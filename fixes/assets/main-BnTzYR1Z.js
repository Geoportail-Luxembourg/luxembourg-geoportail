(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();const fi=n=>typeof n=="string",e0=()=>{let n,e;const t=new Promise((i,r)=>{n=i,e=r});return t.resolve=n,t.reject=e,t},gP=n=>n==null?"":""+n,p6=(n,e,t)=>{n.forEach(i=>{e[i]&&(t[i]=e[i])})},g6=/###/g,mP=n=>n&&n.indexOf("###")>-1?n.replace(g6,"."):n,yP=n=>!n||fi(n),X0=(n,e,t)=>{const i=fi(e)?e.split("."):e;let r=0;for(;r<i.length-1;){if(yP(n))return{};const o=mP(i[r]);!n[o]&&t&&(n[o]=new t),Object.prototype.hasOwnProperty.call(n,o)?n=n[o]:n={},++r}return yP(n)?{}:{obj:n,k:mP(i[r])}},_P=(n,e,t)=>{const{obj:i,k:r}=X0(n,e,Object);if(i!==void 0||e.length===1){i[r]=t;return}let o=e[e.length-1],s=e.slice(0,e.length-1),l=X0(n,s,Object);for(;l.obj===void 0&&s.length;)o=`${s[s.length-1]}.${o}`,s=s.slice(0,s.length-1),l=X0(n,s,Object),l?.obj&&typeof l.obj[`${l.k}.${o}`]<"u"&&(l.obj=void 0);l.obj[`${l.k}.${o}`]=t},m6=(n,e,t,i)=>{const{obj:r,k:o}=X0(n,e,Object);r[o]=r[o]||[],r[o].push(t)},zI=(n,e)=>{const{obj:t,k:i}=X0(n,e);if(t&&Object.prototype.hasOwnProperty.call(t,i))return t[i]},y6=(n,e,t)=>{const i=zI(n,t);return i!==void 0?i:zI(e,t)},S3=(n,e,t)=>{for(const i in e)i!=="__proto__"&&i!=="constructor"&&(i in n?fi(n[i])||n[i]instanceof String||fi(e[i])||e[i]instanceof String?t&&(n[i]=e[i]):S3(n[i],e[i],t):n[i]=e[i]);return n},dm=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var _6={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const v6=n=>fi(n)?n.replace(/[&<>"'\/]/g,e=>_6[e]):n;class b6{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}const x6=[" ",",","?","!",";"],I6=new b6(20),C6=(n,e,t)=>{e=e||"",t=t||"";const i=x6.filter(s=>e.indexOf(s)<0&&t.indexOf(s)<0);if(i.length===0)return!0;const r=I6.getRegExp(`(${i.map(s=>s==="?"?"\\?":s).join("|")})`);let o=!r.test(n);if(!o){const s=n.indexOf(t);s>0&&!r.test(n.substring(0,s))&&(o=!0)}return o},bE=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!n)return;if(n[e])return Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0;const i=e.split(t);let r=n;for(let o=0;o<i.length;){if(!r||typeof r!="object")return;let s,l="";for(let u=o;u<i.length;++u)if(u!==o&&(l+=t),l+=i[u],s=r[l],s!==void 0){if(["string","number","boolean"].indexOf(typeof s)>-1&&u<i.length-1)continue;o+=u-o+1;break}r=s}return r},UI=n=>n?.replace("_","-"),w6={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console?.[n]?.apply?.(console,e)}};class XI{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||w6,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,r){return r&&!this.debug?null:(fi(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new XI(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new XI(this.logger,e)}}var _c=new XI;class bw{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const r=this.observers[i].get(t)||0;this.observers[i].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(s=>{let[l,u]=s;for(let h=0;h<u;h++)l(...i)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(s=>{let[l,u]=s;for(let h=0;h<u;h++)l.apply(l,[e,...i])})}}class vP extends bw{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const o=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,s=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,t],i&&(Array.isArray(i)?l.push(...i):fi(i)&&o?l.push(...i.split(o)):l.push(i)));const u=zI(this.data,l);return!u&&!t&&!i&&e.indexOf(".")>-1&&(e=l[0],t=l[1],i=l.slice(2).join(".")),u||!s||!fi(i)?u:bE(this.data?.[e]?.[t],i,o)}addResource(e,t,i,r){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const s=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator;let l=[e,t];i&&(l=l.concat(s?i.split(s):i)),e.indexOf(".")>-1&&(l=e.split("."),r=t,t=l[1]),this.addNamespaces(t),_P(this.data,l,r),o.silent||this.emit("added",e,t,i,r)}addResources(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const o in i)(fi(i[o])||Array.isArray(i[o]))&&this.addResource(e,t,o,i[o],{silent:!0});r.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,r,o){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},l=[e,t];e.indexOf(".")>-1&&(l=e.split("."),r=i,i=t,t=l[1]),this.addNamespaces(t);let u=zI(this.data,l)||{};s.skipCopy||(i=JSON.parse(JSON.stringify(i))),r?S3(u,i,o):u={...u,...i},_P(this.data,l,u),s.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(r=>t[r]&&Object.keys(t[r]).length>0)}toJSON(){return this.data}}var E3={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,i,r){return n.forEach(o=>{e=this.processors[o]?.process(e,t,i,r)??e}),e}};const bP={},xP=n=>!fi(n)&&typeof n!="boolean"&&typeof n!="number";class YI extends bw{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),p6(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=_c.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};return e==null?!1:this.resolve(e,t)?.res!==void 0}extractFromKey(e,t){let i=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const r=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let o=t.ns||this.options.defaultNS||[];const s=i&&e.indexOf(i)>-1,l=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!C6(e,i,r);if(s&&!l){const u=e.match(this.interpolator.nestingRegexp);if(u&&u.length>0)return{key:e,namespaces:fi(o)?[o]:o};const h=e.split(i);(i!==r||i===r&&this.options.ns.indexOf(h[0])>-1)&&(o=h.shift()),e=h.join(r)}return{key:e,namespaces:fi(o)?[o]:o}}translate(e,t,i){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const r=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,o=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:s,namespaces:l}=this.extractFromKey(e[e.length-1],t),u=l[l.length-1],h=t.lng||this.language,d=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(h?.toLowerCase()==="cimode"){if(d){const fe=t.nsSeparator||this.options.nsSeparator;return r?{res:`${u}${fe}${s}`,usedKey:s,exactUsedKey:s,usedLng:h,usedNS:u,usedParams:this.getUsedParamsDetails(t)}:`${u}${fe}${s}`}return r?{res:s,usedKey:s,exactUsedKey:s,usedLng:h,usedNS:u,usedParams:this.getUsedParamsDetails(t)}:s}const m=this.resolve(e,t);let y=m?.res;const x=m?.usedKey||s,C=m?.exactUsedKey||s,w=["[object Number]","[object Function]","[object RegExp]"],E=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,T=!this.i18nFormat||this.i18nFormat.handleAsObject,k=t.count!==void 0&&!fi(t.count),G=YI.hasDefaultValue(t),O=k?this.pluralResolver.getSuffix(h,t.count,t):"",V=t.ordinal&&k?this.pluralResolver.getSuffix(h,t.count,{ordinal:!1}):"",z=k&&!t.ordinal&&t.count===0,H=z&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${O}`]||t[`defaultValue${V}`]||t.defaultValue;let te=y;T&&!y&&G&&(te=H);const $=xP(te),ae=Object.prototype.toString.apply(te);if(T&&te&&$&&w.indexOf(ae)<0&&!(fi(E)&&Array.isArray(te))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const fe=this.options.returnedObjectHandler?this.options.returnedObjectHandler(x,te,{...t,ns:l}):`key '${s} (${this.language})' returned an object instead of string.`;return r?(m.res=fe,m.usedParams=this.getUsedParamsDetails(t),m):fe}if(o){const fe=Array.isArray(te),Y=fe?[]:{},de=fe?C:x;for(const D in te)if(Object.prototype.hasOwnProperty.call(te,D)){const oe=`${de}${o}${D}`;G&&!y?Y[D]=this.translate(oe,{...t,defaultValue:xP(H)?H[D]:void 0,joinArrays:!1,ns:l}):Y[D]=this.translate(oe,{...t,joinArrays:!1,ns:l}),Y[D]===oe&&(Y[D]=te[D])}y=Y}}else if(T&&fi(E)&&Array.isArray(y))y=y.join(E),y&&(y=this.extendTranslation(y,e,t,i));else{let fe=!1,Y=!1;!this.isValidLookup(y)&&G&&(fe=!0,y=H),this.isValidLookup(y)||(Y=!0,y=s);const D=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&Y?void 0:y,oe=G&&H!==y&&this.options.updateMissing;if(Y||fe||oe){if(this.logger.log(oe?"updateKey":"missingKey",h,u,s,oe?H:y),o){const Ee=this.resolve(s,{...t,keySeparator:!1});Ee&&Ee.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let ue=[];const ge=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&ge&&ge[0])for(let Ee=0;Ee<ge.length;Ee++)ue.push(ge[Ee]);else this.options.saveMissingTo==="all"?ue=this.languageUtils.toResolveHierarchy(t.lng||this.language):ue.push(t.lng||this.language);const Ne=(Ee,se,q)=>{const j=G&&q!==y?q:D;this.options.missingKeyHandler?this.options.missingKeyHandler(Ee,u,se,j,oe,t):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(Ee,u,se,j,oe,t),this.emit("missingKey",Ee,u,se,y)};this.options.saveMissing&&(this.options.saveMissingPlurals&&k?ue.forEach(Ee=>{const se=this.pluralResolver.getSuffixes(Ee,t);z&&t[`defaultValue${this.options.pluralSeparator}zero`]&&se.indexOf(`${this.options.pluralSeparator}zero`)<0&&se.push(`${this.options.pluralSeparator}zero`),se.forEach(q=>{Ne([Ee],s+q,t[`defaultValue${q}`]||H)})}):Ne(ue,s,H))}y=this.extendTranslation(y,e,t,m,i),Y&&y===s&&this.options.appendNamespaceToMissingKey&&(y=`${u}:${s}`),(Y||fe)&&this.options.parseMissingKeyHandler&&(y=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${u}:${s}`:s,fe?y:void 0))}return r?(m.res=y,m.usedParams=this.getUsedParamsDetails(t),m):y}extendTranslation(e,t,i,r,o){var s=this;if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const h=fi(e)&&(i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(h){const y=e.match(this.interpolator.nestingRegexp);d=y&&y.length}let m=i.replace&&!fi(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(m={...this.options.interpolation.defaultVariables,...m}),e=this.interpolator.interpolate(e,m,i.lng||this.language||r.usedLng,i),h){const y=e.match(this.interpolator.nestingRegexp),x=y&&y.length;d<x&&(i.nest=!1)}!i.lng&&r&&r.res&&(i.lng=this.language||r.usedLng),i.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var y=arguments.length,x=new Array(y),C=0;C<y;C++)x[C]=arguments[C];return o?.[0]===x[0]&&!i.context?(s.logger.warn(`It seems you are nesting recursively key: ${x[0]} in key: ${t[0]}`),null):s.translate(...x,t)},i)),i.interpolation&&this.interpolator.reset()}const l=i.postProcess||this.options.postProcess,u=fi(l)?[l]:l;return e!=null&&u?.length&&i.applyPostProcessor!==!1&&(e=E3.handle(u,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i,r,o,s,l;return fi(e)&&(e=[e]),e.forEach(u=>{if(this.isValidLookup(i))return;const h=this.extractFromKey(u,t),d=h.key;r=d;let m=h.namespaces;this.options.fallbackNS&&(m=m.concat(this.options.fallbackNS));const y=t.count!==void 0&&!fi(t.count),x=y&&!t.ordinal&&t.count===0,C=t.context!==void 0&&(fi(t.context)||typeof t.context=="number")&&t.context!=="",w=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);m.forEach(E=>{this.isValidLookup(i)||(l=E,!bP[`${w[0]}-${E}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(l)&&(bP[`${w[0]}-${E}`]=!0,this.logger.warn(`key "${r}" for languages "${w.join(", ")}" won't get resolved as namespace "${l}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),w.forEach(T=>{if(this.isValidLookup(i))return;s=T;const k=[d];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(k,d,T,E,t);else{let O;y&&(O=this.pluralResolver.getSuffix(T,t.count,t));const V=`${this.options.pluralSeparator}zero`,z=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(y&&(k.push(d+O),t.ordinal&&O.indexOf(z)===0&&k.push(d+O.replace(z,this.options.pluralSeparator)),x&&k.push(d+V)),C){const H=`${d}${this.options.contextSeparator}${t.context}`;k.push(H),y&&(k.push(H+O),t.ordinal&&O.indexOf(z)===0&&k.push(H+O.replace(z,this.options.pluralSeparator)),x&&k.push(H+V))}}let G;for(;G=k.pop();)this.isValidLookup(i)||(o=G,i=this.getResource(T,E,G,t))}))})}),{res:i,usedKey:r,exactUsedKey:o,usedLng:s,usedNS:l}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,i,r):this.resourceStore.getResource(e,t,i,r)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=e.replace&&!fi(e.replace);let r=i?e.replace:e;if(i&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!i){r={...r};for(const o of t)delete r[o]}return r}static hasDefaultValue(e){const t="defaultValue";for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,t.length)&&e[i]!==void 0)return!0;return!1}}class IP{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=_c.create("languageUtils")}getScriptPartFromCode(e){if(e=UI(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=UI(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(fi(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(i=>{if(t)return;const r=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(i=>{if(t)return;const r=this.getLanguagePartFromCode(i);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(o=>{if(o===r)return o;if(!(o.indexOf("-")<0&&r.indexOf("-")<0)&&(o.indexOf("-")>0&&r.indexOf("-")<0&&o.substring(0,o.indexOf("-"))===r||o.indexOf(r)===0&&r.length>1))return o})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),fi(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){const i=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],o=s=>{s&&(this.isSupportedCode(s)?r.push(s):this.logger.warn(`rejecting language code not found in supportedLngs: ${s}`))};return fi(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&o(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&o(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&o(this.getLanguagePartFromCode(e))):fi(e)&&o(this.formatLanguageCode(e)),i.forEach(s=>{r.indexOf(s)<0&&o(this.formatLanguageCode(s))}),r}}const CP={zero:0,one:1,two:2,few:3,many:4,other:5},wP={select:n=>n===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class A6{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=_c.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=UI(e==="dev"?"en":e),r=t.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:i,type:r});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];let s;try{s=new Intl.PluralRules(i,{type:r})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),wP;if(!e.match(/-|_/))return wP;const u=this.languageUtils.getLanguagePartFromCode(e);s=this.getRule(u,t)}return this.pluralRulesCache[o]=s,s}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,i).map(r=>`${t}${r}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?i.resolvedOptions().pluralCategories.sort((r,o)=>CP[r]-CP[o]).map(r=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${r}`):[]}getSuffix(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=this.getRule(e,i);return r?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,i))}}const AP=function(n,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=y6(n,e,t);return!o&&r&&fi(t)&&(o=bE(n,t,i),o===void 0&&(o=bE(e,t,i))),o},x2=n=>n.replace(/\$/g,"$$$$");class S6{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=_c.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(t=>t),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:i,useRawValueToEscape:r,prefix:o,prefixEscaped:s,suffix:l,suffixEscaped:u,formatSeparator:h,unescapeSuffix:d,unescapePrefix:m,nestingPrefix:y,nestingPrefixEscaped:x,nestingSuffix:C,nestingSuffixEscaped:w,nestingOptionsSeparator:E,maxReplaces:T,alwaysFormat:k}=e.interpolation;this.escape=t!==void 0?t:v6,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=o?dm(o):s||"{{",this.suffix=l?dm(l):u||"}}",this.formatSeparator=h||",",this.unescapePrefix=d?"":m||"-",this.unescapeSuffix=this.unescapePrefix?"":d||"",this.nestingPrefix=y?dm(y):x||dm("$t("),this.nestingSuffix=C?dm(C):w||dm(")"),this.nestingOptionsSeparator=E||",",this.maxReplaces=T||1e3,this.alwaysFormat=k!==void 0?k:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,i)=>t?.source===i?(t.lastIndex=0,t):new RegExp(i,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,i,r){let o,s,l;const u=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},h=x=>{if(x.indexOf(this.formatSeparator)<0){const T=AP(t,u,x,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(T,void 0,i,{...r,...t,interpolationkey:x}):T}const C=x.split(this.formatSeparator),w=C.shift().trim(),E=C.join(this.formatSeparator).trim();return this.format(AP(t,u,w,this.options.keySeparator,this.options.ignoreJSONStructure),E,i,{...r,...t,interpolationkey:w})};this.resetRegExp();const d=r?.missingInterpolationHandler||this.options.missingInterpolationHandler,m=r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:x=>x2(x)},{regex:this.regexp,safeValue:x=>this.escapeValue?x2(this.escape(x)):x2(x)}].forEach(x=>{for(l=0;o=x.regex.exec(e);){const C=o[1].trim();if(s=h(C),s===void 0)if(typeof d=="function"){const E=d(e,o,r);s=fi(E)?E:""}else if(r&&Object.prototype.hasOwnProperty.call(r,C))s="";else if(m){s=o[0];continue}else this.logger.warn(`missed to pass in variable ${C} for interpolating ${e}`),s="";else!fi(s)&&!this.useRawValueToEscape&&(s=gP(s));const w=x.safeValue(s);if(e=e.replace(o[0],w),m?(x.regex.lastIndex+=s.length,x.regex.lastIndex-=o[0].length):x.regex.lastIndex=0,l++,l>=this.maxReplaces)break}}),e}nest(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,o,s;const l=(u,h)=>{const d=this.nestingOptionsSeparator;if(u.indexOf(d)<0)return u;const m=u.split(new RegExp(`${d}[ ]*{`));let y=`{${m[1]}`;u=m[0],y=this.interpolate(y,s);const x=y.match(/'/g),C=y.match(/"/g);((x?.length??0)%2===0&&!C||C.length%2!==0)&&(y=y.replace(/'/g,'"'));try{s=JSON.parse(y),h&&(s={...h,...s})}catch(w){return this.logger.warn(`failed parsing options string in nesting for key ${u}`,w),`${u}${d}${y}`}return s.defaultValue&&s.defaultValue.indexOf(this.prefix)>-1&&delete s.defaultValue,u};for(;r=this.nestingRegexp.exec(e);){let u=[];s={...i},s=s.replace&&!fi(s.replace)?s.replace:s,s.applyPostProcessor=!1,delete s.defaultValue;let h=!1;if(r[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(r[1])){const d=r[1].split(this.formatSeparator).map(m=>m.trim());r[1]=d.shift(),u=d,h=!0}if(o=t(l.call(this,r[1].trim(),s),s),o&&r[0]===e&&!fi(o))return o;fi(o)||(o=gP(o)),o||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),o=""),h&&(o=u.reduce((d,m)=>this.format(d,m,i.lng,{...i,interpolationkey:r[1].trim()}),o.trim())),e=e.replace(r[0],o),this.regexp.lastIndex=0}return e}}const E6=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const i=n.split("(");e=i[0].toLowerCase().trim();const r=i[1].substring(0,i[1].length-1);e==="currency"&&r.indexOf(":")<0?t.currency||(t.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?t.range||(t.range=r.trim()):r.split(";").forEach(s=>{if(s){const[l,...u]=s.split(":"),h=u.join(":").trim().replace(/^'+|'+$/g,""),d=l.trim();t[d]||(t[d]=h),h==="false"&&(t[d]=!1),h==="true"&&(t[d]=!0),isNaN(h)||(t[d]=parseInt(h,10))}})}return{formatName:e,formatOptions:t}},fm=n=>{const e={};return(t,i,r)=>{let o=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(o={...o,[r.interpolationkey]:void 0});const s=i+JSON.stringify(o);let l=e[s];return l||(l=n(UI(i),r),e[s]=l),l(t)}};let T6=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=_c.create("formatter"),this.options=e,this.formats={number:fm((t,i)=>{const r=new Intl.NumberFormat(t,{...i});return o=>r.format(o)}),currency:fm((t,i)=>{const r=new Intl.NumberFormat(t,{...i,style:"currency"});return o=>r.format(o)}),datetime:fm((t,i)=>{const r=new Intl.DateTimeFormat(t,{...i});return o=>r.format(o)}),relativetime:fm((t,i)=>{const r=new Intl.RelativeTimeFormat(t,{...i});return o=>r.format(o,i.range||"day")}),list:fm((t,i)=>{const r=new Intl.ListFormat(t,{...i});return o=>r.format(o)})},this.init(e)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=fm(t)}format(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const o=t.split(this.formatSeparator);if(o.length>1&&o[0].indexOf("(")>1&&o[0].indexOf(")")<0&&o.find(l=>l.indexOf(")")>-1)){const l=o.findIndex(u=>u.indexOf(")")>-1);o[0]=[o[0],...o.splice(1,l)].join(this.formatSeparator)}return o.reduce((l,u)=>{const{formatName:h,formatOptions:d}=E6(u);if(this.formats[h]){let m=l;try{const y=r?.formatParams?.[r.interpolationkey]||{},x=y.locale||y.lng||r.locale||r.lng||i;m=this.formats[h](l,x,{...d,...r,...y})}catch(y){this.logger.warn(y)}return m}else this.logger.warn(`there was no format function for ${h}`);return l},e)}};const R6=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class M6 extends bw{constructor(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=r,this.logger=_c.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(i,r.backend,r)}queueLoad(e,t,i,r){const o={},s={},l={},u={};return e.forEach(h=>{let d=!0;t.forEach(m=>{const y=`${h}|${m}`;!i.reload&&this.store.hasResourceBundle(h,m)?this.state[y]=2:this.state[y]<0||(this.state[y]===1?s[y]===void 0&&(s[y]=!0):(this.state[y]=1,d=!1,s[y]===void 0&&(s[y]=!0),o[y]===void 0&&(o[y]=!0),u[m]===void 0&&(u[m]=!0)))}),d||(l[h]=!0)}),(Object.keys(o).length||Object.keys(s).length)&&this.queue.push({pending:s,pendingCount:Object.keys(s).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(o),pending:Object.keys(s),toLoadLanguages:Object.keys(l),toLoadNamespaces:Object.keys(u)}}loaded(e,t,i){const r=e.split("|"),o=r[0],s=r[1];t&&this.emit("failedLoading",o,s,t),!t&&i&&this.store.addResourceBundle(o,s,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);const l={};this.queue.forEach(u=>{m6(u.loaded,[o],s),R6(u,e),t&&u.errors.push(t),u.pendingCount===0&&!u.done&&(Object.keys(u.loaded).forEach(h=>{l[h]||(l[h]={});const d=u.loaded[h];d.length&&d.forEach(m=>{l[h][m]===void 0&&(l[h][m]=!0)})}),u.done=!0,u.errors.length?u.callback(u.errors):u.callback())}),this.emit("loaded",l),this.queue=this.queue.filter(u=>!u.done)}read(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,s=arguments.length>5?arguments[5]:void 0;if(!e.length)return s(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:i,tried:r,wait:o,callback:s});return}this.readingCalls++;const l=(h,d)=>{if(this.readingCalls--,this.waitingReads.length>0){const m=this.waitingReads.shift();this.read(m.lng,m.ns,m.fcName,m.tried,m.wait,m.callback)}if(h&&d&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,i,r+1,o*2,s)},o);return}s(h,d)},u=this.backend[i].bind(this.backend);if(u.length===2){try{const h=u(e,t);h&&typeof h.then=="function"?h.then(d=>l(null,d)).catch(l):l(null,h)}catch(h){l(h)}return}return u(e,t,l)}prepareLoading(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();fi(e)&&(e=this.languageUtils.toResolveHierarchy(e)),fi(t)&&(t=[t]);const o=this.queueLoad(e,t,i,r);if(!o.toLoad.length)return o.pending.length||r(),null;o.toLoad.forEach(s=>{this.loadOne(s)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=e.split("|"),r=i[0],o=i[1];this.read(r,o,"read",void 0,void 0,(s,l)=>{s&&this.logger.warn(`${t}loading namespace ${o} for language ${r} failed`,s),!s&&l&&this.logger.log(`${t}loaded namespace ${o} for language ${r}`,l),this.loaded(e,s,l)})}saveMissing(e,t,i,r,o){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend?.create){const u={...s,isUpdate:o},h=this.backend.create.bind(this.backend);if(h.length<6)try{let d;h.length===5?d=h(e,t,i,r,u):d=h(e,t,i,r),d&&typeof d.then=="function"?d.then(m=>l(null,m)).catch(l):l(null,d)}catch(d){l(d)}else h(e,t,i,r,l,u)}!e||!e[0]||this.store.addResource(e[0],t,i,r)}}}const SP=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),fi(n[1])&&(e.defaultValue=n[1]),fi(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(i=>{e[i]=t[i]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),EP=n=>(fi(n.ns)&&(n.ns=[n.ns]),fi(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),fi(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs?.indexOf?.("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),typeof n.initImmediate=="boolean"&&(n.initAsync=n.initImmediate),n),$1=()=>{},k6=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})};class bv extends bw{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=EP(e),this.services={},this.logger=_c,this.modules={external:[]},k6(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(i=t,t={}),t.defaultNS==null&&t.ns&&(fi(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=SP();this.options={...r,...this.options,...EP(t)},this.options.interpolation={...r.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const o=d=>d?typeof d=="function"?new d:d:null;if(!this.options.isClone){this.modules.logger?_c.init(o(this.modules.logger),this.options):_c.init(null,this.options);let d;this.modules.formatter?d=this.modules.formatter:d=T6;const m=new IP(this.options);this.store=new vP(this.options.resources,this.options);const y=this.services;y.logger=_c,y.resourceStore=this.store,y.languageUtils=m,y.pluralResolver=new A6(m,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),d&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(y.formatter=o(d),y.formatter.init(y,this.options),this.options.interpolation.format=y.formatter.format.bind(y.formatter)),y.interpolator=new S6(this.options),y.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},y.backendConnector=new M6(o(this.modules.backend),y.resourceStore,y,this.options),y.backendConnector.on("*",function(x){for(var C=arguments.length,w=new Array(C>1?C-1:0),E=1;E<C;E++)w[E-1]=arguments[E];e.emit(x,...w)}),this.modules.languageDetector&&(y.languageDetector=o(this.modules.languageDetector),y.languageDetector.init&&y.languageDetector.init(y,this.options.detection,this.options)),this.modules.i18nFormat&&(y.i18nFormat=o(this.modules.i18nFormat),y.i18nFormat.init&&y.i18nFormat.init(this)),this.translator=new YI(this.services,this.options),this.translator.on("*",function(x){for(var C=arguments.length,w=new Array(C>1?C-1:0),E=1;E<C;E++)w[E-1]=arguments[E];e.emit(x,...w)}),this.modules.external.forEach(x=>{x.init&&x.init(this)})}if(this.format=this.options.interpolation.format,i||(i=$1),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const d=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);d.length>0&&d[0]!=="dev"&&(this.options.lng=d[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(d=>{this[d]=function(){return e.store[d](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(d=>{this[d]=function(){return e.store[d](...arguments),e}});const u=e0(),h=()=>{const d=(m,y)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),u.resolve(y),i(m,y)};if(this.languages&&!this.isInitialized)return d(null,this.t.bind(this));this.changeLanguage(this.options.lng,d)};return this.options.resources||!this.options.initAsync?h():setTimeout(h,0),u}loadResources(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$1;const r=fi(e)?e:this.language;if(typeof e=="function"&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(r?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const o=[],s=l=>{if(!l||l==="cimode")return;this.services.languageUtils.toResolveHierarchy(l).forEach(h=>{h!=="cimode"&&o.indexOf(h)<0&&o.push(h)})};r?s(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(u=>s(u)),this.options.preload?.forEach?.(l=>s(l)),this.services.backendConnector.load(o,this.options.ns,l=>{!l&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(l)})}else i(null)}reloadResources(e,t,i){const r=e0();return typeof e=="function"&&(i=e,e=void 0),typeof t=="function"&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=$1),this.services.backendConnector.reload(e,t,o=>{r.resolve(),i(o)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&E3.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const i=this.languages[t];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}}changeLanguage(e,t){var i=this;this.isLanguageChangingTo=e;const r=e0();this.emit("languageChanging",e);const o=u=>{this.language=u,this.languages=this.services.languageUtils.toResolveHierarchy(u),this.resolvedLanguage=void 0,this.setResolvedLanguage(u)},s=(u,h)=>{h?(o(h),this.translator.changeLanguage(h),this.isLanguageChangingTo=void 0,this.emit("languageChanged",h),this.logger.log("languageChanged",h)):this.isLanguageChangingTo=void 0,r.resolve(function(){return i.t(...arguments)}),t&&t(u,function(){return i.t(...arguments)})},l=u=>{!e&&!u&&this.services.languageDetector&&(u=[]);const h=fi(u)?u:this.services.languageUtils.getBestMatchFromCodes(u);h&&(this.language||o(h),this.translator.language||this.translator.changeLanguage(h),this.services.languageDetector?.cacheUserLanguage?.(h)),this.loadResources(h,d=>{s(d,h)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?l(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(l):this.services.languageDetector.detect(l):l(e),r}getFixedT(e,t,i){var r=this;const o=function(s,l){let u;if(typeof l!="object"){for(var h=arguments.length,d=new Array(h>2?h-2:0),m=2;m<h;m++)d[m-2]=arguments[m];u=r.options.overloadTranslationOptionHandler([s,l].concat(d))}else u={...l};u.lng=u.lng||o.lng,u.lngs=u.lngs||o.lngs,u.ns=u.ns||o.ns,u.keyPrefix!==""&&(u.keyPrefix=u.keyPrefix||i||o.keyPrefix);const y=r.options.keySeparator||".";let x;return u.keyPrefix&&Array.isArray(s)?x=s.map(C=>`${u.keyPrefix}${y}${C}`):x=u.keyPrefix?`${u.keyPrefix}${y}${s}`:s,r.t(x,u)};return fi(e)?o.lng=e:o.lngs=e,o.ns=t,o.keyPrefix=i,o}t(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.translator?.translate(...t)}exists(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.translator?.exists(...t)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=t.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,o=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const s=(l,u)=>{const h=this.services.backendConnector.state[`${l}|${u}`];return h===-1||h===0||h===2};if(t.precheck){const l=t.precheck(this,s);if(l!==void 0)return l}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||s(i,e)&&(!r||s(o,e)))}loadNamespaces(e,t){const i=e0();return this.options.ns?(fi(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{i.resolve(),t&&t(r)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){const i=e0();fi(e)&&(e=[e]);const r=this.options.preload||[],o=e.filter(s=>r.indexOf(s)<0&&this.services.languageUtils.isSupportedCode(s));return o.length?(this.options.preload=r.concat(o),this.loadResources(s=>{i.resolve(),t&&t(s)}),i):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services?.languageUtils||new IP(SP());return t.indexOf(i.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new bv(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$1;const i=e.forkResourceStore;i&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},o=new bv(r);if((e.debug!==void 0||e.prefix!==void 0)&&(o.logger=o.logger.clone(e)),["store","services","language"].forEach(l=>{o[l]=this[l]}),o.services={...this.services},o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},i){const l=Object.keys(this.store.data).reduce((u,h)=>(u[h]={...this.store.data[h]},Object.keys(u[h]).reduce((d,m)=>(d[m]={...u[h][m]},d),{})),{});o.store=new vP(l,r),o.services.resourceStore=o.store}return o.translator=new YI(o.services,r),o.translator.on("*",function(l){for(var u=arguments.length,h=new Array(u>1?u-1:0),d=1;d<u;d++)h[d-1]=arguments[d];o.emit(l,...h)}),o.init(r,t),o.translator.options=r,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Wn=bv.createInstance();Wn.createInstance=bv.createInstance;Wn.createInstance;Wn.dir;Wn.init;Wn.loadResources;Wn.reloadResources;Wn.use;Wn.changeLanguage;Wn.getFixedT;const L6=Wn.t;Wn.exists;Wn.setDefaultNamespace;Wn.hasLoadedNamespace;Wn.loadNamespaces;Wn.loadLanguages;function xE(n){"@babel/helpers - typeof";return xE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xE(n)}function T3(){return typeof XMLHttpRequest=="function"||(typeof XMLHttpRequest>"u"?"undefined":xE(XMLHttpRequest))==="object"}function P6(n){return!!n&&typeof n.then=="function"}function G6(n){return P6(n)?n:Promise.resolve(n)}const F6="modulepreload",O6=function(n){return"/luxembourg-geoportail/fixes/"+n},TP={},HI=function(e,t,i){let r=Promise.resolve();if(t&&t.length>0){let u=function(h){return Promise.all(h.map(d=>Promise.resolve(d).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");r=u(t.map(h=>{if(h=O6(h),h in TP)return;TP[h]=!0;const d=h.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const y=document.createElement("link");if(y.rel=d?"stylesheet":F6,d||(y.as="script"),y.crossOrigin="",y.href=h,l&&y.setAttribute("nonce",l),document.head.appendChild(y),d)return new Promise((x,C)=>{y.addEventListener("load",x),y.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return r.then(s=>{for(const l of s||[])l.status==="rejected"&&o(l.reason);return e().catch(o)})};function RP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function MP(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?RP(Object(t),!0).forEach(function(i){N6(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):RP(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function N6(n,e,t){return(e=D6(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function D6(n){var e=V6(n,"string");return Xp(e)=="symbol"?e:e+""}function V6(n,e){if(Xp(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(Xp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Xp(n){"@babel/helpers - typeof";return Xp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xp(n)}var df=typeof fetch=="function"?fetch:void 0;typeof global<"u"&&global.fetch?df=global.fetch:typeof window<"u"&&window.fetch&&(df=window.fetch);var xv;T3()&&(typeof global<"u"&&global.XMLHttpRequest?xv=global.XMLHttpRequest:typeof window<"u"&&window.XMLHttpRequest&&(xv=window.XMLHttpRequest));var KI;typeof ActiveXObject=="function"&&(typeof global<"u"&&global.ActiveXObject?KI=global.ActiveXObject:typeof window<"u"&&window.ActiveXObject&&(KI=window.ActiveXObject));typeof df!="function"&&(df=void 0);if(!df&&!xv&&!KI)try{HI(()=>import("./browser-ponyfill-RY7LYq4N.js").then(n=>n.b),[]).then(function(n){df=n.default}).catch(function(){})}catch{}var IE=function(e,t){if(t&&Xp(t)==="object"){var i="";for(var r in t)i+="&"+encodeURIComponent(r)+"="+encodeURIComponent(t[r]);if(!i)return e;e=e+(e.indexOf("?")!==-1?"&":"?")+i.slice(1)}return e},kP=function(e,t,i,r){var o=function(u){if(!u.ok)return i(u.statusText||"Error",{status:u.status});u.text().then(function(h){i(null,{status:u.status,data:h})}).catch(i)};if(r){var s=r(e,t);if(s instanceof Promise){s.then(o).catch(i);return}}typeof fetch=="function"?fetch(e,t).then(o).catch(i):df(e,t).then(o).catch(i)},LP=!1,B6=function(e,t,i,r){e.queryStringParams&&(t=IE(t,e.queryStringParams));var o=MP({},typeof e.customHeaders=="function"?e.customHeaders():e.customHeaders);typeof window>"u"&&typeof global<"u"&&typeof global.process<"u"&&global.process.versions&&global.process.versions.node&&(o["User-Agent"]="i18next-http-backend (node/".concat(global.process.version,"; ").concat(global.process.platform," ").concat(global.process.arch,")")),i&&(o["Content-Type"]="application/json");var s=typeof e.requestOptions=="function"?e.requestOptions(i):e.requestOptions,l=MP({method:i?"POST":"GET",body:i?e.stringify(i):void 0,headers:o},LP?{}:s),u=typeof e.alternateFetch=="function"&&e.alternateFetch.length>=1?e.alternateFetch:void 0;try{kP(t,l,r,u)}catch(h){if(!s||Object.keys(s).length===0||!h.message||h.message.indexOf("not implemented")<0)return r(h);try{Object.keys(s).forEach(function(d){delete l[d]}),kP(t,l,r,u),LP=!0}catch(d){r(d)}}},Z6=function(e,t,i,r){i&&Xp(i)==="object"&&(i=IE("",i).slice(1)),e.queryStringParams&&(t=IE(t,e.queryStringParams));try{var o=xv?new xv:new KI("MSXML2.XMLHTTP.3.0");o.open(i?"POST":"GET",t,1),e.crossDomain||o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.withCredentials=!!e.withCredentials,i&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.overrideMimeType&&o.overrideMimeType("application/json");var s=e.customHeaders;if(s=typeof s=="function"?s():s,s)for(var l in s)o.setRequestHeader(l,s[l]);o.onreadystatechange=function(){o.readyState>3&&r(o.status>=400?o.statusText:null,{status:o.status,data:o.responseText})},o.send(i)}catch(u){console&&console.log(u)}},W6=function(e,t,i,r){if(typeof i=="function"&&(r=i,i=void 0),r=r||function(){},df&&t.indexOf("file:")!==0)return B6(e,t,i,r);if(T3()||typeof ActiveXObject=="function")return Z6(e,t,i,r);r(new Error("No fetch and no xhr implementation found!"))};function Iy(n){"@babel/helpers - typeof";return Iy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Iy(n)}function PP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function I2(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?PP(Object(t),!0).forEach(function(i){R3(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):PP(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function z6(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function U6(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,M3(i.key),i)}}function X6(n,e,t){return e&&U6(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function R3(n,e,t){return(e=M3(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function M3(n){var e=Y6(n,"string");return Iy(e)=="symbol"?e:e+""}function Y6(n,e){if(Iy(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(Iy(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}var H6=function(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",parse:function(t){return JSON.parse(t)},stringify:JSON.stringify,parsePayload:function(t,i,r){return R3({},i,r||"")},parseLoadPayload:function(t,i){},request:W6,reloadInterval:typeof window<"u"?!1:3600*1e3,customHeaders:{},queryStringParams:{},crossDomain:!1,withCredentials:!1,overrideMimeType:!1,requestOptions:{mode:"cors",credentials:"same-origin",cache:"default"}}},k3=(function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};z6(this,n),this.services=e,this.options=t,this.allOptions=i,this.type="backend",this.init(e,t,i)}return X6(n,[{key:"init",value:function(t){var i=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.services=t,this.options=I2(I2(I2({},H6()),this.options||{}),r),this.allOptions=o,this.services&&this.options.reloadInterval){var s=setInterval(function(){return i.reload()},this.options.reloadInterval);Iy(s)==="object"&&typeof s.unref=="function"&&s.unref()}}},{key:"readMulti",value:function(t,i,r){this._readAny(t,t,i,i,r)}},{key:"read",value:function(t,i,r){this._readAny([t],t,[i],i,r)}},{key:"_readAny",value:function(t,i,r,o,s){var l=this,u=this.options.loadPath;typeof this.options.loadPath=="function"&&(u=this.options.loadPath(t,r)),u=G6(u),u.then(function(h){if(!h)return s(null,{});var d=l.services.interpolator.interpolate(h,{lng:t.join("+"),ns:r.join("+")});l.loadUrl(d,s,i,o)})}},{key:"loadUrl",value:function(t,i,r,o){var s=this,l=typeof r=="string"?[r]:r,u=typeof o=="string"?[o]:o,h=this.options.parseLoadPayload(l,u);this.options.request(this.options,t,h,function(d,m){if(m&&(m.status>=500&&m.status<600||!m.status))return i("failed loading "+t+"; status code: "+m.status,!0);if(m&&m.status>=400&&m.status<500)return i("failed loading "+t+"; status code: "+m.status,!1);if(!m&&d&&d.message){var y=d.message.toLowerCase(),x=["failed","fetch","network","load"].find(function(E){return y.indexOf(E)>-1});if(x)return i("failed loading "+t+": "+d.message,!0)}if(d)return i(d,!1);var C,w;try{typeof m.data=="string"?C=s.options.parse(m.data,r,o):C=m.data}catch{w="failed parsing "+t+" to json"}if(w)return i(w,!1);i(null,C)})}},{key:"create",value:function(t,i,r,o,s){var l=this;if(this.options.addPath){typeof t=="string"&&(t=[t]);var u=this.options.parsePayload(i,r,o),h=0,d=[],m=[];t.forEach(function(y){var x=l.options.addPath;typeof l.options.addPath=="function"&&(x=l.options.addPath(y,i));var C=l.services.interpolator.interpolate(x,{lng:y,ns:i});l.options.request(l.options,C,u,function(w,E){h+=1,d.push(w),m.push(E),h===t.length&&typeof s=="function"&&s(d,m)})})}}},{key:"reload",value:function(){var t=this,i=this.services,r=i.backendConnector,o=i.languageUtils,s=i.logger,l=r.language;if(!(l&&l.toLowerCase()==="cimode")){var u=[],h=function(m){var y=o.toResolveHierarchy(m);y.forEach(function(x){u.indexOf(x)<0&&u.push(x)})};h(l),this.allOptions.preload&&this.allOptions.preload.forEach(function(d){return h(d)}),u.forEach(function(d){t.allOptions.ns.forEach(function(m){r.read(d,m,"read",null,null,function(y,x){y&&s.warn("loading namespace ".concat(m," for language ").concat(d," failed"),y),!y&&x&&s.log("loaded namespace ".concat(m," for language ").concat(d),x),r.loaded("".concat(d,"|").concat(m),y,x)})})})}}}])})();k3.type="backend";function bR(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const kr={},ty=[],Ac=()=>{},L3=()=>!1,xw=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),xR=n=>n.startsWith("onUpdate:"),wo=Object.assign,IR=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},K6=Object.prototype.hasOwnProperty,_r=(n,e)=>K6.call(n,e),zn=Array.isArray,ny=n=>ab(n)==="[object Map]",Vy=n=>ab(n)==="[object Set]",GP=n=>ab(n)==="[object Date]",ci=n=>typeof n=="function",ys=n=>typeof n=="string",ku=n=>typeof n=="symbol",Rr=n=>n!==null&&typeof n=="object",P3=n=>(Rr(n)||ci(n))&&ci(n.then)&&ci(n.catch),G3=Object.prototype.toString,ab=n=>G3.call(n),j6=n=>ab(n).slice(8,-1),F3=n=>ab(n)==="[object Object]",Iw=n=>ys(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Y0=bR(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Cw=n=>{const e=Object.create(null);return(t=>e[t]||(e[t]=n(t)))},$6=/-\w/g,eu=Cw(n=>n.replace($6,e=>e.slice(1).toUpperCase())),J6=/\B([A-Z])/g,Cf=Cw(n=>n.replace(J6,"-$1").toLowerCase()),ww=Cw(n=>n.charAt(0).toUpperCase()+n.slice(1)),C2=Cw(n=>n?`on${ww(n)}`:""),of=(n,e)=>!Object.is(n,e),sI=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},O3=(n,e,t,i=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:i,value:t})},Aw=n=>{const e=parseFloat(n);return isNaN(e)?n:e},q6=n=>{const e=ys(n)?Number(n):NaN;return isNaN(e)?n:e};let FP;const Sw=()=>FP||(FP=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Vc(n){if(zn(n)){const e={};for(let t=0;t<n.length;t++){const i=n[t],r=ys(i)?n9(i):Vc(i);if(r)for(const o in r)e[o]=r[o]}return e}else if(ys(n)||Rr(n))return n}const Q6=/;(?![^(]*\))/g,e9=/:([^]+)/,t9=/\/\*[^]*?\*\//g;function n9(n){const e={};return n.replace(t9,"").split(Q6).forEach(t=>{if(t){const i=t.split(e9);i.length>1&&(e[i[0].trim()]=i[1].trim())}}),e}function Rn(n){let e="";if(ys(n))e=n;else if(zn(n))for(let t=0;t<n.length;t++){const i=Rn(n[t]);i&&(e+=i+" ")}else if(Rr(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const i9="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",r9=bR(i9);function N3(n){return!!n||n===""}function s9(n,e){if(n.length!==e.length)return!1;let t=!0;for(let i=0;t&&i<n.length;i++)t=lb(n[i],e[i]);return t}function lb(n,e){if(n===e)return!0;let t=GP(n),i=GP(e);if(t||i)return t&&i?n.getTime()===e.getTime():!1;if(t=ku(n),i=ku(e),t||i)return n===e;if(t=zn(n),i=zn(e),t||i)return t&&i?s9(n,e):!1;if(t=Rr(n),i=Rr(e),t||i){if(!t||!i)return!1;const r=Object.keys(n).length,o=Object.keys(e).length;if(r!==o)return!1;for(const s in n){const l=n.hasOwnProperty(s),u=e.hasOwnProperty(s);if(l&&!u||!l&&u||!lb(n[s],e[s]))return!1}}return String(n)===String(e)}function CR(n,e){return n.findIndex(t=>lb(t,e))}const D3=n=>!!(n&&n.__v_isRef===!0),K=n=>ys(n)?n:n==null?"":zn(n)||Rr(n)&&(n.toString===G3||!ci(n.toString))?D3(n)?K(n.value):JSON.stringify(n,V3,2):String(n),V3=(n,e)=>D3(e)?V3(n,e.value):ny(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[i,r],o)=>(t[w2(i,o)+" =>"]=r,t),{})}:Vy(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>w2(t))}:ku(e)?w2(e):Rr(e)&&!zn(e)&&!F3(e)?String(e):e,w2=(n,e="")=>{var t;return ku(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};let qo;class B3{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=qo,!e&&qo&&(this.index=(qo.scopes||(qo.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=qo;try{return qo=this,e()}finally{qo=t}}}on(){++this._on===1&&(this.prevScope=qo,qo=this)}off(){this._on>0&&--this._on===0&&(qo=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,i;for(t=0,i=this.effects.length;t<i;t++)this.effects[t].stop();for(this.effects.length=0,t=0,i=this.cleanups.length;t<i;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,i=this.scopes.length;t<i;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0}}}function Z3(n){return new B3(n)}function W3(){return qo}function o9(n,e=!1){qo&&qo.cleanups.push(n)}let Br;const A2=new WeakSet;class z3{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,qo&&qo.active&&qo.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,A2.has(this)&&(A2.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||X3(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,OP(this),Y3(this);const e=Br,t=Tu;Br=this,Tu=!0;try{return this.fn()}finally{H3(this),Br=e,Tu=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)SR(e);this.deps=this.depsTail=void 0,OP(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?A2.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){CE(this)&&this.run()}get dirty(){return CE(this)}}let U3=0,H0,K0;function X3(n,e=!1){if(n.flags|=8,e){n.next=K0,K0=n;return}n.next=H0,H0=n}function wR(){U3++}function AR(){if(--U3>0)return;if(K0){let e=K0;for(K0=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;H0;){let e=H0;for(H0=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(i){n||(n=i)}e=t}}if(n)throw n}function Y3(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function H3(n){let e,t=n.depsTail,i=t;for(;i;){const r=i.prevDep;i.version===-1?(i===t&&(t=r),SR(i),a9(i)):e=i,i.dep.activeLink=i.prevActiveLink,i.prevActiveLink=void 0,i=r}n.deps=e,n.depsTail=t}function CE(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(K3(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function K3(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Iv)||(n.globalVersion=Iv,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!CE(n))))return;n.flags|=2;const e=n.dep,t=Br,i=Tu;Br=n,Tu=!0;try{Y3(n);const r=n.fn(n._value);(e.version===0||of(r,n._value))&&(n.flags|=128,n._value=r,e.version++)}catch(r){throw e.version++,r}finally{Br=t,Tu=i,H3(n),n.flags&=-3}}function SR(n,e=!1){const{dep:t,prevSub:i,nextSub:r}=n;if(i&&(i.nextSub=r,n.prevSub=void 0),r&&(r.prevSub=i,n.nextSub=void 0),t.subs===n&&(t.subs=i,!i&&t.computed)){t.computed.flags&=-5;for(let o=t.computed.deps;o;o=o.nextDep)SR(o,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function a9(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Tu=!0;const j3=[];function Uh(){j3.push(Tu),Tu=!1}function Xh(){const n=j3.pop();Tu=n===void 0?!0:n}function OP(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Br;Br=void 0;try{e()}finally{Br=t}}}let Iv=0;class l9{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class ER{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Br||!Tu||Br===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Br)t=this.activeLink=new l9(Br,this),Br.deps?(t.prevDep=Br.depsTail,Br.depsTail.nextDep=t,Br.depsTail=t):Br.deps=Br.depsTail=t,$3(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const i=t.nextDep;i.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=i),t.prevDep=Br.depsTail,t.nextDep=void 0,Br.depsTail.nextDep=t,Br.depsTail=t,Br.deps===t&&(Br.deps=i)}return t}trigger(e){this.version++,Iv++,this.notify(e)}notify(e){wR();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{AR()}}}function $3(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let i=e.deps;i;i=i.nextDep)$3(i)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const jI=new WeakMap,Bp=Symbol(""),wE=Symbol(""),Cv=Symbol("");function ta(n,e,t){if(Tu&&Br){let i=jI.get(n);i||jI.set(n,i=new Map);let r=i.get(t);r||(i.set(t,r=new ER),r.map=i,r.key=t),r.track()}}function Rh(n,e,t,i,r,o){const s=jI.get(n);if(!s){Iv++;return}const l=u=>{u&&u.trigger()};if(wR(),e==="clear")s.forEach(l);else{const u=zn(n),h=u&&Iw(t);if(u&&t==="length"){const d=Number(i);s.forEach((m,y)=>{(y==="length"||y===Cv||!ku(y)&&y>=d)&&l(m)})}else switch((t!==void 0||s.has(void 0))&&l(s.get(t)),h&&l(s.get(Cv)),e){case"add":u?h&&l(s.get("length")):(l(s.get(Bp)),ny(n)&&l(s.get(wE)));break;case"delete":u||(l(s.get(Bp)),ny(n)&&l(s.get(wE)));break;case"set":ny(n)&&l(s.get(Bp));break}}AR()}function u9(n,e){const t=jI.get(n);return t&&t.get(e)}function pm(n){const e=Ji(n);return e===n?e:(ta(e,"iterate",Cv),Al(n)?e:e.map(Lu))}function Ew(n){return ta(n=Ji(n),"iterate",Cv),n}function Dd(n,e){return Yh(n)?Sc(n)?Cy(Lu(e)):Cy(e):Lu(e)}const c9={__proto__:null,[Symbol.iterator](){return S2(this,Symbol.iterator,n=>Dd(this,n))},concat(...n){return pm(this).concat(...n.map(e=>zn(e)?pm(e):e))},entries(){return S2(this,"entries",n=>(n[1]=Dd(this,n[1]),n))},every(n,e){return mh(this,"every",n,e,void 0,arguments)},filter(n,e){return mh(this,"filter",n,e,t=>t.map(i=>Dd(this,i)),arguments)},find(n,e){return mh(this,"find",n,e,t=>Dd(this,t),arguments)},findIndex(n,e){return mh(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return mh(this,"findLast",n,e,t=>Dd(this,t),arguments)},findLastIndex(n,e){return mh(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return mh(this,"forEach",n,e,void 0,arguments)},includes(...n){return E2(this,"includes",n)},indexOf(...n){return E2(this,"indexOf",n)},join(n){return pm(this).join(n)},lastIndexOf(...n){return E2(this,"lastIndexOf",n)},map(n,e){return mh(this,"map",n,e,void 0,arguments)},pop(){return t0(this,"pop")},push(...n){return t0(this,"push",n)},reduce(n,...e){return NP(this,"reduce",n,e)},reduceRight(n,...e){return NP(this,"reduceRight",n,e)},shift(){return t0(this,"shift")},some(n,e){return mh(this,"some",n,e,void 0,arguments)},splice(...n){return t0(this,"splice",n)},toReversed(){return pm(this).toReversed()},toSorted(n){return pm(this).toSorted(n)},toSpliced(...n){return pm(this).toSpliced(...n)},unshift(...n){return t0(this,"unshift",n)},values(){return S2(this,"values",n=>Dd(this,n))}};function S2(n,e,t){const i=Ew(n),r=i[e]();return i!==n&&!Al(n)&&(r._next=r.next,r.next=()=>{const o=r._next();return o.done||(o.value=t(o.value)),o}),r}const h9=Array.prototype;function mh(n,e,t,i,r,o){const s=Ew(n),l=s!==n&&!Al(n),u=s[e];if(u!==h9[e]){const m=u.apply(n,o);return l?Lu(m):m}let h=t;s!==n&&(l?h=function(m,y){return t.call(this,Dd(n,m),y,n)}:t.length>2&&(h=function(m,y){return t.call(this,m,y,n)}));const d=u.call(s,h,i);return l&&r?r(d):d}function NP(n,e,t,i){const r=Ew(n);let o=t;return r!==n&&(Al(n)?t.length>3&&(o=function(s,l,u){return t.call(this,s,l,u,n)}):o=function(s,l,u){return t.call(this,s,Dd(n,l),u,n)}),r[e](o,...i)}function E2(n,e,t){const i=Ji(n);ta(i,"iterate",Cv);const r=i[e](...t);return(r===-1||r===!1)&&Rw(t[0])?(t[0]=Ji(t[0]),i[e](...t)):r}function t0(n,e,t=[]){Uh(),wR();const i=Ji(n)[e].apply(n,t);return AR(),Xh(),i}const d9=bR("__proto__,__v_isRef,__isVue"),J3=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(ku));function f9(n){ku(n)||(n=String(n));const e=Ji(this);return ta(e,"has",n),e.hasOwnProperty(n)}class q3{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,i){if(t==="__v_skip")return e.__v_skip;const r=this._isReadonly,o=this._isShallow;if(t==="__v_isReactive")return!r;if(t==="__v_isReadonly")return r;if(t==="__v_isShallow")return o;if(t==="__v_raw")return i===(r?o?C9:nN:o?tN:eN).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(i)?e:void 0;const s=zn(e);if(!r){let u;if(s&&(u=c9[t]))return u;if(t==="hasOwnProperty")return f9}const l=Reflect.get(e,t,Gr(e)?e:i);if((ku(t)?J3.has(t):d9(t))||(r||ta(e,"get",t),o))return l;if(Gr(l)){const u=s&&Iw(t)?l:l.value;return r&&Rr(u)?SE(u):u}return Rr(l)?r?SE(l):Tw(l):l}}class Q3 extends q3{constructor(e=!1){super(!1,e)}set(e,t,i,r){let o=e[t];const s=zn(e)&&Iw(t);if(!this._isShallow){const h=Yh(o);if(!Al(i)&&!Yh(i)&&(o=Ji(o),i=Ji(i)),!s&&Gr(o)&&!Gr(i))return h||(o.value=i),!0}const l=s?Number(t)<e.length:_r(e,t),u=Reflect.set(e,t,i,Gr(e)?e:r);return e===Ji(r)&&(l?of(i,o)&&Rh(e,"set",t,i):Rh(e,"add",t,i)),u}deleteProperty(e,t){const i=_r(e,t);e[t];const r=Reflect.deleteProperty(e,t);return r&&i&&Rh(e,"delete",t,void 0),r}has(e,t){const i=Reflect.has(e,t);return(!ku(t)||!J3.has(t))&&ta(e,"has",t),i}ownKeys(e){return ta(e,"iterate",zn(e)?"length":Bp),Reflect.ownKeys(e)}}class p9 extends q3{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const g9=new Q3,m9=new p9,y9=new Q3(!0);const AE=n=>n,J1=n=>Reflect.getPrototypeOf(n);function _9(n,e,t){return function(...i){const r=this.__v_raw,o=Ji(r),s=ny(o),l=n==="entries"||n===Symbol.iterator&&s,u=n==="keys"&&s,h=r[n](...i),d=t?AE:e?Cy:Lu;return!e&&ta(o,"iterate",u?wE:Bp),{next(){const{value:m,done:y}=h.next();return y?{value:m,done:y}:{value:l?[d(m[0]),d(m[1])]:d(m),done:y}},[Symbol.iterator](){return this}}}}function q1(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function v9(n,e){const t={get(r){const o=this.__v_raw,s=Ji(o),l=Ji(r);n||(of(r,l)&&ta(s,"get",r),ta(s,"get",l));const{has:u}=J1(s),h=e?AE:n?Cy:Lu;if(u.call(s,r))return h(o.get(r));if(u.call(s,l))return h(o.get(l));o!==s&&o.get(r)},get size(){const r=this.__v_raw;return!n&&ta(Ji(r),"iterate",Bp),r.size},has(r){const o=this.__v_raw,s=Ji(o),l=Ji(r);return n||(of(r,l)&&ta(s,"has",r),ta(s,"has",l)),r===l?o.has(r):o.has(r)||o.has(l)},forEach(r,o){const s=this,l=s.__v_raw,u=Ji(l),h=e?AE:n?Cy:Lu;return!n&&ta(u,"iterate",Bp),l.forEach((d,m)=>r.call(o,h(d),h(m),s))}};return wo(t,n?{add:q1("add"),set:q1("set"),delete:q1("delete"),clear:q1("clear")}:{add(r){!e&&!Al(r)&&!Yh(r)&&(r=Ji(r));const o=Ji(this);return J1(o).has.call(o,r)||(o.add(r),Rh(o,"add",r,r)),this},set(r,o){!e&&!Al(o)&&!Yh(o)&&(o=Ji(o));const s=Ji(this),{has:l,get:u}=J1(s);let h=l.call(s,r);h||(r=Ji(r),h=l.call(s,r));const d=u.call(s,r);return s.set(r,o),h?of(o,d)&&Rh(s,"set",r,o):Rh(s,"add",r,o),this},delete(r){const o=Ji(this),{has:s,get:l}=J1(o);let u=s.call(o,r);u||(r=Ji(r),u=s.call(o,r)),l&&l.call(o,r);const h=o.delete(r);return u&&Rh(o,"delete",r,void 0),h},clear(){const r=Ji(this),o=r.size!==0,s=r.clear();return o&&Rh(r,"clear",void 0,void 0),s}}),["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=_9(r,n,e)}),t}function TR(n,e){const t=v9(n,e);return(i,r,o)=>r==="__v_isReactive"?!n:r==="__v_isReadonly"?n:r==="__v_raw"?i:Reflect.get(_r(t,r)&&r in i?t:i,r,o)}const b9={get:TR(!1,!1)},x9={get:TR(!1,!0)},I9={get:TR(!0,!1)};const eN=new WeakMap,tN=new WeakMap,nN=new WeakMap,C9=new WeakMap;function w9(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function A9(n){return n.__v_skip||!Object.isExtensible(n)?0:w9(j6(n))}function Tw(n){return Yh(n)?n:RR(n,!1,g9,b9,eN)}function S9(n){return RR(n,!1,y9,x9,tN)}function SE(n){return RR(n,!0,m9,I9,nN)}function RR(n,e,t,i,r){if(!Rr(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const o=A9(n);if(o===0)return n;const s=r.get(n);if(s)return s;const l=new Proxy(n,o===2?i:t);return r.set(n,l),l}function Sc(n){return Yh(n)?Sc(n.__v_raw):!!(n&&n.__v_isReactive)}function Yh(n){return!!(n&&n.__v_isReadonly)}function Al(n){return!!(n&&n.__v_isShallow)}function Rw(n){return n?!!n.__v_raw:!1}function Ji(n){const e=n&&n.__v_raw;return e?Ji(e):n}function Mp(n){return!_r(n,"__v_skip")&&Object.isExtensible(n)&&O3(n,"__v_skip",!0),n}const Lu=n=>Rr(n)?Tw(n):n,Cy=n=>Rr(n)?SE(n):n;function Gr(n){return n?n.__v_isRef===!0:!1}function Ue(n){return iN(n,!1)}function mi(n){return iN(n,!0)}function iN(n,e){return Gr(n)?n:new E9(n,e)}class E9{constructor(e,t){this.dep=new ER,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Ji(e),this._value=t?e:Lu(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,i=this.__v_isShallow||Al(e)||Yh(e);e=i?e:Ji(e),of(e,t)&&(this._rawValue=e,this._value=i?e:Lu(e),this.dep.trigger())}}function M(n){return Gr(n)?n.value:n}function T9(n){return ci(n)?n():M(n)}const R9={get:(n,e,t)=>e==="__v_raw"?n:M(Reflect.get(n,e,t)),set:(n,e,t,i)=>{const r=n[e];return Gr(r)&&!Gr(t)?(r.value=t,!0):Reflect.set(n,e,t,i)}};function rN(n){return Sc(n)?n:new Proxy(n,R9)}function M9(n){const e=zn(n)?new Array(n.length):{};for(const t in n)e[t]=oN(n,t);return e}class k9{constructor(e,t,i){this._object=e,this._key=t,this._defaultValue=i,this.__v_isRef=!0,this._value=void 0,this._raw=Ji(e);let r=!0,o=e;if(!zn(e)||!Iw(String(t)))do r=!Rw(o)||Al(o);while(r&&(o=o.__v_raw));this._shallow=r}get value(){let e=this._object[this._key];return this._shallow&&(e=M(e)),this._value=e===void 0?this._defaultValue:e}set value(e){if(this._shallow&&Gr(this._raw[this._key])){const t=this._object[this._key];if(Gr(t)){t.value=e;return}}this._object[this._key]=e}get dep(){return u9(this._raw,this._key)}}class L9{constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function sN(n,e,t){return Gr(n)?n:ci(n)?new L9(n):Rr(n)&&arguments.length>1?oN(n,e,t):Ue(n)}function oN(n,e,t){return new k9(n,e,t)}class P9{constructor(e,t,i){this.fn=e,this.setter=t,this._value=void 0,this.dep=new ER(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Iv-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=i}notify(){if(this.flags|=16,!(this.flags&8)&&Br!==this)return X3(this,!0),!0}get value(){const e=this.dep.track();return K3(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function G9(n,e,t=!1){let i,r;return ci(n)?i=n:(i=n.get,r=n.set),new P9(i,r,t)}const Q1={},$I=new WeakMap;let Ip;function F9(n,e=!1,t=Ip){if(t){let i=$I.get(t);i||$I.set(t,i=[]),i.push(n)}}function O9(n,e,t=kr){const{immediate:i,deep:r,once:o,scheduler:s,augmentJob:l,call:u}=t,h=O=>r?O:Al(O)||r===!1||r===0?Mh(O,1):Mh(O);let d,m,y,x,C=!1,w=!1;if(Gr(n)?(m=()=>n.value,C=Al(n)):Sc(n)?(m=()=>h(n),C=!0):zn(n)?(w=!0,C=n.some(O=>Sc(O)||Al(O)),m=()=>n.map(O=>{if(Gr(O))return O.value;if(Sc(O))return h(O);if(ci(O))return u?u(O,2):O()})):ci(n)?e?m=u?()=>u(n,2):n:m=()=>{if(y){Uh();try{y()}finally{Xh()}}const O=Ip;Ip=d;try{return u?u(n,3,[x]):n(x)}finally{Ip=O}}:m=Ac,e&&r){const O=m,V=r===!0?1/0:r;m=()=>Mh(O(),V)}const E=W3(),T=()=>{d.stop(),E&&E.active&&IR(E.effects,d)};if(o&&e){const O=e;e=(...V)=>{O(...V),T()}}let k=w?new Array(n.length).fill(Q1):Q1;const G=O=>{if(!(!(d.flags&1)||!d.dirty&&!O))if(e){const V=d.run();if(r||C||(w?V.some((z,H)=>of(z,k[H])):of(V,k))){y&&y();const z=Ip;Ip=d;try{const H=[V,k===Q1?void 0:w&&k[0]===Q1?[]:k,x];k=V,u?u(e,3,H):e(...H)}finally{Ip=z}}}else d.run()};return l&&l(G),d=new z3(m),d.scheduler=s?()=>s(G,!1):G,x=O=>F9(O,!1,d),y=d.onStop=()=>{const O=$I.get(d);if(O){if(u)u(O,4);else for(const V of O)V();$I.delete(d)}},e?i?G(!0):k=d.run():s?s(G.bind(null,!0),!0):d.run(),T.pause=d.pause.bind(d),T.resume=d.resume.bind(d),T.stop=T,T}function Mh(n,e=1/0,t){if(e<=0||!Rr(n)||n.__v_skip||(t=t||new Map,(t.get(n)||0)>=e))return n;if(t.set(n,e),e--,Gr(n))Mh(n.value,e,t);else if(zn(n))for(let i=0;i<n.length;i++)Mh(n[i],e,t);else if(Vy(n)||ny(n))n.forEach(i=>{Mh(i,e,t)});else if(F3(n)){for(const i in n)Mh(n[i],e,t);for(const i of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,i)&&Mh(n[i],e,t)}return n}function ub(n,e,t,i){try{return i?n(...i):n()}catch(r){Mw(r,e,t)}}function Pu(n,e,t,i){if(ci(n)){const r=ub(n,e,t,i);return r&&P3(r)&&r.catch(o=>{Mw(o,e,t)}),r}if(zn(n)){const r=[];for(let o=0;o<n.length;o++)r.push(Pu(n[o],e,t,i));return r}}function Mw(n,e,t,i=!0){const r=e?e.vnode:null,{errorHandler:o,throwUnhandledErrorInProduction:s}=e&&e.appContext.config||kr;if(e){let l=e.parent;const u=e.proxy,h=`https://vuejs.org/error-reference/#runtime-${t}`;for(;l;){const d=l.ec;if(d){for(let m=0;m<d.length;m++)if(d[m](n,u,h)===!1)return}l=l.parent}if(o){Uh(),ub(o,null,10,[n,u,h]),Xh();return}}N9(n,t,r,i,s)}function N9(n,e,t,i=!0,r=!1){if(r)throw n;console.error(n)}const ba=[];let pc=-1;const iy=[];let Vd=null,Mm=0;const aN=Promise.resolve();let JI=null;function no(n){const e=JI||aN;return n?e.then(this?n.bind(this):n):e}function D9(n){let e=pc+1,t=ba.length;for(;e<t;){const i=e+t>>>1,r=ba[i],o=wv(r);o<n||o===n&&r.flags&2?e=i+1:t=i}return e}function MR(n){if(!(n.flags&1)){const e=wv(n),t=ba[ba.length-1];!t||!(n.flags&2)&&e>=wv(t)?ba.push(n):ba.splice(D9(e),0,n),n.flags|=1,lN()}}function lN(){JI||(JI=aN.then(cN))}function V9(n){zn(n)?iy.push(...n):Vd&&n.id===-1?Vd.splice(Mm+1,0,n):n.flags&1||(iy.push(n),n.flags|=1),lN()}function DP(n,e,t=pc+1){for(;t<ba.length;t++){const i=ba[t];if(i&&i.flags&2){if(n&&i.id!==n.uid)continue;ba.splice(t,1),t--,i.flags&4&&(i.flags&=-2),i(),i.flags&4||(i.flags&=-2)}}}function uN(n){if(iy.length){const e=[...new Set(iy)].sort((t,i)=>wv(t)-wv(i));if(iy.length=0,Vd){Vd.push(...e);return}for(Vd=e,Mm=0;Mm<Vd.length;Mm++){const t=Vd[Mm];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Vd=null,Mm=0}}const wv=n=>n.id==null?n.flags&2?-1:1/0:n.id;function cN(n){try{for(pc=0;pc<ba.length;pc++){const e=ba[pc];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),ub(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;pc<ba.length;pc++){const e=ba[pc];e&&(e.flags&=-2)}pc=-1,ba.length=0,uN(),JI=null,(ba.length||iy.length)&&cN()}}let Oo=null,hN=null;function qI(n){const e=Oo;return Oo=n,hN=n&&n.type.__scopeId||null,e}function Wt(n,e=Oo,t){if(!e||n._n)return n;const i=(...r)=>{i._d&&tC(-1);const o=qI(e);let s;try{s=n(...r)}finally{qI(o),i._d&&tC(1)}return s};return i._n=!0,i._c=!0,i._d=!0,i}function An(n,e){if(Oo===null)return n;const t=Nw(Oo),i=n.dirs||(n.dirs=[]);for(let r=0;r<e.length;r++){let[o,s,l,u=kr]=e[r];o&&(ci(o)&&(o={mounted:o,updated:o}),o.deep&&Mh(s),i.push({dir:o,instance:t,value:s,oldValue:void 0,arg:l,modifiers:u}))}return n}function cp(n,e,t,i){const r=n.dirs,o=e&&e.dirs;for(let s=0;s<r.length;s++){const l=r[s];o&&(l.oldValue=o[s].value);let u=l.dir[i];u&&(Uh(),Pu(u,t,8,[n.el,l,n,e]),Xh())}}const dN=Symbol("_vte"),fN=n=>n.__isTeleport,j0=n=>n&&(n.disabled||n.disabled===""),VP=n=>n&&(n.defer||n.defer===""),BP=n=>typeof SVGElement<"u"&&n instanceof SVGElement,ZP=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,EE=(n,e)=>{const t=n&&n.to;return ys(t)?e?e(t):null:t},pN={name:"Teleport",__isTeleport:!0,process(n,e,t,i,r,o,s,l,u,h){const{mc:d,pc:m,pbc:y,o:{insert:x,querySelector:C,createText:w,createComment:E}}=h,T=j0(e.props);let{shapeFlag:k,children:G,dynamicChildren:O}=e;if(n==null){const V=e.el=w(""),z=e.anchor=w("");x(V,t,i),x(z,t,i);const H=($,ae)=>{k&16&&d(G,$,ae,r,o,s,l,u)},te=()=>{const $=e.target=EE(e.props,C),ae=gN($,e,w,x);$&&(s!=="svg"&&BP($)?s="svg":s!=="mathml"&&ZP($)&&(s="mathml"),r&&r.isCE&&(r.ce._teleportTargets||(r.ce._teleportTargets=new Set)).add($),T||(H($,ae),oI(e,!1)))};T&&(H(t,z),oI(e,!0)),VP(e.props)?(e.el.__isMounted=!1,va(()=>{te(),delete e.el.__isMounted},o)):te()}else{if(VP(e.props)&&n.el.__isMounted===!1){va(()=>{pN.process(n,e,t,i,r,o,s,l,u,h)},o);return}e.el=n.el,e.targetStart=n.targetStart;const V=e.anchor=n.anchor,z=e.target=n.target,H=e.targetAnchor=n.targetAnchor,te=j0(n.props),$=te?t:z,ae=te?V:H;if(s==="svg"||BP(z)?s="svg":(s==="mathml"||ZP(z))&&(s="mathml"),O?(y(n.dynamicChildren,O,$,r,o,s,l),OR(n,e,!0)):u||m(n,e,$,ae,r,o,s,l,!1),T)te?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):ex(e,t,V,h,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const fe=e.target=EE(e.props,C);fe&&ex(e,fe,null,h,0)}else te&&ex(e,z,H,h,1);oI(e,T)}},remove(n,e,t,{um:i,o:{remove:r}},o){const{shapeFlag:s,children:l,anchor:u,targetStart:h,targetAnchor:d,target:m,props:y}=n;if(m&&(r(h),r(d)),o&&r(u),s&16){const x=o||!j0(y);for(let C=0;C<l.length;C++){const w=l[C];i(w,e,t,x,!!w.dynamicChildren)}}},move:ex,hydrate:B9};function ex(n,e,t,{o:{insert:i},m:r},o=2){o===0&&i(n.targetAnchor,e,t);const{el:s,anchor:l,shapeFlag:u,children:h,props:d}=n,m=o===2;if(m&&i(s,e,t),(!m||j0(d))&&u&16)for(let y=0;y<h.length;y++)r(h[y],e,t,2);m&&i(l,e,t)}function B9(n,e,t,i,r,o,{o:{nextSibling:s,parentNode:l,querySelector:u,insert:h,createText:d}},m){function y(w,E,T,k){E.anchor=m(s(w),E,l(w),t,i,r,o),E.targetStart=T,E.targetAnchor=k}const x=e.target=EE(e.props,u),C=j0(e.props);if(x){const w=x._lpa||x.firstChild;if(e.shapeFlag&16)if(C)y(n,e,w,w&&s(w));else{e.anchor=s(n);let E=w;for(;E;){if(E&&E.nodeType===8){if(E.data==="teleport start anchor")e.targetStart=E;else if(E.data==="teleport anchor"){e.targetAnchor=E,x._lpa=e.targetAnchor&&s(e.targetAnchor);break}}E=s(E)}e.targetAnchor||gN(x,e,d,h),m(w&&s(w),e,x,t,i,r,o)}oI(e,C)}else C&&e.shapeFlag&16&&y(n,e,n,s(n));return e.anchor&&s(e.anchor)}const kw=pN;function oI(n,e){const t=n.ctx;if(t&&t.ut){let i,r;for(e?(i=n.el,r=n.anchor):(i=n.targetStart,r=n.targetAnchor);i&&i!==r;)i.nodeType===1&&i.setAttribute("data-v-owner",t.uid),i=i.nextSibling;t.ut()}}function gN(n,e,t,i){const r=e.targetStart=t(""),o=e.targetAnchor=t("");return r[dN]=o,n&&(i(r,n),i(o,n)),o}const Ah=Symbol("_leaveCb"),tx=Symbol("_enterCb");function Z9(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return sr(()=>{n.isMounted=!0}),cg(()=>{n.isUnmounting=!0}),n}const Zl=[Function,Array],mN={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Zl,onEnter:Zl,onAfterEnter:Zl,onEnterCancelled:Zl,onBeforeLeave:Zl,onLeave:Zl,onAfterLeave:Zl,onLeaveCancelled:Zl,onBeforeAppear:Zl,onAppear:Zl,onAfterAppear:Zl,onAppearCancelled:Zl},yN=n=>{const e=n.subTree;return e.component?yN(e.component):e},W9={name:"BaseTransition",props:mN,setup(n,{slots:e}){const t=hb(),i=Z9();return()=>{const r=e.default&&bN(e.default(),!0);if(!r||!r.length)return;const o=_N(r),s=Ji(n),{mode:l}=s;if(i.isLeaving)return T2(o);const u=WP(o);if(!u)return T2(o);let h=TE(u,s,i,t,m=>h=m);u.type!==na&&Av(u,h);let d=t.subTree&&WP(t.subTree);if(d&&d.type!==na&&!Tp(d,u)&&yN(t).type!==na){let m=TE(d,s,i,t);if(Av(d,m),l==="out-in"&&u.type!==na)return i.isLeaving=!0,m.afterLeave=()=>{i.isLeaving=!1,t.job.flags&8||t.update(),delete m.afterLeave,d=void 0},T2(o);l==="in-out"&&u.type!==na?m.delayLeave=(y,x,C)=>{const w=vN(i,d);w[String(d.key)]=d,y[Ah]=()=>{x(),y[Ah]=void 0,delete h.delayedLeave,d=void 0},h.delayedLeave=()=>{C(),delete h.delayedLeave,d=void 0}}:d=void 0}else d&&(d=void 0);return o}}};function _N(n){let e=n[0];if(n.length>1){for(const t of n)if(t.type!==na){e=t;break}}return e}const z9=W9;function vN(n,e){const{leavingVNodes:t}=n;let i=t.get(e.type);return i||(i=Object.create(null),t.set(e.type,i)),i}function TE(n,e,t,i,r){const{appear:o,mode:s,persisted:l=!1,onBeforeEnter:u,onEnter:h,onAfterEnter:d,onEnterCancelled:m,onBeforeLeave:y,onLeave:x,onAfterLeave:C,onLeaveCancelled:w,onBeforeAppear:E,onAppear:T,onAfterAppear:k,onAppearCancelled:G}=e,O=String(n.key),V=vN(t,n),z=($,ae)=>{$&&Pu($,i,9,ae)},H=($,ae)=>{const fe=ae[1];z($,ae),zn($)?$.every(Y=>Y.length<=1)&&fe():$.length<=1&&fe()},te={mode:s,persisted:l,beforeEnter($){let ae=u;if(!t.isMounted)if(o)ae=E||u;else return;$[Ah]&&$[Ah](!0);const fe=V[O];fe&&Tp(n,fe)&&fe.el[Ah]&&fe.el[Ah](),z(ae,[$])},enter($){let ae=h,fe=d,Y=m;if(!t.isMounted)if(o)ae=T||h,fe=k||d,Y=G||m;else return;let de=!1;const D=$[tx]=oe=>{de||(de=!0,oe?z(Y,[$]):z(fe,[$]),te.delayedLeave&&te.delayedLeave(),$[tx]=void 0)};ae?H(ae,[$,D]):D()},leave($,ae){const fe=String(n.key);if($[tx]&&$[tx](!0),t.isUnmounting)return ae();z(y,[$]);let Y=!1;const de=$[Ah]=D=>{Y||(Y=!0,ae(),D?z(w,[$]):z(C,[$]),$[Ah]=void 0,V[fe]===n&&delete V[fe])};V[fe]=n,x?H(x,[$,de]):de()},clone($){const ae=TE($,e,t,i,r);return r&&r(ae),ae}};return te}function T2(n){if(Lw(n))return n=ff(n),n.children=null,n}function WP(n){if(!Lw(n))return fN(n.type)&&n.children?_N(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&ci(t.default))return t.default()}}function Av(n,e){n.shapeFlag&6&&n.component?(n.transition=e,Av(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function bN(n,e=!1,t){let i=[],r=0;for(let o=0;o<n.length;o++){let s=n[o];const l=t==null?s.key:String(t)+String(s.key!=null?s.key:o);s.type===Mt?(s.patchFlag&128&&r++,i=i.concat(bN(s.children,e,l))):(e||s.type!==na)&&i.push(l!=null?ff(s,{key:l}):s)}if(r>1)for(let o=0;o<i.length;o++)i[o].patchFlag=-2;return i}function at(n,e){return ci(n)?wo({name:n.name},e,{setup:n}):n}function xN(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function wy(n){const e=hb(),t=mi(null);if(e){const r=e.refs===kr?e.refs={}:e.refs;Object.defineProperty(r,n,{enumerable:!0,get:()=>t.value,set:o=>t.value=o})}return t}const QI=new WeakMap;function $0(n,e,t,i,r=!1){if(zn(n)){n.forEach((C,w)=>$0(C,e&&(zn(e)?e[w]:e),t,i,r));return}if(ry(i)&&!r){i.shapeFlag&512&&i.type.__asyncResolved&&i.component.subTree.component&&$0(n,e,t,i.component.subTree);return}const o=i.shapeFlag&4?Nw(i.component):i.el,s=r?null:o,{i:l,r:u}=n,h=e&&e.r,d=l.refs===kr?l.refs={}:l.refs,m=l.setupState,y=Ji(m),x=m===kr?L3:C=>_r(y,C);if(h!=null&&h!==u){if(zP(e),ys(h))d[h]=null,x(h)&&(m[h]=null);else if(Gr(h)){h.value=null;const C=e;C.k&&(d[C.k]=null)}}if(ci(u))ub(u,l,12,[s,d]);else{const C=ys(u),w=Gr(u);if(C||w){const E=()=>{if(n.f){const T=C?x(u)?m[u]:d[u]:u.value;if(r)zn(T)&&IR(T,o);else if(zn(T))T.includes(o)||T.push(o);else if(C)d[u]=[o],x(u)&&(m[u]=d[u]);else{const k=[o];u.value=k,n.k&&(d[n.k]=k)}}else C?(d[u]=s,x(u)&&(m[u]=s)):w&&(u.value=s,n.k&&(d[n.k]=s))};if(s){const T=()=>{E(),QI.delete(n)};T.id=-1,QI.set(n,T),va(T,t)}else zP(n),E()}}}function zP(n){const e=QI.get(n);e&&(e.flags|=8,QI.delete(n))}Sw().requestIdleCallback;Sw().cancelIdleCallback;const ry=n=>!!n.type.__asyncLoader,Lw=n=>n.type.__isKeepAlive;function IN(n,e){CN(n,"a",e)}function U9(n,e){CN(n,"da",e)}function CN(n,e,t=ia){const i=n.__wdc||(n.__wdc=()=>{let r=t;for(;r;){if(r.isDeactivated)return;r=r.parent}return n()});if(Pw(e,i,t),t){let r=t.parent;for(;r&&r.parent;)Lw(r.parent.vnode)&&X9(i,e,t,r),r=r.parent}}function X9(n,e,t,i){const r=Pw(e,n,i,!0);Ms(()=>{IR(i[e],r)},t)}function Pw(n,e,t=ia,i=!1){if(t){const r=t[n]||(t[n]=[]),o=e.__weh||(e.__weh=(...s)=>{Uh();const l=db(t),u=Pu(e,t,n,s);return l(),Xh(),u});return i?r.unshift(o):r.push(o),o}}const td=n=>(e,t=ia)=>{(!Tv||n==="sp")&&Pw(n,(...i)=>e(...i),t)},wN=td("bm"),sr=td("m"),Y9=td("bu"),H9=td("u"),cg=td("bum"),Ms=td("um"),K9=td("sp"),j9=td("rtg"),$9=td("rtc");function J9(n,e=ia){Pw("ec",n,e)}const kR="components",q9="directives";function Q9(n,e){return LR(kR,n,!0,e)||n}const AN=Symbol.for("v-ndc");function cb(n){return ys(n)?LR(kR,n,!1)||n:n||AN}function kl(n){return LR(q9,n)}function LR(n,e,t=!0,i=!1){const r=Oo||ia;if(r){const o=r.type;if(n===kR){const l=BU(o,!1);if(l&&(l===e||l===eu(e)||l===ww(eu(e))))return o}const s=UP(r[n]||o[n],e)||UP(r.appContext[n],e);return!s&&i?o:s}}function UP(n,e){return n&&(n[e]||n[eu(e)]||n[ww(eu(e))])}function hi(n,e,t,i){let r;const o=t,s=zn(n);if(s||ys(n)){const l=s&&Sc(n);let u=!1,h=!1;l&&(u=!Al(n),h=Yh(n),n=Ew(n)),r=new Array(n.length);for(let d=0,m=n.length;d<m;d++)r[d]=e(u?h?Cy(Lu(n[d])):Lu(n[d]):n[d],d,void 0,o)}else if(typeof n=="number"){r=new Array(n);for(let l=0;l<n;l++)r[l]=e(l+1,l,void 0,o)}else if(Rr(n))if(n[Symbol.iterator])r=Array.from(n,(l,u)=>e(l,u,void 0,o));else{const l=Object.keys(n);r=new Array(l.length);for(let u=0,h=l.length;u<h;u++){const d=l[u];r[u]=e(n[d],d,u,o)}}else r=[];return r}function ei(n,e,t={},i,r){if(Oo.ce||Oo.parent&&ry(Oo.parent)&&Oo.parent.ce){const h=Object.keys(t).length>0;return e!=="default"&&(t.name=e),U(),Gt(Mt,null,[mt("slot",t,i&&i())],h?-2:64)}let o=n[e];o&&o._c&&(o._d=!1),U();const s=o&&SN(o(t)),l=t.key||s&&s.key,u=Gt(Mt,{key:(l&&!ku(l)?l:`_${e}`)+(!s&&i?"_fb":"")},s||(i?i():[]),s&&n._===1?64:-2);return!r&&u.scopeId&&(u.slotScopeIds=[u.scopeId+"-s"]),o&&o._c&&(o._d=!0),u}function SN(n){return n.some(e=>Ev(e)?!(e.type===na||e.type===Mt&&!SN(e.children)):!0)?n:null}const RE=n=>n?UN(n)?Nw(n):RE(n.parent):null,J0=wo(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>RE(n.parent),$root:n=>RE(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>TN(n),$forceUpdate:n=>n.f||(n.f=()=>{MR(n.update)}),$nextTick:n=>n.n||(n.n=no.bind(n.proxy)),$watch:n=>hU.bind(n)}),R2=(n,e)=>n!==kr&&!n.__isScriptSetup&&_r(n,e),eU={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:i,data:r,props:o,accessCache:s,type:l,appContext:u}=n;if(e[0]!=="$"){const y=s[e];if(y!==void 0)switch(y){case 1:return i[e];case 2:return r[e];case 4:return t[e];case 3:return o[e]}else{if(R2(i,e))return s[e]=1,i[e];if(r!==kr&&_r(r,e))return s[e]=2,r[e];if(_r(o,e))return s[e]=3,o[e];if(t!==kr&&_r(t,e))return s[e]=4,t[e];ME&&(s[e]=0)}}const h=J0[e];let d,m;if(h)return e==="$attrs"&&ta(n.attrs,"get",""),h(n);if((d=l.__cssModules)&&(d=d[e]))return d;if(t!==kr&&_r(t,e))return s[e]=4,t[e];if(m=u.config.globalProperties,_r(m,e))return m[e]},set({_:n},e,t){const{data:i,setupState:r,ctx:o}=n;return R2(r,e)?(r[e]=t,!0):i!==kr&&_r(i,e)?(i[e]=t,!0):_r(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(o[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:i,appContext:r,props:o,type:s}},l){let u;return!!(t[l]||n!==kr&&l[0]!=="$"&&_r(n,l)||R2(e,l)||_r(o,l)||_r(i,l)||_r(J0,l)||_r(r.config.globalProperties,l)||(u=s.__cssModules)&&u[l])},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:_r(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function XP(n){return zn(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let ME=!0;function tU(n){const e=TN(n),t=n.proxy,i=n.ctx;ME=!1,e.beforeCreate&&YP(e.beforeCreate,n,"bc");const{data:r,computed:o,methods:s,watch:l,provide:u,inject:h,created:d,beforeMount:m,mounted:y,beforeUpdate:x,updated:C,activated:w,deactivated:E,beforeDestroy:T,beforeUnmount:k,destroyed:G,unmounted:O,render:V,renderTracked:z,renderTriggered:H,errorCaptured:te,serverPrefetch:$,expose:ae,inheritAttrs:fe,components:Y,directives:de,filters:D}=e;if(h&&nU(h,i,null),s)for(const ge in s){const Ne=s[ge];ci(Ne)&&(i[ge]=Ne.bind(t))}if(r){const ge=r.call(t,t);Rr(ge)&&(n.data=Tw(ge))}if(ME=!0,o)for(const ge in o){const Ne=o[ge],Ee=ci(Ne)?Ne.bind(t,t):ci(Ne.get)?Ne.get.bind(t,t):Ac,se=!ci(Ne)&&ci(Ne.set)?Ne.set.bind(t):Ac,q=Ct({get:Ee,set:se});Object.defineProperty(i,ge,{enumerable:!0,configurable:!0,get:()=>q.value,set:j=>q.value=j})}if(l)for(const ge in l)EN(l[ge],i,t,ge);if(u){const ge=ci(u)?u.call(t):u;Reflect.ownKeys(ge).forEach(Ne=>{Gw(Ne,ge[Ne])})}d&&YP(d,n,"c");function ue(ge,Ne){zn(Ne)?Ne.forEach(Ee=>ge(Ee.bind(t))):Ne&&ge(Ne.bind(t))}if(ue(wN,m),ue(sr,y),ue(Y9,x),ue(H9,C),ue(IN,w),ue(U9,E),ue(J9,te),ue($9,z),ue(j9,H),ue(cg,k),ue(Ms,O),ue(K9,$),zn(ae))if(ae.length){const ge=n.exposed||(n.exposed={});ae.forEach(Ne=>{Object.defineProperty(ge,Ne,{get:()=>t[Ne],set:Ee=>t[Ne]=Ee,enumerable:!0})})}else n.exposed||(n.exposed={});V&&n.render===Ac&&(n.render=V),fe!=null&&(n.inheritAttrs=fe),Y&&(n.components=Y),de&&(n.directives=de),$&&xN(n)}function nU(n,e,t=Ac){zn(n)&&(n=kE(n));for(const i in n){const r=n[i];let o;Rr(r)?"default"in r?o=Do(r.from||i,r.default,!0):o=Do(r.from||i):o=Do(r),Gr(o)?Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:()=>o.value,set:s=>o.value=s}):e[i]=o}}function YP(n,e,t){Pu(zn(n)?n.map(i=>i.bind(e.proxy)):n.bind(e.proxy),e,t)}function EN(n,e,t,i){let r=i.includes(".")?MN(t,i):()=>t[i];if(ys(n)){const o=e[n];ci(o)&&Pt(r,o)}else if(ci(n))Pt(r,n.bind(t));else if(Rr(n))if(zn(n))n.forEach(o=>EN(o,e,t,i));else{const o=ci(n.handler)?n.handler.bind(t):e[n.handler];ci(o)&&Pt(r,o,n)}}function TN(n){const e=n.type,{mixins:t,extends:i}=e,{mixins:r,optionsCache:o,config:{optionMergeStrategies:s}}=n.appContext,l=o.get(e);let u;return l?u=l:!r.length&&!t&&!i?u=e:(u={},r.length&&r.forEach(h=>eC(u,h,s,!0)),eC(u,e,s)),Rr(e)&&o.set(e,u),u}function eC(n,e,t,i=!1){const{mixins:r,extends:o}=e;o&&eC(n,o,t,!0),r&&r.forEach(s=>eC(n,s,t,!0));for(const s in e)if(!(i&&s==="expose")){const l=iU[s]||t&&t[s];n[s]=l?l(n[s],e[s]):e[s]}return n}const iU={data:HP,props:KP,emits:KP,methods:w0,computed:w0,beforeCreate:ya,created:ya,beforeMount:ya,mounted:ya,beforeUpdate:ya,updated:ya,beforeDestroy:ya,beforeUnmount:ya,destroyed:ya,unmounted:ya,activated:ya,deactivated:ya,errorCaptured:ya,serverPrefetch:ya,components:w0,directives:w0,watch:sU,provide:HP,inject:rU};function HP(n,e){return e?n?function(){return wo(ci(n)?n.call(this,this):n,ci(e)?e.call(this,this):e)}:e:n}function rU(n,e){return w0(kE(n),kE(e))}function kE(n){if(zn(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function ya(n,e){return n?[...new Set([].concat(n,e))]:e}function w0(n,e){return n?wo(Object.create(null),n,e):e}function KP(n,e){return n?zn(n)&&zn(e)?[...new Set([...n,...e])]:wo(Object.create(null),XP(n),XP(e??{})):e}function sU(n,e){if(!n)return e;if(!e)return n;const t=wo(Object.create(null),n);for(const i in e)t[i]=ya(n[i],e[i]);return t}function RN(){return{app:null,config:{isNativeTag:L3,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let oU=0;function aU(n,e){return function(i,r=null){ci(i)||(i=wo({},i)),r!=null&&!Rr(r)&&(r=null);const o=RN(),s=new WeakSet,l=[];let u=!1;const h=o.app={_uid:oU++,_component:i,_props:r,_container:null,_context:o,_instance:null,version:zU,get config(){return o.config},set config(d){},use(d,...m){return s.has(d)||(d&&ci(d.install)?(s.add(d),d.install(h,...m)):ci(d)&&(s.add(d),d(h,...m))),h},mixin(d){return o.mixins.includes(d)||o.mixins.push(d),h},component(d,m){return m?(o.components[d]=m,h):o.components[d]},directive(d,m){return m?(o.directives[d]=m,h):o.directives[d]},mount(d,m,y){if(!u){const x=h._ceVNode||mt(i,r);return x.appContext=o,y===!0?y="svg":y===!1&&(y=void 0),n(x,d,y),u=!0,h._container=d,d.__vue_app__=h,Nw(x.component)}},onUnmount(d){l.push(d)},unmount(){u&&(Pu(l,h._instance,16),n(null,h._container),delete h._container.__vue_app__)},provide(d,m){return o.provides[d]=m,h},runWithContext(d){const m=Zp;Zp=h;try{return d()}finally{Zp=m}}};return h}}let Zp=null;function Gw(n,e){if(ia){let t=ia.provides;const i=ia.parent&&ia.parent.provides;i===t&&(t=ia.provides=Object.create(i)),t[n]=e}}function Do(n,e,t=!1){const i=hb();if(i||Zp){let r=Zp?Zp._context.provides:i?i.parent==null||i.ce?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:void 0;if(r&&n in r)return r[n];if(arguments.length>1)return t&&ci(e)?e.call(i&&i.proxy):e}}function lU(){return!!(hb()||Zp)}const uU=Symbol.for("v-scx"),cU=()=>Do(uU);function Rs(n,e){return PR(n,null,e)}function Pt(n,e,t){return PR(n,e,t)}function PR(n,e,t=kr){const{immediate:i,deep:r,flush:o,once:s}=t,l=wo({},t),u=e&&i||!e&&o!=="post";let h;if(Tv){if(o==="sync"){const x=cU();h=x.__watcherHandles||(x.__watcherHandles=[])}else if(!u){const x=()=>{};return x.stop=Ac,x.resume=Ac,x.pause=Ac,x}}const d=ia;l.call=(x,C,w)=>Pu(x,d,C,w);let m=!1;o==="post"?l.scheduler=x=>{va(x,d&&d.suspense)}:o!=="sync"&&(m=!0,l.scheduler=(x,C)=>{C?x():MR(x)}),l.augmentJob=x=>{e&&(x.flags|=4),m&&(x.flags|=2,d&&(x.id=d.uid,x.i=d))};const y=O9(n,e,l);return Tv&&(h?h.push(y):u&&y()),y}function hU(n,e,t){const i=this.proxy,r=ys(n)?n.includes(".")?MN(i,n):()=>i[n]:n.bind(i,i);let o;ci(e)?o=e:(o=e.handler,t=e);const s=db(this),l=PR(r,o.bind(i),t);return s(),l}function MN(n,e){const t=e.split(".");return()=>{let i=n;for(let r=0;r<t.length&&i;r++)i=i[t[r]];return i}}const dU=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${eu(e)}Modifiers`]||n[`${Cf(e)}Modifiers`];function fU(n,e,...t){if(n.isUnmounted)return;const i=n.vnode.props||kr;let r=t;const o=e.startsWith("update:"),s=o&&dU(i,e.slice(7));s&&(s.trim&&(r=t.map(d=>ys(d)?d.trim():d)),s.number&&(r=t.map(Aw)));let l,u=i[l=C2(e)]||i[l=C2(eu(e))];!u&&o&&(u=i[l=C2(Cf(e))]),u&&Pu(u,n,6,r);const h=i[l+"Once"];if(h){if(!n.emitted)n.emitted={};else if(n.emitted[l])return;n.emitted[l]=!0,Pu(h,n,6,r)}}const pU=new WeakMap;function kN(n,e,t=!1){const i=t?pU:e.emitsCache,r=i.get(n);if(r!==void 0)return r;const o=n.emits;let s={},l=!1;if(!ci(n)){const u=h=>{const d=kN(h,e,!0);d&&(l=!0,wo(s,d))};!t&&e.mixins.length&&e.mixins.forEach(u),n.extends&&u(n.extends),n.mixins&&n.mixins.forEach(u)}return!o&&!l?(Rr(n)&&i.set(n,null),null):(zn(o)?o.forEach(u=>s[u]=null):wo(s,o),Rr(n)&&i.set(n,s),s)}function Fw(n,e){return!n||!xw(e)?!1:(e=e.slice(2).replace(/Once$/,""),_r(n,e[0].toLowerCase()+e.slice(1))||_r(n,Cf(e))||_r(n,e))}function jP(n){const{type:e,vnode:t,proxy:i,withProxy:r,propsOptions:[o],slots:s,attrs:l,emit:u,render:h,renderCache:d,props:m,data:y,setupState:x,ctx:C,inheritAttrs:w}=n,E=qI(n);let T,k;try{if(t.shapeFlag&4){const O=r||i,V=O;T=mc(h.call(V,O,d,m,x,y,C)),k=l}else{const O=e;T=mc(O.length>1?O(m,{attrs:l,slots:s,emit:u}):O(m,null)),k=e.props?l:gU(l)}}catch(O){q0.length=0,Mw(O,n,1),T=mt(na)}let G=T;if(k&&w!==!1){const O=Object.keys(k),{shapeFlag:V}=G;O.length&&V&7&&(o&&O.some(xR)&&(k=mU(k,o)),G=ff(G,k,!1,!0))}return t.dirs&&(G=ff(G,null,!1,!0),G.dirs=G.dirs?G.dirs.concat(t.dirs):t.dirs),t.transition&&Av(G,t.transition),T=G,qI(E),T}const gU=n=>{let e;for(const t in n)(t==="class"||t==="style"||xw(t))&&((e||(e={}))[t]=n[t]);return e},mU=(n,e)=>{const t={};for(const i in n)(!xR(i)||!(i.slice(9)in e))&&(t[i]=n[i]);return t};function yU(n,e,t){const{props:i,children:r,component:o}=n,{props:s,children:l,patchFlag:u}=e,h=o.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&u>=0){if(u&1024)return!0;if(u&16)return i?$P(i,s,h):!!s;if(u&8){const d=e.dynamicProps;for(let m=0;m<d.length;m++){const y=d[m];if(s[y]!==i[y]&&!Fw(h,y))return!0}}}else return(r||l)&&(!l||!l.$stable)?!0:i===s?!1:i?s?$P(i,s,h):!0:!!s;return!1}function $P(n,e,t){const i=Object.keys(e);if(i.length!==Object.keys(n).length)return!0;for(let r=0;r<i.length;r++){const o=i[r];if(e[o]!==n[o]&&!Fw(t,o))return!0}return!1}function _U({vnode:n,parent:e},t){for(;e;){const i=e.subTree;if(i.suspense&&i.suspense.activeBranch===n&&(i.el=n.el),i===n)(n=e.vnode).el=t,e=e.parent;else break}}const LN={},PN=()=>Object.create(LN),GN=n=>Object.getPrototypeOf(n)===LN;function vU(n,e,t,i=!1){const r={},o=PN();n.propsDefaults=Object.create(null),FN(n,e,r,o);for(const s in n.propsOptions[0])s in r||(r[s]=void 0);t?n.props=i?r:S9(r):n.type.props?n.props=r:n.props=o,n.attrs=o}function bU(n,e,t,i){const{props:r,attrs:o,vnode:{patchFlag:s}}=n,l=Ji(r),[u]=n.propsOptions;let h=!1;if((i||s>0)&&!(s&16)){if(s&8){const d=n.vnode.dynamicProps;for(let m=0;m<d.length;m++){let y=d[m];if(Fw(n.emitsOptions,y))continue;const x=e[y];if(u)if(_r(o,y))x!==o[y]&&(o[y]=x,h=!0);else{const C=eu(y);r[C]=LE(u,l,C,x,n,!1)}else x!==o[y]&&(o[y]=x,h=!0)}}}else{FN(n,e,r,o)&&(h=!0);let d;for(const m in l)(!e||!_r(e,m)&&((d=Cf(m))===m||!_r(e,d)))&&(u?t&&(t[m]!==void 0||t[d]!==void 0)&&(r[m]=LE(u,l,m,void 0,n,!0)):delete r[m]);if(o!==l)for(const m in o)(!e||!_r(e,m))&&(delete o[m],h=!0)}h&&Rh(n.attrs,"set","")}function FN(n,e,t,i){const[r,o]=n.propsOptions;let s=!1,l;if(e)for(let u in e){if(Y0(u))continue;const h=e[u];let d;r&&_r(r,d=eu(u))?!o||!o.includes(d)?t[d]=h:(l||(l={}))[d]=h:Fw(n.emitsOptions,u)||(!(u in i)||h!==i[u])&&(i[u]=h,s=!0)}if(o){const u=Ji(t),h=l||kr;for(let d=0;d<o.length;d++){const m=o[d];t[m]=LE(r,u,m,h[m],n,!_r(h,m))}}return s}function LE(n,e,t,i,r,o){const s=n[t];if(s!=null){const l=_r(s,"default");if(l&&i===void 0){const u=s.default;if(s.type!==Function&&!s.skipFactory&&ci(u)){const{propsDefaults:h}=r;if(t in h)i=h[t];else{const d=db(r);i=h[t]=u.call(null,e),d()}}else i=u;r.ce&&r.ce._setProp(t,i)}s[0]&&(o&&!l?i=!1:s[1]&&(i===""||i===Cf(t))&&(i=!0))}return i}const xU=new WeakMap;function ON(n,e,t=!1){const i=t?xU:e.propsCache,r=i.get(n);if(r)return r;const o=n.props,s={},l=[];let u=!1;if(!ci(n)){const d=m=>{u=!0;const[y,x]=ON(m,e,!0);wo(s,y),x&&l.push(...x)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!o&&!u)return Rr(n)&&i.set(n,ty),ty;if(zn(o))for(let d=0;d<o.length;d++){const m=eu(o[d]);JP(m)&&(s[m]=kr)}else if(o)for(const d in o){const m=eu(d);if(JP(m)){const y=o[d],x=s[m]=zn(y)||ci(y)?{type:y}:wo({},y),C=x.type;let w=!1,E=!0;if(zn(C))for(let T=0;T<C.length;++T){const k=C[T],G=ci(k)&&k.name;if(G==="Boolean"){w=!0;break}else G==="String"&&(E=!1)}else w=ci(C)&&C.name==="Boolean";x[0]=w,x[1]=E,(w||_r(x,"default"))&&l.push(m)}}const h=[s,l];return Rr(n)&&i.set(n,h),h}function JP(n){return n[0]!=="$"&&!Y0(n)}const GR=n=>n==="_"||n==="_ctx"||n==="$stable",FR=n=>zn(n)?n.map(mc):[mc(n)],IU=(n,e,t)=>{if(e._n)return e;const i=Wt((...r)=>FR(e(...r)),t);return i._c=!1,i},NN=(n,e,t)=>{const i=n._ctx;for(const r in n){if(GR(r))continue;const o=n[r];if(ci(o))e[r]=IU(r,o,i);else if(o!=null){const s=FR(o);e[r]=()=>s}}},DN=(n,e)=>{const t=FR(e);n.slots.default=()=>t},VN=(n,e,t)=>{for(const i in e)(t||!GR(i))&&(n[i]=e[i])},CU=(n,e,t)=>{const i=n.slots=PN();if(n.vnode.shapeFlag&32){const r=e._;r?(VN(i,e,t),t&&O3(i,"_",r,!0)):NN(e,i)}else e&&DN(n,e)},wU=(n,e,t)=>{const{vnode:i,slots:r}=n;let o=!0,s=kr;if(i.shapeFlag&32){const l=e._;l?t&&l===1?o=!1:VN(r,e,t):(o=!e.$stable,NN(e,r)),s=e}else e&&(DN(n,e),s={default:1});if(o)for(const l in r)!GR(l)&&s[l]==null&&delete r[l]},va=RU;function AU(n){return SU(n)}function SU(n,e){const t=Sw();t.__VUE__=!0;const{insert:i,remove:r,patchProp:o,createElement:s,createText:l,createComment:u,setText:h,setElementText:d,parentNode:m,nextSibling:y,setScopeId:x=Ac,insertStaticContent:C}=n,w=(Ge,ve,W,Ze=null,Re=null,ce=null,me=void 0,_e=null,Ie=!!ve.dynamicChildren)=>{if(Ge===ve)return;Ge&&!Tp(Ge,ve)&&(Ze=xt(Ge),j(Ge,Re,ce,!0),Ge=null),ve.patchFlag===-2&&(Ie=!1,ve.dynamicChildren=null);const{type:pe,ref:Te,shapeFlag:We}=ve;switch(pe){case Ow:E(Ge,ve,W,Ze);break;case na:T(Ge,ve,W,Ze);break;case k2:Ge==null&&k(ve,W,Ze,me);break;case Mt:Y(Ge,ve,W,Ze,Re,ce,me,_e,Ie);break;default:We&1?V(Ge,ve,W,Ze,Re,ce,me,_e,Ie):We&6?de(Ge,ve,W,Ze,Re,ce,me,_e,Ie):(We&64||We&128)&&pe.process(Ge,ve,W,Ze,Re,ce,me,_e,Ie,hn)}Te!=null&&Re?$0(Te,Ge&&Ge.ref,ce,ve||Ge,!ve):Te==null&&Ge&&Ge.ref!=null&&$0(Ge.ref,null,ce,Ge,!0)},E=(Ge,ve,W,Ze)=>{if(Ge==null)i(ve.el=l(ve.children),W,Ze);else{const Re=ve.el=Ge.el;ve.children!==Ge.children&&h(Re,ve.children)}},T=(Ge,ve,W,Ze)=>{Ge==null?i(ve.el=u(ve.children||""),W,Ze):ve.el=Ge.el},k=(Ge,ve,W,Ze)=>{[Ge.el,Ge.anchor]=C(Ge.children,ve,W,Ze,Ge.el,Ge.anchor)},G=({el:Ge,anchor:ve},W,Ze)=>{let Re;for(;Ge&&Ge!==ve;)Re=y(Ge),i(Ge,W,Ze),Ge=Re;i(ve,W,Ze)},O=({el:Ge,anchor:ve})=>{let W;for(;Ge&&Ge!==ve;)W=y(Ge),r(Ge),Ge=W;r(ve)},V=(Ge,ve,W,Ze,Re,ce,me,_e,Ie)=>{if(ve.type==="svg"?me="svg":ve.type==="math"&&(me="mathml"),Ge==null)z(ve,W,Ze,Re,ce,me,_e,Ie);else{const pe=Ge.el&&Ge.el._isVueCE?Ge.el:null;try{pe&&pe._beginPatch(),$(Ge,ve,Re,ce,me,_e,Ie)}finally{pe&&pe._endPatch()}}},z=(Ge,ve,W,Ze,Re,ce,me,_e)=>{let Ie,pe;const{props:Te,shapeFlag:We,transition:tt,dirs:nt}=Ge;if(Ie=Ge.el=s(Ge.type,ce,Te&&Te.is,Te),We&8?d(Ie,Ge.children):We&16&&te(Ge.children,Ie,null,Ze,Re,M2(Ge,ce),me,_e),nt&&cp(Ge,null,Ze,"created"),H(Ie,Ge,Ge.scopeId,me,Ze),Te){for(const on in Te)on!=="value"&&!Y0(on)&&o(Ie,on,null,Te[on],ce,Ze);"value"in Te&&o(Ie,"value",null,Te.value,ce),(pe=Te.onVnodeBeforeMount)&&dc(pe,Ze,Ge)}nt&&cp(Ge,null,Ze,"beforeMount");const bt=EU(Re,tt);bt&&tt.beforeEnter(Ie),i(Ie,ve,W),((pe=Te&&Te.onVnodeMounted)||bt||nt)&&va(()=>{pe&&dc(pe,Ze,Ge),bt&&tt.enter(Ie),nt&&cp(Ge,null,Ze,"mounted")},Re)},H=(Ge,ve,W,Ze,Re)=>{if(W&&x(Ge,W),Ze)for(let ce=0;ce<Ze.length;ce++)x(Ge,Ze[ce]);if(Re){let ce=Re.subTree;if(ve===ce||ZN(ce.type)&&(ce.ssContent===ve||ce.ssFallback===ve)){const me=Re.vnode;H(Ge,me,me.scopeId,me.slotScopeIds,Re.parent)}}},te=(Ge,ve,W,Ze,Re,ce,me,_e,Ie=0)=>{for(let pe=Ie;pe<Ge.length;pe++){const Te=Ge[pe]=_e?Bd(Ge[pe]):mc(Ge[pe]);w(null,Te,ve,W,Ze,Re,ce,me,_e)}},$=(Ge,ve,W,Ze,Re,ce,me)=>{const _e=ve.el=Ge.el;let{patchFlag:Ie,dynamicChildren:pe,dirs:Te}=ve;Ie|=Ge.patchFlag&16;const We=Ge.props||kr,tt=ve.props||kr;let nt;if(W&&hp(W,!1),(nt=tt.onVnodeBeforeUpdate)&&dc(nt,W,ve,Ge),Te&&cp(ve,Ge,W,"beforeUpdate"),W&&hp(W,!0),(We.innerHTML&&tt.innerHTML==null||We.textContent&&tt.textContent==null)&&d(_e,""),pe?ae(Ge.dynamicChildren,pe,_e,W,Ze,M2(ve,Re),ce):me||Ne(Ge,ve,_e,null,W,Ze,M2(ve,Re),ce,!1),Ie>0){if(Ie&16)fe(_e,We,tt,W,Re);else if(Ie&2&&We.class!==tt.class&&o(_e,"class",null,tt.class,Re),Ie&4&&o(_e,"style",We.style,tt.style,Re),Ie&8){const bt=ve.dynamicProps;for(let on=0;on<bt.length;on++){const an=bt[on],Ii=We[an],ji=tt[an];(ji!==Ii||an==="value")&&o(_e,an,Ii,ji,Re,W)}}Ie&1&&Ge.children!==ve.children&&d(_e,ve.children)}else!me&&pe==null&&fe(_e,We,tt,W,Re);((nt=tt.onVnodeUpdated)||Te)&&va(()=>{nt&&dc(nt,W,ve,Ge),Te&&cp(ve,Ge,W,"updated")},Ze)},ae=(Ge,ve,W,Ze,Re,ce,me)=>{for(let _e=0;_e<ve.length;_e++){const Ie=Ge[_e],pe=ve[_e],Te=Ie.el&&(Ie.type===Mt||!Tp(Ie,pe)||Ie.shapeFlag&198)?m(Ie.el):W;w(Ie,pe,Te,null,Ze,Re,ce,me,!0)}},fe=(Ge,ve,W,Ze,Re)=>{if(ve!==W){if(ve!==kr)for(const ce in ve)!Y0(ce)&&!(ce in W)&&o(Ge,ce,ve[ce],null,Re,Ze);for(const ce in W){if(Y0(ce))continue;const me=W[ce],_e=ve[ce];me!==_e&&ce!=="value"&&o(Ge,ce,_e,me,Re,Ze)}"value"in W&&o(Ge,"value",ve.value,W.value,Re)}},Y=(Ge,ve,W,Ze,Re,ce,me,_e,Ie)=>{const pe=ve.el=Ge?Ge.el:l(""),Te=ve.anchor=Ge?Ge.anchor:l("");let{patchFlag:We,dynamicChildren:tt,slotScopeIds:nt}=ve;nt&&(_e=_e?_e.concat(nt):nt),Ge==null?(i(pe,W,Ze),i(Te,W,Ze),te(ve.children||[],W,Te,Re,ce,me,_e,Ie)):We>0&&We&64&&tt&&Ge.dynamicChildren?(ae(Ge.dynamicChildren,tt,W,Re,ce,me,_e),(ve.key!=null||Re&&ve===Re.subTree)&&OR(Ge,ve,!0)):Ne(Ge,ve,W,Te,Re,ce,me,_e,Ie)},de=(Ge,ve,W,Ze,Re,ce,me,_e,Ie)=>{ve.slotScopeIds=_e,Ge==null?ve.shapeFlag&512?Re.ctx.activate(ve,W,Ze,me,Ie):D(ve,W,Ze,Re,ce,me,Ie):oe(Ge,ve,Ie)},D=(Ge,ve,W,Ze,Re,ce,me)=>{const _e=Ge.component=FU(Ge,Ze,Re);if(Lw(Ge)&&(_e.ctx.renderer=hn),OU(_e,!1,me),_e.asyncDep){if(Re&&Re.registerDep(_e,ue,me),!Ge.el){const Ie=_e.subTree=mt(na);T(null,Ie,ve,W),Ge.placeholder=Ie.el}}else ue(_e,Ge,ve,W,Re,ce,me)},oe=(Ge,ve,W)=>{const Ze=ve.component=Ge.component;if(yU(Ge,ve,W))if(Ze.asyncDep&&!Ze.asyncResolved){ge(Ze,ve,W);return}else Ze.next=ve,Ze.update();else ve.el=Ge.el,Ze.vnode=ve},ue=(Ge,ve,W,Ze,Re,ce,me)=>{const _e=()=>{if(Ge.isMounted){let{next:We,bu:tt,u:nt,parent:bt,vnode:on}=Ge;{const Mr=BN(Ge);if(Mr){We&&(We.el=on.el,ge(Ge,We,me)),Mr.asyncDep.then(()=>{Ge.isUnmounted||_e()});return}}let an=We,Ii;hp(Ge,!1),We?(We.el=on.el,ge(Ge,We,me)):We=on,tt&&sI(tt),(Ii=We.props&&We.props.onVnodeBeforeUpdate)&&dc(Ii,bt,We,on),hp(Ge,!0);const ji=jP(Ge),Pi=Ge.subTree;Ge.subTree=ji,w(Pi,ji,m(Pi.el),xt(Pi),Ge,Re,ce),We.el=ji.el,an===null&&_U(Ge,ji.el),nt&&va(nt,Re),(Ii=We.props&&We.props.onVnodeUpdated)&&va(()=>dc(Ii,bt,We,on),Re)}else{let We;const{el:tt,props:nt}=ve,{bm:bt,m:on,parent:an,root:Ii,type:ji}=Ge,Pi=ry(ve);hp(Ge,!1),bt&&sI(bt),!Pi&&(We=nt&&nt.onVnodeBeforeMount)&&dc(We,an,ve),hp(Ge,!0);{Ii.ce&&Ii.ce._def.shadowRoot!==!1&&Ii.ce._injectChildStyle(ji);const Mr=Ge.subTree=jP(Ge);w(null,Mr,W,Ze,Ge,Re,ce),ve.el=Mr.el}if(on&&va(on,Re),!Pi&&(We=nt&&nt.onVnodeMounted)){const Mr=ve;va(()=>dc(We,an,Mr),Re)}(ve.shapeFlag&256||an&&ry(an.vnode)&&an.vnode.shapeFlag&256)&&Ge.a&&va(Ge.a,Re),Ge.isMounted=!0,ve=W=Ze=null}};Ge.scope.on();const Ie=Ge.effect=new z3(_e);Ge.scope.off();const pe=Ge.update=Ie.run.bind(Ie),Te=Ge.job=Ie.runIfDirty.bind(Ie);Te.i=Ge,Te.id=Ge.uid,Ie.scheduler=()=>MR(Te),hp(Ge,!0),pe()},ge=(Ge,ve,W)=>{ve.component=Ge;const Ze=Ge.vnode.props;Ge.vnode=ve,Ge.next=null,bU(Ge,ve.props,Ze,W),wU(Ge,ve.children,W),Uh(),DP(Ge),Xh()},Ne=(Ge,ve,W,Ze,Re,ce,me,_e,Ie=!1)=>{const pe=Ge&&Ge.children,Te=Ge?Ge.shapeFlag:0,We=ve.children,{patchFlag:tt,shapeFlag:nt}=ve;if(tt>0){if(tt&128){se(pe,We,W,Ze,Re,ce,me,_e,Ie);return}else if(tt&256){Ee(pe,We,W,Ze,Re,ce,me,_e,Ie);return}}nt&8?(Te&16&&yt(pe,Re,ce),We!==pe&&d(W,We)):Te&16?nt&16?se(pe,We,W,Ze,Re,ce,me,_e,Ie):yt(pe,Re,ce,!0):(Te&8&&d(W,""),nt&16&&te(We,W,Ze,Re,ce,me,_e,Ie))},Ee=(Ge,ve,W,Ze,Re,ce,me,_e,Ie)=>{Ge=Ge||ty,ve=ve||ty;const pe=Ge.length,Te=ve.length,We=Math.min(pe,Te);let tt;for(tt=0;tt<We;tt++){const nt=ve[tt]=Ie?Bd(ve[tt]):mc(ve[tt]);w(Ge[tt],nt,W,null,Re,ce,me,_e,Ie)}pe>Te?yt(Ge,Re,ce,!0,!1,We):te(ve,W,Ze,Re,ce,me,_e,Ie,We)},se=(Ge,ve,W,Ze,Re,ce,me,_e,Ie)=>{let pe=0;const Te=ve.length;let We=Ge.length-1,tt=Te-1;for(;pe<=We&&pe<=tt;){const nt=Ge[pe],bt=ve[pe]=Ie?Bd(ve[pe]):mc(ve[pe]);if(Tp(nt,bt))w(nt,bt,W,null,Re,ce,me,_e,Ie);else break;pe++}for(;pe<=We&&pe<=tt;){const nt=Ge[We],bt=ve[tt]=Ie?Bd(ve[tt]):mc(ve[tt]);if(Tp(nt,bt))w(nt,bt,W,null,Re,ce,me,_e,Ie);else break;We--,tt--}if(pe>We){if(pe<=tt){const nt=tt+1,bt=nt<Te?ve[nt].el:Ze;for(;pe<=tt;)w(null,ve[pe]=Ie?Bd(ve[pe]):mc(ve[pe]),W,bt,Re,ce,me,_e,Ie),pe++}}else if(pe>tt)for(;pe<=We;)j(Ge[pe],Re,ce,!0),pe++;else{const nt=pe,bt=pe,on=new Map;for(pe=bt;pe<=tt;pe++){const Ei=ve[pe]=Ie?Bd(ve[pe]):mc(ve[pe]);Ei.key!=null&&on.set(Ei.key,pe)}let an,Ii=0;const ji=tt-bt+1;let Pi=!1,Mr=0;const _i=new Array(ji);for(pe=0;pe<ji;pe++)_i[pe]=0;for(pe=nt;pe<=We;pe++){const Ei=Ge[pe];if(Ii>=ji){j(Ei,Re,ce,!0);continue}let Mi;if(Ei.key!=null)Mi=on.get(Ei.key);else for(an=bt;an<=tt;an++)if(_i[an-bt]===0&&Tp(Ei,ve[an])){Mi=an;break}Mi===void 0?j(Ei,Re,ce,!0):(_i[Mi-bt]=pe+1,Mi>=Mr?Mr=Mi:Pi=!0,w(Ei,ve[Mi],W,null,Re,ce,me,_e,Ie),Ii++)}const ss=Pi?TU(_i):ty;for(an=ss.length-1,pe=ji-1;pe>=0;pe--){const Ei=bt+pe,Mi=ve[Ei],zs=ve[Ei+1],Ao=Ei+1<Te?zs.el||zs.placeholder:Ze;_i[pe]===0?w(null,Mi,W,Ao,Re,ce,me,_e,Ie):Pi&&(an<0||pe!==ss[an]?q(Mi,W,Ao,2):an--)}}},q=(Ge,ve,W,Ze,Re=null)=>{const{el:ce,type:me,transition:_e,children:Ie,shapeFlag:pe}=Ge;if(pe&6){q(Ge.component.subTree,ve,W,Ze);return}if(pe&128){Ge.suspense.move(ve,W,Ze);return}if(pe&64){me.move(Ge,ve,W,hn);return}if(me===Mt){i(ce,ve,W);for(let We=0;We<Ie.length;We++)q(Ie[We],ve,W,Ze);i(Ge.anchor,ve,W);return}if(me===k2){G(Ge,ve,W);return}if(Ze!==2&&pe&1&&_e)if(Ze===0)_e.beforeEnter(ce),i(ce,ve,W),va(()=>_e.enter(ce),Re);else{const{leave:We,delayLeave:tt,afterLeave:nt}=_e,bt=()=>{Ge.ctx.isUnmounted?r(ce):i(ce,ve,W)},on=()=>{ce._isLeaving&&ce[Ah](!0),We(ce,()=>{bt(),nt&&nt()})};tt?tt(ce,bt,on):on()}else i(ce,ve,W)},j=(Ge,ve,W,Ze=!1,Re=!1)=>{const{type:ce,props:me,ref:_e,children:Ie,dynamicChildren:pe,shapeFlag:Te,patchFlag:We,dirs:tt,cacheIndex:nt}=Ge;if(We===-2&&(Re=!1),_e!=null&&(Uh(),$0(_e,null,W,Ge,!0),Xh()),nt!=null&&(ve.renderCache[nt]=void 0),Te&256){ve.ctx.deactivate(Ge);return}const bt=Te&1&&tt,on=!ry(Ge);let an;if(on&&(an=me&&me.onVnodeBeforeUnmount)&&dc(an,ve,Ge),Te&6)qe(Ge.component,W,Ze);else{if(Te&128){Ge.suspense.unmount(W,Ze);return}bt&&cp(Ge,null,ve,"beforeUnmount"),Te&64?Ge.type.remove(Ge,ve,W,hn,Ze):pe&&!pe.hasOnce&&(ce!==Mt||We>0&&We&64)?yt(pe,ve,W,!1,!0):(ce===Mt&&We&384||!Re&&Te&16)&&yt(Ie,ve,W),Ze&&ze(Ge)}(on&&(an=me&&me.onVnodeUnmounted)||bt)&&va(()=>{an&&dc(an,ve,Ge),bt&&cp(Ge,null,ve,"unmounted")},W)},ze=Ge=>{const{type:ve,el:W,anchor:Ze,transition:Re}=Ge;if(ve===Mt){je(W,Ze);return}if(ve===k2){O(Ge);return}const ce=()=>{r(W),Re&&!Re.persisted&&Re.afterLeave&&Re.afterLeave()};if(Ge.shapeFlag&1&&Re&&!Re.persisted){const{leave:me,delayLeave:_e}=Re,Ie=()=>me(W,ce);_e?_e(Ge.el,ce,Ie):Ie()}else ce()},je=(Ge,ve)=>{let W;for(;Ge!==ve;)W=y(Ge),r(Ge),Ge=W;r(ve)},qe=(Ge,ve,W)=>{const{bum:Ze,scope:Re,job:ce,subTree:me,um:_e,m:Ie,a:pe}=Ge;qP(Ie),qP(pe),Ze&&sI(Ze),Re.stop(),ce&&(ce.flags|=8,j(me,Ge,ve,W)),_e&&va(_e,ve),va(()=>{Ge.isUnmounted=!0},ve)},yt=(Ge,ve,W,Ze=!1,Re=!1,ce=0)=>{for(let me=ce;me<Ge.length;me++)j(Ge[me],ve,W,Ze,Re)},xt=Ge=>{if(Ge.shapeFlag&6)return xt(Ge.component.subTree);if(Ge.shapeFlag&128)return Ge.suspense.next();const ve=y(Ge.anchor||Ge.el),W=ve&&ve[dN];return W?y(W):ve};let Et=!1;const kt=(Ge,ve,W)=>{Ge==null?ve._vnode&&j(ve._vnode,null,null,!0):w(ve._vnode||null,Ge,ve,null,null,null,W),ve._vnode=Ge,Et||(Et=!0,DP(),uN(),Et=!1)},hn={p:w,um:j,m:q,r:ze,mt:D,mc:te,pc:Ne,pbc:ae,n:xt,o:n};return{render:kt,hydrate:void 0,createApp:aU(kt)}}function M2({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function hp({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function EU(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function OR(n,e,t=!1){const i=n.children,r=e.children;if(zn(i)&&zn(r))for(let o=0;o<i.length;o++){const s=i[o];let l=r[o];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=r[o]=Bd(r[o]),l.el=s.el),!t&&l.patchFlag!==-2&&OR(s,l)),l.type===Ow&&l.patchFlag!==-1&&(l.el=s.el),l.type===na&&!l.el&&(l.el=s.el)}}function TU(n){const e=n.slice(),t=[0];let i,r,o,s,l;const u=n.length;for(i=0;i<u;i++){const h=n[i];if(h!==0){if(r=t[t.length-1],n[r]<h){e[i]=r,t.push(i);continue}for(o=0,s=t.length-1;o<s;)l=o+s>>1,n[t[l]]<h?o=l+1:s=l;h<n[t[o]]&&(o>0&&(e[i]=t[o-1]),t[o]=i)}}for(o=t.length,s=t[o-1];o-- >0;)t[o]=s,s=e[s];return t}function BN(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:BN(e)}function qP(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const ZN=n=>n.__isSuspense;function RU(n,e){e&&e.pendingBranch?zn(n)?e.effects.push(...n):e.effects.push(n):V9(n)}const Mt=Symbol.for("v-fgt"),Ow=Symbol.for("v-txt"),na=Symbol.for("v-cmt"),k2=Symbol.for("v-stc"),q0=[];let Il=null;function U(n=!1){q0.push(Il=n?null:[])}function MU(){q0.pop(),Il=q0[q0.length-1]||null}let Sv=1;function tC(n,e=!1){Sv+=n,n<0&&Il&&e&&(Il.hasOnce=!0)}function WN(n){return n.dynamicChildren=Sv>0?Il||ty:null,MU(),Sv>0&&Il&&Il.push(n),n}function ie(n,e,t,i,r,o){return WN(P(n,e,t,i,r,o,!0))}function Gt(n,e,t,i,r){return WN(mt(n,e,t,i,r,!0))}function Ev(n){return n?n.__v_isVNode===!0:!1}function Tp(n,e){return n.type===e.type&&n.key===e.key}const zN=({key:n})=>n??null,aI=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?ys(n)||Gr(n)||ci(n)?{i:Oo,r:n,k:e,f:!!t}:n:null);function P(n,e=null,t=null,i=0,r=null,o=n===Mt?0:1,s=!1,l=!1){const u={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&zN(e),ref:e&&aI(e),scopeId:hN,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:i,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:Oo};return l?(NR(u,t),o&128&&n.normalize(u)):t&&(u.shapeFlag|=ys(t)?8:16),Sv>0&&!s&&Il&&(u.patchFlag>0||o&6)&&u.patchFlag!==32&&Il.push(u),u}const mt=kU;function kU(n,e=null,t=null,i=0,r=null,o=!1){if((!n||n===AN)&&(n=na),Ev(n)){const l=ff(n,e,!0);return t&&NR(l,t),Sv>0&&!o&&Il&&(l.shapeFlag&6?Il[Il.indexOf(n)]=l:Il.push(l)),l.patchFlag=-2,l}if(ZU(n)&&(n=n.__vccOpts),e){e=LU(e);let{class:l,style:u}=e;l&&!ys(l)&&(e.class=Rn(l)),Rr(u)&&(Rw(u)&&!zn(u)&&(u=wo({},u)),e.style=Vc(u))}const s=ys(n)?1:ZN(n)?128:fN(n)?64:Rr(n)?4:ci(n)?2:0;return P(n,e,t,i,r,s,o,!0)}function LU(n){return n?Rw(n)||GN(n)?wo({},n):n:null}function ff(n,e,t=!1,i=!1){const{props:r,ref:o,patchFlag:s,children:l,transition:u}=n,h=e?DR(r||{},e):r,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:h,key:h&&zN(h),ref:e&&e.ref?t&&o?zn(o)?o.concat(aI(e)):[o,aI(e)]:aI(e):o,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:l,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Mt?s===-1?16:s|16:s,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:u,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&ff(n.ssContent),ssFallback:n.ssFallback&&ff(n.ssFallback),placeholder:n.placeholder,el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return u&&i&&Av(d,u.clone(d)),d}function Bt(n=" ",e=0){return mt(Ow,null,n,e)}function Le(n="",e=!1){return e?(U(),Gt(na,null,n)):mt(na,null,n)}function mc(n){return n==null||typeof n=="boolean"?mt(na):zn(n)?mt(Mt,null,n.slice()):Ev(n)?Bd(n):mt(Ow,null,String(n))}function Bd(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:ff(n)}function NR(n,e){let t=0;const{shapeFlag:i}=n;if(e==null)e=null;else if(zn(e))t=16;else if(typeof e=="object")if(i&65){const r=e.default;r&&(r._c&&(r._d=!1),NR(n,r()),r._c&&(r._d=!0));return}else{t=32;const r=e._;!r&&!GN(e)?e._ctx=Oo:r===3&&Oo&&(Oo.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else ci(e)?(e={default:e,_ctx:Oo},t=32):(e=String(e),i&64?(t=16,e=[Bt(e)]):t=8);n.children=e,n.shapeFlag|=t}function DR(...n){const e={};for(let t=0;t<n.length;t++){const i=n[t];for(const r in i)if(r==="class")e.class!==i.class&&(e.class=Rn([e.class,i.class]));else if(r==="style")e.style=Vc([e.style,i.style]);else if(xw(r)){const o=e[r],s=i[r];s&&o!==s&&!(zn(o)&&o.includes(s))&&(e[r]=o?[].concat(o,s):s)}else r!==""&&(e[r]=i[r])}return e}function dc(n,e,t,i=null){Pu(n,e,7,[t,i])}const PU=RN();let GU=0;function FU(n,e,t){const i=n.type,r=(e?e.appContext:n.appContext)||PU,o={uid:GU++,vnode:n,type:i,parent:e,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new B3(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(r.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ON(i,r),emitsOptions:kN(i,r),emit:null,emitted:null,propsDefaults:kr,inheritAttrs:i.inheritAttrs,ctx:kr,data:kr,props:kr,attrs:kr,slots:kr,refs:kr,setupState:kr,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return o.ctx={_:o},o.root=e?e.root:o,o.emit=fU.bind(null,o),n.ce&&n.ce(o),o}let ia=null;const hb=()=>ia||Oo;let nC,PE;{const n=Sw(),e=(t,i)=>{let r;return(r=n[t])||(r=n[t]=[]),r.push(i),o=>{r.length>1?r.forEach(s=>s(o)):r[0](o)}};nC=e("__VUE_INSTANCE_SETTERS__",t=>ia=t),PE=e("__VUE_SSR_SETTERS__",t=>Tv=t)}const db=n=>{const e=ia;return nC(n),n.scope.on(),()=>{n.scope.off(),nC(e)}},QP=()=>{ia&&ia.scope.off(),nC(null)};function UN(n){return n.vnode.shapeFlag&4}let Tv=!1;function OU(n,e=!1,t=!1){e&&PE(e);const{props:i,children:r}=n.vnode,o=UN(n);vU(n,i,o,e),CU(n,r,t||e);const s=o?NU(n,e):void 0;return e&&PE(!1),s}function NU(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,eU);const{setup:i}=t;if(i){Uh();const r=n.setupContext=i.length>1?VU(n):null,o=db(n),s=ub(i,n,0,[n.props,r]),l=P3(s);if(Xh(),o(),(l||n.sp)&&!ry(n)&&xN(n),l){if(s.then(QP,QP),e)return s.then(u=>{eG(n,u)}).catch(u=>{Mw(u,n,0)});n.asyncDep=s}else eG(n,s)}else XN(n)}function eG(n,e,t){ci(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Rr(e)&&(n.setupState=rN(e)),XN(n)}function XN(n,e,t){const i=n.type;n.render||(n.render=i.render||Ac);{const r=db(n);Uh();try{tU(n)}finally{Xh(),r()}}}const DU={get(n,e){return ta(n,"get",""),n[e]}};function VU(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,DU),slots:n.slots,emit:n.emit,expose:e}}function Nw(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(rN(Mp(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in J0)return J0[t](n)},has(e,t){return t in e||t in J0}})):n.proxy}function BU(n,e=!0){return ci(n)?n.displayName||n.name:n.name||e&&n.__name}function ZU(n){return ci(n)&&"__vccOpts"in n}const Ct=(n,e)=>G9(n,e,Tv);function WU(n,e,t){try{tC(-1);const i=arguments.length;return i===2?Rr(e)&&!zn(e)?Ev(e)?mt(n,null,[e]):mt(n,e):mt(n,null,e):(i>3?t=Array.prototype.slice.call(arguments,2):i===3&&Ev(t)&&(t=[t]),mt(n,e,t))}finally{tC(1)}}const zU="3.5.25";let GE;const tG=typeof window<"u"&&window.trustedTypes;if(tG)try{GE=tG.createPolicy("vue",{createHTML:n=>n})}catch{}const YN=GE?n=>GE.createHTML(n):n=>n,UU="http://www.w3.org/2000/svg",XU="http://www.w3.org/1998/Math/MathML",Ch=typeof document<"u"?document:null,nG=Ch&&Ch.createElement("template"),YU={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,i)=>{const r=e==="svg"?Ch.createElementNS(UU,n):e==="mathml"?Ch.createElementNS(XU,n):t?Ch.createElement(n,{is:t}):Ch.createElement(n);return n==="select"&&i&&i.multiple!=null&&r.setAttribute("multiple",i.multiple),r},createText:n=>Ch.createTextNode(n),createComment:n=>Ch.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ch.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,i,r,o){const s=t?t.previousSibling:e.lastChild;if(r&&(r===o||r.nextSibling))for(;e.insertBefore(r.cloneNode(!0),t),!(r===o||!(r=r.nextSibling)););else{nG.innerHTML=YN(i==="svg"?`<svg>${n}</svg>`:i==="mathml"?`<math>${n}</math>`:n);const l=nG.content;if(i==="svg"||i==="mathml"){const u=l.firstChild;for(;u.firstChild;)l.appendChild(u.firstChild);l.removeChild(u)}e.insertBefore(l,t)}return[s?s.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Td="transition",n0="animation",Rv=Symbol("_vtc"),HN={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},HU=wo({},mN,HN),KU=n=>(n.displayName="Transition",n.props=HU,n),Dw=KU((n,{slots:e})=>WU(z9,jU(n),e)),dp=(n,e=[])=>{zn(n)?n.forEach(t=>t(...e)):n&&n(...e)},iG=n=>n?zn(n)?n.some(e=>e.length>1):n.length>1:!1;function jU(n){const e={};for(const Y in n)Y in HN||(e[Y]=n[Y]);if(n.css===!1)return e;const{name:t="v",type:i,duration:r,enterFromClass:o=`${t}-enter-from`,enterActiveClass:s=`${t}-enter-active`,enterToClass:l=`${t}-enter-to`,appearFromClass:u=o,appearActiveClass:h=s,appearToClass:d=l,leaveFromClass:m=`${t}-leave-from`,leaveActiveClass:y=`${t}-leave-active`,leaveToClass:x=`${t}-leave-to`}=n,C=$U(r),w=C&&C[0],E=C&&C[1],{onBeforeEnter:T,onEnter:k,onEnterCancelled:G,onLeave:O,onLeaveCancelled:V,onBeforeAppear:z=T,onAppear:H=k,onAppearCancelled:te=G}=e,$=(Y,de,D,oe)=>{Y._enterCancelled=oe,fp(Y,de?d:l),fp(Y,de?h:s),D&&D()},ae=(Y,de)=>{Y._isLeaving=!1,fp(Y,m),fp(Y,x),fp(Y,y),de&&de()},fe=Y=>(de,D)=>{const oe=Y?H:k,ue=()=>$(de,Y,D);dp(oe,[de,ue]),rG(()=>{fp(de,Y?u:o),yh(de,Y?d:l),iG(oe)||sG(de,i,w,ue)})};return wo(e,{onBeforeEnter(Y){dp(T,[Y]),yh(Y,o),yh(Y,s)},onBeforeAppear(Y){dp(z,[Y]),yh(Y,u),yh(Y,h)},onEnter:fe(!1),onAppear:fe(!0),onLeave(Y,de){Y._isLeaving=!0;const D=()=>ae(Y,de);yh(Y,m),Y._enterCancelled?(yh(Y,y),lG(Y)):(lG(Y),yh(Y,y)),rG(()=>{Y._isLeaving&&(fp(Y,m),yh(Y,x),iG(O)||sG(Y,i,E,D))}),dp(O,[Y,D])},onEnterCancelled(Y){$(Y,!1,void 0,!0),dp(G,[Y])},onAppearCancelled(Y){$(Y,!0,void 0,!0),dp(te,[Y])},onLeaveCancelled(Y){ae(Y),dp(V,[Y])}})}function $U(n){if(n==null)return null;if(Rr(n))return[L2(n.enter),L2(n.leave)];{const e=L2(n);return[e,e]}}function L2(n){return q6(n)}function yh(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[Rv]||(n[Rv]=new Set)).add(e)}function fp(n,e){e.split(/\s+/).forEach(i=>i&&n.classList.remove(i));const t=n[Rv];t&&(t.delete(e),t.size||(n[Rv]=void 0))}function rG(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let JU=0;function sG(n,e,t,i){const r=n._endId=++JU,o=()=>{r===n._endId&&i()};if(t!=null)return setTimeout(o,t);const{type:s,timeout:l,propCount:u}=qU(n,e);if(!s)return i();const h=s+"end";let d=0;const m=()=>{n.removeEventListener(h,y),o()},y=x=>{x.target===n&&++d>=u&&m()};setTimeout(()=>{d<u&&m()},l+1),n.addEventListener(h,y)}function qU(n,e){const t=window.getComputedStyle(n),i=C=>(t[C]||"").split(", "),r=i(`${Td}Delay`),o=i(`${Td}Duration`),s=oG(r,o),l=i(`${n0}Delay`),u=i(`${n0}Duration`),h=oG(l,u);let d=null,m=0,y=0;e===Td?s>0&&(d=Td,m=s,y=o.length):e===n0?h>0&&(d=n0,m=h,y=u.length):(m=Math.max(s,h),d=m>0?s>h?Td:n0:null,y=d?d===Td?o.length:u.length:0);const x=d===Td&&/\b(?:transform|all)(?:,|$)/.test(i(`${Td}Property`).toString());return{type:d,timeout:m,propCount:y,hasTransform:x}}function oG(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,i)=>aG(t)+aG(n[i])))}function aG(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function lG(n){return(n?n.ownerDocument:document).body.offsetHeight}function QU(n,e,t){const i=n[Rv];i&&(e=(e?[e,...i]:[...i]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const iC=Symbol("_vod"),KN=Symbol("_vsh"),Yp={name:"show",beforeMount(n,{value:e},{transition:t}){n[iC]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):i0(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:i}){!e!=!t&&(i?e?(i.beforeEnter(n),i0(n,!0),i.enter(n)):i.leave(n,()=>{i0(n,!1)}):i0(n,e))},beforeUnmount(n,{value:e}){i0(n,e)}};function i0(n,e){n.style.display=e?n[iC]:"none",n[KN]=!e}const eX=Symbol(""),tX=/(?:^|;)\s*display\s*:/;function nX(n,e,t){const i=n.style,r=ys(t);let o=!1;if(t&&!r){if(e)if(ys(e))for(const s of e.split(";")){const l=s.slice(0,s.indexOf(":")).trim();t[l]==null&&lI(i,l,"")}else for(const s in e)t[s]==null&&lI(i,s,"");for(const s in t)s==="display"&&(o=!0),lI(i,s,t[s])}else if(r){if(e!==t){const s=i[eX];s&&(t+=";"+s),i.cssText=t,o=tX.test(t)}}else e&&n.removeAttribute("style");iC in n&&(n[iC]=o?i.display:"",n[KN]&&(i.display="none"))}const uG=/\s*!important$/;function lI(n,e,t){if(zn(t))t.forEach(i=>lI(n,e,i));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const i=iX(n,e);uG.test(t)?n.setProperty(Cf(i),t.replace(uG,""),"important"):n[i]=t}}const cG=["Webkit","Moz","ms"],P2={};function iX(n,e){const t=P2[e];if(t)return t;let i=eu(e);if(i!=="filter"&&i in n)return P2[e]=i;i=ww(i);for(let r=0;r<cG.length;r++){const o=cG[r]+i;if(o in n)return P2[e]=o}return e}const hG="http://www.w3.org/1999/xlink";function dG(n,e,t,i,r,o=r9(e)){i&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(hG,e.slice(6,e.length)):n.setAttributeNS(hG,e,t):t==null||o&&!N3(t)?n.removeAttribute(e):n.setAttribute(e,o?"":ku(t)?String(t):t)}function fG(n,e,t,i,r){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?YN(t):t);return}const o=n.tagName;if(e==="value"&&o!=="PROGRESS"&&!o.includes("-")){const l=o==="OPTION"?n.getAttribute("value")||"":n.value,u=t==null?n.type==="checkbox"?"on":"":String(t);(l!==u||!("_value"in n))&&(n.value=u),t==null&&n.removeAttribute(e),n._value=t;return}let s=!1;if(t===""||t==null){const l=typeof n[e];l==="boolean"?t=N3(t):t==null&&l==="string"?(t="",s=!0):l==="number"&&(t=0,s=!0)}try{n[e]=t}catch{}s&&n.removeAttribute(r||e)}function Ud(n,e,t,i){n.addEventListener(e,t,i)}function rX(n,e,t,i){n.removeEventListener(e,t,i)}const pG=Symbol("_vei");function sX(n,e,t,i,r=null){const o=n[pG]||(n[pG]={}),s=o[e];if(i&&s)s.value=i;else{const[l,u]=oX(e);if(i){const h=o[e]=uX(i,r);Ud(n,l,h,u)}else s&&(rX(n,l,s,u),o[e]=void 0)}}const gG=/(?:Once|Passive|Capture)$/;function oX(n){let e;if(gG.test(n)){e={};let i;for(;i=n.match(gG);)n=n.slice(0,n.length-i[0].length),e[i[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Cf(n.slice(2)),e]}let G2=0;const aX=Promise.resolve(),lX=()=>G2||(aX.then(()=>G2=0),G2=Date.now());function uX(n,e){const t=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=t.attached)return;Pu(cX(i,t.value),e,5,[i])};return t.value=n,t.attached=lX(),t}function cX(n,e){if(zn(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(i=>r=>!r._stopped&&i&&i(r))}else return e}const mG=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,hX=(n,e,t,i,r,o)=>{const s=r==="svg";e==="class"?QU(n,i,s):e==="style"?nX(n,t,i):xw(e)?xR(e)||sX(n,e,t,i,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):dX(n,e,i,s))?(fG(n,e,i),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&dG(n,e,i,s,o,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!ys(i))?fG(n,eu(e),i,o,e):(e==="true-value"?n._trueValue=i:e==="false-value"&&(n._falseValue=i),dG(n,e,i,s))};function dX(n,e,t,i){if(i)return!!(e==="innerHTML"||e==="textContent"||e in n&&mG(e)&&ci(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="sandbox"&&n.tagName==="IFRAME"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const r=n.tagName;if(r==="IMG"||r==="VIDEO"||r==="CANVAS"||r==="SOURCE")return!1}return mG(e)&&ys(t)?!1:e in n}const Ay=n=>{const e=n.props["onUpdate:modelValue"]||!1;return zn(e)?t=>sI(e,t):e};function fX(n){n.target.composing=!0}function yG(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ph=Symbol("_assign");function _G(n,e,t){return e&&(n=n.trim()),t&&(n=Aw(n)),n}const Or={created(n,{modifiers:{lazy:e,trim:t,number:i}},r){n[Ph]=Ay(r);const o=i||r.props&&r.props.type==="number";Ud(n,e?"change":"input",s=>{s.target.composing||n[Ph](_G(n.value,t,o))}),(t||o)&&Ud(n,"change",()=>{n.value=_G(n.value,t,o)}),e||(Ud(n,"compositionstart",fX),Ud(n,"compositionend",yG),Ud(n,"change",yG))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:i,trim:r,number:o}},s){if(n[Ph]=Ay(s),n.composing)return;const l=(o||n.type==="number")&&!/^0\d/.test(n.value)?Aw(n.value):n.value,u=e??"";l!==u&&(document.activeElement===n&&n.type!=="range"&&(i&&e===t||r&&n.value.trim()===u)||(n.value=u))}},Hh={deep:!0,created(n,e,t){n[Ph]=Ay(t),Ud(n,"change",()=>{const i=n._modelValue,r=Mv(n),o=n.checked,s=n[Ph];if(zn(i)){const l=CR(i,r),u=l!==-1;if(o&&!u)s(i.concat(r));else if(!o&&u){const h=[...i];h.splice(l,1),s(h)}}else if(Vy(i)){const l=new Set(i);o?l.add(r):l.delete(r),s(l)}else s($N(n,o))})},mounted:vG,beforeUpdate(n,e,t){n[Ph]=Ay(t),vG(n,e,t)}};function vG(n,{value:e,oldValue:t},i){n._modelValue=e;let r;if(zn(e))r=CR(e,i.props.value)>-1;else if(Vy(e))r=e.has(i.props.value);else{if(e===t)return;r=lb(e,$N(n,!0))}n.checked!==r&&(n.checked=r)}const jN={deep:!0,created(n,{value:e,modifiers:{number:t}},i){const r=Vy(e);Ud(n,"change",()=>{const o=Array.prototype.filter.call(n.options,s=>s.selected).map(s=>t?Aw(Mv(s)):Mv(s));n[Ph](n.multiple?r?new Set(o):o:o[0]),n._assigning=!0,no(()=>{n._assigning=!1})}),n[Ph]=Ay(i)},mounted(n,{value:e}){bG(n,e)},beforeUpdate(n,e,t){n[Ph]=Ay(t)},updated(n,{value:e}){n._assigning||bG(n,e)}};function bG(n,e){const t=n.multiple,i=zn(e);if(!(t&&!i&&!Vy(e))){for(let r=0,o=n.options.length;r<o;r++){const s=n.options[r],l=Mv(s);if(t)if(i){const u=typeof l;u==="string"||u==="number"?s.selected=e.some(h=>String(h)===String(l)):s.selected=CR(e,l)>-1}else s.selected=e.has(l);else if(lb(Mv(s),e)){n.selectedIndex!==r&&(n.selectedIndex=r);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function Mv(n){return"_value"in n?n._value:n.value}function $N(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const pX=["ctrl","shift","alt","meta"],gX={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>pX.some(t=>n[`${t}Key`]&&!e.includes(t))},ps=(n,e)=>{const t=n._withMods||(n._withMods={}),i=e.join(".");return t[i]||(t[i]=((r,...o)=>{for(let s=0;s<e.length;s++){const l=gX[e[s]];if(l&&l(r,e))return}return n(r,...o)}))},mX={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},to=(n,e)=>{const t=n._withKeys||(n._withKeys={}),i=e.join(".");return t[i]||(t[i]=(r=>{if(!("key"in r))return;const o=Cf(r.key);if(e.some(s=>s===o||mX[s]===o))return n(r)}))},yX=wo({patchProp:hX},YU);let xG;function _X(){return xG||(xG=AU(yX))}const vX=((...n)=>{const e=_X().createApp(...n),{mount:t}=e;return e.mount=i=>{const r=xX(i);if(!r)return;const o=e._component;!ci(o)&&!o.render&&!o.template&&(o.template=r.innerHTML),r.nodeType===1&&(r.textContent="");const s=t(r,!1,bX(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),s},e});function bX(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function xX(n){return ys(n)?document.querySelector(n):n}var JN=Symbol();function IX(n,{i18next:e,rerenderOn:t=["languageChanged","loaded","added","removed"],slotStart:i="{",slotEnd:r="}"}){const o=mi(new Date),s=()=>no(()=>{o.value=new Date}),l=()=>o.value;t.forEach(d=>{var m;switch(d){case"added":case"removed":(m=e.store)==null||m.on(d,s);break;default:e.on(d,s);break}}),n.component("i18next",AX);const u=()=>e.isInitialized;n.config.globalProperties.$t=IG(e.t.bind(e),l,u);const h=new Proxy(e,{get(d,m){return l(),Reflect.get(d,m)}});n.config.globalProperties.$i18next=h,n.provide(JN,{i18next:h,slotPattern:wX(i,r),withAccessRecording(d,m){return IG(d,l,m)}})}function St(n,e){const{i18next:t,withAccessRecording:i}=qN();let r;return r=t.getFixedT(null,null,void 0),{i18next:t,t:i(r,CX(t,n))}}function CX(n,e=[]){let t;return()=>{if(t===void 0)if(n.isInitialized){const r=(typeof e=="string"?[e]:e).filter(o=>!n.hasLoadedNamespace(o));r.length?(t=!1,n.loadNamespaces(r).then(()=>t=!0)):t=!0}else return!1;return t}}function IG(n,e,t){return new Proxy(n,{apply:function(i,r,o){return e(),t()?Reflect.apply(i,r,o):""}})}function qN(){const n=Do(JN);if(!n)throw new Error("i18next-vue: Make sure to register the i18next-vue plugin using app.use(...).");return n}function wX(n,e){const t=`${n}\\s*([a-z0-9\\-]+)\\s*${e}`;return new RegExp(t,"gi")}var AX=at({props:{translation:{type:String,required:!0}},setup(n,{slots:e}){const{slotPattern:t}=qN();return()=>{const i=n.translation,r=[];let o,s=0;for(;(o=t.exec(i))!==null;){r.push(i.substring(s,o.index));const l=e[o[1]];l?r.push(...l()):r.push(o[0]),s=t.lastIndex}return r.push(i.substring(s)),r}}});const{entries:QN,setPrototypeOf:CG,isFrozen:SX,getPrototypeOf:EX,getOwnPropertyDescriptor:TX}=Object;let{freeze:wa,seal:tu,create:FE}=Object,{apply:OE,construct:NE}=typeof Reflect<"u"&&Reflect;wa||(wa=function(e){return e});tu||(tu=function(e){return e});OE||(OE=function(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];return e.apply(t,r)});NE||(NE=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return new e(...i)});const nx=Aa(Array.prototype.forEach),RX=Aa(Array.prototype.lastIndexOf),wG=Aa(Array.prototype.pop),r0=Aa(Array.prototype.push),MX=Aa(Array.prototype.splice),uI=Aa(String.prototype.toLowerCase),F2=Aa(String.prototype.toString),O2=Aa(String.prototype.match),s0=Aa(String.prototype.replace),kX=Aa(String.prototype.indexOf),LX=Aa(String.prototype.trim),yu=Aa(Object.prototype.hasOwnProperty),ma=Aa(RegExp.prototype.test),o0=PX(TypeError);function Aa(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return OE(n,e,i)}}function PX(n){return function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return NE(n,t)}}function Oi(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:uI;CG&&CG(n,null);let i=e.length;for(;i--;){let r=e[i];if(typeof r=="string"){const o=t(r);o!==r&&(SX(e)||(e[i]=o),r=o)}n[r]=!0}return n}function GX(n){for(let e=0;e<n.length;e++)yu(n,e)||(n[e]=null);return n}function fc(n){const e=FE(null);for(const[t,i]of QN(n))yu(n,t)&&(Array.isArray(i)?e[t]=GX(i):i&&typeof i=="object"&&i.constructor===Object?e[t]=fc(i):e[t]=i);return e}function a0(n,e){for(;n!==null;){const i=TX(n,e);if(i){if(i.get)return Aa(i.get);if(typeof i.value=="function")return Aa(i.value)}n=EX(n)}function t(){return null}return t}const AG=wa(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),N2=wa(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),D2=wa(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),FX=wa(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),V2=wa(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),OX=wa(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),SG=wa(["#text"]),EG=wa(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),B2=wa(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),TG=wa(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ix=wa(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),NX=tu(/\{\{[\w\W]*|[\w\W]*\}\}/gm),DX=tu(/<%[\w\W]*|[\w\W]*%>/gm),VX=tu(/\$\{[\w\W]*/gm),BX=tu(/^data-[\-\w.\u00B7-\uFFFF]+$/),ZX=tu(/^aria-[\-\w]+$/),eD=tu(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),WX=tu(/^(?:\w+script|data):/i),zX=tu(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),tD=tu(/^html$/i),UX=tu(/^[a-z][.\w]*(-[.\w]+)+$/i);var RG=Object.freeze({__proto__:null,ARIA_ATTR:ZX,ATTR_WHITESPACE:zX,CUSTOM_ELEMENT:UX,DATA_ATTR:BX,DOCTYPE_NAME:tD,ERB_EXPR:DX,IS_ALLOWED_URI:eD,IS_SCRIPT_OR_DATA:WX,MUSTACHE_EXPR:NX,TMPLIT_EXPR:VX});const l0={element:1,text:3,progressingInstruction:7,comment:8,document:9},XX=function(){return typeof window>"u"?null:window},YX=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let i=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(i=t.getAttribute(r));const o="dompurify"+(i?"#"+i:"");try{return e.createPolicy(o,{createHTML(s){return s},createScriptURL(s){return s}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},MG=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function nD(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:XX();const e=Dt=>nD(Dt);if(e.version="3.3.1",e.removed=[],!n||!n.document||n.document.nodeType!==l0.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const i=t,r=i.currentScript,{DocumentFragment:o,HTMLTemplateElement:s,Node:l,Element:u,NodeFilter:h,NamedNodeMap:d=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:m,DOMParser:y,trustedTypes:x}=n,C=u.prototype,w=a0(C,"cloneNode"),E=a0(C,"remove"),T=a0(C,"nextSibling"),k=a0(C,"childNodes"),G=a0(C,"parentNode");if(typeof s=="function"){const Dt=t.createElement("template");Dt.content&&Dt.content.ownerDocument&&(t=Dt.content.ownerDocument)}let O,V="";const{implementation:z,createNodeIterator:H,createDocumentFragment:te,getElementsByTagName:$}=t,{importNode:ae}=i;let fe=MG();e.isSupported=typeof QN=="function"&&typeof G=="function"&&z&&z.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Y,ERB_EXPR:de,TMPLIT_EXPR:D,DATA_ATTR:oe,ARIA_ATTR:ue,IS_SCRIPT_OR_DATA:ge,ATTR_WHITESPACE:Ne,CUSTOM_ELEMENT:Ee}=RG;let{IS_ALLOWED_URI:se}=RG,q=null;const j=Oi({},[...AG,...N2,...D2,...V2,...SG]);let ze=null;const je=Oi({},[...EG,...B2,...TG,...ix]);let qe=Object.seal(FE(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),yt=null,xt=null;const Et=Object.seal(FE(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let kt=!0,hn=!0,wn=!1,Ge=!0,ve=!1,W=!0,Ze=!1,Re=!1,ce=!1,me=!1,_e=!1,Ie=!1,pe=!0,Te=!1;const We="user-content-";let tt=!0,nt=!1,bt={},on=null;const an=Oi({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ii=null;const ji=Oi({},["audio","video","img","source","image","track"]);let Pi=null;const Mr=Oi({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),_i="http://www.w3.org/1998/Math/MathML",ss="http://www.w3.org/2000/svg",Ei="http://www.w3.org/1999/xhtml";let Mi=Ei,zs=!1,Ao=null;const Ea=Oi({},[_i,ss,Ei],F2);let _s=Oi({},["mi","mo","mn","ms","mtext"]),Ur=Oi({},["annotation-xml"]);const Xr=Oi({},["title","style","font","a","script"]);let vs=null;const Pl=["application/xhtml+xml","text/html"],Ti="text/html";let ee=null,le=null;const ye=t.createElement("form"),Ae=function(Fe){return Fe instanceof RegExp||Fe instanceof Function},Me=function(){let Fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(le&&le===Fe)){if((!Fe||typeof Fe!="object")&&(Fe={}),Fe=fc(Fe),vs=Pl.indexOf(Fe.PARSER_MEDIA_TYPE)===-1?Ti:Fe.PARSER_MEDIA_TYPE,ee=vs==="application/xhtml+xml"?F2:uI,q=yu(Fe,"ALLOWED_TAGS")?Oi({},Fe.ALLOWED_TAGS,ee):j,ze=yu(Fe,"ALLOWED_ATTR")?Oi({},Fe.ALLOWED_ATTR,ee):je,Ao=yu(Fe,"ALLOWED_NAMESPACES")?Oi({},Fe.ALLOWED_NAMESPACES,F2):Ea,Pi=yu(Fe,"ADD_URI_SAFE_ATTR")?Oi(fc(Mr),Fe.ADD_URI_SAFE_ATTR,ee):Mr,Ii=yu(Fe,"ADD_DATA_URI_TAGS")?Oi(fc(ji),Fe.ADD_DATA_URI_TAGS,ee):ji,on=yu(Fe,"FORBID_CONTENTS")?Oi({},Fe.FORBID_CONTENTS,ee):an,yt=yu(Fe,"FORBID_TAGS")?Oi({},Fe.FORBID_TAGS,ee):fc({}),xt=yu(Fe,"FORBID_ATTR")?Oi({},Fe.FORBID_ATTR,ee):fc({}),bt=yu(Fe,"USE_PROFILES")?Fe.USE_PROFILES:!1,kt=Fe.ALLOW_ARIA_ATTR!==!1,hn=Fe.ALLOW_DATA_ATTR!==!1,wn=Fe.ALLOW_UNKNOWN_PROTOCOLS||!1,Ge=Fe.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ve=Fe.SAFE_FOR_TEMPLATES||!1,W=Fe.SAFE_FOR_XML!==!1,Ze=Fe.WHOLE_DOCUMENT||!1,me=Fe.RETURN_DOM||!1,_e=Fe.RETURN_DOM_FRAGMENT||!1,Ie=Fe.RETURN_TRUSTED_TYPE||!1,ce=Fe.FORCE_BODY||!1,pe=Fe.SANITIZE_DOM!==!1,Te=Fe.SANITIZE_NAMED_PROPS||!1,tt=Fe.KEEP_CONTENT!==!1,nt=Fe.IN_PLACE||!1,se=Fe.ALLOWED_URI_REGEXP||eD,Mi=Fe.NAMESPACE||Ei,_s=Fe.MATHML_TEXT_INTEGRATION_POINTS||_s,Ur=Fe.HTML_INTEGRATION_POINTS||Ur,qe=Fe.CUSTOM_ELEMENT_HANDLING||{},Fe.CUSTOM_ELEMENT_HANDLING&&Ae(Fe.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(qe.tagNameCheck=Fe.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Fe.CUSTOM_ELEMENT_HANDLING&&Ae(Fe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(qe.attributeNameCheck=Fe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Fe.CUSTOM_ELEMENT_HANDLING&&typeof Fe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(qe.allowCustomizedBuiltInElements=Fe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ve&&(hn=!1),_e&&(me=!0),bt&&(q=Oi({},SG),ze=[],bt.html===!0&&(Oi(q,AG),Oi(ze,EG)),bt.svg===!0&&(Oi(q,N2),Oi(ze,B2),Oi(ze,ix)),bt.svgFilters===!0&&(Oi(q,D2),Oi(ze,B2),Oi(ze,ix)),bt.mathMl===!0&&(Oi(q,V2),Oi(ze,TG),Oi(ze,ix))),Fe.ADD_TAGS&&(typeof Fe.ADD_TAGS=="function"?Et.tagCheck=Fe.ADD_TAGS:(q===j&&(q=fc(q)),Oi(q,Fe.ADD_TAGS,ee))),Fe.ADD_ATTR&&(typeof Fe.ADD_ATTR=="function"?Et.attributeCheck=Fe.ADD_ATTR:(ze===je&&(ze=fc(ze)),Oi(ze,Fe.ADD_ATTR,ee))),Fe.ADD_URI_SAFE_ATTR&&Oi(Pi,Fe.ADD_URI_SAFE_ATTR,ee),Fe.FORBID_CONTENTS&&(on===an&&(on=fc(on)),Oi(on,Fe.FORBID_CONTENTS,ee)),Fe.ADD_FORBID_CONTENTS&&(on===an&&(on=fc(on)),Oi(on,Fe.ADD_FORBID_CONTENTS,ee)),tt&&(q["#text"]=!0),Ze&&Oi(q,["html","head","body"]),q.table&&(Oi(q,["tbody"]),delete yt.tbody),Fe.TRUSTED_TYPES_POLICY){if(typeof Fe.TRUSTED_TYPES_POLICY.createHTML!="function")throw o0('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof Fe.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw o0('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');O=Fe.TRUSTED_TYPES_POLICY,V=O.createHTML("")}else O===void 0&&(O=YX(x,r)),O!==null&&typeof V=="string"&&(V=O.createHTML(""));wa&&wa(Fe),le=Fe}},$e=Oi({},[...N2,...D2,...FX]),Ye=Oi({},[...V2,...OX]),be=function(Fe){let vt=G(Fe);(!vt||!vt.tagName)&&(vt={namespaceURI:Mi,tagName:"template"});const Kt=uI(Fe.tagName),yn=uI(vt.tagName);return Ao[Fe.namespaceURI]?Fe.namespaceURI===ss?vt.namespaceURI===Ei?Kt==="svg":vt.namespaceURI===_i?Kt==="svg"&&(yn==="annotation-xml"||_s[yn]):!!$e[Kt]:Fe.namespaceURI===_i?vt.namespaceURI===Ei?Kt==="math":vt.namespaceURI===ss?Kt==="math"&&Ur[yn]:!!Ye[Kt]:Fe.namespaceURI===Ei?vt.namespaceURI===ss&&!Ur[yn]||vt.namespaceURI===_i&&!_s[yn]?!1:!Ye[Kt]&&(Xr[Kt]||!$e[Kt]):!!(vs==="application/xhtml+xml"&&Ao[Fe.namespaceURI]):!1},ke=function(Fe){r0(e.removed,{element:Fe});try{G(Fe).removeChild(Fe)}catch{E(Fe)}},it=function(Fe,vt){try{r0(e.removed,{attribute:vt.getAttributeNode(Fe),from:vt})}catch{r0(e.removed,{attribute:null,from:vt})}if(vt.removeAttribute(Fe),Fe==="is")if(me||_e)try{ke(vt)}catch{}else try{vt.setAttribute(Fe,"")}catch{}},At=function(Fe){let vt=null,Kt=null;if(ce)Fe="<remove></remove>"+Fe;else{const En=O2(Fe,/^[\r\n\t ]+/);Kt=En&&En[0]}vs==="application/xhtml+xml"&&Mi===Ei&&(Fe='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Fe+"</body></html>");const yn=O?O.createHTML(Fe):Fe;if(Mi===Ei)try{vt=new y().parseFromString(yn,vs)}catch{}if(!vt||!vt.documentElement){vt=z.createDocument(Mi,"template",null);try{vt.documentElement.innerHTML=zs?V:yn}catch{}}const Bn=vt.body||vt.documentElement;return Fe&&Kt&&Bn.insertBefore(t.createTextNode(Kt),Bn.childNodes[0]||null),Mi===Ei?$.call(vt,Ze?"html":"body")[0]:Ze?vt.documentElement:Bn},Lt=function(Fe){return H.call(Fe.ownerDocument||Fe,Fe,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null)},dt=function(Fe){return Fe instanceof m&&(typeof Fe.nodeName!="string"||typeof Fe.textContent!="string"||typeof Fe.removeChild!="function"||!(Fe.attributes instanceof d)||typeof Fe.removeAttribute!="function"||typeof Fe.setAttribute!="function"||typeof Fe.namespaceURI!="string"||typeof Fe.insertBefore!="function"||typeof Fe.hasChildNodes!="function")},Tt=function(Fe){return typeof l=="function"&&Fe instanceof l};function qt(Dt,Fe,vt){nx(Dt,Kt=>{Kt.call(e,Fe,vt,le)})}const tn=function(Fe){let vt=null;if(qt(fe.beforeSanitizeElements,Fe,null),dt(Fe))return ke(Fe),!0;const Kt=ee(Fe.nodeName);if(qt(fe.uponSanitizeElement,Fe,{tagName:Kt,allowedTags:q}),W&&Fe.hasChildNodes()&&!Tt(Fe.firstElementChild)&&ma(/<[/\w!]/g,Fe.innerHTML)&&ma(/<[/\w!]/g,Fe.textContent)||Fe.nodeType===l0.progressingInstruction||W&&Fe.nodeType===l0.comment&&ma(/<[/\w]/g,Fe.data))return ke(Fe),!0;if(!(Et.tagCheck instanceof Function&&Et.tagCheck(Kt))&&(!q[Kt]||yt[Kt])){if(!yt[Kt]&&$t(Kt)&&(qe.tagNameCheck instanceof RegExp&&ma(qe.tagNameCheck,Kt)||qe.tagNameCheck instanceof Function&&qe.tagNameCheck(Kt)))return!1;if(tt&&!on[Kt]){const yn=G(Fe)||Fe.parentNode,Bn=k(Fe)||Fe.childNodes;if(Bn&&yn){const En=Bn.length;for(let Qi=En-1;Qi>=0;--Qi){const li=w(Bn[Qi],!0);li.__removalCount=(Fe.__removalCount||0)+1,yn.insertBefore(li,T(Fe))}}}return ke(Fe),!0}return Fe instanceof u&&!be(Fe)||(Kt==="noscript"||Kt==="noembed"||Kt==="noframes")&&ma(/<\/no(script|embed|frames)/i,Fe.innerHTML)?(ke(Fe),!0):(ve&&Fe.nodeType===l0.text&&(vt=Fe.textContent,nx([Y,de,D],yn=>{vt=s0(vt,yn," ")}),Fe.textContent!==vt&&(r0(e.removed,{element:Fe.cloneNode()}),Fe.textContent=vt)),qt(fe.afterSanitizeElements,Fe,null),!1)},pt=function(Fe,vt,Kt){if(pe&&(vt==="id"||vt==="name")&&(Kt in t||Kt in ye))return!1;if(!(hn&&!xt[vt]&&ma(oe,vt))){if(!(kt&&ma(ue,vt))){if(!(Et.attributeCheck instanceof Function&&Et.attributeCheck(vt,Fe))){if(!ze[vt]||xt[vt]){if(!($t(Fe)&&(qe.tagNameCheck instanceof RegExp&&ma(qe.tagNameCheck,Fe)||qe.tagNameCheck instanceof Function&&qe.tagNameCheck(Fe))&&(qe.attributeNameCheck instanceof RegExp&&ma(qe.attributeNameCheck,vt)||qe.attributeNameCheck instanceof Function&&qe.attributeNameCheck(vt,Fe))||vt==="is"&&qe.allowCustomizedBuiltInElements&&(qe.tagNameCheck instanceof RegExp&&ma(qe.tagNameCheck,Kt)||qe.tagNameCheck instanceof Function&&qe.tagNameCheck(Kt))))return!1}else if(!Pi[vt]){if(!ma(se,s0(Kt,Ne,""))){if(!((vt==="src"||vt==="xlink:href"||vt==="href")&&Fe!=="script"&&kX(Kt,"data:")===0&&Ii[Fe])){if(!(wn&&!ma(ge,s0(Kt,Ne,"")))){if(Kt)return!1}}}}}}}return!0},$t=function(Fe){return Fe!=="annotation-xml"&&O2(Fe,Ee)},Xt=function(Fe){qt(fe.beforeSanitizeAttributes,Fe,null);const{attributes:vt}=Fe;if(!vt||dt(Fe))return;const Kt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ze,forceKeepAttr:void 0};let yn=vt.length;for(;yn--;){const Bn=vt[yn],{name:En,namespaceURI:Qi,value:li}=Bn,or=ee(En),Gi=li;let Mn=En==="value"?Gi:LX(Gi);if(Kt.attrName=or,Kt.attrValue=Mn,Kt.keepAttr=!0,Kt.forceKeepAttr=void 0,qt(fe.uponSanitizeAttribute,Fe,Kt),Mn=Kt.attrValue,Te&&(or==="id"||or==="name")&&(it(En,Fe),Mn=We+Mn),W&&ma(/((--!?|])>)|<\/(style|title|textarea)/i,Mn)){it(En,Fe);continue}if(or==="attributename"&&O2(Mn,"href")){it(En,Fe);continue}if(Kt.forceKeepAttr)continue;if(!Kt.keepAttr){it(En,Fe);continue}if(!Ge&&ma(/\/>/i,Mn)){it(En,Fe);continue}ve&&nx([Y,de,D],Us=>{Mn=s0(Mn,Us," ")});const Ci=ee(Fe.nodeName);if(!pt(Ci,or,Mn)){it(En,Fe);continue}if(O&&typeof x=="object"&&typeof x.getAttributeType=="function"&&!Qi)switch(x.getAttributeType(Ci,or)){case"TrustedHTML":{Mn=O.createHTML(Mn);break}case"TrustedScriptURL":{Mn=O.createScriptURL(Mn);break}}if(Mn!==Gi)try{Qi?Fe.setAttributeNS(Qi,En,Mn):Fe.setAttribute(En,Mn),dt(Fe)?ke(Fe):wG(e.removed)}catch{it(En,Fe)}}qt(fe.afterSanitizeAttributes,Fe,null)},Yt=function Dt(Fe){let vt=null;const Kt=Lt(Fe);for(qt(fe.beforeSanitizeShadowDOM,Fe,null);vt=Kt.nextNode();)qt(fe.uponSanitizeShadowNode,vt,null),tn(vt),Xt(vt),vt.content instanceof o&&Dt(vt.content);qt(fe.afterSanitizeShadowDOM,Fe,null)};return e.sanitize=function(Dt){let Fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},vt=null,Kt=null,yn=null,Bn=null;if(zs=!Dt,zs&&(Dt="<!-->"),typeof Dt!="string"&&!Tt(Dt))if(typeof Dt.toString=="function"){if(Dt=Dt.toString(),typeof Dt!="string")throw o0("dirty is not a string, aborting")}else throw o0("toString is not a function");if(!e.isSupported)return Dt;if(Re||Me(Fe),e.removed=[],typeof Dt=="string"&&(nt=!1),nt){if(Dt.nodeName){const li=ee(Dt.nodeName);if(!q[li]||yt[li])throw o0("root node is forbidden and cannot be sanitized in-place")}}else if(Dt instanceof l)vt=At("<!---->"),Kt=vt.ownerDocument.importNode(Dt,!0),Kt.nodeType===l0.element&&Kt.nodeName==="BODY"||Kt.nodeName==="HTML"?vt=Kt:vt.appendChild(Kt);else{if(!me&&!ve&&!Ze&&Dt.indexOf("<")===-1)return O&&Ie?O.createHTML(Dt):Dt;if(vt=At(Dt),!vt)return me?null:Ie?V:""}vt&&ce&&ke(vt.firstChild);const En=Lt(nt?Dt:vt);for(;yn=En.nextNode();)tn(yn),Xt(yn),yn.content instanceof o&&Yt(yn.content);if(nt)return Dt;if(me){if(_e)for(Bn=te.call(vt.ownerDocument);vt.firstChild;)Bn.appendChild(vt.firstChild);else Bn=vt;return(ze.shadowroot||ze.shadowrootmode)&&(Bn=ae.call(i,Bn,!0)),Bn}let Qi=Ze?vt.outerHTML:vt.innerHTML;return Ze&&q["!doctype"]&&vt.ownerDocument&&vt.ownerDocument.doctype&&vt.ownerDocument.doctype.name&&ma(tD,vt.ownerDocument.doctype.name)&&(Qi="<!DOCTYPE "+vt.ownerDocument.doctype.name+`>
`+Qi),ve&&nx([Y,de,D],li=>{Qi=s0(Qi,li," ")}),O&&Ie?O.createHTML(Qi):Qi},e.setConfig=function(){let Dt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Me(Dt),Re=!0},e.clearConfig=function(){le=null,Re=!1},e.isValidAttribute=function(Dt,Fe,vt){le||Me({});const Kt=ee(Dt),yn=ee(Fe);return pt(Kt,yn,vt)},e.addHook=function(Dt,Fe){typeof Fe=="function"&&r0(fe[Dt],Fe)},e.removeHook=function(Dt,Fe){if(Fe!==void 0){const vt=RX(fe[Dt],Fe);return vt===-1?void 0:MX(fe[Dt],vt,1)[0]}return wG(fe[Dt])},e.removeHooks=function(Dt){fe[Dt]=[]},e.removeAllHooks=function(){fe=MG()},e}var HX=nD();function KX(n,e){const t=n.hooks??{};let i;for(i in t){const r=t[i];r!==void 0&&e.addHook(i,r)}}function iD(){return HX()}function jX(n={},e=iD){const t=e();KX(n,t);const i=function(s){const l=s.value;if(s.oldValue===l)return;const u=`${l}`,h=s.arg,d=n.namedConfigurations,m=n.default??{};return d&&h!==void 0?t.sanitize(u,d[h]??m):t.sanitize(u,m)},r=function(s,l){const u=i(l);u!==void 0&&(s.innerHTML=u)},o={mounted:r,updated:r};return n.enableSSRPropsSupport?{...o,getSSRProps(s){return{innerHTML:i(s)}}}:o}const $X={install(n,e={},t=iD){n.directive("dompurify-html",jX(e,t))}};let rD;const Vw=n=>rD=n,sD=Symbol();function DE(n){return n&&typeof n=="object"&&Object.prototype.toString.call(n)==="[object Object]"&&typeof n.toJSON!="function"}var Q0;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})(Q0||(Q0={}));function JX(){const n=Z3(!0),e=n.run(()=>Ue({}));let t=[],i=[];const r=Mp({install(o){Vw(r),r._a=o,o.provide(sD,r),o.config.globalProperties.$pinia=r,i.forEach(s=>t.push(s)),i=[]},use(o){return this._a?t.push(o):i.push(o),this},_p:t,_a:null,_e:n,_s:new Map,state:e});return r}const oD=()=>{};function kG(n,e,t,i=oD){n.push(e);const r=()=>{const o=n.indexOf(e);o>-1&&(n.splice(o,1),i())};return!t&&W3()&&o9(r),r}function gm(n,...e){n.slice().forEach(t=>{t(...e)})}const qX=n=>n(),LG=Symbol(),Z2=Symbol();function VE(n,e){n instanceof Map&&e instanceof Map?e.forEach((t,i)=>n.set(i,t)):n instanceof Set&&e instanceof Set&&e.forEach(n.add,n);for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t],r=n[t];DE(r)&&DE(i)&&n.hasOwnProperty(t)&&!Gr(i)&&!Sc(i)?n[t]=VE(r,i):n[t]=i}return n}const QX=Symbol();function eY(n){return!DE(n)||!n.hasOwnProperty(QX)}const{assign:Od}=Object;function tY(n){return!!(Gr(n)&&n.effect)}function nY(n,e,t,i){const{state:r,actions:o,getters:s}=e,l=t.state.value[n];let u;function h(){l||(t.state.value[n]=r?r():{});const d=M9(t.state.value[n]);return Od(d,o,Object.keys(s||{}).reduce((m,y)=>(m[y]=Mp(Ct(()=>{Vw(t);const x=t._s.get(n);return s[y].call(x,x)})),m),{}))}return u=aD(n,h,e,t,i,!0),u}function aD(n,e,t={},i,r,o){let s;const l=Od({actions:{}},t),u={deep:!0};let h,d,m=[],y=[],x;const C=i.state.value[n];!o&&!C&&(i.state.value[n]={}),Ue({});let w;function E(te){let $;h=d=!1,typeof te=="function"?(te(i.state.value[n]),$={type:Q0.patchFunction,storeId:n,events:x}):(VE(i.state.value[n],te),$={type:Q0.patchObject,payload:te,storeId:n,events:x});const ae=w=Symbol();no().then(()=>{w===ae&&(h=!0)}),d=!0,gm(m,$,i.state.value[n])}const T=o?function(){const{state:$}=t,ae=$?$():{};this.$patch(fe=>{Od(fe,ae)})}:oD;function k(){s.stop(),m=[],y=[],i._s.delete(n)}const G=(te,$="")=>{if(LG in te)return te[Z2]=$,te;const ae=function(){Vw(i);const fe=Array.from(arguments),Y=[],de=[];function D(ge){Y.push(ge)}function oe(ge){de.push(ge)}gm(y,{args:fe,name:ae[Z2],store:V,after:D,onError:oe});let ue;try{ue=te.apply(this&&this.$id===n?this:V,fe)}catch(ge){throw gm(de,ge),ge}return ue instanceof Promise?ue.then(ge=>(gm(Y,ge),ge)).catch(ge=>(gm(de,ge),Promise.reject(ge))):(gm(Y,ue),ue)};return ae[LG]=!0,ae[Z2]=$,ae},O={_p:i,$id:n,$onAction:kG.bind(null,y),$patch:E,$reset:T,$subscribe(te,$={}){const ae=kG(m,te,$.detached,()=>fe()),fe=s.run(()=>Pt(()=>i.state.value[n],Y=>{($.flush==="sync"?d:h)&&te({storeId:n,type:Q0.direct,events:x},Y)},Od({},u,$)));return ae},$dispose:k},V=Tw(O);i._s.set(n,V);const H=(i._a&&i._a.runWithContext||qX)(()=>i._e.run(()=>(s=Z3()).run(()=>e({action:G}))));for(const te in H){const $=H[te];if(Gr($)&&!tY($)||Sc($))o||(C&&eY($)&&(Gr($)?$.value=C[te]:VE($,C[te])),i.state.value[n][te]=$);else if(typeof $=="function"){const ae=G($,te);H[te]=ae,l.actions[te]=$}}return Od(V,H),Od(Ji(V),H),Object.defineProperty(V,"$state",{get:()=>i.state.value[n],set:te=>{E($=>{Od($,te)})}}),i._p.forEach(te=>{Od(V,s.run(()=>te({store:V,app:i._a,pinia:i,options:l})))}),C&&o&&t.hydrate&&t.hydrate(V.$state,C),h=!0,d=!0,V}function ca(n,e,t){let i,r;const o=typeof e=="function";typeof n=="string"?(i=n,r=o?t:e):(r=n,i=n.id);function s(l,u){const h=lU();return l=l||(h?Do(sD,null):null),l&&Vw(l),l=rD,l._s.has(i)||(o?aD(i,e,r,l):nY(i,r,l)),l._s.get(i)}return s.$id=i,s}function It(n){{const e=Ji(n),t={};for(const i in e){const r=e[i];r.effect?t[i]=Ct({get:()=>n[i],set(o){n[i]=o}}):(Gr(r)||Sc(r))&&(t[i]=sN(n,i))}return t}}function lD(...n){console.warn(...n)}const Co={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Js(n){const e=el();for(let t=0,i=n.length;t<i;++t)ev(e,n[t]);return e}function iY(n,e,t){const i=Math.min.apply(null,n),r=Math.min.apply(null,e),o=Math.max.apply(null,n),s=Math.max.apply(null,e);return Gc(i,r,o,s,t)}function Kh(n,e,t){return t?(t[0]=n[0]-e,t[1]=n[1]-e,t[2]=n[2]+e,t[3]=n[3]+e,t):[n[0]-e,n[1]-e,n[2]+e,n[3]+e]}function uD(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n.slice()}function hg(n,e,t){let i,r;return e<n[0]?i=n[0]-e:n[2]<e?i=e-n[2]:i=0,t<n[1]?r=n[1]-t:n[3]<t?r=t-n[3]:r=0,i*i+r*r}function Pc(n,e){return VR(n,e[0],e[1])}function vc(n,e){return n[0]<=e[0]&&e[2]<=n[2]&&n[1]<=e[1]&&e[3]<=n[3]}function VR(n,e,t){return n[0]<=e&&e<=n[2]&&n[1]<=t&&t<=n[3]}function BE(n,e){const t=n[0],i=n[1],r=n[2],o=n[3],s=e[0],l=e[1];let u=Co.UNKNOWN;return s<t?u=u|Co.LEFT:s>r&&(u=u|Co.RIGHT),l<i?u=u|Co.BELOW:l>o&&(u=u|Co.ABOVE),u===Co.UNKNOWN&&(u=Co.INTERSECTING),u}function el(){return[1/0,1/0,-1/0,-1/0]}function Gc(n,e,t,i,r){return r?(r[0]=n,r[1]=e,r[2]=t,r[3]=i,r):[n,e,t,i]}function By(n){return Gc(1/0,1/0,-1/0,-1/0,n)}function sy(n,e){const t=n[0],i=n[1];return Gc(t,i,t,i,e)}function BR(n,e,t,i,r){const o=By(r);return cD(o,n,e,t,i)}function Hp(n,e){return n[0]==e[0]&&n[2]==e[2]&&n[1]==e[1]&&n[3]==e[3]}function Sy(n,e){return e[0]<n[0]&&(n[0]=e[0]),e[2]>n[2]&&(n[2]=e[2]),e[1]<n[1]&&(n[1]=e[1]),e[3]>n[3]&&(n[3]=e[3]),n}function ev(n,e){e[0]<n[0]&&(n[0]=e[0]),e[0]>n[2]&&(n[2]=e[0]),e[1]<n[1]&&(n[1]=e[1]),e[1]>n[3]&&(n[3]=e[1])}function cD(n,e,t,i,r){for(;t<i;t+=r)rY(n,e[t],e[t+1]);return n}function rY(n,e,t){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}function ZR(n,e){let t;return t=e(Bw(n)),t||(t=e(Zw(n)),t)||(t=e(Ww(n)),t)||(t=e(nd(n)),t)?t:!1}function ZE(n){let e=0;return dg(n)||(e=Bi(n)*Ws(n)),e}function Bw(n){return[n[0],n[1]]}function Zw(n){return[n[2],n[1]]}function Gu(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function sY(n,e){let t;if(e==="bottom-left")t=Bw(n);else if(e==="bottom-right")t=Zw(n);else if(e==="top-left")t=nd(n);else if(e==="top-right")t=Ww(n);else throw new Error("Invalid corner");return t}function kv(n,e,t,i,r){const[o,s,l,u,h,d,m,y]=hD(n,e,t,i);return Gc(Math.min(o,l,h,m),Math.min(s,u,d,y),Math.max(o,l,h,m),Math.max(s,u,d,y),r)}function hD(n,e,t,i){const r=e*i[0]/2,o=e*i[1]/2,s=Math.cos(t),l=Math.sin(t),u=r*s,h=r*l,d=o*s,m=o*l,y=n[0],x=n[1];return[y-u+m,x-h-d,y-u-m,x-h+d,y+u-m,x+h+d,y+u+m,x+h-d,y-u+m,x-h-d]}function Ws(n){return n[3]-n[1]}function Ec(n,e,t){const i=t||el();return Zs(n,e)?(n[0]>e[0]?i[0]=n[0]:i[0]=e[0],n[1]>e[1]?i[1]=n[1]:i[1]=e[1],n[2]<e[2]?i[2]=n[2]:i[2]=e[2],n[3]<e[3]?i[3]=n[3]:i[3]=e[3]):By(i),i}function nd(n){return[n[0],n[3]]}function Ww(n){return[n[2],n[3]]}function Bi(n){return n[2]-n[0]}function Zs(n,e){return n[0]<=e[2]&&n[2]>=e[0]&&n[1]<=e[3]&&n[3]>=e[1]}function dg(n){return n[2]<n[0]||n[3]<n[1]}function oY(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n}function aY(n,e,t){let i=!1;const r=BE(n,e),o=BE(n,t);if(r===Co.INTERSECTING||o===Co.INTERSECTING)i=!0;else{const s=n[0],l=n[1],u=n[2],h=n[3],d=e[0],m=e[1],y=t[0],x=t[1],C=(x-m)/(y-d);let w,E;o&Co.ABOVE&&!(r&Co.ABOVE)&&(w=y-(x-h)/C,i=w>=s&&w<=u),!i&&o&Co.RIGHT&&!(r&Co.RIGHT)&&(E=x-(y-u)*C,i=E>=l&&E<=h),!i&&o&Co.BELOW&&!(r&Co.BELOW)&&(w=y-(x-l)/C,i=w>=s&&w<=u),!i&&o&Co.LEFT&&!(r&Co.LEFT)&&(E=x-(y-s)*C,i=E>=l&&E<=h)}return i}function lY(n,e,t,i){if(dg(n))return By(t);let r=[];if(i>1){const l=n[2]-n[0],u=n[3]-n[1];for(let h=0;h<i;++h)r.push(n[0]+l*h/i,n[1],n[2],n[1]+u*h/i,n[2]-l*h/i,n[3],n[0],n[3]-u*h/i)}else r=[n[0],n[1],n[2],n[1],n[2],n[3],n[0],n[3]];e(r,r,2);const o=[],s=[];for(let l=0,u=r.length;l<u;l+=2)o.push(r[l]),s.push(r[l+1]);return iY(o,s,t)}function dD(n,e){const t=e.getExtent(),i=Gu(n);if(e.canWrapX()&&(i[0]<t[0]||i[0]>=t[2])){const r=Bi(t),s=Math.floor((i[0]-t[0])/r)*r;n[0]-=s,n[2]-=s}return n}function fD(n,e,t){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[i[0],n[1],i[2],n[3]]];dD(n,e);const r=Bi(i);if(Bi(n)>r&&!t)return[[i[0],n[1],i[2],n[3]]];if(n[0]<i[0])return[[n[0]+r,n[1],i[2],n[3]],[i[0],n[1],n[2],n[3]]];if(n[2]>i[2])return[[n[0],n[1],i[2],n[3]],[i[0],n[1],n[2]-r,n[3]]]}return[n]}function Wr(n,e,t){return Math.min(Math.max(n,e),t)}function uY(n,e,t,i,r,o){const s=r-t,l=o-i;if(s!==0||l!==0){const u=((n-t)*s+(e-i)*l)/(s*s+l*l);u>1?(t=r,i=o):u>0&&(t+=s*u,i+=l*u)}return Gh(n,e,t,i)}function Gh(n,e,t,i){const r=t-n,o=i-e;return r*r+o*o}function cY(n){const e=n.length;for(let i=0;i<e;i++){let r=i,o=Math.abs(n[i][i]);for(let l=i+1;l<e;l++){const u=Math.abs(n[l][i]);u>o&&(o=u,r=l)}if(o===0)return null;const s=n[r];n[r]=n[i],n[i]=s;for(let l=i+1;l<e;l++){const u=-n[l][i]/n[i][i];for(let h=i;h<e+1;h++)i==h?n[l][h]=0:n[l][h]+=u*n[i][h]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=n[i][e]/n[i][i];for(let r=i-1;r>=0;r--)n[r][e]-=n[r][i]*t[i]}return t}function jh(n){return n*180/Math.PI}function aa(n){return n*Math.PI/180}function Fh(n,e){const t=n%e;return t*e<0?t+e:t}function yl(n,e,t){return n+t*(e-n)}function Zy(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}function PG(n,e){return Math.round(Zy(n,e))}function Vm(n,e){return Math.floor(Zy(n,e))}function Kd(n,e){return Math.ceil(Zy(n,e))}function WE(n,e,t){if(n>=e&&n<t)return n;const i=t-e;return((n-e)%i+i)%i+e}function Xd(n,e,t){const i=""+n;let r=i.indexOf(".");return r=r===-1?i.length:r,r>e?i:new Array(1+e-r).join("0")+i}function WR(n,e){const t=(""+n).split("."),i=(""+e).split(".");for(let r=0;r<Math.max(t.length,i.length);r++){const o=parseInt(t[r]||"0",10),s=parseInt(i[r]||"0",10);if(o>s)return 1;if(s>o)return-1}return 0}function hY(n,e){return n[0]+=+e[0],n[1]+=+e[1],n}function fb(n,e){const t=n[0],i=n[1],r=e[0],o=e[1],s=r[0],l=r[1],u=o[0],h=o[1],d=u-s,m=h-l,y=d===0&&m===0?0:(d*(t-s)+m*(i-l))/(d*d+m*m||0);let x,C;return y<=0?(x=s,C=l):y>=1?(x=u,C=h):(x=s+y*d,C=l+y*m),[x,C]}function u0(n,e,t){return n?e.replace("{x}",n[0].toFixed(t)).replace("{y}",n[1].toFixed(t)):""}function Jo(n,e){let t=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=e[i]){t=!1;break}return t}function zR(n,e){const t=Math.cos(e),i=Math.sin(e),r=n[0]*t-n[1]*i,o=n[1]*t+n[0]*i;return n[0]=r,n[1]=o,n}function dY(n,e){return n[0]*=e,n[1]*=e,n}function Oh(n,e){const t=n[0]-e[0],i=n[1]-e[1];return t*t+i*i}function Bm(n,e){return Math.sqrt(Oh(n,e))}function zE(n,e){return Oh(n,fb(n,e))}function zw(n,e){if(e.canWrapX()){const t=Bi(e.getExtent()),i=pD(n,e,t);i&&(n[0]-=i*t)}return n}function pD(n,e,t){const i=e.getExtent();let r=0;return e.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(t=t||Bi(i),r=Math.floor((n[0]-i[0])/t)),r}const Kp={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let Uw=class{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Kp[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const pb=6378137,Zm=Math.PI*pb,fY=[-Zm,-Zm,Zm,Zm],pY=[-180,-85,180,85],rx=pb*Math.log(Math.tan(Math.PI/2));class mm extends Uw{constructor(e){super({code:e,units:"m",extent:fY,global:!0,worldExtent:pY,getPointResolution:function(t,i){return t/Math.cosh(i[1]/pb)}})}}const GG=[new mm("EPSG:3857"),new mm("EPSG:102100"),new mm("EPSG:102113"),new mm("EPSG:900913"),new mm("http://www.opengis.net/def/crs/EPSG/0/3857"),new mm("http://www.opengis.net/gml/srs/epsg.xml#3857")];function gY(n,e,t,i){const r=n.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=n.slice():e=new Array(r));for(let o=0;o<r;o+=i){e[o]=Zm*n[o]/180;let s=pb*Math.log(Math.tan(Math.PI*(+n[o+1]+90)/360));s>rx?s=rx:s<-rx&&(s=-rx),e[o+1]=s}return e}function mY(n,e,t,i){const r=n.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=n.slice():e=new Array(r));for(let o=0;o<r;o+=i)e[o]=180*n[o]/Zm,e[o+1]=360*Math.atan(Math.exp(n[o+1]/pb))/Math.PI-90;return e}const yY=6378137,FG=[-180,-90,180,90],_Y=Math.PI*yY/180;class pp extends Uw{constructor(e,t){super({code:e,units:"degrees",extent:FG,axisOrientation:t,global:!0,metersPerUnit:_Y,worldExtent:FG})}}const OG=[new pp("CRS:84"),new pp("EPSG:4326","neu"),new pp("urn:ogc:def:crs:OGC:1.3:CRS84"),new pp("urn:ogc:def:crs:OGC:2:84"),new pp("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new pp("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new pp("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let UE={};function cI(n){return UE[n]||UE[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function vY(n,e){UE[n]=e}function Wy(n){for(const e in n)delete n[e]}function jp(n){let e;for(e in n)return!1;return!e}let oy={};function $p(n,e,t){const i=n.getCode(),r=e.getCode();i in oy||(oy[i]={}),oy[i][r]=t}function hI(n,e){return n in oy&&e in oy[n]?oy[n][e]:null}const rC=.9996,jl=.00669438,Xw=jl*jl,Yw=Xw*jl,kp=jl/(1-jl),NG=Math.sqrt(1-jl),Ey=(1-NG)/(1+NG),gD=Ey*Ey,UR=gD*Ey,XR=UR*Ey,mD=XR*Ey,yD=1-jl/4-3*Xw/64-5*Yw/256,bY=3*jl/8+3*Xw/32+45*Yw/1024,xY=15*Xw/256+45*Yw/1024,IY=35*Yw/3072,CY=3/2*Ey-27/32*UR+269/512*mD,wY=21/16*gD-55/32*XR,AY=151/96*UR-417/128*mD,SY=1097/512*XR,sC=6378137;function EY(n,e,t){const i=n-5e5,s=(t.north?e:e-1e7)/rC/(sC*yD),l=s+CY*Math.sin(2*s)+wY*Math.sin(4*s)+AY*Math.sin(6*s)+SY*Math.sin(8*s),u=Math.sin(l),h=u*u,d=Math.cos(l),m=u/d,y=m*m,x=y*y,C=1-jl*h,w=Math.sqrt(1-jl*h),E=sC/w,T=(1-jl)/C,k=kp*d**2,G=k*k,O=i/(E*rC),V=O*O,z=V*O,H=z*O,te=H*O,$=te*O,ae=l-m/T*(V/2-H/24*(5+3*y+10*k-4*G-9*kp))+$/720*(61+90*y+298*k+45*x-252*kp-3*G);let fe=(O-z/6*(1+2*y+k)+te/120*(5-2*k+28*y-3*G+8*kp+24*x))/d;return fe=WE(fe+aa(_D(t.number)),-Math.PI,Math.PI),[jh(fe),jh(ae)]}const DG=-80,VG=84,TY=-180,RY=180;function MY(n,e,t){n=WE(n,TY,RY),e<DG?e=DG:e>VG&&(e=VG);const i=aa(e),r=Math.sin(i),o=Math.cos(i),s=r/o,l=s*s,u=l*l,h=aa(n),d=_D(t.number),m=aa(d),y=sC/Math.sqrt(1-jl*r**2),x=kp*o**2,C=o*WE(h-m,-Math.PI,Math.PI),w=C*C,E=w*C,T=E*C,k=T*C,G=k*C,O=sC*(yD*i-bY*Math.sin(2*i)+xY*Math.sin(4*i)-IY*Math.sin(6*i)),V=rC*y*(C+E/6*(1-l+x)+k/120*(5-18*l+u+72*x-58*kp))+5e5;let z=rC*(O+y*s*(w/2+T/24*(5-l+9*x+4*x**2)+G/720*(61-58*l+u+600*x-330*kp)));return t.north||(z+=1e7),[V,z]}function _D(n){return(n-1)*6-180+3}const kY=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function vD(n){let e=0;for(const r of kY){const o=n.match(r);if(o){e=parseInt(o[1]);break}}if(!e)return null;let t=0,i=!1;return e>32700&&e<32761?t=e-32700:e>32600&&e<32661&&(i=!0,t=e-32600),t?{number:t,north:i}:null}function BG(n,e){return function(t,i,r,o){const s=t.length;r=r>1?r:2,o=o??r,i||(r>2?i=t.slice():i=new Array(s));for(let l=0;l<s;l+=o){const u=t[l],h=t[l+1],d=n(u,h,e);i[l]=d[0],i[l+1]=d[1]}return i}}function LY(n){return vD(n)?new Uw({code:n,units:"m"}):null}function PY(n){const e=vD(n.getCode());return e?{forward:BG(MY,e),inverse:BG(EY,e)}:null}const YR=63710088e-1;function oC(n,e,t){t=t||YR;const i=aa(n[1]),r=aa(e[1]),o=(r-i)/2,s=aa(e[0]-n[0])/2,l=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(i)*Math.cos(r);return 2*t*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}function sx(n,e){let t=0;const i=n.length;let r=n[i-1][0],o=n[i-1][1];for(let s=0;s<i;s++){const l=n[s][0],u=n[s][1];t+=aa(l-r)*(2+Math.sin(aa(o))+Math.sin(aa(u))),r=l,o=u}return t*e*e/2}function bD(n,e){e=e||{};const t=e.radius||YR,i=e.projection||"EPSG:3857",r=n.getType();r!=="GeometryCollection"&&(n=n.clone().transform(i,"EPSG:4326"));let o=0,s,l,u,h,d,m;switch(r){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":{for(s=n.getCoordinates(),o=Math.abs(sx(s[0],t)),u=1,h=s.length;u<h;++u)o-=Math.abs(sx(s[u],t));break}case"MultiPolygon":{for(s=n.getCoordinates(),u=0,h=s.length;u<h;++u)for(l=s[u],o+=Math.abs(sx(l[0],t)),d=1,m=l.length;d<m;++d)o-=Math.abs(sx(l[d],t));break}case"GeometryCollection":{const y=n.getGeometries();for(u=0,h=y.length;u<h;++u)o+=bD(y[u],e);break}default:throw new Error("Unsupported geometry type: "+r)}return o}function GY(n,e,t,i){i=i||YR;const r=aa(n[1]),o=aa(n[0]),s=e/i,l=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(t)),u=o+Math.atan2(Math.sin(t)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(l));return[jh(u),jh(l)]}const FY=[PY],OY=[LY];let XE=!0;function NY(n){XE=!1}function HR(n,e){if(e!==void 0){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];e=e}else e=n.slice();return e}function xD(n,e){if(e!==void 0&&n!==e){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];n=e}return n}function aC(n){vY(n.getCode(),n),$p(n,n,HR)}function DY(n){n.forEach(aC)}function Ni(n){if(typeof n!="string")return n;const e=cI(n);if(e)return e;for(const t of OY){const i=t(n);if(i)return i}return null}function Lv(n,e,t,i){n=Ni(n);let r;const o=n.getPointResolutionFunc();if(o){if(r=o(e,t),i&&i!==n.getUnits()){const s=n.getMetersPerUnit();s&&(r=r*s/Kp[i])}}else{const s=n.getUnits();if(s=="degrees"&&!i||i=="degrees")r=e;else{const l=zy(n,Ni("EPSG:4326"));if(!l&&s!=="degrees")r=e*n.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=l(h,h,2);const d=oC(h.slice(0,2),h.slice(2,4)),m=oC(h.slice(4,6),h.slice(6,8));r=(d+m)/2}const u=i?Kp[i]:n.getMetersPerUnit();u!==void 0&&(r/=u)}}return r}function YE(n){DY(n),n.forEach(function(e){n.forEach(function(t){e!==t&&$p(e,t,HR)})})}function VY(n,e,t,i){n.forEach(function(r){e.forEach(function(o){$p(r,o,t),$p(o,r,i)})})}function KR(n,e){return n?typeof n=="string"?Ni(n):n:Ni(e)}function HE(n){return(function(e,t,i,r){const o=e.length;i=i!==void 0?i:2,r=r??i,t=t!==void 0?t:new Array(o);for(let s=0;s<o;s+=r){const l=n(e.slice(s,s+i)),u=l.length;for(let h=0,d=r;h<d;++h)t[s+h]=h>=u?e[s+h]:l[h]}return t})}function BY(n,e,t,i){const r=Ni(n),o=Ni(e);$p(r,o,HE(t)),$p(o,r,HE(i))}function bc(n,e){const t=Ir(n,e!==void 0?e:"EPSG:3857","EPSG:4326"),i=t[0];return(i<-180||i>180)&&(t[0]=Fh(i+180,360)-180),t}function Nh(n,e){if(n===e)return!0;const t=n.getUnits()===e.getUnits();return(n.getCode()===e.getCode()||zy(n,e)===HR)&&t}function zy(n,e){const t=n.getCode(),i=e.getCode();let r=hI(t,i);if(r)return r;let o=null,s=null;for(const u of FY)o||(o=u(n)),s||(s=u(e));if(!o&&!s)return null;const l="EPSG:4326";if(s)if(o)r=W2(o.inverse,s.forward);else{const u=hI(t,l);u&&(r=W2(u,s.forward))}else{const u=hI(l,i);u&&(r=W2(o.inverse,u))}return r&&(aC(n),aC(e),$p(n,e,r)),r}function W2(n,e){return function(t,i,r,o){return i=n(t,i,r,o),e(i,i,r,o)}}function pf(n,e){const t=Ni(n),i=Ni(e);return zy(t,i)}function Ir(n,e,t){const i=pf(e,t);if(!i){const r=Ni(e).getCode(),o=Ni(t).getCode();throw new Error(`No transform available between ${r} and ${o}`)}return i(n,void 0,n.length)}function gb(n,e,t,i){const r=pf(e,t);return lY(n,r,void 0,i)}let ZY=null;function WY(){return ZY}function Jp(n,e){return n}function fs(n,e){return XE&&!Jo(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(XE=!1,lD("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function Hw(n,e){return n}function Xl(n,e){return n}function ZG(n,e,t){return function(i){let r,o;if(n.canWrapX()){const s=n.getExtent(),l=Bi(s);i=i.slice(0),o=pD(i,n,l),o&&(i[0]=i[0]-o*l),i[0]=Wr(i[0],s[0],s[2]),i[1]=Wr(i[1],s[1],s[3]),r=t(i)}else r=t(i);return o&&e.canWrapX()&&(r[0]+=o*Bi(e.getExtent())),r}}function zY(){YE(GG),YE(OG),VY(OG,GG,gY,mY)}zY();const eo={ADD:"add",REMOVE:"remove"},qp={PROPERTYCHANGE:"propertychange"},Qn={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Kw{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function UY(n,e,t){let i,r;t=t||Tc;let o=0,s=n.length,l=!1;for(;o<s;)i=o+(s-o>>1),r=+t(n[i],e),r<0?o=i+1:(s=i,l=!r);return l?o:~o}function Tc(n,e){return n>e?1:n<e?-1:0}function XY(n,e){return n<e?1:n>e?-1:0}function jw(n,e,t){if(n[0]<=e)return 0;const i=n.length;if(e<=n[i-1])return i-1;if(typeof t=="function"){for(let r=1;r<i;++r){const o=n[r];if(o===e)return r;if(o<e)return t(e,n[r-1],o)>0?r-1:r}return i-1}if(t>0){for(let r=1;r<i;++r)if(n[r]<e)return r-1;return i-1}if(t<0){for(let r=1;r<i;++r)if(n[r]<=e)return r;return i-1}for(let r=1;r<i;++r){if(n[r]==e)return r;if(n[r]<e)return n[r-1]-e<e-n[r]?r-1:r}return i-1}function YY(n,e,t){for(;e<t;){const i=n[e];n[e]=n[t],n[t]=i,++e,--t}}function nr(n,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let r=0;r<i;r++)n[n.length]=t[r]}function id(n,e){const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function HY(n,e,t){const i=e||Tc;return n.every(function(r,o){if(o===0)return!0;const s=i(n[o-1],r);return!(s>0||s===0)})}function gf(){return!0}function Uy(){return!1}function Pv(){}function ID(n){let e,t,i;return function(){const r=Array.prototype.slice.call(arguments);return(!t||this!==i||!id(r,t))&&(i=this,t=r,e=n.apply(this,arguments)),e}}function CD(n){function e(){let t;try{t=n()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}class Vo{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class mb extends Kw{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),r=i[e]||(i[e]=[]);r.includes(t)||r.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const o=t?new Vo(e):e;o.target||(o.target=this.eventTarget_||this);const s=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});i in s||(s[i]=0,l[i]=0),++s[i];let u;for(let h=0,d=r.length;h<d;++h)if("handleEvent"in r[h]?u=r[h].handleEvent(o):u=r[h].call(this,o),u===!1||o.propagationStopped){u=!1;break}if(--s[i]===0){let h=l[i];for(delete l[i];h--;)this.removeEventListener(i,Pv);delete s[i]}return u}disposeInternal(){this.listeners_&&Wy(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const i=this.listeners_[e];if(!i)return;const r=i.indexOf(t);r!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[r]=Pv,++this.pendingRemovals_[e]):(i.splice(r,1),i.length===0&&delete this.listeners_[e]))}}function mn(n,e,t,i,r){if(r){const s=t;t=function(l){return n.removeEventListener(e,t),s.call(i??this,l)}}else i&&i!==n&&(t=t.bind(i));const o={target:n,type:e,listener:t};return n.addEventListener(e,t),o}function lC(n,e,t,i){return mn(n,e,t,i,!0)}function mr(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),Wy(n))}class yb extends mb{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Qn.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,r=new Array(i);for(let o=0;o<i;++o)r[o]=mn(this,e[o],t);return r}return mn(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const r=e.length;i=new Array(r);for(let o=0;o<r;++o)i[o]=lC(this,e[o],t)}else i=lC(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)vl(i);else if(Array.isArray(e))for(let r=0,o=e.length;r<o;++r)this.removeEventListener(e[r],t);else this.removeEventListener(e,t)}}yb.prototype.on;yb.prototype.once;yb.prototype.un;function vl(n){if(Array.isArray(n))for(let e=0,t=n.length;e<t;++e)mr(n[e]);else mr(n)}function Zn(){throw new Error("Unimplemented abstract method.")}let KY=0;function Yn(n){return n.ol_uid||(n.ol_uid=String(++KY))}const SPe="10.7.0";class WG extends Vo{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class nu extends yb{constructor(e){super(),this.on,this.once,this.un,Yn(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new WG(i,e,t)),i=qp.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new WG(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const r=this.values_||(this.values_={});if(i)r[e]=t;else{const o=r[e];r[e]=t,o!==t&&this.notify(e,o)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],jp(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}const zG={LENGTH:"length"};class ox extends Vo{constructor(e,t,i){super(e),this.element=t,this.index=i}}class Ts extends nu{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e??[],this.unique_)for(let i=1,r=this.array_.length;i<r;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,r=t.length;i<r;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(zG.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new ox(eo.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,r=t.length;i<r;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new ox(eo.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const r=this.array_[e];this.array_[e]=t,this.dispatchEvent(new ox(eo.REMOVE,r,e)),this.dispatchEvent(new ox(eo.ADD,t,e))}updateLength_(){this.set(zG.LENGTH,this.array_.length)}assertUnique_(e,t){const i=this.array_;for(let r=0,o=i.length;r<o;++r)if(i[r]===e&&r!==t)throw new Error("Duplicate item added to a unique collection")}}class km extends Vo{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class gc extends km{constructor(e,t,i,r,o,s){super(e,t,o),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=s}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Vi={SINGLECLICK:"singleclick",CLICK:Qn.CLICK,DBLCLICK:Qn.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Qp=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",jY=Qp.includes("safari")&&!Qp.includes("chrom");jY&&(Qp.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Qp));const $Y=Qp.includes("webkit")&&!Qp.includes("edge"),jR=Qp.includes("macintosh"),wD=typeof devicePixelRatio<"u"?devicePixelRatio:1,Cl=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,$R=typeof Image<"u"&&Image.prototype.decode,AD=typeof createImageBitmap=="function",SD=(function(){let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return n})(),Gv={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTEROUT:"pointerout"};class JY extends mb{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=mn(i,Gv.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=mn(i,Gv.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Qn.TOUCHMOVE,this.boundHandleTouchMove_,SD?{passive:!1}:!1)}emulateClick_(e){let t=new gc(Vi.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new gc(Vi.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new gc(Vi.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==Vi.POINTERUP||t.type==Vi.POINTERCANCEL){delete this.trackedTouches_[i];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==t.target){delete this.trackedTouches_[r];break}}else(t.type==Vi.POINTERDOWN||t.type==Vi.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new gc(Vi.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(mr),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new gc(Vi.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(mn(i,Vi.POINTERMOVE,this.handlePointerMove_,this),mn(i,Vi.POINTERUP,this.handlePointerUp_,this),mn(this.element_,Vi.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(mn(this.element_.getRootNode(),Vi.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new gc(Vi.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new gc(Vi.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(mr(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Qn.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(mr(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(mr),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const wh={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},xo={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Vn={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function gr(n,e){if(!n)throw new Error(e)}const uC=1/0;class qY{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Wy(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(i);return delete this.queuedElements_[r],i}enqueue(e){gr(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=uC?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,r=t.length,o=t[e],s=i[e],l=e;for(;e<r>>1;){const u=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),d=h<r&&i[h]<i[u]?h:u;t[e]=t[d],i[e]=i[d],e=d}t[e]=o,i[e]=s,this.siftDown_(l,e)}siftDown_(e,t){const i=this.elements_,r=this.priorities_,o=i[t],s=r[t];for(;t>e;){const l=this.getParentIndex_(t);if(r[l]>s)i[t]=i[l],r[t]=r[l],t=l;else break}i[t]=o,r[t]=s}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let r=0;const o=t.length;let s,l,u;for(l=0;l<o;++l)s=t[l],u=e(s),u==uC?delete this.queuedElements_[this.keyFunction_(s)]:(i[r]=u,t[r++]=s);t.length=r,i.length=r,this.heapify_()}}class QY extends qY{constructor(e,t){super(i=>e.apply(null,i),i=>i[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(Qn.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===Vn.LOADED||i===Vn.ERROR||i===Vn.EMPTY){i!==Vn.ERROR&&t.removeEventListener(Qn.CHANGE,this.boundHandleTileChange_);const r=t.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;){const r=this.dequeue()[0],o=r.getKey();r.getState()===Vn.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,r.load())}}}function eH(n,e,t,i,r){if(!n||!(t in n.wantedTiles)||!n.wantedTiles[t][e.getKey()])return uC;const o=n.viewState.center,s=i[0]-o[0],l=i[1]-o[1];return 65536*Math.log(r)+Math.sqrt(s*s+l*l)/r}const Jr={ANIMATING:0,INTERACTING:1},fu={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function UG(n,e,t){return(function(i,r,o,s,l){if(!i)return;if(!r&&!e)return i;const u=e?0:o[0]*r,h=e?0:o[1]*r,d=l?l[0]:0,m=l?l[1]:0;let y=n[0]+u/2+d,x=n[2]-u/2+d,C=n[1]+h/2+m,w=n[3]-h/2+m;y>x&&(y=(x+y)/2,x=y),C>w&&(C=(w+C)/2,w=C);let E=Wr(i[0],y,x),T=Wr(i[1],C,w);if(s&&t&&r){const k=30*r;E+=-k*Math.log(1+Math.max(0,y-i[0])/k)+k*Math.log(1+Math.max(0,i[0]-x)/k),T+=-k*Math.log(1+Math.max(0,C-i[1])/k)+k*Math.log(1+Math.max(0,i[1]-w)/k)}return[E,T]})}function tH(n){return n}function ED(n){return Math.pow(n,3)}function Xy(n){return 1-ED(1-n)}function nH(n){return 3*n*n-2*n*n*n}function iH(n){return n}const TD=new Array(6);function qa(){return[1,0,0,1,0,0]}function XG(n){return qR(n,1,0,0,1,0,0)}function JR(n,e){const t=n[0],i=n[1],r=n[2],o=n[3],s=n[4],l=n[5],u=e[0],h=e[1],d=e[2],m=e[3],y=e[4],x=e[5];return n[0]=t*u+r*h,n[1]=i*u+o*h,n[2]=t*d+r*m,n[3]=i*d+o*m,n[4]=t*y+r*x+s,n[5]=i*y+o*x+l,n}function qR(n,e,t,i,r,o,s){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n[4]=o,n[5]=s,n}function rH(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n}function Vs(n,e){const t=e[0],i=e[1];return e[0]=n[0]*t+n[2]*i+n[4],e[1]=n[1]*t+n[3]*i+n[5],e}function dI(n,e,t){return JR(n,qR(TD,e,0,0,t,0,0))}function sH(n,e,t){return JR(n,qR(TD,1,0,0,1,e,t))}function Fu(n,e,t,i,r,o,s,l){const u=Math.sin(o),h=Math.cos(o);return n[0]=i*h,n[1]=r*u,n[2]=-i*u,n[3]=r*h,n[4]=s*i*h-l*i*u+e,n[5]=s*r*u+l*r*h+t,n}function RD(n,e){const t=oH(e);gr(t!==0,"Transformation matrix cannot be inverted");const i=e[0],r=e[1],o=e[2],s=e[3],l=e[4],u=e[5];return n[0]=s/t,n[1]=-r/t,n[2]=-o/t,n[3]=i/t,n[4]=(o*u-s*l)/t,n[5]=-(i*u-r*l)/t,n}function oH(n){return n[0]*n[3]-n[1]*n[2]}const aH=[1e5,1e5,1e5,1e5,2,2];function lH(n){return"matrix("+n.join(", ")+")"}function KE(n){return n.substring(7,n.length-1).split(",").map(parseFloat)}function uH(n,e){const t=KE(n),i=KE(e);for(let r=0;r<6;++r)if(Math.round((t[r]-i[r])*aH[r])!==0)return!1;return!0}function Dh(n,e,t,i,r,o,s){o=o||[],s=s||2;let l=0;for(let u=e;u<t;u+=i){const h=n[u],d=n[u+1];o[l++]=r[0]*h+r[2]*d+r[4],o[l++]=r[1]*h+r[3]*d+r[5];for(let m=2;m<s;m++)o[l++]=n[u+m]}return o&&o.length!=l&&(o.length=l),o}function QR(n,e,t,i,r,o,s){s=s||[];const l=Math.cos(r),u=Math.sin(r),h=o[0],d=o[1];let m=0;for(let y=e;y<t;y+=i){const x=n[y]-h,C=n[y+1]-d;s[m++]=h+x*l-C*u,s[m++]=d+x*u+C*l;for(let w=y+2;w<y+i;++w)s[m++]=n[w]}return s&&s.length!=m&&(s.length=m),s}function cH(n,e,t,i,r,o,s,l){l=l||[];const u=s[0],h=s[1];let d=0;for(let m=e;m<t;m+=i){const y=n[m]-u,x=n[m+1]-h;l[d++]=u+r*y,l[d++]=h+o*x;for(let C=m+2;C<m+i;++C)l[d++]=n[C]}return l&&l.length!=d&&(l.length=d),l}function hH(n,e,t,i,r,o,s){s=s||[];let l=0;for(let u=e;u<t;u+=i){s[l++]=n[u]+r,s[l++]=n[u+1]+o;for(let h=u+2;h<u+i;++h)s[l++]=n[h]}return s&&s.length!=l&&(s.length=l),s}const YG=qa(),dH=[NaN,NaN];class MD extends nu{constructor(){super(),this.extent_=el(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=ID((e,t,i)=>{if(!i)return this.getSimplifiedGeometry(t);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return Zn()}closestPointXY(e,t,i,r){return Zn()}containsXY(e,t){return this.closestPointXY(e,t,dH,Number.MIN_VALUE)===0}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return Zn()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&By(t),this.extentRevision_=this.getRevision()}return oY(this.extent_,e)}rotate(e,t){Zn()}scale(e,t,i){Zn()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return Zn()}getType(){return Zn()}applyTransform(e){Zn()}intersectsExtent(e){return Zn()}translate(e,t){Zn()}transform(e,t){const i=Ni(e),r=i.getUnits()=="tile-pixels"?function(o,s,l){const u=i.getExtent(),h=i.getWorldExtent(),d=Ws(h)/Ws(u);Fu(YG,h[0],h[3],d,-d,0,0,0);const m=Dh(o,0,o.length,l,YG,s),y=pf(i,t);return y?y(m,m,l):m}:pf(i,t);return this.applyTransform(r),this}}class wf extends MD{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return BR(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return Zn()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=cC(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){Zn()}setLayout(e,t,i){let r;if(e)r=cC(e);else{for(let o=0;o<i;++o){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}r=t.length,e=fg(r)}this.layout=e,this.stride=r}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();QR(i,0,i.length,r,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=Gu(this.getExtent()));const r=this.getFlatCoordinates();if(r){const o=this.getStride();cH(r,0,r.length,o,e,t,i,r),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();hH(i,0,i.length,r,e,t,i),this.changed()}}}function fg(n){let e;return n==2?e="XY":n==3?e="XYZ":n==4&&(e="XYZM"),e}function cC(n){let e;return n=="XY"?e=2:n=="XYZ"||n=="XYM"?e=3:n=="XYZM"&&(e=4),e}function fH(n,e,t){const i=n.getFlatCoordinates();if(!i)return null;const r=n.getStride();return Dh(i,0,i.length,r,e,t)}function kD(n,e,t,i){let r=0;const o=n[t-i],s=n[t-i+1];let l=0,u=0;for(;e<t;e+=i){const h=n[e]-o,d=n[e+1]-s;r+=u*h-l*d,l=h,u=d}return r/2}function LD(n,e,t,i){let r=0;for(let o=0,s=t.length;o<s;++o){const l=t[o];r+=kD(n,e,l,i),e=l}return r}function pH(n,e,t,i){let r=0;for(let o=0,s=t.length;o<s;++o){const l=t[o];r+=LD(n,e,l,i),e=l[l.length-1]}return r}function HG(n,e,t,i,r,o,s){const l=n[e],u=n[e+1],h=n[t]-l,d=n[t+1]-u;let m;if(h===0&&d===0)m=e;else{const y=((r-l)*h+(o-u)*d)/(h*h+d*d);if(y>1)m=t;else if(y>0){for(let x=0;x<i;++x)s[x]=yl(n[e+x],n[t+x],y);s.length=i;return}else m=e}for(let y=0;y<i;++y)s[y]=n[m+y];s.length=i}function eM(n,e,t,i,r){let o=n[e],s=n[e+1];for(e+=i;e<t;e+=i){const l=n[e],u=n[e+1],h=Gh(o,s,l,u);h>r&&(r=h),o=l,s=u}return r}function tM(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o){const l=t[o];r=eM(n,e,l,i,r),e=l}return r}function gH(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o){const l=t[o];r=tM(n,e,l,i,r),e=l[l.length-1]}return r}function nM(n,e,t,i,r,o,s,l,u,h,d){if(e==t)return h;let m,y;if(r===0){if(y=Gh(s,l,n[e],n[e+1]),y<h){for(m=0;m<i;++m)u[m]=n[e+m];return u.length=i,y}return h}d=d||[NaN,NaN];let x=e+i;for(;x<t;)if(HG(n,x-i,x,i,s,l,d),y=Gh(s,l,d[0],d[1]),y<h){for(h=y,m=0;m<i;++m)u[m]=d[m];u.length=i,x+=i}else x+=i*Math.max((Math.sqrt(y)-Math.sqrt(h))/r|0,1);if(o&&(HG(n,t-i,e,i,s,l,d),y=Gh(s,l,d[0],d[1]),y<h)){for(h=y,m=0;m<i;++m)u[m]=d[m];u.length=i}return h}function iM(n,e,t,i,r,o,s,l,u,h,d){d=d||[NaN,NaN];for(let m=0,y=t.length;m<y;++m){const x=t[m];h=nM(n,e,x,i,r,o,s,l,u,h,d),e=x}return h}function mH(n,e,t,i,r,o,s,l,u,h,d){d=d||[NaN,NaN];for(let m=0,y=t.length;m<y;++m){const x=t[m];h=iM(n,e,x,i,r,o,s,l,u,h,d),e=x[x.length-1]}return h}function PD(n,e,t,i){for(let r=0,o=t.length;r<o;++r)n[e++]=t[r];return e}function $w(n,e,t,i){for(let r=0,o=t.length;r<o;++r){const s=t[r];for(let l=0;l<i;++l)n[e++]=s[l]}return e}function _b(n,e,t,i,r){r=r||[];let o=0;for(let s=0,l=t.length;s<l;++s){const u=$w(n,e,t[s],i);r[o++]=u,e=u}return r.length=o,r}function GD(n,e,t,i,r){r=r||[];let o=0;for(let s=0,l=t.length;s<l;++s){const u=_b(n,e,t[s],i,r[o]);u.length===0&&(u[0]=e),r[o++]=u,e=u[u.length-1]}return r.length=o,r}function jd(n,e,t,i,r){r=r!==void 0?r:[];let o=0;for(let s=e;s<t;s+=i)r[o++]=n.slice(s,s+i);return r.length=o,r}function Fv(n,e,t,i,r){r=r!==void 0?r:[];let o=0;for(let s=0,l=t.length;s<l;++s){const u=t[s];r[o++]=jd(n,e,u,i,r[o]),e=u}return r.length=o,r}function jE(n,e,t,i,r){r=r!==void 0?r:[];let o=0;for(let s=0,l=t.length;s<l;++s){const u=t[s];r[o++]=u.length===1&&u[0]===e?[]:Fv(n,e,u,i,r[o]),e=u[u.length-1]}return r.length=o,r}function Jw(n,e,t,i,r,o,s){const l=(t-e)/i;if(l<3){for(;e<t;e+=i)o[s++]=n[e],o[s++]=n[e+1];return s}const u=new Array(l);u[0]=1,u[l-1]=1;const h=[e,t-i];let d=0;for(;h.length>0;){const m=h.pop(),y=h.pop();let x=0;const C=n[y],w=n[y+1],E=n[m],T=n[m+1];for(let k=y+i;k<m;k+=i){const G=n[k],O=n[k+1],V=uY(G,O,C,w,E,T);V>x&&(d=k,x=V)}x>r&&(u[(d-e)/i]=1,y+i<d&&h.push(y,d),d+i<m&&h.push(d,m))}for(let m=0;m<l;++m)u[m]&&(o[s++]=n[e+m*i],o[s++]=n[e+m*i+1]);return s}function FD(n,e,t,i,r,o,s,l){for(let u=0,h=t.length;u<h;++u){const d=t[u];s=Jw(n,e,d,i,r,o,s),l.push(s),e=d}return s}function Cp(n,e){return e*Math.round(n/e)}function yH(n,e,t,i,r,o,s){if(e==t)return s;let l=Cp(n[e],r),u=Cp(n[e+1],r);e+=i,o[s++]=l,o[s++]=u;let h,d;do if(h=Cp(n[e],r),d=Cp(n[e+1],r),e+=i,e==t)return o[s++]=h,o[s++]=d,s;while(h==l&&d==u);for(;e<t;){const m=Cp(n[e],r),y=Cp(n[e+1],r);if(e+=i,m==h&&y==d)continue;const x=h-l,C=d-u,w=m-l,E=y-u;if(x*E==C*w&&(x<0&&w<x||x==w||x>0&&w>x)&&(C<0&&E<C||C==E||C>0&&E>C)){h=m,d=y;continue}o[s++]=h,o[s++]=d,l=h,u=d,h=m,d=y}return o[s++]=h,o[s++]=d,s}function rM(n,e,t,i,r,o,s,l){for(let u=0,h=t.length;u<h;++u){const d=t[u];s=yH(n,e,d,i,r,o,s),l.push(s),e=d}return s}function _H(n,e,t,i,r,o,s,l){for(let u=0,h=t.length;u<h;++u){const d=t[u],m=[];s=rM(n,e,d,i,r,o,s,m),l.push(m),e=d[d.length-1]}return s}class Ov extends wf{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new Ov(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,r){return r<hg(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(eM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),nM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,r))}getArea(){return kD(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return jd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=Jw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Ov(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=$w(this.flatCoordinates,0,e,this.stride),this.changed()}}let zi=class OD extends wf{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new OD(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){const o=this.flatCoordinates,s=Gh(e,t,o[0],o[1]);if(s<r){const l=this.stride;for(let u=0;u<l;++u)i[u]=o[u];return i.length=l,s}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return sy(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return VR(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=PD(this.flatCoordinates,0,e,this.stride),this.changed()}};function vH(n,e,t,i,r){return!ZR(r,function(s){return!Lp(n,e,t,i,s[0],s[1])})}function Lp(n,e,t,i,r,o){let s=0,l=n[t-i],u=n[t-i+1];for(;e<t;e+=i){const h=n[e],d=n[e+1];u<=o?d>o&&(h-l)*(o-u)-(r-l)*(d-u)>0&&s++:d<=o&&(h-l)*(o-u)-(r-l)*(d-u)<0&&s--,l=h,u=d}return s!==0}function sM(n,e,t,i,r,o){if(t.length===0||!Lp(n,e,t[0],i,r,o))return!1;for(let s=1,l=t.length;s<l;++s)if(Lp(n,t[s-1],t[s],i,r,o))return!1;return!0}function bH(n,e,t,i,r,o){if(t.length===0)return!1;for(let s=0,l=t.length;s<l;++s){const u=t[s];if(sM(n,e,u,i,r,o))return!0;e=u[u.length-1]}return!1}function oM(n,e,t,i,r,o,s){let l,u,h,d,m,y,x;const C=r[o+1],w=[];for(let k=0,G=t.length;k<G;++k){const O=t[k];for(d=n[O-i],y=n[O-i+1],l=e;l<O;l+=i)m=n[l],x=n[l+1],(C<=y&&x<=C||y<=C&&C<=x)&&(h=(C-y)/(x-y)*(m-d)+d,w.push(h)),d=m,y=x}let E=NaN,T=-1/0;for(w.sort(Tc),d=w[0],l=1,u=w.length;l<u;++l){m=w[l];const k=Math.abs(m-d);k>T&&(h=(d+m)/2,sM(n,e,t,i,h,C)&&(E=h,T=k)),d=m}return isNaN(E)&&(E=r[o]),s?(s.push(E,C,T),s):[E,C,T]}function ND(n,e,t,i,r){let o=[];for(let s=0,l=t.length;s<l;++s){const u=t[s];o=oM(n,e,u,i,r,2*s,o),e=u[u.length-1]}return o}function DD(n,e,t,i,r){let o;for(e+=i;e<t;e+=i)if(o=r(n.slice(e-i,e),n.slice(e,e+i)),o)return o;return!1}function qw(n,e,t,i,r,o){return o=o??cD(el(),n,e,t,i),Zs(r,o)?o[0]>=r[0]&&o[2]<=r[2]||o[1]>=r[1]&&o[3]<=r[3]?!0:DD(n,e,t,i,function(s,l){return aY(r,s,l)}):!1}function xH(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o){if(qw(n,e,t[o],i,r))return!0;e=t[o]}return!1}function VD(n,e,t,i,r){return!!(qw(n,e,t,i,r)||Lp(n,e,t,i,r[0],r[1])||Lp(n,e,t,i,r[0],r[3])||Lp(n,e,t,i,r[2],r[1])||Lp(n,e,t,i,r[2],r[3]))}function BD(n,e,t,i,r){if(!VD(n,e,t[0],i,r))return!1;if(t.length===1)return!0;for(let o=1,s=t.length;o<s;++o)if(vH(n,t[o-1],t[o],i,r)&&!qw(n,t[o-1],t[o],i,r))return!1;return!0}function IH(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o){const l=t[o];if(BD(n,e,l,i,r))return!0;e=l[l.length-1]}return!1}function CH(n,e,t,i){for(;e<t-i;){for(let r=0;r<i;++r){const o=n[e+r];n[e+r]=n[t-i+r],n[t-i+r]=o}e+=i,t-=i}}function aM(n,e,t,i){let r=0,o=n[t-i],s=n[t-i+1];for(;e<t;e+=i){const l=n[e],u=n[e+1];r+=(l-o)*(u+s),o=l,s=u}return r===0?void 0:r>0}function lM(n,e,t,i,r){r=r!==void 0?r:!1;for(let o=0,s=t.length;o<s;++o){const l=t[o],u=aM(n,e,l,i);if(o===0){if(r&&u||!r&&!u)return!1}else if(r&&!u||!r&&u)return!1;e=l}return!0}function ZD(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o){const l=t[o];if(!lM(n,e,l,i,r))return!1;l.length&&(e=l[l.length-1])}return!0}function hC(n,e,t,i,r){r=r!==void 0?r:!1;for(let o=0,s=t.length;o<s;++o){const l=t[o],u=aM(n,e,l,i);(o===0?r&&u||!r&&!u:r&&!u||!r&&u)&&CH(n,e,l,i),e=l}return e}function $E(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o)e=hC(n,e,t[o],i,r);return e}function wH(n,e){const t=[];let i=0,r=0,o;for(let s=0,l=e.length;s<l;++s){const u=e[s],h=aM(n,i,u,2);if(o===void 0&&(o=h),h===o)t.push(e.slice(r,s+1));else{if(t.length===0)continue;t[t.length-1].push(e[r])}r=s+1,i=u}return t}class Bo extends wf{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?nr(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Bo(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<hg(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(tM(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),iM(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,r))}containsXY(e,t){return sM(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return LD(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),hC(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Fv(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Gu(this.getExtent());this.flatInteriorPoint_=oM(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new zi(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Ov(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,r=[];let o=0;for(let s=0,l=i.length;s<l;++s){const u=i[s],h=new Ov(t.slice(o,u),e);r.push(h),o=u}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;lM(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=hC(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=rM(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new Bo(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return BD(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=_b(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function AH(n,e,t,i){t=t||32;const r=[];for(let o=0;o<t;++o)nr(r,GY(n,e,2*Math.PI*o/t,i));return r.push(r[0],r[1]),new Bo(r,"XY",[r.length])}function JE(n){if(dg(n))throw new Error("Cannot create polygon from empty extent");const e=n[0],t=n[1],i=n[2],r=n[3],o=[e,t,e,r,i,r,i,t,e,t];return new Bo(o,"XY",[o.length])}function WD(n,e,t){e=e||32;const i=n.getStride(),r=n.getLayout(),o=n.getCenter(),s=i*(e+1),l=new Array(s);for(let d=0;d<s;d+=i){l[d]=0,l[d+1]=0;for(let m=2;m<i;m++)l[d+m]=o[m]}const u=[l.length],h=new Bo(l,r,u);return SH(h,o,n.getRadius()),h}function SH(n,e,t,i){const r=n.getFlatCoordinates(),o=n.getStride(),s=r.length/o-1,l=0;for(let u=0;u<=s;++u){const h=u*o,d=l+Fh(u,s)*2*Math.PI/s;r[h]=e[0]+t*Math.cos(d),r[h+1]=e[1]+t*Math.sin(d)}n.changed()}function uM(n,e,t,i){const r=Bi(e)/t[0],o=Ws(e)/t[1];return i?Math.min(n,Math.max(r,o)):Math.min(n,Math.min(r,o))}function cM(n,e,t){let i=Math.min(n,e);const r=50;return i*=Math.log(1+r*Math.max(0,n/e-1))/r+1,t&&(i=Math.max(i,t),i/=Math.log(1+r*Math.max(0,t/n-1))/r+1),Wr(i,t/2,e*2)}function EH(n,e,t,i){return e=e!==void 0?e:!0,(function(r,o,s,l){if(r!==void 0){const u=n[0],h=n[n.length-1],d=t?uM(u,t,s,i):u;if(l)return e?cM(r,d,h):Wr(r,h,d);const m=Math.min(d,r),y=Math.floor(jw(n,m,o));return n[y]>d&&y<n.length-1?n[y+1]:n[y]}})}function TH(n,e,t,i,r,o){return i=i!==void 0?i:!0,t=t!==void 0?t:0,(function(s,l,u,h){if(s!==void 0){const d=r?uM(e,r,u,o):e;if(h)return i?cM(s,d,t):Wr(s,t,d);const m=1e-9,y=Math.ceil(Math.log(e/d)/Math.log(n)-m),x=-l*(.5-m)+.5,C=Math.min(d,s),w=Math.floor(Math.log(e/C)/Math.log(n)+x),E=Math.max(y,w),T=e/Math.pow(n,E);return Wr(T,t,d)}})}function KG(n,e,t,i,r){return t=t!==void 0?t:!0,(function(o,s,l,u){if(o!==void 0){const h=i?uM(n,i,l,r):n;return!t||!u?Wr(o,e,h):cM(o,h,e)}})}function hM(n){if(n!==void 0)return 0}function jG(n){if(n!==void 0)return n}function RH(n){const e=2*Math.PI/n;return(function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t})}function MH(n){const e=aa(5);return(function(t,i){return i||t===void 0?t:Math.abs(t)<=e?0:t})}const kH=42,dM=256,z2=0;class yc extends nu{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=KR(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&NY(),e.center&&(e.center=fs(e.center,this.projection_)),e.extent&&(e.extent=Xl(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const l in fu)delete t[l];this.setProperties(t,!0);const i=PH(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const r=LH(e),o=i.constraint,s=GH(e);this.constraints_={center:r,resolution:o,rotation:s},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const r=e||[0,0,0,0];t=t||[0,0,0,0];const o=this.getResolution(),s=o/2*(r[3]-t[3]+t[1]-r[1]),l=o/2*(r[0]-t[0]+t[2]-r[2]);this.setCenterInternal([i[0]+s,i[1]-l])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let r=arguments[i];r.center&&(r=Object.assign({},r),r.center=fs(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=fs(r.anchor,this.getProjection())),t[i]=r}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let r=0;for(;r<t&&!this.isDef();++r){const d=arguments[r];d.center&&this.setCenterInternal(d.center),d.zoom!==void 0?this.setZoom(d.zoom):d.resolution&&this.setResolution(d.resolution),d.rotation!==void 0&&this.setRotation(d.rotation)}if(r===t){i&&ax(i,!0);return}let o=Date.now(),s=this.targetCenter_.slice(),l=this.targetResolution_,u=this.targetRotation_;const h=[];for(;r<t;++r){const d=arguments[r],m={start:o,complete:!1,anchor:d.anchor,duration:d.duration!==void 0?d.duration:1e3,easing:d.easing||nH,callback:i};if(d.center&&(m.sourceCenter=s,m.targetCenter=d.center.slice(),s=m.targetCenter),d.zoom!==void 0?(m.sourceResolution=l,m.targetResolution=this.getResolutionForZoom(d.zoom),l=m.targetResolution):d.resolution&&(m.sourceResolution=l,m.targetResolution=d.resolution,l=m.targetResolution),d.rotation!==void 0){m.sourceRotation=u;const y=Fh(d.rotation-u+Math.PI,2*Math.PI)-Math.PI;m.targetRotation=u+y,u=m.targetRotation}FH(m)?m.complete=!0:o+=m.duration,h.push(m)}this.animations_.push(h),this.setHint(Jr.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Jr.ANIMATING]>0}getInteracting(){return this.hints_[Jr.INTERACTING]>0}cancelAnimations(){this.setHint(Jr.ANIMATING,-this.hints_[Jr.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const r=this.animations_[t];if(r[0].callback&&ax(r[0].callback,!1),!e)for(let o=0,s=r.length;o<s;++o){const l=r[o];if(!l.complete){e=l.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const r=this.animations_[i];let o=!0;for(let s=0,l=r.length;s<l;++s){const u=r[s];if(u.complete)continue;const h=e-u.start;let d=u.duration>0?h/u.duration:1;d>=1?(u.complete=!0,d=1):o=!1;const m=u.easing(d);if(u.sourceCenter){const y=u.sourceCenter[0],x=u.sourceCenter[1],C=u.targetCenter[0],w=u.targetCenter[1];this.nextCenter_=u.targetCenter;const E=y+m*(C-y),T=x+m*(w-x);this.targetCenter_=[E,T]}if(u.sourceResolution&&u.targetResolution){const y=m===1?u.targetResolution:u.sourceResolution+m*(u.targetResolution-u.sourceResolution);if(u.anchor){const x=this.getViewportSize_(this.getRotation()),C=this.constraints_.resolution(y,0,x,!0);this.targetCenter_=this.calculateCenterZoom(C,u.anchor)}this.nextResolution_=u.targetResolution,this.targetResolution_=y,this.applyTargetState_(!0)}if(u.sourceRotation!==void 0&&u.targetRotation!==void 0){const y=m===1?Fh(u.targetRotation+Math.PI,2*Math.PI)-Math.PI:u.sourceRotation+m*(u.targetRotation-u.sourceRotation);if(u.anchor){const x=this.constraints_.rotation(y,!0);this.targetCenter_=this.calculateCenterRotate(x,u.anchor)}this.nextRotation_=u.targetRotation,this.targetRotation_=y}if(this.applyTargetState_(!0),t=!0,!u.complete)break}if(o){this.animations_[i]=null,this.setHint(Jr.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const s=r[0].callback;s&&ax(s,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const r=this.getCenterInternal();return r!==void 0&&(i=[r[0]-t[0],r[1]-t[1]],zR(i,e-this.getRotation()),hY(i,t)),i}calculateCenterZoom(e,t){let i;const r=this.getCenterInternal(),o=this.getResolution();if(r!==void 0&&o!==void 0){const s=t[0]-e*(t[0]-r[0])/o,l=t[1]-e*(t[1]-r[1])/o;i=[s,l]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],r=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(r*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(r*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Jp(e,this.getProjection())}getCenterInternal(){return this.get(fu.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return Hw(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();gr(t,"The view center is not defined");const i=this.getResolution();gr(i!==void 0,"The view resolution is not defined");const r=this.getRotation();return gr(r!==void 0,"The view rotation is not defined"),kv(t,i,r,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(fu.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(Xl(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=Bi(e)/t[0],r=Ws(e)/t[1];return Math.max(i,r)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(t/i)/Math.log(e);return(function(o){return t/Math.pow(e,o*r)})}getRotation(){return this.get(fu.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,o=Math.log(i/r)/t;return(function(s){return Math.log(i/s)/t/o})}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let r=this.getCenterInternal();const o=this.padding_;if(o){const s=this.getViewportSizeMinusPadding_();r=U2(r,this.getViewportSize_(),[s[0]/2+o[3],s[1]/2+o[0]],t,i)}return{center:r.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,r;if(this.resolutions_){const o=jw(this.resolutions_,e,1);t=o,i=this.resolutions_[o],o==this.resolutions_.length-1?r=2:r=i/this.resolutions_[o+1]}else i=this.maxResolution_,r=this.zoomFactor_;return t+Math.log(i/e)/Math.log(r)}getResolutionForZoom(e){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];const t=Wr(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,Wr(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(gr(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){gr(!dg(e),"Cannot fit empty extent provided as `geometry`");const r=Xl(e,this.getProjection());i=JE(r)}else if(e.getType()==="Circle"){const r=Xl(e.getExtent(),this.getProjection());i=JE(r),i.rotate(this.getRotation(),Gu(r))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),r=Math.sin(-t),o=e.getFlatCoordinates(),s=e.getStride();let l=1/0,u=1/0,h=-1/0,d=-1/0;for(let m=0,y=o.length;m<y;m+=s){const x=o[m]*i-o[m+1]*r,C=o[m]*r+o[m+1]*i;l=Math.min(l,x),u=Math.min(u,C),h=Math.max(h,x),d=Math.max(d,C)}return[l,u,h,d]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const r=t.padding!==void 0?t.padding:[0,0,0,0],o=t.nearest!==void 0?t.nearest:!1;let s;t.minResolution!==void 0?s=t.minResolution:t.maxZoom!==void 0?s=this.getResolutionForZoom(t.maxZoom):s=0;const l=this.rotatedExtentForGeometry(e);let u=this.getResolutionForExtentInternal(l,[i[0]-r[1]-r[3],i[1]-r[0]-r[2]]);u=isNaN(u)?s:Math.max(u,s),u=this.getConstrainedResolution(u,o?0:1);const h=this.getRotation(),d=Math.sin(h),m=Math.cos(h),y=Gu(l);y[0]+=(r[1]-r[3])/2*u,y[1]+=(r[0]-r[2])/2*u;const x=y[0]*m-y[1]*d,C=y[1]*m+y[0]*d,w=this.getConstrainedCenter([x,C],u),E=t.callback?t.callback:Pv;t.duration!==void 0?this.animateInternal({resolution:u,center:w,duration:t.duration,easing:t.easing},E):(this.targetResolution_=u,this.targetCenter_=w,this.applyTargetState_(!1,!0),ax(E,!0))}centerOn(e,t,i){this.centerOnInternal(fs(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(U2(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,r){let o;const s=this.padding_;if(s&&e){const l=this.getViewportSizeMinusPadding_(-i),u=U2(e,r,[l[0]/2+s[3],l[1]/2+s[0]],t,i);o=[e[0]-u[0],e[1]-u[1]]}return o}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Jp(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&fs(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*e,0,r,i);t&&(this.targetCenter_=this.calculateCenterZoom(o,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=fs(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(r,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&fs(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,r=this.constraints_.rotation(this.targetRotation_,i),o=this.getViewportSize_(r),s=this.constraints_.resolution(this.targetResolution_,0,o,i),l=this.constraints_.center(this.targetCenter_,s,o,i,this.calculateCenterShift(this.targetCenter_,s,r,o));this.get(fu.ROTATION)!==r&&this.set(fu.ROTATION,r),this.get(fu.RESOLUTION)!==s&&(this.set(fu.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),(!l||!this.get(fu.CENTER)||!Jo(this.get(fu.CENTER),l))&&this.set(fu.CENTER,l),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const r=t||0,o=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(o),l=this.constraints_.resolution(this.targetResolution_,r,s),u=this.constraints_.center(this.targetCenter_,l,s,!1,this.calculateCenterShift(this.targetCenter_,l,o,s));if(e===0&&!this.cancelAnchor_){this.targetResolution_=l,this.targetRotation_=o,this.targetCenter_=u,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==l||this.getRotation()!==o||!this.getCenterInternal()||!Jo(this.getCenterInternal(),u))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:u,resolution:l,duration:e,easing:Xy,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Jr.INTERACTING,1)}endInteraction(e,t,i){i=i&&fs(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(Jr.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function ax(n,e){setTimeout(function(){n(e)},0)}function LH(n){if(n.extent!==void 0){const t=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return UG(n.extent,n.constrainOnlyCenter,t)}const e=KR(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,UG(t,!1,!1)}return tH}function PH(n){let e,t,i,s=n.minZoom!==void 0?n.minZoom:z2,l=n.maxZoom!==void 0?n.maxZoom:28;const u=n.zoomFactor!==void 0?n.zoomFactor:2,h=n.multiWorld!==void 0?n.multiWorld:!1,d=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,m=n.showFullExtent!==void 0?n.showFullExtent:!1,y=KR(n.projection,"EPSG:3857"),x=y.getExtent();let C=n.constrainOnlyCenter,w=n.extent;if(!h&&!w&&y.isGlobal()&&(C=!1,w=x),n.resolutions!==void 0){const E=n.resolutions;t=E[s],i=E[l]!==void 0?E[l]:E[E.length-1],n.constrainResolution?e=EH(E,d,!C&&w,m):e=KG(t,i,d,!C&&w,m)}else{const T=(x?Math.max(Bi(x),Ws(x)):360*Kp.degrees/y.getMetersPerUnit())/dM/Math.pow(2,z2),k=T/Math.pow(2,28-z2);t=n.maxResolution,t!==void 0?s=0:t=T/Math.pow(u,s),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=t/Math.pow(u,l):i=T/Math.pow(u,l):i=k),l=s+Math.floor(Math.log(t/i)/Math.log(u)),i=t/Math.pow(u,l-s),n.constrainResolution?e=TH(u,t,i,d,!C&&w,m):e=KG(t,i,d,!C&&w,m)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:s,zoomFactor:u}}function GH(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const t=n.constrainRotation;return t===void 0||t===!0?MH():t===!1?jG:typeof t=="number"?RH(t):jG}return hM}function FH(n){return!(n.sourceCenter&&n.targetCenter&&!Jo(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function U2(n,e,t,i,r){const o=Math.cos(-r);let s=Math.sin(-r),l=n[0]*o-n[1]*s,u=n[1]*o+n[0]*s;l+=(e[0]/2-t[0])*i,u+=(t[1]-e[1]/2)*i,s=-s;const h=l*o-u*s,d=u*o+l*s;return[h,d]}const lx="ol-hidden",OH="ol-selectable",Bc="ol-unselectable",$G="ol-unsupported",Af="ol-control",JG="ol-collapsed",NH=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),qG=["style","variant","weight","size","lineHeight","family"],qE={normal:400,bold:700},dC=function(n){const e=n.match(NH);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let i=0,r=qG.length;i<r;++i){const o=e[i+1];o!==void 0&&(t[qG[i]]=typeof o=="string"?o.trim():o)}return isNaN(Number(t.weight))&&t.weight in qE&&(t.weight=qE[t.weight]),t.families=t.family.split(/,\s?/).map(i=>i.trim().replace(/^['"]|['"]$/g,"")),t};function ro(n,e,t,i){let r;return t&&t.length?r=t.shift():Cl?r=new class extends OffscreenCanvas{style={}}(n??300,e??150):r=document.createElement("canvas"),n&&(r.width=n),e&&(r.height=e),r.getContext("2d",i)}let X2;function fC(){return X2||(X2=ro(1,1)),X2}function Qw(n){const e=n.canvas;e.width=1,e.height=1,n.clearRect(0,0,1,1)}function DH(n){let e=n.offsetWidth;const t=getComputedStyle(n);return e+=parseInt(t.marginLeft,10)+parseInt(t.marginRight,10),e}function VH(n){let e=n.offsetHeight;const t=getComputedStyle(n);return e+=parseInt(t.marginTop,10)+parseInt(t.marginBottom,10),e}function pC(n,e){const t=e.parentNode;t&&t.replaceChild(n,e)}function zD(n){for(;n.lastChild;)n.lastChild.remove()}function BH(n,e){const t=n.childNodes;for(let i=0;;++i){const r=t[i],o=e[i];if(!r&&!o)break;if(r!==o){if(!r){n.appendChild(o);continue}if(!o){n.removeChild(r),--i;continue}n.insertBefore(o,r)}}}function UD(){return new Proxy({childNodes:[],appendChild:function(e){return this.childNodes.push(e),e},remove:function(){},removeChild:function(e){const t=this.childNodes.indexOf(e);if(t===-1)throw new Error("Node to remove was not found");return this.childNodes.splice(t,1),e},insertBefore:function(e,t){const i=this.childNodes.indexOf(t);if(i===-1)throw new Error("Reference node not found");return this.childNodes.splice(i,0,e),e},style:{}},{get(e,t,i){return t==="firstElementChild"?e.childNodes.length>0?e.childNodes[0]:null:Reflect.get(e,t,i)}})}function $d(n){return typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}class rd extends nu{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&this.element?.remove();for(let t=0,i=this.listenerKeys.length;t<i;++t)mr(this.listenerKeys[t]);if(this.listenerKeys.length=0,this.map_=e,e){const t=this.target_??e.getOverlayContainerStopEvent();this.element&&t.appendChild(this.element),this.render!==Pv&&this.listenerKeys.push(mn(e,wh.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class ZH extends rd{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",r=e.expandClassName!==void 0?e.expandClassName:t+"-expand",o=e.collapseLabel!==void 0?e.collapseLabel:"",s=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o,this.collapseLabel_.className=s):this.collapseLabel_=o;const l=e.label!==void 0?e.label:"i";typeof l=="string"?(this.label_=document.createElement("span"),this.label_.textContent=l,this.label_.className=r):this.label_=l;const u=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(u),this.toggleButton_.addEventListener(Qn.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+Bc+" "+Af+(this.collapsed_&&this.collapsible_?" "+JG:"")+(this.collapsible_?"":" ol-uncollapsible"),d=this.element;d.className=h,d.appendChild(this.toggleButton_),d.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=this.getMap().getAllLayers(),i=new Set(t.flatMap(r=>r.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(r=>i.add(r)):i.add(this.attributions_)),!this.overrideCollapsible_){const r=!t.some(o=>o.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(r)}return Array.from(i)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(r=>CD(()=>r))),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!id(t,this.renderedAttributions_)){zD(this.ulElement_);for(let r=0,o=t.length;r<o;++r){const s=document.createElement("li");s.innerHTML=t[r],this.ulElement_.appendChild(s)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(JG),this.collapsed_?pC(this.collapseLabel_,this.label_):pC(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class XD extends rd{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"",r=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(r));const o=e.tipLabel?e.tipLabel:"Reset rotation",s=document.createElement("button");s.className=t+"-reset",s.setAttribute("type","button"),s.title=o,s.appendChild(this.label_),s.addEventListener(Qn.CLICK,this.handleClick_.bind(this),!1);const l=t+" "+Bc+" "+Af,u=this.element;u.className=l,u.appendChild(s),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(lx)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:Xy}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const r="rotate("+i+"rad)";if(this.autoHide_){const o=this.element.classList.contains(lx);!o&&i===0?this.element.classList.add(lx):o&&i!==0&&this.element.classList.remove(lx)}this.label_.style.transform=r}this.rotation_=i}}class YD extends rd{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,r=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",o=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",s=e.zoomInLabel!==void 0?e.zoomInLabel:"+",l=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",u=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",d=document.createElement("button");d.className=r,d.setAttribute("type","button"),d.title=u,d.appendChild(typeof s=="string"?document.createTextNode(s):s),d.addEventListener(Qn.CLICK,this.handleClick_.bind(this,i),!1);const m=document.createElement("button");m.className=o,m.setAttribute("type","button"),m.title=h,m.appendChild(typeof l=="string"?document.createTextNode(l):l),m.addEventListener(Qn.CLICK,this.handleClick_.bind(this,-i),!1);const y=t+" "+Bc+" "+Af,x=this.element;x.className=y,x.appendChild(d),x.appendChild(m),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const r=i.getZoom();if(r!==void 0){const o=i.getConstrainedZoom(r+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:o,duration:this.duration_,easing:Xy})):i.setZoom(o)}}}function WH(n){n=n||{};const e=new Ts;return(n.zoom===void 0||n.zoom)&&e.push(new YD(n.zoomOptions)),(n.rotate===void 0||n.rotate)&&e.push(new XD(n.rotateOptions)),(n.attribution===void 0||n.attribution)&&e.push(new ZH(n.attributionOptions)),e}class zH{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const r=this.points_[t+2]-this.points_[i+2];if(r<1e3/60)return!1;const o=this.points_[t]-this.points_[i],s=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(s,o),this.initialVelocity_=Math.sqrt(o*o+s*s)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const QE={ACTIVE:"active"};class Yy extends nu{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(QE.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(QE.ACTIVE,e)}setMap(e){this.map_=e}}function UH(n,e,t){const i=n.getCenterInternal();if(i){const r=[i[0]+e[0],i[1]+e[1]];n.animateInternal({duration:t!==void 0?t:250,easing:iH,center:n.getConstrainedCenter(r)})}}function fM(n,e,t,i){const r=n.getZoom();if(r===void 0)return;const o=n.getConstrainedZoom(r+e),s=n.getResolutionForZoom(o);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:s,anchor:t,duration:i!==void 0?i:250,easing:Xy})}class XH extends Yy{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==Vi.DBLCLICK){const i=e.originalEvent,r=e.map,o=e.coordinate,s=i.shiftKey?-this.delta_:this.delta_,l=r.getView();fM(l,s,o,this.duration_),i.preventDefault(),t=!0}return!t}}function eT(n){const e=arguments;return function(t){let i=!0;for(let r=0,o=e.length;r<o&&(i=i&&e[r](t),!!i);++r);return i}}const YH=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},HH=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},KH=function(n){const e=n.map.getTargetElement(),t=e.getRootNode(),i=n.map.getOwnerDocument().activeElement;return t instanceof ShadowRoot?t.host.contains(i):e.contains(i)},HD=function(n){const e=n.map.getTargetElement(),t=e.getRootNode();return(t instanceof ShadowRoot?t.host:e).hasAttribute("tabindex")?KH(n):!0},ay=gf,jH=function(n){return n.type==Vi.CLICK},KD=function(n){const e=n.originalEvent;return"pointerId"in e&&e.button==0&&!($Y&&jR&&e.ctrlKey)},gC=Uy,$H=function(n){return n.type=="pointermove"},pM=function(n){return n.type==Vi.SINGLECLICK},eA=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},JH=function(n){const e=n.originalEvent;return!e.altKey&&(jR?e.metaKey:e.ctrlKey)&&!e.shiftKey},qH=function(n){const e=n.originalEvent;return jR?e.metaKey:e.ctrlKey},mC=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},jD=function(n){const e=n.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Y2=function(n){const e=n.originalEvent;return"pointerId"in e&&e.pointerType=="mouse"},$D=function(n){const e=n.originalEvent;return"pointerId"in e&&e.isPrimary&&e.button===0};class Zc extends Yy{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Vi.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Vi.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==Vi.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==Vi.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function gM(n){const e=n.length;let t=0,i=0;for(let r=0;r<e;r++)t+=n[r].clientX,i+=n[r].clientY;return{clientX:t/e,clientY:i/e}}class QH extends Zc{constructor(e){super({stopDown:Uy}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:eT(eA,$D);this.condition_=e.onFocusOnly?eT(HD,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,r=t.getEventPixel(gM(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const o=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],l=e.map.getView();dY(o,l.getResolution()),zR(o,l.getRotation()),l.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),s=i.getCenterInternal(),l=t.getPixelFromCoordinateInternal(s),u=t.getCoordinateFromPixelInternal([l[0]-r*Math.cos(o),l[1]-r*Math.sin(o)]);i.animateInternal({center:i.getConstrainedCenter(u),duration:500,easing:Xy})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class tT extends Zc{constructor(e){e=e||{},super({stopDown:Uy}),this.condition_=e.condition?e.condition:HH,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Y2(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===hM)return;const r=t.getSize(),o=e.pixel,s=Math.atan2(r[1]/2-o[1],o[0]-r[0]/2);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;i.adjustRotationInternal(-l)}this.lastAngle_=s}handleUpEvent(e){return Y2(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Y2(e)&&KD(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class eK extends Kw{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",r=this.element_.style;r.left=Math.min(e[0],t[0])+i,r.top=Math.min(e[1],t[1])+i,r.width=Math.abs(t[0]-e[0])+i,r.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,t=this.endPixel_,r=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new Bo([r])}getGeometry(){return this.geometry_}}const ym={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class c0 extends Vo{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class tK extends Zc{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new eK(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??KD,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const r=i[0]-t[0],o=i[1]-t[1];return r*r+o*o>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new c0(ym.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new c0(t?ym.BOXEND:ym.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new c0(ym.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new c0(ym.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new c0(ym.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}}class nK extends tK{constructor(e){e=e||{};const t=e.condition?e.condition:mC;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let r=this.getGeometry();if(this.out_){const o=i.rotatedExtentForGeometry(r),s=i.getResolutionForExtentInternal(o),l=i.getResolution()/s;r=r.clone(),r.scale(l*l)}i.fitInternal(r,{duration:this.duration_,easing:Xy})}}const gp={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class iK extends Yy{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return eA(t)&&jD(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==Qn.KEYDOWN){const i=e.originalEvent,r=i.key;if(this.condition_(e)&&(r==gp.DOWN||r==gp.LEFT||r==gp.RIGHT||r==gp.UP)){const s=e.map.getView(),l=s.getResolution()*this.pixelDelta_;let u=0,h=0;r==gp.DOWN?h=-l:r==gp.LEFT?u=-l:r==gp.RIGHT?u=l:h=l;const d=[u,h];zR(d,s.getRotation()),UH(s,d,this.duration_),i.preventDefault(),t=!0}}return!t}}class rK extends Yy{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!qH(t)&&jD(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==Qn.KEYDOWN||e.type==Qn.KEYPRESS){const i=e.originalEvent,r=i.key;if(this.condition_(e)&&(r==="+"||r==="-")){const o=e.map,s=r==="+"?this.delta_:-this.delta_,l=o.getView();fM(l,s,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const sK=40,oK=300;class aK extends Yy{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:ay;this.condition_=e.onFocusOnly?eT(HD,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==Qn.WHEEL)return!0;const i=e.map,r=e.originalEvent;r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let o=r.deltaY;switch(r.deltaMode){case WheelEvent.DOM_DELTA_LINE:o*=sK;break;case WheelEvent.DOM_DELTA_PAGE:o*=oK;break}if(o===0)return!1;this.lastDelta_=o;const s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(o)<4?"trackpad":"wheel");const l=i.getView();if(this.mode_==="trackpad"&&!(l.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(l.getAnimating()&&l.cancelAnimations(),l.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),l.adjustZoom(-o/this.deltaPerZoom_,this.lastAnchor_?i.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=s,!1;this.totalDelta_+=o;const u=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),u),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-Wr(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),fM(t,i,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class lK extends Zc{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Uy),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],r=this.targetPointers[1],o=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(this.lastAngle_!==void 0){const u=o-this.lastAngle_;this.rotationDelta_+=u,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=u}this.lastAngle_=o;const s=e.map,l=s.getView();l.getConstraints().rotation!==hM&&(this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(gM(this.targetPointers))),this.rotating_&&(s.render(),l.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class uK extends Zc{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Uy),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],r=this.targetPointers[1],o=i.clientX-r.clientX,s=i.clientY-r.clientY,l=Math.sqrt(o*o+s*s);this.lastDistance_!==void 0&&(t=this.lastDistance_/l),this.lastDistance_=l;const u=e.map,h=u.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=u.getCoordinateFromPixelInternal(u.getEventPixel(gM(this.targetPointers))),u.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),r=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function cK(n){n=n||{};const e=new Ts,t=new zH(-.005,.05,100);return(n.altShiftDragRotate===void 0||n.altShiftDragRotate)&&e.push(new tT),(n.doubleClickZoom===void 0||n.doubleClickZoom)&&e.push(new XH({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan===void 0||n.dragPan)&&e.push(new QH({onFocusOnly:n.onFocusOnly,kinetic:t})),(n.pinchRotate===void 0||n.pinchRotate)&&e.push(new lK),(n.pinchZoom===void 0||n.pinchZoom)&&e.push(new uK({duration:n.zoomDuration})),(n.keyboard===void 0||n.keyboard)&&(e.push(new iK),e.push(new rK({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom===void 0||n.mouseWheelZoom)&&e.push(new aK({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom===void 0||n.shiftDragZoom)&&e.push(new nK({duration:n.zoomDuration})),e}const Tr={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class JD extends nu{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[Tr.OPACITY]=e.opacity!==void 0?e.opacity:1,gr(typeof t[Tr.OPACITY]=="number","Layer opacity must be a number"),t[Tr.VISIBLE]=e.visible!==void 0?e.visible:!0,t[Tr.Z_INDEX]=e.zIndex,t[Tr.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[Tr.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[Tr.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[Tr.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=Wr(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return Zn()}getLayerStatesArray(e){return Zn()}getExtent(){return this.get(Tr.EXTENT)}getMaxResolution(){return this.get(Tr.MAX_RESOLUTION)}getMinResolution(){return this.get(Tr.MIN_RESOLUTION)}getMinZoom(){return this.get(Tr.MIN_ZOOM)}getMaxZoom(){return this.get(Tr.MAX_ZOOM)}getOpacity(){return this.get(Tr.OPACITY)}getSourceState(){return Zn()}getVisible(){return this.get(Tr.VISIBLE)}getZIndex(){return this.get(Tr.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(Tr.EXTENT,e)}setMaxResolution(e){this.set(Tr.MAX_RESOLUTION,e)}setMinResolution(e){this.set(Tr.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(Tr.MAX_ZOOM,e)}setMinZoom(e){this.set(Tr.MIN_ZOOM,e)}setOpacity(e){gr(typeof e=="number","Layer opacity must be a number"),this.set(Tr.OPACITY,e)}setVisible(e){this.set(Tr.VISIBLE,e)}setZIndex(e){this.set(Tr.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Rd={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"};class Zd extends Vo{constructor(e,t){super(e),this.layer=t}}const H2={LAYERS:"layers"};class Sf extends JD{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(H2.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new Ts(i.slice(),{unique:!0}):gr(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new Ts(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(mr),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(mn(e,eo.ADD,this.handleLayersAdd_,this),mn(e,eo.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(mr);Wy(this.listenerKeys_);const t=e.getArray();for(let i=0,r=t.length;i<r;i++){const o=t[i];this.registerLayerListeners_(o),this.dispatchEvent(new Zd(Rd.ADDLAYER,o))}this.changed()}registerLayerListeners_(e){const t=[mn(e,qp.PROPERTYCHANGE,this.handleLayerChange_,this),mn(e,Qn.CHANGE,this.handleLayerChange_,this)];e instanceof Sf&&t.push(mn(e,Rd.ADDLAYER,this.handleLayerGroupAdd_,this),mn(e,Rd.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[Yn(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new Zd(Rd.ADDLAYER,e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Zd(Rd.REMOVELAYER,e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Zd(Rd.ADDLAYER,t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=Yn(t);this.listenerKeys_[i].forEach(mr),delete this.listenerKeys_[i],this.dispatchEvent(new Zd(Rd.REMOVELAYER,t)),this.changed()}getLayers(){return this.get(H2.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let r=0,o=i.length;r<o;++r)this.dispatchEvent(new Zd(Rd.REMOVELAYER,i[r]))}this.set(H2.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(s){s.getLayerStatesArray(t)});const r=this.getLayerState();let o=r.zIndex;!e&&r.zIndex===void 0&&(o=0);for(let s=i,l=t.length;s<l;s++){const u=t[s];u.opacity*=r.opacity,u.visible=u.visible&&r.visible,u.maxResolution=Math.min(u.maxResolution,r.maxResolution),u.minResolution=Math.max(u.minResolution,r.minResolution),u.minZoom=Math.max(u.minZoom,r.minZoom),u.maxZoom=Math.min(u.maxZoom,r.maxZoom),r.extent!==void 0&&(u.extent!==void 0?u.extent=Ec(u.extent,r.extent):u.extent=r.extent),u.zIndex===void 0&&(u.zIndex=o)}return t}getSourceState(){return"ready"}}const ja={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class pg extends JD{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(Tr.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(Tr.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(mr(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=mn(e,Qn.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof yc?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let r;if(t.layerStatesArray){if(r=t.layerStatesArray.find(s=>s.layer===this),!r)return!1}else r=this.getLayerState();const o=this.getExtent();return mM(r,t.viewState)&&(!o||Zs(o,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];const t=this.getSource()?.getAttributions();if(!t)return[];const i=e instanceof yc?e.getViewStateAndExtent():e;let r=t(i);return Array.isArray(r)||(r=[r]),r}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(Tr.MAP,e)}getMapInternal(){return this.get(Tr.MAP)}setMap(e){this.mapPrecomposeKey_&&(mr(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(mr(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=mn(e,ja.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=mn(this,Qn.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,i=this.getLayerState(!1);gr(!t.some(r=>r.layer===i.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(i)}setSource(e){this.set(Tr.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function mM(n,e){if(!n.visible)return!1;const t=e.resolution;if(t<n.minResolution||t>=n.maxResolution)return!1;const i=e.zoom;return i>n.minZoom&&i<=n.maxZoom}function qD(n,e,t=0,i=n.length-1,r=hK){for(;i>t;){if(i-t>600){const u=i-t+1,h=e-t+1,d=Math.log(u),m=.5*Math.exp(2*d/3),y=.5*Math.sqrt(d*m*(u-m)/u)*(h-u/2<0?-1:1),x=Math.max(t,Math.floor(e-h*m/u+y)),C=Math.min(i,Math.floor(e+(u-h)*m/u+y));qD(n,e,x,C,r)}const o=n[e];let s=t,l=i;for(h0(n,t,e),r(n[i],o)>0&&h0(n,t,i);s<l;){for(h0(n,s,l),s++,l--;r(n[s],o)<0;)s++;for(;r(n[l],o)>0;)l--}r(n[t],o)===0?h0(n,t,l):(l++,h0(n,l,i)),l<=e&&(t=l+1),e<=l&&(i=l-1)}}function h0(n,e,t){const i=n[e];n[e]=n[t],n[t]=i}function hK(n,e){return n<e?-1:n>e?1:0}let QD=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!cx(e,t))return i;const r=this.toBBox,o=[];for(;t;){for(let s=0;s<t.children.length;s++){const l=t.children[s],u=t.leaf?r(l):l;cx(e,u)&&(t.leaf?i.push(l):j2(e,u)?this._all(l,i):o.push(l))}t=o.pop()}return i}collides(e){let t=this.data;if(!cx(e,t))return!1;const i=[];for(;t;){for(let r=0;r<t.children.length;r++){const o=t.children[r],s=t.leaf?this.toBBox(o):o;if(cx(e,s)){if(t.leaf||j2(e,s))return!0;i.push(o)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Lm([]),this}remove(e,t){if(!e)return this;let i=this.data;const r=this.toBBox(e),o=[],s=[];let l,u,h;for(;i||o.length;){if(i||(i=o.pop(),u=o[o.length-1],l=s.pop(),h=!0),i.leaf){const d=dK(e,i.children,t);if(d!==-1)return i.children.splice(d,1),o.push(i),this._condense(o),this}!h&&!i.leaf&&j2(i,r)?(o.push(i),s.push(l),l=0,u=i,i=i.children[0]):u?(l++,i=u.children[l],h=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,r){const o=i-t+1;let s=this._maxEntries,l;if(o<=s)return l=Lm(e.slice(t,i+1)),_m(l,this.toBBox),l;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),l=Lm([]),l.leaf=!1,l.height=r;const u=Math.ceil(o/s),h=u*Math.ceil(Math.sqrt(s));QG(e,t,i,h,this.compareMinX);for(let d=t;d<=i;d+=h){const m=Math.min(d+h-1,i);QG(e,d,m,u,this.compareMinY);for(let y=d;y<=m;y+=u){const x=Math.min(y+u-1,m);l.children.push(this._build(e,y,x,r-1))}}return _m(l,this.toBBox),l}_chooseSubtree(e,t,i,r){for(;r.push(t),!(t.leaf||r.length-1===i);){let o=1/0,s=1/0,l;for(let u=0;u<t.children.length;u++){const h=t.children[u],d=K2(h),m=gK(e,h)-d;m<s?(s=m,o=d<o?d:o,l=h):m===s&&d<o&&(o=d,l=h)}t=l||t.children[0]}return t}_insert(e,t,i){const r=i?e:this.toBBox(e),o=[],s=this._chooseSubtree(r,this.data,t,o);for(s.children.push(e),S0(s,r);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(r,o,t)}_split(e,t){const i=e[t],r=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,r);const s=this._chooseSplitIndex(i,o,r),l=Lm(i.children.splice(s,i.children.length-s));l.height=i.height,l.leaf=i.leaf,_m(i,this.toBBox),_m(l,this.toBBox),t?e[t-1].children.push(l):this._splitRoot(i,l)}_splitRoot(e,t){this.data=Lm([e,t]),this.data.height=e.height+1,this.data.leaf=!1,_m(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let r,o=1/0,s=1/0;for(let l=t;l<=i-t;l++){const u=A0(e,0,l,this.toBBox),h=A0(e,l,i,this.toBBox),d=mK(u,h),m=K2(u)+K2(h);d<o?(o=d,r=l,s=m<s?m:s):d===o&&m<s&&(s=m,r=l)}return r||i-t}_chooseSplitAxis(e,t,i){const r=e.leaf?this.compareMinX:fK,o=e.leaf?this.compareMinY:pK,s=this._allDistMargin(e,t,i,r),l=this._allDistMargin(e,t,i,o);s<l&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);const o=this.toBBox,s=A0(e,0,t,o),l=A0(e,i-t,i,o);let u=ux(s)+ux(l);for(let h=t;h<i-t;h++){const d=e.children[h];S0(s,e.leaf?o(d):d),u+=ux(s)}for(let h=i-t-1;h>=t;h--){const d=e.children[h];S0(l,e.leaf?o(d):d),u+=ux(l)}return u}_adjustParentBBoxes(e,t,i){for(let r=i;r>=0;r--)S0(t[r],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():_m(e[t],this.toBBox)}};function dK(n,e,t){if(!t)return e.indexOf(n);for(let i=0;i<e.length;i++)if(t(n,e[i]))return i;return-1}function _m(n,e){A0(n,0,n.children.length,e,n)}function A0(n,e,t,i,r){r||(r=Lm(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o=e;o<t;o++){const s=n.children[o];S0(r,n.leaf?i(s):s)}return r}function S0(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function fK(n,e){return n.minX-e.minX}function pK(n,e){return n.minY-e.minY}function K2(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function ux(n){return n.maxX-n.minX+(n.maxY-n.minY)}function gK(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function mK(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),r=Math.min(n.maxX,e.maxX),o=Math.min(n.maxY,e.maxY);return Math.max(0,r-t)*Math.max(0,o-i)}function j2(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function cx(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function Lm(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function QG(n,e,t,i,r){const o=[e,t];for(;o.length;){if(t=o.pop(),e=o.pop(),t-e<=i)continue;const s=e+Math.ceil((t-e)/i/2)*i;qD(n,s,e,t,r),o.push(e,s,s,t)}}const yM=[NaN,NaN,NaN,0];let $2;function yK(){return $2||($2=ro(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),$2}const _K=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,vK=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,bK=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,xK=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function hx(n,e){return n.endsWith("%")?Number(n.substring(0,n.length-1))/e:Number(n)}function tv(n){throw new Error('failed to parse "'+n+'" as color')}function e4(n){if(n.toLowerCase().startsWith("rgb")){const o=n.match(vK)||n.match(_K)||n.match(bK);if(o){const s=o[4],l=100/255;return[Wr(hx(o[1],l)+.5|0,0,255),Wr(hx(o[2],l)+.5|0,0,255),Wr(hx(o[3],l)+.5|0,0,255),s!==void 0?Wr(hx(s,100),0,1):1]}tv(n)}if(n.startsWith("#")){if(xK.test(n)){const o=n.substring(1),s=o.length<=4?1:2,l=[0,0,0,255];for(let u=0,h=o.length;u<h;u+=s){let d=parseInt(o.substring(u,u+s),16);s===1&&(d+=d<<4),l[u/s]=d}return l[3]=l[3]/255,l}tv(n)}const e=yK();e.fillStyle="#abcdef";let t=e.fillStyle;e.fillStyle=n,e.fillStyle===t&&(e.fillStyle="#fedcba",t=e.fillStyle,e.fillStyle=n,e.fillStyle===t&&tv(n));const i=e.fillStyle;if(i.startsWith("#")||i.startsWith("rgba"))return e4(i);e.clearRect(0,0,1,1),e.fillRect(0,0,1,1);const r=Array.from(e.getImageData(0,0,1,1).data);return r[3]=Zy(r[3]/255,3),r}function IK(n){return typeof n=="string"?n:vM(n)}const CK=1024,d0={};let J2=0;function wK(n){if(n.length===4)return n;const e=n.slice();return e[3]=1,e}function q2(n){return n>.0031308?Math.pow(n,1/2.4)*269.025-14.025:n*3294.6}function Q2(n){return n>.2068965?Math.pow(n,3):(n-4/29)*(108/841)}function eS(n){return n>10.314724?Math.pow((n+14.025)/269.025,2.4):n/3294.6}function tS(n){return n>.0088564?Math.pow(n,1/3):n/(108/841)+4/29}function eF(n){const e=eS(n[0]),t=eS(n[1]),i=eS(n[2]),r=tS(e*.222488403+t*.716873169+i*.06060791),o=500*(tS(e*.452247074+t*.399439023+i*.148375274)-r),s=200*(r-tS(e*.016863605+t*.117638439+i*.865350722)),l=Math.atan2(s,o)*(180/Math.PI);return[116*r-16,Math.sqrt(o*o+s*s),l<0?l+360:l,n[3]]}function AK(n){const e=(n[0]+16)/116,t=n[1],i=n[2]*Math.PI/180,r=Q2(e),o=Q2(e+t/500*Math.cos(i)),s=Q2(e-t/200*Math.sin(i)),l=q2(o*3.021973625-r*1.617392459-s*.404875592),u=q2(o*-.943766287+r*1.916279586+s*.027607165),h=q2(o*.069407491-r*.22898585+s*1.159737864);return[Wr(l+.5|0,0,255),Wr(u+.5|0,0,255),Wr(h+.5|0,0,255),n[3]]}function _M(n){if(n==="none")return yM;if(d0.hasOwnProperty(n))return d0[n];if(J2>=CK){let t=0;for(const i in d0)(t++&3)===0&&(delete d0[i],--J2)}const e=e4(n);e.length!==4&&tv(n);for(const t of e)isNaN(t)&&tv(n);return d0[n]=e,++J2,e}function $l(n){return Array.isArray(n)?n:_M(n)}function vM(n){let e=n[0];e!=(e|0)&&(e=e+.5|0);let t=n[1];t!=(t|0)&&(t=t+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const r=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+e+","+t+","+i+","+r+")"}function tF(n){return n[0]>0&&n[1]>0}function SK(n,e,t){return t===void 0&&(t=[0,0]),t[0]=n[0]*e+.5|0,t[1]=n[1]*e+.5|0,t}function oa(n,e){return Array.isArray(n)?n:(e===void 0?e=[n,n]:(e[0]=n,e[1]=n),e)}let gg=0;const xa=1<<gg++,Hi=1<<gg++,Wa=1<<gg++,wu=1<<gg++,eg=1<<gg++,E0=1<<gg++,dx=Math.pow(2,gg)-1,bM={[xa]:"boolean",[Hi]:"number",[Wa]:"string",[wu]:"color",[eg]:"number[]",[E0]:"size"},EK=Object.keys(bM).map(Number).sort(Tc);function TK(n){return n in bM}function T0(n){const e=[];for(const t of EK)R0(n,t)&&e.push(bM[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function R0(n,e){return(n&e)===e}function Md(n,e){return n===e}class co{constructor(e,t){if(!TK(e))throw new Error(`literal expressions must have a specific type, got ${T0(e)}`);this.type=e,this.value=t}}class RK{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function t4(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function No(n,e,t){switch(typeof n){case"boolean":{if(Md(e,Wa))return new co(Wa,n?"true":"false");if(!R0(e,xa))throw new Error(`got a boolean, but expected ${T0(e)}`);return new co(xa,n)}case"number":{if(Md(e,E0))return new co(E0,oa(n));if(Md(e,xa))return new co(xa,!!n);if(Md(e,Wa))return new co(Wa,n.toString());if(!R0(e,Hi))throw new Error(`got a number, but expected ${T0(e)}`);return new co(Hi,n)}case"string":{if(Md(e,wu))return new co(wu,_M(n));if(Md(e,xa))return new co(xa,!!n);if(!R0(e,Wa))throw new Error(`got a string, but expected ${T0(e)}`);return new co(Wa,n)}}if(!Array.isArray(n))throw new Error("expression must be an array or a primitive value");if(n.length===0)throw new Error("empty expression");if(typeof n[0]=="string")return BK(n,e,t);for(const i of n)if(typeof i!="number")throw new Error("expected an array of numbers");if(Md(e,E0)){if(n.length!==2)throw new Error(`expected an array of two values for a size, got ${n.length}`);return new co(E0,n)}if(Md(e,wu)){if(n.length===3)return new co(wu,[...n,1]);if(n.length===4)return new co(wu,n);throw new Error(`expected an array of 3 or 4 values for a color, got ${n.length}`)}if(!R0(e,eg))throw new Error(`got an array of numbers, but expected ${T0(e)}`);return new co(eg,n)}const Rt={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},MK={[Rt.Get]:si(Si(1,1/0),nF),[Rt.Var]:si(Si(1,1),kK),[Rt.Has]:si(Si(1,1/0),nF),[Rt.Id]:si(LK,vm),[Rt.Concat]:si(Si(2,1/0),fr(Wa)),[Rt.GeometryType]:si(PK,vm),[Rt.LineMetric]:si(vm),[Rt.Resolution]:si(nS,vm),[Rt.Zoom]:si(nS,vm),[Rt.Time]:si(nS,vm),[Rt.Any]:si(Si(2,1/0),fr(xa)),[Rt.All]:si(Si(2,1/0),fr(xa)),[Rt.Not]:si(Si(1,1),fr(xa)),[Rt.Equal]:si(Si(2,2),fr(dx)),[Rt.NotEqual]:si(Si(2,2),fr(dx)),[Rt.GreaterThan]:si(Si(2,2),fr(Hi)),[Rt.GreaterThanOrEqualTo]:si(Si(2,2),fr(Hi)),[Rt.LessThan]:si(Si(2,2),fr(Hi)),[Rt.LessThanOrEqualTo]:si(Si(2,2),fr(Hi)),[Rt.Multiply]:si(Si(2,1/0),iF),[Rt.Coalesce]:si(Si(2,1/0),iF),[Rt.Divide]:si(Si(2,2),fr(Hi)),[Rt.Add]:si(Si(2,1/0),fr(Hi)),[Rt.Subtract]:si(Si(2,2),fr(Hi)),[Rt.Clamp]:si(Si(3,3),fr(Hi)),[Rt.Mod]:si(Si(2,2),fr(Hi)),[Rt.Pow]:si(Si(2,2),fr(Hi)),[Rt.Abs]:si(Si(1,1),fr(Hi)),[Rt.Floor]:si(Si(1,1),fr(Hi)),[Rt.Ceil]:si(Si(1,1),fr(Hi)),[Rt.Round]:si(Si(1,1),fr(Hi)),[Rt.Sin]:si(Si(1,1),fr(Hi)),[Rt.Cos]:si(Si(1,1),fr(Hi)),[Rt.Atan]:si(Si(1,2),fr(Hi)),[Rt.Sqrt]:si(Si(1,1),fr(Hi)),[Rt.Match]:si(Si(4,1/0),rF,FK),[Rt.Between]:si(Si(3,3),fr(Hi)),[Rt.Interpolate]:si(Si(6,1/0),rF,OK),[Rt.Case]:si(Si(3,1/0),GK,NK),[Rt.In]:si(Si(2,2),DK),[Rt.Number]:si(Si(1,1/0),fr(dx)),[Rt.String]:si(Si(1,1/0),fr(dx)),[Rt.Array]:si(Si(1,1/0),fr(Hi)),[Rt.Color]:si(Si(1,4),fr(Hi)),[Rt.Band]:si(Si(1,3),fr(Hi)),[Rt.Palette]:si(Si(2,2),VK),[Rt.ToString]:si(Si(1,1),fr(xa|Hi|Wa|wu))};function nF(n,e,t){const i=n.length-1,r=new Array(i);for(let o=0;o<i;++o){const s=n[o+1];switch(typeof s){case"number":{r[o]=new co(Hi,s);break}case"string":{r[o]=new co(Wa,s);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${s}`)}o===0&&t.properties.add(String(s))}return r}function kK(n,e,t){const i=n[1];if(typeof i!="string")throw new Error("expected a string argument for var operation");return t.variables.add(i),[new co(Wa,i)]}function LK(n,e,t){t.featureId=!0}function PK(n,e,t){t.geometryType=!0}function nS(n,e,t){t.mapState=!0}function vm(n,e,t){const i=n[0];if(n.length!==1)throw new Error(`expected no arguments for ${i} operation`);return[]}function Si(n,e){return function(t,i,r){const o=t[0],s=t.length-1;if(n===e){if(s!==n){const l=n===1?"":"s";throw new Error(`expected ${n} argument${l} for ${o}, got ${s}`)}}else if(s<n||s>e){const l=e===1/0?`${n} or more`:`${n} to ${e}`;throw new Error(`expected ${l} arguments for ${o}, got ${s}`)}}}function iF(n,e,t){const i=n.length-1,r=new Array(i);for(let o=0;o<i;++o){const s=No(n[o+1],e,t);r[o]=s}return r}function fr(n){return function(e,t,i){const r=e.length-1,o=new Array(r);for(let s=0;s<r;++s){const l=No(e[s+1],n,i);o[s]=l}return o}}function GK(n,e,t){const i=n[0],r=n.length-1;if(r%2===0)throw new Error(`expected an odd number of arguments for ${i}, got ${r} instead`)}function rF(n,e,t){const i=n[0],r=n.length-1;if(r%2===1)throw new Error(`expected an even number of arguments for operation ${i}, got ${r} instead`)}function FK(n,e,t){const i=n.length-1,r=Wa|Hi|xa,o=No(n[1],r,t),s=No(n[n.length-1],e,t),l=new Array(i-2);for(let u=0;u<i-2;u+=2){try{const h=No(n[u+2],o.type,t);l[u]=h}catch(h){throw new Error(`failed to parse argument ${u+1} of match expression: ${h.message}`)}try{const h=No(n[u+3],s.type,t);l[u+1]=h}catch(h){throw new Error(`failed to parse argument ${u+2} of match expression: ${h.message}`)}}return[o,...l,s]}function OK(n,e,t){const i=n[1];let r;switch(i[0]){case"linear":r=1;break;case"exponential":const u=i[1];if(typeof u!="number"||u<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(u)} instead`);r=u;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(i)}`)}const o=new co(Hi,r);let s;try{s=No(n[2],Hi,t)}catch(u){throw new Error(`failed to parse argument 1 in interpolate expression: ${u.message}`)}const l=new Array(n.length-3);for(let u=0;u<l.length;u+=2){try{const h=No(n[u+3],Hi,t);l[u]=h}catch(h){throw new Error(`failed to parse argument ${u+2} for interpolate expression: ${h.message}`)}try{const h=No(n[u+4],e,t);l[u+1]=h}catch(h){throw new Error(`failed to parse argument ${u+3} for interpolate expression: ${h.message}`)}}return[o,s,...l]}function NK(n,e,t){const i=No(n[n.length-1],e,t),r=new Array(n.length-1);for(let o=0;o<r.length-1;o+=2){try{const s=No(n[o+1],xa,t);r[o]=s}catch(s){throw new Error(`failed to parse argument ${o} of case expression: ${s.message}`)}try{const s=No(n[o+2],i.type,t);r[o+1]=s}catch(s){throw new Error(`failed to parse argument ${o+1} of case expression: ${s.message}`)}}return r[r.length-1]=i,r}function DK(n,e,t){let i=n[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');let r;if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],r=Wa}else r=Hi;const o=new Array(i.length);for(let l=0;l<o.length;l++)try{const u=No(i[l],r,t);o[l]=u}catch(u){throw new Error(`failed to parse haystack item ${l} for "in" expression: ${u.message}`)}return[No(n[1],r,t),...o]}function VK(n,e,t){let i;try{i=No(n[1],Hi,t)}catch(s){throw new Error(`failed to parse first argument in palette expression: ${s.message}`)}const r=n[2];if(!Array.isArray(r))throw new Error("the second argument of palette must be an array");const o=new Array(r.length);for(let s=0;s<o.length;s++){let l;try{l=No(r[s],wu,t)}catch(u){throw new Error(`failed to parse color at index ${s} in palette expression: ${u.message}`)}if(!(l instanceof co))throw new Error(`the palette color at index ${s} must be a literal value`);o[s]=l}return[i,...o]}function si(...n){return function(e,t,i){const r=e[0];let o;for(let s=0;s<n.length;s++){const l=n[s](e,t,i);if(s==n.length-1){if(!l)throw new Error("expected last argument validator to return the parsed args");o=l}}return new RK(t,r,...o)}}function BK(n,e,t){const i=n[0],r=MK[i];if(!r)throw new Error(`unknown operator: ${i}`);return r(n,e,t)}function n4(n){if(!n)return"";const e=n.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return n4(n.getGeometries()[0]);default:return""}}function i4(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function sd(n,e,t){const i=No(n,e,t);return Ou(i)}function Ou(n,e){if(n instanceof co){if(n.type===wu&&typeof n.value=="string"){const i=_M(n.value);return function(){return i}}return function(){return n.value}}const t=n.operator;switch(t){case Rt.Number:case Rt.String:case Rt.Coalesce:return ZK(n);case Rt.Get:case Rt.Var:case Rt.Has:return WK(n);case Rt.Id:return i=>i.featureId;case Rt.GeometryType:return i=>i.geometryType;case Rt.Concat:{const i=n.args.map(r=>Ou(r));return r=>"".concat(...i.map(o=>o(r).toString()))}case Rt.Resolution:return i=>i.resolution;case Rt.Any:case Rt.All:case Rt.Between:case Rt.In:case Rt.Not:return UK(n);case Rt.Equal:case Rt.NotEqual:case Rt.LessThan:case Rt.LessThanOrEqualTo:case Rt.GreaterThan:case Rt.GreaterThanOrEqualTo:return zK(n);case Rt.Multiply:case Rt.Divide:case Rt.Add:case Rt.Subtract:case Rt.Clamp:case Rt.Mod:case Rt.Pow:case Rt.Abs:case Rt.Floor:case Rt.Ceil:case Rt.Round:case Rt.Sin:case Rt.Cos:case Rt.Atan:case Rt.Sqrt:return XK(n);case Rt.Case:return YK(n);case Rt.Match:return HK(n);case Rt.Interpolate:return KK(n);case Rt.ToString:return jK(n);default:throw new Error(`Unsupported operator ${t}`)}}function ZK(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let o=0;o<i;++o)r[o]=Ou(n.args[o]);switch(t){case Rt.Coalesce:return o=>{for(let s=0;s<i;++s){const l=r[s](o);if(typeof l<"u"&&l!==null)return l}throw new Error("Expected one of the values to be non-null")};case Rt.Number:case Rt.String:return o=>{for(let s=0;s<i;++s){const l=r[s](o);if(typeof l===t)return l}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function WK(n,e){const i=n.args[0].value;switch(n.operator){case Rt.Get:return r=>{const o=n.args;let s=r.properties[i];for(let l=1,u=o.length;l<u;++l){const d=o[l].value;s=s[d]}return s};case Rt.Var:return r=>r.variables[i];case Rt.Has:return r=>{const o=n.args;if(!(i in r.properties))return!1;let s=r.properties[i];for(let l=1,u=o.length;l<u;++l){const d=o[l].value;if(!s||!Object.hasOwn(s,d))return!1;s=s[d]}return!0};default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function zK(n,e){const t=n.operator,i=Ou(n.args[0]),r=Ou(n.args[1]);switch(t){case Rt.Equal:return o=>i(o)===r(o);case Rt.NotEqual:return o=>i(o)!==r(o);case Rt.LessThan:return o=>i(o)<r(o);case Rt.LessThanOrEqualTo:return o=>i(o)<=r(o);case Rt.GreaterThan:return o=>i(o)>r(o);case Rt.GreaterThanOrEqualTo:return o=>i(o)>=r(o);default:throw new Error(`Unsupported comparison operator ${t}`)}}function UK(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let o=0;o<i;++o)r[o]=Ou(n.args[o]);switch(t){case Rt.Any:return o=>{for(let s=0;s<i;++s)if(r[s](o))return!0;return!1};case Rt.All:return o=>{for(let s=0;s<i;++s)if(!r[s](o))return!1;return!0};case Rt.Between:return o=>{const s=r[0](o),l=r[1](o),u=r[2](o);return s>=l&&s<=u};case Rt.In:return o=>{const s=r[0](o);for(let l=1;l<i;++l)if(s===r[l](o))return!0;return!1};case Rt.Not:return o=>!r[0](o);default:throw new Error(`Unsupported logical operator ${t}`)}}function XK(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let o=0;o<i;++o)r[o]=Ou(n.args[o]);switch(t){case Rt.Multiply:return o=>{let s=1;for(let l=0;l<i;++l)s*=r[l](o);return s};case Rt.Divide:return o=>r[0](o)/r[1](o);case Rt.Add:return o=>{let s=0;for(let l=0;l<i;++l)s+=r[l](o);return s};case Rt.Subtract:return o=>r[0](o)-r[1](o);case Rt.Clamp:return o=>{const s=r[0](o),l=r[1](o);if(s<l)return l;const u=r[2](o);return s>u?u:s};case Rt.Mod:return o=>r[0](o)%r[1](o);case Rt.Pow:return o=>Math.pow(r[0](o),r[1](o));case Rt.Abs:return o=>Math.abs(r[0](o));case Rt.Floor:return o=>Math.floor(r[0](o));case Rt.Ceil:return o=>Math.ceil(r[0](o));case Rt.Round:return o=>Math.round(r[0](o));case Rt.Sin:return o=>Math.sin(r[0](o));case Rt.Cos:return o=>Math.cos(r[0](o));case Rt.Atan:return i===2?o=>Math.atan2(r[0](o),r[1](o)):o=>Math.atan(r[0](o));case Rt.Sqrt:return o=>Math.sqrt(r[0](o));default:throw new Error(`Unsupported numeric operator ${t}`)}}function YK(n,e){const t=n.args.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=Ou(n.args[r]);return r=>{for(let o=0;o<t-1;o+=2)if(i[o](r))return i[o+1](r);return i[t-1](r)}}function HK(n,e){const t=n.args.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=Ou(n.args[r]);return r=>{const o=i[0](r);for(let s=1;s<t-1;s+=2)if(o===i[s](r))return i[s+1](r);return i[t-1](r)}}function KK(n,e){const t=n.args.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=Ou(n.args[r]);return r=>{const o=i[0](r),s=i[1](r);let l,u;for(let h=2;h<t;h+=2){const d=i[h](r);let m=i[h+1](r);const y=Array.isArray(m);if(y&&(m=wK(m)),d>=s)return h===2?m:y?$K(o,s,l,u,d,m):M0(o,s,l,u,d,m);l=d,u=m}return u}}function jK(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let o=0;o<i;++o)r[o]=Ou(n.args[o]);switch(t){case Rt.ToString:return o=>{const s=r[0](o);return n.args[0].type===wu?vM(s):s.toString()};default:throw new Error(`Unsupported convert operator ${t}`)}}function M0(n,e,t,i,r,o){const s=r-t;if(s===0)return i;const l=e-t,u=n===1?l/s:(Math.pow(n,l)-1)/(Math.pow(n,s)-1);return i+u*(o-i)}function $K(n,e,t,i,r,o){if(r-t===0)return i;const l=eF(i),u=eF(o);let h=u[2]-l[2];h>180?h-=360:h<-180&&(h+=360);const d=[M0(n,e,t,l[0],r,u[0]),M0(n,e,t,l[1],r,u[1]),l[2]+M0(n,e,t,0,r,h),M0(n,e,t,i[3],r,o[3])];return AK(d)}const Sn={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class r4 extends mb{constructor(e,t,i,r){super(),this.extent=e,this.pixelRatio_=i,this.resolution=t,this.state=typeof r=="function"?Sn.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(Qn.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==Sn.IDLE&&this.loader){this.state=Sn.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;CD(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(i=>{"image"in i&&(this.image_=i.image),"extent"in i&&(this.extent=i.extent),"resolution"in i&&(this.resolution=i.resolution),"pixelRatio"in i&&(this.pixelRatio_=i.pixelRatio),(i instanceof HTMLImageElement||AD&&i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement)&&(this.image_=i),this.state=Sn.LOADED}).catch(i=>{this.state=Sn.ERROR,console.error(i)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function JK(n,e,t){const i=n;let r=!0,o=!1,s=!1;const l=[lC(i,Qn.LOAD,function(){s=!0,o||e()})];return i.src&&$R?(o=!0,i.decode().then(function(){r&&e()}).catch(function(u){r&&(s?e():t())})):l.push(lC(i,Qn.ERROR,t)),function(){r=!1,l.forEach(mr)}}function qK(n,e){return new Promise((t,i)=>{function r(){s(),t(n)}function o(){s(),i(new Error("Image load error"))}function s(){n.removeEventListener("load",r),n.removeEventListener("error",o)}n.addEventListener("load",r),n.addEventListener("error",o)})}function s4(n,e){return e&&(n.src=e),n.src&&$R?new Promise((t,i)=>n.decode().then(()=>t(n)).catch(r=>n.complete&&n.width?t(n):i(r))):qK(n)}function o4(n,e){return e&&(n.src=e),n.src&&$R&&AD?n.decode().then(()=>createImageBitmap(n)).catch(t=>{if(n.complete&&n.width)return n;throw t}):s4(n)}class QK{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];(e++&3)===0&&!i.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,i){const r=iS(e,t,i);return r in this.cache_?this.cache_[r]:null}getPattern(e,t,i){const r=iS(e,t,i);return r in this.patternCache_?this.patternCache_[r]:null}set(e,t,i,r,o){const s=iS(e,t,i),l=s in this.cache_;this.cache_[s]=r,o&&(r.getImageState()===Sn.IDLE&&r.load(),r.getImageState()===Sn.LOADING?r.ready().then(()=>{this.patternCache_[s]=fC().createPattern(r.getImage(1),"repeat")}):this.patternCache_[s]=fC().createPattern(r.getImage(1),"repeat")),l||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function iS(n,e,t){const i=t?$l(t):"null";return e+":"+n+":"+i}const Yl=new QK;let f0=null;class xM extends mb{constructor(e,t,i,r,o){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=o,this.imageState_=r===void 0?Sn.IDLE:r,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===Sn.LOADED){f0||(f0=ro(1,1,void 0,{willReadFrequently:!0})),f0.drawImage(this.image_,0,0);try{f0.getImageData(0,0,1,1),this.tainted_=!1}catch{f0=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Qn.CHANGE)}handleImageError_(){this.imageState_=Sn.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Sn.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=ro(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Sn.IDLE){this.image_||this.initializeImage_(),this.imageState_=Sn.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&s4(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==Sn.LOADED)return;const t=this.image_,i=ro(Math.ceil(t.width*e),Math.ceil(t.height*e)),r=i.canvas;i.scale(e,e),i.drawImage(t,0,0),i.globalCompositeOperation="multiply",i.fillStyle=IK(this.color_),i.fillRect(0,0,r.width/e,r.height/e),i.globalCompositeOperation="destination-in",i.drawImage(t,0,0),this.canvas_[e]=r}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===Sn.LOADED||this.imageState_===Sn.ERROR)e();else{const t=()=>{(this.imageState_===Sn.LOADED||this.imageState_===Sn.ERROR)&&(this.removeEventListener(Qn.CHANGE,t),e())};this.addEventListener(Qn.CHANGE,t)}})),this.ready_}}function yC(n,e,t,i,r,o){let s=e===void 0?void 0:Yl.get(e,t,r);return s||(s=new xM(n,n&&"src"in n?n.src||void 0:e,t,i,r),Yl.set(e,t,r,s,o)),o&&s&&!Yl.getPattern(e,t,r)&&Yl.set(e,t,r,s,o),s}function xc(n){return n?Array.isArray(n)?vM(n):typeof n=="object"&&"src"in n?ej(n):n:null}function ej(n){if(!n.offset||!n.size)return Yl.getPattern(n.src,"anonymous",n.color);const e=n.src+":"+n.offset,t=Yl.getPattern(e,void 0,n.color);if(t)return t;const i=Yl.get(n.src,"anonymous",null);if(i.getImageState()!==Sn.LOADED)return null;const r=ro(n.size[0],n.size[1]);return r.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),yC(r.canvas,e,void 0,Sn.LOADED,n.color,!0),Yl.getPattern(e,void 0,n.color)}const a4="10px sans-serif",za="#000",Ty="round",Vh=[],Bh=0,Ry="round",Nv=10,Dv="#000",Vv="center",_C="middle",Pp=[0,0,0,0],Bv=1,Pm=new nu;let p0=null,sF;const nT={},tj=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function nj(n,e,t){return`${n} ${e} 16px "${t}"`}const ij=(function(){let e,t;async function i(o){await t.ready;const s=await t.load(o);if(s.length===0)return!1;const l=dC(o),u=l.families[0].toLowerCase(),h=l.weight;return s.some(d=>{const m=d.family.replace(/^['"]|['"]$/g,"").toLowerCase(),y=qE[d.weight]||d.weight;return m===u&&d.style===l.style&&y==h})}async function r(){await t.ready;let o=!0;const s=Pm.getProperties(),l=Object.keys(s).filter(u=>s[u]<100);for(let u=l.length-1;u>=0;--u){const h=l[u];let d=s[h];d<100&&(await i(h)?(Wy(nT),Pm.set(h,100)):(d+=10,Pm.set(h,d,!0),d<100&&(o=!1)))}e=void 0,o||(e=setTimeout(r,100))}return async function(o){t||(t=Cl?self.fonts:document.fonts);const s=dC(o);if(!s)return;const l=s.families;let u=!1;for(const h of l){if(tj.has(h))continue;const d=nj(s.style,s.weight,h);Pm.get(d)===void 0&&(Pm.set(d,0,!0),u=!0)}u&&(clearTimeout(e),e=setTimeout(r,100))}})(),rj=(function(){let n;return function(e){let t=nT[e];if(t==null){if(Cl){const i=dC(e),r=l4(e,"g");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=e,document.body.appendChild(n),t=n.offsetHeight,document.body.removeChild(n);nT[e]=t}return t}})();function l4(n,e){return p0||(p0=ro(1,1)),n!=sF&&(p0.font=n,sF=p0.font),p0.measureText(e)}function u4(n,e){return l4(n,e).width}function oF(n,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((r,o)=>Math.max(r,u4(n,o)),0);return t[e]=i,i}function sj(n,e){const t=[],i=[],r=[];let o=0,s=0,l=0,u=0;for(let h=0,d=e.length;h<=d;h+=2){const m=e[h];if(m===`
`||h===d){o=Math.max(o,s),r.push(s),s=0,l+=u,u=0;continue}const y=e[h+1]||n.font,x=u4(y,m);t.push(x),s+=x;const C=rj(y);i.push(C),u=Math.max(u,C)}return{width:o,height:l,widths:t,heights:i,lineWidths:r}}function oj(n,e,t,i,r,o,s,l,u,h,d){n.save(),t!==1&&(n.globalAlpha===void 0?n.globalAlpha=m=>m.globalAlpha*=t:n.globalAlpha*=t),e&&n.transform.apply(n,e),i.contextInstructions?(n.translate(u,h),n.scale(d[0],d[1]),aj(i,n)):d[0]<0||d[1]<0?(n.translate(u,h),n.scale(d[0],d[1]),n.drawImage(i,r,o,s,l,0,0,s,l)):n.drawImage(i,r,o,s,l,u,h,s*d[0],l*d[1]),n.restore()}function aj(n,e){const t=n.contextInstructions;for(let i=0,r=t.length;i<r;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class vb{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=oa(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new vb({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Zn()}getImage(e){return Zn()}getHitDetectionImage(){return Zn()}getPixelRatio(e){return 1}getImageState(){return Zn()}getImageSize(){return Zn()}getOrigin(){return Zn()}getSize(){return Zn()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=oa(e)}listenImageChange(e){Zn()}load(){Zn()}unlistenImageChange(e){Zn()}ready(){return Promise.resolve()}}class bl extends vb{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?Sn.LOADING:Sn.LOADED,this.imageState_===Sn.LOADING&&this.ready().then(()=>this.imageState_=Sn.LOADED),this.render()}clone(){const e=this.getScale(),t=new bl({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){const t=this.fill_?.getKey(),i=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${t}`+Object.values(this.renderOptions_).join(",");let r=Yl.get(i,null,null)?.getImage(1);if(!r){const o=this.renderOptions_,s=Math.ceil(o.size*e),l=ro(s,s);this.draw_(o,l,e),r=l.canvas,Yl.set(i,null,null,new xM(r,void 0,null,Sn.LOADED,null))}return r}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let r=this.radius,o=this.radius2_===void 0?r:this.radius2_;if(r<o){const z=r;r=o,o=z}const s=this.radius2_===void 0?this.points_:this.points_*2,l=2*Math.PI/s,u=o*Math.sin(l),h=Math.sqrt(o*o-u*u),d=r-h,m=Math.sqrt(u*u+d*d),y=m/u;if(e==="miter"&&y<=i)return y*t;const x=t/2/y,C=t/2*(d/m),E=Math.sqrt((r+x)*(r+x)+C*C)-r;if(this.radius2_===void 0||e==="bevel")return E*2;const T=r*Math.sin(l),k=Math.sqrt(r*r-T*T),G=o-k,V=Math.sqrt(T*T+G*G)/T;if(V<=i){const z=V*t/2-o-r;return 2*Math.max(E,z)}return E*2}createRenderOptions(){let e=Ty,t=Ry,i=0,r=null,o=0,s,l=0;this.stroke_&&(s=xc(this.stroke_.getColor()??Dv),l=this.stroke_.getWidth()??Bv,r=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??Ry,e=this.stroke_.getLineCap()??Ty,i=this.stroke_.getMiterLimit()??Nv);const u=this.calculateLineJoinSize_(t,l,i),h=Math.max(this.radius,this.radius2_||0),d=Math.ceil(2*h+u);return{strokeStyle:s,strokeWidth:l,size:d,lineCap:e,lineDash:r,lineDashOffset:o,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let r=this.fill_.getColor();r===null&&(r=za),t.fillStyle=xc(r),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let i=this.fill_.getColor(),r=0;typeof i=="string"&&(i=$l(i)),i===null?r=1:Array.isArray(i)&&(r=i.length===4?i[3]:1),r===0&&(t=ro(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const i=this.radius;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const r=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const o=this.angle_-Math.PI/2,s=2*Math.PI/t;for(let l=0;l<t;l++){const u=o+l*s,h=l%2===0?i:r;e.lineTo(h*Math.cos(u),h*Math.sin(u))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=za,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class ms extends bl{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new ms({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius=e,this.render()}}class Di{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new Di({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=yC(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===Sn.IDLE&&t.load(),t.getImageState()===Sn.LOADING&&(this.patternImage_=t)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?Yn(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:$l(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function aF(n,e,t,i){return t!==void 0&&i!==void 0?[t/n,i/e]:t!==void 0?t/n:i!==void 0?i/e:1}class Nu extends vb{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,r=e.scale!==void 0?e.scale:1,o=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:r,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:o,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const s=e.img!==void 0?e.img:null;let l=e.src;gr(!(l!==void 0&&s),"`image` and `src` cannot be provided at the same time"),(l===void 0||l.length===0)&&s&&(l=s.src||Yn(s)),gr(l!==void 0&&l.length>0,"A defined and non-empty `src` or `image` must be provided"),gr(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let u;if(e.src!==void 0?u=Sn.IDLE:s!==void 0&&("complete"in s?s.complete?u=s.src?Sn.LOADED:Sn.IDLE:u=Sn.LOADING:u=Sn.LOADED),this.color_=e.color!==void 0?$l(e.color):null,this.iconImage_=yC(s,l,this.crossOrigin_,u,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let h,d;if(e.size)[h,d]=e.size;else{const m=this.getImage(1);if(m.width&&m.height)h=m.width,d=m.height;else if(m instanceof HTMLImageElement){this.initialOptions_=e;const y=()=>{if(this.unlistenImageChange(y),!this.initialOptions_)return;const x=this.iconImage_.getSize();this.setScale(aF(x[0],x[1],e.width,e.height))};this.listenImageChange(y);return}}h!==void 0&&this.setScale(aF(h,d,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new Nu({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=r[0]),this.anchorYUnits_=="fraction"&&(e[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+r[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}setSrc(e){this.iconImage_=yC(null,e,this.crossOrigin_,Sn.IDLE,this.color_)}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==Sn.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==Sn.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(Qn.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(Qn.CHANGE,e)}ready(){return this.iconImage_.ready()}}class bi{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new bi({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}class Hn{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=lF,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new Hn({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=lF,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function lj(n){let e;if(typeof n=="function")e=n;else{let t;Array.isArray(n)?t=n:(gr(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[n]),e=function(){return t}}return e}let rS=null;function IM(n,e){if(!rS){const t=new Di({color:"rgba(255,255,255,0.4)"}),i=new bi({color:"#3399CC",width:1.25});rS=[new Hn({image:new ms({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return rS}function CM(){const n={},e=[255,255,255,1],t=[0,153,255,1],i=3;return n.Polygon=[new Hn({fill:new Di({color:[255,255,255,.5]})})],n.MultiPolygon=n.Polygon,n.LineString=[new Hn({stroke:new bi({color:e,width:i+2})}),new Hn({stroke:new bi({color:t,width:i})})],n.MultiLineString=n.LineString,n.Circle=n.Polygon.concat(n.LineString),n.Point=[new Hn({image:new ms({radius:i*2,fill:new Di({color:t}),stroke:new bi({color:e,width:i/2})}),zIndex:1/0})],n.MultiPoint=n.Point,n.GeometryCollection=n.Polygon.concat(n.LineString,n.Point),n}function lF(n){return n.getGeometry()}const uj="#333";class Wc{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=oa(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new Di({color:uj}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Wc({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()instanceof Di?this.getFill().clone():this.getFill(),stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=oa(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}function cj(n){return!0}function hj(n){const e=t4(),t=dj(n,e),i=i4();return function(r,o){if(i.properties=r.getPropertiesInternal(),i.resolution=o,e.featureId){const s=r.getId();s!==void 0?i.featureId=s:i.featureId=null}return e.geometryType&&(i.geometryType=n4(r.getGeometry())),t(i)}}function uF(n){const e=t4(),t=n.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=iT(n[s],e);const r=i4(),o=new Array(t);return function(s,l){if(r.properties=s.getPropertiesInternal(),r.resolution=l,e.featureId){const h=s.getId();h!==void 0?r.featureId=h:r.featureId=null}let u=0;for(let h=0;h<t;++h){const d=i[h](r);d&&(o[u]=d,u+=1)}return o.length=u,o}}function dj(n,e){const t=n.length,i=new Array(t);for(let r=0;r<t;++r){const o=n[r],s="filter"in o?sd(o.filter,xa,e):cj;let l;if(Array.isArray(o.style)){const u=o.style.length;l=new Array(u);for(let h=0;h<u;++h)l[h]=iT(o.style[h],e)}else l=[iT(o.style,e)];i[r]={filter:s,styles:l}}return function(r){const o=[];let s=!1;for(let l=0;l<t;++l){const u=i[l].filter;if(u(r)&&!(n[l].else&&s)){s=!0;for(const h of i[l].styles){const d=h(r);d&&o.push(d)}}}return o}}function iT(n,e){const t=Zv(n,"",e),i=Wv(n,"",e),r=fj(n,e),o=pj(n,e),s=Xa(n,"z-index",e);if(!t&&!i&&!r&&!o&&!jp(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const l=new Hn;return function(u){let h=!0;if(t){const d=t(u);d&&(h=!1),l.setFill(d)}if(i){const d=i(u);d&&(h=!1),l.setStroke(d)}if(r){const d=r(u);d&&(h=!1),l.setText(d)}if(o){const d=o(u);d&&(h=!1),l.setImage(d)}return s&&l.setZIndex(s(u)),h?null:l}}function Zv(n,e,t){let i;if(e+"fill-pattern-src"in n)i=_j(n,e+"fill-",t);else{if(n[e+"fill-color"]==="none")return o=>null;i=wM(n,e+"fill-color",t)}if(!i)return null;const r=new Di;return function(o){const s=i(o);return s===yM?null:(r.setColor(s),r)}}function Wv(n,e,t){const i=Xa(n,e+"stroke-width",t),r=wM(n,e+"stroke-color",t);if(!i&&!r)return null;const o=Sh(n,e+"stroke-line-cap",t),s=Sh(n,e+"stroke-line-join",t),l=c4(n,e+"stroke-line-dash",t),u=Xa(n,e+"stroke-line-dash-offset",t),h=Xa(n,e+"stroke-miter-limit",t),d=new bi;return function(m){if(r){const y=r(m);if(y===yM)return null;d.setColor(y)}if(i&&d.setWidth(i(m)),o){const y=o(m);if(y!=="butt"&&y!=="round"&&y!=="square")throw new Error("Expected butt, round, or square line cap");d.setLineCap(y)}if(s){const y=s(m);if(y!=="bevel"&&y!=="round"&&y!=="miter")throw new Error("Expected bevel, round, or miter line join");d.setLineJoin(y)}return l&&d.setLineDash(l(m)),u&&d.setLineDashOffset(u(m)),h&&d.setMiterLimit(h(m)),d}}function fj(n,e){const t="text-",i=Sh(n,t+"value",e);if(!i)return null;const r=Zv(n,t,e),o=Zv(n,t+"background-",e),s=Wv(n,t,e),l=Wv(n,t+"background-",e),u=Sh(n,t+"font",e),h=Xa(n,t+"max-angle",e),d=Xa(n,t+"offset-x",e),m=Xa(n,t+"offset-y",e),y=ly(n,t+"overflow",e),x=Sh(n,t+"placement",e),C=Xa(n,t+"repeat",e),w=tA(n,t+"scale",e),E=ly(n,t+"rotate-with-view",e),T=Xa(n,t+"rotation",e),k=Sh(n,t+"align",e),G=Sh(n,t+"justify",e),O=Sh(n,t+"baseline",e),V=ly(n,t+"keep-upright",e),z=c4(n,t+"padding",e),H=nA(n,t+"declutter-mode"),te=new Wc({declutterMode:H});return function($){if(te.setText(i($)),r&&te.setFill(r($)),o&&te.setBackgroundFill(o($)),s&&te.setStroke(s($)),l&&te.setBackgroundStroke(l($)),u&&te.setFont(u($)),h&&te.setMaxAngle(h($)),d&&te.setOffsetX(d($)),m&&te.setOffsetY(m($)),y&&te.setOverflow(y($)),x){const ae=x($);if(ae!=="point"&&ae!=="line")throw new Error("Expected point or line for text-placement");te.setPlacement(ae)}if(C&&te.setRepeat(C($)),w&&te.setScale(w($)),E&&te.setRotateWithView(E($)),T&&te.setRotation(T($)),k){const ae=k($);if(ae!=="left"&&ae!=="center"&&ae!=="right"&&ae!=="end"&&ae!=="start")throw new Error("Expected left, right, center, start, or end for text-align");te.setTextAlign(ae)}if(G){const ae=G($);if(ae!=="left"&&ae!=="right"&&ae!=="center")throw new Error("Expected left, right, or center for text-justify");te.setJustify(ae)}if(O){const ae=O($);if(ae!=="bottom"&&ae!=="top"&&ae!=="middle"&&ae!=="alphabetic"&&ae!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");te.setTextBaseline(ae)}return z&&te.setPadding(z($)),V&&te.setKeepUpright(V($)),te}}function pj(n,e){return"icon-src"in n?gj(n,e):"shape-points"in n?mj(n,e):"circle-radius"in n?yj(n,e):null}function gj(n,e){const t="icon-",i=t+"src",r=h4(n[i],i),o=vC(n,t+"anchor",e),s=tA(n,t+"scale",e),l=Xa(n,t+"opacity",e),u=vC(n,t+"displacement",e),h=Xa(n,t+"rotation",e),d=ly(n,t+"rotate-with-view",e),m=hF(n,t+"anchor-origin"),y=dF(n,t+"anchor-x-units"),x=dF(n,t+"anchor-y-units"),C=Ij(n,t+"color"),w=bj(n,t+"cross-origin"),E=xj(n,t+"offset"),T=hF(n,t+"offset-origin"),k=bC(n,t+"width"),G=bC(n,t+"height"),O=vj(n,t+"size"),V=nA(n,t+"declutter-mode"),z=new Nu({src:r,anchorOrigin:m,anchorXUnits:y,anchorYUnits:x,color:C,crossOrigin:w,offset:E,offsetOrigin:T,height:G,width:k,size:O,declutterMode:V});return function(H){return l&&z.setOpacity(l(H)),u&&z.setDisplacement(u(H)),h&&z.setRotation(h(H)),d&&z.setRotateWithView(d(H)),s&&z.setScale(s(H)),o&&z.setAnchor(o(H)),z}}function mj(n,e){const t="shape-",i=t+"points",r=t+"radius",o=rT(n[i],i),s=rT(n[r],r),l=Zv(n,t,e),u=Wv(n,t,e),h=tA(n,t+"scale",e),d=vC(n,t+"displacement",e),m=Xa(n,t+"rotation",e),y=ly(n,t+"rotate-with-view",e),x=bC(n,t+"radius2"),C=bC(n,t+"angle"),w=nA(n,t+"declutter-mode"),E=new bl({points:o,radius:s,radius2:x,angle:C,declutterMode:w});return function(T){return l&&E.setFill(l(T)),u&&E.setStroke(u(T)),d&&E.setDisplacement(d(T)),m&&E.setRotation(m(T)),y&&E.setRotateWithView(y(T)),h&&E.setScale(h(T)),E}}function yj(n,e){const t="circle-",i=Zv(n,t,e),r=Wv(n,t,e),o=Xa(n,t+"radius",e),s=tA(n,t+"scale",e),l=vC(n,t+"displacement",e),u=Xa(n,t+"rotation",e),h=ly(n,t+"rotate-with-view",e),d=nA(n,t+"declutter-mode"),m=new ms({radius:5,declutterMode:d});return function(y){return o&&m.setRadius(o(y)),i&&m.setFill(i(y)),r&&m.setStroke(r(y)),l&&m.setDisplacement(l(y)),u&&m.setRotation(u(y)),h&&m.setRotateWithView(h(y)),s&&m.setScale(s(y)),m}}function Xa(n,e,t){if(!(e in n))return;const i=sd(n[e],Hi,t);return function(r){return rT(i(r),e)}}function Sh(n,e,t){if(!(e in n))return null;const i=sd(n[e],Wa,t);return function(r){return h4(i(r),e)}}function _j(n,e,t){const i=Sh(n,e+"pattern-src",t),r=cF(n,e+"pattern-offset",t),o=cF(n,e+"pattern-size",t),s=wM(n,e+"color",t);return function(l){return{src:i(l),offset:r&&r(l),size:o&&o(l),color:s&&s(l)}}}function ly(n,e,t){if(!(e in n))return null;const i=sd(n[e],xa,t);return function(r){const o=i(r);if(typeof o!="boolean")throw new Error(`Expected a boolean for ${e}`);return o}}function wM(n,e,t){if(!(e in n))return null;const i=sd(n[e],wu,t);return function(r){return d4(i(r),e)}}function c4(n,e,t){if(!(e in n))return null;const i=sd(n[e],eg,t);return function(r){return bb(i(r),e)}}function vC(n,e,t){if(!(e in n))return null;const i=sd(n[e],eg,t);return function(r){const o=bb(i(r),e);if(o.length!==2)throw new Error(`Expected two numbers for ${e}`);return o}}function cF(n,e,t){if(!(e in n))return null;const i=sd(n[e],eg,t);return function(r){return f4(i(r),e)}}function tA(n,e,t){if(!(e in n))return null;const i=sd(n[e],eg|Hi,t);return function(r){return Cj(i(r),e)}}function bC(n,e){const t=n[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function vj(n,e){const t=n[e];if(t!==void 0){if(typeof t=="number")return oa(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function bj(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function hF(n,e){const t=n[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function dF(n,e){const t=n[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function xj(n,e){const t=n[e];if(t!==void 0)return bb(t,e)}function nA(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function Ij(n,e){const t=n[e];if(t!==void 0)return d4(t,e)}function bb(n,e){if(!Array.isArray(n))throw new Error(`Expected an array for ${e}`);const t=n.length;for(let i=0;i<t;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return n}function h4(n,e){if(typeof n!="string")throw new Error(`Expected a string for ${e}`);return n}function rT(n,e){if(typeof n!="number")throw new Error(`Expected a number for ${e}`);return n}function d4(n,e){if(typeof n=="string")return n;const t=bb(n,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function f4(n,e){const t=bb(n,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function Cj(n,e){return typeof n=="number"?n:f4(n,e)}const fF={RENDER_ORDER:"renderOrder"};class AM extends pg{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(fF.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const i=this.getDeclutter();i in e.declutter||(e.declutter[i]=new QD(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(fF.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?IM:e;const t=wj(e);this.styleFunction_=e===null?void 0:lj(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}}function wj(n){if(n===void 0)return IM;if(!n)return null;if(typeof n=="function"||n instanceof Hn)return n;if(!Array.isArray(n))return uF([n]);if(n.length===0)return[];const e=n.length,t=n[0];if(t instanceof Hn){const r=new Array(e);for(let o=0;o<e;++o){const s=n[o];if(!(s instanceof Hn))throw new Error("Expected a list of style instances");r[o]=s}return r}if("style"in t){const r=new Array(e);for(let o=0;o<e;++o){const s=n[o];if(!("style"in s))throw new Error("Expected a list of rules with a style property");r[o]=s}return hj(r)}return uF(n)}class p4 extends Vo{constructor(e,t,i,r){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=r}}class Aj extends Kw{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){Zn()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;Fu(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),RD(r,i)}forEachFeatureAtCoordinate(e,t,i,r,o,s,l,u){let h;const d=t.viewState;function m(O,V,z,H){return o.call(s,V,O?z:null,H)}const y=d.projection,x=zw(e.slice(),y),C=[[0,0]];if(y.canWrapX()&&r){const O=y.getExtent(),V=Bi(O);C.push([-V,0],[V,0])}const w=t.layerStatesArray,E=w.length,T=[],k=[];for(let O=0;O<C.length;O++)for(let V=E-1;V>=0;--V){const z=w[V],H=z.layer;if(H.hasRenderer()&&mM(z,d)&&l.call(u,H)){const te=H.getRenderer(),$=H.getSource();if(te&&$){const ae=$.getWrapX()?x:e,fe=m.bind(null,z.managed);k[0]=ae[0]+C[O][0],k[1]=ae[1]+C[O][1],h=te.forEachFeatureAtCoordinate(k,t,i,fe,T)}if(h)return h}}if(T.length===0)return;const G=1/T.length;return T.forEach((O,V)=>O.distanceSq+=V*G),T.sort((O,V)=>O.distanceSq-V.distanceSq),T.some(O=>h=O.callback(O.feature,O.layer,O.geometry)),h}hasFeatureAtCoordinate(e,t,i,r,o,s){return this.forEachFeatureAtCoordinate(e,t,i,r,gf,this,o,s)!==void 0}getMap(){return this.map_}renderFrame(e){Zn()}scheduleExpireIconCache(e){Yl.canExpireCache()&&e.postRenderFunctions.push(Sj)}}function Sj(n,e){Yl.expire()}class Ej extends Aj{constructor(e){super(e),this.fontChangeListenerKey_=mn(Pm,qp.PROPERTYCHANGE,e.redrawText,e),this.element_=Cl?UD():document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Bc+" ol-layers";const i=e.getViewport();i&&i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const r=new p4(e,void 0,t);i.dispatchEvent(r)}}disposeInternal(){mr(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(ja.PRECOMPOSE,e);const t=e.layerStatesArray.sort((h,d)=>h.zIndex-d.zIndex);t.some(h=>h.layer instanceof AM&&h.layer.getDeclutter())&&(e.declutter={});const r=e.viewState;this.children_.length=0;const o=[];let s=null;for(let h=0,d=t.length;h<d;++h){const m=t[h];e.layerIndex=h;const y=m.layer,x=y.getSourceState();if(!mM(m,r)||x!="ready"&&x!="undefined"){y.unrender();continue}const C=y.render(e,s);C&&(C!==s&&(this.children_.push(C),s=C),o.push(m))}this.declutter(e,o),BH(this.element_,this.children_);const u=this.getMap().getTargetElement();if($d(u)){const h=u.getContext("2d");for(const d of this.children_){const m=d.firstElementChild||d,y=d.style.backgroundColor;if(y&&(!$d(m)||m.width>0)&&(h.fillStyle=y,h.fillRect(0,0,u.width,u.height)),$d(m)&&m.width>0){const x=d.style.opacity||m.style.opacity;h.globalAlpha=x===""?1:Number(x);const C=m.style.transform;if(C)h.setTransform(...KE(C));else{const w=parseFloat(m.style.width)/m.width,E=parseFloat(m.style.height)/m.height;h.setTransform(w,0,0,E,0,0)}h.drawImage(m,0,0)}}h.globalAlpha=1,h.setTransform(1,0,0,1,0,0)}this.dispatchRenderEvent(ja.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let i=t.length-1;i>=0;--i){const r=t[i],o=r.layer;o.getDeclutter()&&o.renderDeclutter(e,r)}t.forEach(i=>i.layer.renderDeferred(e))}}}function g4(n){if(n instanceof pg){n.setMapInternal(null);return}n instanceof Sf&&n.getLayers().forEach(g4)}function m4(n,e){if(n instanceof pg){n.setMapInternal(e);return}if(n instanceof Sf){const t=n.getLayers().getArray();for(let i=0,r=t.length;i<r;++i)m4(t[i],e)}}let Tj=class extends nu{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=Rj(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:wD,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=qa(),this.pixelToCoordinateTransform_=qa(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,Cl||(this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_)),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,Cl||(this.resizeObserver_=new ResizeObserver(()=>this.updateSize())),this.controls=t.controls||(Cl?new Ts:WH()),this.interactions=t.interactions||(Cl?new Ts:cK({onFocusOnly:!0})),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new QY(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(xo.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(xo.VIEW,this.handleViewChanged_),this.addChangeListener(xo.SIZE,this.handleSizeChanged_),this.addChangeListener(xo.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof yc)&&e.view.then(function(r){i.setView(new yc(r))}),this.controls.addEventListener(eo.ADD,r=>{r.element.setMap(this)}),this.controls.addEventListener(eo.REMOVE,r=>{r.element.setMap(null)}),this.interactions.addEventListener(eo.ADD,r=>{r.element.setMap(this)}),this.interactions.addEventListener(eo.REMOVE,r=>{r.element.setMap(null)}),this.overlays_.addEventListener(eo.ADD,r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener(eo.REMOVE,r=>{const o=r.element.getId();o!==void 0&&delete this.overlayIdIndex_[o.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){m4(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_?.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const o=i.hitTolerance!==void 0?i.hitTolerance:0,s=i.layerFilter!==void 0?i.layerFilter:gf,l=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,o,l,t,null,s,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(r){i.push(r)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(r){r instanceof Sf?t(r.getLayers()):e.push(r)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const r=t.layerFilter!==void 0?t.layerFilter:gf,o=t.hitTolerance!==void 0?t.hitTolerance:0,s=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,o,s,r,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),r=this.getSize(),o=i.width/r[0],s=i.height/r[1],l="changedTouches"in e?e.changedTouches[0]:e;return[(l.clientX-i.left)/o,(l.clientY-i.top)/s]}getTarget(){return this.get(xo.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Jp(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?Vs(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(xo.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof Ts){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const r=e[t];if(!r.visible)continue;const o=r.layer.getRenderer();if(o&&!o.ready)return!0;const s=r.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(e){const t=fs(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?Vs(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(xo.SIZE)}getView(){return this.get(xo.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,r){return eH(this.frameState_,e,t,i,r)}handleBrowserEvent(e,t){t=t||e.type;const i=new gc(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===Gv.POINTERDOWN||i===Qn.WHEEL||i===Qn.KEYDOWN){const r=this.getOwnerDocument(),o=this.viewport_.getRootNode?this.viewport_.getRootNode():r,s=t.target,l=o instanceof ShadowRoot?o.host===s?o.host.ownerDocument:o:o===r?r.documentElement:o;if(this.overlayContainerStopEvent_.contains(s)||!l.contains(s))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const r=this.getInteractions().getArray().slice();for(let o=r.length-1;o>=0;o--){const s=r[o];if(s.getMap()!==this||!s.getActive()||!this.getTargetElement())continue;if(!s.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let r=this.maxTilesLoading_,o=r;if(e){const s=e.viewHints;if(s[Jr.ANIMATING]||s[Jr.INTERACTING]){const l=Date.now()-e.time>8;r=l?0:8,o=l?0:2}}t.getTilesLoading()<r&&(t.reprioritize(),t.loadMoreTiles(r,o))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(ja.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(ja.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new km(wh.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new km(wh.LOADSTART,this,e))));const i=this.postRenderFunctions_;if(e)for(let r=0,o=i.length;r<o;++r)i[r](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,r=this.targetChangeHandlerKeys_.length;i<r;++i)mr(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Qn.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(Qn.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_&&!$d(this.targetElement_)){this.resizeObserver_?.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{if($d(t)||t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Ej(this)),!$d(t)){this.mapBrowserEventHandler_=new JY(this,this.moveTolerance_);for(const r in Vi)this.mapBrowserEventHandler_.addEventListener(Vi[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Qn.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(Qn.WHEEL,this.boundHandleBrowserEvent_,SD?{passive:!1}:!1);let i;if(this.keyboardEventTarget_)i=this.keyboardEventTarget_;else{const r=t.getRootNode();i=r instanceof ShadowRoot?r.host:t}if(this.targetChangeHandlerKeys_=[mn(i,Qn.KEYDOWN,this.handleBrowserEvent,this),mn(i,Qn.KEYPRESS,this.handleBrowserEvent,this)],t instanceof HTMLElement){const r=t.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_?.observe(t)}}this.updateSize()}}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(mr(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(mr(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=mn(e,qp.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=mn(e,Qn.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(mr),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Zd("addlayer",e)),this.layerGroupPropertyListenerKeys_=[mn(e,qp.PROPERTYCHANGE,this.render,this),mn(e,Qn.CHANGE,this.render,this),mn(e,"addlayer",this.handleLayerAdd_,this),mn(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const e=this.frameState_.layerStatesArray;for(let t=0,i=e.length;t<i;++t){const r=e[t].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){g4(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),r=this.frameState_;let o=null;if(t!==void 0&&tF(t)&&i&&i.isDef()){const s=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=i.getState();if(o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:kv(l.center,l.resolution,l.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:l,viewHints:s,wantedTiles:{},mapId:Yn(this),renderTargets:{}},l.nextCenter&&l.nextResolution){const u=isNaN(l.nextRotation)?l.rotation:l.nextRotation;o.nextExtent=kv(l.nextCenter,l.nextResolution,u,t)}}this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),r&&(!this.previousExtent_||!dg(this.previousExtent_)&&!Hp(o.extent,this.previousExtent_))&&(this.dispatchEvent(new km(wh.MOVESTART,this,r)),this.previousExtent_=By(this.previousExtent_)),this.previousExtent_&&!o.viewHints[Jr.ANIMATING]&&!o.viewHints[Jr.INTERACTING]&&!Hp(o.extent,this.previousExtent_)&&(this.dispatchEvent(new km(wh.MOVEEND,this,o)),uD(o.extent,this.previousExtent_))),this.dispatchEvent(new km(wh.POSTRENDER,this,o)),this.renderComplete_=(this.hasListener(wh.LOADSTART)||this.hasListener(wh.LOADEND)||this.hasListener(ja.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Zd("removelayer",t)),this.set(xo.LAYERGROUP,e)}setSize(e){this.set(xo.SIZE,e)}setTarget(e){this.set(xo.TARGET,e)}setView(e){if(!e||e instanceof yc){this.set(xo.VIEW,e);return}this.set(xo.VIEW,new yc);const t=this;e.then(function(i){t.setView(new yc(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){let r,o;if($d(e))r=e.width,o=e.height;else{const s=getComputedStyle(e);r=e.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=e.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth)}!isNaN(r)&&!isNaN(o)&&(t=[Math.max(0,r),Math.max(0,o)],!tF(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&lD("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!id(t,i))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function Rj(n){let e=null;n.keyboardEventTarget!==void 0&&(e=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const t={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new Sf({layers:n.layers});t[xo.LAYERGROUP]=i,t[xo.TARGET]=n.target,t[xo.VIEW]=n.view instanceof yc?n.view:new yc;let r;n.controls!==void 0&&(Array.isArray(n.controls)?r=new Ts(n.controls.slice()):(gr(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=n.controls));let o;n.interactions!==void 0&&(Array.isArray(n.interactions)?o=new Ts(n.interactions.slice()):(gr(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),o=n.interactions));let s;return n.overlays!==void 0?Array.isArray(n.overlays)?s=new Ts(n.overlays.slice()):(gr(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),s=n.overlays):s=new Ts,{controls:r,interactions:o,keyboardEventTarget:e,overlays:s,values:t}}var Jd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function y4(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fI={exports:{}},Mj=fI.exports,pF;function kj(){return pF||(pF=1,(function(n,e){(function(t,i){n.exports=i()})(Mj,(function(){var t,i,r;function o(s,l){if(!t)t=l;else if(!i)i=l;else{var u="var sharedChunk = {}; ("+t+")(sharedChunk); ("+i+")(sharedChunk);",h={};t(h),r=l(h),typeof window<"u"&&(r.workerUrl=window.URL.createObjectURL(new Blob([u],{type:"text/javascript"})))}}return o(["exports"],(function(s){function l(a,c){return a(c={exports:{}},c.exports),c.exports}var u=h;function h(a,c,f,v){this.cx=3*a,this.bx=3*(f-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(v-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=v,this.p2x=f,this.p2y=v}h.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},h.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},h.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},h.prototype.solveCurveX=function(a,c){var f,v,I,A,R;for(c===void 0&&(c=1e-6),I=a,R=0;R<8;R++){if(A=this.sampleCurveX(I)-a,Math.abs(A)<c)return I;var N=this.sampleCurveDerivativeX(I);if(Math.abs(N)<1e-6)break;I-=A/N}if((I=a)<(f=0))return f;if(I>(v=1))return v;for(;f<v;){if(A=this.sampleCurveX(I),Math.abs(A-a)<c)return I;a>A?f=I:v=I,I=.5*(v-f)+f}return I},h.prototype.solve=function(a,c){return this.sampleCurveY(this.solveCurveX(a,c))};var d=m;function m(a,c){this.x=a,this.y=c}m.prototype={clone:function(){return new m(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,c){return this.clone()._rotateAround(a,c)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var c=a.x-this.x,f=a.y-this.y;return c*c+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,c){return Math.atan2(this.x*c-this.y*a,this.x*a+this.y*c)},_matMult:function(a){var c=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=c,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var c=Math.cos(a),f=Math.sin(a),v=f*this.x+c*this.y;return this.x=c*this.x-f*this.y,this.y=v,this},_rotateAround:function(a,c){var f=Math.cos(a),v=Math.sin(a),I=c.y+v*(this.x-c.x)+f*(this.y-c.y);return this.x=c.x+f*(this.x-c.x)-v*(this.y-c.y),this.y=I,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},m.convert=function(a){return a instanceof m?a:Array.isArray(a)?new m(a[0],a[1]):a};var y=typeof self<"u"?self:{},x=Math.pow(2,53)-1;function C(a,c,f,v){var I=new u(a,c,f,v);return function(A){return I.solve(A)}}var w=C(.25,.1,.25,1);function E(a,c,f){return Math.min(f,Math.max(c,a))}function T(a,c,f){var v=f-c,I=((a-c)%v+v)%v+c;return I===c?f:I}function k(a){for(var c=[],f=arguments.length-1;f-- >0;)c[f]=arguments[f+1];for(var v=0,I=c;v<I.length;v+=1){var A=I[v];for(var R in A)a[R]=A[R]}return a}var G=1;function O(){return G++}function V(){return(function a(c){return c?(c^16*Math.random()>>c/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)})()}function z(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function H(a,c){a.forEach((function(f){c[f]&&(c[f]=c[f].bind(c))}))}function te(a,c){return a.indexOf(c,a.length-c.length)!==-1}function $(a,c,f){var v={};for(var I in a)v[I]=c.call(f||this,a[I],I,a);return v}function ae(a,c,f){var v={};for(var I in a)c.call(f||this,a[I],I,a)&&(v[I]=a[I]);return v}function fe(a){return Array.isArray(a)?a.map(fe):typeof a=="object"&&a?$(a,fe):a}var Y={};function de(a){Y[a]||(typeof console<"u"&&console.warn(a),Y[a]=!0)}function D(a,c,f){return(f.y-a.y)*(c.x-a.x)>(c.y-a.y)*(f.x-a.x)}function oe(a){for(var c=0,f=0,v=a.length,I=v-1,A=void 0,R=void 0;f<v;I=f++)c+=((R=a[I]).x-(A=a[f]).x)*(A.y+R.y);return c}function ue(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ge(a){var c={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(v,I,A,R){var N=A||R;return c[I]=!N||N.toLowerCase(),""})),c["max-age"]){var f=parseInt(c["max-age"],10);isNaN(f)?delete c["max-age"]:c["max-age"]=f}return c}var Ne=null;function Ee(a){if(Ne==null){var c=a.navigator?a.navigator.userAgent:null;Ne=!!a.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Ne}function se(a){try{var c=y[a];return c.setItem("_mapbox_test_",1),c.removeItem("_mapbox_test_"),!0}catch{return!1}}var q,j,ze,je,qe=y.performance&&y.performance.now?y.performance.now.bind(y.performance):Date.now.bind(Date),yt=y.requestAnimationFrame||y.mozRequestAnimationFrame||y.webkitRequestAnimationFrame||y.msRequestAnimationFrame,xt=y.cancelAnimationFrame||y.mozCancelAnimationFrame||y.webkitCancelAnimationFrame||y.msCancelAnimationFrame,Et={now:qe,frame:function(a){var c=yt(a);return{cancel:function(){return xt(c)}}},getImageData:function(a,c){c===void 0&&(c=0);var f=y.document.createElement("canvas"),v=f.getContext("2d");if(!v)throw new Error("failed to create canvas 2d context");return f.width=a.width,f.height=a.height,v.drawImage(a,0,0,a.width,a.height),v.getImageData(-c,-c,a.width+2*c,a.height+2*c)},resolveURL:function(a){return q||(q=y.document.createElement("a")),q.href=a,q.href},hardwareConcurrency:y.navigator&&y.navigator.hardwareConcurrency||4,get devicePixelRatio(){return y.devicePixelRatio},get prefersReducedMotion(){return!!y.matchMedia&&(j==null&&(j=y.matchMedia("(prefers-reduced-motion: reduce)")),j.matches)}},kt={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},hn={supported:!1,testSupport:function(a){!wn&&je&&(Ge?ve(a):ze=a)}},wn=!1,Ge=!1;function ve(a){var c=a.createTexture();a.bindTexture(a.TEXTURE_2D,c);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,je),a.isContextLost())return;hn.supported=!0}catch{}a.deleteTexture(c),wn=!0}y.document&&((je=y.document.createElement("img")).onload=function(){ze&&ve(ze),ze=null,Ge=!0},je.onerror=function(){wn=!0,ze=null},je.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var W="01",Ze=function(a,c){this._transformRequestFn=a,this._customAccessToken=c,this._createSkuToken()};function Re(a){return a.indexOf("mapbox:")===0}Ze.prototype._createSkuToken=function(){var a=(function(){for(var c="",f=0;f<10;f++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",W,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},Ze.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ze.prototype.transformRequest=function(a,c){return this._transformRequestFn&&this._transformRequestFn(a,c)||{url:a}},Ze.prototype.normalizeStyleURL=function(a,c){if(!Re(a))return a;var f=Ie(a);return f.path="/styles/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||c)},Ze.prototype.normalizeGlyphsURL=function(a,c){if(!Re(a))return a;var f=Ie(a);return f.path="/fonts/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||c)},Ze.prototype.normalizeSourceURL=function(a,c){if(!Re(a))return a;var f=Ie(a);return f.path="/v4/"+f.authority+".json",f.params.push("secure"),this._makeAPIURL(f,this._customAccessToken||c)},Ze.prototype.normalizeSpriteURL=function(a,c,f,v){var I=Ie(a);return Re(a)?(I.path="/styles/v1"+I.path+"/sprite"+c+f,this._makeAPIURL(I,this._customAccessToken||v)):(I.path+=""+c+f,pe(I))},Ze.prototype.normalizeTileURL=function(a,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Re(a))return a;var f=Ie(a);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Et.devicePixelRatio>=2||c===512?"@2x":"")+(hn.supported?".webp":"$1")),f.path=f.path.replace(/^.+\/v4\//,"/"),f.path="/v4"+f.path;var v=this._customAccessToken||(function(I){for(var A=0,R=I;A<R.length;A+=1){var N=R[A].match(/^access_token=(.*)$/);if(N)return N[1]}return null})(f.params)||kt.ACCESS_TOKEN;return kt.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&f.params.push("sku="+this._skuToken),this._makeAPIURL(f,v)},Ze.prototype.canonicalizeTileURL=function(a,c){var f=Ie(a);if(!f.path.match(/(^\/v4\/)/)||!f.path.match(/\.[\w]+$/))return a;var v="mapbox://tiles/";v+=f.path.replace("/v4/","");var I=f.params;return c&&(I=I.filter((function(A){return!A.match(/^access_token=/)}))),I.length&&(v+="?"+I.join("&")),v},Ze.prototype.canonicalizeTileset=function(a,c){for(var f=!!c&&Re(c),v=[],I=0,A=a.tiles||[];I<A.length;I+=1){var R=A[I];me(R)?v.push(this.canonicalizeTileURL(R,f)):v.push(R)}return v},Ze.prototype._makeAPIURL=function(a,c){var f="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",v=Ie(kt.API_URL);if(a.protocol=v.protocol,a.authority=v.authority,a.protocol==="http"){var I=a.params.indexOf("secure");I>=0&&a.params.splice(I,1)}if(v.path!=="/"&&(a.path=""+v.path+a.path),!kt.REQUIRE_ACCESS_TOKEN)return pe(a);if(!(c=c||kt.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+f);if(c[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+f);return a.params=a.params.filter((function(A){return A.indexOf("access_token")===-1})),a.params.push("access_token="+c),pe(a)};var ce=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function me(a){return ce.test(a)}var _e=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ie(a){var c=a.match(_e);if(!c)throw new Error("Unable to parse URL object");return{protocol:c[1],authority:c[2],path:c[3]||"/",params:c[4]?c[4].split("&"):[]}}function pe(a){var c=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+c}function Te(a){if(!a)return null;var c=a.split(".");if(!c||c.length!==3)return null;try{return JSON.parse(decodeURIComponent(y.atob(c[1]).split("").map((function(f){return"%"+("00"+f.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch{return null}}var We=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};We.prototype.getStorageKey=function(a){var c,f=Te(kt.ACCESS_TOKEN);return c=f&&f.u?y.btoa(encodeURIComponent(f.u).replace(/%([0-9A-F]{2})/g,(function(v,I){return String.fromCharCode(+("0x"+I))}))):kt.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+c:"mapbox.eventData:"+c},We.prototype.fetchEventData=function(){var a=se("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid");if(a)try{var v=y.localStorage.getItem(c);v&&(this.eventData=JSON.parse(v));var I=y.localStorage.getItem(f);I&&(this.anonId=I)}catch{de("Unable to read from LocalStorage")}},We.prototype.saveEventData=function(){var a=se("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid");if(a)try{y.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&y.localStorage.setItem(c,JSON.stringify(this.eventData))}catch{de("Unable to write to LocalStorage")}},We.prototype.processRequests=function(a){},We.prototype.postEvent=function(a,c,f,v){var I=this;if(kt.EVENTS_URL){var A=Ie(kt.EVENTS_URL);A.params.push("access_token="+(v||kt.ACCESS_TOKEN||""));var R={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:W,userId:this.anonId},N=c?k(R,c):R,Z={url:pe(A),headers:{"Content-Type":"text/plain"},body:JSON.stringify([N])};this.pendingRequest=Ti(Z,(function(X){I.pendingRequest=null,f(X),I.saveEventData(),I.processRequests(v)}))}},We.prototype.queueRequest=function(a,c){this.queue.push(a),this.processRequests(c)};var tt,nt,bt=(function(a){function c(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.postMapLoadEvent=function(f,v,I,A){this.skuToken=I;var R=!(!A&&!kt.ACCESS_TOKEN),N=Array.isArray(f)&&f.some((function(Z){return Re(Z)||me(Z)}));kt.EVENTS_URL&&R&&N&&this.queueRequest({id:v,timestamp:Date.now()},A)},c.prototype.processRequests=function(f){var v=this;if(!this.pendingRequest&&this.queue.length!==0){var I=this.queue.shift(),A=I.id,R=I.timestamp;A&&this.success[A]||(this.anonId||this.fetchEventData(),z(this.anonId)||(this.anonId=V()),this.postEvent(R,{skuToken:this.skuToken},(function(N){N||A&&(v.success[A]=!0)}),f))}},c})(We),on=new((function(a){function c(f){a.call(this,"appUserTurnstile"),this._customAccessToken=f}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.postTurnstileEvent=function(f,v){kt.EVENTS_URL&&kt.ACCESS_TOKEN&&Array.isArray(f)&&f.some((function(I){return Re(I)||me(I)}))&&this.queueRequest(Date.now(),v)},c.prototype.processRequests=function(f){var v=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var I=Te(kt.ACCESS_TOKEN),A=I?I.u:kt.ACCESS_TOKEN,R=A!==this.eventData.tokenU;z(this.anonId)||(this.anonId=V(),R=!0);var N=this.queue.shift();if(this.eventData.lastSuccess){var Z=new Date(this.eventData.lastSuccess),X=new Date(N),Q=(N-this.eventData.lastSuccess)/864e5;R=R||Q>=1||Q<-1||Z.getDate()!==X.getDate()}else R=!0;if(!R)return this.processRequests();this.postEvent(N,{"enabled.telemetry":!1},(function(ne){ne||(v.eventData.lastSuccess=N,v.eventData.tokenU=A)}),f)}},c})(We)),an=on.postTurnstileEvent.bind(on),Ii=new bt,ji=Ii.postMapLoadEvent.bind(Ii),Pi=500,Mr=50;function _i(){y.caches&&!tt&&(tt=y.caches.open("mapbox-tiles"))}function ss(a){var c=a.indexOf("?");return c<0?a:a.slice(0,c)}var Ei,Mi=1/0;function zs(){return Ei==null&&(Ei=y.OffscreenCanvas&&new y.OffscreenCanvas(1,1).getContext("2d")&&typeof y.createImageBitmap=="function"),Ei}var Ao={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ao);var Ea=(function(a){function c(f,v,I){v===401&&me(I)&&(f+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,f),this.status=v,this.url=I,this.name=this.constructor.name,this.message=f}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},c})(Error),_s=ue()?function(){return self.worker&&self.worker.referrer}:function(){return(y.location.protocol==="blob:"?y.parent:y).location.href},Ur,Xr,vs=function(a,c){if(!(/^file:/.test(f=a.url)||/^file:/.test(_s())&&!/^\w+:/.test(f))){if(y.fetch&&y.Request&&y.AbortController&&y.Request.prototype.hasOwnProperty("signal"))return(function(v,I){var A,R=new y.AbortController,N=new y.Request(v.url,{method:v.method||"GET",body:v.body,credentials:v.credentials,headers:v.headers,referrer:_s(),signal:R.signal}),Z=!1,X=!1,Q=(A=N.url).indexOf("sku=")>0&&me(A);v.type==="json"&&N.headers.set("Accept","application/json");var ne=function(xe,Oe,De){if(!X){if(xe&&xe.message!=="SecurityError"&&de(xe),Oe&&De)return he(Oe);var Je=Date.now();y.fetch(N).then((function(Xe){if(Xe.ok){var et=Q?Xe.clone():null;return he(Xe,et,Je)}return I(new Ea(Xe.statusText,Xe.status,v.url))})).catch((function(Xe){Xe.code!==20&&I(new Error(Xe.message))}))}},he=function(xe,Oe,De){(v.type==="arrayBuffer"?xe.arrayBuffer():v.type==="json"?xe.json():xe.text()).then((function(Je){X||(Oe&&De&&(function(Xe,et,st){if(_i(),tt){var ot={status:et.status,statusText:et.statusText,headers:new y.Headers};et.headers.forEach((function(_t,Ft){return ot.headers.set(Ft,_t)}));var ct=ge(et.headers.get("Cache-Control")||"");ct["no-store"]||(ct["max-age"]&&ot.headers.set("Expires",new Date(st+1e3*ct["max-age"]).toUTCString()),new Date(ot.headers.get("Expires")).getTime()-st<42e4||(function(_t,Ft){if(nt===void 0)try{new Response(new ReadableStream),nt=!0}catch{nt=!1}nt?Ft(_t.body):_t.blob().then(Ft)})(et,(function(_t){var Ft=new y.Response(_t,ot);_i(),tt&&tt.then((function(zt){return zt.put(ss(Xe.url),Ft)})).catch((function(zt){return de(zt.message)}))})))}})(N,Oe,De),Z=!0,I(null,Je,xe.headers.get("Cache-Control"),xe.headers.get("Expires")))})).catch((function(Je){X||I(new Error(Je.message))}))};return Q?(function(xe,Oe){if(_i(),!tt)return Oe(null);var De=ss(xe.url);tt.then((function(Je){Je.match(De).then((function(Xe){var et=(function(st){if(!st)return!1;var ot=new Date(st.headers.get("Expires")||0),ct=ge(st.headers.get("Cache-Control")||"");return ot>Date.now()&&!ct["no-cache"]})(Xe);Je.delete(De),et&&Je.put(De,Xe.clone()),Oe(null,Xe,et)})).catch(Oe)})).catch(Oe)})(N,ne):ne(null,null),{cancel:function(){X=!0,Z||R.abort()}}})(a,c);if(ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,c,void 0,!0)}var f;return(function(v,I){var A=new y.XMLHttpRequest;for(var R in A.open(v.method||"GET",v.url,!0),v.type==="arrayBuffer"&&(A.responseType="arraybuffer"),v.headers)A.setRequestHeader(R,v.headers[R]);return v.type==="json"&&(A.responseType="text",A.setRequestHeader("Accept","application/json")),A.withCredentials=v.credentials==="include",A.onerror=function(){I(new Error(A.statusText))},A.onload=function(){if((A.status>=200&&A.status<300||A.status===0)&&A.response!==null){var N=A.response;if(v.type==="json")try{N=JSON.parse(A.response)}catch(Z){return I(Z)}I(null,N,A.getResponseHeader("Cache-Control"),A.getResponseHeader("Expires"))}else I(new Ea(A.statusText,A.status,v.url))},A.send(v.body),{cancel:function(){return A.abort()}}})(a,c)},Pl=function(a,c){return vs(k(a,{type:"arrayBuffer"}),c)},Ti=function(a,c){return vs(k(a,{method:"POST"}),c)},ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ur=[],Xr=0;var le=function(a,c){if(hn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Xr>=kt.MAX_PARALLEL_IMAGE_REQUESTS){var f={requestParameters:a,callback:c,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ur.push(f),f}Xr++;var v=!1,I=function(){if(!v)for(v=!0,Xr--;Ur.length&&Xr<kt.MAX_PARALLEL_IMAGE_REQUESTS;){var R=Ur.shift();R.cancelled||(R.cancel=le(R.requestParameters,R.callback).cancel)}},A=Pl(a,(function(R,N,Z,X){I(),R?c(R):N&&(zs()?(function(Q,ne){var he=new y.Blob([new Uint8Array(Q)],{type:"image/png"});y.createImageBitmap(he).then((function(xe){ne(null,xe)})).catch((function(xe){ne(new Error("Could not load image because of "+xe.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))})(N,c):(function(Q,ne,he,xe){var Oe=new y.Image,De=y.URL;Oe.onload=function(){ne(null,Oe),De.revokeObjectURL(Oe.src),Oe.onload=null,y.requestAnimationFrame((function(){Oe.src=ee}))},Oe.onerror=function(){return ne(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Je=new y.Blob([new Uint8Array(Q)],{type:"image/png"});Oe.cacheControl=he,Oe.expires=xe,Oe.src=Q.byteLength?De.createObjectURL(Je):ee})(N,c,Z,X))}));return{cancel:function(){A.cancel(),I()}}};function ye(a,c,f){f[a]&&f[a].indexOf(c)!==-1||(f[a]=f[a]||[],f[a].push(c))}function Ae(a,c,f){if(f&&f[a]){var v=f[a].indexOf(c);v!==-1&&f[a].splice(v,1)}}var Me=function(a,c){c===void 0&&(c={}),k(this,c),this.type=a},$e=(function(a){function c(f,v){v===void 0&&(v={}),a.call(this,"error",k({error:f},v))}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c})(Me),Ye=function(){};Ye.prototype.on=function(a,c){return this._listeners=this._listeners||{},ye(a,c,this._listeners),this},Ye.prototype.off=function(a,c){return Ae(a,c,this._listeners),Ae(a,c,this._oneTimeListeners),this},Ye.prototype.once=function(a,c){return this._oneTimeListeners=this._oneTimeListeners||{},ye(a,c,this._oneTimeListeners),this},Ye.prototype.fire=function(a,c){typeof a=="string"&&(a=new Me(a,c||{}));var f=a.type;if(this.listens(f)){a.target=this;for(var v=0,I=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];v<I.length;v+=1)I[v].call(this,a);for(var A=0,R=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];A<R.length;A+=1){var N=R[A];Ae(f,N,this._oneTimeListeners),N.call(this,a)}var Z=this._eventedParent;Z&&(k(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),Z.fire(a))}else a instanceof $e&&console.error(a.error);return this},Ye.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},Ye.prototype.setEventedParent=function(a,c){return this._eventedParent=a,this._eventedParentData=c,this};var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ke=function(a,c,f,v){this.message=(a?a+": ":"")+f,v&&(this.identifier=v),c!=null&&c.__line__&&(this.line=c.__line__)};function it(a){var c=a.value;return c?[new ke(a.key,c,"constants have been deprecated as of v8")]:[]}function At(a){for(var c=[],f=arguments.length-1;f-- >0;)c[f]=arguments[f+1];for(var v=0,I=c;v<I.length;v+=1){var A=I[v];for(var R in A)a[R]=A[R]}return a}function Lt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function dt(a){if(Array.isArray(a))return a.map(dt);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var c={};for(var f in a)c[f]=dt(a[f]);return c}return Lt(a)}var Tt=(function(a){function c(f,v){a.call(this,v),this.message=v,this.key=f}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c})(Error),qt=function(a,c){c===void 0&&(c=[]),this.parent=a,this.bindings={};for(var f=0,v=c;f<v.length;f+=1){var I=v[f];this.bindings[I[0]]=I[1]}};qt.prototype.concat=function(a){return new qt(this,a)},qt.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},qt.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var tn={kind:"null"},pt={kind:"number"},$t={kind:"string"},Xt={kind:"boolean"},Yt={kind:"color"},Dt={kind:"object"},Fe={kind:"value"},vt={kind:"collator"},Kt={kind:"formatted"},yn={kind:"resolvedImage"};function Bn(a,c){return{kind:"array",itemType:a,N:c}}function En(a){if(a.kind==="array"){var c=En(a.itemType);return typeof a.N=="number"?"array<"+c+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+c+">"}return a.kind}var Qi=[tn,pt,$t,Xt,Yt,Kt,Dt,Bn(Fe),yn];function li(a,c){if(c.kind==="error")return null;if(a.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!li(a.itemType,c.itemType))&&(typeof a.N!="number"||a.N===c.N))return null}else{if(a.kind===c.kind)return null;if(a.kind==="value"){for(var f=0,v=Qi;f<v.length;f+=1)if(!li(v[f],c))return null}}return"Expected "+En(a)+" but found "+En(c)+" instead."}function or(a,c){return c.some((function(f){return f.kind===a.kind}))}function Gi(a,c){return c.some((function(f){return f==="null"?a===null:f==="array"?Array.isArray(a):f==="object"?a&&!Array.isArray(a)&&typeof a=="object":f===typeof a}))}var Mn=l((function(a,c){var f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function v(N){return(N=Math.round(N))<0?0:N>255?255:N}function I(N){return v(N[N.length-1]==="%"?parseFloat(N)/100*255:parseInt(N))}function A(N){return(Z=N[N.length-1]==="%"?parseFloat(N)/100:parseFloat(N))<0?0:Z>1?1:Z;var Z}function R(N,Z,X){return X<0?X+=1:X>1&&(X-=1),6*X<1?N+(Z-N)*X*6:2*X<1?Z:3*X<2?N+(Z-N)*(2/3-X)*6:N}try{c.parseCSSColor=function(N){var Z,X=N.replace(/ /g,"").toLowerCase();if(X in f)return f[X].slice();if(X[0]==="#")return X.length===4?(Z=parseInt(X.substr(1),16))>=0&&Z<=4095?[(3840&Z)>>4|(3840&Z)>>8,240&Z|(240&Z)>>4,15&Z|(15&Z)<<4,1]:null:X.length===7&&(Z=parseInt(X.substr(1),16))>=0&&Z<=16777215?[(16711680&Z)>>16,(65280&Z)>>8,255&Z,1]:null;var Q=X.indexOf("("),ne=X.indexOf(")");if(Q!==-1&&ne+1===X.length){var he=X.substr(0,Q),xe=X.substr(Q+1,ne-(Q+1)).split(","),Oe=1;switch(he){case"rgba":if(xe.length!==4)return null;Oe=A(xe.pop());case"rgb":return xe.length!==3?null:[I(xe[0]),I(xe[1]),I(xe[2]),Oe];case"hsla":if(xe.length!==4)return null;Oe=A(xe.pop());case"hsl":if(xe.length!==3)return null;var De=(parseFloat(xe[0])%360+360)%360/360,Je=A(xe[1]),Xe=A(xe[2]),et=Xe<=.5?Xe*(Je+1):Xe+Je-Xe*Je,st=2*Xe-et;return[v(255*R(st,et,De+1/3)),v(255*R(st,et,De)),v(255*R(st,et,De-1/3)),Oe];default:return null}}return null}}catch{}})).parseCSSColor,Ci=function(a,c,f,v){v===void 0&&(v=1),this.r=a,this.g=c,this.b=f,this.a=v};Ci.parse=function(a){if(a){if(a instanceof Ci)return a;if(typeof a=="string"){var c=Mn(a);if(c)return new Ci(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3])}}},Ci.prototype.toString=function(){var a=this.toArray(),c=a[1],f=a[2],v=a[3];return"rgba("+Math.round(a[0])+","+Math.round(c)+","+Math.round(f)+","+v+")"},Ci.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},Ci.black=new Ci(0,0,0,1),Ci.white=new Ci(1,1,1,1),Ci.transparent=new Ci(0,0,0,0),Ci.red=new Ci(1,0,0,1);var Us=function(a,c,f){this.sensitivity=a?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Us.prototype.compare=function(a,c){return this.collator.compare(a,c)},Us.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Pf=function(a,c,f,v,I){this.text=a,this.image=c,this.scale=f,this.fontStack=v,this.textColor=I},Ls=function(a){this.sections=a};Ls.fromString=function(a){return new Ls([new Pf(a,null,null,null,null)])},Ls.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some((function(a){return a.text.length!==0||a.image&&a.image.name.length!==0}))},Ls.factory=function(a){return a instanceof Ls?a:Ls.fromString(a)},Ls.prototype.toString=function(){return this.sections.length===0?"":this.sections.map((function(a){return a.text})).join("")},Ls.prototype.serialize=function(){for(var a=["format"],c=0,f=this.sections;c<f.length;c+=1){var v=f[c];if(v.image)a.push(["image",v.image.name]);else{a.push(v.text);var I={};v.fontStack&&(I["text-font"]=["literal",v.fontStack.split(",")]),v.scale&&(I["font-scale"]=v.scale),v.textColor&&(I["text-color"]=["rgba"].concat(v.textColor.toArray())),a.push(I)}}return a};var So=function(a){this.name=a.name,this.available=a.available};function r_(a,c,f,v){return typeof a=="number"&&a>=0&&a<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof f=="number"&&f>=0&&f<=255?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:"Invalid rgba value ["+[a,c,f,v].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof v=="number"?[a,c,f,v]:[a,c,f]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Gf(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Ci||a instanceof Us||a instanceof Ls||a instanceof So)return!0;if(Array.isArray(a)){for(var c=0,f=a;c<f.length;c+=1)if(!Gf(f[c]))return!1;return!0}if(typeof a=="object"){for(var v in a)if(!Gf(a[v]))return!1;return!0}return!1}function Yr(a){if(a===null)return tn;if(typeof a=="string")return $t;if(typeof a=="boolean")return Xt;if(typeof a=="number")return pt;if(a instanceof Ci)return Yt;if(a instanceof Us)return vt;if(a instanceof Ls)return Kt;if(a instanceof So)return yn;if(Array.isArray(a)){for(var c,f=a.length,v=0,I=a;v<I.length;v+=1){var A=Yr(I[v]);if(c){if(c===A)continue;c=Fe;break}c=A}return Bn(c||Fe,f)}return Dt}function Ff(a){var c=typeof a;return a===null?"":c==="string"||c==="number"||c==="boolean"?String(a):a instanceof Ci||a instanceof Ls||a instanceof So?a.toString():JSON.stringify(a)}So.prototype.toString=function(){return this.name},So.fromString=function(a){return a?new So({name:a,available:!1}):null},So.prototype.serialize=function(){return["image",this.name]};var ho=function(a,c){this.type=a,this.value=c};ho.parse=function(a,c){if(a.length!==2)return c.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!Gf(a[1]))return c.error("invalid value");var f=a[1],v=Yr(f),I=c.expectedType;return v.kind!=="array"||v.N!==0||!I||I.kind!=="array"||typeof I.N=="number"&&I.N!==0||(v=I),new ho(v,f)},ho.prototype.evaluate=function(){return this.value},ho.prototype.eachChild=function(){},ho.prototype.outputDefined=function(){return!0},ho.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ci?["rgba"].concat(this.value.toArray()):this.value instanceof Ls?this.value.serialize():this.value};var Ps=function(a){this.name="ExpressionEvaluationError",this.message=a};Ps.prototype.toJSON=function(){return this.message};var Ta={string:$t,number:pt,boolean:Xt,object:Dt},Cr=function(a,c){this.type=a,this.args=c};Cr.parse=function(a,c){if(a.length<2)return c.error("Expected at least one argument.");var f,v=1,I=a[0];if(I==="array"){var A,R;if(a.length>2){var N=a[1];if(typeof N!="string"||!(N in Ta)||N==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);A=Ta[N],v++}else A=Fe;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return c.error('The length argument to "array" must be a positive integer literal',2);R=a[2],v++}f=Bn(A,R)}else f=Ta[I];for(var Z=[];v<a.length;v++){var X=c.parse(a[v],v,Fe);if(!X)return null;Z.push(X)}return new Cr(f,Z)},Cr.prototype.evaluate=function(a){for(var c=0;c<this.args.length;c++){var f=this.args[c].evaluate(a);if(!li(this.type,Yr(f)))return f;if(c===this.args.length-1)throw new Ps("Expected value to be of type "+En(this.type)+", but found "+En(Yr(f))+" instead.")}return null},Cr.prototype.eachChild=function(a){this.args.forEach(a)},Cr.prototype.outputDefined=function(){return this.args.every((function(a){return a.outputDefined()}))},Cr.prototype.serialize=function(){var a=this.type,c=[a.kind];if(a.kind==="array"){var f=a.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){c.push(f.kind);var v=a.N;(typeof v=="number"||this.args.length>1)&&c.push(v)}}return c.concat(this.args.map((function(I){return I.serialize()})))};var rl=function(a){this.type=Kt,this.sections=a};rl.parse=function(a,c){if(a.length<2)return c.error("Expected at least one argument.");var f=a[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");for(var v=[],I=!1,A=1;A<=a.length-1;++A){var R=a[A];if(I&&typeof R=="object"&&!Array.isArray(R)){I=!1;var N=null;if(R["font-scale"]&&!(N=c.parse(R["font-scale"],1,pt)))return null;var Z=null;if(R["text-font"]&&!(Z=c.parse(R["text-font"],1,Bn($t))))return null;var X=null;if(R["text-color"]&&!(X=c.parse(R["text-color"],1,Yt)))return null;var Q=v[v.length-1];Q.scale=N,Q.font=Z,Q.textColor=X}else{var ne=c.parse(a[A],1,Fe);if(!ne)return null;var he=ne.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");I=!0,v.push({content:ne,scale:null,font:null,textColor:null})}}return new rl(v)},rl.prototype.evaluate=function(a){return new Ls(this.sections.map((function(c){var f=c.content.evaluate(a);return Yr(f)===yn?new Pf("",f,null,null,null):new Pf(Ff(f),null,c.scale?c.scale.evaluate(a):null,c.font?c.font.evaluate(a).join(","):null,c.textColor?c.textColor.evaluate(a):null)})))},rl.prototype.eachChild=function(a){for(var c=0,f=this.sections;c<f.length;c+=1){var v=f[c];a(v.content),v.scale&&a(v.scale),v.font&&a(v.font),v.textColor&&a(v.textColor)}},rl.prototype.outputDefined=function(){return!1},rl.prototype.serialize=function(){for(var a=["format"],c=0,f=this.sections;c<f.length;c+=1){var v=f[c];a.push(v.content.serialize());var I={};v.scale&&(I["font-scale"]=v.scale.serialize()),v.font&&(I["text-font"]=v.font.serialize()),v.textColor&&(I["text-color"]=v.textColor.serialize()),a.push(I)}return a};var ha=function(a){this.type=yn,this.input=a};ha.parse=function(a,c){if(a.length!==2)return c.error("Expected two arguments.");var f=c.parse(a[1],1,$t);return f?new ha(f):c.error("No image name provided.")},ha.prototype.evaluate=function(a){var c=this.input.evaluate(a),f=So.fromString(c);return f&&a.availableImages&&(f.available=a.availableImages.indexOf(c)>-1),f},ha.prototype.eachChild=function(a){a(this.input)},ha.prototype.outputDefined=function(){return!1},ha.prototype.serialize=function(){return["image",this.input.serialize()]};var Bb={"to-boolean":Xt,"to-color":Yt,"to-number":pt,"to-string":$t},Ra=function(a,c){this.type=a,this.args=c};Ra.parse=function(a,c){if(a.length<2)return c.error("Expected at least one argument.");var f=a[0];if((f==="to-boolean"||f==="to-string")&&a.length!==2)return c.error("Expected one argument.");for(var v=Bb[f],I=[],A=1;A<a.length;A++){var R=c.parse(a[A],A,Fe);if(!R)return null;I.push(R)}return new Ra(v,I)},Ra.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var c,f,v=0,I=this.args;v<I.length;v+=1){if(f=null,(c=I[v].evaluate(a))instanceof Ci)return c;if(typeof c=="string"){var A=a.parseColor(c);if(A)return A}else if(Array.isArray(c)&&!(f=c.length<3||c.length>4?"Invalid rbga value "+JSON.stringify(c)+": expected an array containing either three or four numeric values.":r_(c[0],c[1],c[2],c[3])))return new Ci(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Ps(f||"Could not parse color from value '"+(typeof c=="string"?c:String(JSON.stringify(c)))+"'")}if(this.type.kind==="number"){for(var R=null,N=0,Z=this.args;N<Z.length;N+=1){if((R=Z[N].evaluate(a))===null)return 0;var X=Number(R);if(!isNaN(X))return X}throw new Ps("Could not convert "+JSON.stringify(R)+" to number.")}return this.type.kind==="formatted"?Ls.fromString(Ff(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?So.fromString(Ff(this.args[0].evaluate(a))):Ff(this.args[0].evaluate(a))},Ra.prototype.eachChild=function(a){this.args.forEach(a)},Ra.prototype.outputDefined=function(){return this.args.every((function(a){return a.outputDefined()}))},Ra.prototype.serialize=function(){if(this.type.kind==="formatted")return new rl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ha(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild((function(c){a.push(c.serialize())})),a};var RA=["Unknown","Point","LineString","Polygon"],su=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};su.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},su.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?RA[this.feature.type]:this.feature.type:null},su.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},su.prototype.canonicalID=function(){return this.canonical},su.prototype.properties=function(){return this.feature&&this.feature.properties||{}},su.prototype.parseColor=function(a){var c=this._parseColorCache[a];return c||(c=this._parseColorCache[a]=Ci.parse(a)),c};var Xs=function(a,c,f,v){this.name=a,this.type=c,this._evaluate=f,this.args=v};Xs.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Xs.prototype.eachChild=function(a){this.args.forEach(a)},Xs.prototype.outputDefined=function(){return!1},Xs.prototype.serialize=function(){return[this.name].concat(this.args.map((function(a){return a.serialize()})))},Xs.parse=function(a,c){var f,v=a[0],I=Xs.definitions[v];if(!I)return c.error('Unknown expression "'+v+'". If you wanted a literal array, use ["literal", [...]].',0);for(var A=Array.isArray(I)?I[0]:I.type,R=Array.isArray(I)?[[I[1],I[2]]]:I.overloads,N=R.filter((function(bn){var Qt=bn[0];return!Array.isArray(Qt)||Qt.length===a.length-1})),Z=null,X=0,Q=N;X<Q.length;X+=1){var ne=Q[X],he=ne[0],xe=ne[1];Z=new Yu(c.registry,c.path,null,c.scope);for(var Oe=[],De=!1,Je=1;Je<a.length;Je++){var Xe=a[Je],et=Array.isArray(he)?he[Je-1]:he.type,st=Z.parse(Xe,1+Oe.length,et);if(!st){De=!0;break}Oe.push(st)}if(!De)if(Array.isArray(he)&&he.length!==Oe.length)Z.error("Expected "+he.length+" arguments, but found "+Oe.length+" instead.");else{for(var ot=0;ot<Oe.length;ot++){var ct=Array.isArray(he)?he[ot]:he.type,_t=Oe[ot];Z.concat(ot+1).checkSubtype(ct,_t.type)}if(Z.errors.length===0)return new Xs(v,A,xe,Oe)}}if(N.length===1)(f=c.errors).push.apply(f,Z.errors);else{for(var Ft=(N.length?N:R).map((function(bn){var Qt;return Qt=bn[0],Array.isArray(Qt)?"("+Qt.map(En).join(", ")+")":"("+En(Qt.type)+"...)"})).join(" | "),zt=[],gn=1;gn<a.length;gn++){var Jt=c.parse(a[gn],1+zt.length);if(!Jt)return null;zt.push(En(Jt.type))}c.error("Expected arguments of type "+Ft+", but found ("+zt.join(", ")+") instead.")}return null},Xs.register=function(a,c){for(var f in Xs.definitions=c,c)a[f]=Xs};var Gl=function(a,c,f){this.type=vt,this.locale=f,this.caseSensitive=a,this.diacriticSensitive=c};function fo(a,c){a[0]=Math.min(a[0],c[0]),a[1]=Math.min(a[1],c[1]),a[2]=Math.max(a[2],c[0]),a[3]=Math.max(a[3],c[1])}function Xc(a,c){return!(a[0]<=c[0]||a[2]>=c[2]||a[1]<=c[1]||a[3]>=c[3])}function MA(a,c){var f=(180+a[0])/360,v=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,I=Math.pow(2,c.z);return[Math.round(f*I*8192),Math.round(v*I*8192)]}function kA(a,c,f){return c[1]>a[1]!=f[1]>a[1]&&a[0]<(f[0]-c[0])*(a[1]-c[1])/(f[1]-c[1])+c[0]}function s_(a,c){for(var f,v,I,A,R,N,Z,X=!1,Q=0,ne=c.length;Q<ne;Q++)for(var he=c[Q],xe=0,Oe=he.length;xe<Oe-1;xe++){if((A=(f=a)[0]-(v=he[xe])[0])*(Z=f[1]-(I=he[xe+1])[1])-(N=f[0]-I[0])*(R=f[1]-v[1])==0&&A*N<=0&&R*Z<=0)return!1;kA(a,he[xe],he[xe+1])&&(X=!X)}return X}function LA(a,c){for(var f=0;f<c.length;f++)if(s_(a,c[f]))return!0;return!1}function Zb(a,c,f,v){var I=v[0]-f[0],A=v[1]-f[1],R=(a[0]-f[0])*A-I*(a[1]-f[1]),N=(c[0]-f[0])*A-I*(c[1]-f[1]);return R>0&&N<0||R<0&&N>0}function PA(a,c,f){for(var v=0,I=f;v<I.length;v+=1)for(var A=I[v],R=0;R<A.length-1;++R)if((ne=[(Q=A[R+1])[0]-(X=A[R])[0],Q[1]-X[1]])[0]*(he=[(Z=c)[0]-(N=a)[0],Z[1]-N[1]])[1]-ne[1]*he[0]!=0&&Zb(N,Z,X,Q)&&Zb(X,Q,N,Z))return!0;var N,Z,X,Q,ne,he;return!1}function Wb(a,c){for(var f=0;f<a.length;++f)if(!s_(a[f],c))return!1;for(var v=0;v<a.length-1;++v)if(PA(a[v],a[v+1],c))return!1;return!0}function zb(a,c){for(var f=0;f<c.length;f++)if(Wb(a,c[f]))return!0;return!1}function cd(a,c,f){for(var v=[],I=0;I<a.length;I++){for(var A=[],R=0;R<a[I].length;R++){var N=MA(a[I][R],f);fo(c,N),A.push(N)}v.push(A)}return v}function o_(a,c,f){for(var v=[],I=0;I<a.length;I++){var A=cd(a[I],c,f);v.push(A)}return v}function Of(a,c,f,v){if(a[0]<f[0]||a[0]>f[2]){var I=.5*v,A=a[0]-f[0]>I?-v:f[0]-a[0]>I?v:0;A===0&&(A=a[0]-f[2]>I?-v:f[2]-a[0]>I?v:0),a[0]+=A}fo(c,a)}function Ub(a,c,f,v){for(var I=8192*Math.pow(2,v.z),A=[8192*v.x,8192*v.y],R=[],N=0,Z=a;N<Z.length;N+=1)for(var X=0,Q=Z[N];X<Q.length;X+=1){var ne=Q[X],he=[ne.x+A[0],ne.y+A[1]];Of(he,c,f,I),R.push(he)}return R}function _g(a,c,f,v){for(var I,A=8192*Math.pow(2,v.z),R=[8192*v.x,8192*v.y],N=[],Z=0,X=a;Z<X.length;Z+=1){for(var Q=[],ne=0,he=X[Z];ne<he.length;ne+=1){var xe=he[ne],Oe=[xe.x+R[0],xe.y+R[1]];fo(c,Oe),Q.push(Oe)}N.push(Q)}if(c[2]-c[0]<=A/2){(I=c)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(var De=0,Je=N;De<Je.length;De+=1)for(var Xe=0,et=Je[De];Xe<et.length;Xe+=1)Of(et[Xe],c,f,A)}return N}Gl.parse=function(a,c){if(a.length!==2)return c.error("Expected one argument.");var f=a[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");var v=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Xt);if(!v)return null;var I=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Xt);if(!I)return null;var A=null;return f.locale&&!(A=c.parse(f.locale,1,$t))?null:new Gl(v,I,A)},Gl.prototype.evaluate=function(a){return new Us(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Gl.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Gl.prototype.outputDefined=function(){return!1},Gl.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Ma=function(a,c){this.type=Xt,this.geojson=a,this.geometries=c};function zu(a){if(a instanceof Xs&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ma)return!1;var c=!0;return a.eachChild((function(f){c&&!zu(f)&&(c=!1)})),c}function Uu(a){if(a instanceof Xs&&a.name==="feature-state")return!1;var c=!0;return a.eachChild((function(f){c&&!Uu(f)&&(c=!1)})),c}function Yc(a,c){if(a instanceof Xs&&c.indexOf(a.name)>=0)return!1;var f=!0;return a.eachChild((function(v){f&&!Yc(v,c)&&(f=!1)})),f}Ma.parse=function(a,c){if(a.length!==2)return c.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(Gf(a[1])){var f=a[1];if(f.type==="FeatureCollection")for(var v=0;v<f.features.length;++v){var I=f.features[v].geometry.type;if(I==="Polygon"||I==="MultiPolygon")return new Ma(f,f.features[v].geometry)}else if(f.type==="Feature"){var A=f.geometry.type;if(A==="Polygon"||A==="MultiPolygon")return new Ma(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Ma(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ma.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(c,f){var v=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],A=c.canonicalID();if(f.type==="Polygon"){var R=cd(f.coordinates,I,A),N=Ub(c.geometry(),v,I,A);if(!Xc(v,I))return!1;for(var Z=0,X=N;Z<X.length;Z+=1)if(!s_(X[Z],R))return!1}if(f.type==="MultiPolygon"){var Q=o_(f.coordinates,I,A),ne=Ub(c.geometry(),v,I,A);if(!Xc(v,I))return!1;for(var he=0,xe=ne;he<xe.length;he+=1)if(!LA(xe[he],Q))return!1}return!0})(a,this.geometries);if(a.geometryType()==="LineString")return(function(c,f){var v=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],A=c.canonicalID();if(f.type==="Polygon"){var R=cd(f.coordinates,I,A),N=_g(c.geometry(),v,I,A);if(!Xc(v,I))return!1;for(var Z=0,X=N;Z<X.length;Z+=1)if(!Wb(X[Z],R))return!1}if(f.type==="MultiPolygon"){var Q=o_(f.coordinates,I,A),ne=_g(c.geometry(),v,I,A);if(!Xc(v,I))return!1;for(var he=0,xe=ne;he<xe.length;he+=1)if(!zb(xe[he],Q))return!1}return!0})(a,this.geometries)}return!1},Ma.prototype.eachChild=function(){},Ma.prototype.outputDefined=function(){return!0},Ma.prototype.serialize=function(){return["within",this.geojson]};var Xu=function(a,c){this.type=c.type,this.name=a,this.boundExpression=c};Xu.parse=function(a,c){if(a.length!==2||typeof a[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");var f=a[1];return c.scope.has(f)?new Xu(f,c.scope.get(f)):c.error('Unknown variable "'+f+'". Make sure "'+f+'" has been bound in an enclosing "let" expression before using it.',1)},Xu.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},Xu.prototype.eachChild=function(){},Xu.prototype.outputDefined=function(){return!1},Xu.prototype.serialize=function(){return["var",this.name]};var Yu=function(a,c,f,v,I){c===void 0&&(c=[]),v===void 0&&(v=new qt),I===void 0&&(I=[]),this.registry=a,this.path=c,this.key=c.map((function(A){return"["+A+"]"})).join(""),this.scope=v,this.errors=I,this.expectedType=f};function vg(a,c){for(var f,v=a.length-1,I=0,A=v,R=0;I<=A;)if((f=a[R=Math.floor((I+A)/2)])<=c){if(R===v||c<a[R+1])return R;I=R+1}else{if(!(f>c))throw new Ps("Input is not a number.");A=R-1}return 0}Yu.prototype.parse=function(a,c,f,v,I){return I===void 0&&(I={}),c?this.concat(c,f,v)._parse(a,I):this._parse(a,I)},Yu.prototype._parse=function(a,c){function f(X,Q,ne){return ne==="assert"?new Cr(Q,[X]):ne==="coerce"?new Ra(Q,[X]):X}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var v=a[0];if(typeof v!="string")return this.error("Expression name must be a string, but found "+typeof v+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var I=this.registry[v];if(I){var A=I.parse(a,this);if(!A)return null;if(this.expectedType){var R=this.expectedType,N=A.type;if(R.kind!=="string"&&R.kind!=="number"&&R.kind!=="boolean"&&R.kind!=="object"&&R.kind!=="array"||N.kind!=="value")if(R.kind!=="color"&&R.kind!=="formatted"&&R.kind!=="resolvedImage"||N.kind!=="value"&&N.kind!=="string"){if(this.checkSubtype(R,N))return null}else A=f(A,R,c.typeAnnotation||"coerce");else A=f(A,R,c.typeAnnotation||"assert")}if(!(A instanceof ho)&&A.type.kind!=="resolvedImage"&&(function X(Q){if(Q instanceof Xu)return X(Q.boundExpression);if(Q instanceof Xs&&Q.name==="error"||Q instanceof Gl||Q instanceof Ma)return!1;var ne=Q instanceof Ra||Q instanceof Cr,he=!0;return Q.eachChild((function(xe){he=ne?he&&X(xe):he&&xe instanceof ho})),!!he&&zu(Q)&&Yc(Q,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])})(A)){var Z=new su;try{A=new ho(A.type,A.evaluate(Z))}catch(X){return this.error(X.message),null}}return A}return this.error('Unknown expression "'+v+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},Yu.prototype.concat=function(a,c,f){var v=typeof a=="number"?this.path.concat(a):this.path,I=f?this.scope.concat(f):this.scope;return new Yu(this.registry,v,c||null,I,this.errors)},Yu.prototype.error=function(a){for(var c=[],f=arguments.length-1;f-- >0;)c[f]=arguments[f+1];var v=""+this.key+c.map((function(I){return"["+I+"]"})).join("");this.errors.push(new Tt(v,a))},Yu.prototype.checkSubtype=function(a,c){var f=li(a,c);return f&&this.error(f),f};var Zo=function(a,c,f){this.type=a,this.input=c,this.labels=[],this.outputs=[];for(var v=0,I=f;v<I.length;v+=1){var A=I[v],R=A[1];this.labels.push(A[0]),this.outputs.push(R)}};function ts(a,c,f){return a*(1-f)+c*f}Zo.parse=function(a,c){if(a.length-1<4)return c.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return c.error("Expected an even number of arguments.");var f=c.parse(a[1],1,pt);if(!f)return null;var v=[],I=null;c.expectedType&&c.expectedType.kind!=="value"&&(I=c.expectedType);for(var A=1;A<a.length;A+=2){var R=A===1?-1/0:a[A],N=a[A+1],Z=A,X=A+1;if(typeof R!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(v.length&&v[v.length-1][0]>=R)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Z);var Q=c.parse(N,X,I);if(!Q)return null;I=I||Q.type,v.push([R,Q])}return new Zo(I,f,v)},Zo.prototype.evaluate=function(a){var c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(a);var v=this.input.evaluate(a);if(v<=c[0])return f[0].evaluate(a);var I=c.length;return v>=c[I-1]?f[I-1].evaluate(a):f[vg(c,v)].evaluate(a)},Zo.prototype.eachChild=function(a){a(this.input);for(var c=0,f=this.outputs;c<f.length;c+=1)a(f[c])},Zo.prototype.outputDefined=function(){return this.outputs.every((function(a){return a.outputDefined()}))},Zo.prototype.serialize=function(){for(var a=["step",this.input.serialize()],c=0;c<this.labels.length;c++)c>0&&a.push(this.labels[c]),a.push(this.outputs[c].serialize());return a};var hd=Object.freeze({__proto__:null,number:ts,color:function(a,c,f){return new Ci(ts(a.r,c.r,f),ts(a.g,c.g,f),ts(a.b,c.b,f),ts(a.a,c.a,f))},array:function(a,c,f){return a.map((function(v,I){return ts(v,c[I],f)}))}}),Xb=6/29*3*(6/29),GA=Math.PI/180,FA=180/Math.PI;function a_(a){return a>.008856451679035631?Math.pow(a,1/3):a/Xb+4/29}function l_(a){return a>6/29?a*a*a:Xb*(a-4/29)}function u_(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function c_(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Yb(a){var c=c_(a.r),f=c_(a.g),v=c_(a.b),I=a_((.4124564*c+.3575761*f+.1804375*v)/.95047),A=a_((.2126729*c+.7151522*f+.072175*v)/1);return{l:116*A-16,a:500*(I-A),b:200*(A-a_((.0193339*c+.119192*f+.9503041*v)/1.08883)),alpha:a.a}}function Hb(a){var c=(a.l+16)/116,f=isNaN(a.a)?c:c+a.a/500,v=isNaN(a.b)?c:c-a.b/200;return c=1*l_(c),f=.95047*l_(f),v=1.08883*l_(v),new Ci(u_(3.2404542*f-1.5371385*c-.4985314*v),u_(-.969266*f+1.8760108*c+.041556*v),u_(.0556434*f-.2040259*c+1.0572252*v),a.alpha)}function OA(a,c,f){var v=c-a;return a+f*(v>180||v<-180?v-360*Math.round(v/360):v)}var Nf={forward:Yb,reverse:Hb,interpolate:function(a,c,f){return{l:ts(a.l,c.l,f),a:ts(a.a,c.a,f),b:ts(a.b,c.b,f),alpha:ts(a.alpha,c.alpha,f)}}},Df={forward:function(a){var c=Yb(a),f=c.l,v=c.a,I=c.b,A=Math.atan2(I,v)*FA;return{h:A<0?A+360:A,c:Math.sqrt(v*v+I*I),l:f,alpha:a.a}},reverse:function(a){var c=a.h*GA,f=a.c;return Hb({l:a.l,a:Math.cos(c)*f,b:Math.sin(c)*f,alpha:a.alpha})},interpolate:function(a,c,f){return{h:OA(a.h,c.h,f),c:ts(a.c,c.c,f),l:ts(a.l,c.l,f),alpha:ts(a.alpha,c.alpha,f)}}},Kb=Object.freeze({__proto__:null,lab:Nf,hcl:Df}),Ys=function(a,c,f,v,I){this.type=a,this.operator=c,this.interpolation=f,this.input=v,this.labels=[],this.outputs=[];for(var A=0,R=I;A<R.length;A+=1){var N=R[A],Z=N[1];this.labels.push(N[0]),this.outputs.push(Z)}};function h_(a,c,f,v){var I=v-f,A=a-f;return I===0?0:c===1?A/I:(Math.pow(c,A)-1)/(Math.pow(c,I)-1)}Ys.interpolationFactor=function(a,c,f,v){var I=0;if(a.name==="exponential")I=h_(c,a.base,f,v);else if(a.name==="linear")I=h_(c,1,f,v);else if(a.name==="cubic-bezier"){var A=a.controlPoints;I=new u(A[0],A[1],A[2],A[3]).solve(h_(c,1,f,v))}return I},Ys.parse=function(a,c){var f=a[0],v=a[1],I=a[2],A=a.slice(3);if(!Array.isArray(v)||v.length===0)return c.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){var R=v[1];if(typeof R!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:R}}else{if(v[0]!=="cubic-bezier")return c.error("Unknown interpolation type "+String(v[0]),1,0);var N=v.slice(1);if(N.length!==4||N.some((function(Je){return typeof Je!="number"||Je<0||Je>1})))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:N}}if(a.length-1<4)return c.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(!(I=c.parse(I,2,pt)))return null;var Z=[],X=null;f==="interpolate-hcl"||f==="interpolate-lab"?X=Yt:c.expectedType&&c.expectedType.kind!=="value"&&(X=c.expectedType);for(var Q=0;Q<A.length;Q+=2){var ne=A[Q],he=A[Q+1],xe=Q+3,Oe=Q+4;if(typeof ne!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',xe);if(Z.length&&Z[Z.length-1][0]>=ne)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',xe);var De=c.parse(he,Oe,X);if(!De)return null;X=X||De.type,Z.push([ne,De])}return X.kind==="number"||X.kind==="color"||X.kind==="array"&&X.itemType.kind==="number"&&typeof X.N=="number"?new Ys(X,f,v,I,Z):c.error("Type "+En(X)+" is not interpolatable.")},Ys.prototype.evaluate=function(a){var c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(a);var v=this.input.evaluate(a);if(v<=c[0])return f[0].evaluate(a);var I=c.length;if(v>=c[I-1])return f[I-1].evaluate(a);var A=vg(c,v),R=Ys.interpolationFactor(this.interpolation,v,c[A],c[A+1]),N=f[A].evaluate(a),Z=f[A+1].evaluate(a);return this.operator==="interpolate"?hd[this.type.kind.toLowerCase()](N,Z,R):this.operator==="interpolate-hcl"?Df.reverse(Df.interpolate(Df.forward(N),Df.forward(Z),R)):Nf.reverse(Nf.interpolate(Nf.forward(N),Nf.forward(Z),R))},Ys.prototype.eachChild=function(a){a(this.input);for(var c=0,f=this.outputs;c<f.length;c+=1)a(f[c])},Ys.prototype.outputDefined=function(){return this.outputs.every((function(a){return a.outputDefined()}))},Ys.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var c=[this.operator,a,this.input.serialize()],f=0;f<this.labels.length;f++)c.push(this.labels[f],this.outputs[f].serialize());return c};var Hu=function(a,c){this.type=a,this.args=c};Hu.parse=function(a,c){if(a.length<2)return c.error("Expectected at least one argument.");var f=null,v=c.expectedType;v&&v.kind!=="value"&&(f=v);for(var I=[],A=0,R=a.slice(1);A<R.length;A+=1){var N=c.parse(R[A],1+I.length,f,void 0,{typeAnnotation:"omit"});if(!N)return null;f=f||N.type,I.push(N)}var Z=v&&I.some((function(X){return li(v,X.type)}));return new Hu(Z?Fe:f,I)},Hu.prototype.evaluate=function(a){for(var c,f=null,v=0,I=0,A=this.args;I<A.length&&(v++,(f=A[I].evaluate(a))&&f instanceof So&&!f.available&&(c||(c=f.name),f=null,v===this.args.length&&(f=c)),f===null);I+=1);return f},Hu.prototype.eachChild=function(a){this.args.forEach(a)},Hu.prototype.outputDefined=function(){return this.args.every((function(a){return a.outputDefined()}))},Hu.prototype.serialize=function(){var a=["coalesce"];return this.eachChild((function(c){a.push(c.serialize())})),a};var Ku=function(a,c){this.type=c.type,this.bindings=[].concat(a),this.result=c};Ku.prototype.evaluate=function(a){return this.result.evaluate(a)},Ku.prototype.eachChild=function(a){for(var c=0,f=this.bindings;c<f.length;c+=1)a(f[c][1]);a(this.result)},Ku.parse=function(a,c){if(a.length<4)return c.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var f=[],v=1;v<a.length-1;v+=2){var I=a[v];if(typeof I!="string")return c.error("Expected string, but found "+typeof I+" instead.",v);if(/[^a-zA-Z0-9_]/.test(I))return c.error("Variable names must contain only alphanumeric characters or '_'.",v);var A=c.parse(a[v+1],v+1);if(!A)return null;f.push([I,A])}var R=c.parse(a[a.length-1],a.length-1,c.expectedType,f);return R?new Ku(f,R):null},Ku.prototype.outputDefined=function(){return this.result.outputDefined()},Ku.prototype.serialize=function(){for(var a=["let"],c=0,f=this.bindings;c<f.length;c+=1){var v=f[c];a.push(v[0],v[1].serialize())}return a.push(this.result.serialize()),a};var Hc=function(a,c,f){this.type=a,this.index=c,this.input=f};Hc.parse=function(a,c){if(a.length!==3)return c.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var f=c.parse(a[1],1,pt),v=c.parse(a[2],2,Bn(c.expectedType||Fe));return f&&v?new Hc(v.type.itemType,f,v):null},Hc.prototype.evaluate=function(a){var c=this.index.evaluate(a),f=this.input.evaluate(a);if(c<0)throw new Ps("Array index out of bounds: "+c+" < 0.");if(c>=f.length)throw new Ps("Array index out of bounds: "+c+" > "+(f.length-1)+".");if(c!==Math.floor(c))throw new Ps("Array index must be an integer, but found "+c+" instead.");return f[c]},Hc.prototype.eachChild=function(a){a(this.index),a(this.input)},Hc.prototype.outputDefined=function(){return!1},Hc.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Kc=function(a,c){this.type=Xt,this.needle=a,this.haystack=c};Kc.parse=function(a,c){if(a.length!==3)return c.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var f=c.parse(a[1],1,Fe),v=c.parse(a[2],2,Fe);return f&&v?or(f.type,[Xt,$t,pt,tn,Fe])?new Kc(f,v):c.error("Expected first argument to be of type boolean, string, number or null, but found "+En(f.type)+" instead"):null},Kc.prototype.evaluate=function(a){var c=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!f)return!1;if(!Gi(c,["boolean","string","number","null"]))throw new Ps("Expected first argument to be of type boolean, string, number or null, but found "+En(Yr(c))+" instead.");if(!Gi(f,["string","array"]))throw new Ps("Expected second argument to be of type array or string, but found "+En(Yr(f))+" instead.");return f.indexOf(c)>=0},Kc.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Kc.prototype.outputDefined=function(){return!0},Kc.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ju=function(a,c,f){this.type=pt,this.needle=a,this.haystack=c,this.fromIndex=f};ju.parse=function(a,c){if(a.length<=2||a.length>=5)return c.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var f=c.parse(a[1],1,Fe),v=c.parse(a[2],2,Fe);if(!f||!v)return null;if(!or(f.type,[Xt,$t,pt,tn,Fe]))return c.error("Expected first argument to be of type boolean, string, number or null, but found "+En(f.type)+" instead");if(a.length===4){var I=c.parse(a[3],3,pt);return I?new ju(f,v,I):null}return new ju(f,v)},ju.prototype.evaluate=function(a){var c=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!Gi(c,["boolean","string","number","null"]))throw new Ps("Expected first argument to be of type boolean, string, number or null, but found "+En(Yr(c))+" instead.");if(!Gi(f,["string","array"]))throw new Ps("Expected second argument to be of type array or string, but found "+En(Yr(f))+" instead.");if(this.fromIndex){var v=this.fromIndex.evaluate(a);return f.indexOf(c,v)}return f.indexOf(c)},ju.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},ju.prototype.outputDefined=function(){return!1},ju.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var jc=function(a,c,f,v,I,A){this.inputType=a,this.type=c,this.input=f,this.cases=v,this.outputs=I,this.otherwise=A};jc.parse=function(a,c){if(a.length<5)return c.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return c.error("Expected an even number of arguments.");var f,v;c.expectedType&&c.expectedType.kind!=="value"&&(v=c.expectedType);for(var I={},A=[],R=2;R<a.length-1;R+=2){var N=a[R],Z=a[R+1];Array.isArray(N)||(N=[N]);var X=c.concat(R);if(N.length===0)return X.error("Expected at least one branch label.");for(var Q=0,ne=N;Q<ne.length;Q+=1){var he=ne[Q];if(typeof he!="number"&&typeof he!="string")return X.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return X.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof he=="number"&&Math.floor(he)!==he)return X.error("Numeric branch labels must be integer values.");if(f){if(X.checkSubtype(f,Yr(he)))return null}else f=Yr(he);if(I[String(he)]!==void 0)return X.error("Branch labels must be unique.");I[String(he)]=A.length}var xe=c.parse(Z,R,v);if(!xe)return null;v=v||xe.type,A.push(xe)}var Oe=c.parse(a[1],1,Fe);if(!Oe)return null;var De=c.parse(a[a.length-1],a.length-1,v);return De?Oe.type.kind!=="value"&&c.concat(1).checkSubtype(f,Oe.type)?null:new jc(f,v,Oe,I,A,De):null},jc.prototype.evaluate=function(a){var c=this.input.evaluate(a);return(Yr(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(a)},jc.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},jc.prototype.outputDefined=function(){return this.outputs.every((function(a){return a.outputDefined()}))&&this.otherwise.outputDefined()},jc.prototype.serialize=function(){for(var a=this,c=["match",this.input.serialize()],f=[],v={},I=0,A=Object.keys(this.cases).sort();I<A.length;I+=1){var R=A[I];(ne=v[this.cases[R]])===void 0?(v[this.cases[R]]=f.length,f.push([this.cases[R],[R]])):f[ne][1].push(R)}for(var N=function(xe){return a.inputType.kind==="number"?Number(xe):xe},Z=0,X=f;Z<X.length;Z+=1){var Q=X[Z],ne=Q[0],he=Q[1];c.push(he.length===1?N(he[0]):he.map(N)),c.push(this.outputs[outputIndex$1].serialize())}return c.push(this.otherwise.serialize()),c};var $c=function(a,c,f){this.type=a,this.branches=c,this.otherwise=f};$c.parse=function(a,c){if(a.length<4)return c.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return c.error("Expected an odd number of arguments.");var f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);for(var v=[],I=1;I<a.length-1;I+=2){var A=c.parse(a[I],I,Xt);if(!A)return null;var R=c.parse(a[I+1],I+1,f);if(!R)return null;v.push([A,R]),f=f||R.type}var N=c.parse(a[a.length-1],a.length-1,f);return N?new $c(f,v,N):null},$c.prototype.evaluate=function(a){for(var c=0,f=this.branches;c<f.length;c+=1){var v=f[c],I=v[1];if(v[0].evaluate(a))return I.evaluate(a)}return this.otherwise.evaluate(a)},$c.prototype.eachChild=function(a){for(var c=0,f=this.branches;c<f.length;c+=1){var v=f[c],I=v[1];a(v[0]),a(I)}a(this.otherwise)},$c.prototype.outputDefined=function(){return this.branches.every((function(a){return a[1].outputDefined()}))&&this.otherwise.outputDefined()},$c.prototype.serialize=function(){var a=["case"];return this.eachChild((function(c){a.push(c.serialize())})),a};var $u=function(a,c,f,v){this.type=a,this.input=c,this.beginIndex=f,this.endIndex=v};function jb(a,c){return a==="=="||a==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function $b(a,c,f,v){return v.compare(c,f)===0}function er(a,c,f){var v=a!=="=="&&a!=="!=";return(function(){function I(A,R,N){this.type=Xt,this.lhs=A,this.rhs=R,this.collator=N,this.hasUntypedArgument=A.type.kind==="value"||R.type.kind==="value"}return I.parse=function(A,R){if(A.length!==3&&A.length!==4)return R.error("Expected two or three arguments.");var N=A[0],Z=R.parse(A[1],1,Fe);if(!Z)return null;if(!jb(N,Z.type))return R.concat(1).error('"'+N+`" comparisons are not supported for type '`+En(Z.type)+"'.");var X=R.parse(A[2],2,Fe);if(!X)return null;if(!jb(N,X.type))return R.concat(2).error('"'+N+`" comparisons are not supported for type '`+En(X.type)+"'.");if(Z.type.kind!==X.type.kind&&Z.type.kind!=="value"&&X.type.kind!=="value")return R.error("Cannot compare types '"+En(Z.type)+"' and '"+En(X.type)+"'.");v&&(Z.type.kind==="value"&&X.type.kind!=="value"?Z=new Cr(X.type,[Z]):Z.type.kind!=="value"&&X.type.kind==="value"&&(X=new Cr(Z.type,[X])));var Q=null;if(A.length===4){if(Z.type.kind!=="string"&&X.type.kind!=="string"&&Z.type.kind!=="value"&&X.type.kind!=="value")return R.error("Cannot use collator to compare non-string types.");if(!(Q=R.parse(A[3],3,vt)))return null}return new I(Z,X,Q)},I.prototype.evaluate=function(A){var R=this.lhs.evaluate(A),N=this.rhs.evaluate(A);if(v&&this.hasUntypedArgument){var Z=Yr(R),X=Yr(N);if(Z.kind!==X.kind||Z.kind!=="string"&&Z.kind!=="number")throw new Ps('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+Z.kind+", "+X.kind+") instead.")}if(this.collator&&!v&&this.hasUntypedArgument){var Q=Yr(R),ne=Yr(N);if(Q.kind!=="string"||ne.kind!=="string")return c(A,R,N)}return this.collator?f(A,R,N,this.collator.evaluate(A)):c(A,R,N)},I.prototype.eachChild=function(A){A(this.lhs),A(this.rhs),this.collator&&A(this.collator)},I.prototype.outputDefined=function(){return!0},I.prototype.serialize=function(){var A=[a];return this.eachChild((function(R){A.push(R.serialize())})),A},I})()}$u.parse=function(a,c){if(a.length<=2||a.length>=5)return c.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var f=c.parse(a[1],1,Fe),v=c.parse(a[2],2,pt);if(!f||!v)return null;if(!or(f.type,[Bn(Fe),$t,Fe]))return c.error("Expected first argument to be of type array or string, but found "+En(f.type)+" instead");if(a.length===4){var I=c.parse(a[3],3,pt);return I?new $u(f.type,f,v,I):null}return new $u(f.type,f,v)},$u.prototype.evaluate=function(a){var c=this.input.evaluate(a),f=this.beginIndex.evaluate(a);if(!Gi(c,["string","array"]))throw new Ps("Expected first argument to be of type array or string, but found "+En(Yr(c))+" instead.");if(this.endIndex){var v=this.endIndex.evaluate(a);return c.slice(f,v)}return c.slice(f)},$u.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},$u.prototype.outputDefined=function(){return!1},$u.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var NA=er("==",(function(a,c,f){return c===f}),$b),bg=er("!=",(function(a,c,f){return c!==f}),(function(a,c,f,v){return!$b(0,c,f,v)})),Jb=er("<",(function(a,c,f){return c<f}),(function(a,c,f,v){return v.compare(c,f)<0})),qb=er(">",(function(a,c,f){return c>f}),(function(a,c,f,v){return v.compare(c,f)>0})),Qb=er("<=",(function(a,c,f){return c<=f}),(function(a,c,f,v){return v.compare(c,f)<=0})),e1=er(">=",(function(a,c,f){return c>=f}),(function(a,c,f,v){return v.compare(c,f)>=0})),Jc=function(a,c,f,v,I){this.type=$t,this.number=a,this.locale=c,this.currency=f,this.minFractionDigits=v,this.maxFractionDigits=I};Jc.parse=function(a,c){if(a.length!==3)return c.error("Expected two arguments.");var f=c.parse(a[1],1,pt);if(!f)return null;var v=a[2];if(typeof v!="object"||Array.isArray(v))return c.error("NumberFormat options argument must be an object.");var I=null;if(v.locale&&!(I=c.parse(v.locale,1,$t)))return null;var A=null;if(v.currency&&!(A=c.parse(v.currency,1,$t)))return null;var R=null;if(v["min-fraction-digits"]&&!(R=c.parse(v["min-fraction-digits"],1,pt)))return null;var N=null;return v["max-fraction-digits"]&&!(N=c.parse(v["max-fraction-digits"],1,pt))?null:new Jc(f,I,A,R,N)},Jc.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Jc.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Jc.prototype.outputDefined=function(){return!1},Jc.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var Ju=function(a){this.type=pt,this.input=a};Ju.parse=function(a,c){if(a.length!==2)return c.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var f=c.parse(a[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error("Expected argument of type string or array, but found "+En(f.type)+" instead."):new Ju(f):null},Ju.prototype.evaluate=function(a){var c=this.input.evaluate(a);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Ps("Expected value to be of type string or array, but found "+En(Yr(c))+" instead.")},Ju.prototype.eachChild=function(a){a(this.input)},Ju.prototype.outputDefined=function(){return!1},Ju.prototype.serialize=function(){var a=["length"];return this.eachChild((function(c){a.push(c.serialize())})),a};var qc={"==":NA,"!=":bg,">":qb,"<":Jb,">=":e1,"<=":Qb,array:Cr,at:Hc,boolean:Cr,case:$c,coalesce:Hu,collator:Gl,format:rl,image:ha,in:Kc,"index-of":ju,interpolate:Ys,"interpolate-hcl":Ys,"interpolate-lab":Ys,length:Ju,let:Ku,literal:ho,match:jc,number:Cr,"number-format":Jc,object:Cr,slice:$u,step:Zo,string:Cr,"to-boolean":Ra,"to-color":Ra,"to-number":Ra,"to-string":Ra,var:Xu,within:Ma};function t1(a,c){var f=c[0],v=c[1],I=c[2],A=c[3];f=f.evaluate(a),v=v.evaluate(a),I=I.evaluate(a);var R=A?A.evaluate(a):1,N=r_(f,v,I,R);if(N)throw new Ps(N);return new Ci(f/255*R,v/255*R,I/255*R,R)}function n1(a,c){return a in c}function d_(a,c){var f=c[a];return f===void 0?null:f}function Qc(a){return{type:a}}function i1(a){return{result:"success",value:a}}function eh(a){return{result:"error",value:a}}function th(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function r1(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Vf(a){return!!a.expression&&a.expression.interpolated}function cr(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function xg(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function DA(a){return a}function dd(a,c,f){return a!==void 0?a:c!==void 0?c:f!==void 0?f:void 0}function s1(a,c,f,v,I){return dd(typeof f===I?v[f]:void 0,a.default,c.default)}function VA(a,c,f){if(cr(f)!=="number")return dd(a.default,c.default);var v=a.stops.length;if(v===1||f<=a.stops[0][0])return a.stops[0][1];if(f>=a.stops[v-1][0])return a.stops[v-1][1];var I=vg(a.stops.map((function(A){return A[0]})),f);return a.stops[I][1]}function o1(a,c,f){var v=a.base!==void 0?a.base:1;if(cr(f)!=="number")return dd(a.default,c.default);var I=a.stops.length;if(I===1||f<=a.stops[0][0])return a.stops[0][1];if(f>=a.stops[I-1][0])return a.stops[I-1][1];var A=vg(a.stops.map((function(ne){return ne[0]})),f),R=(function(ne,he,xe,Oe){var De=Oe-xe,Je=ne-xe;return De===0?0:he===1?Je/De:(Math.pow(he,Je)-1)/(Math.pow(he,De)-1)})(f,v,a.stops[A][0],a.stops[A+1][0]),N=a.stops[A][1],Z=a.stops[A+1][1],X=hd[c.type]||DA;if(a.colorSpace&&a.colorSpace!=="rgb"){var Q=Kb[a.colorSpace];X=function(ne,he){return Q.reverse(Q.interpolate(Q.forward(ne),Q.forward(he),R))}}return typeof N.evaluate=="function"?{evaluate:function(){for(var ne=[],he=arguments.length;he--;)ne[he]=arguments[he];var xe=N.evaluate.apply(void 0,ne),Oe=Z.evaluate.apply(void 0,ne);if(xe!==void 0&&Oe!==void 0)return X(xe,Oe,R)}}:X(N,Z,R)}function Ig(a,c,f){return c.type==="color"?f=Ci.parse(f):c.type==="formatted"?f=Ls.fromString(f.toString()):c.type==="resolvedImage"?f=So.fromString(f.toString()):cr(f)===c.type||c.type==="enum"&&c.values[f]||(f=void 0),dd(f,a.default,c.default)}Xs.register(qc,{error:[{kind:"error"},[$t],function(a,c){throw new Ps(c[0].evaluate(a))}],typeof:[$t,[Fe],function(a,c){return En(Yr(c[0].evaluate(a)))}],"to-rgba":[Bn(pt,4),[Yt],function(a,c){return c[0].evaluate(a).toArray()}],rgb:[Yt,[pt,pt,pt],t1],rgba:[Yt,[pt,pt,pt,pt],t1],has:{type:Xt,overloads:[[[$t],function(a,c){return n1(c[0].evaluate(a),a.properties())}],[[$t,Dt],function(a,c){var f=c[1];return n1(c[0].evaluate(a),f.evaluate(a))}]]},get:{type:Fe,overloads:[[[$t],function(a,c){return d_(c[0].evaluate(a),a.properties())}],[[$t,Dt],function(a,c){var f=c[1];return d_(c[0].evaluate(a),f.evaluate(a))}]]},"feature-state":[Fe,[$t],function(a,c){return d_(c[0].evaluate(a),a.featureState||{})}],properties:[Dt,[],function(a){return a.properties()}],"geometry-type":[$t,[],function(a){return a.geometryType()}],id:[Fe,[],function(a){return a.id()}],zoom:[pt,[],function(a){return a.globals.zoom}],"heatmap-density":[pt,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[pt,[],function(a){return a.globals.lineProgress||0}],accumulated:[Fe,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[pt,Qc(pt),function(a,c){for(var f=0,v=0,I=c;v<I.length;v+=1)f+=I[v].evaluate(a);return f}],"*":[pt,Qc(pt),function(a,c){for(var f=1,v=0,I=c;v<I.length;v+=1)f*=I[v].evaluate(a);return f}],"-":{type:pt,overloads:[[[pt,pt],function(a,c){var f=c[1];return c[0].evaluate(a)-f.evaluate(a)}],[[pt],function(a,c){return-c[0].evaluate(a)}]]},"/":[pt,[pt,pt],function(a,c){var f=c[1];return c[0].evaluate(a)/f.evaluate(a)}],"%":[pt,[pt,pt],function(a,c){var f=c[1];return c[0].evaluate(a)%f.evaluate(a)}],ln2:[pt,[],function(){return Math.LN2}],pi:[pt,[],function(){return Math.PI}],e:[pt,[],function(){return Math.E}],"^":[pt,[pt,pt],function(a,c){var f=c[1];return Math.pow(c[0].evaluate(a),f.evaluate(a))}],sqrt:[pt,[pt],function(a,c){return Math.sqrt(c[0].evaluate(a))}],log10:[pt,[pt],function(a,c){return Math.log(c[0].evaluate(a))/Math.LN10}],ln:[pt,[pt],function(a,c){return Math.log(c[0].evaluate(a))}],log2:[pt,[pt],function(a,c){return Math.log(c[0].evaluate(a))/Math.LN2}],sin:[pt,[pt],function(a,c){return Math.sin(c[0].evaluate(a))}],cos:[pt,[pt],function(a,c){return Math.cos(c[0].evaluate(a))}],tan:[pt,[pt],function(a,c){return Math.tan(c[0].evaluate(a))}],asin:[pt,[pt],function(a,c){return Math.asin(c[0].evaluate(a))}],acos:[pt,[pt],function(a,c){return Math.acos(c[0].evaluate(a))}],atan:[pt,[pt],function(a,c){return Math.atan(c[0].evaluate(a))}],min:[pt,Qc(pt),function(a,c){return Math.min.apply(Math,c.map((function(f){return f.evaluate(a)})))}],max:[pt,Qc(pt),function(a,c){return Math.max.apply(Math,c.map((function(f){return f.evaluate(a)})))}],abs:[pt,[pt],function(a,c){return Math.abs(c[0].evaluate(a))}],round:[pt,[pt],function(a,c){var f=c[0].evaluate(a);return f<0?-Math.round(-f):Math.round(f)}],floor:[pt,[pt],function(a,c){return Math.floor(c[0].evaluate(a))}],ceil:[pt,[pt],function(a,c){return Math.ceil(c[0].evaluate(a))}],"filter-==":[Xt,[$t,Fe],function(a,c){var f=c[0],v=c[1];return a.properties()[f.value]===v.value}],"filter-id-==":[Xt,[Fe],function(a,c){var f=c[0];return a.id()===f.value}],"filter-type-==":[Xt,[$t],function(a,c){var f=c[0];return a.geometryType()===f.value}],"filter-<":[Xt,[$t,Fe],function(a,c){var f=c[0],v=c[1],I=a.properties()[f.value],A=v.value;return typeof I==typeof A&&I<A}],"filter-id-<":[Xt,[Fe],function(a,c){var f=c[0],v=a.id(),I=f.value;return typeof v==typeof I&&v<I}],"filter->":[Xt,[$t,Fe],function(a,c){var f=c[0],v=c[1],I=a.properties()[f.value],A=v.value;return typeof I==typeof A&&I>A}],"filter-id->":[Xt,[Fe],function(a,c){var f=c[0],v=a.id(),I=f.value;return typeof v==typeof I&&v>I}],"filter-<=":[Xt,[$t,Fe],function(a,c){var f=c[0],v=c[1],I=a.properties()[f.value],A=v.value;return typeof I==typeof A&&I<=A}],"filter-id-<=":[Xt,[Fe],function(a,c){var f=c[0],v=a.id(),I=f.value;return typeof v==typeof I&&v<=I}],"filter->=":[Xt,[$t,Fe],function(a,c){var f=c[0],v=c[1],I=a.properties()[f.value],A=v.value;return typeof I==typeof A&&I>=A}],"filter-id->=":[Xt,[Fe],function(a,c){var f=c[0],v=a.id(),I=f.value;return typeof v==typeof I&&v>=I}],"filter-has":[Xt,[Fe],function(a,c){return c[0].value in a.properties()}],"filter-has-id":[Xt,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[Xt,[Bn($t)],function(a,c){return c[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[Xt,[Bn(Fe)],function(a,c){return c[0].value.indexOf(a.id())>=0}],"filter-in-small":[Xt,[$t,Bn(Fe)],function(a,c){var f=c[0];return c[1].value.indexOf(a.properties()[f.value])>=0}],"filter-in-large":[Xt,[$t,Bn(Fe)],function(a,c){var f=c[0],v=c[1];return(function(I,A,R,N){for(;R<=N;){var Z=R+N>>1;if(A[Z]===I)return!0;A[Z]>I?N=Z-1:R=Z+1}return!1})(a.properties()[f.value],v.value,0,v.value.length-1)}],all:{type:Xt,overloads:[[[Xt,Xt],function(a,c){var f=c[1];return c[0].evaluate(a)&&f.evaluate(a)}],[Qc(Xt),function(a,c){for(var f=0,v=c;f<v.length;f+=1)if(!v[f].evaluate(a))return!1;return!0}]]},any:{type:Xt,overloads:[[[Xt,Xt],function(a,c){var f=c[1];return c[0].evaluate(a)||f.evaluate(a)}],[Qc(Xt),function(a,c){for(var f=0,v=c;f<v.length;f+=1)if(v[f].evaluate(a))return!0;return!1}]]},"!":[Xt,[Xt],function(a,c){return!c[0].evaluate(a)}],"is-supported-script":[Xt,[$t],function(a,c){var f=a.globals&&a.globals.isSupportedScript;return!f||f(c[0].evaluate(a))}],upcase:[$t,[$t],function(a,c){return c[0].evaluate(a).toUpperCase()}],downcase:[$t,[$t],function(a,c){return c[0].evaluate(a).toLowerCase()}],concat:[$t,Qc(Fe),function(a,c){return c.map((function(f){return Ff(f.evaluate(a))})).join("")}],"resolved-locale":[$t,[vt],function(a,c){return c[0].evaluate(a).resolvedLocale()}]});var fd=function(a,c){this.expression=a,this._warningHistory={},this._evaluator=new su,this._defaultValue=c?(function(f){return f.type==="color"&&xg(f.default)?new Ci(0,0,0,0):f.type==="color"?Ci.parse(f.default)||null:f.default===void 0?null:f.default})(c):null,this._enumValues=c&&c.type==="enum"?c.values:null};function Bf(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in qc}function Cg(a,c){var f=new Yu(qc,[],c?(function(I){var A={color:Yt,string:$t,number:pt,enum:$t,boolean:Xt,formatted:Kt,resolvedImage:yn};return I.type==="array"?Bn(A[I.value]||Fe,I.length):A[I.type]})(c):void 0),v=f.parse(a,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?i1(new fd(v,c)):eh(f.errors)}fd.prototype.evaluateWithoutErrorHandling=function(a,c,f,v,I,A){return this._evaluator.globals=a,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=v,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)},fd.prototype.evaluate=function(a,c,f,v,I,A){this._evaluator.globals=a,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=v,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=A||null;try{var R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Ps("Expected value to be one of "+Object.keys(this._enumValues).map((function(N){return JSON.stringify(N)})).join(", ")+", but found "+JSON.stringify(R)+" instead.");return R}catch(N){return this._warningHistory[N.message]||(this._warningHistory[N.message]=!0,typeof console<"u"&&console.warn(N.message)),this._defaultValue}};var Zf=function(a,c){this.kind=a,this._styleExpression=c,this.isStateDependent=a!=="constant"&&!Uu(c.expression)};Zf.prototype.evaluateWithoutErrorHandling=function(a,c,f,v,I,A){return this._styleExpression.evaluateWithoutErrorHandling(a,c,f,v,I,A)},Zf.prototype.evaluate=function(a,c,f,v,I,A){return this._styleExpression.evaluate(a,c,f,v,I,A)};var pd=function(a,c,f,v){this.kind=a,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=a!=="camera"&&!Uu(c.expression),this.interpolationType=v};function a1(a,c){if((a=Cg(a,c)).result==="error")return a;var f=a.value.expression,v=zu(f);if(!v&&!th(c))return eh([new Tt("","data expressions not supported")]);var I=Yc(f,["zoom"]);if(!I&&!r1(c))return eh([new Tt("","zoom expressions not supported")]);var A=(function R(N){var Z=null;if(N instanceof Ku)Z=R(N.result);else if(N instanceof Hu)for(var X=0,Q=N.args;X<Q.length&&!(Z=R(Q[X]));X+=1);else(N instanceof Zo||N instanceof Ys)&&N.input instanceof Xs&&N.input.name==="zoom"&&(Z=N);return Z instanceof Tt||N.eachChild((function(ne){var he=R(ne);he instanceof Tt?Z=he:!Z&&he?Z=new Tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):Z&&he&&Z!==he&&(Z=new Tt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),Z})(f);return A||I?A instanceof Tt?eh([A]):A instanceof Ys&&!Vf(c)?eh([new Tt("",'"interpolate" expressions cannot be used with this property')]):i1(A?new pd(v?"camera":"composite",a.value,A.labels,A instanceof Ys?A.interpolation:void 0):new Zf(v?"constant":"source",a.value)):eh([new Tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}pd.prototype.evaluateWithoutErrorHandling=function(a,c,f,v,I,A){return this._styleExpression.evaluateWithoutErrorHandling(a,c,f,v,I,A)},pd.prototype.evaluate=function(a,c,f,v,I,A){return this._styleExpression.evaluate(a,c,f,v,I,A)},pd.prototype.interpolationFactor=function(a,c,f){return this.interpolationType?Ys.interpolationFactor(this.interpolationType,a,c,f):0};var gd=function(a,c){this._parameters=a,this._specification=c,At(this,(function f(v,I){var A,R,N,Z=I.type==="color",X=v.stops&&typeof v.stops[0][0]=="object",Q=X||!(X||v.property!==void 0),ne=v.type||(Vf(I)?"exponential":"interval");if(Z&&((v=At({},v)).stops&&(v.stops=v.stops.map((function(Jt){return[Jt[0],Ci.parse(Jt[1])]}))),v.default=Ci.parse(v.default?v.default:I.default)),v.colorSpace&&v.colorSpace!=="rgb"&&!Kb[v.colorSpace])throw new Error("Unknown color space: "+v.colorSpace);if(ne==="exponential")A=o1;else if(ne==="interval")A=VA;else if(ne==="categorical"){A=s1,R=Object.create(null);for(var he=0,xe=v.stops;he<xe.length;he+=1){var Oe=xe[he];R[Oe[0]]=Oe[1]}N=typeof v.stops[0][0]}else{if(ne!=="identity")throw new Error('Unknown function type "'+ne+'"');A=Ig}if(X){for(var De={},Je=[],Xe=0;Xe<v.stops.length;Xe++){var et=v.stops[Xe],st=et[0].zoom;De[st]===void 0&&(De[st]={zoom:st,type:v.type,property:v.property,default:v.default,stops:[]},Je.push(st)),De[st].stops.push([et[0].value,et[1]])}for(var ot=[],ct=0,_t=Je;ct<_t.length;ct+=1){var Ft=_t[ct];ot.push([De[Ft].zoom,f(De[Ft],I)])}var zt={name:"linear"};return{kind:"composite",interpolationType:zt,interpolationFactor:Ys.interpolationFactor.bind(void 0,zt),zoomStops:ot.map((function(Jt){return Jt[0]})),evaluate:function(Jt,bn){var Qt=Jt.zoom;return o1({stops:ot,base:v.base},I,Qt).evaluate(Qt,bn)}}}if(Q){var gn=ne==="exponential"?{name:"exponential",base:v.base!==void 0?v.base:1}:null;return{kind:"camera",interpolationType:gn,interpolationFactor:Ys.interpolationFactor.bind(void 0,gn),zoomStops:v.stops.map((function(Jt){return Jt[0]})),evaluate:function(Jt){return A(v,I,Jt.zoom,R,N)}}}return{kind:"source",evaluate:function(Jt,bn){var Qt=bn&&bn.properties?bn.properties[v.property]:void 0;return Qt===void 0?dd(v.default,I.default):A(v,I,Qt,R,N)}}})(this._parameters,this._specification))};function sl(a){var c=a.key,f=a.value,v=a.valueSpec||{},I=a.objectElementValidators||{},A=a.style,R=a.styleSpec,N=[],Z=cr(f);if(Z!=="object")return[new ke(c,f,"object expected, "+Z+" found")];for(var X in f){var Q=X.split(".")[0],ne=v[Q]||v["*"],he=void 0;if(I[Q])he=I[Q];else if(v[Q])he=vi;else if(I["*"])he=I["*"];else{if(!v["*"]){N.push(new ke(c,f[X],'unknown property "'+X+'"'));continue}he=vi}N=N.concat(he({key:(c&&c+".")+X,value:f[X],valueSpec:ne,style:A,styleSpec:R,object:f,objectKey:X},f))}for(var xe in v)I[xe]||v[xe].required&&v[xe].default===void 0&&f[xe]===void 0&&N.push(new ke(c,f,'missing required property "'+xe+'"'));return N}function l1(a){var c=a.value,f=a.valueSpec,v=a.style,I=a.styleSpec,A=a.key,R=a.arrayElementValidator||vi;if(cr(c)!=="array")return[new ke(A,c,"array expected, "+cr(c)+" found")];if(f.length&&c.length!==f.length)return[new ke(A,c,"array length "+f.length+" expected, length "+c.length+" found")];if(f["min-length"]&&c.length<f["min-length"])return[new ke(A,c,"array length at least "+f["min-length"]+" expected, length "+c.length+" found")];var N={type:f.value,values:f.values};I.$version<7&&(N.function=f.function),cr(f.value)==="object"&&(N=f.value);for(var Z=[],X=0;X<c.length;X++)Z=Z.concat(R({array:c,arrayIndex:X,value:c[X],valueSpec:N,style:v,styleSpec:I,key:A+"["+X+"]"}));return Z}function u1(a){var c=a.key,f=a.value,v=a.valueSpec,I=cr(f);return I==="number"&&f!=f&&(I="NaN"),I!=="number"?[new ke(c,f,"number expected, "+I+" found")]:"minimum"in v&&f<v.minimum?[new ke(c,f,f+" is less than the minimum value "+v.minimum)]:"maximum"in v&&f>v.maximum?[new ke(c,f,f+" is greater than the maximum value "+v.maximum)]:[]}function c1(a){var c,f,v,I=a.valueSpec,A=Lt(a.value.type),R={},N=A!=="categorical"&&a.value.property===void 0,Z=!N,X=cr(a.value.stops)==="array"&&cr(a.value.stops[0])==="array"&&cr(a.value.stops[0][0])==="object",Q=sl({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(xe){if(A==="identity")return[new ke(xe.key,xe.value,'identity function may not have a "stops" property')];var Oe=[],De=xe.value;return Oe=Oe.concat(l1({key:xe.key,value:De,valueSpec:xe.valueSpec,style:xe.style,styleSpec:xe.styleSpec,arrayElementValidator:ne})),cr(De)==="array"&&De.length===0&&Oe.push(new ke(xe.key,De,"array must have at least one stop")),Oe},default:function(xe){return vi({key:xe.key,value:xe.value,valueSpec:I,style:xe.style,styleSpec:xe.styleSpec})}}});return A==="identity"&&N&&Q.push(new ke(a.key,a.value,'missing required property "property"')),A==="identity"||a.value.stops||Q.push(new ke(a.key,a.value,'missing required property "stops"')),A==="exponential"&&a.valueSpec.expression&&!Vf(a.valueSpec)&&Q.push(new ke(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(Z&&!th(a.valueSpec)?Q.push(new ke(a.key,a.value,"property functions not supported")):N&&!r1(a.valueSpec)&&Q.push(new ke(a.key,a.value,"zoom functions not supported"))),A!=="categorical"&&!X||a.value.property!==void 0||Q.push(new ke(a.key,a.value,'"property" property is required')),Q;function ne(xe){var Oe=[],De=xe.value,Je=xe.key;if(cr(De)!=="array")return[new ke(Je,De,"array expected, "+cr(De)+" found")];if(De.length!==2)return[new ke(Je,De,"array length 2 expected, length "+De.length+" found")];if(X){if(cr(De[0])!=="object")return[new ke(Je,De,"object expected, "+cr(De[0])+" found")];if(De[0].zoom===void 0)return[new ke(Je,De,"object stop key must have zoom")];if(De[0].value===void 0)return[new ke(Je,De,"object stop key must have value")];if(v&&v>Lt(De[0].zoom))return[new ke(Je,De[0].zoom,"stop zoom values must appear in ascending order")];Lt(De[0].zoom)!==v&&(v=Lt(De[0].zoom),f=void 0,R={}),Oe=Oe.concat(sl({key:Je+"[0]",value:De[0],valueSpec:{zoom:{}},style:xe.style,styleSpec:xe.styleSpec,objectElementValidators:{zoom:u1,value:he}}))}else Oe=Oe.concat(he({key:Je+"[0]",value:De[0],style:xe.style,styleSpec:xe.styleSpec},De));return Bf(dt(De[1]))?Oe.concat([new ke(Je+"[1]",De[1],"expressions are not allowed in function stops.")]):Oe.concat(vi({key:Je+"[1]",value:De[1],valueSpec:I,style:xe.style,styleSpec:xe.styleSpec}))}function he(xe,Oe){var De=cr(xe.value),Je=Lt(xe.value),Xe=xe.value!==null?xe.value:Oe;if(c){if(De!==c)return[new ke(xe.key,Xe,De+" stop domain type must match previous stop domain type "+c)]}else c=De;if(De!=="number"&&De!=="string"&&De!=="boolean")return[new ke(xe.key,Xe,"stop domain value must be a number, string, or boolean")];if(De!=="number"&&A!=="categorical"){var et="number expected, "+De+" found";return th(I)&&A===void 0&&(et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(xe.key,Xe,et)]}return A!=="categorical"||De!=="number"||isFinite(Je)&&Math.floor(Je)===Je?A!=="categorical"&&De==="number"&&f!==void 0&&Je<f?[new ke(xe.key,Xe,"stop domain values must appear in ascending order")]:(f=Je,A==="categorical"&&Je in R?[new ke(xe.key,Xe,"stop domain values must be unique")]:(R[Je]=!0,[])):[new ke(xe.key,Xe,"integer expected, found "+Je)]}}function nh(a){var c=(a.expressionContext==="property"?a1:Cg)(dt(a.value),a.valueSpec);if(c.result==="error")return c.value.map((function(v){return new ke(""+a.key+v.key,a.value,v.message)}));var f=c.value.expression||c.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!f.outputDefined())return[new ke(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Uu(f))return[new ke(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Uu(f))return[new ke(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Yc(f,["zoom","feature-state"]))return[new ke(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!zu(f))return[new ke(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wf(a){var c=a.key,f=a.value,v=a.valueSpec,I=[];return Array.isArray(v.values)?v.values.indexOf(Lt(f))===-1&&I.push(new ke(c,f,"expected one of ["+v.values.join(", ")+"], "+JSON.stringify(f)+" found")):Object.keys(v.values).indexOf(Lt(f))===-1&&I.push(new ke(c,f,"expected one of ["+Object.keys(v.values).join(", ")+"], "+JSON.stringify(f)+" found")),I}function wg(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var c=0,f=a.slice(1);c<f.length;c+=1){var v=f[c];if(!wg(v)&&typeof v!="boolean")return!1}return!0;default:return!0}}gd.deserialize=function(a){return new gd(a._parameters,a._specification)},gd.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var f_={type:"boolean",default:!1};function Ag(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};wg(a)||(a=Sg(a));var c=Cg(a,f_);if(c.result==="error")throw new Error(c.value.map((function(f){return f.key+": "+f.message})).join(", "));return{filter:function(f,v,I){return c.value.evaluate(f,v,{},I)},needGeometry:(function f(v){if(!Array.isArray(v))return!1;if(v[0]==="within")return!0;for(var I=1;I<v.length;I++)if(f(v[I]))return!0;return!1})(a)}}function BA(a,c){return a<c?-1:a>c?1:0}function Sg(a){if(!a)return!0;var c,f=a[0];return a.length<=1?f!=="any":f==="=="?p_(a[1],a[2],"=="):f==="!="?Eg(p_(a[1],a[2],"==")):f==="<"||f===">"||f==="<="||f===">="?p_(a[1],a[2],f):f==="any"?(c=a.slice(1),["any"].concat(c.map(Sg))):f==="all"?["all"].concat(a.slice(1).map(Sg)):f==="none"?["all"].concat(a.slice(1).map(Sg).map(Eg)):f==="in"?h1(a[1],a.slice(2)):f==="!in"?Eg(h1(a[1],a.slice(2))):f==="has"?d1(a[1]):f==="!has"?Eg(d1(a[1])):f!=="within"||a}function p_(a,c,f){switch(a){case"$type":return["filter-type-"+f,c];case"$id":return["filter-id-"+f,c];default:return["filter-"+f,a,c]}}function h1(a,c){if(c.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some((function(f){return typeof f!=typeof c[0]}))?["filter-in-large",a,["literal",c.sort(BA)]]:["filter-in-small",a,["literal",c]]}}function d1(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Eg(a){return["!",a]}function g_(a){return wg(dt(a.value))?nh(At({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):(function c(f){var v=f.value,I=f.key;if(cr(v)!=="array")return[new ke(I,v,"array expected, "+cr(v)+" found")];var A,R=f.styleSpec,N=[];if(v.length<1)return[new ke(I,v,"filter array must have at least 1 element")];switch(N=N.concat(Wf({key:I+"[0]",value:v[0],valueSpec:R.filter_operator,style:f.style,styleSpec:f.styleSpec})),Lt(v[0])){case"<":case"<=":case">":case">=":v.length>=2&&Lt(v[1])==="$type"&&N.push(new ke(I,v,'"$type" cannot be use with operator "'+v[0]+'"'));case"==":case"!=":v.length!==3&&N.push(new ke(I,v,'filter array for operator "'+v[0]+'" must have 3 elements'));case"in":case"!in":v.length>=2&&(A=cr(v[1]))!=="string"&&N.push(new ke(I+"[1]",v[1],"string expected, "+A+" found"));for(var Z=2;Z<v.length;Z++)A=cr(v[Z]),Lt(v[1])==="$type"?N=N.concat(Wf({key:I+"["+Z+"]",value:v[Z],valueSpec:R.geometry_type,style:f.style,styleSpec:f.styleSpec})):A!=="string"&&A!=="number"&&A!=="boolean"&&N.push(new ke(I+"["+Z+"]",v[Z],"string, number, or boolean expected, "+A+" found"));break;case"any":case"all":case"none":for(var X=1;X<v.length;X++)N=N.concat(c({key:I+"["+X+"]",value:v[X],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":A=cr(v[1]),v.length!==2?N.push(new ke(I,v,'filter array for "'+v[0]+'" operator must have 2 elements')):A!=="string"&&N.push(new ke(I+"[1]",v[1],"string expected, "+A+" found"));break;case"within":A=cr(v[1]),v.length!==2?N.push(new ke(I,v,'filter array for "'+v[0]+'" operator must have 2 elements')):A!=="object"&&N.push(new ke(I+"[1]",v[1],"object expected, "+A+" found"))}return N})(a)}function m_(a,c){var f=a.key,v=a.style,I=a.styleSpec,A=a.value,R=a.objectKey,N=I[c+"_"+a.layerType];if(!N)return[];var Z=R.match(/^(.*)-transition$/);if(c==="paint"&&Z&&N[Z[1]]&&N[Z[1]].transition)return vi({key:f,value:A,valueSpec:I.transition,style:v,styleSpec:I});var X,Q=a.valueSpec||N[R];if(!Q)return[new ke(f,A,'unknown property "'+R+'"')];if(cr(A)==="string"&&th(Q)&&!Q.tokens&&(X=/^{([^}]+)}$/.exec(A)))return[new ke(f,A,'"'+R+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(X[1])+" }`.")];var ne=[];return a.layerType==="symbol"&&(R==="text-field"&&v&&!v.glyphs&&ne.push(new ke(f,A,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&xg(dt(A))&&Lt(A.type)==="identity"&&ne.push(new ke(f,A,'"text-font" does not support identity functions'))),ne.concat(vi({key:a.key,value:A,valueSpec:Q,style:v,styleSpec:I,expressionContext:"property",propertyType:c,propertyKey:R}))}function y_(a){return m_(a,"paint")}function zf(a){return m_(a,"layout")}function f1(a){var c=[],f=a.value,v=a.key,I=a.style,A=a.styleSpec;f.type||f.ref||c.push(new ke(v,f,'either "type" or "ref" is required'));var R,N=Lt(f.type),Z=Lt(f.ref);if(f.id)for(var X=Lt(f.id),Q=0;Q<a.arrayIndex;Q++){var ne=I.layers[Q];Lt(ne.id)===X&&c.push(new ke(v,f.id,'duplicate layer id "'+f.id+'", previously used at line '+ne.id.__line__))}if("ref"in f)["type","source","source-layer","filter","layout"].forEach((function(Oe){Oe in f&&c.push(new ke(v,f[Oe],'"'+Oe+'" is prohibited for ref layers'))})),I.layers.forEach((function(Oe){Lt(Oe.id)===Z&&(R=Oe)})),R?R.ref?c.push(new ke(v,f.ref,"ref cannot reference another ref layer")):N=Lt(R.type):c.push(new ke(v,f.ref,'ref layer "'+Z+'" not found'));else if(N!=="background")if(f.source){var he=I.sources&&I.sources[f.source],xe=he&&Lt(he.type);he?xe==="vector"&&N==="raster"?c.push(new ke(v,f.source,'layer "'+f.id+'" requires a raster source')):xe==="raster"&&N!=="raster"?c.push(new ke(v,f.source,'layer "'+f.id+'" requires a vector source')):xe!=="vector"||f["source-layer"]?xe==="raster-dem"&&N!=="hillshade"?c.push(new ke(v,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="line"||!f.paint||!f.paint["line-gradient"]||xe==="geojson"&&he.lineMetrics||c.push(new ke(v,f,'layer "'+f.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):c.push(new ke(v,f,'layer "'+f.id+'" must specify a "source-layer"')):c.push(new ke(v,f.source,'source "'+f.source+'" not found'))}else c.push(new ke(v,f,'missing required property "source"'));return c=c.concat(sl({key:v,value:f,valueSpec:A.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return vi({key:v+".type",value:f.type,valueSpec:A.layer.type,style:a.style,styleSpec:a.styleSpec,object:f,objectKey:"type"})},filter:g_,layout:function(Oe){return sl({layer:f,key:Oe.key,value:Oe.value,style:Oe.style,styleSpec:Oe.styleSpec,objectElementValidators:{"*":function(De){return zf(At({layerType:N},De))}}})},paint:function(Oe){return sl({layer:f,key:Oe.key,value:Oe.value,style:Oe.style,styleSpec:Oe.styleSpec,objectElementValidators:{"*":function(De){return y_(At({layerType:N},De))}}})}}}))}function ih(a){var c=a.value,f=a.key,v=cr(c);return v!=="string"?[new ke(f,c,"string expected, "+v+" found")]:[]}var wr={promoteId:function(a){var c=a.key,f=a.value;if(cr(f)==="string")return ih({key:c,value:f});var v=[];for(var I in f)v.push.apply(v,ih({key:c+"."+I,value:f[I]}));return v}};function Tg(a){var c=a.value,f=a.key,v=a.styleSpec,I=a.style;if(!c.type)return[new ke(f,c,'"type" is required')];var A,R=Lt(c.type);switch(R){case"vector":case"raster":case"raster-dem":return sl({key:f,value:c,valueSpec:v["source_"+R.replace("-","_")],style:a.style,styleSpec:v,objectElementValidators:wr});case"geojson":if(A=sl({key:f,value:c,valueSpec:v.source_geojson,style:I,styleSpec:v,objectElementValidators:wr}),c.cluster)for(var N in c.clusterProperties){var Z=c.clusterProperties[N],X=Z[0],Q=typeof X=="string"?[X,["accumulated"],["get",N]]:X;A.push.apply(A,nh({key:f+"."+N+".map",value:Z[1],expressionContext:"cluster-map"})),A.push.apply(A,nh({key:f+"."+N+".reduce",value:Q,expressionContext:"cluster-reduce"}))}return A;case"video":return sl({key:f,value:c,valueSpec:v.source_video,style:I,styleSpec:v});case"image":return sl({key:f,value:c,valueSpec:v.source_image,style:I,styleSpec:v});case"canvas":return[new ke(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wf({key:f+".type",value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function rh(a){var c=a.value,f=a.styleSpec,v=f.light,I=a.style,A=[],R=cr(c);if(c===void 0)return A;if(R!=="object")return A.concat([new ke("light",c,"object expected, "+R+" found")]);for(var N in c){var Z=N.match(/^(.*)-transition$/);A=A.concat(Z&&v[Z[1]]&&v[Z[1]].transition?vi({key:N,value:c[N],valueSpec:f.transition,style:I,styleSpec:f}):v[N]?vi({key:N,value:c[N],valueSpec:v[N],style:I,styleSpec:f}):[new ke(N,c[N],'unknown property "'+N+'"')])}return A}var qu={"*":function(){return[]},array:l1,boolean:function(a){var c=a.value,f=a.key,v=cr(c);return v!=="boolean"?[new ke(f,c,"boolean expected, "+v+" found")]:[]},number:u1,color:function(a){var c=a.key,f=a.value,v=cr(f);return v!=="string"?[new ke(c,f,"color expected, "+v+" found")]:Mn(f)===null?[new ke(c,f,'color expected, "'+f+'" found')]:[]},constants:it,enum:Wf,filter:g_,function:c1,layer:f1,object:sl,source:Tg,light:rh,string:ih,formatted:function(a){return ih(a).length===0?[]:nh(a)},resolvedImage:function(a){return ih(a).length===0?[]:nh(a)}};function vi(a){var c=a.value,f=a.valueSpec,v=a.styleSpec;return f.expression&&xg(Lt(c))?c1(a):f.expression&&Bf(dt(c))?nh(a):f.type&&qu[f.type]?qu[f.type](a):sl(At({},a,{valueSpec:f.type?v[f.type]:f}))}function hr(a){var c=a.value,f=a.key,v=ih(a);return v.length||(c.indexOf("{fontstack}")===-1&&v.push(new ke(f,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&v.push(new ke(f,c,'"glyphs" url must include a "{range}" token'))),v}function da(a,c){c===void 0&&(c=be);var f=[];return f=f.concat(vi({key:"",value:a,valueSpec:c.$root,styleSpec:c,style:a,objectElementValidators:{glyphs:hr,"*":function(){return[]}}})),a.constants&&(f=f.concat(it({key:"constants",value:a.constants}))),Uf(f)}function Uf(a){return[].concat(a).sort((function(c,f){return c.line-f.line}))}function md(a){return function(){for(var c=[],f=arguments.length;f--;)c[f]=arguments[f];return Uf(a.apply(this,c))}}da.source=md(Tg),da.light=md(rh),da.layer=md(f1),da.filter=md(g_),da.paintProperty=md(y_),da.layoutProperty=md(zf);var Xf=da,ZA=Xf.light,WA=Xf.paintProperty,Yf=Xf.layoutProperty;function Hf(a,c){var f=!1;if(c&&c.length)for(var v=0,I=c;v<I.length;v+=1)a.fire(new $e(new Error(I[v].message))),f=!0;return f}var ou=os;function os(a,c,f){var v=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var I=new Int32Array(this.arrayBuffer);a=I[0],this.d=(c=I[1])+2*(f=I[2]);for(var A=0;A<this.d*this.d;A++){var R=I[3+A],N=I[3+A+1];v.push(R===N?null:I.subarray(R,N))}var Z=I[3+v.length+1];this.keys=I.subarray(I[3+v.length],Z),this.bboxes=I.subarray(Z),this.insert=this._insertReadonly}else{this.d=c+2*f;for(var X=0;X<this.d*this.d;X++)v.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=a,this.padding=f,this.scale=c/a,this.uid=0;var Q=f/c*a;this.min=-Q,this.max=a+Q}os.prototype.insert=function(a,c,f,v,I){this._forEachCell(c,f,v,I,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(I)},os.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},os.prototype._insertCell=function(a,c,f,v,I,A){this.cells[I].push(A)},os.prototype.query=function(a,c,f,v,I){var A=this.min,R=this.max;if(a<=A&&c<=A&&R<=f&&R<=v&&!I)return Array.prototype.slice.call(this.keys);var N=[];return this._forEachCell(a,c,f,v,this._queryCell,N,{},I),N},os.prototype._queryCell=function(a,c,f,v,I,A,R,N){var Z=this.cells[I];if(Z!==null)for(var X=this.keys,Q=this.bboxes,ne=0;ne<Z.length;ne++){var he=Z[ne];if(R[he]===void 0){var xe=4*he;(N?N(Q[xe+0],Q[xe+1],Q[xe+2],Q[xe+3]):a<=Q[xe+2]&&c<=Q[xe+3]&&f>=Q[xe+0]&&v>=Q[xe+1])?(R[he]=!0,A.push(X[he])):R[he]=!1}}},os.prototype._forEachCell=function(a,c,f,v,I,A,R,N){for(var Z=this._convertToCellCoord(a),X=this._convertToCellCoord(c),Q=this._convertToCellCoord(f),ne=this._convertToCellCoord(v),he=Z;he<=Q;he++)for(var xe=X;xe<=ne;xe++){var Oe=this.d*xe+he;if((!N||N(this._convertFromCellCoord(he),this._convertFromCellCoord(xe),this._convertFromCellCoord(he+1),this._convertFromCellCoord(xe+1)))&&I.call(this,a,c,f,v,Oe,A,R,N))return}},os.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},os.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},os.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,c=3+this.cells.length+1+1,f=0,v=0;v<this.cells.length;v++)f+=this.cells[v].length;var I=new Int32Array(c+f+this.keys.length+this.bboxes.length);I[0]=this.extent,I[1]=this.n,I[2]=this.padding;for(var A=c,R=0;R<a.length;R++){var N=a[R];I[3+R]=A,I.set(N,A),A+=N.length}return I[3+a.length]=A,I.set(this.keys,A),I[3+a.length+1]=A+=this.keys.length,I.set(this.bboxes,A),A+=this.bboxes.length,I.buffer};var Kf=y.ImageData,p1=y.ImageBitmap,ns={};function rn(a,c,f){f===void 0&&(f={}),Object.defineProperty(c,"_classRegistryKey",{value:a,writeable:!1}),ns[a]={klass:c,omit:f.omit||[],shallow:f.shallow||[]}}for(var Wo in rn("Object",Object),ou.serialize=function(a,c){var f=a.toArrayBuffer();return c&&c.push(f),{buffer:f}},ou.deserialize=function(a){return new ou(a.buffer)},rn("Grid",ou),rn("Color",Ci),rn("Error",Error),rn("ResolvedImage",So),rn("StylePropertyFunction",gd),rn("StyleExpression",fd,{omit:["_evaluator"]}),rn("ZoomDependentExpression",pd),rn("ZoomConstantExpression",Zf),rn("CompoundExpression",Xs,{omit:["_evaluate"]}),qc)qc[Wo]._classRegistryKey||rn("Expression_"+Wo,qc[Wo]);function Rg(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function yd(a){return p1&&a instanceof p1}function ol(a,c){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Rg(a)||yd(a))return c&&c.push(a),a;if(ArrayBuffer.isView(a)){var f=a;return c&&c.push(f.buffer),f}if(a instanceof Kf)return c&&c.push(a.data.buffer),a;if(Array.isArray(a)){for(var v=[],I=0,A=a;I<A.length;I+=1)v.push(ol(A[I],c));return v}if(typeof a=="object"){var R=a.constructor,N=R._classRegistryKey;if(!N)throw new Error("can't serialize object of unregistered class");var Z=R.serialize?R.serialize(a,c):{};if(!R.serialize){for(var X in a)if(a.hasOwnProperty(X)&&!(ns[N].omit.indexOf(X)>=0)){var Q=a[X];Z[X]=ns[N].shallow.indexOf(X)>=0?Q:ol(Q,c)}a instanceof Error&&(Z.message=a.message)}if(Z.$name)throw new Error("$name property is reserved for worker serialization logic.");return N!=="Object"&&(Z.$name=N),Z}throw new Error("can't serialize object of type "+typeof a)}function zo(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Rg(a)||yd(a)||ArrayBuffer.isView(a)||a instanceof Kf)return a;if(Array.isArray(a))return a.map(zo);if(typeof a=="object"){var c=a.$name||"Object",f=ns[c].klass;if(!f)throw new Error("can't deserialize unregistered class "+c);if(f.deserialize)return f.deserialize(a);for(var v=Object.create(f.prototype),I=0,A=Object.keys(a);I<A.length;I+=1){var R=A[I];if(R!=="$name"){var N=a[R];v[R]=ns[c].shallow.indexOf(R)>=0?N:zo(N)}}return v}throw new Error("can't deserialize object of type "+typeof a)}var __=function(){this.first=!0};__.prototype.update=function(a,c){var f=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=f,!0))};var Ht={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function v_(a){for(var c=0,f=a;c<f.length;c+=1)if(Mg(f[c].charCodeAt(0)))return!0;return!1}function Mg(a){return!(a!==746&&a!==747&&(a<4352||!(Ht["Bopomofo Extended"](a)||Ht.Bopomofo(a)||Ht["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ht["CJK Compatibility Ideographs"](a)||Ht["CJK Compatibility"](a)||Ht["CJK Radicals Supplement"](a)||Ht["CJK Strokes"](a)||!(!Ht["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Ht["CJK Unified Ideographs Extension A"](a)||Ht["CJK Unified Ideographs"](a)||Ht["Enclosed CJK Letters and Months"](a)||Ht["Hangul Compatibility Jamo"](a)||Ht["Hangul Jamo Extended-A"](a)||Ht["Hangul Jamo Extended-B"](a)||Ht["Hangul Jamo"](a)||Ht["Hangul Syllables"](a)||Ht.Hiragana(a)||Ht["Ideographic Description Characters"](a)||Ht.Kanbun(a)||Ht["Kangxi Radicals"](a)||Ht["Katakana Phonetic Extensions"](a)||Ht.Katakana(a)&&a!==12540||!(!Ht["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Ht["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ht["Unified Canadian Aboriginal Syllabics"](a)||Ht["Unified Canadian Aboriginal Syllabics Extended"](a)||Ht["Vertical Forms"](a)||Ht["Yijing Hexagram Symbols"](a)||Ht["Yi Syllables"](a)||Ht["Yi Radicals"](a))))}function b_(a){return!(Mg(a)||(function(c){return!!(Ht["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||Ht["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||Ht["Letterlike Symbols"](c)||Ht["Number Forms"](c)||Ht["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||Ht["Control Pictures"](c)&&c!==9251||Ht["Optical Character Recognition"](c)||Ht["Enclosed Alphanumerics"](c)||Ht["Geometric Shapes"](c)||Ht["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||Ht["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||Ht["CJK Symbols and Punctuation"](c)||Ht.Katakana(c)||Ht["Private Use Area"](c)||Ht["CJK Compatibility Forms"](c)||Ht["Small Form Variants"](c)||Ht["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)})(a))}function ka(a){return a>=1424&&a<=2303||Ht["Arabic Presentation Forms-A"](a)||Ht["Arabic Presentation Forms-B"](a)}function Uo(a,c){return!(!c&&ka(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ht.Khmer(a))}function kg(a){for(var c=0,f=a;c<f.length;c+=1)if(ka(f[c].charCodeAt(0)))return!0;return!1}var Lg=null,Xo="unavailable",au=null,g1=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Xo="error"),Lg&&Lg(a)};function jf(){x_.fire(new Me("pluginStateChange",{pluginStatus:Xo,pluginURL:au}))}var x_=new Ye,I_=function(){return Xo},al=function(){if(Xo!=="deferred"||!au)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Xo="loading",jf(),au&&Pl({url:au},(function(a){a?g1(a):(Xo="loaded",jf())}))},fa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Xo==="loaded"||fa.applyArabicShaping!=null},isLoading:function(){return Xo==="loading"},setState:function(a){Xo=a.pluginStatus,au=a.pluginURL},isParsed:function(){return fa.applyArabicShaping!=null&&fa.processBidirectionalText!=null&&fa.processStyledBidirectionalText!=null},getPluginURL:function(){return au}},ui=function(a,c){this.zoom=a,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new __,this.transition={})};ui.prototype.isSupportedScript=function(a){return(function(c,f){for(var v=0,I=c;v<I.length;v+=1)if(!Uo(I[v].charCodeAt(0),f))return!1;return!0})(a,fa.isLoaded())},ui.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ui.prototype.getCrossfadeParameters=function(){var a=this.zoom,c=a-Math.floor(a),f=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}};var Fl=function(a,c){this.property=a,this.value=c,this.expression=(function(f,v){if(xg(f))return new gd(f,v);if(Bf(f)){var I=a1(f,v);if(I.result==="error")throw new Error(I.value.map((function(R){return R.key+": "+R.message})).join(", "));return I.value}var A=f;return typeof f=="string"&&v.type==="color"&&(A=Ci.parse(f)),{kind:"constant",evaluate:function(){return A}}})(c===void 0?a.specification.default:c,a.specification)};Fl.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Fl.prototype.possiblyEvaluate=function(a,c,f){return this.property.possiblyEvaluate(this,a,c,f)};var La=function(a){this.property=a,this.value=new Fl(a,void 0)};La.prototype.transitioned=function(a,c){return new sh(this.property,this.value,c,k({},a.transition,this.transition),a.now)},La.prototype.untransitioned=function(){return new sh(this.property,this.value,null,{},0)};var Hs=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};Hs.prototype.getValue=function(a){return fe(this._values[a].value.value)},Hs.prototype.setValue=function(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new La(this._values[a].property)),this._values[a].value=new Fl(this._values[a].property,c===null?void 0:fe(c))},Hs.prototype.getTransition=function(a){return fe(this._values[a].transition)},Hs.prototype.setTransition=function(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new La(this._values[a].property)),this._values[a].transition=fe(c)||void 0},Hs.prototype.serialize=function(){for(var a={},c=0,f=Object.keys(this._values);c<f.length;c+=1){var v=f[c],I=this.getValue(v);I!==void 0&&(a[v]=I);var A=this.getTransition(v);A!==void 0&&(a[v+"-transition"]=A)}return a},Hs.prototype.transitioned=function(a,c){for(var f=new Qu(this._properties),v=0,I=Object.keys(this._values);v<I.length;v+=1){var A=I[v];f._values[A]=this._values[A].transitioned(a,c._values[A])}return f},Hs.prototype.untransitioned=function(){for(var a=new Qu(this._properties),c=0,f=Object.keys(this._values);c<f.length;c+=1){var v=f[c];a._values[v]=this._values[v].untransitioned()}return a};var sh=function(a,c,f,v,I){this.property=a,this.value=c,this.begin=I+v.delay||0,this.end=this.begin+v.duration||0,a.specification.transition&&(v.delay||v.duration)&&(this.prior=f)};sh.prototype.possiblyEvaluate=function(a,c,f){var v=a.now||0,I=this.value.possiblyEvaluate(a,c,f),A=this.prior;if(A){if(v>this.end)return this.prior=null,I;if(this.value.isDataDriven())return this.prior=null,I;if(v<this.begin)return A.possiblyEvaluate(a,c,f);var R=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(a,c,f),I,(function(N){if(N<=0)return 0;if(N>=1)return 1;var Z=N*N,X=Z*N;return 4*(N<.5?X:3*(N-Z)+X-.75)})(R))}return I};var Qu=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};Qu.prototype.possiblyEvaluate=function(a,c,f){for(var v=new $f(this._properties),I=0,A=Object.keys(this._values);I<A.length;I+=1){var R=A[I];v._values[R]=this._values[R].possiblyEvaluate(a,c,f)}return v},Qu.prototype.hasTransition=function(){for(var a=0,c=Object.keys(this._values);a<c.length;a+=1)if(this._values[c[a]].prior)return!0;return!1};var ll=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};ll.prototype.getValue=function(a){return fe(this._values[a].value)},ll.prototype.setValue=function(a,c){this._values[a]=new Fl(this._values[a].property,c===null?void 0:fe(c))},ll.prototype.serialize=function(){for(var a={},c=0,f=Object.keys(this._values);c<f.length;c+=1){var v=f[c],I=this.getValue(v);I!==void 0&&(a[v]=I)}return a},ll.prototype.possiblyEvaluate=function(a,c,f){for(var v=new $f(this._properties),I=0,A=Object.keys(this._values);I<A.length;I+=1){var R=A[I];v._values[R]=this._values[R].possiblyEvaluate(a,c,f)}return v};var po=function(a,c,f){this.property=a,this.value=c,this.parameters=f};po.prototype.isConstant=function(){return this.value.kind==="constant"},po.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},po.prototype.evaluate=function(a,c,f,v){return this.property.evaluate(this.value,this.parameters,a,c,f,v)};var $f=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};$f.prototype.get=function(a){return this._values[a]};var _n=function(a){this.specification=a};_n.prototype.possiblyEvaluate=function(a,c){return a.expression.evaluate(c)},_n.prototype.interpolate=function(a,c,f){var v=hd[this.specification.type];return v?v(a,c,f):a};var un=function(a,c){this.specification=a,this.overrides=c};un.prototype.possiblyEvaluate=function(a,c,f,v){return new po(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(c,null,{},f,v)}:a.expression,c)},un.prototype.interpolate=function(a,c,f){if(a.value.kind!=="constant"||c.value.kind!=="constant")return a;if(a.value.value===void 0||c.value.value===void 0)return new po(this,{kind:"constant",value:void 0},a.parameters);var v=hd[this.specification.type];return v?new po(this,{kind:"constant",value:v(a.value.value,c.value.value,f)},a.parameters):a},un.prototype.evaluate=function(a,c,f,v,I,A){return a.kind==="constant"?a.value:a.evaluate(c,f,v,I,A)};var Pg=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.possiblyEvaluate=function(f,v,I,A){if(f.value===void 0)return new po(this,{kind:"constant",value:void 0},v);if(f.expression.kind==="constant"){var R=f.expression.evaluate(v,null,{},I,A),N=f.property.specification.type==="resolvedImage"&&typeof R!="string"?R.name:R,Z=this._calculate(N,N,N,v);return new po(this,{kind:"constant",value:Z},v)}if(f.expression.kind==="camera"){var X=this._calculate(f.expression.evaluate({zoom:v.zoom-1}),f.expression.evaluate({zoom:v.zoom}),f.expression.evaluate({zoom:v.zoom+1}),v);return new po(this,{kind:"constant",value:X},v)}return new po(this,f.expression,v)},c.prototype.evaluate=function(f,v,I,A,R,N){if(f.kind==="source"){var Z=f.evaluate(v,I,A,R,N);return this._calculate(Z,Z,Z,v)}return f.kind==="composite"?this._calculate(f.evaluate({zoom:Math.floor(v.zoom)-1},I,A),f.evaluate({zoom:Math.floor(v.zoom)},I,A),f.evaluate({zoom:Math.floor(v.zoom)+1},I,A),v):f.value},c.prototype._calculate=function(f,v,I,A){return A.zoom>A.zoomHistory.lastIntegerZoom?{from:f,to:v}:{from:I,to:v}},c.prototype.interpolate=function(f){return f},c})(un),go=function(a){this.specification=a};go.prototype.possiblyEvaluate=function(a,c,f,v){if(a.value!==void 0){if(a.expression.kind==="constant"){var I=a.expression.evaluate(c,null,{},f,v);return this._calculate(I,I,I,c)}return this._calculate(a.expression.evaluate(new ui(Math.floor(c.zoom-1),c)),a.expression.evaluate(new ui(Math.floor(c.zoom),c)),a.expression.evaluate(new ui(Math.floor(c.zoom+1),c)),c)}},go.prototype._calculate=function(a,c,f,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:a,to:c}:{from:f,to:c}},go.prototype.interpolate=function(a){return a};var ul=function(a){this.specification=a};ul.prototype.possiblyEvaluate=function(a,c,f,v){return!!a.expression.evaluate(c,null,{},f,v)},ul.prototype.interpolate=function(){return!1};var Ks=function(a){for(var c in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var f=a[c];f.specification.overridable&&this.overridableProperties.push(c);var v=this.defaultPropertyValues[c]=new Fl(f,void 0),I=this.defaultTransitionablePropertyValues[c]=new La(f);this.defaultTransitioningPropertyValues[c]=I.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=v.possiblyEvaluate({})}};rn("DataDrivenProperty",un),rn("DataConstantProperty",_n),rn("CrossFadedDataDrivenProperty",Pg),rn("CrossFadedProperty",go),rn("ColorRampProperty",ul);var Ol=(function(a){function c(f,v){if(a.call(this),this.id=f.id,this.type=f.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},f.type!=="custom"&&(this.metadata=(f=f).metadata,this.minzoom=f.minzoom,this.maxzoom=f.maxzoom,f.type!=="background"&&(this.source=f.source,this.sourceLayer=f["source-layer"],this.filter=f.filter),v.layout&&(this._unevaluatedLayout=new ll(v.layout)),v.paint)){for(var I in this._transitionablePaint=new Hs(v.paint),f.paint)this.setPaintProperty(I,f.paint[I],{validate:!1});for(var A in f.layout)this.setLayoutProperty(A,f.layout[A],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $f(v.paint)}}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},c.prototype.getLayoutProperty=function(f){return f==="visibility"?this.visibility:this._unevaluatedLayout.getValue(f)},c.prototype.setLayoutProperty=function(f,v,I){I===void 0&&(I={}),v!=null&&this._validate(Yf,"layers."+this.id+".layout."+f,f,v,I)||(f!=="visibility"?this._unevaluatedLayout.setValue(f,v):this.visibility=v)},c.prototype.getPaintProperty=function(f){return te(f,"-transition")?this._transitionablePaint.getTransition(f.slice(0,-11)):this._transitionablePaint.getValue(f)},c.prototype.setPaintProperty=function(f,v,I){if(I===void 0&&(I={}),v!=null&&this._validate(WA,"layers."+this.id+".paint."+f,f,v,I))return!1;if(te(f,"-transition"))return this._transitionablePaint.setTransition(f.slice(0,-11),v||void 0),!1;var A=this._transitionablePaint._values[f],R=A.property.specification["property-type"]==="cross-faded-data-driven",N=A.value.isDataDriven(),Z=A.value;this._transitionablePaint.setValue(f,v),this._handleSpecialPaintPropertyUpdate(f);var X=this._transitionablePaint._values[f].value;return X.isDataDriven()||N||R||this._handleOverridablePaintPropertyUpdate(f,Z,X)},c.prototype._handleSpecialPaintPropertyUpdate=function(f){},c.prototype._handleOverridablePaintPropertyUpdate=function(f,v,I){return!1},c.prototype.isHidden=function(f){return!!(this.minzoom&&f<this.minzoom)||!!(this.maxzoom&&f>=this.maxzoom)||this.visibility==="none"},c.prototype.updateTransitions=function(f){this._transitioningPaint=this._transitionablePaint.transitioned(f,this._transitioningPaint)},c.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},c.prototype.recalculate=function(f,v){f.getCrossfadeParameters&&(this._crossfadeParameters=f.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(f,void 0,v)),this.paint=this._transitioningPaint.possiblyEvaluate(f,void 0,v)},c.prototype.serialize=function(){var f={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(f.layout=f.layout||{},f.layout.visibility=this.visibility),ae(f,(function(v,I){return!(v===void 0||I==="layout"&&!Object.keys(v).length||I==="paint"&&!Object.keys(v).length)}))},c.prototype._validate=function(f,v,I,A,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Hf(this,f.call(Xf,{key:v,layerType:this.type,objectKey:I,value:A,styleSpec:be,style:{glyphs:!0,sprite:!0}}))},c.prototype.is3D=function(){return!1},c.prototype.isTileClipped=function(){return!1},c.prototype.hasOffscreenPass=function(){return!1},c.prototype.resize=function(){},c.prototype.isStateDependent=function(){for(var f in this.paint._values){var v=this.paint.get(f);if(v instanceof po&&th(v.property.specification)&&(v.value.kind==="source"||v.value.kind==="composite")&&v.value.isStateDependent)return!0}return!1},c})(Ye),C_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Gg=function(a,c){this._structArray=a,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Zi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Gs(a,c){c===void 0&&(c=1);var f=0,v=0;return{members:a.map((function(I){var A=C_[I.type].BYTES_PER_ELEMENT,R=f=m1(f,Math.max(c,A)),N=I.components||1;return v=Math.max(v,A),f+=A*N,{name:I.name,type:I.type,components:N,offset:R}})),size:m1(f,Math.max(v,c)),alignment:c}}function m1(a,c){return Math.ceil(a/c)*c}Zi.serialize=function(a,c){return a._trim(),c&&(a.isTransferred=!0,c.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Zi.deserialize=function(a){var c=Object.create(this.prototype);return c.arrayBuffer=a.arrayBuffer,c.length=a.length,c.capacity=a.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c},Zi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Zi.prototype.clear=function(){this.length=0},Zi.prototype.resize=function(a){this.reserve(a),this.length=a},Zi.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}},Zi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var oh=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v){var I=this.length;return this.resize(I+1),this.emplace(I,f,v)},c.prototype.emplace=function(f,v,I){var A=2*f;return this.int16[A+0]=v,this.int16[A+1]=I,f},c})(Zi);oh.prototype.bytesPerElement=4,rn("StructArrayLayout2i4",oh);var w_=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A){var R=this.length;return this.resize(R+1),this.emplace(R,f,v,I,A)},c.prototype.emplace=function(f,v,I,A,R){var N=4*f;return this.int16[N+0]=v,this.int16[N+1]=I,this.int16[N+2]=A,this.int16[N+3]=R,f},c})(Zi);w_.prototype.bytesPerElement=8,rn("StructArrayLayout4i8",w_);var lu=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,N){var Z=this.length;return this.resize(Z+1),this.emplace(Z,f,v,I,A,R,N)},c.prototype.emplace=function(f,v,I,A,R,N,Z){var X=6*f;return this.int16[X+0]=v,this.int16[X+1]=I,this.int16[X+2]=A,this.int16[X+3]=R,this.int16[X+4]=N,this.int16[X+5]=Z,f},c})(Zi);lu.prototype.bytesPerElement=12,rn("StructArrayLayout2i4i12",lu);var Yo=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,N){var Z=this.length;return this.resize(Z+1),this.emplace(Z,f,v,I,A,R,N)},c.prototype.emplace=function(f,v,I,A,R,N,Z){var X=4*f,Q=8*f;return this.int16[X+0]=v,this.int16[X+1]=I,this.uint8[Q+4]=A,this.uint8[Q+5]=R,this.uint8[Q+6]=N,this.uint8[Q+7]=Z,f},c})(Zi);Yo.prototype.bytesPerElement=8,rn("StructArrayLayout2i4ub8",Yo);var _d=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v){var I=this.length;return this.resize(I+1),this.emplace(I,f,v)},c.prototype.emplace=function(f,v,I){var A=2*f;return this.float32[A+0]=v,this.float32[A+1]=I,f},c})(Zi);_d.prototype.bytesPerElement=8,rn("StructArrayLayout2f8",_d);var Nl=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,N,Z,X,Q,ne){var he=this.length;return this.resize(he+1),this.emplace(he,f,v,I,A,R,N,Z,X,Q,ne)},c.prototype.emplace=function(f,v,I,A,R,N,Z,X,Q,ne,he){var xe=10*f;return this.uint16[xe+0]=v,this.uint16[xe+1]=I,this.uint16[xe+2]=A,this.uint16[xe+3]=R,this.uint16[xe+4]=N,this.uint16[xe+5]=Z,this.uint16[xe+6]=X,this.uint16[xe+7]=Q,this.uint16[xe+8]=ne,this.uint16[xe+9]=he,f},c})(Zi);Nl.prototype.bytesPerElement=20,rn("StructArrayLayout10ui20",Nl);var Fg=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,N,Z,X,Q,ne,he,xe){var Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,f,v,I,A,R,N,Z,X,Q,ne,he,xe)},c.prototype.emplace=function(f,v,I,A,R,N,Z,X,Q,ne,he,xe,Oe){var De=12*f;return this.int16[De+0]=v,this.int16[De+1]=I,this.int16[De+2]=A,this.int16[De+3]=R,this.uint16[De+4]=N,this.uint16[De+5]=Z,this.uint16[De+6]=X,this.uint16[De+7]=Q,this.int16[De+8]=ne,this.int16[De+9]=he,this.int16[De+10]=xe,this.int16[De+11]=Oe,f},c})(Zi);Fg.prototype.bytesPerElement=24,rn("StructArrayLayout4i4ui4i24",Fg);var vd=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I){var A=this.length;return this.resize(A+1),this.emplace(A,f,v,I)},c.prototype.emplace=function(f,v,I,A){var R=3*f;return this.float32[R+0]=v,this.float32[R+1]=I,this.float32[R+2]=A,f},c})(Zi);vd.prototype.bytesPerElement=12,rn("StructArrayLayout3f12",vd);var Jf=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f){var v=this.length;return this.resize(v+1),this.emplace(v,f)},c.prototype.emplace=function(f,v){return this.uint32[1*f+0]=v,f},c})(Zi);Jf.prototype.bytesPerElement=4,rn("StructArrayLayout1ul4",Jf);var A_=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,N,Z,X,Q){var ne=this.length;return this.resize(ne+1),this.emplace(ne,f,v,I,A,R,N,Z,X,Q)},c.prototype.emplace=function(f,v,I,A,R,N,Z,X,Q,ne){var he=10*f,xe=5*f;return this.int16[he+0]=v,this.int16[he+1]=I,this.int16[he+2]=A,this.int16[he+3]=R,this.int16[he+4]=N,this.int16[he+5]=Z,this.uint32[xe+3]=X,this.uint16[he+8]=Q,this.uint16[he+9]=ne,f},c})(Zi);A_.prototype.bytesPerElement=20,rn("StructArrayLayout6i1ul2ui20",A_);var bd=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,N){var Z=this.length;return this.resize(Z+1),this.emplace(Z,f,v,I,A,R,N)},c.prototype.emplace=function(f,v,I,A,R,N,Z){var X=6*f;return this.int16[X+0]=v,this.int16[X+1]=I,this.int16[X+2]=A,this.int16[X+3]=R,this.int16[X+4]=N,this.int16[X+5]=Z,f},c})(Zi);bd.prototype.bytesPerElement=12,rn("StructArrayLayout2i2i2i12",bd);var ah=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R){var N=this.length;return this.resize(N+1),this.emplace(N,f,v,I,A,R)},c.prototype.emplace=function(f,v,I,A,R,N){var Z=4*f,X=8*f;return this.float32[Z+0]=v,this.float32[Z+1]=I,this.float32[Z+2]=A,this.int16[X+6]=R,this.int16[X+7]=N,f},c})(Zi);ah.prototype.bytesPerElement=16,rn("StructArrayLayout2f1f2i16",ah);var S_=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A){var R=this.length;return this.resize(R+1),this.emplace(R,f,v,I,A)},c.prototype.emplace=function(f,v,I,A,R){var N=12*f,Z=3*f;return this.uint8[N+0]=v,this.uint8[N+1]=I,this.float32[Z+1]=A,this.float32[Z+2]=R,f},c})(Zi);S_.prototype.bytesPerElement=12,rn("StructArrayLayout2ub2f12",S_);var ec=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I){var A=this.length;return this.resize(A+1),this.emplace(A,f,v,I)},c.prototype.emplace=function(f,v,I,A){var R=3*f;return this.uint16[R+0]=v,this.uint16[R+1]=I,this.uint16[R+2]=A,f},c})(Zi);ec.prototype.bytesPerElement=6,rn("StructArrayLayout3ui6",ec);var tc=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,N,Z,X,Q,ne,he,xe,Oe,De,Je,Xe,et){var st=this.length;return this.resize(st+1),this.emplace(st,f,v,I,A,R,N,Z,X,Q,ne,he,xe,Oe,De,Je,Xe,et)},c.prototype.emplace=function(f,v,I,A,R,N,Z,X,Q,ne,he,xe,Oe,De,Je,Xe,et,st){var ot=24*f,ct=12*f,_t=48*f;return this.int16[ot+0]=v,this.int16[ot+1]=I,this.uint16[ot+2]=A,this.uint16[ot+3]=R,this.uint32[ct+2]=N,this.uint32[ct+3]=Z,this.uint32[ct+4]=X,this.uint16[ot+10]=Q,this.uint16[ot+11]=ne,this.uint16[ot+12]=he,this.float32[ct+7]=xe,this.float32[ct+8]=Oe,this.uint8[_t+36]=De,this.uint8[_t+37]=Je,this.uint8[_t+38]=Xe,this.uint32[ct+10]=et,this.int16[ot+22]=st,f},c})(Zi);tc.prototype.bytesPerElement=48,rn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",tc);var Og=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,N,Z,X,Q,ne,he,xe,Oe,De,Je,Xe,et,st,ot,ct,_t,Ft,zt,gn,Jt,bn,Qt,qn){var kn=this.length;return this.resize(kn+1),this.emplace(kn,f,v,I,A,R,N,Z,X,Q,ne,he,xe,Oe,De,Je,Xe,et,st,ot,ct,_t,Ft,zt,gn,Jt,bn,Qt,qn)},c.prototype.emplace=function(f,v,I,A,R,N,Z,X,Q,ne,he,xe,Oe,De,Je,Xe,et,st,ot,ct,_t,Ft,zt,gn,Jt,bn,Qt,qn,kn){var cn=34*f,ri=17*f;return this.int16[cn+0]=v,this.int16[cn+1]=I,this.int16[cn+2]=A,this.int16[cn+3]=R,this.int16[cn+4]=N,this.int16[cn+5]=Z,this.int16[cn+6]=X,this.int16[cn+7]=Q,this.uint16[cn+8]=ne,this.uint16[cn+9]=he,this.uint16[cn+10]=xe,this.uint16[cn+11]=Oe,this.uint16[cn+12]=De,this.uint16[cn+13]=Je,this.uint16[cn+14]=Xe,this.uint16[cn+15]=et,this.uint16[cn+16]=st,this.uint16[cn+17]=ot,this.uint16[cn+18]=ct,this.uint16[cn+19]=_t,this.uint16[cn+20]=Ft,this.uint16[cn+21]=zt,this.uint16[cn+22]=gn,this.uint32[ri+12]=Jt,this.float32[ri+13]=bn,this.float32[ri+14]=Qt,this.float32[ri+15]=qn,this.float32[ri+16]=kn,f},c})(Zi);Og.prototype.bytesPerElement=68,rn("StructArrayLayout8i15ui1ul4f68",Og);var nc=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f){var v=this.length;return this.resize(v+1),this.emplace(v,f)},c.prototype.emplace=function(f,v){return this.float32[1*f+0]=v,f},c})(Zi);nc.prototype.bytesPerElement=4,rn("StructArrayLayout1f4",nc);var Pa=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I){var A=this.length;return this.resize(A+1),this.emplace(A,f,v,I)},c.prototype.emplace=function(f,v,I,A){var R=3*f;return this.int16[R+0]=v,this.int16[R+1]=I,this.int16[R+2]=A,f},c})(Zi);Pa.prototype.bytesPerElement=6,rn("StructArrayLayout3i6",Pa);var E_=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I){var A=this.length;return this.resize(A+1),this.emplace(A,f,v,I)},c.prototype.emplace=function(f,v,I,A){var R=4*f;return this.uint32[2*f+0]=v,this.uint16[R+2]=I,this.uint16[R+3]=A,f},c})(Zi);E_.prototype.bytesPerElement=8,rn("StructArrayLayout1ul2ui8",E_);var qf=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v){var I=this.length;return this.resize(I+1),this.emplace(I,f,v)},c.prototype.emplace=function(f,v,I){var A=2*f;return this.uint16[A+0]=v,this.uint16[A+1]=I,f},c})(Zi);qf.prototype.bytesPerElement=4,rn("StructArrayLayout2ui4",qf);var T_=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f){var v=this.length;return this.resize(v+1),this.emplace(v,f)},c.prototype.emplace=function(f,v){return this.uint16[1*f+0]=v,f},c})(Zi);T_.prototype.bytesPerElement=2,rn("StructArrayLayout1ui2",T_);var Ng=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A){var R=this.length;return this.resize(R+1),this.emplace(R,f,v,I,A)},c.prototype.emplace=function(f,v,I,A,R){var N=4*f;return this.float32[N+0]=v,this.float32[N+1]=I,this.float32[N+2]=A,this.float32[N+3]=R,f},c})(Zi);Ng.prototype.bytesPerElement=16,rn("StructArrayLayout4f16",Ng);var p=(function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c;var f={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return f.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},f.x1.get=function(){return this._structArray.int16[this._pos2+2]},f.y1.get=function(){return this._structArray.int16[this._pos2+3]},f.x2.get=function(){return this._structArray.int16[this._pos2+4]},f.y2.get=function(){return this._structArray.int16[this._pos2+5]},f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.anchorPoint.get=function(){return new d(this.anchorPointX,this.anchorPointY)},Object.defineProperties(c.prototype,f),c})(Gg);p.prototype.size=20;var _=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.get=function(f){return new p(this,f)},c})(A_);rn("CollisionBoxArray",_);var g=(function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},f.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},f.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},f.segment.get=function(){return this._structArray.uint16[this._pos2+10]},f.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},f.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},f.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},f.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},f.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},f.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},f.placedOrientation.set=function(v){this._structArray.uint8[this._pos1+37]=v},f.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},f.hidden.set=function(v){this._structArray.uint8[this._pos1+38]=v},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},f.crossTileID.set=function(v){this._structArray.uint32[this._pos4+10]=v},f.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(c.prototype,f),c})(Gg);g.prototype.size=48;var b=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.get=function(f){return new g(this,f)},c})(tc);rn("PlacedSymbolArray",b);var S=(function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},f.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},f.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},f.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},f.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},f.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},f.key.get=function(){return this._structArray.uint16[this._pos2+8]},f.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},f.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},f.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},f.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},f.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},f.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},f.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},f.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},f.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},f.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},f.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},f.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},f.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},f.crossTileID.set=function(v){this._structArray.uint32[this._pos4+12]=v},f.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},f.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},f.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},f.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(c.prototype,f),c})(Gg);S.prototype.size=68;var L=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.get=function(f){return new S(this,f)},c})(Og);rn("SymbolInstanceArray",L);var F=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.getoffsetX=function(f){return this.float32[1*f+0]},c})(nc);rn("GlyphOffsetArray",F);var B=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.getx=function(f){return this.int16[3*f+0]},c.prototype.gety=function(f){return this.int16[3*f+1]},c.prototype.gettileUnitDistanceFromAnchor=function(f){return this.int16[3*f+2]},c})(Pa);rn("SymbolLineVertexArray",B);var J=(function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c;var f={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(c.prototype,f),c})(Gg);J.prototype.size=8;var re=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.get=function(f){return new J(this,f)},c})(E_);rn("FeatureIndexArray",re);var Ce=Gs([{name:"a_pos",components:2,type:"Int16"}],4).members,we=function(a){a===void 0&&(a=[]),this.segments=a};function Se(a,c){return 256*(a=E(Math.floor(a),0,255))+E(Math.floor(c),0,255)}we.prototype.prepareSegment=function(a,c,f,v){var I=this.segments[this.segments.length-1];return a>we.MAX_VERTEX_ARRAY_LENGTH&&de("Max vertices per segment is "+we.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!I||I.vertexLength+a>we.MAX_VERTEX_ARRAY_LENGTH||I.sortKey!==v)&&(I={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},v!==void 0&&(I.sortKey=v),this.segments.push(I)),I},we.prototype.get=function(){return this.segments},we.prototype.destroy=function(){for(var a=0,c=this.segments;a<c.length;a+=1){var f=c[a];for(var v in f.vaos)f.vaos[v].destroy()}},we.simpleSegment=function(a,c,f,v){return new we([{vertexOffset:a,primitiveOffset:c,vertexLength:f,primitiveLength:v,vaos:{},sortKey:0}])},we.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rn("SegmentVector",we);var Be=Gs([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ve=l((function(a){a.exports=function(c,f){var v,I,A,R,N,Z,X,Q;for(I=c.length-(v=3&c.length),A=f,N=3432918353,Z=461845907,Q=0;Q<I;)X=255&c.charCodeAt(Q)|(255&c.charCodeAt(++Q))<<8|(255&c.charCodeAt(++Q))<<16|(255&c.charCodeAt(++Q))<<24,++Q,A=27492+(65535&(R=5*(65535&(A=(A^=X=(65535&(X=(X=(65535&X)*N+(((X>>>16)*N&65535)<<16)&4294967295)<<15|X>>>17))*Z+(((X>>>16)*Z&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch(X=0,v){case 3:X^=(255&c.charCodeAt(Q+2))<<16;case 2:X^=(255&c.charCodeAt(Q+1))<<8;case 1:A^=X=(65535&(X=(X=(65535&(X^=255&c.charCodeAt(Q)))*N+(((X>>>16)*N&65535)<<16)&4294967295)<<15|X>>>17))*Z+(((X>>>16)*Z&65535)<<16)&4294967295}return A^=c.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0}})),Ke=l((function(a){a.exports=function(c,f){for(var v,I=c.length,A=f^I,R=0;I>=4;)v=1540483477*(65535&(v=255&c.charCodeAt(R)|(255&c.charCodeAt(++R))<<8|(255&c.charCodeAt(++R))<<16|(255&c.charCodeAt(++R))<<24))+((1540483477*(v>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(v=1540483477*(65535&(v^=v>>>24))+((1540483477*(v>>>16)&65535)<<16)),I-=4,++R;switch(I){case 3:A^=(255&c.charCodeAt(R+2))<<16;case 2:A^=(255&c.charCodeAt(R+1))<<8;case 1:A=1540483477*(65535&(A^=255&c.charCodeAt(R)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0}})),Pe=Ve,He=Ke;Pe.murmur3=Ve,Pe.murmur2=He;var Qe=function(){this.ids=[],this.positions=[],this.indexed=!1};Qe.prototype.add=function(a,c,f,v){this.ids.push(ht(a)),this.positions.push(c,f,v)},Qe.prototype.getPositions=function(a){for(var c=ht(a),f=0,v=this.ids.length-1;f<v;){var I=f+v>>1;this.ids[I]>=c?v=I:f=I+1}for(var A=[];this.ids[f]===c;)A.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return A},Qe.serialize=function(a,c){var f=new Float64Array(a.ids),v=new Uint32Array(a.positions);return(function I(A,R,N,Z){for(;N<Z;){for(var X=A[N+Z>>1],Q=N-1,ne=Z+1;;){do Q++;while(A[Q]<X);do ne--;while(A[ne]>X);if(Q>=ne)break;lt(A,Q,ne),lt(R,3*Q,3*ne),lt(R,3*Q+1,3*ne+1),lt(R,3*Q+2,3*ne+2)}ne-N<Z-ne?(I(A,R,N,ne),N=ne+1):(I(A,R,ne+1,Z),Z=ne)}})(f,v,0,f.length-1),c&&c.push(f.buffer,v.buffer),{ids:f,positions:v}},Qe.deserialize=function(a){var c=new Qe;return c.ids=a.ids,c.positions=a.positions,c.indexed=!0,c};var rt=Math.pow(2,53)-1;function ht(a){var c=+a;return!isNaN(c)&&c<=rt?c:Pe(String(a))}function lt(a,c,f){var v=a[c];a[c]=a[f],a[f]=v}rn("FeaturePositionMap",Qe);var ft=function(a,c){this.gl=a.gl,this.location=c},wt=(function(a){function c(f,v){a.call(this,f,v),this.current=0}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))},c})(ft),Vt=(function(a){function c(f,v){a.call(this,f,v),this.current=0}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))},c})(ft),Ot=(function(a){function c(f,v){a.call(this,f,v),this.current=[0,0]}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))},c})(ft),en=(function(a){function c(f,v){a.call(this,f,v),this.current=[0,0,0]}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))},c})(ft),vn=(function(a){function c(f,v){a.call(this,f,v),this.current=[0,0,0,0]}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3]))},c})(ft),Cn=(function(a){function c(f,v){a.call(this,f,v),this.current=Ci.transparent}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a))},c})(ft),In=new Float32Array(16),wi=(function(a){function c(f,v){a.call(this,f,v),this.current=In}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(var v=1;v<16;v++)if(f[v]!==this.current[v]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}},c})(ft);function nn(a){return[Se(255*a.r,255*a.g),Se(255*a.b,255*a.a)]}var Nn=function(a,c,f){this.value=a,this.uniformNames=c.map((function(v){return"u_"+v})),this.type=f};Nn.prototype.setUniform=function(a,c,f){a.set(f.constantOr(this.value))},Nn.prototype.getBinding=function(a,c,f){return this.type==="color"?new Cn(a,c):new Vt(a,c)};var $n=function(a,c){this.uniformNames=c.map((function(f){return"u_"+f})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};$n.prototype.setConstantPatternPositions=function(a,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=a.tlbr},$n.prototype.setUniform=function(a,c,f,v){var I=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;I&&a.set(I)},$n.prototype.getBinding=function(a,c,f){return f.substr(0,9)==="u_pattern"?new vn(a,c):new Vt(a,c)};var On=function(a,c,f,v){this.expression=a,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map((function(I){return{name:"a_"+I,type:"Float32",components:f==="color"?2:1,offset:0}})),this.paintVertexArray=new v};On.prototype.populatePaintArray=function(a,c,f,v,I){var A=this.paintVertexArray.length,R=this.expression.evaluate(new ui(0),c,{},v,[],I);this.paintVertexArray.resize(a),this._setPaintValue(A,a,R)},On.prototype.updatePaintArray=function(a,c,f,v){var I=this.expression.evaluate({zoom:0},f,v);this._setPaintValue(a,c,I)},On.prototype._setPaintValue=function(a,c,f){if(this.type==="color")for(var v=nn(f),I=a;I<c;I++)this.paintVertexArray.emplace(I,v[0],v[1]);else{for(var A=a;A<c;A++)this.paintVertexArray.emplace(A,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}},On.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},On.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Fn=function(a,c,f,v,I,A){this.expression=a,this.uniformNames=c.map((function(R){return"u_"+R+"_t"})),this.type=f,this.useIntegerZoom=v,this.zoom=I,this.maxValue=0,this.paintVertexAttributes=c.map((function(R){return{name:"a_"+R,type:"Float32",components:f==="color"?4:2,offset:0}})),this.paintVertexArray=new A};Fn.prototype.populatePaintArray=function(a,c,f,v,I){var A=this.expression.evaluate(new ui(this.zoom),c,{},v,[],I),R=this.expression.evaluate(new ui(this.zoom+1),c,{},v,[],I),N=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(N,a,A,R)},Fn.prototype.updatePaintArray=function(a,c,f,v){var I=this.expression.evaluate({zoom:this.zoom},f,v),A=this.expression.evaluate({zoom:this.zoom+1},f,v);this._setPaintValue(a,c,I,A)},Fn.prototype._setPaintValue=function(a,c,f,v){if(this.type==="color")for(var I=nn(f),A=nn(v),R=a;R<c;R++)this.paintVertexArray.emplace(R,I[0],I[1],A[0],A[1]);else{for(var N=a;N<c;N++)this.paintVertexArray.emplace(N,f,v);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(v))}},Fn.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Fn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Fn.prototype.setUniform=function(a,c){var f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,v=E(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);a.set(v)},Fn.prototype.getBinding=function(a,c,f){return new Vt(a,c)};var jn=function(a,c,f,v,I,A){this.expression=a,this.type=c,this.useIntegerZoom=f,this.zoom=v,this.layerId=A,this.zoomInPaintVertexArray=new I,this.zoomOutPaintVertexArray=new I};jn.prototype.populatePaintArray=function(a,c,f){var v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(v,a,c.patterns&&c.patterns[this.layerId],f)},jn.prototype.updatePaintArray=function(a,c,f,v,I){this._setPaintValues(a,c,f.patterns&&f.patterns[this.layerId],I)},jn.prototype._setPaintValues=function(a,c,f,v){if(v&&f){var I=v[f.min],A=v[f.mid],R=v[f.max];if(I&&A&&R)for(var N=a;N<c;N++)this.zoomInPaintVertexArray.emplace(N,A.tl[0],A.tl[1],A.br[0],A.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],A.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(N,A.tl[0],A.tl[1],A.br[0],A.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],A.pixelRatio,R.pixelRatio)}},jn.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,Be.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,Be.members,this.expression.isStateDependent))},jn.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Pn=function(a,c,f){this.binders={},this._buffers=[];var v=[];for(var I in a.paint._values)if(f(I)){var A=a.paint.get(I);if(A instanceof po&&th(A.property.specification)){var R=bs(I,a.type),N=A.value,Z=A.property.specification.type,X=A.property.useIntegerZoom,Q=A.property.specification["property-type"],ne=Q==="cross-faded"||Q==="cross-faded-data-driven";if(N.kind==="constant")this.binders[I]=ne?new $n(N.value,R):new Nn(N.value,R,Z),v.push("/u_"+I);else if(N.kind==="source"||ne){var he=Nr(I,Z,"source");this.binders[I]=ne?new jn(N,Z,X,c,he,a.id):new On(N,R,Z,he),v.push("/a_"+I)}else{var xe=Nr(I,Z,"composite");this.binders[I]=new Fn(N,R,Z,X,c,xe),v.push("/z_"+I)}}}this.cacheKey=v.sort().join("")};Pn.prototype.getMaxValue=function(a){var c=this.binders[a];return c instanceof On||c instanceof Fn?c.maxValue:0},Pn.prototype.populatePaintArrays=function(a,c,f,v,I){for(var A in this.binders){var R=this.binders[A];(R instanceof On||R instanceof Fn||R instanceof jn)&&R.populatePaintArray(a,c,f,v,I)}},Pn.prototype.setConstantPatternPositions=function(a,c){for(var f in this.binders){var v=this.binders[f];v instanceof $n&&v.setConstantPatternPositions(a,c)}},Pn.prototype.updatePaintArrays=function(a,c,f,v,I){var A=!1;for(var R in a)for(var N=0,Z=c.getPositions(R);N<Z.length;N+=1){var X=Z[N],Q=f.feature(X.index);for(var ne in this.binders){var he=this.binders[ne];if((he instanceof On||he instanceof Fn||he instanceof jn)&&he.expression.isStateDependent===!0){var xe=v.paint.get(ne);he.expression=xe.value,he.updatePaintArray(X.start,X.end,Q,a[R],I),A=!0}}}return A},Pn.prototype.defines=function(){var a=[];for(var c in this.binders){var f=this.binders[c];(f instanceof Nn||f instanceof $n)&&a.push.apply(a,f.uniformNames.map((function(v){return"#define HAS_UNIFORM_"+v})))}return a},Pn.prototype.getBinderAttributes=function(){var a=[];for(var c in this.binders){var f=this.binders[c];if(f instanceof On||f instanceof Fn)for(var v=0;v<f.paintVertexAttributes.length;v++)a.push(f.paintVertexAttributes[v].name);else if(f instanceof jn)for(var I=0;I<Be.members.length;I++)a.push(Be.members[I].name)}return a},Pn.prototype.getBinderUniforms=function(){var a=[];for(var c in this.binders){var f=this.binders[c];if(f instanceof Nn||f instanceof $n||f instanceof Fn)for(var v=0,I=f.uniformNames;v<I.length;v+=1)a.push(I[v])}return a},Pn.prototype.getPaintVertexBuffers=function(){return this._buffers},Pn.prototype.getUniforms=function(a,c){var f=[];for(var v in this.binders){var I=this.binders[v];if(I instanceof Nn||I instanceof $n||I instanceof Fn)for(var A=0,R=I.uniformNames;A<R.length;A+=1){var N=R[A];if(c[N]){var Z=I.getBinding(a,c[N],N);f.push({name:N,property:v,binding:Z})}}}return f},Pn.prototype.setUniforms=function(a,c,f,v){for(var I=0,A=c;I<A.length;I+=1){var R=A[I],N=R.name,Z=R.property;this.binders[Z].setUniform(R.binding,v,f.get(Z),N)}},Pn.prototype.updatePaintBuffers=function(a){for(var c in this._buffers=[],this.binders){var f=this.binders[c];if(a&&f instanceof jn){var v=a.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(f instanceof On||f instanceof Fn)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}},Pn.prototype.upload=function(a){for(var c in this.binders){var f=this.binders[c];(f instanceof On||f instanceof Fn||f instanceof jn)&&f.upload(a)}this.updatePaintBuffers()},Pn.prototype.destroy=function(){for(var a in this.binders){var c=this.binders[a];(c instanceof On||c instanceof Fn||c instanceof jn)&&c.destroy()}};var Tn=function(a,c,f){f===void 0&&(f=function(){return!0}),this.programConfigurations={};for(var v=0,I=a;v<I.length;v+=1){var A=I[v];this.programConfigurations[A.id]=new Pn(A,c,f)}this.needsUpload=!1,this._featureMap=new Qe,this._bufferOffset=0};function bs(a,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(c+"-","").replace(/-/g,"_")]}function Nr(a,c,f){var v={color:{source:_d,composite:Ng},number:{source:nc,composite:_d}},I=(function(A){return{"line-pattern":{source:Nl,composite:Nl},"fill-pattern":{source:Nl,composite:Nl},"fill-extrusion-pattern":{source:Nl,composite:Nl}}[A]})(a);return I&&I[f]||v[c][f]}Tn.prototype.populatePaintArrays=function(a,c,f,v,I,A){for(var R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(a,c,v,I,A);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Tn.prototype.updatePaintArrays=function(a,c,f,v){for(var I=0,A=f;I<A.length;I+=1){var R=A[I];this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(a,this._featureMap,c,R,v)||this.needsUpload}},Tn.prototype.get=function(a){return this.programConfigurations[a]},Tn.prototype.upload=function(a){if(this.needsUpload){for(var c in this.programConfigurations)this.programConfigurations[c].upload(a);this.needsUpload=!1}},Tn.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},rn("ConstantBinder",Nn),rn("CrossFadedConstantBinder",$n),rn("SourceExpressionBinder",On),rn("CrossFadedCompositeBinder",jn),rn("CompositeExpressionBinder",Fn),rn("ProgramConfiguration",Pn,{omit:["_buffers"]}),rn("ProgramConfigurationSet",Tn);var oo=Math.pow(2,14)-1,Fs=-oo-1;function Lr(a){for(var c=8192/a.extent,f=a.loadGeometry(),v=0;v<f.length;v++)for(var I=f[v],A=0;A<I.length;A++){var R=I[A],N=Math.round(R.x*c),Z=Math.round(R.y*c);R.x=E(N,Fs,oo),R.y=E(Z,Fs,oo),(N<R.x||N>R.x+1||Z<R.y||Z>R.y+1)&&de("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return f}function Hr(a,c){return{type:a.type,id:a.id,properties:a.properties,geometry:c?Lr(a):[]}}function Ho(a,c,f,v,I){a.emplaceBack(2*c+(v+1)/2,2*f+(I+1)/2)}var mo=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((function(c){return c.id})),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new oh,this.indexArray=new ec,this.segments=new we,this.programConfigurations=new Tn(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter((function(c){return c.isStateDependent()})).map((function(c){return c.id}))};function ic(a,c){for(var f=0;f<a.length;f++)if(Dl(c,a[f]))return!0;for(var v=0;v<c.length;v++)if(Dl(a,c[v]))return!0;return!!Qf(a,c)}function Eo(a,c,f){return!!Dl(a,c)||!!rc(c,a,f)}function cl(a,c){if(a.length===1)return ep(c,a[0]);for(var f=0;f<c.length;f++)for(var v=c[f],I=0;I<v.length;I++)if(Dl(a,v[I]))return!0;for(var A=0;A<a.length;A++)if(ep(c,a[A]))return!0;for(var R=0;R<c.length;R++)if(Qf(a,c[R]))return!0;return!1}function Ga(a,c,f){if(a.length>1){if(Qf(a,c))return!0;for(var v=0;v<c.length;v++)if(rc(c[v],a,f))return!0}for(var I=0;I<a.length;I++)if(rc(a[I],c,f))return!0;return!1}function Qf(a,c){if(a.length===0||c.length===0)return!1;for(var f=0;f<a.length-1;f++)for(var v=a[f],I=a[f+1],A=0;A<c.length-1;A++)if(xd(v,I,c[A],c[A+1]))return!0;return!1}function xd(a,c,f,v){return D(a,f,v)!==D(c,f,v)&&D(a,c,f)!==D(a,c,v)}function rc(a,c,f){var v=f*f;if(c.length===1)return a.distSqr(c[0])<v;for(var I=1;I<c.length;I++)if(Id(a,c[I-1],c[I])<v)return!0;return!1}function Id(a,c,f){var v=c.distSqr(f);if(v===0)return a.distSqr(c);var I=((a.x-c.x)*(f.x-c.x)+(a.y-c.y)*(f.y-c.y))/v;return a.distSqr(I<0?c:I>1?f:f.sub(c)._mult(I)._add(c))}function ep(a,c){for(var f,v,I,A=!1,R=0;R<a.length;R++)for(var N=0,Z=(f=a[R]).length-1;N<f.length;Z=N++)(v=f[N]).y>c.y!=(I=f[Z]).y>c.y&&c.x<(I.x-v.x)*(c.y-v.y)/(I.y-v.y)+v.x&&(A=!A);return A}function Dl(a,c){for(var f=!1,v=0,I=a.length-1;v<a.length;I=v++){var A=a[v],R=a[I];A.y>c.y!=R.y>c.y&&c.x<(R.x-A.x)*(c.y-A.y)/(R.y-A.y)+A.x&&(f=!f)}return f}function tp(a,c,f){var v=f[0],I=f[2];if(a.x<v.x&&c.x<v.x||a.x>I.x&&c.x>I.x||a.y<v.y&&c.y<v.y||a.y>I.y&&c.y>I.y)return!1;var A=D(a,c,f[0]);return A!==D(a,c,f[1])||A!==D(a,c,f[2])||A!==D(a,c,f[3])}function Vl(a,c,f){var v=c.paint.get(a).value;return v.kind==="constant"?v.value:f.programConfigurations.get(c.id).getMaxValue(a)}function xs(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function uu(a,c,f,v,I){if(!c[0]&&!c[1])return a;var A=d.convert(c)._mult(I);f==="viewport"&&A._rotate(-v);for(var R=[],N=0;N<a.length;N++)R.push(a[N].sub(A));return R}mo.prototype.populate=function(a,c,f){var v=this.layers[0],I=[],A=null;v.type==="circle"&&(A=v.layout.get("circle-sort-key"));for(var R=0,N=a;R<N.length;R+=1){var Z=N[R],X=Z.feature,Q=Z.id,ne=Z.index,he=Z.sourceLayerIndex,xe=this.layers[0]._featureFilter.needGeometry,Oe=Hr(X,xe);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),Oe,f)){var De=A?A.evaluate(Oe,{},f):void 0,Je={id:Q,properties:X.properties,type:X.type,sourceLayerIndex:he,index:ne,geometry:xe?Oe.geometry:Lr(X),patterns:{},sortKey:De};I.push(Je)}}A&&I.sort((function(zt,gn){return zt.sortKey-gn.sortKey}));for(var Xe=0,et=I;Xe<et.length;Xe+=1){var st=et[Xe],ot=st.geometry,ct=st.index,_t=st.sourceLayerIndex,Ft=a[ct].feature;this.addFeature(st,ot,ct,f),c.featureIndex.insert(Ft,ot,ct,_t,this.index)}},mo.prototype.update=function(a,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,c,this.stateDependentLayers,f)},mo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},mo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},mo.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ce),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},mo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},mo.prototype.addFeature=function(a,c,f,v){for(var I=0,A=c;I<A.length;I+=1)for(var R=0,N=A[I];R<N.length;R+=1){var Z=N[R],X=Z.x,Q=Z.y;if(!(X<0||X>=8192||Q<0||Q>=8192)){var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),he=ne.vertexLength;Ho(this.layoutVertexArray,X,Q,-1,-1),Ho(this.layoutVertexArray,X,Q,1,-1),Ho(this.layoutVertexArray,X,Q,1,1),Ho(this.layoutVertexArray,X,Q,-1,1),this.indexArray.emplaceBack(he,he+1,he+2),this.indexArray.emplaceBack(he,he+3,he+2),ne.vertexLength+=4,ne.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,{},v)},rn("CircleBucket",mo,{omit:["layers"]});var sc=new Ks({"circle-sort-key":new un(be.layout_circle["circle-sort-key"])}),lh={paint:new Ks({"circle-radius":new un(be.paint_circle["circle-radius"]),"circle-color":new un(be.paint_circle["circle-color"]),"circle-blur":new un(be.paint_circle["circle-blur"]),"circle-opacity":new un(be.paint_circle["circle-opacity"]),"circle-translate":new _n(be.paint_circle["circle-translate"]),"circle-translate-anchor":new _n(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _n(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _n(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new un(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new un(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new un(be.paint_circle["circle-stroke-opacity"])}),layout:sc},Fi=typeof Float32Array<"u"?Float32Array:Array;function pa(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function To(a,c,f){var v=c[0],I=c[1],A=c[2],R=c[3],N=c[4],Z=c[5],X=c[6],Q=c[7],ne=c[8],he=c[9],xe=c[10],Oe=c[11],De=c[12],Je=c[13],Xe=c[14],et=c[15],st=f[0],ot=f[1],ct=f[2],_t=f[3];return a[0]=st*v+ot*N+ct*ne+_t*De,a[1]=st*I+ot*Z+ct*he+_t*Je,a[2]=st*A+ot*X+ct*xe+_t*Xe,a[3]=st*R+ot*Q+ct*Oe+_t*et,a[4]=(st=f[4])*v+(ot=f[5])*N+(ct=f[6])*ne+(_t=f[7])*De,a[5]=st*I+ot*Z+ct*he+_t*Je,a[6]=st*A+ot*X+ct*xe+_t*Xe,a[7]=st*R+ot*Q+ct*Oe+_t*et,a[8]=(st=f[8])*v+(ot=f[9])*N+(ct=f[10])*ne+(_t=f[11])*De,a[9]=st*I+ot*Z+ct*he+_t*Je,a[10]=st*A+ot*X+ct*xe+_t*Xe,a[11]=st*R+ot*Q+ct*Oe+_t*et,a[12]=(st=f[12])*v+(ot=f[13])*N+(ct=f[14])*ne+(_t=f[15])*De,a[13]=st*I+ot*Z+ct*he+_t*Je,a[14]=st*A+ot*X+ct*xe+_t*Xe,a[15]=st*R+ot*Q+ct*Oe+_t*et,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,c=0,f=arguments.length;f--;)c+=a[f]*a[f];return Math.sqrt(c)});var uh,zA=To;function Dg(a,c,f){var v=c[0],I=c[1],A=c[2],R=c[3];return a[0]=f[0]*v+f[4]*I+f[8]*A+f[12]*R,a[1]=f[1]*v+f[5]*I+f[9]*A+f[13]*R,a[2]=f[2]*v+f[6]*I+f[10]*A+f[14]*R,a[3]=f[3]*v+f[7]*I+f[11]*A+f[15]*R,a}uh=new Fi(3),Fi!=Float32Array&&(uh[0]=0,uh[1]=0,uh[2]=0),(function(){var a=new Fi(4);Fi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)})();var UA=((function(){var a=new Fi(2);Fi!=Float32Array&&(a[0]=0,a[1]=0)})(),(function(a){function c(f){a.call(this,f,lh)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.createBucket=function(f){return new mo(f)},c.prototype.queryRadius=function(f){var v=f;return Vl("circle-radius",this,v)+Vl("circle-stroke-width",this,v)+xs(this.paint.get("circle-translate"))},c.prototype.queryIntersectsFeature=function(f,v,I,A,R,N,Z,X){for(var Q=uu(f,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),N.angle,Z),ne=this.paint.get("circle-radius").evaluate(v,I)+this.paint.get("circle-stroke-width").evaluate(v,I),he=this.paint.get("circle-pitch-alignment")==="map",xe=he?Q:(function(Ft,zt){return Ft.map((function(gn){return np(gn,zt)}))})(Q,X),Oe=he?ne*Z:ne,De=0,Je=A;De<Je.length;De+=1)for(var Xe=0,et=Je[De];Xe<et.length;Xe+=1){var st=et[Xe],ot=he?st:np(st,X),ct=Oe,_t=Dg([],[st.x,st.y,0,1],X);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ct*=_t[3]/N.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ct*=N.cameraToCenterDistance/_t[3]),Eo(xe,ot,ct))return!0}return!1},c})(Ol));function np(a,c){var f=Dg([],[a.x,a.y,0,1],c);return new d(f[0]/f[3],f[1]/f[3])}var y1=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c})(mo);function Cd(a,c,f,v){var I=c.width,A=c.height;if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==I*A*f)throw new RangeError("mismatched image size")}else v=new Uint8Array(I*A*f);return a.width=I,a.height=A,a.data=v,a}function Vg(a,c,f){var v=c.width,I=c.height;if(v!==a.width||I!==a.height){var A=Cd({},{width:v,height:I},f);XA(a,A,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,v),height:Math.min(a.height,I)},f),a.width=v,a.height=I,a.data=A.data}}function XA(a,c,f,v,I,A){if(I.width===0||I.height===0)return c;if(I.width>a.width||I.height>a.height||f.x>a.width-I.width||f.y>a.height-I.height)throw new RangeError("out of range source coordinates for image copy");if(I.width>c.width||I.height>c.height||v.x>c.width-I.width||v.y>c.height-I.height)throw new RangeError("out of range destination coordinates for image copy");for(var R=a.data,N=c.data,Z=0;Z<I.height;Z++)for(var X=((f.y+Z)*a.width+f.x)*A,Q=((v.y+Z)*c.width+v.x)*A,ne=0;ne<I.width*A;ne++)N[Q+ne]=R[X+ne];return c}rn("HeatmapBucket",y1,{omit:["layers"]});var ip=function(a,c){Cd(this,a,1,c)};ip.prototype.resize=function(a){Vg(this,a,1)},ip.prototype.clone=function(){return new ip({width:this.width,height:this.height},new Uint8Array(this.data))},ip.copy=function(a,c,f,v,I){XA(a,c,f,v,I,1)};var Ko=function(a,c){Cd(this,a,4,c)};Ko.prototype.resize=function(a){Vg(this,a,4)},Ko.prototype.replace=function(a,c){c?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Ko.prototype.clone=function(){return new Ko({width:this.width,height:this.height},new Uint8Array(this.data))},Ko.copy=function(a,c,f,v,I){XA(a,c,f,v,I,4)},rn("AlphaImage",ip),rn("RGBAImage",Ko);var Oz={paint:new Ks({"heatmap-radius":new un(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new un(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _n(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ul(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _n(be.paint_heatmap["heatmap-opacity"])})};function jk(a){var c={},f=a.resolution||256,v=a.clips?a.clips.length:1,I=a.image||new Ko({width:f,height:v}),A=function(Oe,De,Je){c[a.evaluationKey]=Je;var Xe=a.expression.evaluate(c);I.data[Oe+De+0]=Math.floor(255*Xe.r/Xe.a),I.data[Oe+De+1]=Math.floor(255*Xe.g/Xe.a),I.data[Oe+De+2]=Math.floor(255*Xe.b/Xe.a),I.data[Oe+De+3]=Math.floor(255*Xe.a)};if(a.clips)for(var R=0,N=0;R<v;++R,N+=4*f)for(var Z=0,X=0;Z<f;Z++,X+=4){var Q=Z/(f-1),ne=a.clips[R];A(N,X,ne.start*(1-Q)+ne.end*Q)}else for(var he=0,xe=0;he<f;he++,xe+=4)A(0,xe,he/(f-1));return I}var Nz=(function(a){function c(f){a.call(this,f,Oz),this._updateColorRamp()}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.createBucket=function(f){return new y1(f)},c.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="heatmap-color"&&this._updateColorRamp()},c.prototype._updateColorRamp=function(){this.colorRamp=jk({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},c.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},c.prototype.queryRadius=function(){return 0},c.prototype.queryIntersectsFeature=function(){return!1},c.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},c})(Ol),Dz={paint:new Ks({"hillshade-illumination-direction":new _n(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _n(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _n(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _n(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _n(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _n(be.paint_hillshade["hillshade-accent-color"])})},Vz=(function(a){function c(f){a.call(this,f,Dz)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},c})(Ol),Bz=Gs([{name:"a_pos",components:2,type:"Int16"}],4).members,YA=_1,Zz=_1;function _1(a,c,f){f=f||2;var v,I,A,R,N,Z,X,Q=c&&c.length,ne=Q?c[0]*f:a.length,he=$k(a,0,ne,f,!0),xe=[];if(!he||he.next===he.prev)return xe;if(Q&&(he=(function(De,Je,Xe,et){var st,ot,ct,_t=[];for(st=0,ot=Je.length;st<ot;st++)(ct=$k(De,Je[st]*et,st<ot-1?Je[st+1]*et:De.length,et,!1))===ct.next&&(ct.steiner=!0),_t.push(jz(ct));for(_t.sort(Yz),st=0;st<_t.length;st++)Hz(_t[st],Xe),Xe=wd(Xe,Xe.next);return Xe})(a,c,he,f)),a.length>80*f){v=A=a[0],I=R=a[1];for(var Oe=f;Oe<ne;Oe+=f)(N=a[Oe])<v&&(v=N),(Z=a[Oe+1])<I&&(I=Z),N>A&&(A=N),Z>R&&(R=Z);X=(X=Math.max(A-v,R-I))!==0?1/X:0}return R_(he,xe,f,v,I,X),xe}function $k(a,c,f,v,I){var A,R;if(I===jA(a,c,f,v)>0)for(A=c;A<f;A+=v)R=Qk(A,a[A],a[A+1],R);else for(A=f-v;A>=c;A-=v)R=Qk(A,a[A],a[A+1],R);return R&&v1(R,R.next)&&(k_(R),R=R.next),R}function wd(a,c){if(!a)return a;c||(c=a);var f,v=a;do if(f=!1,v.steiner||!v1(v,v.next)&&as(v.prev,v,v.next)!==0)v=v.next;else{if(k_(v),(v=c=v.prev)===v.next)break;f=!0}while(f||v!==c);return c}function R_(a,c,f,v,I,A,R){if(a){!R&&A&&(function(Q,ne,he,xe){var Oe=Q;do Oe.z===null&&(Oe.z=HA(Oe.x,Oe.y,ne,he,xe)),Oe.prevZ=Oe.prev,Oe.nextZ=Oe.next,Oe=Oe.next;while(Oe!==Q);Oe.prevZ.nextZ=null,Oe.prevZ=null,(function(De){var Je,Xe,et,st,ot,ct,_t,Ft,zt=1;do{for(Xe=De,De=null,ot=null,ct=0;Xe;){for(ct++,et=Xe,_t=0,Je=0;Je<zt&&(_t++,et=et.nextZ);Je++);for(Ft=zt;_t>0||Ft>0&&et;)_t!==0&&(Ft===0||!et||Xe.z<=et.z)?(st=Xe,Xe=Xe.nextZ,_t--):(st=et,et=et.nextZ,Ft--),ot?ot.nextZ=st:De=st,st.prevZ=ot,ot=st;Xe=et}ot.nextZ=null,zt*=2}while(ct>1)})(Oe)})(a,v,I,A);for(var N,Z,X=a;a.prev!==a.next;)if(N=a.prev,Z=a.next,A?zz(a,v,I,A):Wz(a))c.push(N.i/f),c.push(a.i/f),c.push(Z.i/f),k_(a),a=Z.next,X=Z.next;else if((a=Z)===X){R?R===1?R_(a=Uz(wd(a),c,f),c,f,v,I,A,2):R===2&&Xz(a,c,f,v,I,A):R_(wd(a),c,f,v,I,A,1);break}}}function Wz(a){var c=a.prev,f=a,v=a.next;if(as(c,f,v)>=0)return!1;for(var I=a.next.next;I!==a.prev;){if(Bg(c.x,c.y,f.x,f.y,v.x,v.y,I.x,I.y)&&as(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function zz(a,c,f,v){var I=a.prev,A=a,R=a.next;if(as(I,A,R)>=0)return!1;for(var N=I.x>A.x?I.x>R.x?I.x:R.x:A.x>R.x?A.x:R.x,Z=I.y>A.y?I.y>R.y?I.y:R.y:A.y>R.y?A.y:R.y,X=HA(I.x<A.x?I.x<R.x?I.x:R.x:A.x<R.x?A.x:R.x,I.y<A.y?I.y<R.y?I.y:R.y:A.y<R.y?A.y:R.y,c,f,v),Q=HA(N,Z,c,f,v),ne=a.prevZ,he=a.nextZ;ne&&ne.z>=X&&he&&he.z<=Q;){if(ne!==a.prev&&ne!==a.next&&Bg(I.x,I.y,A.x,A.y,R.x,R.y,ne.x,ne.y)&&as(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,he!==a.prev&&he!==a.next&&Bg(I.x,I.y,A.x,A.y,R.x,R.y,he.x,he.y)&&as(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ne&&ne.z>=X;){if(ne!==a.prev&&ne!==a.next&&Bg(I.x,I.y,A.x,A.y,R.x,R.y,ne.x,ne.y)&&as(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;he&&he.z<=Q;){if(he!==a.prev&&he!==a.next&&Bg(I.x,I.y,A.x,A.y,R.x,R.y,he.x,he.y)&&as(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function Uz(a,c,f){var v=a;do{var I=v.prev,A=v.next.next;!v1(I,A)&&Jk(I,v,v.next,A)&&M_(I,A)&&M_(A,I)&&(c.push(I.i/f),c.push(v.i/f),c.push(A.i/f),k_(v),k_(v.next),v=a=A),v=v.next}while(v!==a);return wd(v)}function Xz(a,c,f,v,I,A){var R=a;do{for(var N=R.next.next;N!==R.prev;){if(R.i!==N.i&&$z(R,N)){var Z=qk(R,N);return R=wd(R,R.next),Z=wd(Z,Z.next),R_(R,c,f,v,I,A),void R_(Z,c,f,v,I,A)}N=N.next}R=R.next}while(R!==a)}function Yz(a,c){return a.x-c.x}function Hz(a,c){if(c=(function(v,I){var A,R=I,N=v.x,Z=v.y,X=-1/0;do{if(Z<=R.y&&Z>=R.next.y&&R.next.y!==R.y){var Q=R.x+(Z-R.y)*(R.next.x-R.x)/(R.next.y-R.y);if(Q<=N&&Q>X){if(X=Q,Q===N){if(Z===R.y)return R;if(Z===R.next.y)return R.next}A=R.x<R.next.x?R:R.next}}R=R.next}while(R!==I);if(!A)return null;if(N===X)return A;var ne,he=A,xe=A.x,Oe=A.y,De=1/0;R=A;do N>=R.x&&R.x>=xe&&N!==R.x&&Bg(Z<Oe?N:X,Z,xe,Oe,Z<Oe?X:N,Z,R.x,R.y)&&(ne=Math.abs(Z-R.y)/(N-R.x),M_(R,v)&&(ne<De||ne===De&&(R.x>A.x||R.x===A.x&&Kz(A,R)))&&(A=R,De=ne)),R=R.next;while(R!==he);return A})(a,c)){var f=qk(c,a);wd(c,c.next),wd(f,f.next)}}function Kz(a,c){return as(a.prev,a,c.prev)<0&&as(c.next,a,a.next)<0}function HA(a,c,f,v,I){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-f)*I)|a<<8))|a<<4))|a<<2))|a<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=32767*(c-v)*I)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function jz(a){var c=a,f=a;do(c.x<f.x||c.x===f.x&&c.y<f.y)&&(f=c),c=c.next;while(c!==a);return f}function Bg(a,c,f,v,I,A,R,N){return(I-R)*(c-N)-(a-R)*(A-N)>=0&&(a-R)*(v-N)-(f-R)*(c-N)>=0&&(f-R)*(A-N)-(I-R)*(v-N)>=0}function $z(a,c){return a.next.i!==c.i&&a.prev.i!==c.i&&!(function(f,v){var I=f;do{if(I.i!==f.i&&I.next.i!==f.i&&I.i!==v.i&&I.next.i!==v.i&&Jk(I,I.next,f,v))return!0;I=I.next}while(I!==f);return!1})(a,c)&&(M_(a,c)&&M_(c,a)&&(function(f,v){var I=f,A=!1,R=(f.x+v.x)/2,N=(f.y+v.y)/2;do I.y>N!=I.next.y>N&&I.next.y!==I.y&&R<(I.next.x-I.x)*(N-I.y)/(I.next.y-I.y)+I.x&&(A=!A),I=I.next;while(I!==f);return A})(a,c)&&(as(a.prev,a,c.prev)||as(a,c.prev,c))||v1(a,c)&&as(a.prev,a,a.next)>0&&as(c.prev,c,c.next)>0)}function as(a,c,f){return(c.y-a.y)*(f.x-c.x)-(c.x-a.x)*(f.y-c.y)}function v1(a,c){return a.x===c.x&&a.y===c.y}function Jk(a,c,f,v){var I=x1(as(a,c,f)),A=x1(as(a,c,v)),R=x1(as(f,v,a)),N=x1(as(f,v,c));return I!==A&&R!==N||!(I!==0||!b1(a,f,c))||!(A!==0||!b1(a,v,c))||!(R!==0||!b1(f,a,v))||!(N!==0||!b1(f,c,v))}function b1(a,c,f){return c.x<=Math.max(a.x,f.x)&&c.x>=Math.min(a.x,f.x)&&c.y<=Math.max(a.y,f.y)&&c.y>=Math.min(a.y,f.y)}function x1(a){return a>0?1:a<0?-1:0}function M_(a,c){return as(a.prev,a,a.next)<0?as(a,c,a.next)>=0&&as(a,a.prev,c)>=0:as(a,c,a.prev)<0||as(a,a.next,c)<0}function qk(a,c){var f=new KA(a.i,a.x,a.y),v=new KA(c.i,c.x,c.y),I=a.next,A=c.prev;return a.next=c,c.prev=a,f.next=I,I.prev=f,v.next=f,f.prev=v,A.next=v,v.prev=A,v}function Qk(a,c,f,v){var I=new KA(a,c,f);return v?(I.next=v.next,I.prev=v,v.next.prev=I,v.next=I):(I.prev=I,I.next=I),I}function k_(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function KA(a,c,f){this.i=a,this.x=c,this.y=f,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function jA(a,c,f,v){for(var I=0,A=c,R=f-v;A<f;A+=v)I+=(a[R]-a[A])*(a[A+1]+a[R+1]),R=A;return I}function Jz(a,c,f,v,I){(function A(R,N,Z,X,Q){for(;X>Z;){if(X-Z>600){var ne=X-Z+1,he=N-Z+1,xe=Math.log(ne),Oe=.5*Math.exp(2*xe/3),De=.5*Math.sqrt(xe*Oe*(ne-Oe)/ne)*(he-ne/2<0?-1:1);A(R,N,Math.max(Z,Math.floor(N-he*Oe/ne+De)),Math.min(X,Math.floor(N+(ne-he)*Oe/ne+De)),Q)}var Je=R[N],Xe=Z,et=X;for(L_(R,Z,N),Q(R[X],Je)>0&&L_(R,Z,X);Xe<et;){for(L_(R,Xe,et),Xe++,et--;Q(R[Xe],Je)<0;)Xe++;for(;Q(R[et],Je)>0;)et--}Q(R[Z],Je)===0?L_(R,Z,et):L_(R,++et,X),et<=N&&(Z=et+1),N<=et&&(X=et-1)}})(a,c,f,v||a.length-1,I||qz)}function L_(a,c,f){var v=a[c];a[c]=a[f],a[f]=v}function qz(a,c){return a<c?-1:a>c?1:0}function $A(a,c){var f=a.length;if(f<=1)return[a];for(var v,I,A=[],R=0;R<f;R++){var N=oe(a[R]);N!==0&&(a[R].area=Math.abs(N),I===void 0&&(I=N<0),I===N<0?(v&&A.push(v),v=[a[R]]):v.push(a[R]))}if(v&&A.push(v),c>1)for(var Z=0;Z<A.length;Z++)A[Z].length<=c||(Jz(A[Z],c,1,A[Z].length-1,Qz),A[Z]=A[Z].slice(0,c));return A}function Qz(a,c){return c.area-a.area}function JA(a,c,f){for(var v=f.patternDependencies,I=!1,A=0,R=c;A<R.length;A+=1){var N=R[A].paint.get(a+"-pattern");N.isConstant()||(I=!0);var Z=N.constantOr(null);Z&&(I=!0,v[Z.to]=!0,v[Z.from]=!0)}return I}function qA(a,c,f,v,I){for(var A=I.patternDependencies,R=0,N=c;R<N.length;R+=1){var Z=N[R],X=Z.paint.get(a+"-pattern").value;if(X.kind!=="constant"){var Q=X.evaluate({zoom:v-1},f,{},I.availableImages),ne=X.evaluate({zoom:v},f,{},I.availableImages),he=X.evaluate({zoom:v+1},f,{},I.availableImages);ne=ne&&ne.name?ne.name:ne,he=he&&he.name?he.name:he,A[Q=Q&&Q.name?Q.name:Q]=!0,A[ne]=!0,A[he]=!0,f.patterns[Z.id]={min:Q,mid:ne,max:he}}}return f}_1.deviation=function(a,c,f,v){var I=c&&c.length,A=Math.abs(jA(a,0,I?c[0]*f:a.length,f));if(I)for(var R=0,N=c.length;R<N;R++)A-=Math.abs(jA(a,c[R]*f,R<N-1?c[R+1]*f:a.length,f));var Z=0;for(R=0;R<v.length;R+=3){var X=v[R]*f,Q=v[R+1]*f,ne=v[R+2]*f;Z+=Math.abs((a[X]-a[ne])*(a[Q+1]-a[X+1])-(a[X]-a[Q])*(a[ne+1]-a[X+1]))}return A===0&&Z===0?0:Math.abs((Z-A)/A)},_1.flatten=function(a){for(var c=a[0][0].length,f={vertices:[],holes:[],dimensions:c},v=0,I=0;I<a.length;I++){for(var A=0;A<a[I].length;A++)for(var R=0;R<c;R++)f.vertices.push(a[I][A][R]);I>0&&f.holes.push(v+=a[I-1].length)}return f},YA.default=Zz;var cu=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((function(c){return c.id})),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new oh,this.indexArray=new ec,this.indexArray2=new qf,this.programConfigurations=new Tn(a.layers,a.zoom),this.segments=new we,this.segments2=new we,this.stateDependentLayerIds=this.layers.filter((function(c){return c.isStateDependent()})).map((function(c){return c.id}))};cu.prototype.populate=function(a,c,f){this.hasPattern=JA("fill",this.layers,c);for(var v=this.layers[0].layout.get("fill-sort-key"),I=[],A=0,R=a;A<R.length;A+=1){var N=R[A],Z=N.feature,X=N.id,Q=N.index,ne=N.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,xe=Hr(Z,he);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),xe,f)){var Oe=v?v.evaluate(xe,{},f,c.availableImages):void 0,De={id:X,properties:Z.properties,type:Z.type,sourceLayerIndex:ne,index:Q,geometry:he?xe.geometry:Lr(Z),patterns:{},sortKey:Oe};I.push(De)}}v&&I.sort((function(Ft,zt){return Ft.sortKey-zt.sortKey}));for(var Je=0,Xe=I;Je<Xe.length;Je+=1){var et=Xe[Je],st=et.geometry,ot=et.index,ct=et.sourceLayerIndex;if(this.hasPattern){var _t=qA("fill",this.layers,et,this.zoom,c);this.patternFeatures.push(_t)}else this.addFeature(et,st,ot,f,{});c.featureIndex.insert(a[ot].feature,st,ot,ct,this.index)}},cu.prototype.update=function(a,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,c,this.stateDependentLayers,f)},cu.prototype.addFeatures=function(a,c,f){for(var v=0,I=this.patternFeatures;v<I.length;v+=1){var A=I[v];this.addFeature(A,A.geometry,A.index,c,f)}},cu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},cu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},cu.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Bz),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},cu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},cu.prototype.addFeature=function(a,c,f,v,I){for(var A=0,R=$A(c,500);A<R.length;A+=1){for(var N=R[A],Z=0,X=0,Q=N;X<Q.length;X+=1)Z+=Q[X].length;for(var ne=this.segments.prepareSegment(Z,this.layoutVertexArray,this.indexArray),he=ne.vertexLength,xe=[],Oe=[],De=0,Je=N;De<Je.length;De+=1){var Xe=Je[De];if(Xe.length!==0){Xe!==N[0]&&Oe.push(xe.length/2);var et=this.segments2.prepareSegment(Xe.length,this.layoutVertexArray,this.indexArray2),st=et.vertexLength;this.layoutVertexArray.emplaceBack(Xe[0].x,Xe[0].y),this.indexArray2.emplaceBack(st+Xe.length-1,st),xe.push(Xe[0].x),xe.push(Xe[0].y);for(var ot=1;ot<Xe.length;ot++)this.layoutVertexArray.emplaceBack(Xe[ot].x,Xe[ot].y),this.indexArray2.emplaceBack(st+ot-1,st+ot),xe.push(Xe[ot].x),xe.push(Xe[ot].y);et.vertexLength+=Xe.length,et.primitiveLength+=Xe.length}}for(var ct=YA(xe,Oe),_t=0;_t<ct.length;_t+=3)this.indexArray.emplaceBack(he+ct[_t],he+ct[_t+1],he+ct[_t+2]);ne.vertexLength+=Z,ne.primitiveLength+=ct.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,I,v)},rn("FillBucket",cu,{omit:["layers","patternFeatures"]});var e8=new Ks({"fill-sort-key":new un(be.layout_fill["fill-sort-key"])}),t8={paint:new Ks({"fill-antialias":new _n(be.paint_fill["fill-antialias"]),"fill-opacity":new un(be.paint_fill["fill-opacity"]),"fill-color":new un(be.paint_fill["fill-color"]),"fill-outline-color":new un(be.paint_fill["fill-outline-color"]),"fill-translate":new _n(be.paint_fill["fill-translate"]),"fill-translate-anchor":new _n(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pg(be.paint_fill["fill-pattern"])}),layout:e8},n8=(function(a){function c(f){a.call(this,f,t8)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.recalculate=function(f,v){a.prototype.recalculate.call(this,f,v);var I=this.paint._values["fill-outline-color"];I.value.kind==="constant"&&I.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},c.prototype.createBucket=function(f){return new cu(f)},c.prototype.queryRadius=function(){return xs(this.paint.get("fill-translate"))},c.prototype.queryIntersectsFeature=function(f,v,I,A,R,N,Z){return cl(uu(f,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),N.angle,Z),A)},c.prototype.isTileClipped=function(){return!0},c})(Ol),i8=Gs([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,eL=Zg;function Zg(a,c,f,v,I){this.properties={},this.extent=f,this.type=0,this._pbf=a,this._geometry=-1,this._keys=v,this._values=I,a.readFields(r8,this,c)}function r8(a,c,f){a==1?c.id=f.readVarint():a==2?(function(v,I){for(var A=v.readVarint()+v.pos;v.pos<A;){var R=I._keys[v.readVarint()],N=I._values[v.readVarint()];I.properties[R]=N}})(f,c):a==3?c.type=f.readVarint():a==4&&(c._geometry=f.pos)}function s8(a){for(var c,f,v=0,I=0,A=a.length,R=A-1;I<A;R=I++)v+=((f=a[R]).x-(c=a[I]).x)*(c.y+f.y);return v}Zg.types=["Unknown","Point","LineString","Polygon"],Zg.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var c,f=a.readVarint()+a.pos,v=1,I=0,A=0,R=0,N=[];a.pos<f;){if(I<=0){var Z=a.readVarint();v=7&Z,I=Z>>3}if(I--,v===1||v===2)A+=a.readSVarint(),R+=a.readSVarint(),v===1&&(c&&N.push(c),c=[]),c.push(new d(A,R));else{if(v!==7)throw new Error("unknown command "+v);c&&c.push(c[0].clone())}}return c&&N.push(c),N},Zg.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var c=a.readVarint()+a.pos,f=1,v=0,I=0,A=0,R=1/0,N=-1/0,Z=1/0,X=-1/0;a.pos<c;){if(v<=0){var Q=a.readVarint();f=7&Q,v=Q>>3}if(v--,f===1||f===2)(I+=a.readSVarint())<R&&(R=I),I>N&&(N=I),(A+=a.readSVarint())<Z&&(Z=A),A>X&&(X=A);else if(f!==7)throw new Error("unknown command "+f)}return[R,Z,N,X]},Zg.prototype.toGeoJSON=function(a,c,f){var v,I,A=this.extent*Math.pow(2,f),R=this.extent*a,N=this.extent*c,Z=this.loadGeometry(),X=Zg.types[this.type];function Q(xe){for(var Oe=0;Oe<xe.length;Oe++){var De=xe[Oe];xe[Oe]=[360*(De.x+R)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(De.y+N)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var ne=[];for(v=0;v<Z.length;v++)ne[v]=Z[v][0];Q(Z=ne);break;case 2:for(v=0;v<Z.length;v++)Q(Z[v]);break;case 3:for(Z=(function(xe){var Oe=xe.length;if(Oe<=1)return[xe];for(var De,Je,Xe=[],et=0;et<Oe;et++){var st=s8(xe[et]);st!==0&&(Je===void 0&&(Je=st<0),Je===st<0?(De&&Xe.push(De),De=[xe[et]]):De.push(xe[et]))}return De&&Xe.push(De),Xe})(Z),v=0;v<Z.length;v++)for(I=0;I<Z[v].length;I++)Q(Z[v][I])}Z.length===1?Z=Z[0]:X="Multi"+X;var he={type:"Feature",geometry:{type:X,coordinates:Z},properties:this.properties};return"id"in this&&(he.id=this.id),he};var tL=nL;function nL(a,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(o8,this,c),this.length=this._features.length}function o8(a,c,f){a===15?c.version=f.readVarint():a===1?c.name=f.readString():a===5?c.extent=f.readVarint():a===2?c._features.push(f.pos):a===3?c._keys.push(f.readString()):a===4&&c._values.push((function(v){for(var I=null,A=v.readVarint()+v.pos;v.pos<A;){var R=v.readVarint()>>3;I=R===1?v.readString():R===2?v.readFloat():R===3?v.readDouble():R===4?v.readVarint64():R===5?v.readVarint():R===6?v.readSVarint():R===7?v.readBoolean():null}return I})(f))}function a8(a,c,f){if(a===3){var v=new tL(f,f.readVarint()+f.pos);v.length&&(c[v.name]=v)}}nL.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var c=this._pbf.readVarint()+this._pbf.pos;return new eL(this._pbf,c,this.extent,this._keys,this._values)};var Wg={VectorTile:function(a,c){this.layers=a.readFields(a8,{},c)},VectorTileFeature:eL,VectorTileLayer:tL},l8=Wg.VectorTileFeature.types,QA=Math.pow(2,13);function P_(a,c,f,v,I,A,R,N){a.emplaceBack(c,f,2*Math.floor(v*QA)+R,I*QA*2,A*QA*2,Math.round(N))}var hu=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((function(c){return c.id})),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new lu,this.indexArray=new ec,this.programConfigurations=new Tn(a.layers,a.zoom),this.segments=new we,this.stateDependentLayerIds=this.layers.filter((function(c){return c.isStateDependent()})).map((function(c){return c.id}))};function u8(a,c){return a.x===c.x&&(a.x<0||a.x>8192)||a.y===c.y&&(a.y<0||a.y>8192)}hu.prototype.populate=function(a,c,f){this.features=[],this.hasPattern=JA("fill-extrusion",this.layers,c);for(var v=0,I=a;v<I.length;v+=1){var A=I[v],R=A.feature,N=A.id,Z=A.index,X=A.sourceLayerIndex,Q=this.layers[0]._featureFilter.needGeometry,ne=Hr(R,Q);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),ne,f)){var he={id:N,sourceLayerIndex:X,index:Z,geometry:Q?ne.geometry:Lr(R),properties:R.properties,type:R.type,patterns:{}};this.hasPattern?this.features.push(qA("fill-extrusion",this.layers,he,this.zoom,c)):this.addFeature(he,he.geometry,Z,f,{}),c.featureIndex.insert(R,he.geometry,Z,X,this.index,!0)}}},hu.prototype.addFeatures=function(a,c,f){for(var v=0,I=this.features;v<I.length;v+=1){var A=I[v];this.addFeature(A,A.geometry,A.index,c,f)}},hu.prototype.update=function(a,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,c,this.stateDependentLayers,f)},hu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},hu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},hu.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,i8),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},hu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},hu.prototype.addFeature=function(a,c,f,v,I){for(var A=0,R=$A(c,500);A<R.length;A+=1){for(var N=R[A],Z=0,X=0,Q=N;X<Q.length;X+=1)Z+=Q[X].length;for(var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),he=0,xe=N;he<xe.length;he+=1){var Oe=xe[he];if(Oe.length!==0&&!((ri=Oe).every((function(Un){return Un.x<0}))||ri.every((function(Un){return Un.x>8192}))||ri.every((function(Un){return Un.y<0}))||ri.every((function(Un){return Un.y>8192}))))for(var De=0,Je=0;Je<Oe.length;Je++){var Xe=Oe[Je];if(Je>=1){var et=Oe[Je-1];if(!u8(Xe,et)){ne.vertexLength+4>we.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var st=Xe.sub(et)._perp()._unit(),ot=et.dist(Xe);De+ot>32768&&(De=0),P_(this.layoutVertexArray,Xe.x,Xe.y,st.x,st.y,0,0,De),P_(this.layoutVertexArray,Xe.x,Xe.y,st.x,st.y,0,1,De),P_(this.layoutVertexArray,et.x,et.y,st.x,st.y,0,0,De+=ot),P_(this.layoutVertexArray,et.x,et.y,st.x,st.y,0,1,De);var ct=ne.vertexLength;this.indexArray.emplaceBack(ct,ct+2,ct+1),this.indexArray.emplaceBack(ct+1,ct+2,ct+3),ne.vertexLength+=4,ne.primitiveLength+=2}}}}if(ne.vertexLength+Z>we.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(Z,this.layoutVertexArray,this.indexArray)),l8[a.type]==="Polygon"){for(var _t=[],Ft=[],zt=ne.vertexLength,gn=0,Jt=N;gn<Jt.length;gn+=1){var bn=Jt[gn];if(bn.length!==0){bn!==N[0]&&Ft.push(_t.length/2);for(var Qt=0;Qt<bn.length;Qt++){var qn=bn[Qt];P_(this.layoutVertexArray,qn.x,qn.y,0,0,1,1,0),_t.push(qn.x),_t.push(qn.y)}}}for(var kn=YA(_t,Ft),cn=0;cn<kn.length;cn+=3)this.indexArray.emplaceBack(zt+kn[cn],zt+kn[cn+2],zt+kn[cn+1]);ne.primitiveLength+=kn.length/3,ne.vertexLength+=Z}}var ri;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,I,v)},rn("FillExtrusionBucket",hu,{omit:["layers","features"]});var c8={paint:new Ks({"fill-extrusion-opacity":new _n(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new un(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _n(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _n(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pg(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new un(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new un(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _n(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},h8=(function(a){function c(f){a.call(this,f,c8)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.createBucket=function(f){return new hu(f)},c.prototype.queryRadius=function(){return xs(this.paint.get("fill-extrusion-translate"))},c.prototype.is3D=function(){return!0},c.prototype.queryIntersectsFeature=function(f,v,I,A,R,N,Z,X){var Q=uu(f,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),N.angle,Z),ne=this.paint.get("fill-extrusion-height").evaluate(v,I),he=this.paint.get("fill-extrusion-base").evaluate(v,I),xe=(function(De,Je,Xe,et){for(var st=[],ot=0,ct=De;ot<ct.length;ot+=1){var _t=ct[ot],Ft=[_t.x,_t.y,0,1];Dg(Ft,Ft,Je),st.push(new d(Ft[0]/Ft[3],Ft[1]/Ft[3]))}return st})(Q,X),Oe=(function(De,Je,Xe,et){for(var st=[],ot=[],ct=et[8]*Je,_t=et[9]*Je,Ft=et[10]*Je,zt=et[11]*Je,gn=et[8]*Xe,Jt=et[9]*Xe,bn=et[10]*Xe,Qt=et[11]*Xe,qn=0,kn=De;qn<kn.length;qn+=1){for(var cn=[],ri=[],Un=0,xi=kn[qn];Un<xi.length;Un+=1){var xn=xi[Un],ki=xn.x,Sr=xn.y,Dr=et[0]*ki+et[4]*Sr+et[12],Pr=et[1]*ki+et[5]*Sr+et[13],Er=et[2]*ki+et[6]*Sr+et[14],Vr=et[3]*ki+et[7]*Sr+et[15],Is=Er+Ft,Cs=Vr+zt,_o=Dr+gn,Ns=Pr+Jt,vo=Er+bn,Kr=Vr+Qt,Ds=new d((Dr+ct)/Cs,(Pr+_t)/Cs);Ds.z=Is/Cs,cn.push(Ds);var di=new d(_o/Kr,Ns/Kr);di.z=vo/Kr,ri.push(di)}st.push(cn),ot.push(ri)}return[st,ot]})(A,he,ne,X);return(function(De,Je,Xe){var et=1/0;cl(Xe,Je)&&(et=iL(Xe,Je[0]));for(var st=0;st<Je.length;st++)for(var ot=Je[st],ct=De[st],_t=0;_t<ot.length-1;_t++){var Ft=ot[_t],zt=[Ft,ot[_t+1],ct[_t+1],ct[_t],Ft];ic(Xe,zt)&&(et=Math.min(et,iL(Xe,zt)))}return et!==1/0&&et})(Oe[0],Oe[1],xe)},c})(Ol);function G_(a,c){return a.x*c.x+a.y*c.y}function iL(a,c){if(a.length===1){for(var f,v=0,I=c[v++];!f||I.equals(f);)if(!(f=c[v++]))return 1/0;for(;v<c.length;v++){var A=c[v],R=a[0],N=f.sub(I),Z=A.sub(I),X=R.sub(I),Q=G_(N,N),ne=G_(N,Z),he=G_(Z,Z),xe=G_(X,N),Oe=G_(X,Z),De=Q*he-ne*ne,Je=(he*xe-ne*Oe)/De,Xe=(Q*Oe-ne*xe)/De,et=I.z*(1-Je-Xe)+f.z*Je+A.z*Xe;if(isFinite(et))return et}return 1/0}for(var st=1/0,ot=0,ct=c;ot<ct.length;ot+=1)st=Math.min(st,ct[ot].z);return st}var d8=Gs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,f8=Gs([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,p8=Wg.VectorTileFeature.types,g8=Math.cos(Math.PI/180*37.5),rL=Math.pow(2,14)/.5,Ro=function(a){var c=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((function(f){return f.id})),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(f){c.gradients[f.id]={}})),this.layoutVertexArray=new Yo,this.layoutVertexArray2=new _d,this.indexArray=new ec,this.programConfigurations=new Tn(a.layers,a.zoom),this.segments=new we,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(f){return f.isStateDependent()})).map((function(f){return f.id}))};Ro.prototype.populate=function(a,c,f){this.hasPattern=JA("line",this.layers,c);for(var v=this.layers[0].layout.get("line-sort-key"),I=[],A=0,R=a;A<R.length;A+=1){var N=R[A],Z=N.feature,X=N.id,Q=N.index,ne=N.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,xe=Hr(Z,he);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),xe,f)){var Oe=v?v.evaluate(xe,{},f):void 0,De={id:X,properties:Z.properties,type:Z.type,sourceLayerIndex:ne,index:Q,geometry:he?xe.geometry:Lr(Z),patterns:{},sortKey:Oe};I.push(De)}}v&&I.sort((function(Ft,zt){return Ft.sortKey-zt.sortKey}));for(var Je=0,Xe=I;Je<Xe.length;Je+=1){var et=Xe[Je],st=et.geometry,ot=et.index,ct=et.sourceLayerIndex;if(this.hasPattern){var _t=qA("line",this.layers,et,this.zoom,c);this.patternFeatures.push(_t)}else this.addFeature(et,st,ot,f,{});c.featureIndex.insert(a[ot].feature,st,ot,ct,this.index)}},Ro.prototype.update=function(a,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,c,this.stateDependentLayers,f)},Ro.prototype.addFeatures=function(a,c,f){for(var v=0,I=this.patternFeatures;v<I.length;v+=1){var A=I[v];this.addFeature(A,A.geometry,A.index,c,f)}},Ro.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ro.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ro.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,f8)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,d8),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ro.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ro.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Ro.prototype.addFeature=function(a,c,f,v,I){var A=this.layers[0].layout,R=A.get("line-join").evaluate(a,{}),N=A.get("line-cap"),Z=A.get("line-miter-limit"),X=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var Q=0,ne=c;Q<ne.length;Q+=1)this.addLine(ne[Q],a,R,N,Z,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,I,v)},Ro.prototype.addLine=function(a,c,f,v,I,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var R=0;R<a.length-1;R++)this.totalDistance+=a[R].dist(a[R+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var N=p8[c.type]==="Polygon",Z=a.length;Z>=2&&a[Z-1].equals(a[Z-2]);)Z--;for(var X=0;X<Z-1&&a[X].equals(a[X+1]);)X++;if(!(Z<(N?3:2))){f==="bevel"&&(I=1.05);var Q,ne=this.overscaling<=16?122880/(512*this.overscaling):0,he=this.segments.prepareSegment(10*Z,this.layoutVertexArray,this.indexArray),xe=void 0,Oe=void 0,De=void 0,Je=void 0;this.e1=this.e2=-1,N&&(Je=a[X].sub(Q=a[Z-2])._unit()._perp());for(var Xe=X;Xe<Z;Xe++)if(!(Oe=Xe===Z-1?N?a[X+1]:void 0:a[Xe+1])||!a[Xe].equals(Oe)){Je&&(De=Je),Q&&(xe=Q),Q=a[Xe],Je=Oe?Oe.sub(Q)._unit()._perp():De;var et=(De=De||Je).add(Je);et.x===0&&et.y===0||et._unit();var st=De.x*Je.x+De.y*Je.y,ot=et.x*Je.x+et.y*Je.y,ct=ot!==0?1/ot:1/0,_t=2*Math.sqrt(2-2*ot),Ft=ot<g8&&xe&&Oe,zt=De.x*Je.y-De.y*Je.x>0;if(Ft&&Xe>X){var gn=Q.dist(xe);if(gn>2*ne){var Jt=Q.sub(Q.sub(xe)._mult(ne/gn)._round());this.updateDistance(xe,Jt),this.addCurrentVertex(Jt,De,0,0,he),xe=Jt}}var bn=xe&&Oe,Qt=bn?f:N?"butt":v;if(bn&&Qt==="round"&&(ct<A?Qt="miter":ct<=2&&(Qt="fakeround")),Qt==="miter"&&ct>I&&(Qt="bevel"),Qt==="bevel"&&(ct>2&&(Qt="flipbevel"),ct<I&&(Qt="miter")),xe&&this.updateDistance(xe,Q),Qt==="miter")et._mult(ct),this.addCurrentVertex(Q,et,0,0,he);else if(Qt==="flipbevel"){if(ct>100)et=Je.mult(-1);else{var qn=ct*De.add(Je).mag()/De.sub(Je).mag();et._perp()._mult(qn*(zt?-1:1))}this.addCurrentVertex(Q,et,0,0,he),this.addCurrentVertex(Q,et.mult(-1),0,0,he)}else if(Qt==="bevel"||Qt==="fakeround"){var kn=-Math.sqrt(ct*ct-1),cn=zt?kn:0,ri=zt?0:kn;if(xe&&this.addCurrentVertex(Q,De,cn,ri,he),Qt==="fakeround")for(var Un=Math.round(180*_t/Math.PI/20),xi=1;xi<Un;xi++){var xn=xi/Un;if(xn!==.5){var ki=xn-.5;xn+=xn*ki*(xn-1)*((1.0904+st*(st*(3.55645-1.43519*st)-3.2452))*ki*ki+(.848013+st*(.215638*st-1.06021)))}var Sr=Je.sub(De)._mult(xn)._add(De)._unit()._mult(zt?-1:1);this.addHalfVertex(Q,Sr.x,Sr.y,!1,zt,0,he)}Oe&&this.addCurrentVertex(Q,Je,-cn,-ri,he)}else if(Qt==="butt")this.addCurrentVertex(Q,et,0,0,he);else if(Qt==="square"){var Dr=xe?1:-1;this.addCurrentVertex(Q,et,Dr,Dr,he)}else Qt==="round"&&(xe&&(this.addCurrentVertex(Q,De,0,0,he),this.addCurrentVertex(Q,De,1,1,he,!0)),Oe&&(this.addCurrentVertex(Q,Je,-1,-1,he,!0),this.addCurrentVertex(Q,Je,0,0,he)));if(Ft&&Xe<Z-1){var Pr=Q.dist(Oe);if(Pr>2*ne){var Er=Q.add(Oe.sub(Q)._mult(ne/Pr)._round());this.updateDistance(Q,Er),this.addCurrentVertex(Er,Je,0,0,he),Q=Er}}}}},Ro.prototype.addCurrentVertex=function(a,c,f,v,I,A){A===void 0&&(A=!1);var R=c.y*v-c.x,N=-c.y-c.x*v;this.addHalfVertex(a,c.x+c.y*f,c.y-c.x*f,A,!1,f,I),this.addHalfVertex(a,R,N,A,!0,-v,I),this.distance>rL/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,c,f,v,I,A))},Ro.prototype.addHalfVertex=function(a,c,f,v,I,A,R){var N=.5*(this.lineClips?this.scaledDistance*(rL-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(v?1:0),(a.y<<1)+(I?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(A===0?0:A<0?-1:1)|(63&N)<<2,N>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var Z=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Z),R.primitiveLength++),I?this.e2=Z:this.e1=Z},Ro.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ro.prototype.updateDistance=function(a,c){this.distance+=a.dist(c),this.updateScaledDistance()},rn("LineBucket",Ro,{omit:["layers","patternFeatures"]});var m8=new Ks({"line-cap":new _n(be.layout_line["line-cap"]),"line-join":new un(be.layout_line["line-join"]),"line-miter-limit":new _n(be.layout_line["line-miter-limit"]),"line-round-limit":new _n(be.layout_line["line-round-limit"]),"line-sort-key":new un(be.layout_line["line-sort-key"])}),sL={paint:new Ks({"line-opacity":new un(be.paint_line["line-opacity"]),"line-color":new un(be.paint_line["line-color"]),"line-translate":new _n(be.paint_line["line-translate"]),"line-translate-anchor":new _n(be.paint_line["line-translate-anchor"]),"line-width":new un(be.paint_line["line-width"]),"line-gap-width":new un(be.paint_line["line-gap-width"]),"line-offset":new un(be.paint_line["line-offset"]),"line-blur":new un(be.paint_line["line-blur"]),"line-dasharray":new go(be.paint_line["line-dasharray"]),"line-pattern":new Pg(be.paint_line["line-pattern"]),"line-gradient":new ul(be.paint_line["line-gradient"])}),layout:m8},oL=new((function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.possiblyEvaluate=function(f,v){return v=new ui(Math.floor(v.zoom),{now:v.now,fadeDuration:v.fadeDuration,zoomHistory:v.zoomHistory,transition:v.transition}),a.prototype.possiblyEvaluate.call(this,f,v)},c.prototype.evaluate=function(f,v,I,A){return v=k({},v,{zoom:Math.floor(v.zoom)}),a.prototype.evaluate.call(this,f,v,I,A)},c})(un))(sL.paint.properties["line-width"].specification);oL.useIntegerZoom=!0;var y8=(function(a){function c(f){a.call(this,f,sL),this.gradientVersion=0}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Zo,this.gradientVersion=(this.gradientVersion+1)%x)},c.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},c.prototype.recalculate=function(f,v){a.prototype.recalculate.call(this,f,v),this.paint._values["line-floorwidth"]=oL.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,f)},c.prototype.createBucket=function(f){return new Ro(f)},c.prototype.queryRadius=function(f){var v=f,I=aL(Vl("line-width",this,v),Vl("line-gap-width",this,v)),A=Vl("line-offset",this,v);return I/2+Math.abs(A)+xs(this.paint.get("line-translate"))},c.prototype.queryIntersectsFeature=function(f,v,I,A,R,N,Z){var X=uu(f,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),N.angle,Z),Q=Z/2*aL(this.paint.get("line-width").evaluate(v,I),this.paint.get("line-gap-width").evaluate(v,I)),ne=this.paint.get("line-offset").evaluate(v,I);return ne&&(A=(function(he,xe){for(var Oe=[],De=new d(0,0),Je=0;Je<he.length;Je++){for(var Xe=he[Je],et=[],st=0;st<Xe.length;st++){var ot=Xe[st],ct=Xe[st+1],_t=st===0?De:ot.sub(Xe[st-1])._unit()._perp(),Ft=st===Xe.length-1?De:ct.sub(ot)._unit()._perp(),zt=_t._add(Ft)._unit();zt._mult(1/(zt.x*Ft.x+zt.y*Ft.y)),et.push(zt._mult(xe)._add(ot))}Oe.push(et)}return Oe})(A,ne*Z)),(function(he,xe,Oe){for(var De=0;De<xe.length;De++){var Je=xe[De];if(he.length>=3){for(var Xe=0;Xe<Je.length;Xe++)if(Dl(he,Je[Xe]))return!0}if(Ga(he,Je,Oe))return!0}return!1})(X,A,Q)},c.prototype.isTileClipped=function(){return!0},c})(Ol);function aL(a,c){return c>0?c+2*a:a}var _8=Gs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),v8=Gs([{name:"a_projected_pos",components:3,type:"Float32"}],4),b8=(Gs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Gs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),lL=(Gs([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Gs([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),x8=Gs([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function I8(a,c,f){return a.sections.forEach((function(v){v.text=(function(I,A,R){var N=A.layout.get("text-transform").evaluate(R,{});return N==="uppercase"?I=I.toLocaleUpperCase():N==="lowercase"&&(I=I.toLocaleLowerCase()),fa.applyArabicShaping&&(I=fa.applyArabicShaping(I)),I})(v.text,c,f)})),a}Gs([{name:"triangle",components:3,type:"Uint16"}]),Gs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Gs([{type:"Float32",name:"offsetX"}]),Gs([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var F_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},uL=function(a,c,f,v,I){var A,R,N=8*I-v-1,Z=(1<<N)-1,X=Z>>1,Q=-7,ne=I-1,he=-1,xe=a[c+ne];for(ne+=he,A=xe&(1<<-Q)-1,xe>>=-Q,Q+=N;Q>0;A=256*A+a[c+ne],ne+=he,Q-=8);for(R=A&(1<<-Q)-1,A>>=-Q,Q+=v;Q>0;R=256*R+a[c+ne],ne+=he,Q-=8);if(A===0)A=1-X;else{if(A===Z)return R?NaN:1/0*(xe?-1:1);R+=Math.pow(2,v),A-=X}return(xe?-1:1)*R*Math.pow(2,A-v)},cL=function(a,c,f,v,I,A){var R,N,Z,X=8*A-I-1,Q=(1<<X)-1,ne=Q>>1,he=I===23?Math.pow(2,-24)-Math.pow(2,-77):0,xe=0,Oe=1,De=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(N=isNaN(c)?1:0,R=Q):(R=Math.floor(Math.log(c)/Math.LN2),c*(Z=Math.pow(2,-R))<1&&(R--,Z*=2),(c+=R+ne>=1?he/Z:he*Math.pow(2,1-ne))*Z>=2&&(R++,Z/=2),R+ne>=Q?(N=0,R=Q):R+ne>=1?(N=(c*Z-1)*Math.pow(2,I),R+=ne):(N=c*Math.pow(2,ne-1)*Math.pow(2,I),R=0));I>=8;a[f+xe]=255&N,xe+=Oe,N/=256,I-=8);for(R=R<<I|N,X+=I;X>0;a[f+xe]=255&R,xe+=Oe,R/=256,X-=8);a[f+xe-Oe]|=128*De},I1=dr;function dr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}dr.Varint=0,dr.Fixed64=1,dr.Bytes=2,dr.Fixed32=5;var hL=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ch(a){return a.type===dr.Bytes?a.readVarint()+a.pos:a.pos+1}function zg(a,c,f){return f?4294967296*c+(a>>>0):4294967296*(c>>>0)+(a>>>0)}function dL(a,c,f){var v=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));f.realloc(v);for(var I=f.pos-1;I>=a;I--)f.buf[I+v]=f.buf[I]}function C8(a,c){for(var f=0;f<a.length;f++)c.writeVarint(a[f])}function w8(a,c){for(var f=0;f<a.length;f++)c.writeSVarint(a[f])}function A8(a,c){for(var f=0;f<a.length;f++)c.writeFloat(a[f])}function S8(a,c){for(var f=0;f<a.length;f++)c.writeDouble(a[f])}function E8(a,c){for(var f=0;f<a.length;f++)c.writeBoolean(a[f])}function T8(a,c){for(var f=0;f<a.length;f++)c.writeFixed32(a[f])}function R8(a,c){for(var f=0;f<a.length;f++)c.writeSFixed32(a[f])}function M8(a,c){for(var f=0;f<a.length;f++)c.writeFixed64(a[f])}function k8(a,c){for(var f=0;f<a.length;f++)c.writeSFixed64(a[f])}function C1(a,c){return(a[c]|a[c+1]<<8|a[c+2]<<16)+16777216*a[c+3]}function Ug(a,c,f){a[f]=c,a[f+1]=c>>>8,a[f+2]=c>>>16,a[f+3]=c>>>24}function fL(a,c){return(a[c]|a[c+1]<<8|a[c+2]<<16)+(a[c+3]<<24)}function L8(a,c,f){a===1&&f.readMessage(P8,c)}function P8(a,c,f){if(a===3){var v=f.readMessage(G8,{}),I=v.width,A=v.height,R=v.left,N=v.top,Z=v.advance;c.push({id:v.id,bitmap:new ip({width:I+6,height:A+6},v.bitmap),metrics:{width:I,height:A,left:R,top:N,advance:Z}})}}function G8(a,c,f){a===1?c.id=f.readVarint():a===2?c.bitmap=f.readBytes():a===3?c.width=f.readVarint():a===4?c.height=f.readVarint():a===5?c.left=f.readSVarint():a===6?c.top=f.readSVarint():a===7&&(c.advance=f.readVarint())}function pL(a){for(var c=0,f=0,v=0,I=a;v<I.length;v+=1){var A=I[v];c+=A.w*A.h,f=Math.max(f,A.w)}a.sort((function(De,Je){return Je.h-De.h}));for(var R=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),f),h:1/0}],N=0,Z=0,X=0,Q=a;X<Q.length;X+=1)for(var ne=Q[X],he=R.length-1;he>=0;he--){var xe=R[he];if(!(ne.w>xe.w||ne.h>xe.h)){if(ne.x=xe.x,ne.y=xe.y,Z=Math.max(Z,ne.y+ne.h),N=Math.max(N,ne.x+ne.w),ne.w===xe.w&&ne.h===xe.h){var Oe=R.pop();he<R.length&&(R[he]=Oe)}else ne.h===xe.h?(xe.x+=ne.w,xe.w-=ne.w):ne.w===xe.w?(xe.y+=ne.h,xe.h-=ne.h):(R.push({x:xe.x+ne.w,y:xe.y,w:xe.w-ne.w,h:ne.h}),xe.y+=ne.h,xe.h-=ne.h);break}}return{w:N,h:Z,fill:c/(N*Z)||0}}dr.prototype={destroy:function(){this.buf=null},readFields:function(a,c,f){for(f=f||this.length;this.pos<f;){var v=this.readVarint(),I=v>>3,A=this.pos;this.type=7&v,a(I,c,this),this.pos===A&&this.skip(v)}return c},readMessage:function(a,c){return this.readFields(a,c,this.readVarint()+this.pos)},readFixed32:function(){var a=C1(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=fL(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=C1(this.buf,this.pos)+4294967296*C1(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=C1(this.buf,this.pos)+4294967296*fL(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=uL(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=uL(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var c,f,v=this.buf;return c=127&(f=v[this.pos++]),f<128?c:(c|=(127&(f=v[this.pos++]))<<7,f<128?c:(c|=(127&(f=v[this.pos++]))<<14,f<128?c:(c|=(127&(f=v[this.pos++]))<<21,f<128?c:(function(I,A,R){var N,Z,X=R.buf;if(N=(112&(Z=X[R.pos++]))>>4,Z<128||(N|=(127&(Z=X[R.pos++]))<<3,Z<128)||(N|=(127&(Z=X[R.pos++]))<<10,Z<128)||(N|=(127&(Z=X[R.pos++]))<<17,Z<128)||(N|=(127&(Z=X[R.pos++]))<<24,Z<128)||(N|=(1&(Z=X[R.pos++]))<<31,Z<128))return zg(I,N,A);throw new Error("Expected varint not more than 10 bytes")})(c|=(15&(f=v[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,c=this.pos;return this.pos=a,a-c>=12&&hL?(function(f,v,I){return hL.decode(f.subarray(v,I))})(this.buf,c,a):(function(f,v,I){for(var A="",R=v;R<I;){var N,Z,X,Q=f[R],ne=null,he=Q>239?4:Q>223?3:Q>191?2:1;if(R+he>I)break;he===1?Q<128&&(ne=Q):he===2?(192&(N=f[R+1]))==128&&(ne=(31&Q)<<6|63&N)<=127&&(ne=null):he===3?(Z=f[R+2],(192&(N=f[R+1]))==128&&(192&Z)==128&&((ne=(15&Q)<<12|(63&N)<<6|63&Z)<=2047||ne>=55296&&ne<=57343)&&(ne=null)):he===4&&(Z=f[R+2],X=f[R+3],(192&(N=f[R+1]))==128&&(192&Z)==128&&(192&X)==128&&((ne=(15&Q)<<18|(63&N)<<12|(63&Z)<<6|63&X)<=65535||ne>=1114112)&&(ne=null)),ne===null?(ne=65533,he=1):ne>65535&&(ne-=65536,A+=String.fromCharCode(ne>>>10&1023|55296),ne=56320|1023&ne),A+=String.fromCharCode(ne),R+=he}return A})(this.buf,c,a)},readBytes:function(){var a=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,a);return this.pos=a,c},readPackedVarint:function(a,c){if(this.type!==dr.Bytes)return a.push(this.readVarint(c));var f=ch(this);for(a=a||[];this.pos<f;)a.push(this.readVarint(c));return a},readPackedSVarint:function(a){if(this.type!==dr.Bytes)return a.push(this.readSVarint());var c=ch(this);for(a=a||[];this.pos<c;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==dr.Bytes)return a.push(this.readBoolean());var c=ch(this);for(a=a||[];this.pos<c;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==dr.Bytes)return a.push(this.readFloat());var c=ch(this);for(a=a||[];this.pos<c;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==dr.Bytes)return a.push(this.readDouble());var c=ch(this);for(a=a||[];this.pos<c;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==dr.Bytes)return a.push(this.readFixed32());var c=ch(this);for(a=a||[];this.pos<c;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==dr.Bytes)return a.push(this.readSFixed32());var c=ch(this);for(a=a||[];this.pos<c;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==dr.Bytes)return a.push(this.readFixed64());var c=ch(this);for(a=a||[];this.pos<c;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==dr.Bytes)return a.push(this.readSFixed64());var c=ch(this);for(a=a||[];this.pos<c;)a.push(this.readSFixed64());return a},skip:function(a){var c=7&a;if(c===dr.Varint)for(;this.buf[this.pos++]>127;);else if(c===dr.Bytes)this.pos=this.readVarint()+this.pos;else if(c===dr.Fixed32)this.pos+=4;else{if(c!==dr.Fixed64)throw new Error("Unimplemented type: "+c);this.pos+=8}},writeTag:function(a,c){this.writeVarint(a<<3|c)},realloc:function(a){for(var c=this.length||16;c<this.pos+a;)c*=2;if(c!==this.length){var f=new Uint8Array(c);f.set(this.buf),this.buf=f,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Ug(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Ug(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Ug(this.buf,-1&a,this.pos),Ug(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Ug(this.buf,-1&a,this.pos),Ug(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?(function(c,f){var v,I;if(c>=0?(v=c%4294967296|0,I=c/4294967296|0):(I=~(-c/4294967296),4294967295^(v=~(-c%4294967296))?v=v+1|0:(v=0,I=I+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),(function(A,R,N){N.buf[N.pos++]=127&A|128,A>>>=7,N.buf[N.pos++]=127&A|128,A>>>=7,N.buf[N.pos++]=127&A|128,A>>>=7,N.buf[N.pos++]=127&A|128,N.buf[N.pos]=127&(A>>>=7)})(v,0,f),(function(A,R){var N=(7&A)<<4;R.buf[R.pos++]|=N|((A>>>=3)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A)))))})(I,f)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var c=this.pos;this.pos=(function(v,I,A){for(var R,N,Z=0;Z<I.length;Z++){if((R=I.charCodeAt(Z))>55295&&R<57344){if(!N){R>56319||Z+1===I.length?(v[A++]=239,v[A++]=191,v[A++]=189):N=R;continue}if(R<56320){v[A++]=239,v[A++]=191,v[A++]=189,N=R;continue}R=N-55296<<10|R-56320|65536,N=null}else N&&(v[A++]=239,v[A++]=191,v[A++]=189,N=null);R<128?v[A++]=R:(R<2048?v[A++]=R>>6|192:(R<65536?v[A++]=R>>12|224:(v[A++]=R>>18|240,v[A++]=R>>12&63|128),v[A++]=R>>6&63|128),v[A++]=63&R|128)}return A})(this.buf,a,this.pos);var f=this.pos-c;f>=128&&dL(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeFloat:function(a){this.realloc(4),cL(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),cL(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var c=a.length;this.writeVarint(c),this.realloc(c);for(var f=0;f<c;f++)this.buf[this.pos++]=a[f]},writeRawMessage:function(a,c){this.pos++;var f=this.pos;a(c,this);var v=this.pos-f;v>=128&&dL(f,v,this),this.pos=f-1,this.writeVarint(v),this.pos+=v},writeMessage:function(a,c,f){this.writeTag(a,dr.Bytes),this.writeRawMessage(c,f)},writePackedVarint:function(a,c){c.length&&this.writeMessage(a,C8,c)},writePackedSVarint:function(a,c){c.length&&this.writeMessage(a,w8,c)},writePackedBoolean:function(a,c){c.length&&this.writeMessage(a,E8,c)},writePackedFloat:function(a,c){c.length&&this.writeMessage(a,A8,c)},writePackedDouble:function(a,c){c.length&&this.writeMessage(a,S8,c)},writePackedFixed32:function(a,c){c.length&&this.writeMessage(a,T8,c)},writePackedSFixed32:function(a,c){c.length&&this.writeMessage(a,R8,c)},writePackedFixed64:function(a,c){c.length&&this.writeMessage(a,M8,c)},writePackedSFixed64:function(a,c){c.length&&this.writeMessage(a,k8,c)},writeBytesField:function(a,c){this.writeTag(a,dr.Bytes),this.writeBytes(c)},writeFixed32Field:function(a,c){this.writeTag(a,dr.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(a,c){this.writeTag(a,dr.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(a,c){this.writeTag(a,dr.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(a,c){this.writeTag(a,dr.Fixed64),this.writeSFixed64(c)},writeVarintField:function(a,c){this.writeTag(a,dr.Varint),this.writeVarint(c)},writeSVarintField:function(a,c){this.writeTag(a,dr.Varint),this.writeSVarint(c)},writeStringField:function(a,c){this.writeTag(a,dr.Bytes),this.writeString(c)},writeFloatField:function(a,c){this.writeTag(a,dr.Fixed32),this.writeFloat(c)},writeDoubleField:function(a,c){this.writeTag(a,dr.Fixed64),this.writeDouble(c)},writeBooleanField:function(a,c){this.writeVarintField(a,!!c)}};var w1=function(a,c){var f=c.pixelRatio,v=c.version,I=c.stretchX,A=c.stretchY,R=c.content;this.paddedRect=a,this.pixelRatio=f,this.stretchX=I,this.stretchY=A,this.content=R,this.version=v},O_={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};O_.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},O_.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},O_.tlbr.get=function(){return this.tl.concat(this.br)},O_.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(w1.prototype,O_);var N_=function(a,c){var f={},v={};this.haveRenderCallbacks=[];var I=[];this.addImages(a,f,I),this.addImages(c,v,I);var A=pL(I),R=new Ko({width:A.w||1,height:A.h||1});for(var N in a){var Z=a[N],X=f[N].paddedRect;Ko.copy(Z.data,R,{x:0,y:0},{x:X.x+1,y:X.y+1},Z.data)}for(var Q in c){var ne=c[Q],he=v[Q].paddedRect,xe=he.x+1,Oe=he.y+1,De=ne.data.width,Je=ne.data.height;Ko.copy(ne.data,R,{x:0,y:0},{x:xe,y:Oe},ne.data),Ko.copy(ne.data,R,{x:0,y:Je-1},{x:xe,y:Oe-1},{width:De,height:1}),Ko.copy(ne.data,R,{x:0,y:0},{x:xe,y:Oe+Je},{width:De,height:1}),Ko.copy(ne.data,R,{x:De-1,y:0},{x:xe-1,y:Oe},{width:1,height:Je}),Ko.copy(ne.data,R,{x:0,y:0},{x:xe+De,y:Oe},{width:1,height:Je})}this.image=R,this.iconPositions=f,this.patternPositions=v};N_.prototype.addImages=function(a,c,f){for(var v in a){var I=a[v],A={x:0,y:0,w:I.data.width+2,h:I.data.height+2};f.push(A),c[v]=new w1(A,I),I.hasRenderCallback&&this.haveRenderCallbacks.push(v)}},N_.prototype.patchUpdatedImages=function(a,c){for(var f in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[f],a.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],a.getImage(f),c)},N_.prototype.patchUpdatedImage=function(a,c,f){if(a&&c&&a.version!==c.version){a.version=c.version;var v=a.tl;f.update(c.data,void 0,{x:v[0],y:v[1]})}},rn("ImagePosition",w1),rn("ImageAtlas",N_);var Fa={horizontal:1,vertical:2,horizontalOnly:3},Xg=function(){this.scale=1,this.fontStack="",this.imageName=null};Xg.forText=function(a,c){var f=new Xg;return f.scale=a||1,f.fontStack=c,f},Xg.forImage=function(a){var c=new Xg;return c.imageName=a,c};var yo=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function A1(a,c,f,v,I,A,R,N,Z,X,Q,ne,he,xe,Oe,De){var Je,Xe=yo.fromFeature(a,I);ne===Fa.vertical&&Xe.verticalizePunctuation();var et=fa.processBidirectionalText,st=fa.processStyledBidirectionalText;if(et&&Xe.sections.length===1){Je=[];for(var ot=0,ct=et(Xe.toString(),e2(Xe,X,A,c,v,xe,Oe));ot<ct.length;ot+=1){var _t=ct[ot],Ft=new yo;Ft.text=_t,Ft.sections=Xe.sections;for(var zt=0;zt<_t.length;zt++)Ft.sectionIndex.push(0);Je.push(Ft)}}else if(st){Je=[];for(var gn=0,Jt=st(Xe.text,Xe.sectionIndex,e2(Xe,X,A,c,v,xe,Oe));gn<Jt.length;gn+=1){var bn=Jt[gn],Qt=new yo;Qt.text=bn[0],Qt.sectionIndex=bn[1],Qt.sections=Xe.sections,Je.push(Qt)}}else Je=(function(cn,ri){for(var Un=[],xi=cn.text,xn=0,ki=0,Sr=ri;ki<Sr.length;ki+=1){var Dr=Sr[ki];Un.push(cn.substring(xn,Dr)),xn=Dr}return xn<xi.length&&Un.push(cn.substring(xn,xi.length)),Un})(Xe,e2(Xe,X,A,c,v,xe,Oe));var qn=[],kn={positionedLines:qn,text:Xe.toString(),top:Q[1],bottom:Q[1],left:Q[0],right:Q[0],writingMode:ne,iconsInText:!1,verticalizable:!1};return(function(cn,ri,Un,xi,xn,ki,Sr,Dr,Pr,Er,Vr,Is){for(var Cs=0,_o=-17,Ns=0,vo=0,Kr=Dr==="right"?1:Dr==="left"?0:.5,Ds=0,di=0,tr=xn;di<tr.length;di+=1){var Xi=tr[di];Xi.trim();var Ai=Xi.getMaxScale(),Mo=24*(Ai-1),ao={positionedGlyphs:[],lineOffset:0};cn.positionedLines[Ds]=ao;var yr=ao.positionedGlyphs,is=0;if(Xi.length()){for(var lo=0;lo<Xi.length();lo++){var Li=Xi.getSection(lo),oc=Xi.getSectionIndex(lo),Oa=Xi.getCharCode(lo),ac=0,jr=null,lc=null,Bl=null,Qg=24,ap=!(Pr===Fa.horizontal||!Vr&&!Mg(Oa)||Vr&&(S1[Oa]||(ph=Oa,Ht.Arabic(ph)||Ht["Arabic Supplement"](ph)||Ht["Arabic Extended-A"](ph)||Ht["Arabic Presentation Forms-A"](ph)||Ht["Arabic Presentation Forms-B"](ph))));if(Li.imageName){var em=xi[Li.imageName];if(!em)continue;Bl=Li.imageName,cn.iconsInText=cn.iconsInText||!0,lc=em.paddedRect;var fh=em.displaySize;Li.scale=24*Li.scale/Is,ac=Mo+(24-fh[1]*Li.scale),Qg=(jr={width:fh[0],height:fh[1],left:1,top:-3,advance:ap?fh[1]:fh[0]}).advance;var tm=ap?fh[0]*Li.scale-24*Ai:fh[1]*Li.scale-24*Ai;tm>0&&tm>is&&(is=tm)}else{var F1=Un[Li.fontStack],nm=F1&&F1[Oa];if(nm&&nm.rect)lc=nm.rect,jr=nm.metrics;else{var B_=ri[Li.fontStack],O1=B_&&B_[Oa];if(!O1)continue;jr=O1.metrics}ac=24*(Ai-Li.scale)}ap?(cn.verticalizable=!0,yr.push({glyph:Oa,imageName:Bl,x:Cs,y:_o+ac,vertical:ap,scale:Li.scale,fontStack:Li.fontStack,sectionIndex:oc,metrics:jr,rect:lc}),Cs+=Qg*Li.scale+Er):(yr.push({glyph:Oa,imageName:Bl,x:Cs,y:_o+ac,vertical:ap,scale:Li.scale,fontStack:Li.fontStack,sectionIndex:oc,metrics:jr,rect:lc}),Cs+=jr.advance*Li.scale+Er)}yr.length!==0&&(Ns=Math.max(Cs-Er,Ns),O8(yr,0,yr.length-1,Kr,is)),Cs=0;var N1=ki*Ai+is;ao.lineOffset=Math.max(is,Mo),_o+=N1,vo=Math.max(N1,vo),++Ds}else _o+=ki,++Ds}var ph,Z_=_o- -17,im=t2(Sr),Sd=im.horizontalAlign,rm=im.verticalAlign;(function(D1,V1,W_,z_,B1,U_,X_,Y_,Z1){var sm,W1=(V1-W_)*B1;sm=U_!==X_?-Y_*z_- -17:(-z_*Z1+.5)*X_;for(var om=0,H_=D1;om<H_.length;om+=1)for(var lp=0,K_=H_[om].positionedGlyphs;lp<K_.length;lp+=1){var am=K_[lp];am.x+=W1,am.y+=sm}})(cn.positionedLines,Kr,Sd,rm,Ns,vo,ki,Z_,xn.length),cn.top+=-rm*Z_,cn.bottom=cn.top+Z_,cn.left+=-Sd*Ns,cn.right=cn.left+Ns})(kn,c,f,v,Je,R,N,Z,ne,X,he,De),!(function(cn){for(var ri=0,Un=cn;ri<Un.length;ri+=1)if(Un[ri].positionedGlyphs.length!==0)return!1;return!0})(qn)&&kn}yo.fromFeature=function(a,c){for(var f=new yo,v=0;v<a.sections.length;v++){var I=a.sections[v];I.image?f.addImageSection(I):f.addTextSection(I,c)}return f},yo.prototype.length=function(){return this.text.length},yo.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},yo.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},yo.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},yo.prototype.verticalizePunctuation=function(){this.text=(function(a){for(var c="",f=0;f<a.length;f++){var v=a.charCodeAt(f+1)||null,I=a.charCodeAt(f-1)||null;c+=v&&b_(v)&&!F_[a[f+1]]||I&&b_(I)&&!F_[a[f-1]]||!F_[a[f]]?a[f]:F_[a[f]]}return c})(this.text)},yo.prototype.trim=function(){for(var a=0,c=0;c<this.text.length&&S1[this.text.charCodeAt(c)];c++)a++;for(var f=this.text.length,v=this.text.length-1;v>=0&&v>=a&&S1[this.text.charCodeAt(v)];v--)f--;this.text=this.text.substring(a,f),this.sectionIndex=this.sectionIndex.slice(a,f)},yo.prototype.substring=function(a,c){var f=new yo;return f.text=this.text.substring(a,c),f.sectionIndex=this.sectionIndex.slice(a,c),f.sections=this.sections,f},yo.prototype.toString=function(){return this.text},yo.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce((function(c,f){return Math.max(c,a.sections[f].scale)}),0)},yo.prototype.addTextSection=function(a,c){this.text+=a.text,this.sections.push(Xg.forText(a.scale,a.fontStack||c));for(var f=this.sections.length-1,v=0;v<a.text.length;++v)this.sectionIndex.push(f)},yo.prototype.addImageSection=function(a){var c=a.image?a.image.name:"";if(c.length!==0){var f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Xg.forImage(c)),this.sectionIndex.push(this.sections.length-1)):de("Reached maximum number of images 6401")}else de("Can't add FormattedSection with an empty image.")},yo.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var S1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ga={};function gL(a,c,f,v,I,A){if(c.imageName){var R=v[c.imageName];return R?R.displaySize[0]*c.scale*24/A+I:0}var N=f[c.fontStack],Z=N&&N[a];return Z?Z.metrics.advance*c.scale+I:0}function mL(a,c,f,v){var I=Math.pow(a-c,2);return v?a<c?I/2:2*I:I+Math.abs(f)*f}function F8(a,c,f){var v=0;return a===10&&(v-=1e4),f&&(v+=150),a!==40&&a!==65288||(v+=50),c!==41&&c!==65289||(v+=50),v}function yL(a,c,f,v,I,A){for(var R=null,N=mL(c,f,I,A),Z=0,X=v;Z<X.length;Z+=1){var Q=X[Z],ne=mL(c-Q.x,f,I,A)+Q.badness;ne<=N&&(R=Q,N=ne)}return{index:a,x:c,priorBreak:R,badness:N}}function e2(a,c,f,v,I,A,R){if(A!=="point")return[];if(!a)return[];for(var N,Z=[],X=(function(Je,Xe,et,st,ot,ct){for(var _t=0,Ft=0;Ft<Je.length();Ft++){var zt=Je.getSection(Ft);_t+=gL(Je.getCharCode(Ft),zt,st,ot,Xe,ct)}return _t/Math.max(1,Math.ceil(_t/et))})(a,c,f,v,I,R),Q=a.text.indexOf("")>=0,ne=0,he=0;he<a.length();he++){var xe=a.getSection(he),Oe=a.getCharCode(he);if(S1[Oe]||(ne+=gL(Oe,xe,v,I,c,R)),he<a.length()-1){var De=!((N=Oe)<11904||!(Ht["Bopomofo Extended"](N)||Ht.Bopomofo(N)||Ht["CJK Compatibility Forms"](N)||Ht["CJK Compatibility Ideographs"](N)||Ht["CJK Compatibility"](N)||Ht["CJK Radicals Supplement"](N)||Ht["CJK Strokes"](N)||Ht["CJK Symbols and Punctuation"](N)||Ht["CJK Unified Ideographs Extension A"](N)||Ht["CJK Unified Ideographs"](N)||Ht["Enclosed CJK Letters and Months"](N)||Ht["Halfwidth and Fullwidth Forms"](N)||Ht.Hiragana(N)||Ht["Ideographic Description Characters"](N)||Ht["Kangxi Radicals"](N)||Ht["Katakana Phonetic Extensions"](N)||Ht.Katakana(N)||Ht["Vertical Forms"](N)||Ht["Yi Radicals"](N)||Ht["Yi Syllables"](N)));(ga[Oe]||De||xe.imageName)&&Z.push(yL(he+1,ne,X,Z,F8(Oe,a.getCharCode(he+1),De&&Q),!1))}}return(function Je(Xe){return Xe?Je(Xe.priorBreak).concat(Xe.index):[]})(yL(a.length(),ne,X,Z,0,!0))}function t2(a){var c=.5,f=.5;switch(a){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:c,verticalAlign:f}}function O8(a,c,f,v,I){if(v||I)for(var A=a[f],R=(a[f].x+A.metrics.advance*A.scale)*v,N=c;N<=f;N++)a[N].x-=R,a[N].y+=I}function _L(a,c,f,v,I,A){var R,N=a.image;if(N.content){var Z=N.content,X=N.pixelRatio||1;R=[Z[0]/X,Z[1]/X,N.displaySize[0]-Z[2]/X,N.displaySize[1]-Z[3]/X]}var Q,ne,he,xe,Oe=c.left*A,De=c.right*A;f==="width"||f==="both"?(xe=I[0]+Oe-v[3],ne=I[0]+De+v[1]):ne=(xe=I[0]+(Oe+De-N.displaySize[0])/2)+N.displaySize[0];var Je=c.top*A,Xe=c.bottom*A;return f==="height"||f==="both"?(Q=I[1]+Je-v[0],he=I[1]+Xe+v[2]):he=(Q=I[1]+(Je+Xe-N.displaySize[1])/2)+N.displaySize[1],{image:N,top:Q,right:ne,bottom:he,left:xe,collisionPadding:R}}ga[10]=!0,ga[32]=!0,ga[38]=!0,ga[40]=!0,ga[41]=!0,ga[43]=!0,ga[45]=!0,ga[47]=!0,ga[173]=!0,ga[183]=!0,ga[8203]=!0,ga[8208]=!0,ga[8211]=!0,ga[8231]=!0;var Yg=(function(a){function c(f,v,I,A){a.call(this,f,v),this.angle=I,A!==void 0&&(this.segment=A)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.clone=function(){return new c(this.x,this.y,this.angle,this.segment)},c})(d);function n2(a,c){var f=c.expression;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new ui(a+1))};if(f.kind==="source")return{kind:"source"};for(var v=f.zoomStops,I=f.interpolationType,A=0;A<v.length&&v[A]<=a;)A++;for(var R=A=Math.max(0,A-1);R<v.length&&v[R]<a+1;)R++;R=Math.min(v.length-1,R);var N=v[A],Z=v[R];return f.kind==="composite"?{kind:"composite",minZoom:N,maxZoom:Z,interpolationType:I}:{kind:"camera",minZoom:N,maxZoom:Z,minSize:f.evaluate(new ui(N)),maxSize:f.evaluate(new ui(Z)),interpolationType:I}}function vL(a,c,f){var v=c.uSize,I=f.lowerSize;return a.kind==="source"?I/128:a.kind==="composite"?ts(I/128,f.upperSize/128,c.uSizeT):v}function bL(a,c){var f=0,v=0;if(a.kind==="constant")v=a.layoutSize;else if(a.kind!=="source"){var I=a.interpolationType,A=I?E(Ys.interpolationFactor(I,c,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?v=ts(a.minSize,a.maxSize,A):f=A}return{uSizeT:f,uSize:v}}rn("Anchor",Yg);var N8=Object.freeze({__proto__:null,getSizeData:n2,evaluateSizeForFeature:vL,evaluateSizeForZoom:bL,SIZE_PACK_FACTOR:128});function xL(a,c,f,v,I){if(c.segment===void 0)return!0;for(var A=c,R=c.segment+1,N=0;N>-f/2;){if(--R<0)return!1;N-=a[R].dist(A),A=a[R]}N+=a[R].dist(a[R+1]),R++;for(var Z=[],X=0;N<f/2;){var Q=a[R],ne=a[R+1];if(!ne)return!1;var he=a[R-1].angleTo(Q)-Q.angleTo(ne);for(he=Math.abs((he+3*Math.PI)%(2*Math.PI)-Math.PI),Z.push({distance:N,angleDelta:he}),X+=he;N-Z[0].distance>v;)X-=Z.shift().angleDelta;if(X>I)return!1;R++,N+=Q.dist(ne)}return!0}function IL(a){for(var c=0,f=0;f<a.length-1;f++)c+=a[f].dist(a[f+1]);return c}function CL(a,c,f){return a?.6*c*f:0}function wL(a,c){return Math.max(a?a.right-a.left:0,c?c.right-c.left:0)}function D8(a,c,f,v,I,A){for(var R=CL(f,I,A),N=wL(f,v)*A,Z=0,X=IL(a)/2,Q=0;Q<a.length-1;Q++){var ne=a[Q],he=a[Q+1],xe=ne.dist(he);if(Z+xe>X){var Oe=(X-Z)/xe,De=ts(ne.x,he.x,Oe),Je=ts(ne.y,he.y,Oe),Xe=new Yg(De,Je,he.angleTo(ne),Q);return Xe._round(),!R||xL(a,Xe,N,R,c)?Xe:void 0}Z+=xe}}function V8(a,c,f,v,I,A,R,N,Z){var X=CL(v,A,R),Q=wL(v,I),ne=Q*R,he=a[0].x===0||a[0].x===Z||a[0].y===0||a[0].y===Z;return c-ne<c/4&&(c=ne+c/4),(function xe(Oe,De,Je,Xe,et,st,ot,ct,_t){for(var Ft=st/2,zt=IL(Oe),gn=0,Jt=De-Je,bn=[],Qt=0;Qt<Oe.length-1;Qt++){for(var qn=Oe[Qt],kn=Oe[Qt+1],cn=qn.dist(kn),ri=kn.angleTo(qn);Jt+Je<gn+cn;){var Un=((Jt+=Je)-gn)/cn,xi=ts(qn.x,kn.x,Un),xn=ts(qn.y,kn.y,Un);if(xi>=0&&xi<_t&&xn>=0&&xn<_t&&Jt-Ft>=0&&Jt+Ft<=zt){var ki=new Yg(xi,xn,ri,Qt);ki._round(),Xe&&!xL(Oe,ki,st,Xe,et)||bn.push(ki)}}gn+=cn}return ct||bn.length||ot||(bn=xe(Oe,gn/2,Je,Xe,et,st,ot,!0,_t)),bn})(a,he?c/2*N%c:(Q/2+2*A)*R*N%c,c,X,f,ne,he,!1,Z)}function AL(a,c,f,v,I){for(var A=[],R=0;R<a.length;R++)for(var N=a[R],Z=void 0,X=0;X<N.length-1;X++){var Q=N[X],ne=N[X+1];Q.x<c&&ne.x<c||(Q.x<c?Q=new d(c,Q.y+(c-Q.x)/(ne.x-Q.x)*(ne.y-Q.y))._round():ne.x<c&&(ne=new d(c,Q.y+(c-Q.x)/(ne.x-Q.x)*(ne.y-Q.y))._round()),Q.y<f&&ne.y<f||(Q.y<f?Q=new d(Q.x+(f-Q.y)/(ne.y-Q.y)*(ne.x-Q.x),f)._round():ne.y<f&&(ne=new d(Q.x+(f-Q.y)/(ne.y-Q.y)*(ne.x-Q.x),f)._round()),Q.x>=v&&ne.x>=v||(Q.x>=v?Q=new d(v,Q.y+(v-Q.x)/(ne.x-Q.x)*(ne.y-Q.y))._round():ne.x>=v&&(ne=new d(v,Q.y+(v-Q.x)/(ne.x-Q.x)*(ne.y-Q.y))._round()),Q.y>=I&&ne.y>=I||(Q.y>=I?Q=new d(Q.x+(I-Q.y)/(ne.y-Q.y)*(ne.x-Q.x),I)._round():ne.y>=I&&(ne=new d(Q.x+(I-Q.y)/(ne.y-Q.y)*(ne.x-Q.x),I)._round()),Z&&Q.equals(Z[Z.length-1])||A.push(Z=[Q]),Z.push(ne)))))}return A}function SL(a,c,f,v){var I=[],A=a.image,R=A.pixelRatio,N=A.paddedRect.w-2,Z=A.paddedRect.h-2,X=a.right-a.left,Q=a.bottom-a.top,ne=A.stretchX||[[0,N]],he=A.stretchY||[[0,Z]],xe=function(xi,xn){return xi+xn[1]-xn[0]},Oe=ne.reduce(xe,0),De=he.reduce(xe,0),Je=N-Oe,Xe=Z-De,et=0,st=Oe,ot=0,ct=De,_t=0,Ft=Je,zt=0,gn=Xe;if(A.content&&v){var Jt=A.content;et=E1(ne,0,Jt[0]),ot=E1(he,0,Jt[1]),st=E1(ne,Jt[0],Jt[2]),ct=E1(he,Jt[1],Jt[3]),_t=Jt[0]-et,zt=Jt[1]-ot,Ft=Jt[2]-Jt[0]-st,gn=Jt[3]-Jt[1]-ct}var bn=function(xi,xn,ki,Sr){var Dr=T1(xi.stretch-et,st,X,a.left),Pr=R1(xi.fixed-_t,Ft,xi.stretch,Oe),Er=T1(xn.stretch-ot,ct,Q,a.top),Vr=R1(xn.fixed-zt,gn,xn.stretch,De),Is=T1(ki.stretch-et,st,X,a.left),Cs=R1(ki.fixed-_t,Ft,ki.stretch,Oe),_o=T1(Sr.stretch-ot,ct,Q,a.top),Ns=R1(Sr.fixed-zt,gn,Sr.stretch,De),vo=new d(Dr,Er),Kr=new d(Is,Er),Ds=new d(Is,_o),di=new d(Dr,_o),tr=new d(Pr/R,Vr/R),Xi=new d(Cs/R,Ns/R),Ai=c*Math.PI/180;if(Ai){var Mo=Math.sin(Ai),ao=Math.cos(Ai),yr=[ao,-Mo,Mo,ao];vo._matMult(yr),Kr._matMult(yr),di._matMult(yr),Ds._matMult(yr)}var is=xi.stretch+xi.fixed,lo=xn.stretch+xn.fixed;return{tl:vo,tr:Kr,bl:di,br:Ds,tex:{x:A.paddedRect.x+1+is,y:A.paddedRect.y+1+lo,w:ki.stretch+ki.fixed-is,h:Sr.stretch+Sr.fixed-lo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:tr,pixelOffsetBR:Xi,minFontScaleX:Ft/R/X,minFontScaleY:gn/R/Q,isSDF:f}};if(v&&(A.stretchX||A.stretchY))for(var Qt=EL(ne,Je,Oe),qn=EL(he,Xe,De),kn=0;kn<Qt.length-1;kn++)for(var cn=Qt[kn],ri=Qt[kn+1],Un=0;Un<qn.length-1;Un++)I.push(bn(cn,qn[Un],ri,qn[Un+1]));else I.push(bn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:N+1},{fixed:0,stretch:Z+1}));return I}function E1(a,c,f){for(var v=0,I=0,A=a;I<A.length;I+=1){var R=A[I];v+=Math.max(c,Math.min(f,R[1]))-Math.max(c,Math.min(f,R[0]))}return v}function EL(a,c,f){for(var v=[{fixed:-1,stretch:0}],I=0,A=a;I<A.length;I+=1){var R=A[I],N=R[0],Z=R[1],X=v[v.length-1];v.push({fixed:N-X.stretch,stretch:X.stretch}),v.push({fixed:N-X.stretch,stretch:X.stretch+(Z-N)})}return v.push({fixed:c+1,stretch:f}),v}function T1(a,c,f,v){return a/c*f+v}function R1(a,c,f,v){return a-c*f/v}var M1=function(a,c,f,v,I,A,R,N,Z,X){if(this.boxStartIndex=a.length,Z){var Q=A.top,ne=A.bottom,he=A.collisionPadding;he&&(Q-=he[1],ne+=he[3]);var xe=ne-Q;xe>0&&(xe=Math.max(10,xe),this.circleDiameter=xe)}else{var Oe=A.top*R-N,De=A.bottom*R+N,Je=A.left*R-N,Xe=A.right*R+N,et=A.collisionPadding;if(et&&(Je-=et[0]*R,Oe-=et[1]*R,Xe+=et[2]*R,De+=et[3]*R),X){var st=new d(Je,Oe),ot=new d(Xe,Oe),ct=new d(Je,De),_t=new d(Xe,De),Ft=X*Math.PI/180;st._rotate(Ft),ot._rotate(Ft),ct._rotate(Ft),_t._rotate(Ft),Je=Math.min(st.x,ot.x,ct.x,_t.x),Xe=Math.max(st.x,ot.x,ct.x,_t.x),Oe=Math.min(st.y,ot.y,ct.y,_t.y),De=Math.max(st.y,ot.y,ct.y,_t.y)}a.emplaceBack(c.x,c.y,Je,Oe,Xe,De,f,v,I)}this.boxEndIndex=a.length},Hg=function(a,c){if(a===void 0&&(a=[]),c===void 0&&(c=B8),this.data=a,this.length=this.data.length,this.compare=c,this.length>0)for(var f=(this.length>>1)-1;f>=0;f--)this._down(f)};function B8(a,c){return a<c?-1:a>c?1:0}function Z8(a,c,f){f===void 0&&(f=!1);for(var v=1/0,I=1/0,A=-1/0,R=-1/0,N=a[0],Z=0;Z<N.length;Z++){var X=N[Z];(!Z||X.x<v)&&(v=X.x),(!Z||X.y<I)&&(I=X.y),(!Z||X.x>A)&&(A=X.x),(!Z||X.y>R)&&(R=X.y)}var Q=Math.min(A-v,R-I),ne=Q/2,he=new Hg([],W8);if(Q===0)return new d(v,I);for(var xe=v;xe<A;xe+=Q)for(var Oe=I;Oe<R;Oe+=Q)he.push(new Kg(xe+ne,Oe+ne,ne,a));for(var De=(function(et){for(var st=0,ot=0,ct=0,_t=et[0],Ft=0,zt=_t.length,gn=zt-1;Ft<zt;gn=Ft++){var Jt=_t[Ft],bn=_t[gn],Qt=Jt.x*bn.y-bn.x*Jt.y;ot+=(Jt.x+bn.x)*Qt,ct+=(Jt.y+bn.y)*Qt,st+=3*Qt}return new Kg(ot/st,ct/st,0,et)})(a),Je=he.length;he.length;){var Xe=he.pop();(Xe.d>De.d||!De.d)&&(De=Xe,f&&console.log("found best %d after %d probes",Math.round(1e4*Xe.d)/1e4,Je)),Xe.max-De.d<=c||(he.push(new Kg(Xe.p.x-(ne=Xe.h/2),Xe.p.y-ne,ne,a)),he.push(new Kg(Xe.p.x+ne,Xe.p.y-ne,ne,a)),he.push(new Kg(Xe.p.x-ne,Xe.p.y+ne,ne,a)),he.push(new Kg(Xe.p.x+ne,Xe.p.y+ne,ne,a)),Je+=4)}return f&&(console.log("num probes: "+Je),console.log("best distance: "+De.d)),De.p}function W8(a,c){return c.max-a.max}function Kg(a,c,f,v){this.p=new d(a,c),this.h=f,this.d=(function(I,A){for(var R=!1,N=1/0,Z=0;Z<A.length;Z++)for(var X=A[Z],Q=0,ne=X.length,he=ne-1;Q<ne;he=Q++){var xe=X[Q],Oe=X[he];xe.y>I.y!=Oe.y>I.y&&I.x<(Oe.x-xe.x)*(I.y-xe.y)/(Oe.y-xe.y)+xe.x&&(R=!R),N=Math.min(N,Id(I,xe,Oe))}return(R?1:-1)*Math.sqrt(N)})(this.p,v),this.max=this.d+this.h*Math.SQRT2}Hg.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},Hg.prototype.pop=function(){if(this.length!==0){var a=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),a}},Hg.prototype.peek=function(){return this.data[0]},Hg.prototype._up=function(a){for(var c=this.data,f=this.compare,v=c[a];a>0;){var I=a-1>>1,A=c[I];if(f(v,A)>=0)break;c[a]=A,a=I}c[a]=v},Hg.prototype._down=function(a){for(var c=this.data,f=this.compare,v=this.length>>1,I=c[a];a<v;){var A=1+(a<<1),R=c[A],N=A+1;if(N<this.length&&f(c[N],R)<0&&(A=N,R=c[N]),f(R,I)>=0)break;c[a]=R,a=A}c[a]=I};var i2=Number.POSITIVE_INFINITY;function TL(a,c){return c[1]!==i2?(function(f,v,I){var A=0,R=0;switch(v=Math.abs(v),I=Math.abs(I),f){case"top-right":case"top-left":case"top":R=I-7;break;case"bottom-right":case"bottom-left":case"bottom":R=7-I}switch(f){case"top-right":case"bottom-right":case"right":A=-v;break;case"top-left":case"bottom-left":case"left":A=v}return[A,R]})(a,c[0],c[1]):(function(f,v){var I=0,A=0;v<0&&(v=0);var R=v/Math.sqrt(2);switch(f){case"top-right":case"top-left":A=R-7;break;case"bottom-right":case"bottom-left":A=7-R;break;case"bottom":A=7-v;break;case"top":A=v-7}switch(f){case"top-right":case"bottom-right":I=-R;break;case"top-left":case"bottom-left":I=R;break;case"left":I=v;break;case"right":I=-v}return[I,A]})(a,c[0])}function r2(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function RL(a,c,f,v,I,A,R,N,Z,X,Q,ne,he,xe,Oe){var De=(function(ot,ct,_t,Ft,zt,gn,Jt,bn){for(var Qt=Ft.layout.get("text-rotate").evaluate(gn,{})*Math.PI/180,qn=[],kn=0,cn=ct.positionedLines;kn<cn.length;kn+=1)for(var ri=cn[kn],Un=0,xi=ri.positionedGlyphs;Un<xi.length;Un+=1){var xn=xi[Un];if(xn.rect){var ki=xn.rect||{},Sr=4,Dr=!0,Pr=1,Er=0,Vr=(zt||bn)&&xn.vertical,Is=xn.metrics.advance*xn.scale/2;if(bn&&ct.verticalizable&&(Er=ri.lineOffset/2-(xn.imageName?-(24-xn.metrics.width*xn.scale)/2:24*(xn.scale-1))),xn.imageName){var Cs=Jt[xn.imageName];Dr=Cs.sdf,Sr=1/(Pr=Cs.pixelRatio)}var _o=zt?[xn.x+Is,xn.y]:[0,0],Ns=zt?[0,0]:[xn.x+Is+_t[0],xn.y+_t[1]-Er],vo=[0,0];Vr&&(vo=Ns,Ns=[0,0]);var Kr=(xn.metrics.left-Sr)*xn.scale-Is+Ns[0],Ds=(-xn.metrics.top-Sr)*xn.scale+Ns[1],di=Kr+ki.w*xn.scale/Pr,tr=Ds+ki.h*xn.scale/Pr,Xi=new d(Kr,Ds),Ai=new d(di,Ds),Mo=new d(Kr,tr),ao=new d(di,tr);if(Vr){var yr=new d(-Is,Is- -17),is=-Math.PI/2,lo=12-Is,Li=new d(22-lo,-(xn.imageName?lo:0)),oc=new(Function.prototype.bind.apply(d,[null].concat(vo)));Xi._rotateAround(is,yr)._add(Li)._add(oc),Ai._rotateAround(is,yr)._add(Li)._add(oc),Mo._rotateAround(is,yr)._add(Li)._add(oc),ao._rotateAround(is,yr)._add(Li)._add(oc)}if(Qt){var Oa=Math.sin(Qt),ac=Math.cos(Qt),jr=[ac,-Oa,Oa,ac];Xi._matMult(jr),Ai._matMult(jr),Mo._matMult(jr),ao._matMult(jr)}var lc=new d(0,0),Bl=new d(0,0);qn.push({tl:Xi,tr:Ai,bl:Mo,br:ao,tex:ki,writingMode:ct.writingMode,glyphOffset:_o,sectionIndex:xn.sectionIndex,isSDF:Dr,pixelOffsetTL:lc,pixelOffsetBR:Bl,minFontScaleX:0,minFontScaleY:0})}}return qn})(0,f,N,I,A,R,v,a.allowVerticalPlacement),Je=a.textSizeData,Xe=null;Je.kind==="source"?(Xe=[128*I.layout.get("text-size").evaluate(R,{})])[0]>32640&&de(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Je.kind==="composite"&&((Xe=[128*xe.compositeTextSizes[0].evaluate(R,{},Oe),128*xe.compositeTextSizes[1].evaluate(R,{},Oe)])[0]>32640||Xe[1]>32640)&&de(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,De,Xe,N,A,R,X,c,Z.lineStartIndex,Z.lineLength,he,Oe);for(var et=0,st=Q;et<st.length;et+=1)ne[st[et]]=a.text.placedSymbolArray.length-1;return 4*De.length}function ML(a){for(var c in a)return a[c];return null}function z8(a,c,f,v){var I=a.compareText;if(c in I){for(var A=I[c],R=A.length-1;R>=0;R--)if(v.dist(A[R])<f)return!0}else I[c]=[];return I[c].push(v),!1}var U8=Wg.VectorTileFeature.types,X8=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function k1(a,c,f,v,I,A,R,N,Z,X,Q,ne,he){var xe=N?Math.min(32640,Math.round(N[0])):0,Oe=N?Math.min(32640,Math.round(N[1])):0;a.emplaceBack(c,f,Math.round(32*v),Math.round(32*I),A,R,(xe<<1)+(Z?1:0),Oe,16*X,16*Q,256*ne,256*he)}function s2(a,c,f){a.emplaceBack(c.x,c.y,f),a.emplaceBack(c.x,c.y,f),a.emplaceBack(c.x,c.y,f),a.emplaceBack(c.x,c.y,f)}function Y8(a){for(var c=0,f=a.sections;c<f.length;c+=1)if(kg(f[c].text))return!0;return!1}var jg=function(a){this.layoutVertexArray=new Fg,this.indexArray=new ec,this.programConfigurations=a,this.segments=new we,this.dynamicLayoutVertexArray=new vd,this.opacityVertexArray=new Jf,this.placedSymbolArray=new b};jg.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},jg.prototype.upload=function(a,c,f,v){this.isEmpty()||(f&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,_8.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,v8.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,X8,!0),this.opacityVertexBuffer.itemSize=1),(f||v)&&this.programConfigurations.upload(a))},jg.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},rn("SymbolBuffers",jg);var D_=function(a,c,f){this.layoutVertexArray=new a,this.layoutAttributes=c,this.indexArray=new f,this.segments=new we,this.collisionVertexArray=new S_};D_.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,b8.members,!0)},D_.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},rn("CollisionBuffers",D_);var $i=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((function(A){return A.id})),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=pa([]),this.placementViewportMatrix=pa([]);var c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=n2(this.zoom,c["text-size"]),this.iconSizeData=n2(this.zoom,c["icon-size"]);var f=this.layers[0].layout,v=f.get("symbol-sort-key"),I=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=I!=="viewport-y"&&v.constantOr(1)!==void 0,this.sortFeaturesByY=(I==="viewport-y"||I==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map((function(A){return Fa[A]}))),this.stateDependentLayerIds=this.layers.filter((function(A){return A.isStateDependent()})).map((function(A){return A.id})),this.sourceID=a.sourceID};$i.prototype.createArrays=function(){this.text=new jg(new Tn(this.layers,this.zoom,(function(a){return/^text/.test(a)}))),this.icon=new jg(new Tn(this.layers,this.zoom,(function(a){return/^icon/.test(a)}))),this.glyphOffsetArray=new F,this.lineVertexArray=new B,this.symbolInstances=new L},$i.prototype.calculateGlyphDependencies=function(a,c,f,v,I){for(var A=0;A<a.length;A++)if(c[a.charCodeAt(A)]=!0,(f||v)&&I){var R=F_[a.charAt(A)];R&&(c[R.charCodeAt(0)]=!0)}},$i.prototype.populate=function(a,c,f){var v=this.layers[0],I=v.layout,A=I.get("text-font"),R=I.get("text-field"),N=I.get("icon-image"),Z=(R.value.kind!=="constant"||R.value.value instanceof Ls&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),X=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,Q=I.get("symbol-sort-key");if(this.features=[],Z||X){for(var ne=c.iconDependencies,he=c.glyphDependencies,xe=c.availableImages,Oe=new ui(this.zoom),De=0,Je=a;De<Je.length;De+=1){var Xe=Je[De],et=Xe.feature,st=Xe.id,ot=Xe.index,ct=Xe.sourceLayerIndex,_t=v._featureFilter.needGeometry,Ft=Hr(et,_t);if(v._featureFilter.filter(Oe,Ft,f)){_t||(Ft.geometry=Lr(et));var zt=void 0;if(Z){var gn=v.getValueAndResolveTokens("text-field",Ft,f,xe),Jt=Ls.factory(gn);Y8(Jt)&&(this.hasRTLText=!0),(!this.hasRTLText||I_()==="unavailable"||this.hasRTLText&&fa.isParsed())&&(zt=I8(Jt,v,Ft))}var bn=void 0;if(X){var Qt=v.getValueAndResolveTokens("icon-image",Ft,f,xe);bn=Qt instanceof So?Qt:So.fromString(Qt)}if(zt||bn){var qn=this.sortFeaturesByKey?Q.evaluate(Ft,{},f):void 0;if(this.features.push({id:st,text:zt,icon:bn,index:ot,sourceLayerIndex:ct,geometry:Ft.geometry,properties:et.properties,type:U8[et.type],sortKey:qn}),bn&&(ne[bn.name]=!0),zt){var kn=A.evaluate(Ft,{},f).join(","),cn=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fa.vertical)>=0;for(var ri=0,Un=zt.sections;ri<Un.length;ri+=1){var xi=Un[ri];if(xi.image)ne[xi.image.name]=!0;else{var xn=v_(zt.toString()),ki=xi.fontStack||kn,Sr=he[ki]=he[ki]||{};this.calculateGlyphDependencies(xi.text,Sr,cn,this.allowVerticalPlacement,xn)}}}}}}I.get("symbol-placement")==="line"&&(this.features=(function(Dr){var Pr={},Er={},Vr=[],Is=0;function Cs(yr){Vr.push(Dr[yr]),Is++}function _o(yr,is,lo){var Li=Er[yr];return delete Er[yr],Er[is]=Li,Vr[Li].geometry[0].pop(),Vr[Li].geometry[0]=Vr[Li].geometry[0].concat(lo[0]),Li}function Ns(yr,is,lo){var Li=Pr[is];return delete Pr[is],Pr[yr]=Li,Vr[Li].geometry[0].shift(),Vr[Li].geometry[0]=lo[0].concat(Vr[Li].geometry[0]),Li}function vo(yr,is,lo){var Li=lo?is[0][is[0].length-1]:is[0][0];return yr+":"+Li.x+":"+Li.y}for(var Kr=0;Kr<Dr.length;Kr++){var Ds=Dr[Kr],di=Ds.geometry,tr=Ds.text?Ds.text.toString():null;if(tr){var Xi=vo(tr,di),Ai=vo(tr,di,!0);if(Xi in Er&&Ai in Pr&&Er[Xi]!==Pr[Ai]){var Mo=Ns(Xi,Ai,di),ao=_o(Xi,Ai,Vr[Mo].geometry);delete Pr[Xi],delete Er[Ai],Er[vo(tr,Vr[ao].geometry,!0)]=ao,Vr[Mo].geometry=null}else Xi in Er?_o(Xi,Ai,di):Ai in Pr?Ns(Xi,Ai,di):(Cs(Kr),Pr[Xi]=Is-1,Er[Ai]=Is-1)}else Cs(Kr)}return Vr.filter((function(yr){return yr.geometry}))})(this.features)),this.sortFeaturesByKey&&this.features.sort((function(Dr,Pr){return Dr.sortKey-Pr.sortKey}))}},$i.prototype.update=function(a,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(a,c,this.layers,f))},$i.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},$i.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},$i.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},$i.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},$i.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},$i.prototype.addToLineVertexArray=function(a,c){var f=this.lineVertexArray.length;if(a.segment!==void 0){for(var v=a.dist(c[a.segment+1]),I=a.dist(c[a.segment]),A={},R=a.segment+1;R<c.length;R++)A[R]={x:c[R].x,y:c[R].y,tileUnitDistanceFromAnchor:v},R<c.length-1&&(v+=c[R+1].dist(c[R]));for(var N=a.segment||0;N>=0;N--)A[N]={x:c[N].x,y:c[N].y,tileUnitDistanceFromAnchor:I},N>0&&(I+=c[N-1].dist(c[N]));for(var Z=0;Z<c.length;Z++){var X=A[Z];this.lineVertexArray.emplaceBack(X.x,X.y,X.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}},$i.prototype.addSymbols=function(a,c,f,v,I,A,R,N,Z,X,Q,ne){for(var he=a.indexArray,xe=a.layoutVertexArray,Oe=a.segments.prepareSegment(4*c.length,xe,he,this.canOverlap?A.sortKey:void 0),De=this.glyphOffsetArray.length,Je=Oe.vertexLength,Xe=this.allowVerticalPlacement&&R===Fa.vertical?Math.PI/2:0,et=A.text&&A.text.sections,st=0;st<c.length;st++){var ot=c[st],ct=ot.tl,_t=ot.tr,Ft=ot.bl,zt=ot.br,gn=ot.tex,Jt=ot.pixelOffsetTL,bn=ot.pixelOffsetBR,Qt=ot.minFontScaleX,qn=ot.minFontScaleY,kn=ot.glyphOffset,cn=ot.isSDF,ri=ot.sectionIndex,Un=Oe.vertexLength,xi=kn[1];k1(xe,N.x,N.y,ct.x,xi+ct.y,gn.x,gn.y,f,cn,Jt.x,Jt.y,Qt,qn),k1(xe,N.x,N.y,_t.x,xi+_t.y,gn.x+gn.w,gn.y,f,cn,bn.x,Jt.y,Qt,qn),k1(xe,N.x,N.y,Ft.x,xi+Ft.y,gn.x,gn.y+gn.h,f,cn,Jt.x,bn.y,Qt,qn),k1(xe,N.x,N.y,zt.x,xi+zt.y,gn.x+gn.w,gn.y+gn.h,f,cn,bn.x,bn.y,Qt,qn),s2(a.dynamicLayoutVertexArray,N,Xe),he.emplaceBack(Un,Un+1,Un+2),he.emplaceBack(Un+1,Un+2,Un+3),Oe.vertexLength+=4,Oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kn[0]),st!==c.length-1&&ri===c[st+1].sectionIndex||a.programConfigurations.populatePaintArrays(xe.length,A,A.index,{},ne,et&&et[ri])}a.placedSymbolArray.emplaceBack(N.x,N.y,De,this.glyphOffsetArray.length-De,Je,Z,X,N.segment,f?f[0]:0,f?f[1]:0,v[0],v[1],R,0,!1,0,Q)},$i.prototype._addCollisionDebugVertex=function(a,c,f,v,I,A){return c.emplaceBack(0,0),a.emplaceBack(f.x,f.y,v,I,Math.round(A.x),Math.round(A.y))},$i.prototype.addCollisionDebugVertices=function(a,c,f,v,I,A,R){var N=I.segments.prepareSegment(4,I.layoutVertexArray,I.indexArray),Z=N.vertexLength,X=I.layoutVertexArray,Q=I.collisionVertexArray,ne=R.anchorX,he=R.anchorY;this._addCollisionDebugVertex(X,Q,A,ne,he,new d(a,c)),this._addCollisionDebugVertex(X,Q,A,ne,he,new d(f,c)),this._addCollisionDebugVertex(X,Q,A,ne,he,new d(f,v)),this._addCollisionDebugVertex(X,Q,A,ne,he,new d(a,v)),N.vertexLength+=4;var xe=I.indexArray;xe.emplaceBack(Z,Z+1),xe.emplaceBack(Z+1,Z+2),xe.emplaceBack(Z+2,Z+3),xe.emplaceBack(Z+3,Z),N.primitiveLength+=4},$i.prototype.addDebugCollisionBoxes=function(a,c,f,v){for(var I=a;I<c;I++){var A=this.collisionBoxArray.get(I);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,v?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,f)}},$i.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new D_(bd,lL.members,qf),this.iconCollisionBox=new D_(bd,lL.members,qf);for(var a=0;a<this.symbolInstances.length;a++){var c=this.symbolInstances.get(a);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}},$i.prototype._deserializeCollisionBoxesForSymbol=function(a,c,f,v,I,A,R,N,Z){for(var X={},Q=c;Q<f;Q++){var ne=a.get(Q);X.textBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},X.textFeatureIndex=ne.featureIndex;break}for(var he=v;he<I;he++){var xe=a.get(he);X.verticalTextBox={x1:xe.x1,y1:xe.y1,x2:xe.x2,y2:xe.y2,anchorPointX:xe.anchorPointX,anchorPointY:xe.anchorPointY},X.verticalTextFeatureIndex=xe.featureIndex;break}for(var Oe=A;Oe<R;Oe++){var De=a.get(Oe);X.iconBox={x1:De.x1,y1:De.y1,x2:De.x2,y2:De.y2,anchorPointX:De.anchorPointX,anchorPointY:De.anchorPointY},X.iconFeatureIndex=De.featureIndex;break}for(var Je=N;Je<Z;Je++){var Xe=a.get(Je);X.verticalIconBox={x1:Xe.x1,y1:Xe.y1,x2:Xe.x2,y2:Xe.y2,anchorPointX:Xe.anchorPointX,anchorPointY:Xe.anchorPointY},X.verticalIconFeatureIndex=Xe.featureIndex;break}return X},$i.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var c=0;c<this.symbolInstances.length;c++){var f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}},$i.prototype.hasTextData=function(){return this.text.segments.get().length>0},$i.prototype.hasIconData=function(){return this.icon.segments.get().length>0},$i.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},$i.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},$i.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},$i.prototype.addIndicesForPlacedSymbol=function(a,c){for(var f=a.placedSymbolArray.get(c),v=f.vertexStartIndex+4*f.numGlyphs,I=f.vertexStartIndex;I<v;I+=4)a.indexArray.emplaceBack(I,I+1,I+2),a.indexArray.emplaceBack(I+1,I+2,I+3)},$i.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var c=Math.sin(a),f=Math.cos(a),v=[],I=[],A=[],R=0;R<this.symbolInstances.length;++R){A.push(R);var N=this.symbolInstances.get(R);v.push(0|Math.round(c*N.anchorX+f*N.anchorY)),I.push(N.featureIndex)}return A.sort((function(Z,X){return v[Z]-v[X]||I[X]-I[Z]})),A},$i.prototype.addToSortKeyRanges=function(a,c){var f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:a,symbolInstanceEnd:a+1})},$i.prototype.sortFeatures=function(a){var c=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var f=0,v=this.symbolInstanceIndexes;f<v.length;f+=1){var I=this.symbolInstances.get(v[f]);this.featureSortOrder.push(I.featureIndex),[I.rightJustifiedTextSymbolIndex,I.centerJustifiedTextSymbolIndex,I.leftJustifiedTextSymbolIndex].forEach((function(A,R,N){A>=0&&N.indexOf(A)===R&&c.addIndicesForPlacedSymbol(c.text,A)})),I.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,I.verticalPlacedTextSymbolIndex),I.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,I.placedIconSymbolIndex),I.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,I.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},rn("SymbolBucket",$i,{omit:["layers","collisionBoxArray","features","compareText"]}),$i.MAX_GLYPHS=65535,$i.addDynamicAttributes=s2;var H8=new Ks({"symbol-placement":new _n(be.layout_symbol["symbol-placement"]),"symbol-spacing":new _n(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _n(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new un(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _n(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _n(be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _n(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new _n(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _n(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new un(be.layout_symbol["icon-size"]),"icon-text-fit":new _n(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _n(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new un(be.layout_symbol["icon-image"]),"icon-rotate":new un(be.layout_symbol["icon-rotate"]),"icon-padding":new _n(be.layout_symbol["icon-padding"]),"icon-keep-upright":new _n(be.layout_symbol["icon-keep-upright"]),"icon-offset":new un(be.layout_symbol["icon-offset"]),"icon-anchor":new un(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _n(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _n(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _n(be.layout_symbol["text-rotation-alignment"]),"text-field":new un(be.layout_symbol["text-field"]),"text-font":new un(be.layout_symbol["text-font"]),"text-size":new un(be.layout_symbol["text-size"]),"text-max-width":new un(be.layout_symbol["text-max-width"]),"text-line-height":new _n(be.layout_symbol["text-line-height"]),"text-letter-spacing":new un(be.layout_symbol["text-letter-spacing"]),"text-justify":new un(be.layout_symbol["text-justify"]),"text-radial-offset":new un(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _n(be.layout_symbol["text-variable-anchor"]),"text-anchor":new un(be.layout_symbol["text-anchor"]),"text-max-angle":new _n(be.layout_symbol["text-max-angle"]),"text-writing-mode":new _n(be.layout_symbol["text-writing-mode"]),"text-rotate":new un(be.layout_symbol["text-rotate"]),"text-padding":new _n(be.layout_symbol["text-padding"]),"text-keep-upright":new _n(be.layout_symbol["text-keep-upright"]),"text-transform":new un(be.layout_symbol["text-transform"]),"text-offset":new un(be.layout_symbol["text-offset"]),"text-allow-overlap":new _n(be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _n(be.layout_symbol["text-ignore-placement"]),"text-optional":new _n(be.layout_symbol["text-optional"])}),o2={paint:new Ks({"icon-opacity":new un(be.paint_symbol["icon-opacity"]),"icon-color":new un(be.paint_symbol["icon-color"]),"icon-halo-color":new un(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new un(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new un(be.paint_symbol["icon-halo-blur"]),"icon-translate":new _n(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new _n(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new un(be.paint_symbol["text-opacity"]),"text-color":new un(be.paint_symbol["text-color"],{runtimeType:Yt,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new un(be.paint_symbol["text-halo-color"]),"text-halo-width":new un(be.paint_symbol["text-halo-width"]),"text-halo-blur":new un(be.paint_symbol["text-halo-blur"]),"text-translate":new _n(be.paint_symbol["text-translate"]),"text-translate-anchor":new _n(be.paint_symbol["text-translate-anchor"])}),layout:H8},$g=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:tn,this.defaultValue=a};$g.prototype.evaluate=function(a){if(a.formattedSection){var c=this.defaultValue.property.overrides;if(c&&c.hasOverride(a.formattedSection))return c.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},$g.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},$g.prototype.outputDefined=function(){return!1},$g.prototype.serialize=function(){return null},rn("FormatSectionOverride",$g,{omit:["defaultValue"]});var K8=(function(a){function c(f){a.call(this,f,o2)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.recalculate=function(f,v){if(a.prototype.recalculate.call(this,f,v),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var I=this.layout.get("text-writing-mode");if(I){for(var A=[],R=0,N=I;R<N.length;R+=1){var Z=N[R];A.indexOf(Z)<0&&A.push(Z)}this.layout._values["text-writing-mode"]=A}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},c.prototype.getValueAndResolveTokens=function(f,v,I,A){var R=this.layout.get(f).evaluate(v,{},I,A),N=this._unevaluatedLayout._values[f];return N.isDataDriven()||Bf(N.value)||!R?R:(function(Z,X){return X.replace(/{([^{}]+)}/g,(function(Q,ne){return ne in Z?String(Z[ne]):""}))})(v.properties,R)},c.prototype.createBucket=function(f){return new $i(f)},c.prototype.queryRadius=function(){return 0},c.prototype.queryIntersectsFeature=function(){return!1},c.prototype._setPaintOverrides=function(){for(var f=0,v=o2.paint.overridableProperties;f<v.length;f+=1){var I=v[f];if(c.hasPaintOverride(this.layout,I)){var A,R=this.paint.get(I),N=new $g(R),Z=new fd(N,R.property.specification);A=R.value.kind==="constant"||R.value.kind==="source"?new Zf("source",Z):new pd("composite",Z,R.value.zoomStops,R.value._interpolationType),this.paint._values[I]=new po(R.property,A,R.parameters)}}},c.prototype._handleOverridablePaintPropertyUpdate=function(f,v,I){return!(!this.layout||v.isDataDriven()||I.isDataDriven())&&c.hasPaintOverride(this.layout,f)},c.hasPaintOverride=function(f,v){var I=f.get("text-field"),A=o2.paint.properties[v],R=!1,N=function(Q){for(var ne=0,he=Q;ne<he.length;ne+=1)if(A.overrides&&A.overrides.hasOverride(he[ne]))return void(R=!0)};if(I.value.kind==="constant"&&I.value.value instanceof Ls)N(I.value.value.sections);else if(I.value.kind==="source"){var Z=function(Q){R||(Q instanceof ho&&Yr(Q.value)===Kt?N(Q.value.sections):Q instanceof rl?N(Q.sections):Q.eachChild(Z))},X=I.value;X._styleExpression&&Z(X._styleExpression.expression)}return R},c})(Ol),j8={paint:new Ks({"background-color":new _n(be.paint_background["background-color"]),"background-pattern":new go(be.paint_background["background-pattern"]),"background-opacity":new _n(be.paint_background["background-opacity"])})},$8=(function(a){function c(f){a.call(this,f,j8)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c})(Ol),J8={paint:new Ks({"raster-opacity":new _n(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new _n(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _n(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _n(be.paint_raster["raster-brightness-max"]),"raster-saturation":new _n(be.paint_raster["raster-saturation"]),"raster-contrast":new _n(be.paint_raster["raster-contrast"]),"raster-resampling":new _n(be.paint_raster["raster-resampling"]),"raster-fade-duration":new _n(be.paint_raster["raster-fade-duration"])})},q8=(function(a){function c(f){a.call(this,f,J8)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c})(Ol),Q8=(function(a){function c(f){a.call(this,f,{}),this.implementation=f}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},c.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},c.prototype.recalculate=function(){},c.prototype.updateTransitions=function(){},c.prototype.hasTransition=function(){},c.prototype.serialize=function(){},c.prototype.onAdd=function(f){this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},c.prototype.onRemove=function(f){this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},c})(Ol),e6={circle:UA,heatmap:Nz,hillshade:Vz,fill:n8,"fill-extrusion":h8,line:y8,symbol:K8,background:$8,raster:q8},kL=y.HTMLImageElement,LL=y.HTMLCanvasElement,PL=y.HTMLVideoElement,GL=y.ImageData,L1=y.ImageBitmap,rp=function(a,c,f,v){this.context=a,this.format=f,this.texture=a.gl.createTexture(),this.update(c,v)};rp.prototype.update=function(a,c,f){var v=a.width,I=a.height,A=!(this.size&&this.size[0]===v&&this.size[1]===I||f),R=this.context,N=R.gl;if(this.useMipmap=!!(c&&c.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!c||c.premultiply!==!1)),A)this.size=[v,I],a instanceof kL||a instanceof LL||a instanceof PL||a instanceof GL||L1&&a instanceof L1?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,a):N.texImage2D(N.TEXTURE_2D,0,this.format,v,I,0,this.format,N.UNSIGNED_BYTE,a.data);else{var Z=f||{x:0,y:0},X=Z.x,Q=Z.y;a instanceof kL||a instanceof LL||a instanceof PL||a instanceof GL||L1&&a instanceof L1?N.texSubImage2D(N.TEXTURE_2D,0,X,Q,N.RGBA,N.UNSIGNED_BYTE,a):N.texSubImage2D(N.TEXTURE_2D,0,X,Q,v,I,N.RGBA,N.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)},rp.prototype.bind=function(a,c,f){var v=this.context.gl;v.bindTexture(v.TEXTURE_2D,this.texture),f!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=v.LINEAR),a!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,a),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,f||a),this.filter=a),c!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,c),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,c),this.wrap=c)},rp.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},rp.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var a2=function(a){var c=this;this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){c._triggered=!1,c._callback()})};a2.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){a._triggered=!1,a._callback()}),0))},a2.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Jg=function(a,c,f){this.target=a,this.parent=c,this.mapId=f,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},H(["receive","process"],this),this.invoker=new a2(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ue()?a:y};function FL(a,c,f){var v=2*Math.PI*6378137/256/Math.pow(2,f);return[a*v-2*Math.PI*6378137/2,c*v-2*Math.PI*6378137/2]}Jg.prototype.send=function(a,c,f,v,I){var A=this;I===void 0&&(I=!1);var R=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(this.callbacks[R]=f);var N=Ee(this.globalScope)?void 0:[];return this.target.postMessage({id:R,type:a,hasCallback:!!f,targetMapId:v,mustQueue:I,sourceMapId:this.mapId,data:ol(c,N)},N),{cancel:function(){f&&delete A.callbacks[R],A.target.postMessage({id:R,type:"<cancel>",targetMapId:v,sourceMapId:A.mapId})}}},Jg.prototype.receive=function(a){var c=a.data,f=c.id;if(f&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){delete this.tasks[f];var v=this.cancelCallbacks[f];delete this.cancelCallbacks[f],v&&v()}else ue()||c.mustQueue?(this.tasks[f]=c,this.taskQueue.push(f),this.invoker.trigger()):this.processTask(f,c)},Jg.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),c=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),c&&this.processTask(a,c)}},Jg.prototype.processTask=function(a,c){var f=this;if(c.type==="<response>"){var v=this.callbacks[a];delete this.callbacks[a],v&&(c.error?v(zo(c.error)):v(null,zo(c.data)))}else{var I=!1,A=Ee(this.globalScope)?void 0:[],R=c.hasCallback?function(Q,ne){I=!0,delete f.cancelCallbacks[a],f.target.postMessage({id:a,type:"<response>",sourceMapId:f.mapId,error:Q?ol(Q):null,data:ol(ne,A)},A)}:function(Q){I=!0},N=null,Z=zo(c.data);if(this.parent[c.type])N=this.parent[c.type](c.sourceMapId,Z,R);else if(this.parent.getWorkerSource){var X=c.type.split(".");N=this.parent.getWorkerSource(c.sourceMapId,X[0],Z.source)[X[1]](Z,R)}else R(new Error("Could not find function "+c.type));!I&&N&&N.cancel&&(this.cancelCallbacks[a]=N.cancel)}},Jg.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var ls=function(a,c){a&&(c?this.setSouthWest(a).setNorthEast(c):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};ls.prototype.setNorthEast=function(a){return this._ne=a instanceof Ar?new Ar(a.lng,a.lat):Ar.convert(a),this},ls.prototype.setSouthWest=function(a){return this._sw=a instanceof Ar?new Ar(a.lng,a.lat):Ar.convert(a),this},ls.prototype.extend=function(a){var c,f,v=this._sw,I=this._ne;if(a instanceof Ar)c=a,f=a;else{if(!(a instanceof ls))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(ls.convert(a)):this.extend(Ar.convert(a)):this;if(f=a._ne,!(c=a._sw)||!f)return this}return v||I?(v.lng=Math.min(c.lng,v.lng),v.lat=Math.min(c.lat,v.lat),I.lng=Math.max(f.lng,I.lng),I.lat=Math.max(f.lat,I.lat)):(this._sw=new Ar(c.lng,c.lat),this._ne=new Ar(f.lng,f.lat)),this},ls.prototype.getCenter=function(){return new Ar((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ls.prototype.getSouthWest=function(){return this._sw},ls.prototype.getNorthEast=function(){return this._ne},ls.prototype.getNorthWest=function(){return new Ar(this.getWest(),this.getNorth())},ls.prototype.getSouthEast=function(){return new Ar(this.getEast(),this.getSouth())},ls.prototype.getWest=function(){return this._sw.lng},ls.prototype.getSouth=function(){return this._sw.lat},ls.prototype.getEast=function(){return this._ne.lng},ls.prototype.getNorth=function(){return this._ne.lat},ls.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ls.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ls.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ls.prototype.contains=function(a){var c=Ar.convert(a),f=c.lng,v=c.lat,I=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(I=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=v&&v<=this._ne.lat&&I},ls.convert=function(a){return!a||a instanceof ls?a:new ls(a)};var Ar=function(a,c){if(isNaN(a)||isNaN(c))throw new Error("Invalid LngLat object: ("+a+", "+c+")");if(this.lng=+a,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ar.prototype.wrap=function(){return new Ar(T(this.lng,-180,180),this.lat)},Ar.prototype.toArray=function(){return[this.lng,this.lat]},Ar.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ar.prototype.distanceTo=function(a){var c=Math.PI/180,f=this.lat*c,v=a.lat*c,I=Math.sin(f)*Math.sin(v)+Math.cos(f)*Math.cos(v)*Math.cos((a.lng-this.lng)*c);return 63710088e-1*Math.acos(Math.min(I,1))},Ar.prototype.toBounds=function(a){a===void 0&&(a=0);var c=360*a/40075017,f=c/Math.cos(Math.PI/180*this.lat);return new ls(new Ar(this.lng-f,this.lat-c),new Ar(this.lng+f,this.lat+c))},Ar.convert=function(a){if(a instanceof Ar)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Ar(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Ar(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var OL=2*Math.PI*63710088e-1;function NL(a){return OL*Math.cos(a*Math.PI/180)}function DL(a){return(180+a)/360}function VL(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function BL(a,c){return a/NL(c)}function l2(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var sp=function(a,c,f){f===void 0&&(f=0),this.x=+a,this.y=+c,this.z=+f};sp.fromLngLat=function(a,c){c===void 0&&(c=0);var f=Ar.convert(a);return new sp(DL(f.lng),VL(f.lat),BL(c,f.lat))},sp.prototype.toLngLat=function(){return new Ar(360*this.x-180,l2(this.y))},sp.prototype.toAltitude=function(){return this.z*NL(l2(this.y))},sp.prototype.meterInMercatorCoordinateUnits=function(){return 1/OL*(a=l2(this.y),1/Math.cos(a*Math.PI/180));var a};var op=function(a,c,f){this.z=a,this.x=c,this.y=f,this.key=V_(0,a,a,c,f)};op.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},op.prototype.url=function(a,c){var f,v,I,A,R,N=(v=this.y,I=this.z,A=FL(256*(f=this.x),256*(v=Math.pow(2,I)-v-1),I),R=FL(256*(f+1),256*(v+1),I),A[0]+","+A[1]+","+R[0]+","+R[1]),Z=(function(X,Q,ne){for(var he,xe="",Oe=X;Oe>0;Oe--)xe+=(Q&(he=1<<Oe-1)?1:0)+(ne&he?2:0);return xe})(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",Z).replace("{bbox-epsg-3857}",N)},op.prototype.getTilePoint=function(a){var c=Math.pow(2,this.z);return new d(8192*(a.x*c-this.x),8192*(a.y*c-this.y))},op.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var ZL=function(a,c){this.wrap=a,this.canonical=c,this.key=V_(a,c.z,c.z,c.x,c.y)},us=function(a,c,f,v,I){this.overscaledZ=a,this.wrap=c,this.canonical=new op(f,+v,+I),this.key=V_(c,a,f,v,I)};function V_(a,c,f,v,I){(a*=2)<0&&(a=-1*a-1);var A=1<<f;return(A*A*a+A*I+v).toString(36)+f.toString(36)+c.toString(36)}us.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},us.prototype.scaledTo=function(a){var c=this.canonical.z-a;return a>this.canonical.z?new us(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new us(a,this.wrap,a,this.canonical.x>>c,this.canonical.y>>c)},us.prototype.calculateScaledKey=function(a,c){var f=this.canonical.z-a;return a>this.canonical.z?V_(this.wrap*+c,a,this.canonical.z,this.canonical.x,this.canonical.y):V_(this.wrap*+c,a,a,this.canonical.x>>f,this.canonical.y>>f)},us.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var c=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>c&&a.canonical.y===this.canonical.y>>c},us.prototype.children=function(a){if(this.overscaledZ>=a)return[new us(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var c=this.canonical.z+1,f=2*this.canonical.x,v=2*this.canonical.y;return[new us(c,this.wrap,c,f,v),new us(c,this.wrap,c,f+1,v),new us(c,this.wrap,c,f,v+1),new us(c,this.wrap,c,f+1,v+1)]},us.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},us.prototype.wrapped=function(){return new us(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},us.prototype.unwrapTo=function(a){return new us(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},us.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},us.prototype.toUnwrapped=function(){return new ZL(this.wrap,this.canonical)},us.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},us.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new sp(a.x-this.wrap,a.y))},rn("CanonicalTileID",op),rn("OverscaledTileID",us,{omit:["posMatrix"]});var hh=function(a,c,f){if(this.uid=a,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return de('"'+f+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=c.height;var v=this.dim=c.height-2;this.data=new Uint32Array(c.data.buffer),this.encoding=f||"mapbox";for(var I=0;I<v;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(v,I)]=this.data[this._idx(v-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,v)]=this.data[this._idx(I,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)]};hh.prototype.get=function(a,c){var f=new Uint8Array(this.data.buffer),v=4*this._idx(a,c);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[v],f[v+1],f[v+2])},hh.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},hh.prototype._idx=function(a,c){if(a<-1||a>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(a+1)},hh.prototype._unpackMapbox=function(a,c,f){return(256*a*256+256*c+f)/10-1e4},hh.prototype._unpackTerrarium=function(a,c,f){return 256*a+c+f/256-32768},hh.prototype.getPixels=function(){return new Ko({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},hh.prototype.backfillBorder=function(a,c,f){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var v=c*this.dim,I=c*this.dim+this.dim,A=f*this.dim,R=f*this.dim+this.dim;switch(c){case-1:v=I-1;break;case 1:I=v+1}switch(f){case-1:A=R-1;break;case 1:R=A+1}for(var N=-c*this.dim,Z=-f*this.dim,X=A;X<R;X++)for(var Q=v;Q<I;Q++)this.data[this._idx(Q,X)]=a.data[this._idx(Q+N,X+Z)]},rn("DEMData",hh);var P1=function(a){this._stringToNumber={},this._numberToString=[];for(var c=0;c<a.length;c++){var f=a[c];this._stringToNumber[f]=c,this._numberToString[c]=f}};P1.prototype.encode=function(a){return this._stringToNumber[a]},P1.prototype.decode=function(a){return this._numberToString[a]};var G1=function(a,c,f,v,I){this.type="Feature",this._vectorTileFeature=a,a._z=c,a._x=f,a._y=v,this.properties=a.properties,this.id=I},u2={geometry:{configurable:!0}};u2.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},u2.geometry.set=function(a){this._geometry=a},G1.prototype.toJSON=function(){var a={geometry:this.geometry};for(var c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(a[c]=this[c]);return a},Object.defineProperties(G1.prototype,u2);var qg=function(){this.state={},this.stateChanges={},this.deletedStates={}};qg.prototype.updateState=function(a,c,f){var v=String(c);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][v]=this.stateChanges[a][v]||{},k(this.stateChanges[a][v],f),this.deletedStates[a]===null)for(var I in this.deletedStates[a]={},this.state[a])I!==v&&(this.deletedStates[a][I]=null);else if(this.deletedStates[a]&&this.deletedStates[a][v]===null)for(var A in this.deletedStates[a][v]={},this.state[a][v])f[A]||(this.deletedStates[a][v][A]=null);else for(var R in f)this.deletedStates[a]&&this.deletedStates[a][v]&&this.deletedStates[a][v][R]===null&&delete this.deletedStates[a][v][R]},qg.prototype.removeFeatureState=function(a,c,f){if(this.deletedStates[a]!==null){var v=String(c);if(this.deletedStates[a]=this.deletedStates[a]||{},f&&c!==void 0)this.deletedStates[a][v]!==null&&(this.deletedStates[a][v]=this.deletedStates[a][v]||{},this.deletedStates[a][v][f]=null);else if(c!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][v])for(f in this.deletedStates[a][v]={},this.stateChanges[a][v])this.deletedStates[a][v][f]=null;else this.deletedStates[a][v]=null;else this.deletedStates[a]=null}},qg.prototype.getState=function(a,c){var f=String(c),v=k({},(this.state[a]||{})[f],(this.stateChanges[a]||{})[f]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var I=this.deletedStates[a][c];if(I===null)return{};for(var A in I)delete v[A]}return v},qg.prototype.initializeTileState=function(a,c){a.setFeatureState(this.state,c)},qg.prototype.coalesceChanges=function(a,c){var f={};for(var v in this.stateChanges){this.state[v]=this.state[v]||{};var I={};for(var A in this.stateChanges[v])this.state[v][A]||(this.state[v][A]={}),k(this.state[v][A],this.stateChanges[v][A]),I[A]=this.state[v][A];f[v]=I}for(var R in this.deletedStates){this.state[R]=this.state[R]||{};var N={};if(this.deletedStates[R]===null)for(var Z in this.state[R])N[Z]={},this.state[R][Z]={};else for(var X in this.deletedStates[R]){if(this.deletedStates[R][X]===null)this.state[R][X]={};else for(var Q=0,ne=Object.keys(this.deletedStates[R][X]);Q<ne.length;Q+=1)delete this.state[R][X][ne[Q]];N[X]=this.state[R][X]}f[R]=f[R]||{},k(f[R],N)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(var he in a)a[he].setFeatureState(f,c)};var dh=function(a,c){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new ou(8192,16,0),this.grid3D=new ou(8192,16,0),this.featureIndexArray=new re,this.promoteId=c};function WL(a,c,f,v,I){return $(a,(function(A,R){var N=c instanceof $f?c.get(R):null;return N&&N.evaluate?N.evaluate(f,v,I):N}))}function zL(a){for(var c=1/0,f=1/0,v=-1/0,I=-1/0,A=0,R=a;A<R.length;A+=1){var N=R[A];c=Math.min(c,N.x),f=Math.min(f,N.y),v=Math.max(v,N.x),I=Math.max(I,N.y)}return{minX:c,minY:f,maxX:v,maxY:I}}function t6(a,c){return c-a}dh.prototype.insert=function(a,c,f,v,I,A){var R=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,v,I);for(var N=A?this.grid3D:this.grid,Z=0;Z<c.length;Z++){for(var X=c[Z],Q=[1/0,1/0,-1/0,-1/0],ne=0;ne<X.length;ne++){var he=X[ne];Q[0]=Math.min(Q[0],he.x),Q[1]=Math.min(Q[1],he.y),Q[2]=Math.max(Q[2],he.x),Q[3]=Math.max(Q[3],he.y)}Q[0]<8192&&Q[1]<8192&&Q[2]>=0&&Q[3]>=0&&N.insert(R,Q[0],Q[1],Q[2],Q[3])}},dh.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Wg.VectorTile(new I1(this.rawTileData)).layers,this.sourceLayerCoder=new P1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},dh.prototype.query=function(a,c,f,v){var I=this;this.loadVTLayers();for(var A=a.params||{},R=8192/a.tileSize/a.scale,N=Ag(A.filter),Z=a.queryGeometry,X=a.queryPadding*R,Q=zL(Z),ne=this.grid.query(Q.minX-X,Q.minY-X,Q.maxX+X,Q.maxY+X),he=zL(a.cameraQueryGeometry),xe=this.grid3D.query(he.minX-X,he.minY-X,he.maxX+X,he.maxY+X,(function(ot,ct,_t,Ft){return(function(zt,gn,Jt,bn,Qt){for(var qn=0,kn=zt;qn<kn.length;qn+=1){var cn=kn[qn];if(gn<=cn.x&&Jt<=cn.y&&bn>=cn.x&&Qt>=cn.y)return!0}var ri=[new d(gn,Jt),new d(gn,Qt),new d(bn,Qt),new d(bn,Jt)];if(zt.length>2){for(var Un=0,xi=ri;Un<xi.length;Un+=1)if(Dl(zt,xi[Un]))return!0}for(var xn=0;xn<zt.length-1;xn++)if(tp(zt[xn],zt[xn+1],ri))return!0;return!1})(a.cameraQueryGeometry,ot-X,ct-X,_t+X,Ft+X)})),Oe=0,De=xe;Oe<De.length;Oe+=1)ne.push(De[Oe]);ne.sort(t6);for(var Je,Xe={},et=function(ot){var ct=ne[ot];if(ct!==Je){Je=ct;var _t=I.featureIndexArray.get(ct),Ft=null;I.loadMatchingFeature(Xe,_t.bucketIndex,_t.sourceLayerIndex,_t.featureIndex,N,A.layers,A.availableImages,c,f,v,(function(zt,gn,Jt){return Ft||(Ft=Lr(zt)),gn.queryIntersectsFeature(Z,zt,Jt,Ft,I.z,a.transform,R,a.pixelPosMatrix)}))}},st=0;st<ne.length;st++)et(st);return Xe},dh.prototype.loadMatchingFeature=function(a,c,f,v,I,A,R,N,Z,X,Q){var ne=this.bucketLayerIDs[c];if(!A||(function(zt,gn){for(var Jt=0;Jt<zt.length;Jt++)if(gn.indexOf(zt[Jt])>=0)return!0;return!1})(A,ne)){var he=this.sourceLayerCoder.decode(f),xe=this.vtLayers[he].feature(v);if(I.needGeometry){var Oe=Hr(xe,!0);if(!I.filter(new ui(this.tileID.overscaledZ),Oe,this.tileID.canonical))return}else if(!I.filter(new ui(this.tileID.overscaledZ),xe))return;for(var De=this.getId(xe,he),Je=0;Je<ne.length;Je++){var Xe=ne[Je];if(!(A&&A.indexOf(Xe)<0)){var et=N[Xe];if(et){var st={};De!==void 0&&X&&(st=X.getState(et.sourceLayer||"_geojsonTileLayer",De));var ot=k({},Z[Xe]);ot.paint=WL(ot.paint,et.paint,xe,st,R),ot.layout=WL(ot.layout,et.layout,xe,st,R);var ct=!Q||Q(xe,et,st);if(ct){var _t=new G1(xe,this.z,this.x,this.y,De);_t.layer=ot;var Ft=a[Xe];Ft===void 0&&(Ft=a[Xe]=[]),Ft.push({featureIndex:v,feature:_t,intersectionZ:ct})}}}}}},dh.prototype.lookupSymbolFeatures=function(a,c,f,v,I,A,R,N){var Z={};this.loadVTLayers();for(var X=Ag(I),Q=0,ne=a;Q<ne.length;Q+=1)this.loadMatchingFeature(Z,f,v,ne[Q],X,A,R,N,c);return Z},dh.prototype.hasLayer=function(a){for(var c=0,f=this.bucketLayerIDs;c<f.length;c+=1)for(var v=0,I=f[c];v<I.length;v+=1)if(a===I[v])return!0;return!1},dh.prototype.getId=function(a,c){var f=a.id;return this.promoteId&&typeof(f=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]])=="boolean"&&(f=Number(f)),f},rn("FeatureIndex",dh,{omit:["rawTileData","sourceLayerCoder"]});var Os=function(a,c){this.tileID=a,this.uid=O(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Os.prototype.registerFadeDuration=function(a){var c=a+this.timeAdded;c<Et.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)},Os.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Os.prototype.loadVectorData=function(a,c,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var v in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=(function(X,Q){var ne={};if(!Q)return ne;for(var he=function(){var De=Oe[xe],Je=De.layerIds.map((function(st){return Q.getLayer(st)})).filter(Boolean);if(Je.length!==0){De.layers=Je,De.stateDependentLayerIds&&(De.stateDependentLayers=De.stateDependentLayerIds.map((function(st){return Je.filter((function(ot){return ot.id===st}))[0]})));for(var Xe=0,et=Je;Xe<et.length;Xe+=1)ne[et[Xe].id]=De}},xe=0,Oe=X;xe<Oe.length;xe+=1)he();return ne})(a.buckets,c.style),this.hasSymbolBuckets=!1,this.buckets){var I=this.buckets[v];if(I instanceof $i){if(this.hasSymbolBuckets=!0,!f)break;I.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var A in this.buckets){var R=this.buckets[A];if(R instanceof $i&&R.hasRTLText){this.hasRTLText=!0,fa.isLoading()||fa.isLoaded()||I_()!=="deferred"||al();break}}for(var N in this.queryPadding=0,this.buckets){var Z=this.buckets[N];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(N).queryRadius(Z))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new _},Os.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Os.prototype.getBucket=function(a){return this.buckets[a.id]},Os.prototype.upload=function(a){for(var c in this.buckets){var f=this.buckets[c];f.uploadPending()&&f.upload(a)}var v=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new rp(a,this.imageAtlas.image,v.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new rp(a,this.glyphAtlasImage,v.ALPHA),this.glyphAtlasImage=null)},Os.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},Os.prototype.queryRenderedFeatures=function(a,c,f,v,I,A,R,N,Z,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:I,scale:A,tileSize:this.tileSize,pixelPosMatrix:X,transform:N,params:R,queryPadding:this.queryPadding*Z},a,c,f):{}},Os.prototype.querySourceFeatures=function(a,c){var f=this.latestFeatureIndex;if(f&&f.rawTileData){var v=f.loadVTLayers(),I=c?c.sourceLayer:"",A=v._geojsonTileLayer||v[I];if(A)for(var R=Ag(c&&c.filter),N=this.tileID.canonical,Z=N.z,X=N.x,Q=N.y,ne={z:Z,x:X,y:Q},he=0;he<A.length;he++){var xe=A.feature(he);if(R.needGeometry){var Oe=Hr(xe,!0);if(!R.filter(new ui(this.tileID.overscaledZ),Oe,this.tileID.canonical))continue}else if(!R.filter(new ui(this.tileID.overscaledZ),xe))continue;var De=f.getId(xe,I),Je=new G1(xe,Z,X,Q,De);Je.tile=ne,a.push(Je)}}},Os.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Os.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Os.prototype.setExpiryData=function(a){var c=this.expirationTime;if(a.cacheControl){var f=ge(a.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var v=Date.now(),I=!1;if(this.expirationTime>v)I=!1;else if(c)if(this.expirationTime<c)I=!0;else{var A=this.expirationTime-c;A?this.expirationTime=v+Math.max(A,3e4):I=!0}else I=!0;I?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Os.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Os.prototype.setFeatureState=function(a,c){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var f=this.latestFeatureIndex.loadVTLayers();for(var v in this.buckets)if(c.style.hasLayer(v)){var I=this.buckets[v],A=I.layers[0].sourceLayer||"_geojsonTileLayer",R=f[A],N=a[A];if(R&&N&&Object.keys(N).length!==0){I.update(N,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});var Z=c&&c.style&&c.style.getLayer(v);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(I)))}}}},Os.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Os.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Et.now()},Os.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Os.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Et.now()+a},Os.prototype.setDependencies=function(a,c){for(var f={},v=0,I=c;v<I.length;v+=1)f[I[v]]=!0;this.dependencies[a]=f},Os.prototype.hasDependency=function(a,c){for(var f=0,v=a;f<v.length;f+=1){var I=this.dependencies[v[f]];if(I){for(var A=0,R=c;A<R.length;A+=1)if(I[R[A]])return!0}}return!1};var Ad=y.performance,UL=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Ad.mark(this._marks.start)};UL.prototype.finish=function(){Ad.mark(this._marks.end);var a=Ad.getEntriesByName(this._marks.measure);return a.length===0&&(Ad.measure(this._marks.measure,this._marks.start,this._marks.end),a=Ad.getEntriesByName(this._marks.measure),Ad.clearMarks(this._marks.start),Ad.clearMarks(this._marks.end),Ad.clearMeasures(this._marks.measure)),a},s.Actor=Jg,s.AlphaImage=ip,s.CanonicalTileID=op,s.CollisionBoxArray=_,s.Color=Ci,s.DEMData=hh,s.DataConstantProperty=_n,s.DictionaryCoder=P1,s.EXTENT=8192,s.ErrorEvent=$e,s.EvaluationParameters=ui,s.Event=Me,s.Evented=Ye,s.FeatureIndex=dh,s.FillBucket=cu,s.FillExtrusionBucket=hu,s.ImageAtlas=N_,s.ImagePosition=w1,s.LineBucket=Ro,s.LngLat=Ar,s.LngLatBounds=ls,s.MercatorCoordinate=sp,s.ONE_EM=24,s.OverscaledTileID=us,s.Point=d,s.Point$1=d,s.Properties=Ks,s.Protobuf=I1,s.RGBAImage=Ko,s.RequestManager=Ze,s.RequestPerformance=UL,s.ResourceType=Ao,s.SegmentVector=we,s.SourceFeatureState=qg,s.StructArrayLayout1ui2=T_,s.StructArrayLayout2f1f2i16=ah,s.StructArrayLayout2i4=oh,s.StructArrayLayout3ui6=ec,s.StructArrayLayout4i8=w_,s.SymbolBucket=$i,s.Texture=rp,s.Tile=Os,s.Transitionable=Hs,s.Uniform1f=Vt,s.Uniform1i=wt,s.Uniform2f=Ot,s.Uniform3f=en,s.Uniform4f=vn,s.UniformColor=Cn,s.UniformMatrix4f=wi,s.UnwrappedTileID=ZL,s.ValidationError=ke,s.WritingMode=Fa,s.ZoomHistory=__,s.add=function(a,c,f){return a[0]=c[0]+f[0],a[1]=c[1]+f[1],a[2]=c[2]+f[2],a},s.addDynamicAttributes=s2,s.asyncAll=function(a,c,f){if(!a.length)return f(null,[]);var v=a.length,I=new Array(a.length),A=null;a.forEach((function(R,N){c(R,(function(Z,X){Z&&(A=Z),I[N]=X,--v==0&&f(A,I)}))}))},s.bezier=C,s.bindAll=H,s.browser=Et,s.cacheEntryPossiblyAdded=function(a){++Mi>Mr&&(a.getActor().send("enforceCacheSizeLimit",Pi),Mi=0)},s.clamp=E,s.clearTileCache=function(a){var c=y.caches.delete("mapbox-tiles");a&&c.catch(a).then((function(){return a()}))},s.clipLine=AL,s.clone=function(a){var c=new Fi(16);return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},s.clone$1=fe,s.clone$2=function(a){var c=new Fi(3);return c[0]=a[0],c[1]=a[1],c[2]=a[2],c},s.collisionCircleLayout=x8,s.config=kt,s.create=function(){var a=new Fi(16);return Fi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},s.create$1=function(){var a=new Fi(9);return Fi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},s.create$2=function(){var a=new Fi(4);return Fi!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},s.createCommonjsModule=l,s.createExpression=Cg,s.createLayout=Gs,s.createStyleLayer=function(a){return a.type==="custom"?new Q8(a):new e6[a.type](a)},s.cross=function(a,c,f){var v=c[0],I=c[1],A=c[2],R=f[0],N=f[1],Z=f[2];return a[0]=I*Z-A*N,a[1]=A*R-v*Z,a[2]=v*N-I*R,a},s.deepEqual=function a(c,f){if(Array.isArray(c)){if(!Array.isArray(f)||c.length!==f.length)return!1;for(var v=0;v<c.length;v++)if(!a(c[v],f[v]))return!1;return!0}if(typeof c=="object"&&c!==null&&f!==null){if(typeof f!="object"||Object.keys(c).length!==Object.keys(f).length)return!1;for(var I in c)if(!a(c[I],f[I]))return!1;return!0}return c===f},s.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]},s.dot$1=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]},s.ease=w,s.emitValidationErrors=Hf,s.endsWith=te,s.enforceCacheSizeLimit=function(a){_i(),tt&&tt.then((function(c){c.keys().then((function(f){for(var v=0;v<f.length-a;v++)c.delete(f[v])}))}))},s.evaluateSizeForFeature=vL,s.evaluateSizeForZoom=bL,s.evaluateVariableOffset=TL,s.evented=x_,s.extend=k,s.featureFilter=Ag,s.filterObject=ae,s.fromRotation=function(a,c){var f=Math.sin(c),v=Math.cos(c);return a[0]=v,a[1]=f,a[2]=0,a[3]=-f,a[4]=v,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},s.getAnchorAlignment=t2,s.getAnchorJustification=r2,s.getArrayBuffer=Pl,s.getImage=le,s.getJSON=function(a,c){return vs(k(a,{type:"json"}),c)},s.getRTLTextPluginStatus=I_,s.getReferrer=_s,s.getVideo=function(a,c){var f,v,I=y.document.createElement("video");I.muted=!0,I.onloadstart=function(){c(null,I)};for(var A=0;A<a.length;A++){var R=y.document.createElement("source");f=a[A],v=void 0,(v=y.document.createElement("a")).href=f,(v.protocol!==y.document.location.protocol||v.host!==y.document.location.host)&&(I.crossOrigin="Anonymous"),R.src=a[A],I.appendChild(R)}return{cancel:function(){}}},s.identity=pa,s.invert=function(a,c){var f=c[0],v=c[1],I=c[2],A=c[3],R=c[4],N=c[5],Z=c[6],X=c[7],Q=c[8],ne=c[9],he=c[10],xe=c[11],Oe=c[12],De=c[13],Je=c[14],Xe=c[15],et=f*N-v*R,st=f*Z-I*R,ot=f*X-A*R,ct=v*Z-I*N,_t=v*X-A*N,Ft=I*X-A*Z,zt=Q*De-ne*Oe,gn=Q*Je-he*Oe,Jt=Q*Xe-xe*Oe,bn=ne*Je-he*De,Qt=ne*Xe-xe*De,qn=he*Xe-xe*Je,kn=et*qn-st*Qt+ot*bn+ct*Jt-_t*gn+Ft*zt;return kn?(a[0]=(N*qn-Z*Qt+X*bn)*(kn=1/kn),a[1]=(I*Qt-v*qn-A*bn)*kn,a[2]=(De*Ft-Je*_t+Xe*ct)*kn,a[3]=(he*_t-ne*Ft-xe*ct)*kn,a[4]=(Z*Jt-R*qn-X*gn)*kn,a[5]=(f*qn-I*Jt+A*gn)*kn,a[6]=(Je*ot-Oe*Ft-Xe*st)*kn,a[7]=(Q*Ft-he*ot+xe*st)*kn,a[8]=(R*Qt-N*Jt+X*zt)*kn,a[9]=(v*Jt-f*Qt-A*zt)*kn,a[10]=(Oe*_t-De*ot+Xe*et)*kn,a[11]=(ne*ot-Q*_t-xe*et)*kn,a[12]=(N*gn-R*bn-Z*zt)*kn,a[13]=(f*bn-v*gn+I*zt)*kn,a[14]=(De*st-Oe*ct-Je*et)*kn,a[15]=(Q*ct-ne*st+he*et)*kn,a):null},s.isChar=Ht,s.isMapboxURL=Re,s.keysDifference=function(a,c){var f=[];for(var v in a)v in c||f.push(v);return f},s.makeRequest=vs,s.mapObject=$,s.mercatorXfromLng=DL,s.mercatorYfromLat=VL,s.mercatorZfromAltitude=BL,s.mul=zA,s.multiply=To,s.mvt=Wg,s.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},s.normalize=function(a,c){var f=c[0],v=c[1],I=c[2],A=f*f+v*v+I*I;return A>0&&(A=1/Math.sqrt(A)),a[0]=c[0]*A,a[1]=c[1]*A,a[2]=c[2]*A,a},s.number=ts,s.offscreenCanvasSupported=zs,s.ortho=function(a,c,f,v,I,A,R){var N=1/(c-f),Z=1/(v-I),X=1/(A-R);return a[0]=-2*N,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*Z,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*X,a[11]=0,a[12]=(c+f)*N,a[13]=(I+v)*Z,a[14]=(R+A)*X,a[15]=1,a},s.parseGlyphPBF=function(a){return new I1(a).readFields(L8,[])},s.pbf=I1,s.performSymbolLayout=function(a,c,f,v,I,A,R){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var N=a.layers[0].layout,Z=a.layers[0]._unevaluatedLayout._values,X={};if(a.textSizeData.kind==="composite"){var Q=a.textSizeData,ne=Q.maxZoom;X.compositeTextSizes=[Z["text-size"].possiblyEvaluate(new ui(Q.minZoom),R),Z["text-size"].possiblyEvaluate(new ui(ne),R)]}if(a.iconSizeData.kind==="composite"){var he=a.iconSizeData,xe=he.maxZoom;X.compositeIconSizes=[Z["icon-size"].possiblyEvaluate(new ui(he.minZoom),R),Z["icon-size"].possiblyEvaluate(new ui(xe),R)]}X.layoutTextSize=Z["text-size"].possiblyEvaluate(new ui(a.zoom+1),R),X.layoutIconSize=Z["icon-size"].possiblyEvaluate(new ui(a.zoom+1),R),X.textMaxSize=Z["text-size"].possiblyEvaluate(new ui(18));for(var Oe=24*N.get("text-line-height"),De=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Je=N.get("text-keep-upright"),Xe=N.get("text-size"),et=function(){var ct=ot[st],_t=N.get("text-font").evaluate(ct,{},R).join(","),Ft=Xe.evaluate(ct,{},R),zt=X.layoutTextSize.evaluate(ct,{},R),gn=X.layoutIconSize.evaluate(ct,{},R),Jt={horizontal:{},vertical:void 0},bn=ct.text,Qt=[0,0];if(bn){var qn=bn.toString(),kn=24*N.get("text-letter-spacing").evaluate(ct,{},R),cn=(function(di){for(var tr=0,Xi=di;tr<Xi.length;tr+=1)if(Ai=Xi[tr].charCodeAt(0),Ht.Arabic(Ai)||Ht["Arabic Supplement"](Ai)||Ht["Arabic Extended-A"](Ai)||Ht["Arabic Presentation Forms-A"](Ai)||Ht["Arabic Presentation Forms-B"](Ai))return!1;var Ai;return!0})(qn)?kn:0,ri=N.get("text-anchor").evaluate(ct,{},R),Un=N.get("text-variable-anchor");if(!Un){var xi=N.get("text-radial-offset").evaluate(ct,{},R);Qt=xi?TL(ri,[24*xi,i2]):N.get("text-offset").evaluate(ct,{},R).map((function(di){return 24*di}))}var xn=De?"center":N.get("text-justify").evaluate(ct,{},R),ki=N.get("symbol-placement"),Sr=ki==="point"?24*N.get("text-max-width").evaluate(ct,{},R):0,Dr=function(){a.allowVerticalPlacement&&v_(qn)&&(Jt.vertical=A1(bn,c,f,I,_t,Sr,Oe,ri,"left",cn,Qt,Fa.vertical,!0,ki,zt,Ft))};if(!De&&Un){for(var Pr=xn==="auto"?Un.map((function(di){return r2(di)})):[xn],Er=!1,Vr=0;Vr<Pr.length;Vr++){var Is=Pr[Vr];if(!Jt.horizontal[Is])if(Er)Jt.horizontal[Is]=Jt.horizontal[0];else{var Cs=A1(bn,c,f,I,_t,Sr,Oe,"center",Is,cn,Qt,Fa.horizontal,!1,ki,zt,Ft);Cs&&(Jt.horizontal[Is]=Cs,Er=Cs.positionedLines.length===1)}}Dr()}else{xn==="auto"&&(xn=r2(ri));var _o=A1(bn,c,f,I,_t,Sr,Oe,ri,xn,cn,Qt,Fa.horizontal,!1,ki,zt,Ft);_o&&(Jt.horizontal[xn]=_o),Dr(),v_(qn)&&De&&Je&&(Jt.vertical=A1(bn,c,f,I,_t,Sr,Oe,ri,xn,cn,Qt,Fa.vertical,!1,ki,zt,Ft))}}var Ns=void 0,vo=!1;if(ct.icon&&ct.icon.name){var Kr=v[ct.icon.name];Kr&&(Ns=(function(di,tr,Xi){var Ai=t2(Xi),Mo=tr[0]-di.displaySize[0]*Ai.horizontalAlign,ao=tr[1]-di.displaySize[1]*Ai.verticalAlign;return{image:di,top:ao,bottom:ao+di.displaySize[1],left:Mo,right:Mo+di.displaySize[0]}})(I[ct.icon.name],N.get("icon-offset").evaluate(ct,{},R),N.get("icon-anchor").evaluate(ct,{},R)),vo=Kr.sdf,a.sdfIcons===void 0?a.sdfIcons=Kr.sdf:a.sdfIcons!==Kr.sdf&&de("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Kr.pixelRatio!==a.pixelRatio||N.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var Ds=ML(Jt.horizontal)||Jt.vertical;a.iconsInText=!!Ds&&Ds.iconsInText,(Ds||Ns)&&(function(di,tr,Xi,Ai,Mo,ao,yr,is,lo,Li,oc){var Oa=ao.textMaxSize.evaluate(tr,{});Oa===void 0&&(Oa=yr);var ac,jr=di.layers[0].layout,lc=jr.get("icon-offset").evaluate(tr,{},oc),Bl=ML(Xi.horizontal),Qg=yr/24,ap=di.tilePixelRatio*Qg,em=di.tilePixelRatio*Oa/24,fh=di.tilePixelRatio*is,tm=di.tilePixelRatio*jr.get("symbol-spacing"),F1=jr.get("text-padding")*di.tilePixelRatio,nm=jr.get("icon-padding")*di.tilePixelRatio,B_=jr.get("text-max-angle")/180*Math.PI,O1=jr.get("text-rotation-alignment")==="map"&&jr.get("symbol-placement")!=="point",N1=jr.get("icon-rotation-alignment")==="map"&&jr.get("symbol-placement")!=="point",ph=jr.get("symbol-placement"),Z_=tm/2,im=jr.get("icon-text-fit");Ai&&im!=="none"&&(di.allowVerticalPlacement&&Xi.vertical&&(ac=_L(Ai,Xi.vertical,im,jr.get("icon-text-fit-padding"),lc,Qg)),Bl&&(Ai=_L(Ai,Bl,im,jr.get("icon-text-fit-padding"),lc,Qg)));var Sd=function(n6,j_){j_.x<0||j_.x>=8192||j_.y<0||j_.y>=8192||(function($r,du,i6,Ed,f2,HL,z1,uc,U1,$_,X1,Y1,p2,KL,J_,jL,$L,JL,qL,QL,Na,H1,eP,cc,r6){var tP,up,lm,um,cm,hm=$r.addToLineVertexArray(du,i6),nP=0,iP=0,rP=0,sP=0,g2=-1,m2=-1,gh={},oP=Pe(""),y2=0,_2=0;if(uc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(y2=(tP=uc.layout.get("text-offset").evaluate(Na,{},cc).map((function(Q_){return 24*Q_})))[0],_2=tP[1]):(y2=24*uc.layout.get("text-radial-offset").evaluate(Na,{},cc),_2=i2),$r.allowVerticalPlacement&&Ed.vertical){var aP=uc.layout.get("text-rotate").evaluate(Na,{},cc)+90;um=new M1(U1,du,$_,X1,Y1,Ed.vertical,p2,KL,J_,aP),z1&&(cm=new M1(U1,du,$_,X1,Y1,z1,$L,JL,J_,aP))}if(f2){var v2=uc.layout.get("icon-rotate").evaluate(Na,{}),lP=uc.layout.get("icon-text-fit")!=="none",uP=SL(f2,v2,eP,lP),b2=z1?SL(z1,v2,eP,lP):void 0;lm=new M1(U1,du,$_,X1,Y1,f2,$L,JL,!1,v2),nP=4*uP.length;var cP=$r.iconSizeData,q_=null;cP.kind==="source"?(q_=[128*uc.layout.get("icon-size").evaluate(Na,{})])[0]>32640&&de($r.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):cP.kind==="composite"&&((q_=[128*H1.compositeIconSizes[0].evaluate(Na,{},cc),128*H1.compositeIconSizes[1].evaluate(Na,{},cc)])[0]>32640||q_[1]>32640)&&de($r.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),$r.addSymbols($r.icon,uP,q_,QL,qL,Na,!1,du,hm.lineStartIndex,hm.lineLength,-1,cc),g2=$r.icon.placedSymbolArray.length-1,b2&&(iP=4*b2.length,$r.addSymbols($r.icon,b2,q_,QL,qL,Na,Fa.vertical,du,hm.lineStartIndex,hm.lineLength,-1,cc),m2=$r.icon.placedSymbolArray.length-1)}for(var hP in Ed.horizontal){var K1=Ed.horizontal[hP];if(!up){oP=Pe(K1.text);var s6=uc.layout.get("text-rotate").evaluate(Na,{},cc);up=new M1(U1,du,$_,X1,Y1,K1,p2,KL,J_,s6)}var dP=K1.positionedLines.length===1;if(rP+=RL($r,du,K1,HL,uc,J_,Na,jL,hm,Ed.vertical?Fa.horizontal:Fa.horizontalOnly,dP?Object.keys(Ed.horizontal):[hP],gh,g2,H1,cc),dP)break}Ed.vertical&&(sP+=RL($r,du,Ed.vertical,HL,uc,J_,Na,jL,hm,Fa.vertical,["vertical"],gh,m2,H1,cc));var o6=up?up.boxStartIndex:$r.collisionBoxArray.length,a6=up?up.boxEndIndex:$r.collisionBoxArray.length,l6=um?um.boxStartIndex:$r.collisionBoxArray.length,u6=um?um.boxEndIndex:$r.collisionBoxArray.length,c6=lm?lm.boxStartIndex:$r.collisionBoxArray.length,h6=lm?lm.boxEndIndex:$r.collisionBoxArray.length,d6=cm?cm.boxStartIndex:$r.collisionBoxArray.length,f6=cm?cm.boxEndIndex:$r.collisionBoxArray.length,hc=-1,j1=function(Q_,pP){return Q_&&Q_.circleDiameter?Math.max(Q_.circleDiameter,pP):pP};hc=j1(up,hc),hc=j1(um,hc),hc=j1(lm,hc);var fP=(hc=j1(cm,hc))>-1?1:0;fP&&(hc*=r6/24),$r.glyphOffsetArray.length>=$i.MAX_GLYPHS&&de("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Na.sortKey!==void 0&&$r.addToSortKeyRanges($r.symbolInstances.length,Na.sortKey),$r.symbolInstances.emplaceBack(du.x,du.y,gh.right>=0?gh.right:-1,gh.center>=0?gh.center:-1,gh.left>=0?gh.left:-1,gh.vertical||-1,g2,m2,oP,o6,a6,l6,u6,c6,h6,d6,f6,$_,rP,sP,nP,iP,fP,0,p2,y2,_2,hc)})(di,j_,n6,Xi,Ai,Mo,ac,di.layers[0],di.collisionBoxArray,tr.index,tr.sourceLayerIndex,di.index,ap,F1,O1,lo,fh,nm,N1,lc,tr,ao,Li,oc,yr)};if(ph==="line")for(var rm=0,D1=AL(tr.geometry,0,0,8192,8192);rm<D1.length;rm+=1)for(var V1=D1[rm],W_=0,z_=V8(V1,tm,B_,Xi.vertical||Bl,Ai,24,em,di.overscaling,8192);W_<z_.length;W_+=1){var B1=z_[W_];Bl&&z8(di,Bl.text,Z_,B1)||Sd(V1,B1)}else if(ph==="line-center")for(var U_=0,X_=tr.geometry;U_<X_.length;U_+=1){var Y_=X_[U_];if(Y_.length>1){var Z1=D8(Y_,B_,Xi.vertical||Bl,Ai,24,em);Z1&&Sd(Y_,Z1)}}else if(tr.type==="Polygon")for(var sm=0,W1=$A(tr.geometry,0);sm<W1.length;sm+=1){var om=W1[sm],H_=Z8(om,16);Sd(om[0],new Yg(H_.x,H_.y,0))}else if(tr.type==="LineString")for(var lp=0,K_=tr.geometry;lp<K_.length;lp+=1){var am=K_[lp];Sd(am,new Yg(am[0].x,am[0].y,0))}else if(tr.type==="Point")for(var c2=0,XL=tr.geometry;c2<XL.length;c2+=1)for(var h2=0,YL=XL[c2];h2<YL.length;h2+=1){var d2=YL[h2];Sd([d2],new Yg(d2.x,d2.y,0))}})(a,ct,Jt,Ns,v,X,zt,gn,Qt,vo,R)},st=0,ot=a.features;st<ot.length;st+=1)et();A&&a.generateCollisionDebugBuffers()},s.perspective=function(a,c,f,v,I){var A,R=1/Math.tan(c/2);return a[0]=R/f,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=R,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,I!=null&&I!==1/0?(a[10]=(I+v)*(A=1/(v-I)),a[14]=2*I*v*A):(a[10]=-1,a[14]=-2*v),a},s.pick=function(a,c){for(var f={},v=0;v<c.length;v++){var I=c[v];I in a&&(f[I]=a[I])}return f},s.plugin=fa,s.polygonIntersectsPolygon=ic,s.postMapLoadEvent=ji,s.postTurnstileEvent=an,s.potpack=pL,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.register=rn,s.registerForPluginStateChange=function(a){return a({pluginStatus:Xo,pluginURL:au}),x_.on("pluginStateChange",a),a},s.renderColorRamp=jk,s.rotate=function(a,c,f){var v=c[0],I=c[1],A=c[2],R=c[3],N=Math.sin(f),Z=Math.cos(f);return a[0]=v*Z+A*N,a[1]=I*Z+R*N,a[2]=v*-N+A*Z,a[3]=I*-N+R*Z,a},s.rotateX=function(a,c,f){var v=Math.sin(f),I=Math.cos(f),A=c[4],R=c[5],N=c[6],Z=c[7],X=c[8],Q=c[9],ne=c[10],he=c[11];return c!==a&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]),a[4]=A*I+X*v,a[5]=R*I+Q*v,a[6]=N*I+ne*v,a[7]=Z*I+he*v,a[8]=X*I-A*v,a[9]=Q*I-R*v,a[10]=ne*I-N*v,a[11]=he*I-Z*v,a},s.rotateZ=function(a,c,f){var v=Math.sin(f),I=Math.cos(f),A=c[0],R=c[1],N=c[2],Z=c[3],X=c[4],Q=c[5],ne=c[6],he=c[7];return c!==a&&(a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]),a[0]=A*I+X*v,a[1]=R*I+Q*v,a[2]=N*I+ne*v,a[3]=Z*I+he*v,a[4]=X*I-A*v,a[5]=Q*I-R*v,a[6]=ne*I-N*v,a[7]=he*I-Z*v,a},s.scale=function(a,c,f){var v=f[0],I=f[1],A=f[2];return a[0]=c[0]*v,a[1]=c[1]*v,a[2]=c[2]*v,a[3]=c[3]*v,a[4]=c[4]*I,a[5]=c[5]*I,a[6]=c[6]*I,a[7]=c[7]*I,a[8]=c[8]*A,a[9]=c[9]*A,a[10]=c[10]*A,a[11]=c[11]*A,a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],a},s.scale$1=function(a,c,f){return a[0]=c[0]*f,a[1]=c[1]*f,a[2]=c[2]*f,a[3]=c[3]*f,a},s.scale$2=function(a,c,f){return a[0]=c[0]*f,a[1]=c[1]*f,a[2]=c[2]*f,a},s.setCacheLimits=function(a,c){Pi=a,Mr=c},s.setRTLTextPlugin=function(a,c,f){if(f===void 0&&(f=!1),Xo==="deferred"||Xo==="loading"||Xo==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");au=Et.resolveURL(a),Xo="deferred",Lg=c,jf(),f||al()},s.sphericalToCartesian=function(a){var c=a[0],f=a[1],v=a[2];return f+=90,f*=Math.PI/180,v*=Math.PI/180,{x:c*Math.cos(f)*Math.sin(v),y:c*Math.sin(f)*Math.sin(v),z:c*Math.cos(v)}},s.sqrLen=function(a){var c=a[0],f=a[1];return c*c+f*f},s.styleSpec=be,s.sub=function(a,c,f){return a[0]=c[0]-f[0],a[1]=c[1]-f[1],a[2]=c[2]-f[2],a},s.symbolSize=N8,s.transformMat3=function(a,c,f){var v=c[0],I=c[1],A=c[2];return a[0]=v*f[0]+I*f[3]+A*f[6],a[1]=v*f[1]+I*f[4]+A*f[7],a[2]=v*f[2]+I*f[5]+A*f[8],a},s.transformMat4=Dg,s.translate=function(a,c,f){var v,I,A,R,N,Z,X,Q,ne,he,xe,Oe,De=f[0],Je=f[1],Xe=f[2];return c===a?(a[12]=c[0]*De+c[4]*Je+c[8]*Xe+c[12],a[13]=c[1]*De+c[5]*Je+c[9]*Xe+c[13],a[14]=c[2]*De+c[6]*Je+c[10]*Xe+c[14],a[15]=c[3]*De+c[7]*Je+c[11]*Xe+c[15]):(I=c[1],A=c[2],R=c[3],N=c[4],Z=c[5],X=c[6],Q=c[7],ne=c[8],he=c[9],xe=c[10],Oe=c[11],a[0]=v=c[0],a[1]=I,a[2]=A,a[3]=R,a[4]=N,a[5]=Z,a[6]=X,a[7]=Q,a[8]=ne,a[9]=he,a[10]=xe,a[11]=Oe,a[12]=v*De+N*Je+ne*Xe+c[12],a[13]=I*De+Z*Je+he*Xe+c[13],a[14]=A*De+X*Je+xe*Xe+c[14],a[15]=R*De+Q*Je+Oe*Xe+c[15]),a},s.triggerPluginCompletionEvent=g1,s.uniqueId=O,s.validateCustomStyleLayer=function(a){var c=[],f=a.id;return f===void 0&&c.push({message:"layers."+f+': missing required property "id"'}),a.render===void 0&&c.push({message:"layers."+f+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&c.push({message:"layers."+f+': property "renderingMode" must be either "2d" or "3d"'}),c},s.validateLight=ZA,s.validateStyle=Xf,s.values=function(a){var c=[];for(var f in a)c.push(a[f]);return c},s.vectorTile=Wg,s.version="1.13.3",s.warnOnce=de,s.webpSupported=hn,s.window=y,s.wrap=T})),o(["./shared"],(function(s){function l(ee){var le=typeof ee;if(le==="number"||le==="boolean"||le==="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){for(var ye="[",Ae=0,Me=ee;Ae<Me.length;Ae+=1)ye+=l(Me[Ae])+",";return ye+"]"}for(var $e=Object.keys(ee).sort(),Ye="{",be=0;be<$e.length;be++)Ye+=JSON.stringify($e[be])+":"+l(ee[$e[be]])+",";return Ye+"}"}function u(ee){for(var le="",ye=0,Ae=s.refProperties;ye<Ae.length;ye+=1)le+="/"+l(ee[Ae[ye]]);return le}var h=function(ee){this.keyCache={},ee&&this.replace(ee)};h.prototype.replace=function(ee){this._layerConfigs={},this._layers={},this.update(ee,[])},h.prototype.update=function(ee,le){for(var ye=this,Ae=0,Me=ee;Ae<Me.length;Ae+=1){var $e=Me[Ae];this._layerConfigs[$e.id]=$e;var Ye=this._layers[$e.id]=s.createStyleLayer($e);Ye._featureFilter=s.featureFilter(Ye.filter),this.keyCache[$e.id]&&delete this.keyCache[$e.id]}for(var be=0,ke=le;be<ke.length;be+=1){var it=ke[be];delete this.keyCache[it],delete this._layerConfigs[it],delete this._layers[it]}this.familiesBySource={};for(var At=0,Lt=(function(Xt,Yt){for(var Dt={},Fe=0;Fe<Xt.length;Fe++){var vt=Yt&&Yt[Xt[Fe].id]||u(Xt[Fe]);Yt&&(Yt[Xt[Fe].id]=vt);var Kt=Dt[vt];Kt||(Kt=Dt[vt]=[]),Kt.push(Xt[Fe])}var yn=[];for(var Bn in Dt)yn.push(Dt[Bn]);return yn})(s.values(this._layerConfigs),this.keyCache);At<Lt.length;At+=1){var dt=Lt[At].map((function(Xt){return ye._layers[Xt.id]})),Tt=dt[0];if(Tt.visibility!=="none"){var qt=Tt.source||"",tn=this.familiesBySource[qt];tn||(tn=this.familiesBySource[qt]={});var pt=Tt.sourceLayer||"_geojsonTileLayer",$t=tn[pt];$t||($t=tn[pt]=[]),$t.push(dt)}}};var d=function(ee){var le={},ye=[];for(var Ae in ee){var Me=ee[Ae],$e=le[Ae]={};for(var Ye in Me){var be=Me[+Ye];if(be&&be.bitmap.width!==0&&be.bitmap.height!==0){var ke={x:0,y:0,w:be.bitmap.width+2,h:be.bitmap.height+2};ye.push(ke),$e[Ye]={rect:ke,metrics:be.metrics}}}}var it=s.potpack(ye),At=new s.AlphaImage({width:it.w||1,height:it.h||1});for(var Lt in ee){var dt=ee[Lt];for(var Tt in dt){var qt=dt[+Tt];if(qt&&qt.bitmap.width!==0&&qt.bitmap.height!==0){var tn=le[Lt][Tt].rect;s.AlphaImage.copy(qt.bitmap,At,{x:0,y:0},{x:tn.x+1,y:tn.y+1},qt.bitmap)}}}this.image=At,this.positions=le};s.register("GlyphAtlas",d);var m=function(ee){this.tileID=new s.OverscaledTileID(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.uid=ee.uid,this.zoom=ee.zoom,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.returnDependencies=!!ee.returnDependencies,this.promoteId=ee.promoteId};function y(ee,le,ye){for(var Ae=new s.EvaluationParameters(le),Me=0,$e=ee;Me<$e.length;Me+=1)$e[Me].recalculate(Ae,ye)}function x(ee,le){var ye=s.getArrayBuffer(ee.request,(function(Ae,Me,$e,Ye){Ae?le(Ae):Me&&le(null,{vectorTile:new s.vectorTile.VectorTile(new s.pbf(Me)),rawData:Me,cacheControl:$e,expires:Ye})}));return function(){ye.cancel(),le()}}m.prototype.parse=function(ee,le,ye,Ae,Me){var $e=this;this.status="parsing",this.data=ee,this.collisionBoxArray=new s.CollisionBoxArray;var Ye=new s.DictionaryCoder(Object.keys(ee.layers).sort()),be=new s.FeatureIndex(this.tileID,this.promoteId);be.bucketLayerIDs=[];var ke,it,At,Lt,dt={},Tt={featureIndex:be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ye},qt=le.familiesBySource[this.source];for(var tn in qt){var pt=ee.layers[tn];if(pt){pt.version===1&&s.warnOnce('Vector tile source "'+this.source+'" layer "'+tn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var $t=Ye.encode(tn),Xt=[],Yt=0;Yt<pt.length;Yt++){var Dt=pt.feature(Yt),Fe=be.getId(Dt,tn);Xt.push({feature:Dt,id:Fe,index:Yt,sourceLayerIndex:$t})}for(var vt=0,Kt=qt[tn];vt<Kt.length;vt+=1){var yn=Kt[vt],Bn=yn[0];Bn.minzoom&&this.zoom<Math.floor(Bn.minzoom)||Bn.maxzoom&&this.zoom>=Bn.maxzoom||Bn.visibility!=="none"&&(y(yn,this.zoom,ye),(dt[Bn.id]=Bn.createBucket({index:be.bucketLayerIDs.length,layers:yn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$t,sourceID:this.source})).populate(Xt,Tt,this.tileID.canonical),be.bucketLayerIDs.push(yn.map((function(Gi){return Gi.id}))))}}}var En=s.mapObject(Tt.glyphDependencies,(function(Gi){return Object.keys(Gi).map(Number)}));Object.keys(En).length?Ae.send("getGlyphs",{uid:this.uid,stacks:En},(function(Gi,Mn){ke||(ke=Gi,it=Mn,or.call($e))})):it={};var Qi=Object.keys(Tt.iconDependencies);Qi.length?Ae.send("getImages",{icons:Qi,source:this.source,tileID:this.tileID,type:"icons"},(function(Gi,Mn){ke||(ke=Gi,At=Mn,or.call($e))})):At={};var li=Object.keys(Tt.patternDependencies);function or(){if(ke)return Me(ke);if(it&&At&&Lt){var Gi=new d(it),Mn=new s.ImageAtlas(At,Lt);for(var Ci in dt){var Us=dt[Ci];Us instanceof s.SymbolBucket?(y(Us.layers,this.zoom,ye),s.performSymbolLayout(Us,it,Gi.positions,At,Mn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Us.hasPattern&&(Us instanceof s.LineBucket||Us instanceof s.FillBucket||Us instanceof s.FillExtrusionBucket)&&(y(Us.layers,this.zoom,ye),Us.addFeatures(Tt,this.tileID.canonical,Mn.patternPositions))}this.status="done",Me(null,{buckets:s.values(dt).filter((function(Pf){return!Pf.isEmpty()})),featureIndex:be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gi.image,imageAtlas:Mn,glyphMap:this.returnDependencies?it:null,iconMap:this.returnDependencies?At:null,glyphPositions:this.returnDependencies?Gi.positions:null})}}li.length?Ae.send("getImages",{icons:li,source:this.source,tileID:this.tileID,type:"patterns"},(function(Gi,Mn){ke||(ke=Gi,Lt=Mn,or.call($e))})):Lt={},or.call(this)};var C=function(ee,le,ye,Ae){this.actor=ee,this.layerIndex=le,this.availableImages=ye,this.loadVectorData=Ae||x,this.loading={},this.loaded={}};C.prototype.loadTile=function(ee,le){var ye=this,Ae=ee.uid;this.loading||(this.loading={});var Me=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new s.RequestPerformance(ee.request),$e=this.loading[Ae]=new m(ee);$e.abort=this.loadVectorData(ee,(function(Ye,be){if(delete ye.loading[Ae],Ye||!be)return $e.status="done",ye.loaded[Ae]=$e,le(Ye);var ke=be.rawData,it={};be.expires&&(it.expires=be.expires),be.cacheControl&&(it.cacheControl=be.cacheControl);var At={};if(Me){var Lt=Me.finish();Lt&&(At.resourceTiming=JSON.parse(JSON.stringify(Lt)))}$e.vectorTile=be.vectorTile,$e.parse(be.vectorTile,ye.layerIndex,ye.availableImages,ye.actor,(function(dt,Tt){if(dt||!Tt)return le(dt);le(null,s.extend({rawTileData:ke.slice(0)},Tt,it,At))})),ye.loaded=ye.loaded||{},ye.loaded[Ae]=$e}))},C.prototype.reloadTile=function(ee,le){var ye=this,Ae=this.loaded,Me=ee.uid,$e=this;if(Ae&&Ae[Me]){var Ye=Ae[Me];Ye.showCollisionBoxes=ee.showCollisionBoxes;var be=function(ke,it){var At=Ye.reloadCallback;At&&(delete Ye.reloadCallback,Ye.parse(Ye.vectorTile,$e.layerIndex,ye.availableImages,$e.actor,At)),le(ke,it)};Ye.status==="parsing"?Ye.reloadCallback=be:Ye.status==="done"&&(Ye.vectorTile?Ye.parse(Ye.vectorTile,this.layerIndex,this.availableImages,this.actor,be):be())}},C.prototype.abortTile=function(ee,le){var ye=this.loading,Ae=ee.uid;ye&&ye[Ae]&&ye[Ae].abort&&(ye[Ae].abort(),delete ye[Ae]),le()},C.prototype.removeTile=function(ee,le){var ye=this.loaded,Ae=ee.uid;ye&&ye[Ae]&&delete ye[Ae],le()};var w=s.window.ImageBitmap,E=function(){this.loaded={}};function T(ee,le){if(ee.length!==0){k(ee[0],le);for(var ye=1;ye<ee.length;ye++)k(ee[ye],!le)}}function k(ee,le){for(var ye=0,Ae=0,Me=0,$e=ee.length,Ye=$e-1;Me<$e;Ye=Me++){var be=(ee[Me][0]-ee[Ye][0])*(ee[Ye][1]+ee[Me][1]),ke=ye+be;Ae+=Math.abs(ye)>=Math.abs(be)?ye-ke+be:be-ke+ye,ye=ke}ye+Ae>=0!=!!le&&ee.reverse()}E.prototype.loadTile=function(ee,le){var ye=ee.uid,Ae=ee.encoding,Me=ee.rawImageData,$e=w&&Me instanceof w?this.getImageData(Me):Me,Ye=new s.DEMData(ye,$e,Ae);this.loaded=this.loaded||{},this.loaded[ye]=Ye,le(null,Ye)},E.prototype.getImageData=function(ee){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);var le=this.offscreenCanvasContext.getImageData(-1,-1,ee.width+2,ee.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:le.width,height:le.height},le.data)},E.prototype.removeTile=function(ee){var le=this.loaded,ye=ee.uid;le&&le[ye]&&delete le[ye]};var G=s.vectorTile.VectorTileFeature.prototype.toGeoJSON,O=function(ee){this._feature=ee,this.extent=s.EXTENT,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))};O.prototype.loadGeometry=function(){if(this._feature.type===1){for(var ee=[],le=0,ye=this._feature.geometry;le<ye.length;le+=1){var Ae=ye[le];ee.push([new s.Point$1(Ae[0],Ae[1])])}return ee}for(var Me=[],$e=0,Ye=this._feature.geometry;$e<Ye.length;$e+=1){for(var be=[],ke=0,it=Ye[$e];ke<it.length;ke+=1){var At=it[ke];be.push(new s.Point$1(At[0],At[1]))}Me.push(be)}return Me},O.prototype.toGeoJSON=function(ee,le,ye){return G.call(this,ee,le,ye)};var V=function(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=ee.length,this._features=ee};V.prototype.feature=function(ee){return new O(this._features[ee])};var z=s.vectorTile.VectorTileFeature,H=te;function te(ee,le){this.options=le||{},this.features=ee,this.length=ee.length}function $(ee,le){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=le||4096}te.prototype.feature=function(ee){return new $(this.features[ee],this.options.extent)},$.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var le=0;le<ee.length;le++){for(var ye=ee[le],Ae=[],Me=0;Me<ye.length;Me++)Ae.push(new s.Point$1(ye[Me][0],ye[Me][1]));this.geometry.push(Ae)}return this.geometry},$.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,le=1/0,ye=-1/0,Ae=1/0,Me=-1/0,$e=0;$e<ee.length;$e++)for(var Ye=ee[$e],be=0;be<Ye.length;be++){var ke=Ye[be];le=Math.min(le,ke.x),ye=Math.max(ye,ke.x),Ae=Math.min(Ae,ke.y),Me=Math.max(Me,ke.y)}return[le,Ae,ye,Me]},$.prototype.toGeoJSON=z.prototype.toGeoJSON;var ae=Y,fe=H;function Y(ee){var le=new s.pbf;return(function(ye,Ae){for(var Me in ye.layers)Ae.writeMessage(3,de,ye.layers[Me])})(ee,le),le.finish()}function de(ee,le){var ye;le.writeVarintField(15,ee.version||1),le.writeStringField(1,ee.name||""),le.writeVarintField(5,ee.extent||4096);var Ae={keys:[],values:[],keycache:{},valuecache:{}};for(ye=0;ye<ee.length;ye++)Ae.feature=ee.feature(ye),le.writeMessage(2,D,Ae);var Me=Ae.keys;for(ye=0;ye<Me.length;ye++)le.writeStringField(3,Me[ye]);var $e=Ae.values;for(ye=0;ye<$e.length;ye++)le.writeMessage(4,Ee,$e[ye])}function D(ee,le){var ye=ee.feature;ye.id!==void 0&&le.writeVarintField(1,ye.id),le.writeMessage(2,oe,ee),le.writeVarintField(3,ye.type),le.writeMessage(4,Ne,ye)}function oe(ee,le){var ye=ee.feature,Ae=ee.keys,Me=ee.values,$e=ee.keycache,Ye=ee.valuecache;for(var be in ye.properties){var ke=$e[be];ke===void 0&&(Ae.push(be),$e[be]=ke=Ae.length-1),le.writeVarint(ke);var it=ye.properties[be],At=typeof it;At!=="string"&&At!=="boolean"&&At!=="number"&&(it=JSON.stringify(it));var Lt=At+":"+it,dt=Ye[Lt];dt===void 0&&(Me.push(it),Ye[Lt]=dt=Me.length-1),le.writeVarint(dt)}}function ue(ee,le){return(le<<3)+(7&ee)}function ge(ee){return ee<<1^ee>>31}function Ne(ee,le){for(var ye=ee.loadGeometry(),Ae=ee.type,Me=0,$e=0,Ye=ye.length,be=0;be<Ye;be++){var ke=ye[be],it=1;Ae===1&&(it=ke.length),le.writeVarint(ue(1,it));for(var At=Ae===3?ke.length-1:ke.length,Lt=0;Lt<At;Lt++){Lt===1&&Ae!==1&&le.writeVarint(ue(2,At-1));var dt=ke[Lt].x-Me,Tt=ke[Lt].y-$e;le.writeVarint(ge(dt)),le.writeVarint(ge(Tt)),Me+=dt,$e+=Tt}Ae===3&&le.writeVarint(ue(7,1))}}function Ee(ee,le){var ye=typeof ee;ye==="string"?le.writeStringField(1,ee):ye==="boolean"?le.writeBooleanField(7,ee):ye==="number"&&(ee%1!=0?le.writeDoubleField(3,ee):ee<0?le.writeSVarintField(6,ee):le.writeVarintField(5,ee))}function se(ee,le,ye,Ae){q(ee,ye,Ae),q(le,2*ye,2*Ae),q(le,2*ye+1,2*Ae+1)}function q(ee,le,ye){var Ae=ee[le];ee[le]=ee[ye],ee[ye]=Ae}function j(ee,le,ye,Ae){var Me=ee-ye,$e=le-Ae;return Me*Me+$e*$e}ae.fromVectorTileJs=Y,ae.fromGeojsonVt=function(ee,le){le=le||{};var ye={};for(var Ae in ee)ye[Ae]=new H(ee[Ae].features,le),ye[Ae].name=Ae,ye[Ae].version=le.version,ye[Ae].extent=le.extent;return Y({layers:ye})},ae.GeoJSONWrapper=fe;var ze=function(ee){return ee[0]},je=function(ee){return ee[1]},qe=function(ee,le,ye,Ae,Me){le===void 0&&(le=ze),ye===void 0&&(ye=je),Ae===void 0&&(Ae=64),Me===void 0&&(Me=Float64Array),this.nodeSize=Ae,this.points=ee;for(var $e=ee.length<65536?Uint16Array:Uint32Array,Ye=this.ids=new $e(ee.length),be=this.coords=new Me(2*ee.length),ke=0;ke<ee.length;ke++)Ye[ke]=ke,be[2*ke]=le(ee[ke]),be[2*ke+1]=ye(ee[ke]);(function it(At,Lt,dt,Tt,qt,tn){if(!(qt-Tt<=dt)){var pt=Tt+qt>>1;(function $t(Xt,Yt,Dt,Fe,vt,Kt){for(;vt>Fe;){if(vt-Fe>600){var yn=vt-Fe+1,Bn=Dt-Fe+1,En=Math.log(yn),Qi=.5*Math.exp(2*En/3),li=.5*Math.sqrt(En*Qi*(yn-Qi)/yn)*(Bn-yn/2<0?-1:1);$t(Xt,Yt,Dt,Math.max(Fe,Math.floor(Dt-Bn*Qi/yn+li)),Math.min(vt,Math.floor(Dt+(yn-Bn)*Qi/yn+li)),Kt)}var or=Yt[2*Dt+Kt],Gi=Fe,Mn=vt;for(se(Xt,Yt,Fe,Dt),Yt[2*vt+Kt]>or&&se(Xt,Yt,Fe,vt);Gi<Mn;){for(se(Xt,Yt,Gi,Mn),Gi++,Mn--;Yt[2*Gi+Kt]<or;)Gi++;for(;Yt[2*Mn+Kt]>or;)Mn--}Yt[2*Fe+Kt]===or?se(Xt,Yt,Fe,Mn):se(Xt,Yt,++Mn,vt),Mn<=Dt&&(Fe=Mn+1),Dt<=Mn&&(vt=Mn-1)}})(At,Lt,pt,Tt,qt,tn%2),it(At,Lt,dt,Tt,pt-1,tn+1),it(At,Lt,dt,pt+1,qt,tn+1)}})(Ye,be,Ae,0,Ye.length-1,0)};qe.prototype.range=function(ee,le,ye,Ae){return(function(Me,$e,Ye,be,ke,it,At){for(var Lt,dt,Tt=[0,Me.length-1,0],qt=[];Tt.length;){var tn=Tt.pop(),pt=Tt.pop(),$t=Tt.pop();if(pt-$t<=At)for(var Xt=$t;Xt<=pt;Xt++)dt=$e[2*Xt+1],(Lt=$e[2*Xt])>=Ye&&Lt<=ke&&dt>=be&&dt<=it&&qt.push(Me[Xt]);else{var Yt=Math.floor(($t+pt)/2);dt=$e[2*Yt+1],(Lt=$e[2*Yt])>=Ye&&Lt<=ke&&dt>=be&&dt<=it&&qt.push(Me[Yt]);var Dt=(tn+1)%2;(tn===0?Ye<=Lt:be<=dt)&&(Tt.push($t),Tt.push(Yt-1),Tt.push(Dt)),(tn===0?ke>=Lt:it>=dt)&&(Tt.push(Yt+1),Tt.push(pt),Tt.push(Dt))}}return qt})(this.ids,this.coords,ee,le,ye,Ae,this.nodeSize)},qe.prototype.within=function(ee,le,ye){return(function(Ae,Me,$e,Ye,be,ke){for(var it=[0,Ae.length-1,0],At=[],Lt=be*be;it.length;){var dt=it.pop(),Tt=it.pop(),qt=it.pop();if(Tt-qt<=ke)for(var tn=qt;tn<=Tt;tn++)j(Me[2*tn],Me[2*tn+1],$e,Ye)<=Lt&&At.push(Ae[tn]);else{var pt=Math.floor((qt+Tt)/2),$t=Me[2*pt],Xt=Me[2*pt+1];j($t,Xt,$e,Ye)<=Lt&&At.push(Ae[pt]);var Yt=(dt+1)%2;(dt===0?$e-be<=$t:Ye-be<=Xt)&&(it.push(qt),it.push(pt-1),it.push(Yt)),(dt===0?$e+be>=$t:Ye+be>=Xt)&&(it.push(pt+1),it.push(Tt),it.push(Yt))}}return At})(this.ids,this.coords,ee,le,ye,this.nodeSize)};var yt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ee){return ee}},xt=function(ee){this.options=W(Object.create(yt),ee),this.trees=new Array(this.options.maxZoom+1)};function Et(ee,le,ye,Ae,Me){return{x:ee,y:le,zoom:1/0,id:ye,parentId:-1,numPoints:Ae,properties:Me}}function kt(ee,le){var ye=ee.geometry.coordinates,Ae=ye[1];return{x:Ge(ye[0]),y:ve(Ae),zoom:1/0,index:le,parentId:-1}}function hn(ee){return{type:"Feature",id:ee.id,properties:wn(ee),geometry:{type:"Point",coordinates:[(Ae=ee.x,360*(Ae-.5)),(le=ee.y,ye=(180-360*le)*Math.PI/180,360*Math.atan(Math.exp(ye))/Math.PI-90)]}};var le,ye,Ae}function wn(ee){var le=ee.numPoints,ye=le>=1e4?Math.round(le/1e3)+"k":le>=1e3?Math.round(le/100)/10+"k":le;return W(W({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:le,point_count_abbreviated:ye})}function Ge(ee){return ee/360+.5}function ve(ee){var le=Math.sin(ee*Math.PI/180),ye=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ye<0?0:ye>1?1:ye}function W(ee,le){for(var ye in le)ee[ye]=le[ye];return ee}function Ze(ee){return ee.x}function Re(ee){return ee.y}function ce(ee,le,ye,Ae,Me,$e){var Ye=Me-ye,be=$e-Ae;if(Ye!==0||be!==0){var ke=((ee-ye)*Ye+(le-Ae)*be)/(Ye*Ye+be*be);ke>1?(ye=Me,Ae=$e):ke>0&&(ye+=Ye*ke,Ae+=be*ke)}return(Ye=ee-ye)*Ye+(be=le-Ae)*be}function me(ee,le,ye,Ae){var Me={id:ee===void 0?null:ee,type:le,geometry:ye,tags:Ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function($e){var Ye=$e.geometry,be=$e.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")_e($e,Ye);else if(be==="Polygon"||be==="MultiLineString")for(var ke=0;ke<Ye.length;ke++)_e($e,Ye[ke]);else if(be==="MultiPolygon")for(ke=0;ke<Ye.length;ke++)for(var it=0;it<Ye[ke].length;it++)_e($e,Ye[ke][it])})(Me),Me}function _e(ee,le){for(var ye=0;ye<le.length;ye+=3)ee.minX=Math.min(ee.minX,le[ye]),ee.minY=Math.min(ee.minY,le[ye+1]),ee.maxX=Math.max(ee.maxX,le[ye]),ee.maxY=Math.max(ee.maxY,le[ye+1])}function Ie(ee,le,ye,Ae){if(le.geometry){var Me=le.geometry.coordinates,$e=le.geometry.type,Ye=Math.pow(ye.tolerance/((1<<ye.maxZoom)*ye.extent),2),be=[],ke=le.id;if(ye.promoteId?ke=le.properties[ye.promoteId]:ye.generateId&&(ke=Ae||0),$e==="Point")pe(Me,be);else if($e==="MultiPoint")for(var it=0;it<Me.length;it++)pe(Me[it],be);else if($e==="LineString")Te(Me,be,Ye,!1);else if($e==="MultiLineString"){if(ye.lineMetrics){for(it=0;it<Me.length;it++)Te(Me[it],be=[],Ye,!1),ee.push(me(ke,"LineString",be,le.properties));return}We(Me,be,Ye,!1)}else if($e==="Polygon")We(Me,be,Ye,!0);else{if($e!=="MultiPolygon"){if($e==="GeometryCollection"){for(it=0;it<le.geometry.geometries.length;it++)Ie(ee,{id:ke,geometry:le.geometry.geometries[it],properties:le.properties},ye,Ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(it=0;it<Me.length;it++){var At=[];We(Me[it],At,Ye,!0),be.push(At)}}ee.push(me(ke,$e,be,le.properties))}}function pe(ee,le){le.push(tt(ee[0])),le.push(nt(ee[1])),le.push(0)}function Te(ee,le,ye,Ae){for(var Me,$e,Ye=0,be=0;be<ee.length;be++){var ke=tt(ee[be][0]),it=nt(ee[be][1]);le.push(ke),le.push(it),le.push(0),be>0&&(Ye+=Ae?(Me*it-ke*$e)/2:Math.sqrt(Math.pow(ke-Me,2)+Math.pow(it-$e,2))),Me=ke,$e=it}var At=le.length-3;le[2]=1,(function Lt(dt,Tt,qt,tn){for(var pt,$t=tn,Xt=qt-Tt>>1,Yt=qt-Tt,Dt=dt[Tt],Fe=dt[Tt+1],vt=dt[qt],Kt=dt[qt+1],yn=Tt+3;yn<qt;yn+=3){var Bn=ce(dt[yn],dt[yn+1],Dt,Fe,vt,Kt);if(Bn>$t)pt=yn,$t=Bn;else if(Bn===$t){var En=Math.abs(yn-Xt);En<Yt&&(pt=yn,Yt=En)}}$t>tn&&(pt-Tt>3&&Lt(dt,Tt,pt,tn),dt[pt+2]=$t,qt-pt>3&&Lt(dt,pt,qt,tn))})(le,0,At,ye),le[At+2]=1,le.size=Math.abs(Ye),le.start=0,le.end=le.size}function We(ee,le,ye,Ae){for(var Me=0;Me<ee.length;Me++){var $e=[];Te(ee[Me],$e,ye,Ae),le.push($e)}}function tt(ee){return ee/360+.5}function nt(ee){var le=Math.sin(ee*Math.PI/180),ye=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ye<0?0:ye>1?1:ye}function bt(ee,le,ye,Ae,Me,$e,Ye,be){if(Ae/=le,$e>=(ye/=le)&&Ye<Ae)return ee;if(Ye<ye||$e>=Ae)return null;for(var ke=[],it=0;it<ee.length;it++){var At=ee[it],Lt=At.geometry,dt=At.type,Tt=Me===0?At.minX:At.minY,qt=Me===0?At.maxX:At.maxY;if(Tt>=ye&&qt<Ae)ke.push(At);else if(!(qt<ye||Tt>=Ae)){var tn=[];if(dt==="Point"||dt==="MultiPoint")on(Lt,tn,ye,Ae,Me);else if(dt==="LineString")an(Lt,tn,ye,Ae,Me,!1,be.lineMetrics);else if(dt==="MultiLineString")ji(Lt,tn,ye,Ae,Me,!1);else if(dt==="Polygon")ji(Lt,tn,ye,Ae,Me,!0);else if(dt==="MultiPolygon")for(var pt=0;pt<Lt.length;pt++){var $t=[];ji(Lt[pt],$t,ye,Ae,Me,!0),$t.length&&tn.push($t)}if(tn.length){if(be.lineMetrics&&dt==="LineString"){for(pt=0;pt<tn.length;pt++)ke.push(me(At.id,dt,tn[pt],At.tags));continue}dt!=="LineString"&&dt!=="MultiLineString"||(tn.length===1?(dt="LineString",tn=tn[0]):dt="MultiLineString"),dt!=="Point"&&dt!=="MultiPoint"||(dt=tn.length===3?"Point":"MultiPoint"),ke.push(me(At.id,dt,tn,At.tags))}}}return ke.length?ke:null}function on(ee,le,ye,Ae,Me){for(var $e=0;$e<ee.length;$e+=3){var Ye=ee[$e+Me];Ye>=ye&&Ye<=Ae&&(le.push(ee[$e]),le.push(ee[$e+1]),le.push(ee[$e+2]))}}function an(ee,le,ye,Ae,Me,$e,Ye){for(var be,ke,it=Ii(ee),At=Me===0?Mr:_i,Lt=ee.start,dt=0;dt<ee.length-3;dt+=3){var Tt=ee[dt],qt=ee[dt+1],tn=ee[dt+2],pt=ee[dt+3],$t=ee[dt+4],Xt=Me===0?Tt:qt,Yt=Me===0?pt:$t,Dt=!1;Ye&&(be=Math.sqrt(Math.pow(Tt-pt,2)+Math.pow(qt-$t,2))),Xt<ye?Yt>ye&&(ke=At(it,Tt,qt,pt,$t,ye),Ye&&(it.start=Lt+be*ke)):Xt>Ae?Yt<Ae&&(ke=At(it,Tt,qt,pt,$t,Ae),Ye&&(it.start=Lt+be*ke)):Pi(it,Tt,qt,tn),Yt<ye&&Xt>=ye&&(ke=At(it,Tt,qt,pt,$t,ye),Dt=!0),Yt>Ae&&Xt<=Ae&&(ke=At(it,Tt,qt,pt,$t,Ae),Dt=!0),!$e&&Dt&&(Ye&&(it.end=Lt+be*ke),le.push(it),it=Ii(ee)),Ye&&(Lt+=be)}var Fe=ee.length-3;Tt=ee[Fe],qt=ee[Fe+1],tn=ee[Fe+2],(Xt=Me===0?Tt:qt)>=ye&&Xt<=Ae&&Pi(it,Tt,qt,tn),Fe=it.length-3,$e&&Fe>=3&&(it[Fe]!==it[0]||it[Fe+1]!==it[1])&&Pi(it,it[0],it[1],it[2]),it.length&&le.push(it)}function Ii(ee){var le=[];return le.size=ee.size,le.start=ee.start,le.end=ee.end,le}function ji(ee,le,ye,Ae,Me,$e){for(var Ye=0;Ye<ee.length;Ye++)an(ee[Ye],le,ye,Ae,Me,$e,!1)}function Pi(ee,le,ye,Ae){ee.push(le),ee.push(ye),ee.push(Ae)}function Mr(ee,le,ye,Ae,Me,$e){var Ye=($e-le)/(Ae-le);return ee.push($e),ee.push(ye+(Me-ye)*Ye),ee.push(1),Ye}function _i(ee,le,ye,Ae,Me,$e){var Ye=($e-ye)/(Me-ye);return ee.push(le+(Ae-le)*Ye),ee.push($e),ee.push(1),Ye}function ss(ee,le){for(var ye=[],Ae=0;Ae<ee.length;Ae++){var Me,$e=ee[Ae],Ye=$e.type;if(Ye==="Point"||Ye==="MultiPoint"||Ye==="LineString")Me=Ei($e.geometry,le);else if(Ye==="MultiLineString"||Ye==="Polygon"){Me=[];for(var be=0;be<$e.geometry.length;be++)Me.push(Ei($e.geometry[be],le))}else if(Ye==="MultiPolygon")for(Me=[],be=0;be<$e.geometry.length;be++){for(var ke=[],it=0;it<$e.geometry[be].length;it++)ke.push(Ei($e.geometry[be][it],le));Me.push(ke)}ye.push(me($e.id,Ye,Me,$e.tags))}return ye}function Ei(ee,le){var ye=[];ye.size=ee.size,ee.start!==void 0&&(ye.start=ee.start,ye.end=ee.end);for(var Ae=0;Ae<ee.length;Ae+=3)ye.push(ee[Ae]+le,ee[Ae+1],ee[Ae+2]);return ye}function Mi(ee,le){if(ee.transformed)return ee;var ye,Ae,Me,$e=1<<ee.z,Ye=ee.x,be=ee.y;for(ye=0;ye<ee.features.length;ye++){var ke=ee.features[ye],it=ke.geometry,At=ke.type;if(ke.geometry=[],At===1)for(Ae=0;Ae<it.length;Ae+=2)ke.geometry.push(zs(it[Ae],it[Ae+1],le,$e,Ye,be));else for(Ae=0;Ae<it.length;Ae++){var Lt=[];for(Me=0;Me<it[Ae].length;Me+=2)Lt.push(zs(it[Ae][Me],it[Ae][Me+1],le,$e,Ye,be));ke.geometry.push(Lt)}}return ee.transformed=!0,ee}function zs(ee,le,ye,Ae,Me,$e){return[Math.round(ye*(ee*Ae-Me)),Math.round(ye*(le*Ae-$e))]}function Ao(ee,le,ye,Ae,Me){for(var $e=le===Me.maxZoom?0:Me.tolerance/((1<<le)*Me.extent),Ye={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ye,y:Ae,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<ee.length;be++){Ye.numFeatures++,Ea(Ye,ee[be],$e,Me);var ke=ee[be].minX,it=ee[be].minY,At=ee[be].maxX,Lt=ee[be].maxY;ke<Ye.minX&&(Ye.minX=ke),it<Ye.minY&&(Ye.minY=it),At>Ye.maxX&&(Ye.maxX=At),Lt>Ye.maxY&&(Ye.maxY=Lt)}return Ye}function Ea(ee,le,ye,Ae){var Me=le.geometry,$e=le.type,Ye=[];if($e==="Point"||$e==="MultiPoint")for(var be=0;be<Me.length;be+=3)Ye.push(Me[be]),Ye.push(Me[be+1]),ee.numPoints++,ee.numSimplified++;else if($e==="LineString")_s(Ye,Me,ee,ye,!1,!1);else if($e==="MultiLineString"||$e==="Polygon")for(be=0;be<Me.length;be++)_s(Ye,Me[be],ee,ye,$e==="Polygon",be===0);else if($e==="MultiPolygon")for(var ke=0;ke<Me.length;ke++){var it=Me[ke];for(be=0;be<it.length;be++)_s(Ye,it[be],ee,ye,!0,be===0)}if(Ye.length){var At=le.tags||null;if($e==="LineString"&&Ae.lineMetrics){for(var Lt in At={},le.tags)At[Lt]=le.tags[Lt];At.mapbox_clip_start=Me.start/Me.size,At.mapbox_clip_end=Me.end/Me.size}var dt={geometry:Ye,type:$e==="Polygon"||$e==="MultiPolygon"?3:$e==="LineString"||$e==="MultiLineString"?2:1,tags:At};le.id!==null&&(dt.id=le.id),ee.features.push(dt)}}function _s(ee,le,ye,Ae,Me,$e){var Ye=Ae*Ae;if(Ae>0&&le.size<(Me?Ye:Ae))ye.numPoints+=le.length/3;else{for(var be=[],ke=0;ke<le.length;ke+=3)(Ae===0||le[ke+2]>Ye)&&(ye.numSimplified++,be.push(le[ke]),be.push(le[ke+1])),ye.numPoints++;Me&&(function(it,At){for(var Lt=0,dt=0,Tt=it.length,qt=Tt-2;dt<Tt;qt=dt,dt+=2)Lt+=(it[dt]-it[qt])*(it[dt+1]+it[qt+1]);if(Lt>0===At)for(dt=0,Tt=it.length;dt<Tt/2;dt+=2){var tn=it[dt],pt=it[dt+1];it[dt]=it[Tt-2-dt],it[dt+1]=it[Tt-1-dt],it[Tt-2-dt]=tn,it[Tt-1-dt]=pt}})(be,$e),ee.push(be)}}function Ur(ee,le){var ye=(le=this.options=(function(Me,$e){for(var Ye in $e)Me[Ye]=$e[Ye];return Me})(Object.create(this.options),le)).debug;if(ye&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ae=(function(Me,$e){var Ye=[];if(Me.type==="FeatureCollection")for(var be=0;be<Me.features.length;be++)Ie(Ye,Me.features[be],$e,be);else Ie(Ye,Me.type==="Feature"?Me:{geometry:Me},$e);return Ye})(ee,le);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ae=(function(Me,$e){var Ye=$e.buffer/$e.extent,be=Me,ke=bt(Me,1,-1-Ye,Ye,0,-1,2,$e),it=bt(Me,1,1-Ye,2+Ye,0,-1,2,$e);return(ke||it)&&(be=bt(Me,1,-Ye,1+Ye,0,-1,2,$e)||[],ke&&(be=ss(ke,1).concat(be)),it&&(be=be.concat(ss(it,-1)))),be})(Ae,le)).length&&this.splitTile(Ae,0,0,0),ye&&(Ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Xr(ee,le,ye){return 32*((1<<ee)*ye+le)+ee}function vs(ee,le){var ye=ee.tileID.canonical;if(!this._geoJSONIndex)return le(null,null);var Ae=this._geoJSONIndex.getTile(ye.z,ye.x,ye.y);if(!Ae)return le(null,null);var Me=new V(Ae.features),$e=ae(Me);$e.byteOffset===0&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),le(null,{vectorTile:Me,rawData:$e.buffer})}xt.prototype.load=function(ee){var le=this.options,ye=le.log,Ae=le.minZoom,Me=le.maxZoom,$e=le.nodeSize;ye&&console.time("total time");var Ye="prepare "+ee.length+" points";ye&&console.time(Ye),this.points=ee;for(var be=[],ke=0;ke<ee.length;ke++)ee[ke].geometry&&be.push(kt(ee[ke],ke));this.trees[Me+1]=new qe(be,Ze,Re,$e,Float32Array),ye&&console.timeEnd(Ye);for(var it=Me;it>=Ae;it--){var At=+Date.now();be=this._cluster(be,it),this.trees[it]=new qe(be,Ze,Re,$e,Float32Array),ye&&console.log("z%d: %d clusters in %dms",it,be.length,+Date.now()-At)}return ye&&console.timeEnd("total time"),this},xt.prototype.getClusters=function(ee,le){var ye=((ee[0]+180)%360+360)%360-180,Ae=Math.max(-90,Math.min(90,ee[1])),Me=ee[2]===180?180:((ee[2]+180)%360+360)%360-180,$e=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)ye=-180,Me=180;else if(ye>Me){var Ye=this.getClusters([ye,Ae,180,$e],le),be=this.getClusters([-180,Ae,Me,$e],le);return Ye.concat(be)}for(var ke=this.trees[this._limitZoom(le)],it=[],At=0,Lt=ke.range(Ge(ye),ve($e),Ge(Me),ve(Ae));At<Lt.length;At+=1){var dt=ke.points[Lt[At]];it.push(dt.numPoints?hn(dt):this.points[dt.index])}return it},xt.prototype.getChildren=function(ee){var le=this._getOriginId(ee),ye=this._getOriginZoom(ee),Ae="No cluster with the specified id.",Me=this.trees[ye];if(!Me)throw new Error(Ae);var $e=Me.points[le];if(!$e)throw new Error(Ae);for(var Ye=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),be=[],ke=0,it=Me.within($e.x,$e.y,Ye);ke<it.length;ke+=1){var At=Me.points[it[ke]];At.parentId===ee&&be.push(At.numPoints?hn(At):this.points[At.index])}if(be.length===0)throw new Error(Ae);return be},xt.prototype.getLeaves=function(ee,le,ye){var Ae=[];return this._appendLeaves(Ae,ee,le=le||10,ye=ye||0,0),Ae},xt.prototype.getTile=function(ee,le,ye){var Ae=this.trees[this._limitZoom(ee)],Me=Math.pow(2,ee),$e=this.options,Ye=$e.radius/$e.extent,be=(ye-Ye)/Me,ke=(ye+1+Ye)/Me,it={features:[]};return this._addTileFeatures(Ae.range((le-Ye)/Me,be,(le+1+Ye)/Me,ke),Ae.points,le,ye,Me,it),le===0&&this._addTileFeatures(Ae.range(1-Ye/Me,be,1,ke),Ae.points,Me,ye,Me,it),le===Me-1&&this._addTileFeatures(Ae.range(0,be,Ye/Me,ke),Ae.points,-1,ye,Me,it),it.features.length?it:null},xt.prototype.getClusterExpansionZoom=function(ee){for(var le=this._getOriginZoom(ee)-1;le<=this.options.maxZoom;){var ye=this.getChildren(ee);if(le++,ye.length!==1)break;ee=ye[0].properties.cluster_id}return le},xt.prototype._appendLeaves=function(ee,le,ye,Ae,Me){for(var $e=0,Ye=this.getChildren(le);$e<Ye.length;$e+=1){var be=Ye[$e],ke=be.properties;if(ke&&ke.cluster?Me+ke.point_count<=Ae?Me+=ke.point_count:Me=this._appendLeaves(ee,ke.cluster_id,ye,Ae,Me):Me<Ae?Me++:ee.push(be),ee.length===ye)break}return Me},xt.prototype._addTileFeatures=function(ee,le,ye,Ae,Me,$e){for(var Ye=0,be=ee;Ye<be.length;Ye+=1){var ke=le[be[Ye]],it=ke.numPoints,At={type:1,geometry:[[Math.round(this.options.extent*(ke.x*Me-ye)),Math.round(this.options.extent*(ke.y*Me-Ae))]],tags:it?wn(ke):this.points[ke.index].properties},Lt=void 0;it?Lt=ke.id:this.options.generateId?Lt=ke.index:this.points[ke.index].id&&(Lt=this.points[ke.index].id),Lt!==void 0&&(At.id=Lt),$e.features.push(At)}},xt.prototype._limitZoom=function(ee){return Math.max(this.options.minZoom,Math.min(+ee,this.options.maxZoom+1))},xt.prototype._cluster=function(ee,le){for(var ye=[],Ae=this.options,Me=Ae.reduce,$e=Ae.minPoints,Ye=Ae.radius/(Ae.extent*Math.pow(2,le)),be=0;be<ee.length;be++){var ke=ee[be];if(!(ke.zoom<=le)){ke.zoom=le;for(var it=this.trees[le+1],At=it.within(ke.x,ke.y,Ye),Lt=ke.numPoints||1,dt=Lt,Tt=0,qt=At;Tt<qt.length;Tt+=1){var tn=it.points[qt[Tt]];tn.zoom>le&&(dt+=tn.numPoints||1)}if(dt>=$e){for(var pt=ke.x*Lt,$t=ke.y*Lt,Xt=Me&&Lt>1?this._map(ke,!0):null,Yt=(be<<5)+(le+1)+this.points.length,Dt=0,Fe=At;Dt<Fe.length;Dt+=1){var vt=it.points[Fe[Dt]];if(!(vt.zoom<=le)){vt.zoom=le;var Kt=vt.numPoints||1;pt+=vt.x*Kt,$t+=vt.y*Kt,vt.parentId=Yt,Me&&(Xt||(Xt=this._map(ke,!0)),Me(Xt,this._map(vt)))}}ke.parentId=Yt,ye.push(Et(pt/dt,$t/dt,Yt,dt,Xt))}else if(ye.push(ke),dt>1)for(var yn=0,Bn=At;yn<Bn.length;yn+=1){var En=it.points[Bn[yn]];En.zoom<=le||(En.zoom=le,ye.push(En))}}}return ye},xt.prototype._getOriginId=function(ee){return ee-this.points.length>>5},xt.prototype._getOriginZoom=function(ee){return(ee-this.points.length)%32},xt.prototype._map=function(ee,le){if(ee.numPoints)return le?W({},ee.properties):ee.properties;var ye=this.points[ee.index].properties,Ae=this.options.map(ye);return le&&Ae===ye?W({},Ae):Ae},Ur.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ur.prototype.splitTile=function(ee,le,ye,Ae,Me,$e,Ye){for(var be=[ee,le,ye,Ae],ke=this.options,it=ke.debug;be.length;){Ae=be.pop(),ye=be.pop(),le=be.pop(),ee=be.pop();var At=1<<le,Lt=Xr(le,ye,Ae),dt=this.tiles[Lt];if(!dt&&(it>1&&console.time("creation"),dt=this.tiles[Lt]=Ao(ee,le,ye,Ae,ke),this.tileCoords.push({z:le,x:ye,y:Ae}),it)){it>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,ye,Ae,dt.numFeatures,dt.numPoints,dt.numSimplified),console.timeEnd("creation"));var Tt="z"+le;this.stats[Tt]=(this.stats[Tt]||0)+1,this.total++}if(dt.source=ee,Me){if(le===ke.maxZoom||le===Me)continue;var qt=1<<Me-le;if(ye!==Math.floor($e/qt)||Ae!==Math.floor(Ye/qt))continue}else if(le===ke.indexMaxZoom||dt.numPoints<=ke.indexMaxPoints)continue;if(dt.source=null,ee.length!==0){it>1&&console.time("clipping");var tn,pt,$t,Xt,Yt,Dt,Fe=.5*ke.buffer/ke.extent,vt=.5-Fe,Kt=.5+Fe,yn=1+Fe;tn=pt=$t=Xt=null,Yt=bt(ee,At,ye-Fe,ye+Kt,0,dt.minX,dt.maxX,ke),Dt=bt(ee,At,ye+vt,ye+yn,0,dt.minX,dt.maxX,ke),ee=null,Yt&&(tn=bt(Yt,At,Ae-Fe,Ae+Kt,1,dt.minY,dt.maxY,ke),pt=bt(Yt,At,Ae+vt,Ae+yn,1,dt.minY,dt.maxY,ke),Yt=null),Dt&&($t=bt(Dt,At,Ae-Fe,Ae+Kt,1,dt.minY,dt.maxY,ke),Xt=bt(Dt,At,Ae+vt,Ae+yn,1,dt.minY,dt.maxY,ke),Dt=null),it>1&&console.timeEnd("clipping"),be.push(tn||[],le+1,2*ye,2*Ae),be.push(pt||[],le+1,2*ye,2*Ae+1),be.push($t||[],le+1,2*ye+1,2*Ae),be.push(Xt||[],le+1,2*ye+1,2*Ae+1)}}},Ur.prototype.getTile=function(ee,le,ye){var Ae=this.options,Me=Ae.extent,$e=Ae.debug;if(ee<0||ee>24)return null;var Ye=1<<ee,be=Xr(ee,le=(le%Ye+Ye)%Ye,ye);if(this.tiles[be])return Mi(this.tiles[be],Me);$e>1&&console.log("drilling down to z%d-%d-%d",ee,le,ye);for(var ke,it=ee,At=le,Lt=ye;!ke&&it>0;)it--,At=Math.floor(At/2),Lt=Math.floor(Lt/2),ke=this.tiles[Xr(it,At,Lt)];return ke&&ke.source?($e>1&&console.log("found parent tile z%d-%d-%d",it,At,Lt),$e>1&&console.time("drilling down"),this.splitTile(ke.source,it,At,Lt,ee,le,ye),$e>1&&console.timeEnd("drilling down"),this.tiles[be]?Mi(this.tiles[be],Me):null):null};var Pl=(function(ee){function le(ye,Ae,Me,$e){ee.call(this,ye,Ae,Me,vs),$e&&(this.loadGeoJSON=$e)}return ee&&(le.__proto__=ee),(le.prototype=Object.create(ee&&ee.prototype)).constructor=le,le.prototype.loadData=function(ye,Ae){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Ae,this._pendingLoadDataParams=ye,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},le.prototype._loadData=function(){var ye=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Ae=this._pendingCallback,Me=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var $e=!!(Me&&Me.request&&Me.request.collectResourceTiming)&&new s.RequestPerformance(Me.request);this.loadGeoJSON(Me,(function(Ye,be){if(Ye||!be)return Ae(Ye);if(typeof be!="object")return Ae(new Error("Input data given to '"+Me.source+"' is not a valid GeoJSON object."));(function dt(Tt,qt){var tn,pt=Tt&&Tt.type;if(pt==="FeatureCollection")for(tn=0;tn<Tt.features.length;tn++)dt(Tt.features[tn],qt);else if(pt==="GeometryCollection")for(tn=0;tn<Tt.geometries.length;tn++)dt(Tt.geometries[tn],qt);else if(pt==="Feature")dt(Tt.geometry,qt);else if(pt==="Polygon")T(Tt.coordinates,qt);else if(pt==="MultiPolygon")for(tn=0;tn<Tt.coordinates.length;tn++)T(Tt.coordinates[tn],qt);return Tt})(be,!0);try{if(Me.filter){var ke=s.createExpression(Me.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ke.result==="error")throw new Error(ke.value.map((function(dt){return dt.key+": "+dt.message})).join(", "));var it=be.features.filter((function(dt){return ke.value.evaluate({zoom:0},dt)}));be={type:"FeatureCollection",features:it}}ye._geoJSONIndex=Me.cluster?new xt((function(dt){var Tt=dt.superclusterOptions,qt=dt.clusterProperties;if(!qt||!Tt)return Tt;for(var tn={},pt={},$t={accumulated:null,zoom:0},Xt={properties:null},Yt=Object.keys(qt),Dt=0,Fe=Yt;Dt<Fe.length;Dt+=1){var vt=Fe[Dt],Kt=qt[vt],yn=Kt[0],Bn=s.createExpression(Kt[1]),En=s.createExpression(typeof yn=="string"?[yn,["accumulated"],["get",vt]]:yn);tn[vt]=Bn.value,pt[vt]=En.value}return Tt.map=function(Qi){Xt.properties=Qi;for(var li={},or=0,Gi=Yt;or<Gi.length;or+=1){var Mn=Gi[or];li[Mn]=tn[Mn].evaluate($t,Xt)}return li},Tt.reduce=function(Qi,li){Xt.properties=li;for(var or=0,Gi=Yt;or<Gi.length;or+=1){var Mn=Gi[or];$t.accumulated=Qi[Mn],Qi[Mn]=pt[Mn].evaluate($t,Xt)}},Tt})(Me)).load(be.features):(function(dt,Tt){return new Ur(dt,Tt)})(be,Me.geojsonVtOptions)}catch(dt){return Ae(dt)}ye.loaded={};var At={};if($e){var Lt=$e.finish();Lt&&(At.resourceTiming={},At.resourceTiming[Me.source]=JSON.parse(JSON.stringify(Lt)))}Ae(null,At)}))}},le.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},le.prototype.reloadTile=function(ye,Ae){var Me=this.loaded;return Me&&Me[ye.uid]?ee.prototype.reloadTile.call(this,ye,Ae):this.loadTile(ye,Ae)},le.prototype.loadGeoJSON=function(ye,Ae){if(ye.request)s.getJSON(ye.request,Ae);else{if(typeof ye.data!="string")return Ae(new Error("Input data given to '"+ye.source+"' is not a valid GeoJSON object."));try{return Ae(null,JSON.parse(ye.data))}catch{return Ae(new Error("Input data given to '"+ye.source+"' is not a valid GeoJSON object."))}}},le.prototype.removeSource=function(ye,Ae){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Ae()},le.prototype.getClusterExpansionZoom=function(ye,Ae){try{Ae(null,this._geoJSONIndex.getClusterExpansionZoom(ye.clusterId))}catch(Me){Ae(Me)}},le.prototype.getClusterChildren=function(ye,Ae){try{Ae(null,this._geoJSONIndex.getChildren(ye.clusterId))}catch(Me){Ae(Me)}},le.prototype.getClusterLeaves=function(ye,Ae){try{Ae(null,this._geoJSONIndex.getLeaves(ye.clusterId,ye.limit,ye.offset))}catch(Me){Ae(Me)}},le})(C),Ti=function(ee){var le=this;this.self=ee,this.actor=new s.Actor(ee,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:C,geojson:Pl},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ye,Ae){if(le.workerSourceTypes[ye])throw new Error('Worker source with name "'+ye+'" already registered.');le.workerSourceTypes[ye]=Ae},this.self.registerRTLTextPlugin=function(ye){if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=ye.applyArabicShaping,s.plugin.processBidirectionalText=ye.processBidirectionalText,s.plugin.processStyledBidirectionalText=ye.processStyledBidirectionalText}};return Ti.prototype.setReferrer=function(ee,le){this.referrer=le},Ti.prototype.setImages=function(ee,le,ye){for(var Ae in this.availableImages[ee]=le,this.workerSources[ee]){var Me=this.workerSources[ee][Ae];for(var $e in Me)Me[$e].availableImages=le}ye()},Ti.prototype.setLayers=function(ee,le,ye){this.getLayerIndex(ee).replace(le),ye()},Ti.prototype.updateLayers=function(ee,le,ye){this.getLayerIndex(ee).update(le.layers,le.removedIds),ye()},Ti.prototype.loadTile=function(ee,le,ye){this.getWorkerSource(ee,le.type,le.source).loadTile(le,ye)},Ti.prototype.loadDEMTile=function(ee,le,ye){this.getDEMWorkerSource(ee,le.source).loadTile(le,ye)},Ti.prototype.reloadTile=function(ee,le,ye){this.getWorkerSource(ee,le.type,le.source).reloadTile(le,ye)},Ti.prototype.abortTile=function(ee,le,ye){this.getWorkerSource(ee,le.type,le.source).abortTile(le,ye)},Ti.prototype.removeTile=function(ee,le,ye){this.getWorkerSource(ee,le.type,le.source).removeTile(le,ye)},Ti.prototype.removeDEMTile=function(ee,le){this.getDEMWorkerSource(ee,le.source).removeTile(le)},Ti.prototype.removeSource=function(ee,le,ye){if(this.workerSources[ee]&&this.workerSources[ee][le.type]&&this.workerSources[ee][le.type][le.source]){var Ae=this.workerSources[ee][le.type][le.source];delete this.workerSources[ee][le.type][le.source],Ae.removeSource!==void 0?Ae.removeSource(le,ye):ye()}},Ti.prototype.loadWorkerSource=function(ee,le,ye){try{this.self.importScripts(le.url),ye()}catch(Ae){ye(Ae.toString())}},Ti.prototype.syncRTLPluginState=function(ee,le,ye){try{s.plugin.setState(le);var Ae=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&Ae!=null){this.self.importScripts(Ae);var Me=s.plugin.isParsed();ye(Me?void 0:new Error("RTL Text Plugin failed to import scripts from "+Ae),Me)}}catch($e){ye($e.toString())}},Ti.prototype.getAvailableImages=function(ee){var le=this.availableImages[ee];return le||(le=[]),le},Ti.prototype.getLayerIndex=function(ee){var le=this.layerIndexes[ee];return le||(le=this.layerIndexes[ee]=new h),le},Ti.prototype.getWorkerSource=function(ee,le,ye){var Ae=this;return this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][le]||(this.workerSources[ee][le]={}),this.workerSources[ee][le][ye]||(this.workerSources[ee][le][ye]=new this.workerSourceTypes[le]({send:function(Me,$e,Ye){Ae.actor.send(Me,$e,Ye,ee)}},this.getLayerIndex(ee),this.getAvailableImages(ee))),this.workerSources[ee][le][ye]},Ti.prototype.getDEMWorkerSource=function(ee,le){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][le]||(this.demWorkerSources[ee][le]=new E),this.demWorkerSources[ee][le]},Ti.prototype.enforceCacheSizeLimit=function(ee,le){s.enforceCacheSizeLimit(le)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ti(self)),Ti})),o(["./shared"],(function(s){var l=s.createCommonjsModule((function(p){function _(S){return!g(S)}function g(S){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var F,B,J=new Blob([""],{type:"text/javascript"}),re=URL.createObjectURL(J);try{B=new Worker(re),F=!0}catch{F=!1}return B&&B.terminate(),URL.revokeObjectURL(re),F})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var F=document.createElement("canvas");F.width=F.height=1;var B=F.getContext("2d");if(!B)return!1;var J=B.getImageData(0,0,1,1);return J&&J.width===F.width})()?(b[L=S&&S.failIfMajorPerformanceCaveat]===void 0&&(b[L]=(function(F){var B=(function(re){var Ce=document.createElement("canvas"),we=Object.create(_.webGLContextAttributes);return we.failIfMajorPerformanceCaveat=re,Ce.probablySupportsContext?Ce.probablySupportsContext("webgl",we)||Ce.probablySupportsContext("experimental-webgl",we):Ce.supportsContext?Ce.supportsContext("webgl",we)||Ce.supportsContext("experimental-webgl",we):Ce.getContext("webgl",we)||Ce.getContext("experimental-webgl",we)})(F);if(!B)return!1;var J=B.createShader(B.VERTEX_SHADER);return!(!J||B.isContextLost())&&(B.shaderSource(J,"void main() {}"),B.compileShader(J),B.getShaderParameter(J,B.COMPILE_STATUS)===!0)})(L)),b[L]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var L}p.exports?p.exports=_:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=_,window.mapboxgl.notSupportedReason=g);var b={};_.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),u={create:function(p,_,g){var b=s.window.document.createElement(p);return _!==void 0&&(b.className=_),g&&g.appendChild(b),b},createNS:function(p,_){return s.window.document.createElementNS(p,_)}},h=s.window.document&&s.window.document.documentElement.style;function d(p){if(!h)return p[0];for(var _=0;_<p.length;_++)if(p[_]in h)return p[_];return p[0]}var m,y=d(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);u.disableDrag=function(){h&&y&&(m=h[y],h[y]="none")},u.enableDrag=function(){h&&y&&(h[y]=m)};var x=d(["transform","WebkitTransform"]);u.setTransform=function(p,_){p.style[x]=_};var C=!1;try{var w=Object.defineProperty({},"passive",{get:function(){C=!0}});s.window.addEventListener("test",w,w),s.window.removeEventListener("test",w,w)}catch{C=!1}u.addEventListener=function(p,_,g,b){b===void 0&&(b={}),p.addEventListener(_,g,"passive"in b&&C?b:b.capture)},u.removeEventListener=function(p,_,g,b){b===void 0&&(b={}),p.removeEventListener(_,g,"passive"in b&&C?b:b.capture)};var E=function(p){p.preventDefault(),p.stopPropagation(),s.window.removeEventListener("click",E,!0)};function T(p){var _=p.userImage;return!!(_&&_.render&&_.render())&&(p.data.replace(new Uint8Array(_.data.buffer)),!0)}u.suppressClick=function(){s.window.addEventListener("click",E,!0),s.window.setTimeout((function(){s.window.removeEventListener("click",E,!0)}),0)},u.mousePos=function(p,_){var g=p.getBoundingClientRect();return new s.Point(_.clientX-g.left-p.clientLeft,_.clientY-g.top-p.clientTop)},u.touchPos=function(p,_){for(var g=p.getBoundingClientRect(),b=[],S=0;S<_.length;S++)b.push(new s.Point(_[S].clientX-g.left-p.clientLeft,_[S].clientY-g.top-p.clientTop));return b},u.mouseButton=function(p){return s.window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button},u.remove=function(p){p.parentNode&&p.parentNode.removeChild(p)};var k=(function(p){function _(){p.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.isLoaded=function(){return this.loaded},_.prototype.setLoaded=function(g){if(this.loaded!==g&&(this.loaded=g,g)){for(var b=0,S=this.requestors;b<S.length;b+=1){var L=S[b];this._notify(L.ids,L.callback)}this.requestors=[]}},_.prototype.getImage=function(g){return this.images[g]},_.prototype.addImage=function(g,b){this._validate(g,b)&&(this.images[g]=b)},_.prototype._validate=function(g,b){var S=!0;return this._validateStretch(b.stretchX,b.data&&b.data.width)||(this.fire(new s.ErrorEvent(new Error('Image "'+g+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(b.stretchY,b.data&&b.data.height)||(this.fire(new s.ErrorEvent(new Error('Image "'+g+'" has invalid "stretchY" value'))),S=!1),this._validateContent(b.content,b)||(this.fire(new s.ErrorEvent(new Error('Image "'+g+'" has invalid "content" value'))),S=!1),S},_.prototype._validateStretch=function(g,b){if(!g)return!0;for(var S=0,L=0,F=g;L<F.length;L+=1){var B=F[L];if(B[0]<S||B[1]<B[0]||b<B[1])return!1;S=B[1]}return!0},_.prototype._validateContent=function(g,b){return!(g&&(g.length!==4||g[0]<0||b.data.width<g[0]||g[1]<0||b.data.height<g[1]||g[2]<0||b.data.width<g[2]||g[3]<0||b.data.height<g[3]||g[2]<g[0]||g[3]<g[1]))},_.prototype.updateImage=function(g,b){b.version=this.images[g].version+1,this.images[g]=b,this.updatedImages[g]=!0},_.prototype.removeImage=function(g){var b=this.images[g];delete this.images[g],delete this.patterns[g],b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()},_.prototype.listImages=function(){return Object.keys(this.images)},_.prototype.getImages=function(g,b){var S=!0;if(!this.isLoaded())for(var L=0,F=g;L<F.length;L+=1)this.images[F[L]]||(S=!1);this.isLoaded()||S?this._notify(g,b):this.requestors.push({ids:g,callback:b})},_.prototype._notify=function(g,b){for(var S={},L=0,F=g;L<F.length;L+=1){var B=F[L];this.images[B]||this.fire(new s.Event("styleimagemissing",{id:B}));var J=this.images[B];J?S[B]={data:J.data.clone(),pixelRatio:J.pixelRatio,sdf:J.sdf,version:J.version,stretchX:J.stretchX,stretchY:J.stretchY,content:J.content,hasRenderCallback:!!(J.userImage&&J.userImage.render)}:s.warnOnce('Image "'+B+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}b(null,S)},_.prototype.getPixelSize=function(){var g=this.atlasImage;return{width:g.width,height:g.height}},_.prototype.getPattern=function(g){var b=this.patterns[g],S=this.getImage(g);if(!S)return null;if(b&&b.position.version===S.version)return b.position;if(b)b.position.version=S.version;else{var L={w:S.data.width+2,h:S.data.height+2,x:0,y:0},F=new s.ImagePosition(L,S);this.patterns[g]={bin:L,position:F}}return this._updatePatternAtlas(),this.patterns[g].position},_.prototype.bind=function(g){var b=g.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(g,this.atlasImage,b.RGBA),this.atlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE)},_.prototype._updatePatternAtlas=function(){var g=[];for(var b in this.patterns)g.push(this.patterns[b].bin);var S=s.potpack(g),L=S.w,F=S.h,B=this.atlasImage;for(var J in B.resize({width:L||1,height:F||1}),this.patterns){var re=this.patterns[J].bin,Ce=re.x+1,we=re.y+1,Se=this.images[J].data,Be=Se.width,Ve=Se.height;s.RGBAImage.copy(Se,B,{x:0,y:0},{x:Ce,y:we},{width:Be,height:Ve}),s.RGBAImage.copy(Se,B,{x:0,y:Ve-1},{x:Ce,y:we-1},{width:Be,height:1}),s.RGBAImage.copy(Se,B,{x:0,y:0},{x:Ce,y:we+Ve},{width:Be,height:1}),s.RGBAImage.copy(Se,B,{x:Be-1,y:0},{x:Ce-1,y:we},{width:1,height:Ve}),s.RGBAImage.copy(Se,B,{x:0,y:0},{x:Ce+Be,y:we},{width:1,height:Ve})}this.dirty=!0},_.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},_.prototype.dispatchRenderCallbacks=function(g){for(var b=0,S=g;b<S.length;b+=1){var L=S[b];if(!this.callbackDispatchedThisFrame[L]){this.callbackDispatchedThisFrame[L]=!0;var F=this.images[L];T(F)&&this.updateImage(L,F)}}},_})(s.Evented),G=z,O=z,V=1e20;function z(p,_,g,b,S,L){this.fontSize=p||24,this.buffer=_===void 0?3:_,this.cutoff=b||.25,this.fontFamily=S||"sans-serif",this.fontWeight=L||"normal",this.radius=g||8;var F=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=F,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(F*F),this.gridInner=new Float64Array(F*F),this.f=new Float64Array(F),this.d=new Float64Array(F),this.z=new Float64Array(F+1),this.v=new Int16Array(F),this.middle=Math.round(F/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function H(p,_,g,b,S,L,F){for(var B=0;B<_;B++){for(var J=0;J<g;J++)b[J]=p[J*_+B];for(te(b,S,L,F,g),J=0;J<g;J++)p[J*_+B]=S[J]}for(J=0;J<g;J++){for(B=0;B<_;B++)b[B]=p[J*_+B];for(te(b,S,L,F,_),B=0;B<_;B++)p[J*_+B]=Math.sqrt(S[B])}}function te(p,_,g,b,S){g[0]=0,b[0]=-V,b[1]=+V;for(var L=1,F=0;L<S;L++){for(var B=(p[L]+L*L-(p[g[F]]+g[F]*g[F]))/(2*L-2*g[F]);B<=b[F];)F--,B=(p[L]+L*L-(p[g[F]]+g[F]*g[F]))/(2*L-2*g[F]);g[++F]=L,b[F]=B,b[F+1]=+V}for(L=0,F=0;L<S;L++){for(;b[F+1]<L;)F++;_[L]=(L-g[F])*(L-g[F])+p[g[F]]}}z.prototype.draw=function(p){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(p,this.buffer,this.middle);for(var _=this.ctx.getImageData(0,0,this.size,this.size),g=new Uint8ClampedArray(this.size*this.size),b=0;b<this.size*this.size;b++){var S=_.data[4*b+3]/255;this.gridOuter[b]=S===1?0:S===0?V:Math.pow(Math.max(0,.5-S),2),this.gridInner[b]=S===1?V:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(H(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),H(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),b=0;b<this.size*this.size;b++)g[b]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[b]-this.gridInner[b])/this.radius+this.cutoff))));return g},G.default=O;var $=function(p,_){this.requestManager=p,this.localIdeographFontFamily=_,this.entries={}};$.prototype.setURL=function(p){this.url=p},$.prototype.getGlyphs=function(p,_){var g=this,b=[];for(var S in p)for(var L=0,F=p[S];L<F.length;L+=1)b.push({stack:S,id:F[L]});s.asyncAll(b,(function(B,J){var re=B.stack,Ce=B.id,we=g.entries[re];we||(we=g.entries[re]={glyphs:{},requests:{},ranges:{}});var Se=we.glyphs[Ce];if(Se===void 0){if(Se=g._tinySDF(we,re,Ce))return we.glyphs[Ce]=Se,void J(null,{stack:re,id:Ce,glyph:Se});var Be=Math.floor(Ce/256);if(256*Be>65535)J(new Error("glyphs > 65535 not supported"));else if(we.ranges[Be])J(null,{stack:re,id:Ce,glyph:Se});else{var Ve=we.requests[Be];Ve||(Ve=we.requests[Be]=[],$.loadGlyphRange(re,Be,g.url,g.requestManager,(function(Ke,Pe){if(Pe){for(var He in Pe)g._doesCharSupportLocalGlyph(+He)||(we.glyphs[+He]=Pe[+He]);we.ranges[Be]=!0}for(var Qe=0,rt=Ve;Qe<rt.length;Qe+=1)(0,rt[Qe])(Ke,Pe);delete we.requests[Be]}))),Ve.push((function(Ke,Pe){Ke?J(Ke):Pe&&J(null,{stack:re,id:Ce,glyph:Pe[Ce]||null})}))}}else J(null,{stack:re,id:Ce,glyph:Se})}),(function(B,J){if(B)_(B);else if(J){for(var re={},Ce=0,we=J;Ce<we.length;Ce+=1){var Se=we[Ce],Be=Se.stack,Ve=Se.id,Ke=Se.glyph;(re[Be]||(re[Be]={}))[Ve]=Ke&&{id:Ke.id,bitmap:Ke.bitmap.clone(),metrics:Ke.metrics}}_(null,re)}}))},$.prototype._doesCharSupportLocalGlyph=function(p){return!!this.localIdeographFontFamily&&(s.isChar["CJK Unified Ideographs"](p)||s.isChar["Hangul Syllables"](p)||s.isChar.Hiragana(p)||s.isChar.Katakana(p))},$.prototype._tinySDF=function(p,_,g){var b=this.localIdeographFontFamily;if(b&&this._doesCharSupportLocalGlyph(g)){var S=p.tinySDF;if(!S){var L="400";/bold/i.test(_)?L="900":/medium/i.test(_)?L="500":/light/i.test(_)&&(L="200"),S=p.tinySDF=new $.TinySDF(24,3,8,.25,b,L)}return{id:g,bitmap:new s.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(g))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},$.loadGlyphRange=function(p,_,g,b,S){var L=256*_,F=L+255,B=b.transformRequest(b.normalizeGlyphsURL(g).replace("{fontstack}",p).replace("{range}",L+"-"+F),s.ResourceType.Glyphs);s.getArrayBuffer(B,(function(J,re){if(J)S(J);else if(re){for(var Ce={},we=0,Se=s.parseGlyphPBF(re);we<Se.length;we+=1){var Be=Se[we];Ce[Be.id]=Be}S(null,Ce)}}))},$.TinySDF=G;var ae=function(){this.specification=s.styleSpec.light.position};ae.prototype.possiblyEvaluate=function(p,_){return s.sphericalToCartesian(p.expression.evaluate(_))},ae.prototype.interpolate=function(p,_,g){return{x:s.number(p.x,_.x,g),y:s.number(p.y,_.y,g),z:s.number(p.z,_.z,g)}};var fe=new s.Properties({anchor:new s.DataConstantProperty(s.styleSpec.light.anchor),position:new ae,color:new s.DataConstantProperty(s.styleSpec.light.color),intensity:new s.DataConstantProperty(s.styleSpec.light.intensity)}),Y=(function(p){function _(g){p.call(this),this._transitionable=new s.Transitionable(fe),this.setLight(g),this._transitioning=this._transitionable.untransitioned()}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getLight=function(){return this._transitionable.serialize()},_.prototype.setLight=function(g,b){if(b===void 0&&(b={}),!this._validate(s.validateLight,g,b))for(var S in g){var L=g[S];s.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-11),L):this._transitionable.setValue(S,L)}},_.prototype.updateTransitions=function(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)},_.prototype.hasTransition=function(){return this._transitioning.hasTransition()},_.prototype.recalculate=function(g){this.properties=this._transitioning.possiblyEvaluate(g)},_.prototype._validate=function(g,b,S){return(!S||S.validate!==!1)&&s.emitValidationErrors(this,g.call(s.validateStyle,s.extend({value:b,style:{glyphs:!0,sprite:!0},styleSpec:s.styleSpec})))},_})(s.Evented),de=function(p,_){this.width=p,this.height=_,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};de.prototype.getDash=function(p,_){var g=p.join(",")+String(_);return this.dashEntry[g]||(this.dashEntry[g]=this.addDash(p,_)),this.dashEntry[g]},de.prototype.getDashRanges=function(p,_,g){var b=[],S=p.length%2==1?-p[p.length-1]*g:0,L=p[0]*g,F=!0;b.push({left:S,right:L,isDash:F,zeroLength:p[0]===0});for(var B=p[0],J=1;J<p.length;J++){var re=p[J];b.push({left:S=B*g,right:L=(B+=re)*g,isDash:F=!F,zeroLength:re===0})}return b},de.prototype.addRoundDash=function(p,_,g){for(var b=_/2,S=-g;S<=g;S++)for(var L=this.width*(this.nextRow+g+S),F=0,B=p[F],J=0;J<this.width;J++){J/B.right>1&&(B=p[++F]);var re=Math.abs(J-B.left),Ce=Math.abs(J-B.right),we=Math.min(re,Ce),Se=void 0,Be=S/g*(b+1);if(B.isDash){var Ve=b-Math.abs(Be);Se=Math.sqrt(we*we+Ve*Ve)}else Se=b-Math.sqrt(we*we+Be*Be);this.data[L+J]=Math.max(0,Math.min(255,Se+128))}},de.prototype.addRegularDash=function(p){for(var _=p.length-1;_>=0;--_){var g=p[_],b=p[_+1];g.zeroLength?p.splice(_,1):b&&b.isDash===g.isDash&&(b.left=g.left,p.splice(_,1))}var S=p[0],L=p[p.length-1];S.isDash===L.isDash&&(S.left=L.left-this.width,L.right=S.right+this.width);for(var F=this.width*this.nextRow,B=0,J=p[B],re=0;re<this.width;re++){re/J.right>1&&(J=p[++B]);var Ce=Math.abs(re-J.left),we=Math.abs(re-J.right),Se=Math.min(Ce,we);this.data[F+re]=Math.max(0,Math.min(255,(J.isDash?Se:-Se)+128))}},de.prototype.addDash=function(p,_){var g=_?7:0,b=2*g+1;if(this.nextRow+b>this.height)return s.warnOnce("LineAtlas out of space"),null;for(var S=0,L=0;L<p.length;L++)S+=p[L];if(S!==0){var F=this.width/S,B=this.getDashRanges(p,this.width,F);_?this.addRoundDash(B,F,g):this.addRegularDash(B)}var J={y:(this.nextRow+g+.5)/this.height,height:2*g/this.height,width:S};return this.nextRow+=b,this.dirty=!0,J},de.prototype.bind=function(p){var _=p.gl;this.texture?(_.bindTexture(_.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,_.texSubImage2D(_.TEXTURE_2D,0,0,0,this.width,this.height,_.ALPHA,_.UNSIGNED_BYTE,this.data))):(this.texture=_.createTexture(),_.bindTexture(_.TEXTURE_2D,this.texture),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.REPEAT),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.REPEAT),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.texImage2D(_.TEXTURE_2D,0,_.ALPHA,this.width,this.height,0,_.ALPHA,_.UNSIGNED_BYTE,this.data))};var D=function p(_,g){this.workerPool=_,this.actors=[],this.currentActor=0,this.id=s.uniqueId();for(var b=this.workerPool.acquire(this.id),S=0;S<b.length;S++){var L=new p.Actor(b[S],g,this.id);L.name="Worker "+S,this.actors.push(L)}};function oe(p,_,g){var b=function(S,L){if(S)return g(S);if(L){var F=s.pick(s.extend(L,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);L.vector_layers&&(F.vectorLayers=L.vector_layers,F.vectorLayerIds=F.vectorLayers.map((function(B){return B.id}))),F.tiles=_.canonicalizeTileset(F,p.url),g(null,F)}};return p.url?s.getJSON(_.transformRequest(_.normalizeSourceURL(p.url),s.ResourceType.Source),b):s.browser.frame((function(){return b(null,p)}))}D.prototype.broadcast=function(p,_,g){s.asyncAll(this.actors,(function(b,S){b.send(p,_,S)}),g=g||function(){})},D.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},D.prototype.remove=function(){this.actors.forEach((function(p){p.remove()})),this.actors=[],this.workerPool.release(this.id)},D.Actor=s.Actor;var ue=function(p,_,g){this.bounds=s.LngLatBounds.convert(this.validateBounds(p)),this.minzoom=_||0,this.maxzoom=g||24};ue.prototype.validateBounds=function(p){return Array.isArray(p)&&p.length===4?[Math.max(-180,p[0]),Math.max(-90,p[1]),Math.min(180,p[2]),Math.min(90,p[3])]:[-180,-90,180,90]},ue.prototype.contains=function(p){var _=Math.pow(2,p.z),g=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*_),b=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*_),S=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*_),L=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*_);return p.x>=g&&p.x<S&&p.y>=b&&p.y<L};var ge=(function(p){function _(g,b,S,L){if(p.call(this),this.id=g,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(b,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},b),this._collectResourceTiming=b.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(L)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(){var g=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=oe(this._options,this.map._requestManager,(function(b,S){g._tileJSONRequest=null,g._loaded=!0,b?g.fire(new s.ErrorEvent(b)):S&&(s.extend(g,S),S.bounds&&(g.tileBounds=new ue(S.bounds,g.minzoom,g.maxzoom)),s.postTurnstileEvent(S.tiles,g.map._requestManager._customAccessToken),s.postMapLoadEvent(S.tiles,g.map._getMapId(),g.map._requestManager._skuToken,g.map._requestManager._customAccessToken),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))}))},_.prototype.loaded=function(){return this._loaded},_.prototype.hasTile=function(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)},_.prototype.onAdd=function(g){this.map=g,this.load()},_.prototype.setSourceProperty=function(g){this._tileJSONRequest&&this._tileJSONRequest.cancel(),g(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},_.prototype.setTiles=function(g){var b=this;return this.setSourceProperty((function(){b._options.tiles=g})),this},_.prototype.setUrl=function(g){var b=this;return this.setSourceProperty((function(){b.url=g,b._options.url=g})),this},_.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},_.prototype.serialize=function(){return s.extend({},this._options)},_.prototype.loadTile=function(g,b){var S=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),L={request:this.map._requestManager.transformRequest(S,s.ResourceType.Tile),uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function F(B,J){return delete g.request,g.aborted?b(null):B&&B.status!==404?b(B):(J&&J.resourceTiming&&(g.resourceTiming=J.resourceTiming),this.map._refreshExpiredTiles&&J&&g.setExpiryData(J),g.loadVectorData(J,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),b(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}L.request.collectResourceTiming=this._collectResourceTiming,g.actor&&g.state!=="expired"?g.state==="loading"?g.reloadCallback=b:g.request=g.actor.send("reloadTile",L,F.bind(this)):(g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",L,F.bind(this)))},_.prototype.abortTile=function(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id},void 0)},_.prototype.unloadTile=function(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id},void 0)},_.prototype.hasTransition=function(){return!1},_})(s.Evented),Ne=(function(p){function _(g,b,S,L){p.call(this),this.id=g,this.dispatcher=S,this.setEventedParent(L),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},b),s.extend(this,s.pick(b,["url","scheme","tileSize"]))}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(){var g=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=oe(this._options,this.map._requestManager,(function(b,S){g._tileJSONRequest=null,g._loaded=!0,b?g.fire(new s.ErrorEvent(b)):S&&(s.extend(g,S),S.bounds&&(g.tileBounds=new ue(S.bounds,g.minzoom,g.maxzoom)),s.postTurnstileEvent(S.tiles),s.postMapLoadEvent(S.tiles,g.map._getMapId(),g.map._requestManager._skuToken),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))}))},_.prototype.loaded=function(){return this._loaded},_.prototype.onAdd=function(g){this.map=g,this.load()},_.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},_.prototype.serialize=function(){return s.extend({},this._options)},_.prototype.hasTile=function(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)},_.prototype.loadTile=function(g,b){var S=this,L=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);g.request=s.getImage(this.map._requestManager.transformRequest(L,s.ResourceType.Tile),(function(F,B){if(delete g.request,g.aborted)g.state="unloaded",b(null);else if(F)g.state="errored",b(F);else if(B){S.map._refreshExpiredTiles&&g.setExpiryData(B),delete B.cacheControl,delete B.expires;var J=S.map.painter.context,re=J.gl;g.texture=S.map.painter.getTileTexture(B.width),g.texture?g.texture.update(B,{useMipmap:!0}):(g.texture=new s.Texture(J,B,re.RGBA,{useMipmap:!0}),g.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST),J.extTextureFilterAnisotropic&&re.texParameterf(re.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax)),g.state="loaded",s.cacheEntryPossiblyAdded(S.dispatcher),b(null)}}))},_.prototype.abortTile=function(g,b){g.request&&(g.request.cancel(),delete g.request),b()},_.prototype.unloadTile=function(g,b){g.texture&&this.map.painter.saveTileTexture(g.texture),b()},_.prototype.hasTransition=function(){return!1},_})(s.Evented),Ee=(function(p){function _(g,b,S,L){p.call(this,g,b,S,L),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},b),this.encoding=b.encoding||"mapbox"}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},_.prototype.loadTile=function(g,b){var S=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function L(F,B){F&&(g.state="errored",b(F)),B&&(g.dem=B,g.needsHillshadePrepare=!0,g.state="loaded",b(null))}g.request=s.getImage(this.map._requestManager.transformRequest(S,s.ResourceType.Tile),(function(F,B){if(delete g.request,g.aborted)g.state="unloaded",b(null);else if(F)g.state="errored",b(F);else if(B){this.map._refreshExpiredTiles&&g.setExpiryData(B),delete B.cacheControl,delete B.expires;var J=s.window.ImageBitmap&&B instanceof s.window.ImageBitmap&&s.offscreenCanvasSupported()?B:s.browser.getImageData(B,1),re={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:J,encoding:this.encoding};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",re,L.bind(this)))}}).bind(this)),g.neighboringTiles=this._getNeighboringTiles(g.tileID)},_.prototype._getNeighboringTiles=function(g){var b=g.canonical,S=Math.pow(2,b.z),L=(b.x-1+S)%S,F=b.x===0?g.wrap-1:g.wrap,B=(b.x+1+S)%S,J=b.x+1===S?g.wrap+1:g.wrap,re={};return re[new s.OverscaledTileID(g.overscaledZ,F,b.z,L,b.y).key]={backfilled:!1},re[new s.OverscaledTileID(g.overscaledZ,J,b.z,B,b.y).key]={backfilled:!1},b.y>0&&(re[new s.OverscaledTileID(g.overscaledZ,F,b.z,L,b.y-1).key]={backfilled:!1},re[new s.OverscaledTileID(g.overscaledZ,g.wrap,b.z,b.x,b.y-1).key]={backfilled:!1},re[new s.OverscaledTileID(g.overscaledZ,J,b.z,B,b.y-1).key]={backfilled:!1}),b.y+1<S&&(re[new s.OverscaledTileID(g.overscaledZ,F,b.z,L,b.y+1).key]={backfilled:!1},re[new s.OverscaledTileID(g.overscaledZ,g.wrap,b.z,b.x,b.y+1).key]={backfilled:!1},re[new s.OverscaledTileID(g.overscaledZ,J,b.z,B,b.y+1).key]={backfilled:!1}),re},_.prototype.unloadTile=function(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded",g.actor&&g.actor.send("removeDEMTile",{uid:g.uid,source:this.id})},_})(Ne),se=(function(p){function _(g,b,S,L){p.call(this),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(L),this._data=b.data,this._options=s.extend({},b),this._collectResourceTiming=b.collectResourceTiming,this._resourceTiming=[],b.maxzoom!==void 0&&(this.maxzoom=b.maxzoom),b.type&&(this.type=b.type),b.attribution&&(this.attribution=b.attribution),this.promoteId=b.promoteId;var F=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:b.cluster||!1,geojsonVtOptions:{buffer:(b.buffer!==void 0?b.buffer:128)*F,tolerance:(b.tolerance!==void 0?b.tolerance:.375)*F,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:b.lineMetrics||!1,generateId:b.generateId||!1},superclusterOptions:{maxZoom:b.clusterMaxZoom!==void 0?Math.min(b.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,b.clusterMinPoints||2),extent:s.EXTENT,radius:(b.clusterRadius||50)*F,log:!1,generateId:b.generateId||!1},clusterProperties:b.clusterProperties,filter:b.filter},b.workerOptions)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(){var g=this;this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(b){if(b)g.fire(new s.ErrorEvent(b));else{var S={dataType:"source",sourceDataType:"metadata"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(S.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new s.Event("data",S))}}))},_.prototype.onAdd=function(g){this.map=g,this.load()},_.prototype.setData=function(g){var b=this;return this._data=g,this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(S){if(S)b.fire(new s.ErrorEvent(S));else{var L={dataType:"source",sourceDataType:"content"};b._collectResourceTiming&&b._resourceTiming&&b._resourceTiming.length>0&&(L.resourceTiming=b._resourceTiming,b._resourceTiming=[]),b.fire(new s.Event("data",L))}})),this},_.prototype.getClusterExpansionZoom=function(g,b){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},b),this},_.prototype.getClusterChildren=function(g,b){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},b),this},_.prototype.getClusterLeaves=function(g,b,S,L){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:b,offset:S},L),this},_.prototype._updateWorkerData=function(g){var b=this;this._loaded=!1;var S=s.extend({},this.workerOptions),L=this._data;typeof L=="string"?(S.request=this.map._requestManager.transformRequest(s.browser.resolveURL(L),s.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(L),this.actor.send(this.type+".loadData",S,(function(F,B){b._removed||B&&B.abandoned||(b._loaded=!0,B&&B.resourceTiming&&B.resourceTiming[b.id]&&(b._resourceTiming=B.resourceTiming[b.id].slice(0)),b.actor.send(b.type+".coalesce",{source:S.source},null),g(F))}))},_.prototype.loaded=function(){return this._loaded},_.prototype.loadTile=function(g,b){var S=this,L=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(L,{type:this.type,uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(F,B){return delete g.request,g.unloadVectorData(),g.aborted?b(null):F?b(F):(g.loadVectorData(B,S.map.painter,L==="reloadTile"),b(null))}))},_.prototype.abortTile=function(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0},_.prototype.unloadTile=function(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})},_.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},_.prototype.serialize=function(){return s.extend({},this._options,{type:this.type,data:this._data})},_.prototype.hasTransition=function(){return!1},_})(s.Evented),q=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),j=(function(p){function _(g,b,S,L){p.call(this),this.id=g,this.dispatcher=S,this.coordinates=b.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(L),this.options=b}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(g,b){var S=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(function(L,F){S._loaded=!0,L?S.fire(new s.ErrorEvent(L)):F&&(S.image=F,g&&(S.coordinates=g),b&&b(),S._finishLoading())}))},_.prototype.loaded=function(){return this._loaded},_.prototype.updateImage=function(g){var b=this;return this.image&&g.url?(this.options.url=g.url,this.load(g.coordinates,(function(){b.texture=null})),this):this},_.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))},_.prototype.onAdd=function(g){this.map=g,this.load()},_.prototype.setCoordinates=function(g){var b=this;this.coordinates=g;var S=g.map(s.MercatorCoordinate.fromLngLat);this.tileID=(function(F){for(var B=1/0,J=1/0,re=-1/0,Ce=-1/0,we=0,Se=F;we<Se.length;we+=1){var Be=Se[we];B=Math.min(B,Be.x),J=Math.min(J,Be.y),re=Math.max(re,Be.x),Ce=Math.max(Ce,Be.y)}var Ve=Math.max(re-B,Ce-J),Ke=Math.max(0,Math.floor(-Math.log(Ve)/Math.LN2)),Pe=Math.pow(2,Ke);return new s.CanonicalTileID(Ke,Math.floor((B+re)/2*Pe),Math.floor((J+Ce)/2*Pe))})(S),this.minzoom=this.maxzoom=this.tileID.z;var L=S.map((function(F){return b.tileID.getTilePoint(F)._round()}));return this._boundsArray=new s.StructArrayLayout4i8,this._boundsArray.emplaceBack(L[0].x,L[0].y,0,0),this._boundsArray.emplaceBack(L[1].x,L[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(L[3].x,L[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(L[2].x,L[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this},_.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var g=this.map.painter.context,b=g.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,q.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new s.Texture(g,this.image,b.RGBA),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE)),this.tiles){var L=this.tiles[S];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture)}}},_.prototype.loadTile=function(g,b){this.tileID&&this.tileID.equals(g.tileID.canonical)?(this.tiles[String(g.tileID.wrap)]=g,g.buckets={},b(null)):(g.state="errored",b(null))},_.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},_.prototype.hasTransition=function(){return!1},_})(s.Evented),ze=(function(p){function _(g,b,S,L){p.call(this,g,b,S,L),this.roundZoom=!0,this.type="video",this.options=b}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(){var g=this;this._loaded=!1;var b=this.options;this.urls=[];for(var S=0,L=b.urls;S<L.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(L[S],s.ResourceType.Source).url);s.getVideo(this.urls,(function(F,B){g._loaded=!0,F?g.fire(new s.ErrorEvent(F)):B&&(g.video=B,g.video.loop=!0,g.video.setAttribute("playsinline",""),g.video.addEventListener("playing",(function(){g.map.triggerRepaint()})),g.map&&g.video.play(),g._finishLoading())}))},_.prototype.pause=function(){this.video&&this.video.pause()},_.prototype.play=function(){this.video&&this.video.play()},_.prototype.seek=function(g){if(this.video){var b=this.video.seekable;g<b.start(0)||g>b.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+b.start(0)+" and "+b.end(0)+"-second mark."))):this.video.currentTime=g}},_.prototype.getVideo=function(){return this.video},_.prototype.onAdd=function(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},_.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var g=this.map.painter.context,b=g.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,q.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.texSubImage2D(b.TEXTURE_2D,0,0,0,b.RGBA,b.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(g,this.video,b.RGBA),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE)),this.tiles){var L=this.tiles[S];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture)}}},_.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},_.prototype.hasTransition=function(){return this.video&&!this.video.paused},_})(j),je=(function(p){function _(g,b,S,L){p.call(this,g,b,S,L),b.coordinates?Array.isArray(b.coordinates)&&b.coordinates.length===4&&!b.coordinates.some((function(F){return!Array.isArray(F)||F.length!==2||F.some((function(B){return typeof B!="number"}))}))||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'missing required property "coordinates"'))),b.animate&&typeof b.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'optional "animate" property must be a boolean value'))),b.canvas?typeof b.canvas=="string"||b.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'missing required property "canvas"'))),this.options=b,this.animate=b.animate===void 0||b.animate}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},_.prototype.getCanvas=function(){return this.canvas},_.prototype.onAdd=function(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()},_.prototype.onRemove=function(){this.pause()},_.prototype.prepare=function(){var g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var b=this.map.painter.context,S=b.gl;for(var L in this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,q.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(b,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var F=this.tiles[L];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture)}}},_.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},_.prototype.hasTransition=function(){return this._playing},_.prototype._hasInvalidDimensions=function(){for(var g=0,b=[this.canvas.width,this.canvas.height];g<b.length;g+=1){var S=b[g];if(isNaN(S)||S<=0)return!0}return!1},_})(j),qe={vector:ge,raster:Ne,"raster-dem":Ee,geojson:se,video:ze,image:j,canvas:je};function yt(p,_){var g=s.identity([]);return s.translate(g,g,[1,1,0]),s.scale(g,g,[.5*p.width,.5*p.height,1]),s.multiply(g,g,p.calculatePosMatrix(_.toUnwrapped()))}function xt(p,_,g,b,S,L){var F=(function(Ke,Pe,He){if(Ke)for(var Qe=0,rt=Ke;Qe<rt.length;Qe+=1){var ht=Pe[rt[Qe]];if(ht&&ht.source===He&&ht.type==="fill-extrusion")return!0}else for(var lt in Pe){var ft=Pe[lt];if(ft.source===He&&ft.type==="fill-extrusion")return!0}return!1})(S&&S.layers,_,p.id),B=L.maxPitchScaleFactor(),J=p.tilesIn(b,B,F);J.sort(Et);for(var re=[],Ce=0,we=J;Ce<we.length;Ce+=1){var Se=we[Ce];re.push({wrappedTileID:Se.tileID.wrapped().key,queryResults:Se.tile.queryRenderedFeatures(_,g,p._state,Se.queryGeometry,Se.cameraQueryGeometry,Se.scale,S,L,B,yt(p.transform,Se.tileID))})}var Be=(function(Ke){for(var Pe={},He={},Qe=0,rt=Ke;Qe<rt.length;Qe+=1){var ht=rt[Qe],lt=ht.queryResults,ft=ht.wrappedTileID,wt=He[ft]=He[ft]||{};for(var Vt in lt)for(var Ot=lt[Vt],en=wt[Vt]=wt[Vt]||{},vn=Pe[Vt]=Pe[Vt]||[],Cn=0,In=Ot;Cn<In.length;Cn+=1){var wi=In[Cn];en[wi.featureIndex]||(en[wi.featureIndex]=!0,vn.push(wi))}}return Pe})(re);for(var Ve in Be)Be[Ve].forEach((function(Ke){var Pe=Ke.feature,He=p.getFeatureState(Pe.layer["source-layer"],Pe.id);Pe.source=Pe.layer.source,Pe.layer["source-layer"]&&(Pe.sourceLayer=Pe.layer["source-layer"]),Pe.state=He}));return Be}function Et(p,_){var g=p.tileID,b=_.tileID;return g.overscaledZ-b.overscaledZ||g.canonical.y-b.canonical.y||g.wrap-b.wrap||g.canonical.x-b.canonical.x}var kt=function(p,_){this.max=p,this.onRemove=_,this.reset()};kt.prototype.reset=function(){for(var p in this.data)for(var _=0,g=this.data[p];_<g.length;_+=1){var b=g[_];b.timeout&&clearTimeout(b.timeout),this.onRemove(b.value)}return this.data={},this.order=[],this},kt.prototype.add=function(p,_,g){var b=this,S=p.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var L={value:_,timeout:void 0};if(g!==void 0&&(L.timeout=setTimeout((function(){b.remove(p,L)}),g)),this.data[S].push(L),this.order.push(S),this.order.length>this.max){var F=this._getAndRemoveByKey(this.order[0]);F&&this.onRemove(F)}return this},kt.prototype.has=function(p){return p.wrapped().key in this.data},kt.prototype.getAndRemove=function(p){return this.has(p)?this._getAndRemoveByKey(p.wrapped().key):null},kt.prototype._getAndRemoveByKey=function(p){var _=this.data[p].shift();return _.timeout&&clearTimeout(_.timeout),this.data[p].length===0&&delete this.data[p],this.order.splice(this.order.indexOf(p),1),_.value},kt.prototype.getByKey=function(p){var _=this.data[p];return _?_[0].value:null},kt.prototype.get=function(p){return this.has(p)?this.data[p.wrapped().key][0].value:null},kt.prototype.remove=function(p,_){if(!this.has(p))return this;var g=p.wrapped().key,b=_===void 0?0:this.data[g].indexOf(_),S=this.data[g][b];return this.data[g].splice(b,1),S.timeout&&clearTimeout(S.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(S.value),this.order.splice(this.order.indexOf(g),1),this},kt.prototype.setMaxSize=function(p){for(this.max=p;this.order.length>this.max;){var _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this},kt.prototype.filter=function(p){var _=[];for(var g in this.data)for(var b=0,S=this.data[g];b<S.length;b+=1){var L=S[b];p(L.value)||_.push(L)}for(var F=0,B=_;F<B.length;F+=1){var J=B[F];this.remove(J.value.tileID,J)}};var hn=function(p,_,g){this.context=p;var b=p.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),p.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,_.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete _.arrayBuffer};hn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},hn.prototype.updateData=function(p){var _=this.context.gl;this.context.unbindVAO(),this.bind(),_.bufferSubData(_.ELEMENT_ARRAY_BUFFER,0,p.arrayBuffer)},hn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var wn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ge=function(p,_,g,b){this.length=_.length,this.attributes=g,this.itemSize=_.bytesPerElement,this.dynamicDraw=b,this.context=p;var S=p.gl;this.buffer=S.createBuffer(),p.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,_.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete _.arrayBuffer};Ge.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ge.prototype.updateData=function(p){var _=this.context.gl;this.bind(),_.bufferSubData(_.ARRAY_BUFFER,0,p.arrayBuffer)},Ge.prototype.enableAttributes=function(p,_){for(var g=0;g<this.attributes.length;g++){var b=_.attributes[this.attributes[g].name];b!==void 0&&p.enableVertexAttribArray(b)}},Ge.prototype.setVertexAttribPointers=function(p,_,g){for(var b=0;b<this.attributes.length;b++){var S=this.attributes[b],L=_.attributes[S.name];L!==void 0&&p.vertexAttribPointer(L,S.components,p[wn[S.type]],!1,this.itemSize,S.offset+this.itemSize*(g||0))}},Ge.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ve=function(p){this.gl=p.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ve.prototype.get=function(){return this.current},ve.prototype.set=function(p){},ve.prototype.getDefault=function(){return this.default},ve.prototype.setDefault=function(){this.set(this.default)};var W=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return s.Color.transparent},_.prototype.set=function(g){var b=this.current;(g.r!==b.r||g.g!==b.g||g.b!==b.b||g.a!==b.a||this.dirty)&&(this.gl.clearColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)},_})(ve),Ze=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return 1},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.clearDepth(g),this.current=g,this.dirty=!1)},_})(ve),Re=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return 0},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.clearStencil(g),this.current=g,this.dirty=!1)},_})(ve),ce=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return[!0,!0,!0,!0]},_.prototype.set=function(g){var b=this.current;(g[0]!==b[0]||g[1]!==b[1]||g[2]!==b[2]||g[3]!==b[3]||this.dirty)&&(this.gl.colorMask(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)},_})(ve),me=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!0},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.depthMask(g),this.current=g,this.dirty=!1)},_})(ve),_e=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return 255},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.stencilMask(g),this.current=g,this.dirty=!1)},_})(ve),Ie=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},_.prototype.set=function(g){var b=this.current;(g.func!==b.func||g.ref!==b.ref||g.mask!==b.mask||this.dirty)&&(this.gl.stencilFunc(g.func,g.ref,g.mask),this.current=g,this.dirty=!1)},_})(ve),pe=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){var g=this.gl;return[g.KEEP,g.KEEP,g.KEEP]},_.prototype.set=function(g){var b=this.current;(g[0]!==b[0]||g[1]!==b[1]||g[2]!==b[2]||this.dirty)&&(this.gl.stencilOp(g[0],g[1],g[2]),this.current=g,this.dirty=!1)},_})(ve),Te=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;g?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST),this.current=g,this.dirty=!1}},_})(ve),We=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return[0,1]},_.prototype.set=function(g){var b=this.current;(g[0]!==b[0]||g[1]!==b[1]||this.dirty)&&(this.gl.depthRange(g[0],g[1]),this.current=g,this.dirty=!1)},_})(ve),tt=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;g?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST),this.current=g,this.dirty=!1}},_})(ve),nt=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return this.gl.LESS},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.depthFunc(g),this.current=g,this.dirty=!1)},_})(ve),bt=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;g?b.enable(b.BLEND):b.disable(b.BLEND),this.current=g,this.dirty=!1}},_})(ve),on=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){var g=this.gl;return[g.ONE,g.ZERO]},_.prototype.set=function(g){var b=this.current;(g[0]!==b[0]||g[1]!==b[1]||this.dirty)&&(this.gl.blendFunc(g[0],g[1]),this.current=g,this.dirty=!1)},_})(ve),an=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return s.Color.transparent},_.prototype.set=function(g){var b=this.current;(g.r!==b.r||g.g!==b.g||g.b!==b.b||g.a!==b.a||this.dirty)&&(this.gl.blendColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)},_})(ve),Ii=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return this.gl.FUNC_ADD},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.blendEquation(g),this.current=g,this.dirty=!1)},_})(ve),ji=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;g?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE),this.current=g,this.dirty=!1}},_})(ve),Pi=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return this.gl.BACK},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.cullFace(g),this.current=g,this.dirty=!1)},_})(ve),Mr=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return this.gl.CCW},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.frontFace(g),this.current=g,this.dirty=!1)},_})(ve),_i=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)},_})(ve),ss=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return this.gl.TEXTURE0},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.activeTexture(g),this.current=g,this.dirty=!1)},_})(ve),Ei=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){var g=this.gl;return[0,0,g.drawingBufferWidth,g.drawingBufferHeight]},_.prototype.set=function(g){var b=this.current;(g[0]!==b[0]||g[1]!==b[1]||g[2]!==b[2]||g[3]!==b[3]||this.dirty)&&(this.gl.viewport(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)},_})(ve),Mi=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,g),this.current=g,this.dirty=!1}},_})(ve),zs=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.bindRenderbuffer(b.RENDERBUFFER,g),this.current=g,this.dirty=!1}},_})(ve),Ao=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.bindTexture(b.TEXTURE_2D,g),this.current=g,this.dirty=!1}},_})(ve),Ea=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.bindBuffer(b.ARRAY_BUFFER,g),this.current=g,this.dirty=!1}},_})(ve),_s=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){var b=this.gl;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,g),this.current=g,this.dirty=!1},_})(ve),Ur=(function(p){function _(g){p.call(this,g),this.vao=g.extVertexArrayObject}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){this.vao&&(g!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(g),this.current=g,this.dirty=!1)},_})(ve),Xr=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return 4},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.pixelStorei(b.UNPACK_ALIGNMENT,g),this.current=g,this.dirty=!1}},_})(ve),vs=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,g),this.current=g,this.dirty=!1}},_})(ve),Pl=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,g),this.current=g,this.dirty=!1}},_})(ve),Ti=(function(p){function _(g,b){p.call(this,g),this.context=g,this.parent=b}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_})(ve),ee=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.setDirty=function(){this.dirty=!0},_.prototype.set=function(g){if(g!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var b=this.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,g,0),this.current=g,this.dirty=!1}},_})(Ti),le=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.set=function(g){if(g!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var b=this.gl;b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,g),this.current=g,this.dirty=!1}},_})(Ti),ye=function(p,_,g,b){this.context=p,this.width=_,this.height=g;var S=this.framebuffer=p.gl.createFramebuffer();this.colorAttachment=new ee(p,S),b&&(this.depthAttachment=new le(p,S))};ye.prototype.destroy=function(){var p=this.context.gl,_=this.colorAttachment.get();if(_&&p.deleteTexture(_),this.depthAttachment){var g=this.depthAttachment.get();g&&p.deleteRenderbuffer(g)}p.deleteFramebuffer(this.framebuffer)};var Ae=function(p,_,g){this.func=p,this.mask=_,this.range=g};Ae.ReadOnly=!1,Ae.ReadWrite=!0,Ae.disabled=new Ae(519,Ae.ReadOnly,[0,1]);var Me=function(p,_,g,b,S,L){this.test=p,this.ref=_,this.mask=g,this.fail=b,this.depthFail=S,this.pass=L};Me.disabled=new Me({func:519,mask:0},0,0,7680,7680,7680);var $e=function(p,_,g){this.blendFunction=p,this.blendColor=_,this.mask=g};$e.disabled=new $e($e.Replace=[1,0],s.Color.transparent,[!1,!1,!1,!1]),$e.unblended=new $e($e.Replace,s.Color.transparent,[!0,!0,!0,!0]),$e.alphaBlended=new $e([1,771],s.Color.transparent,[!0,!0,!0,!0]);var Ye=function(p,_,g){this.enable=p,this.mode=_,this.frontFace=g};Ye.disabled=new Ye(!1,1029,2305),Ye.backCCW=new Ye(!0,1029,2305);var be=function(p){this.gl=p,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new W(this),this.clearDepth=new Ze(this),this.clearStencil=new Re(this),this.colorMask=new ce(this),this.depthMask=new me(this),this.stencilMask=new _e(this),this.stencilFunc=new Ie(this),this.stencilOp=new pe(this),this.stencilTest=new Te(this),this.depthRange=new We(this),this.depthTest=new tt(this),this.depthFunc=new nt(this),this.blend=new bt(this),this.blendFunc=new on(this),this.blendColor=new an(this),this.blendEquation=new Ii(this),this.cullFace=new ji(this),this.cullFaceSide=new Pi(this),this.frontFace=new Mr(this),this.program=new _i(this),this.activeTexture=new ss(this),this.viewport=new Ei(this),this.bindFramebuffer=new Mi(this),this.bindRenderbuffer=new zs(this),this.bindTexture=new Ao(this),this.bindVertexBuffer=new Ea(this),this.bindElementBuffer=new _s(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ur(this),this.pixelStoreUnpack=new Xr(this),this.pixelStoreUnpackPremultiplyAlpha=new vs(this),this.pixelStoreUnpackFlipY=new Pl(this),this.extTextureFilterAnisotropic=p.getExtension("EXT_texture_filter_anisotropic")||p.getExtension("MOZ_EXT_texture_filter_anisotropic")||p.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=p.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=p.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(p.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=p.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=p.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=p.getParameter(p.MAX_TEXTURE_SIZE)};be.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},be.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},be.prototype.createIndexBuffer=function(p,_){return new hn(this,p,_)},be.prototype.createVertexBuffer=function(p,_,g){return new Ge(this,p,_,g)},be.prototype.createRenderbuffer=function(p,_,g){var b=this.gl,S=b.createRenderbuffer();return this.bindRenderbuffer.set(S),b.renderbufferStorage(b.RENDERBUFFER,p,_,g),this.bindRenderbuffer.set(null),S},be.prototype.createFramebuffer=function(p,_,g){return new ye(this,p,_,g)},be.prototype.clear=function(p){var _=p.color,g=p.depth,b=this.gl,S=0;_&&(S|=b.COLOR_BUFFER_BIT,this.clearColor.set(_),this.colorMask.set([!0,!0,!0,!0])),g!==void 0&&(S|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),b.clear(S)},be.prototype.setCullFace=function(p){p.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(p.mode),this.frontFace.set(p.frontFace))},be.prototype.setDepthMode=function(p){p.func!==this.gl.ALWAYS||p.mask?(this.depthTest.set(!0),this.depthFunc.set(p.func),this.depthMask.set(p.mask),this.depthRange.set(p.range)):this.depthTest.set(!1)},be.prototype.setStencilMode=function(p){p.test.func!==this.gl.ALWAYS||p.mask?(this.stencilTest.set(!0),this.stencilMask.set(p.mask),this.stencilOp.set([p.fail,p.depthFail,p.pass]),this.stencilFunc.set({func:p.test.func,ref:p.ref,mask:p.test.mask})):this.stencilTest.set(!1)},be.prototype.setColorMode=function(p){s.deepEqual(p.blendFunction,$e.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(p.blendFunction),this.blendColor.set(p.blendColor)),this.colorMask.set(p.mask)},be.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ke=(function(p){function _(g,b,S){var L=this;p.call(this),this.id=g,this.dispatcher=S,this.on("data",(function(F){F.dataType==="source"&&F.sourceDataType==="metadata"&&(L._sourceLoaded=!0),L._sourceLoaded&&!L._paused&&F.dataType==="source"&&F.sourceDataType==="content"&&(L.reload(),L.transform&&L.update(L.transform))})),this.on("error",(function(){L._sourceErrored=!0})),this._source=(function(F,B,J,re){var Ce=new qe[B.type](F,B,J,re);if(Ce.id!==F)throw new Error("Expected Source id to be "+F+" instead of "+Ce.id);return s.bindAll(["load","abort","unload","serialize","prepare"],Ce),Ce})(g,b,S,this),this._tiles={},this._cache=new kt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new s.SourceFeatureState}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.onAdd=function(g){this.map=g,this._maxTileCacheSize=g?g._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(g)},_.prototype.onRemove=function(g){this._source&&this._source.onRemove&&this._source.onRemove(g)},_.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var g in this._tiles){var b=this._tiles[g];if(b.state!=="loaded"&&b.state!=="errored")return!1}return!0},_.prototype.getSource=function(){return this._source},_.prototype.pause=function(){this._paused=!0},_.prototype.resume=function(){if(this._paused){var g=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,g&&this.reload(),this.transform&&this.update(this.transform)}},_.prototype._loadTile=function(g,b){return this._source.loadTile(g,b)},_.prototype._unloadTile=function(g){if(this._source.unloadTile)return this._source.unloadTile(g,(function(){}))},_.prototype._abortTile=function(g){if(this._source.abortTile)return this._source.abortTile(g,(function(){}))},_.prototype.serialize=function(){return this._source.serialize()},_.prototype.prepare=function(g){for(var b in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[b];S.upload(g),S.prepare(this.map.style.imageManager)}},_.prototype.getIds=function(){return s.values(this._tiles).map((function(g){return g.tileID})).sort(it).map((function(g){return g.key}))},_.prototype.getRenderableIds=function(g){var b=this,S=[];for(var L in this._tiles)this._isIdRenderable(L,g)&&S.push(this._tiles[L]);return g?S.sort((function(F,B){var J=F.tileID,re=B.tileID,Ce=new s.Point(J.canonical.x,J.canonical.y)._rotate(b.transform.angle),we=new s.Point(re.canonical.x,re.canonical.y)._rotate(b.transform.angle);return J.overscaledZ-re.overscaledZ||we.y-Ce.y||we.x-Ce.x})).map((function(F){return F.tileID.key})):S.map((function(F){return F.tileID})).sort(it).map((function(F){return F.key}))},_.prototype.hasRenderableParent=function(g){var b=this.findLoadedParent(g,0);return!!b&&this._isIdRenderable(b.tileID.key)},_.prototype._isIdRenderable=function(g,b){return this._tiles[g]&&this._tiles[g].hasData()&&!this._coveredTiles[g]&&(b||!this._tiles[g].holdingForFade())},_.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var g in this._cache.reset(),this._tiles)this._tiles[g].state!=="errored"&&this._reloadTile(g,"reloading")},_.prototype._reloadTile=function(g,b){var S=this._tiles[g];S&&(S.state!=="loading"&&(S.state=b),this._loadTile(S,this._tileLoaded.bind(this,S,g,b)))},_.prototype._tileLoaded=function(g,b,S,L){if(L)return g.state="errored",void(L.status!==404?this._source.fire(new s.ErrorEvent(L,{tile:g})):this.update(this.transform));g.timeAdded=s.browser.now(),S==="expired"&&(g.refreshedUponExpiration=!0),this._setTileReloadTimer(b,g),this.getSource().type==="raster-dem"&&g.dem&&this._backfillDEM(g),this._state.initializeTileState(g,this.map?this.map.painter:null),this._source.fire(new s.Event("data",{dataType:"source",tile:g,coord:g.tileID}))},_.prototype._backfillDEM=function(g){for(var b=this.getRenderableIds(),S=0;S<b.length;S++){var L=b[S];if(g.neighboringTiles&&g.neighboringTiles[L]){var F=this.getTileByID(L);B(g,F),B(F,g)}}function B(J,re){J.needsHillshadePrepare=!0;var Ce=re.tileID.canonical.x-J.tileID.canonical.x,we=re.tileID.canonical.y-J.tileID.canonical.y,Se=Math.pow(2,J.tileID.canonical.z),Be=re.tileID.key;Ce===0&&we===0||Math.abs(we)>1||(Math.abs(Ce)>1&&(Math.abs(Ce+Se)===1?Ce+=Se:Math.abs(Ce-Se)===1&&(Ce-=Se)),re.dem&&J.dem&&(J.dem.backfillBorder(re.dem,Ce,we),J.neighboringTiles&&J.neighboringTiles[Be]&&(J.neighboringTiles[Be].backfilled=!0)))}},_.prototype.getTile=function(g){return this.getTileByID(g.key)},_.prototype.getTileByID=function(g){return this._tiles[g]},_.prototype._retainLoadedChildren=function(g,b,S,L){for(var F in this._tiles){var B=this._tiles[F];if(!(L[F]||!B.hasData()||B.tileID.overscaledZ<=b||B.tileID.overscaledZ>S)){for(var J=B.tileID;B&&B.tileID.overscaledZ>b+1;){var re=B.tileID.scaledTo(B.tileID.overscaledZ-1);(B=this._tiles[re.key])&&B.hasData()&&(J=re)}for(var Ce=J;Ce.overscaledZ>b;)if(g[(Ce=Ce.scaledTo(Ce.overscaledZ-1)).key]){L[J.key]=J;break}}}},_.prototype.findLoadedParent=function(g,b){if(g.key in this._loadedParentTiles){var S=this._loadedParentTiles[g.key];return S&&S.tileID.overscaledZ>=b?S:null}for(var L=g.overscaledZ-1;L>=b;L--){var F=g.scaledTo(L),B=this._getLoadedTile(F);if(B)return B}},_.prototype._getLoadedTile=function(g){var b=this._tiles[g.key];return b&&b.hasData()?b:this._cache.getByKey(g.wrapped().key)},_.prototype.updateCacheSize=function(g){var b=Math.ceil(g.width/this._source.tileSize)+1,S=Math.ceil(g.height/this._source.tileSize)+1,L=Math.floor(b*S*5),F=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,L):L;this._cache.setMaxSize(F)},_.prototype.handleWrapJump=function(g){var b=Math.round((g-(this._prevLng===void 0?g:this._prevLng))/360);if(this._prevLng=g,b){var S={};for(var L in this._tiles){var F=this._tiles[L];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+b),S[F.tileID.key]=F}for(var B in this._tiles=S,this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(var J in this._tiles)this._setTileReloadTimer(J,this._tiles[J])}},_.prototype.update=function(g){var b=this;if(this.transform=g,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(g),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=g.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(wt){return new s.OverscaledTileID(wt.canonical.z,wt.wrap,wt.canonical.z,wt.canonical.x,wt.canonical.y)})):(S=g.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter((function(wt){return b._source.hasTile(wt)})))):S=[];var L=g.coveringZoomLevel(this._source),F=Math.max(L-_.maxOverzooming,this._source.minzoom),B=Math.max(L+_.maxUnderzooming,this._source.minzoom),J=this._updateRetainedTiles(S,L);if(At(this._source.type)){for(var re={},Ce={},we=0,Se=Object.keys(J);we<Se.length;we+=1){var Be=Se[we],Ve=J[Be],Ke=this._tiles[Be];if(Ke&&!(Ke.fadeEndTime&&Ke.fadeEndTime<=s.browser.now())){var Pe=this.findLoadedParent(Ve,F);Pe&&(this._addTile(Pe.tileID),re[Pe.tileID.key]=Pe.tileID),Ce[Be]=Ve}}for(var He in this._retainLoadedChildren(Ce,L,B,J),re)J[He]||(this._coveredTiles[He]=!0,J[He]=re[He])}for(var Qe in J)this._tiles[Qe].clearFadeHold();for(var rt=0,ht=s.keysDifference(this._tiles,J);rt<ht.length;rt+=1){var lt=ht[rt],ft=this._tiles[lt];ft.hasSymbolBuckets&&!ft.holdingForFade()?ft.setHoldDuration(this.map._fadeDuration):ft.hasSymbolBuckets&&!ft.symbolFadeFinished()||this._removeTile(lt)}this._updateLoadedParentTileCache()}},_.prototype.releaseSymbolFadeTiles=function(){for(var g in this._tiles)this._tiles[g].holdingForFade()&&this._removeTile(g)},_.prototype._updateRetainedTiles=function(g,b){for(var S={},L={},F=Math.max(b-_.maxOverzooming,this._source.minzoom),B=Math.max(b+_.maxUnderzooming,this._source.minzoom),J={},re=0,Ce=g;re<Ce.length;re+=1){var we=Ce[re],Se=this._addTile(we);S[we.key]=we,Se.hasData()||b<this._source.maxzoom&&(J[we.key]=we)}this._retainLoadedChildren(J,b,B,S);for(var Be=0,Ve=g;Be<Ve.length;Be+=1){var Ke=Ve[Be],Pe=this._tiles[Ke.key];if(!Pe.hasData()){if(b+1>this._source.maxzoom){var He=Ke.children(this._source.maxzoom)[0],Qe=this.getTile(He);if(Qe&&Qe.hasData()){S[He.key]=He;continue}}else{var rt=Ke.children(this._source.maxzoom);if(S[rt[0].key]&&S[rt[1].key]&&S[rt[2].key]&&S[rt[3].key])continue}for(var ht=Pe.wasRequested(),lt=Ke.overscaledZ-1;lt>=F;--lt){var ft=Ke.scaledTo(lt);if(L[ft.key]||(L[ft.key]=!0,!(Pe=this.getTile(ft))&&ht&&(Pe=this._addTile(ft)),Pe&&(S[ft.key]=ft,ht=Pe.wasRequested(),Pe.hasData())))break}}}return S},_.prototype._updateLoadedParentTileCache=function(){for(var g in this._loadedParentTiles={},this._tiles){for(var b=[],S=void 0,L=this._tiles[g].tileID;L.overscaledZ>0;){if(L.key in this._loadedParentTiles){S=this._loadedParentTiles[L.key];break}b.push(L.key);var F=L.scaledTo(L.overscaledZ-1);if(S=this._getLoadedTile(F))break;L=F}for(var B=0,J=b;B<J.length;B+=1)this._loadedParentTiles[J[B]]=S}},_.prototype._addTile=function(g){var b=this._tiles[g.key];if(b)return b;(b=this._cache.getAndRemove(g))&&(this._setTileReloadTimer(g.key,b),b.tileID=g,this._state.initializeTileState(b,this.map?this.map.painter:null),this._cacheTimers[g.key]&&(clearTimeout(this._cacheTimers[g.key]),delete this._cacheTimers[g.key],this._setTileReloadTimer(g.key,b)));var S=!!b;return S||(b=new s.Tile(g,this._source.tileSize*g.overscaleFactor()),this._loadTile(b,this._tileLoaded.bind(this,b,g.key,b.state))),b?(b.uses++,this._tiles[g.key]=b,S||this._source.fire(new s.Event("dataloading",{tile:b,coord:b.tileID,dataType:"source"})),b):null},_.prototype._setTileReloadTimer=function(g,b){var S=this;g in this._timers&&(clearTimeout(this._timers[g]),delete this._timers[g]);var L=b.getExpiryTimeout();L&&(this._timers[g]=setTimeout((function(){S._reloadTile(g,"expired"),delete S._timers[g]}),L))},_.prototype._removeTile=function(g){var b=this._tiles[g];b&&(b.uses--,delete this._tiles[g],this._timers[g]&&(clearTimeout(this._timers[g]),delete this._timers[g]),b.uses>0||(b.hasData()&&b.state!=="reloading"?this._cache.add(b.tileID,b,b.getExpiryTimeout()):(b.aborted=!0,this._abortTile(b),this._unloadTile(b))))},_.prototype.clearTiles=function(){for(var g in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(g);this._cache.reset()},_.prototype.tilesIn=function(g,b,S){var L=this,F=[],B=this.transform;if(!B)return F;for(var J=S?B.getCameraQueryGeometry(g):g,re=g.map((function(lt){return B.pointCoordinate(lt)})),Ce=J.map((function(lt){return B.pointCoordinate(lt)})),we=this.getIds(),Se=1/0,Be=1/0,Ve=-1/0,Ke=-1/0,Pe=0,He=Ce;Pe<He.length;Pe+=1){var Qe=He[Pe];Se=Math.min(Se,Qe.x),Be=Math.min(Be,Qe.y),Ve=Math.max(Ve,Qe.x),Ke=Math.max(Ke,Qe.y)}for(var rt=function(lt){var ft=L._tiles[we[lt]];if(!ft.holdingForFade()){var wt=ft.tileID,Vt=Math.pow(2,B.zoom-ft.tileID.overscaledZ),Ot=b*ft.queryPadding*s.EXTENT/ft.tileSize/Vt,en=[wt.getTilePoint(new s.MercatorCoordinate(Se,Be)),wt.getTilePoint(new s.MercatorCoordinate(Ve,Ke))];if(en[0].x-Ot<s.EXTENT&&en[0].y-Ot<s.EXTENT&&en[1].x+Ot>=0&&en[1].y+Ot>=0){var vn=re.map((function(In){return wt.getTilePoint(In)})),Cn=Ce.map((function(In){return wt.getTilePoint(In)}));F.push({tile:ft,tileID:wt,queryGeometry:vn,cameraQueryGeometry:Cn,scale:Vt})}}},ht=0;ht<we.length;ht++)rt(ht);return F},_.prototype.getVisibleCoordinates=function(g){for(var b=this,S=this.getRenderableIds(g).map((function(J){return b._tiles[J].tileID})),L=0,F=S;L<F.length;L+=1){var B=F[L];B.posMatrix=this.transform.calculatePosMatrix(B.toUnwrapped())}return S},_.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(At(this._source.type))for(var g in this._tiles){var b=this._tiles[g];if(b.fadeEndTime!==void 0&&b.fadeEndTime>=s.browser.now())return!0}return!1},_.prototype.setFeatureState=function(g,b,S){this._state.updateState(g=g||"_geojsonTileLayer",b,S)},_.prototype.removeFeatureState=function(g,b,S){this._state.removeFeatureState(g=g||"_geojsonTileLayer",b,S)},_.prototype.getFeatureState=function(g,b){return this._state.getState(g=g||"_geojsonTileLayer",b)},_.prototype.setDependencies=function(g,b,S){var L=this._tiles[g];L&&L.setDependencies(b,S)},_.prototype.reloadTilesForDependencies=function(g,b){for(var S in this._tiles)this._tiles[S].hasDependency(g,b)&&this._reloadTile(S,"reloading");this._cache.filter((function(L){return!L.hasDependency(g,b)}))},_})(s.Evented);function it(p,_){var g=Math.abs(2*p.wrap)-+(p.wrap<0),b=Math.abs(2*_.wrap)-+(_.wrap<0);return p.overscaledZ-_.overscaledZ||b-g||_.canonical.y-p.canonical.y||_.canonical.x-p.canonical.x}function At(p){return p==="raster"||p==="image"||p==="video"}function Lt(){return new s.window.Worker(Ng.workerUrl)}ke.maxOverzooming=10,ke.maxUnderzooming=3;var dt="mapboxgl_preloaded_worker_pool",Tt=function(){this.active={}};Tt.prototype.acquire=function(p){if(!this.workers)for(this.workers=[];this.workers.length<Tt.workerCount;)this.workers.push(new Lt);return this.active[p]=!0,this.workers.slice()},Tt.prototype.release=function(p){delete this.active[p],this.numActive()===0&&(this.workers.forEach((function(_){_.terminate()})),this.workers=null)},Tt.prototype.isPreloaded=function(){return!!this.active[dt]},Tt.prototype.numActive=function(){return Object.keys(this.active).length};var qt,tn=Math.floor(s.browser.hardwareConcurrency/2);function pt(){return qt||(qt=new Tt),qt}function $t(p,_){var g={};for(var b in p)b!=="ref"&&(g[b]=p[b]);return s.refProperties.forEach((function(S){S in _&&(g[S]=_[S])})),g}function Xt(p){p=p.slice();for(var _=Object.create(null),g=0;g<p.length;g++)_[p[g].id]=p[g];for(var b=0;b<p.length;b++)"ref"in p[b]&&(p[b]=$t(p[b],_[p[b].ref]));return p}Tt.workerCount=Math.max(Math.min(tn,6),1);var Yt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Dt(p,_,g){g.push({command:Yt.addSource,args:[p,_[p]]})}function Fe(p,_,g){_.push({command:Yt.removeSource,args:[p]}),g[p]=!0}function vt(p,_,g,b){Fe(p,g,b),Dt(p,_,g)}function Kt(p,_,g){var b;for(b in p[g])if(p[g].hasOwnProperty(b)&&b!=="data"&&!s.deepEqual(p[g][b],_[g][b]))return!1;for(b in _[g])if(_[g].hasOwnProperty(b)&&b!=="data"&&!s.deepEqual(p[g][b],_[g][b]))return!1;return!0}function yn(p,_,g,b,S,L){var F;for(F in _=_||{},p=p||{})p.hasOwnProperty(F)&&(s.deepEqual(p[F],_[F])||g.push({command:L,args:[b,F,_[F],S]}));for(F in _)_.hasOwnProperty(F)&&!p.hasOwnProperty(F)&&(s.deepEqual(p[F],_[F])||g.push({command:L,args:[b,F,_[F],S]}))}function Bn(p){return p.id}function En(p,_){return p[_.id]=_,p}var Qi=function(p,_){this.reset(p,_)};Qi.prototype.reset=function(p,_){this.points=p||[],this._distances=[0];for(var g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(_||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Qi.prototype.lerp=function(p){if(this.points.length===1)return this.points[0];p=s.clamp(p,0,1);for(var _=1,g=this._distances[_],b=p*this.paddedLength+this.padding;g<b&&_<this._distances.length;)g=this._distances[++_];var S=_-1,L=this._distances[S],F=g-L,B=F>0?(b-L)/F:0;return this.points[S].mult(1-B).add(this.points[_].mult(B))};var li=function(p,_,g){var b=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(p/g),this.yCellCount=Math.ceil(_/g);for(var L=0;L<this.xCellCount*this.yCellCount;L++)b.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=p,this.height=_,this.xScale=this.xCellCount/p,this.yScale=this.yCellCount/_,this.boxUid=0,this.circleUid=0};function or(p,_,g,b,S){var L=s.create();return _?(s.scale(L,L,[1/S,1/S,1]),g||s.rotateZ(L,L,b.angle)):s.multiply(L,b.labelPlaneMatrix,p),L}function Gi(p,_,g,b,S){if(_){var L=s.clone(p);return s.scale(L,L,[S,S,1]),g||s.rotateZ(L,L,-b.angle),L}return b.glCoordMatrix}function Mn(p,_){var g=[p.x,p.y,0,1];Ps(g,g,_);var b=g[3];return{point:new s.Point(g[0]/b,g[1]/b),signedDistanceFromCamera:b}}function Ci(p,_){return .5+p/_*.5}function Us(p,_){var g=p[0]/p[3],b=p[1]/p[3];return g>=-_[0]&&g<=_[0]&&b>=-_[1]&&b<=_[1]}function Pf(p,_,g,b,S,L,F,B){var J=b?p.textSizeData:p.iconSizeData,re=s.evaluateSizeForZoom(J,g.transform.zoom),Ce=[256/g.width*2+1,256/g.height*2+1],we=b?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;we.clear();for(var Se=p.lineVertexArray,Be=b?p.text.placedSymbolArray:p.icon.placedSymbolArray,Ve=g.transform.width/g.transform.height,Ke=!1,Pe=0;Pe<Be.length;Pe++){var He=Be.get(Pe);if(He.hidden||He.writingMode===s.WritingMode.vertical&&!Ke)ho(He.numGlyphs,we);else{Ke=!1;var Qe=[He.anchorX,He.anchorY,0,1];if(s.transformMat4(Qe,Qe,_),Us(Qe,Ce)){var rt=Ci(g.transform.cameraToCenterDistance,Qe[3]),ht=s.evaluateSizeForFeature(J,re,He),lt=F?ht/rt:ht*rt,ft=new s.Point(He.anchorX,He.anchorY),wt=Mn(ft,S).point,Vt={},Ot=r_(He,lt,!1,B,_,S,L,p.glyphOffsetArray,Se,we,wt,ft,Vt,Ve);Ke=Ot.useVertical,(Ot.notEnoughRoom||Ke||Ot.needsFlipping&&r_(He,lt,!0,B,_,S,L,p.glyphOffsetArray,Se,we,wt,ft,Vt,Ve).notEnoughRoom)&&ho(He.numGlyphs,we)}else ho(He.numGlyphs,we)}}b?p.text.dynamicLayoutVertexBuffer.updateData(we):p.icon.dynamicLayoutVertexBuffer.updateData(we)}function Ls(p,_,g,b,S,L,F,B,J,re,Ce){var we=B.glyphStartIndex+B.numGlyphs,Se=B.lineStartIndex,Be=B.lineStartIndex+B.lineLength,Ve=_.getoffsetX(B.glyphStartIndex),Ke=_.getoffsetX(we-1),Pe=Yr(p*Ve,g,b,S,L,F,B.segment,Se,Be,J,re,Ce);if(!Pe)return null;var He=Yr(p*Ke,g,b,S,L,F,B.segment,Se,Be,J,re,Ce);return He?{first:Pe,last:He}:null}function So(p,_,g,b){return p===s.WritingMode.horizontal&&Math.abs(g.y-_.y)>Math.abs(g.x-_.x)*b?{useVertical:!0}:(p===s.WritingMode.vertical?_.y<g.y:_.x>g.x)?{needsFlipping:!0}:null}function r_(p,_,g,b,S,L,F,B,J,re,Ce,we,Se,Be){var Ve,Ke=_/24,Pe=p.lineOffsetX*Ke,He=p.lineOffsetY*Ke;if(p.numGlyphs>1){var Qe=p.glyphStartIndex+p.numGlyphs,rt=p.lineStartIndex,ht=p.lineStartIndex+p.lineLength,lt=Ls(Ke,B,Pe,He,g,Ce,we,p,J,L,Se);if(!lt)return{notEnoughRoom:!0};var ft=Mn(lt.first.point,F).point,wt=Mn(lt.last.point,F).point;if(b&&!g){var Vt=So(p.writingMode,ft,wt,Be);if(Vt)return Vt}Ve=[lt.first];for(var Ot=p.glyphStartIndex+1;Ot<Qe-1;Ot++)Ve.push(Yr(Ke*B.getoffsetX(Ot),Pe,He,g,Ce,we,p.segment,rt,ht,J,L,Se));Ve.push(lt.last)}else{if(b&&!g){var en=Mn(we,S).point,vn=p.lineStartIndex+p.segment+1,Cn=new s.Point(J.getx(vn),J.gety(vn)),In=Mn(Cn,S),wi=In.signedDistanceFromCamera>0?In.point:Gf(we,Cn,en,1,S),nn=So(p.writingMode,en,wi,Be);if(nn)return nn}var Nn=Yr(Ke*B.getoffsetX(p.glyphStartIndex),Pe,He,g,Ce,we,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,J,L,Se);if(!Nn)return{notEnoughRoom:!0};Ve=[Nn]}for(var $n=0,On=Ve;$n<On.length;$n+=1){var Fn=On[$n];s.addDynamicAttributes(re,Fn.point,Fn.angle)}return{}}function Gf(p,_,g,b,S){var L=Mn(p.add(p.sub(_)._unit()),S).point,F=g.sub(L);return g.add(F._mult(b/F.mag()))}function Yr(p,_,g,b,S,L,F,B,J,re,Ce,we){var Se=b?p-_:p+_,Be=Se>0?1:-1,Ve=0;b&&(Be*=-1,Ve=Math.PI),Be<0&&(Ve+=Math.PI);for(var Ke=Be>0?B+F:B+F+1,Pe=S,He=S,Qe=0,rt=0,ht=Math.abs(Se),lt=[];Qe+rt<=ht;){if((Ke+=Be)<B||Ke>=J)return null;if(He=Pe,lt.push(Pe),(Pe=we[Ke])===void 0){var ft=new s.Point(re.getx(Ke),re.gety(Ke)),wt=Mn(ft,Ce);if(wt.signedDistanceFromCamera>0)Pe=we[Ke]=wt.point;else{var Vt=Ke-Be;Pe=Gf(Qe===0?L:new s.Point(re.getx(Vt),re.gety(Vt)),ft,He,ht-Qe+1,Ce)}}Qe+=rt,rt=He.dist(Pe)}var Ot=(ht-Qe)/rt,en=Pe.sub(He),vn=en.mult(Ot)._add(He);vn._add(en._unit()._perp()._mult(g*Be));var Cn=Ve+Math.atan2(Pe.y-He.y,Pe.x-He.x);return lt.push(vn),{point:vn,angle:Cn,path:lt}}li.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},li.prototype.insert=function(p,_,g,b,S){this._forEachCell(_,g,b,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(p),this.bboxes.push(_),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(S)},li.prototype.insertCircle=function(p,_,g,b){this._forEachCell(_-b,g-b,_+b,g+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(p),this.circles.push(_),this.circles.push(g),this.circles.push(b)},li.prototype._insertBoxCell=function(p,_,g,b,S,L){this.boxCells[S].push(L)},li.prototype._insertCircleCell=function(p,_,g,b,S,L){this.circleCells[S].push(L)},li.prototype._query=function(p,_,g,b,S,L){if(g<0||p>this.width||b<0||_>this.height)return!S&&[];var F=[];if(p<=0&&_<=0&&this.width<=g&&this.height<=b){if(S)return!0;for(var B=0;B<this.boxKeys.length;B++)F.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(var J=0;J<this.circleKeys.length;J++){var re=this.circles[3*J],Ce=this.circles[3*J+1],we=this.circles[3*J+2];F.push({key:this.circleKeys[J],x1:re-we,y1:Ce-we,x2:re+we,y2:Ce+we})}return L?F.filter(L):F}return this._forEachCell(p,_,g,b,this._queryCell,F,{hitTest:S,seenUids:{box:{},circle:{}}},L),S?F.length>0:F},li.prototype._queryCircle=function(p,_,g,b,S){var L=p-g,F=p+g,B=_-g,J=_+g;if(F<0||L>this.width||J<0||B>this.height)return!b&&[];var re=[];return this._forEachCell(L,B,F,J,this._queryCellCircle,re,{hitTest:b,circle:{x:p,y:_,radius:g},seenUids:{box:{},circle:{}}},S),b?re.length>0:re},li.prototype.query=function(p,_,g,b,S){return this._query(p,_,g,b,!1,S)},li.prototype.hitTest=function(p,_,g,b,S){return this._query(p,_,g,b,!0,S)},li.prototype.hitTestCircle=function(p,_,g,b){return this._queryCircle(p,_,g,!0,b)},li.prototype._queryCell=function(p,_,g,b,S,L,F,B){var J=F.seenUids,re=this.boxCells[S];if(re!==null)for(var Ce=this.bboxes,we=0,Se=re;we<Se.length;we+=1){var Be=Se[we];if(!J.box[Be]){J.box[Be]=!0;var Ve=4*Be;if(p<=Ce[Ve+2]&&_<=Ce[Ve+3]&&g>=Ce[Ve+0]&&b>=Ce[Ve+1]&&(!B||B(this.boxKeys[Be]))){if(F.hitTest)return L.push(!0),!0;L.push({key:this.boxKeys[Be],x1:Ce[Ve],y1:Ce[Ve+1],x2:Ce[Ve+2],y2:Ce[Ve+3]})}}}var Ke=this.circleCells[S];if(Ke!==null)for(var Pe=this.circles,He=0,Qe=Ke;He<Qe.length;He+=1){var rt=Qe[He];if(!J.circle[rt]){J.circle[rt]=!0;var ht=3*rt;if(this._circleAndRectCollide(Pe[ht],Pe[ht+1],Pe[ht+2],p,_,g,b)&&(!B||B(this.circleKeys[rt]))){if(F.hitTest)return L.push(!0),!0;var lt=Pe[ht],ft=Pe[ht+1],wt=Pe[ht+2];L.push({key:this.circleKeys[rt],x1:lt-wt,y1:ft-wt,x2:lt+wt,y2:ft+wt})}}}},li.prototype._queryCellCircle=function(p,_,g,b,S,L,F,B){var J=F.circle,re=F.seenUids,Ce=this.boxCells[S];if(Ce!==null)for(var we=this.bboxes,Se=0,Be=Ce;Se<Be.length;Se+=1){var Ve=Be[Se];if(!re.box[Ve]){re.box[Ve]=!0;var Ke=4*Ve;if(this._circleAndRectCollide(J.x,J.y,J.radius,we[Ke+0],we[Ke+1],we[Ke+2],we[Ke+3])&&(!B||B(this.boxKeys[Ve])))return L.push(!0),!0}}var Pe=this.circleCells[S];if(Pe!==null)for(var He=this.circles,Qe=0,rt=Pe;Qe<rt.length;Qe+=1){var ht=rt[Qe];if(!re.circle[ht]){re.circle[ht]=!0;var lt=3*ht;if(this._circlesCollide(He[lt],He[lt+1],He[lt+2],J.x,J.y,J.radius)&&(!B||B(this.circleKeys[ht])))return L.push(!0),!0}}},li.prototype._forEachCell=function(p,_,g,b,S,L,F,B){for(var J=this._convertToXCellCoord(p),re=this._convertToYCellCoord(_),Ce=this._convertToXCellCoord(g),we=this._convertToYCellCoord(b),Se=J;Se<=Ce;Se++)for(var Be=re;Be<=we;Be++)if(S.call(this,p,_,g,b,this.xCellCount*Be+Se,L,F,B))return},li.prototype._convertToXCellCoord=function(p){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(p*this.xScale)))},li.prototype._convertToYCellCoord=function(p){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(p*this.yScale)))},li.prototype._circlesCollide=function(p,_,g,b,S,L){var F=b-p,B=S-_,J=g+L;return J*J>F*F+B*B},li.prototype._circleAndRectCollide=function(p,_,g,b,S,L,F){var B=(L-b)/2,J=Math.abs(p-(b+B));if(J>B+g)return!1;var re=(F-S)/2,Ce=Math.abs(_-(S+re));if(Ce>re+g)return!1;if(J<=B||Ce<=re)return!0;var we=J-B,Se=Ce-re;return we*we+Se*Se<=g*g};var Ff=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ho(p,_){for(var g=0;g<p;g++){var b=_.length;_.resize(b+4),_.float32.set(Ff,3*b)}}function Ps(p,_,g){var b=_[0],S=_[1];return p[0]=g[0]*b+g[4]*S+g[12],p[1]=g[1]*b+g[5]*S+g[13],p[3]=g[3]*b+g[7]*S+g[15],p}var Ta=function(p,_,g){_===void 0&&(_=new li(p.width+200,p.height+200,25)),g===void 0&&(g=new li(p.width+200,p.height+200,25)),this.transform=p,this.grid=_,this.ignoredGrid=g,this.pitchfactor=Math.cos(p._pitch)*p.cameraToCenterDistance,this.screenRightBoundary=p.width+100,this.screenBottomBoundary=p.height+100,this.gridRightBoundary=p.width+200,this.gridBottomBoundary=p.height+200};function Cr(p,_,g){return _*(s.EXTENT/(p.tileSize*Math.pow(2,g-p.tileID.overscaledZ)))}Ta.prototype.placeCollisionBox=function(p,_,g,b,S){var L=this.projectAndGetPerspectiveRatio(b,p.anchorPointX,p.anchorPointY),F=g*L.perspectiveRatio,B=p.x1*F+L.point.x,J=p.y1*F+L.point.y,re=p.x2*F+L.point.x,Ce=p.y2*F+L.point.y;return!this.isInsideGrid(B,J,re,Ce)||!_&&this.grid.hitTest(B,J,re,Ce,S)?{box:[],offscreen:!1}:{box:[B,J,re,Ce],offscreen:this.isOffscreen(B,J,re,Ce)}},Ta.prototype.placeCollisionCircles=function(p,_,g,b,S,L,F,B,J,re,Ce,we,Se){var Be=[],Ve=new s.Point(_.anchorX,_.anchorY),Ke=Mn(Ve,L),Pe=Ci(this.transform.cameraToCenterDistance,Ke.signedDistanceFromCamera),He=(re?S/Pe:S*Pe)/s.ONE_EM,Qe=Mn(Ve,F).point,rt=Ls(He,b,_.lineOffsetX*He,_.lineOffsetY*He,!1,Qe,Ve,_,g,F,{}),ht=!1,lt=!1,ft=!0;if(rt){for(var wt=.5*we*Pe+Se,Vt=new s.Point(-100,-100),Ot=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),en=new Qi,vn=rt.first,Cn=rt.last,In=[],wi=vn.path.length-1;wi>=1;wi--)In.push(vn.path[wi]);for(var nn=1;nn<Cn.path.length;nn++)In.push(Cn.path[nn]);var Nn=2.5*wt;if(B){var $n=In.map((function(Ga){return Mn(Ga,B)}));In=$n.some((function(Ga){return Ga.signedDistanceFromCamera<=0}))?[]:$n.map((function(Ga){return Ga.point}))}var On=[];if(In.length>0){for(var Fn=In[0].clone(),jn=In[0].clone(),Pn=1;Pn<In.length;Pn++)Fn.x=Math.min(Fn.x,In[Pn].x),Fn.y=Math.min(Fn.y,In[Pn].y),jn.x=Math.max(jn.x,In[Pn].x),jn.y=Math.max(jn.y,In[Pn].y);On=Fn.x>=Vt.x&&jn.x<=Ot.x&&Fn.y>=Vt.y&&jn.y<=Ot.y?[In]:jn.x<Vt.x||Fn.x>Ot.x||jn.y<Vt.y||Fn.y>Ot.y?[]:s.clipLine([In],Vt.x,Vt.y,Ot.x,Ot.y)}for(var Tn=0,bs=On;Tn<bs.length;Tn+=1){var Nr;en.reset(bs[Tn],.25*wt),Nr=en.length<=.5*wt?1:Math.ceil(en.paddedLength/Nn)+1;for(var oo=0;oo<Nr;oo++){var Fs=oo/Math.max(Nr-1,1),Lr=en.lerp(Fs),Hr=Lr.x+100,Ho=Lr.y+100;Be.push(Hr,Ho,wt,0);var mo=Hr-wt,ic=Ho-wt,Eo=Hr+wt,cl=Ho+wt;if(ft=ft&&this.isOffscreen(mo,ic,Eo,cl),lt=lt||this.isInsideGrid(mo,ic,Eo,cl),!p&&this.grid.hitTestCircle(Hr,Ho,wt,Ce)&&(ht=!0,!J))return{circles:[],offscreen:!1,collisionDetected:ht}}}}return{circles:!J&&ht||!lt?[]:Be,offscreen:ft,collisionDetected:ht}},Ta.prototype.queryRenderedSymbols=function(p){if(p.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var _=[],g=1/0,b=1/0,S=-1/0,L=-1/0,F=0,B=p;F<B.length;F+=1){var J=B[F],re=new s.Point(J.x+100,J.y+100);g=Math.min(g,re.x),b=Math.min(b,re.y),S=Math.max(S,re.x),L=Math.max(L,re.y),_.push(re)}for(var Ce={},we={},Se=0,Be=this.grid.query(g,b,S,L).concat(this.ignoredGrid.query(g,b,S,L));Se<Be.length;Se+=1){var Ve=Be[Se],Ke=Ve.key;if(Ce[Ke.bucketInstanceId]===void 0&&(Ce[Ke.bucketInstanceId]={}),!Ce[Ke.bucketInstanceId][Ke.featureIndex]){var Pe=[new s.Point(Ve.x1,Ve.y1),new s.Point(Ve.x2,Ve.y1),new s.Point(Ve.x2,Ve.y2),new s.Point(Ve.x1,Ve.y2)];s.polygonIntersectsPolygon(_,Pe)&&(Ce[Ke.bucketInstanceId][Ke.featureIndex]=!0,we[Ke.bucketInstanceId]===void 0&&(we[Ke.bucketInstanceId]=[]),we[Ke.bucketInstanceId].push(Ke.featureIndex))}}return we},Ta.prototype.insertCollisionBox=function(p,_,g,b,S){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:S},p[0],p[1],p[2],p[3])},Ta.prototype.insertCollisionCircles=function(p,_,g,b,S){for(var L=_?this.ignoredGrid:this.grid,F={bucketInstanceId:g,featureIndex:b,collisionGroupID:S},B=0;B<p.length;B+=4)L.insertCircle(F,p[B],p[B+1],p[B+2])},Ta.prototype.projectAndGetPerspectiveRatio=function(p,_,g){var b=[_,g,0,1];return Ps(b,b,p),{point:new s.Point((b[0]/b[3]+1)/2*this.transform.width+100,(-b[1]/b[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}},Ta.prototype.isOffscreen=function(p,_,g,b){return g<100||p>=this.screenRightBoundary||b<100||_>this.screenBottomBoundary},Ta.prototype.isInsideGrid=function(p,_,g,b){return g>=0&&p<this.gridRightBoundary&&b>=0&&_<this.gridBottomBoundary},Ta.prototype.getViewportMatrix=function(){var p=s.identity([]);return s.translate(p,p,[-100,-100,0]),p};var rl=function(p,_,g,b){this.opacity=p?Math.max(0,Math.min(1,p.opacity+(p.placed?_:-_))):b&&g?1:0,this.placed=g};rl.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var ha=function(p,_,g,b,S){this.text=new rl(p?p.text:null,_,g,S),this.icon=new rl(p?p.icon:null,_,b,S)};ha.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Bb=function(p,_,g){this.text=p,this.icon=_,this.skipFade=g},Ra=function(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]},RA=function(p,_,g,b,S){this.bucketInstanceId=p,this.featureIndex=_,this.sourceLayerIndex=g,this.bucketIndex=b,this.tileID=S},su=function(p){this.crossSourceCollisions=p,this.maxGroupID=0,this.collisionGroups={}};function Xs(p,_,g,b,S){var L=s.getAnchorAlignment(p),F=-(L.horizontalAlign-.5)*_,B=-(L.verticalAlign-.5)*g,J=s.evaluateVariableOffset(p,b);return new s.Point(F+J[0]*S,B+J[1]*S)}function Gl(p,_,g,b,S,L){var F=p.x1,B=p.x2,J=p.y1,re=p.y2,Ce=p.anchorPointX,we=p.anchorPointY,Se=new s.Point(_,g);return b&&Se._rotate(S?L:-L),{x1:F+Se.x,y1:J+Se.y,x2:B+Se.x,y2:re+Se.y,anchorPointX:Ce,anchorPointY:we}}su.prototype.get=function(p){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[p]){var _=++this.maxGroupID;this.collisionGroups[p]={ID:_,predicate:function(g){return g.collisionGroupID===_}}}return this.collisionGroups[p]};var fo=function(p,_,g,b){this.transform=p.clone(),this.collisionIndex=new Ta(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new su(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}};function Xc(p,_,g,b,S){p.emplaceBack(_?1:0,g?1:0,b||0,S||0),p.emplaceBack(_?1:0,g?1:0,b||0,S||0),p.emplaceBack(_?1:0,g?1:0,b||0,S||0),p.emplaceBack(_?1:0,g?1:0,b||0,S||0)}fo.prototype.getBucketParts=function(p,_,g,b){var S=g.getBucket(_),L=g.latestFeatureIndex;if(S&&L&&_.id===S.layerIds[0]){var F=g.collisionBoxArray,B=S.layers[0].layout,J=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),re=g.tileSize/s.EXTENT,Ce=this.transform.calculatePosMatrix(g.tileID.toUnwrapped()),we=B.get("text-pitch-alignment")==="map",Se=B.get("text-rotation-alignment")==="map",Be=Cr(g,1,this.transform.zoom),Ve=or(Ce,we,Se,this.transform,Be),Ke=null;if(we){var Pe=Gi(Ce,we,Se,this.transform,Be);Ke=s.multiply([],this.transform.labelPlaneMatrix,Pe)}this.retainedQueryData[S.bucketInstanceId]=new RA(S.bucketInstanceId,L,S.sourceLayerIndex,S.index,g.tileID);var He={bucket:S,layout:B,posMatrix:Ce,textLabelPlaneMatrix:Ve,labelToScreenMatrix:Ke,scale:J,textPixelRatio:re,holdingForFade:g.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(b)for(var Qe=0,rt=S.sortKeyRanges;Qe<rt.length;Qe+=1){var ht=rt[Qe];p.push({sortKey:ht.sortKey,symbolInstanceStart:ht.symbolInstanceStart,symbolInstanceEnd:ht.symbolInstanceEnd,parameters:He})}else p.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:He})}},fo.prototype.attemptAnchorPlacement=function(p,_,g,b,S,L,F,B,J,re,Ce,we,Se,Be,Ve){var Ke,Pe=[we.textOffset0,we.textOffset1],He=Xs(p,g,b,Pe,S),Qe=this.collisionIndex.placeCollisionBox(Gl(_,He.x,He.y,L,F,this.transform.angle),Ce,B,J,re.predicate);if(!Ve||this.collisionIndex.placeCollisionBox(Gl(Ve,He.x,He.y,L,F,this.transform.angle),Ce,B,J,re.predicate).box.length!==0)return Qe.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID].text&&(Ke=this.prevPlacement.variableOffsets[we.crossTileID].anchor),this.variableOffsets[we.crossTileID]={textOffset:Pe,width:g,height:b,anchor:p,textBoxScale:S,prevAnchor:Ke},this.markUsedJustification(Se,p,we,Be),Se.allowVerticalPlacement&&(this.markUsedOrientation(Se,Be,we),this.placedOrientations[we.crossTileID]=Be),{shift:He,placedGlyphBoxes:Qe}):void 0},fo.prototype.placeLayerBucketPart=function(p,_,g){var b=this,S=p.parameters,L=S.bucket,F=S.layout,B=S.posMatrix,J=S.textLabelPlaneMatrix,re=S.labelToScreenMatrix,Ce=S.textPixelRatio,we=S.holdingForFade,Se=S.collisionBoxArray,Be=S.partiallyEvaluatedTextSize,Ve=S.collisionGroup,Ke=F.get("text-optional"),Pe=F.get("icon-optional"),He=F.get("text-allow-overlap"),Qe=F.get("icon-allow-overlap"),rt=F.get("text-rotation-alignment")==="map",ht=F.get("text-pitch-alignment")==="map",lt=F.get("icon-text-fit")!=="none",ft=F.get("symbol-z-order")==="viewport-y",wt=He&&(Qe||!L.hasIconData()||Pe),Vt=Qe&&(He||!L.hasTextData()||Ke);!L.collisionArrays&&Se&&L.deserializeCollisionBoxes(Se);var Ot=function(nn,Nn){if(!_[nn.crossTileID])if(we)b.placements[nn.crossTileID]=new Bb(!1,!1,!1);else{var $n,On=!1,Fn=!1,jn=!0,Pn=null,Tn={box:null,offscreen:null},bs={box:null,offscreen:null},Nr=null,oo=null,Fs=0,Lr=0,Hr=0;Nn.textFeatureIndex?Fs=Nn.textFeatureIndex:nn.useRuntimeCollisionCircles&&(Fs=nn.featureIndex),Nn.verticalTextFeatureIndex&&(Lr=Nn.verticalTextFeatureIndex);var Ho=Nn.textBox;if(Ho){var mo=function(Fi){var pa=s.WritingMode.horizontal;if(L.allowVerticalPlacement&&!Fi&&b.prevPlacement){var To=b.prevPlacement.placedOrientations[nn.crossTileID];To&&(b.placedOrientations[nn.crossTileID]=To,b.markUsedOrientation(L,pa=To,nn))}return pa},ic=function(Fi,pa){if(L.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&Nn.verticalTextBox)for(var To=0,uh=L.writingModes;To<uh.length&&(uh[To]===s.WritingMode.vertical?(Tn=pa(),bs=Tn):Tn=Fi(),!(Tn&&Tn.box&&Tn.box.length));To+=1);else Tn=Fi()};if(F.get("text-variable-anchor")){var Eo=F.get("text-variable-anchor");if(b.prevPlacement&&b.prevPlacement.variableOffsets[nn.crossTileID]){var cl=b.prevPlacement.variableOffsets[nn.crossTileID];Eo.indexOf(cl.anchor)>0&&(Eo=Eo.filter((function(Fi){return Fi!==cl.anchor}))).unshift(cl.anchor)}var Ga=function(Fi,pa,To){for(var uh=Fi.x2-Fi.x1,zA=Fi.y2-Fi.y1,Dg=nn.textBoxScale,UA=lt&&!Qe?pa:null,np={box:[],offscreen:!1},y1=He?2*Eo.length:Eo.length,Cd=0;Cd<y1;++Cd){var Vg=b.attemptAnchorPlacement(Eo[Cd%Eo.length],Fi,uh,zA,Dg,rt,ht,Ce,B,Ve,Cd>=Eo.length,nn,L,To,UA);if(Vg&&(np=Vg.placedGlyphBoxes)&&np.box&&np.box.length){On=!0,Pn=Vg.shift;break}}return np};ic((function(){return Ga(Ho,Nn.iconBox,s.WritingMode.horizontal)}),(function(){var Fi=Nn.verticalTextBox;return L.allowVerticalPlacement&&!(Tn&&Tn.box&&Tn.box.length)&&nn.numVerticalGlyphVertices>0&&Fi?Ga(Fi,Nn.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}})),Tn&&(On=Tn.box,jn=Tn.offscreen);var Qf=mo(Tn&&Tn.box);if(!On&&b.prevPlacement){var xd=b.prevPlacement.variableOffsets[nn.crossTileID];xd&&(b.variableOffsets[nn.crossTileID]=xd,b.markUsedJustification(L,xd.anchor,nn,Qf))}}else{var rc=function(Fi,pa){var To=b.collisionIndex.placeCollisionBox(Fi,He,Ce,B,Ve.predicate);return To&&To.box&&To.box.length&&(b.markUsedOrientation(L,pa,nn),b.placedOrientations[nn.crossTileID]=pa),To};ic((function(){return rc(Ho,s.WritingMode.horizontal)}),(function(){var Fi=Nn.verticalTextBox;return L.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&Fi?rc(Fi,s.WritingMode.vertical):{box:null,offscreen:null}})),mo(Tn&&Tn.box&&Tn.box.length)}}if(On=($n=Tn)&&$n.box&&$n.box.length>0,jn=$n&&$n.offscreen,nn.useRuntimeCollisionCircles){var Id=L.text.placedSymbolArray.get(nn.centerJustifiedTextSymbolIndex),ep=s.evaluateSizeForFeature(L.textSizeData,Be,Id),Dl=F.get("text-padding");Nr=b.collisionIndex.placeCollisionCircles(He,Id,L.lineVertexArray,L.glyphOffsetArray,ep,B,J,re,g,ht,Ve.predicate,nn.collisionCircleDiameter,Dl),On=He||Nr.circles.length>0&&!Nr.collisionDetected,jn=jn&&Nr.offscreen}if(Nn.iconFeatureIndex&&(Hr=Nn.iconFeatureIndex),Nn.iconBox){var tp=function(Fi){var pa=lt&&Pn?Gl(Fi,Pn.x,Pn.y,rt,ht,b.transform.angle):Fi;return b.collisionIndex.placeCollisionBox(pa,Qe,Ce,B,Ve.predicate)};Fn=bs&&bs.box&&bs.box.length&&Nn.verticalIconBox?(oo=tp(Nn.verticalIconBox)).box.length>0:(oo=tp(Nn.iconBox)).box.length>0,jn=jn&&oo.offscreen}var Vl=Ke||nn.numHorizontalGlyphVertices===0&&nn.numVerticalGlyphVertices===0,xs=Pe||nn.numIconVertices===0;if(Vl||xs?xs?Vl||(Fn=Fn&&On):On=Fn&&On:Fn=On=Fn&&On,On&&$n&&$n.box&&b.collisionIndex.insertCollisionBox($n.box,F.get("text-ignore-placement"),L.bucketInstanceId,bs&&bs.box&&Lr?Lr:Fs,Ve.ID),Fn&&oo&&b.collisionIndex.insertCollisionBox(oo.box,F.get("icon-ignore-placement"),L.bucketInstanceId,Hr,Ve.ID),Nr&&(On&&b.collisionIndex.insertCollisionCircles(Nr.circles,F.get("text-ignore-placement"),L.bucketInstanceId,Fs,Ve.ID),g)){var uu=L.bucketInstanceId,sc=b.collisionCircleArrays[uu];sc===void 0&&(sc=b.collisionCircleArrays[uu]=new Ra);for(var lh=0;lh<Nr.circles.length;lh+=4)sc.circles.push(Nr.circles[lh+0]),sc.circles.push(Nr.circles[lh+1]),sc.circles.push(Nr.circles[lh+2]),sc.circles.push(Nr.collisionDetected?1:0)}b.placements[nn.crossTileID]=new Bb(On||wt,Fn||Vt,jn||L.justReloaded),_[nn.crossTileID]=!0}};if(ft)for(var en=L.getSortedSymbolIndexes(this.transform.angle),vn=en.length-1;vn>=0;--vn){var Cn=en[vn];Ot(L.symbolInstances.get(Cn),L.collisionArrays[Cn])}else for(var In=p.symbolInstanceStart;In<p.symbolInstanceEnd;In++)Ot(L.symbolInstances.get(In),L.collisionArrays[In]);if(g&&L.bucketInstanceId in this.collisionCircleArrays){var wi=this.collisionCircleArrays[L.bucketInstanceId];s.invert(wi.invProjMatrix,B),wi.viewportMatrix=this.collisionIndex.getViewportMatrix()}L.justReloaded=!1},fo.prototype.markUsedJustification=function(p,_,g,b){var S;S=b===s.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(_)];for(var L=0,F=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];L<F.length;L+=1){var B=F[L];B>=0&&(p.text.placedSymbolArray.get(B).crossTileID=S>=0&&B!==S?0:g.crossTileID)}},fo.prototype.markUsedOrientation=function(p,_,g){for(var b=_===s.WritingMode.horizontal||_===s.WritingMode.horizontalOnly?_:0,S=_===s.WritingMode.vertical?_:0,L=0,F=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];L<F.length;L+=1)p.text.placedSymbolArray.get(F[L]).placedOrientation=b;g.verticalPlacedTextSymbolIndex&&(p.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=S)},fo.prototype.commit=function(p){this.commitTime=p,this.zoomAtLastRecencyCheck=this.transform.zoom;var _=this.prevPlacement,g=!1;this.prevZoomAdjustment=_?_.zoomAdjustment(this.transform.zoom):0;var b=_?_.symbolFadeChange(p):1,S=_?_.opacities:{},L=_?_.variableOffsets:{},F=_?_.placedOrientations:{};for(var B in this.placements){var J=this.placements[B],re=S[B];re?(this.opacities[B]=new ha(re,b,J.text,J.icon),g=g||J.text!==re.text.placed||J.icon!==re.icon.placed):(this.opacities[B]=new ha(null,b,J.text,J.icon,J.skipFade),g=g||J.text||J.icon)}for(var Ce in S){var we=S[Ce];if(!this.opacities[Ce]){var Se=new ha(we,b,!1,!1);Se.isHidden()||(this.opacities[Ce]=Se,g=g||we.text.placed||we.icon.placed)}}for(var Be in L)this.variableOffsets[Be]||!this.opacities[Be]||this.opacities[Be].isHidden()||(this.variableOffsets[Be]=L[Be]);for(var Ve in F)this.placedOrientations[Ve]||!this.opacities[Ve]||this.opacities[Ve].isHidden()||(this.placedOrientations[Ve]=F[Ve]);g?this.lastPlacementChangeTime=p:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=_?_.lastPlacementChangeTime:p)},fo.prototype.updateLayerOpacities=function(p,_){for(var g={},b=0,S=_;b<S.length;b+=1){var L=S[b],F=L.getBucket(p);F&&L.latestFeatureIndex&&p.id===F.layerIds[0]&&this.updateBucketOpacities(F,g,L.collisionBoxArray)}},fo.prototype.updateBucketOpacities=function(p,_,g){var b=this;p.hasTextData()&&p.text.opacityVertexArray.clear(),p.hasIconData()&&p.icon.opacityVertexArray.clear(),p.hasIconCollisionBoxData()&&p.iconCollisionBox.collisionVertexArray.clear(),p.hasTextCollisionBoxData()&&p.textCollisionBox.collisionVertexArray.clear();var S=p.layers[0].layout,L=new ha(null,0,!1,!1,!0),F=S.get("text-allow-overlap"),B=S.get("icon-allow-overlap"),J=S.get("text-variable-anchor"),re=S.get("text-rotation-alignment")==="map",Ce=S.get("text-pitch-alignment")==="map",we=S.get("icon-text-fit")!=="none",Se=new ha(null,0,F&&(B||!p.hasIconData()||S.get("icon-optional")),B&&(F||!p.hasTextData()||S.get("text-optional")),!0);!p.collisionArrays&&g&&(p.hasIconCollisionBoxData()||p.hasTextCollisionBoxData())&&p.deserializeCollisionBoxes(g);for(var Be=function(He,Qe,rt){for(var ht=0;ht<Qe/4;ht++)He.opacityVertexArray.emplaceBack(rt)},Ve=function(He){var Qe=p.symbolInstances.get(He),rt=Qe.numHorizontalGlyphVertices,ht=Qe.numVerticalGlyphVertices,lt=Qe.crossTileID,ft=b.opacities[lt];_[lt]?ft=L:ft||(b.opacities[lt]=ft=Se),_[lt]=!0;var wt=Qe.numIconVertices>0,Vt=b.placedOrientations[Qe.crossTileID],Ot=Vt===s.WritingMode.vertical,en=Vt===s.WritingMode.horizontal||Vt===s.WritingMode.horizontalOnly;if(rt>0||ht>0){var vn=zb(ft.text);Be(p.text,rt,Ot?cd:vn),Be(p.text,ht,en?cd:vn);var Cn=ft.text.isHidden();[Qe.rightJustifiedTextSymbolIndex,Qe.centerJustifiedTextSymbolIndex,Qe.leftJustifiedTextSymbolIndex].forEach((function(Tn){Tn>=0&&(p.text.placedSymbolArray.get(Tn).hidden=Cn||Ot?1:0)})),Qe.verticalPlacedTextSymbolIndex>=0&&(p.text.placedSymbolArray.get(Qe.verticalPlacedTextSymbolIndex).hidden=Cn||en?1:0);var In=b.variableOffsets[Qe.crossTileID];In&&b.markUsedJustification(p,In.anchor,Qe,Vt);var wi=b.placedOrientations[Qe.crossTileID];wi&&(b.markUsedJustification(p,"left",Qe,wi),b.markUsedOrientation(p,wi,Qe))}if(wt){var nn=zb(ft.icon),Nn=!(we&&Qe.verticalPlacedIconSymbolIndex&&Ot);Qe.placedIconSymbolIndex>=0&&(Be(p.icon,Qe.numIconVertices,Nn?nn:cd),p.icon.placedSymbolArray.get(Qe.placedIconSymbolIndex).hidden=ft.icon.isHidden()),Qe.verticalPlacedIconSymbolIndex>=0&&(Be(p.icon,Qe.numVerticalIconVertices,Nn?cd:nn),p.icon.placedSymbolArray.get(Qe.verticalPlacedIconSymbolIndex).hidden=ft.icon.isHidden())}if(p.hasIconCollisionBoxData()||p.hasTextCollisionBoxData()){var $n=p.collisionArrays[He];if($n){var On=new s.Point(0,0);if($n.textBox||$n.verticalTextBox){var Fn=!0;if(J){var jn=b.variableOffsets[lt];jn?(On=Xs(jn.anchor,jn.width,jn.height,jn.textOffset,jn.textBoxScale),re&&On._rotate(Ce?b.transform.angle:-b.transform.angle)):Fn=!1}$n.textBox&&Xc(p.textCollisionBox.collisionVertexArray,ft.text.placed,!Fn||Ot,On.x,On.y),$n.verticalTextBox&&Xc(p.textCollisionBox.collisionVertexArray,ft.text.placed,!Fn||en,On.x,On.y)}var Pn=!!(!en&&$n.verticalIconBox);$n.iconBox&&Xc(p.iconCollisionBox.collisionVertexArray,ft.icon.placed,Pn,we?On.x:0,we?On.y:0),$n.verticalIconBox&&Xc(p.iconCollisionBox.collisionVertexArray,ft.icon.placed,!Pn,we?On.x:0,we?On.y:0)}}},Ke=0;Ke<p.symbolInstances.length;Ke++)Ve(Ke);if(p.sortFeatures(this.transform.angle),this.retainedQueryData[p.bucketInstanceId]&&(this.retainedQueryData[p.bucketInstanceId].featureSortOrder=p.featureSortOrder),p.hasTextData()&&p.text.opacityVertexBuffer&&p.text.opacityVertexBuffer.updateData(p.text.opacityVertexArray),p.hasIconData()&&p.icon.opacityVertexBuffer&&p.icon.opacityVertexBuffer.updateData(p.icon.opacityVertexArray),p.hasIconCollisionBoxData()&&p.iconCollisionBox.collisionVertexBuffer&&p.iconCollisionBox.collisionVertexBuffer.updateData(p.iconCollisionBox.collisionVertexArray),p.hasTextCollisionBoxData()&&p.textCollisionBox.collisionVertexBuffer&&p.textCollisionBox.collisionVertexBuffer.updateData(p.textCollisionBox.collisionVertexArray),p.bucketInstanceId in this.collisionCircleArrays){var Pe=this.collisionCircleArrays[p.bucketInstanceId];p.placementInvProjMatrix=Pe.invProjMatrix,p.placementViewportMatrix=Pe.viewportMatrix,p.collisionCircleArray=Pe.circles,delete this.collisionCircleArrays[p.bucketInstanceId]}},fo.prototype.symbolFadeChange=function(p){return this.fadeDuration===0?1:(p-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},fo.prototype.zoomAdjustment=function(p){return Math.max(0,(this.transform.zoom-p)/1.5)},fo.prototype.hasTransitions=function(p){return this.stale||p-this.lastPlacementChangeTime<this.fadeDuration},fo.prototype.stillRecent=function(p,_){var g=this.zoomAtLastRecencyCheck===_?1-this.zoomAdjustment(_):1;return this.zoomAtLastRecencyCheck=_,this.commitTime+this.fadeDuration*g>p},fo.prototype.setStale=function(){this.stale=!0};var MA=Math.pow(2,25),kA=Math.pow(2,24),s_=Math.pow(2,17),LA=Math.pow(2,16),Zb=Math.pow(2,9),PA=Math.pow(2,8),Wb=Math.pow(2,1);function zb(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;var _=p.placed?1:0,g=Math.floor(127*p.opacity);return g*MA+_*kA+g*s_+_*LA+g*Zb+_*PA+g*Wb+_}var cd=0,o_=function(p){this._sortAcrossTiles=p.layout.get("symbol-z-order")!=="viewport-y"&&p.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};o_.prototype.continuePlacement=function(p,_,g,b,S){for(var L=this._bucketParts;this._currentTileIndex<p.length;)if(_.getBucketParts(L,b,p[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,L.sort((function(F,B){return F.sortKey-B.sortKey})));this._currentPartIndex<L.length;)if(_.placeLayerBucketPart(L[this._currentPartIndex],this._seenCrossTileIDs,g),this._currentPartIndex++,S())return!0;return!1};var Of=function(p,_,g,b,S,L,F){this.placement=new fo(p,S,L,F),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=b,this._done=!1};Of.prototype.isDone=function(){return this._done},Of.prototype.continuePlacement=function(p,_,g){for(var b=this,S=s.browser.now(),L=function(){var J=s.browser.now()-S;return!b._forceFullPlacement&&J>2};this._currentPlacementIndex>=0;){var F=_[p[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(F.type==="symbol"&&(!F.minzoom||F.minzoom<=B)&&(!F.maxzoom||F.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new o_(F)),this._inProgressLayer.continuePlacement(g[F.source],this.placement,this._showCollisionBoxes,F,L))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Of.prototype.commit=function(p){return this.placement.commit(p),this.placement};var Ub=512/s.EXTENT/2,_g=function(p,_,g){this.tileID=p,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(var b=0;b<_.length;b++){var S=_.get(b),L=S.key;this.indexedSymbolInstances[L]||(this.indexedSymbolInstances[L]=[]),this.indexedSymbolInstances[L].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,p)})}};_g.prototype.getScaledCoordinates=function(p,_){var g=Ub/Math.pow(2,_.canonical.z-this.tileID.canonical.z);return{x:Math.floor((_.canonical.x*s.EXTENT+p.anchorX)*g),y:Math.floor((_.canonical.y*s.EXTENT+p.anchorY)*g)}},_g.prototype.findMatches=function(p,_,g){for(var b=this.tileID.canonical.z<_.canonical.z?1:Math.pow(2,this.tileID.canonical.z-_.canonical.z),S=0;S<p.length;S++){var L=p.get(S);if(!L.crossTileID){var F=this.indexedSymbolInstances[L.key];if(F)for(var B=this.getScaledCoordinates(L,_),J=0,re=F;J<re.length;J+=1){var Ce=re[J];if(Math.abs(Ce.coord.x-B.x)<=b&&Math.abs(Ce.coord.y-B.y)<=b&&!g[Ce.crossTileID]){g[Ce.crossTileID]=!0,L.crossTileID=Ce.crossTileID;break}}}}};var Ma=function(){this.maxCrossTileID=0};Ma.prototype.generate=function(){return++this.maxCrossTileID};var zu=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};zu.prototype.handleWrapJump=function(p){var _=Math.round((p-this.lng)/360);if(_!==0)for(var g in this.indexes){var b=this.indexes[g],S={};for(var L in b){var F=b[L];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+_),S[F.tileID.key]=F}this.indexes[g]=S}this.lng=p},zu.prototype.addBucket=function(p,_,g){if(this.indexes[p.overscaledZ]&&this.indexes[p.overscaledZ][p.key]){if(this.indexes[p.overscaledZ][p.key].bucketInstanceId===_.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(p.overscaledZ,this.indexes[p.overscaledZ][p.key])}for(var b=0;b<_.symbolInstances.length;b++)_.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[p.overscaledZ]||(this.usedCrossTileIDs[p.overscaledZ]={});var S=this.usedCrossTileIDs[p.overscaledZ];for(var L in this.indexes){var F=this.indexes[L];if(Number(L)>p.overscaledZ)for(var B in F){var J=F[B];J.tileID.isChildOf(p)&&J.findMatches(_.symbolInstances,p,S)}else{var re=F[p.scaledTo(Number(L)).key];re&&re.findMatches(_.symbolInstances,p,S)}}for(var Ce=0;Ce<_.symbolInstances.length;Ce++){var we=_.symbolInstances.get(Ce);we.crossTileID||(we.crossTileID=g.generate(),S[we.crossTileID]=!0)}return this.indexes[p.overscaledZ]===void 0&&(this.indexes[p.overscaledZ]={}),this.indexes[p.overscaledZ][p.key]=new _g(p,_.symbolInstances,_.bucketInstanceId),!0},zu.prototype.removeBucketCrossTileIDs=function(p,_){for(var g in _.indexedSymbolInstances)for(var b=0,S=_.indexedSymbolInstances[g];b<S.length;b+=1)delete this.usedCrossTileIDs[p][S[b].crossTileID]},zu.prototype.removeStaleBuckets=function(p){var _=!1;for(var g in this.indexes){var b=this.indexes[g];for(var S in b)p[b[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,b[S]),delete b[S],_=!0)}return _};var Uu=function(){this.layerIndexes={},this.crossTileIDs=new Ma,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Uu.prototype.addLayer=function(p,_,g){var b=this.layerIndexes[p.id];b===void 0&&(b=this.layerIndexes[p.id]=new zu);var S=!1,L={};b.handleWrapJump(g);for(var F=0,B=_;F<B.length;F+=1){var J=B[F],re=J.getBucket(p);re&&p.id===re.layerIds[0]&&(re.bucketInstanceId||(re.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(J.tileID,re,this.crossTileIDs)&&(S=!0),L[re.bucketInstanceId]=!0)}return b.removeStaleBuckets(L)&&(S=!0),S},Uu.prototype.pruneUnusedLayers=function(p){var _={};for(var g in p.forEach((function(b){_[b]=!0})),this.layerIndexes)_[g]||delete this.layerIndexes[g]};var Yc=function(p,_){return s.emitValidationErrors(p,_&&_.filter((function(g){return g.identifier!=="source.canvas"})))},Xu=s.pick(Yt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Yu=s.pick(Yt,["setCenter","setZoom","setBearing","setPitch"]),vg=(function(){var p={},_=s.styleSpec.$version;for(var g in s.styleSpec.$root){var b,S=s.styleSpec.$root[g];S.required&&(b=g==="version"?_:S.type==="array"?[]:{})!=null&&(p[g]=b)}return p})(),Zo=(function(p){function _(g,b){var S=this;b===void 0&&(b={}),p.call(this),this.map=g,this.dispatcher=new D(pt(),this),this.imageManager=new k,this.imageManager.setEventedParent(this),this.glyphManager=new $(g._requestManager,b.localIdeographFontFamily),this.lineAtlas=new de(256,512),this.crossTileSymbolIndex=new Uu,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());var L=this;this._rtlTextPluginCallback=_.registerForPluginStateChange((function(F){L.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:F.pluginStatus,pluginURL:F.pluginURL},(function(B,J){if(s.triggerPluginCompletionEvent(B),J&&J.every((function(Ce){return Ce})))for(var re in L.sourceCaches)L.sourceCaches[re].reload()}))})),this.on("data",(function(F){if(F.dataType==="source"&&F.sourceDataType==="metadata"){var B=S.sourceCaches[F.sourceId];if(B){var J=B.getSource();if(J&&J.vectorLayerIds)for(var re in S._layers){var Ce=S._layers[re];Ce.source===J.id&&S._validateLayer(Ce)}}}}))}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.loadURL=function(g,b){var S=this;b===void 0&&(b={}),this.fire(new s.Event("dataloading",{dataType:"style"}));var L=typeof b.validate=="boolean"?b.validate:!s.isMapboxURL(g);g=this.map._requestManager.normalizeStyleURL(g,b.accessToken);var F=this.map._requestManager.transformRequest(g,s.ResourceType.Style);this._request=s.getJSON(F,(function(B,J){S._request=null,B?S.fire(new s.ErrorEvent(B)):J&&S._load(J,L)}))},_.prototype.loadJSON=function(g,b){var S=this;b===void 0&&(b={}),this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.browser.frame((function(){S._request=null,S._load(g,b.validate!==!1)}))},_.prototype.loadEmpty=function(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(vg,!1)},_.prototype._load=function(g,b){if(!b||!Yc(this,s.validateStyle(g))){for(var S in this._loaded=!0,this.stylesheet=g,g.sources)this.addSource(S,g.sources[S],{validate:!1});g.sprite?this._loadSprite(g.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(g.glyphs);var L=Xt(this.stylesheet.layers);this._order=L.map((function(re){return re.id})),this._layers={},this._serializedLayers={};for(var F=0,B=L;F<B.length;F+=1){var J=B[F];(J=s.createStyleLayer(J)).setEventedParent(this,{layer:{id:J.id}}),this._layers[J.id]=J,this._serializedLayers[J.id]=J.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Y(this.stylesheet.light),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}},_.prototype._loadSprite=function(g){var b=this;this._spriteRequest=(function(S,L,F){var B,J,re,Ce=s.browser.devicePixelRatio>1?"@2x":"",we=s.getJSON(L.transformRequest(L.normalizeSpriteURL(S,Ce,".json"),s.ResourceType.SpriteJSON),(function(Ve,Ke){we=null,re||(re=Ve,B=Ke,Be())})),Se=s.getImage(L.transformRequest(L.normalizeSpriteURL(S,Ce,".png"),s.ResourceType.SpriteImage),(function(Ve,Ke){Se=null,re||(re=Ve,J=Ke,Be())}));function Be(){if(re)F(re);else if(B&&J){var Ve=s.browser.getImageData(J),Ke={};for(var Pe in B){var He=B[Pe],Qe=He.width,rt=He.height,ht=He.x,lt=He.y,ft=He.sdf,wt=He.pixelRatio,Vt=He.stretchX,Ot=He.stretchY,en=He.content,vn=new s.RGBAImage({width:Qe,height:rt});s.RGBAImage.copy(Ve,vn,{x:ht,y:lt},{x:0,y:0},{width:Qe,height:rt}),Ke[Pe]={data:vn,pixelRatio:wt,sdf:ft,stretchX:Vt,stretchY:Ot,content:en}}F(null,Ke)}}return{cancel:function(){we&&(we.cancel(),we=null),Se&&(Se.cancel(),Se=null)}}})(g,this.map._requestManager,(function(S,L){if(b._spriteRequest=null,S)b.fire(new s.ErrorEvent(S));else if(L)for(var F in L)b.imageManager.addImage(F,L[F]);b.imageManager.setLoaded(!0),b._availableImages=b.imageManager.listImages(),b.dispatcher.broadcast("setImages",b._availableImages),b.fire(new s.Event("data",{dataType:"style"}))}))},_.prototype._validateLayer=function(g){var b=this.sourceCaches[g.source];if(b){var S=g.sourceLayer;if(S){var L=b.getSource();(L.type==="geojson"||L.vectorLayerIds&&L.vectorLayerIds.indexOf(S)===-1)&&this.fire(new s.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+L.id+'" as specified by style layer "'+g.id+'"')))}}},_.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var g in this.sourceCaches)if(!this.sourceCaches[g].loaded())return!1;return!!this.imageManager.isLoaded()},_.prototype._serializeLayers=function(g){for(var b=[],S=0,L=g;S<L.length;S+=1){var F=this._layers[L[S]];F.type!=="custom"&&b.push(F.serialize())}return b},_.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var g in this.sourceCaches)if(this.sourceCaches[g].hasTransition())return!0;for(var b in this._layers)if(this._layers[b].hasTransition())return!0;return!1},_.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},_.prototype.update=function(g){if(this._loaded){var b=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),L=Object.keys(this._removedLayers);for(var F in(S.length||L.length)&&this._updateWorkerLayers(S,L),this._updatedSources){var B=this._updatedSources[F];B==="reload"?this._reloadSource(F):B==="clear"&&this._clearSource(F)}for(var J in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[J].updateTransitions(g);this.light.updateTransitions(g),this._resetUpdates()}var re={};for(var Ce in this.sourceCaches){var we=this.sourceCaches[Ce];re[Ce]=we.used,we.used=!1}for(var Se=0,Be=this._order;Se<Be.length;Se+=1){var Ve=this._layers[Be[Se]];Ve.recalculate(g,this._availableImages),!Ve.isHidden(g.zoom)&&Ve.source&&(this.sourceCaches[Ve.source].used=!0)}for(var Ke in re){var Pe=this.sourceCaches[Ke];re[Ke]!==Pe.used&&Pe.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ke}))}this.light.recalculate(g),this.z=g.zoom,b&&this.fire(new s.Event("data",{dataType:"style"}))}},_.prototype._updateTilesForChangedImages=function(){var g=Object.keys(this._changedImages);if(g.length){for(var b in this.sourceCaches)this.sourceCaches[b].reloadTilesForDependencies(["icons","patterns"],g);this._changedImages={}}},_.prototype._updateWorkerLayers=function(g,b){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(g),removedIds:b})},_.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},_.prototype.setState=function(g){var b=this;if(this._checkLoaded(),Yc(this,s.validateStyle(g)))return!1;(g=s.clone$1(g)).layers=Xt(g.layers);var S=(function(F,B){if(!F)return[{command:Yt.setStyle,args:[B]}];var J=[];try{if(!s.deepEqual(F.version,B.version))return[{command:Yt.setStyle,args:[B]}];s.deepEqual(F.center,B.center)||J.push({command:Yt.setCenter,args:[B.center]}),s.deepEqual(F.zoom,B.zoom)||J.push({command:Yt.setZoom,args:[B.zoom]}),s.deepEqual(F.bearing,B.bearing)||J.push({command:Yt.setBearing,args:[B.bearing]}),s.deepEqual(F.pitch,B.pitch)||J.push({command:Yt.setPitch,args:[B.pitch]}),s.deepEqual(F.sprite,B.sprite)||J.push({command:Yt.setSprite,args:[B.sprite]}),s.deepEqual(F.glyphs,B.glyphs)||J.push({command:Yt.setGlyphs,args:[B.glyphs]}),s.deepEqual(F.transition,B.transition)||J.push({command:Yt.setTransition,args:[B.transition]}),s.deepEqual(F.light,B.light)||J.push({command:Yt.setLight,args:[B.light]});var re={},Ce=[];(function(Se,Be,Ve,Ke){var Pe;for(Pe in Be=Be||{},Se=Se||{})Se.hasOwnProperty(Pe)&&(Be.hasOwnProperty(Pe)||Fe(Pe,Ve,Ke));for(Pe in Be)Be.hasOwnProperty(Pe)&&(Se.hasOwnProperty(Pe)?s.deepEqual(Se[Pe],Be[Pe])||(Se[Pe].type==="geojson"&&Be[Pe].type==="geojson"&&Kt(Se,Be,Pe)?Ve.push({command:Yt.setGeoJSONSourceData,args:[Pe,Be[Pe].data]}):vt(Pe,Be,Ve,Ke)):Dt(Pe,Be,Ve))})(F.sources,B.sources,Ce,re);var we=[];F.layers&&F.layers.forEach((function(Se){re[Se.source]?J.push({command:Yt.removeLayer,args:[Se.id]}):we.push(Se)})),J=J.concat(Ce),(function(Se,Be,Ve){Be=Be||[];var Ke,Pe,He,Qe,rt,ht,lt,ft=(Se=Se||[]).map(Bn),wt=Be.map(Bn),Vt=Se.reduce(En,{}),Ot=Be.reduce(En,{}),en=ft.slice(),vn=Object.create(null);for(Ke=0,Pe=0;Ke<ft.length;Ke++)Ot.hasOwnProperty(He=ft[Ke])?Pe++:(Ve.push({command:Yt.removeLayer,args:[He]}),en.splice(en.indexOf(He,Pe),1));for(Ke=0,Pe=0;Ke<wt.length;Ke++)en[en.length-1-Ke]!==(He=wt[wt.length-1-Ke])&&(Vt.hasOwnProperty(He)?(Ve.push({command:Yt.removeLayer,args:[He]}),en.splice(en.lastIndexOf(He,en.length-Pe),1)):Pe++,Ve.push({command:Yt.addLayer,args:[Ot[He],ht=en[en.length-Ke]]}),en.splice(en.length-Ke,0,He),vn[He]=!0);for(Ke=0;Ke<wt.length;Ke++)if(Qe=Vt[He=wt[Ke]],rt=Ot[He],!vn[He]&&!s.deepEqual(Qe,rt))if(s.deepEqual(Qe.source,rt.source)&&s.deepEqual(Qe["source-layer"],rt["source-layer"])&&s.deepEqual(Qe.type,rt.type)){for(lt in yn(Qe.layout,rt.layout,Ve,He,null,Yt.setLayoutProperty),yn(Qe.paint,rt.paint,Ve,He,null,Yt.setPaintProperty),s.deepEqual(Qe.filter,rt.filter)||Ve.push({command:Yt.setFilter,args:[He,rt.filter]}),s.deepEqual(Qe.minzoom,rt.minzoom)&&s.deepEqual(Qe.maxzoom,rt.maxzoom)||Ve.push({command:Yt.setLayerZoomRange,args:[He,rt.minzoom,rt.maxzoom]}),Qe)Qe.hasOwnProperty(lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?yn(Qe[lt],rt[lt],Ve,He,lt.slice(6),Yt.setPaintProperty):s.deepEqual(Qe[lt],rt[lt])||Ve.push({command:Yt.setLayerProperty,args:[He,lt,rt[lt]]}));for(lt in rt)rt.hasOwnProperty(lt)&&!Qe.hasOwnProperty(lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?yn(Qe[lt],rt[lt],Ve,He,lt.slice(6),Yt.setPaintProperty):s.deepEqual(Qe[lt],rt[lt])||Ve.push({command:Yt.setLayerProperty,args:[He,lt,rt[lt]]}))}else Ve.push({command:Yt.removeLayer,args:[He]}),ht=en[en.lastIndexOf(He)+1],Ve.push({command:Yt.addLayer,args:[rt,ht]})})(we,B.layers,J)}catch(Se){console.warn("Unable to compute style diff:",Se),J=[{command:Yt.setStyle,args:[B]}]}return J})(this.serialize(),g).filter((function(F){return!(F.command in Yu)}));if(S.length===0)return!1;var L=S.filter((function(F){return!(F.command in Xu)}));if(L.length>0)throw new Error("Unimplemented: "+L.map((function(F){return F.command})).join(", ")+".");return S.forEach((function(F){F.command!=="setTransition"&&b[F.command].apply(b,F.args)})),this.stylesheet=g,!0},_.prototype.addImage=function(g,b){if(this.getImage(g))return this.fire(new s.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(g,b),this._afterImageUpdated(g)},_.prototype.updateImage=function(g,b){this.imageManager.updateImage(g,b)},_.prototype.getImage=function(g){return this.imageManager.getImage(g)},_.prototype.removeImage=function(g){if(!this.getImage(g))return this.fire(new s.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(g),this._afterImageUpdated(g)},_.prototype._afterImageUpdated=function(g){this._availableImages=this.imageManager.listImages(),this._changedImages[g]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))},_.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},_.prototype.addSource=function(g,b,S){var L=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[g]!==void 0)throw new Error("There is already a source with this ID");if(!b.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(b).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(b.type)>=0&&this._validate(s.validateStyle.source,"sources."+g,b,null,S))){this.map&&this.map._collectResourceTiming&&(b.collectResourceTiming=!0);var F=this.sourceCaches[g]=new ke(g,b,this.dispatcher);F.style=this,F.setEventedParent(this,(function(){return{isSourceLoaded:L.loaded(),source:F.serialize(),sourceId:g}})),F.onAdd(this.map),this._changed=!0}},_.prototype.removeSource=function(g){if(this._checkLoaded(),this.sourceCaches[g]===void 0)throw new Error("There is no source with this ID");for(var b in this._layers)if(this._layers[b].source===g)return this.fire(new s.ErrorEvent(new Error('Source "'+g+'" cannot be removed while layer "'+b+'" is using it.')));var S=this.sourceCaches[g];delete this.sourceCaches[g],delete this._updatedSources[g],S.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},_.prototype.setGeoJSONSourceData=function(g,b){this._checkLoaded(),this.sourceCaches[g].getSource().setData(b),this._changed=!0},_.prototype.getSource=function(g){return this.sourceCaches[g]&&this.sourceCaches[g].getSource()},_.prototype.addLayer=function(g,b,S){S===void 0&&(S={}),this._checkLoaded();var L=g.id;if(this.getLayer(L))this.fire(new s.ErrorEvent(new Error('Layer with id "'+L+'" already exists on this map')));else{var F;if(g.type==="custom"){if(Yc(this,s.validateCustomStyleLayer(g)))return;F=s.createStyleLayer(g)}else{if(typeof g.source=="object"&&(this.addSource(L,g.source),g=s.clone$1(g),g=s.extend(g,{source:L})),this._validate(s.validateStyle.layer,"layers."+L,g,{arrayIndex:-1},S))return;F=s.createStyleLayer(g),this._validateLayer(F),F.setEventedParent(this,{layer:{id:L}}),this._serializedLayers[F.id]=F.serialize()}var B=b?this._order.indexOf(b):this._order.length;if(b&&B===-1)this.fire(new s.ErrorEvent(new Error('Layer with id "'+b+'" does not exist on this map.')));else{if(this._order.splice(B,0,L),this._layerOrderChanged=!0,this._layers[L]=F,this._removedLayers[L]&&F.source&&F.type!=="custom"){var J=this._removedLayers[L];delete this._removedLayers[L],J.type!==F.type?this._updatedSources[F.source]="clear":(this._updatedSources[F.source]="reload",this.sourceCaches[F.source].pause())}this._updateLayer(F),F.onAdd&&F.onAdd(this.map)}}},_.prototype.moveLayer=function(g,b){if(this._checkLoaded(),this._changed=!0,this._layers[g]){if(g!==b){var S=this._order.indexOf(g);this._order.splice(S,1);var L=b?this._order.indexOf(b):this._order.length;b&&L===-1?this.fire(new s.ErrorEvent(new Error('Layer with id "'+b+'" does not exist on this map.'))):(this._order.splice(L,0,g),this._layerOrderChanged=!0)}}else this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be moved.")))},_.prototype.removeLayer=function(g){this._checkLoaded();var b=this._layers[g];if(b){b.setEventedParent(null);var S=this._order.indexOf(g);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[g]=b,delete this._layers[g],delete this._serializedLayers[g],delete this._updatedLayers[g],delete this._updatedPaintProps[g],b.onRemove&&b.onRemove(this.map)}else this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be removed.")))},_.prototype.getLayer=function(g){return this._layers[g]},_.prototype.hasLayer=function(g){return g in this._layers},_.prototype.setLayerZoomRange=function(g,b,S){this._checkLoaded();var L=this.getLayer(g);L?L.minzoom===b&&L.maxzoom===S||(b!=null&&(L.minzoom=b),S!=null&&(L.maxzoom=S),this._updateLayer(L)):this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot have zoom extent.")))},_.prototype.setFilter=function(g,b,S){S===void 0&&(S={}),this._checkLoaded();var L=this.getLayer(g);if(L){if(!s.deepEqual(L.filter,b))return b==null?(L.filter=void 0,void this._updateLayer(L)):void(this._validate(s.validateStyle.filter,"layers."+L.id+".filter",b,null,S)||(L.filter=s.clone$1(b),this._updateLayer(L)))}else this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be filtered.")))},_.prototype.getFilter=function(g){return s.clone$1(this.getLayer(g).filter)},_.prototype.setLayoutProperty=function(g,b,S,L){L===void 0&&(L={}),this._checkLoaded();var F=this.getLayer(g);F?s.deepEqual(F.getLayoutProperty(b),S)||(F.setLayoutProperty(b,S,L),this._updateLayer(F)):this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be styled.")))},_.prototype.getLayoutProperty=function(g,b){var S=this.getLayer(g);if(S)return S.getLayoutProperty(b);this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style.")))},_.prototype.setPaintProperty=function(g,b,S,L){L===void 0&&(L={}),this._checkLoaded();var F=this.getLayer(g);F?s.deepEqual(F.getPaintProperty(b),S)||(F.setPaintProperty(b,S,L)&&this._updateLayer(F),this._changed=!0,this._updatedPaintProps[g]=!0):this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be styled.")))},_.prototype.getPaintProperty=function(g,b){return this.getLayer(g).getPaintProperty(b)},_.prototype.setFeatureState=function(g,b){this._checkLoaded();var S=g.source,L=g.sourceLayer,F=this.sourceCaches[S];if(F!==void 0){var B=F.getSource().type;B==="geojson"&&L?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):B!=="vector"||L?(g.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),F.setFeatureState(L,g.id,b)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},_.prototype.removeFeatureState=function(g,b){this._checkLoaded();var S=g.source,L=this.sourceCaches[S];if(L!==void 0){var F=L.getSource().type,B=F==="vector"?g.sourceLayer:void 0;F!=="vector"||B?b&&typeof g.id!="string"&&typeof g.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):L.removeFeatureState(B,g.id,b):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},_.prototype.getFeatureState=function(g){this._checkLoaded();var b=g.source,S=g.sourceLayer,L=this.sourceCaches[b];if(L!==void 0){if(L.getSource().type!=="vector"||S)return g.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),L.getFeatureState(S,g.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},_.prototype.getTransition=function(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},_.prototype.serialize=function(){return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s.mapObject(this.sourceCaches,(function(g){return g.serialize()})),layers:this._serializeLayers(this._order)},(function(g){return g!==void 0}))},_.prototype._updateLayer=function(g){this._updatedLayers[g.id]=!0,g.source&&!this._updatedSources[g.source]&&this.sourceCaches[g.source].getSource().type!=="raster"&&(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause()),this._changed=!0},_.prototype._flattenAndSortRenderedFeatures=function(g){for(var b=this,S=function(Vt){return b._layers[Vt].type==="fill-extrusion"},L={},F=[],B=this._order.length-1;B>=0;B--){var J=this._order[B];if(S(J)){L[J]=B;for(var re=0,Ce=g;re<Ce.length;re+=1){var we=Ce[re][J];if(we)for(var Se=0,Be=we;Se<Be.length;Se+=1)F.push(Be[Se])}}}F.sort((function(Vt,Ot){return Ot.intersectionZ-Vt.intersectionZ}));for(var Ve=[],Ke=this._order.length-1;Ke>=0;Ke--){var Pe=this._order[Ke];if(S(Pe))for(var He=F.length-1;He>=0;He--){var Qe=F[He].feature;if(L[Qe.layer.id]<Ke)break;Ve.push(Qe),F.pop()}else for(var rt=0,ht=g;rt<ht.length;rt+=1){var lt=ht[rt][Pe];if(lt)for(var ft=0,wt=lt;ft<wt.length;ft+=1)Ve.push(wt[ft].feature)}}return Ve},_.prototype.queryRenderedFeatures=function(g,b,S){b&&b.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",b.filter,null,b);var L={};if(b&&b.layers){if(!Array.isArray(b.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var F=0,B=b.layers;F<B.length;F+=1){var J=B[F],re=this._layers[J];if(!re)return this.fire(new s.ErrorEvent(new Error("The layer '"+J+"' does not exist in the map's style and cannot be queried for features."))),[];L[re.source]=!0}}var Ce=[];for(var we in b.availableImages=this._availableImages,this.sourceCaches)b.layers&&!L[we]||Ce.push(xt(this.sourceCaches[we],this._layers,this._serializedLayers,g,b,S));return this.placement&&Ce.push((function(Se,Be,Ve,Ke,Pe,He,Qe){for(var rt={},ht=He.queryRenderedSymbols(Ke),lt=[],ft=0,wt=Object.keys(ht).map(Number);ft<wt.length;ft+=1)lt.push(Qe[wt[ft]]);lt.sort(Et);for(var Vt=function(){var In=en[Ot],wi=In.featureIndex.lookupSymbolFeatures(ht[In.bucketInstanceId],Be,In.bucketIndex,In.sourceLayerIndex,Pe.filter,Pe.layers,Pe.availableImages,Se);for(var nn in wi){var Nn=rt[nn]=rt[nn]||[],$n=wi[nn];$n.sort((function(jn,Pn){var Tn=In.featureSortOrder;if(Tn){var bs=Tn.indexOf(jn.featureIndex);return Tn.indexOf(Pn.featureIndex)-bs}return Pn.featureIndex-jn.featureIndex}));for(var On=0,Fn=$n;On<Fn.length;On+=1)Nn.push(Fn[On])}},Ot=0,en=lt;Ot<en.length;Ot+=1)Vt();var vn=function(In){rt[In].forEach((function(wi){var nn=wi.feature,Nn=Ve[Se[In].source].getFeatureState(nn.layer["source-layer"],nn.id);nn.source=nn.layer.source,nn.layer["source-layer"]&&(nn.sourceLayer=nn.layer["source-layer"]),nn.state=Nn}))};for(var Cn in rt)vn(Cn);return rt})(this._layers,this._serializedLayers,this.sourceCaches,g,b,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Ce)},_.prototype.querySourceFeatures=function(g,b){b&&b.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",b.filter,null,b);var S=this.sourceCaches[g];return S?(function(L,F){for(var B=L.getRenderableIds().map((function(Be){return L.getTileByID(Be)})),J=[],re={},Ce=0;Ce<B.length;Ce++){var we=B[Ce],Se=we.tileID.canonical.key;re[Se]||(re[Se]=!0,we.querySourceFeatures(J,F))}return J})(S,b):[]},_.prototype.addSourceType=function(g,b,S){return _.getSourceType(g)?S(new Error('A source type called "'+g+'" already exists.')):(_.setSourceType(g,b),b.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:g,url:b.workerSourceURL},S):S(null,null))},_.prototype.getLight=function(){return this.light.getLight()},_.prototype.setLight=function(g,b){b===void 0&&(b={}),this._checkLoaded();var S=this.light.getLight(),L=!1;for(var F in g)if(!s.deepEqual(g[F],S[F])){L=!0;break}if(L){var B={now:s.browser.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(g,b),this.light.updateTransitions(B)}},_.prototype._validate=function(g,b,S,L,F){return F===void 0&&(F={}),(!F||F.validate!==!1)&&Yc(this,g.call(s.validateStyle,s.extend({key:b,style:this.serialize(),value:S,styleSpec:s.styleSpec},L)))},_.prototype._remove=function(){for(var g in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[g].setEventedParent(null);for(var b in this.sourceCaches)this.sourceCaches[b].clearTiles(),this.sourceCaches[b].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},_.prototype._clearSource=function(g){this.sourceCaches[g].clearTiles()},_.prototype._reloadSource=function(g){this.sourceCaches[g].resume(),this.sourceCaches[g].reload()},_.prototype._updateSources=function(g){for(var b in this.sourceCaches)this.sourceCaches[b].update(g)},_.prototype._generateCollisionBoxes=function(){for(var g in this.sourceCaches)this._reloadSource(g)},_.prototype._updatePlacement=function(g,b,S,L,F){F===void 0&&(F=!1);for(var B=!1,J=!1,re={},Ce=0,we=this._order;Ce<we.length;Ce+=1){var Se=this._layers[we[Ce]];if(Se.type==="symbol"){if(!re[Se.source]){var Be=this.sourceCaches[Se.source];re[Se.source]=Be.getRenderableIds(!0).map((function(Qe){return Be.getTileByID(Qe)})).sort((function(Qe,rt){return rt.tileID.overscaledZ-Qe.tileID.overscaledZ||(Qe.tileID.isLessThan(rt.tileID)?-1:1)}))}var Ve=this.crossTileSymbolIndex.addLayer(Se,re[Se.source],g.center.lng);B=B||Ve}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((F=F||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.browser.now(),g.zoom))&&(this.pauseablePlacement=new Of(g,this._order,F,b,S,L,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,re),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.browser.now()),J=!0),B&&this.pauseablePlacement.placement.setStale()),J||B)for(var Ke=0,Pe=this._order;Ke<Pe.length;Ke+=1){var He=this._layers[Pe[Ke]];He.type==="symbol"&&this.placement.updateLayerOpacities(He,re[He.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.browser.now())},_.prototype._releaseSymbolFadeTiles=function(){for(var g in this.sourceCaches)this.sourceCaches[g].releaseSymbolFadeTiles()},_.prototype.getImages=function(g,b,S){this.imageManager.getImages(b.icons,S),this._updateTilesForChangedImages();var L=this.sourceCaches[b.source];L&&L.setDependencies(b.tileID.key,b.type,b.icons)},_.prototype.getGlyphs=function(g,b,S){this.glyphManager.getGlyphs(b.stacks,S)},_.prototype.getResource=function(g,b,S){return s.makeRequest(b,S)},_})(s.Evented);Zo.getSourceType=function(p){return qe[p]},Zo.setSourceType=function(p,_){qe[p]=_},Zo.registerForPluginStateChange=s.registerForPluginStateChange;var ts=s.createLayout([{name:"a_pos",type:"Int16",components:2}]),hd=er(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Xb=er(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),GA=er(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),FA=er(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),a_=er("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),l_=er(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),u_=er(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),c_=er("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Yb=er("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Hb=er("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),OA=er(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Nf=er(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Df=er(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Kb=er(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ys=er(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),h_=er(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Hu=er(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ku=er(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Hc=er(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Kc=er(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ju=er(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),jc=er(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),$c=er(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),$u=er(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),jb=er(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),$b=er(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function er(p,_){var g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=_.match(/attribute ([\w]+) ([\w]+)/g),S=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),L=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),F=L?L.concat(S):S,B={};return{fragmentSource:p=p.replace(g,(function(J,re,Ce,we,Se){return B[Se]=!0,re==="define"?`
#ifndef HAS_UNIFORM_u_`+Se+`
varying `+Ce+" "+we+" "+Se+`;
#else
uniform `+Ce+" "+we+" u_"+Se+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Se+`
    `+Ce+" "+we+" "+Se+" = u_"+Se+`;
#endif
`})),vertexSource:_=_.replace(g,(function(J,re,Ce,we,Se){var Be=we==="float"?"vec2":"vec4",Ve=Se.match(/color/)?"color":Be;return B[Se]?re==="define"?`
#ifndef HAS_UNIFORM_u_`+Se+`
uniform lowp float u_`+Se+`_t;
attribute `+Ce+" "+Be+" a_"+Se+`;
varying `+Ce+" "+we+" "+Se+`;
#else
uniform `+Ce+" "+we+" u_"+Se+`;
#endif
`:Ve==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+Se+" = a_"+Se+`;
#else
    `+Ce+" "+we+" "+Se+" = u_"+Se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+Se+" = unpack_mix_"+Ve+"(a_"+Se+", u_"+Se+`_t);
#else
    `+Ce+" "+we+" "+Se+" = u_"+Se+`;
#endif
`:re==="define"?`
#ifndef HAS_UNIFORM_u_`+Se+`
uniform lowp float u_`+Se+`_t;
attribute `+Ce+" "+Be+" a_"+Se+`;
#else
uniform `+Ce+" "+we+" u_"+Se+`;
#endif
`:Ve==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+Ce+" "+we+" "+Se+" = a_"+Se+`;
#else
    `+Ce+" "+we+" "+Se+" = u_"+Se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+Ce+" "+we+" "+Se+" = unpack_mix_"+Ve+"(a_"+Se+", u_"+Se+`_t);
#else
    `+Ce+" "+we+" "+Se+" = u_"+Se+`;
#endif
`})),staticAttributes:b,staticUniforms:F}}var NA=Object.freeze({__proto__:null,prelude:hd,background:Xb,backgroundPattern:GA,circle:FA,clippingMask:a_,heatmap:l_,heatmapTexture:u_,collisionBox:c_,collisionCircle:Yb,debug:Hb,fill:OA,fillOutline:Nf,fillOutlinePattern:Df,fillPattern:Kb,fillExtrusion:Ys,fillExtrusionPattern:h_,hillshadePrepare:Hu,hillshade:Ku,line:Hc,lineGradient:Kc,linePattern:ju,lineSDF:jc,raster:$c,symbolIcon:$u,symbolSDF:jb,symbolTextAndIcon:$b}),bg=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Jb(p){for(var _=[],g=0;g<p.length;g++)if(p[g]!==null){var b=p[g].split(" ");_.push(b.pop())}return _}bg.prototype.bind=function(p,_,g,b,S,L,F,B){this.context=p;for(var J=this.boundPaintVertexBuffers.length!==b.length,re=0;!J&&re<b.length;re++)this.boundPaintVertexBuffers[re]!==b[re]&&(J=!0);p.extVertexArrayObject&&this.vao&&this.boundProgram===_&&this.boundLayoutVertexBuffer===g&&!J&&this.boundIndexBuffer===S&&this.boundVertexOffset===L&&this.boundDynamicVertexBuffer===F&&this.boundDynamicVertexBuffer2===B?(p.bindVertexArrayOES.set(this.vao),F&&F.bind(),S&&S.dynamicDraw&&S.bind(),B&&B.bind()):this.freshBind(_,g,b,S,L,F,B)},bg.prototype.freshBind=function(p,_,g,b,S,L,F){var B,J=p.numAttributes,re=this.context,Ce=re.gl;if(re.extVertexArrayObject)this.vao&&this.destroy(),this.vao=re.extVertexArrayObject.createVertexArrayOES(),re.bindVertexArrayOES.set(this.vao),B=0,this.boundProgram=p,this.boundLayoutVertexBuffer=_,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=b,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=L,this.boundDynamicVertexBuffer2=F;else{B=re.currentNumAttributes||0;for(var we=J;we<B;we++)Ce.disableVertexAttribArray(we)}_.enableAttributes(Ce,p);for(var Se=0,Be=g;Se<Be.length;Se+=1)Be[Se].enableAttributes(Ce,p);L&&L.enableAttributes(Ce,p),F&&F.enableAttributes(Ce,p),_.bind(),_.setVertexAttribPointers(Ce,p,S);for(var Ve=0,Ke=g;Ve<Ke.length;Ve+=1){var Pe=Ke[Ve];Pe.bind(),Pe.setVertexAttribPointers(Ce,p,S)}L&&(L.bind(),L.setVertexAttribPointers(Ce,p,S)),b&&b.bind(),F&&(F.bind(),F.setVertexAttribPointers(Ce,p,S)),re.currentNumAttributes=J},bg.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var qb=function(p,_,g,b,S,L){var F=p.gl;this.program=F.createProgram();for(var B=Jb(g.staticAttributes),J=b?b.getBinderAttributes():[],re=B.concat(J),Ce=g.staticUniforms?Jb(g.staticUniforms):[],we=b?b.getBinderUniforms():[],Se=[],Be=0,Ve=Ce.concat(we);Be<Ve.length;Be+=1){var Ke=Ve[Be];Se.indexOf(Ke)<0&&Se.push(Ke)}var Pe=b?b.defines():[];L&&Pe.push("#define OVERDRAW_INSPECTOR;");var He=Pe.concat(hd.fragmentSource,g.fragmentSource).join(`
`),Qe=Pe.concat(hd.vertexSource,g.vertexSource).join(`
`),rt=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())this.failedToCreate=!0;else{F.shaderSource(rt,He),F.compileShader(rt),F.attachShader(this.program,rt);var ht=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())this.failedToCreate=!0;else{F.shaderSource(ht,Qe),F.compileShader(ht),F.attachShader(this.program,ht),this.attributes={};var lt={};this.numAttributes=re.length;for(var ft=0;ft<this.numAttributes;ft++)re[ft]&&(F.bindAttribLocation(this.program,ft,re[ft]),this.attributes[re[ft]]=ft);F.linkProgram(this.program),F.deleteShader(ht),F.deleteShader(rt);for(var wt=0;wt<Se.length;wt++){var Vt=Se[wt];if(Vt&&!lt[Vt]){var Ot=F.getUniformLocation(this.program,Vt);Ot&&(lt[Vt]=Ot)}}this.fixedUniforms=S(p,lt),this.binderUniforms=b?b.getUniforms(p,lt):[]}}};function Qb(p,_,g){var b=1/Cr(g,1,_.transform.tileZoom),S=Math.pow(2,g.tileID.overscaledZ),L=g.tileSize*Math.pow(2,_.transform.tileZoom)/S,F=L*(g.tileID.canonical.x+g.tileID.wrap*S),B=L*g.tileID.canonical.y;return{u_image:0,u_texsize:g.imageAtlasTexture.size,u_scale:[b,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[F>>16,B>>16],u_pixel_coord_lower:[65535&F,65535&B]}}qb.prototype.draw=function(p,_,g,b,S,L,F,B,J,re,Ce,we,Se,Be,Ve,Ke){var Pe,He=p.gl;if(!this.failedToCreate){for(var Qe in p.program.set(this.program),p.setDepthMode(g),p.setStencilMode(b),p.setColorMode(S),p.setCullFace(L),this.fixedUniforms)this.fixedUniforms[Qe].set(F[Qe]);Be&&Be.setUniforms(p,this.binderUniforms,we,{zoom:Se});for(var rt=(Pe={},Pe[He.LINES]=2,Pe[He.TRIANGLES]=3,Pe[He.LINE_STRIP]=1,Pe)[_],ht=0,lt=Ce.get();ht<lt.length;ht+=1){var ft=lt[ht],wt=ft.vaos||(ft.vaos={});(wt[B]||(wt[B]=new bg)).bind(p,this,J,Be?Be.getPaintVertexBuffers():[],re,ft.vertexOffset,Ve,Ke),He.drawElements(_,ft.primitiveLength*rt,He.UNSIGNED_SHORT,ft.primitiveOffset*rt*2)}}};var e1=function(p,_,g,b){var S=_.style.light,L=S.properties.get("position"),F=[L.x,L.y,L.z],B=s.create$1();S.properties.get("anchor")==="viewport"&&s.fromRotation(B,-_.transform.angle),s.transformMat3(F,F,B);var J=S.properties.get("color");return{u_matrix:p,u_lightpos:F,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+g,u_opacity:b}},Jc=function(p,_,g,b,S,L,F){return s.extend(e1(p,_,g,b),Qb(L,_,F),{u_height_factor:-Math.pow(2,S.overscaledZ)/F.tileSize/8})},Ju=function(p){return{u_matrix:p}},qc=function(p,_,g,b){return s.extend(Ju(p),Qb(g,_,b))},t1=function(p,_){return{u_matrix:p,u_world:_}},n1=function(p,_,g,b,S){return s.extend(qc(p,_,g,b),{u_world:S})},d_=function(p,_,g,b){var S,L,F=p.transform;if(b.paint.get("circle-pitch-alignment")==="map"){var B=Cr(g,1,F.zoom);S=!0,L=[B,B]}else S=!1,L=F.pixelsToGLUnits;return{u_camera_to_center_distance:F.cameraToCenterDistance,u_scale_with_map:+(b.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(_.posMatrix,g,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:s.browser.devicePixelRatio,u_extrude_scale:L}},Qc=function(p,_,g){var b=Cr(g,1,_.zoom),S=Math.pow(2,_.zoom-g.tileID.overscaledZ),L=g.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:_.cameraToCenterDistance,u_pixels_to_tile_units:b,u_extrude_scale:[_.pixelsToGLUnits[0]/(b*S),_.pixelsToGLUnits[1]/(b*S)],u_overscale_factor:L}},i1=function(p,_,g){return{u_matrix:p,u_inv_matrix:_,u_camera_to_center_distance:g.cameraToCenterDistance,u_viewport_size:[g.width,g.height]}},eh=function(p,_,g){return g===void 0&&(g=1),{u_matrix:p,u_color:_,u_overlay:0,u_overlay_scale:g}},th=function(p){return{u_matrix:p}},r1=function(p,_,g,b){return{u_matrix:p,u_extrude_scale:Cr(_,1,g),u_intensity:b}},Vf=function(p,_,g){var b=p.transform;return{u_matrix:s1(p,_,g),u_ratio:1/Cr(_,1,b.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},cr=function(p,_,g,b){return s.extend(Vf(p,_,g),{u_image:0,u_image_height:b})},xg=function(p,_,g,b){var S=p.transform,L=dd(_,S);return{u_matrix:s1(p,_,g),u_texsize:_.imageAtlasTexture.size,u_ratio:1/Cr(_,1,S.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_image:0,u_scale:[L,b.fromScale,b.toScale],u_fade:b.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},DA=function(p,_,g,b,S){var L=p.lineAtlas,F=dd(_,p.transform),B=g.layout.get("line-cap")==="round",J=L.getDash(b.from,B),re=L.getDash(b.to,B),Ce=J.width*S.fromScale,we=re.width*S.toScale;return s.extend(Vf(p,_,g),{u_patternscale_a:[F/Ce,-J.height/2],u_patternscale_b:[F/we,-re.height/2],u_sdfgamma:L.width/(256*Math.min(Ce,we)*s.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:J.y,u_tex_y_b:re.y,u_mix:S.t})};function dd(p,_){return 1/Cr(p,1,_.tileZoom)}function s1(p,_,g){return p.translatePosMatrix(_.tileID.posMatrix,_,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}var VA=function(p,_,g,b,S){return{u_matrix:p,u_tl_parent:_,u_scale_parent:g,u_buffer_scale:1,u_fade_t:b.mix,u_opacity:b.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(F=S.paint.get("raster-saturation"),F>0?1-1/(1.001-F):-F),u_contrast_factor:(L=S.paint.get("raster-contrast"),L>0?1/(1-L):1+L),u_spin_weights:o1(S.paint.get("raster-hue-rotate"))};var L,F};function o1(p){p*=Math.PI/180;var _=Math.sin(p),g=Math.cos(p);return[(2*g+1)/3,(-Math.sqrt(3)*_-g+1)/3,(Math.sqrt(3)*_-g+1)/3]}var Ig,fd=function(p,_,g,b,S,L,F,B,J,re){var Ce=S.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:_?_.uSizeT:0,u_size:_?_.uSize:0,u_camera_to_center_distance:Ce.cameraToCenterDistance,u_pitch:Ce.pitch/360*2*Math.PI,u_rotate_symbol:+g,u_aspect_ratio:Ce.width/Ce.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:L,u_label_plane_matrix:F,u_coord_matrix:B,u_is_text:+J,u_pitch_with_map:+b,u_texsize:re,u_texture:0}},Bf=function(p,_,g,b,S,L,F,B,J,re,Ce){var we=S.transform;return s.extend(fd(p,_,g,b,S,L,F,B,J,re),{u_gamma_scale:b?Math.cos(we._pitch)*we.cameraToCenterDistance:1,u_device_pixel_ratio:s.browser.devicePixelRatio,u_is_halo:1})},Cg=function(p,_,g,b,S,L,F,B,J,re){return s.extend(Bf(p,_,g,b,S,L,F,B,!0,J),{u_texsize_icon:re,u_texture_icon:1})},Zf=function(p,_,g){return{u_matrix:p,u_opacity:_,u_color:g}},pd=function(p,_,g,b,S,L){return s.extend((function(F,B,J,re){var Ce=J.imageManager.getPattern(F.from.toString()),we=J.imageManager.getPattern(F.to.toString()),Se=J.imageManager.getPixelSize(),Be=Se.width,Ve=Se.height,Ke=Math.pow(2,re.tileID.overscaledZ),Pe=re.tileSize*Math.pow(2,J.transform.tileZoom)/Ke,He=Pe*(re.tileID.canonical.x+re.tileID.wrap*Ke),Qe=Pe*re.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Ce.tl,u_pattern_br_a:Ce.br,u_pattern_tl_b:we.tl,u_pattern_br_b:we.br,u_texsize:[Be,Ve],u_mix:B.t,u_pattern_size_a:Ce.displaySize,u_pattern_size_b:we.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/Cr(re,1,J.transform.tileZoom),u_pixel_coord_upper:[He>>16,Qe>>16],u_pixel_coord_lower:[65535&He,65535&Qe]}})(b,L,g,S),{u_matrix:p,u_opacity:_})},a1={fillExtrusion:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_lightpos:new s.Uniform3f(p,_.u_lightpos),u_lightintensity:new s.Uniform1f(p,_.u_lightintensity),u_lightcolor:new s.Uniform3f(p,_.u_lightcolor),u_vertical_gradient:new s.Uniform1f(p,_.u_vertical_gradient),u_opacity:new s.Uniform1f(p,_.u_opacity)}},fillExtrusionPattern:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_lightpos:new s.Uniform3f(p,_.u_lightpos),u_lightintensity:new s.Uniform1f(p,_.u_lightintensity),u_lightcolor:new s.Uniform3f(p,_.u_lightcolor),u_vertical_gradient:new s.Uniform1f(p,_.u_vertical_gradient),u_height_factor:new s.Uniform1f(p,_.u_height_factor),u_image:new s.Uniform1i(p,_.u_image),u_texsize:new s.Uniform2f(p,_.u_texsize),u_pixel_coord_upper:new s.Uniform2f(p,_.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(p,_.u_pixel_coord_lower),u_scale:new s.Uniform3f(p,_.u_scale),u_fade:new s.Uniform1f(p,_.u_fade),u_opacity:new s.Uniform1f(p,_.u_opacity)}},fill:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix)}},fillPattern:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_image:new s.Uniform1i(p,_.u_image),u_texsize:new s.Uniform2f(p,_.u_texsize),u_pixel_coord_upper:new s.Uniform2f(p,_.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(p,_.u_pixel_coord_lower),u_scale:new s.Uniform3f(p,_.u_scale),u_fade:new s.Uniform1f(p,_.u_fade)}},fillOutline:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_world:new s.Uniform2f(p,_.u_world)}},fillOutlinePattern:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_world:new s.Uniform2f(p,_.u_world),u_image:new s.Uniform1i(p,_.u_image),u_texsize:new s.Uniform2f(p,_.u_texsize),u_pixel_coord_upper:new s.Uniform2f(p,_.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(p,_.u_pixel_coord_lower),u_scale:new s.Uniform3f(p,_.u_scale),u_fade:new s.Uniform1f(p,_.u_fade)}},circle:function(p,_){return{u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(p,_.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(p,_.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(p,_.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(p,_.u_matrix)}},collisionBox:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(p,_.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(p,_.u_extrude_scale),u_overscale_factor:new s.Uniform1f(p,_.u_overscale_factor)}},collisionCircle:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_inv_matrix:new s.UniformMatrix4f(p,_.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(p,_.u_viewport_size)}},debug:function(p,_){return{u_color:new s.UniformColor(p,_.u_color),u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_overlay:new s.Uniform1i(p,_.u_overlay),u_overlay_scale:new s.Uniform1f(p,_.u_overlay_scale)}},clippingMask:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix)}},heatmap:function(p,_){return{u_extrude_scale:new s.Uniform1f(p,_.u_extrude_scale),u_intensity:new s.Uniform1f(p,_.u_intensity),u_matrix:new s.UniformMatrix4f(p,_.u_matrix)}},heatmapTexture:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_world:new s.Uniform2f(p,_.u_world),u_image:new s.Uniform1i(p,_.u_image),u_color_ramp:new s.Uniform1i(p,_.u_color_ramp),u_opacity:new s.Uniform1f(p,_.u_opacity)}},hillshade:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_image:new s.Uniform1i(p,_.u_image),u_latrange:new s.Uniform2f(p,_.u_latrange),u_light:new s.Uniform2f(p,_.u_light),u_shadow:new s.UniformColor(p,_.u_shadow),u_highlight:new s.UniformColor(p,_.u_highlight),u_accent:new s.UniformColor(p,_.u_accent)}},hillshadePrepare:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_image:new s.Uniform1i(p,_.u_image),u_dimension:new s.Uniform2f(p,_.u_dimension),u_zoom:new s.Uniform1f(p,_.u_zoom),u_unpack:new s.Uniform4f(p,_.u_unpack)}},line:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_ratio:new s.Uniform1f(p,_.u_ratio),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(p,_.u_units_to_pixels)}},lineGradient:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_ratio:new s.Uniform1f(p,_.u_ratio),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(p,_.u_units_to_pixels),u_image:new s.Uniform1i(p,_.u_image),u_image_height:new s.Uniform1f(p,_.u_image_height)}},linePattern:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_texsize:new s.Uniform2f(p,_.u_texsize),u_ratio:new s.Uniform1f(p,_.u_ratio),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_image:new s.Uniform1i(p,_.u_image),u_units_to_pixels:new s.Uniform2f(p,_.u_units_to_pixels),u_scale:new s.Uniform3f(p,_.u_scale),u_fade:new s.Uniform1f(p,_.u_fade)}},lineSDF:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_ratio:new s.Uniform1f(p,_.u_ratio),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(p,_.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(p,_.u_patternscale_a),u_patternscale_b:new s.Uniform2f(p,_.u_patternscale_b),u_sdfgamma:new s.Uniform1f(p,_.u_sdfgamma),u_image:new s.Uniform1i(p,_.u_image),u_tex_y_a:new s.Uniform1f(p,_.u_tex_y_a),u_tex_y_b:new s.Uniform1f(p,_.u_tex_y_b),u_mix:new s.Uniform1f(p,_.u_mix)}},raster:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_tl_parent:new s.Uniform2f(p,_.u_tl_parent),u_scale_parent:new s.Uniform1f(p,_.u_scale_parent),u_buffer_scale:new s.Uniform1f(p,_.u_buffer_scale),u_fade_t:new s.Uniform1f(p,_.u_fade_t),u_opacity:new s.Uniform1f(p,_.u_opacity),u_image0:new s.Uniform1i(p,_.u_image0),u_image1:new s.Uniform1i(p,_.u_image1),u_brightness_low:new s.Uniform1f(p,_.u_brightness_low),u_brightness_high:new s.Uniform1f(p,_.u_brightness_high),u_saturation_factor:new s.Uniform1f(p,_.u_saturation_factor),u_contrast_factor:new s.Uniform1f(p,_.u_contrast_factor),u_spin_weights:new s.Uniform3f(p,_.u_spin_weights)}},symbolIcon:function(p,_){return{u_is_size_zoom_constant:new s.Uniform1i(p,_.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(p,_.u_is_size_feature_constant),u_size_t:new s.Uniform1f(p,_.u_size_t),u_size:new s.Uniform1f(p,_.u_size),u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_pitch:new s.Uniform1f(p,_.u_pitch),u_rotate_symbol:new s.Uniform1i(p,_.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(p,_.u_aspect_ratio),u_fade_change:new s.Uniform1f(p,_.u_fade_change),u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(p,_.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(p,_.u_coord_matrix),u_is_text:new s.Uniform1i(p,_.u_is_text),u_pitch_with_map:new s.Uniform1i(p,_.u_pitch_with_map),u_texsize:new s.Uniform2f(p,_.u_texsize),u_texture:new s.Uniform1i(p,_.u_texture)}},symbolSDF:function(p,_){return{u_is_size_zoom_constant:new s.Uniform1i(p,_.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(p,_.u_is_size_feature_constant),u_size_t:new s.Uniform1f(p,_.u_size_t),u_size:new s.Uniform1f(p,_.u_size),u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_pitch:new s.Uniform1f(p,_.u_pitch),u_rotate_symbol:new s.Uniform1i(p,_.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(p,_.u_aspect_ratio),u_fade_change:new s.Uniform1f(p,_.u_fade_change),u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(p,_.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(p,_.u_coord_matrix),u_is_text:new s.Uniform1i(p,_.u_is_text),u_pitch_with_map:new s.Uniform1i(p,_.u_pitch_with_map),u_texsize:new s.Uniform2f(p,_.u_texsize),u_texture:new s.Uniform1i(p,_.u_texture),u_gamma_scale:new s.Uniform1f(p,_.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(p,_.u_is_halo)}},symbolTextAndIcon:function(p,_){return{u_is_size_zoom_constant:new s.Uniform1i(p,_.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(p,_.u_is_size_feature_constant),u_size_t:new s.Uniform1f(p,_.u_size_t),u_size:new s.Uniform1f(p,_.u_size),u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_pitch:new s.Uniform1f(p,_.u_pitch),u_rotate_symbol:new s.Uniform1i(p,_.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(p,_.u_aspect_ratio),u_fade_change:new s.Uniform1f(p,_.u_fade_change),u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(p,_.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(p,_.u_coord_matrix),u_is_text:new s.Uniform1i(p,_.u_is_text),u_pitch_with_map:new s.Uniform1i(p,_.u_pitch_with_map),u_texsize:new s.Uniform2f(p,_.u_texsize),u_texsize_icon:new s.Uniform2f(p,_.u_texsize_icon),u_texture:new s.Uniform1i(p,_.u_texture),u_texture_icon:new s.Uniform1i(p,_.u_texture_icon),u_gamma_scale:new s.Uniform1f(p,_.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(p,_.u_is_halo)}},background:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_opacity:new s.Uniform1f(p,_.u_opacity),u_color:new s.UniformColor(p,_.u_color)}},backgroundPattern:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_opacity:new s.Uniform1f(p,_.u_opacity),u_image:new s.Uniform1i(p,_.u_image),u_pattern_tl_a:new s.Uniform2f(p,_.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(p,_.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(p,_.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(p,_.u_pattern_br_b),u_texsize:new s.Uniform2f(p,_.u_texsize),u_mix:new s.Uniform1f(p,_.u_mix),u_pattern_size_a:new s.Uniform2f(p,_.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(p,_.u_pattern_size_b),u_scale_a:new s.Uniform1f(p,_.u_scale_a),u_scale_b:new s.Uniform1f(p,_.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(p,_.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(p,_.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(p,_.u_tile_units_to_pixels)}}};function gd(p,_,g,b,S,L,F){for(var B=p.context,J=B.gl,re=p.useProgram("collisionBox"),Ce=[],we=0,Se=0,Be=0;Be<b.length;Be++){var Ve=b[Be],Ke=_.getTile(Ve),Pe=Ke.getBucket(g);if(Pe){var He=Ve.posMatrix;S[0]===0&&S[1]===0||(He=p.translatePosMatrix(Ve.posMatrix,Ke,S,L));var Qe=F?Pe.textCollisionBox:Pe.iconCollisionBox,rt=Pe.collisionCircleArray;if(rt.length>0){var ht=s.create(),lt=He;s.mul(ht,Pe.placementInvProjMatrix,p.transform.glCoordMatrix),s.mul(ht,ht,Pe.placementViewportMatrix),Ce.push({circleArray:rt,circleOffset:Se,transform:lt,invTransform:ht}),Se=we+=rt.length/4}Qe&&re.draw(B,J.LINES,Ae.disabled,Me.disabled,p.colorModeForRenderPass(),Ye.disabled,Qc(He,p.transform,Ke),g.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,p.transform.zoom,null,null,Qe.collisionVertexBuffer)}}if(F&&Ce.length){var ft=p.useProgram("collisionCircle"),wt=new s.StructArrayLayout2f1f2i16;wt.resize(4*we),wt._trim();for(var Vt=0,Ot=0,en=Ce;Ot<en.length;Ot+=1)for(var vn=en[Ot],Cn=0;Cn<vn.circleArray.length/4;Cn++){var In=4*Cn,wi=vn.circleArray[In+0],nn=vn.circleArray[In+1],Nn=vn.circleArray[In+2],$n=vn.circleArray[In+3];wt.emplace(Vt++,wi,nn,Nn,$n,0),wt.emplace(Vt++,wi,nn,Nn,$n,1),wt.emplace(Vt++,wi,nn,Nn,$n,2),wt.emplace(Vt++,wi,nn,Nn,$n,3)}(!Ig||Ig.length<2*we)&&(Ig=(function(Nr){var oo=2*Nr,Fs=new s.StructArrayLayout3ui6;Fs.resize(oo),Fs._trim();for(var Lr=0;Lr<oo;Lr++){var Hr=6*Lr;Fs.uint16[Hr+0]=4*Lr+0,Fs.uint16[Hr+1]=4*Lr+1,Fs.uint16[Hr+2]=4*Lr+2,Fs.uint16[Hr+3]=4*Lr+2,Fs.uint16[Hr+4]=4*Lr+3,Fs.uint16[Hr+5]=4*Lr+0}return Fs})(we));for(var On=B.createIndexBuffer(Ig,!0),Fn=B.createVertexBuffer(wt,s.collisionCircleLayout.members,!0),jn=0,Pn=Ce;jn<Pn.length;jn+=1){var Tn=Pn[jn],bs=i1(Tn.transform,Tn.invTransform,p.transform);ft.draw(B,J.TRIANGLES,Ae.disabled,Me.disabled,p.colorModeForRenderPass(),Ye.disabled,bs,g.id,Fn,On,s.SegmentVector.simpleSegment(0,2*Tn.circleOffset,Tn.circleArray.length,Tn.circleArray.length/2),null,p.transform.zoom,null,null,null)}Fn.destroy(),On.destroy()}}var sl=s.identity(new Float32Array(16));function l1(p,_,g,b,S,L){var F=s.getAnchorAlignment(p),B=-(F.horizontalAlign-.5)*_,J=-(F.verticalAlign-.5)*g,re=s.evaluateVariableOffset(p,b);return new s.Point((B/S+re[0])*L,(J/S+re[1])*L)}function u1(p,_,g,b,S,L,F,B,J,re,Ce){var we=p.text.placedSymbolArray,Se=p.text.dynamicLayoutVertexArray,Be=p.icon.dynamicLayoutVertexArray,Ve={};Se.clear();for(var Ke=0;Ke<we.length;Ke++){var Pe=we.get(Ke),He=Pe.hidden||!Pe.crossTileID||p.allowVerticalPlacement&&!Pe.placedOrientation?null:b[Pe.crossTileID];if(He){var Qe=new s.Point(Pe.anchorX,Pe.anchorY),rt=Mn(Qe,g?B:F),ht=Ci(L.cameraToCenterDistance,rt.signedDistanceFromCamera),lt=S.evaluateSizeForFeature(p.textSizeData,re,Pe)*ht/s.ONE_EM;g&&(lt*=p.tilePixelRatio/J);for(var ft=l1(He.anchor,He.width,He.height,He.textOffset,He.textBoxScale,lt),wt=g?Mn(Qe.add(ft),F).point:rt.point.add(_?ft.rotate(-L.angle):ft),Vt=p.allowVerticalPlacement&&Pe.placedOrientation===s.WritingMode.vertical?Math.PI/2:0,Ot=0;Ot<Pe.numGlyphs;Ot++)s.addDynamicAttributes(Se,wt,Vt);Ce&&Pe.associatedIconIndex>=0&&(Ve[Pe.associatedIconIndex]={shiftedAnchor:wt,angle:Vt})}else ho(Pe.numGlyphs,Se)}if(Ce){Be.clear();for(var en=p.icon.placedSymbolArray,vn=0;vn<en.length;vn++){var Cn=en.get(vn);if(Cn.hidden)ho(Cn.numGlyphs,Be);else{var In=Ve[vn];if(In)for(var wi=0;wi<Cn.numGlyphs;wi++)s.addDynamicAttributes(Be,In.shiftedAnchor,In.angle);else ho(Cn.numGlyphs,Be)}}p.icon.dynamicLayoutVertexBuffer.updateData(Be)}p.text.dynamicLayoutVertexBuffer.updateData(Se)}function c1(p,_,g){return g.iconsInText&&_?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function nh(p,_,g,b,S,L,F,B,J,re,Ce,we){for(var Se=p.context,Be=Se.gl,Ve=p.transform,Ke=B==="map",Pe=J==="map",He=Ke&&g.layout.get("symbol-placement")!=="point",Qe=Ke&&!Pe&&!He,rt=g.layout.get("symbol-sort-key").constantOr(1)!==void 0,ht=!1,lt=p.depthModeForSublayer(0,Ae.ReadOnly),ft=g.layout.get("text-variable-anchor"),wt=[],Vt=0,Ot=b;Vt<Ot.length;Vt+=1){var en=Ot[Vt],vn=_.getTile(en),Cn=vn.getBucket(g);if(Cn){var In=S?Cn.text:Cn.icon;if(In&&In.segments.get().length){var wi=In.programConfigurations.get(g.id),nn=S||Cn.sdfIcons,Nn=S?Cn.textSizeData:Cn.iconSizeData,$n=Pe||Ve.pitch!==0,On=p.useProgram(c1(nn,S,Cn),wi),Fn=s.evaluateSizeForZoom(Nn,Ve.zoom),jn=void 0,Pn=[0,0],Tn=void 0,bs=void 0,Nr=null,oo=void 0;if(S)Tn=vn.glyphAtlasTexture,bs=Be.LINEAR,jn=vn.glyphAtlasTexture.size,Cn.iconsInText&&(Pn=vn.imageAtlasTexture.size,Nr=vn.imageAtlasTexture,oo=$n||p.options.rotating||p.options.zooming||Nn.kind==="composite"||Nn.kind==="camera"?Be.LINEAR:Be.NEAREST);else{var Fs=g.layout.get("icon-size").constantOr(0)!==1||Cn.iconsNeedLinear;Tn=vn.imageAtlasTexture,bs=nn||p.options.rotating||p.options.zooming||Fs||$n?Be.LINEAR:Be.NEAREST,jn=vn.imageAtlasTexture.size}var Lr=Cr(vn,1,p.transform.zoom),Hr=or(en.posMatrix,Pe,Ke,p.transform,Lr),Ho=Gi(en.posMatrix,Pe,Ke,p.transform,Lr),mo=ft&&Cn.hasTextData(),ic=g.layout.get("icon-text-fit")!=="none"&&mo&&Cn.hasIconData();He&&Pf(Cn,en.posMatrix,p,S,Hr,Ho,Pe,re);var Eo=p.translatePosMatrix(en.posMatrix,vn,L,F),cl=He||S&&ft||ic?sl:Hr,Ga=p.translatePosMatrix(Ho,vn,L,F,!0),Qf=nn&&g.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,xd={program:On,buffers:In,uniformValues:nn?Cn.iconsInText?Cg(Nn.kind,Fn,Qe,Pe,p,Eo,cl,Ga,jn,Pn):Bf(Nn.kind,Fn,Qe,Pe,p,Eo,cl,Ga,S,jn):fd(Nn.kind,Fn,Qe,Pe,p,Eo,cl,Ga,S,jn),atlasTexture:Tn,atlasTextureIcon:Nr,atlasInterpolation:bs,atlasInterpolationIcon:oo,isSDF:nn,hasHalo:Qf};if(rt&&Cn.canOverlap){ht=!0;for(var rc=0,Id=In.segments.get();rc<Id.length;rc+=1){var ep=Id[rc];wt.push({segments:new s.SegmentVector([ep]),sortKey:ep.sortKey,state:xd})}}else wt.push({segments:In.segments,sortKey:0,state:xd})}}}ht&&wt.sort((function(sc,lh){return sc.sortKey-lh.sortKey}));for(var Dl=0,tp=wt;Dl<tp.length;Dl+=1){var Vl=tp[Dl],xs=Vl.state;if(Se.activeTexture.set(Be.TEXTURE0),xs.atlasTexture.bind(xs.atlasInterpolation,Be.CLAMP_TO_EDGE),xs.atlasTextureIcon&&(Se.activeTexture.set(Be.TEXTURE1),xs.atlasTextureIcon&&xs.atlasTextureIcon.bind(xs.atlasInterpolationIcon,Be.CLAMP_TO_EDGE)),xs.isSDF){var uu=xs.uniformValues;xs.hasHalo&&(uu.u_is_halo=1,Wf(xs.buffers,Vl.segments,g,p,xs.program,lt,Ce,we,uu)),uu.u_is_halo=0}Wf(xs.buffers,Vl.segments,g,p,xs.program,lt,Ce,we,xs.uniformValues)}}function Wf(p,_,g,b,S,L,F,B,J){var re=b.context;S.draw(re,re.gl.TRIANGLES,L,F,B,Ye.disabled,J,g.id,p.layoutVertexBuffer,p.indexBuffer,_,g.paint,b.transform.zoom,p.programConfigurations.get(g.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function wg(p,_,g,b,S,L,F){var B,J,re,Ce,we,Se=p.context.gl,Be=g.paint.get("fill-pattern"),Ve=Be&&Be.constantOr(1),Ke=g.getCrossfadeParameters();F?(J=Ve&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=Se.LINES):(J=Ve?"fillPattern":"fill",B=Se.TRIANGLES);for(var Pe=0,He=b;Pe<He.length;Pe+=1){var Qe=He[Pe],rt=_.getTile(Qe);if(!Ve||rt.patternsLoaded()){var ht=rt.getBucket(g);if(ht){var lt=ht.programConfigurations.get(g.id),ft=p.useProgram(J,lt);Ve&&(p.context.activeTexture.set(Se.TEXTURE0),rt.imageAtlasTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),lt.updatePaintBuffers(Ke));var wt=Be.constantOr(null);if(wt&&rt.imageAtlas){var Vt=rt.imageAtlas,Ot=Vt.patternPositions[wt.to.toString()],en=Vt.patternPositions[wt.from.toString()];Ot&&en&&lt.setConstantPatternPositions(Ot,en)}var vn=p.translatePosMatrix(Qe.posMatrix,rt,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));if(F){Ce=ht.indexBuffer2,we=ht.segments2;var Cn=[Se.drawingBufferWidth,Se.drawingBufferHeight];re=J==="fillOutlinePattern"&&Ve?n1(vn,p,Ke,rt,Cn):t1(vn,Cn)}else Ce=ht.indexBuffer,we=ht.segments,re=Ve?qc(vn,p,Ke,rt):Ju(vn);ft.draw(p.context,B,S,p.stencilModeForClipping(Qe),L,Ye.disabled,re,g.id,ht.layoutVertexBuffer,Ce,we,g.paint,p.transform.zoom,lt)}}}}function f_(p,_,g,b,S,L,F){for(var B=p.context,J=B.gl,re=g.paint.get("fill-extrusion-pattern"),Ce=re.constantOr(1),we=g.getCrossfadeParameters(),Se=g.paint.get("fill-extrusion-opacity"),Be=0,Ve=b;Be<Ve.length;Be+=1){var Ke=Ve[Be],Pe=_.getTile(Ke),He=Pe.getBucket(g);if(He){var Qe=He.programConfigurations.get(g.id),rt=p.useProgram(Ce?"fillExtrusionPattern":"fillExtrusion",Qe);Ce&&(p.context.activeTexture.set(J.TEXTURE0),Pe.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Qe.updatePaintBuffers(we));var ht=re.constantOr(null);if(ht&&Pe.imageAtlas){var lt=Pe.imageAtlas,ft=lt.patternPositions[ht.to.toString()],wt=lt.patternPositions[ht.from.toString()];ft&&wt&&Qe.setConstantPatternPositions(ft,wt)}var Vt=p.translatePosMatrix(Ke.posMatrix,Pe,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),Ot=g.paint.get("fill-extrusion-vertical-gradient"),en=Ce?Jc(Vt,p,Ot,Se,Ke,we,Pe):e1(Vt,p,Ot,Se);rt.draw(B,B.gl.TRIANGLES,S,L,F,Ye.backCCW,en,g.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,g.paint,p.transform.zoom,Qe)}}}function Ag(p,_,g,b,S,L){var F=p.context,B=F.gl,J=_.fbo;if(J){var re=p.useProgram("hillshade");F.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,J.colorAttachment.get());var Ce=(function(we,Se,Be){var Ve=Be.paint.get("hillshade-shadow-color"),Ke=Be.paint.get("hillshade-highlight-color"),Pe=Be.paint.get("hillshade-accent-color"),He=Be.paint.get("hillshade-illumination-direction")*(Math.PI/180);Be.paint.get("hillshade-illumination-anchor")==="viewport"&&(He-=we.transform.angle);var Qe,rt,ht,lt=!we.options.moving;return{u_matrix:we.transform.calculatePosMatrix(Se.tileID.toUnwrapped(),lt),u_image:0,u_latrange:(Qe=Se.tileID,rt=Math.pow(2,Qe.canonical.z),ht=Qe.canonical.y,[new s.MercatorCoordinate(0,ht/rt).toLngLat().lat,new s.MercatorCoordinate(0,(ht+1)/rt).toLngLat().lat]),u_light:[Be.paint.get("hillshade-exaggeration"),He],u_shadow:Ve,u_highlight:Ke,u_accent:Pe}})(p,_,g);re.draw(F,B.TRIANGLES,b,S,L,Ye.disabled,Ce,g.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}}function BA(p,_,g,b,S,L){var F=p.context,B=F.gl,J=_.dem;if(J&&J.data){var re=J.dim,Ce=J.stride,we=J.getPixels();if(F.activeTexture.set(B.TEXTURE1),F.pixelStoreUnpackPremultiplyAlpha.set(!1),_.demTexture=_.demTexture||p.getTileTexture(Ce),_.demTexture){var Se=_.demTexture;Se.update(we,{premultiply:!1}),Se.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else _.demTexture=new s.Texture(F,we,B.RGBA,{premultiply:!1}),_.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);F.activeTexture.set(B.TEXTURE0);var Be=_.fbo;if(!Be){var Ve=new s.Texture(F,{width:re,height:re,data:null},B.RGBA);Ve.bind(B.LINEAR,B.CLAMP_TO_EDGE),(Be=_.fbo=F.createFramebuffer(re,re,!0)).colorAttachment.set(Ve.texture)}F.bindFramebuffer.set(Be.framebuffer),F.viewport.set([0,0,re,re]),p.useProgram("hillshadePrepare").draw(F,B.TRIANGLES,b,S,L,Ye.disabled,(function(Ke,Pe){var He=Pe.stride,Qe=s.create();return s.ortho(Qe,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(Qe,Qe,[0,-s.EXTENT,0]),{u_matrix:Qe,u_image:1,u_dimension:[He,He],u_zoom:Ke.overscaledZ,u_unpack:Pe.getUnpackVector()}})(_.tileID,J),g.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),_.needsHillshadePrepare=!1}}function Sg(p,_,g,b,S){var L=b.paint.get("raster-fade-duration");if(L>0){var F=s.browser.now(),B=(F-p.timeAdded)/L,J=_?(F-_.timeAdded)/L:-1,re=g.getSource(),Ce=S.coveringZoomLevel({tileSize:re.tileSize,roundZoom:re.roundZoom}),we=!_||Math.abs(_.tileID.overscaledZ-Ce)>Math.abs(p.tileID.overscaledZ-Ce),Se=we&&p.refreshedUponExpiration?1:s.clamp(we?B:1-J,0,1);return p.refreshedUponExpiration&&B>=1&&(p.refreshedUponExpiration=!1),_?{opacity:1,mix:1-Se}:{opacity:Se,mix:0}}return{opacity:1,mix:0}}var p_=new s.Color(1,0,0,1),h1=new s.Color(0,1,0,1),d1=new s.Color(0,0,1,1),Eg=new s.Color(1,0,1,1),g_=new s.Color(0,1,1,1);function m_(p,_,g,b){zf(p,0,_+g/2,p.transform.width,g,b)}function y_(p,_,g,b){zf(p,_-g/2,0,g,p.transform.height,b)}function zf(p,_,g,b,S,L){var F=p.context,B=F.gl;B.enable(B.SCISSOR_TEST),B.scissor(_*s.browser.devicePixelRatio,g*s.browser.devicePixelRatio,b*s.browser.devicePixelRatio,S*s.browser.devicePixelRatio),F.clear({color:L}),B.disable(B.SCISSOR_TEST)}function f1(p,_,g){var b=p.context,S=b.gl,L=g.posMatrix,F=p.useProgram("debug"),B=Ae.disabled,J=Me.disabled,re=p.colorModeForRenderPass();b.activeTexture.set(S.TEXTURE0),p.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),F.draw(b,S.LINE_STRIP,B,J,re,Ye.disabled,eh(L,s.Color.red),"$debug",p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments);var Ce=_.getTileByID(g.key).latestRawTileData,we=Math.floor((Ce&&Ce.byteLength||0)/1024),Se=_.getTile(g).tileSize,Be=512/Math.min(Se,512)*(g.overscaledZ/p.transform.zoom)*.5,Ve=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(Ve+=" => "+g.overscaledZ),(function(Ke,Pe){Ke.initDebugOverlayCanvas();var He=Ke.debugOverlayCanvas,Qe=Ke.context.gl,rt=Ke.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,He.width,He.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(Pe,5,5),rt.strokeText(Pe,5,5),Ke.debugOverlayTexture.update(He),Ke.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)})(p,Ve+" "+we+"kb"),F.draw(b,S.TRIANGLES,B,J,$e.alphaBlended,Ye.disabled,eh(L,s.Color.transparent,Be),"$debug",p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments)}var ih={symbol:function(p,_,g,b,S){if(p.renderPass==="translucent"){var L=Me.disabled,F=p.colorModeForRenderPass();g.layout.get("text-variable-anchor")&&(function(B,J,re,Ce,we,Se,Be){for(var Ve=J.transform,Ke=we==="map",Pe=Se==="map",He=0,Qe=B;He<Qe.length;He+=1){var rt=Qe[He],ht=Ce.getTile(rt),lt=ht.getBucket(re);if(lt&&lt.text&&lt.text.segments.get().length){var ft=s.evaluateSizeForZoom(lt.textSizeData,Ve.zoom),wt=Cr(ht,1,J.transform.zoom),Vt=or(rt.posMatrix,Pe,Ke,J.transform,wt),Ot=re.layout.get("icon-text-fit")!=="none"&&lt.hasIconData();if(ft){var en=Math.pow(2,Ve.zoom-ht.tileID.overscaledZ);u1(lt,Ke,Pe,Be,s.symbolSize,Ve,Vt,rt.posMatrix,en,ft,Ot)}}}})(b,p,g,_,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),S),g.paint.get("icon-opacity").constantOr(1)!==0&&nh(p,_,g,b,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),L,F),g.paint.get("text-opacity").constantOr(1)!==0&&nh(p,_,g,b,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),L,F),_.map.showCollisionBoxes&&(gd(p,_,g,b,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),gd(p,_,g,b,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))}},circle:function(p,_,g,b){if(p.renderPass==="translucent"){var S=g.paint.get("circle-opacity"),L=g.paint.get("circle-stroke-width"),F=g.paint.get("circle-stroke-opacity"),B=g.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||L.constantOr(1)!==0&&F.constantOr(1)!==0){for(var J=p.context,re=J.gl,Ce=p.depthModeForSublayer(0,Ae.ReadOnly),we=Me.disabled,Se=p.colorModeForRenderPass(),Be=[],Ve=0;Ve<b.length;Ve++){var Ke=b[Ve],Pe=_.getTile(Ke),He=Pe.getBucket(g);if(He){var Qe=He.programConfigurations.get(g.id),rt={programConfiguration:Qe,program:p.useProgram("circle",Qe),layoutVertexBuffer:He.layoutVertexBuffer,indexBuffer:He.indexBuffer,uniformValues:d_(p,Ke,Pe,g)};if(B)for(var ht=0,lt=He.segments.get();ht<lt.length;ht+=1){var ft=lt[ht];Be.push({segments:new s.SegmentVector([ft]),sortKey:ft.sortKey,state:rt})}else Be.push({segments:He.segments,sortKey:0,state:rt})}}B&&Be.sort((function(vn,Cn){return vn.sortKey-Cn.sortKey}));for(var wt=0,Vt=Be;wt<Vt.length;wt+=1){var Ot=Vt[wt],en=Ot.state;en.program.draw(J,re.TRIANGLES,Ce,we,Se,Ye.disabled,en.uniformValues,g.id,en.layoutVertexBuffer,en.indexBuffer,Ot.segments,g.paint,p.transform.zoom,en.programConfiguration)}}}},heatmap:function(p,_,g,b){if(g.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){var S=p.context,L=S.gl,F=Me.disabled,B=new $e([L.ONE,L.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(Be,Ve,Ke){var Pe=Be.gl;Be.activeTexture.set(Pe.TEXTURE1),Be.viewport.set([0,0,Ve.width/4,Ve.height/4]);var He=Ke.heatmapFbo;if(He)Pe.bindTexture(Pe.TEXTURE_2D,He.colorAttachment.get()),Be.bindFramebuffer.set(He.framebuffer);else{var Qe=Pe.createTexture();Pe.bindTexture(Pe.TEXTURE_2D,Qe),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_WRAP_S,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_WRAP_T,Pe.CLAMP_TO_EDGE),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_MIN_FILTER,Pe.LINEAR),Pe.texParameteri(Pe.TEXTURE_2D,Pe.TEXTURE_MAG_FILTER,Pe.LINEAR),He=Ke.heatmapFbo=Be.createFramebuffer(Ve.width/4,Ve.height/4,!1),(function(rt,ht,lt,ft){var wt=rt.gl;wt.texImage2D(wt.TEXTURE_2D,0,wt.RGBA,ht.width/4,ht.height/4,0,wt.RGBA,rt.extRenderToTextureHalfFloat?rt.extTextureHalfFloat.HALF_FLOAT_OES:wt.UNSIGNED_BYTE,null),ft.colorAttachment.set(lt)})(Be,Ve,Qe,He)}})(S,p,g),S.clear({color:s.Color.transparent});for(var J=0;J<b.length;J++){var re=b[J];if(!_.hasRenderableParent(re)){var Ce=_.getTile(re),we=Ce.getBucket(g);if(we){var Se=we.programConfigurations.get(g.id);p.useProgram("heatmap",Se).draw(S,L.TRIANGLES,Ae.disabled,F,B,Ye.disabled,r1(re.posMatrix,Ce,p.transform.zoom,g.paint.get("heatmap-intensity")),g.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,g.paint,p.transform.zoom,Se)}}}S.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),(function(Be,Ve){var Ke=Be.context,Pe=Ke.gl,He=Ve.heatmapFbo;if(He){Ke.activeTexture.set(Pe.TEXTURE0),Pe.bindTexture(Pe.TEXTURE_2D,He.colorAttachment.get()),Ke.activeTexture.set(Pe.TEXTURE1);var Qe=Ve.colorRampTexture;Qe||(Qe=Ve.colorRampTexture=new s.Texture(Ke,Ve.colorRamp,Pe.RGBA)),Qe.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),Be.useProgram("heatmapTexture").draw(Ke,Pe.TRIANGLES,Ae.disabled,Me.disabled,Be.colorModeForRenderPass(),Ye.disabled,(function(rt,ht,lt,ft){var wt=s.create();s.ortho(wt,0,rt.width,rt.height,0,0,1);var Vt=rt.context.gl;return{u_matrix:wt,u_world:[Vt.drawingBufferWidth,Vt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ht.paint.get("heatmap-opacity")}})(Be,Ve),Ve.id,Be.viewportBuffer,Be.quadTriangleIndexBuffer,Be.viewportSegments,Ve.paint,Be.transform.zoom)}})(p,g))},line:function(p,_,g,b){if(p.renderPass==="translucent"){var S=g.paint.get("line-opacity"),L=g.paint.get("line-width");if(S.constantOr(1)!==0&&L.constantOr(1)!==0)for(var F=p.depthModeForSublayer(0,Ae.ReadOnly),B=p.colorModeForRenderPass(),J=g.paint.get("line-dasharray"),re=g.paint.get("line-pattern"),Ce=re.constantOr(1),we=g.paint.get("line-gradient"),Se=g.getCrossfadeParameters(),Be=Ce?"linePattern":J?"lineSDF":we?"lineGradient":"line",Ve=p.context,Ke=Ve.gl,Pe=!0,He=0,Qe=b;He<Qe.length;He+=1){var rt=Qe[He],ht=_.getTile(rt);if(!Ce||ht.patternsLoaded()){var lt=ht.getBucket(g);if(lt){var ft=lt.programConfigurations.get(g.id),wt=p.context.program.get(),Vt=p.useProgram(Be,ft),Ot=Pe||Vt.program!==wt,en=re.constantOr(null);if(en&&ht.imageAtlas){var vn=ht.imageAtlas,Cn=vn.patternPositions[en.to.toString()],In=vn.patternPositions[en.from.toString()];Cn&&In&&ft.setConstantPatternPositions(Cn,In)}var wi=Ce?xg(p,ht,g,Se):J?DA(p,ht,g,J,Se):we?cr(p,ht,g,lt.lineClipsArray.length):Vf(p,ht,g);if(Ce)Ve.activeTexture.set(Ke.TEXTURE0),ht.imageAtlasTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE),ft.updatePaintBuffers(Se);else if(J&&(Ot||p.lineAtlas.dirty))Ve.activeTexture.set(Ke.TEXTURE0),p.lineAtlas.bind(Ve);else if(we){var nn=lt.gradients[g.id],Nn=nn.texture;if(g.gradientVersion!==nn.version){var $n=256;if(g.stepInterpolant){var On=_.getSource().maxzoom,Fn=rt.canonical.z===On?Math.ceil(1<<p.transform.maxZoom-rt.canonical.z):1;$n=s.clamp(s.nextPowerOfTwo(lt.maxLineLength/s.EXTENT*1024*Fn),256,Ve.maxTextureSize)}nn.gradient=s.renderColorRamp({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:$n,image:nn.gradient||void 0,clips:lt.lineClipsArray}),nn.texture?nn.texture.update(nn.gradient):nn.texture=new s.Texture(Ve,nn.gradient,Ke.RGBA),nn.version=g.gradientVersion,Nn=nn.texture}Ve.activeTexture.set(Ke.TEXTURE0),Nn.bind(g.stepInterpolant?Ke.NEAREST:Ke.LINEAR,Ke.CLAMP_TO_EDGE)}Vt.draw(Ve,Ke.TRIANGLES,F,p.stencilModeForClipping(rt),B,Ye.disabled,wi,g.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,g.paint,p.transform.zoom,ft,lt.layoutVertexBuffer2),Pe=!1}}}}},fill:function(p,_,g,b){var S=g.paint.get("fill-color"),L=g.paint.get("fill-opacity");if(L.constantOr(1)!==0){var F=p.colorModeForRenderPass(),B=g.paint.get("fill-pattern"),J=p.opaquePassEnabledForLayer()&&!B.constantOr(1)&&S.constantOr(s.Color.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===J){var re=p.depthModeForSublayer(1,p.renderPass==="opaque"?Ae.ReadWrite:Ae.ReadOnly);wg(p,_,g,b,re,F,!1)}if(p.renderPass==="translucent"&&g.paint.get("fill-antialias")){var Ce=p.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,Ae.ReadOnly);wg(p,_,g,b,Ce,F,!0)}}},"fill-extrusion":function(p,_,g,b){var S=g.paint.get("fill-extrusion-opacity");if(S!==0&&p.renderPass==="translucent"){var L=new Ae(p.context.gl.LEQUAL,Ae.ReadWrite,p.depthRangeFor3D);if(S!==1||g.paint.get("fill-extrusion-pattern").constantOr(1))f_(p,_,g,b,L,Me.disabled,$e.disabled),f_(p,_,g,b,L,p.stencilModeFor3D(),p.colorModeForRenderPass());else{var F=p.colorModeForRenderPass();f_(p,_,g,b,L,Me.disabled,F)}}},hillshade:function(p,_,g,b){if(p.renderPass==="offscreen"||p.renderPass==="translucent"){for(var S=p.context,L=p.depthModeForSublayer(0,Ae.ReadOnly),F=p.colorModeForRenderPass(),B=p.renderPass==="translucent"?p.stencilConfigForOverlap(b):[{},b],J=B[0],re=0,Ce=B[1];re<Ce.length;re+=1){var we=Ce[re],Se=_.getTile(we);Se.needsHillshadePrepare&&p.renderPass==="offscreen"?BA(p,Se,g,L,Me.disabled,F):p.renderPass==="translucent"&&Ag(p,Se,g,L,J[we.overscaledZ],F)}S.viewport.set([0,0,p.width,p.height])}},raster:function(p,_,g,b){if(p.renderPass==="translucent"&&g.paint.get("raster-opacity")!==0&&b.length)for(var S=p.context,L=S.gl,F=_.getSource(),B=p.useProgram("raster"),J=p.colorModeForRenderPass(),re=F instanceof j?[{},b]:p.stencilConfigForOverlap(b),Ce=re[0],we=re[1],Se=we[we.length-1].overscaledZ,Be=!p.options.moving,Ve=0,Ke=we;Ve<Ke.length;Ve+=1){var Pe=Ke[Ve],He=p.depthModeForSublayer(Pe.overscaledZ-Se,g.paint.get("raster-opacity")===1?Ae.ReadWrite:Ae.ReadOnly,L.LESS),Qe=_.getTile(Pe),rt=p.transform.calculatePosMatrix(Pe.toUnwrapped(),Be);Qe.registerFadeDuration(g.paint.get("raster-fade-duration"));var ht=_.findLoadedParent(Pe,0),lt=Sg(Qe,ht,_,g,p.transform),ft=void 0,wt=void 0,Vt=g.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;S.activeTexture.set(L.TEXTURE0),Qe.texture.bind(Vt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(L.TEXTURE1),ht?(ht.texture.bind(Vt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),ft=Math.pow(2,ht.tileID.overscaledZ-Qe.tileID.overscaledZ),wt=[Qe.tileID.canonical.x*ft%1,Qe.tileID.canonical.y*ft%1]):Qe.texture.bind(Vt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);var Ot=VA(rt,wt||[0,0],ft||1,lt,g);F instanceof j?B.draw(S,L.TRIANGLES,He,Me.disabled,J,Ye.disabled,Ot,g.id,F.boundsBuffer,p.quadTriangleIndexBuffer,F.boundsSegments):B.draw(S,L.TRIANGLES,He,Ce[Pe.overscaledZ],J,Ye.disabled,Ot,g.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}},background:function(p,_,g){var b=g.paint.get("background-color"),S=g.paint.get("background-opacity");if(S!==0){var L=p.context,F=L.gl,B=p.transform,J=B.tileSize,re=g.paint.get("background-pattern");if(!p.isPatternMissing(re)){var Ce=!re&&b.a===1&&S===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass===Ce){var we=Me.disabled,Se=p.depthModeForSublayer(0,Ce==="opaque"?Ae.ReadWrite:Ae.ReadOnly),Be=p.colorModeForRenderPass(),Ve=p.useProgram(re?"backgroundPattern":"background"),Ke=B.coveringTiles({tileSize:J});re&&(L.activeTexture.set(F.TEXTURE0),p.imageManager.bind(p.context));for(var Pe=g.getCrossfadeParameters(),He=0,Qe=Ke;He<Qe.length;He+=1){var rt=Qe[He],ht=p.transform.calculatePosMatrix(rt.toUnwrapped()),lt=re?pd(ht,S,p,re,{tileID:rt,tileSize:J},Pe):Zf(ht,S,b);Ve.draw(L,F.TRIANGLES,Se,we,Be,Ye.disabled,lt,g.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}}}},debug:function(p,_,g){for(var b=0;b<g.length;b++)f1(p,_,g[b])},custom:function(p,_,g){var b=p.context,S=g.implementation;if(p.renderPass==="offscreen"){var L=S.prerender;L&&(p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),L.call(S,b.gl,p.transform.customLayerMatrix()),b.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),b.setStencilMode(Me.disabled);var F=S.renderingMode==="3d"?new Ae(p.context.gl.LEQUAL,Ae.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Ae.ReadOnly);b.setDepthMode(F),S.render(b.gl,p.transform.customLayerMatrix()),b.setDirty(),p.setBaseState(),b.bindFramebuffer.set(null)}}},wr=function(p,_){this.context=new be(p),this.transform=_,this._tileTextures={},this.setup(),this.numSublayers=ke.maxUnderzooming+ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Uu,this.gpuTimers={}};wr.prototype.resize=function(p,_){if(this.width=p*s.browser.devicePixelRatio,this.height=_*s.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var g=0,b=this.style._order;g<b.length;g+=1)this.style._layers[b[g]].resize()},wr.prototype.setup=function(){var p=this.context,_=new s.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(s.EXTENT,0),_.emplaceBack(0,s.EXTENT),_.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=p.createVertexBuffer(_,ts.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);var g=new s.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(s.EXTENT,0),g.emplaceBack(0,s.EXTENT),g.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=p.createVertexBuffer(g,ts.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);var b=new s.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(s.EXTENT,0,s.EXTENT,0),b.emplaceBack(0,s.EXTENT,0,s.EXTENT),b.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=p.createVertexBuffer(b,q.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);var S=new s.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=p.createVertexBuffer(S,ts.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);var L=new s.StructArrayLayout1ui2;L.emplaceBack(0),L.emplaceBack(1),L.emplaceBack(3),L.emplaceBack(2),L.emplaceBack(0),this.tileBorderIndexBuffer=p.createIndexBuffer(L);var F=new s.StructArrayLayout3ui6;F.emplaceBack(0,1,2),F.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=p.createIndexBuffer(F),this.emptyTexture=new s.Texture(p,{width:1,height:1,data:new Uint8Array([0,0,0,0])},p.gl.RGBA);var B=this.context.gl;this.stencilClearMode=new Me({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)},wr.prototype.clearStencil=function(){var p=this.context,_=p.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var g=s.create();s.ortho(g,0,this.width,this.height,0,0,1),s.scale(g,g,[_.drawingBufferWidth,_.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(p,_.TRIANGLES,Ae.disabled,this.stencilClearMode,$e.disabled,Ye.disabled,th(g),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},wr.prototype._renderTileClippingMasks=function(p,_){if(this.currentStencilSource!==p.source&&p.isTileClipped()&&_&&_.length){this.currentStencilSource=p.source;var g=this.context,b=g.gl;this.nextStencilID+_.length>256&&this.clearStencil(),g.setColorMode($e.disabled),g.setDepthMode(Ae.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var L=0,F=_;L<F.length;L+=1){var B=F[L],J=this._tileClippingMaskIDs[B.key]=this.nextStencilID++;S.draw(g,b.TRIANGLES,Ae.disabled,new Me({func:b.ALWAYS,mask:0},J,255,b.KEEP,b.KEEP,b.REPLACE),$e.disabled,Ye.disabled,th(B.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},wr.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var p=this.nextStencilID++,_=this.context.gl;return new Me({func:_.NOTEQUAL,mask:255},p,255,_.KEEP,_.KEEP,_.REPLACE)},wr.prototype.stencilModeForClipping=function(p){var _=this.context.gl;return new Me({func:_.EQUAL,mask:255},this._tileClippingMaskIDs[p.key],0,_.KEEP,_.KEEP,_.REPLACE)},wr.prototype.stencilConfigForOverlap=function(p){var _,g=this.context.gl,b=p.sort((function(J,re){return re.overscaledZ-J.overscaledZ})),S=b[b.length-1].overscaledZ,L=b[0].overscaledZ-S+1;if(L>1){this.currentStencilSource=void 0,this.nextStencilID+L>256&&this.clearStencil();for(var F={},B=0;B<L;B++)F[B+S]=new Me({func:g.GEQUAL,mask:255},B+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=L,[F,b]}return[(_={},_[S]=Me.disabled,_),b]},wr.prototype.colorModeForRenderPass=function(){var p=this.context.gl;return this._showOverdrawInspector?new $e([p.CONSTANT_COLOR,p.ONE],new s.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$e.unblended:$e.alphaBlended},wr.prototype.depthModeForSublayer=function(p,_,g){if(!this.opaquePassEnabledForLayer())return Ae.disabled;var b=1-((1+this.currentLayer)*this.numSublayers+p)*this.depthEpsilon;return new Ae(g||this.context.gl.LEQUAL,_,[b,b])},wr.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},wr.prototype.render=function(p,_){var g=this;this.style=p,this.options=_,this.lineAtlas=p.lineAtlas,this.imageManager=p.imageManager,this.glyphManager=p.glyphManager,this.symbolFadeChange=p.placement.symbolFadeChange(s.browser.now()),this.imageManager.beginFrame();var b=this.style._order,S=this.style.sourceCaches;for(var L in S){var F=S[L];F.used&&F.prepare(this.context)}var B,J,re={},Ce={},we={};for(var Se in S){var Be=S[Se];re[Se]=Be.getVisibleCoordinates(),Ce[Se]=re[Se].slice().reverse(),we[Se]=Be.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ve=0;Ve<b.length;Ve++)if(this.style._layers[b[Ve]].is3D()){this.opaquePassCutoff=Ve;break}this.renderPass="offscreen";for(var Ke=0,Pe=b;Ke<Pe.length;Ke+=1){var He=this.style._layers[Pe[Ke]];if(He.hasOffscreenPass()&&!He.isHidden(this.transform.zoom)){var Qe=Ce[He.source];(He.type==="custom"||Qe.length)&&this.renderLayer(this,S[He.source],He,Qe)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:_.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=_.showOverdrawInspector,this.depthRangeFor3D=[0,1-(p._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){var rt=this.style._layers[b[this.currentLayer]],ht=S[rt.source],lt=re[rt.source];this._renderTileClippingMasks(rt,lt),this.renderLayer(this,ht,rt,lt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){var ft=this.style._layers[b[this.currentLayer]],wt=S[ft.source],Vt=(ft.type==="symbol"?we:Ce)[ft.source];this._renderTileClippingMasks(ft,re[ft.source]),this.renderLayer(this,wt,ft,Vt)}this.options.showTileBoundaries&&(s.values(this.style._layers).forEach((function(Ot){Ot.source&&!Ot.isHidden(g.transform.zoom)&&(Ot.source!==(J&&J.id)&&(J=g.style.sourceCaches[Ot.source]),(!B||B.getSource().maxzoom<J.getSource().maxzoom)&&(B=J))})),B&&ih.debug(this,B,B.getVisibleCoordinates())),this.options.showPadding&&(function(Ot){var en=Ot.transform.padding;m_(Ot,Ot.transform.height-(en.top||0),3,p_),m_(Ot,en.bottom||0,3,h1),y_(Ot,en.left||0,3,d1),y_(Ot,Ot.transform.width-(en.right||0),3,Eg);var vn=Ot.transform.centerPoint;(function(Cn,In,wi,nn){zf(Cn,In-1,wi-10,2,20,nn),zf(Cn,In-10,wi-1,20,2,nn)})(Ot,vn.x,Ot.transform.height-vn.y,g_)})(this),this.context.setDefault()},wr.prototype.renderLayer=function(p,_,g,b){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="custom"||b.length)&&(this.id=g.id,this.gpuTimingStart(g),ih[g.type](p,_,g,b,this.style.placement.variableOffsets),this.gpuTimingEnd())},wr.prototype.gpuTimingStart=function(p){if(this.options.gpuTiming){var _=this.context.extTimerQuery,g=this.gpuTimers[p.id];g||(g=this.gpuTimers[p.id]={calls:0,cpuTime:0,query:_.createQueryEXT()}),g.calls++,_.beginQueryEXT(_.TIME_ELAPSED_EXT,g.query)}},wr.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var p=this.context.extTimerQuery;p.endQueryEXT(p.TIME_ELAPSED_EXT)}},wr.prototype.collectGpuTimers=function(){var p=this.gpuTimers;return this.gpuTimers={},p},wr.prototype.queryGpuTimers=function(p){var _={};for(var g in p){var b=p[g],S=this.context.extTimerQuery,L=S.getQueryObjectEXT(b.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(b.query),_[g]=L}return _},wr.prototype.translatePosMatrix=function(p,_,g,b,S){if(!g[0]&&!g[1])return p;var L=S?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(L){var F=Math.sin(L),B=Math.cos(L);g=[g[0]*B-g[1]*F,g[0]*F+g[1]*B]}var J=[S?g[0]:Cr(_,g[0],this.transform.zoom),S?g[1]:Cr(_,g[1],this.transform.zoom),0],re=new Float32Array(16);return s.translate(re,p,J),re},wr.prototype.saveTileTexture=function(p){var _=this._tileTextures[p.size[0]];_?_.push(p):this._tileTextures[p.size[0]]=[p]},wr.prototype.getTileTexture=function(p){var _=this._tileTextures[p];return _&&_.length>0?_.pop():null},wr.prototype.isPatternMissing=function(p){if(!p)return!1;if(!p.from||!p.to)return!0;var _=this.imageManager.getPattern(p.from.toString()),g=this.imageManager.getPattern(p.to.toString());return!_||!g},wr.prototype.useProgram=function(p,_){this.cache=this.cache||{};var g=""+p+(_?_.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[g]||(this.cache[g]=new qb(this.context,p,NA[p],_,a1[p],this._showOverdrawInspector)),this.cache[g]},wr.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},wr.prototype.setBaseState=function(){var p=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(p.FUNC_ADD)},wr.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},wr.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Tg=function(p,_){this.points=p,this.planes=_};Tg.fromInvProjectionMatrix=function(p,_,g){var b=Math.pow(2,g),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(F){return s.transformMat4([],F,p)})).map((function(F){return s.scale$1([],F,1/F[3]/_*b)})),L=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(F){var B=s.sub([],S[F[0]],S[F[1]]),J=s.sub([],S[F[2]],S[F[1]]),re=s.normalize([],s.cross([],B,J)),Ce=-s.dot(re,S[F[1]]);return re.concat(Ce)}));return new Tg(S,L)};var rh=function(p,_){this.min=p,this.max=_,this.center=s.scale$2([],s.add([],this.min,this.max),.5)};rh.prototype.quadrant=function(p){for(var _=[p%2==0,p<2],g=s.clone$2(this.min),b=s.clone$2(this.max),S=0;S<_.length;S++)g[S]=_[S]?this.min[S]:this.center[S],b[S]=_[S]?this.center[S]:this.max[S];return b[2]=this.max[2],new rh(g,b)},rh.prototype.distanceX=function(p){return Math.max(Math.min(this.max[0],p[0]),this.min[0])-p[0]},rh.prototype.distanceY=function(p){return Math.max(Math.min(this.max[1],p[1]),this.min[1])-p[1]},rh.prototype.intersects=function(p){for(var _=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],g=!0,b=0;b<p.planes.length;b++){for(var S=p.planes[b],L=0,F=0;F<_.length;F++)L+=s.dot$1(S,_[F])>=0;if(L===0)return 0;L!==_.length&&(g=!1)}if(g)return 2;for(var B=0;B<3;B++){for(var J=Number.MAX_VALUE,re=-Number.MAX_VALUE,Ce=0;Ce<p.points.length;Ce++){var we=p.points[Ce][B]-this.min[B];J=Math.min(J,we),re=Math.max(re,we)}if(re<0||J>this.max[B]-this.min[B])return 0}return 1};var qu=function(p,_,g,b){if(p===void 0&&(p=0),_===void 0&&(_=0),g===void 0&&(g=0),b===void 0&&(b=0),isNaN(p)||p<0||isNaN(_)||_<0||isNaN(g)||g<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=p,this.bottom=_,this.left=g,this.right=b};qu.prototype.interpolate=function(p,_,g){return _.top!=null&&p.top!=null&&(this.top=s.number(p.top,_.top,g)),_.bottom!=null&&p.bottom!=null&&(this.bottom=s.number(p.bottom,_.bottom,g)),_.left!=null&&p.left!=null&&(this.left=s.number(p.left,_.left,g)),_.right!=null&&p.right!=null&&(this.right=s.number(p.right,_.right,g)),this},qu.prototype.getCenter=function(p,_){var g=s.clamp((this.left+p-this.right)/2,0,p),b=s.clamp((this.top+_-this.bottom)/2,0,_);return new s.Point(g,b)},qu.prototype.equals=function(p){return this.top===p.top&&this.bottom===p.bottom&&this.left===p.left&&this.right===p.right},qu.prototype.clone=function(){return new qu(this.top,this.bottom,this.left,this.right)},qu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var vi=function(p,_,g,b,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=p||0,this._maxZoom=_||22,this._minPitch=g??0,this._maxPitch=b??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new qu,this._posMatrixCache={},this._alignedPosMatrixCache={}},hr={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};vi.prototype.clone=function(){var p=new vi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return p.tileSize=this.tileSize,p.latRange=this.latRange,p.width=this.width,p.height=this.height,p._center=this._center,p.zoom=this.zoom,p.angle=this.angle,p._fov=this._fov,p._pitch=this._pitch,p._unmodified=this._unmodified,p._edgeInsets=this._edgeInsets.clone(),p._calcMatrices(),p},hr.minZoom.get=function(){return this._minZoom},hr.minZoom.set=function(p){this._minZoom!==p&&(this._minZoom=p,this.zoom=Math.max(this.zoom,p))},hr.maxZoom.get=function(){return this._maxZoom},hr.maxZoom.set=function(p){this._maxZoom!==p&&(this._maxZoom=p,this.zoom=Math.min(this.zoom,p))},hr.minPitch.get=function(){return this._minPitch},hr.minPitch.set=function(p){this._minPitch!==p&&(this._minPitch=p,this.pitch=Math.max(this.pitch,p))},hr.maxPitch.get=function(){return this._maxPitch},hr.maxPitch.set=function(p){this._maxPitch!==p&&(this._maxPitch=p,this.pitch=Math.min(this.pitch,p))},hr.renderWorldCopies.get=function(){return this._renderWorldCopies},hr.renderWorldCopies.set=function(p){p===void 0?p=!0:p===null&&(p=!1),this._renderWorldCopies=p},hr.worldSize.get=function(){return this.tileSize*this.scale},hr.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},hr.size.get=function(){return new s.Point(this.width,this.height)},hr.bearing.get=function(){return-this.angle/Math.PI*180},hr.bearing.set=function(p){var _=-s.wrap(p,-180,180)*Math.PI/180;this.angle!==_&&(this._unmodified=!1,this.angle=_,this._calcMatrices(),this.rotationMatrix=s.create$2(),s.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},hr.pitch.get=function(){return this._pitch/Math.PI*180},hr.pitch.set=function(p){var _=s.clamp(p,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==_&&(this._unmodified=!1,this._pitch=_,this._calcMatrices())},hr.fov.get=function(){return this._fov/Math.PI*180},hr.fov.set=function(p){p=Math.max(.01,Math.min(60,p)),this._fov!==p&&(this._unmodified=!1,this._fov=p/180*Math.PI,this._calcMatrices())},hr.zoom.get=function(){return this._zoom},hr.zoom.set=function(p){var _=Math.min(Math.max(p,this.minZoom),this.maxZoom);this._zoom!==_&&(this._unmodified=!1,this._zoom=_,this.scale=this.zoomScale(_),this.tileZoom=Math.floor(_),this.zoomFraction=_-this.tileZoom,this._constrain(),this._calcMatrices())},hr.center.get=function(){return this._center},hr.center.set=function(p){p.lat===this._center.lat&&p.lng===this._center.lng||(this._unmodified=!1,this._center=p,this._constrain(),this._calcMatrices())},hr.padding.get=function(){return this._edgeInsets.toJSON()},hr.padding.set=function(p){this._edgeInsets.equals(p)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,p,1),this._calcMatrices())},hr.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},vi.prototype.isPaddingEqual=function(p){return this._edgeInsets.equals(p)},vi.prototype.interpolatePadding=function(p,_,g){this._unmodified=!1,this._edgeInsets.interpolate(p,_,g),this._constrain(),this._calcMatrices()},vi.prototype.coveringZoomLevel=function(p){var _=(p.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/p.tileSize));return Math.max(0,_)},vi.prototype.getVisibleUnwrappedCoordinates=function(p){var _=[new s.UnwrappedTileID(0,p)];if(this._renderWorldCopies)for(var g=this.pointCoordinate(new s.Point(0,0)),b=this.pointCoordinate(new s.Point(this.width,0)),S=this.pointCoordinate(new s.Point(this.width,this.height)),L=this.pointCoordinate(new s.Point(0,this.height)),F=Math.floor(Math.min(g.x,b.x,S.x,L.x)),B=Math.floor(Math.max(g.x,b.x,S.x,L.x)),J=F-1;J<=B+1;J++)J!==0&&_.push(new s.UnwrappedTileID(J,p));return _},vi.prototype.coveringTiles=function(p){var _=this.coveringZoomLevel(p),g=_;if(p.minzoom!==void 0&&_<p.minzoom)return[];p.maxzoom!==void 0&&_>p.maxzoom&&(_=p.maxzoom);var b=s.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,_),L=[S*b.x,S*b.y,0],F=Tg.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_),B=p.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(B=_);var J=function(Ot){return{aabb:new rh([Ot*S,0,0],[(Ot+1)*S,S,0]),zoom:0,x:0,y:0,wrap:Ot,fullyVisible:!1}},re=[],Ce=[],we=_,Se=p.reparseOverscaled?g:_;if(this._renderWorldCopies)for(var Be=1;Be<=3;Be++)re.push(J(-Be)),re.push(J(Be));for(re.push(J(0));re.length>0;){var Ve=re.pop(),Ke=Ve.x,Pe=Ve.y,He=Ve.fullyVisible;if(!He){var Qe=Ve.aabb.intersects(F);if(Qe===0)continue;He=Qe===2}var rt=Ve.aabb.distanceX(L),ht=Ve.aabb.distanceY(L),lt=Math.max(Math.abs(rt),Math.abs(ht));if(Ve.zoom===we||lt>3+(1<<we-Ve.zoom)-2&&Ve.zoom>=B)Ce.push({tileID:new s.OverscaledTileID(Ve.zoom===we?Se:Ve.zoom,Ve.wrap,Ve.zoom,Ke,Pe),distanceSq:s.sqrLen([L[0]-.5-Ke,L[1]-.5-Pe])});else for(var ft=0;ft<4;ft++){var wt=(Ke<<1)+ft%2,Vt=(Pe<<1)+(ft>>1);re.push({aabb:Ve.aabb.quadrant(ft),zoom:Ve.zoom+1,x:wt,y:Vt,wrap:Ve.wrap,fullyVisible:He})}}return Ce.sort((function(Ot,en){return Ot.distanceSq-en.distanceSq})).map((function(Ot){return Ot.tileID}))},vi.prototype.resize=function(p,_){this.width=p,this.height=_,this.pixelsToGLUnits=[2/p,-2/_],this._constrain(),this._calcMatrices()},hr.unmodified.get=function(){return this._unmodified},vi.prototype.zoomScale=function(p){return Math.pow(2,p)},vi.prototype.scaleZoom=function(p){return Math.log(p)/Math.LN2},vi.prototype.project=function(p){var _=s.clamp(p.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.Point(s.mercatorXfromLng(p.lng)*this.worldSize,s.mercatorYfromLat(_)*this.worldSize)},vi.prototype.unproject=function(p){return new s.MercatorCoordinate(p.x/this.worldSize,p.y/this.worldSize).toLngLat()},hr.point.get=function(){return this.project(this.center)},vi.prototype.setLocationAtPoint=function(p,_){var g=this.pointCoordinate(_),b=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(p),L=new s.MercatorCoordinate(S.x-(g.x-b.x),S.y-(g.y-b.y));this.center=this.coordinateLocation(L),this._renderWorldCopies&&(this.center=this.center.wrap())},vi.prototype.locationPoint=function(p){return this.coordinatePoint(this.locationCoordinate(p))},vi.prototype.pointLocation=function(p){return this.coordinateLocation(this.pointCoordinate(p))},vi.prototype.locationCoordinate=function(p){return s.MercatorCoordinate.fromLngLat(p)},vi.prototype.coordinateLocation=function(p){return p.toLngLat()},vi.prototype.pointCoordinate=function(p){var _=[p.x,p.y,0,1],g=[p.x,p.y,1,1];s.transformMat4(_,_,this.pixelMatrixInverse),s.transformMat4(g,g,this.pixelMatrixInverse);var b=_[3],S=g[3],L=_[1]/b,F=g[1]/S,B=_[2]/b,J=g[2]/S,re=B===J?0:(0-B)/(J-B);return new s.MercatorCoordinate(s.number(_[0]/b,g[0]/S,re)/this.worldSize,s.number(L,F,re)/this.worldSize)},vi.prototype.coordinatePoint=function(p){var _=[p.x*this.worldSize,p.y*this.worldSize,0,1];return s.transformMat4(_,_,this.pixelMatrix),new s.Point(_[0]/_[3],_[1]/_[3])},vi.prototype.getBounds=function(){return new s.LngLatBounds().extend(this.pointLocation(new s.Point(0,0))).extend(this.pointLocation(new s.Point(this.width,0))).extend(this.pointLocation(new s.Point(this.width,this.height))).extend(this.pointLocation(new s.Point(0,this.height)))},vi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},vi.prototype.setMaxBounds=function(p){p?(this.lngRange=[p.getWest(),p.getEast()],this.latRange=[p.getSouth(),p.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},vi.prototype.calculatePosMatrix=function(p,_){_===void 0&&(_=!1);var g=p.key,b=_?this._alignedPosMatrixCache:this._posMatrixCache;if(b[g])return b[g];var S=p.canonical,L=this.worldSize/this.zoomScale(S.z),F=S.x+Math.pow(2,S.z)*p.wrap,B=s.identity(new Float64Array(16));return s.translate(B,B,[F*L,S.y*L,0]),s.scale(B,B,[L/s.EXTENT,L/s.EXTENT,1]),s.multiply(B,_?this.alignedProjMatrix:this.projMatrix,B),b[g]=new Float32Array(B),b[g]},vi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},vi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var p,_,g,b,S=-90,L=90,F=-180,B=180,J=this.size,re=this._unmodified;if(this.latRange){var Ce=this.latRange;S=s.mercatorYfromLat(Ce[1])*this.worldSize,p=(L=s.mercatorYfromLat(Ce[0])*this.worldSize)-S<J.y?J.y/(L-S):0}if(this.lngRange){var we=this.lngRange;F=s.mercatorXfromLng(we[0])*this.worldSize,_=(B=s.mercatorXfromLng(we[1])*this.worldSize)-F<J.x?J.x/(B-F):0}var Se=this.point,Be=Math.max(_||0,p||0);if(Be)return this.center=this.unproject(new s.Point(_?(B+F)/2:Se.x,p?(L+S)/2:Se.y)),this.zoom+=this.scaleZoom(Be),this._unmodified=re,void(this._constraining=!1);if(this.latRange){var Ve=Se.y,Ke=J.y/2;Ve-Ke<S&&(b=S+Ke),Ve+Ke>L&&(b=L-Ke)}if(this.lngRange){var Pe=Se.x,He=J.x/2;Pe-He<F&&(g=F+He),Pe+He>B&&(g=B-He)}g===void 0&&b===void 0||(this.center=this.unproject(new s.Point(g!==void 0?g:Se.x,b!==void 0?b:Se.y))),this._unmodified=re,this._constraining=!1}},vi.prototype._calcMatrices=function(){if(this.height){var p=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var _=Math.PI/2+this._pitch,g=this._fov*(.5+p.y/this.height),b=Math.sin(g)*this.cameraToCenterDistance/Math.sin(s.clamp(Math.PI-_-g,.01,Math.PI-.01)),S=this.point,L=S.x,F=S.y,B=1.01*(Math.cos(Math.PI/2-this._pitch)*b+this.cameraToCenterDistance),J=this.height/50,re=new Float64Array(16);s.perspective(re,this._fov,this.width/this.height,J,B),re[8]=2*-p.x/this.width,re[9]=2*p.y/this.height,s.scale(re,re,[1,-1,1]),s.translate(re,re,[0,0,-this.cameraToCenterDistance]),s.rotateX(re,re,this._pitch),s.rotateZ(re,re,this.angle),s.translate(re,re,[-L,-F,0]),this.mercatorMatrix=s.scale([],re,[this.worldSize,this.worldSize,this.worldSize]),s.scale(re,re,[1,1,s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=re,this.invProjMatrix=s.invert([],this.projMatrix);var Ce=this.width%2/2,we=this.height%2/2,Se=Math.cos(this.angle),Be=Math.sin(this.angle),Ve=L-Math.round(L)+Se*Ce+Be*we,Ke=F-Math.round(F)+Se*we+Be*Ce,Pe=new Float64Array(re);if(s.translate(Pe,Pe,[Ve>.5?Ve-1:Ve,Ke>.5?Ke-1:Ke,0]),this.alignedProjMatrix=Pe,re=s.create(),s.scale(re,re,[this.width/2,-this.height/2,1]),s.translate(re,re,[1,-1,0]),this.labelPlaneMatrix=re,re=s.create(),s.scale(re,re,[1,-1,1]),s.translate(re,re,[-1,-1,0]),s.scale(re,re,[2/this.width,2/this.height,1]),this.glCoordMatrix=re,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(re=s.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=re,this._posMatrixCache={},this._alignedPosMatrixCache={}}},vi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var p=this.pointCoordinate(new s.Point(0,0)),_=[p.x*this.worldSize,p.y*this.worldSize,0,1];return s.transformMat4(_,_,this.pixelMatrix)[3]/this.cameraToCenterDistance},vi.prototype.getCameraPoint=function(){var p=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,p))},vi.prototype.getCameraQueryGeometry=function(p){var _=this.getCameraPoint();if(p.length===1)return[p[0],_];for(var g=_.x,b=_.y,S=_.x,L=_.y,F=0,B=p;F<B.length;F+=1){var J=B[F];g=Math.min(g,J.x),b=Math.min(b,J.y),S=Math.max(S,J.x),L=Math.max(L,J.y)}return[new s.Point(g,b),new s.Point(S,b),new s.Point(S,L),new s.Point(g,L),new s.Point(g,b)]},Object.defineProperties(vi.prototype,hr);var da=function(p){var _,g,b,S;this._hashName=p&&encodeURIComponent(p),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(_=this._updateHashUnthrottled.bind(this),g=!1,b=null,S=function(){b=null,g&&(_(),b=setTimeout(S,300),g=!1)},function(){return g=!0,b||S(),b})};da.prototype.addTo=function(p){return this._map=p,s.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},da.prototype.remove=function(){return s.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},da.prototype.getHashString=function(p){var _=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,b=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,b),L=Math.round(_.lng*S)/S,F=Math.round(_.lat*S)/S,B=this._map.getBearing(),J=this._map.getPitch(),re="";if(re+=p?"/"+L+"/"+F+"/"+g:g+"/"+F+"/"+L,(B||J)&&(re+="/"+Math.round(10*B)/10),J&&(re+="/"+Math.round(J)),this._hashName){var Ce=this._hashName,we=!1,Se=s.window.location.hash.slice(1).split("&").map((function(Be){var Ve=Be.split("=")[0];return Ve===Ce?(we=!0,Ve+"="+re):Be})).filter((function(Be){return Be}));return we||Se.push(Ce+"="+re),"#"+Se.join("&")}return"#"+re},da.prototype._getCurrentHash=function(){var p,_=this,g=s.window.location.hash.replace("#","");return this._hashName?(g.split("&").map((function(b){return b.split("=")})).forEach((function(b){b[0]===_._hashName&&(p=b)})),(p&&p[1]||"").split("/")):g.split("/")},da.prototype._onHashChange=function(){var p=this._getCurrentHash();if(p.length>=3&&!p.some((function(g){return isNaN(g)}))){var _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(p[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:_,pitch:+(p[4]||0)}),!0}return!1},da.prototype._updateHashUnthrottled=function(){var p=s.window.location.href.replace(/(#.+)?$/,this.getHashString());try{s.window.history.replaceState(s.window.history.state,null,p)}catch{}};var Uf={linearity:.3,easing:s.bezier(0,0,.3,1)},md=s.extend({deceleration:2500,maxSpeed:1400},Uf),Xf=s.extend({deceleration:20,maxSpeed:1400},Uf),ZA=s.extend({deceleration:1e3,maxSpeed:360},Uf),WA=s.extend({deceleration:1e3,maxSpeed:90},Uf),Yf=function(p){this._map=p,this.clear()};function Hf(p,_){(!p.duration||p.duration<_.duration)&&(p.duration=_.duration,p.easing=_.easing)}function ou(p,_,g){var b=g.maxSpeed,S=g.linearity,L=g.deceleration,F=s.clamp(p*S/(_/1e3),-b,b),B=Math.abs(F)/(L*S);return{easing:g.easing,duration:1e3*B,amount:F*(B/2)}}Yf.prototype.clear=function(){this._inertiaBuffer=[]},Yf.prototype.record=function(p){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.browser.now(),settings:p})},Yf.prototype._drainInertiaBuffer=function(){for(var p=this._inertiaBuffer,_=s.browser.now();p.length>0&&_-p[0].time>160;)p.shift()},Yf.prototype._onMoveEnd=function(p){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var _={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0},g=0,b=this._inertiaBuffer;g<b.length;g+=1){var S=b[g].settings;_.zoom+=S.zoomDelta||0,_.bearing+=S.bearingDelta||0,_.pitch+=S.pitchDelta||0,S.panDelta&&_.pan._add(S.panDelta),S.around&&(_.around=S.around),S.pinchAround&&(_.pinchAround=S.pinchAround)}var L=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,F={};if(_.pan.mag()){var B=ou(_.pan.mag(),L,s.extend({},md,p||{}));F.offset=_.pan.mult(B.amount/_.pan.mag()),F.center=this._map.transform.center,Hf(F,B)}if(_.zoom){var J=ou(_.zoom,L,Xf);F.zoom=this._map.transform.zoom+J.amount,Hf(F,J)}if(_.bearing){var re=ou(_.bearing,L,ZA);F.bearing=this._map.transform.bearing+s.clamp(re.amount,-179,179),Hf(F,re)}if(_.pitch){var Ce=ou(_.pitch,L,WA);F.pitch=this._map.transform.pitch+Ce.amount,Hf(F,Ce)}if(F.zoom||F.bearing){var we=_.pinchAround===void 0?_.around:_.pinchAround;F.around=we?this._map.unproject(we):this._map.getCenter()}return this.clear(),s.extend(F,{noMoveStart:!0})}};var os=(function(p){function _(b,S,L,F){F===void 0&&(F={});var B=u.mousePos(S.getCanvasContainer(),L),J=S.unproject(B);p.call(this,b,s.extend({point:B,lngLat:J,originalEvent:L},F)),this._defaultPrevented=!1,this.target=S}p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_;var g={defaultPrevented:{configurable:!0}};return _.prototype.preventDefault=function(){this._defaultPrevented=!0},g.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(_.prototype,g),_})(s.Event),Kf=(function(p){function _(b,S,L){var F=b==="touchend"?L.changedTouches:L.touches,B=u.touchPos(S.getCanvasContainer(),F),J=B.map((function(we){return S.unproject(we)})),re=B.reduce((function(we,Se,Be,Ve){return we.add(Se.div(Ve.length))}),new s.Point(0,0)),Ce=S.unproject(re);p.call(this,b,{points:B,point:re,lngLats:J,lngLat:Ce,originalEvent:L}),this._defaultPrevented=!1}p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_;var g={defaultPrevented:{configurable:!0}};return _.prototype.preventDefault=function(){this._defaultPrevented=!0},g.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(_.prototype,g),_})(s.Event),p1=(function(p){function _(b,S,L){p.call(this,b,{originalEvent:L}),this._defaultPrevented=!1}p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_;var g={defaultPrevented:{configurable:!0}};return _.prototype.preventDefault=function(){this._defaultPrevented=!0},g.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(_.prototype,g),_})(s.Event),ns=function(p,_){this._map=p,this._clickTolerance=_.clickTolerance};ns.prototype.reset=function(){delete this._mousedownPos},ns.prototype.wheel=function(p){return this._firePreventable(new p1(p.type,this._map,p))},ns.prototype.mousedown=function(p,_){return this._mousedownPos=_,this._firePreventable(new os(p.type,this._map,p))},ns.prototype.mouseup=function(p){this._map.fire(new os(p.type,this._map,p))},ns.prototype.click=function(p,_){this._mousedownPos&&this._mousedownPos.dist(_)>=this._clickTolerance||this._map.fire(new os(p.type,this._map,p))},ns.prototype.dblclick=function(p){return this._firePreventable(new os(p.type,this._map,p))},ns.prototype.mouseover=function(p){this._map.fire(new os(p.type,this._map,p))},ns.prototype.mouseout=function(p){this._map.fire(new os(p.type,this._map,p))},ns.prototype.touchstart=function(p){return this._firePreventable(new Kf(p.type,this._map,p))},ns.prototype.touchmove=function(p){this._map.fire(new Kf(p.type,this._map,p))},ns.prototype.touchend=function(p){this._map.fire(new Kf(p.type,this._map,p))},ns.prototype.touchcancel=function(p){this._map.fire(new Kf(p.type,this._map,p))},ns.prototype._firePreventable=function(p){if(this._map.fire(p),p.defaultPrevented)return{}},ns.prototype.isEnabled=function(){return!0},ns.prototype.isActive=function(){return!1},ns.prototype.enable=function(){},ns.prototype.disable=function(){};var rn=function(p){this._map=p};rn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},rn.prototype.mousemove=function(p){this._map.fire(new os(p.type,this._map,p))},rn.prototype.mousedown=function(){this._delayContextMenu=!0},rn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new os("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},rn.prototype.contextmenu=function(p){this._delayContextMenu?this._contextMenuEvent=p:this._map.fire(new os(p.type,this._map,p)),this._map.listens("contextmenu")&&p.preventDefault()},rn.prototype.isEnabled=function(){return!0},rn.prototype.isActive=function(){return!1},rn.prototype.enable=function(){},rn.prototype.disable=function(){};var Wo=function(p,_){this._map=p,this._el=p.getCanvasContainer(),this._container=p.getContainer(),this._clickTolerance=_.clickTolerance||1};function Rg(p,_){for(var g={},b=0;b<p.length;b++)g[p[b].identifier]=_[b];return g}Wo.prototype.isEnabled=function(){return!!this._enabled},Wo.prototype.isActive=function(){return!!this._active},Wo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Wo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Wo.prototype.mousedown=function(p,_){this.isEnabled()&&p.shiftKey&&p.button===0&&(u.disableDrag(),this._startPos=this._lastPos=_,this._active=!0)},Wo.prototype.mousemoveWindow=function(p,_){if(this._active){var g=_;if(!(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)){var b=this._startPos;this._lastPos=g,this._box||(this._box=u.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",p));var S=Math.min(b.x,g.x),L=Math.max(b.x,g.x),F=Math.min(b.y,g.y),B=Math.max(b.y,g.y);u.setTransform(this._box,"translate("+S+"px,"+F+"px)"),this._box.style.width=L-S+"px",this._box.style.height=B-F+"px"}}},Wo.prototype.mouseupWindow=function(p,_){var g=this;if(this._active&&p.button===0){var b=this._startPos,S=_;if(this.reset(),u.suppressClick(),b.x!==S.x||b.y!==S.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:p})),{cameraAnimation:function(L){return L.fitScreenCoordinates(b,S,g._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",p)}},Wo.prototype.keydown=function(p){this._active&&p.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",p))},Wo.prototype.blur=function(){this.reset()},Wo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(u.remove(this._box),this._box=null),u.enableDrag(),delete this._startPos,delete this._lastPos},Wo.prototype._fireEvent=function(p,_){return this._map.fire(new s.Event(p,{originalEvent:_}))};var yd=function(p){this.reset(),this.numTouches=p.numTouches};yd.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},yd.prototype.touchstart=function(p,_,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=p.timeStamp),g.length===this.numTouches&&(this.centroid=(function(b){for(var S=new s.Point(0,0),L=0,F=b;L<F.length;L+=1)S._add(F[L]);return S.div(b.length)})(_),this.touches=Rg(g,_)))},yd.prototype.touchmove=function(p,_,g){if(!this.aborted&&this.centroid){var b=Rg(g,_);for(var S in this.touches){var L=b[S];(!L||L.dist(this.touches[S])>30)&&(this.aborted=!0)}}},yd.prototype.touchend=function(p,_,g){if((!this.centroid||p.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){var b=!this.aborted&&this.centroid;if(this.reset(),b)return b}};var ol=function(p){this.singleTap=new yd(p),this.numTaps=p.numTaps,this.reset()};ol.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ol.prototype.touchstart=function(p,_,g){this.singleTap.touchstart(p,_,g)},ol.prototype.touchmove=function(p,_,g){this.singleTap.touchmove(p,_,g)},ol.prototype.touchend=function(p,_,g){var b=this.singleTap.touchend(p,_,g);if(b){var S=p.timeStamp-this.lastTime<500,L=!this.lastTap||this.lastTap.dist(b)<30;if(S&&L||this.reset(),this.count++,this.lastTime=p.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}};var zo=function(){this._zoomIn=new ol({numTouches:1,numTaps:2}),this._zoomOut=new ol({numTouches:2,numTaps:1}),this.reset()};zo.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},zo.prototype.touchstart=function(p,_,g){this._zoomIn.touchstart(p,_,g),this._zoomOut.touchstart(p,_,g)},zo.prototype.touchmove=function(p,_,g){this._zoomIn.touchmove(p,_,g),this._zoomOut.touchmove(p,_,g)},zo.prototype.touchend=function(p,_,g){var b=this,S=this._zoomIn.touchend(p,_,g),L=this._zoomOut.touchend(p,_,g);return S?(this._active=!0,p.preventDefault(),setTimeout((function(){return b.reset()}),0),{cameraAnimation:function(F){return F.easeTo({duration:300,zoom:F.getZoom()+1,around:F.unproject(S)},{originalEvent:p})}}):L?(this._active=!0,p.preventDefault(),setTimeout((function(){return b.reset()}),0),{cameraAnimation:function(F){return F.easeTo({duration:300,zoom:F.getZoom()-1,around:F.unproject(L)},{originalEvent:p})}}):void 0},zo.prototype.touchcancel=function(){this.reset()},zo.prototype.enable=function(){this._enabled=!0},zo.prototype.disable=function(){this._enabled=!1,this.reset()},zo.prototype.isEnabled=function(){return this._enabled},zo.prototype.isActive=function(){return this._active};var __={0:1,2:2},Ht=function(p){this.reset(),this._clickTolerance=p.clickTolerance||1};Ht.prototype.blur=function(){this.reset()},Ht.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Ht.prototype._correctButton=function(p,_){return!1},Ht.prototype._move=function(p,_){return{}},Ht.prototype.mousedown=function(p,_){if(!this._lastPoint){var g=u.mouseButton(p);this._correctButton(p,g)&&(this._lastPoint=_,this._eventButton=g)}},Ht.prototype.mousemoveWindow=function(p,_){var g=this._lastPoint;if(g){if(p.preventDefault(),(function(b,S){var L=__[S];return b.buttons===void 0||(b.buttons&L)!==L})(p,this._eventButton))this.reset();else if(this._moved||!(_.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=_,this._move(g,_)}},Ht.prototype.mouseupWindow=function(p){this._lastPoint&&u.mouseButton(p)===this._eventButton&&(this._moved&&u.suppressClick(),this.reset())},Ht.prototype.enable=function(){this._enabled=!0},Ht.prototype.disable=function(){this._enabled=!1,this.reset()},Ht.prototype.isEnabled=function(){return this._enabled},Ht.prototype.isActive=function(){return this._active};var v_=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.mousedown=function(g,b){p.prototype.mousedown.call(this,g,b),this._lastPoint&&(this._active=!0)},_.prototype._correctButton=function(g,b){return b===0&&!g.ctrlKey},_.prototype._move=function(g,b){return{around:b,panDelta:b.sub(g)}},_})(Ht),Mg=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype._correctButton=function(g,b){return b===0&&g.ctrlKey||b===2},_.prototype._move=function(g,b){var S=.8*(b.x-g.x);if(S)return this._active=!0,{bearingDelta:S}},_.prototype.contextmenu=function(g){g.preventDefault()},_})(Ht),b_=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype._correctButton=function(g,b){return b===0&&g.ctrlKey||b===2},_.prototype._move=function(g,b){var S=-.5*(b.y-g.y);if(S)return this._active=!0,{pitchDelta:S}},_.prototype.contextmenu=function(g){g.preventDefault()},_})(Ht),ka=function(p){this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset()};ka.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)},ka.prototype.touchstart=function(p,_,g){return this._calculateTransform(p,_,g)},ka.prototype.touchmove=function(p,_,g){if(this._active&&!(g.length<this._minTouches))return p.preventDefault(),this._calculateTransform(p,_,g)},ka.prototype.touchend=function(p,_,g){this._calculateTransform(p,_,g),this._active&&g.length<this._minTouches&&this.reset()},ka.prototype.touchcancel=function(){this.reset()},ka.prototype._calculateTransform=function(p,_,g){g.length>0&&(this._active=!0);var b=Rg(g,_),S=new s.Point(0,0),L=new s.Point(0,0),F=0;for(var B in b){var J=b[B],re=this._touches[B];re&&(S._add(J),L._add(J.sub(re)),F++,b[B]=J)}if(this._touches=b,!(F<this._minTouches)&&L.mag()){var Ce=L.div(F);if(this._sum._add(Ce),!(this._sum.mag()<this._clickTolerance))return{around:S.div(F),panDelta:Ce}}},ka.prototype.enable=function(){this._enabled=!0},ka.prototype.disable=function(){this._enabled=!1,this.reset()},ka.prototype.isEnabled=function(){return this._enabled},ka.prototype.isActive=function(){return this._active};var Uo=function(){this.reset()};function kg(p,_,g){for(var b=0;b<p.length;b++)if(p[b].identifier===g)return _[b]}function Lg(p,_){return Math.log(p/_)/Math.LN2}Uo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Uo.prototype._start=function(p){},Uo.prototype._move=function(p,_,g){return{}},Uo.prototype.touchstart=function(p,_,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([_[0],_[1]]))},Uo.prototype.touchmove=function(p,_,g){if(this._firstTwoTouches){p.preventDefault();var b=this._firstTwoTouches,S=b[1],L=kg(g,_,b[0]),F=kg(g,_,S);if(L&&F){var B=this._aroundCenter?null:L.add(F).div(2);return this._move([L,F],B,p)}}},Uo.prototype.touchend=function(p,_,g){if(this._firstTwoTouches){var b=this._firstTwoTouches,S=b[1],L=kg(g,_,b[0]),F=kg(g,_,S);L&&F||(this._active&&u.suppressClick(),this.reset())}},Uo.prototype.touchcancel=function(){this.reset()},Uo.prototype.enable=function(p){this._enabled=!0,this._aroundCenter=!!p&&p.around==="center"},Uo.prototype.disable=function(){this._enabled=!1,this.reset()},Uo.prototype.isEnabled=function(){return this._enabled},Uo.prototype.isActive=function(){return this._active};var Xo=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.reset=function(){p.prototype.reset.call(this),delete this._distance,delete this._startDistance},_.prototype._start=function(g){this._startDistance=this._distance=g[0].dist(g[1])},_.prototype._move=function(g,b){var S=this._distance;if(this._distance=g[0].dist(g[1]),this._active||!(Math.abs(Lg(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lg(this._distance,S),pinchAround:b}},_})(Uo);function au(p,_){return 180*p.angleWith(_)/Math.PI}var g1=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.reset=function(){p.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},_.prototype._start=function(g){this._startVector=this._vector=g[0].sub(g[1]),this._minDiameter=g[0].dist(g[1])},_.prototype._move=function(g,b){var S=this._vector;if(this._vector=g[0].sub(g[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:au(this._vector,S),pinchAround:b}},_.prototype._isBelowThreshold=function(g){this._minDiameter=Math.min(this._minDiameter,g.mag());var b=25/(Math.PI*this._minDiameter)*360,S=au(g,this._startVector);return Math.abs(S)<b},_})(Uo);function jf(p){return Math.abs(p.y)>Math.abs(p.x)}var x_=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.reset=function(){p.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},_.prototype._start=function(g){this._lastPoints=g,jf(g[0].sub(g[1]))&&(this._valid=!1)},_.prototype._move=function(g,b,S){var L=g[0].sub(this._lastPoints[0]),F=g[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(L,F,S.timeStamp),this._valid)return this._lastPoints=g,this._active=!0,{pitchDelta:(L.y+F.y)/2*-.5}},_.prototype.gestureBeginsVertically=function(g,b,S){if(this._valid!==void 0)return this._valid;var L=g.mag()>=2,F=b.mag()>=2;if(L||F){if(!L||!F)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var B=g.y>0==b.y>0;return jf(g)&&jf(b)&&B}},_})(Uo),I_={panStep:100,bearingStep:15,pitchStep:10},al=function(){var p=I_;this._panStep=p.panStep,this._bearingStep=p.bearingStep,this._pitchStep=p.pitchStep,this._rotationDisabled=!1};function fa(p){return p*(2-p)}al.prototype.blur=function(){this.reset()},al.prototype.reset=function(){this._active=!1},al.prototype.keydown=function(p){var _=this;if(!(p.altKey||p.ctrlKey||p.metaKey)){var g=0,b=0,S=0,L=0,F=0;switch(p.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:p.shiftKey?b=-1:(p.preventDefault(),L=-1);break;case 39:p.shiftKey?b=1:(p.preventDefault(),L=1);break;case 38:p.shiftKey?S=1:(p.preventDefault(),F=-1);break;case 40:p.shiftKey?S=-1:(p.preventDefault(),F=1);break;default:return}return this._rotationDisabled&&(b=0,S=0),{cameraAnimation:function(B){var J=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:fa,zoom:g?Math.round(J)+g*(p.shiftKey?2:1):J,bearing:B.getBearing()+b*_._bearingStep,pitch:B.getPitch()+S*_._pitchStep,offset:[-L*_._panStep,-F*_._panStep],center:B.getCenter()},{originalEvent:p})}}}},al.prototype.enable=function(){this._enabled=!0},al.prototype.disable=function(){this._enabled=!1,this.reset()},al.prototype.isEnabled=function(){return this._enabled},al.prototype.isActive=function(){return this._active},al.prototype.disableRotation=function(){this._rotationDisabled=!0},al.prototype.enableRotation=function(){this._rotationDisabled=!1};var ui=function(p,_){this._map=p,this._el=p.getCanvasContainer(),this._handler=_,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,s.bindAll(["_onTimeout"],this)};ui.prototype.setZoomRate=function(p){this._defaultZoomRate=p},ui.prototype.setWheelZoomRate=function(p){this._wheelZoomRate=p},ui.prototype.isEnabled=function(){return!!this._enabled},ui.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ui.prototype.isZooming=function(){return!!this._zooming},ui.prototype.enable=function(p){this.isEnabled()||(this._enabled=!0,this._aroundCenter=p&&p.around==="center")},ui.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ui.prototype.wheel=function(p){if(this.isEnabled()){var _=p.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*p.deltaY:p.deltaY,g=s.browser.now(),b=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,_!==0&&_%4.000244140625==0?this._type="wheel":_!==0&&Math.abs(_)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=_,this._timeout=setTimeout(this._onTimeout,40,p)):this._type||(this._type=Math.abs(b*_)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,_+=this._lastValue)),p.shiftKey&&_&&(_/=4),this._type&&(this._lastWheelEvent=p,this._delta-=_,this._active||this._start(p)),p.preventDefault()}},ui.prototype._onTimeout=function(p){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},ui.prototype._start=function(p){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var _=u.mousePos(this._el,p);this._around=s.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(_)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ui.prototype.renderFrame=function(){var p=this;if(this._frameId&&(this._frameId=null,this.isActive())){var _=this._map.transform;if(this._delta!==0){var g=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,b=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&b!==0&&(b=1/b);var S=typeof this._targetZoom=="number"?_.zoomScale(this._targetZoom):_.scale;this._targetZoom=Math.min(_.maxZoom,Math.max(_.minZoom,_.scaleZoom(S*b))),this._type==="wheel"&&(this._startZoom=_.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var L,F=typeof this._targetZoom=="number"?this._targetZoom:_.zoom,B=this._startZoom,J=this._easing,re=!1;if(this._type==="wheel"&&B&&J){var Ce=Math.min((s.browser.now()-this._lastWheelEventTime)/200,1),we=J(Ce);L=s.number(B,F,we),Ce<1?this._frameId||(this._frameId=!0):re=!0}else L=F,re=!0;return this._active=!0,re&&(this._active=!1,this._finishTimeout=setTimeout((function(){p._zooming=!1,p._handler._triggerRenderFrame(),delete p._targetZoom,delete p._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!re,zoomDelta:L-_.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ui.prototype._smoothOutEasing=function(p){var _=s.ease;if(this._prevEase){var g=this._prevEase,b=(s.browser.now()-g.start)/g.duration,S=g.easing(b+.01)-g.easing(b),L=.27/Math.sqrt(S*S+1e-4)*.01,F=Math.sqrt(.0729-L*L);_=s.bezier(L,F,.25,1)}return this._prevEase={start:s.browser.now(),duration:p,easing:_},_},ui.prototype.blur=function(){this.reset()},ui.prototype.reset=function(){this._active=!1};var Fl=function(p,_){this._clickZoom=p,this._tapZoom=_};Fl.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Fl.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Fl.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Fl.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var La=function(){this.reset()};La.prototype.reset=function(){this._active=!1},La.prototype.blur=function(){this.reset()},La.prototype.dblclick=function(p,_){return p.preventDefault(),{cameraAnimation:function(g){g.easeTo({duration:300,zoom:g.getZoom()+(p.shiftKey?-1:1),around:g.unproject(_)},{originalEvent:p})}}},La.prototype.enable=function(){this._enabled=!0},La.prototype.disable=function(){this._enabled=!1,this.reset()},La.prototype.isEnabled=function(){return this._enabled},La.prototype.isActive=function(){return this._active};var Hs=function(){this._tap=new ol({numTouches:1,numTaps:1}),this.reset()};Hs.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Hs.prototype.touchstart=function(p,_,g){this._swipePoint||(this._tapTime&&p.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=_[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(p,_,g))},Hs.prototype.touchmove=function(p,_,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;var b=_[0],S=b.y-this._swipePoint.y;return this._swipePoint=b,p.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(p,_,g)},Hs.prototype.touchend=function(p,_,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(p,_,g)&&(this._tapTime=p.timeStamp)},Hs.prototype.touchcancel=function(){this.reset()},Hs.prototype.enable=function(){this._enabled=!0},Hs.prototype.disable=function(){this._enabled=!1,this.reset()},Hs.prototype.isEnabled=function(){return this._enabled},Hs.prototype.isActive=function(){return this._active};var sh=function(p,_,g){this._el=p,this._mousePan=_,this._touchPan=g};sh.prototype.enable=function(p){this._inertiaOptions=p||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},sh.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},sh.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},sh.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Qu=function(p,_,g){this._pitchWithRotate=p.pitchWithRotate,this._mouseRotate=_,this._mousePitch=g};Qu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Qu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Qu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Qu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var ll=function(p,_,g,b){this._el=p,this._touchZoom=_,this._touchRotate=g,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0};ll.prototype.enable=function(p){this._touchZoom.enable(p),this._rotationDisabled||this._touchRotate.enable(p),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},ll.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},ll.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},ll.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},ll.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},ll.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var po=function(p){return p.zoom||p.drag||p.pitch||p.rotate},$f=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_})(s.Event);function _n(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}var un=function(p,_){this._map=p,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yf(p),this._bearingSnap=_.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(_),s.bindAll(["handleEvent","handleWindowEvent"],this);var g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[s.window,"blur",void 0]];for(var b=0,S=this._listeners;b<S.length;b+=1){var L=S[b],F=L[0];u.addEventListener(F,L[1],F===s.window.document?this.handleWindowEvent:this.handleEvent,L[2])}};un.prototype.destroy=function(){for(var p=0,_=this._listeners;p<_.length;p+=1){var g=_[p],b=g[0];u.removeEventListener(b,g[1],b===s.window.document?this.handleWindowEvent:this.handleEvent,g[2])}},un.prototype._addDefaultHandlers=function(p){var _=this._map,g=_.getCanvasContainer();this._add("mapEvent",new ns(_,p));var b=_.boxZoom=new Wo(_,p);this._add("boxZoom",b);var S=new zo,L=new La;_.doubleClickZoom=new Fl(L,S),this._add("tapZoom",S),this._add("clickZoom",L);var F=new Hs;this._add("tapDragZoom",F);var B=_.touchPitch=new x_;this._add("touchPitch",B);var J=new Mg(p),re=new b_(p);_.dragRotate=new Qu(p,J,re),this._add("mouseRotate",J,["mousePitch"]),this._add("mousePitch",re,["mouseRotate"]);var Ce=new v_(p),we=new ka(p);_.dragPan=new sh(g,Ce,we),this._add("mousePan",Ce),this._add("touchPan",we,["touchZoom","touchRotate"]);var Se=new g1,Be=new Xo;_.touchZoomRotate=new ll(g,Be,Se,F),this._add("touchRotate",Se,["touchPan","touchZoom"]),this._add("touchZoom",Be,["touchPan","touchRotate"]);var Ve=_.scrollZoom=new ui(_,this);this._add("scrollZoom",Ve,["mousePan"]);var Ke=_.keyboard=new al;this._add("keyboard",Ke),this._add("blockableMapEvent",new rn(_));for(var Pe=0,He=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Pe<He.length;Pe+=1){var Qe=He[Pe];p.interactive&&p[Qe]&&_[Qe].enable(p[Qe])}},un.prototype._add=function(p,_,g){this._handlers.push({handlerName:p,handler:_,allowed:g}),this._handlersById[p]=_},un.prototype.stop=function(p){if(!this._updatingCamera){for(var _=0,g=this._handlers;_<g.length;_+=1)g[_].handler.reset();this._inertia.clear(),this._fireEvents({},{},p),this._changes=[]}},un.prototype.isActive=function(){for(var p=0,_=this._handlers;p<_.length;p+=1)if(_[p].handler.isActive())return!0;return!1},un.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},un.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},un.prototype.isMoving=function(){return!!po(this._eventsInProgress)||this.isZooming()},un.prototype._blockedByActive=function(p,_,g){for(var b in p)if(b!==g&&(!_||_.indexOf(b)<0))return!0;return!1},un.prototype.handleWindowEvent=function(p){this.handleEvent(p,p.type+"Window")},un.prototype._getMapTouches=function(p){for(var _=[],g=0,b=p;g<b.length;g+=1){var S=b[g];this._el.contains(S.target)&&_.push(S)}return _},un.prototype.handleEvent=function(p,_){this._updatingCamera=!0;for(var g=p.type==="renderFrame"?void 0:p,b={needsRenderFrame:!1},S={},L={},F=p.touches?this._getMapTouches(p.touches):void 0,B=F?u.touchPos(this._el,F):u.mousePos(this._el,p),J=0,re=this._handlers;J<re.length;J+=1){var Ce=re[J],we=Ce.handlerName,Se=Ce.handler,Be=Ce.allowed;if(Se.isEnabled()){var Ve=void 0;this._blockedByActive(L,Be,we)?Se.reset():Se[_||p.type]&&(Ve=Se[_||p.type](p,B,F),this.mergeHandlerResult(b,S,Ve,we,g),Ve&&Ve.needsRenderFrame&&this._triggerRenderFrame()),(Ve||Se.isActive())&&(L[we]=Se)}}var Ke={};for(var Pe in this._previousActiveHandlers)L[Pe]||(Ke[Pe]=g);this._previousActiveHandlers=L,(Object.keys(Ke).length||_n(b))&&(this._changes.push([b,S,Ke]),this._triggerRenderFrame()),(Object.keys(L).length||_n(b))&&this._map._stop(!0),this._updatingCamera=!1;var He=b.cameraAnimation;He&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],He(this._map))},un.prototype.mergeHandlerResult=function(p,_,g,b,S){if(g){s.extend(p,g);var L={handlerName:b,originalEvent:g.originalEvent||S};g.zoomDelta!==void 0&&(_.zoom=L),g.panDelta!==void 0&&(_.drag=L),g.pitchDelta!==void 0&&(_.pitch=L),g.bearingDelta!==void 0&&(_.rotate=L)}},un.prototype._applyChanges=function(){for(var p={},_={},g={},b=0,S=this._changes;b<S.length;b+=1){var L=S[b],F=L[0],B=L[1],J=L[2];F.panDelta&&(p.panDelta=(p.panDelta||new s.Point(0,0))._add(F.panDelta)),F.zoomDelta&&(p.zoomDelta=(p.zoomDelta||0)+F.zoomDelta),F.bearingDelta&&(p.bearingDelta=(p.bearingDelta||0)+F.bearingDelta),F.pitchDelta&&(p.pitchDelta=(p.pitchDelta||0)+F.pitchDelta),F.around!==void 0&&(p.around=F.around),F.pinchAround!==void 0&&(p.pinchAround=F.pinchAround),F.noInertia&&(p.noInertia=F.noInertia),s.extend(_,B),s.extend(g,J)}this._updateMapTransform(p,_,g),this._changes=[]},un.prototype._updateMapTransform=function(p,_,g){var b=this._map,S=b.transform;if(!_n(p))return this._fireEvents(_,g,!0);var L=p.panDelta,F=p.zoomDelta,B=p.bearingDelta,J=p.pitchDelta,re=p.around,Ce=p.pinchAround;Ce!==void 0&&(re=Ce),b._stop(!0),re=re||b.transform.centerPoint;var we=S.pointLocation(L?re.sub(L):re);B&&(S.bearing+=B),J&&(S.pitch+=J),F&&(S.zoom+=F),S.setLocationAtPoint(we,re),this._map._update(),p.noInertia||this._inertia.record(p),this._fireEvents(_,g,!0)},un.prototype._fireEvents=function(p,_,g){var b=this,S=po(this._eventsInProgress),L=po(p),F={};for(var B in p)this._eventsInProgress[B]||(F[B+"start"]=p[B].originalEvent),this._eventsInProgress[B]=p[B];for(var J in!S&&L&&this._fireEvent("movestart",L.originalEvent),F)this._fireEvent(J,F[J]);for(var re in L&&this._fireEvent("move",L.originalEvent),p)this._fireEvent(re,p[re].originalEvent);var Ce,we={};for(var Se in this._eventsInProgress){var Be=this._eventsInProgress[Se],Ve=Be.handlerName,Ke=Be.originalEvent;this._handlersById[Ve].isActive()||(delete this._eventsInProgress[Se],we[Se+"end"]=Ce=_[Ve]||Ke)}for(var Pe in we)this._fireEvent(Pe,we[Pe]);var He=po(this._eventsInProgress);if(g&&(S||L)&&!He){this._updatingCamera=!0;var Qe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),rt=function(ht){return ht!==0&&-b._bearingSnap<ht&&ht<b._bearingSnap};Qe?(rt(Qe.bearing||this._map.getBearing())&&(Qe.bearing=0),this._map.easeTo(Qe,{originalEvent:Ce})):(this._map.fire(new s.Event("moveend",{originalEvent:Ce})),rt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},un.prototype._fireEvent=function(p,_){this._map.fire(new s.Event(p,_?{originalEvent:_}:{}))},un.prototype._requestFrame=function(){var p=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(_){delete p._frameId,p.handleEvent(new $f("renderFrame",{timeStamp:_})),p._applyChanges()}))},un.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Pg=(function(p){function _(g,b){p.call(this),this._moving=!1,this._zooming=!1,this.transform=g,this._bearingSnap=b.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getCenter=function(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)},_.prototype.setCenter=function(g,b){return this.jumpTo({center:g},b)},_.prototype.panBy=function(g,b,S){return g=s.Point.convert(g).mult(-1),this.panTo(this.transform.center,s.extend({offset:g},b),S)},_.prototype.panTo=function(g,b,S){return this.easeTo(s.extend({center:g},b),S)},_.prototype.getZoom=function(){return this.transform.zoom},_.prototype.setZoom=function(g,b){return this.jumpTo({zoom:g},b),this},_.prototype.zoomTo=function(g,b,S){return this.easeTo(s.extend({zoom:g},b),S)},_.prototype.zoomIn=function(g,b){return this.zoomTo(this.getZoom()+1,g,b),this},_.prototype.zoomOut=function(g,b){return this.zoomTo(this.getZoom()-1,g,b),this},_.prototype.getBearing=function(){return this.transform.bearing},_.prototype.setBearing=function(g,b){return this.jumpTo({bearing:g},b),this},_.prototype.getPadding=function(){return this.transform.padding},_.prototype.setPadding=function(g,b){return this.jumpTo({padding:g},b),this},_.prototype.rotateTo=function(g,b,S){return this.easeTo(s.extend({bearing:g},b),S)},_.prototype.resetNorth=function(g,b){return this.rotateTo(0,s.extend({duration:1e3},g),b),this},_.prototype.resetNorthPitch=function(g,b){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},g),b),this},_.prototype.snapToNorth=function(g,b){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(g,b):this},_.prototype.getPitch=function(){return this.transform.pitch},_.prototype.setPitch=function(g,b){return this.jumpTo({pitch:g},b),this},_.prototype.cameraForBounds=function(g,b){g=s.LngLatBounds.convert(g);var S=b&&b.bearing||0;return this._cameraForBoxAndBearing(g.getNorthWest(),g.getSouthEast(),S,b)},_.prototype._cameraForBoxAndBearing=function(g,b,S,L){var F={top:0,bottom:0,right:0,left:0};if(typeof(L=s.extend({padding:F,offset:[0,0],maxZoom:this.transform.maxZoom},L)).padding=="number"){var B=L.padding;L.padding={top:B,bottom:B,right:B,left:B}}L.padding=s.extend(F,L.padding);var J=this.transform,re=J.padding,Ce=J.project(s.LngLat.convert(g)),we=J.project(s.LngLat.convert(b)),Se=Ce.rotate(-S*Math.PI/180),Be=we.rotate(-S*Math.PI/180),Ve=new s.Point(Math.max(Se.x,Be.x),Math.max(Se.y,Be.y)),Ke=new s.Point(Math.min(Se.x,Be.x),Math.min(Se.y,Be.y)),Pe=Ve.sub(Ke),He=(J.width-(re.left+re.right+L.padding.left+L.padding.right))/Pe.x,Qe=(J.height-(re.top+re.bottom+L.padding.top+L.padding.bottom))/Pe.y;if(!(Qe<0||He<0)){var rt=Math.min(J.scaleZoom(J.scale*Math.min(He,Qe)),L.maxZoom),ht=typeof L.offset.x=="number"?new s.Point(L.offset.x,L.offset.y):s.Point.convert(L.offset),lt=new s.Point((L.padding.left-L.padding.right)/2,(L.padding.top-L.padding.bottom)/2).rotate(S*Math.PI/180),ft=ht.add(lt).mult(J.scale/J.zoomScale(rt));return{center:J.unproject(Ce.add(we).div(2).sub(ft)),zoom:rt,bearing:S}}s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},_.prototype.fitBounds=function(g,b,S){return this._fitInternal(this.cameraForBounds(g,b),b,S)},_.prototype.fitScreenCoordinates=function(g,b,S,L,F){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.Point.convert(g)),this.transform.pointLocation(s.Point.convert(b)),S,L),L,F)},_.prototype._fitInternal=function(g,b,S){return g?(delete(b=s.extend(g,b)).padding,b.linear?this.easeTo(b,S):this.flyTo(b,S)):this},_.prototype.jumpTo=function(g,b){this.stop();var S=this.transform,L=!1,F=!1,B=!1;return"zoom"in g&&S.zoom!==+g.zoom&&(L=!0,S.zoom=+g.zoom),g.center!==void 0&&(S.center=s.LngLat.convert(g.center)),"bearing"in g&&S.bearing!==+g.bearing&&(F=!0,S.bearing=+g.bearing),"pitch"in g&&S.pitch!==+g.pitch&&(B=!0,S.pitch=+g.pitch),g.padding==null||S.isPaddingEqual(g.padding)||(S.padding=g.padding),this.fire(new s.Event("movestart",b)).fire(new s.Event("move",b)),L&&this.fire(new s.Event("zoomstart",b)).fire(new s.Event("zoom",b)).fire(new s.Event("zoomend",b)),F&&this.fire(new s.Event("rotatestart",b)).fire(new s.Event("rotate",b)).fire(new s.Event("rotateend",b)),B&&this.fire(new s.Event("pitchstart",b)).fire(new s.Event("pitch",b)).fire(new s.Event("pitchend",b)),this.fire(new s.Event("moveend",b))},_.prototype.easeTo=function(g,b){var S=this;this._stop(!1,g.easeId),((g=s.extend({offset:[0,0],duration:500,easing:s.ease},g)).animate===!1||!g.essential&&s.browser.prefersReducedMotion)&&(g.duration=0);var L=this.transform,F=this.getZoom(),B=this.getBearing(),J=this.getPitch(),re=this.getPadding(),Ce="zoom"in g?+g.zoom:F,we="bearing"in g?this._normalizeBearing(g.bearing,B):B,Se="pitch"in g?+g.pitch:J,Be="padding"in g?g.padding:L.padding,Ve=s.Point.convert(g.offset),Ke=L.centerPoint.add(Ve),Pe=L.pointLocation(Ke),He=s.LngLat.convert(g.center||Pe);this._normalizeCenter(He);var Qe,rt,ht=L.project(Pe),lt=L.project(He).sub(ht),ft=L.zoomScale(Ce-F);g.around&&(Qe=s.LngLat.convert(g.around),rt=L.locationPoint(Qe));var wt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ce!==F,this._rotating=this._rotating||B!==we,this._pitching=this._pitching||Se!==J,this._padding=!L.isPaddingEqual(Be),this._easeId=g.easeId,this._prepareEase(b,g.noMoveStart,wt),this._ease((function(Vt){if(S._zooming&&(L.zoom=s.number(F,Ce,Vt)),S._rotating&&(L.bearing=s.number(B,we,Vt)),S._pitching&&(L.pitch=s.number(J,Se,Vt)),S._padding&&(L.interpolatePadding(re,Be,Vt),Ke=L.centerPoint.add(Ve)),Qe)L.setLocationAtPoint(Qe,rt);else{var Ot=L.zoomScale(L.zoom-F),en=Ce>F?Math.min(2,ft):Math.max(.5,ft),vn=Math.pow(en,1-Vt),Cn=L.unproject(ht.add(lt.mult(Vt*vn)).mult(Ot));L.setLocationAtPoint(L.renderWorldCopies?Cn.wrap():Cn,Ke)}S._fireMoveEvents(b)}),(function(Vt){S._afterEase(b,Vt)}),g),this},_.prototype._prepareEase=function(g,b,S){S===void 0&&(S={}),this._moving=!0,b||S.moving||this.fire(new s.Event("movestart",g)),this._zooming&&!S.zooming&&this.fire(new s.Event("zoomstart",g)),this._rotating&&!S.rotating&&this.fire(new s.Event("rotatestart",g)),this._pitching&&!S.pitching&&this.fire(new s.Event("pitchstart",g))},_.prototype._fireMoveEvents=function(g){this.fire(new s.Event("move",g)),this._zooming&&this.fire(new s.Event("zoom",g)),this._rotating&&this.fire(new s.Event("rotate",g)),this._pitching&&this.fire(new s.Event("pitch",g))},_.prototype._afterEase=function(g,b){if(!this._easeId||!b||this._easeId!==b){delete this._easeId;var S=this._zooming,L=this._rotating,F=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new s.Event("zoomend",g)),L&&this.fire(new s.Event("rotateend",g)),F&&this.fire(new s.Event("pitchend",g)),this.fire(new s.Event("moveend",g))}},_.prototype.flyTo=function(g,b){var S=this;if(!g.essential&&s.browser.prefersReducedMotion){var L=s.pick(g,["center","zoom","bearing","pitch","around"]);return this.jumpTo(L,b)}this.stop(),g=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},g);var F=this.transform,B=this.getZoom(),J=this.getBearing(),re=this.getPitch(),Ce=this.getPadding(),we="zoom"in g?s.clamp(+g.zoom,F.minZoom,F.maxZoom):B,Se="bearing"in g?this._normalizeBearing(g.bearing,J):J,Be="pitch"in g?+g.pitch:re,Ve="padding"in g?g.padding:F.padding,Ke=F.zoomScale(we-B),Pe=s.Point.convert(g.offset),He=F.centerPoint.add(Pe),Qe=F.pointLocation(He),rt=s.LngLat.convert(g.center||Qe);this._normalizeCenter(rt);var ht=F.project(Qe),lt=F.project(rt).sub(ht),ft=g.curve,wt=Math.max(F.width,F.height),Vt=wt/Ke,Ot=lt.mag();if("minZoom"in g){var en=s.clamp(Math.min(g.minZoom,B,we),F.minZoom,F.maxZoom),vn=wt/F.zoomScale(en-B);ft=Math.sqrt(vn/Ot*2)}var Cn=ft*ft;function In(Pn){var Tn=(Vt*Vt-wt*wt+(Pn?-1:1)*Cn*Cn*Ot*Ot)/(2*(Pn?Vt:wt)*Cn*Ot);return Math.log(Math.sqrt(Tn*Tn+1)-Tn)}function wi(Pn){return(Math.exp(Pn)-Math.exp(-Pn))/2}function nn(Pn){return(Math.exp(Pn)+Math.exp(-Pn))/2}var Nn=In(0),$n=function(Pn){return nn(Nn)/nn(Nn+ft*Pn)},On=function(Pn){return wt*((nn(Nn)*(wi(Tn=Nn+ft*Pn)/nn(Tn))-wi(Nn))/Cn)/Ot;var Tn},Fn=(In(1)-Nn)/ft;if(Math.abs(Ot)<1e-6||!isFinite(Fn)){if(Math.abs(wt-Vt)<1e-6)return this.easeTo(g,b);var jn=Vt<wt?-1:1;Fn=Math.abs(Math.log(Vt/wt))/ft,On=function(){return 0},$n=function(Pn){return Math.exp(jn*ft*Pn)}}return g.duration="duration"in g?+g.duration:1e3*Fn/("screenSpeed"in g?+g.screenSpeed/ft:+g.speed),g.maxDuration&&g.duration>g.maxDuration&&(g.duration=0),this._zooming=!0,this._rotating=J!==Se,this._pitching=Be!==re,this._padding=!F.isPaddingEqual(Ve),this._prepareEase(b,!1),this._ease((function(Pn){var Tn=Pn*Fn,bs=1/$n(Tn);F.zoom=Pn===1?we:B+F.scaleZoom(bs),S._rotating&&(F.bearing=s.number(J,Se,Pn)),S._pitching&&(F.pitch=s.number(re,Be,Pn)),S._padding&&(F.interpolatePadding(Ce,Ve,Pn),He=F.centerPoint.add(Pe));var Nr=Pn===1?rt:F.unproject(ht.add(lt.mult(On(Tn))).mult(bs));F.setLocationAtPoint(F.renderWorldCopies?Nr.wrap():Nr,He),S._fireMoveEvents(b)}),(function(){return S._afterEase(b)}),g),this},_.prototype.isEasing=function(){return!!this._easeFrameId},_.prototype.stop=function(){return this._stop()},_.prototype._stop=function(g,b){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,b)}if(!g){var L=this.handlers;L&&L.stop(!1)}return this},_.prototype._ease=function(g,b,S){S.animate===!1||S.duration===0?(g(1),b()):(this._easeStart=s.browser.now(),this._easeOptions=S,this._onEaseFrame=g,this._onEaseEnd=b,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},_.prototype._renderFrameCallback=function(){var g=Math.min((s.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},_.prototype._normalizeBearing=function(g,b){g=s.wrap(g,-180,180);var S=Math.abs(g-b);return Math.abs(g-360-b)<S&&(g-=360),Math.abs(g+360-b)<S&&(g+=360),g},_.prototype._normalizeCenter=function(g){var b=this.transform;if(b.renderWorldCopies&&!b.lngRange){var S=g.lng-b.center.lng;g.lng+=S>180?-360:S<-180?360:0}},_})(s.Evented),go=function(p){p===void 0&&(p={}),this.options=p,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};go.prototype.getDefaultPosition=function(){return"bottom-right"},go.prototype.onAdd=function(p){var _=this.options&&this.options.compact;return this._map=p,this._container=u.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=u.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=u.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),_&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),_===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},go.prototype.onRemove=function(){u.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},go.prototype._setElementTitle=function(p,_){var g=this._map._getUIString("AttributionControl."+_);p.title=g,p.setAttribute("aria-label",g)},go.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},go.prototype._updateEditLink=function(){var p=this._editLink;p||(p=this._editLink=this._container.querySelector(".mapbox-improve-map"));var _=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(p){var g=_.reduce((function(b,S,L){return S.value&&(b+=S.key+"="+S.value+(L<_.length-1?"&":"")),b}),"?");p.href=s.config.FEEDBACK_URL+"/"+g+(this._map._hash?this._map._hash.getHashString(!0):""),p.rel="noopener nofollow",this._setElementTitle(p,"MapFeedback")}},go.prototype._updateData=function(p){!p||p.sourceDataType!=="metadata"&&p.sourceDataType!=="visibility"&&p.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},go.prototype._updateAttributions=function(){if(this._map.style){var p=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?p=p.concat(this.options.customAttribution.map((function(B){return typeof B!="string"?"":B}))):typeof this.options.customAttribution=="string"&&p.push(this.options.customAttribution)),this._map.style.stylesheet){var _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}var g=this._map.style.sourceCaches;for(var b in g){var S=g[b];if(S.used){var L=S.getSource();L.attribution&&p.indexOf(L.attribution)<0&&p.push(L.attribution)}}p.sort((function(B,J){return B.length-J.length}));var F=(p=p.filter((function(B,J){for(var re=J+1;re<p.length;re++)if(p[re].indexOf(B)>=0)return!1;return!0}))).join(" | ");F!==this._attribHTML&&(this._attribHTML=F,p.length?(this._innerContainer.innerHTML=F,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},go.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var ul=function(){s.bindAll(["_updateLogo"],this),s.bindAll(["_updateCompact"],this)};ul.prototype.onAdd=function(p){this._map=p,this._container=u.create("div","mapboxgl-ctrl");var _=u.create("a","mapboxgl-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://www.mapbox.com/",_.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),_.setAttribute("rel","noopener nofollow"),this._container.appendChild(_),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ul.prototype.onRemove=function(){u.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ul.prototype.getDefaultPosition=function(){return"bottom-left"},ul.prototype._updateLogo=function(p){p&&p.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ul.prototype._logoRequired=function(){if(this._map.style){var p=this._map.style.sourceCaches;for(var _ in p)if(p[_].getSource().mapbox_logo)return!0;return!1}},ul.prototype._updateCompact=function(){var p=this._container.children;if(p.length){var _=p[0];this._map.getCanvasContainer().offsetWidth<250?_.classList.add("mapboxgl-compact"):_.classList.remove("mapboxgl-compact")}};var Ks=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ks.prototype.add=function(p){var _=++this._id;return this._queue.push({callback:p,id:_,cancelled:!1}),_},Ks.prototype.remove=function(p){for(var _=this._currentlyRunning,g=0,b=_?this._queue.concat(_):this._queue;g<b.length;g+=1){var S=b[g];if(S.id===p)return void(S.cancelled=!0)}},Ks.prototype.run=function(p){p===void 0&&(p=0);var _=this._currentlyRunning=this._queue;this._queue=[];for(var g=0,b=_;g<b.length;g+=1){var S=b[g];if(!S.cancelled&&(S.callback(p),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ks.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ol={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},C_=s.window.HTMLImageElement,Gg=s.window.HTMLElement,Zi=s.window.ImageBitmap,Gs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},m1=(function(p){function _(b){var S=this;if((b=s.extend({},Gs,b)).minZoom!=null&&b.maxZoom!=null&&b.minZoom>b.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(b.minPitch!=null&&b.maxPitch!=null&&b.minPitch>b.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(b.minPitch!=null&&b.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(b.maxPitch!=null&&b.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var L=new vi(b.minZoom,b.maxZoom,b.minPitch,b.maxPitch,b.renderWorldCopies);if(p.call(this,L,b),this._interactive=b.interactive,this._maxTileCacheSize=b.maxTileCacheSize,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._antialias=b.antialias,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,this._refreshExpiredTiles=b.refreshExpiredTiles,this._fadeDuration=b.fadeDuration,this._crossSourceCollisions=b.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=b.collectResourceTiming,this._renderTaskQueue=new Ks,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Ol,b.locale),this._clickTolerance=b.clickTolerance,this._requestManager=new s.RequestManager(b.transformRequest,b.accessToken),typeof b.container=="string"){if(this._container=s.window.document.getElementById(b.container),!this._container)throw new Error("Container '"+b.container+"' not found.")}else{if(!(b.container instanceof Gg))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(b.maxBounds&&this.setMaxBounds(b.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return S._update(!1)})),this.on("moveend",(function(){return S._update(!1)})),this.on("zoom",(function(){return S._update(!0)})),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new un(this,b),this._hash=b.hash&&new da(typeof b.hash=="string"&&b.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}),b.bounds&&(this.resize(),this.fitBounds(b.bounds,s.extend({},b.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=b.localIdeographFontFamily,b.style&&this.setStyle(b.style,{localIdeographFontFamily:b.localIdeographFontFamily}),b.attributionControl&&this.addControl(new go({customAttribution:b.customAttribution})),this.addControl(new ul,b.logoPosition),this.on("style.load",(function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)})),this.on("data",(function(F){S._update(F.dataType==="style"),S.fire(new s.Event(F.dataType+"data",F))})),this.on("dataloading",(function(F){S.fire(new s.Event(F.dataType+"dataloading",F))}))}p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_;var g={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return _.prototype._getMapId=function(){return this._mapId},_.prototype.addControl=function(b,S){if(S===void 0&&(S=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var L=b.onAdd(this);this._controls.push(b);var F=this._controlPositions[S];return S.indexOf("bottom")!==-1?F.insertBefore(L,F.firstChild):F.appendChild(L),this},_.prototype.removeControl=function(b){if(!b||!b.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(b);return S>-1&&this._controls.splice(S,1),b.onRemove(this),this},_.prototype.hasControl=function(b){return this._controls.indexOf(b)>-1},_.prototype.resize=function(b){var S=this._containerDimensions(),L=S[0],F=S[1];if(L===this.transform.width&&F===this.transform.height)return this;this._resizeCanvas(L,F),this.transform.resize(L,F),this.painter.resize(L,F);var B=!this._moving;return B&&this.fire(new s.Event("movestart",b)).fire(new s.Event("move",b)),this.fire(new s.Event("resize",b)),B&&this.fire(new s.Event("moveend",b)),this},_.prototype.getBounds=function(){return this.transform.getBounds()},_.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},_.prototype.setMaxBounds=function(b){return this.transform.setMaxBounds(s.LngLatBounds.convert(b)),this._update()},_.prototype.setMinZoom=function(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},_.prototype.getMinZoom=function(){return this.transform.minZoom},_.prototype.setMaxZoom=function(b){if((b=b??22)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")},_.prototype.getMaxZoom=function(){return this.transform.maxZoom},_.prototype.setMinPitch=function(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},_.prototype.getMinPitch=function(){return this.transform.minPitch},_.prototype.setMaxPitch=function(b){if((b=b??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")},_.prototype.getMaxPitch=function(){return this.transform.maxPitch},_.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},_.prototype.setRenderWorldCopies=function(b){return this.transform.renderWorldCopies=b,this._update()},_.prototype.project=function(b){return this.transform.locationPoint(s.LngLat.convert(b))},_.prototype.unproject=function(b){return this.transform.pointLocation(s.Point.convert(b))},_.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},_.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},_.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},_.prototype._createDelegatedListener=function(b,S,L){var F,B=this;if(b==="mouseenter"||b==="mouseover"){var J=!1;return{layer:S,listener:L,delegates:{mousemove:function(Ce){var we=B.getLayer(S)?B.queryRenderedFeatures(Ce.point,{layers:[S]}):[];we.length?J||(J=!0,L.call(B,new os(b,B,Ce.originalEvent,{features:we}))):J=!1},mouseout:function(){J=!1}}}}if(b==="mouseleave"||b==="mouseout"){var re=!1;return{layer:S,listener:L,delegates:{mousemove:function(Ce){(B.getLayer(S)?B.queryRenderedFeatures(Ce.point,{layers:[S]}):[]).length?re=!0:re&&(re=!1,L.call(B,new os(b,B,Ce.originalEvent)))},mouseout:function(Ce){re&&(re=!1,L.call(B,new os(b,B,Ce.originalEvent)))}}}}return{layer:S,listener:L,delegates:(F={},F[b]=function(Ce){var we=B.getLayer(S)?B.queryRenderedFeatures(Ce.point,{layers:[S]}):[];we.length&&(Ce.features=we,L.call(B,Ce),delete Ce.features)},F)}},_.prototype.on=function(b,S,L){if(L===void 0)return p.prototype.on.call(this,b,S);var F=this._createDelegatedListener(b,S,L);for(var B in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(F),F.delegates)this.on(B,F.delegates[B]);return this},_.prototype.once=function(b,S,L){if(L===void 0)return p.prototype.once.call(this,b,S);var F=this._createDelegatedListener(b,S,L);for(var B in F.delegates)this.once(B,F.delegates[B]);return this},_.prototype.off=function(b,S,L){var F=this;return L===void 0?p.prototype.off.call(this,b,S):(this._delegatedListeners&&this._delegatedListeners[b]&&(function(B){for(var J=B[b],re=0;re<J.length;re++){var Ce=J[re];if(Ce.layer===S&&Ce.listener===L){for(var we in Ce.delegates)F.off(we,Ce.delegates[we]);return J.splice(re,1),F}}})(this._delegatedListeners),this)},_.prototype.queryRenderedFeatures=function(b,S){if(!this.style)return[];var L;if(S!==void 0||b===void 0||b instanceof s.Point||Array.isArray(b)||(S=b,b=void 0),S=S||{},(b=b||[[0,0],[this.transform.width,this.transform.height]])instanceof s.Point||typeof b[0]=="number")L=[s.Point.convert(b)];else{var F=s.Point.convert(b[0]),B=s.Point.convert(b[1]);L=[F,new s.Point(B.x,F.y),B,new s.Point(F.x,B.y),F]}return this.style.queryRenderedFeatures(L,S,this.transform)},_.prototype.querySourceFeatures=function(b,S){return this.style.querySourceFeatures(b,S)},_.prototype.setStyle=function(b,S){return(S=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(b,S))},_.prototype._getUIString=function(b){var S=this._locale[b];if(S==null)throw new Error("Missing UI string '"+b+"'");return S},_.prototype._updateStyle=function(b,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),b?(this.style=new Zo(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b):this.style.loadJSON(b),this):(delete this.style,this)},_.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Zo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},_.prototype._diffStyle=function(b,S){var L=this;if(typeof b=="string"){var F=this._requestManager.normalizeStyleURL(b),B=this._requestManager.transformRequest(F,s.ResourceType.Style);s.getJSON(B,(function(J,re){J?L.fire(new s.ErrorEvent(J)):re&&L._updateDiff(re,S)}))}else typeof b=="object"&&this._updateDiff(b,S)},_.prototype._updateDiff=function(b,S){try{this.style.setState(b)&&this._update(!0)}catch(L){s.warnOnce("Unable to perform style diff: "+(L.message||L.error||L)+".  Rebuilding the style from scratch."),this._updateStyle(b,S)}},_.prototype.getStyle=function(){if(this.style)return this.style.serialize()},_.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")},_.prototype.addSource=function(b,S){return this._lazyInitEmptyStyle(),this.style.addSource(b,S),this._update(!0)},_.prototype.isSourceLoaded=function(b){var S=this.style&&this.style.sourceCaches[b];if(S!==void 0)return S.loaded();this.fire(new s.ErrorEvent(new Error("There is no source with ID '"+b+"'")))},_.prototype.areTilesLoaded=function(){var b=this.style&&this.style.sourceCaches;for(var S in b){var L=b[S]._tiles;for(var F in L){var B=L[F];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0},_.prototype.addSourceType=function(b,S,L){return this._lazyInitEmptyStyle(),this.style.addSourceType(b,S,L)},_.prototype.removeSource=function(b){return this.style.removeSource(b),this._update(!0)},_.prototype.getSource=function(b){return this.style.getSource(b)},_.prototype.addImage=function(b,S,L){L===void 0&&(L={});var F=L.pixelRatio;F===void 0&&(F=1);var B=L.sdf;B===void 0&&(B=!1);var J=L.stretchX,re=L.stretchY,Ce=L.content;if(this._lazyInitEmptyStyle(),S instanceof C_||Zi&&S instanceof Zi){var we=s.browser.getImageData(S);this.style.addImage(b,{data:new s.RGBAImage({width:we.width,height:we.height},we.data),pixelRatio:F,stretchX:J,stretchY:re,content:Ce,sdf:B,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Se=S;this.style.addImage(b,{data:new s.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:F,stretchX:J,stretchY:re,content:Ce,sdf:B,version:0,userImage:Se}),Se.onAdd&&Se.onAdd(this,b)}},_.prototype.updateImage=function(b,S){var L=this.style.getImage(b);if(!L)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var F=S instanceof C_||Zi&&S instanceof Zi?s.browser.getImageData(S):S,B=F.width,J=F.height,re=F.data;return B===void 0||J===void 0?this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):B!==L.data.width||J!==L.data.height?this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(L.data.replace(re,!(S instanceof C_||Zi&&S instanceof Zi)),void this.style.updateImage(b,L))},_.prototype.hasImage=function(b){return b?!!this.style.getImage(b):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)},_.prototype.removeImage=function(b){this.style.removeImage(b)},_.prototype.loadImage=function(b,S){s.getImage(this._requestManager.transformRequest(b,s.ResourceType.Image),S)},_.prototype.listImages=function(){return this.style.listImages()},_.prototype.addLayer=function(b,S){return this._lazyInitEmptyStyle(),this.style.addLayer(b,S),this._update(!0)},_.prototype.moveLayer=function(b,S){return this.style.moveLayer(b,S),this._update(!0)},_.prototype.removeLayer=function(b){return this.style.removeLayer(b),this._update(!0)},_.prototype.getLayer=function(b){return this.style.getLayer(b)},_.prototype.setLayerZoomRange=function(b,S,L){return this.style.setLayerZoomRange(b,S,L),this._update(!0)},_.prototype.setFilter=function(b,S,L){return L===void 0&&(L={}),this.style.setFilter(b,S,L),this._update(!0)},_.prototype.getFilter=function(b){return this.style.getFilter(b)},_.prototype.setPaintProperty=function(b,S,L,F){return F===void 0&&(F={}),this.style.setPaintProperty(b,S,L,F),this._update(!0)},_.prototype.getPaintProperty=function(b,S){return this.style.getPaintProperty(b,S)},_.prototype.setLayoutProperty=function(b,S,L,F){return F===void 0&&(F={}),this.style.setLayoutProperty(b,S,L,F),this._update(!0)},_.prototype.getLayoutProperty=function(b,S){return this.style.getLayoutProperty(b,S)},_.prototype.setLight=function(b,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(b,S),this._update(!0)},_.prototype.getLight=function(){return this.style.getLight()},_.prototype.setFeatureState=function(b,S){return this.style.setFeatureState(b,S),this._update()},_.prototype.removeFeatureState=function(b,S){return this.style.removeFeatureState(b,S),this._update()},_.prototype.getFeatureState=function(b){return this.style.getFeatureState(b)},_.prototype.getContainer=function(){return this._container},_.prototype.getCanvasContainer=function(){return this._canvasContainer},_.prototype.getCanvas=function(){return this._canvas},_.prototype._containerDimensions=function(){var b=0,S=0;return this._container&&(b=this._container.clientWidth||400,S=this._container.clientHeight||300),[b,S]},_.prototype._detectMissingCSS=function(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},_.prototype._setupContainer=function(){var b=this._container;b.classList.add("mapboxgl-map"),(this._missingCSSCanary=u.create("div","mapboxgl-canary",b)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=u.create("div","mapboxgl-canvas-container",b);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=u.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var L=this._containerDimensions();this._resizeCanvas(L[0],L[1]);var F=this._controlContainer=u.create("div","mapboxgl-control-container",b),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(J){B[J]=u.create("div","mapboxgl-ctrl-"+J,F)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},_.prototype._resizeCanvas=function(b,S){var L=s.browser.devicePixelRatio||1;this._canvas.width=L*b,this._canvas.height=L*S,this._canvas.style.width=b+"px",this._canvas.style.height=S+"px"},_.prototype._setupPainter=function(){var b=s.extend({},l.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",b)||this._canvas.getContext("experimental-webgl",b);S?(this.painter=new wr(S,this.transform),s.webpSupported.testSupport(S)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))},_.prototype._contextLost=function(b){b.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:b}))},_.prototype._contextRestored=function(b){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:b}))},_.prototype._onMapScroll=function(b){if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},_.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},_.prototype._update=function(b){return this.style?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this},_.prototype._requestRenderFrame=function(b){return this._update(),this._renderTaskQueue.add(b)},_.prototype._cancelRenderFrame=function(b){this._renderTaskQueue.remove(b)},_.prototype._render=function(b){var S,L=this,F=0,B=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=B.createQueryEXT(),B.beginQueryEXT(B.TIME_ELAPSED_EXT,S),F=s.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),!this._removed){var J=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var re=this.transform.zoom,Ce=s.browser.now();this.style.zoomHistory.update(re,Ce);var we=new s.EvaluationParameters(re,{now:Ce,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Se=we.crossFadingFactor();Se===1&&Se===this._crossFadingFactor||(J=!0,this._crossFadingFactor=Se),this.style.update(we)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||J)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Be=s.browser.now()-F;B.endQueryEXT(B.TIME_ELAPSED_EXT,S),setTimeout((function(){var Pe=B.getQueryObjectEXT(S,B.QUERY_RESULT_EXT)/1e6;B.deleteQueryEXT(S),L.fire(new s.Event("gpu-timing-frame",{cpuTime:Be,gpuTime:Pe}))}),50)}if(this.listens("gpu-timing-layer")){var Ve=this.painter.collectGpuTimers();setTimeout((function(){var Pe=L.painter.queryGpuTimers(Ve);L.fire(new s.Event("gpu-timing-layer",{layerTimes:Pe}))}),50)}var Ke=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ke||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||Ke||(this._fullyLoaded=!0),this}},_.prototype.remove=function(){this._hash&&this._hash.remove();for(var b=0,S=this._controls;b<S.length;b+=1)S[b].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));var L=this.painter.context.gl.getExtension("WEBGL_lose_context");L&&L.loseContext(),oh(this._canvasContainer),oh(this._controlContainer),oh(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new s.Event("remove"))},_.prototype.triggerRepaint=function(){var b=this;this.style&&!this._frame&&(this._frame=s.browser.frame((function(S){b._frame=null,b._render(S)})))},_.prototype._onWindowOnline=function(){this._update()},_.prototype._onWindowResize=function(b){this._trackResize&&this.resize({originalEvent:b})._update()},g.showTileBoundaries.get=function(){return!!this._showTileBoundaries},g.showTileBoundaries.set=function(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())},g.showPadding.get=function(){return!!this._showPadding},g.showPadding.set=function(b){this._showPadding!==b&&(this._showPadding=b,this._update())},g.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},g.showCollisionBoxes.set=function(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())},g.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},g.showOverdrawInspector.set=function(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())},g.repaint.get=function(){return!!this._repaint},g.repaint.set=function(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())},g.vertices.get=function(){return!!this._vertices},g.vertices.set=function(b){this._vertices=b,this._update()},_.prototype._setCacheLimits=function(b,S){s.setCacheLimits(b,S)},g.version.get=function(){return s.version},Object.defineProperties(_.prototype,g),_})(Pg);function oh(p){p.parentNode&&p.parentNode.removeChild(p)}var w_={showCompass:!0,showZoom:!0,visualizePitch:!1},lu=function(p){var _=this;this.options=s.extend({},w_,p),this._container=u.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(g){return g.preventDefault()})),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(g){return _._map.zoomIn({},{originalEvent:g})})),u.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(g){return _._map.zoomOut({},{originalEvent:g})})),u.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(g){_.options.visualizePitch?_._map.resetNorthPitch({},{originalEvent:g}):_._map.resetNorth({},{originalEvent:g})})),this._compassIcon=u.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};lu.prototype._updateZoomButtons=function(){var p=this._map.getZoom(),_=p===this._map.getMaxZoom(),g=p===this._map.getMinZoom();this._zoomInButton.disabled=_,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",_.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},lu.prototype._rotateCompassArrow=function(){var p=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=p},lu.prototype.onAdd=function(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yo(this._map,this._compass,this.options.visualizePitch)),this._container},lu.prototype.onRemove=function(){u.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},lu.prototype._createButton=function(p,_){var g=u.create("button",p,this._container);return g.type="button",g.addEventListener("click",_),g},lu.prototype._setButtonTitle=function(p,_){var g=this._map._getUIString("NavigationControl."+_);p.title=g,p.setAttribute("aria-label",g)};var Yo=function(p,_,g){g===void 0&&(g=!1),this._clickTolerance=10,this.element=_,this.mouseRotate=new Mg({clickTolerance:p.dragRotate._mouseRotate._clickTolerance}),this.map=p,g&&(this.mousePitch=new b_({clickTolerance:p.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener(_,"mousedown",this.mousedown),u.addEventListener(_,"touchstart",this.touchstart,{passive:!1}),u.addEventListener(_,"touchmove",this.touchmove),u.addEventListener(_,"touchend",this.touchend),u.addEventListener(_,"touchcancel",this.reset)};function _d(p,_,g){if(p=new s.LngLat(p.lng,p.lat),_){var b=new s.LngLat(p.lng-360,p.lat),S=new s.LngLat(p.lng+360,p.lat),L=g.locationPoint(p).distSqr(_);g.locationPoint(b).distSqr(_)<L?p=b:g.locationPoint(S).distSqr(_)<L&&(p=S)}for(;Math.abs(p.lng-g.center.lng)>180;){var F=g.locationPoint(p);if(F.x>=0&&F.y>=0&&F.x<=g.width&&F.y<=g.height)break;p.lng>g.center.lng?p.lng-=360:p.lng+=360}return p}Yo.prototype.down=function(p,_){this.mouseRotate.mousedown(p,_),this.mousePitch&&this.mousePitch.mousedown(p,_),u.disableDrag()},Yo.prototype.move=function(p,_){var g=this.map,b=this.mouseRotate.mousemoveWindow(p,_);if(b&&b.bearingDelta&&g.setBearing(g.getBearing()+b.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(p,_);S&&S.pitchDelta&&g.setPitch(g.getPitch()+S.pitchDelta)}},Yo.prototype.off=function(){var p=this.element;u.removeEventListener(p,"mousedown",this.mousedown),u.removeEventListener(p,"touchstart",this.touchstart,{passive:!1}),u.removeEventListener(p,"touchmove",this.touchmove),u.removeEventListener(p,"touchend",this.touchend),u.removeEventListener(p,"touchcancel",this.reset),this.offTemp()},Yo.prototype.offTemp=function(){u.enableDrag(),u.removeEventListener(s.window,"mousemove",this.mousemove),u.removeEventListener(s.window,"mouseup",this.mouseup)},Yo.prototype.mousedown=function(p){this.down(s.extend({},p,{ctrlKey:!0,preventDefault:function(){return p.preventDefault()}}),u.mousePos(this.element,p)),u.addEventListener(s.window,"mousemove",this.mousemove),u.addEventListener(s.window,"mouseup",this.mouseup)},Yo.prototype.mousemove=function(p){this.move(p,u.mousePos(this.element,p))},Yo.prototype.mouseup=function(p){this.mouseRotate.mouseupWindow(p),this.mousePitch&&this.mousePitch.mouseupWindow(p),this.offTemp()},Yo.prototype.touchstart=function(p){p.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=u.touchPos(this.element,p.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return p.preventDefault()}},this._startPos))},Yo.prototype.touchmove=function(p){p.targetTouches.length!==1?this.reset():(this._lastPos=u.touchPos(this.element,p.targetTouches)[0],this.move({preventDefault:function(){return p.preventDefault()}},this._lastPos))},Yo.prototype.touchend=function(p){p.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Yo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Nl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Fg(p,_,g){var b=p.classList;for(var S in Nl)b.remove("mapboxgl-"+g+"-anchor-"+S);b.add("mapboxgl-"+g+"-anchor-"+_)}var vd,Jf=(function(p){function _(g,b){if(p.call(this),(g instanceof s.window.HTMLElement||b)&&(g=s.extend({element:g},b)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=g&&g.anchor||"center",this._color=g&&g.color||"#3FB1CE",this._scale=g&&g.scale||1,this._draggable=g&&g.draggable||!1,this._clickTolerance=g&&g.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=g&&g.rotation||0,this._rotationAlignment=g&&g.rotationAlignment||"auto",this._pitchAlignment=g&&g.pitchAlignment&&g.pitchAlignment!=="auto"?g.pitchAlignment:this._rotationAlignment,g&&g.element)this._element=g.element,this._offset=s.Point.convert(g&&g.offset||[0,0]);else{this._defaultMarker=!0,this._element=u.create("div"),this._element.setAttribute("aria-label","Map marker");var S=u.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var L=u.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"stroke","none"),L.setAttributeNS(null,"stroke-width","1"),L.setAttributeNS(null,"fill","none"),L.setAttributeNS(null,"fill-rule","evenodd");var F=u.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill-rule","nonzero");var B=u.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");for(var J=0,re=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];J<re.length;J+=1){var Ce=re[J],we=u.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",Ce.rx),we.setAttributeNS(null,"ry",Ce.ry),B.appendChild(we)}var Se=u.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"fill",this._color);var Be=u.createNS("http://www.w3.org/2000/svg","path");Be.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Se.appendChild(Be);var Ve=u.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"opacity","0.25"),Ve.setAttributeNS(null,"fill","#000000");var Ke=u.createNS("http://www.w3.org/2000/svg","path");Ke.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ve.appendChild(Ke);var Pe=u.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Pe.setAttributeNS(null,"fill","#FFFFFF");var He=u.createNS("http://www.w3.org/2000/svg","g");He.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Qe=u.createNS("http://www.w3.org/2000/svg","circle");Qe.setAttributeNS(null,"fill","#000000"),Qe.setAttributeNS(null,"opacity","0.25"),Qe.setAttributeNS(null,"cx","5.5"),Qe.setAttributeNS(null,"cy","5.5"),Qe.setAttributeNS(null,"r","5.4999962");var rt=u.createNS("http://www.w3.org/2000/svg","circle");rt.setAttributeNS(null,"fill","#FFFFFF"),rt.setAttributeNS(null,"cx","5.5"),rt.setAttributeNS(null,"cy","5.5"),rt.setAttributeNS(null,"r","5.4999962"),He.appendChild(Qe),He.appendChild(rt),F.appendChild(B),F.appendChild(Se),F.appendChild(Ve),F.appendChild(Pe),F.appendChild(He),S.appendChild(F),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=s.Point.convert(g&&g.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(ht){ht.preventDefault()})),this._element.addEventListener("mousedown",(function(ht){ht.preventDefault()})),Fg(this._element,this._anchor,"marker"),this._popup=null}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.addTo=function(g){return this.remove(),this._map=g,g.getCanvasContainer().appendChild(this._element),g.on("move",this._update),g.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},_.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),u.remove(this._element),this._popup&&this._popup.remove(),this},_.prototype.getLngLat=function(){return this._lngLat},_.prototype.setLngLat=function(g){return this._lngLat=s.LngLat.convert(g),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},_.prototype.getElement=function(){return this._element},_.prototype.setPopup=function(g){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),g){if(!("offset"in g.options)){var b=Math.sqrt(Math.pow(13.5,2)/2);g.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=g,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},_.prototype._onKeyPress=function(g){var b=g.code,S=g.charCode||g.keyCode;b!=="Space"&&b!=="Enter"&&S!==32&&S!==13||this.togglePopup()},_.prototype._onMapClick=function(g){var b=g.originalEvent.target,S=this._element;this._popup&&(b===S||S.contains(b))&&this.togglePopup()},_.prototype.getPopup=function(){return this._popup},_.prototype.togglePopup=function(){var g=this._popup;return g?(g.isOpen()?g.remove():g.addTo(this._map),this):this},_.prototype._update=function(g){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=_d(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(b="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),g&&g.type!=="moveend"||(this._pos=this._pos.round()),u.setTransform(this._element,Nl[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+b)}},_.prototype.getOffset=function(){return this._offset},_.prototype.setOffset=function(g){return this._offset=s.Point.convert(g),this._update(),this},_.prototype._onMove=function(g){if(!this._isDragging){var b=this._clickTolerance||this._map._clickTolerance;this._isDragging=g.point.dist(this._pointerdownPos)>=b}this._isDragging&&(this._pos=g.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))},_.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"},_.prototype._addDragHandler=function(g){this._element.contains(g.originalEvent.target)&&(g.preventDefault(),this._positionDelta=g.point.sub(this._pos).add(this._offset),this._pointerdownPos=g.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},_.prototype.setDraggable=function(g){return this._draggable=!!g,this._map&&(g?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},_.prototype.isDraggable=function(){return this._draggable},_.prototype.setRotation=function(g){return this._rotation=g||0,this._update(),this},_.prototype.getRotation=function(){return this._rotation},_.prototype.setRotationAlignment=function(g){return this._rotationAlignment=g||"auto",this._update(),this},_.prototype.getRotationAlignment=function(){return this._rotationAlignment},_.prototype.setPitchAlignment=function(g){return this._pitchAlignment=g&&g!=="auto"?g:this._rotationAlignment,this._update(),this},_.prototype.getPitchAlignment=function(){return this._pitchAlignment},_})(s.Evented),A_={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},bd=0,ah=!1,S_=(function(p){function _(g){p.call(this),this.options=s.extend({},A_,g),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.onAdd=function(g){var b;return this._map=g,this._container=u.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),b=this._setupUI,vd!==void 0?b(vd):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then((function(S){b(vd=S.state!=="denied")})):b(vd=!!s.window.navigator.geolocation),this._container},_.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),u.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,bd=0,ah=!1},_.prototype._isOutOfMapMaxBounds=function(g){var b=this._map.getMaxBounds(),S=g.coords;return b&&(S.longitude<b.getWest()||S.longitude>b.getEast()||S.latitude<b.getSouth()||S.latitude>b.getNorth())},_.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},_.prototype._onSuccess=function(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",g)),this._finish()}},_.prototype._updateCamera=function(g){var b=new s.LngLat(g.coords.longitude,g.coords.latitude),S=g.coords.accuracy,L=this._map.getBearing(),F=s.extend({bearing:L},this.options.fitBoundsOptions);this._map.fitBounds(b.toBounds(S),F,{geolocateSource:!0})},_.prototype._updateMarker=function(g){if(g){var b=new s.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(b).addTo(this._map),this._userLocationDotMarker.setLngLat(b).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},_.prototype._updateCircleRadius=function(){var g=this._map._container.clientHeight/2,b=this._map.unproject([0,g]),S=this._map.unproject([1,g]),L=b.distanceTo(S),F=Math.ceil(2*this._accuracy/L);this._circleElement.style.width=F+"px",this._circleElement.style.height=F+"px"},_.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},_.prototype._onError=function(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&ah)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",g)),this._finish()}},_.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},_.prototype._setupUI=function(g){var b=this;if(this._container.addEventListener("contextmenu",(function(F){return F.preventDefault()})),this._geolocateButton=u.create("button","mapboxgl-ctrl-geolocate",this._container),u.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",g===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var L=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=L,this._geolocateButton.setAttribute("aria-label",L)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=u.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Jf(this._dotElement),this._circleElement=u.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(F){F.geolocateSource||b._watchState!=="ACTIVE_LOCK"||F.originalEvent&&F.originalEvent.type==="resize"||(b._watchState="BACKGROUND",b._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),b._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),b.fire(new s.Event("trackuserlocationend")))}))},_.prototype.trigger=function(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":bd--,ah=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++bd>1?(g={maximumAge:6e5,timeout:0},ah=!0):(g=this.options.positionOptions,ah=!1),this._geolocationWatchID=s.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else s.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},_.prototype._clearWatch=function(){s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},_})(s.Evented),ec={maxWidth:100,unit:"metric"},tc=function(p){this.options=s.extend({},ec,p),s.bindAll(["_onMove","setUnit"],this)};function Og(p,_,g){var b=g&&g.maxWidth||100,S=p._container.clientHeight/2,L=p.unproject([0,S]),F=p.unproject([b,S]),B=L.distanceTo(F);if(g&&g.unit==="imperial"){var J=3.2808*B;J>5280?nc(_,b,J/5280,p._getUIString("ScaleControl.Miles")):nc(_,b,J,p._getUIString("ScaleControl.Feet"))}else g&&g.unit==="nautical"?nc(_,b,B/1852,p._getUIString("ScaleControl.NauticalMiles")):B>=1e3?nc(_,b,B/1e3,p._getUIString("ScaleControl.Kilometers")):nc(_,b,B,p._getUIString("ScaleControl.Meters"))}function nc(p,_,g,b){var S,L,F,B=(S=g,(L=Math.pow(10,(""+Math.floor(S)).length-1))*(F=(F=S/L)>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:(function(J){var re=Math.pow(10,Math.ceil(-Math.log(J)/Math.LN10));return Math.round(J*re)/re})(F)));p.style.width=_*(B/g)+"px",p.innerHTML=B+"&nbsp;"+b}tc.prototype.getDefaultPosition=function(){return"bottom-left"},tc.prototype._onMove=function(){Og(this._map,this._container,this.options)},tc.prototype.onAdd=function(p){return this._map=p,this._container=u.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},tc.prototype.onRemove=function(){u.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},tc.prototype.setUnit=function(p){this.options.unit=p,Og(this._map,this._container,this.options)};var Pa=function(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof s.window.HTMLElement?this._container=p.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in s.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in s.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in s.window.document&&(this._fullscreenchange="MSFullscreenChange")};Pa.prototype.onAdd=function(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=u.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Pa.prototype.onRemove=function(){u.remove(this._controlContainer),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Pa.prototype._checkFullscreenSupport=function(){return!!(s.window.document.fullscreenEnabled||s.window.document.mozFullScreenEnabled||s.window.document.msFullscreenEnabled||s.window.document.webkitFullscreenEnabled)},Pa.prototype._setupUI=function(){var p=this._fullscreenButton=u.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);u.create("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden",!0),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Pa.prototype._updateTitle=function(){var p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p},Pa.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Pa.prototype._isFullscreen=function(){return this._fullscreen},Pa.prototype._changeIcon=function(){(s.window.document.fullscreenElement||s.window.document.mozFullScreenElement||s.window.document.webkitFullscreenElement||s.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Pa.prototype._onClickFullscreen=function(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.mozCancelFullScreen?s.window.document.mozCancelFullScreen():s.window.document.msExitFullscreen?s.window.document.msExitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var E_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),T_=(function(p){function _(g){p.call(this),this.options=s.extend(Object.create(E_),g),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.addTo=function(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this},_.prototype.isOpen=function(){return!!this._map},_.prototype.remove=function(){return this._content&&u.remove(this._content),this._container&&(u.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this},_.prototype.getLngLat=function(){return this._lngLat},_.prototype.setLngLat=function(g){return this._lngLat=s.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},_.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},_.prototype.getElement=function(){return this._container},_.prototype.setText=function(g){return this.setDOMContent(s.window.document.createTextNode(g))},_.prototype.setHTML=function(g){var b,S=s.window.document.createDocumentFragment(),L=s.window.document.createElement("body");for(L.innerHTML=g;b=L.firstChild;)S.appendChild(b);return this.setDOMContent(S)},_.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},_.prototype.setMaxWidth=function(g){return this.options.maxWidth=g,this._update(),this},_.prototype.setDOMContent=function(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=u.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this},_.prototype.addClassName=function(g){this._container&&this._container.classList.add(g)},_.prototype.removeClassName=function(g){this._container&&this._container.classList.remove(g)},_.prototype.setOffset=function(g){return this.options.offset=g,this._update(),this},_.prototype.toggleClassName=function(g){if(this._container)return this._container.classList.toggle(g)},_.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=u.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},_.prototype._onMouseUp=function(g){this._update(g.point)},_.prototype._onMouseMove=function(g){this._update(g.point)},_.prototype._onDrag=function(g){this._update(g.point)},_.prototype._update=function(g){var b=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=u.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=u.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(we){return b._container.classList.add(we)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_d(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||g)){var S=this._pos=this._trackPointer&&g?g:this._map.project(this._lngLat),L=this.options.anchor,F=(function we(Se){if(Se){if(typeof Se=="number"){var Be=Math.round(Math.sqrt(.5*Math.pow(Se,2)));return{center:new s.Point(0,0),top:new s.Point(0,Se),"top-left":new s.Point(Be,Be),"top-right":new s.Point(-Be,Be),bottom:new s.Point(0,-Se),"bottom-left":new s.Point(Be,-Be),"bottom-right":new s.Point(-Be,-Be),left:new s.Point(Se,0),right:new s.Point(-Se,0)}}if(Se instanceof s.Point||Array.isArray(Se)){var Ve=s.Point.convert(Se);return{center:Ve,top:Ve,"top-left":Ve,"top-right":Ve,bottom:Ve,"bottom-left":Ve,"bottom-right":Ve,left:Ve,right:Ve}}return{center:s.Point.convert(Se.center||[0,0]),top:s.Point.convert(Se.top||[0,0]),"top-left":s.Point.convert(Se["top-left"]||[0,0]),"top-right":s.Point.convert(Se["top-right"]||[0,0]),bottom:s.Point.convert(Se.bottom||[0,0]),"bottom-left":s.Point.convert(Se["bottom-left"]||[0,0]),"bottom-right":s.Point.convert(Se["bottom-right"]||[0,0]),left:s.Point.convert(Se.left||[0,0]),right:s.Point.convert(Se.right||[0,0])}}return we(new s.Point(0,0))})(this.options.offset);if(!L){var B,J=this._container.offsetWidth,re=this._container.offsetHeight;B=S.y+F.bottom.y<re?["top"]:S.y>this._map.transform.height-re?["bottom"]:[],S.x<J/2?B.push("left"):S.x>this._map.transform.width-J/2&&B.push("right"),L=B.length===0?"bottom":B.join("-")}var Ce=S.add(F[L]).round();u.setTransform(this._container,Nl[L]+" translate("+Ce.x+"px,"+Ce.y+"px)"),Fg(this._container,L,"popup")}},_.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var g=this._container.querySelector(qf);g&&g.focus()}},_.prototype._onClose=function(){this.remove()},_})(s.Evented),Ng={version:s.version,supported:l,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:m1,NavigationControl:lu,GeolocateControl:S_,AttributionControl:go,ScaleControl:tc,FullscreenControl:Pa,Popup:T_,Marker:Jf,Style:Zo,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,config:s.config,prewarm:function(){pt().acquire(dt)},clearPrewarmedResources:function(){var p=qt;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(dt),qt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(p){s.config.ACCESS_TOKEN=p},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(p){s.config.API_URL=p},get workerCount(){return Tt.workerCount},set workerCount(p){Tt.workerCount=p},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){s.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage:function(p){s.clearTileCache(p)},workerUrl:""};return Ng})),r}))})(fI)),fI.exports}var Lj=kj();const gF=y4(Lj);class SM extends pg{constructor(e){const t=Object.assign({},e);delete t.accessToken,delete t.style,delete t.container,delete t.xyz,super(t),this.set("xyz",e.maplibreOptions.xyz),this.set("xyz_custom",e.maplibreOptions.xyz_custom),this.xyz_=e.xyz,e.accessToken&&(gF.accessToken=e.accessToken),this.map_=new gF.Map({container:e.maplibreOptions.container,style:e.maplibreOptions.style,attributionControl:!1,interactive:!1}),this.maplibreMap=this.map_}getMapBoxMap(){return this.map_}getMapLibreMap(){return this.map_}render(e){const t=this.map_.getCanvas(),i=e.viewState;t.style.position="absolute";const r=this.getVisible();t.style.display=r?"block":"none";const o=this.getOpacity().toString();o!==t.style.opacity&&(t.style.opacity=o);const s=i.rotation;return s&&this.map_.rotateTo(jh(-s),{animate:!1}),this.map_.jumpTo({center:bc(i.center),zoom:i.zoom-1,animate:!1}),this.map_._frame&&(this.map_._frame.cancel(),this.map_._frame=null),this.map_._render(),t}setLayerVisibility(e,t){this.map_.setLayoutProperty(e,"visibility",t?"visible":"none")}getStyle(){return this.map_.getStyle()}getXYZ(){return this.get("xyz")}}function _4(n,e,t){t(n,e)&&n instanceof Sf&&n.getLayers().forEach(r=>{_4(r,[...e,n],t)})}const v4=parseInt("19",10),Pj=parseInt("8",10);var EM=(n=>(n.ON_LAYER_TYPE="ON_LAYER_TYPE",n))(EM||{});const Wp="EPSG:3857",Sl="EPSG:4326",Ml="EPSG:2169",Gj=JSON.parse("[2.6, 47.7, 8.6, 51]"),Fj=parseInt("8",10);let sS;const oS=mi();function Kn(){function n(){return sS}function e(){return!!oS.value}function t(){return oS.value=sS=new Tj({view:new yc({center:[682439,6379152],constrainResolution:!0,enableRotation:!0,extent:gb(Gj,"EPSG:4326","EPSG:3857"),multiWorld:!1,zoom:Fj}),controls:[],keyboardEventTarget:document}),sS}function i(x,C){return x.id===C.id}function r(x,C){return x===C}function o(x,C){return x.layers?.some(w=>i(w,C))}function s(x,C){const w=x?.layers?.find(E=>i(E,C));return!r(w,C)}function l(x,C){return!(C===null||!("layers"in x)||!("layers"in C)||typeof C.layers>"u"||typeof x.layers>"u"||x.layers===C.layers)}function u(x,C){return!("layers"in x)||typeof x.layers>"u"?[]:C===null||!("layers"in C)?x.layers.map((w,E)=>({layer:w,position:E})):x.layers===C.layers?[]:x.layers.reduce((w,E,T)=>o(C,E)?w:[...w,{layer:E,position:T}],[])}function h(x,C){return l(x,C)?C.layers.reduce((w,E)=>o(x,E)?w:[...w,E],[]):[]}function d(x,C){return l(x,C)?x.layers.reduce((w,E)=>s(C,E)?[...w,E]:w,[]):[]}function m(x,C,w){const E=C.layers?.find(k=>k.id===x),T=w?.layers?.find(k=>k.id===x);return E?.type!==T?.type?EM.ON_LAYER_TYPE:null}function y(){const x=Kn().getOlMap();x.updateSize(),_4(x.getLayerGroup(),[],C=>(C instanceof SM&&C.getMapLibreMap().resize(),!0))}return{olMap:oS,getOlMap:n,hasOlMap:e,createMap:t,equalsLayer:i,hasLayer:o,layerHasChanged:s,contextHasChanged:l,getAddedLayers:u,getRemovedLayers:h,getMutatedLayers:d,getMutationType:m,resize:y}}function TM(n,e="fr-FR"){return n?new Intl.DateTimeFormat(e,{dateStyle:"short",timeStyle:"short"}).format(new Date(n)):""}function Oj(n,e,t){if(n==null||isNaN(n))return Wn.t("N/A",{ns:"client"});switch(t){case"elevation":return RM(n,e);case"area":return sT(n,e);case"length":default:return af(n,e)}}function RM(n,e=0){return isNaN(+n)?n:`${(+n).toFixed(e)} m`}function af(n,e=2){return n===null?Wn.t("N/A",{ns:"client"}):n<1e3?`${n.toFixed(e)} m`:n>=1e3?`${(n/1e3).toFixed(e)} km`:""}function sT(n,e=2){return n===null?Wn.t("N/A",{ns:"client"}):n<1e6?`${n.toFixed(e)} m`:n>=1e6?`${(n/1e6).toFixed(e)} km`:""}function mF(n){return n===void 0?Wn.t("N/A",{ns:"client"}):`${n.number}, ${n.street}, ${n.postal_code} ${n.locality}`}function Nj(n,e,t){const i=t.split(":")[2];let r=t,o;i!==void 0?r=t.slice(0,t.lastIndexOf(":")):t.endsWith("*")&&(o=bc(n,e)[0]<=6?"UTM31N":"UTM32N",r=t.replace("3*",o.slice(3,5)));const s=Ir(n,e,r),l=r===Sl,u=s.map((d,m)=>(l?Dj(d):d)<0?"WS"[m]:"EN"[m]),h=s.map(d=>l?Vj(d,i):Math.abs(Math.round(d)).toString());return o!==void 0?`${h.join(" | ")}  (${o})`:h.map((d,m)=>`${d} ${u[m]}`).join(" | ")}function Dj(n){return(n+180)%360-180}function Vj(n,e){const t=(n+180)%360-180,i=Math.abs(t);if(e===void 0)return Math.round(i*1e6)/1e6;const r=Math.floor(i),o=i%1*60;if(e==="DMm"){const s=Math.round(o*1e6)/1e6;return`${r} ${s}`}if(e==="DMS"){const s=Math.floor(o),l=Math.round(o%1*600)/10;return`${r} ${s} ${l}`}return"N/A"}const Bj={install(n){n.directive("format-measure",Zj)}};function Zj(n,e){let t,i=e.value;const r=e?.arg!==void 0?+e?.arg:void 0;try{t=Object.keys(e.modifiers)[0]}catch{}i=Oj(i,r,t),n.textContent=i}function Wj(n){const e=Object.keys(n.defs),t=e.length;let i,r;for(i=0;i<t;++i){const o=e[i];if(!cI(o)){const s=n.defs(o);let l=s.units;!l&&s.projName==="longlat"&&(l="degrees"),aC(new Uw({code:o,axisOrientation:s.axis,metersPerUnit:s.to_meter,units:l}))}}for(i=0;i<t;++i){const o=e[i],s=cI(o);for(r=0;r<t;++r){const l=e[r],u=cI(l);if(!hI(o,l))if(n.defs[o]===n.defs[l])YE([s,u]);else{const h=n(o,l);BY(s,u,ZG(s,u,h.forward),ZG(u,s,h.inverse))}}}}function zj(n){n("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),n("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),n("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var e=1;e<=60;++e)n("EPSG:"+(32600+e),"+proj=utm +zone="+e+" +datum=WGS84 +units=m"),n("EPSG:"+(32700+e),"+proj=utm +zone="+e+" +south +datum=WGS84 +units=m");n("EPSG:5041","+title=WGS 84 / UPS North (E,N) +proj=stere +lat_0=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),n("EPSG:5042","+title=WGS 84 / UPS South (E,N) +proj=stere +lat_0=-90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),n.WGS84=n["EPSG:4326"],n["EPSG:3785"]=n["EPSG:3857"],n.GOOGLE=n["EPSG:3857"],n["EPSG:900913"]=n["EPSG:3857"],n["EPSG:102113"]=n["EPSG:3857"]}var tg=1,ng=2,uy=3,Uj=4,oT=5,yF=6378137,Xj=6356752314e-3,_F=.0066943799901413165,nv=484813681109536e-20,Zt=Math.PI/2,Yj=.16666666666666666,Hj=.04722222222222222,Kj=.022156084656084655,sn=1e-10,Ss=.017453292519943295,$a=57.29577951308232,vr=Math.PI/4,zv=Math.PI*2,Bs=3.14159265359,nl={};nl.greenwich=0;nl.lisbon=-9.131906111111;nl.paris=2.337229166667;nl.bogota=-74.080916666667;nl.madrid=-3.687938888889;nl.rome=12.452333333333;nl.bern=7.439583333333;nl.jakarta=106.807719444444;nl.ferro=-17.666666666667;nl.brussels=4.367975;nl.stockholm=18.058277777778;nl.athens=23.7163375;nl.oslo=10.722916666667;const jj={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var vF=/[\s_\-\/\(\)]/g;function mf(n,e){if(n[e])return n[e];for(var t=Object.keys(n),i=e.toLowerCase().replace(vF,""),r=-1,o,s;++r<t.length;)if(o=t[r],s=o.toLowerCase().replace(vF,""),s===i)return n[o]}function aT(n){var e={},t=n.split("+").map(function(l){return l.trim()}).filter(function(l){return l}).reduce(function(l,u){var h=u.split("=");return h.push(!0),l[h[0].toLowerCase()]=h[1],l},{}),i,r,o,s={proj:"projName",datum:"datumCode",rf:function(l){e.rf=parseFloat(l)},lat_0:function(l){e.lat0=l*Ss},lat_1:function(l){e.lat1=l*Ss},lat_2:function(l){e.lat2=l*Ss},lat_ts:function(l){e.lat_ts=l*Ss},lon_0:function(l){e.long0=l*Ss},lon_1:function(l){e.long1=l*Ss},lon_2:function(l){e.long2=l*Ss},alpha:function(l){e.alpha=parseFloat(l)*Ss},gamma:function(l){e.rectified_grid_angle=parseFloat(l)*Ss},lonc:function(l){e.longc=l*Ss},x_0:function(l){e.x0=parseFloat(l)},y_0:function(l){e.y0=parseFloat(l)},k_0:function(l){e.k0=parseFloat(l)},k:function(l){e.k0=parseFloat(l)},a:function(l){e.a=parseFloat(l)},b:function(l){e.b=parseFloat(l)},r:function(l){e.a=e.b=parseFloat(l)},r_a:function(){e.R_A=!0},zone:function(l){e.zone=parseInt(l,10)},south:function(){e.utmSouth=!0},towgs84:function(l){e.datum_params=l.split(",").map(function(u){return parseFloat(u)})},to_meter:function(l){e.to_meter=parseFloat(l)},units:function(l){e.units=l;var u=mf(jj,l);u&&(e.to_meter=u.to_meter)},from_greenwich:function(l){e.from_greenwich=l*Ss},pm:function(l){var u=mf(nl,l);e.from_greenwich=(u||parseFloat(l))*Ss},nadgrids:function(l){l==="@null"?e.datumCode="none":e.nadgrids=l},axis:function(l){var u="ewnsud";l.length===3&&u.indexOf(l.substr(0,1))!==-1&&u.indexOf(l.substr(1,1))!==-1&&u.indexOf(l.substr(2,1))!==-1&&(e.axis=l)},approx:function(){e.approx=!0},over:function(){e.over=!0}};for(i in t)r=t[i],i in s?(o=s[i],typeof o=="function"?o(r):e[o]=r):e[i]=r;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e.projStr=n,e}class b4{static getId(e){const t=e.find(i=>Array.isArray(i)&&i[0]==="ID");return t&&t.length>=3?{authority:t[1],code:parseInt(t[2],10)}:null}static convertUnit(e,t="unit"){if(!e||e.length<3)return{type:t,name:"unknown",conversion_factor:null};const i=e[1],r=parseFloat(e[2])||null,o=e.find(l=>Array.isArray(l)&&l[0]==="ID"),s=o?{authority:o[1],code:parseInt(o[2],10)}:null;return{type:t,name:i,conversion_factor:r,id:s}}static convertAxis(e){const t=e[1]||"Unknown";let i;const r=t.match(/^\((.)\)$/);if(r){const h=r[1].toUpperCase();if(h==="E")i="east";else if(h==="N")i="north";else if(h==="U")i="up";else throw new Error(`Unknown axis abbreviation: ${h}`)}else i=e[2]?e[2].toLowerCase():"unknown";const o=e.find(h=>Array.isArray(h)&&h[0]==="ORDER"),s=o?parseInt(o[1],10):null,l=e.find(h=>Array.isArray(h)&&(h[0]==="LENGTHUNIT"||h[0]==="ANGLEUNIT"||h[0]==="SCALEUNIT")),u=this.convertUnit(l);return{name:t,direction:i,unit:u,order:s}}static extractAxes(e){return e.filter(t=>Array.isArray(t)&&t[0]==="AXIS").map(t=>this.convertAxis(t)).sort((t,i)=>(t.order||0)-(i.order||0))}static convert(e,t={}){switch(e[0]){case"PROJCRS":t.type="ProjectedCRS",t.name=e[1],t.base_crs=e.find(y=>Array.isArray(y)&&y[0]==="BASEGEOGCRS")?this.convert(e.find(y=>Array.isArray(y)&&y[0]==="BASEGEOGCRS")):null,t.conversion=e.find(y=>Array.isArray(y)&&y[0]==="CONVERSION")?this.convert(e.find(y=>Array.isArray(y)&&y[0]==="CONVERSION")):null;const i=e.find(y=>Array.isArray(y)&&y[0]==="CS");i&&(t.coordinate_system={type:i[1],axis:this.extractAxes(e)});const r=e.find(y=>Array.isArray(y)&&y[0]==="LENGTHUNIT");if(r){const y=this.convertUnit(r);t.coordinate_system.unit=y}t.id=this.getId(e);break;case"BASEGEOGCRS":case"GEOGCRS":t.type="GeographicCRS",t.name=e[1];const o=e.find(y=>Array.isArray(y)&&(y[0]==="DATUM"||y[0]==="ENSEMBLE"));if(o){const y=this.convert(o);o[0]==="ENSEMBLE"?t.datum_ensemble=y:t.datum=y;const x=e.find(C=>Array.isArray(C)&&C[0]==="PRIMEM");x&&x[1]!=="Greenwich"&&(y.prime_meridian={name:x[1],longitude:parseFloat(x[2])})}t.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(e)},t.id=this.getId(e);break;case"DATUM":t.type="GeodeticReferenceFrame",t.name=e[1],t.ellipsoid=e.find(y=>Array.isArray(y)&&y[0]==="ELLIPSOID")?this.convert(e.find(y=>Array.isArray(y)&&y[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":t.type="DatumEnsemble",t.name=e[1],t.members=e.filter(y=>Array.isArray(y)&&y[0]==="MEMBER").map(y=>({type:"DatumEnsembleMember",name:y[1],id:this.getId(y)}));const s=e.find(y=>Array.isArray(y)&&y[0]==="ENSEMBLEACCURACY");s&&(t.accuracy=parseFloat(s[1]));const l=e.find(y=>Array.isArray(y)&&y[0]==="ELLIPSOID");l&&(t.ellipsoid=this.convert(l)),t.id=this.getId(e);break;case"ELLIPSOID":t.type="Ellipsoid",t.name=e[1],t.semi_major_axis=parseFloat(e[2]),t.inverse_flattening=parseFloat(e[3]),e.find(y=>Array.isArray(y)&&y[0]==="LENGTHUNIT")&&this.convert(e.find(y=>Array.isArray(y)&&y[0]==="LENGTHUNIT"),t);break;case"CONVERSION":t.type="Conversion",t.name=e[1],t.method=e.find(y=>Array.isArray(y)&&y[0]==="METHOD")?this.convert(e.find(y=>Array.isArray(y)&&y[0]==="METHOD")):null,t.parameters=e.filter(y=>Array.isArray(y)&&y[0]==="PARAMETER").map(y=>this.convert(y));break;case"METHOD":t.type="Method",t.name=e[1],t.id=this.getId(e);break;case"PARAMETER":t.type="Parameter",t.name=e[1],t.value=parseFloat(e[2]),t.unit=this.convertUnit(e.find(y=>Array.isArray(y)&&(y[0]==="LENGTHUNIT"||y[0]==="ANGLEUNIT"||y[0]==="SCALEUNIT"))),t.id=this.getId(e);break;case"BOUNDCRS":t.type="BoundCRS";const u=e.find(y=>Array.isArray(y)&&y[0]==="SOURCECRS");if(u){const y=u.find(x=>Array.isArray(x));t.source_crs=y?this.convert(y):null}const h=e.find(y=>Array.isArray(y)&&y[0]==="TARGETCRS");if(h){const y=h.find(x=>Array.isArray(x));t.target_crs=y?this.convert(y):null}const d=e.find(y=>Array.isArray(y)&&y[0]==="ABRIDGEDTRANSFORMATION");d?t.transformation=this.convert(d):t.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(t.type="Transformation",t.name=e[1],t.method=e.find(y=>Array.isArray(y)&&y[0]==="METHOD")?this.convert(e.find(y=>Array.isArray(y)&&y[0]==="METHOD")):null,t.parameters=e.filter(y=>Array.isArray(y)&&(y[0]==="PARAMETER"||y[0]==="PARAMETERFILE")).map(y=>{if(y[0]==="PARAMETER")return this.convert(y);if(y[0]==="PARAMETERFILE")return{name:y[1],value:y[2],id:{authority:"EPSG",code:8656}}}),t.parameters.length===7){const y=t.parameters[6];y.name==="Scale difference"&&(y.value=Math.round((y.value-1)*1e12)/1e6)}t.id=this.getId(e);break;case"AXIS":t.coordinate_system||(t.coordinate_system={type:"unspecified",axis:[]}),t.coordinate_system.axis.push(this.convertAxis(e));break;case"LENGTHUNIT":const m=this.convertUnit(e,"LinearUnit");t.coordinate_system&&t.coordinate_system.axis&&t.coordinate_system.axis.forEach(y=>{y.unit||(y.unit=m)}),m.conversion_factor&&m.conversion_factor!==1&&t.semi_major_axis&&(t.semi_major_axis={value:t.semi_major_axis,unit:m});break;default:t.keyword=e[0];break}return t}}class $j extends b4{static convert(e,t={}){return super.convert(e,t),t.coordinate_system&&t.coordinate_system.subtype==="Cartesian"&&delete t.coordinate_system,t.usage&&delete t.usage,t}}class Jj extends b4{static convert(e,t={}){super.convert(e,t);const i=e.find(o=>Array.isArray(o)&&o[0]==="CS");i&&(t.coordinate_system={subtype:i[1],axis:this.extractAxes(e)});const r=e.find(o=>Array.isArray(o)&&o[0]==="USAGE");if(r){const o=r.find(u=>Array.isArray(u)&&u[0]==="SCOPE"),s=r.find(u=>Array.isArray(u)&&u[0]==="AREA"),l=r.find(u=>Array.isArray(u)&&u[0]==="BBOX");t.usage={},o&&(t.usage.scope=o[1]),s&&(t.usage.area=s[1]),l&&(t.usage.bbox=l.slice(1))}return t}}function qj(n){return n.find(e=>Array.isArray(e)&&e[0]==="USAGE")?"2019":(n.find(e=>Array.isArray(e)&&e[0]==="CS")||n[0]==="BOUNDCRS"||n[0]==="PROJCRS"||n[0]==="GEOGCRS","2015")}function Qj(n){return(qj(n)==="2019"?Jj:$j).convert(n)}function e7(n){const e=n.toUpperCase();return e.includes("PROJCRS")||e.includes("GEOGCRS")||e.includes("BOUNDCRS")||e.includes("VERTCRS")||e.includes("LENGTHUNIT")||e.includes("ANGLEUNIT")||e.includes("SCALEUNIT")?"WKT2":(e.includes("PROJCS")||e.includes("GEOGCS")||e.includes("LOCAL_CS")||e.includes("VERT_CS")||e.includes("UNIT"),"WKT1")}var Uv=1,x4=2,I4=3,xC=4,C4=5,MM=-1,t7=/\s/,n7=/[A-Za-z]/,i7=/[A-Za-z84_]/,iA=/[,\]]/,w4=/[\d\.E\-\+]/;function od(n){if(typeof n!="string")throw new Error("not a string");this.text=n.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Uv}od.prototype.readCharicter=function(){var n=this.text[this.place++];if(this.state!==xC)for(;t7.test(n);){if(this.place>=this.text.length)return;n=this.text[this.place++]}switch(this.state){case Uv:return this.neutral(n);case x4:return this.keyword(n);case xC:return this.quoted(n);case C4:return this.afterquote(n);case I4:return this.number(n);case MM:return}};od.prototype.afterquote=function(n){if(n==='"'){this.word+='"',this.state=xC;return}if(iA.test(n)){this.word=this.word.trim(),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in afterquote yet, index '+this.place)};od.prototype.afterItem=function(n){if(n===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Uv;return}if(n==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Uv,this.currentObject=this.stack.pop(),this.currentObject||(this.state=MM);return}};od.prototype.number=function(n){if(w4.test(n)){this.word+=n;return}if(iA.test(n)){this.word=parseFloat(this.word),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in number yet, index '+this.place)};od.prototype.quoted=function(n){if(n==='"'){this.state=C4;return}this.word+=n};od.prototype.keyword=function(n){if(i7.test(n)){this.word+=n;return}if(n==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=Uv;return}if(iA.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in keyword yet, index '+this.place)};od.prototype.neutral=function(n){if(n7.test(n)){this.word=n,this.state=x4;return}if(n==='"'){this.word="",this.state=xC;return}if(w4.test(n)){this.word=n,this.state=I4;return}if(iA.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in neutral yet, index '+this.place)};od.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===MM)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function r7(n){var e=new od(n);return e.output()}function aS(n,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var i=e?{}:n,r=t.reduce(function(o,s){return Wm(s,o),o},i);e&&(n[e]=r)}function Wm(n,e){if(!Array.isArray(n)){e[n]=!0;return}var t=n.shift();if(t==="PARAMETER"&&(t=n.shift()),n.length===1){if(Array.isArray(n[0])){e[t]={},Wm(n[0],e[t]);return}e[t]=n[0];return}if(!n.length){e[t]=!0;return}if(t==="TOWGS84"){e[t]=n;return}if(t==="AXIS"){t in e||(e[t]=[]),e[t].push(n);return}Array.isArray(t)||(e[t]={});var i;switch(t){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[t]={name:n[0].toLowerCase(),convert:n[1]},n.length===3&&Wm(n[2],e[t]);return;case"SPHEROID":case"ELLIPSOID":e[t]={name:n[0],a:n[1],rf:n[2]},n.length===4&&Wm(n[3],e[t]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":n[0]=["name",n[0]],aS(e,t,n);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":n[0]=["name",n[0]],aS(e,t,n),e[t].type=t;return;default:for(i=-1;++i<n.length;)if(!Array.isArray(n[i]))return Wm(n,e[t]);return aS(e,t,n)}}var s7=.017453292519943295;function _u(n){return n*s7}function A4(n){const e=(n.projName||"").toLowerCase().replace(/_/g," ");!n.long0&&n.longc&&(e==="albers conic equal area"||e==="lambert azimuthal equal area")&&(n.long0=n.longc),!n.lat_ts&&n.lat1&&(e==="stereographic south pole"||e==="polar stereographic (variant b)")?(n.lat0=_u(n.lat1>0?90:-90),n.lat_ts=n.lat1,delete n.lat1):!n.lat_ts&&n.lat0&&(e==="polar stereographic"||e==="polar stereographic (variant a)")&&(n.lat_ts=n.lat0,n.lat0=_u(n.lat0>0?90:-90),delete n.lat1)}function bF(n){let e={units:null,to_meter:void 0};return typeof n=="string"?(e.units=n.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.units==="meter"&&(e.to_meter=1)):n&&n.name&&(e.units=n.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.to_meter=n.conversion_factor),e}function xF(n){return typeof n=="object"?n.value*n.unit.conversion_factor:n}function IF(n,e){n.ellipsoid.radius?(e.a=n.ellipsoid.radius,e.rf=0):(e.a=xF(n.ellipsoid.semi_major_axis),n.ellipsoid.inverse_flattening!==void 0?e.rf=n.ellipsoid.inverse_flattening:n.ellipsoid.semi_major_axis!==void 0&&n.ellipsoid.semi_minor_axis!==void 0&&(e.rf=e.a/(e.a-xF(n.ellipsoid.semi_minor_axis))))}function IC(n,e={}){return!n||typeof n!="object"?n:n.type==="BoundCRS"?(IC(n.source_crs,e),n.transformation&&(n.transformation.method&&n.transformation.method.name==="NTv2"?e.nadgrids=n.transformation.parameters[0].value:e.datum_params=n.transformation.parameters.map(t=>t.value)),e):(Object.keys(n).forEach(t=>{const i=n[t];if(i!==null)switch(t){case"name":if(e.srsCode)break;e.name=i,e.srsCode=i;break;case"type":i==="GeographicCRS"?e.projName="longlat":i==="ProjectedCRS"&&n.conversion&&n.conversion.method&&(e.projName=n.conversion.method.name);break;case"datum":case"datum_ensemble":i.ellipsoid&&(e.ellps=i.ellipsoid.name,IF(i,e)),i.prime_meridian&&(e.from_greenwich=i.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":e.ellps=i.name,IF(i,e);break;case"prime_meridian":e.long0=(i.longitude||0)*Math.PI/180;break;case"coordinate_system":if(i.axis){if(e.axis=i.axis.map(r=>{const o=r.direction;if(o==="east")return"e";if(o==="north")return"n";if(o==="west")return"w";if(o==="south")return"s";throw new Error(`Unknown axis direction: ${o}`)}).join("")+"u",i.unit){const{units:r,to_meter:o}=bF(i.unit);e.units=r,e.to_meter=o}else if(i.axis[0]&&i.axis[0].unit){const{units:r,to_meter:o}=bF(i.axis[0].unit);e.units=r,e.to_meter=o}}break;case"id":i.authority&&i.code&&(e.title=i.authority+":"+i.code);break;case"conversion":i.method&&i.method.name&&(e.projName=i.method.name),i.parameters&&i.parameters.forEach(r=>{const o=r.name.toLowerCase().replace(/\s+/g,"_"),s=r.value;r.unit&&r.unit.conversion_factor?e[o]=s*r.unit.conversion_factor:r.unit==="degree"?e[o]=s*Math.PI/180:e[o]=s});break;case"unit":i.name&&(e.units=i.name.toLowerCase(),e.units==="metre"&&(e.units="meter")),i.conversion_factor&&(e.to_meter=i.conversion_factor);break;case"base_crs":IC(i,e),e.datumCode=i.id?i.id.authority+"_"+i.id.code:i.name;break}}),e.latitude_of_false_origin!==void 0&&(e.lat0=e.latitude_of_false_origin),e.longitude_of_false_origin!==void 0&&(e.long0=e.longitude_of_false_origin),e.latitude_of_standard_parallel!==void 0&&(e.lat0=e.latitude_of_standard_parallel,e.lat1=e.latitude_of_standard_parallel),e.latitude_of_1st_standard_parallel!==void 0&&(e.lat1=e.latitude_of_1st_standard_parallel),e.latitude_of_2nd_standard_parallel!==void 0&&(e.lat2=e.latitude_of_2nd_standard_parallel),e.latitude_of_projection_centre!==void 0&&(e.lat0=e.latitude_of_projection_centre),e.longitude_of_projection_centre!==void 0&&(e.longc=e.longitude_of_projection_centre),e.easting_at_false_origin!==void 0&&(e.x0=e.easting_at_false_origin),e.northing_at_false_origin!==void 0&&(e.y0=e.northing_at_false_origin),e.latitude_of_natural_origin!==void 0&&(e.lat0=e.latitude_of_natural_origin),e.longitude_of_natural_origin!==void 0&&(e.long0=e.longitude_of_natural_origin),e.longitude_of_origin!==void 0&&(e.long0=e.longitude_of_origin),e.false_easting!==void 0&&(e.x0=e.false_easting),e.easting_at_projection_centre&&(e.x0=e.easting_at_projection_centre),e.false_northing!==void 0&&(e.y0=e.false_northing),e.northing_at_projection_centre&&(e.y0=e.northing_at_projection_centre),e.standard_parallel_1!==void 0&&(e.lat1=e.standard_parallel_1),e.standard_parallel_2!==void 0&&(e.lat2=e.standard_parallel_2),e.scale_factor_at_natural_origin!==void 0&&(e.k0=e.scale_factor_at_natural_origin),e.scale_factor_at_projection_centre!==void 0&&(e.k0=e.scale_factor_at_projection_centre),e.scale_factor_on_pseudo_standard_parallel!==void 0&&(e.k0=e.scale_factor_on_pseudo_standard_parallel),e.azimuth!==void 0&&(e.alpha=e.azimuth),e.azimuth_at_projection_centre!==void 0&&(e.alpha=e.azimuth_at_projection_centre),e.angle_from_rectified_to_skew_grid&&(e.rectified_grid_angle=e.angle_from_rectified_to_skew_grid),A4(e),e)}var o7=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function a7(n,e){var t=e[0],i=e[1];!(t in n)&&i in n&&(n[t]=n[i],e.length===3&&(n[t]=e[2](n[t])))}function S4(n){for(var e=Object.keys(n),t=0,i=e.length;t<i;++t){var r=e[t];o7.indexOf(r)!==-1&&l7(n[r]),typeof n[r]=="object"&&S4(n[r])}}function l7(n){if(n.AUTHORITY){var e=Object.keys(n.AUTHORITY)[0];e&&e in n.AUTHORITY&&(n.title=e+":"+n.AUTHORITY[e])}if(n.type==="GEOGCS"?n.projName="longlat":n.type==="LOCAL_CS"?(n.projName="identity",n.local=!0):typeof n.PROJECTION=="object"?n.projName=Object.keys(n.PROJECTION)[0]:n.projName=n.PROJECTION,n.AXIS){for(var t="",i=0,r=n.AXIS.length;i<r;++i){var o=[n.AXIS[i][0].toLowerCase(),n.AXIS[i][1].toLowerCase()];o[0].indexOf("north")!==-1||(o[0]==="y"||o[0]==="lat")&&o[1]==="north"?t+="n":o[0].indexOf("south")!==-1||(o[0]==="y"||o[0]==="lat")&&o[1]==="south"?t+="s":o[0].indexOf("east")!==-1||(o[0]==="x"||o[0]==="lon")&&o[1]==="east"?t+="e":(o[0].indexOf("west")!==-1||(o[0]==="x"||o[0]==="lon")&&o[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(n.axis=t)}n.UNIT&&(n.units=n.UNIT.name.toLowerCase(),n.units==="metre"&&(n.units="meter"),n.UNIT.convert&&(n.type==="GEOGCS"?n.DATUM&&n.DATUM.SPHEROID&&(n.to_meter=n.UNIT.convert*n.DATUM.SPHEROID.a):n.to_meter=n.UNIT.convert));var s=n.GEOGCS;n.type==="GEOGCS"&&(s=n),s&&(s.DATUM?n.datumCode=s.DATUM.name.toLowerCase():n.datumCode=s.name.toLowerCase(),n.datumCode.slice(0,2)==="d_"&&(n.datumCode=n.datumCode.slice(2)),n.datumCode==="new_zealand_1949"&&(n.datumCode="nzgd49"),(n.datumCode==="wgs_1984"||n.datumCode==="world_geodetic_system_1984")&&(n.PROJECTION==="Mercator_Auxiliary_Sphere"&&(n.sphere=!0),n.datumCode="wgs84"),n.datumCode==="belge_1972"&&(n.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(n.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),n.ellps.toLowerCase().slice(0,13)==="international"&&(n.ellps="intl"),n.a=s.DATUM.SPHEROID.a,n.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(n.datum_params=s.DATUM.TOWGS84),~n.datumCode.indexOf("osgb_1936")&&(n.datumCode="osgb36"),~n.datumCode.indexOf("osni_1952")&&(n.datumCode="osni52"),(~n.datumCode.indexOf("tm65")||~n.datumCode.indexOf("geodetic_datum_of_1965"))&&(n.datumCode="ire65"),n.datumCode==="ch1903+"&&(n.datumCode="ch1903"),~n.datumCode.indexOf("israel")&&(n.datumCode="isr93")),n.b&&!isFinite(n.b)&&(n.b=n.a),n.rectified_grid_angle&&(n.rectified_grid_angle=_u(n.rectified_grid_angle));function l(d){var m=n.to_meter||1;return d*m}var u=function(d){return a7(n,d)},h=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",_u],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",_u],["x0","false_easting",l],["y0","false_northing",l],["long0","central_meridian",_u],["lat0","latitude_of_origin",_u],["lat0","standard_parallel_1",_u],["lat1","standard_parallel_1",_u],["lat2","standard_parallel_2",_u],["azimuth","Azimuth"],["alpha","azimuth",_u],["srsCode","name"]];h.forEach(u),A4(n)}function CC(n){if(typeof n=="object")return IC(n);const e=e7(n);var t=r7(n);if(e==="WKT2"){const o=Qj(t);return IC(o)}var i=t[0],r={};return Wm(t,r),S4(r),r[i]}function Po(n){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?Po[n]=aT(arguments[1]):Po[n]=CC(arguments[1]):t&&typeof t=="object"&&!("projName"in t)?Po[n]=CC(arguments[1]):(Po[n]=t,t||delete Po[n])}else if(arguments.length===1){if(Array.isArray(n))return n.map(function(i){return Array.isArray(i)?Po.apply(e,i):Po(i)});if(typeof n=="string"){if(n in Po)return Po[n]}else"EPSG"in n?Po["EPSG:"+n.EPSG]=n:"ESRI"in n?Po["ESRI:"+n.ESRI]=n:"IAU2000"in n?Po["IAU2000:"+n.IAU2000]=n:console.log(n);return}}zj(Po);function u7(n){return typeof n=="string"}function c7(n){return n in Po}function h7(n){return n.indexOf("+")!==0&&n.indexOf("[")!==-1||typeof n=="object"&&!("srsCode"in n)}var d7=["3857","900913","3785","102113"];function f7(n){var e=mf(n,"authority");if(e){var t=mf(e,"epsg");return t&&d7.indexOf(t)>-1}}function p7(n){var e=mf(n,"extension");if(e)return mf(e,"proj4")}function g7(n){return n[0]==="+"}function m7(n){if(u7(n)){if(c7(n))return Po[n];if(h7(n)){var e=CC(n);if(f7(e))return Po["EPSG:3857"];var t=p7(e);return t?aT(t):e}if(g7(n))return aT(n)}else return"projName"in n?n:CC(n)}function CF(n,e){n=n||{};var t,i;if(!e)return n;for(i in e)t=e[i],t!==void 0&&(n[i]=t);return n}function Fc(n,e,t){var i=n*e;return t/Math.sqrt(1-i*i)}function xb(n){return n<0?-1:1}function dn(n,e){return e||Math.abs(n)<=Bs?n:n-xb(n)*zv}function Ru(n,e,t){var i=n*t,r=.5*n;return i=Math.pow((1-i)/(1+i),r),Math.tan(.5*(Zt-e))/i}function Xv(n,e){for(var t=.5*n,i,r,o=Zt-2*Math.atan(e),s=0;s<=15;s++)if(i=n*Math.sin(o),r=Zt-2*Math.atan(e*Math.pow((1-i)/(1+i),t))-o,o+=r,Math.abs(r)<=1e-10)return o;return-9999}function y7(){var n=this.b/this.a;this.es=1-n*n,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Fc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function _7(n){var e=n.x,t=n.y;if(t*$a>90&&t*$a<-90&&e*$a>180&&e*$a<-180)return null;var i,r;if(Math.abs(Math.abs(t)-Zt)<=sn)return null;if(this.sphere)i=this.x0+this.a*this.k0*dn(e-this.long0,this.over),r=this.y0+this.a*this.k0*Math.log(Math.tan(vr+.5*t));else{var o=Math.sin(t),s=Ru(this.e,t,o);i=this.x0+this.a*this.k0*dn(e-this.long0,this.over),r=this.y0-this.a*this.k0*Math.log(s)}return n.x=i,n.y=r,n}function v7(n){var e=n.x-this.x0,t=n.y-this.y0,i,r;if(this.sphere)r=Zt-2*Math.atan(Math.exp(-t/(this.a*this.k0)));else{var o=Math.exp(-t/(this.a*this.k0));if(r=Xv(this.e,o),r===-9999)return null}return i=dn(this.long0+e/(this.a*this.k0),this.over),n.x=i,n.y=r,n}var b7=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"];const x7={init:y7,forward:_7,inverse:v7,names:b7};function I7(){}function wF(n){return n}var E4=["longlat","identity"];const C7={init:I7,forward:wF,inverse:wF,names:E4};var w7=[x7,C7],wp={},zm=[];function T4(n,e){var t=zm.length;return n.names?(zm[t]=n,n.names.forEach(function(i){wp[i.toLowerCase()]=t}),this):(console.log(e),!0)}function R4(n){return n.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function A7(n){if(!n)return!1;var e=n.toLowerCase();if(typeof wp[e]<"u"&&zm[wp[e]]||(e=R4(e),e in wp&&zm[wp[e]]))return zm[wp[e]]}function S7(){w7.forEach(T4)}const E7={start:S7,add:T4,get:A7};var M4={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};const T7=M4.WGS84;function R7(n,e,t,i){var r=n*n,o=e*e,s=(r-o)/r,l=0;i?(n*=1-s*(Yj+s*(Hj+s*Kj)),r=n*n,s=0):l=Math.sqrt(s);var u=(r-o)/o;return{es:s,e:l,ep2:u}}function M7(n,e,t,i,r){if(!n){var o=mf(M4,i);o||(o=T7),n=o.a,e=o.b,t=o.rf}return t&&!e&&(e=(1-1/t)*n),(t===0||Math.abs(n-e)<sn)&&(r=!0,e=n),{a:n,b:e,rf:t,sphere:r}}var pI={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var k7 in pI){var lS=pI[k7];lS.datumName&&(pI[lS.datumName]=lS)}function L7(n,e,t,i,r,o,s){var l={};return n===void 0||n==="none"?l.datum_type=oT:l.datum_type=Uj,e&&(l.datum_params=e.map(parseFloat),(l.datum_params[0]!==0||l.datum_params[1]!==0||l.datum_params[2]!==0)&&(l.datum_type=tg),l.datum_params.length>3&&(l.datum_params[3]!==0||l.datum_params[4]!==0||l.datum_params[5]!==0||l.datum_params[6]!==0)&&(l.datum_type=ng,l.datum_params[3]*=nv,l.datum_params[4]*=nv,l.datum_params[5]*=nv,l.datum_params[6]=l.datum_params[6]/1e6+1)),s&&(l.datum_type=uy,l.grids=s),l.a=t,l.b=i,l.es=r,l.ep2=o,l}var kM={};function P7(n,e,t){return e instanceof ArrayBuffer?G7(n,e,t):{ready:F7(n,e)}}function G7(n,e,t){var i=!0;t!==void 0&&t.includeErrorFields===!1&&(i=!1);var r=new DataView(e),o=D7(r),s=V7(r,o),l=B7(r,s,o,i),u={header:s,subgrids:l};return kM[n]=u,u}async function F7(n,e){for(var t=[],i=await e.getImageCount(),r=i-1;r>=0;r--){var o=await e.getImage(r),s=await o.readRasters(),l=s,u=[o.getWidth(),o.getHeight()],h=o.getBoundingBox().map(AF),d=[o.fileDirectory.ModelPixelScale[0],o.fileDirectory.ModelPixelScale[1]].map(AF),m=h[0]+(u[0]-1)*d[0],y=h[3]-(u[1]-1)*d[1],x=l[0],C=l[1],w=[];for(let k=u[1]-1;k>=0;k--)for(let G=u[0]-1;G>=0;G--){var E=k*u[0]+G;w.push([-qd(C[E]),qd(x[E])])}t.push({del:d,lim:u,ll:[-m,y],cvs:w})}var T={header:{nSubgrids:i},subgrids:t};return kM[n]=T,T}function O7(n){if(n===void 0)return null;var e=n.split(",");return e.map(N7)}function N7(n){if(n.length===0)return null;var e=n[0]==="@";return e&&(n=n.slice(1)),n==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:n,mandatory:!e,grid:kM[n]||null,isNull:!1}}function AF(n){return n*Math.PI/180}function qd(n){return n/3600*Math.PI/180}function D7(n){var e=n.getInt32(8,!1);return e===11?!1:(e=n.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function V7(n,e){return{nFields:n.getInt32(8,e),nSubgridFields:n.getInt32(24,e),nSubgrids:n.getInt32(40,e),shiftType:lT(n,56,64).trim(),fromSemiMajorAxis:n.getFloat64(120,e),fromSemiMinorAxis:n.getFloat64(136,e),toSemiMajorAxis:n.getFloat64(152,e),toSemiMinorAxis:n.getFloat64(168,e)}}function lT(n,e,t){return String.fromCharCode.apply(null,new Uint8Array(n.buffer.slice(e,t)))}function B7(n,e,t,i){for(var r=176,o=[],s=0;s<e.nSubgrids;s++){var l=W7(n,r,t),u=z7(n,r,l,t,i),h=Math.round(1+(l.upperLongitude-l.lowerLongitude)/l.longitudeInterval),d=Math.round(1+(l.upperLatitude-l.lowerLatitude)/l.latitudeInterval);o.push({ll:[qd(l.lowerLongitude),qd(l.lowerLatitude)],del:[qd(l.longitudeInterval),qd(l.latitudeInterval)],lim:[h,d],count:l.gridNodeCount,cvs:Z7(u)});var m=16;i===!1&&(m=8),r+=176+l.gridNodeCount*m}return o}function Z7(n){return n.map(function(e){return[qd(e.longitudeShift),qd(e.latitudeShift)]})}function W7(n,e,t){return{name:lT(n,e+8,e+16).trim(),parent:lT(n,e+24,e+24+8).trim(),lowerLatitude:n.getFloat64(e+72,t),upperLatitude:n.getFloat64(e+88,t),lowerLongitude:n.getFloat64(e+104,t),upperLongitude:n.getFloat64(e+120,t),latitudeInterval:n.getFloat64(e+136,t),longitudeInterval:n.getFloat64(e+152,t),gridNodeCount:n.getInt32(e+168,t)}}function z7(n,e,t,i,r){var o=e+176,s=16;r===!1&&(s=8);for(var l=[],u=0;u<t.gridNodeCount;u++){var h={latitudeShift:n.getFloat32(o+u*s,i),longitudeShift:n.getFloat32(o+u*s+4,i)};r!==!1&&(h.latitudeAccuracy=n.getFloat32(o+u*s+8,i),h.longitudeAccuracy=n.getFloat32(o+u*s+12,i)),l.push(h)}return l}function Jl(n,e){if(!(this instanceof Jl))return new Jl(n);this.forward=null,this.inverse=null,this.init=null,this.name,this.names=null,this.title,e=e||function(h){if(h)throw h};var t=m7(n);if(typeof t!="object"){e("Could not parse to valid json: "+n);return}var i=Jl.projections.get(t.projName);if(!i){e("Could not get projection name from: "+n);return}if(t.datumCode&&t.datumCode!=="none"){var r=mf(pI,t.datumCode);r&&(t.datum_params=t.datum_params||(r.towgs84?r.towgs84.split(","):null),t.ellps=r.ellipse,t.datumName=r.datumName?r.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var o=M7(t.a,t.b,t.rf,t.ellps,t.sphere),s=R7(o.a,o.b,o.rf,t.R_A),l=O7(t.nadgrids),u=t.datum||L7(t.datumCode,t.datum_params,o.a,o.b,s.es,s.ep2,l);CF(this,t),CF(this,i),this.a=o.a,this.b=o.b,this.rf=o.rf,this.sphere=o.sphere,this.es=s.es,this.e=s.e,this.ep2=s.ep2,this.datum=u,"init"in this&&typeof this.init=="function"&&this.init(),e(null,this)}Jl.projections=E7;Jl.projections.start();function U7(n,e){return n.datum_type!==e.datum_type||n.a!==e.a||Math.abs(n.es-e.es)>5e-11?!1:n.datum_type===tg?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]:n.datum_type===ng?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]&&n.datum_params[3]===e.datum_params[3]&&n.datum_params[4]===e.datum_params[4]&&n.datum_params[5]===e.datum_params[5]&&n.datum_params[6]===e.datum_params[6]:!0}function k4(n,e,t){var i=n.x,r=n.y,o=n.z?n.z:0,s,l,u,h;if(r<-Zt&&r>-1.001*Zt)r=-Zt;else if(r>Zt&&r<1.001*Zt)r=Zt;else{if(r<-Zt)return{x:-1/0,y:-1/0,z:n.z};if(r>Zt)return{x:1/0,y:1/0,z:n.z}}return i>Math.PI&&(i-=2*Math.PI),l=Math.sin(r),h=Math.cos(r),u=l*l,s=t/Math.sqrt(1-e*u),{x:(s+o)*h*Math.cos(i),y:(s+o)*h*Math.sin(i),z:(s*(1-e)+o)*l}}function L4(n,e,t,i){var r=1e-12,o=r*r,s=30,l,u,h,d,m,y,x,C,w,E,T,k,G,O=n.x,V=n.y,z=n.z?n.z:0,H,te,$;if(l=Math.sqrt(O*O+V*V),u=Math.sqrt(O*O+V*V+z*z),l/t<r){if(H=0,u/t<r)return te=Zt,$=-i,{x:n.x,y:n.y,z:n.z}}else H=Math.atan2(V,O);h=z/u,d=l/u,m=1/Math.sqrt(1-e*(2-e)*d*d),C=d*(1-e)*m,w=h*m,G=0;do G++,x=t/Math.sqrt(1-e*w*w),$=l*C+z*w-x*(1-e*w*w),y=e*x/(x+$),m=1/Math.sqrt(1-y*(2-y)*d*d),E=d*(1-y)*m,T=h*m,k=T*C-E*w,C=E,w=T;while(k*k>o&&G<s);return te=Math.atan(T/Math.abs(E)),{x:H,y:te,z:$}}function X7(n,e,t){if(e===tg)return{x:n.x+t[0],y:n.y+t[1],z:n.z+t[2]};if(e===ng){var i=t[0],r=t[1],o=t[2],s=t[3],l=t[4],u=t[5],h=t[6];return{x:h*(n.x-u*n.y+l*n.z)+i,y:h*(u*n.x+n.y-s*n.z)+r,z:h*(-l*n.x+s*n.y+n.z)+o}}}function Y7(n,e,t){if(e===tg)return{x:n.x-t[0],y:n.y-t[1],z:n.z-t[2]};if(e===ng){var i=t[0],r=t[1],o=t[2],s=t[3],l=t[4],u=t[5],h=t[6],d=(n.x-i)/h,m=(n.y-r)/h,y=(n.z-o)/h;return{x:d+u*m-l*y,y:-u*d+m+s*y,z:l*d-s*m+y}}}function fx(n){return n===tg||n===ng}function H7(n,e,t){if(U7(n,e)||n.datum_type===oT||e.datum_type===oT)return t;var i=n.a,r=n.es;if(n.datum_type===uy){var o=SF(n,!1,t);if(o!==0)return;i=yF,r=_F}var s=e.a,l=e.b,u=e.es;if(e.datum_type===uy&&(s=yF,l=Xj,u=_F),r===u&&i===s&&!fx(n.datum_type)&&!fx(e.datum_type))return t;if(t=k4(t,r,i),fx(n.datum_type)&&(t=X7(t,n.datum_type,n.datum_params)),fx(e.datum_type)&&(t=Y7(t,e.datum_type,e.datum_params)),t=L4(t,u,s,l),e.datum_type===uy){var h=SF(e,!0,t);if(h!==0)return}return t}function SF(n,e,t){if(n.grids===null||n.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-t.x,y:t.y},r={x:Number.NaN,y:Number.NaN},o=[];e:for(var s=0;s<n.grids.length;s++){var l=n.grids[s];if(o.push(l.name),l.isNull){r=i;break}if(l.grid===null){if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1;continue}for(var u=l.grid.subgrids,h=0,d=u.length;h<d;h++){var m=u[h],y=(Math.abs(m.del[1])+Math.abs(m.del[0]))/1e4,x=m.ll[0]-y,C=m.ll[1]-y,w=m.ll[0]+(m.lim[0]-1)*m.del[0]+y,E=m.ll[1]+(m.lim[1]-1)*m.del[1]+y;if(!(C>i.y||x>i.x||E<i.y||w<i.x)&&(r=K7(i,e,m),!isNaN(r.x)))break e}}return isNaN(r.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*$a+" "+i.y*$a+" tried: '"+o+"'"),-1):(t.x=-r.x,t.y=r.y,0)}function K7(n,e,t){var i={x:Number.NaN,y:Number.NaN};if(isNaN(n.x))return i;var r={x:n.x,y:n.y};r.x-=t.ll[0],r.y-=t.ll[1],r.x=dn(r.x-Math.PI)+Math.PI;var o=EF(r,t);if(e){if(isNaN(o.x))return i;o.x=r.x-o.x,o.y=r.y-o.y;var s=9,l=1e-12,u,h;do{if(h=EF(o,t),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}u={x:r.x-(h.x+o.x),y:r.y-(h.y+o.y)},o.x+=u.x,o.y+=u.y}while(s--&&Math.abs(u.x)>l&&Math.abs(u.y)>l);if(s<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=dn(o.x+t.ll[0]),i.y=o.y+t.ll[1]}else isNaN(o.x)||(i.x=n.x+o.x,i.y=n.y+o.y);return i}function EF(n,e){var t={x:n.x/e.del[0],y:n.y/e.del[1]},i={x:Math.floor(t.x),y:Math.floor(t.y)},r={x:t.x-1*i.x,y:t.y-1*i.y},o={x:Number.NaN,y:Number.NaN},s;if(i.x<0||i.x>=e.lim[0]||i.y<0||i.y>=e.lim[1])return o;s=i.y*e.lim[0]+i.x;var l={x:e.cvs[s][0],y:e.cvs[s][1]};s++;var u={x:e.cvs[s][0],y:e.cvs[s][1]};s+=e.lim[0];var h={x:e.cvs[s][0],y:e.cvs[s][1]};s--;var d={x:e.cvs[s][0],y:e.cvs[s][1]},m=r.x*r.y,y=r.x*(1-r.y),x=(1-r.x)*(1-r.y),C=(1-r.x)*r.y;return o.x=x*l.x+y*u.x+C*d.x+m*h.x,o.y=x*l.y+y*u.y+C*d.y+m*h.y,o}function TF(n,e,t){var i=t.x,r=t.y,o=t.z||0,s,l,u,h={};for(u=0;u<3;u++)if(!(e&&u===2&&t.z===void 0))switch(u===0?(s=i,"ew".indexOf(n.axis[u])!==-1?l="x":l="y"):u===1?(s=r,"ns".indexOf(n.axis[u])!==-1?l="y":l="x"):(s=o,l="z"),n.axis[u]){case"e":h[l]=s;break;case"w":h[l]=-s;break;case"n":h[l]=s;break;case"s":h[l]=-s;break;case"u":t[l]!==void 0&&(h.z=s);break;case"d":t[l]!==void 0&&(h.z=-s);break;default:return null}return h}function P4(n){var e={x:n[0],y:n[1]};return n.length>2&&(e.z=n[2]),n.length>3&&(e.m=n[3]),e}function j7(n){RF(n.x),RF(n.y)}function RF(n){if(typeof Number.isFinite=="function"){if(Number.isFinite(n))return;throw new TypeError("coordinates must be finite numbers")}if(typeof n!="number"||n!==n||!isFinite(n))throw new TypeError("coordinates must be finite numbers")}function $7(n,e){return(n.datum.datum_type===tg||n.datum.datum_type===ng||n.datum.datum_type===uy)&&e.datumCode!=="WGS84"||(e.datum.datum_type===tg||e.datum.datum_type===ng||e.datum.datum_type===uy)&&n.datumCode!=="WGS84"}function wC(n,e,t,i){var r;Array.isArray(t)?t=P4(t):t={x:t.x,y:t.y,z:t.z,m:t.m};var o=t.z!==void 0;if(j7(t),n.datum&&e.datum&&$7(n,e)&&(r=new Jl("WGS84"),t=wC(n,r,t,i),n=r),i&&n.axis!=="enu"&&(t=TF(n,!1,t)),n.projName==="longlat")t={x:t.x*Ss,y:t.y*Ss,z:t.z||0};else if(n.to_meter&&(t={x:t.x*n.to_meter,y:t.y*n.to_meter,z:t.z||0}),t=n.inverse(t),!t)return;if(n.from_greenwich&&(t.x+=n.from_greenwich),t=H7(n.datum,e.datum,t),!!t)return t=t,e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*$a,y:t.y*$a,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),i&&e.axis!=="enu"?TF(e,!0,t):(t&&!o&&delete t.z,t)}var MF=Jl("WGS84");function uS(n,e,t,i){var r,o,s;return Array.isArray(t)?(r=wC(n,e,t,i)||{x:NaN,y:NaN},t.length>2?typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof r.z=="number"?[r.x,r.y,r.z].concat(t.slice(3)):[r.x,r.y,t[2]].concat(t.slice(3)):[r.x,r.y].concat(t.slice(2)):[r.x,r.y]):(o=wC(n,e,t,i),s=Object.keys(t),s.length===2||s.forEach(function(l){if(typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(l==="x"||l==="y"||l==="z")return}else if(l==="x"||l==="y")return;o[l]=t[l]}),o)}function px(n){return n instanceof Jl?n:typeof n=="object"&&"oProj"in n?n.oProj:Jl(n)}function J7(n,e,t){var i,r,o=!1,s;return typeof e>"u"?(r=px(n),i=MF,o=!0):(typeof e.x<"u"||Array.isArray(e))&&(t=e,r=px(n),i=MF,o=!0),i||(i=px(n)),r||(r=px(e)),t?uS(i,r,t):(s={forward:function(l,u){return uS(i,r,l,u)},inverse:function(l,u){return uS(r,i,l,u)}},o&&(s.oProj=r),s)}var kF=6,G4="AJSAJS",F4="AFAFAF",Um=65,Va=73,zl=79,k0=86,L0=90;const q7={forward:O4,inverse:Q7,toPoint:N4};function O4(n,e){return e=e||5,n$(e$({lat:n[1],lon:n[0]}),e)}function Q7(n){var e=LM(V4(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function N4(n){var e=LM(V4(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function cS(n){return n*(Math.PI/180)}function LF(n){return 180*(n/Math.PI)}function e$(n){var e=n.lat,t=n.lon,i=6378137,r=.00669438,o=.9996,s,l,u,h,d,m,y,x=cS(e),C=cS(t),w,E;E=Math.floor((t+180)/6)+1,t===180&&(E=60),e>=56&&e<64&&t>=3&&t<12&&(E=32),e>=72&&e<84&&(t>=0&&t<9?E=31:t>=9&&t<21?E=33:t>=21&&t<33?E=35:t>=33&&t<42&&(E=37)),s=(E-1)*6-180+3,w=cS(s),l=r/(1-r),u=i/Math.sqrt(1-r*Math.sin(x)*Math.sin(x)),h=Math.tan(x)*Math.tan(x),d=l*Math.cos(x)*Math.cos(x),m=Math.cos(x)*(C-w),y=i*((1-r/4-3*r*r/64-5*r*r*r/256)*x-(3*r/8+3*r*r/32+45*r*r*r/1024)*Math.sin(2*x)+(15*r*r/256+45*r*r*r/1024)*Math.sin(4*x)-35*r*r*r/3072*Math.sin(6*x));var T=o*u*(m+(1-h+d)*m*m*m/6+(5-18*h+h*h+72*d-58*l)*m*m*m*m*m/120)+5e5,k=o*(y+u*Math.tan(x)*(m*m/2+(5-h+9*d+4*d*d)*m*m*m*m/24+(61-58*h+h*h+600*d-330*l)*m*m*m*m*m*m/720));return e<0&&(k+=1e7),{northing:Math.round(k),easting:Math.round(T),zoneNumber:E,zoneLetter:t$(e)}}function LM(n){var e=n.northing,t=n.easting,i=n.zoneLetter,r=n.zoneNumber;if(r<0||r>60)return null;var o=.9996,s=6378137,l=.00669438,u,h=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)),d,m,y,x,C,w,E,T,k,G=t-5e5,O=e;i<"N"&&(O-=1e7),E=(r-1)*6-180+3,u=l/(1-l),w=O/o,T=w/(s*(1-l/4-3*l*l/64-5*l*l*l/256)),k=T+(3*h/2-27*h*h*h/32)*Math.sin(2*T)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*T)+151*h*h*h/96*Math.sin(6*T),d=s/Math.sqrt(1-l*Math.sin(k)*Math.sin(k)),m=Math.tan(k)*Math.tan(k),y=u*Math.cos(k)*Math.cos(k),x=s*(1-l)/Math.pow(1-l*Math.sin(k)*Math.sin(k),1.5),C=G/(d*o);var V=k-d*Math.tan(k)/x*(C*C/2-(5+3*m+10*y-4*y*y-9*u)*C*C*C*C/24+(61+90*m+298*y+45*m*m-252*u-3*y*y)*C*C*C*C*C*C/720);V=LF(V);var z=(C-(1+2*m+y)*C*C*C/6+(5-2*y+28*m-3*y*y+8*u+24*m*m)*C*C*C*C*C/120)/Math.cos(k);z=E+LF(z);var H;if(n.accuracy){var te=LM({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});H={top:te.lat,right:te.lon,bottom:V,left:z}}else H={lat:V,lon:z};return H}function t$(n){var e="Z";return 84>=n&&n>=72?e="X":72>n&&n>=64?e="W":64>n&&n>=56?e="V":56>n&&n>=48?e="U":48>n&&n>=40?e="T":40>n&&n>=32?e="S":32>n&&n>=24?e="R":24>n&&n>=16?e="Q":16>n&&n>=8?e="P":8>n&&n>=0?e="N":0>n&&n>=-8?e="M":-8>n&&n>=-16?e="L":-16>n&&n>=-24?e="K":-24>n&&n>=-32?e="J":-32>n&&n>=-40?e="H":-40>n&&n>=-48?e="G":-48>n&&n>=-56?e="F":-56>n&&n>=-64?e="E":-64>n&&n>=-72?e="D":-72>n&&n>=-80&&(e="C"),e}function n$(n,e){var t="00000"+n.easting,i="00000"+n.northing;return n.zoneNumber+n.zoneLetter+i$(n.easting,n.northing,n.zoneNumber)+t.substr(t.length-5,e)+i.substr(i.length-5,e)}function i$(n,e,t){var i=D4(t),r=Math.floor(n/1e5),o=Math.floor(e/1e5)%20;return r$(r,o,i)}function D4(n){var e=n%kF;return e===0&&(e=kF),e}function r$(n,e,t){var i=t-1,r=G4.charCodeAt(i),o=F4.charCodeAt(i),s=r+n-1,l=o+e,u=!1;s>L0&&(s=s-L0+Um-1,u=!0),(s===Va||r<Va&&s>Va||(s>Va||r<Va)&&u)&&s++,(s===zl||r<zl&&s>zl||(s>zl||r<zl)&&u)&&(s++,s===Va&&s++),s>L0&&(s=s-L0+Um-1),l>k0?(l=l-k0+Um-1,u=!0):u=!1,(l===Va||o<Va&&l>Va||(l>Va||o<Va)&&u)&&l++,(l===zl||o<zl&&l>zl||(l>zl||o<zl)&&u)&&(l++,l===Va&&l++),l>k0&&(l=l-k0+Um-1);var h=String.fromCharCode(s)+String.fromCharCode(l);return h}function V4(n){if(n&&n.length===0)throw"MGRSPoint coverting from nothing";for(var e=n.length,t=null,i="",r,o=0;!/[A-Z]/.test(r=n.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+n;i+=r,o++}var s=parseInt(i,10);if(o===0||o+3>e)throw"MGRSPoint bad conversion from: "+n;var l=n.charAt(o++);if(l<="A"||l==="B"||l==="Y"||l>="Z"||l==="I"||l==="O")throw"MGRSPoint zone letter "+l+" not handled: "+n;t=n.substring(o,o+=2);for(var u=D4(s),h=s$(t.charAt(0),u),d=o$(t.charAt(1),u);d<a$(l);)d+=2e6;var m=e-o;if(m%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+n;var y=m/2,x=0,C=0,w,E,T,k,G;return y>0&&(w=1e5/Math.pow(10,y),E=n.substring(o,o+y),x=parseFloat(E)*w,T=n.substring(o+y),C=parseFloat(T)*w),k=x+h,G=C+d,{easting:k,northing:G,zoneLetter:l,zoneNumber:s,accuracy:w}}function s$(n,e){for(var t=G4.charCodeAt(e-1),i=1e5,r=!1;t!==n.charCodeAt(0);){if(t++,t===Va&&t++,t===zl&&t++,t>L0){if(r)throw"Bad character: "+n;t=Um,r=!0}i+=1e5}return i}function o$(n,e){if(n>"V")throw"MGRSPoint given invalid Northing "+n;for(var t=F4.charCodeAt(e-1),i=0,r=!1;t!==n.charCodeAt(0);){if(t++,t===Va&&t++,t===zl&&t++,t>k0){if(r)throw"Bad character: "+n;t=Um,r=!0}i+=1e5}return i}function a$(n){var e;switch(n){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+n}function My(n,e,t){if(!(this instanceof My))return new My(n,e,t);if(Array.isArray(n))this.x=n[0],this.y=n[1],this.z=n[2]||0;else if(typeof n=="object")this.x=n.x,this.y=n.y,this.z=n.z||0;else if(typeof n=="string"&&typeof e>"u"){var i=n.split(",");this.x=parseFloat(i[0]),this.y=parseFloat(i[1]),this.z=parseFloat(i[2])||0}else this.x=n,this.y=e,this.z=t||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}My.fromMGRS=function(n){return new My(N4(n))};My.prototype.toMGRS=function(n){return O4([this.x,this.y],n)};var l$=1,u$=.25,PF=.046875,GF=.01953125,FF=.01068115234375,c$=.75,h$=.46875,d$=.013020833333333334,f$=.007120768229166667,p$=.3645833333333333,g$=.005696614583333333,m$=.3076171875;function PM(n){var e=[];e[0]=l$-n*(u$+n*(PF+n*(GF+n*FF))),e[1]=n*(c$-n*(PF+n*(GF+n*FF)));var t=n*n;return e[2]=t*(h$-n*(d$+n*f$)),t*=n,e[3]=t*(p$-n*g$),e[4]=t*n*m$,e}function Hy(n,e,t,i){return t*=e,e*=e,i[0]*n-t*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))}var y$=20;function GM(n,e,t){for(var i=1/(1-e),r=n,o=y$;o;--o){var s=Math.sin(r),l=1-e*s*s;if(l=(Hy(r,s,Math.cos(r),t)-n)*(l*Math.sqrt(l))*i,r-=l,Math.abs(l)<sn)return r}return r}function _$(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=PM(this.es),this.ml0=Hy(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function v$(n){var e=n.x,t=n.y,i=dn(e-this.long0,this.over),r,o,s,l=Math.sin(t),u=Math.cos(t);if(this.es){var d=u*i,m=Math.pow(d,2),y=this.ep2*Math.pow(u,2),x=Math.pow(y,2),C=Math.abs(u)>sn?Math.tan(t):0,w=Math.pow(C,2),E=Math.pow(w,2);r=1-this.es*Math.pow(l,2),d=d/Math.sqrt(r);var T=Hy(t,l,u,this.en);o=this.a*(this.k0*d*(1+m/6*(1-w+y+m/20*(5-18*w+E+14*y-58*w*y+m/42*(61+179*E-E*w-479*w)))))+this.x0,s=this.a*(this.k0*(T-this.ml0+l*i*d/2*(1+m/12*(5-w+9*y+4*x+m/30*(61+E-58*w+270*y-330*w*y+m/56*(1385+543*E-E*w-3111*w))))))+this.y0}else{var h=u*Math.sin(i);if(Math.abs(Math.abs(h)-1)<sn)return 93;if(o=.5*this.a*this.k0*Math.log((1+h)/(1-h))+this.x0,s=u*Math.cos(i)/Math.sqrt(1-Math.pow(h,2)),h=Math.abs(s),h>=1){if(h-1>sn)return 93;s=0}else s=Math.acos(s);t<0&&(s=-s),s=this.a*this.k0*(s-this.lat0)+this.y0}return n.x=o,n.y=s,n}function b$(n){var e,t,i,r,o=(n.x-this.x0)*(1/this.a),s=(n.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+s/this.k0,t=GM(e,this.es,this.en),Math.abs(t)<Zt){var m=Math.sin(t),y=Math.cos(t),x=Math.abs(y)>sn?Math.tan(t):0,C=this.ep2*Math.pow(y,2),w=Math.pow(C,2),E=Math.pow(x,2),T=Math.pow(E,2);e=1-this.es*Math.pow(m,2);var k=o*Math.sqrt(e)/this.k0,G=Math.pow(k,2);e=e*x,i=t-e*G/(1-this.es)*.5*(1-G/12*(5+3*E-9*C*E+C-4*w-G/30*(61+90*E-252*C*E+45*T+46*C-G/56*(1385+3633*E+4095*T+1574*T*E)))),r=dn(this.long0+k*(1-G/6*(1+2*E+C-G/20*(5+28*E+24*T+8*C*E+6*C-G/42*(61+662*E+1320*T+720*T*E))))/y,this.over)}else i=Zt*xb(s),r=0;else{var l=Math.exp(o/this.k0),u=.5*(l-1/l),h=this.lat0+s/this.k0,d=Math.cos(h);e=Math.sqrt((1-Math.pow(d,2))/(1+Math.pow(u,2))),i=Math.asin(e),s<0&&(i=-i),u===0&&d===0?r=0:r=dn(Math.atan2(u,d)+this.long0,this.over)}return n.x=r,n.y=i,n}var x$=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const gI={init:_$,forward:v$,inverse:b$,names:x$};function B4(n){var e=Math.exp(n);return e=(e-1/e)/2,e}function Ya(n,e){n=Math.abs(n),e=Math.abs(e);var t=Math.max(n,e),i=Math.min(n,e)/(t||1);return t*Math.sqrt(1+Math.pow(i,2))}function I$(n){var e=1+n,t=e-1;return t===0?n:n*Math.log(e)/t}function C$(n){var e=Math.abs(n);return e=I$(e*(1+e/(Ya(1,e)+1))),n<0?-e:e}function FM(n,e){for(var t=2*Math.cos(2*e),i=n.length-1,r=n[i],o=0,s;--i>=0;)s=-o+t*r+n[i],o=r,r=s;return e+s*Math.sin(2*e)}function w$(n,e){for(var t=2*Math.cos(e),i=n.length-1,r=n[i],o=0,s;--i>=0;)s=-o+t*r+n[i],o=r,r=s;return Math.sin(e)*s}function A$(n){var e=Math.exp(n);return e=(e+1/e)/2,e}function Z4(n,e,t){for(var i=Math.sin(e),r=Math.cos(e),o=B4(t),s=A$(t),l=2*r*s,u=-2*i*o,h=n.length-1,d=n[h],m=0,y=0,x=0,C,w;--h>=0;)C=y,w=m,y=d,m=x,d=-C+l*y-u*m+n[h],x=-w+u*y+l*m;return l=i*s,u=r*o,[l*d-u*x,l*x+u*d]}function S$(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(gI.init.apply(this),this.forward=gI.forward,this.inverse=gI.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var n=this.es/(1+Math.sqrt(1-this.es)),e=n/(2-n),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),t=t*e,this.cgb[1]=t*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t=t*e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),t=t*e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(-12/5+e*(-24832/14175))),t=t*e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t=t*e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),t=t*e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t=t*e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t=t*e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t=t*e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=t*(212378941/319334400);var i=FM(this.cbg,this.lat0);this.Zb=-this.Qn*(i+w$(this.gtu,2*i))}function E$(n){var e=dn(n.x-this.long0,this.over),t=n.y;t=FM(this.cbg,t);var i=Math.sin(t),r=Math.cos(t),o=Math.sin(e),s=Math.cos(e);t=Math.atan2(i,s*r),e=Math.atan2(o*r,Ya(i,r*s)),e=C$(Math.tan(e));var l=Z4(this.gtu,2*t,2*e);t=t+l[0],e=e+l[1];var u,h;return Math.abs(e)<=2.623395162778?(u=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*t+this.Zb)+this.y0):(u=1/0,h=1/0),n.x=u,n.y=h,n}function T$(n){var e=(n.x-this.x0)*(1/this.a),t=(n.y-this.y0)*(1/this.a);t=(t-this.Zb)/this.Qn,e=e/this.Qn;var i,r;if(Math.abs(e)<=2.623395162778){var o=Z4(this.utg,2*t,2*e);t=t+o[0],e=e+o[1],e=Math.atan(B4(e));var s=Math.sin(t),l=Math.cos(t),u=Math.sin(e),h=Math.cos(e);t=Math.atan2(s*h,Ya(u,h*l)),e=Math.atan2(u,h*l),i=dn(e+this.long0,this.over),r=FM(this.cgb,t)}else i=1/0,r=1/0;return n.x=i,n.y=r,n}var R$=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const mI={init:S$,forward:E$,inverse:T$,names:R$};function M$(n,e){if(n===void 0){if(n=Math.floor((dn(e)+Math.PI)*30/Math.PI)+1,n<0)return 0;if(n>60)return 60}return n}var k$="etmerc";function L$(){var n=M$(this.zone,this.long0);if(n===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(n)-183)*Ss,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,mI.init.apply(this),this.forward=mI.forward,this.inverse=mI.inverse}var P$=["Universal Transverse Mercator System","utm"];const G$={init:L$,names:P$,dependsOn:k$};function OM(n,e){return Math.pow((1-n)/(1+n),e)}var F$=20;function O$(){var n=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*n*n),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(n/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+vr)/(Math.pow(Math.tan(.5*this.lat0+vr),this.C)*OM(this.e*n,this.ratexp))}function N$(n){var e=n.x,t=n.y;return n.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+vr),this.C)*OM(this.e*Math.sin(t),this.ratexp))-Zt,n.x=this.C*e,n}function D$(n){for(var e=1e-14,t=n.x/this.C,i=n.y,r=Math.pow(Math.tan(.5*i+vr)/this.K,1/this.C),o=F$;o>0&&(i=2*Math.atan(r*OM(this.e*Math.sin(n.y),-.5*this.e))-Zt,!(Math.abs(i-n.y)<e));--o)n.y=i;return o?(n.x=t,n.y=i,n):null}const NM={init:O$,forward:N$,inverse:D$};function V$(){NM.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function B$(n){var e,t,i,r;return n.x=dn(n.x-this.long0,this.over),NM.forward.apply(this,[n]),e=Math.sin(n.y),t=Math.cos(n.y),i=Math.cos(n.x),r=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*i),n.x=r*t*Math.sin(n.x),n.y=r*(this.cosc0*e-this.sinc0*t*i),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function Z$(n){var e,t,i,r,o;if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,o=Ya(n.x,n.y)){var s=2*Math.atan2(o,this.R2);e=Math.sin(s),t=Math.cos(s),r=Math.asin(t*this.sinc0+n.y*e*this.cosc0/o),i=Math.atan2(n.x*e,o*this.cosc0*t-n.y*this.sinc0*e)}else r=this.phic0,i=0;return n.x=i,n.y=r,NM.inverse.apply(this,[n]),n.x=dn(n.x+this.long0,this.over),n}var W$=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const z$={init:V$,forward:B$,inverse:Z$,names:W$};function DM(n,e,t){return e*=t,Math.tan(.5*(Zt+n))*Math.pow((1-e)/(1+e),.5*t)}function U$(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=sn&&(this.k0=.5*(1+xb(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=sn&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=sn&&Math.abs(Math.cos(this.lat_ts))>sn&&(this.k0=.5*this.cons*Fc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Ru(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Fc(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(DM(this.lat0,this.sinlat0,this.e))-Zt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function X$(n){var e=n.x,t=n.y,i=Math.sin(t),r=Math.cos(t),o,s,l,u,h,d,m=dn(e-this.long0,this.over);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=sn&&Math.abs(t+this.lat0)<=sn?(n.x=NaN,n.y=NaN,n):this.sphere?(o=2*this.k0/(1+this.sinlat0*i+this.coslat0*r*Math.cos(m)),n.x=this.a*o*r*Math.sin(m)+this.x0,n.y=this.a*o*(this.coslat0*i-this.sinlat0*r*Math.cos(m))+this.y0,n):(s=2*Math.atan(DM(t,i,this.e))-Zt,u=Math.cos(s),l=Math.sin(s),Math.abs(this.coslat0)<=sn?(h=Ru(this.e,t*this.con,this.con*i),d=2*this.a*this.k0*h/this.cons,n.x=this.x0+d*Math.sin(e-this.long0),n.y=this.y0-this.con*d*Math.cos(e-this.long0),n):(Math.abs(this.sinlat0)<sn?(o=2*this.a*this.k0/(1+u*Math.cos(m)),n.y=o*l):(o=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*l+this.cosX0*u*Math.cos(m))),n.y=o*(this.cosX0*l-this.sinX0*u*Math.cos(m))+this.y0),n.x=o*u*Math.sin(m)+this.x0,n))}function Y$(n){n.x-=this.x0,n.y-=this.y0;var e,t,i,r,o,s=Math.sqrt(n.x*n.x+n.y*n.y);if(this.sphere){var l=2*Math.atan(s/(2*this.a*this.k0));return e=this.long0,t=this.lat0,s<=sn?(n.x=e,n.y=t,n):(t=Math.asin(Math.cos(l)*this.sinlat0+n.y*Math.sin(l)*this.coslat0/s),Math.abs(this.coslat0)<sn?this.lat0>0?e=dn(this.long0+Math.atan2(n.x,-1*n.y),this.over):e=dn(this.long0+Math.atan2(n.x,n.y),this.over):e=dn(this.long0+Math.atan2(n.x*Math.sin(l),s*this.coslat0*Math.cos(l)-n.y*this.sinlat0*Math.sin(l)),this.over),n.x=e,n.y=t,n)}else if(Math.abs(this.coslat0)<=sn){if(s<=sn)return t=this.lat0,e=this.long0,n.x=e,n.y=t,n;n.x*=this.con,n.y*=this.con,i=s*this.cons/(2*this.a*this.k0),t=this.con*Xv(this.e,i),e=this.con*dn(this.con*this.long0+Math.atan2(n.x,-1*n.y),this.over)}else r=2*Math.atan(s*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,s<=sn?o=this.X0:(o=Math.asin(Math.cos(r)*this.sinX0+n.y*Math.sin(r)*this.cosX0/s),e=dn(this.long0+Math.atan2(n.x*Math.sin(r),s*this.cosX0*Math.cos(r)-n.y*this.sinX0*Math.sin(r)),this.over)),t=-1*Xv(this.e,Math.tan(.5*(Zt+o)));return n.x=e,n.y=t,n}var H$=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"];const K$={init:U$,forward:X$,inverse:Y$,names:H$,ssfn_:DM};function j$(){var n=this.lat0;this.lambda0=this.long0;var e=Math.sin(n),t=this.a,i=this.rf,r=1/i,o=2*r-Math.pow(r,2),s=this.e=Math.sqrt(o);this.R=this.k0*t*Math.sqrt(1-o)/(1-o*Math.pow(e,2)),this.alpha=Math.sqrt(1+o/(1-o)*Math.pow(Math.cos(n),4)),this.b0=Math.asin(e/this.alpha);var l=Math.log(Math.tan(Math.PI/4+this.b0/2)),u=Math.log(Math.tan(Math.PI/4+n/2)),h=Math.log((1+s*e)/(1-s*e));this.K=l-this.alpha*u+this.alpha*s/2*h}function $$(n){var e=Math.log(Math.tan(Math.PI/4-n.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(n.y))/(1-this.e*Math.sin(n.y))),i=-this.alpha*(e+t)+this.K,r=2*(Math.atan(Math.exp(i))-Math.PI/4),o=this.alpha*(n.x-this.lambda0),s=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(o))),l=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(o));return n.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,n.x=this.R*s+this.x0,n}function J$(n){for(var e=n.x-this.x0,t=n.y-this.y0,i=e/this.R,r=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(i)),s=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(r))),l=this.lambda0+s/this.alpha,u=0,h=o,d=-1e3,m=0;Math.abs(h-d)>1e-7;){if(++m>20)return;u=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),d=h,h=2*Math.atan(Math.exp(u))-Math.PI/2}return n.x=l,n.y=h,n}var q$=["somerc"];const Q$={init:j$,forward:$$,inverse:J$,names:q$};var Gm=1e-7;function eJ(n){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],t=typeof n.projName=="object"?Object.keys(n.projName)[0]:n.projName;return"no_uoff"in n||"no_off"in n||e.indexOf(t)!==-1||e.indexOf(R4(t))!==-1}function tJ(){var n,e,t,i,r,o,s,l,u,h,d=0,m,y=0,x=0,C=0,w=0,E=0,T=0;this.no_off=eJ(this),this.no_rot="no_rot"in this;var k=!1;"alpha"in this&&(k=!0);var G=!1;if("rectified_grid_angle"in this&&(G=!0),k&&(T=this.alpha),G&&(d=this.rectified_grid_angle),k||G)y=this.longc;else if(x=this.long1,w=this.lat1,C=this.long2,E=this.lat2,Math.abs(w-E)<=Gm||(n=Math.abs(w))<=Gm||Math.abs(n-Zt)<=Gm||Math.abs(Math.abs(this.lat0)-Zt)<=Gm||Math.abs(Math.abs(E)-Zt)<=Gm)throw new Error;var O=1-this.es;e=Math.sqrt(O),Math.abs(this.lat0)>sn?(l=Math.sin(this.lat0),t=Math.cos(this.lat0),n=1-this.es*l*l,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/O),this.A=this.B*this.k0*e/n,i=this.B*e/(t*Math.sqrt(n)),r=i*i-1,r<=0?r=0:(r=Math.sqrt(r),this.lat0<0&&(r=-r)),this.E=r+=i,this.E*=Math.pow(Ru(this.e,this.lat0,l),this.B)):(this.B=1/e,this.A=this.k0,this.E=i=r=1),k||G?(k?(m=Math.asin(Math.sin(T)/i),G||(d=T)):(m=d,T=Math.asin(i*Math.sin(m))),this.lam0=y-Math.asin(.5*(r-1/r)*Math.tan(m))/this.B):(o=Math.pow(Ru(this.e,w,Math.sin(w)),this.B),s=Math.pow(Ru(this.e,E,Math.sin(E)),this.B),r=this.E/o,u=(s-o)/(s+o),h=this.E*this.E,h=(h-s*o)/(h+s*o),n=x-C,n<-Math.PI?C-=zv:n>Math.PI&&(C+=zv),this.lam0=dn(.5*(x+C)-Math.atan(h*Math.tan(.5*this.B*(x-C))/u)/this.B,this.over),m=Math.atan(2*Math.sin(this.B*dn(x-this.lam0,this.over))/(r-1/r)),d=T=Math.asin(i*Math.sin(m))),this.singam=Math.sin(m),this.cosgam=Math.cos(m),this.sinrot=Math.sin(d),this.cosrot=Math.cos(d),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(T))),this.lat0<0&&(this.u_0=-this.u_0)),r=.5*m,this.v_pole_n=this.ArB*Math.log(Math.tan(vr-r)),this.v_pole_s=this.ArB*Math.log(Math.tan(vr+r))}function nJ(n){var e={},t,i,r,o,s,l,u,h;if(n.x=n.x-this.lam0,Math.abs(Math.abs(n.y)-Zt)>sn){if(s=this.E/Math.pow(Ru(this.e,n.y,Math.sin(n.y)),this.B),l=1/s,t=.5*(s-l),i=.5*(s+l),o=Math.sin(this.B*n.x),r=(t*this.singam-o*this.cosgam)/i,Math.abs(Math.abs(r)-1)<sn)throw new Error;h=.5*this.ArB*Math.log((1-r)/(1+r)),l=Math.cos(this.B*n.x),Math.abs(l)<Gm?u=this.A*n.x:u=this.ArB*Math.atan2(t*this.cosgam+o*this.singam,l)}else h=n.y>0?this.v_pole_n:this.v_pole_s,u=this.ArB*n.y;return this.no_rot?(e.x=u,e.y=h):(u-=this.u_0,e.x=h*this.cosrot+u*this.sinrot,e.y=u*this.cosrot-h*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function iJ(n){var e,t,i,r,o,s,l,u={};if(n.x=(n.x-this.x0)*(1/this.a),n.y=(n.y-this.y0)*(1/this.a),this.no_rot?(t=n.y,e=n.x):(t=n.x*this.cosrot-n.y*this.sinrot,e=n.y*this.cosrot+n.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*t),r=.5*(i-1/i),o=.5*(i+1/i),s=Math.sin(this.BrA*e),l=(s*this.cosgam+r*this.singam)/o,Math.abs(Math.abs(l)-1)<sn)u.x=0,u.y=l<0?-Zt:Zt;else{if(u.y=this.E/Math.sqrt((1+l)/(1-l)),u.y=Xv(this.e,Math.pow(u.y,1/this.B)),u.y===1/0)throw new Error;u.x=-this.rB*Math.atan2(r*this.cosgam-s*this.singam,Math.cos(this.BrA*e))}return u.x+=this.lam0,u}var rJ=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const sJ={init:tJ,forward:nJ,inverse:iJ,names:rJ};function oJ(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<sn)){var n=this.b/this.a;this.e=Math.sqrt(1-n*n);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),i=Fc(this.e,e,t),r=Ru(this.e,this.lat1,e),o=Math.sin(this.lat2),s=Math.cos(this.lat2),l=Fc(this.e,o,s),u=Ru(this.e,this.lat2,o),h=Math.abs(Math.abs(this.lat0)-Zt)<sn?0:Ru(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>sn?this.ns=Math.log(i/l)/Math.log(r/u):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=i/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function aJ(n){var e=n.x,t=n.y;Math.abs(2*Math.abs(t)-Math.PI)<=sn&&(t=xb(t)*(Zt-2*sn));var i=Math.abs(Math.abs(t)-Zt),r,o;if(i>sn)r=Ru(this.e,t,Math.sin(t)),o=this.a*this.f0*Math.pow(r,this.ns);else{if(i=t*this.ns,i<=0)return null;o=0}var s=this.ns*dn(e-this.long0,this.over);return n.x=this.k0*(o*Math.sin(s))+this.x0,n.y=this.k0*(this.rh-o*Math.cos(s))+this.y0,n}function lJ(n){var e,t,i,r,o,s=(n.x-this.x0)/this.k0,l=this.rh-(n.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(s*s+l*l),t=1):(e=-Math.sqrt(s*s+l*l),t=-1);var u=0;if(e!==0&&(u=Math.atan2(t*s,t*l)),e!==0||this.ns>0){if(t=1/this.ns,i=Math.pow(e/(this.a*this.f0),t),r=Xv(this.e,i),r===-9999)return null}else r=-Zt;return o=dn(u/this.ns+this.long0,this.over),n.x=o,n.y=r,n}var uJ=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const cJ={init:oJ,forward:aJ,inverse:lJ,names:uJ};function hJ(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function dJ(n){var e,t,i,r,o,s,l,u=n.x,h=n.y,d=dn(u-this.long0,this.over);return e=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/e)-this.s45),i=-d*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(i)),o=Math.asin(Math.cos(t)*Math.sin(i)/Math.cos(r)),s=this.n*o,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),n.y=l*Math.cos(s)/1,n.x=l*Math.sin(s)/1,this.czech||(n.y*=-1,n.x*=-1),n}function fJ(n){var e,t,i,r,o,s,l,u,h=n.x;n.x=n.y,n.y=h,this.czech||(n.y*=-1,n.x*=-1),s=Math.sqrt(n.x*n.x+n.y*n.y),o=Math.atan2(n.y,n.x),r=o/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/s,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),t=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(e)),n.x=this.long0-t/this.alfa,l=e,u=0;var d=0;do n.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.e/2))-this.s45),Math.abs(l-n.y)<1e-10&&(u=1),l=n.y,d+=1;while(u===0&&d<15);return d>=15?null:n}var pJ=["Krovak","krovak"];const gJ={init:hJ,forward:dJ,inverse:fJ,names:pJ};function Ia(n,e,t,i,r){return n*r-e*Math.sin(2*r)+t*Math.sin(4*r)-i*Math.sin(6*r)}function Ib(n){return 1-.25*n*(1+n/16*(3+1.25*n))}function Cb(n){return .375*n*(1+.25*n*(1+.46875*n))}function wb(n){return .05859375*n*n*(1+.75*n)}function Ab(n){return n*n*n*(35/3072)}function VM(n,e,t){var i=e*t;return n/Math.sqrt(1-i*i)}function Ef(n){return Math.abs(n)<Zt?n:n-xb(n)*Math.PI}function AC(n,e,t,i,r){var o,s;o=n/e;for(var l=0;l<15;l++)if(s=(n-(e*o-t*Math.sin(2*o)+i*Math.sin(4*o)-r*Math.sin(6*o)))/(e-2*t*Math.cos(2*o)+4*i*Math.cos(4*o)-6*r*Math.cos(6*o)),o+=s,Math.abs(s)<=1e-10)return o;return NaN}function mJ(){this.sphere||(this.e0=Ib(this.es),this.e1=Cb(this.es),this.e2=wb(this.es),this.e3=Ab(this.es),this.ml0=this.a*Ia(this.e0,this.e1,this.e2,this.e3,this.lat0))}function yJ(n){var e,t,i=n.x,r=n.y;if(i=dn(i-this.long0,this.over),this.sphere)e=this.a*Math.asin(Math.cos(r)*Math.sin(i)),t=this.a*(Math.atan2(Math.tan(r),Math.cos(i))-this.lat0);else{var o=Math.sin(r),s=Math.cos(r),l=VM(this.a,this.e,o),u=Math.tan(r)*Math.tan(r),h=i*Math.cos(r),d=h*h,m=this.es*s*s/(1-this.es),y=this.a*Ia(this.e0,this.e1,this.e2,this.e3,r);e=l*h*(1-d*u*(1/6-(8-u+8*m)*d/120)),t=y-this.ml0+l*o/s*d*(.5+(5-u+6*m)*d/24)}return n.x=e+this.x0,n.y=t+this.y0,n}function _J(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,t=n.y/this.a,i,r;if(this.sphere){var o=t+this.lat0;i=Math.asin(Math.sin(o)*Math.cos(e)),r=Math.atan2(Math.tan(e),Math.cos(o))}else{var s=this.ml0/this.a+t,l=AC(s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-Zt)<=sn)return n.x=this.long0,n.y=Zt,t<0&&(n.y*=-1),n;var u=VM(this.a,this.e,Math.sin(l)),h=u*u*u/this.a/this.a*(1-this.es),d=Math.pow(Math.tan(l),2),m=e*this.a/u,y=m*m;i=l-u*Math.tan(l)/h*m*m*(.5-(1+3*d)*m*m/24),r=m*(1-y*(d/3+(1+3*d)*d*y/15))/Math.cos(l)}return n.x=dn(r+this.long0,this.over),n.y=Ef(i),n}var vJ=["Cassini","Cassini_Soldner","cass"];const bJ={init:mJ,forward:yJ,inverse:_J,names:vJ};function lf(n,e){var t;return n>1e-7?(t=n*e,(1-n*n)*(e/(1-t*t)-.5/n*Math.log((1-t)/(1+t)))):2*e}var uT=1,cT=2,hT=3,yI=4;function xJ(){var n=Math.abs(this.lat0);if(Math.abs(n-Zt)<sn?this.mode=this.lat0<0?uT:cT:Math.abs(n)<sn?this.mode=hT:this.mode=yI,this.es>0){var e;switch(this.qp=lf(this.e,1),this.mmf=.5/(1-this.es),this.apa=MJ(this.es),this.mode){case cT:this.dd=1;break;case uT:this.dd=1;break;case hT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case yI:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=lf(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===yI&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function IJ(n){var e,t,i,r,o,s,l,u,h,d,m=n.x,y=n.y;if(m=dn(m-this.long0,this.over),this.sphere){if(o=Math.sin(y),d=Math.cos(y),i=Math.cos(m),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t=this.mode===this.EQUIT?1+d*i:1+this.sinph0*o+this.cosph0*d*i,t<=sn)return null;t=Math.sqrt(2/t),e=t*d*Math.sin(m),t*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*d*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(y+this.lat0)<sn)return null;t=vr-y*.5,t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)),e=t*Math.sin(m),t*=i}}else{switch(l=0,u=0,h=0,i=Math.cos(m),r=Math.sin(m),o=Math.sin(y),s=lf(this.e,o),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(l=s/this.qp,u=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:h=1+this.sinb1*l+this.cosb1*u*i;break;case this.EQUIT:h=1+u*i;break;case this.N_POLE:h=Zt+y,s=this.qp-s;break;case this.S_POLE:h=y-Zt,s=this.qp+s;break}if(Math.abs(h)<sn)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?t=this.ymf*h*(this.cosb1*l-this.sinb1*u*i):t=(h=Math.sqrt(2/(1+u*i)))*l*this.ymf,e=this.xmf*h*u*r;break;case this.N_POLE:case this.S_POLE:s>=0?(e=(h=Math.sqrt(s))*r,t=i*(this.mode===this.S_POLE?h:-h)):e=t=0;break}}return n.x=this.a*e+this.x0,n.y=this.a*t+this.y0,n}function CJ(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,t=n.y/this.a,i,r,o,s,l,u,h;if(this.sphere){var d=0,m,y=0;if(m=Math.sqrt(e*e+t*t),r=m*.5,r>1)return null;switch(r=2*Math.asin(r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(y=Math.sin(r),d=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(m)<=sn?0:Math.asin(t*y/m),e*=y,t=d*m;break;case this.OBLIQ:r=Math.abs(m)<=sn?this.lat0:Math.asin(d*this.sinph0+t*y*this.cosph0/m),e*=y*this.cosph0,t=(d-Math.sin(r)*this.sinph0)*m;break;case this.N_POLE:t=-t,r=Zt-r;break;case this.S_POLE:r-=Zt;break}i=t===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,t)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,t*=this.dd,u=Math.sqrt(e*e+t*t),u<sn)return n.x=this.long0,n.y=this.lat0,n;s=2*Math.asin(.5*u/this.rq),o=Math.cos(s),e*=s=Math.sin(s),this.mode===this.OBLIQ?(h=o*this.sinb1+t*s*this.cosb1/u,l=this.qp*h,t=u*this.cosb1*o-t*this.sinb1*s):(h=t*s/u,l=this.qp*h,t=u*o)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(t=-t),l=e*e+t*t,!l)return n.x=this.long0,n.y=this.lat0,n;h=1-l/this.qp,this.mode===this.S_POLE&&(h=-h)}i=Math.atan2(e,t),r=kJ(Math.asin(h),this.apa)}return n.x=dn(this.long0+i,this.over),n.y=r,n}var wJ=.3333333333333333,AJ=.17222222222222222,SJ=.10257936507936508,EJ=.06388888888888888,TJ=.0664021164021164,RJ=.016415012942191543;function MJ(n){var e,t=[];return t[0]=n*wJ,e=n*n,t[0]+=e*AJ,t[1]=e*EJ,e*=n,t[0]+=e*SJ,t[1]+=e*TJ,t[2]=e*RJ,t}function kJ(n,e){var t=n+n;return n+e[0]*Math.sin(t)+e[1]*Math.sin(t+t)+e[2]*Math.sin(t+t+t)}var LJ=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const PJ={init:xJ,forward:IJ,inverse:CJ,names:LJ,S_POLE:uT,N_POLE:cT,EQUIT:hT,OBLIQ:yI};function yf(n){return Math.abs(n)>1&&(n=n>1?1:-1),Math.asin(n)}function GJ(){Math.abs(this.lat1+this.lat2)<sn||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Fc(this.e3,this.sin_po,this.cos_po),this.qs1=lf(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Fc(this.e3,this.sin_po,this.cos_po),this.qs2=lf(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=lf(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>sn?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function FJ(n){var e=n.x,t=n.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var i=lf(this.e3,this.sin_phi),r=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,o=this.ns0*dn(e-this.long0,this.over),s=r*Math.sin(o)+this.x0,l=this.rh-r*Math.cos(o)+this.y0;return n.x=s,n.y=l,n}function OJ(n){var e,t,i,r,o,s;return n.x-=this.x0,n.y=this.rh-n.y+this.y0,this.ns0>=0?(e=Math.sqrt(n.x*n.x+n.y*n.y),i=1):(e=-Math.sqrt(n.x*n.x+n.y*n.y),i=-1),r=0,e!==0&&(r=Math.atan2(i*n.x,i*n.y)),i=e*this.ns0/this.a,this.sphere?s=Math.asin((this.c-i*i)/(2*this.ns0)):(t=(this.c-i*i)/this.ns0,s=this.phi1z(this.e3,t)),o=dn(r/this.ns0+this.long0,this.over),n.x=o,n.y=s,n}function NJ(n,e){var t,i,r,o,s,l=yf(.5*e);if(n<sn)return l;for(var u=n*n,h=1;h<=25;h++)if(t=Math.sin(l),i=Math.cos(l),r=n*t,o=1-r*r,s=.5*o*o/i*(e/(1-u)-t/o+.5/n*Math.log((1-r)/(1+r))),l=l+s,Math.abs(s)<=1e-7)return l;return null}var DJ=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"];const VJ={init:GJ,forward:FJ,inverse:OJ,names:DJ,phi1z:NJ};function BJ(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function ZJ(n){var e,t,i,r,o,s,l,u,h=n.x,d=n.y;return i=dn(h-this.long0,this.over),e=Math.sin(d),t=Math.cos(d),r=Math.cos(i),s=this.sin_p14*e+this.cos_p14*t*r,o=1,s>0||Math.abs(s)<=sn?(l=this.x0+this.a*o*t*Math.sin(i)/s,u=this.y0+this.a*o*(this.cos_p14*e-this.sin_p14*t*r)/s):(l=this.x0+this.infinity_dist*t*Math.sin(i),u=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*r)),n.x=l,n.y=u,n}function WJ(n){var e,t,i,r,o,s;return n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,(e=Math.sqrt(n.x*n.x+n.y*n.y))?(r=Math.atan2(e,this.rc),t=Math.sin(r),i=Math.cos(r),s=yf(i*this.sin_p14+n.y*t*this.cos_p14/e),o=Math.atan2(n.x*t,e*this.cos_p14*i-n.y*this.sin_p14*t),o=dn(this.long0+o,this.over)):(s=this.phic0,o=0),n.x=o,n.y=s,n}var zJ=["gnom"];const UJ={init:BJ,forward:ZJ,inverse:WJ,names:zJ};function XJ(n,e){var t=1-(1-n*n)/(2*n)*Math.log((1-n)/(1+n));if(Math.abs(Math.abs(e)-t)<1e-6)return e<0?-1*Zt:Zt;for(var i=Math.asin(.5*e),r,o,s,l,u=0;u<30;u++)if(o=Math.sin(i),s=Math.cos(i),l=n*o,r=Math.pow(1-l*l,2)/(2*s)*(e/(1-n*n)-o/(1-l*l)+.5/n*Math.log((1-l)/(1+l))),i+=r,Math.abs(r)<=1e-10)return i;return NaN}function YJ(){this.sphere||(this.k0=Fc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function HJ(n){var e=n.x,t=n.y,i,r,o=dn(e-this.long0,this.over);if(this.sphere)i=this.x0+this.a*o*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(t)/Math.cos(this.lat_ts);else{var s=lf(this.e,Math.sin(t));i=this.x0+this.a*this.k0*o,r=this.y0+this.a*s*.5/this.k0}return n.x=i,n.y=r,n}function KJ(n){n.x-=this.x0,n.y-=this.y0;var e,t;return this.sphere?(e=dn(this.long0+n.x/this.a/Math.cos(this.lat_ts),this.over),t=Math.asin(n.y/this.a*Math.cos(this.lat_ts))):(t=XJ(this.e,2*n.y*this.k0/this.a),e=dn(this.long0+n.x/(this.a*this.k0),this.over)),n.x=e,n.y=t,n}var jJ=["cea"];const $J={init:YJ,forward:HJ,inverse:KJ,names:jJ};function JJ(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function qJ(n){var e=n.x,t=n.y,i=dn(e-this.long0,this.over),r=Ef(t-this.lat0);return n.x=this.x0+this.a*i*this.rc,n.y=this.y0+this.a*r,n}function QJ(n){var e=n.x,t=n.y;return n.x=dn(this.long0+(e-this.x0)/(this.a*this.rc),this.over),n.y=Ef(this.lat0+(t-this.y0)/this.a),n}var eq=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"];const tq={init:JJ,forward:qJ,inverse:QJ,names:eq};var OF=20;function nq(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ib(this.es),this.e1=Cb(this.es),this.e2=wb(this.es),this.e3=Ab(this.es),this.ml0=this.a*Ia(this.e0,this.e1,this.e2,this.e3,this.lat0)}function iq(n){var e=n.x,t=n.y,i,r,o,s=dn(e-this.long0,this.over);if(o=s*Math.sin(t),this.sphere)Math.abs(t)<=sn?(i=this.a*s,r=-1*this.a*this.lat0):(i=this.a*Math.sin(o)/Math.tan(t),r=this.a*(Ef(t-this.lat0)+(1-Math.cos(o))/Math.tan(t)));else if(Math.abs(t)<=sn)i=this.a*s,r=-1*this.ml0;else{var l=VM(this.a,this.e,Math.sin(t))/Math.tan(t);i=l*Math.sin(o),r=this.a*Ia(this.e0,this.e1,this.e2,this.e3,t)-this.ml0+l*(1-Math.cos(o))}return n.x=i+this.x0,n.y=r+this.y0,n}function rq(n){var e,t,i,r,o,s,l,u,h;if(i=n.x-this.x0,r=n.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=sn)e=dn(i/this.a+this.long0,this.over),t=0;else{s=this.lat0+r/this.a,l=i*i/this.a/this.a+s*s,u=s;var d;for(o=OF;o;--o)if(d=Math.tan(u),h=-1*(s*(u*d+1)-u-.5*(u*u+l)*d)/((u-s)/d-1),u+=h,Math.abs(h)<=sn){t=u;break}e=dn(this.long0+Math.asin(i*Math.tan(u)/this.a)/Math.sin(t),this.over)}else if(Math.abs(r+this.ml0)<=sn)t=0,e=dn(this.long0+i/this.a,this.over);else{s=(this.ml0+r)/this.a,l=i*i/this.a/this.a+s*s,u=s;var m,y,x,C,w;for(o=OF;o;--o)if(w=this.e*Math.sin(u),m=Math.sqrt(1-w*w)*Math.tan(u),y=this.a*Ia(this.e0,this.e1,this.e2,this.e3,u),x=this.e0-2*this.e1*Math.cos(2*u)+4*this.e2*Math.cos(4*u)-6*this.e3*Math.cos(6*u),C=y/this.a,h=(s*(m*C+1)-C-.5*m*(C*C+l))/(this.es*Math.sin(2*u)*(C*C+l-2*s*C)/(4*m)+(s-C)*(m*x-2/Math.sin(2*u))-x),u-=h,Math.abs(h)<=sn){t=u;break}m=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=dn(this.long0+Math.asin(i*m/this.a)/Math.sin(t),this.over)}return n.x=e,n.y=t,n}var sq=["Polyconic","American_Polyconic","poly"];const oq={init:nq,forward:iq,inverse:rq,names:sq};function aq(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function lq(n){var e,t=n.x,i=n.y,r=i-this.lat0,o=t-this.long0,s=r/nv*1e-5,l=o,u=1,h=0;for(e=1;e<=10;e++)u=u*s,h=h+this.A[e]*u;var d=h,m=l,y=1,x=0,C,w,E=0,T=0;for(e=1;e<=6;e++)C=y*d-x*m,w=x*d+y*m,y=C,x=w,E=E+this.B_re[e]*y-this.B_im[e]*x,T=T+this.B_im[e]*y+this.B_re[e]*x;return n.x=T*this.a+this.x0,n.y=E*this.a+this.y0,n}function uq(n){var e,t=n.x,i=n.y,r=t-this.x0,o=i-this.y0,s=o/this.a,l=r/this.a,u=1,h=0,d,m,y=0,x=0;for(e=1;e<=6;e++)d=u*s-h*l,m=h*s+u*l,u=d,h=m,y=y+this.C_re[e]*u-this.C_im[e]*h,x=x+this.C_im[e]*u+this.C_re[e]*h;for(var C=0;C<this.iterations;C++){var w=y,E=x,T,k,G=s,O=l;for(e=2;e<=6;e++)T=w*y-E*x,k=E*y+w*x,w=T,E=k,G=G+(e-1)*(this.B_re[e]*w-this.B_im[e]*E),O=O+(e-1)*(this.B_im[e]*w+this.B_re[e]*E);w=1,E=0;var V=this.B_re[1],z=this.B_im[1];for(e=2;e<=6;e++)T=w*y-E*x,k=E*y+w*x,w=T,E=k,V=V+e*(this.B_re[e]*w-this.B_im[e]*E),z=z+e*(this.B_im[e]*w+this.B_re[e]*E);var H=V*V+z*z;y=(G*V+O*z)/H,x=(O*V-G*z)/H}var te=y,$=x,ae=1,fe=0;for(e=1;e<=9;e++)ae=ae*te,fe=fe+this.D[e]*ae;var Y=this.lat0+fe*nv*1e5,de=this.long0+$;return n.x=de,n.y=Y,n}var cq=["New_Zealand_Map_Grid","nzmg"];const hq={init:aq,forward:lq,inverse:uq,names:cq};function dq(){}function fq(n){var e=n.x,t=n.y,i=dn(e-this.long0,this.over),r=this.x0+this.a*i,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return n.x=r,n.y=o,n}function pq(n){n.x-=this.x0,n.y-=this.y0;var e=dn(this.long0+n.x/this.a,this.over),t=2.5*(Math.atan(Math.exp(.8*n.y/this.a))-Math.PI/4);return n.x=e,n.y=t,n}var gq=["Miller_Cylindrical","mill"];const mq={init:dq,forward:fq,inverse:pq,names:gq};var yq=20;function _q(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=PM(this.es)}function vq(n){var e,t,i=n.x,r=n.y;if(i=dn(i-this.long0,this.over),this.sphere){if(!this.m)r=this.n!==1?Math.asin(this.n*Math.sin(r)):r;else for(var o=this.n*Math.sin(r),s=yq;s;--s){var l=(this.m*r+Math.sin(r)-o)/(this.m+Math.cos(r));if(r-=l,Math.abs(l)<sn)break}e=this.a*this.C_x*i*(this.m+Math.cos(r)),t=this.a*this.C_y*r}else{var u=Math.sin(r),h=Math.cos(r);t=this.a*Hy(r,u,h,this.en),e=this.a*i*h/Math.sqrt(1-this.es*u*u)}return n.x=e,n.y=t,n}function bq(n){var e,t,i,r;return n.x-=this.x0,i=n.x/this.a,n.y-=this.y0,e=n.y/this.a,this.sphere?(e/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(e))),this.m?e=yf((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=yf(Math.sin(e)/this.n)),i=dn(i+this.long0,this.over),e=Ef(e)):(e=GM(n.y/this.a,this.es,this.en),r=Math.abs(e),r<Zt?(r=Math.sin(e),t=this.long0+n.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(e)),i=dn(t,this.over)):r-sn<Zt&&(i=this.long0)),n.x=i,n.y=e,n}var xq=["Sinusoidal","sinu"];const Iq={init:_q,forward:vq,inverse:bq,names:xq};function Cq(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0}function wq(n){for(var e=n.x,t=n.y,i=dn(e-this.long0,this.over),r=t,o=Math.PI*Math.sin(t);;){var s=-(r+Math.sin(r)-o)/(1+Math.cos(r));if(r+=s,Math.abs(s)<sn)break}r/=2,Math.PI/2-Math.abs(t)<sn&&(i=0);var l=.900316316158*this.a*i*Math.cos(r)+this.x0,u=1.4142135623731*this.a*Math.sin(r)+this.y0;return n.x=l,n.y=u,n}function Aq(n){var e,t;n.x-=this.x0,n.y-=this.y0,t=n.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var i=dn(this.long0+n.x/(.900316316158*this.a*Math.cos(e)),this.over);i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var r=Math.asin(t);return n.x=i,n.y=r,n}var Sq=["Mollweide","moll"];const Eq={init:Cq,forward:wq,inverse:Aq,names:Sq};function Tq(){Math.abs(this.lat1+this.lat2)<sn||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ib(this.es),this.e1=Cb(this.es),this.e2=wb(this.es),this.e3=Ab(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=Fc(this.e,this.sin_phi,this.cos_phi),this.ml1=Ia(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<sn?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=Fc(this.e,this.sin_phi,this.cos_phi),this.ml2=Ia(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ia(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function Rq(n){var e=n.x,t=n.y,i;if(this.sphere)i=this.a*(this.g-t);else{var r=Ia(this.e0,this.e1,this.e2,this.e3,t);i=this.a*(this.g-r)}var o=this.ns*dn(e-this.long0,this.over),s=this.x0+i*Math.sin(o),l=this.y0+this.rh-i*Math.cos(o);return n.x=s,n.y=l,n}function Mq(n){n.x-=this.x0,n.y=this.rh-n.y+this.y0;var e,t,i,r;this.ns>=0?(t=Math.sqrt(n.x*n.x+n.y*n.y),e=1):(t=-Math.sqrt(n.x*n.x+n.y*n.y),e=-1);var o=0;if(t!==0&&(o=Math.atan2(e*n.x,e*n.y)),this.sphere)return r=dn(this.long0+o/this.ns,this.over),i=Ef(this.g-t/this.a),n.x=r,n.y=i,n;var s=this.g-t/this.a;return i=AC(s,this.e0,this.e1,this.e2,this.e3),r=dn(this.long0+o/this.ns,this.over),n.x=r,n.y=i,n}var kq=["Equidistant_Conic","eqdc"];const Lq={init:Tq,forward:Rq,inverse:Mq,names:kq};function Pq(){this.R=this.a}function Gq(n){var e=n.x,t=n.y,i=dn(e-this.long0,this.over),r,o;Math.abs(t)<=sn&&(r=this.x0+this.R*i,o=this.y0);var s=yf(2*Math.abs(t/Math.PI));(Math.abs(i)<=sn||Math.abs(Math.abs(t)-Zt)<=sn)&&(r=this.x0,t>=0?o=this.y0+Math.PI*this.R*Math.tan(.5*s):o=this.y0+Math.PI*this.R*-Math.tan(.5*s));var l=.5*Math.abs(Math.PI/i-i/Math.PI),u=l*l,h=Math.sin(s),d=Math.cos(s),m=d/(h+d-1),y=m*m,x=m*(2/h-1),C=x*x,w=Math.PI*this.R*(l*(m-C)+Math.sqrt(u*(m-C)*(m-C)-(C+u)*(y-C)))/(C+u);i<0&&(w=-w),r=this.x0+w;var E=u+m;return w=Math.PI*this.R*(x*E-l*Math.sqrt((C+u)*(u+1)-E*E))/(C+u),t>=0?o=this.y0+w:o=this.y0-w,n.x=r,n.y=o,n}function Fq(n){var e,t,i,r,o,s,l,u,h,d,m,y,x;return n.x-=this.x0,n.y-=this.y0,m=Math.PI*this.R,i=n.x/m,r=n.y/m,o=i*i+r*r,s=-Math.abs(r)*(1+o),l=s-2*r*r+i*i,u=-2*s+1+2*r*r+o*o,x=r*r/u+(2*l*l*l/u/u/u-9*s*l/u/u)/27,h=(s-l*l/3/u)/u,d=2*Math.sqrt(-h/3),m=3*x/h/d,Math.abs(m)>1&&(m>=0?m=1:m=-1),y=Math.acos(m)/3,n.y>=0?t=(-d*Math.cos(y+Math.PI/3)-l/3/u)*Math.PI:t=-(-d*Math.cos(y+Math.PI/3)-l/3/u)*Math.PI,Math.abs(i)<sn?e=this.long0:e=dn(this.long0+Math.PI*(o-1+Math.sqrt(1+2*(i*i-r*r)+o*o))/2/i,this.over),n.x=e,n.y=t,n}var Oq=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"];const Nq={init:Pq,forward:Gq,inverse:Fq,names:Oq};function Dq(n,e,t,i,r,o){const s=i-e,l=Math.atan((1-o)*Math.tan(n)),u=Math.atan((1-o)*Math.tan(t)),h=Math.sin(l),d=Math.cos(l),m=Math.sin(u),y=Math.cos(u);let x=s,C,w=100,E,T,k,G,O,V,z,H,te,$,ae,fe,Y,de;do{if(E=Math.sin(x),T=Math.cos(x),k=Math.sqrt(y*E*(y*E)+(d*m-h*y*T)*(d*m-h*y*T)),k===0)return{azi1:0,s12:0};G=h*m+d*y*T,O=Math.atan2(k,G),V=d*y*E/k,z=1-V*V,H=z!==0?G-2*h*m/z:0,te=o/16*z*(4+o*(4-3*z)),C=x,x=s+(1-te)*o*V*(O+te*k*(H+te*G*(-1+2*H*H)))}while(Math.abs(x-C)>1e-12&&--w>0);return w===0?{azi1:NaN,s12:NaN}:($=z*(r*r-r*(1-o)*(r*(1-o)))/(r*(1-o)*(r*(1-o))),ae=1+$/16384*(4096+$*(-768+$*(320-175*$))),fe=$/1024*(256+$*(-128+$*(74-47*$))),Y=fe*k*(H+fe/4*(G*(-1+2*H*H)-fe/6*H*(-3+4*k*k)*(-3+4*H*H))),de=r*(1-o)*ae*(O-Y),{azi1:Math.atan2(y*E,d*m-h*y*T),s12:de})}function Vq(n,e,t,i,r,o){const s=Math.atan((1-o)*Math.tan(n)),l=Math.sin(s),u=Math.cos(s),h=Math.sin(t),d=Math.cos(t),m=Math.atan2(l,u*d),y=u*h,x=1-y*y,C=x*(r*r-r*(1-o)*(r*(1-o)))/(r*(1-o)*(r*(1-o))),w=1+C/16384*(4096+C*(-768+C*(320-175*C))),E=C/1024*(256+C*(-128+C*(74-47*C)));let T=i/(r*(1-o)*w),k,G=100,O,V,z,H;do O=Math.cos(2*m+T),V=Math.sin(T),z=Math.cos(T),H=E*V*(O+E/4*(z*(-1+2*O*O)-E/6*O*(-3+4*V*V)*(-3+4*O*O))),k=T,T=i/(r*(1-o)*w)+H;while(Math.abs(T-k)>1e-12&&--G>0);if(G===0)return{lat2:NaN,lon2:NaN};const te=l*V-u*z*d,$=Math.atan2(l*z+u*V*d,(1-o)*Math.sqrt(y*y+te*te)),ae=Math.atan2(V*h,u*z-l*V*d),fe=o/16*x*(4+o*(4-3*x)),Y=ae-(1-fe)*o*y*(T+fe*V*(O+fe*z*(-1+2*O*O))),de=e+Y;return{lat2:$,lon2:de}}function Bq(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))}function Zq(n){var e=n.x,t=n.y,i=Math.sin(n.y),r=Math.cos(n.y),o=dn(e-this.long0,this.over),s,l,u,h,d,m,y,x,C,w,E;return this.sphere?Math.abs(this.sin_p12-1)<=sn?(n.x=this.x0+this.a*(Zt-t)*Math.sin(o),n.y=this.y0-this.a*(Zt-t)*Math.cos(o),n):Math.abs(this.sin_p12+1)<=sn?(n.x=this.x0+this.a*(Zt+t)*Math.sin(o),n.y=this.y0+this.a*(Zt+t)*Math.cos(o),n):(C=this.sin_p12*i+this.cos_p12*r*Math.cos(o),y=Math.acos(C),x=y?y/Math.sin(y):1,n.x=this.x0+this.a*x*r*Math.sin(o),n.y=this.y0+this.a*x*(this.cos_p12*i-this.sin_p12*r*Math.cos(o)),n):(s=Ib(this.es),l=Cb(this.es),u=wb(this.es),h=Ab(this.es),Math.abs(this.sin_p12-1)<=sn?(d=this.a*Ia(s,l,u,h,Zt),m=this.a*Ia(s,l,u,h,t),n.x=this.x0+(d-m)*Math.sin(o),n.y=this.y0-(d-m)*Math.cos(o),n):Math.abs(this.sin_p12+1)<=sn?(d=this.a*Ia(s,l,u,h,Zt),m=this.a*Ia(s,l,u,h,t),n.x=this.x0+(d+m)*Math.sin(o),n.y=this.y0+(d+m)*Math.cos(o),n):Math.abs(e)<sn&&Math.abs(t-this.lat0)<sn?(n.x=n.y=0,n):(w=Dq(this.lat0,this.long0,t,e,this.a,this.f),E=w.azi1,n.x=w.s12*Math.sin(E),n.y=w.s12*Math.cos(E),n))}function Wq(n){n.x-=this.x0,n.y-=this.y0;var e,t,i,r,o,s,l,u,h,d,m,y,x,C,w,E;return this.sphere?(e=Math.sqrt(n.x*n.x+n.y*n.y),e>2*Zt*this.a?void 0:(t=e/this.a,i=Math.sin(t),r=Math.cos(t),o=this.long0,Math.abs(e)<=sn?s=this.lat0:(s=yf(r*this.sin_p12+n.y*i*this.cos_p12/e),l=Math.abs(this.lat0)-Zt,Math.abs(l)<=sn?this.lat0>=0?o=dn(this.long0+Math.atan2(n.x,-n.y),this.over):o=dn(this.long0-Math.atan2(-n.x,n.y),this.over):o=dn(this.long0+Math.atan2(n.x*i,e*this.cos_p12*r-n.y*this.sin_p12*i),this.over)),n.x=o,n.y=s,n)):(u=Ib(this.es),h=Cb(this.es),d=wb(this.es),m=Ab(this.es),Math.abs(this.sin_p12-1)<=sn?(y=this.a*Ia(u,h,d,m,Zt),e=Math.sqrt(n.x*n.x+n.y*n.y),x=y-e,s=AC(x/this.a,u,h,d,m),o=dn(this.long0+Math.atan2(n.x,-1*n.y),this.over),n.x=o,n.y=s,n):Math.abs(this.sin_p12+1)<=sn?(y=this.a*Ia(u,h,d,m,Zt),e=Math.sqrt(n.x*n.x+n.y*n.y),x=e-y,s=AC(x/this.a,u,h,d,m),o=dn(this.long0+Math.atan2(n.x,n.y),this.over),n.x=o,n.y=s,n):(C=Math.atan2(n.x,n.y),w=Math.sqrt(n.x*n.x+n.y*n.y),E=Vq(this.lat0,this.long0,C,w,this.a,this.f),n.x=E.lon2,n.y=E.lat2,n))}var zq=["Azimuthal_Equidistant","aeqd"];const Uq={init:Bq,forward:Zq,inverse:Wq,names:zq};function Xq(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function Yq(n){var e,t,i,r,o,s,l,u,h=n.x,d=n.y;return i=dn(h-this.long0,this.over),e=Math.sin(d),t=Math.cos(d),r=Math.cos(i),s=this.sin_p14*e+this.cos_p14*t*r,o=1,(s>0||Math.abs(s)<=sn)&&(l=this.a*o*t*Math.sin(i),u=this.y0+this.a*o*(this.cos_p14*e-this.sin_p14*t*r)),n.x=l,n.y=u,n}function Hq(n){var e,t,i,r,o,s,l;return n.x-=this.x0,n.y-=this.y0,e=Math.sqrt(n.x*n.x+n.y*n.y),t=yf(e/this.a),i=Math.sin(t),r=Math.cos(t),s=this.long0,Math.abs(e)<=sn?(l=this.lat0,n.x=s,n.y=l,n):(l=yf(r*this.sin_p14+n.y*i*this.cos_p14/e),o=Math.abs(this.lat0)-Zt,Math.abs(o)<=sn?(this.lat0>=0?s=dn(this.long0+Math.atan2(n.x,-n.y),this.over):s=dn(this.long0-Math.atan2(-n.x,n.y),this.over),n.x=s,n.y=l,n):(s=dn(this.long0+Math.atan2(n.x*i,e*this.cos_p14*r-n.y*this.sin_p14*i),this.over),n.x=s,n.y=l,n))}var Kq=["ortho"];const jq={init:Xq,forward:Yq,inverse:Hq,names:Kq};var ds={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},br={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function $q(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Zt-vr/2?this.face=ds.TOP:this.lat0<=-(Zt-vr/2)?this.face=ds.BOTTOM:Math.abs(this.long0)<=vr?this.face=ds.FRONT:Math.abs(this.long0)<=Zt+vr?this.face=this.long0>0?ds.RIGHT:ds.LEFT:this.face=ds.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function Jq(n){var e={x:0,y:0},t,i,r,o,s,l,u={value:0};if(n.x-=this.long0,this.es!==0?t=Math.atan(this.one_minus_f_squared*Math.tan(n.y)):t=n.y,i=n.x,this.face===ds.TOP)o=Zt-t,i>=vr&&i<=Zt+vr?(u.value=br.AREA_0,r=i-Zt):i>Zt+vr||i<=-(Zt+vr)?(u.value=br.AREA_1,r=i>0?i-Bs:i+Bs):i>-(Zt+vr)&&i<=-vr?(u.value=br.AREA_2,r=i+Zt):(u.value=br.AREA_3,r=i);else if(this.face===ds.BOTTOM)o=Zt+t,i>=vr&&i<=Zt+vr?(u.value=br.AREA_0,r=-i+Zt):i<vr&&i>=-vr?(u.value=br.AREA_1,r=-i):i<-vr&&i>=-(Zt+vr)?(u.value=br.AREA_2,r=-i-Zt):(u.value=br.AREA_3,r=i>0?-i+Bs:-i-Bs);else{var h,d,m,y,x,C,w;this.face===ds.RIGHT?i=cy(i,+Zt):this.face===ds.BACK?i=cy(i,+Bs):this.face===ds.LEFT&&(i=cy(i,-Zt)),y=Math.sin(t),x=Math.cos(t),C=Math.sin(i),w=Math.cos(i),h=x*w,d=x*C,m=y,this.face===ds.FRONT?(o=Math.acos(h),r=gx(o,m,d,u)):this.face===ds.RIGHT?(o=Math.acos(d),r=gx(o,m,-h,u)):this.face===ds.BACK?(o=Math.acos(-h),r=gx(o,m,-d,u)):this.face===ds.LEFT?(o=Math.acos(-d),r=gx(o,m,h,u)):(o=r=0,u.value=br.AREA_0)}return l=Math.atan(12/Bs*(r+Math.acos(Math.sin(r)*Math.cos(vr))-Zt)),s=Math.sqrt((1-Math.cos(o))/(Math.cos(l)*Math.cos(l))/(1-Math.cos(Math.atan(1/Math.cos(r))))),u.value===br.AREA_1?l+=Zt:u.value===br.AREA_2?l+=Bs:u.value===br.AREA_3&&(l+=1.5*Bs),e.x=s*Math.cos(l),e.y=s*Math.sin(l),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,n.x=e.x,n.y=e.y,n}function qq(n){var e={lam:0,phi:0},t,i,r,o,s,l,u,h,d,m={value:0};if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,i=Math.atan(Math.sqrt(n.x*n.x+n.y*n.y)),t=Math.atan2(n.y,n.x),n.x>=0&&n.x>=Math.abs(n.y)?m.value=br.AREA_0:n.y>=0&&n.y>=Math.abs(n.x)?(m.value=br.AREA_1,t-=Zt):n.x<0&&-n.x>=Math.abs(n.y)?(m.value=br.AREA_2,t=t<0?t+Bs:t-Bs):(m.value=br.AREA_3,t+=Zt),d=Bs/12*Math.tan(t),s=Math.sin(d)/(Math.cos(d)-1/Math.sqrt(2)),l=Math.atan(s),r=Math.cos(t),o=Math.tan(i),u=1-r*r*o*o*(1-Math.cos(Math.atan(1/Math.cos(l)))),u<-1?u=-1:u>1&&(u=1),this.face===ds.TOP)h=Math.acos(u),e.phi=Zt-h,m.value===br.AREA_0?e.lam=l+Zt:m.value===br.AREA_1?e.lam=l<0?l+Bs:l-Bs:m.value===br.AREA_2?e.lam=l-Zt:e.lam=l;else if(this.face===ds.BOTTOM)h=Math.acos(u),e.phi=h-Zt,m.value===br.AREA_0?e.lam=-l+Zt:m.value===br.AREA_1?e.lam=-l:m.value===br.AREA_2?e.lam=-l-Zt:e.lam=l<0?-l-Bs:-l+Bs;else{var y,x,C;y=u,d=y*y,d>=1?C=0:C=Math.sqrt(1-d)*Math.sin(l),d+=C*C,d>=1?x=0:x=Math.sqrt(1-d),m.value===br.AREA_1?(d=x,x=-C,C=d):m.value===br.AREA_2?(x=-x,C=-C):m.value===br.AREA_3&&(d=x,x=C,C=-d),this.face===ds.RIGHT?(d=y,y=-x,x=d):this.face===ds.BACK?(y=-y,x=-x):this.face===ds.LEFT&&(d=y,y=x,x=-d),e.phi=Math.acos(-C)-Zt,e.lam=Math.atan2(x,y),this.face===ds.RIGHT?e.lam=cy(e.lam,-Zt):this.face===ds.BACK?e.lam=cy(e.lam,-Bs):this.face===ds.LEFT&&(e.lam=cy(e.lam,+Zt))}if(this.es!==0){var w,E,T;w=e.phi<0?1:0,E=Math.tan(e.phi),T=this.b/Math.sqrt(E*E+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-T*T)/(this.one_minus_f*T)),w&&(e.phi=-e.phi)}return e.lam+=this.long0,n.x=e.lam,n.y=e.phi,n}function gx(n,e,t,i){var r;return n<sn?(i.value=br.AREA_0,r=0):(r=Math.atan2(e,t),Math.abs(r)<=vr?i.value=br.AREA_0:r>vr&&r<=Zt+vr?(i.value=br.AREA_1,r-=Zt):r>Zt+vr||r<=-(Zt+vr)?(i.value=br.AREA_2,r=r>=0?r-Bs:r+Bs):(i.value=br.AREA_3,r+=Zt)),r}function cy(n,e){var t=n+e;return t<-Bs?t+=zv:t>+Bs&&(t-=zv),t}var Qq=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const eQ={init:$q,forward:Jq,inverse:qq,names:Qq};var dT=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],P0=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],W4=.8487,z4=1.3523,U4=$a/5,tQ=1/U4,Xm=18,SC=function(n,e){return n[0]+e*(n[1]+e*(n[2]+e*n[3]))},nQ=function(n,e){return n[1]+e*(2*n[2]+e*3*n[3])};function iQ(n,e,t,i){for(var r=e;i;--i){var o=n(r);if(r-=o,Math.abs(o)<t)break}return r}function rQ(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function sQ(n){var e=dn(n.x-this.long0,this.over),t=Math.abs(n.y),i=Math.floor(t*U4);i<0?i=0:i>=Xm&&(i=Xm-1),t=$a*(t-tQ*i);var r={x:SC(dT[i],t)*e,y:SC(P0[i],t)};return n.y<0&&(r.y=-r.y),r.x=r.x*this.a*W4+this.x0,r.y=r.y*this.a*z4+this.y0,r}function oQ(n){var e={x:(n.x-this.x0)/(this.a*W4),y:Math.abs(n.y-this.y0)/(this.a*z4)};if(e.y>=1)e.x/=dT[Xm][0],e.y=n.y<0?-Zt:Zt;else{var t=Math.floor(e.y*Xm);for(t<0?t=0:t>=Xm&&(t=Xm-1);;)if(P0[t][0]>e.y)--t;else if(P0[t+1][0]<=e.y)++t;else break;var i=P0[t],r=5*(e.y-i[0])/(P0[t+1][0]-i[0]);r=iQ(function(o){return(SC(i,o)-e.y)/nQ(i,o)},r,sn,100),e.x/=SC(dT[t],r),e.y=(5*t+r)*Ss,n.y<0&&(e.y=-e.y)}return e.x=dn(e.x+this.long0,this.over),e}var aQ=["Robinson","robin"];const lQ={init:rQ,forward:sQ,inverse:oQ,names:aQ};function uQ(){this.name="geocent"}function cQ(n){var e=k4(n,this.es,this.a);return e}function hQ(n){var e=L4(n,this.es,this.a,this.b);return e}var dQ=["Geocentric","geocentric","geocent","Geocent"];const fQ={init:uQ,forward:cQ,inverse:hQ,names:dQ};var Qo={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},g0={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function pQ(){if(Object.keys(g0).forEach((function(t){if(typeof this[t]>"u")this[t]=g0[t].def;else{if(g0[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);g0[t].num&&(this[t]=parseFloat(this[t]))}g0[t].degrees&&(this[t]=this[t]*Ss)}).bind(this)),Math.abs(Math.abs(this.lat0)-Zt)<sn?this.mode=this.lat0<0?Qo.S_POLE:Qo.N_POLE:Math.abs(this.lat0)<sn?this.mode=Qo.EQUIT:(this.mode=Qo.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var n=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(n),this.sw=Math.sin(n)}function gQ(n){n.x-=this.long0;var e=Math.sin(n.y),t=Math.cos(n.y),i=Math.cos(n.x),r,o;switch(this.mode){case Qo.OBLIQ:o=this.sinph0*e+this.cosph0*t*i;break;case Qo.EQUIT:o=t*i;break;case Qo.S_POLE:o=-e;break;case Qo.N_POLE:o=e;break}switch(o=this.pn1/(this.p-o),r=o*t*Math.sin(n.x),this.mode){case Qo.OBLIQ:o*=this.cosph0*e-this.sinph0*t*i;break;case Qo.EQUIT:o*=e;break;case Qo.N_POLE:o*=-(t*i);break;case Qo.S_POLE:o*=t*i;break}var s,l;return s=o*this.cg+r*this.sg,l=1/(s*this.sw*this.h1+this.cw),r=(r*this.cg-o*this.sg)*this.cw*l,o=s*l,n.x=r*this.a,n.y=o*this.a,n}function mQ(n){n.x/=this.a,n.y/=this.a;var e={x:n.x,y:n.y},t,i,r;r=1/(this.pn1-n.y*this.sw),t=this.pn1*n.x*r,i=this.pn1*n.y*this.cw*r,n.x=t*this.cg+i*this.sg,n.y=i*this.cg-t*this.sg;var o=Ya(n.x,n.y);if(Math.abs(o)<sn)e.x=0,e.y=n.y;else{var s,l;switch(l=1-o*o*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/o+o/this.pn1),s=Math.sqrt(1-l*l),this.mode){case Qo.OBLIQ:e.y=Math.asin(s*this.sinph0+n.y*l*this.cosph0/o),n.y=(s-this.sinph0*Math.sin(e.y))*o,n.x*=l*this.cosph0;break;case Qo.EQUIT:e.y=Math.asin(n.y*l/o),n.y=s*o,n.x*=l;break;case Qo.N_POLE:e.y=Math.asin(s),n.y=-n.y;break;case Qo.S_POLE:e.y=-Math.asin(s);break}e.x=Math.atan2(n.x,n.y)}return n.x=e.x+this.long0,n.y=e.y,n}var yQ=["Tilted_Perspective","tpers"];const _Q={init:pQ,forward:gQ,inverse:mQ,names:yQ};function vQ(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var n=1-this.es,e=1/n;this.radius_p=Math.sqrt(n),this.radius_p2=n,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function bQ(n){var e=n.x,t=n.y,i,r,o,s;if(e=e-this.long0,this.shape==="ellipse"){t=Math.atan(this.radius_p2*Math.tan(t));var l=this.radius_p/Ya(this.radius_p*Math.cos(t),Math.sin(t));if(r=l*Math.cos(e)*Math.cos(t),o=l*Math.sin(e)*Math.cos(t),s=l*Math.sin(t),(this.radius_g-r)*r-o*o-s*s*this.radius_p_inv2<0)return n.x=Number.NaN,n.y=Number.NaN,n;i=this.radius_g-r,this.flip_axis?(n.x=this.radius_g_1*Math.atan(o/Ya(s,i)),n.y=this.radius_g_1*Math.atan(s/i)):(n.x=this.radius_g_1*Math.atan(o/i),n.y=this.radius_g_1*Math.atan(s/Ya(o,i)))}else this.shape==="sphere"&&(i=Math.cos(t),r=Math.cos(e)*i,o=Math.sin(e)*i,s=Math.sin(t),i=this.radius_g-r,this.flip_axis?(n.x=this.radius_g_1*Math.atan(o/Ya(s,i)),n.y=this.radius_g_1*Math.atan(s/i)):(n.x=this.radius_g_1*Math.atan(o/i),n.y=this.radius_g_1*Math.atan(s/Ya(o,i))));return n.x=n.x*this.a,n.y=n.y*this.a,n}function xQ(n){var e=-1,t=0,i=0,r,o,s,l;if(n.x=n.x/this.a,n.y=n.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),t=Math.tan(n.x/this.radius_g_1)*Ya(1,i)):(t=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*Ya(1,t));var u=i/this.radius_p;if(r=t*t+u*u+e*e,o=2*this.radius_g*e,s=o*o-4*r*this.C,s<0)return n.x=Number.NaN,n.y=Number.NaN,n;l=(-o-Math.sqrt(s))/(2*r),e=this.radius_g+l*e,t*=l,i*=l,n.x=Math.atan2(t,e),n.y=Math.atan(i*Math.cos(n.x)/e),n.y=Math.atan(this.radius_p_inv2*Math.tan(n.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),t=Math.tan(n.x/this.radius_g_1)*Math.sqrt(1+i*i)):(t=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*Math.sqrt(1+t*t)),r=t*t+i*i+e*e,o=2*this.radius_g*e,s=o*o-4*r*this.C,s<0)return n.x=Number.NaN,n.y=Number.NaN,n;l=(-o-Math.sqrt(s))/(2*r),e=this.radius_g+l*e,t*=l,i*=l,n.x=Math.atan2(t,e),n.y=Math.atan(i*Math.cos(n.x)/e)}return n.x=n.x+this.long0,n}var IQ=["Geostationary Satellite View","Geostationary_Satellite","geos"];const CQ={init:vQ,forward:bQ,inverse:xQ,names:IQ};var iv=1.340264,rv=-.081106,sv=893e-6,ov=.003796,EC=Math.sqrt(3)/2;function wQ(){this.es=0,this.long0=this.long0!==void 0?this.long0:0,this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0}function AQ(n){var e=dn(n.x-this.long0,this.over),t=n.y,i=Math.asin(EC*Math.sin(t)),r=i*i,o=r*r*r;return n.x=e*Math.cos(i)/(EC*(iv+3*rv*r+o*(7*sv+9*ov*r))),n.y=i*(iv+rv*r+o*(sv+ov*r)),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function SQ(n){n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a;var e=1e-9,t=12,i=n.y,r,o,s,l,u,h;for(h=0;h<t&&(r=i*i,o=r*r*r,s=i*(iv+rv*r+o*(sv+ov*r))-n.y,l=iv+3*rv*r+o*(7*sv+9*ov*r),i-=u=s/l,!(Math.abs(u)<e));++h);return r=i*i,o=r*r*r,n.x=EC*n.x*(iv+3*rv*r+o*(7*sv+9*ov*r))/Math.cos(i),n.y=Math.asin(Math.sin(i)/EC),n.x=dn(n.x+this.long0,this.over),n}var EQ=["eqearth","Equal Earth","Equal_Earth"];const TQ={init:wQ,forward:AQ,inverse:SQ,names:EQ};var Yv=1e-10;function RQ(){var n;if(this.phi1=this.lat1,Math.abs(this.phi1)<Yv)throw new Error;this.es?(this.en=PM(this.es),this.m1=Hy(this.phi1,this.am1=Math.sin(this.phi1),n=Math.cos(this.phi1),this.en),this.am1=n/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=kQ,this.forward=MQ):(Math.abs(this.phi1)+Yv>=Zt?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=PQ,this.forward=LQ)}function MQ(n){var e=dn(n.x-(this.long0||0),this.over),t=n.y,i,r,o;return i=this.am1+this.m1-Hy(t,r=Math.sin(t),o=Math.cos(t),this.en),r=o*e/(i*Math.sqrt(1-this.es*r*r)),n.x=i*Math.sin(r),n.y=this.am1-i*Math.cos(r),n.x=this.a*n.x+(this.x0||0),n.y=this.a*n.y+(this.y0||0),n}function kQ(n){n.x=(n.x-(this.x0||0))/this.a,n.y=(n.y-(this.y0||0))/this.a;var e,t,i,r;if(t=Ya(n.x,n.y=this.am1-n.y),r=GM(this.am1+this.m1-t,this.es,this.en),(e=Math.abs(r))<Zt)e=Math.sin(r),i=t*Math.atan2(n.x,n.y)*Math.sqrt(1-this.es*e*e)/Math.cos(r);else if(Math.abs(e-Zt)<=Yv)i=0;else throw new Error;return n.x=dn(i+(this.long0||0),this.over),n.y=Ef(r),n}function LQ(n){var e=dn(n.x-(this.long0||0),this.over),t=n.y,i,r;return r=this.cphi1+this.phi1-t,Math.abs(r)>Yv?(n.x=r*Math.sin(i=e*Math.cos(t)/r),n.y=this.cphi1-r*Math.cos(i)):n.x=n.y=0,n.x=this.a*n.x+(this.x0||0),n.y=this.a*n.y+(this.y0||0),n}function PQ(n){n.x=(n.x-(this.x0||0))/this.a,n.y=(n.y-(this.y0||0))/this.a;var e,t,i=Ya(n.x,n.y=this.cphi1-n.y);if(t=this.cphi1+this.phi1-i,Math.abs(t)>Zt)throw new Error;return Math.abs(Math.abs(t)-Zt)<=Yv?e=0:e=i*Math.atan2(n.x,n.y)/Math.cos(t),n.x=dn(e+(this.long0||0),this.over),n.y=Ef(t),n}var GQ=["bonne","Bonne (Werner lat_1=90)"];const FQ={init:RQ,names:GQ},NF={OBLIQUE:{forward:BQ,inverse:WQ},TRANSVERSE:{forward:ZQ,inverse:zQ}},TC={ROTATE:{o_alpha:"oAlpha",o_lon_c:"oLongC",o_lat_c:"oLatC"},NEW_POLE:{o_lat_p:"oLatP",o_lon_p:"oLongP"},NEW_EQUATOR:{o_lon_1:"oLong1",o_lat_1:"oLat1",o_lon_2:"oLong2",o_lat_2:"oLat2"}};function OQ(){if(this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.title=this.title||"General Oblique Transformation",this.isIdentity=E4.includes(this.o_proj),!this.o_proj)throw new Error("Missing parameter: o_proj");if(this.o_proj==="ob_tran")throw new Error("Invalid value for o_proj: "+this.o_proj);const n=this.projStr.replace("+proj=ob_tran","").replace("+o_proj=","+proj=").trim(),e=Jl(n);if(!e)throw new Error("Invalid parameter: o_proj. Unknown projection "+this.o_proj);e.long0=0,this.obliqueProjection=e;let t;const i=Object.keys(TC),r=l=>{if(typeof this[l]>"u")return;const u=parseFloat(this[l])*Ss;if(isNaN(u))throw new Error("Invalid value for "+l+": "+this[l]);return u};for(let l=0;l<i.length;l++){const u=i[l],h=TC[u],d=Object.entries(h);if(d.some(([y])=>typeof this[y]<"u")){t=h;for(let y=0;y<d.length;y++){const[x,C]=d[y],w=r(x);if(typeof w>"u")throw new Error("Missing parameter: "+x+".");this[C]=w}break}}if(!t)throw new Error("No valid parameters provided for ob_tran projection.");const{lamp:o,phip:s}=VQ(this,t);this.lamp=o,Math.abs(s)>sn?(this.cphip=Math.cos(s),this.sphip=Math.sin(s),this.projectionType=NF.OBLIQUE):this.projectionType=NF.TRANSVERSE}function NQ(n){return this.projectionType.forward(this,n)}function DQ(n){return this.projectionType.inverse(this,n)}function VQ(n,e){let t,i;if(e===TC.ROTATE){let r=n.oLongC,o=n.oLatC,s=n.oAlpha;if(Math.abs(Math.abs(o)-Zt)<=sn)throw new Error("Invalid value for o_lat_c: "+n.o_lat_c+" should be < 90");i=r+Math.atan2(-1*Math.cos(s),-1*Math.sin(s)*Math.sin(o)),t=Math.asin(Math.cos(o)*Math.sin(s))}else if(e===TC.NEW_POLE)i=n.oLongP,t=n.oLatP;else{let r=n.oLong1,o=n.oLat1,s=n.oLong2,l=n.oLat2,u=Math.abs(o);if(Math.abs(o)>Zt-sn)throw new Error("Invalid value for o_lat_1: "+n.o_lat_1+" should be < 90");if(Math.abs(l)>Zt-sn)throw new Error("Invalid value for o_lat_2: "+n.o_lat_2+" should be < 90");if(Math.abs(o-l)<sn)throw new Error("Invalid value for o_lat_1 and o_lat_2: o_lat_1 should be different from o_lat_2");if(u<sn)throw new Error("Invalid value for o_lat_1: o_lat_1 should be different from zero");i=Math.atan2(Math.cos(o)*Math.sin(l)*Math.cos(r)-Math.sin(o)*Math.cos(l)*Math.cos(s),Math.sin(o)*Math.cos(l)*Math.sin(s)-Math.cos(o)*Math.sin(l)*Math.sin(r)),t=Math.atan(-1*Math.cos(i-r)/Math.tan(o))}return{lamp:i,phip:t}}function BQ(n,e){let{x:t,y:i}=e;t+=n.long0;const r=Math.cos(t),o=Math.sin(i),s=Math.cos(i);e.x=dn(Math.atan2(s*Math.sin(t),n.sphip*s*r+n.cphip*o)+n.lamp),e.y=Math.asin(n.sphip*o-n.cphip*s*r);const l=n.obliqueProjection.forward(e);return n.isIdentity&&(l.x*=$a,l.y*=$a),l}function ZQ(n,e){let{x:t,y:i}=e;t+=n.long0;const r=Math.cos(i),o=Math.cos(t);e.x=dn(Math.atan2(r*Math.sin(t),Math.sin(i))+n.lamp),e.y=Math.asin(-1*r*o);const s=n.obliqueProjection.forward(e);return n.isIdentity&&(s.x*=$a,s.y*=$a),s}function WQ(n,e){n.isIdentity&&(e.x*=Ss,e.y*=Ss);const t=n.obliqueProjection.inverse(e);let{x:i,y:r}=t;if(i<Number.MAX_VALUE){i-=n.lamp;const o=Math.cos(i),s=Math.sin(r),l=Math.cos(r);e.x=Math.atan2(l*Math.sin(i),n.sphip*l*o-n.cphip*s),e.y=Math.asin(n.sphip*s+n.cphip*l*o)}return e.x=dn(e.x+n.long0),e}function zQ(n,e){n.isIdentity&&(e.x*=Ss,e.y*=Ss);const t=n.obliqueProjection.inverse(e);let{x:i,y:r}=t;if(i<Number.MAX_VALUE){const o=Math.cos(r);i-=n.lamp,e.x=Math.atan2(o*Math.sin(i),-1*Math.sin(r)),e.y=Math.asin(o*Math.cos(i))}return e.x=dn(e.x+n.long0),e}var UQ=["General Oblique Transformation","General_Oblique_Transformation","ob_tran"];const XQ={init:OQ,forward:NQ,inverse:DQ,names:UQ};function YQ(n){n.Proj.projections.add(gI),n.Proj.projections.add(mI),n.Proj.projections.add(G$),n.Proj.projections.add(z$),n.Proj.projections.add(K$),n.Proj.projections.add(Q$),n.Proj.projections.add(sJ),n.Proj.projections.add(cJ),n.Proj.projections.add(gJ),n.Proj.projections.add(bJ),n.Proj.projections.add(PJ),n.Proj.projections.add(VJ),n.Proj.projections.add(UJ),n.Proj.projections.add($J),n.Proj.projections.add(tq),n.Proj.projections.add(oq),n.Proj.projections.add(hq),n.Proj.projections.add(mq),n.Proj.projections.add(Iq),n.Proj.projections.add(Eq),n.Proj.projections.add(Lq),n.Proj.projections.add(Nq),n.Proj.projections.add(Uq),n.Proj.projections.add(jq),n.Proj.projections.add(eQ),n.Proj.projections.add(lQ),n.Proj.projections.add(fQ),n.Proj.projections.add(_Q),n.Proj.projections.add(CQ),n.Proj.projections.add(TQ),n.Proj.projections.add(FQ),n.Proj.projections.add(XQ)}const G0=Object.assign(J7,{defaultDatum:"WGS84",Proj:Jl,WGS84:new Jl("WGS84"),Point:My,toPoint:P4,defs:Po,nadgrid:P7,transform:wC,mgrs:q7,version:"__VERSION__"});YQ(G0);function X4(){G0.defs("EPSG:32632","+proj=utm +zone=32 +datum=WGS84 +units=m +no_defs"),G0.defs("EPSG:32631","+proj=utm +zone=31 +datum=WGS84 +units=m +no_defs"),G0.defs("EPSG:2169","+proj=tmerc +lat_0=49.83333333333334 +lon_0=6.166666666666667 +k=1 +x_0=80000 +y_0=100000 +ellps=intl +towgs84=-189.681,18.3463,-42.7695,-0.33746,-3.09264,2.53861,0.4598 +units=m +no_defs"),Wj(G0),Ni("EPSG:32632")?.setExtent([166021.44,0,833978.55,932900518e-2]),Ni("EPSG:32631")?.setExtent([166021.44,0,833978.55,932900518e-2]),Ni("EPSG:2169")?.setExtent([48225.17,56225.6,105842.04,139616.4])}const HQ="main",KQ="root_3d",jQ=-222,Zr=ca("config",()=>{const n=mi(),e=Ue(HQ),t=Ct(()=>n.value?.themes),i=Ct(()=>t.value?.find(h=>h.name===e.value)),r=Ct(()=>n.value?.background_layers||[]),o=Ct(()=>{const h=t.value?.filter(d=>d.metadata?.ol3d_type!==void 0);if(h)return{name:KQ,id:jQ,children:h.flatMap(d=>d?.children?d.children:d),metadata:{}}});function s(h){n.value=h}function l(h){e.value=decodeURIComponent(h)}async function u(){const d="https://migration.geoportail.lu/".replace(/\/$/,""),m=Date.now(),y=d?`${d}/themes?interface=main&background=background&cache_version=${m}`:`/themes?interface=main&background=background&cache_version=${m}`;try{const x=await fetch(y,{credentials:"include"});if(!x.ok)throw new Error(`Failed to fetch themes: ${x.status}`);const C=await x.json();if(!Array.isArray(C?.themes)||C.themes.length===0)return;s(C)}catch{}}return{config:n,themes:t,themeName:e,theme:i,bgLayers:r,layerTrees_3d:o,setTheme:l,setThemes:s,loadThemes:u}},{}),Y4="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAM0AAAAoCAMAAABq645qAAACPVBMVEUAAABaW13////tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy5DjxTaAAAAvXRSTlMAAAABAgMEBQYHCAkKCwwNDg8QERESFBUWFxkaGx0eHyAhIiInKSosMTIzNTY5Ojs8PUFCQ0RERkpMTk9QU1RVVldaXmFjZWZmamtwcXJzdXd3eHl7fX+AgYKDhIaHiIiKi4yOj5CTlJWWl5iZmZqcnZ+goaKjpKanqKqqq6ywsbK0tbW4u7u8vb6/wMHExcbHysvMzM7P0NDS1NXa29zd3t/g4eTl5ujp6uvs7e7u8PLz9PX29/j5+vv8/f5cALqzAAAEcklEQVRo3u3Z+ZPUVBAH8O63LsLKijoIgotHFI+HgiKNeGC8MCqgUUFAJYjgAQ6HKMgGEQQiqChIPFh1iciiwPIEhvv49t/mD5lBORa2tHbLTO2rmqnUTCrJZ3r65ZuEjDHGGLrMWGcKMah7mh/7NP8PzXBqbqgfzdtPb7i/fjQPvq8r5jUVXNNIY4moYeL6+XNfn9Ov6LUZ2/Z7Pxo3YaZWTp/uLPw/reXYbqLRPz/38g+qJ/oTEV396IzmgmquXHZoIRHd/sTs31T1DqIBcyqHZjQWtTbf6nQiokHLVVWn7ju4euXGjsX9LtTAGgPAGGMzOPZSOGFYtmAXsO8skFkgZovQgi2QcZKyIGAAjJQtIgAB/5vRTc2IvbqSqOWNJQdUVdfe+/zitmsu2jeQ/GWMC43HacRhxhAWcJRyEgmYBSVYgROwgJkzeGVEDGEGotqnPaih1Xp63KSvVFVVtz0wt23AvMVda5AZY2FM7OWO/N2DwBMgESBiQZyABUgYSYQkYSBjhAh7QXN3Zfey7YdyzXh6aQpdu2fIpWsD30CykKOU4XPgmBPEnNcmC1jgIT9uCx9ZkOW1kQi9oBm6aMvO3KIVomUPES19/KIaoNo34uA8cUgtB4DzmQXCFoCFhbXgMtgC8DNGKMj7xnIKtj2toeGf55X5c9+ZRpo1lWjyq5c/33Avj+5obpz25miiwd+p6q4/2jfvIrqtrYlemF5MzZObTuhHCw6cUd2y/91ftj5DRJOn0JKniqm56jPtUNXDx44u6NywvaPzPqL+G5v3jCimhhqaX/vyi6VTxtzyYkVV9dSsRvrmnVXUI5oo7GkNEV2RH/igaRVV1Y8fOdE+tEc0tlzqBU1tND+7U1W18t51F8/QAFJrkUccL4VjABFb+MwoMyznszWzBZxfDT2SIbZgm0/TzBbIpLqcr8GwScJxfF4UiliAgGEZ1gKx8VK4bmuafmpdrqr6cFdXBJBSORPkp9A0ZI8hAi4jYQY8CEN8MDML2K/FBBdwKU80kOp3eSBirq7BkJJLstK5UShw+eYhDBGUYNPQeN3WTND2rd+r6oquNUZQ00A49gCEJQg8RhJD8j0DQX6IEBZYMLMAAANZrpHa8lkNBwjOi0Ion90KRIDIQEzsdVfzlurhT1X11F2XqE3qwfNQMiYLGYIYNgAQMcTltXHV3z9w1dAD/8LapH/XJt9eycWudG4U8lGrjYeSIAtMFlaD1SU1NxAR0cA9qrpqr6ruaOmybxLPREBojLEOzoMNkAXsO4YNYRnIpNo3WS30+EByXt+kttY3AEdAyGmZ4/TcKORCDgDhEAg5D0wO7vK1mbmwhajxA9XWkXTTh8dVj6wZX9gr6ZFL9eTm1nbVhUREdOs2Vb25sJqmRTuOq+r+rwfmgGEHVYcU+H7a8KNrdP6kYTXBJ6qPFVjT2DxwzD/msbWqE+vnrvqvevSeutGMUm0dXC+ahk3asb5unt+8cvLIqOvr52nU7Dv7nq31afo0/0mzrhiavwAx1n2SsZnMdgAAAABJRU5ErkJggg==",$Q="fr",JQ=!0,qQ=!1,QQ=!1,eee=!1,tee=!1,nee=!1,iee=!1,ree=!1,see=!1,oee=!1,aee=!1,lee=!1,uee=!1,Jn=ca("app",()=>{const n=Ue(!1),e=Ue(!1),t=Ue($Q),i=Ue(JQ),r=Ue(qQ),o=Ue(QQ),s=Ue(eee),l=Ue(),u=Ue(void 0),h=Ue(!1),d=Ue(!1),m=Ue(tee),y=Ue(nee),x=Ue(lee),C=Ue(aee),w=Ue(iee),E=Ue(ree),T=Ue(see),k=Ue(oee),G=Ue(),O=Ue(!1),V=Ue(void 0),z=Ue(!1),H=Ue(!1),te=Ue(!1),$=Ue(!1),ae=Ue(!1),fe=Ue(!1),Y=Ue(uee);function de(ve){fe.value=ve}function D(ve){t.value=ve}function oe(ve){i.value=ve}function ue(ve){o.value=ve,o.value&&(s.value=!1,r.value=!1)}function ge(ve){s.value=ve,s.value&&(O.value=!1,r.value=!1)}function Ne(){s.value?(i.value=!1,r.value=!1,m.value=!1,s.value=!1,C.value=!1):(s.value=!0,i.value=!0,r.value=!1,m.value=!1,y.value=!1,C.value=!1,O.value=!1,o.value&&(o.value=!1))}function Ee(ve){G.value=ve}function se(){O.value=!0,i.value=!1}function q(){O.value=!1,i.value=!0}function j(ve){n.value=ve??!n.value}function ze(ve){z.value=ve??!z.value}function je(ve){m.value=ve??!m.value}function qe(ve){r.value=ve??!r.value}function yt(ve){y.value=ve??!y.value}function xt(ve){x.value=ve??!x.value,x.value&&(z.value=!1,H.value=!1,$.value=!1)}function Et(ve){C.value=ve??!C.value}function kt(ve){$.value=ve??!$.value}function hn(ve){te.value=ve??!te.value}function wn(ve){w.value=ve??!w.value}function Ge(ve){Y.value=ve??!Y.value}return{authFormOpened:n,embedded:e,lang:t,layersOpen:i,legendsOpen:r,myLayersTabOpen:o,themeGridOpen:s,myMapId:l,myMap:u,myMapIsLoading:h,myMapLayersChanged:d,myMapsOpen:m,infoOpen:y,shareOpen:x,lidarOpen:C,feedbackOpen:w,feedbackanfOpen:E,feedbackageOpen:T,feedbackcruesOpen:k,styleEditorOpen:O,styleEditorOpenedSection:V,remoteLayersOpen:G,drawToolbarOpen:z,measureToolbarOpen:H,routingPanelOpen:Y,elevationProfileToolbarOpen:te,isOffLine:ae,isApp:fe,printToolbarOpen:$,setIsApp:de,setLang:D,setLayersOpen:oe,setMyLayersTabOpen:ue,setThemeGridOpen:ge,setRemoteLayersOpen:Ee,openStyleEditorPanel:se,closeStyleEditorPanel:q,toggleAuthFormOpen:j,toggleDrawToolbarOpen:ze,togglePrintToolbarOpen:kt,toggleMyMapsOpen:je,toggleInfoOpen:yt,toggleShareOpen:xt,toggleLidarOpen:Et,toggleThemeGrid:Ne,toggleLegendsOpen:qe,toggleElevationProfileToolbarOpen:hn,toggleFeedbackOpen:wn,toggleRoutingOpen:Ge}},{}),iu=ca("user-manager",()=>{const n=Jn(),{isOffLine:e}=It(n),t=Ue(void 0),i=Ct(()=>e.value||!!t.value);function r(){return i.value}function o(l){if(l.login)t.value=l;else throw s(),new Error("Invalid username or password")}function s(){t.value=void 0}return{authenticated:i,currentUser:t,clearUser:s,isAuthenticated:r,setCurrentUser:o}},{}),hS="include",cee="https://migration.geoportail.lu/login",hee="https://migration.geoportail.lu/logout",dee="https://migration.geoportail.lu/getuserinfo";class fee{async authenticate(e,t,i=!1){const r=new URLSearchParams({login:e,password:t,app:i?"true":"false"}),o=await fetch(cee,{method:"POST",credentials:hS,headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r});if(!o.ok)throw new Error("Error while trying to authenticate user");const s=await o.json();return this.mapUserApiToUser(s)}async logout(){const e=await fetch(hee,{credentials:hS});if(!e.ok)throw new Error("Error while trying to logout user");return await e.text()}async getUserInfo(){const e=new URLSearchParams({}),t=await fetch(dee,{method:"POST",credentials:hS,headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e}),i=t.ok&&await t.json();if(!i.login)throw new Error("Error while trying to get user info");return this.mapUserApiToUser(i)}mapUserApiToUser(e){const{is_admin:t,login:i,mail:r,mymaps_role:o,role:s,role_id:l,sn:u,typeUtilisateur:h}=e;return{login:i,mail:r,isAdmin:t,mymapsRole:o,name:u,role:s,roleId:l,sn:u,typeUtilisateur:h}}}const dS=new fee;var ko=[];for(var fS=0;fS<256;++fS)ko.push((fS+256).toString(16).slice(1));function pee(n,e=0){return(ko[n[e+0]]+ko[n[e+1]]+ko[n[e+2]]+ko[n[e+3]]+"-"+ko[n[e+4]]+ko[n[e+5]]+"-"+ko[n[e+6]]+ko[n[e+7]]+"-"+ko[n[e+8]]+ko[n[e+9]]+"-"+ko[n[e+10]]+ko[n[e+11]]+ko[n[e+12]]+ko[n[e+13]]+ko[n[e+14]]+ko[n[e+15]]).toLowerCase()}var mx,gee=new Uint8Array(16);function mee(){if(!mx&&(mx=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!mx))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mx(gee)}var yee=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const DF={randomUUID:yee};function Hv(n,e,t){if(DF.randomUUID&&!n)return DF.randomUUID();n=n||{};var i=n.random||(n.rng||mee)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,pee(i)}var ii=(n=>(n.INFO="alert-info",n.WARNING="alert-warning",n.ERROR="alert-danger",n))(ii||{});class _ee{constructor(e,t,i,r,o){this.uuid=e,this.message=t,this.type=i,this.duration=r,this.timer=o,this.start()}timeoutID;start(){this.timer&&(this.timeoutID=setTimeout(()=>this.timer(this.uuid),this.duration))}cancel(){clearTimeout(this.timeoutID)}}const vee=ii.INFO,bee=7e3,xee=4e3,Qr=ca("alert-notifications",()=>{const n=Ue([]);function e(i,r=vee,o){o=o??(r===ii.WARNING?xee:bee);const s=new _ee(Hv(),i,r,o,l=>t(l));return n.value.push(s),s.uuid}function t(i){n.value=n.value.filter(r=>(r.uuid===i&&r.cancel(),r.uuid!==i))}return{notifications:n,addNotification:e,removeNotification:t}},{}),Iee={"data-cy":"authForm",class:"lux-account bg-secondary"},Cee={class:"lux-panel-title pt-5 mb-5 pl-5 h-16 shrink-0 flex justify-between"},wee={class:"lux-account-content"},Aee={class:"flex flex-col gap-2 mb-2"},See=["placeholder"],Eee=["placeholder"],Tee={class:"flex mt-3 items-center"},Ree={class:"grow leading-5"},Mee=["href"],kee=["href"],Lee=["value"],Pee={key:1},Gee={class:"flex flex-col gap-[1px] mb-2 text-white"},Fee={class:"bg-secondary py-1 px-3"},Oee={class:"bg-secondary py-1 px-3"},Nee={class:"flex items-center gap-3 justify-end"},Dee=["href"],Vee=at({__name:"auth-form",setup(n){const e="https://myaccount.geoportail.lu",t="https://myaccount.geoportail.lu/recover-password",i="https://myaccount.geoportail.lu/new-user",{t:r}=St(),{addNotification:o}=Qr(),{lang:s,isApp:l}=It(Jn()),u=Zr(),h=iu(),{setCurrentUser:d,clearUser:m}=h,{authenticated:y,currentUser:x}=It(h),C=Ue(!1),w=Ue(""),E=Ue("");Pt(y,z=>{!C.value&&z&&o(r("Vous tes maintenant correctement connect."))}),sr(()=>{dS.getUserInfo().then(z=>{C.value=!0,G(z)}).catch(()=>{})});function T(){dS.logout().then(()=>{m(),u.loadThemes()}).catch(()=>o(r("Une erreur est survenue durant la dconnexion."),ii.ERROR)),V()}function k(){dS.authenticate(w.value,E.value,l.value).then(z=>{C.value=!1,G(z)}).catch(O),V()}function G(z){d(z),C.value||u.loadThemes()}function O(){o(r("Invalid username or password."),ii.WARNING),m()}function V(){w.value="",E.value=""}return(z,H)=>(U(),ie("div",Iee,[P("h4",Cee,K(M(r)("My account")),1),P("fieldset",null,[H[2]||(H[2]=P("legend",{class:"lux-account-tab"},null,-1)),P("div",wee,[M(y)?(U(),ie("div",Pee,[P("div",Gee,[P("div",Fee,K(M(x)?.login),1),P("div",Oee,K(M(x)?.mail),1)]),P("div",Nee,[P("div",null,[P("a",{class:"text-secondary hover:underline hover:text-white",target:"_blank",href:`${M(e)}?lang=${M(s)}`},K(M(r)("My account")),9,Dee)]),P("div",null,[P("button",{class:"lux-btn",onClick:T},K(M(r)("Logout")),1)])])])):(U(),ie("form",{key:0,onSubmit:ps(k,["prevent"])},[P("div",Aee,[P("div",null,[An(P("input",{class:"w-full lux-input h-11",type:"text",name:"userName","onUpdate:modelValue":H[0]||(H[0]=te=>w.value=te),placeholder:M(r)("Username"),required:""},null,8,See),[[Or,w.value]])]),P("div",null,[An(P("input",{class:"w-full lux-input h-11",type:"password",name:"userPassword","onUpdate:modelValue":H[1]||(H[1]=te=>E.value=te),placeholder:M(r)("Password"),required:""},null,8,Eee),[[Or,E.value]])])]),P("div",Tee,[P("div",Ree,[P("p",null,[P("a",{"data-cy":"authFormLostPwd",class:"text-secondary hover:underline hover:text-white",target:"_blank",href:M(t)},K(M(r)("I lost my password")),9,Mee)]),P("p",null,[P("a",{"data-cy":"authFormNewAccount",class:"text-secondary hover:underline hover:text-white",target:"_blank",href:M(i)},K(M(r)("Create a new user account")),9,kee)])]),P("div",null,[P("input",{class:"lux-btn h-11 w-24 text-white placeholder:italic bg-secondary border-none uppercase hover:text-primary hover:bg-secondary",type:"submit",value:M(r)("Submit")},null,8,Lee)])])],32))])])]))}}),Bee={class:"h-full w-full"},Zee=["aria-expanded"],Wee=["title"],zee={class:"lux-dropdown-wrapper",ref:"dropdownWrapperDOM"},Uee=at({__name:"dropdown-content",props:{placeholder:{},enableClickOutside:{type:Boolean,default:!0},isOpen:{type:Boolean,default:!1},direction:{}},emits:["toggleDropdown"],setup(n,{emit:e}){const t=n,i=e,r=mi(t.isOpen);Pt(()=>t.isOpen,d=>{r.value=d});function o(d){r.value=d===void 0?!r.value:d,i("toggleDropdown",r.value)}function s(d){d.stopImmediatePropagation(),o()}function l(){o(!1)}const u=Ue(null),h=Ue("");return sr(()=>{t.enableClickOutside&&document.addEventListener("click",l),h.value=u.value?"lux-btn-"+getComputedStyle(u.value).getPropertyValue("--button-theme"):""}),Ms(()=>t.enableClickOutside&&document.removeEventListener("click",l)),(d,m)=>(U(),ie("div",DR({class:"lux-dropdown"},d.$attrs,{ref_key:"root",ref:u}),[P("div",Bee,[P("button",{type:"button",class:Rn(["lux-btn lux-dropdown-btn flex items-center text-ellipsis max-w-full",[r.value?"expanded":"",h.value]]),"aria-expanded":r.value,"aria-haspopup":"true",onClick:s},[P("span",{class:"grow text-left text-ellipsis max-w-full overflow-hidden text-nowrap",title:t.placeholder},K(t.placeholder),9,Wee),P("span",{class:Rn(["lux-caret ml-1",{up:n.direction==="up"}])},null,2)],10,Zee)]),P("div",zee,[P("div",{class:Rn(["lux-dropdown-content",r.value?"":"hidden"]),tabindex:"-1"},[ei(d.$slots,"default",{},void 0,!0)],2)],512)],16))}}),es=(n,e)=>{const t=n.__vccOpts||n;for(const[i,r]of e)t[i]=r;return t},H4=es(Uee,[["__scopeId","data-v-22e52595"]]),Xee=["data-cy"],Yee=["aria-label","data-value"],ig=at({__name:"dropdown-list",props:{placeholder:{},options:{default:()=>[{label:"Default label",value:"Default value"}]},modelValue:{},direction:{default:"down"}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,r=mi(),o=sN(t.direction);function s(u){u.preventDefault(),r.value=u.target.dataset.value,i("change",r.value)}function l(){return t.modelValue!==void 0?t.options.find(u=>u.value===t.modelValue)?.label:t.placeholder}return(u,h)=>(U(),Gt(H4,DR({placeholder:l(),direction:o.value},u.$attrs),{default:Wt(()=>[P("ul",{class:Rn(["lux-dropdown-list",o.value])},[(U(!0),ie(Mt,null,hi(t.options,d=>(U(),ie("li",{key:d.value,class:Rn(n.modelValue===d.value?"selected":""),"data-cy":`dropdownItem-${d.value}`},[P("button",{class:"lux-dropdown-list-item","aria-label":d.ariaLabel,"data-value":d.value,onClick:s},K(d.label),9,Yee)],10,Xee))),128))],2)]),_:1},16,["placeholder","direction"]))}});function Hee(n){return{fr:"fre",en:"eng",de:"ger",lb:"ltz"}[n.toLowerCase()]}function Kee(n){return new DOMParser().parseFromString(n,"text/html").body}function jee(n){const e=[];function t(i){if(!i)return;const r=i.split("|");r[3]==="WWW:LINK-1.0-http--link"&&e.indexOf(r[2])===-1&&e.push(r[2])}return Array.isArray(n)?n.forEach(t,n):t(n),e}function $ee(n){const t=(Array.isArray(n)?n:[n]).filter(i=>{const r=i.split("|")[1];return r==="metadata"||r==="resource"});return t.length===0?{organisaton:"",name:"",unknown:"",address:"",email:""}:{organisaton:t[0].split("|")[2],name:t[0].split("|")[5],unknown:t[0].split("|")[6],address:t[0].split("|")[7],email:t[0].split("|")[4]}}const Jee="/";var K4=(n=>(n.PNG="image/png",n.JPG="image/jpeg",n))(K4||{}),kh=(n=>(n.VALUE="value",n.RANGE="range",n))(kh||{}),_I=(n=>(n.DATEPICKER="datepicker",n.SLIDER="slider",n))(_I||{});class j4{drawCustom(e,t,i,r,o){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,i){}drawFeature(e,t,i){}drawGeometryCollection(e,t,i){}drawLineString(e,t,i){}drawMultiLineString(e,t,i){}drawMultiPoint(e,t,i){}drawMultiPolygon(e,t,i){}drawPoint(e,t,i){}drawPolygon(e,t,i){}drawText(e,t,i){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const Xn={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},yx=[Xn.FILL],Qd=[Xn.STROKE],Gp=[Xn.BEGIN_PATH],VF=[Xn.CLOSE_PATH];class Sb extends j4{constructor(e,t,i,r){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,o=this.coordinates;let s=o.length;for(let l=0,u=e.length;l<u;l+=t)r[0]=e[l],r[1]=e[l+1],Pc(i,r)&&(o[s++]=r[0],o[s++]=r[1]);return s}appendFlatLineCoordinates(e,t,i,r,o,s){const l=this.coordinates;let u=l.length;const h=this.getBufferedMaxExtent();s&&(t+=r);let d=e[t],m=e[t+1];const y=this.tmpCoordinate_;let x=!0,C,w,E;for(C=t+r;C<i;C+=r)y[0]=e[C],y[1]=e[C+1],E=BE(h,y),E!==w?(x&&(l[u++]=d,l[u++]=m,x=!1),l[u++]=y[0],l[u++]=y[1]):E===Co.INTERSECTING?(l[u++]=y[0],l[u++]=y[1],x=!1):x=!0,d=y[0],m=y[1],w=E;return(o&&x||C===t+r)&&(l[u++]=d,l[u++]=m),u}drawCustomCoordinates_(e,t,i,r,o){for(let s=0,l=i.length;s<l;++s){const u=i[s],h=this.appendFlatLineCoordinates(e,t,u,r,!1,!1);o.push(h),t=u}return t}drawCustom(e,t,i,r,o){this.beginGeometry(e,t,o);const s=e.getType(),l=e.getStride(),u=this.coordinates.length;let h,d,m,y,x;switch(s){case"MultiPolygon":h=e.getOrientedFlatCoordinates(),y=[];const C=e.getEndss();x=0;for(let w=0,E=C.length;w<E;++w){const T=[];x=this.drawCustomCoordinates_(h,x,C[w],l,T),y.push(T)}this.instructions.push([Xn.CUSTOM,u,y,e,i,jE,o]),this.hitDetectionInstructions.push([Xn.CUSTOM,u,y,e,r||i,jE,o]);break;case"Polygon":case"MultiLineString":m=[],h=s=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),x=this.drawCustomCoordinates_(h,0,e.getEnds(),l,m),this.instructions.push([Xn.CUSTOM,u,m,e,i,Fv,o]),this.hitDetectionInstructions.push([Xn.CUSTOM,u,m,e,r||i,Fv,o]);break;case"LineString":case"Circle":h=e.getFlatCoordinates(),d=this.appendFlatLineCoordinates(h,0,h.length,l,!1,!1),this.instructions.push([Xn.CUSTOM,u,d,e,i,jd,o]),this.hitDetectionInstructions.push([Xn.CUSTOM,u,d,e,r||i,jd,o]);break;case"MultiPoint":h=e.getFlatCoordinates(),d=this.appendFlatPointCoordinates(h,l),d>u&&(this.instructions.push([Xn.CUSTOM,u,d,e,i,jd,o]),this.hitDetectionInstructions.push([Xn.CUSTOM,u,d,e,r||i,jd,o]));break;case"Point":h=e.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),d=this.coordinates.length,this.instructions.push([Xn.CUSTOM,u,d,e,i,void 0,o]),this.hitDetectionInstructions.push([Xn.CUSTOM,u,d,e,r||i,void 0,o]);break}this.endGeometry(t)}beginGeometry(e,t,i){this.beginGeometryInstruction1_=[Xn.BEGIN_GEOMETRY,t,0,e,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Xn.BEGIN_GEOMETRY,t,0,e,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let r,o,s=-1;for(t=0;t<i;++t)r=e[t],o=r[0],o==Xn.END_GEOMETRY?s=t:o==Xn.BEGIN_GEOMETRY&&(r[2]=t,YY(this.hitDetectionInstructions,s,t),s=-1)}fillStyleToState(e,t={}){if(e){const i=e.getColor();t.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,t.fillStyle=xc(i||za)}else t.fillStyle=void 0;return t}strokeStyleToState(e,t={}){if(e){const i=e.getColor();t.strokeStyle=xc(i||Dv);const r=e.getLineCap();t.lineCap=r!==void 0?r:Ty;const o=e.getLineDash();t.lineDash=o?o.slice():Vh;const s=e.getLineDashOffset();t.lineDashOffset=s||Bh;const l=e.getLineJoin();t.lineJoin=l!==void 0?l:Ry;const u=e.getWidth();t.lineWidth=u!==void 0?u:Bv;const h=e.getMiterLimit();t.miterLimit=h!==void 0?h:Nv,t.lineWidth>this.maxLineWidth&&(this.maxLineWidth=t.lineWidth,this.bufferedMaxExtent_=null)}else t.strokeStyle=void 0,t.lineCap=void 0,t.lineDash=null,t.lineDashOffset=void 0,t.lineJoin=void 0,t.lineWidth=void 0,t.miterLimit=void 0;return t}setFillStrokeStyle(e,t){const i=this.state;this.fillStyleToState(e,i),this.strokeStyleToState(t,i)}createFill(e){const t=e.fillStyle,i=[Xn.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(e.fillPatternScale),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[Xn.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,r=e.lineCap,o=e.lineDash,s=e.lineDashOffset,l=e.lineJoin,u=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=r||o!=e.currentLineDash&&!id(e.currentLineDash,o)||e.currentLineDashOffset!=s||e.currentLineJoin!=l||e.currentLineWidth!=u||e.currentMiterLimit!=h)&&(t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=r,e.currentLineDash=o,e.currentLineDashOffset=s,e.currentLineJoin=l,e.currentLineWidth=u,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[Xn.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=uD(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;Kh(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class qee extends Sb{constructor(e,t,i,r){super(e,t,i,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,i){if(!this.image_||this.maxExtent&&!Pc(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,i);const r=e.getFlatCoordinates(),o=e.getStride(),s=this.coordinates.length,l=this.appendFlatPointCoordinates(r,o);this.instructions.push([Xn.DRAW_IMAGE,s,l,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Xn.DRAW_IMAGE,s,l,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,i){if(!this.image_)return;this.beginGeometry(e,t,i);const r=e.getFlatCoordinates(),o=[];for(let u=0,h=r.length;u<h;u+=e.getStride())(!this.maxExtent||Pc(this.maxExtent,r.slice(u,u+2)))&&o.push(r[u],r[u+1]);const s=this.coordinates.length,l=this.appendFlatPointCoordinates(o,2);this.instructions.push([Xn.DRAW_IMAGE,s,l,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Xn.DRAW_IMAGE,s,l,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),r=e.getSize(),o=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=e.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=r[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class Qee extends Sb{constructor(e,t,i,r){super(e,t,i,r)}drawFlatCoordinates_(e,t,i,r){const o=this.coordinates.length,s=this.appendFlatLineCoordinates(e,t,i,r,!1,!1),l=[Xn.MOVE_TO_LINE_TO,o,s];return this.instructions.push(l),this.hitDetectionInstructions.push(l),i}drawLineString(e,t,i){const r=this.state,o=r.strokeStyle,s=r.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Vh,Bh],Gp);const l=e.getFlatCoordinates(),u=e.getStride();this.drawFlatCoordinates_(l,0,l.length,u),this.hitDetectionInstructions.push(Qd),this.endGeometry(t)}drawMultiLineString(e,t,i){const r=this.state,o=r.strokeStyle,s=r.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Vh,Bh],Gp);const l=e.getEnds(),u=e.getFlatCoordinates(),h=e.getStride();let d=0;for(let m=0,y=l.length;m<y;++m)d=this.drawFlatCoordinates_(u,d,l[m],h);this.hitDetectionInstructions.push(Qd),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(Qd),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(Qd),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Gp)}}class BF extends Sb{constructor(e,t,i,r){super(e,t,i,r)}drawFlatCoordinatess_(e,t,i,r){const o=this.state,s=o.fillStyle!==void 0,l=o.strokeStyle!==void 0,u=i.length;this.instructions.push(Gp),this.hitDetectionInstructions.push(Gp);for(let h=0;h<u;++h){const d=i[h],m=this.coordinates.length,y=this.appendFlatLineCoordinates(e,t,d,r,!0,!l),x=[Xn.MOVE_TO_LINE_TO,m,y];this.instructions.push(x),this.hitDetectionInstructions.push(x),l&&(this.instructions.push(VF),this.hitDetectionInstructions.push(VF)),t=d}return s&&(this.instructions.push(yx),this.hitDetectionInstructions.push(yx)),l&&(this.instructions.push(Qd),this.hitDetectionInstructions.push(Qd)),t}drawCircle(e,t,i){const r=this.state,o=r.fillStyle,s=r.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_FILL_STYLE,za]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Vh,Bh]);const l=e.getFlatCoordinates(),u=e.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(l,0,l.length,u,!1,!1);const d=[Xn.CIRCLE,h];this.instructions.push(Gp,d),this.hitDetectionInstructions.push(Gp,d),r.fillStyle!==void 0&&(this.instructions.push(yx),this.hitDetectionInstructions.push(yx)),r.strokeStyle!==void 0&&(this.instructions.push(Qd),this.hitDetectionInstructions.push(Qd)),this.endGeometry(t)}drawPolygon(e,t,i){const r=this.state,o=r.fillStyle,s=r.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_FILL_STYLE,za]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Vh,Bh]);const l=e.getEnds(),u=e.getOrientedFlatCoordinates(),h=e.getStride();this.drawFlatCoordinatess_(u,0,l,h),this.endGeometry(t)}drawMultiPolygon(e,t,i){const r=this.state,o=r.fillStyle,s=r.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_FILL_STYLE,za]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Vh,Bh]);const l=e.getEndss(),u=e.getOrientedFlatCoordinates(),h=e.getStride();let d=0;for(let m=0,y=l.length;m<y;++m)d=this.drawFlatCoordinatess_(u,d,l[m],h);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,r=t.length;i<r;++i)t[i]=Cp(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;this.updateFillStyle(e,this.createFill),this.updateStrokeStyle(e,this.applyStroke)}}function ete(n,e,t,i,r){const o=[];let s=t,l=0,u=e.slice(t,2);for(;l<n&&s+r<i;){const[h,d]=u.slice(-2),m=e[s+r],y=e[s+r+1],x=Math.sqrt((m-h)*(m-h)+(y-d)*(y-d));if(l+=x,l>=n){const C=(n-l+x)/x,w=yl(h,m,C),E=yl(d,y,C);u.push(w,E),o.push(u),u=[w,E],l==n&&(s+=r),l=0}else if(l<n)u.push(e[s+r],e[s+r+1]),s+=r;else{const C=x-l,w=yl(h,m,C/x),E=yl(d,y,C/x);u.push(w,E),o.push(u),u=[w,E],l=0,s+=r}}return l>0&&o.push(u),o}function tte(n,e,t,i,r){let o=t,s=t,l=0,u=0,h=t,d,m,y,x,C,w,E,T,k,G;for(m=t;m<i;m+=r){const O=e[m],V=e[m+1];C!==void 0&&(k=O-C,G=V-w,x=Math.sqrt(k*k+G*G),E!==void 0&&(u+=y,d=Math.acos((E*k+T*G)/(y*x)),d>n&&(u>l&&(l=u,o=h,s=m),u=0,h=m-r)),y=x,E=k,T=G),C=O,w=V}return u+=x,u>l?[h,m]:[o,s]}const RC={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class nte extends Sb{constructor(e,t,i,r){super(e,t,i,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[za]={fillStyle:za},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,i){const r=this.textFillState_,o=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!r&&!o)return;const l=this.coordinates;let u=l.length;const h=e.getType();let d=null,m=e.getStride();if(s.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!Zs(this.maxExtent,e.getExtent()))return;let y;if(d=e.getFlatCoordinates(),h=="LineString")y=[d.length];else if(h=="MultiLineString")y=e.getEnds();else if(h=="Polygon")y=e.getEnds().slice(0,1);else if(h=="MultiPolygon"){const E=e.getEndss();y=[];for(let T=0,k=E.length;T<k;++T)y.push(E[T][0])}this.beginGeometry(e,t,i);const x=s.repeat,C=x?void 0:s.textAlign;let w=0;for(let E=0,T=y.length;E<T;++E){let k;x?k=ete(x*this.resolution,d,w,y[E],m):k=[d.slice(w,y[E])];for(let G=0,O=k.length;G<O;++G){const V=k[G];let z=0,H=V.length;if(C==null){const $=tte(s.maxAngle,V,0,V.length,2);z=$[0],H=$[1]}for(let $=z;$<H;$+=m)l.push(V[$],V[$+1]);const te=l.length;w=y[E],this.drawChars_(u,te),u=te}}this.endGeometry(t)}else{let y=s.overflow?null:[];switch(h){case"Point":case"MultiPoint":d=e.getFlatCoordinates();break;case"LineString":d=e.getFlatMidpoint();break;case"Circle":d=e.getCenter();break;case"MultiLineString":d=e.getFlatMidpoints(),m=2;break;case"Polygon":d=e.getFlatInteriorPoint(),s.overflow||y.push(d[2]/this.resolution),m=3;break;case"MultiPolygon":const O=e.getFlatInteriorPoints();d=[];for(let V=0,z=O.length;V<z;V+=3)s.overflow||y.push(O[V+2]/this.resolution),d.push(O[V],O[V+1]);if(d.length===0)return;m=2;break}const x=this.appendFlatPointCoordinates(d,m);if(x===u)return;if(y&&(x-u)/2!==d.length/m){let O=u/2;y=y.filter((V,z)=>{const H=l[(O+z)*2]===d[z*m]&&l[(O+z)*2+1]===d[z*m+1];return H||--O,H})}this.saveTextStates_();const C=s.backgroundFill?this.createFill(this.fillStyleToState(s.backgroundFill)):null,w=s.backgroundStroke?this.createStroke(this.strokeStyleToState(s.backgroundStroke)):null;this.beginGeometry(e,t,i);let E=s.padding;if(E!=Pp&&(s.scale[0]<0||s.scale[1]<0)){let O=s.padding[0],V=s.padding[1],z=s.padding[2],H=s.padding[3];s.scale[0]<0&&(V=-V,H=-H),s.scale[1]<0&&(O=-O,z=-z),E=[O,V,z,H]}const T=this.pixelRatio;this.instructions.push([Xn.DRAW_IMAGE,u,x,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,E==Pp?Pp:E.map(function(O){return O*T}),C,w,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,y]);const k=1/T,G=C?C.slice(0):null;G&&(G[1]=za),this.hitDetectionInstructions.push([Xn.DRAW_IMAGE,u,x,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[k,k],NaN,this.declutterMode_,this.declutterImageWithText_,E,G,w,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?za:this.fillKey_,this.textOffsetX_,this.textOffsetY_,y]),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,r=this.strokeKey_;e&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const o=this.textKey_;o in this.textStates||(this.textStates[o]={font:t.font,textAlign:t.textAlign||Vv,justify:t.justify,textBaseline:t.textBaseline||_C,scale:t.scale});const s=this.fillKey_;i&&(s in this.fillStates||(this.fillStates[s]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,r=this.textState_,o=this.strokeKey_,s=this.textKey_,l=this.fillKey_;this.saveTextStates_();const u=this.pixelRatio,h=RC[r.textBaseline],d=this.textOffsetY_*u,m=this.text_,y=i?i.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([Xn.DRAW_CHARS,e,t,h,r.overflow,l,r.maxAngle,u,d,o,y*u,m,s,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([Xn.DRAW_CHARS,e,t,h,r.overflow,l&&za,r.maxAngle,u,d,o,y*u,m,s,1/u,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,t){let i,r,o;if(!e)this.text_="";else{const s=e.getFill();s?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=xc(s.getColor()||za)):(r=null,this.textFillState_=r);const l=e.getStroke();if(!l)o=null,this.textStrokeState_=o;else{o=this.textStrokeState_,o||(o={},this.textStrokeState_=o);const w=l.getLineDash(),E=l.getLineDashOffset(),T=l.getWidth(),k=l.getMiterLimit();o.lineCap=l.getLineCap()||Ty,o.lineDash=w?w.slice():Vh,o.lineDashOffset=E===void 0?Bh:E,o.lineJoin=l.getLineJoin()||Ry,o.lineWidth=T===void 0?Bv:T,o.miterLimit=k===void 0?Nv:k,o.strokeStyle=xc(l.getColor()||Dv)}i=this.textState_;const u=e.getFont()||a4;ij(u);const h=e.getScaleArray();i.overflow=e.getOverflow(),i.font=u,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||_C,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||Pp,i.scale=h===void 0?[1,1]:h;const d=e.getOffsetX(),m=e.getOffsetY(),y=e.getRotateWithView(),x=e.getKeepUpright(),C=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=d===void 0?0:d,this.textOffsetY_=m===void 0?0:m,this.textRotateWithView_=y===void 0?!1:y,this.textKeepUpright_=x===void 0?!0:x,this.textRotation_=C===void 0?0:C,this.strokeKey_=o?(typeof o.strokeStyle=="string"?o.strokeStyle:Yn(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=r&&r.fillStyle?typeof r.fillStyle=="string"?r.fillStyle:"|"+Yn(r.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const ite={Circle:BF,Default:Sb,Image:qee,LineString:Qee,Polygon:BF,Text:nte};class $4{constructor(e,t,i,r){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=r,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const r in i){const o=i[r].finish();e[t][r]=o}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let r=this.buildersByZIndex_[i];r===void 0&&(r={},this.buildersByZIndex_[i]=r);let o=r[t];if(o===void 0){const s=ite[t];o=new s(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[t]=o}return o}}function BM(n,e,t,i){let r=n[e],o=n[e+1],s=0;for(let l=e+i;l<t;l+=i){const u=n[l],h=n[l+1];s+=Math.sqrt((u-r)*(u-r)+(h-o)*(h-o)),r=u,o=h}return s}function rte(n,e,t,i,r,o,s,l,u,h,d,m,y=!0){let x=n[e],C=n[e+1],w=0,E=0,T=0,k=0;function G(){w=x,E=C,e+=i,x=n[e],C=n[e+1],k+=T,T=Math.sqrt((x-w)*(x-w)+(C-E)*(C-E))}do G();while(e<t-i&&k+T<o);let O=T===0?0:(o-k)/T;const V=yl(w,x,O),z=yl(E,C,O),H=e-i,te=k,$=o+l*u(h,r,d);for(;e<t-i&&k+T<$;)G();O=T===0?0:($-k)/T;const ae=yl(w,x,O),fe=yl(E,C,O);let Y=!1;if(y)if(m){const ge=[V,z,ae,fe];QR(ge,0,4,2,m,ge,ge),Y=ge[0]>ge[2]}else Y=V>ae;const de=Math.PI,D=[],oe=H+i===e;e=H,T=0,k=te,x=n[e],C=n[e+1];let ue;if(oe){G(),ue=Math.atan2(C-E,x-w),Y&&(ue+=ue>0?-de:de);const ge=(ae+V)/2,Ne=(fe+z)/2;return D[0]=[ge,Ne,($-o)/2,ue,r],D}r=r.replace(/\n/g," ");for(let ge=0,Ne=r.length;ge<Ne;){G();let Ee=Math.atan2(C-E,x-w);if(Y&&(Ee+=Ee>0?-de:de),ue!==void 0){let qe=Ee-ue;if(qe+=qe>de?-2*de:qe<-de?2*de:0,Math.abs(qe)>s)return null}ue=Ee;const se=ge;let q=0;for(;ge<Ne;++ge){const qe=Y?Ne-ge-1:ge,yt=l*u(h,r[qe],d);if(e+i<t&&k+T<o+q+yt/2)break;q+=yt}if(ge===se)continue;const j=Y?r.substring(Ne-se,Ne-ge):r.substring(se,ge);O=T===0?0:(o+q/2-k)/T;const ze=yl(w,x,O),je=yl(E,C,O);D.push([ze,je,q/2,Ee,j]),o+=q}return D}class ZM{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(fC(),{get:(e,t)=>{if(typeof fC()[t]=="function")return this.push_(t),this.pushMethodArgs_},set:(e,t,i)=>(this.push_(t,i),!0)})}push_(...e){const t=this.instructions_,i=this.zIndex+this.offset_;t[i]||(t[i]=[]),t[i].push(...e)}pushMethodArgs_=(...e)=>(this.push_(e),this);pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let i=0,r=t.length;i<r;++i){const o=t[i];if(typeof o=="function"){o(e);continue}const s=t[++i];if(typeof e[o]=="function")e[o](...s);else{if(typeof s=="function"){e[o]=s(e);continue}e[o]=s}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const bm=el(),kd=[],_h=[],vh=[],Ld=[];function ZF(n){return n[3].declutterBox}const WF=new RegExp("[-----]");function pS(n,e){return e==="start"?e=WF.test(n)?"right":"left":e==="end"&&(e=WF.test(n)?"left":"right"),RC[e]}function ste(n,e,t){return t>0&&n.push(`
`,""),n.push(e,""),n}function ote(n,e,t){return t%2===0&&(n+=e),n}class ate{constructor(e,t,i,r,o){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=qa(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=o?new ZM:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,i,r){const o=e+t+i+r;if(this.labels_[o])return this.labels_[o];const s=r?this.strokeStates[r]:null,l=i?this.fillStates[i]:null,u=this.textStates[t],h=this.pixelRatio,d=[u.scale[0]*h,u.scale[1]*h],m=u.justify?RC[u.justify]:pS(Array.isArray(e)?e[0]:e,u.textAlign||Vv),y=r&&s.lineWidth?s.lineWidth:0,x=Array.isArray(e)?e:String(e).split(`
`).reduce(ste,[]),{width:C,height:w,widths:E,heights:T,lineWidths:k}=sj(u,x),G=C+y,O=[],V=(G+2)*d[0],z=(w+y)*d[1],H={width:V<0?Math.floor(V):Math.ceil(V),height:z<0?Math.floor(z):Math.ceil(z),contextInstructions:O};(d[0]!=1||d[1]!=1)&&O.push("scale",d),r&&(O.push("strokeStyle",s.strokeStyle),O.push("lineWidth",y),O.push("lineCap",s.lineCap),O.push("lineJoin",s.lineJoin),O.push("miterLimit",s.miterLimit),O.push("setLineDash",[s.lineDash]),O.push("lineDashOffset",s.lineDashOffset)),i&&O.push("fillStyle",l.fillStyle),O.push("textBaseline","middle"),O.push("textAlign","center");const te=.5-m;let $=m*G+te*y;const ae=[],fe=[];let Y=0,de=0,D=0,oe=0,ue;for(let ge=0,Ne=x.length;ge<Ne;ge+=2){const Ee=x[ge];if(Ee===`
`){de+=Y,Y=0,$=m*G+te*y,++oe;continue}const se=x[ge+1]||u.font;se!==ue&&(r&&ae.push("font",se),i&&fe.push("font",se),ue=se),Y=Math.max(Y,T[D]);const q=[Ee,$+te*E[D]+m*(E[D]-k[oe]),.5*(y+Y)+de];$+=E[D],r&&ae.push("strokeText",q),i&&fe.push("fillText",q),++D}return Array.prototype.push.apply(O,ae),Array.prototype.push.apply(O,fe),this.labels_[o]=H,H}replayTextBackground_(e,t,i,r,o,s,l){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,r),e.lineTo.apply(e,o),e.lineTo.apply(e,t),s&&(this.alignAndScaleFill_=s[2],e.fillStyle=s[1],this.fill_(e)),l&&(this.setStrokeStyle_(e,l),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,r,o,s,l,u,h,d,m,y,x,C,w,E){l*=y[0],u*=y[1];let T=i-l,k=r-u;const G=o+h>e?e-h:o,O=s+d>t?t-d:s,V=C[3]+G*y[0]+C[1],z=C[0]+O*y[1]+C[2],H=T-C[3],te=k-C[0];(w||m!==0)&&(kd[0]=H,Ld[0]=H,kd[1]=te,_h[1]=te,_h[0]=H+V,vh[0]=_h[0],vh[1]=te+z,Ld[1]=vh[1]);let $;return m!==0?($=Fu(qa(),i,r,1,1,m,-i,-r),Vs($,kd),Vs($,_h),Vs($,vh),Vs($,Ld),Gc(Math.min(kd[0],_h[0],vh[0],Ld[0]),Math.min(kd[1],_h[1],vh[1],Ld[1]),Math.max(kd[0],_h[0],vh[0],Ld[0]),Math.max(kd[1],_h[1],vh[1],Ld[1]),bm)):Gc(Math.min(H,H+V),Math.min(te,te+z),Math.max(H,H+V),Math.max(te,te+z),bm),x&&(T=Math.round(T),k=Math.round(k)),{drawImageX:T,drawImageY:k,drawImageW:G,drawImageH:O,originX:h,originY:d,declutterBox:{minX:bm[0],minY:bm[1],maxX:bm[2],maxY:bm[3],value:E},canvasTransform:$,scale:y}}replayImageOrLabel_(e,t,i,r,o,s,l){const u=!!(s||l),h=r.declutterBox,d=l?l[2]*r.scale[0]/2:0;return h.minX-d<=t[0]&&h.maxX+d>=0&&h.minY-d<=t[1]&&h.maxY+d>=0&&(u&&this.replayTextBackground_(e,kd,_h,vh,Ld,s,l),oj(e,r.canvasTransform,o,i,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const i=Vs(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;e.save(),e.translate(i[0]%r,i[1]%r),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],t[1]&&(e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6]))}drawLabelWithPointPlacement_(e,t,i,r){const o=this.textStates[t],s=this.createLabel(e,t,r,i),l=this.strokeStates[i],u=this.pixelRatio,h=pS(Array.isArray(e)?e[0]:e,o.textAlign||Vv),d=RC[o.textBaseline||_C],m=l&&l.lineWidth?l.lineWidth:0,y=s.width/u-2*o.scale[0],x=h*y+2*(.5-h)*m,C=d*s.height/u+2*(.5-d)*m;return{label:s,anchorX:x,anchorY:C}}execute_(e,t,i,r,o,s,l,u){const h=this.zIndexContext_;let d;this.pixelCoordinates_&&id(i,this.renderedTransform_)?d=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),d=Dh(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),rH(this.renderedTransform_,i));let m=0;const y=r.length;let x=0,C,w,E,T,k,G,O,V,z,H,te,$,ae,fe=0,Y=0;const de=this.coordinateCache_,D=this.viewRotation_,oe=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,ue={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:D},ge=this.instructions!=r||this.overlaps?0:200;let Ne,Ee,se,q;for(;m<y;){const j=r[m];switch(j[0]){case Xn.BEGIN_GEOMETRY:Ne=j[1],q=j[3],Ne.getGeometry()?l!==void 0&&!Zs(l,q.getExtent())?m=j[2]+1:++m:m=j[2],h&&(h.zIndex=j[4]);break;case Xn.BEGIN_PATH:fe>ge&&(this.fill_(e),fe=0),Y>ge&&(e.stroke(),Y=0),!fe&&!Y&&(e.beginPath(),k=NaN,G=NaN),++m;break;case Xn.CIRCLE:x=j[1];const je=d[x],qe=d[x+1],yt=d[x+2],xt=d[x+3],Et=yt-je,kt=xt-qe,hn=Math.sqrt(Et*Et+kt*kt);e.moveTo(je+hn,qe),e.arc(je,qe,hn,0,2*Math.PI,!0),++m;break;case Xn.CLOSE_PATH:e.closePath(),++m;break;case Xn.CUSTOM:x=j[1],C=j[2];const wn=j[3],Ge=j[4],ve=j[5];ue.geometry=wn,ue.feature=Ne,m in de||(de[m]=[]);const W=de[m];ve?ve(d,x,C,2,W):(W[0]=d[x],W[1]=d[x+1],W.length=2),h&&(h.zIndex=j[6]),Ge(W,ue),++m;break;case Xn.DRAW_IMAGE:x=j[1],C=j[2],z=j[3],w=j[4],E=j[5];let Ze=j[6];const Re=j[7],ce=j[8],me=j[9],_e=j[10];let Ie=j[11];const pe=j[12];let Te=j[13];T=j[14]||"declutter";const We=j[15];if(!z&&j.length>=20){H=j[19],te=j[20],$=j[21],ae=j[22];const Ti=this.drawLabelWithPointPlacement_(H,te,$,ae);z=Ti.label,j[3]=z;const ee=j[23];w=(Ti.anchorX-ee)*this.pixelRatio,j[4]=w;const le=j[24];E=(Ti.anchorY-le)*this.pixelRatio,j[5]=E,Ze=z.height,j[6]=Ze,Te=z.width,j[13]=Te}let tt;j.length>25&&(tt=j[25]);let nt,bt,on;j.length>17?(nt=j[16],bt=j[17],on=j[18]):(nt=Pp,bt=null,on=null),_e&&oe?Ie+=D:!_e&&!oe&&(Ie-=D);let an=0;for(;x<C;x+=2){if(tt&&tt[an++]<Te/this.pixelRatio)continue;const Ti=this.calculateImageOrLabelDimensions_(z.width,z.height,d[x],d[x+1],Te,Ze,w,E,ce,me,Ie,pe,o,nt,!!bt||!!on,Ne),ee=[e,t,z,Ti,Re,bt,on];if(u){let le,ye,Ae;if(We){const Ye=C-x;if(!We[Ye]){We[Ye]={args:ee,declutterMode:T};continue}const be=We[Ye];le=be.args,ye=be.declutterMode,delete We[Ye],Ae=ZF(le)}let Me,$e;if(le&&(ye!=="declutter"||!u.collides(Ae))&&(Me=!0),(T!=="declutter"||!u.collides(Ti.declutterBox))&&($e=!0),ye==="declutter"&&T==="declutter"){const Ye=Me&&$e;Me=Ye,$e=Ye}Me&&(ye!=="none"&&u.insert(Ae),this.replayImageOrLabel_.apply(this,le)),$e&&(T!=="none"&&u.insert(Ti.declutterBox),this.replayImageOrLabel_.apply(this,ee))}else this.replayImageOrLabel_.apply(this,ee)}++m;break;case Xn.DRAW_CHARS:const Ii=j[1],ji=j[2],Pi=j[3],Mr=j[4];ae=j[5];const _i=j[6],ss=j[7],Ei=j[8];$=j[9];const Mi=j[10];H=j[11],Array.isArray(H)&&(H=H.reduce(ote,"")),te=j[12];const zs=[j[13],j[13]];T=j[14]||"declutter";const Ao=j[15],Ea=this.textStates[te],_s=Ea.font,Ur=[Ea.scale[0]*ss,Ea.scale[1]*ss];let Xr;_s in this.widths_?Xr=this.widths_[_s]:(Xr={},this.widths_[_s]=Xr);const vs=BM(d,Ii,ji,2),Pl=Math.abs(Ur[0])*oF(_s,H,Xr);if(Mr||Pl<=vs){const Ti=this.textStates[te].textAlign,ee=(vs-Pl)*pS(H,Ti),le=rte(d,Ii,ji,2,H,ee,_i,Math.abs(Ur[0]),oF,_s,Xr,oe?0:this.viewRotation_,Ao);e:if(le){const ye=[];let Ae,Me,$e,Ye,be;if($)for(Ae=0,Me=le.length;Ae<Me;++Ae){be=le[Ae],$e=be[4],Ye=this.createLabel($e,te,"",$),w=be[2]+(Ur[0]<0?-Mi:Mi),E=Pi*Ye.height+(.5-Pi)*2*Mi*Ur[1]/Ur[0]-Ei;const ke=this.calculateImageOrLabelDimensions_(Ye.width,Ye.height,be[0],be[1],Ye.width,Ye.height,w,E,0,0,be[3],zs,!1,Pp,!1,Ne);if(u&&T==="declutter"&&u.collides(ke.declutterBox))break e;ye.push([e,t,Ye,ke,1,null,null])}if(ae)for(Ae=0,Me=le.length;Ae<Me;++Ae){be=le[Ae],$e=be[4],Ye=this.createLabel($e,te,ae,""),w=be[2],E=Pi*Ye.height-Ei;const ke=this.calculateImageOrLabelDimensions_(Ye.width,Ye.height,be[0],be[1],Ye.width,Ye.height,w,E,0,0,be[3],zs,!1,Pp,!1,Ne);if(u&&T==="declutter"&&u.collides(ke.declutterBox))break e;ye.push([e,t,Ye,ke,1,null,null])}u&&T!=="none"&&u.load(ye.map(ZF));for(let ke=0,it=ye.length;ke<it;++ke)this.replayImageOrLabel_.apply(this,ye[ke])}}++m;break;case Xn.END_GEOMETRY:if(s!==void 0){Ne=j[1];const Ti=s(Ne,q,T);if(Ti)return Ti}++m;break;case Xn.FILL:ge?fe++:this.fill_(e),++m;break;case Xn.MOVE_TO_LINE_TO:for(x=j[1],C=j[2],Ee=d[x],se=d[x+1],e.moveTo(Ee,se),k=Ee+.5|0,G=se+.5|0,x+=2;x<C;x+=2)Ee=d[x],se=d[x+1],O=Ee+.5|0,V=se+.5|0,(x==C-2||O!==k||V!==G)&&(e.lineTo(Ee,se),k=O,G=V);++m;break;case Xn.SET_FILL_STYLE:this.alignAndScaleFill_=j[2],fe&&(this.fill_(e),fe=0,Y&&(e.stroke(),Y=0)),e.fillStyle=j[1],++m;break;case Xn.SET_STROKE_STYLE:Y&&(e.stroke(),Y=0),this.setStrokeStyle_(e,j),++m;break;case Xn.STROKE:ge?Y++:e.stroke(),++m;break;default:++m;break}}fe&&this.fill_(e),Y&&e.stroke()}execute(e,t,i,r,o,s){this.viewRotation_=r,this.execute_(e,t,i,this.instructions,o,void 0,void 0,s)}executeHitDetection(e,t,i,r,o){return this.viewRotation_=i,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,r,o)}}const Rp=["Polygon","Circle","LineString","Image","Text","Default"],MC=["Image","Text"],lte=Rp.filter(n=>!MC.includes(n));class J4{constructor(e,t,i,r,o,s,l){this.maxExtent_=e,this.overlaps_=r,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=qa(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(o,l)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e,t){for(const i in e){let r=this.executorsByZIndex_[i];r===void 0&&(r={},this.executorsByZIndex_[i]=r);const o=e[i];for(const s in o){const l=o[s];r[s]=new ate(this.resolution_,this.pixelRatio_,this.overlaps_,l,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let r=0,o=e.length;r<o;++r)if(e[r]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,r,o,s){r=Math.round(r);const l=r*2+1,u=Fu(this.hitDetectionTransform_,r+.5,r+.5,1/t,-1/t,-i,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=ro(l,l));const d=this.hitDetectionContext_;d.canvas.width!==l||d.canvas.height!==l?(d.canvas.width=l,d.canvas.height=l):h||d.clearRect(0,0,l,l);let m;this.renderBuffer_!==void 0&&(m=el(),ev(m,e),Kh(m,t*(this.renderBuffer_+r),m));const y=ute(r);let x;function C(V,z,H){const te=d.getImageData(0,0,l,l).data;for(let $=0,ae=y.length;$<ae;$++)if(te[y[$]]>0){if(!s||H==="none"||x!=="Image"&&x!=="Text"||s.includes(V)){const fe=(y[$]-3)/4,Y=r-fe%l,de=r-(fe/l|0),D=o(V,z,Y*Y+de*de);if(D)return D}d.clearRect(0,0,l,l);break}}const w=Object.keys(this.executorsByZIndex_).map(Number);w.sort(Tc);let E,T,k,G,O;for(E=w.length-1;E>=0;--E){const V=w[E].toString();for(k=this.executorsByZIndex_[V],T=Rp.length-1;T>=0;--T)if(x=Rp[T],G=k[x],G!==void 0&&(O=G.executeHitDetection(d,u,i,C,m),O))return O}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],r=t[1],o=t[2],s=t[3],l=[i,r,i,s,o,s,o,r];return Dh(l,0,8,2,e,l),l}isEmpty(){return jp(this.executorsByZIndex_)}execute(e,t,i,r,o,s,l){const u=Object.keys(this.executorsByZIndex_).map(Number);u.sort(l?XY:Tc),s=s||Rp;const h=Rp.length;for(let d=0,m=u.length;d<m;++d){const y=u[d].toString(),x=this.executorsByZIndex_[y];for(let C=0,w=s.length;C<w;++C){const E=s[C],T=x[E];if(T!==void 0){const k=l===null?void 0:T.getZIndexContext(),G=k?k.getContext():e,O=this.maxExtent_&&E!=="Image"&&E!=="Text";if(O&&(G.save(),this.clip(G,i)),!k||E==="Text"||E==="Image"?T.execute(G,t,i,r,o,l):k.pushFunction(V=>T.execute(V,t,i,r,o,l)),O&&G.restore(),k){k.offset();const V=u[d]*h+Rp.indexOf(E);this.deferredZIndexContexts_[V]||(this.deferredZIndexContexts_[V]=[]),this.deferredZIndexContexts_[V].push(k)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(Tc);for(let i=0,r=t.length;i<r;++i)e[t[i]].forEach(o=>{o.draw(this.renderedContext_),o.clear()}),e[t[i]].length=0}}const gS={};function ute(n){if(gS[n]!==void 0)return gS[n];const e=n*2+1,t=n*n,i=new Array(t+1);for(let o=0;o<=n;++o)for(let s=0;s<=n;++s){const l=o*o+s*s;if(l>t)break;let u=i[l];u||(u=[],i[l]=u),u.push(((n+o)*e+(n+s))*4+3),o>0&&u.push(((n-o)*e+(n+s))*4+3),s>0&&(u.push(((n+o)*e+(n-s))*4+3),o>0&&u.push(((n-o)*e+(n-s))*4+3))}const r=[];for(let o=0,s=i.length;o<s;++o)i[o]&&r.push(...i[o]);return gS[n]=r,r}const zF=Object.freeze(Object.defineProperty({__proto__:null,Circle:ms,Fill:Di,Icon:Nu,IconImage:xM,Image:vb,RegularShape:bl,Stroke:bi,Style:Hn,Text:Wc},Symbol.toStringTag,{value:"Module"}));class q4 extends j4{constructor(e,t,i,r,o,s,l){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=r,this.transformRotation_=r?Zy(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=o,this.squaredTolerance_=s,this.userTransform_=l,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=qa()}drawImages_(e,t,i,r){if(!this.image_)return;const o=Dh(e,t,i,r,this.transform_,this.pixelCoordinates_),s=this.context_,l=this.tmpLocalTransform_,u=s.globalAlpha;this.imageOpacity_!=1&&(s.globalAlpha=u*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let d=0,m=o.length;d<m;d+=2){const y=o[d]-this.imageAnchorX_,x=o[d+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const C=y+this.imageAnchorX_,w=x+this.imageAnchorY_;Fu(l,C,w,1,1,h,-C,-w),s.save(),s.transform.apply(s,l),s.translate(C,w),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.restore()}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,y,x,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(s.globalAlpha=u)}drawText_(e,t,i,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const o=Dh(e,t,i,r,this.transform_,this.pixelCoordinates_),s=this.context_;let l=this.textRotation_;for(this.transformRotation_===0&&(l-=this.viewRotation_),this.textRotateWithView_&&(l+=this.viewRotation_);t<i;t+=r){const u=o[t]+this.textOffsetX_,h=o[t+1]+this.textOffsetY_;l!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(s.save(),s.translate(u-this.textOffsetX_,h-this.textOffsetY_),s.rotate(l),s.translate(this.textOffsetX_,this.textOffsetY_),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.restore()):(this.textStrokeState_&&s.strokeText(this.text_,u,h),this.textFillState_&&s.fillText(this.text_,u,h))}}moveToLineTo_(e,t,i,r,o){const s=this.context_,l=Dh(e,t,i,r,this.transform_,this.pixelCoordinates_);s.moveTo(l[0],l[1]);let u=l.length;o&&(u-=2);for(let h=2;h<u;h+=2)s.lineTo(l[h],l[h+1]);return o&&s.closePath(),i}drawRings_(e,t,i,r){for(let o=0,s=i.length;o<s;++o)t=this.moveToLineTo_(e,t,i[o],r,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Zs(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=fH(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],r=t[3]-t[1],o=Math.sqrt(i*i+r*r),s=this.context_;s.beginPath(),s.arc(t[0],t[1],o,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,r=t.length;i<r;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Zs(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(Zs(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,r=e.getFlatCoordinates();let o=0;const s=e.getEnds(),l=e.getStride();i.beginPath();for(let u=0,h=s.length;u<h;++u)o=this.moveToLineTo_(r,o,s[u],l,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Zs(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Zs(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let r=0;const o=e.getEndss(),s=e.getStride();t.beginPath();for(let l=0,u=o.length;l<u;++l){const h=o[l];r=this.drawRings_(i,r,h,s)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),id(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,r=e.textAlign?e.textAlign:Vv;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=r&&(i.textAlign=r,t.textAlign=r),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=r,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:xc(i||za)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),r=t.getLineCap(),o=t.getLineDash(),s=t.getLineDashOffset(),l=t.getLineJoin(),u=t.getWidth(),h=t.getMiterLimit(),d=o||Vh;this.strokeState_={lineCap:r!==void 0?r:Ty,lineDash:this.pixelRatio_===1?d:d.map(m=>m*this.pixelRatio_),lineDashOffset:(s||Bh)*this.pixelRatio_,lineJoin:l!==void 0?l:Ry,lineWidth:(u!==void 0?u:Bv)*this.pixelRatio_,miterLimit:h!==void 0?h:Nv,strokeStyle:xc(i||Dv)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),r=e.getAnchor(),o=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*i,this.imageAnchorY_=r[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const s=e.getScaleArray();this.imageScale_=[s[0]*this.pixelRatio_/i,s[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const x=t.getColor();this.textFillState_={fillStyle:xc(x||za)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const x=i.getColor(),C=i.getLineCap(),w=i.getLineDash(),E=i.getLineDashOffset(),T=i.getLineJoin(),k=i.getWidth(),G=i.getMiterLimit();this.textStrokeState_={lineCap:C!==void 0?C:Ty,lineDash:w||Vh,lineDashOffset:E||Bh,lineJoin:T!==void 0?T:Ry,lineWidth:k!==void 0?k:Bv,miterLimit:G!==void 0?G:Nv,strokeStyle:xc(x||Dv)}}const r=e.getFont(),o=e.getOffsetX(),s=e.getOffsetY(),l=e.getRotateWithView(),u=e.getRotation(),h=e.getScaleArray(),d=e.getText(),m=e.getTextAlign(),y=e.getTextBaseline();this.textState_={font:r!==void 0?r:a4,textAlign:m!==void 0?m:Vv,textBaseline:y!==void 0?y:_C},this.text_=d!==void 0?Array.isArray(d)?d.reduce((x,C,w)=>x+=w%2?" ":C,""):d:"",this.textOffsetX_=o!==void 0?this.pixelRatio_*o:0,this.textOffsetY_=s!==void 0?this.pixelRatio_*s:0,this.textRotateWithView_=l!==void 0?l:!1,this.textRotation_=u!==void 0?u:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const xl=.5;function Q4(n,e,t,i,r,o,s,l,u){const h=u?Hw(r):r,d=n[0]*xl,m=n[1]*xl,y=ro(d,m);y.imageSmoothingEnabled=!1;const x=y.canvas,C=new q4(y,xl,r,null,s,l,u?zy(WY(),u):null),w=t.length,E=Math.floor((256*256*256-1)/w),T={};for(let G=1;G<=w;++G){const O=t[G-1],V=O.getStyleFunction()||i;if(!V)continue;let z=V(O,o);if(!z)continue;Array.isArray(z)||(z=[z]);const te=(G*E).toString(16).padStart(7,"#00000");for(let $=0,ae=z.length;$<ae;++$){const fe=z[$],Y=fe.getGeometryFunction()(O);if(!Y||!Zs(h,Y.getExtent()))continue;const de=fe.clone(),D=de.getFill();D&&D.setColor(te);const oe=de.getStroke();oe&&(oe.setColor(te),oe.setLineDash(null)),de.setText(void 0);const ue=fe.getImage();if(ue){const se=ue.getImageSize();if(!se)continue;const q=ro(se[0],se[1],void 0,{alpha:!1}),j=q.canvas;q.fillStyle=te,q.fillRect(0,0,j.width,j.height),de.setImage(new Nu({img:j,anchor:ue.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:ue.getOrigin(),opacity:1,size:ue.getSize(),scale:ue.getScale(),rotation:ue.getRotation(),rotateWithView:ue.getRotateWithView()}))}const ge=de.getZIndex()||0;let Ne=T[ge];Ne||(Ne={},T[ge]=Ne,Ne.Polygon=[],Ne.Circle=[],Ne.LineString=[],Ne.Point=[]);const Ee=Y.getType();if(Ee==="GeometryCollection"){const se=Y.getGeometriesArrayRecursive();for(let q=0,j=se.length;q<j;++q){const ze=se[q];Ne[ze.getType().replace("Multi","")].push(ze,de)}}else Ne[Ee.replace("Multi","")].push(Y,de)}}const k=Object.keys(T).map(Number).sort(Tc);for(let G=0,O=k.length;G<O;++G){const V=T[k[G]];for(const z in V){const H=V[z];for(let te=0,$=H.length;te<$;te+=2){C.setStyle(H[te+1]);for(let ae=0,fe=e.length;ae<fe;++ae)C.setTransform(e[ae]),C.drawGeometry(H[te])}}}return y.getImageData(0,0,x.width,x.height)}function eV(n,e,t){const i=[];if(t){const r=Math.floor(Math.round(n[0])*xl),o=Math.floor(Math.round(n[1])*xl),s=(Wr(r,0,t.width-1)+Wr(o,0,t.height-1)*t.width)*4,l=t.data[s],u=t.data[s+1],d=t.data[s+2]+256*(u+256*l),m=Math.floor((256*256*256-1)/e.length);d&&d%m===0&&i.push(e[d/m-1])}return i}const cte=.5,tV={Point:_te,LineString:gte,Polygon:bte,MultiPoint:vte,MultiLineString:mte,MultiPolygon:yte,GeometryCollection:pte,Circle:dte};function hte(n,e){return parseInt(Yn(n),10)-parseInt(Yn(e),10)}function fT(n,e){const t=nV(n,e);return t*t}function nV(n,e){return cte*n/e}function dte(n,e,t,i,r){const o=t.getFill(),s=t.getStroke();if(o||s){const u=n.getBuilder(t.getZIndex(),"Circle");u.setFillStrokeStyle(o,s),u.drawCircle(e,i,r)}const l=t.getText();if(l&&l.getText()){const u=n.getBuilder(t.getZIndex(),"Text");u.setTextStyle(l),u.drawText(e,i)}}function kC(n,e,t,i,r,o,s,l){const u=[],h=t.getImage();if(h){let y=!0;const x=h.getImageState();x==Sn.LOADED||x==Sn.ERROR?y=!1:x==Sn.IDLE&&h.load(),y&&u.push(h.ready())}const d=t.getFill();d&&d.loading()&&u.push(d.ready());const m=u.length>0;return m&&Promise.all(u).then(()=>r(null)),fte(n,e,t,i,o,s,l),m}function fte(n,e,t,i,r,o,s){const l=t.getGeometryFunction()(e);if(!l)return;const u=l.simplifyTransformed(i,r);if(t.getRenderer())iV(n,u,t,e,s);else{const d=tV[u.getType()];d(n,u,t,e,s,o)}}function iV(n,e,t,i,r){if(e.getType()=="GeometryCollection"){const s=e.getGeometries();for(let l=0,u=s.length;l<u;++l)iV(n,s[l],t,i,r);return}n.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer(),r)}function pte(n,e,t,i,r,o){const s=e.getGeometriesArray();let l,u;for(l=0,u=s.length;l<u;++l){const h=tV[s[l].getType()];h(n,s[l],t,i,r,o)}}function gte(n,e,t,i,r){const o=t.getStroke();if(o){const l=n.getBuilder(t.getZIndex(),"LineString");l.setFillStrokeStyle(null,o),l.drawLineString(e,i,r)}const s=t.getText();if(s&&s.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(s),l.drawText(e,i,r)}}function mte(n,e,t,i,r){const o=t.getStroke();if(o){const l=n.getBuilder(t.getZIndex(),"LineString");l.setFillStrokeStyle(null,o),l.drawMultiLineString(e,i,r)}const s=t.getText();if(s&&s.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(s),l.drawText(e,i,r)}}function yte(n,e,t,i,r){const o=t.getFill(),s=t.getStroke();if(s||o){const u=n.getBuilder(t.getZIndex(),"Polygon");u.setFillStrokeStyle(o,s),u.drawMultiPolygon(e,i,r)}const l=t.getText();if(l&&l.getText()){const u=n.getBuilder(t.getZIndex(),"Text");u.setTextStyle(l),u.drawText(e,i,r)}}function _te(n,e,t,i,r,o){const s=t.getImage(),l=t.getText(),u=l&&l.getText(),h=o&&s&&u?{}:void 0;if(s){if(s.getImageState()!=Sn.LOADED)return;const d=n.getBuilder(t.getZIndex(),"Image");d.setImageStyle(s,h),d.drawPoint(e,i,r)}if(u){const d=n.getBuilder(t.getZIndex(),"Text");d.setTextStyle(l,h),d.drawText(e,i,r)}}function vte(n,e,t,i,r,o){const s=t.getImage(),l=s&&s.getOpacity()!==0,u=t.getText(),h=u&&u.getText(),d=o&&l&&h?{}:void 0;if(l){if(s.getImageState()!=Sn.LOADED)return;const m=n.getBuilder(t.getZIndex(),"Image");m.setImageStyle(s,d),m.drawMultiPoint(e,i,r)}if(h){const m=n.getBuilder(t.getZIndex(),"Text");m.setTextStyle(u,d),m.drawText(e,i,r)}}function bte(n,e,t,i,r){const o=t.getFill(),s=t.getStroke();if(o||s){const u=n.getBuilder(t.getZIndex(),"Polygon");u.setFillStrokeStyle(o,s),u.drawPolygon(e,i,r)}const l=t.getText();if(l&&l.getText()){const u=n.getBuilder(t.getZIndex(),"Text");u.setTextStyle(l),u.drawText(e,i,r)}}const xte=5;class Ite extends yb{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=xte}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return Zn()}getData(e){return null}prepareFrame(e){return Zn()}renderFrame(e,t){return Zn()}forEachFeatureAtCoordinate(e,t,i,r,o){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===Sn.LOADED||t.getState()===Sn.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=Sn.LOADED&&t!=Sn.ERROR&&e.addEventListener(Qn.CHANGE,this.boundHandleImageChange_),t==Sn.IDLE&&(e.load(),t=e.getState()),t==Sn.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const UF=[];let Fm=null;function Cte(){Fm=ro(1,1,void 0,{willReadFrequently:!0})}class WM extends Ite{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=qa(),this.pixelTransform=qa(),this.inversePixelTransform=qa(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,i){Fm||Cte(),Fm.clearRect(0,0,1,1);let r;try{Fm.drawImage(e,t,i,1,1,0,0,1,1),r=Fm.getImageData(0,0,1,1).data}catch{return Fm=null,null}return r}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const r=this.getLayer().getClassName();let o,s;if(e&&e.className===r&&(!i||e&&e.style.backgroundColor&&id($l(e.style.backgroundColor),$l(i)))){const l=e.firstElementChild;$d(l)&&(s=l.getContext("2d"))}if(s&&uH(s.canvas.style.transform,t)?(this.container=e,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){o=Cl?UD():document.createElement("div"),o.className=r;let l=o.style;l.position="absolute",l.width="100%",l.height="100%",s=ro();const u=s.canvas;o.appendChild(u),l=u.style,l.position="absolute",l.left="0",l.transformOrigin="top left",this.container=o,this.context=s}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const r=nd(i),o=Ww(i),s=Zw(i),l=Bw(i);Vs(t.coordinateToPixelTransform,r),Vs(t.coordinateToPixelTransform,o),Vs(t.coordinateToPixelTransform,s),Vs(t.coordinateToPixelTransform,l);const u=this.inversePixelTransform;Vs(u,r),Vs(u,o),Vs(u,s),Vs(u,l),e.save(),e.beginPath(),e.moveTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(l[0]),Math.round(l[1])),e.clip()}prepareContainer(e,t){const i=e.extent,r=e.viewState.resolution,o=e.viewState.rotation,s=e.pixelRatio,l=Math.round(Bi(i)/r*s),u=Math.round(Ws(i)/r*s);Fu(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/s,1/s,o,-l/2,-u/2),RD(this.inversePixelTransform,this.pixelTransform);const h=lH(this.pixelTransform);if(this.useContainer(t,h,this.getBackground(e)),!this.containerReused){const d=this.context.canvas;d.width!=l||d.height!=u?(d.width=l,d.height=u):this.context.clearRect(0,0,l,u),h!==d.style.transform&&(d.style.transform=h)}}dispatchRenderEvent_(e,t,i){const r=this.getLayer();if(r.hasListener(e)){const o=new p4(e,this.inversePixelTransform,i,t);r.dispatchEvent(o)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(ja.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(ja.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new ZM),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(ja.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(ja.POSTRENDER,this.context,e))}getRenderTransform(e,t,i,r,o,s,l){const u=o/2,h=s/2,d=r/t,m=-d,y=-e[0]+l,x=-e[1];return Fu(this.tempTransform,u,h,d,m,-i,y,x)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class wte extends WM{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=el(),this.wrappedRenderedExtent_=el(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,i){const r=t.extent,o=t.viewState,s=o.center,l=o.resolution,u=o.projection,h=o.rotation,d=u.getExtent(),m=this.getLayer().getSource(),y=this.getLayer().getDeclutter(),x=t.pixelRatio,C=t.viewHints,w=!(C[Jr.ANIMATING]||C[Jr.INTERACTING]),E=this.context,T=Math.round(Bi(r)/l*x),k=Math.round(Ws(r)/l*x),G=m.getWrapX()&&u.canWrapX(),O=G?Bi(d):null,V=G?Math.ceil((r[2]-d[2])/O)+1:1;let z=G?Math.floor((r[0]-d[0])/O):0;do{let H=this.getRenderTransform(s,l,0,x,T,k,z*O);t.declutter&&(H=H.slice(0)),e.execute(E,[E.canvas.width,E.canvas.height],H,h,w,i===void 0?Rp:i?MC:lte,i?y&&t.declutter[y]:void 0)}while(++z<V)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=ro(this.context.canvas.width,this.context.canvas.height,UF))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,Qw(this.context),UF.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex];this.opacity_=i.opacity;const r=e.viewState;this.prepareContainer(e,t);const o=this.context,s=this.replayGroup_;let l=s&&!s.isEmpty();if(!l&&!(this.getLayer().hasListener(ja.PRERENDER)||this.getLayer().hasListener(ja.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(o,e),r.projection,this.clipped_=!1,l&&i.extent&&this.clipping){const u=Xl(i.extent);l=Zs(u,e.extent),this.clipped_=l&&!vc(u,e.extent),this.clipped_&&this.clipUnrotated(o,e,u)}return l&&this.renderWorlds(s,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&o.restore(),this.postRender(o,e),this.renderedRotation_!==r.rotation&&(this.renderedRotation_=r.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),r=this.renderedCenter_,o=this.renderedResolution_,s=this.renderedRotation_,l=this.renderedProjection_,u=this.wrappedRenderedExtent_,h=this.getLayer(),d=[],m=i[0]*xl,y=i[1]*xl;d.push(this.getRenderTransform(r,o,s,xl,m,y,0).slice());const x=h.getSource(),C=l.getExtent();if(x.getWrapX()&&l.canWrapX()&&!vc(C,u)){let w=u[0];const E=Bi(C);let T=0,k;for(;w<C[0];)--T,k=E*T,d.push(this.getRenderTransform(r,o,s,xl,m,y,k).slice()),w+=E;for(T=0,w=u[2];w>C[2];)++T,k=E*T,d.push(this.getRenderTransform(r,o,s,xl,m,y,k).slice()),w-=E}this.hitDetectionImageData_=Q4(i,d,this.renderedFeatures_,h.getStyleFunction(),u,o,s,fT(o,this.renderedPixelRatio_),null)}t(eV(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,r,o){if(!this.replayGroup_)return;const s=t.viewState.resolution,l=t.viewState.rotation,u=this.getLayer(),h={},d=function(y,x,C){const w=Yn(y),E=h[w];if(E){if(E!==!0&&C<E.distanceSq){if(C===0)return h[w]=!0,o.splice(o.lastIndexOf(E),1),r(y,u,x);E.geometry=x,E.distanceSq=C}}else{if(C===0)return h[w]=!0,r(y,u,x);o.push(h[w]={feature:y,layer:u,geometry:x,distanceSq:C,callback:r})}},m=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,s,l,i,d,m?t.declutter?.[m]?.all().map(y=>y.value):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const r=e.viewHints[Jr.ANIMATING],o=e.viewHints[Jr.INTERACTING],s=t.getUpdateWhileAnimating(),l=t.getUpdateWhileInteracting();if(this.ready&&!s&&r||!l&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const u=e.extent,h=e.viewState,d=h.projection,m=h.resolution,y=e.pixelRatio,x=t.getRevision(),C=t.getRenderBuffer();let w=t.getRenderOrder();w===void 0&&(w=hte);const E=h.center.slice(),T=Kh(u,C*m),k=T.slice(),G=[T.slice()],O=d.getExtent();if(i.getWrapX()&&d.canWrapX()&&!vc(O,e.extent)){const D=Bi(O),oe=Math.max(Bi(T)/2,D);T[0]=O[0]-oe,T[2]=O[2]+oe,zw(E,d);const ue=dD(G[0],d);ue[0]<O[0]&&ue[2]<O[2]?G.push([ue[0]+D,ue[1],ue[2]+D,ue[3]]):ue[0]>O[0]&&ue[2]>O[2]&&G.push([ue[0]-D,ue[1],ue[2]-D,ue[3]])}if(this.ready&&this.renderedResolution_==m&&this.renderedRevision_==x&&this.renderedRenderOrder_==w&&this.renderedFrameDeclutter_===!!e.declutter&&vc(this.wrappedRenderedExtent_,T))return id(this.renderedExtent_,k)||(this.hitDetectionImageData_=null,this.renderedExtent_=k),this.renderedCenter_=E,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const V=new $4(nV(m,y),T,m,y);let z;for(let D=0,oe=G.length;D<oe;++D)i.loadFeatures(G[D],m,d);const H=fT(m,y);let te=!0;const $=(D,oe)=>{let ue;const ge=D.getStyleFunction()||t.getStyleFunction();if(ge&&(ue=ge(D,m)),ue){const Ne=this.renderFeature(D,H,ue,V,z,this.getLayer().getDeclutter(),oe);te=te&&!Ne}},ae=Hw(T),fe=i.getFeaturesInExtent(ae);w&&fe.sort(w);for(let D=0,oe=fe.length;D<oe;++D)$(fe[D],D);this.renderedFeatures_=fe,this.ready=te;const Y=V.finish(),de=new J4(T,m,y,i.getOverlaps(),Y,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=m,this.renderedRevision_=x,this.renderedRenderOrder_=w,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=k,this.wrappedRenderedExtent_=T,this.renderedCenter_=E,this.renderedProjection_=d,this.renderedPixelRatio_=y,this.replayGroup_=de,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,r,o,s,l){if(!i)return!1;let u=!1;if(Array.isArray(i))for(let h=0,d=i.length;h<d;++h)u=kC(r,e,i[h],t,this.boundHandleStyleImageChange_,o,s,l)||u;else u=kC(r,e,i,t,this.boundHandleStyleImageChange_,o,s,l);return u}}class gs extends AM{constructor(e){super(e)}createRenderer(){return new wte(this)}}let Ate=!1;function Ste(n,e,t,i,r,o,s){const l=new XMLHttpRequest;l.open("GET",typeof n=="function"?n(t,i,r):n,!0),e.getType()=="arraybuffer"&&(l.responseType="arraybuffer"),l.withCredentials=Ate,l.onload=function(u){if(!l.status||l.status>=200&&l.status<300){const h=e.getType();try{let d;h=="text"||h=="json"?d=l.responseText:h=="xml"?d=l.responseXML||l.responseText:h=="arraybuffer"&&(d=l.response),d?o(e.readFeatures(d,{extent:t,featureProjection:r}),e.readProjection(d)):s()}catch{s()}}else s()},l.onerror=s,l.send()}function XF(n,e){return function(t,i,r,o,s){Ste(n,e,t,i,r,(l,u)=>{this.addFeatures(l),o!==void 0&&o(l)},()=>{this.changed(),s!==void 0&&s()})}}function Ete(n,e){return[[-1/0,-1/0,1/0,1/0]]}class yi extends nu{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new yi(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(mr(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=mn(e,Qn.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?Tte(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Tte(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(gr(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[n]),function(){return e}}function rV(n,e,t,i){const r=[];let o=el();for(let s=0,l=t.length;s<l;++s){const u=t[s];o=BR(n,e,u[0],i),r.push((o[0]+o[2])/2,(o[1]+o[3])/2),e=u[u.length-1]}return r}function LC(n,e,t,i,r,o,s){let l,u;const h=(t-e)/i;if(h===1)l=e;else if(h===2)l=e,u=r;else if(h!==0){let d=n[e],m=n[e+1],y=0;const x=[0];for(let E=e+i;E<t;E+=i){const T=n[E],k=n[E+1];y+=Math.sqrt((T-d)*(T-d)+(k-m)*(k-m)),x.push(y),d=T,m=k}const C=r*y,w=UY(x,C);w<0?(u=(C-x[-w-2])/(x[-w-1]-x[-w-2]),l=e+(-w-2)*i):l=e+w*i}s=s>1?s:2,o=o||new Array(s);for(let d=0;d<s;++d)o[d]=l===void 0?NaN:u===void 0?n[l+d]:yl(n[l+d],n[l+i+d],u);return o}function pT(n,e,t,i,r,o){if(t==e)return null;let s;if(r<n[e+i-1])return o?(s=n.slice(e,e+i),s[i-1]=r,s):null;if(n[t-1]<r)return o?(s=n.slice(t-i,t),s[i-1]=r,s):null;if(r==n[e+i-1])return n.slice(e,e+i);let l=e/i,u=t/i;for(;l<u;){const y=l+u>>1;r<n[(y+1)*i-1]?u=y:l=y+1}const h=n[l*i-1];if(r==h)return n.slice((l-1)*i,(l-1)*i+i);const d=n[(l+1)*i-1],m=(r-h)/(d-h);s=[];for(let y=0;y<i-1;++y)s.push(yl(n[(l-1)*i+y],n[l*i+y],m));return s.push(r),s}function Rte(n,e,t,i,r,o,s){if(s)return pT(n,e,t[t.length-1],i,r,o);let l;if(r<n[i-1])return o?(l=n.slice(0,i),l[i-1]=r,l):null;if(n[n.length-1]<r)return o?(l=n.slice(n.length-i),l[i-1]=r,l):null;for(let u=0,h=t.length;u<h;++u){const d=t[u];if(e!=d){if(r<n[e+i-1])return null;if(r<=n[d-1])return pT(n,e,d,i,r,!1);e=d}}return null}class _f extends wf{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new _f(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){const o=this.flatCoordinates,s=e-o[0],l=t-o[1],u=s*s+l*l;if(u<r){if(u===0)for(let h=0;h<this.stride;++h)i[h]=o[h];else{const h=this.getRadius()/Math.sqrt(u);i[0]=o[0]+h*s,i[1]=o[1]+h*l;for(let d=2;d<this.stride;++d)i[d]=o[d]}return i.length=this.stride,u}return r}containsXY(e,t){const i=this.flatCoordinates,r=e-i[0],o=t-i[1];return r*r+o*o<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return Gc(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Zs(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:ZR(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],r=e.slice();r[t]=r[0]+i;for(let o=1;o<t;++o)r[t+o]=e[o];this.setFlatCoordinates(this.layout,r),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let o=PD(r,0,e,this.stride);r[o++]=r[0]+t;for(let s=1,l=this.stride;s<l;++s)r[o++]=r[s];r.length=o,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),r=this.getStride();this.setCenter(QR(i,0,i.length,r,e,t,i)),this.changed()}}_f.prototype.transform;class ql extends MD{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(mr),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,i=e.length;t<i;++t)this.changeEventsKeys_.push(mn(e[t],Qn.CHANGE,this.changed,this))}clone(){const e=new ql(mS(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<hg(this.getExtent(),e,t))return r;const o=this.geometries_;for(let s=0,l=o.length;s<l;++s)r=o[s].closestPointXY(e,t,i,r);return r}containsXY(e,t){const i=this.geometries_;for(let r=0,o=i.length;r<o;++r)if(i[r].containsXY(e,t))return!0;return!1}computeExtent(e){By(e);const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)Sy(e,t[i].getExtent());return e}getGeometries(){return mS(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let r=!1;for(let o=0,s=i.length;o<s;++o){const l=i[o],u=l.getSimplifiedGeometry(e);t.push(u),u!==l&&(r=!0)}return r?new ql(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let r=0,o=i.length;r<o;++r)i[r].rotate(e,t);this.changed()}scale(e,t,i){i||(i=Gu(this.getExtent()));const r=this.geometries_;for(let o=0,s=r.length;o<s;++o)r[o].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(mS(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let r=0,o=i.length;r<o;++r)i[r].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function mS(n){return n.map(e=>e.clone())}class qi extends wf{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){nr(this.flatCoordinates,e),this.changed()}clone(){const e=new qi(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<hg(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(eM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),nM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,r))}forEachSegment(e){return DD(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,pT(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return jd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return LC(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return BM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=Jw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new qi(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return qw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=$w(this.flatCoordinates,0,e,this.stride),this.changed()}}class Du extends wf{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{const r=e,o=[],s=[];for(let u=0,h=r.length;u<h;++u){const d=r[u];nr(o,d.getFlatCoordinates()),s.push(o.length)}const l=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(l,o),this.ends_=s}}appendLineString(e){nr(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Du(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<hg(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(tM(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),iM(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,r))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,Rte(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return Fv(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new qi(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,r=[];let o=0;for(let s=0,l=t.length;s<l;++s){const u=t[s],h=new qi(e.slice(o,u),i);r.push(h),o=u}return r}getLength(){const e=this.ends_;let t=0,i=0;for(let r=0,o=e.length;r<o;++r)i+=BM(this.flatCoordinates,t,e[r],this.stride),t=e[r];return i}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const r=this.ends_,o=this.stride;for(let s=0,l=r.length;s<l;++s){const u=r[s],h=LC(t,i,u,o,.5);nr(e,h),i=u}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=FD(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new Du(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return xH(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=_b(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class $h extends wf{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){nr(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new $h(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<hg(this.getExtent(),e,t))return r;const o=this.flatCoordinates,s=this.stride;for(let l=0,u=o.length;l<u;l+=s){const h=Gh(e,t,o[l],o[l+1]);if(h<r){r=h;for(let d=0;d<s;++d)i[d]=o[l+d];i.length=s}}return r}getCoordinates(){return jd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new zi(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,r=[];for(let o=0,s=e.length;o<s;o+=i){const l=new zi(e.slice(o,o+i),t);r.push(l)}return r}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let r=0,o=t.length;r<o;r+=i){const s=t[r],l=t[r+1];if(VR(e,s,l))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=$w(this.flatCoordinates,0,e,this.stride),this.changed()}}class vf extends wf{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){const r=e,o=[],s=[];for(let l=0,u=r.length;l<u;++l){const h=r[l],d=o.length,m=h.getEnds();for(let y=0,x=m.length;y<x;++y)m[y]+=d;nr(o,h.getFlatCoordinates()),s.push(m)}t=r.length===0?this.getLayout():r[0].getLayout(),e=o,i=s}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;nr(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let r=0,o=t.length;r<o;++r)t[r]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=this.endss_[r].slice();const i=new vf(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,r){return r<hg(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gH(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),mH(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,r))}containsXY(e,t){return bH(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return pH(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),$E(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,jE(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=rV(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=ND(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new $h(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;ZD(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=$E(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=_H(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new vf(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const o=this.endss_[e-1];t=o[o.length-1]}const i=this.endss_[e].slice(),r=i[i.length-1];if(t!==0)for(let o=0,s=i.length;o<s;++o)i[o]-=t;return new Bo(this.flatCoordinates.slice(t,r),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,r=[];let o=0;for(let s=0,l=i.length;s<l;++s){const u=i[s].slice(),h=u[u.length-1];if(o!==0)for(let m=0,y=u.length;m<y;++m)u[m]-=o;const d=new Bo(t.slice(o,h),e,u);r.push(d),o=h}return r}getType(){return"MultiPolygon"}intersectsExtent(e){return IH(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=GD(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const r=i[i.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}}const YF=qa();class _l{constructor(e,t,i,r,o,s){this.styleFunction,this.extent_,this.id_=s,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=o,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?sy(this.flatCoordinates_):BR(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=Gu(this.getExtent());this.flatInteriorPoints_=oM(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=wH(this.flatCoordinates_,this.ends_),t=rV(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=ND(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=LC(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let r=0,o=i.length;r<o;++r){const s=i[r],l=LC(e,t,s,2,.5);nr(this.flatMidpoints_,l),t=s}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=Ni(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const r=Ws(i)/Ws(t);Fu(YF,i[0],i[3],r,-r,0,0,0),Dh(this.flatCoordinates_,0,this.flatCoordinates_.length,2,YF,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new _l(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=ID((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const i=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":i.length=Jw(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,i,0),r=[i.length];break;case"MultiLineString":r=[],i.length=FD(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,i,0,r);break;case"Polygon":r=[],i.length=rM(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),i,0,r);break}return r&&(this.simplifiedGeometry_=new _l(this.type_,i,r,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}_l.prototype.getFlatCoordinates=_l.prototype.getOrientedFlatCoordinates;class PC{constructor(e){this.rbush_=new QD(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[Yn(t)]=i}load(e,t){const i=new Array(t.length);for(let r=0,o=t.length;r<o;r++){const s=e[r],l=t[r],u={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:l};i[r]=u,this.items_[Yn(l)]=u}this.rbush_.load(i)}remove(e){const t=Yn(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[Yn(t)],r=[i.minX,i.minY,i.maxX,i.maxY];Hp(r,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(r){return r.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let r=0,o=e.length;r<o;r++)if(i=t(e[r]),i)return i;return i}isEmpty(){return jp(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return Gc(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}class zM extends nu{constructor(e){super(),this.projection=Ni(e.projection),this.attributions_=HF(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,r){t.viewResolver=i,t.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=HF(e),this.changed()}setState(e){this.state_=e,this.changed()}}function HF(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),e=>n):null}const Ba={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class Pd extends Vo{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class io extends zM{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Pv,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(gr(this.format_,"`format` must be set when `url` is set"),this.loader_=XF(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:Ete;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new PC:null,this.loadedExtentsRtree_=new PC,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,r;Array.isArray(e.features)?r=e.features:e.features&&(i=e.features,r=i.getArray()),!t&&i===void 0&&(i=new Ts(r)),r!==void 0&&this.addFeaturesInternal(r),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=Yn(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const r=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Pd(Ba.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof _l||(this.featureChangeKeys_[e]=[mn(t,Qn.CHANGE,this.handleFeatureChange_,this),mn(t,qp.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let i=!0;if(t.getId()!==void 0){const r=String(t.getId());if(!(r in this.idIndex_))this.idIndex_[r]=t;else if(t instanceof _l){const o=this.idIndex_[r];o instanceof _l?Array.isArray(o)?o.push(t):this.idIndex_[r]=[o,t]:i=!1}else i=!1}return i&&(gr(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],r=[];for(let o=0,s=e.length;o<s;o++){const l=e[o],u=Yn(l);this.addToIndex_(u,l)&&i.push(l)}for(let o=0,s=i.length;o<s;o++){const l=i[o],u=Yn(l);this.setupChangeEvents_(u,l);const h=l.getGeometry();if(h){const d=h.getExtent();t.push(d),r.push(l)}else this.nullGeometryFeatures_[u]=l}if(this.featuresRtree_&&this.featuresRtree_.load(t,r),this.hasListener(Ba.ADDFEATURE))for(let o=0,s=i.length;o<s;o++)this.dispatchEvent(new Pd(Ba.ADDFEATURE,i[o]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Ba.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(Ba.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(eo.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(eo.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(mr);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Pd(Ba.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(r){const o=r.getGeometry();if(o instanceof _l||o.intersectsCoordinate(e))return t(r)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){const r=i.getGeometry();if(r instanceof _l||r.intersectsExtent(e)){const o=t(i);if(o)return o}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),jp(this.nullGeometryFeatures_)||nr(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const r=fD(e,t);return[].concat(...r.map(o=>this.featuresRtree_.getInExtent(o)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],r=e[1];let o=null;const s=[NaN,NaN];let l=1/0;const u=[-1/0,-1/0,1/0,1/0];return t=t||gf,this.featuresRtree_.forEachInExtent(u,function(h){if(t(h)){const d=h.getGeometry(),m=l;if(l=d instanceof _l?0:d.closestPointXY(i,r,s,l),l<m){o=h;const y=Math.sqrt(l);u[0]=i-y,u[1]=r-y,u[2]=i+y,u[3]=r+y}}}),o}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=Yn(t),r=t.getGeometry();if(!r)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const s=r.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(s,t)):this.featuresRtree_&&this.featuresRtree_.update(s,t)}const o=t.getId();if(o!==void 0){const s=o.toString();this.idIndex_[s]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[s]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new Pd(Ba.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:Yn(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&jp(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const r=this.loadedExtentsRtree_,o=this.strategy_(e,t,i);for(let s=0,l=o.length;s<l;++s){const u=o[s];r.forEachInExtent(u,function(d){return vc(d.extent,u)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Pd(Ba.FEATURESLOADSTART)),this.loader_.call(this,u,t,i,d=>{--this.loadingExtentsCount_,this.dispatchEvent(new Pd(Ba.FEATURESLOADEND,void 0,d))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Pd(Ba.FEATURESLOADERROR))}),r.insert(u,{extent:u.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_,i=t.forEachInExtent(e,function(r){if(Hp(r.extent,e))return r});i&&t.remove(i)}removeFeatures(e){let t=!1;for(let i=0,r=e.length;i<r;++i)t=this.removeFeatureInternal(e[i])||t;t&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=Yn(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.featureChangeKeys_[t]?.forEach(mr),delete this.featureChangeKeys_[t];const r=e.getId();if(r!==void 0){const o=r.toString(),s=this.idIndex_[o];s===e?delete this.idIndex_[o]:Array.isArray(s)&&(s.splice(s.indexOf(e),1),s.length===1&&(this.idIndex_[o]=s[0]))}return delete this.uidIndex_[t],this.hasListener(Ba.REMOVEFEATURE)&&this.dispatchEvent(new Pd(Ba.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){gr(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(XF(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}class UM{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=yi,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?Ni(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=Ni(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return Zn()}readFeature(e,t){return Zn()}readFeatures(e,t){return Zn()}readGeometry(e,t){return Zn()}readProjection(e){return Zn()}writeFeature(e,t){return Zn()}writeFeatures(e,t){return Zn()}writeGeometry(e,t){return Zn()}}function ru(n,e,t){const i=t?Ni(t.featureProjection):null,r=t?Ni(t.dataProjection):null;let o=n;if(i&&r&&!Nh(i,r)){e&&(o=n.clone());const s=e?i:r,l=e?r:i;s.getUnits()==="tile-pixels"?o.transform(s,l):o.applyTransform(pf(s,l))}if(e&&t&&t.decimals!==void 0){const s=Math.pow(10,t.decimals),l=function(u){for(let h=0,d=u.length;h<d;++h)u[h]=Math.round(u[h]*s)/s;return u};o===n&&(o=n.clone()),o.applyTransform(l)}return o}const Mte={Point:zi,LineString:qi,Polygon:Bo,MultiPoint:$h,MultiLineString:Du,MultiPolygon:vf};function kte(n,e,t){return Array.isArray(e[0])?(ZD(n,0,e,t)||(n=n.slice(),$E(n,0,e,t)),n):(lM(n,0,e,t)||(n=n.slice(),hC(n,0,e,t)),n)}function sV(n,e){const t=n.geometry;if(!t)return[];if(Array.isArray(t))return t.map(o=>sV({...n,geometry:o})).flat();const i=t.type==="MultiPolygon"?"Polygon":t.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const r=t.layout.length;return ru(new _l(i,i==="Polygon"?kte(t.flatCoordinates,t.ends,r):t.flatCoordinates,t.ends?.flat(),r,n.properties||{},n.id).enableSimplifyTransformed(),!1,e)}function XM(n,e){if(!n)return null;if(Array.isArray(n)){const i=n.map(r=>XM(r,e));return new ql(i)}const t=Mte[n.type];return ru(new t(n.flatCoordinates,n.layout||"XY",n.ends),!1,e)}class Lte extends UM{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(_x(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(_x(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return Zn()}readFeaturesFromObject(e,t){return Zn()}readGeometry(e,t){return this.readGeometryFromObject(_x(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return Zn()}readProjection(e){return this.readProjectionFromObject(_x(e))}readProjectionFromObject(e){return Zn()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return Zn()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return Zn()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return Zn()}}function _x(n){if(typeof n=="string"){const e=JSON.parse(n);return e||null}return n!==null?n:null}class Qa extends Lte{constructor(e){e=e||{},super(),this.dataProjection=Ni(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=Ni(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;e.type==="Feature"?i=e:i={type:"Feature",geometry:e,properties:null};const r=YM(i.geometry);if(this.featureClass===_l)return sV({geometry:r,id:i.id,properties:i.properties},t);const o=new yi;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&o.setGeometryName(i.geometry_name),o.setGeometry(XM(r,t)),"id"in i&&o.setId(i.id),i.properties&&o.setProperties(i.properties,!0),o}readFeaturesFromObject(e,t){const i=e;let r=null;if(i.type==="FeatureCollection"){const o=e;r=[];const s=o.features;for(let l=0,u=s.length;l<u;++l){const h=this.readFeatureFromObject(s[l],t);h&&r.push(h)}}else r=[this.readFeatureFromObject(e,t)];return r.flat()}readGeometryFromObject(e,t){return Pte(e,t)}readProjectionFromObject(e){const t=e.crs;let i;if(t)if(t.type=="name")i=Ni(t.properties.name);else if(t.type==="EPSG")i=Ni("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},r=e.getId();if(r!==void 0&&(i.id=r),!e.hasProperties())return i;const o=e.getProperties(),s=e.getGeometry();return s&&(i.geometry=gT(s,t),delete o[e.getGeometryName()]),jp(o)||(i.properties=o),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let r=0,o=e.length;r<o;++r)i.push(this.writeFeatureObject(e[r],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return gT(e,this.adaptOptions(t))}}function YM(n,e){if(!n)return null;let t;switch(n.type){case"Point":{t=Fte(n);break}case"LineString":{t=Ote(n);break}case"Polygon":{t=Bte(n);break}case"MultiPoint":{t=Dte(n);break}case"MultiLineString":{t=Nte(n);break}case"MultiPolygon":{t=Vte(n);break}case"GeometryCollection":{t=Gte(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return t}function Pte(n,e){const t=YM(n);return XM(t,e)}function Gte(n,e){return n.geometries.map(function(i){return YM(i)})}function Fte(n){const e=n.coordinates;return{type:"Point",flatCoordinates:e,layout:fg(e.length)}}function Ote(n){const e=n.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:fg(e[0]?.length||2)}}function Nte(n){const e=n.coordinates,t=e[0]?.[0]?.length||2,i=[],r=_b(i,0,e,t);return{type:"MultiLineString",flatCoordinates:i,ends:r,layout:fg(t)}}function Dte(n){const e=n.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:fg(e[0]?.length||2)}}function Vte(n){const e=n.coordinates,t=[],i=e[0]?.[0]?.[0].length||2,r=GD(t,0,e,i);return{type:"MultiPolygon",flatCoordinates:t,ends:r,layout:fg(i)}}function Bte(n){const e=n.coordinates,t=[],i=e[0]?.[0]?.length,r=_b(t,0,e,i);return{type:"Polygon",flatCoordinates:t,ends:r,layout:fg(i)}}function gT(n,e){n=ru(n,!0,e);const t=n.getType();let i;switch(t){case"Point":{i=Yte(n);break}case"LineString":{i=Wte(n);break}case"Polygon":{i=Hte(n,e);break}case"MultiPoint":{i=Ute(n);break}case"MultiLineString":{i=zte(n);break}case"MultiPolygon":{i=Xte(n,e);break}case"GeometryCollection":{i=Zte(n,e);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return i}function Zte(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return gT(i,e)})}}function Wte(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function zte(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function Ute(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function Xte(n,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(t)}}function Yte(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function Hte(n,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(t)}}const Kte="searchLayer",KF=17;class jte{map;featureLayer;init(e){this.map=e,this.createFeatureLayer()}createFeatureLayer(){this.featureLayer=new gs({source:new io,zIndex:1e3});const e=new Di({color:[255,255,0,.6]}),t=new bi({color:[255,155,55,1],width:3}),i=new ms({radius:10,fill:e,stroke:t});this.featureLayer.set("cyLayerType",Kte),this.featureLayer.setStyle(function(r){const o=r.get("color")||"#ffcc33",s=r.get("width")||3,l=[new Hn({fill:new Di({color:[255,255,0,.6]})}),new Hn({stroke:new bi({color:"#ffffff",width:5})}),new Hn({stroke:new bi({color:o,width:s})})],u=r.getGeometry?.()?.getType?.();return u==="Point"||u==="MultiPoint"?[new Hn({image:i})]:l}),this.map.addLayer(this.featureLayer)}clearFeatures(){this.featureLayer.getSource()?.clear()}clearParcelHighlights(){const e=this.featureLayer.getSource();if(!e)return;const t=e.getFeatures()||[];for(const i of t)try{i.get&&i.get("isParcel")&&e.removeFeature(i)}catch{}}fitFeatures(e,t,i){const r={dataProjection:i||Sl,featureProjection:this.map.getView().getProjection()},o=new Qa().readFeatures({type:"FeatureCollection",features:e},r);if(o.length>0){let s=o[0].getGeometry()?.getExtent()||[0,0,0,0];for(const l of o){const u=l.getGeometry()?.getExtent()||[0,0,0,0];s=Sy(s,u)}if(s){const l={size:this.map.getSize(),maxZoom:t||KF};this.map.getView().fit(s,l)}}}isGeoJsonArray(e){return e.length>0&&typeof e[0].type=="string"}isFeatureArray(e){return e.length>0&&typeof e[0].getGeometry=="function"}highlightFeatures(e,t,i,r){if(this.clearFeatures(),e!=null){this.map.getLayers().getArray().indexOf(this.featureLayer)===-1&&this.map.addLayer(this.featureLayer);const o={dataProjection:r||Sl,featureProjection:this.map.getView().getProjection()};let s=[];if(this.isGeoJsonArray(e)?s=new Qa().readFeatures({type:"FeatureCollection",features:e},o):this.isFeatureArray(e)&&(s=e),s.length>0){let l=s[0].getGeometry()?.getExtent()||[0,0,0,0];for(const u of s){const h=u.getGeometry()?.getExtent()||[0,0,0,0];l=Sy(l,h),u.getId()==null&&u.setId(void 0);try{(u.get("layer_name")==="Parcelle"||u.get("isParcel"))&&u.set("isParcel",!0)}catch{}u.getGeometry()?.getType()==="GeometryCollection"?u.getGeometry().getGeometriesArray().forEach(m=>{const y=u.clone();y.setGeometry(m),u.get("isParcel")&&y.set("isParcel",!0),this.featureLayer.getSource()?.addFeature(y)}):this.featureLayer.getSource()?.addFeature(u)}if(t&&l){const u={size:this.map.getSize(),maxZoom:i||KF};this.map.getView().fit(l,u)}}}}}const vu=new jte,$te="featureInfoLayer",Jte=17;class qte{map;featureLayer;init(e){this.map=e,this.createFeatureLayer()}createFeatureLayer(){this.featureLayer=new gs({source:new io,zIndex:1e3});const e=new Di({color:[255,255,0,.6]}),t=new bi({color:[255,155,55,1],width:3}),i=new ms({radius:10,fill:e,stroke:t});this.featureLayer.set("cyLayerType",$te),this.featureLayer.setStyle(function(r){const o=r.get("color")||"#ffcc33",s=r.get("width")||3,l=[new Hn({fill:new Di({color:[255,255,0,.6]})}),new Hn({stroke:new bi({color:"#ffffff",width:5})}),new Hn({stroke:new bi({color:o,width:s})})],u=r.getGeometry()?.getType();return u==="Point"||u==="MultiPoint"?[new Hn({image:i})]:l}),this.map.addLayer(this.featureLayer)}highlightFeatures(e,t,i){if(e!=null){this.map.getLayers().getArray().indexOf(this.featureLayer)===-1&&this.map.addLayer(this.featureLayer);const r={dataProjection:Ml,featureProjection:this.map.getView().getProjection()},o=new Qa().readFeatures({type:"FeatureCollection",features:e},r);if(o.length>0){let s=o[0].getGeometry()?.getExtent()||[0,0,0,0];for(const l of o){const u=l.getGeometry()?.getExtent()||[0,0,0,0];s=Sy(s,u),l.getId()==null&&l.setId(void 0);try{(l.get("layer_name")==="Parcelle"||l.get("isParcel"))&&l.set("isParcel",!0)}catch{}l.getGeometry()?.getType()==="GeometryCollection"?l.getGeometry().getGeometriesArray().forEach(d=>{const m=l.clone();m.setGeometry(d),l.get("isParcel")&&m.set("isParcel",!0),this.featureLayer.getSource()?.addFeature(m)}):this.featureLayer.getSource()?.addFeature(l)}if(t&&s){const l={size:this.map.getSize(),maxZoom:i||Jte};this.map.getView().fit(s,l)}}}}clearFeatures(){this.featureLayer.getSource()?.clear()}clearParcelHighlights(){const e=this.featureLayer.getSource();if(!e)return;const t=e.getFeatures()||[];for(const i of t)try{i.get&&i.get("isParcel")&&e.removeFeature(i)}catch{}}}const Ym=new qte,Qte=["parcels","parcels_labels","parcels_go","parcels_prof","parcels_labels_go","parcels_labels_prof","cadastre"];function Hm(n){if(n==null)return!1;const e=String(n).toLowerCase();return Qte.some(t=>e.includes(t))}function la(){const n=Tl();function e(h,d){try{const m=JSON.parse(h).concat(JSON.parse(d));return new Set(m).size<m.length}catch{return!1}}function t(h){return h.opacity=h.previousOpacity=h.metadata?.start_opacity??1,i(h),h}function i(h){h.currentTimeMinValue||(h.currentTimeMinValue=h.time?.minDefValue??h.time?.minValue);const d=h.time?.mode===kh.RANGE;!h.currentTimeMaxValue&&d&&(h.currentTimeMaxValue=h.time?.maxDefValue??h.time?.maxValue)}function r(h){const d=o(h);let m=h.name;return d&&(m=h.metadata?.time_layers?.[d]??m),m}function o(h){return[h.currentTimeMinValue,...h.currentTimeMaxValue?[h.currentTimeMaxValue]:[]].join(Jee)}function s(h){const d=Qr();if(!h.metadata?.exclusion)return;const m=Ui(),y=m.layers.filter(x=>e(h?.metadata?.exclusion,x?.metadata?.exclusion));if(y.length>0){if(m.removeLayers(...y.map(C=>C.id)),y.some(C=>Hm(C.layers)||Hm(C.name)))try{vu.clearParcelHighlights(),Ym.clearParcelHighlights()}catch{}d.addNotification(Wn.t("The layer <b>{{layersToRemove}}</b> has been removed because it cannot be displayed while the layer <b>{{layer}}</b> is displayed",{count:y.length,layersToRemove:y.map(C=>Wn.t(C.name,{ns:"client"})).join(", "),layer:Wn.t(h.name,{ns:"client"}),ns:"client"}),ii.WARNING)}h.id!==m.bgLayer?.id&&l(h)}function l(h){const d=Ui(),m=Qr();if(e(h.metadata?.exclusion,d.bgLayer?.metadata?.exclusion)&&(d.setBgLayer(null),m.addNotification(Wn.t("Background has been deactivated because the layer {{layer}} cannot be displayed on top of it.",{layer:Wn.t(h.name,{ns:"client"}),ns:"client"}),ii.WARNING),Hm(h.layers)||Hm(h.name)))try{vu.clearParcelHighlights(),Ym.clearParcelHighlights()}catch{}}function u(h,d=!0,m,y){const x=Zr(),C=Ui(),w=m?x.layerTrees_3d:x.theme,E=n.findById(h,y?w:void 0);if(E){const T=E.metadata?.linked_layers||[];d===!1?C.removeLayers(E.id,...T):(s(E),(m?C.add3dLayers:C.addLayers)(t(E),...T.map(G=>t(n.findById(parseInt(G,10))))))}}return{initLayer:t,getLayerCurrentLabel:r,getLayerCurrentTime:o,handleExclusionLayers:s,toggleLayer:u}}class mg extends Error{}class ene extends mg{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class tne extends mg{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class nne extends mg{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class Km extends mg{}class oV extends mg{constructor(e){super(`Invalid unit ${e}`)}}class ea extends mg{}class Gd extends mg{constructor(){super("Zone is an abstract class")}}const fn="numeric",Vu="short",El="long",GC={year:fn,month:fn,day:fn},aV={year:fn,month:Vu,day:fn},ine={year:fn,month:Vu,day:fn,weekday:Vu},lV={year:fn,month:El,day:fn},uV={year:fn,month:El,day:fn,weekday:El},cV={hour:fn,minute:fn},hV={hour:fn,minute:fn,second:fn},dV={hour:fn,minute:fn,second:fn,timeZoneName:Vu},fV={hour:fn,minute:fn,second:fn,timeZoneName:El},pV={hour:fn,minute:fn,hourCycle:"h23"},gV={hour:fn,minute:fn,second:fn,hourCycle:"h23"},mV={hour:fn,minute:fn,second:fn,hourCycle:"h23",timeZoneName:Vu},yV={hour:fn,minute:fn,second:fn,hourCycle:"h23",timeZoneName:El},_V={year:fn,month:fn,day:fn,hour:fn,minute:fn},vV={year:fn,month:fn,day:fn,hour:fn,minute:fn,second:fn},bV={year:fn,month:Vu,day:fn,hour:fn,minute:fn},xV={year:fn,month:Vu,day:fn,hour:fn,minute:fn,second:fn},rne={year:fn,month:Vu,day:fn,weekday:Vu,hour:fn,minute:fn},IV={year:fn,month:El,day:fn,hour:fn,minute:fn,timeZoneName:Vu},CV={year:fn,month:El,day:fn,hour:fn,minute:fn,second:fn,timeZoneName:Vu},wV={year:fn,month:El,day:fn,weekday:El,hour:fn,minute:fn,timeZoneName:El},AV={year:fn,month:El,day:fn,weekday:El,hour:fn,minute:fn,second:fn,timeZoneName:El};class Eb{get type(){throw new Gd}get name(){throw new Gd}get ianaName(){return this.name}get isUniversal(){throw new Gd}offsetName(e,t){throw new Gd}formatOffset(e,t){throw new Gd}offset(e){throw new Gd}equals(e){throw new Gd}get isValid(){throw new Gd}}let yS=null;class rA extends Eb{static get instance(){return yS===null&&(yS=new rA),yS}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return OV(e,t,i)}formatOffset(e,t){return av(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}const mT=new Map;function sne(n){let e=mT.get(n);return e===void 0&&(e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:n,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),mT.set(n,e)),e}const one={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function ane(n,e){const t=n.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(t),[,r,o,s,l,u,h,d]=i;return[s,r,o,l,u,h,d]}function lne(n,e){const t=n.formatToParts(e),i=[];for(let r=0;r<t.length;r++){const{type:o,value:s}=t[r],l=one[o];o==="era"?i[l]=s:ai(l)||(i[l]=parseInt(s,10))}return i}const _S=new Map;class Jh extends Eb{static create(e){let t=_S.get(e);return t===void 0&&_S.set(e,t=new Jh(e)),t}static resetCache(){_S.clear(),mT.clear()}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Jh.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return OV(e,t,i,this.name)}formatOffset(e,t){return av(this.offset(e),t)}offset(e){if(!this.valid)return NaN;const t=new Date(e);if(isNaN(t))return NaN;const i=sne(this.name);let[r,o,s,l,u,h,d]=i.formatToParts?lne(i,t):ane(i,t);l==="BC"&&(r=-Math.abs(r)+1);const y=oA({year:r,month:o,day:s,hour:u===24?0:u,minute:h,second:d,millisecond:0});let x=+t;const C=x%1e3;return x-=C>=0?C:1e3+C,(y-x)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let jF={};function une(n,e={}){const t=JSON.stringify([n,e]);let i=jF[t];return i||(i=new Intl.ListFormat(n,e),jF[t]=i),i}const yT=new Map;function _T(n,e={}){const t=JSON.stringify([n,e]);let i=yT.get(t);return i===void 0&&(i=new Intl.DateTimeFormat(n,e),yT.set(t,i)),i}const vT=new Map;function cne(n,e={}){const t=JSON.stringify([n,e]);let i=vT.get(t);return i===void 0&&(i=new Intl.NumberFormat(n,e),vT.set(t,i)),i}const bT=new Map;function hne(n,e={}){const{base:t,...i}=e,r=JSON.stringify([n,i]);let o=bT.get(r);return o===void 0&&(o=new Intl.RelativeTimeFormat(n,e),bT.set(r,o)),o}let F0=null;function dne(){return F0||(F0=new Intl.DateTimeFormat().resolvedOptions().locale,F0)}const xT=new Map;function SV(n){let e=xT.get(n);return e===void 0&&(e=new Intl.DateTimeFormat(n).resolvedOptions(),xT.set(n,e)),e}const IT=new Map;function fne(n){let e=IT.get(n);if(!e){const t=new Intl.Locale(n);e="getWeekInfo"in t?t.getWeekInfo():t.weekInfo,"minimalDays"in e||(e={...EV,...e}),IT.set(n,e)}return e}function pne(n){const e=n.indexOf("-x-");e!==-1&&(n=n.substring(0,e));const t=n.indexOf("-u-");if(t===-1)return[n];{let i,r;try{i=_T(n).resolvedOptions(),r=n}catch{const u=n.substring(0,t);i=_T(u).resolvedOptions(),r=u}const{numberingSystem:o,calendar:s}=i;return[r,o,s]}}function gne(n,e,t){return(t||e)&&(n.includes("-u-")||(n+="-u"),t&&(n+=`-ca-${t}`),e&&(n+=`-nu-${e}`)),n}function mne(n){const e=[];for(let t=1;t<=12;t++){const i=oi.utc(2009,t,1);e.push(n(i))}return e}function yne(n){const e=[];for(let t=1;t<=7;t++){const i=oi.utc(2016,11,13+t);e.push(n(i))}return e}function vx(n,e,t,i){const r=n.listingMode();return r==="error"?null:r==="en"?t(e):i(e)}function _ne(n){return n.numberingSystem&&n.numberingSystem!=="latn"?!1:n.numberingSystem==="latn"||!n.locale||n.locale.startsWith("en")||SV(n.locale).numberingSystem==="latn"}class vne{constructor(e,t,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:r,floor:o,...s}=i;if(!t||Object.keys(s).length>0){const l={useGrouping:!1,...i};i.padTo>0&&(l.minimumIntegerDigits=i.padTo),this.inf=cne(e,l)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}else{const t=this.floor?Math.floor(e):JM(e,3);return qs(t,this.padTo)}}}class bne{constructor(e,t,i){this.opts=i,this.originalZone=void 0;let r;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const s=-1*(e.offset/60),l=s>=0?`Etc/GMT+${s}`:`Etc/GMT${s}`;e.offset!==0&&Jh.create(l).valid?(r=l,this.dt=e):(r="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,r=e.zone.name):(r="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const o={...this.opts};o.timeZone=o.timeZone||r,this.dtf=_T(t,o)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(t=>{if(t.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...t,value:i}}else return t}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class xne{constructor(e,t,i){this.opts={style:"long",...i},!t&&GV()&&(this.rtf=hne(e,i))}format(e,t){return this.rtf?this.rtf.format(e,t):zne(t,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}const EV={firstDay:1,minimalDays:4,weekend:[6,7]};class xr{static fromOpts(e){return xr.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,t,i,r,o=!1){const s=e||Es.defaultLocale,l=s||(o?"en-US":dne()),u=t||Es.defaultNumberingSystem,h=i||Es.defaultOutputCalendar,d=wT(r)||Es.defaultWeekSettings;return new xr(l,u,h,d,s)}static resetCache(){F0=null,yT.clear(),vT.clear(),bT.clear(),xT.clear(),IT.clear()}static fromObject({locale:e,numberingSystem:t,outputCalendar:i,weekSettings:r}={}){return xr.create(e,t,i,r)}constructor(e,t,i,r,o){const[s,l,u]=pne(e);this.locale=s,this.numberingSystem=t||l||null,this.outputCalendar=i||u||null,this.weekSettings=r,this.intl=gne(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=o,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=_ne(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&t?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:xr.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,wT(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1){return vx(this,e,VV,()=>{const i=this.intl==="ja"||this.intl.startsWith("ja-");t&=!i;const r=t?{month:e,day:"numeric"}:{month:e},o=t?"format":"standalone";if(!this.monthsCache[o][e]){const s=i?l=>this.dtFormatter(l,r).format():l=>this.extract(l,r,"month");this.monthsCache[o][e]=mne(s)}return this.monthsCache[o][e]})}weekdays(e,t=!1){return vx(this,e,WV,()=>{const i=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},r=t?"format":"standalone";return this.weekdaysCache[r][e]||(this.weekdaysCache[r][e]=yne(o=>this.extract(o,i,"weekday"))),this.weekdaysCache[r][e]})}meridiems(){return vx(this,void 0,()=>zV,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[oi.utc(2016,11,13,9),oi.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return vx(this,e,UV,()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[oi.utc(-40,1,1),oi.utc(2017,1,1)].map(i=>this.extract(i,t,"era"))),this.eraCache[e]})}extract(e,t,i){const r=this.dtFormatter(e,t),o=r.formatToParts(),s=o.find(l=>l.type.toLowerCase()===i);return s?s.value:null}numberFormatter(e={}){return new vne(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new bne(e,this.intl,t)}relFormatter(e={}){return new xne(this.intl,this.isEnglish(),e)}listFormatter(e={}){return une(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||SV(this.intl).locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:FV()?fne(this.locale):EV}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let vS=null;class Ca extends Eb{static get utcInstance(){return vS===null&&(vS=new Ca(0)),vS}static instance(e){return e===0?Ca.utcInstance:new Ca(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new Ca(aA(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${av(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${av(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return av(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class Ine extends Eb{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Yd(n,e){if(ai(n)||n===null)return e;if(n instanceof Eb)return n;if(Tne(n)){const t=n.toLowerCase();return t==="default"?e:t==="local"||t==="system"?rA.instance:t==="utc"||t==="gmt"?Ca.utcInstance:Ca.parseSpecifier(t)||Jh.create(n)}else return uf(n)?Ca.instance(n):typeof n=="object"&&"offset"in n&&typeof n.offset=="function"?n:new Ine(n)}const HM={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},$F={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Cne=HM.hanidec.replace(/[\[|\]]/g,"").split("");function wne(n){let e=parseInt(n,10);if(isNaN(e)){e="";for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);if(n[t].search(HM.hanidec)!==-1)e+=Cne.indexOf(n[t]);else for(const r in $F){const[o,s]=$F[r];i>=o&&i<=s&&(e+=i-o)}}return parseInt(e,10)}else return e}const CT=new Map;function Ane(){CT.clear()}function pu({numberingSystem:n},e=""){const t=n||"latn";let i=CT.get(t);i===void 0&&(i=new Map,CT.set(t,i));let r=i.get(e);return r===void 0&&(r=new RegExp(`${HM[t]}${e}`),i.set(e,r)),r}let JF=()=>Date.now(),qF="system",QF=null,eO=null,tO=null,nO=60,iO,rO=null;class Es{static get now(){return JF}static set now(e){JF=e}static set defaultZone(e){qF=e}static get defaultZone(){return Yd(qF,rA.instance)}static get defaultLocale(){return QF}static set defaultLocale(e){QF=e}static get defaultNumberingSystem(){return eO}static set defaultNumberingSystem(e){eO=e}static get defaultOutputCalendar(){return tO}static set defaultOutputCalendar(e){tO=e}static get defaultWeekSettings(){return rO}static set defaultWeekSettings(e){rO=wT(e)}static get twoDigitCutoffYear(){return nO}static set twoDigitCutoffYear(e){nO=e%100}static get throwOnInvalid(){return iO}static set throwOnInvalid(e){iO=e}static resetCaches(){xr.resetCache(),Jh.resetCache(),oi.resetCache(),Ane()}}class Su{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const TV=[0,31,59,90,120,151,181,212,243,273,304,334],RV=[0,31,60,91,121,152,182,213,244,274,305,335];function Hl(n,e){return new Su("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${n}, which is invalid`)}function KM(n,e,t){const i=new Date(Date.UTC(n,e-1,t));n<100&&n>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const r=i.getUTCDay();return r===0?7:r}function MV(n,e,t){return t+(Tb(n)?RV:TV)[e-1]}function kV(n,e){const t=Tb(n)?RV:TV,i=t.findIndex(o=>o<e),r=e-t[i];return{month:i+1,day:r}}function jM(n,e){return(n-e+7)%7+1}function FC(n,e=4,t=1){const{year:i,month:r,day:o}=n,s=MV(i,r,o),l=jM(KM(i,r,o),t);let u=Math.floor((s-l+14-e)/7),h;return u<1?(h=i-1,u=Kv(h,e,t)):u>Kv(i,e,t)?(h=i+1,u=1):h=i,{weekYear:h,weekNumber:u,weekday:l,...lA(n)}}function sO(n,e=4,t=1){const{weekYear:i,weekNumber:r,weekday:o}=n,s=jM(KM(i,1,e),t),l=hy(i);let u=r*7+o-s-7+e,h;u<1?(h=i-1,u+=hy(h)):u>l?(h=i+1,u-=hy(i)):h=i;const{month:d,day:m}=kV(h,u);return{year:h,month:d,day:m,...lA(n)}}function bS(n){const{year:e,month:t,day:i}=n,r=MV(e,t,i);return{year:e,ordinal:r,...lA(n)}}function oO(n){const{year:e,ordinal:t}=n,{month:i,day:r}=kV(e,t);return{year:e,month:i,day:r,...lA(n)}}function aO(n,e){if(!ai(n.localWeekday)||!ai(n.localWeekNumber)||!ai(n.localWeekYear)){if(!ai(n.weekday)||!ai(n.weekNumber)||!ai(n.weekYear))throw new Km("Cannot mix locale-based week fields with ISO-based week fields");return ai(n.localWeekday)||(n.weekday=n.localWeekday),ai(n.localWeekNumber)||(n.weekNumber=n.localWeekNumber),ai(n.localWeekYear)||(n.weekYear=n.localWeekYear),delete n.localWeekday,delete n.localWeekNumber,delete n.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function Sne(n,e=4,t=1){const i=sA(n.weekYear),r=Kl(n.weekNumber,1,Kv(n.weekYear,e,t)),o=Kl(n.weekday,1,7);return i?r?o?!1:Hl("weekday",n.weekday):Hl("week",n.weekNumber):Hl("weekYear",n.weekYear)}function Ene(n){const e=sA(n.year),t=Kl(n.ordinal,1,hy(n.year));return e?t?!1:Hl("ordinal",n.ordinal):Hl("year",n.year)}function LV(n){const e=sA(n.year),t=Kl(n.month,1,12),i=Kl(n.day,1,OC(n.year,n.month));return e?t?i?!1:Hl("day",n.day):Hl("month",n.month):Hl("year",n.year)}function PV(n){const{hour:e,minute:t,second:i,millisecond:r}=n,o=Kl(e,0,23)||e===24&&t===0&&i===0&&r===0,s=Kl(t,0,59),l=Kl(i,0,59),u=Kl(r,0,999);return o?s?l?u?!1:Hl("millisecond",r):Hl("second",i):Hl("minute",t):Hl("hour",e)}function ai(n){return typeof n>"u"}function uf(n){return typeof n=="number"}function sA(n){return typeof n=="number"&&n%1===0}function Tne(n){return typeof n=="string"}function Rne(n){return Object.prototype.toString.call(n)==="[object Date]"}function GV(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function FV(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function Mne(n){return Array.isArray(n)?n:[n]}function lO(n,e,t){if(n.length!==0)return n.reduce((i,r)=>{const o=[e(r),r];return i&&t(i[0],o[0])===i[0]?i:o},null)[1]}function kne(n,e){return e.reduce((t,i)=>(t[i]=n[i],t),{})}function ky(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function wT(n){if(n==null)return null;if(typeof n!="object")throw new ea("Week settings must be an object");if(!Kl(n.firstDay,1,7)||!Kl(n.minimalDays,1,7)||!Array.isArray(n.weekend)||n.weekend.some(e=>!Kl(e,1,7)))throw new ea("Invalid week settings");return{firstDay:n.firstDay,minimalDays:n.minimalDays,weekend:Array.from(n.weekend)}}function Kl(n,e,t){return sA(n)&&n>=e&&n<=t}function Lne(n,e){return n-e*Math.floor(n/e)}function qs(n,e=2){const t=n<0;let i;return t?i="-"+(""+-n).padStart(e,"0"):i=(""+n).padStart(e,"0"),i}function Wd(n){if(!(ai(n)||n===null||n===""))return parseInt(n,10)}function mp(n){if(!(ai(n)||n===null||n===""))return parseFloat(n)}function $M(n){if(!(ai(n)||n===null||n==="")){const e=parseFloat("0."+n)*1e3;return Math.floor(e)}}function JM(n,e,t="round"){const i=10**e;switch(t){case"expand":return n>0?Math.ceil(n*i)/i:Math.floor(n*i)/i;case"trunc":return Math.trunc(n*i)/i;case"round":return Math.round(n*i)/i;case"floor":return Math.floor(n*i)/i;case"ceil":return Math.ceil(n*i)/i;default:throw new RangeError(`Value rounding ${t} is out of range`)}}function Tb(n){return n%4===0&&(n%100!==0||n%400===0)}function hy(n){return Tb(n)?366:365}function OC(n,e){const t=Lne(e-1,12)+1,i=n+(e-t)/12;return t===2?Tb(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][t-1]}function oA(n){let e=Date.UTC(n.year,n.month-1,n.day,n.hour,n.minute,n.second,n.millisecond);return n.year<100&&n.year>=0&&(e=new Date(e),e.setUTCFullYear(n.year,n.month-1,n.day)),+e}function uO(n,e,t){return-jM(KM(n,1,e),t)+e-1}function Kv(n,e=4,t=1){const i=uO(n,e,t),r=uO(n+1,e,t);return(hy(n)-i+r)/7}function AT(n){return n>99?n:n>Es.twoDigitCutoffYear?1900+n:2e3+n}function OV(n,e,t,i=null){const r=new Date(n),o={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(o.timeZone=i);const s={timeZoneName:e,...o},l=new Intl.DateTimeFormat(t,s).formatToParts(r).find(u=>u.type.toLowerCase()==="timezonename");return l?l.value:null}function aA(n,e){let t=parseInt(n,10);Number.isNaN(t)&&(t=0);const i=parseInt(e,10)||0,r=t<0||Object.is(t,-0)?-i:i;return t*60+r}function NV(n){const e=Number(n);if(typeof n=="boolean"||n===""||!Number.isFinite(e))throw new ea(`Invalid unit value ${n}`);return e}function NC(n,e){const t={};for(const i in n)if(ky(n,i)){const r=n[i];if(r==null)continue;t[e(i)]=NV(r)}return t}function av(n,e){const t=Math.trunc(Math.abs(n/60)),i=Math.trunc(Math.abs(n%60)),r=n>=0?"+":"-";switch(e){case"short":return`${r}${qs(t,2)}:${qs(i,2)}`;case"narrow":return`${r}${t}${i>0?`:${i}`:""}`;case"techie":return`${r}${qs(t,2)}${qs(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function lA(n){return kne(n,["hour","minute","second","millisecond"])}const Pne=["January","February","March","April","May","June","July","August","September","October","November","December"],DV=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Gne=["J","F","M","A","M","J","J","A","S","O","N","D"];function VV(n){switch(n){case"narrow":return[...Gne];case"short":return[...DV];case"long":return[...Pne];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const BV=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ZV=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Fne=["M","T","W","T","F","S","S"];function WV(n){switch(n){case"narrow":return[...Fne];case"short":return[...ZV];case"long":return[...BV];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const zV=["AM","PM"],One=["Before Christ","Anno Domini"],Nne=["BC","AD"],Dne=["B","A"];function UV(n){switch(n){case"narrow":return[...Dne];case"short":return[...Nne];case"long":return[...One];default:return null}}function Vne(n){return zV[n.hour<12?0:1]}function Bne(n,e){return WV(e)[n.weekday-1]}function Zne(n,e){return VV(e)[n.month-1]}function Wne(n,e){return UV(e)[n.year<0?0:1]}function zne(n,e,t="always",i=!1){const r={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},o=["hours","minutes","seconds"].indexOf(n)===-1;if(t==="auto"&&o){const m=n==="days";switch(e){case 1:return m?"tomorrow":`next ${r[n][0]}`;case-1:return m?"yesterday":`last ${r[n][0]}`;case 0:return m?"today":`this ${r[n][0]}`}}const s=Object.is(e,-0)||e<0,l=Math.abs(e),u=l===1,h=r[n],d=i?u?h[1]:h[2]||h[1]:u?r[n][0]:n;return s?`${l} ${d} ago`:`in ${l} ${d}`}function cO(n,e){let t="";for(const i of n)i.literal?t+=i.val:t+=e(i.val);return t}const Une={D:GC,DD:aV,DDD:lV,DDDD:uV,t:cV,tt:hV,ttt:dV,tttt:fV,T:pV,TT:gV,TTT:mV,TTTT:yV,f:_V,ff:bV,fff:IV,ffff:wV,F:vV,FF:xV,FFF:CV,FFFF:AV};class ra{static create(e,t={}){return new ra(e,t)}static parseFormat(e){let t=null,i="",r=!1;const o=[];for(let s=0;s<e.length;s++){const l=e.charAt(s);l==="'"?((i.length>0||r)&&o.push({literal:r||/^\s+$/.test(i),val:i===""?"'":i}),t=null,i="",r=!r):r||l===t?i+=l:(i.length>0&&o.push({literal:/^\s+$/.test(i),val:i}),i=l,t=l)}return i.length>0&&o.push({literal:r||/^\s+$/.test(i),val:i}),o}static macroTokenToFormatOpts(e){return Une[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0,i=void 0){if(this.opts.forceSimple)return qs(e,t);const r={...this.opts};return t>0&&(r.padTo=t),i&&(r.signDisplay=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,t){const i=this.loc.listingMode()==="en",r=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",o=(x,C)=>this.loc.extract(e,x,C),s=x=>e.isOffsetFixed&&e.offset===0&&x.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,x.format):"",l=()=>i?Vne(e):o({hour:"numeric",hourCycle:"h12"},"dayperiod"),u=(x,C)=>i?Zne(e,x):o(C?{month:x}:{month:x,day:"numeric"},"month"),h=(x,C)=>i?Bne(e,x):o(C?{weekday:x}:{weekday:x,month:"long",day:"numeric"},"weekday"),d=x=>{const C=ra.macroTokenToFormatOpts(x);return C?this.formatWithSystemDefault(e,C):x},m=x=>i?Wne(e,x):o({era:x},"era"),y=x=>{switch(x){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return s({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return s({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return s({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return l();case"d":return r?o({day:"numeric"},"day"):this.num(e.day);case"dd":return r?o({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return h("short",!0);case"cccc":return h("long",!0);case"ccccc":return h("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return h("short",!1);case"EEEE":return h("long",!1);case"EEEEE":return h("narrow",!1);case"L":return r?o({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return r?o({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return u("short",!0);case"LLLL":return u("long",!0);case"LLLLL":return u("narrow",!0);case"M":return r?o({month:"numeric"},"month"):this.num(e.month);case"MM":return r?o({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return u("short",!1);case"MMMM":return u("long",!1);case"MMMMM":return u("narrow",!1);case"y":return r?o({year:"numeric"},"year"):this.num(e.year);case"yy":return r?o({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return r?o({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return r?o({year:"numeric"},"year"):this.num(e.year,6);case"G":return m("short");case"GG":return m("long");case"GGGGG":return m("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return d(x)}};return cO(ra.parseFormat(t),y)}formatDurationFromString(e,t){const i=this.opts.signMode==="negativeLargestOnly"?-1:1,r=d=>{switch(d[0]){case"S":return"milliseconds";case"s":return"seconds";case"m":return"minutes";case"h":return"hours";case"d":return"days";case"w":return"weeks";case"M":return"months";case"y":return"years";default:return null}},o=(d,m)=>y=>{const x=r(y);if(x){const C=m.isNegativeDuration&&x!==m.largestUnit?i:1;let w;return this.opts.signMode==="negativeLargestOnly"&&x!==m.largestUnit?w="never":this.opts.signMode==="all"?w="always":w="auto",this.num(d.get(x)*C,y.length,w)}else return y},s=ra.parseFormat(t),l=s.reduce((d,{literal:m,val:y})=>m?d:d.concat(y),[]),u=e.shiftTo(...l.map(r).filter(d=>d)),h={isNegativeDuration:u<0,largestUnit:Object.keys(u.values)[0]};return cO(s,o(u,h))}}const XV=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function Ky(...n){const e=n.reduce((t,i)=>t+i.source,"");return RegExp(`^${e}$`)}function jy(...n){return e=>n.reduce(([t,i,r],o)=>{const[s,l,u]=o(e,r);return[{...t,...s},l||i,u]},[{},null,1]).slice(0,2)}function $y(n,...e){if(n==null)return[null,null];for(const[t,i]of e){const r=t.exec(n);if(r)return i(r)}return[null,null]}function YV(...n){return(e,t)=>{const i={};let r;for(r=0;r<n.length;r++)i[n[r]]=Wd(e[t+r]);return[i,null,t+r]}}const HV=/(?:([Zz])|([+-]\d\d)(?::?(\d\d))?)/,Xne=`(?:${HV.source}?(?:\\[(${XV.source})\\])?)?`,qM=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,KV=RegExp(`${qM.source}${Xne}`),QM=RegExp(`(?:[Tt]${KV.source})?`),Yne=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Hne=/(\d{4})-?W(\d\d)(?:-?(\d))?/,Kne=/(\d{4})-?(\d{3})/,jne=YV("weekYear","weekNumber","weekDay"),$ne=YV("year","ordinal"),Jne=/(\d{4})-(\d\d)-(\d\d)/,jV=RegExp(`${qM.source} ?(?:${HV.source}|(${XV.source}))?`),qne=RegExp(`(?: ${jV.source})?`);function dy(n,e,t){const i=n[e];return ai(i)?t:Wd(i)}function Qne(n,e){return[{year:dy(n,e),month:dy(n,e+1,1),day:dy(n,e+2,1)},null,e+3]}function Jy(n,e){return[{hours:dy(n,e,0),minutes:dy(n,e+1,0),seconds:dy(n,e+2,0),milliseconds:$M(n[e+3])},null,e+4]}function Rb(n,e){const t=!n[e]&&!n[e+1],i=aA(n[e+1],n[e+2]),r=t?null:Ca.instance(i);return[{},r,e+3]}function Mb(n,e){const t=n[e]?Jh.create(n[e]):null;return[{},t,e+1]}const eie=RegExp(`^T?${qM.source}$`),tie=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function nie(n){const[e,t,i,r,o,s,l,u,h]=n,d=e[0]==="-",m=u&&u[0]==="-",y=(x,C=!1)=>x!==void 0&&(C||x&&d)?-x:x;return[{years:y(mp(t)),months:y(mp(i)),weeks:y(mp(r)),days:y(mp(o)),hours:y(mp(s)),minutes:y(mp(l)),seconds:y(mp(u),u==="-0"),milliseconds:y($M(h),m)}]}const iie={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function ek(n,e,t,i,r,o,s){const l={year:e.length===2?AT(Wd(e)):Wd(e),month:DV.indexOf(t)+1,day:Wd(i),hour:Wd(r),minute:Wd(o)};return s&&(l.second=Wd(s)),n&&(l.weekday=n.length>3?BV.indexOf(n)+1:ZV.indexOf(n)+1),l}const rie=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function sie(n){const[,e,t,i,r,o,s,l,u,h,d,m]=n,y=ek(e,r,i,t,o,s,l);let x;return u?x=iie[u]:h?x=0:x=aA(d,m),[y,new Ca(x)]}function oie(n){return n.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const aie=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,lie=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,uie=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function hO(n){const[,e,t,i,r,o,s,l]=n;return[ek(e,r,i,t,o,s,l),Ca.utcInstance]}function cie(n){const[,e,t,i,r,o,s,l]=n;return[ek(e,l,t,i,r,o,s),Ca.utcInstance]}const hie=Ky(Yne,QM),die=Ky(Hne,QM),fie=Ky(Kne,QM),pie=Ky(KV),$V=jy(Qne,Jy,Rb,Mb),gie=jy(jne,Jy,Rb,Mb),mie=jy($ne,Jy,Rb,Mb),yie=jy(Jy,Rb,Mb);function _ie(n){return $y(n,[hie,$V],[die,gie],[fie,mie],[pie,yie])}function vie(n){return $y(oie(n),[rie,sie])}function bie(n){return $y(n,[aie,hO],[lie,hO],[uie,cie])}function xie(n){return $y(n,[tie,nie])}const Iie=jy(Jy);function Cie(n){return $y(n,[eie,Iie])}const wie=Ky(Jne,qne),Aie=Ky(jV),Sie=jy(Jy,Rb,Mb);function Eie(n){return $y(n,[wie,$V],[Aie,Sie])}const dO="Invalid Duration",JV={weeks:{days:7,hours:168,minutes:10080,seconds:10080*60,milliseconds:10080*60*1e3},days:{hours:24,minutes:1440,seconds:1440*60,milliseconds:1440*60*1e3},hours:{minutes:60,seconds:3600,milliseconds:3600*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Tie={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:2184*60,seconds:2184*60*60,milliseconds:2184*60*60*1e3},months:{weeks:4,days:30,hours:720,minutes:720*60,seconds:720*60*60,milliseconds:720*60*60*1e3},...JV},Wl=146097/400,xm=146097/4800,Rie={years:{quarters:4,months:12,weeks:Wl/7,days:Wl,hours:Wl*24,minutes:Wl*24*60,seconds:Wl*24*60*60,milliseconds:Wl*24*60*60*1e3},quarters:{months:3,weeks:Wl/28,days:Wl/4,hours:Wl*24/4,minutes:Wl*24*60/4,seconds:Wl*24*60*60/4,milliseconds:Wl*24*60*60*1e3/4},months:{weeks:xm/7,days:xm,hours:xm*24,minutes:xm*24*60,seconds:xm*24*60*60,milliseconds:xm*24*60*60*1e3},...JV},Fp=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Mie=Fp.slice(0).reverse();function bh(n,e,t=!1){const i={values:t?e.values:{...n.values,...e.values||{}},loc:n.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||n.conversionAccuracy,matrix:e.matrix||n.matrix};return new ir(i)}function qV(n,e){let t=e.milliseconds??0;for(const i of Mie.slice(1))e[i]&&(t+=e[i]*n[i].milliseconds);return t}function fO(n,e){const t=qV(n,e)<0?-1:1;Fp.reduceRight((i,r)=>{if(ai(e[r]))return i;if(i){const o=e[i]*t,s=n[r][i],l=Math.floor(o/s);e[r]+=l*t,e[i]-=l*s*t}return r},null),Fp.reduce((i,r)=>{if(ai(e[r]))return i;if(i){const o=e[i]%1;e[i]-=o,e[r]+=o*n[i][r]}return r},null)}function pO(n){const e={};for(const[t,i]of Object.entries(n))i!==0&&(e[t]=i);return e}class ir{constructor(e){const t=e.conversionAccuracy==="longterm"||!1;let i=t?Rie:Tie;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||xr.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,t){return ir.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(e==null||typeof e!="object")throw new ea(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new ir({values:NC(e,ir.normalizeUnit),loc:xr.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(uf(e))return ir.fromMillis(e);if(ir.isDuration(e))return e;if(typeof e=="object")return ir.fromObject(e);throw new ea(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[i]=xie(e);return i?ir.fromObject(i,t):ir.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[i]=Cie(e);return i?ir.fromObject(i,t):ir.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new ea("need to specify a reason the Duration is invalid");const i=e instanceof Su?e:new Su(e,t);if(Es.throwOnInvalid)throw new nne(i);return new ir({invalid:i})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!t)throw new oV(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const i={...t,floor:t.round!==!1&&t.floor!==!1};return this.isValid?ra.create(this.loc,i).formatDurationFromString(this,e):dO}toHuman(e={}){if(!this.isValid)return dO;const t=e.showZeros!==!1,i=Fp.map(r=>{const o=this.values[r];return ai(o)||o===0&&!t?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(o)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=JM(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();return t<0||t>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},oi.fromMillis(t,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?qV(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=ir.fromDurationLike(e),i={};for(const r of Fp)(ky(t.values,r)||ky(this.values,r))&&(i[r]=t.get(r)+this.get(r));return bh(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const t=ir.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=NV(e(this.values[i],i));return bh(this,{values:t},!0)}get(e){return this[ir.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const t={...this.values,...NC(e,ir.normalizeUnit)};return bh(this,{values:t})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:i,matrix:r}={}){const s={loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:r,conversionAccuracy:i};return bh(this,s)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return fO(this.matrix,e),bh(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=pO(this.normalize().shiftToAll().toObject());return bh(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(s=>ir.normalizeUnit(s));const t={},i={},r=this.toObject();let o;for(const s of Fp)if(e.indexOf(s)>=0){o=s;let l=0;for(const h in i)l+=this.matrix[h][s]*i[h],i[h]=0;uf(r[s])&&(l+=r[s]);const u=Math.trunc(l);t[s]=u,i[s]=(l*1e3-u*1e3)/1e3}else uf(r[s])&&(i[s]=r[s]);for(const s in i)i[s]!==0&&(t[o]+=s===o?i[s]:i[s]/this.matrix[o][s]);return fO(this.matrix,t),bh(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=this.values[t]===0?0:-this.values[t];return bh(this,{values:e},!0)}removeZeros(){if(!this.isValid)return this;const e=pO(this.values);return bh(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function t(i,r){return i===void 0||i===0?r===void 0||r===0:i===r}for(const i of Fp)if(!t(this.values[i],e.values[i]))return!1;return!0}}const Im="Invalid Interval";function kie(n,e){return!n||!n.isValid?As.invalid("missing or invalid start"):!e||!e.isValid?As.invalid("missing or invalid end"):e<n?As.invalid("end before start",`The end of an interval must be after its start, but you had start=${n.toISO()} and end=${e.toISO()}`):null}class As{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new ea("need to specify a reason the Interval is invalid");const i=e instanceof Su?e:new Su(e,t);if(Es.throwOnInvalid)throw new tne(i);return new As({invalid:i})}static fromDateTimes(e,t){const i=m0(e),r=m0(t),o=kie(i,r);return o??new As({start:i,end:r})}static after(e,t){const i=ir.fromDurationLike(t),r=m0(e);return As.fromDateTimes(r,r.plus(i))}static before(e,t){const i=ir.fromDurationLike(t),r=m0(e);return As.fromDateTimes(r.minus(i),r)}static fromISO(e,t){const[i,r]=(e||"").split("/",2);if(i&&r){let o,s;try{o=oi.fromISO(i,t),s=o.isValid}catch{s=!1}let l,u;try{l=oi.fromISO(r,t),u=l.isValid}catch{u=!1}if(s&&u)return As.fromDateTimes(o,l);if(s){const h=ir.fromISO(r,t);if(h.isValid)return As.after(o,h)}else if(u){const h=ir.fromISO(i,t);if(h.isValid)return As.before(l,h)}}return As.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",t){if(!this.isValid)return NaN;const i=this.start.startOf(e,t);let r;return t?.useLocaleWeeks?r=this.end.reconfigure({locale:i.locale}):r=this.end,r=r.startOf(e,t),Math.floor(r.diff(i,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:t}={}){return this.isValid?As.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(m0).filter(s=>this.contains(s)).sort((s,l)=>s.toMillis()-l.toMillis()),i=[];let{s:r}=this,o=0;for(;r<this.e;){const s=t[o]||this.e,l=+s>+this.e?this.e:s;i.push(As.fromDateTimes(r,l)),r=l,o+=1}return i}splitBy(e){const t=ir.fromDurationLike(e);if(!this.isValid||!t.isValid||t.as("milliseconds")===0)return[];let{s:i}=this,r=1,o;const s=[];for(;i<this.e;){const l=this.start.plus(t.mapUnits(u=>u*r));o=+l>+this.e?this.e:l,s.push(As.fromDateTimes(i,o)),i=o,r+=1}return s}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return t>=i?null:As.fromDateTimes(t,i)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return As.fromDateTimes(t,i)}static merge(e){const[t,i]=e.sort((r,o)=>r.s-o.s).reduce(([r,o],s)=>o?o.overlaps(s)||o.abutsStart(s)?[r,o.union(s)]:[r.concat([o]),s]:[r,s],[[],null]);return i&&t.push(i),t}static xor(e){let t=null,i=0;const r=[],o=e.map(u=>[{time:u.s,type:"s"},{time:u.e,type:"e"}]),s=Array.prototype.concat(...o),l=s.sort((u,h)=>u.time-h.time);for(const u of l)i+=u.type==="s"?1:-1,i===1?t=u.time:(t&&+t!=+u.time&&r.push(As.fromDateTimes(t,u.time)),t=null);return As.merge(r)}difference(...e){return As.xor([this].concat(e)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:Im}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=GC,t={}){return this.isValid?ra.create(this.s.loc.clone(t),e).formatInterval(this):Im}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Im}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Im}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Im}toFormat(e,{separator:t="  "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:Im}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):ir.invalid(this.invalidReason)}mapEndpoints(e){return As.fromDateTimes(e(this.s),e(this.e))}}class bx{static hasDST(e=Es.defaultZone){const t=oi.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return Jh.isValidZone(e)}static normalizeZone(e){return Yd(e,Es.defaultZone)}static getStartOfWeek({locale:e=null,locObj:t=null}={}){return(t||xr.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:t=null}={}){return(t||xr.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:t=null}={}){return(t||xr.create(e)).getWeekendDays().slice()}static months(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null,outputCalendar:o="gregory"}={}){return(r||xr.create(t,i,o)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null,outputCalendar:o="gregory"}={}){return(r||xr.create(t,i,o)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null}={}){return(r||xr.create(t,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null}={}){return(r||xr.create(t,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return xr.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return xr.create(t,null,"gregory").eras(e)}static features(){return{relative:GV(),localeWeek:FV()}}}function gO(n,e){const t=r=>r.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=t(e)-t(n);return Math.floor(ir.fromMillis(i).as("days"))}function Lie(n,e,t){const i=[["years",(u,h)=>h.year-u.year],["quarters",(u,h)=>h.quarter-u.quarter+(h.year-u.year)*4],["months",(u,h)=>h.month-u.month+(h.year-u.year)*12],["weeks",(u,h)=>{const d=gO(u,h);return(d-d%7)/7}],["days",gO]],r={},o=n;let s,l;for(const[u,h]of i)t.indexOf(u)>=0&&(s=u,r[u]=h(n,e),l=o.plus(r),l>e?(r[u]--,n=o.plus(r),n>e&&(l=n,r[u]--,n=o.plus(r))):n=l);return[n,r,l,s]}function Pie(n,e,t,i){let[r,o,s,l]=Lie(n,e,t);const u=e-r,h=t.filter(m=>["hours","minutes","seconds","milliseconds"].indexOf(m)>=0);h.length===0&&(s<e&&(s=r.plus({[l]:1})),s!==r&&(o[l]=(o[l]||0)+u/(s-r)));const d=ir.fromObject(o,i);return h.length>0?ir.fromMillis(u,i).shiftTo(...h).plus(d):d}const Gie="missing Intl.DateTimeFormat.formatToParts support";function pr(n,e=t=>t){return{regex:n,deser:([t])=>e(wne(t))}}const Fie="",QV=`[ ${Fie}]`,eB=new RegExp(QV,"g");function Oie(n){return n.replace(/\./g,"\\.?").replace(eB,QV)}function mO(n){return n.replace(/\./g,"").replace(eB," ").toLowerCase()}function gu(n,e){return n===null?null:{regex:RegExp(n.map(Oie).join("|")),deser:([t])=>n.findIndex(i=>mO(t)===mO(i))+e}}function yO(n,e){return{regex:n,deser:([,t,i])=>aA(t,i),groups:e}}function xx(n){return{regex:n,deser:([e])=>e}}function Nie(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Die(n,e){const t=pu(e),i=pu(e,"{2}"),r=pu(e,"{3}"),o=pu(e,"{4}"),s=pu(e,"{6}"),l=pu(e,"{1,2}"),u=pu(e,"{1,3}"),h=pu(e,"{1,6}"),d=pu(e,"{1,9}"),m=pu(e,"{2,4}"),y=pu(e,"{4,6}"),x=E=>({regex:RegExp(Nie(E.val)),deser:([T])=>T,literal:!0}),w=(E=>{if(n.literal)return x(E);switch(E.val){case"G":return gu(e.eras("short"),0);case"GG":return gu(e.eras("long"),0);case"y":return pr(h);case"yy":return pr(m,AT);case"yyyy":return pr(o);case"yyyyy":return pr(y);case"yyyyyy":return pr(s);case"M":return pr(l);case"MM":return pr(i);case"MMM":return gu(e.months("short",!0),1);case"MMMM":return gu(e.months("long",!0),1);case"L":return pr(l);case"LL":return pr(i);case"LLL":return gu(e.months("short",!1),1);case"LLLL":return gu(e.months("long",!1),1);case"d":return pr(l);case"dd":return pr(i);case"o":return pr(u);case"ooo":return pr(r);case"HH":return pr(i);case"H":return pr(l);case"hh":return pr(i);case"h":return pr(l);case"mm":return pr(i);case"m":return pr(l);case"q":return pr(l);case"qq":return pr(i);case"s":return pr(l);case"ss":return pr(i);case"S":return pr(u);case"SSS":return pr(r);case"u":return xx(d);case"uu":return xx(l);case"uuu":return pr(t);case"a":return gu(e.meridiems(),0);case"kkkk":return pr(o);case"kk":return pr(m,AT);case"W":return pr(l);case"WW":return pr(i);case"E":case"c":return pr(t);case"EEE":return gu(e.weekdays("short",!1),1);case"EEEE":return gu(e.weekdays("long",!1),1);case"ccc":return gu(e.weekdays("short",!0),1);case"cccc":return gu(e.weekdays("long",!0),1);case"Z":case"ZZ":return yO(new RegExp(`([+-]${l.source})(?::(${i.source}))?`),2);case"ZZZ":return yO(new RegExp(`([+-]${l.source})(${i.source})?`),2);case"z":return xx(/[a-z_+-/]{1,256}?/i);case" ":return xx(/[^\S\n\r]/);default:return x(E)}})(n)||{invalidReason:Gie};return w.token=n,w}const Vie={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Bie(n,e,t){const{type:i,value:r}=n;if(i==="literal"){const u=/^\s+$/.test(r);return{literal:!u,val:u?" ":r}}const o=e[i];let s=i;i==="hour"&&(e.hour12!=null?s=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?s="hour12":s="hour24":s=t.hour12?"hour12":"hour24");let l=Vie[s];if(typeof l=="object"&&(l=l[o]),l)return{literal:!1,val:l}}function Zie(n){return[`^${n.map(t=>t.regex).reduce((t,i)=>`${t}(${i.source})`,"")}$`,n]}function Wie(n,e,t){const i=n.match(e);if(i){const r={};let o=1;for(const s in t)if(ky(t,s)){const l=t[s],u=l.groups?l.groups+1:1;!l.literal&&l.token&&(r[l.token.val[0]]=l.deser(i.slice(o,o+u))),o+=u}return[i,r]}else return[i,{}]}function zie(n){const e=o=>{switch(o){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let t=null,i;return ai(n.z)||(t=Jh.create(n.z)),ai(n.Z)||(t||(t=new Ca(n.Z)),i=n.Z),ai(n.q)||(n.M=(n.q-1)*3+1),ai(n.h)||(n.h<12&&n.a===1?n.h+=12:n.h===12&&n.a===0&&(n.h=0)),n.G===0&&n.y&&(n.y=-n.y),ai(n.u)||(n.S=$M(n.u)),[Object.keys(n).reduce((o,s)=>{const l=e(s);return l&&(o[l]=n[s]),o},{}),t,i]}let xS=null;function Uie(){return xS||(xS=oi.fromMillis(1555555555555)),xS}function Xie(n,e){if(n.literal)return n;const t=ra.macroTokenToFormatOpts(n.val),i=rB(t,e);return i==null||i.includes(void 0)?n:i}function tB(n,e){return Array.prototype.concat(...n.map(t=>Xie(t,e)))}class nB{constructor(e,t){if(this.locale=e,this.format=t,this.tokens=tB(ra.parseFormat(t),e),this.units=this.tokens.map(i=>Die(i,e)),this.disqualifyingUnit=this.units.find(i=>i.invalidReason),!this.disqualifyingUnit){const[i,r]=Zie(this.units);this.regex=RegExp(i,"i"),this.handlers=r}}explainFromTokens(e){if(this.isValid){const[t,i]=Wie(e,this.regex,this.handlers),[r,o,s]=i?zie(i):[null,null,void 0];if(ky(i,"a")&&ky(i,"H"))throw new Km("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:t,matches:i,result:r,zone:o,specificOffset:s}}else return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function iB(n,e,t){return new nB(n,t).explainFromTokens(e)}function Yie(n,e,t){const{result:i,zone:r,specificOffset:o,invalidReason:s}=iB(n,e,t);return[i,r,o,s]}function rB(n,e){if(!n)return null;const i=ra.create(e,n).dtFormatter(Uie()),r=i.formatToParts(),o=i.resolvedOptions();return r.map(s=>Bie(s,n,o))}const IS="Invalid DateTime",_O=864e13;function O0(n){return new Su("unsupported zone",`the zone "${n.name}" is not supported`)}function CS(n){return n.weekData===null&&(n.weekData=FC(n.c)),n.weekData}function wS(n){return n.localWeekData===null&&(n.localWeekData=FC(n.c,n.loc.getMinDaysInFirstWeek(),n.loc.getStartOfWeek())),n.localWeekData}function yp(n,e){const t={ts:n.ts,zone:n.zone,c:n.c,o:n.o,loc:n.loc,invalid:n.invalid};return new oi({...t,...e,old:t})}function sB(n,e,t){let i=n-e*60*1e3;const r=t.offset(i);if(e===r)return[i,e];i-=(r-e)*60*1e3;const o=t.offset(i);return r===o?[i,r]:[n-Math.min(r,o)*60*1e3,Math.max(r,o)]}function Ix(n,e){n+=e*60*1e3;const t=new Date(n);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()}}function vI(n,e,t){return sB(oA(n),e,t)}function vO(n,e){const t=n.o,i=n.c.year+Math.trunc(e.years),r=n.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,o={...n.c,year:i,month:r,day:Math.min(n.c.day,OC(i,r))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},s=ir.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),l=oA(o);let[u,h]=sB(l,t,n.zone);return s!==0&&(u+=s,h=n.zone.offset(u)),{ts:u,o:h}}function Cm(n,e,t,i,r,o){const{setZone:s,zone:l}=t;if(n&&Object.keys(n).length!==0||e){const u=e||l,h=oi.fromObject(n,{...t,zone:u,specificOffset:o});return s?h:h.setZone(l)}else return oi.invalid(new Su("unparsable",`the input "${r}" can't be parsed as ${i}`))}function Cx(n,e,t=!0){return n.isValid?ra.create(xr.create("en-US"),{allowZ:t,forceSimple:!0}).formatDateTimeFromString(n,e):null}function AS(n,e,t){const i=n.c.year>9999||n.c.year<0;let r="";if(i&&n.c.year>=0&&(r+="+"),r+=qs(n.c.year,i?6:4),t==="year")return r;if(e){if(r+="-",r+=qs(n.c.month),t==="month")return r;r+="-"}else if(r+=qs(n.c.month),t==="month")return r;return r+=qs(n.c.day),r}function bO(n,e,t,i,r,o,s){let l=!t||n.c.millisecond!==0||n.c.second!==0,u="";switch(s){case"day":case"month":case"year":break;default:if(u+=qs(n.c.hour),s==="hour")break;if(e){if(u+=":",u+=qs(n.c.minute),s==="minute")break;l&&(u+=":",u+=qs(n.c.second))}else{if(u+=qs(n.c.minute),s==="minute")break;l&&(u+=qs(n.c.second))}if(s==="second")break;l&&(!i||n.c.millisecond!==0)&&(u+=".",u+=qs(n.c.millisecond,3))}return r&&(n.isOffsetFixed&&n.offset===0&&!o?u+="Z":n.o<0?(u+="-",u+=qs(Math.trunc(-n.o/60)),u+=":",u+=qs(Math.trunc(-n.o%60))):(u+="+",u+=qs(Math.trunc(n.o/60)),u+=":",u+=qs(Math.trunc(n.o%60)))),o&&(u+="["+n.zone.ianaName+"]"),u}const oB={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Hie={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Kie={ordinal:1,hour:0,minute:0,second:0,millisecond:0},bI=["year","month","day","hour","minute","second","millisecond"],jie=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],$ie=["year","ordinal","hour","minute","second","millisecond"];function xI(n){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[n.toLowerCase()];if(!e)throw new oV(n);return e}function xO(n){switch(n.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return xI(n)}}function Jie(n){if(N0===void 0&&(N0=Es.now()),n.type!=="iana")return n.offset(N0);const e=n.name;let t=ST.get(e);return t===void 0&&(t=n.offset(N0),ST.set(e,t)),t}function IO(n,e){const t=Yd(e.zone,Es.defaultZone);if(!t.isValid)return oi.invalid(O0(t));const i=xr.fromObject(e);let r,o;if(ai(n.year))r=Es.now();else{for(const u of bI)ai(n[u])&&(n[u]=oB[u]);const s=LV(n)||PV(n);if(s)return oi.invalid(s);const l=Jie(t);[r,o]=vI(n,l,t)}return new oi({ts:r,zone:t,loc:i,o})}function CO(n,e,t){const i=ai(t.round)?!0:t.round,r=ai(t.rounding)?"trunc":t.rounding,o=(l,u)=>(l=JM(l,i||t.calendary?0:2,t.calendary?"round":r),e.loc.clone(t).relFormatter(t).format(l,u)),s=l=>t.calendary?e.hasSame(n,l)?0:e.startOf(l).diff(n.startOf(l),l).get(l):e.diff(n,l).get(l);if(t.unit)return o(s(t.unit),t.unit);for(const l of t.units){const u=s(l);if(Math.abs(u)>=1)return o(u,l)}return o(n>e?-0:0,t.units[t.units.length-1])}function wO(n){let e={},t;return n.length>0&&typeof n[n.length-1]=="object"?(e=n[n.length-1],t=Array.from(n).slice(0,n.length-1)):t=Array.from(n),[e,t]}let N0;const ST=new Map;class oi{constructor(e){const t=e.zone||Es.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new Su("invalid input"):null)||(t.isValid?null:O0(t));this.ts=ai(e.ts)?Es.now():e.ts;let r=null,o=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[r,o]=[e.old.c,e.old.o];else{const l=uf(e.o)&&!e.old?e.o:t.offset(this.ts);r=Ix(this.ts,l),i=Number.isNaN(r.year)?new Su("invalid input"):null,r=i?null:r,o=i?null:l}this._zone=t,this.loc=e.loc||xr.create(),this.invalid=i,this.weekData=null,this.localWeekData=null,this.c=r,this.o=o,this.isLuxonDateTime=!0}static now(){return new oi({})}static local(){const[e,t]=wO(arguments),[i,r,o,s,l,u,h]=t;return IO({year:i,month:r,day:o,hour:s,minute:l,second:u,millisecond:h},e)}static utc(){const[e,t]=wO(arguments),[i,r,o,s,l,u,h]=t;return e.zone=Ca.utcInstance,IO({year:i,month:r,day:o,hour:s,minute:l,second:u,millisecond:h},e)}static fromJSDate(e,t={}){const i=Rne(e)?e.valueOf():NaN;if(Number.isNaN(i))return oi.invalid("invalid input");const r=Yd(t.zone,Es.defaultZone);return r.isValid?new oi({ts:i,zone:r,loc:xr.fromObject(t)}):oi.invalid(O0(r))}static fromMillis(e,t={}){if(uf(e))return e<-_O||e>_O?oi.invalid("Timestamp out of range"):new oi({ts:e,zone:Yd(t.zone,Es.defaultZone),loc:xr.fromObject(t)});throw new ea(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(uf(e))return new oi({ts:e*1e3,zone:Yd(t.zone,Es.defaultZone),loc:xr.fromObject(t)});throw new ea("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const i=Yd(t.zone,Es.defaultZone);if(!i.isValid)return oi.invalid(O0(i));const r=xr.fromObject(t),o=NC(e,xO),{minDaysInFirstWeek:s,startOfWeek:l}=aO(o,r),u=Es.now(),h=ai(t.specificOffset)?i.offset(u):t.specificOffset,d=!ai(o.ordinal),m=!ai(o.year),y=!ai(o.month)||!ai(o.day),x=m||y,C=o.weekYear||o.weekNumber;if((x||d)&&C)throw new Km("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(y&&d)throw new Km("Can't mix ordinal dates with month/day");const w=C||o.weekday&&!x;let E,T,k=Ix(u,h);w?(E=jie,T=Hie,k=FC(k,s,l)):d?(E=$ie,T=Kie,k=bS(k)):(E=bI,T=oB);let G=!1;for(const ae of E){const fe=o[ae];ai(fe)?G?o[ae]=T[ae]:o[ae]=k[ae]:G=!0}const O=w?Sne(o,s,l):d?Ene(o):LV(o),V=O||PV(o);if(V)return oi.invalid(V);const z=w?sO(o,s,l):d?oO(o):o,[H,te]=vI(z,h,i),$=new oi({ts:H,zone:i,o:te,loc:r});return o.weekday&&x&&e.weekday!==$.weekday?oi.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${$.toISO()}`):$.isValid?$:oi.invalid($.invalid)}static fromISO(e,t={}){const[i,r]=_ie(e);return Cm(i,r,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[i,r]=vie(e);return Cm(i,r,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[i,r]=bie(e);return Cm(i,r,t,"HTTP",t)}static fromFormat(e,t,i={}){if(ai(e)||ai(t))throw new ea("fromFormat requires an input string and a format");const{locale:r=null,numberingSystem:o=null}=i,s=xr.fromOpts({locale:r,numberingSystem:o,defaultToEN:!0}),[l,u,h,d]=Yie(s,e,t);return d?oi.invalid(d):Cm(l,u,i,`format ${t}`,e,h)}static fromString(e,t,i={}){return oi.fromFormat(e,t,i)}static fromSQL(e,t={}){const[i,r]=Eie(e);return Cm(i,r,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new ea("need to specify a reason the DateTime is invalid");const i=e instanceof Su?e:new Su(e,t);if(Es.throwOnInvalid)throw new ene(i);return new oi({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const i=rB(e,xr.fromObject(t));return i?i.map(r=>r?r.val:null).join(""):null}static expandFormat(e,t={}){return tB(ra.parseFormat(e),xr.fromObject(t)).map(r=>r.val).join("")}static resetCache(){N0=void 0,ST.clear()}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?CS(this).weekYear:NaN}get weekNumber(){return this.isValid?CS(this).weekNumber:NaN}get weekday(){return this.isValid?CS(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?wS(this).weekday:NaN}get localWeekNumber(){return this.isValid?wS(this).weekNumber:NaN}get localWeekYear(){return this.isValid?wS(this).weekYear:NaN}get ordinal(){return this.isValid?bS(this.c).ordinal:NaN}get monthShort(){return this.isValid?bx.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?bx.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?bx.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?bx.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,i=oA(this.c),r=this.zone.offset(i-e),o=this.zone.offset(i+e),s=this.zone.offset(i-r*t),l=this.zone.offset(i-o*t);if(s===l)return[this];const u=i-s*t,h=i-l*t,d=Ix(u,s),m=Ix(h,l);return d.hour===m.hour&&d.minute===m.minute&&d.second===m.second&&d.millisecond===m.millisecond?[yp(this,{ts:u}),yp(this,{ts:h})]:[this]}get isInLeapYear(){return Tb(this.year)}get daysInMonth(){return OC(this.year,this.month)}get daysInYear(){return this.isValid?hy(this.year):NaN}get weeksInWeekYear(){return this.isValid?Kv(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?Kv(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:i,calendar:r}=ra.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:i,outputCalendar:r}}toUTC(e=0,t={}){return this.setZone(Ca.instance(e),t)}toLocal(){return this.setZone(Es.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:i=!1}={}){if(e=Yd(e,Es.defaultZone),e.equals(this.zone))return this;if(e.isValid){let r=this.ts;if(t||i){const o=e.offset(this.ts),s=this.toObject();[r]=vI(s,o,e)}return yp(this,{ts:r,zone:e})}else return oi.invalid(O0(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:i}={}){const r=this.loc.clone({locale:e,numberingSystem:t,outputCalendar:i});return yp(this,{loc:r})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=NC(e,xO),{minDaysInFirstWeek:i,startOfWeek:r}=aO(t,this.loc),o=!ai(t.weekYear)||!ai(t.weekNumber)||!ai(t.weekday),s=!ai(t.ordinal),l=!ai(t.year),u=!ai(t.month)||!ai(t.day),h=l||u,d=t.weekYear||t.weekNumber;if((h||s)&&d)throw new Km("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(u&&s)throw new Km("Can't mix ordinal dates with month/day");let m;o?m=sO({...FC(this.c,i,r),...t},i,r):ai(t.ordinal)?(m={...this.toObject(),...t},ai(t.day)&&(m.day=Math.min(OC(m.year,m.month),m.day))):m=oO({...bS(this.c),...t});const[y,x]=vI(m,this.o,this.zone);return yp(this,{ts:y,o:x})}plus(e){if(!this.isValid)return this;const t=ir.fromDurationLike(e);return yp(this,vO(this,t))}minus(e){if(!this.isValid)return this;const t=ir.fromDurationLike(e).negate();return yp(this,vO(this,t))}startOf(e,{useLocaleWeeks:t=!1}={}){if(!this.isValid)return this;const i={},r=ir.normalizeUnit(e);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks")if(t){const o=this.loc.getStartOfWeek(),{weekday:s}=this;s<o&&(i.weekNumber=this.weekNumber-1),i.weekday=o}else i.weekday=1;if(r==="quarters"){const o=Math.ceil(this.month/3);i.month=(o-1)*3+1}return this.set(i)}endOf(e,t){return this.isValid?this.plus({[e]:1}).startOf(e,t).minus(1):this}toFormat(e,t={}){return this.isValid?ra.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):IS}toLocaleString(e=GC,t={}){return this.isValid?ra.create(this.loc.clone(t),e).formatDateTime(this):IS}toLocaleParts(e={}){return this.isValid?ra.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:i=!1,includeOffset:r=!0,extendedZone:o=!1,precision:s="milliseconds"}={}){if(!this.isValid)return null;s=xI(s);const l=e==="extended";let u=AS(this,l,s);return bI.indexOf(s)>=3&&(u+="T"),u+=bO(this,l,t,i,r,o,s),u}toISODate({format:e="extended",precision:t="day"}={}){return this.isValid?AS(this,e==="extended",xI(t)):null}toISOWeekDate(){return Cx(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:i=!0,includePrefix:r=!1,extendedZone:o=!1,format:s="extended",precision:l="milliseconds"}={}){return this.isValid?(l=xI(l),(r&&bI.indexOf(l)>=3?"T":"")+bO(this,s==="extended",t,e,i,o,l)):null}toRFC2822(){return Cx(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return Cx(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?AS(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:i=!0}={}){let r="HH:mm:ss.SSS";return(t||e)&&(i&&(r+=" "),t?r+="z":e&&(r+="ZZ")),Cx(this,r,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():IS}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",i={}){if(!this.isValid||!e.isValid)return ir.invalid("created by diffing an invalid DateTime");const r={locale:this.locale,numberingSystem:this.numberingSystem,...i},o=Mne(t).map(ir.normalizeUnit),s=e.valueOf()>this.valueOf(),l=s?this:e,u=s?e:this,h=Pie(l,u,o,r);return s?h.negate():h}diffNow(e="milliseconds",t={}){return this.diff(oi.now(),e,t)}until(e){return this.isValid?As.fromDateTimes(this,e):this}hasSame(e,t,i){if(!this.isValid)return!1;const r=e.valueOf(),o=this.setZone(e.zone,{keepLocalTime:!0});return o.startOf(t,i)<=r&&r<=o.endOf(t,i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||oi.fromObject({},{zone:this.zone}),i=e.padding?this<t?-e.padding:e.padding:0;let r=["years","months","days","hours","minutes","seconds"],o=e.unit;return Array.isArray(e.unit)&&(r=e.unit,o=void 0),CO(t,this.plus(i),{...e,numeric:"always",units:r,unit:o})}toRelativeCalendar(e={}){return this.isValid?CO(e.base||oi.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(oi.isDateTime))throw new ea("min requires all arguments be DateTimes");return lO(e,t=>t.valueOf(),Math.min)}static max(...e){if(!e.every(oi.isDateTime))throw new ea("max requires all arguments be DateTimes");return lO(e,t=>t.valueOf(),Math.max)}static fromFormatExplain(e,t,i={}){const{locale:r=null,numberingSystem:o=null}=i,s=xr.fromOpts({locale:r,numberingSystem:o,defaultToEN:!0});return iB(s,e,t)}static fromStringExplain(e,t,i={}){return oi.fromFormatExplain(e,t,i)}static buildFormatParser(e,t={}){const{locale:i=null,numberingSystem:r=null}=t,o=xr.fromOpts({locale:i,numberingSystem:r,defaultToEN:!0});return new nB(o,e)}static fromFormatParser(e,t,i={}){if(ai(e)||ai(t))throw new ea("fromFormatParser requires an input string and a format parser");const{locale:r=null,numberingSystem:o=null}=i,s=xr.fromOpts({locale:r,numberingSystem:o,defaultToEN:!0});if(!s.equals(t.locale))throw new ea(`fromFormatParser called with a locale of ${s}, but the format parser was created for ${t.locale}`);const{result:l,zone:u,specificOffset:h,invalidReason:d}=t.explainFromTokens(e);return d?oi.invalid(d):Cm(l,u,i,`format ${t.format}`,e,h)}static get DATE_SHORT(){return GC}static get DATE_MED(){return aV}static get DATE_MED_WITH_WEEKDAY(){return ine}static get DATE_FULL(){return lV}static get DATE_HUGE(){return uV}static get TIME_SIMPLE(){return cV}static get TIME_WITH_SECONDS(){return hV}static get TIME_WITH_SHORT_OFFSET(){return dV}static get TIME_WITH_LONG_OFFSET(){return fV}static get TIME_24_SIMPLE(){return pV}static get TIME_24_WITH_SECONDS(){return gV}static get TIME_24_WITH_SHORT_OFFSET(){return mV}static get TIME_24_WITH_LONG_OFFSET(){return yV}static get DATETIME_SHORT(){return _V}static get DATETIME_SHORT_WITH_SECONDS(){return vV}static get DATETIME_MED(){return bV}static get DATETIME_MED_WITH_SECONDS(){return xV}static get DATETIME_MED_WITH_WEEKDAY(){return rne}static get DATETIME_FULL(){return IV}static get DATETIME_FULL_WITH_SECONDS(){return CV}static get DATETIME_HUGE(){return wV}static get DATETIME_HUGE_WITH_SECONDS(){return AV}}function m0(n){if(oi.isDateTime(n))return n;if(n&&n.valueOf&&uf(n.valueOf()))return oi.fromJSDate(n);if(n&&typeof n=="object")return oi.fromObject(n);throw new ea(`Unknown datetime argument: ${n}, of type ${typeof n}`)}const aB=[0,1,0,0];function AO(n,e="second",t,i){const{t:r}=St(),o=new Date(n).toISOString(),s={year:r("yyyy"),month:r("M/yyyy"),day:r("M/d/yyyy"),second:r("M/d/yyyy HH:mm:ss")},u=(t?{year:"yyyy",month:"yyyy-MM",day:"yyyy-MM-dd",second:void 0}:s)[e];return u?oi.fromISO(o).toFormat(`${i?"UTC:":""}${u}`):o.replace(/\.\d{3}/,"")}function ET(n){return new Date(n).toISOString().split(".")[0]+"Z"}function SS(n){return oi.fromISO(n).toFormat("yyyy-MM-dd")}function qie(n,e){return n<=e.minValue?e.minValue:n>=e.maxValue?e.maxValue:e.timeValueList?Qie(n,e):ere(n,e)}function Qie(n,e){const t=e.timeValueList??[];let i,r=0,o=t.length-1;for(;o-r>1;)i=Math.floor((r+o)/2),t[i]>=n?o=i:r=i;const s=Math.abs(t[r]-n),l=Math.abs(t[o]-n);return t[s<l?r:o]}function ere(n,e){const t=e.timeInterval??aB,i=new Date(n).getTime(),r=new Date(e.minValue),o=e.maxValue;let s=e.minValue,l=Math.abs(i-s);for(let u=1;;u++){const h=new Date(r.getTime());if(h.setFullYear(r.getFullYear()+u*t[0]),h.setMonth(r.getMonth()+u*t[1],r.getDate()+u*t[2]),h.setSeconds(r.getSeconds()+u*t[3]),h.getTime()>o)break;const d=Math.abs(i-h.getTime());if(d<=l)s=h.getTime(),l=d;else break}return s}const Ui=ca("map",()=>{const n=la(),e=Ue({}),t=mi([]),i=mi([]),r=Ue(!1),o=Ue(!1),s=Ue(void 0),l=Ue(void 0),u=Ue(void 0),h=Ue(void 0),d=Ue(void 0),m=Ue(void 0),y=Ue(void 0);function x(te){s.value=te}function C(...te){t.value=[...new Set([...t.value,...te])]}function w(...te){i.value=[...new Set([...i.value,...te])]}function E(...te){t.value=t.value.filter($=>te.indexOf($.id)===-1),i.value=i.value.filter($=>te.indexOf($.id)===-1)}function T(){t.value=[]}function k(te){return!!t.value?.find($=>$.id===te)}function G(te,$=!1){const ae=$?i:t;ae.value=[...ae.value?.sort((fe,Y)=>te.indexOf(fe.id)-te.indexOf(Y.id))||[]]}function O(te,$){t.value=t.value.map(ae=>ae.id===te?{...ae,opacity:$,previousOpacity:ae.opacity}:ae)}function V(te,$,ae){t.value=t.value.map(fe=>{if(fe.id===te){const Y={...fe,currentTimeMinValue:$?ET($):void 0,currentTimeMaxValue:ae?ET(ae):void 0};return Y.type==="WMTS"&&(Y.name=n.getLayerCurrentLabel(Y)),Y}return fe})}function z(te){r.value=te}function H(te){o.value=te}return{map:e,layers:t,layers3d:i,is3dActive:r,is3dMesh:o,bgLayer:s,minZoom:l,maxZoom:u,x:h,y:d,zoom:m,rotation:y,addLayers:C,add3dLayers:w,removeLayers:E,removeAllLayers:T,reorderLayers:G,setLayerOpacity:O,setLayerTime:V,setBgLayer:x,setIs3dActive:z,setIs3dMesh:H,hasLayer:k}});function Tl(){function n(d,m){return t(d,void 0,m)}function e(d,m){return t(void 0,d,m)}function t(d,m,y){const{themes:x}=Zr();if(y=y||x?.find(C=>t(d,m,C)),d&&y?.id===+d||m&&y?.name===m)return y;if(y?.children)for(const C of y.children){const w=t(d,m,C);if(w)return w}}function i(d){const{themes:m}=Zr(),y=[];function x(C,w){C.id===+d&&y.push(w),C.children&&C.children.forEach(E=>x(E,w))}return m&&Array.isArray(m)&&m.forEach(C=>{C?.metadata?.display_in_switcher&&x(C,C.name)}),[...new Set(y)]}function r(d){const{layerTrees_3d:m}=Zr();return t(d,void 0,m)}function o(d){const{bgLayers:m}=Zr();return m.find(y=>y.id===d)}function s(d){const{bgLayers:m}=Zr();return m.find(y=>y.name===d)}function l(d){return o(+d)||n(+d)||r(+d)}function u(d){const{setTheme:m}=Zr();m(d),h(d)}function h(d){const{maxZoom:m}=It(Ui()),y=e(d),{resolutions:x}=y?.metadata||{};m.value=x?x.length+7:v4}return{findById:n,findByName:e,find3dLayerById:r,findBgLayerById:o,findBgLayerByName:s,findAnyLayerById:l,setTheme:u,findThemeNamesByLayerId:i}}var Rc=(n=>(n.WMS="WMS",n.WMTS="WMTS",n))(Rc||{});let tre=0;function nre(){return tre++}var tk=Object.defineProperty,ire=Object.getOwnPropertyDescriptor,rre=Object.getOwnPropertyNames,sre=Object.prototype.hasOwnProperty,ore=(n,e)=>{for(var t in e)tk(n,t,{get:e[t],enumerable:!0})},are=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of rre(e))!sre.call(n,r)&&r!==t&&tk(n,r,{get:()=>e[r],enumerable:!(i=ire(e,r))||i.enumerable});return n},lre=n=>are(tk({},"__esModule",{value:!0}),n),lB={};ore(lB,{XmlCdata:()=>dB,XmlComment:()=>fB,XmlDeclaration:()=>pB,XmlDocument:()=>gB,XmlDocumentType:()=>mB,XmlElement:()=>uA,XmlError:()=>yB,XmlNode:()=>lr,XmlProcessingInstruction:()=>TT,XmlText:()=>ik,parseXml:()=>vre});lre(lB);var _p="",ure=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,cre=class{constructor(n){if(this.k=this.q(n,!0),this.d=0,this.length=n.length,this.n=this.k!==this.length,this.m=n,this.n){let e=[];for(let t=0,i=0;i<this.k;++i)e[i]=t,t+=n.codePointAt(t)>65535?2:1;this.y=e}}get z(){return this.d>=this.k}q(n,e=this.n){return e?n.replace(ure,"_").length:n.length}g(n=1){this.d=Math.min(this.k,this.d+n)}i(n=this.d){var e;return this.n?(e=this.y[n])!=null?e:1/0:n}F(n=1){let e=this.h(n);return this.g(n),e}G(n){if(!n.sticky)throw new Error('`regex` must have a sticky flag ("y")');n.lastIndex=this.i();let e=n.exec(this.m);if(e===null||e.length===0)return _p;let t=e[0];return this.g(this.q(t)),t}v(n){let e,t=_p;for(;(e=this.h())&&n(e);)t+=e,this.g();return t}Q(n){if(this.b(n))return n;if(this.n){let{length:e}=n,t=this.q(n);if(t!==e&&n===this.h(t))return this.g(t),n}return _p}b(n){let{length:e}=n;return this.h(e)===n?(this.g(e),n):_p}A(n){let e=this.m.slice(this.i()),t=e.search(n);if(t<=0)return _p;let i=e.slice(0,t);return this.g(this.q(i)),i}t(n){let{m:e}=this,t=this.i(),i=e.indexOf(n,t);if(i<=0)return _p;let r=e.slice(t,i);return this.g(this.q(r)),r}h(n=1){let{d:e,n:t,m:i}=this;return t?e>=this.k?_p:i.slice(this.i(e),this.i(e+n)):i.slice(e,e+n)}o(n=0){this.d=n>=0?Math.min(this.k,n):Math.max(0,this.d+n)}},hre=/[^"&<]+/y,dre=/[^'&<]+/y,fre=/\r\n|[\n\r\t]/g,pre=/<|&|]]>/,gre=Object.freeze(Object.assign(Object.create(null),{amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}));function uB(n){let e=nk(n);return e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57||e===45||e===46||e===183||e>=768&&e<=879||e>=8255&&e<=8256||cB(n,e)}function cB(n,e=nk(n)){return e>=97&&e<=122||e>=65&&e<=90||e===58||e===95||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039}function mre(n){return n==="#"||uB(n)}function yre(n){let e=nk(n);return e===32||e===9||e===10||e===13}function SO(n){return n===9||n===10||n===13||n>=32&&n<=55295||n>=57344&&n<=65533||n>=65536&&n<=1114111}function nk(n){return n.codePointAt(0)||-1}var hB=class{constructor(){this.parent=null,this.start=-1,this.end=-1}get document(){var n,e;return(e=(n=this.parent)==null?void 0:n.document)!=null?e:null}get isRootNode(){return this.parent!==null&&this.parent===this.document&&this.type===hB.TYPE_ELEMENT}get preserveWhitespace(){var n;return!!((n=this.parent)!=null&&n.preserveWhitespace)}get type(){return""}toJSON(){let n={type:this.type};return this.isRootNode&&(n.isRootNode=!0),this.preserveWhitespace&&(n.preserveWhitespace=!0),this.start!==-1&&(n.start=this.start,n.end=this.end),n}},lr=hB;lr.TYPE_CDATA="cdata";lr.TYPE_COMMENT="comment";lr.TYPE_DOCUMENT="document";lr.TYPE_DOCUMENT_TYPE="doctype";lr.TYPE_ELEMENT="element";lr.TYPE_PROCESSING_INSTRUCTION="pi";lr.TYPE_TEXT="text";lr.TYPE_XML_DECLARATION="xmldecl";var ik=class extends lr{constructor(n=""){super(),this.text=n}get type(){return lr.TYPE_TEXT}toJSON(){return Object.assign(lr.prototype.toJSON.call(this),{text:this.text})}},dB=class extends ik{get type(){return lr.TYPE_CDATA}},fB=class extends lr{constructor(n=""){super(),this.content=n}get type(){return lr.TYPE_COMMENT}toJSON(){return Object.assign(lr.prototype.toJSON.call(this),{content:this.content})}},pB=class extends lr{constructor(n,e,t){super(),this.version=n,this.encoding=e??null,this.standalone=t??null}get type(){return lr.TYPE_XML_DECLARATION}toJSON(){let n=lr.prototype.toJSON.call(this);n.version=this.version;for(let e of["encoding","standalone"])this[e]!==null&&(n[e]=this[e]);return n}},uA=class extends lr{constructor(n,e=Object.create(null),t=[]){super(),this.name=n,this.attributes=e,this.children=t}get isEmpty(){return this.children.length===0}get preserveWhitespace(){let n=this;for(;n instanceof uA;){if("xml:space"in n.attributes)return n.attributes["xml:space"]==="preserve";n=n.parent}return!1}get text(){return this.children.map(n=>"text"in n?n.text:"").join("")}get type(){return lr.TYPE_ELEMENT}toJSON(){return Object.assign(lr.prototype.toJSON.call(this),{name:this.name,attributes:this.attributes,children:this.children.map(n=>n.toJSON())})}},gB=class extends lr{constructor(n=[]){super(),this.children=n}get document(){return this}get root(){for(let n of this.children)if(n instanceof uA)return n;return null}get text(){return this.children.map(n=>"text"in n?n.text:"").join("")}get type(){return lr.TYPE_DOCUMENT}toJSON(){return Object.assign(lr.prototype.toJSON.call(this),{children:this.children.map(n=>n.toJSON())})}},mB=class extends lr{constructor(n,e,t,i){super(),this.name=n,this.publicId=e??null,this.systemId=t??null,this.internalSubset=i??null}get type(){return lr.TYPE_DOCUMENT_TYPE}toJSON(){let n=lr.prototype.toJSON.call(this);n.name=this.name;for(let e of["publicId","systemId","internalSubset"])this[e]!==null&&(n[e]=this[e]);return n}},yB=class extends Error{constructor(n,e,t){let i=1,r="",o=1;for(let u=0;u<e;++u){let h=t[u];h===`
`?(i=1,r="",o+=1):(i+=1,r+=h)}let s=t.indexOf(`
`,e);r+=s===-1?t.slice(e):t.slice(e,s);let l=0;r.length>50&&(i<40?r=r.slice(0,50):(l=i-20,r=r.slice(l,i+30))),super(`${n} (line ${o}, column ${i})
  ${r}
`+" ".repeat(i-l+1)+`^
`),this.column=i,this.excerpt=r,this.line=o,this.name="XmlError",this.pos=e}},TT=class extends lr{constructor(n,e=""){super(),this.name=n,this.content=e}get type(){return lr.TYPE_PROCESSING_INSTRUCTION}toJSON(){return Object.assign(lr.prototype.toJSON.call(this),{name:this.name,content:this.content})}},ES="",_re=class{constructor(n,e={}){let t=this.document=new gB,i=this.c=new cre(n);if(this.l=t,this.f=e,this.f.includeOffsets&&(t.start=0,t.end=n.length),i.b("\uFEFF"),this.H(),!this.B())throw this.a("Root element is missing or invalid");for(;this.w(););if(!i.z)throw this.a("Extra content at the end of the document")}j(n,e){return n.parent=this.l,this.f.includeOffsets&&(n.start=this.c.i(e),n.end=this.c.i()),this.l.children.push(n),!0}x(n,e){let{children:t}=this.l,{length:i}=t;if(n=wx(n),i>0){let r=t[i-1];if(r?.type===lr.TYPE_TEXT){let o=r;return o.text+=n,this.f.includeOffsets&&(o.end=this.c.i()),!0}}return this.j(new ik(n),e)}I(){let n=Object.create(null);for(;this.e();){let e=this.r();if(!e)break;let t=this.u()&&this.J();if(t===!1)throw this.a("Attribute value expected");if(e in n)throw this.a(`Duplicate attribute: ${e}`);if(e==="xml:space"&&t!=="default"&&t!=="preserve")throw this.a('Value of the `xml:space` attribute must be "default" or "preserve"');n[e]=t}if(this.f.sortAttributes){let e=Object.keys(n).sort(),t=Object.create(null);for(let i=0;i<e.length;++i){let r=e[i];t[r]=n[r]}n=t}return n}J(){let{c:n}=this,e=n.h();if(e!=='"'&&e!=="'")return!1;n.g();let t,i=!1,r=ES,o=e==='"'?hre:dre;e:for(;!n.z;)switch(t=n.G(o),t&&(this.p(t),r+=t.replace(fre," ")),n.h()){case e:i=!0;break e;case"&":r+=this.C();continue;case"<":throw this.a("Unescaped `<` is not allowed in an attribute value");case ES:break e}if(!i)throw this.a("Unclosed attribute");return n.g(),r}K(){let{c:n}=this,e=n.d;if(!n.b("<![CDATA["))return!1;let t=n.t("]]>");if(this.p(t),!n.b("]]>"))throw this.a("Unclosed CDATA section");return this.f.preserveCdata?this.j(new dB(wx(t)),e):this.x(t,e)}L(){let{c:n}=this,e=n.d,t=n.A(pre);if(!t)return!1;if(this.p(t),n.h(3)==="]]>")throw this.a("Element content may not contain the CDATA section close delimiter `]]>`");return this.x(t,e)}D(){let{c:n}=this,e=n.d;if(!n.b("<!--"))return!1;let t=n.t("--");if(this.p(t),!n.b("-->"))throw n.h(2)==="--"?this.a("The string `--` isn't allowed inside a comment"):this.a("Unclosed comment");return this.f.preserveComments?this.j(new fB(wx(t)),e):!0}M(){let n=this.c.d,e=this.C();return e?this.x(e,n):!1}N(){let{c:n}=this,e=n.d;if(!n.b("<!DOCTYPE"))return!1;let t=this.e()&&this.r();if(!t)throw this.a("Expected a name");let i,r;if(this.e()){if(n.b("PUBLIC")){if(i=this.e()&&this.O(),i===!1)throw this.a("Expected a public identifier");this.e()}if(i!==void 0||n.b("SYSTEM")){if(this.e(),r=this.s(),r===!1)throw this.a("Expected a system identifier");this.e()}}let o;if(n.b("[")){if(o=n.A(/\][\x20\t\r\n]*>/),!n.b("]"))throw this.a("Unclosed internal subset");this.e()}if(!n.b(">"))throw this.a("Unclosed doctype declaration");return this.f.preserveDocumentType?this.j(new mB(t,i,r,o),e):!0}B(){let{c:n}=this,e=n.d;if(!n.b("<"))return!1;let t=this.r();if(!t)return n.o(e),!1;let i=this.I(),r=!!n.b("/>"),o=new uA(t,i);if(o.parent=this.l,!r){if(!n.b(">"))throw this.a(`Unclosed start tag for element \`${t}\``);this.l=o;do this.L();while(this.B()||this.M()||this.K()||this.E()||this.D());let s=n.d,l;if(!n.b("</")||!(l=this.r())||l!==t)throw n.o(s),this.a(`Missing end tag for element ${t}`);if(this.e(),!n.b(">"))throw this.a(`Unclosed end tag for element ${t}`);this.l=o.parent}return this.j(o,e)}u(){return this.e(),this.c.b("=")?(this.e(),!0):!1}w(){return this.D()||this.E()||this.e()}r(){return cB(this.c.h())?this.c.v(uB):ES}E(){let{c:n}=this,e=n.d;if(!n.b("<?"))return!1;let t=this.r();if(t){if(t.toLowerCase()==="xml")throw n.o(e),this.a("XML declaration isn't allowed here")}else throw this.a("Invalid processing instruction");if(!this.e()){if(n.b("?>"))return this.j(new TT(t),e);throw this.a("Whitespace is required after a processing instruction name")}let i=n.t("?>");if(this.p(i),!n.b("?>"))throw this.a("Unterminated processing instruction");return this.j(new TT(t,wx(i)),e)}H(){let{c:n}=this,e=n.d;for(this.P();this.w(););if(this.N())for(;this.w(););return e<n.d}O(){let n=this.c.d,e=this.s();if(e!==!1&&!/^[-\x20\r\na-zA-Z0-9'()+,./:=?;!*#@$_%]*$/.test(e))throw this.c.o(n),this.a("Invalid character in public identifier");return e}C(){let{c:n}=this;if(!n.b("&"))return!1;let e=n.v(mre);if(n.F()!==";")throw this.a("Unterminated reference (a reference must end with `;`)");let t;if(e[0]==="#"){let i=e[1]==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10);if(isNaN(i))throw this.a("Invalid character reference");if(!SO(i))throw this.a("Character reference resolves to an invalid character");t=String.fromCodePoint(i)}else if(t=gre[e],t===void 0){let{ignoreUndefinedEntities:i,resolveUndefinedEntity:r}=this.f,o=`&${e};`;if(r){let s=r(o);if(s!=null){let l=typeof s;if(l!=="string")throw new TypeError(`\`resolveUndefinedEntity()\` must return a string, \`null\`, or \`undefined\`, but returned a value of type ${l}`);return s}}if(i)return o;throw n.o(-o.length),this.a(`Named entity isn't defined: ${o}`)}return t}s(){let{c:n}=this,e=n.b('"')||n.b("'");if(!e)return!1;let t=n.t(e);if(this.p(t),!n.b(e))throw this.a("Missing end quote");return t}e(){return!!this.c.v(yre)}P(){let{c:n}=this,e=n.d;if(!n.b("<?xml"))return!1;if(!this.e())throw this.a("Invalid XML declaration");let t=!!n.b("version")&&this.u()&&this.s();if(t===!1)throw this.a("XML version is missing or invalid");if(!/^1\.[0-9]+$/.test(t))throw this.a("Invalid character in version number");let i,r;if(this.e()&&(i=!!n.b("encoding")&&this.u()&&this.s(),i&&this.e(),r=!!n.b("standalone")&&this.u()&&this.s(),r)){if(r!=="yes"&&r!=="no")throw this.a('Only "yes" and "no" are permitted as values of `standalone`');this.e()}if(!n.b("?>"))throw this.a("Invalid or unclosed XML declaration");return this.f.preserveXmlDeclaration?this.j(new pB(t,i||void 0,r||void 0),e):!0}a(n){let{c:e}=this;return new yB(n,e.d,e.m)}p(n){let{length:e}=n;for(let t=0;t<e;++t){let i=n.codePointAt(t);if(!SO(i))throw this.c.o(-([...n].length-t)),this.a("Invalid character");i>65535&&(t+=1)}}};function wx(n){let e=0;for(;(e=n.indexOf("\r",e))!==-1;)n=n[e+1]===`
`?n.slice(0,e)+n.slice(e+1):n.slice(0,e)+`
`+n.slice(e+1);return n}function vre(n,e){return new _re(n,e).document}let bre=class extends Error{constructor(e,t,i){super(e),this.httpStatus=t,this.isCrossOriginRelated=i,this.name="EndpointError"}},xre=class extends Error{constructor(e,t,i,r,o){super(e),this.requestUrl=t,this.code=i,this.locator=r,this.response=o,this.name="ServiceExceptionError"}};function Ire(n){if(n.name==="ServiceExceptionError"){const t=new xre(n.message,n.requestUrl,n.code,n.locator,n.response);return t.stack=n.stack,t}if(n.name==="EndpointError"){const t=new bre(n.message,n.httpStatus,n.isCrossOriginRelated);return t.stack=n.stack,t}const e=new Error(n.message);return e.stack=n.stack,e}const TS=new EventTarget;function Cre(n,e,t){return new Promise((i,r)=>{const o=nre(),s={requestId:o,taskName:n,params:t};e===null?TS.dispatchEvent(new CustomEvent("ogc-client.request",{detail:s})):e.postMessage(s);const l=d=>{d.requestId===o&&(e===null?TS.removeEventListener("ogc-client.response",u):e.removeEventListener("message",h),"error"in d?r(Ire(d.error)):i(d.response))},u=d=>l(d.detail),h=d=>l(d.data);e===null?TS.addEventListener("ogc-client.response",u):e.addEventListener("message",h)})}const _B="KGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICAvKiEgQHJncm92ZS9wYXJzZS14bWwgdjQuMS4wIHwgSVNDIExpY2Vuc2UgfCBDb3B5cmlnaHQgUnlhbiBHcm92ZSAqLwogIHZhciBfX2RlZlByb3AgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7CiAgdmFyIF9fZ2V0T3duUHJvcERlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwogIHZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwogIHZhciBfX2hhc093blByb3AgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwogIHZhciBfX2V4cG9ydCA9ICh0YXJnZXQsIGFsbCkgPT4gewogICAgZm9yICh2YXIgbmFtZSBpbiBhbGwpCiAgICAgIF9fZGVmUHJvcCh0YXJnZXQsIG5hbWUsIHsgZ2V0OiBhbGxbbmFtZV0sIGVudW1lcmFibGU6IHRydWUgfSk7CiAgfTsKICB2YXIgX19jb3B5UHJvcHMgPSAodG8sIGZyb20sIGV4Y2VwdCwgZGVzYykgPT4gewogICAgaWYgKGZyb20gJiYgdHlwZW9mIGZyb20gPT09ICJvYmplY3QiIHx8IHR5cGVvZiBmcm9tID09PSAiZnVuY3Rpb24iKSB7CiAgICAgIGZvciAobGV0IGtleSBvZiBfX2dldE93blByb3BOYW1lcyhmcm9tKSkKICAgICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KQogICAgICAgICAgX19kZWZQcm9wKHRvLCBrZXksIHsgZ2V0OiAoKSA9PiBmcm9tW2tleV0sIGVudW1lcmFibGU6ICEoZGVzYyA9IF9fZ2V0T3duUHJvcERlc2MoZnJvbSwga2V5KSkgfHwgZGVzYy5lbnVtZXJhYmxlIH0pOwogICAgfQogICAgcmV0dXJuIHRvOwogIH07CiAgdmFyIF9fdG9Db21tb25KUyA9IChtb2QpID0+IF9fY29weVByb3BzKF9fZGVmUHJvcCh7fSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCBtb2QpOwogIHZhciBzcmNfZXhwb3J0cyA9IHt9OwogIF9fZXhwb3J0KHNyY19leHBvcnRzLCB7CiAgICBYbWxDZGF0YTogKCkgPT4gWG1sQ2RhdGEsCiAgICBYbWxDb21tZW50OiAoKSA9PiBYbWxDb21tZW50LAogICAgWG1sRGVjbGFyYXRpb246ICgpID0+IFhtbERlY2xhcmF0aW9uLAogICAgWG1sRG9jdW1lbnQ6ICgpID0+IFhtbERvY3VtZW50LAogICAgWG1sRG9jdW1lbnRUeXBlOiAoKSA9PiBYbWxEb2N1bWVudFR5cGUsCiAgICBYbWxFbGVtZW50OiAoKSA9PiBYbWxFbGVtZW50LAogICAgWG1sRXJyb3I6ICgpID0+IFhtbEVycm9yLAogICAgWG1sTm9kZTogKCkgPT4gWG1sTm9kZSwKICAgIFhtbFByb2Nlc3NpbmdJbnN0cnVjdGlvbjogKCkgPT4gWG1sUHJvY2Vzc2luZ0luc3RydWN0aW9uLAogICAgWG1sVGV4dDogKCkgPT4gWG1sVGV4dCwKICAgIHBhcnNlWG1sOiAoKSA9PiBwYXJzZVhtbAogIH0pOwogIHZhciBicm93c2VyID0gX190b0NvbW1vbkpTKHNyY19leHBvcnRzKTsKICB2YXIgZW1wdHlTdHJpbmcgPSAiIjsKICB2YXIgc3Vycm9nYXRlUGFpciA9IC9bXHVEODAwLVx1REJGRl1bXHVEQzAwLVx1REZGRl0vZzsKICB2YXIgU3RyaW5nU2Nhbm5lciA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKHN0cmluZykgewogICAgICB0aGlzLmsgPSB0aGlzLnEoc3RyaW5nLCB0cnVlKTsKICAgICAgdGhpcy5kID0gMDsKICAgICAgdGhpcy5sZW5ndGggPSBzdHJpbmcubGVuZ3RoOwogICAgICB0aGlzLm4gPSB0aGlzLmsgIT09IHRoaXMubGVuZ3RoOwogICAgICB0aGlzLm0gPSBzdHJpbmc7CiAgICAgIGlmICh0aGlzLm4pIHsKICAgICAgICBsZXQgY2hhcnNUb0J5dGVzID0gW107CiAgICAgICAgZm9yIChsZXQgYnl0ZUluZGV4ID0gMCwgY2hhckluZGV4ID0gMDsgY2hhckluZGV4IDwgdGhpcy5rOyArK2NoYXJJbmRleCkgewogICAgICAgICAgY2hhcnNUb0J5dGVzW2NoYXJJbmRleF0gPSBieXRlSW5kZXg7CiAgICAgICAgICBieXRlSW5kZXggKz0gc3RyaW5nLmNvZGVQb2ludEF0KGJ5dGVJbmRleCkgPiA2NTUzNSA/IDIgOiAxOwogICAgICAgIH0KICAgICAgICB0aGlzLnkgPSBjaGFyc1RvQnl0ZXM7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogV2hldGhlciB0aGUgY3VycmVudCBjaGFyYWN0ZXIgaW5kZXggaXMgYXQgdGhlIGVuZCBvZiB0aGUgaW5wdXQgc3RyaW5nLgogICAgICovCiAgICBnZXQgeigpIHsKICAgICAgcmV0dXJuIHRoaXMuZCA+PSB0aGlzLms7CiAgICB9CiAgICAvLyAtLSBQcm90ZWN0ZWQgTWV0aG9kcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIGNoYXJhY3RlcnMgaW4gdGhlIGdpdmVuIHN0cmluZywgd2hpY2ggbWF5IGRpZmZlciBmcm9tCiAgICAgKiB0aGUgYnl0ZSBsZW5ndGggaWYgdGhlIHN0cmluZyBjb250YWlucyBtdWx0aWJ5dGUgY2hhcmFjdGVycy4KICAgICAqLwogICAgcShzdHJpbmcsIG11bHRpQnl0ZVNhZmUgPSB0aGlzLm4pIHsKICAgICAgcmV0dXJuIG11bHRpQnl0ZVNhZmUgPyBzdHJpbmcucmVwbGFjZShzdXJyb2dhdGVQYWlyLCAiXyIpLmxlbmd0aCA6IHN0cmluZy5sZW5ndGg7CiAgICB9CiAgICAvLyAtLSBQdWJsaWMgTWV0aG9kcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8qKgogICAgICogQWR2YW5jZXMgdGhlIHNjYW5uZXIgYnkgdGhlIGdpdmVuIG51bWJlciBvZiBjaGFyYWN0ZXJzLCBzdG9wcGluZyBpZiB0aGUgZW5kCiAgICAgKiBvZiB0aGUgc3RyaW5nIGlzIHJlYWNoZWQuCiAgICAgKi8KICAgIGcoY291bnQgPSAxKSB7CiAgICAgIHRoaXMuZCA9IE1hdGgubWluKHRoaXMuaywgdGhpcy5kICsgY291bnQpOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBieXRlIGluZGV4IG9mIHRoZSBnaXZlbiBjaGFyYWN0ZXIgaW5kZXggaW4gdGhlIHN0cmluZy4gVGhlIHR3bwogICAgICogbWF5IGRpZmZlciBpbiBzdHJpbmdzIHRoYXQgY29udGFpbiBtdWx0aWJ5dGUgY2hhcmFjdGVycy4KICAgICAqLwogICAgaShjaGFySW5kZXggPSB0aGlzLmQpIHsKICAgICAgdmFyIF9hOwogICAgICByZXR1cm4gdGhpcy5uID8gKF9hID0gdGhpcy55W2NoYXJJbmRleF0pICE9IG51bGwgPyBfYSA6IEluZmluaXR5IDogY2hhckluZGV4OwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBhbmQgcmV0dXJucyB0aGUgZ2l2ZW4gbnVtYmVyIG9mIGNoYXJhY3RlcnMgaWYgcG9zc2libGUsIGFkdmFuY2luZwogICAgICogdGhlIHNjYW5uZXIgYW5kIHN0b3BwaW5nIGlmIHRoZSBlbmQgb2YgdGhlIHN0cmluZyBpcyByZWFjaGVkLgogICAgICoKICAgICAqIElmIG5vIGNoYXJhY3RlcnMgY291bGQgYmUgY29uc3VtZWQsIGFuIGVtcHR5IHN0cmluZyB3aWxsIGJlIHJldHVybmVkLgogICAgICovCiAgICBGKGNvdW50ID0gMSkgewogICAgICBsZXQgY2hhcnMgPSB0aGlzLmgoY291bnQpOwogICAgICB0aGlzLmcoY291bnQpOwogICAgICByZXR1cm4gY2hhcnM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgbWF0Y2ggZm9yIHRoZSBnaXZlbiBzdGlja3kgcmVnZXgsIGFkdmFuY2VzIHRoZSBzY2FubmVyLCB1cGRhdGVzCiAgICAgKiB0aGUgYGxhc3RJbmRleGAgcHJvcGVydHkgb2YgdGhlIHJlZ2V4LCBhbmQgcmV0dXJucyB0aGUgbWF0Y2hpbmcgc3RyaW5nLgogICAgICoKICAgICAqIFRoZSByZWdleCBtdXN0IGhhdmUgYSBzdGlja3kgZmxhZyAoInkiKSBzbyB0aGF0IGl0cyBgbGFzdEluZGV4YCBwcm9wIGNhbiBiZQogICAgICogdXNlZCB0byBhbmNob3IgdGhlIG1hdGNoIGF0IHRoZSBjdXJyZW50IHNjYW5uZXIgcG9zaXRpb24uCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgY29uc3VtZWQgc3RyaW5nLCBvciBhbiBlbXB0eSBzdHJpbmcgaWYgbm90aGluZyB3YXMgY29uc3VtZWQuCiAgICAgKi8KICAgIEcocmVnZXgpIHsKICAgICAgaWYgKCFyZWdleC5zdGlja3kpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ByZWdleGAgbXVzdCBoYXZlIGEgc3RpY2t5IGZsYWcgKCJ5IiknKTsKICAgICAgfQogICAgICByZWdleC5sYXN0SW5kZXggPSB0aGlzLmkoKTsKICAgICAgbGV0IHJlc3VsdCA9IHJlZ2V4LmV4ZWModGhpcy5tKTsKICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGVtcHR5U3RyaW5nOwogICAgICB9CiAgICAgIGxldCBtYXRjaCA9IHJlc3VsdFswXTsKICAgICAgdGhpcy5nKHRoaXMucShtYXRjaCkpOwogICAgICByZXR1cm4gbWF0Y2g7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGFuZCByZXR1cm5zIGFsbCBjaGFyYWN0ZXJzIGZvciB3aGljaCB0aGUgZ2l2ZW4gZnVuY3Rpb24gcmV0dXJucyBhCiAgICAgKiB0cnV0aHkgdmFsdWUsIHN0b3BwaW5nIG9uIHRoZSBmaXJzdCBmYWxzeSByZXR1cm4gdmFsdWUgb3IgaWYgdGhlIGVuZCBvZiB0aGUKICAgICAqIGlucHV0IGlzIHJlYWNoZWQuCiAgICAgKi8KICAgIHYoZm4pIHsKICAgICAgbGV0IGNoYXI7CiAgICAgIGxldCBtYXRjaCA9IGVtcHR5U3RyaW5nOwogICAgICB3aGlsZSAoKGNoYXIgPSB0aGlzLmgoKSkgJiYgZm4oY2hhcikpIHsKICAgICAgICBtYXRjaCArPSBjaGFyOwogICAgICAgIHRoaXMuZygpOwogICAgICB9CiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3VtZXMgdGhlIGdpdmVuIHN0cmluZyBpZiBpdCBleGlzdHMgYXQgdGhlIGN1cnJlbnQgY2hhcmFjdGVyIGluZGV4LCBhbmQKICAgICAqIGFkdmFuY2VzIHRoZSBzY2FubmVyLgogICAgICoKICAgICAqIElmIHRoZSBnaXZlbiBzdHJpbmcgZG9lc24ndCBleGlzdCBhdCB0aGUgY3VycmVudCBjaGFyYWN0ZXIgaW5kZXgsIGFuIGVtcHR5CiAgICAgKiBzdHJpbmcgd2lsbCBiZSByZXR1cm5lZCBhbmQgdGhlIHNjYW5uZXIgd2lsbCBub3QgYmUgYWR2YW5jZWQuCiAgICAgKi8KICAgIFEoc3RyaW5nVG9Db25zdW1lKSB7CiAgICAgIGlmICh0aGlzLmIoc3RyaW5nVG9Db25zdW1lKSkgewogICAgICAgIHJldHVybiBzdHJpbmdUb0NvbnN1bWU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMubikgewogICAgICAgIGxldCB7IGxlbmd0aCB9ID0gc3RyaW5nVG9Db25zdW1lOwogICAgICAgIGxldCBjaGFyTGVuZ3RoVG9NYXRjaCA9IHRoaXMucShzdHJpbmdUb0NvbnN1bWUpOwogICAgICAgIGlmIChjaGFyTGVuZ3RoVG9NYXRjaCAhPT0gbGVuZ3RoICYmIHN0cmluZ1RvQ29uc3VtZSA9PT0gdGhpcy5oKGNoYXJMZW5ndGhUb01hdGNoKSkgewogICAgICAgICAgdGhpcy5nKGNoYXJMZW5ndGhUb01hdGNoKTsKICAgICAgICAgIHJldHVybiBzdHJpbmdUb0NvbnN1bWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBlbXB0eVN0cmluZzsKICAgIH0KICAgIC8qKgogICAgICogRG9lcyB0aGUgc2FtZSB0aGluZyBhcyBgY29uc3VtZVN0cmluZygpYCwgYnV0IGRvZXNuJ3Qgc3VwcG9ydCBjb25zdW1pbmcKICAgICAqIG11bHRpYnl0ZSBjaGFyYWN0ZXJzLiBUaGlzIGNhbiBiZSBmYXN0ZXIgaWYgeW91IG9ubHkgbmVlZCB0byBtYXRjaCBzaW5nbGUKICAgICAqIGJ5dGUgY2hhcmFjdGVycy4KICAgICAqLwogICAgYihzdHJpbmdUb0NvbnN1bWUpIHsKICAgICAgbGV0IHsgbGVuZ3RoIH0gPSBzdHJpbmdUb0NvbnN1bWU7CiAgICAgIGlmICh0aGlzLmgobGVuZ3RoKSA9PT0gc3RyaW5nVG9Db25zdW1lKSB7CiAgICAgICAgdGhpcy5nKGxlbmd0aCk7CiAgICAgICAgcmV0dXJuIHN0cmluZ1RvQ29uc3VtZTsKICAgICAgfQogICAgICByZXR1cm4gZW1wdHlTdHJpbmc7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGNoYXJhY3RlcnMgdW50aWwgdGhlIGdpdmVuIGdsb2JhbCByZWdleCBpcyBtYXRjaGVkLCBhZHZhbmNpbmcgdGhlCiAgICAgKiBzY2FubmVyIHVwIHRvIChidXQgbm90IGJleW9uZCkgdGhlIGJlZ2lubmluZyBvZiB0aGUgbWF0Y2guIElmIHRoZSByZWdleAogICAgICogZG9lc24ndCBtYXRjaCwgbm90aGluZyB3aWxsIGJlIGNvbnN1bWVkLgogICAgICoKICAgICAqIFJldHVybnMgdGhlIGNvbnN1bWVkIHN0cmluZywgb3IgYW4gZW1wdHkgc3RyaW5nIGlmIG5vdGhpbmcgd2FzIGNvbnN1bWVkLgogICAgICovCiAgICBBKHJlZ2V4KSB7CiAgICAgIGxldCByZXN0T2ZTdHJpbmcgPSB0aGlzLm0uc2xpY2UodGhpcy5pKCkpOwogICAgICBsZXQgbWF0Y2hCeXRlSW5kZXggPSByZXN0T2ZTdHJpbmcuc2VhcmNoKHJlZ2V4KTsKICAgICAgaWYgKG1hdGNoQnl0ZUluZGV4IDw9IDApIHsKICAgICAgICByZXR1cm4gZW1wdHlTdHJpbmc7CiAgICAgIH0KICAgICAgbGV0IHJlc3VsdCA9IHJlc3RPZlN0cmluZy5zbGljZSgwLCBtYXRjaEJ5dGVJbmRleCk7CiAgICAgIHRoaXMuZyh0aGlzLnEocmVzdWx0KSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGNoYXJhY3RlcnMgdW50aWwgdGhlIGdpdmVuIHN0cmluZyBpcyBmb3VuZCwgYWR2YW5jaW5nIHRoZSBzY2FubmVyCiAgICAgKiB1cCB0byAoYnV0IG5vdCBiZXlvbmQpIHRoYXQgcG9pbnQuIElmIHRoZSBzdHJpbmcgaXMgbmV2ZXIgZm91bmQsIG5vdGhpbmcKICAgICAqIHdpbGwgYmUgY29uc3VtZWQuCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgY29uc3VtZWQgc3RyaW5nLCBvciBhbiBlbXB0eSBzdHJpbmcgaWYgbm90aGluZyB3YXMgY29uc3VtZWQuCiAgICAgKi8KICAgIHQoc2VhcmNoU3RyaW5nKSB7CiAgICAgIGxldCB7IG06IHN0cmluZyB9ID0gdGhpczsKICAgICAgbGV0IGJ5dGVJbmRleCA9IHRoaXMuaSgpOwogICAgICBsZXQgbWF0Y2hCeXRlSW5kZXggPSBzdHJpbmcuaW5kZXhPZihzZWFyY2hTdHJpbmcsIGJ5dGVJbmRleCk7CiAgICAgIGlmIChtYXRjaEJ5dGVJbmRleCA8PSAwKSB7CiAgICAgICAgcmV0dXJuIGVtcHR5U3RyaW5nOwogICAgICB9CiAgICAgIGxldCByZXN1bHQgPSBzdHJpbmcuc2xpY2UoYnl0ZUluZGV4LCBtYXRjaEJ5dGVJbmRleCk7CiAgICAgIHRoaXMuZyh0aGlzLnEocmVzdWx0KSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGdpdmVuIG51bWJlciBvZiBjaGFyYWN0ZXJzIHN0YXJ0aW5nIGF0IHRoZSBjdXJyZW50IGNoYXJhY3RlcgogICAgICogaW5kZXgsIHdpdGhvdXQgYWR2YW5jaW5nIHRoZSBzY2FubmVyIGFuZCB3aXRob3V0IGV4Y2VlZGluZyB0aGUgZW5kIG9mIHRoZQogICAgICogaW5wdXQgc3RyaW5nLgogICAgICovCiAgICBoKGNvdW50ID0gMSkgewogICAgICBsZXQgeyBkOiBjaGFySW5kZXgsIG46IG11bHRpQnl0ZU1vZGUsIG06IHN0cmluZyB9ID0gdGhpczsKICAgICAgaWYgKG11bHRpQnl0ZU1vZGUpIHsKICAgICAgICBpZiAoY2hhckluZGV4ID49IHRoaXMuaykgewogICAgICAgICAgcmV0dXJuIGVtcHR5U3RyaW5nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyaW5nLnNsaWNlKAogICAgICAgICAgdGhpcy5pKGNoYXJJbmRleCksCiAgICAgICAgICB0aGlzLmkoY2hhckluZGV4ICsgY291bnQpCiAgICAgICAgKTsKICAgICAgfQogICAgICByZXR1cm4gc3RyaW5nLnNsaWNlKGNoYXJJbmRleCwgY2hhckluZGV4ICsgY291bnQpOwogICAgfQogICAgLyoqCiAgICAgKiBSZXNldHMgdGhlIHNjYW5uZXIgcG9zaXRpb24gdG8gdGhlIGdpdmVuIGNoYXJhY3RlciBfaW5kZXhfLCBvciB0byB0aGUgc3RhcnQKICAgICAqIG9mIHRoZSBpbnB1dCBzdHJpbmcgaWYgbm8gaW5kZXggaXMgZ2l2ZW4uCiAgICAgKgogICAgICogSWYgX2luZGV4XyBpcyBuZWdhdGl2ZSwgdGhlIHNjYW5uZXIgcG9zaXRpb24gd2lsbCBiZSBtb3ZlZCBiYWNrd2FyZCBieSB0aGF0CiAgICAgKiBtYW55IGNoYXJhY3RlcnMsIHN0b3BwaW5nIGlmIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHN0cmluZyBpcyByZWFjaGVkLgogICAgICovCiAgICBvKGluZGV4ID0gMCkgewogICAgICB0aGlzLmQgPSBpbmRleCA+PSAwID8gTWF0aC5taW4odGhpcy5rLCBpbmRleCkgOiBNYXRoLm1heCgwLCB0aGlzLmQgKyBpbmRleCk7CiAgICB9CiAgfTsKICB2YXIgYXR0VmFsdWVDaGFyRG91YmxlUXVvdGUgPSAvW14iJjxdKy95OwogIHZhciBhdHRWYWx1ZUNoYXJTaW5nbGVRdW90ZSA9IC9bXicmPF0rL3k7CiAgdmFyIGF0dFZhbHVlTm9ybWFsaXplZFdoaXRlc3BhY2UgPSAvXHJcbnxbXG5cclx0XS9nOwogIHZhciBlbmRDaGFyRGF0YSA9IC88fCZ8XV0+LzsKICB2YXIgcHJlZGVmaW5lZEVudGl0aWVzID0gT2JqZWN0LmZyZWV6ZShPYmplY3QuYXNzaWduKC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpLCB7CiAgICBhbXA6ICImIiwKICAgIGFwb3M6ICInIiwKICAgIGd0OiAiPiIsCiAgICBsdDogIjwiLAogICAgcXVvdDogJyInCiAgfSkpOwogIGZ1bmN0aW9uIGlzTmFtZUNoYXIoY2hhcikgewogICAgbGV0IGNwID0gZ2V0Q29kZVBvaW50KGNoYXIpOwogICAgcmV0dXJuIGNwID49IDk3ICYmIGNwIDw9IDEyMiB8fCBjcCA+PSA2NSAmJiBjcCA8PSA5MCB8fCBjcCA+PSA0OCAmJiBjcCA8PSA1NyB8fCBjcCA9PT0gNDUgfHwgY3AgPT09IDQ2IHx8IGNwID09PSAxODMgfHwgY3AgPj0gNzY4ICYmIGNwIDw9IDg3OSB8fCBjcCA+PSA4MjU1ICYmIGNwIDw9IDgyNTYgfHwgaXNOYW1lU3RhcnRDaGFyKGNoYXIsIGNwKTsKICB9CiAgZnVuY3Rpb24gaXNOYW1lU3RhcnRDaGFyKGNoYXIsIGNwID0gZ2V0Q29kZVBvaW50KGNoYXIpKSB7CiAgICByZXR1cm4gY3AgPj0gOTcgJiYgY3AgPD0gMTIyIHx8IGNwID49IDY1ICYmIGNwIDw9IDkwIHx8IGNwID09PSA1OCB8fCBjcCA9PT0gOTUgfHwgY3AgPj0gMTkyICYmIGNwIDw9IDIxNCB8fCBjcCA+PSAyMTYgJiYgY3AgPD0gMjQ2IHx8IGNwID49IDI0OCAmJiBjcCA8PSA3NjcgfHwgY3AgPj0gODgwICYmIGNwIDw9IDg5MyB8fCBjcCA+PSA4OTUgJiYgY3AgPD0gODE5MSB8fCBjcCA+PSA4MjA0ICYmIGNwIDw9IDgyMDUgfHwgY3AgPj0gODMwNCAmJiBjcCA8PSA4NTkxIHx8IGNwID49IDExMjY0ICYmIGNwIDw9IDEyMjcxIHx8IGNwID49IDEyMjg5ICYmIGNwIDw9IDU1Mjk1IHx8IGNwID49IDYzNzQ0ICYmIGNwIDw9IDY0OTc1IHx8IGNwID49IDY1MDA4ICYmIGNwIDw9IDY1NTMzIHx8IGNwID49IDY1NTM2ICYmIGNwIDw9IDk4MzAzOTsKICB9CiAgZnVuY3Rpb24gaXNSZWZlcmVuY2VDaGFyKGNoYXIpIHsKICAgIHJldHVybiBjaGFyID09PSAiIyIgfHwgaXNOYW1lQ2hhcihjaGFyKTsKICB9CiAgZnVuY3Rpb24gaXNXaGl0ZXNwYWNlKGNoYXIpIHsKICAgIGxldCBjcCA9IGdldENvZGVQb2ludChjaGFyKTsKICAgIHJldHVybiBjcCA9PT0gMzIgfHwgY3AgPT09IDkgfHwgY3AgPT09IDEwIHx8IGNwID09PSAxMzsKICB9CiAgZnVuY3Rpb24gaXNYbWxDb2RlUG9pbnQoY3ApIHsKICAgIHJldHVybiBjcCA9PT0gOSB8fCBjcCA9PT0gMTAgfHwgY3AgPT09IDEzIHx8IGNwID49IDMyICYmIGNwIDw9IDU1Mjk1IHx8IGNwID49IDU3MzQ0ICYmIGNwIDw9IDY1NTMzIHx8IGNwID49IDY1NTM2ICYmIGNwIDw9IDExMTQxMTE7CiAgfQogIGZ1bmN0aW9uIGdldENvZGVQb2ludChjaGFyKSB7CiAgICByZXR1cm4gY2hhci5jb2RlUG9pbnRBdCgwKSB8fCAtMTsKICB9CiAgdmFyIF9YbWxOb2RlID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMucGFyZW50ID0gbnVsbDsKICAgICAgdGhpcy5zdGFydCA9IC0xOwogICAgICB0aGlzLmVuZCA9IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBEb2N1bWVudCB0aGF0IGNvbnRhaW5zIHRoaXMgbm9kZSwgb3IgYG51bGxgIGlmIHRoaXMgbm9kZSBpcyBub3QgYXNzb2NpYXRlZAogICAgICogd2l0aCBhIGRvY3VtZW50LgogICAgICovCiAgICBnZXQgZG9jdW1lbnQoKSB7CiAgICAgIHZhciBfYSwgX2I7CiAgICAgIHJldHVybiAoX2IgPSAoX2EgPSB0aGlzLnBhcmVudCkgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLmRvY3VtZW50KSAhPSBudWxsID8gX2IgOiBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgbm9kZSBpcyB0aGUgcm9vdCBub2RlIG9mIHRoZSBkb2N1bWVudCAoYWxzbyBrbm93biBhcyB0aGUKICAgICAqIGRvY3VtZW50IGVsZW1lbnQpLgogICAgICovCiAgICBnZXQgaXNSb290Tm9kZSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGFyZW50ICE9PSBudWxsICYmIHRoaXMucGFyZW50ID09PSB0aGlzLmRvY3VtZW50ICYmIHRoaXMudHlwZSA9PT0gX1htbE5vZGUuVFlQRV9FTEVNRU5UOwogICAgfQogICAgLyoqCiAgICAgKiBXaGV0aGVyIHdoaXRlc3BhY2Ugc2hvdWxkIGJlIHByZXNlcnZlZCBpbiB0aGUgY29udGVudCBvZiB0aGlzIGVsZW1lbnQgYW5kCiAgICAgKiBpdHMgY2hpbGRyZW4uCiAgICAgKgogICAgICogVGhpcyBpcyBpbmZsdWVuY2VkIGJ5IHRoZSB2YWx1ZSBvZiB0aGUgc3BlY2lhbCBgeG1sOnNwYWNlYCBhdHRyaWJ1dGUsIGFuZAogICAgICogd2lsbCBiZSBgdHJ1ZWAgZm9yIGFueSBub2RlIHdob3NlIGB4bWw6c3BhY2VgIGF0dHJpYnV0ZSBpcyBzZXQgdG8KICAgICAqICJwcmVzZXJ2ZSIuIElmIGEgbm9kZSBoYXMgbm8gc3VjaCBhdHRyaWJ1dGUsIGl0IHdpbGwgaW5oZXJpdCB0aGUgdmFsdWUgb2YKICAgICAqIHRoZSBuZWFyZXN0IGFuY2VzdG9yIHRoYXQgZG9lcyAoaWYgYW55KS4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI3NlYy13aGl0ZS1zcGFjZQogICAgICovCiAgICBnZXQgcHJlc2VydmVXaGl0ZXNwYWNlKCkgewogICAgICB2YXIgX2E7CiAgICAgIHJldHVybiAhISgoX2EgPSB0aGlzLnBhcmVudCkgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLnByZXNlcnZlV2hpdGVzcGFjZSk7CiAgICB9CiAgICAvKioKICAgICAqIFR5cGUgb2YgdGhpcyBub2RlLgogICAgICoKICAgICAqIFRoZSB2YWx1ZSBvZiB0aGlzIHByb3BlcnR5IGlzIGEgc3RyaW5nIHRoYXQgbWF0Y2hlcyBvbmUgb2YgdGhlIHN0YXRpYwogICAgICogYFRZUEVfKmAgcHJvcGVydGllcyBvbiB0aGUgYFhtbE5vZGVgIGNsYXNzIChlLmcuIGBUWVBFX0VMRU1FTlRgLAogICAgICogYFRZUEVfVEVYVGAsIGV0Yy4pLgogICAgICoKICAgICAqIFRoZSBgWG1sTm9kZWAgY2xhc3MgaXRzZWxmIGlzIGEgYmFzZSBjbGFzcyBhbmQgZG9lc24ndCBoYXZlIGl0cyBvd24gdHlwZQogICAgICogbmFtZS4KICAgICAqLwogICAgZ2V0IHR5cGUoKSB7CiAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIG9iamVjdCByZXByZXNlbnRpbmcgdGhpcyBub2RlLCBtaW51cyBwcm9wZXJ0aWVzCiAgICAgKiB0aGF0IGNvdWxkIHJlc3VsdCBpbiBjaXJjdWxhciByZWZlcmVuY2VzLgogICAgICovCiAgICB0b0pTT04oKSB7CiAgICAgIGxldCBqc29uID0gewogICAgICAgIHR5cGU6IHRoaXMudHlwZQogICAgICB9OwogICAgICBpZiAodGhpcy5pc1Jvb3ROb2RlKSB7CiAgICAgICAganNvbi5pc1Jvb3ROb2RlID0gdHJ1ZTsKICAgICAgfQogICAgICBpZiAodGhpcy5wcmVzZXJ2ZVdoaXRlc3BhY2UpIHsKICAgICAgICBqc29uLnByZXNlcnZlV2hpdGVzcGFjZSA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuc3RhcnQgIT09IC0xKSB7CiAgICAgICAganNvbi5zdGFydCA9IHRoaXMuc3RhcnQ7CiAgICAgICAganNvbi5lbmQgPSB0aGlzLmVuZDsKICAgICAgfQogICAgICByZXR1cm4ganNvbjsKICAgIH0KICB9OwogIHZhciBYbWxOb2RlID0gX1htbE5vZGU7CiAgWG1sTm9kZS5UWVBFX0NEQVRBID0gImNkYXRhIjsKICBYbWxOb2RlLlRZUEVfQ09NTUVOVCA9ICJjb21tZW50IjsKICBYbWxOb2RlLlRZUEVfRE9DVU1FTlQgPSAiZG9jdW1lbnQiOwogIFhtbE5vZGUuVFlQRV9ET0NVTUVOVF9UWVBFID0gImRvY3R5cGUiOwogIFhtbE5vZGUuVFlQRV9FTEVNRU5UID0gImVsZW1lbnQiOwogIFhtbE5vZGUuVFlQRV9QUk9DRVNTSU5HX0lOU1RSVUNUSU9OID0gInBpIjsKICBYbWxOb2RlLlRZUEVfVEVYVCA9ICJ0ZXh0IjsKICBYbWxOb2RlLlRZUEVfWE1MX0RFQ0xBUkFUSU9OID0gInhtbGRlY2wiOwogIHZhciBYbWxUZXh0ID0gY2xhc3MgZXh0ZW5kcyBYbWxOb2RlIHsKICAgIGNvbnN0cnVjdG9yKHRleHQgPSAiIikgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnRleHQgPSB0ZXh0OwogICAgfQogICAgZ2V0IHR5cGUoKSB7CiAgICAgIHJldHVybiBYbWxOb2RlLlRZUEVfVEVYVDsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oWG1sTm9kZS5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcyksIHsKICAgICAgICB0ZXh0OiB0aGlzLnRleHQKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgWG1sQ2RhdGEgPSBjbGFzcyBleHRlbmRzIFhtbFRleHQgewogICAgZ2V0IHR5cGUoKSB7CiAgICAgIHJldHVybiBYbWxOb2RlLlRZUEVfQ0RBVEE7CiAgICB9CiAgfTsKICB2YXIgWG1sQ29tbWVudCA9IGNsYXNzIGV4dGVuZHMgWG1sTm9kZSB7CiAgICBjb25zdHJ1Y3Rvcihjb250ZW50ID0gIiIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5jb250ZW50ID0gY29udGVudDsKICAgIH0KICAgIGdldCB0eXBlKCkgewogICAgICByZXR1cm4gWG1sTm9kZS5UWVBFX0NPTU1FTlQ7CiAgICB9CiAgICB0b0pTT04oKSB7CiAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKFhtbE5vZGUucHJvdG90eXBlLnRvSlNPTi5jYWxsKHRoaXMpLCB7CiAgICAgICAgY29udGVudDogdGhpcy5jb250ZW50CiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIFhtbERlY2xhcmF0aW9uID0gY2xhc3MgZXh0ZW5kcyBYbWxOb2RlIHsKICAgIGNvbnN0cnVjdG9yKHZlcnNpb24sIGVuY29kaW5nLCBzdGFuZGFsb25lKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247CiAgICAgIHRoaXMuZW5jb2RpbmcgPSBlbmNvZGluZyAhPSBudWxsID8gZW5jb2RpbmcgOiBudWxsOwogICAgICB0aGlzLnN0YW5kYWxvbmUgPSBzdGFuZGFsb25lICE9IG51bGwgPyBzdGFuZGFsb25lIDogbnVsbDsKICAgIH0KICAgIGdldCB0eXBlKCkgewogICAgICByZXR1cm4gWG1sTm9kZS5UWVBFX1hNTF9ERUNMQVJBVElPTjsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgbGV0IGpzb24gPSBYbWxOb2RlLnByb3RvdHlwZS50b0pTT04uY2FsbCh0aGlzKTsKICAgICAganNvbi52ZXJzaW9uID0gdGhpcy52ZXJzaW9uOwogICAgICBmb3IgKGxldCBrZXkgb2YgWyJlbmNvZGluZyIsICJzdGFuZGFsb25lIl0pIHsKICAgICAgICBpZiAodGhpc1trZXldICE9PSBudWxsKSB7CiAgICAgICAgICBqc29uW2tleV0gPSB0aGlzW2tleV07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBqc29uOwogICAgfQogIH07CiAgdmFyIFhtbEVsZW1lbnQgPSBjbGFzcyBleHRlbmRzIFhtbE5vZGUgewogICAgY29uc3RydWN0b3IobmFtZSwgYXR0cmlidXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpLCBjaGlsZHJlbiA9IFtdKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjsKICAgIH0KICAgIC8qKgogICAgICogV2hldGhlciB0aGlzIGVsZW1lbnQgaXMgZW1wdHkgKG1lYW5pbmcgaXQgaGFzIG5vIGNoaWxkcmVuKS4KICAgICAqLwogICAgZ2V0IGlzRW1wdHkoKSB7CiAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9PT0gMDsKICAgIH0KICAgIGdldCBwcmVzZXJ2ZVdoaXRlc3BhY2UoKSB7CiAgICAgIGxldCBub2RlID0gdGhpczsKICAgICAgd2hpbGUgKG5vZGUgaW5zdGFuY2VvZiBYbWxFbGVtZW50KSB7CiAgICAgICAgaWYgKCJ4bWw6c3BhY2UiIGluIG5vZGUuYXR0cmlidXRlcykgewogICAgICAgICAgcmV0dXJuIG5vZGUuYXR0cmlidXRlc1sieG1sOnNwYWNlIl0gPT09ICJwcmVzZXJ2ZSI7CiAgICAgICAgfQogICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFRleHQgY29udGVudCBvZiB0aGlzIGVsZW1lbnQgYW5kIGFsbCBpdHMgZGVzY2VuZGFudHMuCiAgICAgKi8KICAgIGdldCB0ZXh0KCkgewogICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiAidGV4dCIgaW4gY2hpbGQgPyBjaGlsZC50ZXh0IDogIiIpLmpvaW4oIiIpOwogICAgfQogICAgZ2V0IHR5cGUoKSB7CiAgICAgIHJldHVybiBYbWxOb2RlLlRZUEVfRUxFTUVOVDsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oWG1sTm9kZS5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcyksIHsKICAgICAgICBuYW1lOiB0aGlzLm5hbWUsCiAgICAgICAgYXR0cmlidXRlczogdGhpcy5hdHRyaWJ1dGVzLAogICAgICAgIGNoaWxkcmVuOiB0aGlzLmNoaWxkcmVuLm1hcCgoY2hpbGQpID0+IGNoaWxkLnRvSlNPTigpKQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBYbWxEb2N1bWVudCA9IGNsYXNzIGV4dGVuZHMgWG1sTm9kZSB7CiAgICBjb25zdHJ1Y3RvcihjaGlsZHJlbiA9IFtdKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjsKICAgIH0KICAgIGdldCBkb2N1bWVudCgpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJvb3QgZWxlbWVudCBvZiB0aGlzIGRvY3VtZW50LCBvciBgbnVsbGAgaWYgdGhpcyBkb2N1bWVudCBpcyBlbXB0eS4KICAgICAqLwogICAgZ2V0IHJvb3QoKSB7CiAgICAgIGZvciAobGV0IGNoaWxkIG9mIHRoaXMuY2hpbGRyZW4pIHsKICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBYbWxFbGVtZW50KSB7CiAgICAgICAgICByZXR1cm4gY2hpbGQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBUZXh0IGNvbnRlbnQgb2YgdGhpcyBkb2N1bWVudCBhbmQgYWxsIGl0cyBkZXNjZW5kYW50cy4KICAgICAqLwogICAgZ2V0IHRleHQoKSB7CiAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuLm1hcCgoY2hpbGQpID0+ICJ0ZXh0IiBpbiBjaGlsZCA/IGNoaWxkLnRleHQgOiAiIikuam9pbigiIik7CiAgICB9CiAgICBnZXQgdHlwZSgpIHsKICAgICAgcmV0dXJuIFhtbE5vZGUuVFlQRV9ET0NVTUVOVDsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oWG1sTm9kZS5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcyksIHsKICAgICAgICBjaGlsZHJlbjogdGhpcy5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiBjaGlsZC50b0pTT04oKSkKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgWG1sRG9jdW1lbnRUeXBlID0gY2xhc3MgZXh0ZW5kcyBYbWxOb2RlIHsKICAgIGNvbnN0cnVjdG9yKG5hbWUsIHB1YmxpY0lkLCBzeXN0ZW1JZCwgaW50ZXJuYWxTdWJzZXQpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgdGhpcy5wdWJsaWNJZCA9IHB1YmxpY0lkICE9IG51bGwgPyBwdWJsaWNJZCA6IG51bGw7CiAgICAgIHRoaXMuc3lzdGVtSWQgPSBzeXN0ZW1JZCAhPSBudWxsID8gc3lzdGVtSWQgOiBudWxsOwogICAgICB0aGlzLmludGVybmFsU3Vic2V0ID0gaW50ZXJuYWxTdWJzZXQgIT0gbnVsbCA/IGludGVybmFsU3Vic2V0IDogbnVsbDsKICAgIH0KICAgIGdldCB0eXBlKCkgewogICAgICByZXR1cm4gWG1sTm9kZS5UWVBFX0RPQ1VNRU5UX1RZUEU7CiAgICB9CiAgICB0b0pTT04oKSB7CiAgICAgIGxldCBqc29uID0gWG1sTm9kZS5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcyk7CiAgICAgIGpzb24ubmFtZSA9IHRoaXMubmFtZTsKICAgICAgZm9yIChsZXQga2V5IG9mIFsicHVibGljSWQiLCAic3lzdGVtSWQiLCAiaW50ZXJuYWxTdWJzZXQiXSkgewogICAgICAgIGlmICh0aGlzW2tleV0gIT09IG51bGwpIHsKICAgICAgICAgIGpzb25ba2V5XSA9IHRoaXNba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGpzb247CiAgICB9CiAgfTsKICB2YXIgWG1sRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHsKICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIGNoYXJJbmRleCwgeG1sKSB7CiAgICAgIGxldCBjb2x1bW4gPSAxOwogICAgICBsZXQgZXhjZXJwdCA9ICIiOwogICAgICBsZXQgbGluZSA9IDE7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hhckluZGV4OyArK2kpIHsKICAgICAgICBsZXQgY2hhciA9IHhtbFtpXTsKICAgICAgICBpZiAoY2hhciA9PT0gIlxuIikgewogICAgICAgICAgY29sdW1uID0gMTsKICAgICAgICAgIGV4Y2VycHQgPSAiIjsKICAgICAgICAgIGxpbmUgKz0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29sdW1uICs9IDE7CiAgICAgICAgICBleGNlcnB0ICs9IGNoYXI7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCBlb2wgPSB4bWwuaW5kZXhPZigiXG4iLCBjaGFySW5kZXgpOwogICAgICBleGNlcnB0ICs9IGVvbCA9PT0gLTEgPyB4bWwuc2xpY2UoY2hhckluZGV4KSA6IHhtbC5zbGljZShjaGFySW5kZXgsIGVvbCk7CiAgICAgIGxldCBleGNlcnB0U3RhcnQgPSAwOwogICAgICBpZiAoZXhjZXJwdC5sZW5ndGggPiA1MCkgewogICAgICAgIGlmIChjb2x1bW4gPCA0MCkgewogICAgICAgICAgZXhjZXJwdCA9IGV4Y2VycHQuc2xpY2UoMCwgNTApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBleGNlcnB0U3RhcnQgPSBjb2x1bW4gLSAyMDsKICAgICAgICAgIGV4Y2VycHQgPSBleGNlcnB0LnNsaWNlKGV4Y2VycHRTdGFydCwgY29sdW1uICsgMzApOwogICAgICAgIH0KICAgICAgfQogICAgICBzdXBlcigKICAgICAgICBgJHttZXNzYWdlfSAobGluZSAke2xpbmV9LCBjb2x1bW4gJHtjb2x1bW59KQogICR7ZXhjZXJwdH0KYCArICIgIi5yZXBlYXQoY29sdW1uIC0gZXhjZXJwdFN0YXJ0ICsgMSkgKyAiXlxuIgogICAgICApOwogICAgICB0aGlzLmNvbHVtbiA9IGNvbHVtbjsKICAgICAgdGhpcy5leGNlcnB0ID0gZXhjZXJwdDsKICAgICAgdGhpcy5saW5lID0gbGluZTsKICAgICAgdGhpcy5uYW1lID0gIlhtbEVycm9yIjsKICAgICAgdGhpcy5wb3MgPSBjaGFySW5kZXg7CiAgICB9CiAgfTsKICB2YXIgWG1sUHJvY2Vzc2luZ0luc3RydWN0aW9uID0gY2xhc3MgZXh0ZW5kcyBYbWxOb2RlIHsKICAgIGNvbnN0cnVjdG9yKG5hbWUsIGNvbnRlbnQgPSAiIikgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50OwogICAgfQogICAgZ2V0IHR5cGUoKSB7CiAgICAgIHJldHVybiBYbWxOb2RlLlRZUEVfUFJPQ0VTU0lOR19JTlNUUlVDVElPTjsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oWG1sTm9kZS5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcyksIHsKICAgICAgICBuYW1lOiB0aGlzLm5hbWUsCiAgICAgICAgY29udGVudDogdGhpcy5jb250ZW50CiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIGVtcHR5U3RyaW5nMiA9ICIiOwogIHZhciBQYXJzZXIgPSBjbGFzcyB7CiAgICAvKioKICAgICAqIEBwYXJhbSB4bWwgWE1MIHN0cmluZyB0byBwYXJzZS4KICAgICAqIEBwYXJhbSBvcHRpb25zIFBhcnNlciBvcHRpb25zLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih4bWwsIG9wdGlvbnMgPSB7fSkgewogICAgICBsZXQgZG9jID0gdGhpcy5kb2N1bWVudCA9IG5ldyBYbWxEb2N1bWVudCgpOwogICAgICBsZXQgc2Nhbm5lciA9IHRoaXMuYyA9IG5ldyBTdHJpbmdTY2FubmVyKHhtbCk7CiAgICAgIHRoaXMubCA9IGRvYzsKICAgICAgdGhpcy5mID0gb3B0aW9uczsKICAgICAgaWYgKHRoaXMuZi5pbmNsdWRlT2Zmc2V0cykgewogICAgICAgIGRvYy5zdGFydCA9IDA7CiAgICAgICAgZG9jLmVuZCA9IHhtbC5sZW5ndGg7CiAgICAgIH0KICAgICAgc2Nhbm5lci5iKCJcdUZFRkYiKTsKICAgICAgdGhpcy5IKCk7CiAgICAgIGlmICghdGhpcy5CKCkpIHsKICAgICAgICB0aHJvdyB0aGlzLmEoIlJvb3QgZWxlbWVudCBpcyBtaXNzaW5nIG9yIGludmFsaWQiKTsKICAgICAgfQogICAgICB3aGlsZSAodGhpcy53KCkpIHsKICAgICAgfQogICAgICBpZiAoIXNjYW5uZXIueikgewogICAgICAgIHRocm93IHRoaXMuYSgiRXh0cmEgY29udGVudCBhdCB0aGUgZW5kIG9mIHRoZSBkb2N1bWVudCIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgdGhlIGdpdmVuIGBYbWxOb2RlYCBhcyBhIGNoaWxkIG9mIGB0aGlzLmN1cnJlbnROb2RlYC4KICAgICAqLwogICAgaihub2RlLCBjaGFySW5kZXgpIHsKICAgICAgbm9kZS5wYXJlbnQgPSB0aGlzLmw7CiAgICAgIGlmICh0aGlzLmYuaW5jbHVkZU9mZnNldHMpIHsKICAgICAgICBub2RlLnN0YXJ0ID0gdGhpcy5jLmkoY2hhckluZGV4KTsKICAgICAgICBub2RlLmVuZCA9IHRoaXMuYy5pKCk7CiAgICAgIH0KICAgICAgdGhpcy5sLmNoaWxkcmVuLnB1c2gobm9kZSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBnaXZlbiBfdGV4dF8gdG8gdGhlIGRvY3VtZW50LCBlaXRoZXIgYnkgYXBwZW5kaW5nIGl0IHRvIGEKICAgICAqIHByZWNlZGluZyBgWG1sVGV4dGAgbm9kZSAoaWYgcG9zc2libGUpIG9yIGJ5IGNyZWF0aW5nIGEgbmV3IGBYbWxUZXh0YCBub2RlLgogICAgICovCiAgICB4KHRleHQsIGNoYXJJbmRleCkgewogICAgICBsZXQgeyBjaGlsZHJlbiB9ID0gdGhpcy5sOwogICAgICBsZXQgeyBsZW5ndGggfSA9IGNoaWxkcmVuOwogICAgICB0ZXh0ID0gbm9ybWFsaXplTGluZUJyZWFrcyh0ZXh0KTsKICAgICAgaWYgKGxlbmd0aCA+IDApIHsKICAgICAgICBsZXQgcHJldk5vZGUgPSBjaGlsZHJlbltsZW5ndGggLSAxXTsKICAgICAgICBpZiAoKHByZXZOb2RlID09IG51bGwgPyB2b2lkIDAgOiBwcmV2Tm9kZS50eXBlKSA9PT0gWG1sTm9kZS5UWVBFX1RFWFQpIHsKICAgICAgICAgIGxldCB0ZXh0Tm9kZSA9IHByZXZOb2RlOwogICAgICAgICAgdGV4dE5vZGUudGV4dCArPSB0ZXh0OwogICAgICAgICAgaWYgKHRoaXMuZi5pbmNsdWRlT2Zmc2V0cykgewogICAgICAgICAgICB0ZXh0Tm9kZS5lbmQgPSB0aGlzLmMuaSgpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmoobmV3IFhtbFRleHQodGV4dCksIGNoYXJJbmRleCk7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGVsZW1lbnQgYXR0cmlidXRlcy4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI3NlYy1zdGFydHRhZ3MKICAgICAqLwogICAgSSgpIHsKICAgICAgbGV0IGF0dHJpYnV0ZXMgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgd2hpbGUgKHRoaXMuZSgpKSB7CiAgICAgICAgbGV0IGF0dHJOYW1lID0gdGhpcy5yKCk7CiAgICAgICAgaWYgKCFhdHRyTmFtZSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGxldCBhdHRyVmFsdWUgPSB0aGlzLnUoKSAmJiB0aGlzLkooKTsKICAgICAgICBpZiAoYXR0clZhbHVlID09PSBmYWxzZSkgewogICAgICAgICAgdGhyb3cgdGhpcy5hKCJBdHRyaWJ1dGUgdmFsdWUgZXhwZWN0ZWQiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGF0dHJOYW1lIGluIGF0dHJpYnV0ZXMpIHsKICAgICAgICAgIHRocm93IHRoaXMuYShgRHVwbGljYXRlIGF0dHJpYnV0ZTogJHthdHRyTmFtZX1gKTsKICAgICAgICB9CiAgICAgICAgaWYgKGF0dHJOYW1lID09PSAieG1sOnNwYWNlIiAmJiBhdHRyVmFsdWUgIT09ICJkZWZhdWx0IiAmJiBhdHRyVmFsdWUgIT09ICJwcmVzZXJ2ZSIpIHsKICAgICAgICAgIHRocm93IHRoaXMuYSgnVmFsdWUgb2YgdGhlIGB4bWw6c3BhY2VgIGF0dHJpYnV0ZSBtdXN0IGJlICJkZWZhdWx0IiBvciAicHJlc2VydmUiJyk7CiAgICAgICAgfQogICAgICAgIGF0dHJpYnV0ZXNbYXR0ck5hbWVdID0gYXR0clZhbHVlOwogICAgICB9CiAgICAgIGlmICh0aGlzLmYuc29ydEF0dHJpYnV0ZXMpIHsKICAgICAgICBsZXQgYXR0ck5hbWVzID0gT2JqZWN0LmtleXMoYXR0cmlidXRlcykuc29ydCgpOwogICAgICAgIGxldCBzb3J0ZWRBdHRyaWJ1dGVzID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhdHRyTmFtZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGxldCBhdHRyTmFtZSA9IGF0dHJOYW1lc1tpXTsKICAgICAgICAgIHNvcnRlZEF0dHJpYnV0ZXNbYXR0ck5hbWVdID0gYXR0cmlidXRlc1thdHRyTmFtZV07CiAgICAgICAgfQogICAgICAgIGF0dHJpYnV0ZXMgPSBzb3J0ZWRBdHRyaWJ1dGVzOwogICAgICB9CiAgICAgIHJldHVybiBhdHRyaWJ1dGVzOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBhbiBgQXR0VmFsdWVgIChhdHRyaWJ1dGUgdmFsdWUpIGlmIHBvc3NpYmxlLgogICAgICoKICAgICAqIEByZXR1cm5zCiAgICAgKiAgIENvbnRlbnRzIG9mIHRoZSBgQXR0VmFsdWVgIG1pbnVzIHF1b3Rlcywgb3IgYGZhbHNlYCBpZiBub3RoaW5nIHdhcwogICAgICogICBjb25zdW1lZC4gQW4gZW1wdHkgc3RyaW5nIGluZGljYXRlcyB0aGF0IGFuIGBBdHRWYWx1ZWAgd2FzIGNvbnN1bWVkIGJ1dAogICAgICogICB3YXMgZW1wdHkuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNOVC1BdHRWYWx1ZQogICAgICovCiAgICBKKCkgewogICAgICBsZXQgeyBjOiBzY2FubmVyIH0gPSB0aGlzOwogICAgICBsZXQgcXVvdGUgPSBzY2FubmVyLmgoKTsKICAgICAgaWYgKHF1b3RlICE9PSAnIicgJiYgcXVvdGUgIT09ICInIikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBzY2FubmVyLmcoKTsKICAgICAgbGV0IGNoYXJzOwogICAgICBsZXQgaXNDbG9zZWQgPSBmYWxzZTsKICAgICAgbGV0IHZhbHVlID0gZW1wdHlTdHJpbmcyOwogICAgICBsZXQgcmVnZXggPSBxdW90ZSA9PT0gJyInID8gYXR0VmFsdWVDaGFyRG91YmxlUXVvdGUgOiBhdHRWYWx1ZUNoYXJTaW5nbGVRdW90ZTsKICAgICAgbWF0Y2hMb29wOgogICAgICAgIHdoaWxlICghc2Nhbm5lci56KSB7CiAgICAgICAgICBjaGFycyA9IHNjYW5uZXIuRyhyZWdleCk7CiAgICAgICAgICBpZiAoY2hhcnMpIHsKICAgICAgICAgICAgdGhpcy5wKGNoYXJzKTsKICAgICAgICAgICAgdmFsdWUgKz0gY2hhcnMucmVwbGFjZShhdHRWYWx1ZU5vcm1hbGl6ZWRXaGl0ZXNwYWNlLCAiICIpOwogICAgICAgICAgfQogICAgICAgICAgc3dpdGNoIChzY2FubmVyLmgoKSkgewogICAgICAgICAgICBjYXNlIHF1b3RlOgogICAgICAgICAgICAgIGlzQ2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhayBtYXRjaExvb3A7CiAgICAgICAgICAgIGNhc2UgIiYiOgogICAgICAgICAgICAgIHZhbHVlICs9IHRoaXMuQygpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlICI8IjoKICAgICAgICAgICAgICB0aHJvdyB0aGlzLmEoIlVuZXNjYXBlZCBgPGAgaXMgbm90IGFsbG93ZWQgaW4gYW4gYXR0cmlidXRlIHZhbHVlIik7CiAgICAgICAgICAgIGNhc2UgZW1wdHlTdHJpbmcyOgogICAgICAgICAgICAgIGJyZWFrIG1hdGNoTG9vcDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIGlmICghaXNDbG9zZWQpIHsKICAgICAgICB0aHJvdyB0aGlzLmEoIlVuY2xvc2VkIGF0dHJpYnV0ZSIpOwogICAgICB9CiAgICAgIHNjYW5uZXIuZygpOwogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgQ0RBVEEgc2VjdGlvbiBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGEgQ0RBVEEgc2VjdGlvbiB3YXMgY29uc3VtZWQuCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI3NlYy1jZGF0YS1zZWN0CiAgICAgKi8KICAgIEsoKSB7CiAgICAgIGxldCB7IGM6IHNjYW5uZXIgfSA9IHRoaXM7CiAgICAgIGxldCBzdGFydEluZGV4ID0gc2Nhbm5lci5kOwogICAgICBpZiAoIXNjYW5uZXIuYigiPCFbQ0RBVEFbIikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IHRleHQgPSBzY2FubmVyLnQoIl1dPiIpOwogICAgICB0aGlzLnAodGV4dCk7CiAgICAgIGlmICghc2Nhbm5lci5iKCJdXT4iKSkgewogICAgICAgIHRocm93IHRoaXMuYSgiVW5jbG9zZWQgQ0RBVEEgc2VjdGlvbiIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmYucHJlc2VydmVDZGF0YSA/IHRoaXMuaihuZXcgWG1sQ2RhdGEobm9ybWFsaXplTGluZUJyZWFrcyh0ZXh0KSksIHN0YXJ0SW5kZXgpIDogdGhpcy54KHRleHQsIHN0YXJ0SW5kZXgpOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBjaGFyYWN0ZXIgZGF0YSBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGNoYXJhY3RlciBkYXRhIHdhcyBjb25zdW1lZC4KICAgICAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSLzIwMDgvUkVDLXhtbC0yMDA4MTEyNi8jZHQtY2hhcmRhdGEKICAgICAqLwogICAgTCgpIHsKICAgICAgbGV0IHsgYzogc2Nhbm5lciB9ID0gdGhpczsKICAgICAgbGV0IHN0YXJ0SW5kZXggPSBzY2FubmVyLmQ7CiAgICAgIGxldCBjaGFyRGF0YSA9IHNjYW5uZXIuQShlbmRDaGFyRGF0YSk7CiAgICAgIGlmICghY2hhckRhdGEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgdGhpcy5wKGNoYXJEYXRhKTsKICAgICAgaWYgKHNjYW5uZXIuaCgzKSA9PT0gIl1dPiIpIHsKICAgICAgICB0aHJvdyB0aGlzLmEoIkVsZW1lbnQgY29udGVudCBtYXkgbm90IGNvbnRhaW4gdGhlIENEQVRBIHNlY3Rpb24gY2xvc2UgZGVsaW1pdGVyIGBdXT5gIik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMueChjaGFyRGF0YSwgc3RhcnRJbmRleCk7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgY29tbWVudCBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGEgY29tbWVudCB3YXMgY29uc3VtZWQuCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI05ULUNvbW1lbnQKICAgICAqLwogICAgRCgpIHsKICAgICAgbGV0IHsgYzogc2Nhbm5lciB9ID0gdGhpczsKICAgICAgbGV0IHN0YXJ0SW5kZXggPSBzY2FubmVyLmQ7CiAgICAgIGlmICghc2Nhbm5lci5iKCI8IS0tIikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IGNvbnRlbnQgPSBzY2FubmVyLnQoIi0tIik7CiAgICAgIHRoaXMucChjb250ZW50KTsKICAgICAgaWYgKCFzY2FubmVyLmIoIi0tPiIpKSB7CiAgICAgICAgaWYgKHNjYW5uZXIuaCgyKSA9PT0gIi0tIikgewogICAgICAgICAgdGhyb3cgdGhpcy5hKCJUaGUgc3RyaW5nIGAtLWAgaXNuJ3QgYWxsb3dlZCBpbnNpZGUgYSBjb21tZW50Iik7CiAgICAgICAgfQogICAgICAgIHRocm93IHRoaXMuYSgiVW5jbG9zZWQgY29tbWVudCIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmYucHJlc2VydmVDb21tZW50cyA/IHRoaXMuaihuZXcgWG1sQ29tbWVudChub3JtYWxpemVMaW5lQnJlYWtzKGNvbnRlbnQpKSwgc3RhcnRJbmRleCkgOiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBhIHJlZmVyZW5jZSBpbiBhIGNvbnRlbnQgY29udGV4dCBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBUaGlzIGRpZmZlcnMgZnJvbSBgY29uc3VtZVJlZmVyZW5jZSgpYCBpbiB0aGF0IGEgY29uc3VtZWQgcmVmZXJlbmNlIHdpbGwgYmUKICAgICAqIGFkZGVkIHRvIHRoZSBkb2N1bWVudCBhcyBhIHRleHQgbm9kZSBpbnN0ZWFkIG9mIHJldHVybmVkLgogICAgICoKICAgICAqIEByZXR1cm5zIFdoZXRoZXIgYSByZWZlcmVuY2Ugd2FzIGNvbnN1bWVkLgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNlbnRwcm9jCiAgICAgKi8KICAgIE0oKSB7CiAgICAgIGxldCBzdGFydEluZGV4ID0gdGhpcy5jLmQ7CiAgICAgIGxldCByZWYgPSB0aGlzLkMoKTsKICAgICAgcmV0dXJuIHJlZiA/IHRoaXMueChyZWYsIHN0YXJ0SW5kZXgpIDogZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgZG9jdHlwZSBkZWNsYXJhdGlvbiBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBUaGlzIGlzIGEgbG9vc2UgaW1wbGVtZW50YXRpb24gc2luY2UgZG9jdHlwZSBkZWNsYXJhdGlvbnMgYXJlIGN1cnJlbnRseQogICAgICogZGlzY2FyZGVkIHdpdGhvdXQgZnVydGhlciBwYXJzaW5nLgogICAgICoKICAgICAqIEByZXR1cm5zIFdoZXRoZXIgYSBkb2N0eXBlIGRlY2xhcmF0aW9uIHdhcyBjb25zdW1lZC4KICAgICAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSLzIwMDgvUkVDLXhtbC0yMDA4MTEyNi8jZHRkCiAgICAgKi8KICAgIE4oKSB7CiAgICAgIGxldCB7IGM6IHNjYW5uZXIgfSA9IHRoaXM7CiAgICAgIGxldCBzdGFydEluZGV4ID0gc2Nhbm5lci5kOwogICAgICBpZiAoIXNjYW5uZXIuYigiPCFET0NUWVBFIikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IG5hbWUgPSB0aGlzLmUoKSAmJiB0aGlzLnIoKTsKICAgICAgaWYgKCFuYW1lKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJFeHBlY3RlZCBhIG5hbWUiKTsKICAgICAgfQogICAgICBsZXQgcHVibGljSWQ7CiAgICAgIGxldCBzeXN0ZW1JZDsKICAgICAgaWYgKHRoaXMuZSgpKSB7CiAgICAgICAgaWYgKHNjYW5uZXIuYigiUFVCTElDIikpIHsKICAgICAgICAgIHB1YmxpY0lkID0gdGhpcy5lKCkgJiYgdGhpcy5PKCk7CiAgICAgICAgICBpZiAocHVibGljSWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IHRoaXMuYSgiRXhwZWN0ZWQgYSBwdWJsaWMgaWRlbnRpZmllciIpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5lKCk7CiAgICAgICAgfQogICAgICAgIGlmIChwdWJsaWNJZCAhPT0gdm9pZCAwIHx8IHNjYW5uZXIuYigiU1lTVEVNIikpIHsKICAgICAgICAgIHRoaXMuZSgpOwogICAgICAgICAgc3lzdGVtSWQgPSB0aGlzLnMoKTsKICAgICAgICAgIGlmIChzeXN0ZW1JZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgdGhpcy5hKCJFeHBlY3RlZCBhIHN5c3RlbSBpZGVudGlmaWVyIik7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmUoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbGV0IGludGVybmFsU3Vic2V0OwogICAgICBpZiAoc2Nhbm5lci5iKCJbIikpIHsKICAgICAgICBpbnRlcm5hbFN1YnNldCA9IHNjYW5uZXIuQSgvXF1bXHgyMFx0XHJcbl0qPi8pOwogICAgICAgIGlmICghc2Nhbm5lci5iKCJdIikpIHsKICAgICAgICAgIHRocm93IHRoaXMuYSgiVW5jbG9zZWQgaW50ZXJuYWwgc3Vic2V0Iik7CiAgICAgICAgfQogICAgICAgIHRoaXMuZSgpOwogICAgICB9CiAgICAgIGlmICghc2Nhbm5lci5iKCI+IikpIHsKICAgICAgICB0aHJvdyB0aGlzLmEoIlVuY2xvc2VkIGRvY3R5cGUgZGVjbGFyYXRpb24iKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5mLnByZXNlcnZlRG9jdW1lbnRUeXBlID8gdGhpcy5qKG5ldyBYbWxEb2N1bWVudFR5cGUobmFtZSwgcHVibGljSWQsIHN5c3RlbUlkLCBpbnRlcm5hbFN1YnNldCksIHN0YXJ0SW5kZXgpIDogdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3VtZXMgYW4gZWxlbWVudCBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGFuIGVsZW1lbnQgd2FzIGNvbnN1bWVkLgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNOVC1lbGVtZW50CiAgICAgKi8KICAgIEIoKSB7CiAgICAgIGxldCB7IGM6IHNjYW5uZXIgfSA9IHRoaXM7CiAgICAgIGxldCBzdGFydEluZGV4ID0gc2Nhbm5lci5kOwogICAgICBpZiAoIXNjYW5uZXIuYigiPCIpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGxldCBuYW1lID0gdGhpcy5yKCk7CiAgICAgIGlmICghbmFtZSkgewogICAgICAgIHNjYW5uZXIubyhzdGFydEluZGV4KTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IGF0dHJpYnV0ZXMgPSB0aGlzLkkoKTsKICAgICAgbGV0IGlzRW1wdHkgPSAhIXNjYW5uZXIuYigiLz4iKTsKICAgICAgbGV0IGVsZW1lbnQgPSBuZXcgWG1sRWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzKTsKICAgICAgZWxlbWVudC5wYXJlbnQgPSB0aGlzLmw7CiAgICAgIGlmICghaXNFbXB0eSkgewogICAgICAgIGlmICghc2Nhbm5lci5iKCI+IikpIHsKICAgICAgICAgIHRocm93IHRoaXMuYShgVW5jbG9zZWQgc3RhcnQgdGFnIGZvciBlbGVtZW50IFxgJHtuYW1lfVxgYCk7CiAgICAgICAgfQogICAgICAgIHRoaXMubCA9IGVsZW1lbnQ7CiAgICAgICAgZG8gewogICAgICAgICAgdGhpcy5MKCk7CiAgICAgICAgfSB3aGlsZSAodGhpcy5CKCkgfHwgdGhpcy5NKCkgfHwgdGhpcy5LKCkgfHwgdGhpcy5FKCkgfHwgdGhpcy5EKCkpOwogICAgICAgIGxldCBlbmRUYWdNYXJrID0gc2Nhbm5lci5kOwogICAgICAgIGxldCBlbmRUYWdOYW1lOwogICAgICAgIGlmICghc2Nhbm5lci5iKCI8LyIpIHx8ICEoZW5kVGFnTmFtZSA9IHRoaXMucigpKSB8fCBlbmRUYWdOYW1lICE9PSBuYW1lKSB7CiAgICAgICAgICBzY2FubmVyLm8oZW5kVGFnTWFyayk7CiAgICAgICAgICB0aHJvdyB0aGlzLmEoYE1pc3NpbmcgZW5kIHRhZyBmb3IgZWxlbWVudCAke25hbWV9YCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuZSgpOwogICAgICAgIGlmICghc2Nhbm5lci5iKCI+IikpIHsKICAgICAgICAgIHRocm93IHRoaXMuYShgVW5jbG9zZWQgZW5kIHRhZyBmb3IgZWxlbWVudCAke25hbWV9YCk7CiAgICAgICAgfQogICAgICAgIHRoaXMubCA9IGVsZW1lbnQucGFyZW50OwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmooZWxlbWVudCwgc3RhcnRJbmRleCk7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGFuIGBFcWAgcHJvZHVjdGlvbiBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGFuIGBFcWAgcHJvZHVjdGlvbiB3YXMgY29uc3VtZWQuCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI05ULUVxCiAgICAgKi8KICAgIHUoKSB7CiAgICAgIHRoaXMuZSgpOwogICAgICBpZiAodGhpcy5jLmIoIj0iKSkgewogICAgICAgIHRoaXMuZSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3VtZXMgYE1pc2NgIGNvbnRlbnQgaWYgcG9zc2libGUuCiAgICAgKgogICAgICogQHJldHVybnMgV2hldGhlciBhbnl0aGluZyB3YXMgY29uc3VtZWQuCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI05ULU1pc2MKICAgICAqLwogICAgdygpIHsKICAgICAgcmV0dXJuIHRoaXMuRCgpIHx8IHRoaXMuRSgpIHx8IHRoaXMuZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBvbmUgb3IgbW9yZSBgTmFtZWAgY2hhcmFjdGVycyBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBgTmFtZWAgY2hhcmFjdGVycywgb3IgYW4gZW1wdHkgc3RyaW5nIGlmIG5vbmUgd2VyZSBjb25zdW1lZC4KICAgICAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSLzIwMDgvUkVDLXhtbC0yMDA4MTEyNi8jTlQtTmFtZQogICAgICovCiAgICByKCkgewogICAgICByZXR1cm4gaXNOYW1lU3RhcnRDaGFyKHRoaXMuYy5oKCkpID8gdGhpcy5jLnYoaXNOYW1lQ2hhcikgOiBlbXB0eVN0cmluZzI7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGEgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiB3YXMgY29uc3VtZWQuCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI3NlYy1waQogICAgICovCiAgICBFKCkgewogICAgICBsZXQgeyBjOiBzY2FubmVyIH0gPSB0aGlzOwogICAgICBsZXQgc3RhcnRJbmRleCA9IHNjYW5uZXIuZDsKICAgICAgaWYgKCFzY2FubmVyLmIoIjw/IikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IG5hbWUgPSB0aGlzLnIoKTsKICAgICAgaWYgKG5hbWUpIHsKICAgICAgICBpZiAobmFtZS50b0xvd2VyQ2FzZSgpID09PSAieG1sIikgewogICAgICAgICAgc2Nhbm5lci5vKHN0YXJ0SW5kZXgpOwogICAgICAgICAgdGhyb3cgdGhpcy5hKCJYTUwgZGVjbGFyYXRpb24gaXNuJ3QgYWxsb3dlZCBoZXJlIik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IHRoaXMuYSgiSW52YWxpZCBwcm9jZXNzaW5nIGluc3RydWN0aW9uIik7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmUoKSkgewogICAgICAgIGlmIChzY2FubmVyLmIoIj8+IikpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmoobmV3IFhtbFByb2Nlc3NpbmdJbnN0cnVjdGlvbihuYW1lKSwgc3RhcnRJbmRleCk7CiAgICAgICAgfQogICAgICAgIHRocm93IHRoaXMuYSgiV2hpdGVzcGFjZSBpcyByZXF1aXJlZCBhZnRlciBhIHByb2Nlc3NpbmcgaW5zdHJ1Y3Rpb24gbmFtZSIpOwogICAgICB9CiAgICAgIGxldCBjb250ZW50ID0gc2Nhbm5lci50KCI/PiIpOwogICAgICB0aGlzLnAoY29udGVudCk7CiAgICAgIGlmICghc2Nhbm5lci5iKCI/PiIpKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJVbnRlcm1pbmF0ZWQgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmoobmV3IFhtbFByb2Nlc3NpbmdJbnN0cnVjdGlvbihuYW1lLCBub3JtYWxpemVMaW5lQnJlYWtzKGNvbnRlbnQpKSwgc3RhcnRJbmRleCk7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgcHJvbG9nIGlmIHBvc3NpYmxlLgogICAgICoKICAgICAqIEByZXR1cm5zIFdoZXRoZXIgYSBwcm9sb2cgd2FzIGNvbnN1bWVkLgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNzZWMtcHJvbG9nLWR0ZAogICAgICovCiAgICBIKCkgewogICAgICBsZXQgeyBjOiBzY2FubmVyIH0gPSB0aGlzOwogICAgICBsZXQgc3RhcnRJbmRleCA9IHNjYW5uZXIuZDsKICAgICAgdGhpcy5QKCk7CiAgICAgIHdoaWxlICh0aGlzLncoKSkgewogICAgICB9CiAgICAgIGlmICh0aGlzLk4oKSkgewogICAgICAgIHdoaWxlICh0aGlzLncoKSkgewogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gc3RhcnRJbmRleCA8IHNjYW5uZXIuZDsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3VtZXMgYSBwdWJsaWMgaWRlbnRpZmllciBsaXRlcmFsIGlmIHBvc3NpYmxlLgogICAgICoKICAgICAqIEByZXR1cm5zCiAgICAgKiAgIFZhbHVlIG9mIHRoZSBwdWJsaWMgaWRlbnRpZmllciBsaXRlcmFsIG1pbnVzIHF1b3Rlcywgb3IgYGZhbHNlYCBpZgogICAgICogICBub3RoaW5nIHdhcyBjb25zdW1lZC4gQW4gZW1wdHkgc3RyaW5nIGluZGljYXRlcyB0aGF0IGEgcHVibGljIGlkIGxpdGVyYWwKICAgICAqICAgd2FzIGNvbnN1bWVkIGJ1dCB3YXMgZW1wdHkuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNOVC1QdWJpZExpdGVyYWwKICAgICAqLwogICAgTygpIHsKICAgICAgbGV0IHN0YXJ0SW5kZXggPSB0aGlzLmMuZDsKICAgICAgbGV0IHZhbHVlID0gdGhpcy5zKCk7CiAgICAgIGlmICh2YWx1ZSAhPT0gZmFsc2UgJiYgIS9eWy1ceDIwXHJcbmEtekEtWjAtOScoKSssLi86PT87ISojQCRfJV0qJC8udGVzdCh2YWx1ZSkpIHsKICAgICAgICB0aGlzLmMubyhzdGFydEluZGV4KTsKICAgICAgICB0aHJvdyB0aGlzLmEoIkludmFsaWQgY2hhcmFjdGVyIGluIHB1YmxpYyBpZGVudGlmaWVyIik7CiAgICAgIH0KICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBhIHJlZmVyZW5jZSBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBUaGlzIGRpZmZlcnMgZnJvbSBgY29uc3VtZUNvbnRlbnRSZWZlcmVuY2UoKWAgaW4gdGhhdCBhIGNvbnN1bWVkIHJlZmVyZW5jZQogICAgICogd2lsbCBiZSByZXR1cm5lZCByYXRoZXIgdGhhbiBhZGRlZCB0byB0aGUgZG9jdW1lbnQuCiAgICAgKgogICAgICogQHJldHVybnMKICAgICAqICAgUGFyc2VkIHJlZmVyZW5jZSB2YWx1ZSwgb3IgYGZhbHNlYCBpZiBub3RoaW5nIHdhcyBjb25zdW1lZCAodG8KICAgICAqICAgZGlzdGluZ3Vpc2ggZnJvbSBhIHJlZmVyZW5jZSB0aGF0IHJlc29sdmVzIHRvIGFuIGVtcHR5IHN0cmluZykuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNOVC1SZWZlcmVuY2UKICAgICAqLwogICAgQygpIHsKICAgICAgbGV0IHsgYzogc2Nhbm5lciB9ID0gdGhpczsKICAgICAgaWYgKCFzY2FubmVyLmIoIiYiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBsZXQgcmVmID0gc2Nhbm5lci52KGlzUmVmZXJlbmNlQ2hhcik7CiAgICAgIGlmIChzY2FubmVyLkYoKSAhPT0gIjsiKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJVbnRlcm1pbmF0ZWQgcmVmZXJlbmNlIChhIHJlZmVyZW5jZSBtdXN0IGVuZCB3aXRoIGA7YCkiKTsKICAgICAgfQogICAgICBsZXQgcGFyc2VkVmFsdWU7CiAgICAgIGlmIChyZWZbMF0gPT09ICIjIikgewogICAgICAgIGxldCBjb2RlUG9pbnQgPSByZWZbMV0gPT09ICJ4IiA/IHBhcnNlSW50KHJlZi5zbGljZSgyKSwgMTYpIDogcGFyc2VJbnQocmVmLnNsaWNlKDEpLCAxMCk7CiAgICAgICAgaWYgKGlzTmFOKGNvZGVQb2ludCkpIHsKICAgICAgICAgIHRocm93IHRoaXMuYSgiSW52YWxpZCBjaGFyYWN0ZXIgcmVmZXJlbmNlIik7CiAgICAgICAgfQogICAgICAgIGlmICghaXNYbWxDb2RlUG9pbnQoY29kZVBvaW50KSkgewogICAgICAgICAgdGhyb3cgdGhpcy5hKCJDaGFyYWN0ZXIgcmVmZXJlbmNlIHJlc29sdmVzIHRvIGFuIGludmFsaWQgY2hhcmFjdGVyIik7CiAgICAgICAgfQogICAgICAgIHBhcnNlZFZhbHVlID0gU3RyaW5nLmZyb21Db2RlUG9pbnQoY29kZVBvaW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwYXJzZWRWYWx1ZSA9IHByZWRlZmluZWRFbnRpdGllc1tyZWZdOwogICAgICAgIGlmIChwYXJzZWRWYWx1ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBsZXQgewogICAgICAgICAgICBpZ25vcmVVbmRlZmluZWRFbnRpdGllcywKICAgICAgICAgICAgcmVzb2x2ZVVuZGVmaW5lZEVudGl0eQogICAgICAgICAgfSA9IHRoaXMuZjsKICAgICAgICAgIGxldCB3cmFwcGVkUmVmID0gYCYke3JlZn07YDsKICAgICAgICAgIGlmIChyZXNvbHZlVW5kZWZpbmVkRW50aXR5KSB7CiAgICAgICAgICAgIGxldCByZXNvbHZlZFZhbHVlID0gcmVzb2x2ZVVuZGVmaW5lZEVudGl0eSh3cmFwcGVkUmVmKTsKICAgICAgICAgICAgaWYgKHJlc29sdmVkVmFsdWUgIT09IG51bGwgJiYgcmVzb2x2ZWRWYWx1ZSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgbGV0IHR5cGUgPSB0eXBlb2YgcmVzb2x2ZWRWYWx1ZTsKICAgICAgICAgICAgICBpZiAodHlwZSAhPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYFxgcmVzb2x2ZVVuZGVmaW5lZEVudGl0eSgpXGAgbXVzdCByZXR1cm4gYSBzdHJpbmcsIFxgbnVsbFxgLCBvciBcYHVuZGVmaW5lZFxgLCBidXQgcmV0dXJuZWQgYSB2YWx1ZSBvZiB0eXBlICR7dHlwZX1gKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmVkVmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChpZ25vcmVVbmRlZmluZWRFbnRpdGllcykgewogICAgICAgICAgICByZXR1cm4gd3JhcHBlZFJlZjsKICAgICAgICAgIH0KICAgICAgICAgIHNjYW5uZXIubygtd3JhcHBlZFJlZi5sZW5ndGgpOwogICAgICAgICAgdGhyb3cgdGhpcy5hKGBOYW1lZCBlbnRpdHkgaXNuJ3QgZGVmaW5lZDogJHt3cmFwcGVkUmVmfWApOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcGFyc2VkVmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgYFN5c3RlbUxpdGVyYWxgIGlmIHBvc3NpYmxlLgogICAgICoKICAgICAqIEEgYFN5c3RlbUxpdGVyYWxgIGlzIHNpbWlsYXIgdG8gYW4gYXR0cmlidXRlIHZhbHVlLCBidXQgYWxsb3dzIHRoZQogICAgICogY2hhcmFjdGVycyBgPGAgYW5kIGAmYCBhbmQgZG9lc24ndCByZXBsYWNlIHJlZmVyZW5jZXMuCiAgICAgKgogICAgICogQHJldHVybnMKICAgICAqICAgVmFsdWUgb2YgdGhlIGBTeXN0ZW1MaXRlcmFsYCBtaW51cyBxdW90ZXMsIG9yIGBmYWxzZWAgaWYgbm90aGluZyB3YXMKICAgICAqICAgY29uc3VtZWQuIEFuIGVtcHR5IHN0cmluZyBpbmRpY2F0ZXMgdGhhdCBhIGBTeXN0ZW1MaXRlcmFsYCB3YXMgY29uc3VtZWQKICAgICAqICAgYnV0IHdhcyBlbXB0eS4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI05ULVN5c3RlbUxpdGVyYWwKICAgICAqLwogICAgcygpIHsKICAgICAgbGV0IHsgYzogc2Nhbm5lciB9ID0gdGhpczsKICAgICAgbGV0IHF1b3RlID0gc2Nhbm5lci5iKCciJykgfHwgc2Nhbm5lci5iKCInIik7CiAgICAgIGlmICghcXVvdGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IHZhbHVlID0gc2Nhbm5lci50KHF1b3RlKTsKICAgICAgdGhpcy5wKHZhbHVlKTsKICAgICAgaWYgKCFzY2FubmVyLmIocXVvdGUpKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJNaXNzaW5nIGVuZCBxdW90ZSIpOwogICAgICB9CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3VtZXMgb25lIG9yIG1vcmUgd2hpdGVzcGFjZSBjaGFyYWN0ZXJzIGlmIHBvc3NpYmxlLgogICAgICoKICAgICAqIEByZXR1cm5zIFdoZXRoZXIgYW55IHdoaXRlc3BhY2UgY2hhcmFjdGVycyB3ZXJlIGNvbnN1bWVkLgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyN3aGl0ZQogICAgICovCiAgICBlKCkgewogICAgICByZXR1cm4gISF0aGlzLmMudihpc1doaXRlc3BhY2UpOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBhbiBYTUwgZGVjbGFyYXRpb24gaWYgcG9zc2libGUuCiAgICAgKgogICAgICogQHJldHVybnMgV2hldGhlciBhbiBYTUwgZGVjbGFyYXRpb24gd2FzIGNvbnN1bWVkLgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNOVC1YTUxEZWNsCiAgICAgKi8KICAgIFAoKSB7CiAgICAgIGxldCB7IGM6IHNjYW5uZXIgfSA9IHRoaXM7CiAgICAgIGxldCBzdGFydEluZGV4ID0gc2Nhbm5lci5kOwogICAgICBpZiAoIXNjYW5uZXIuYigiPD94bWwiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAoIXRoaXMuZSgpKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJJbnZhbGlkIFhNTCBkZWNsYXJhdGlvbiIpOwogICAgICB9CiAgICAgIGxldCB2ZXJzaW9uID0gISFzY2FubmVyLmIoInZlcnNpb24iKSAmJiB0aGlzLnUoKSAmJiB0aGlzLnMoKTsKICAgICAgaWYgKHZlcnNpb24gPT09IGZhbHNlKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJYTUwgdmVyc2lvbiBpcyBtaXNzaW5nIG9yIGludmFsaWQiKTsKICAgICAgfSBlbHNlIGlmICghL14xXC5bMC05XSskLy50ZXN0KHZlcnNpb24pKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJJbnZhbGlkIGNoYXJhY3RlciBpbiB2ZXJzaW9uIG51bWJlciIpOwogICAgICB9CiAgICAgIGxldCBlbmNvZGluZzsKICAgICAgbGV0IHN0YW5kYWxvbmU7CiAgICAgIGlmICh0aGlzLmUoKSkgewogICAgICAgIGVuY29kaW5nID0gISFzY2FubmVyLmIoImVuY29kaW5nIikgJiYgdGhpcy51KCkgJiYgdGhpcy5zKCk7CiAgICAgICAgaWYgKGVuY29kaW5nKSB7CiAgICAgICAgICB0aGlzLmUoKTsKICAgICAgICB9CiAgICAgICAgc3RhbmRhbG9uZSA9ICEhc2Nhbm5lci5iKCJzdGFuZGFsb25lIikgJiYgdGhpcy51KCkgJiYgdGhpcy5zKCk7CiAgICAgICAgaWYgKHN0YW5kYWxvbmUpIHsKICAgICAgICAgIGlmIChzdGFuZGFsb25lICE9PSAieWVzIiAmJiBzdGFuZGFsb25lICE9PSAibm8iKSB7CiAgICAgICAgICAgIHRocm93IHRoaXMuYSgnT25seSAieWVzIiBhbmQgIm5vIiBhcmUgcGVybWl0dGVkIGFzIHZhbHVlcyBvZiBgc3RhbmRhbG9uZWAnKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIXNjYW5uZXIuYigiPz4iKSkgewogICAgICAgIHRocm93IHRoaXMuYSgiSW52YWxpZCBvciB1bmNsb3NlZCBYTUwgZGVjbGFyYXRpb24iKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5mLnByZXNlcnZlWG1sRGVjbGFyYXRpb24gPyB0aGlzLmoobmV3IFhtbERlY2xhcmF0aW9uKAogICAgICAgIHZlcnNpb24sCiAgICAgICAgZW5jb2RpbmcgfHwgdm9pZCAwLAogICAgICAgIHN0YW5kYWxvbmUgfHwgdm9pZCAwCiAgICAgICksIHN0YXJ0SW5kZXgpIDogdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbiBgWG1sRXJyb3JgIGZvciB0aGUgY3VycmVudCBzY2FubmVyIHBvc2l0aW9uLgogICAgICovCiAgICBhKG1lc3NhZ2UpIHsKICAgICAgbGV0IHsgYzogc2Nhbm5lciB9ID0gdGhpczsKICAgICAgcmV0dXJuIG5ldyBYbWxFcnJvcihtZXNzYWdlLCBzY2FubmVyLmQsIHNjYW5uZXIubSk7CiAgICB9CiAgICAvKioKICAgICAqIFRocm93cyBhbiBpbnZhbGlkIGNoYXJhY3RlciBlcnJvciBpZiBhbnkgY2hhcmFjdGVyIGluIHRoZSBnaXZlbiBfc3RyaW5nXwogICAgICogaXNuJ3QgYSB2YWxpZCBYTUwgY2hhcmFjdGVyLgogICAgICovCiAgICBwKHN0cmluZykgewogICAgICBsZXQgeyBsZW5ndGggfSA9IHN0cmluZzsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgIGxldCBjcCA9IHN0cmluZy5jb2RlUG9pbnRBdChpKTsKICAgICAgICBpZiAoIWlzWG1sQ29kZVBvaW50KGNwKSkgewogICAgICAgICAgdGhpcy5jLm8oLShbLi4uc3RyaW5nXS5sZW5ndGggLSBpKSk7CiAgICAgICAgICB0aHJvdyB0aGlzLmEoIkludmFsaWQgY2hhcmFjdGVyIik7CiAgICAgICAgfQogICAgICAgIGlmIChjcCA+IDY1NTM1KSB7CiAgICAgICAgICBpICs9IDE7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKICBmdW5jdGlvbiBub3JtYWxpemVMaW5lQnJlYWtzKHRleHQpIHsKICAgIGxldCBpID0gMDsKICAgIHdoaWxlICgoaSA9IHRleHQuaW5kZXhPZigiXHIiLCBpKSkgIT09IC0xKSB7CiAgICAgIHRleHQgPSB0ZXh0W2kgKyAxXSA9PT0gIlxuIiA/IHRleHQuc2xpY2UoMCwgaSkgKyB0ZXh0LnNsaWNlKGkgKyAxKSA6IHRleHQuc2xpY2UoMCwgaSkgKyAiXG4iICsgdGV4dC5zbGljZShpICsgMSk7CiAgICB9CiAgICByZXR1cm4gdGV4dDsKICB9CiAgZnVuY3Rpb24gcGFyc2VYbWwoeG1sLCBvcHRpb25zKSB7CiAgICByZXR1cm4gbmV3IFBhcnNlcih4bWwsIG9wdGlvbnMpLmRvY3VtZW50OwogIH0KICBjbGFzcyBYbWxQYXJzZUVycm9yIGV4dGVuZHMgRXJyb3IgewogICAgY29uc3RydWN0b3IobWVzc2FnZSkgewogICAgICBzdXBlcihtZXNzYWdlKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gcGFyc2VYbWxTdHJpbmcoeG1sU3RyaW5nKSB7CiAgICBsZXQgZG9jID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGRvYyA9IGJyb3dzZXIucGFyc2VYbWwoeG1sU3RyaW5nKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgdGhyb3cgbmV3IFhtbFBhcnNlRXJyb3IoZS5tZXNzYWdlKTsKICAgIH0KICAgIHJldHVybiBkb2M7CiAgfQogIGZ1bmN0aW9uIHN0cmlwTmFtZXNwYWNlKG5hbWUpIHsKICAgIGNvbnN0IGNvbG9uID0gbmFtZS5pbmRleE9mKCI6Iik7CiAgICByZXR1cm4gY29sb24gPiAtMSA/IG5hbWUuc3Vic3RyKGNvbG9uICsgMSkgOiBuYW1lOwogIH0KICBmdW5jdGlvbiBnZXRSb290RWxlbWVudCh4bWxEb2MpIHsKICAgIHJldHVybiB4bWxEb2MuY2hpbGRyZW5bMF07CiAgfQogIGZ1bmN0aW9uIGdldEVsZW1lbnROYW1lKGVsZW1lbnQpIHsKICAgIHJldHVybiBlbGVtZW50Lm5hbWUgfHwgIiI7CiAgfQogIGZ1bmN0aW9uIGZpbmRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCwgbmFtZSwgbmVzdGVkID0gZmFsc2UpIHsKICAgIGNvbnN0IHN0cmlwcGVkTmFtZSA9IHN0cmlwTmFtZXNwYWNlKG5hbWUpOwogICAgZnVuY3Rpb24gcmVkdWNlcihwcmV2LCBjdXJyKSB7CiAgICAgIGlmIChzdHJpcE5hbWVzcGFjZShnZXRFbGVtZW50TmFtZShjdXJyKSkgPT09IHN0cmlwcGVkTmFtZSkgewogICAgICAgIHByZXYucHVzaChjdXJyKTsKICAgICAgfQogICAgICBpZiAobmVzdGVkICYmIEFycmF5LmlzQXJyYXkoY3Vyci5jaGlsZHJlbikpIHsKICAgICAgICByZXR1cm4gWy4uLnByZXYsIC4uLmN1cnIuY2hpbGRyZW4ucmVkdWNlKHJlZHVjZXIsIFtdKV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHByZXY7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBlbGVtZW50ICYmIEFycmF5LmlzQXJyYXkoZWxlbWVudC5jaGlsZHJlbikgPyBlbGVtZW50LmNoaWxkcmVuLnJlZHVjZShyZWR1Y2VyLCBbXSkgOiBbXTsKICB9CiAgZnVuY3Rpb24gZmluZENoaWxkRWxlbWVudChlbGVtZW50LCBuYW1lLCBuZXN0ZWQgPSBmYWxzZSkgewogICAgcmV0dXJuIGZpbmRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCwgbmFtZSwgbmVzdGVkKVswXSB8fCBudWxsOwogIH0KICBmdW5jdGlvbiBnZXRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCkgewogICAgcmV0dXJuIGVsZW1lbnQgJiYgQXJyYXkuaXNBcnJheShlbGVtZW50LmNoaWxkcmVuKSA/IFsKICAgICAgLi4uZWxlbWVudC5jaGlsZHJlbi5maWx0ZXIoCiAgICAgICAgKGVsKSA9PiBlbCBpbnN0YW5jZW9mIGJyb3dzZXIuWG1sRWxlbWVudAogICAgICApCiAgICBdIDogW107CiAgfQogIGZ1bmN0aW9uIGdldEVsZW1lbnRUZXh0KGVsZW1lbnQpIHsKICAgIGNvbnN0IHRleHROb2RlID0gZWxlbWVudCAmJiBBcnJheS5pc0FycmF5KGVsZW1lbnQuY2hpbGRyZW4pID8gZWxlbWVudC5jaGlsZHJlbi5maW5kKChub2RlKSA9PiBub2RlLnR5cGUgPT09ICJ0ZXh0IikgOiBudWxsOwogICAgcmV0dXJuIHRleHROb2RlID8gdGV4dE5vZGUudGV4dCA6ICIiOwogIH0KICBmdW5jdGlvbiBnZXRFbGVtZW50QXR0cmlidXRlKGVsZW1lbnQsIGF0dHJOYW1lKSB7CiAgICByZXR1cm4gZWxlbWVudCAmJiBlbGVtZW50LmF0dHJpYnV0ZXNbYXR0ck5hbWVdIHx8ICIiOwogIH0KICBjbGFzcyBFbmRwb2ludEVycm9yIGV4dGVuZHMgRXJyb3IgewogICAgY29uc3RydWN0b3IobWVzc2FnZSwgaHR0cFN0YXR1cywgaXNDcm9zc09yaWdpblJlbGF0ZWQpIHsKICAgICAgc3VwZXIobWVzc2FnZSk7CiAgICAgIHRoaXMuaHR0cFN0YXR1cyA9IGh0dHBTdGF0dXM7CiAgICAgIHRoaXMuaXNDcm9zc09yaWdpblJlbGF0ZWQgPSBpc0Nyb3NzT3JpZ2luUmVsYXRlZDsKICAgICAgdGhpcy5uYW1lID0gIkVuZHBvaW50RXJyb3IiOwogICAgfQogIH0KICBjbGFzcyBTZXJ2aWNlRXhjZXB0aW9uRXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yCiAgICAgKiBAcGFyYW0gbWVzc2FnZSBFcnJvciBtZXNzYWdlCiAgICAgKiBAcGFyYW0gcmVxdWVzdFVybCBVUkwgd2hpY2ggcmVzdWx0ZWQgaW4gdGhlIFNlcnZpY2VFeGNlcHRpb24KICAgICAqIEBwYXJhbSBjb2RlIE9wdGlvbmFsIFNlcnZpY2VFeGNlcHRpb24gY29kZQogICAgICogQHBhcmFtIGxvY2F0b3IgT3B0aW9uYWwgU2VydmljZUV4Y2VwdGlvbiBsb2NhdG9yCiAgICAgKiBAcGFyYW0gcmVzcG9uc2UgT3B0aW9uYWwgcmVzcG9uc2UgY29udGVudCByZWNlaXZlZAogICAgICovCiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCByZXF1ZXN0VXJsLCBjb2RlLCBsb2NhdG9yLCByZXNwb25zZSkgewogICAgICBzdXBlcihtZXNzYWdlKTsKICAgICAgdGhpcy5yZXF1ZXN0VXJsID0gcmVxdWVzdFVybDsKICAgICAgdGhpcy5jb2RlID0gY29kZTsKICAgICAgdGhpcy5sb2NhdG9yID0gbG9jYXRvcjsKICAgICAgdGhpcy5yZXNwb25zZSA9IHJlc3BvbnNlOwogICAgICB0aGlzLm5hbWUgPSAiU2VydmljZUV4Y2VwdGlvbkVycm9yIjsKICAgIH0KICB9CiAgZnVuY3Rpb24gcGFyc2Uoc2VydmljZUV4Y2VwdGlvbiwgdXJsKSB7CiAgICBjb25zdCBlcnJvckNvZGUgPSBnZXRFbGVtZW50QXR0cmlidXRlKHNlcnZpY2VFeGNlcHRpb24sICJjb2RlIikgfHwgZ2V0RWxlbWVudEF0dHJpYnV0ZShzZXJ2aWNlRXhjZXB0aW9uLCAiZXhjZXB0aW9uQ29kZSIpOwogICAgY29uc3QgZXJyb3JMb2NhdG9yID0gZ2V0RWxlbWVudEF0dHJpYnV0ZShzZXJ2aWNlRXhjZXB0aW9uLCAibG9jYXRvciIpOwogICAgY29uc3QgdGV4dEVsZW1lbnQgPSBmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2VFeGNlcHRpb24sICJFeGNlcHRpb25UZXh0IikgfHwgc2VydmljZUV4Y2VwdGlvbjsKICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGdldEVsZW1lbnRUZXh0KHRleHRFbGVtZW50KS50cmltKCk7CiAgICByZXR1cm4gbmV3IFNlcnZpY2VFeGNlcHRpb25FcnJvcigKICAgICAgZXJyb3JNZXNzYWdlLAogICAgICB1cmwsCiAgICAgIGVycm9yQ29kZSwKICAgICAgZXJyb3JMb2NhdG9yLAogICAgICBzZXJ2aWNlRXhjZXB0aW9uLmRvY3VtZW50CiAgICApOwogIH0KICBmdW5jdGlvbiBjaGVjayhyZXNwb25zZSwgdXJsKSB7CiAgICBjb25zdCByb290RWwgPSBnZXRSb290RWxlbWVudChyZXNwb25zZSk7CiAgICBjb25zdCByb290RWxOYW1lID0gc3RyaXBOYW1lc3BhY2UoZ2V0RWxlbWVudE5hbWUocm9vdEVsKSk7CiAgICBpZiAocm9vdEVsTmFtZSA9PT0gIlNlcnZpY2VFeGNlcHRpb25SZXBvcnQiKSB7CiAgICAgIGNvbnN0IGVycm9yID0gZmluZENoaWxkRWxlbWVudChyb290RWwsICJTZXJ2aWNlRXhjZXB0aW9uIik7CiAgICAgIGlmIChlcnJvcikgewogICAgICAgIHRocm93IHBhcnNlKGVycm9yLCB1cmwpOwogICAgICB9CiAgICB9CiAgICBpZiAocm9vdEVsTmFtZSA9PT0gIkV4Y2VwdGlvblJlcG9ydCIpIHsKICAgICAgY29uc3QgZXJyb3IgPSBmaW5kQ2hpbGRFbGVtZW50KHJvb3RFbCwgIkV4Y2VwdGlvbiIpOwogICAgICBpZiAoZXJyb3IpIHsKICAgICAgICB0aHJvdyBwYXJzZShlcnJvciwgdXJsKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3BvbnNlOwogIH0KICBmdW5jdGlvbiBlbmNvZGVFcnJvcihlcnJvcikgewogICAgY29uc3QgYmFzZSA9IHsKICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSwKICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLAogICAgICBuYW1lOiBlcnJvci5uYW1lCiAgICB9OwogICAgaWYgKGVycm9yIGluc3RhbmNlb2YgU2VydmljZUV4Y2VwdGlvbkVycm9yKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgLi4uYmFzZSwKICAgICAgICBjb2RlOiBlcnJvci5jb2RlLAogICAgICAgIGxvY2F0b3I6IGVycm9yLmxvY2F0b3IsCiAgICAgICAgcmVzcG9uc2U6IGVycm9yLnJlc3BvbnNlLAogICAgICAgIHJlcXVlc3RVcmw6IGVycm9yLnJlcXVlc3RVcmwKICAgICAgfTsKICAgIH0KICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVuZHBvaW50RXJyb3IpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICAuLi5iYXNlLAogICAgICAgIGh0dHBTdGF0dXM6IGVycm9yLmh0dHBTdGF0dXMsCiAgICAgICAgaXNDcm9zc09yaWdpblJlbGF0ZWQ6IGVycm9yLmlzQ3Jvc3NPcmlnaW5SZWxhdGVkCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gYmFzZTsKICB9CiAgY29uc3QgZmFsbGJhY2tFdmVudFRhcmdldCA9IG5ldyBFdmVudFRhcmdldCgpOwogIGZ1bmN0aW9uIGFkZFRhc2tIYW5kbGVyKHRhc2tOYW1lLCBzY29wZSwgaGFuZGxlcikgewogICAgY29uc3QgdXNlV29ya2VyID0gdHlwZW9mIFdvcmtlckdsb2JhbFNjb3BlICE9PSAidW5kZWZpbmVkIjsKICAgIGNvbnN0IGV2ZW50SGFuZGxlciA9IGFzeW5jIChyZXF1ZXN0KSA9PiB7CiAgICAgIGlmIChyZXF1ZXN0LnRhc2tOYW1lID09PSB0YXNrTmFtZSkgewogICAgICAgIGxldCByZXNwb25zZSwgZXJyb3I7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LnBhcmFtcyk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgZXJyb3IgPSBlbmNvZGVFcnJvcihlKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbWVzc2FnZSA9ICgKICAgICAgICAgIC8qKiBAdHlwZSB7V29ya2VyUmVzcG9uc2V9ICovCiAgICAgICAgICB7CiAgICAgICAgICAgIHRhc2tOYW1lLAogICAgICAgICAgICByZXF1ZXN0SWQ6IHJlcXVlc3QucmVxdWVzdElkLAogICAgICAgICAgICAuLi5yZXNwb25zZSAmJiB7IHJlc3BvbnNlIH0sCiAgICAgICAgICAgIC4uLmVycm9yICYmIHsgZXJyb3IgfQogICAgICAgICAgfQogICAgICAgICk7CiAgICAgICAgaWYgKHVzZVdvcmtlcikgewogICAgICAgICAgc2NvcGUucG9zdE1lc3NhZ2UobWVzc2FnZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZhbGxiYWNrRXZlbnRUYXJnZXQuZGlzcGF0Y2hFdmVudCgKICAgICAgICAgICAgbmV3IEN1c3RvbUV2ZW50KCJvZ2MtY2xpZW50LnJlc3BvbnNlIiwgewogICAgICAgICAgICAgIGRldGFpbDogbWVzc2FnZQogICAgICAgICAgICB9KQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICBpZiAodXNlV29ya2VyKSB7CiAgICAgIHNjb3BlLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCAoZXZlbnQpID0+IGV2ZW50SGFuZGxlcihldmVudC5kYXRhKSk7CiAgICB9IGVsc2UgewogICAgICBmYWxsYmFja0V2ZW50VGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICAgIm9nYy1jbGllbnQucmVxdWVzdCIsCiAgICAgICAgKGV2ZW50KSA9PiBldmVudEhhbmRsZXIoZXZlbnQuZGV0YWlsKQogICAgICApOwogICAgfQogIH0KICBjb25zdCBFTkNPRElOR1MgPSBbInV0Zi04IiwgInV0Zi0xNiIsICJpc28tODg1OS0xIl07CiAgY29uc3QgRkFMTEJBQ0tfRU5DT0RJTkcgPSAidXRmLTgiOwogIGZ1bmN0aW9uIGV4dHJhY3RFbmNvZGluZyhjb250ZW50VHlwZSkgewogICAgY29uc3QgbWF0Y2hlcyA9IC9jaGFyc2V0PShbXjtdKykvLmV4ZWMoY29udGVudFR5cGUpOwogICAgcmV0dXJuIG1hdGNoZXMgPyBtYXRjaGVzWzFdIDogbnVsbDsKICB9CiAgZnVuY3Rpb24gZGVjb2RlU3RyaW5nKGJ1ZmZlciwgY29udGVudFR5cGUpIHsKICAgIGNvbnN0IGVuY29kaW5nSGludCA9IGNvbnRlbnRUeXBlID8gZXh0cmFjdEVuY29kaW5nKGNvbnRlbnRUeXBlKSA6IG51bGw7CiAgICBjb25zdCBlbmNvZGluZ0F0dGVtcHRzID0gZW5jb2RpbmdIaW50ID8gW2VuY29kaW5nSGludCwgLi4uRU5DT0RJTkdTXSA6IEVOQ09ESU5HUzsKICAgIGZvciAoY29uc3QgZW5jb2Rpbmcgb2YgZW5jb2RpbmdBdHRlbXB0cykgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmcsIHsgZmF0YWw6IHRydWUgfSk7CiAgICAgICAgcmV0dXJuIGRlY29kZXIuZGVjb2RlKGJ1ZmZlcik7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgfQogICAgfQogICAgY29uc29sZS53YXJuKAogICAgICBgW29nYy1jbGllbnRdIFhNTCBkb2N1bWVudCBlbmNvZGluZyBjb3VsZCBub3QgYmUgZGV0ZXJtaW5lZCwgZmFsbGluZyBiYWNrIHRvICR7RkFMTEJBQ0tfRU5DT0RJTkd9LmAKICAgICk7CiAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKEZBTExCQUNLX0VOQ09ESU5HKS5kZWNvZGUoYnVmZmVyKTsKICB9CiAgY29uc3QgZmV0Y2hQcm9taXNlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgbGV0IGZldGNoT3B0aW9ucyA9IHt9OwogIGZ1bmN0aW9uIHNldEZldGNoT3B0aW9ucyhvcHRpb25zKSB7CiAgICBmZXRjaE9wdGlvbnMgPSBvcHRpb25zOwogIH0KICBmdW5jdGlvbiBnZXRGZXRjaE9wdGlvbnMoKSB7CiAgICByZXR1cm4gZmV0Y2hPcHRpb25zOwogIH0KICBmdW5jdGlvbiBzaGFyZWRGZXRjaCh1cmwsIG1ldGhvZCA9ICJHRVQiLCBhc0pzb24pIHsKICAgIGxldCBmZXRjaEtleSA9IGAke21ldGhvZH0jJHt1cmx9YDsKICAgIGlmIChhc0pzb24pIHsKICAgICAgZmV0Y2hLZXkgPSBgJHttZXRob2R9I2FzSnNvbiMke3VybH1gOwogICAgfQogICAgaWYgKGZldGNoUHJvbWlzZXMuaGFzKGZldGNoS2V5KSkgewogICAgICByZXR1cm4gZmV0Y2hQcm9taXNlcy5nZXQoZmV0Y2hLZXkpOwogICAgfQogICAgY29uc3Qgb3B0aW9ucyA9IHsgLi4uZ2V0RmV0Y2hPcHRpb25zKCkgfTsKICAgIG9wdGlvbnMubWV0aG9kID0gbWV0aG9kOwogICAgaWYgKGFzSnNvbikgewogICAgICBvcHRpb25zLmhlYWRlcnMgPSAiaGVhZGVycyIgaW4gb3B0aW9ucyA/IG9wdGlvbnMuaGVhZGVycyA6IHt9OwogICAgICBvcHRpb25zLmhlYWRlcnNbIkFjY2VwdCJdID0gImFwcGxpY2F0aW9uL2pzb24sYXBwbGljYXRpb24vc2NoZW1hK2pzb24iOwogICAgfQogICAgY29uc3QgcHJvbWlzZSA9IGZldGNoKHVybCwgb3B0aW9ucykuY2F0Y2goKGUpID0+IGUpLnRoZW4oKHJlc3ApID0+IHsKICAgICAgZmV0Y2hQcm9taXNlcy5kZWxldGUoZmV0Y2hLZXkpOwogICAgICByZXR1cm4gcmVzcDsKICAgIH0pOwogICAgZmV0Y2hQcm9taXNlcy5zZXQoZmV0Y2hLZXksIHByb21pc2UpOwogICAgcmV0dXJuIHByb21pc2UudGhlbigocmVzcCkgPT4gewogICAgICBpZiAocmVzcCBpbnN0YW5jZW9mIEVycm9yKQogICAgICAgIHRocm93IHJlc3A7CiAgICAgIHJldHVybiByZXNwLmNsb25lKCk7CiAgICB9KTsKICB9CiAgZnVuY3Rpb24gcXVlcnlYbWxEb2N1bWVudCh1cmwpIHsKICAgIHJldHVybiBzaGFyZWRGZXRjaCh1cmwpLmNhdGNoKAogICAgICAoKSA9PiAoCiAgICAgICAgLy8gYXR0ZW1wdCBhIEhFQUQgdG8gc2VlIGlmIHRoZSBmYWlsdXJlIGNvbWVzIGZyb20gQ09SUyBvciB0aGUgc2VydmljZSBpcyBnZW5lcmFsbHkgdW5yZWFjaGFibGUKICAgICAgICBmZXRjaCh1cmwsIHsgLi4uZ2V0RmV0Y2hPcHRpb25zKCksIG1ldGhvZDogIkhFQUQiLCBtb2RlOiAibm8tY29ycyIgfSkuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICB0aHJvdyBuZXcgRW5kcG9pbnRFcnJvcigKICAgICAgICAgICAgYEZldGNoaW5nIHRoZSBkb2N1bWVudCBmYWlsZWQgZWl0aGVyIGR1ZSB0byBuZXR3b3JrIGVycm9ycyBvciB1bnJlYWNoYWJsZSBob3N0LCBlcnJvciBpczogJHtlcnJvci5tZXNzYWdlfWAsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGZhbHNlCiAgICAgICAgICApOwogICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhyb3cgbmV3IEVuZHBvaW50RXJyb3IoCiAgICAgICAgICAgIGBUaGUgZG9jdW1lbnQgY291bGQgbm90IGJlIGZldGNoZWQgZHVlIHRvIENPUlMgbGltaXRhdGlvbnNgLAogICAgICAgICAgICAwLAogICAgICAgICAgICB0cnVlCiAgICAgICAgICApOwogICAgICAgIH0pCiAgICAgICkKICAgICkudGhlbihhc3luYyAocmVzcCkgPT4gewogICAgICBpZiAoIXJlc3Aub2spIHsKICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcC50ZXh0KCk7CiAgICAgICAgdGhyb3cgbmV3IEVuZHBvaW50RXJyb3IoCiAgICAgICAgICBgUmVjZWl2ZWQgYW4gZXJyb3Igd2l0aCBjb2RlICR7cmVzcC5zdGF0dXN9OiAke3RleHR9YCwKICAgICAgICAgIHJlc3Auc3RhdHVzLAogICAgICAgICAgZmFsc2UKICAgICAgICApOwogICAgICB9CiAgICAgIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IHJlc3AuYXJyYXlCdWZmZXIoKTsKICAgICAgY29uc3QgY29udGVudFR5cGVIZWFkZXIgPSByZXNwLmhlYWRlcnMuZ2V0KCJDb250ZW50LVR5cGUiKTsKICAgICAgcmV0dXJuIGRlY29kZVN0cmluZyhidWZmZXIsIGNvbnRlbnRUeXBlSGVhZGVyKTsKICAgIH0pLnRoZW4oKHhtbCkgPT4gcGFyc2VYbWxTdHJpbmcoeG1sKSk7CiAgfQogIGZ1bmN0aW9uIHNldFF1ZXJ5UGFyYW1zKHVybCwgcGFyYW1zKSB7CiAgICBjb25zdCBlbmNvZGVkVXJsTWF0Y2ggPSB1cmwubWF0Y2goLyhodHRwcz8lM0ElMkYlMkZbXi9dKykkLyk7CiAgICBpZiAoZW5jb2RlZFVybE1hdGNoKSB7CiAgICAgIGNvbnN0IGVuY29kZWRVcmwgPSBlbmNvZGVkVXJsTWF0Y2hbMV07CiAgICAgIGNvbnN0IG1vZGlmaWVkVXJsID0gc2V0UXVlcnlQYXJhbXMoZGVjb2RlVVJJQ29tcG9uZW50KGVuY29kZWRVcmwpLCBwYXJhbXMpOwogICAgICByZXR1cm4gdXJsLnJlcGxhY2UoZW5jb2RlZFVybCwgZW5jb2RlVVJJQ29tcG9uZW50KG1vZGlmaWVkVXJsKSk7CiAgICB9CiAgICBjb25zdCB1cmxPYmogPSBuZXcgVVJMKHVybCk7CiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocGFyYW1zKTsKICAgIGNvbnN0IGtleXNMb3dlciA9IGtleXMubWFwKChrZXkpID0+IGtleS50b0xvd2VyQ2FzZSgpKTsKICAgIGNvbnN0IHRvRGVsZXRlID0gW107CiAgICBmb3IgKGNvbnN0IHBhcmFtIG9mIHVybE9iai5zZWFyY2hQYXJhbXMua2V5cygpKSB7CiAgICAgIGlmIChrZXlzTG93ZXIuaW5kZXhPZihwYXJhbS50b0xvd2VyQ2FzZSgpKSA+IC0xKSB7CiAgICAgICAgdG9EZWxldGUucHVzaChwYXJhbSk7CiAgICAgIH0KICAgIH0KICAgIHRvRGVsZXRlLm1hcCgocGFyYW0pID0+IHVybE9iai5zZWFyY2hQYXJhbXMuZGVsZXRlKHBhcmFtKSk7CiAgICBrZXlzLmZvckVhY2goCiAgICAgIChrZXkpID0+IHVybE9iai5zZWFyY2hQYXJhbXMuc2V0KAogICAgICAgIGtleSwKICAgICAgICBwYXJhbXNba2V5XSA9PT0gdHJ1ZSA/ICIiIDogcGFyYW1zW2tleV0KICAgICAgKQogICAgKTsKICAgIHJldHVybiB1cmxPYmoudG9TdHJpbmcoKTsKICB9CiAgY29uc3QgTGF0TG9uQ3JzTGlzdCA9IFsKICAgICJFUFNHOjQwNDYiLAogICAgLy8gUkdSREMgMjAwNQogICAgIkVQU0c6NDA3NSIsCiAgICAvLyBTUkVGOTgKICAgICJFUFNHOjQxMjAiLAogICAgLy8gR3JlZWsKICAgICJFUFNHOjQxMjIiLAogICAgLy8gQVRTNzcKICAgICJFUFNHOjQxMjQiLAogICAgLy8gUlQ5MAogICAgIkVQU0c6NDEyNiIsCiAgICAvLyBMS1M5NCAoRVRSUzg5KQogICAgIkVQU0c6NDE0OSIsCiAgICAvLyBDSDE5MDMKICAgICJFUFNHOjQxNTEiLAogICAgLy8gQ0hUUkY5NQogICAgIkVQU0c6NDE1MyIsCiAgICAvLyBSYXNzYWRpcmFuCiAgICAiRVBTRzo0MTU1IiwKICAgIC8vIERhYm9sYSAxOTgxCiAgICAiRVBTRzo0MTU3IiwKICAgIC8vIE1vdW50IERpbGxvbgogICAgIkVQU0c6NDE1OSIsCiAgICAvLyBFTEQ3OQogICAgIkVQU0c6NDE2MSIsCiAgICAvLyBQYW1wYSBkZWwgQ2FzdGlsbG8KICAgICJFUFNHOjQxNjMiLAogICAgLy8gWWVtZW4gTkdOOTYKICAgICJFUFNHOjQxNjUiLAogICAgLy8gQmlzc2F1CiAgICAiRVBTRzo0MTY3IiwKICAgIC8vIE5aR0QyMDAwCiAgICAiRVBTRzo0MTY5IiwKICAgIC8vIEFtZXJpY2FuIFNhbW9hIDE5NjIKICAgICJFUFNHOjQxNzEiLAogICAgLy8gUkdGOTMKICAgICJFUFNHOjQxNzMiLAogICAgLy8gSVJFTkVUOTUKICAgICJFUFNHOjQxNzUiLAogICAgLy8gU2llcnJhIExlb25lIDE5NjgKICAgICJFUFNHOjQxNzgiLAogICAgLy8gUHVsa292byAxOTQyKDgzKQogICAgIkVQU0c6NDE4MCIsCiAgICAvLyBFU1Q5NwogICAgIkVQU0c6NDE4MiIsCiAgICAvLyBBem9yZXMgT2NjaWRlbnRhbCAxOTM5CiAgICAiRVBTRzo0MTg0IiwKICAgIC8vIEF6b3JlcyBPcmllbnRhbCAxOTQwCiAgICAiRVBTRzo0MTg4IiwKICAgIC8vIE9TTkkgMTk1MgogICAgIkVQU0c6NDE5MCIsCiAgICAvLyBQT1NHQVIgOTgKICAgICJFUFNHOjQxOTEiLAogICAgLy8gQWxiYW5pYW4gMTk4NwogICAgIkVQU0c6NDE5NiIsCiAgICAvLyBBbW1hc3NhbGlrIDE5NTgKICAgICJFUFNHOjQxOTgiLAogICAgLy8gS291c3NlcmkKICAgICJFUFNHOjQyMDIiLAogICAgLy8gQUdENjYKICAgICJFUFNHOjQyMTAiLAogICAgLy8gQXJjIDE5NjAKICAgICJFUFNHOjQyMTEiLAogICAgLy8gQmF0YXZpYQogICAgIkVQU0c6NDIxNCIsCiAgICAvLyBCZWlqaW5nIDE5NTQKICAgICJFUFNHOjQyMjYiLAogICAgLy8gQ290ZSBkJ0l2b2lyZQogICAgIkVQU0c6NDIyOSIsCiAgICAvLyBFZ3lwdCAxOTA3CiAgICAiRVBTRzo0MjMxIiwKICAgIC8vIEVEODcKICAgICJFUFNHOjQyMzMiLAogICAgLy8gR2FuZGFqaWthIDE5NzAKICAgICJFUFNHOjQyMzYiLAogICAgLy8gSHUgVHp1IFNoYW4gMTk1MAogICAgIkVQU0c6NDIzOCIsCiAgICAvLyBJRDc0CiAgICAiRVBTRzo0MjQwIiwKICAgIC8vIEluZGlhbiAxOTc1CiAgICAiRVBTRzo0MjQyIiwKICAgIC8vIEpBRDY5CiAgICAiRVBTRzo0MjQ0IiwKICAgIC8vIEthbmRhd2FsYQogICAgIkVQU0c6NDI0NiIsCiAgICAvLyBLT0MKICAgICJFUFNHOjQyNDgiLAogICAgLy8gUFNBRDU2CiAgICAiRVBTRzo0MjUwIiwKICAgIC8vIExlaWdvbgogICAgIkVQU0c6NDI1MiIsCiAgICAvLyBMb21lCiAgICAiRVBTRzo0MjU1IiwKICAgIC8vIEhlcmF0IE5vcnRoCiAgICAiRVBTRzo0MjU4IiwKICAgIC8vIEVUUlM4OQogICAgIkVQU0c6NDI2MSIsCiAgICAvLyBNZXJjaGljaAogICAgIkVQU0c6NDI2NCIsCiAgICAvLyBNaGFzdAogICAgIkVQU0c6NDI2NyIsCiAgICAvLyBOQUQyNwogICAgIkVQU0c6NDI3MCIsCiAgICAvLyBOYWhyd2FuIDE5NjcKICAgICJFUFNHOjQyNzMiLAogICAgLy8gTkdPIDE5NDgKICAgICJFUFNHOjQyNzYiLAogICAgLy8gTlNXQyA5Wi0yCiAgICAiRVBTRzo0Mjc5IiwKICAgIC8vIE9TKFNOKTgwCiAgICAiRVBTRzo0MjgxIiwKICAgIC8vIFBhbGVzdGluZSAxOTIzCiAgICAiRVBTRzo0Mjg0IiwKICAgIC8vIFB1bGtvdm8gMTk0MgogICAgIkVQU0c6NDI4NiIsCiAgICAvLyBRYXRhciAxOTQ4CiAgICAiRVBTRzo0Mjg4IiwKICAgIC8vIExvbWEgUXVpbnRhbmEKICAgICJFUFNHOjQyOTIiLAogICAgLy8gU2FwcGVyIEhpbGwgMTk0MwogICAgIkVQU0c6NDI5NSIsCiAgICAvLyBTZXJpbmR1bmcKICAgICJFUFNHOjQyOTciLAogICAgLy8gVGFuYW5hcml2ZQogICAgIkVQU0c6NDI5OSIsCiAgICAvLyBUTTY1CiAgICAiRVBTRzo0MzAyIiwKICAgIC8vIFRyaW5pZGFkIDE5MDMKICAgICJFUFNHOjQzMjQiLAogICAgLy8gV0dTIDcyQkUKICAgICJFUFNHOjQzMjYiCiAgICAvLyBXR1MgODQKICBdOwogIGZ1bmN0aW9uIGhhc0ludmVydGVkQ29vcmRpbmF0ZXMoY3JzTmFtZSkgewogICAgcmV0dXJuIExhdExvbkNyc0xpc3QuaW5kZXhPZihzaW1wbGlmeUVwc2dVcm4oY3JzTmFtZSkpID4gLTE7CiAgfQogIGZ1bmN0aW9uIHNpbXBsaWZ5RXBzZ1VybihmdWxsQ3JzTmFtZSkgewogICAgaWYgKC9edXJuOig/OngtKT9vZ2M6ZGVmOmNyczplcHNnOi8udGVzdChmdWxsQ3JzTmFtZS50b0xvd2VyQ2FzZSgpKSkgewogICAgICBjb25zdCBjb2RlID0gLyhbMC05XSspJC8uZXhlYyhmdWxsQ3JzTmFtZSlbMV07CiAgICAgIHJldHVybiBgRVBTRzoke2NvZGV9YDsKICAgIH0KICAgIHJldHVybiBmdWxsQ3JzTmFtZTsKICB9CiAgZnVuY3Rpb24gcmVhZE9wZXJhdGlvblVybHNGcm9tQ2FwYWJpbGl0aWVzJDEoY2FwYWJpbGl0aWVzRG9jKSB7CiAgICBjb25zdCB1cmxzID0ge307CiAgICBjb25zdCBjYXBhYmlsaXR5ID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwKICAgICAgIkNhcGFiaWxpdHkiCiAgICApOwogICAgY29uc3QgcmVxdWVzdCA9IGZpbmRDaGlsZEVsZW1lbnQoY2FwYWJpbGl0eSwgIlJlcXVlc3QiKTsKICAgIGdldENoaWxkcmVuRWxlbWVudChyZXF1ZXN0KS5mb3JFYWNoKChvcGVyYXRpb24pID0+IHsKICAgICAgY29uc3Qgb3BlcmF0aW9uTmFtZSA9IHN0cmlwTmFtZXNwYWNlKGdldEVsZW1lbnROYW1lKG9wZXJhdGlvbikpOwogICAgICB1cmxzW29wZXJhdGlvbk5hbWVdID0gcGFyc2VPcGVyYXRpb24ob3BlcmF0aW9uKTsKICAgIH0pOwogICAgcmV0dXJuIHVybHM7CiAgfQogIGZ1bmN0aW9uIHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyQxKGNhcGFiaWxpdGllc0RvYykgewogICAgcmV0dXJuIGdldFJvb3RFbGVtZW50KGNhcGFiaWxpdGllc0RvYykuYXR0cmlidXRlc1sidmVyc2lvbiJdOwogIH0KICBmdW5jdGlvbiByZWFkTGF5ZXJzRnJvbUNhcGFiaWxpdGllcyQxKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3QgdmVyc2lvbiA9IHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyQxKGNhcGFiaWxpdGllc0RvYyk7CiAgICBjb25zdCBjYXBhYmlsaXR5ID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwKICAgICAgIkNhcGFiaWxpdHkiCiAgICApOwogICAgcmV0dXJuIGZpbmRDaGlsZHJlbkVsZW1lbnQoY2FwYWJpbGl0eSwgIkxheWVyIikubWFwKAogICAgICAobGF5ZXJFbCkgPT4gcGFyc2VMYXllcihsYXllckVsLCB2ZXJzaW9uKQogICAgKTsKICB9CiAgZnVuY3Rpb24gcmVhZE91dHB1dEZvcm1hdHNGcm9tQ2FwYWJpbGl0aWVzJDEoY2FwYWJpbGl0aWVzRG9jKSB7CiAgICBjb25zdCBjYXBhYmlsaXR5ID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwKICAgICAgIkNhcGFiaWxpdHkiCiAgICApOwogICAgY29uc3QgZ2V0TWFwID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgZmluZENoaWxkRWxlbWVudChjYXBhYmlsaXR5LCAiUmVxdWVzdCIpLAogICAgICAiR2V0TWFwIgogICAgKTsKICAgIGNvbnN0IG91dHB1dEZvcm1hdHMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGdldE1hcCwgIkZvcm1hdCIpLm1hcCgKICAgICAgZ2V0RWxlbWVudFRleHQKICAgICk7CiAgICByZXR1cm4gb3V0cHV0Rm9ybWF0czsKICB9CiAgZnVuY3Rpb24gcmVhZEluZm9Gb3JtYXRzRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpIHsKICAgIGNvbnN0IGNhcGFiaWxpdHkgPSBmaW5kQ2hpbGRFbGVtZW50KAogICAgICBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLAogICAgICAiQ2FwYWJpbGl0eSIKICAgICk7CiAgICBjb25zdCBnZXRGZWF0dXJlSW5mbyA9IGZpbmRDaGlsZEVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQoY2FwYWJpbGl0eSwgIlJlcXVlc3QiKSwKICAgICAgIkdldEZlYXR1cmVJbmZvIgogICAgKTsKICAgIGNvbnN0IG91dHB1dEZvcm1hdHMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGdldEZlYXR1cmVJbmZvLCAiRm9ybWF0IikubWFwKAogICAgICBnZXRFbGVtZW50VGV4dAogICAgKTsKICAgIHJldHVybiBvdXRwdXRGb3JtYXRzOwogIH0KICBmdW5jdGlvbiByZWFkRXhjZXB0aW9uRm9ybWF0c0Zyb21DYXBhYmlsaXRpZXMoY2FwYWJpbGl0aWVzRG9jKSB7CiAgICBjb25zdCBjYXBhYmlsaXR5ID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwKICAgICAgIkNhcGFiaWxpdHkiCiAgICApOwogICAgY29uc3QgZXhjZXB0aW9uID0gZmluZENoaWxkRWxlbWVudChjYXBhYmlsaXR5LCAiRXhjZXB0aW9uIik7CiAgICBjb25zdCBleGNlcHRpb25Gb3JtYXRzID0gZmluZENoaWxkcmVuRWxlbWVudChleGNlcHRpb24sICJGb3JtYXQiKS5tYXAoCiAgICAgIGdldEVsZW1lbnRUZXh0CiAgICApOwogICAgcmV0dXJuIGV4Y2VwdGlvbkZvcm1hdHM7CiAgfQogIGZ1bmN0aW9uIHJlYWRJbmZvRnJvbUNhcGFiaWxpdGllcyQyKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3Qgc2VydmljZSA9IGZpbmRDaGlsZEVsZW1lbnQoZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwgIlNlcnZpY2UiKTsKICAgIGNvbnN0IG91dHB1dEZvcm1hdHMgPSByZWFkT3V0cHV0Rm9ybWF0c0Zyb21DYXBhYmlsaXRpZXMkMShjYXBhYmlsaXRpZXNEb2MpOwogICAgY29uc3QgaW5mb0Zvcm1hdHMgPSByZWFkSW5mb0Zvcm1hdHNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYyk7CiAgICBjb25zdCBleGNlcHRpb25Gb3JtYXRzID0gcmVhZEV4Y2VwdGlvbkZvcm1hdHNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYyk7CiAgICBjb25zdCBrZXl3b3JkcyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIktleXdvcmRMaXN0IiksCiAgICAgICJLZXl3b3JkIgogICAgKS5tYXAoZ2V0RWxlbWVudFRleHQpLmZpbHRlcigodiwgaSwgYXJyKSA9PiBhcnIuaW5kZXhPZih2KSA9PT0gaSk7CiAgICBjb25zdCBwcm92aWRlciA9IHJlYWRQcm92aWRlckZyb21DYXBhYmlsaXRpZXMkMShjYXBhYmlsaXRpZXNEb2MpOwogICAgcmV0dXJuIHsKICAgICAgdGl0bGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIlRpdGxlIikpLAogICAgICBuYW1lOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJOYW1lIikpLAogICAgICBhYnN0cmFjdDogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzZXJ2aWNlLCAiQWJzdHJhY3QiKSksCiAgICAgIG91dHB1dEZvcm1hdHMsCiAgICAgIGluZm9Gb3JtYXRzLAogICAgICBleGNlcHRpb25Gb3JtYXRzLAogICAgICBmZWVzOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJGZWVzIikpLAogICAgICBjb25zdHJhaW50czogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzZXJ2aWNlLCAiQWNjZXNzQ29uc3RyYWludHMiKSksCiAgICAgIHByb3ZpZGVyLAogICAgICBrZXl3b3JkcwogICAgfTsKICB9CiAgZnVuY3Rpb24gcGFyc2VPcGVyYXRpb24ob3BlcmF0aW9uKSB7CiAgICBjb25zdCB1cmxzID0ge307CiAgICBjb25zdCBkY3BUeXBlID0gZmluZENoaWxkcmVuRWxlbWVudChvcGVyYXRpb24sICJEQ1BUeXBlIik7CiAgICBjb25zdCBodHRwID0gZGNwVHlwZS5mbGF0TWFwKChkKSA9PiBmaW5kQ2hpbGRFbGVtZW50KGQsICJIVFRQIikpOwogICAgY29uc3QgbWV0aG9kcyA9IGh0dHAuZmxhdE1hcCgoaCkgPT4gZ2V0Q2hpbGRyZW5FbGVtZW50KGgpKTsKICAgIG1ldGhvZHMuZm9yRWFjaCgobWV0aG9kKSA9PiB7CiAgICAgIGNvbnN0IG9ubGluZVJlc291cmNlID0gZmluZENoaWxkRWxlbWVudChtZXRob2QsICJPbmxpbmVSZXNvdXJjZSIpOwogICAgICBjb25zdCBtZXRob2ROYW1lID0gc3RyaXBOYW1lc3BhY2UoZ2V0RWxlbWVudE5hbWUobWV0aG9kKSk7CiAgICAgIHVybHNbbWV0aG9kTmFtZV0gPSBnZXRFbGVtZW50QXR0cmlidXRlKG9ubGluZVJlc291cmNlLCAieGxpbms6aHJlZiIpOwogICAgfSk7CiAgICByZXR1cm4gdXJsczsKICB9CiAgZnVuY3Rpb24gcGFyc2VMYXllcihsYXllckVsLCB2ZXJzaW9uLCBpbmhlcml0ZWRTcnMgPSBbXSwgaW5oZXJpdGVkU3R5bGVzID0gW10sIGluaGVyaXRlZEF0dHJpYnV0aW9uID0gbnVsbCwgaW5oZXJpdGVkQm91bmRpbmdCb3hlcyA9IG51bGwsIGluaGVyaXRlZE1heFNjYWxlRGVub20gPSBudWxsLCBpbmhlcml0ZWRNaW5TY2FsZURlbm9tID0gbnVsbCkgewogICAgY29uc3Qgc3JzVGFnID0gdmVyc2lvbiA9PT0gIjEuMy4wIiA/ICJDUlMiIDogIlNSUyI7CiAgICBjb25zdCBzcnNMaXN0ID0gZmluZENoaWxkcmVuRWxlbWVudChsYXllckVsLCBzcnNUYWcpLm1hcChnZXRFbGVtZW50VGV4dCk7CiAgICBjb25zdCBhdmFpbGFibGVDcnMgPSBzcnNMaXN0Lmxlbmd0aCA+IDAgPyBzcnNMaXN0IDogaW5oZXJpdGVkU3JzOwogICAgY29uc3QgbGF5ZXJTdHlsZXMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGxheWVyRWwsICJTdHlsZSIpLm1hcCgKICAgICAgcGFyc2VMYXllclN0eWxlCiAgICApOwogICAgY29uc3Qgc3R5bGVzID0gbGF5ZXJTdHlsZXMubGVuZ3RoID4gMCA/IGxheWVyU3R5bGVzIDogaW5oZXJpdGVkU3R5bGVzOwogICAgZnVuY3Rpb24gcGFyc2VCQm94MihiYm94RWwpIHsKICAgICAgY29uc3Qgc3JzID0gZ2V0RWxlbWVudEF0dHJpYnV0ZShiYm94RWwsIHNyc1RhZyk7CiAgICAgIGNvbnN0IGF0dHJzID0gaGFzSW52ZXJ0ZWRDb29yZGluYXRlcyhzcnMpICYmIHZlcnNpb24gPT09ICIxLjMuMCIgPyBbIm1pbnkiLCAibWlueCIsICJtYXh5IiwgIm1heHgiXSA6IFsibWlueCIsICJtaW55IiwgIm1heHgiLCAibWF4eSJdOwogICAgICByZXR1cm4gYXR0cnMubWFwKChuYW1lKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGJib3hFbCwgbmFtZSkpOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VFeEdlb2dyYXBoaWNCb3VuZGluZ0JveChiYm94RWwpIHsKICAgICAgcmV0dXJuIFsKICAgICAgICAid2VzdEJvdW5kTG9uZ2l0dWRlIiwKICAgICAgICAic291dGhCb3VuZExhdGl0dWRlIiwKICAgICAgICAiZWFzdEJvdW5kTG9uZ2l0dWRlIiwKICAgICAgICAibm9ydGhCb3VuZExhdGl0dWRlIgogICAgICBdLm1hcCgobmFtZSkgPT4gZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChiYm94RWwsIG5hbWUpKSk7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZUxhdExvbkJvdW5kaW5nQm94KGJib3hFbCkgewogICAgICByZXR1cm4gWyJtaW54IiwgIm1pbnkiLCAibWF4eCIsICJtYXh5Il0ubWFwKAogICAgICAgIChuYW1lKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGJib3hFbCwgbmFtZSkKICAgICAgKTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlU2NhbGVIaW50VmFsdWUodGV4dFZhbHVlLCBkZWZhdWx0VmFsdWUpIHsKICAgICAgaWYgKHRleHRWYWx1ZSA9PT0gIiIpIHsKICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogICAgICB9CiAgICAgIHJldHVybiBNYXRoLnNxcnQoMC41ICogcGFyc2VGbG9hdCh0ZXh0VmFsdWUpICoqIDIpIC8gMjhlLTU7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZVNjYWxlSGludCgpIHsKICAgICAgY29uc3Qgc2NhbGVIaW50ID0gZmluZENoaWxkRWxlbWVudChsYXllckVsLCAiU2NhbGVIaW50Iik7CiAgICAgIGlmICghc2NhbGVIaW50KSB7CiAgICAgICAgcmV0dXJuIFtpbmhlcml0ZWRNaW5TY2FsZURlbm9tLCBpbmhlcml0ZWRNYXhTY2FsZURlbm9tXTsKICAgICAgfQogICAgICBjb25zdCBtaW4gPSBnZXRFbGVtZW50QXR0cmlidXRlKHNjYWxlSGludCwgIm1pbiIpOwogICAgICBjb25zdCBtYXggPSBnZXRFbGVtZW50QXR0cmlidXRlKHNjYWxlSGludCwgIm1heCIpOwogICAgICByZXR1cm4gWwogICAgICAgIHBhcnNlU2NhbGVIaW50VmFsdWUobWluLCBpbmhlcml0ZWRNaW5TY2FsZURlbm9tKSwKICAgICAgICBwYXJzZVNjYWxlSGludFZhbHVlKG1heCwgaW5oZXJpdGVkTWF4U2NhbGVEZW5vbSkKICAgICAgXTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlU2NhbGVEZW5vbWluYXRvcihuYW1lLCBpbmhlcml0ZWRWYWx1ZSkgewogICAgICBjb25zdCB0ZXh0VmFsdWUgPSBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGxheWVyRWwsIG5hbWUpKTsKICAgICAgcmV0dXJuIHRleHRWYWx1ZSA9PT0gIiIgPyBpbmhlcml0ZWRWYWx1ZSA6IHBhcnNlRmxvYXQodGV4dFZhbHVlKTsKICAgIH0KICAgIGNvbnN0IGF0dHJpYnV0aW9uRWwgPSBmaW5kQ2hpbGRFbGVtZW50KGxheWVyRWwsICJBdHRyaWJ1dGlvbiIpOwogICAgY29uc3QgYXR0cmlidXRpb24gPSBhdHRyaWJ1dGlvbkVsICE9PSBudWxsID8gcGFyc2VMYXllckF0dHJpYnV0aW9uKGF0dHJpYnV0aW9uRWwpIDogaW5oZXJpdGVkQXR0cmlidXRpb247CiAgICBjb25zdCBsYXRMb25CYm94RWwgPSB2ZXJzaW9uID09PSAiMS4zLjAiID8gZmluZENoaWxkRWxlbWVudChsYXllckVsLCAiRVhfR2VvZ3JhcGhpY0JvdW5kaW5nQm94IikgOiBmaW5kQ2hpbGRFbGVtZW50KGxheWVyRWwsICJMYXRMb25Cb3VuZGluZ0JveCIpOwogICAgY29uc3QgYmFzZUJvdW5kaW5nQm94ID0ge307CiAgICBpZiAobGF0TG9uQmJveEVsKSB7CiAgICAgIGJhc2VCb3VuZGluZ0JveFsiRVBTRzo0MzI2Il0gPSB2ZXJzaW9uID09PSAiMS4zLjAiID8gcGFyc2VFeEdlb2dyYXBoaWNCb3VuZGluZ0JveChsYXRMb25CYm94RWwpIDogcGFyc2VMYXRMb25Cb3VuZGluZ0JveChsYXRMb25CYm94RWwpOwogICAgfQogICAgbGV0IGJvdW5kaW5nQm94ZXMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGxheWVyRWwsICJCb3VuZGluZ0JveCIpLnJlZHVjZSgKICAgICAgKHByZXYsIGJib3hFbCkgPT4gKHsKICAgICAgICAuLi5wcmV2LAogICAgICAgIFtnZXRFbGVtZW50QXR0cmlidXRlKGJib3hFbCwgc3JzVGFnKV06IHBhcnNlQkJveDIoYmJveEVsKQogICAgICB9KSwKICAgICAgYmFzZUJvdW5kaW5nQm94CiAgICApOwogICAgYm91bmRpbmdCb3hlcyA9IE9iamVjdC5rZXlzKGJvdW5kaW5nQm94ZXMpLmxlbmd0aCA+IDAgfHwgaW5oZXJpdGVkQm91bmRpbmdCb3hlcyA9PT0gbnVsbCA/IGJvdW5kaW5nQm94ZXMgOiBpbmhlcml0ZWRCb3VuZGluZ0JveGVzOwogICAgY29uc3QgcXVlcnlhYmxlID0gbGF5ZXJFbC5hdHRyaWJ1dGVzLnF1ZXJ5YWJsZSA9PT0gIjEiIHx8IGxheWVyRWwuYXR0cmlidXRlcy5xdWVyeWFibGUgPT09ICJ0cnVlIiA/IHRydWUgOiBmYWxzZTsKICAgIGNvbnN0IG9wYXF1ZSA9IGxheWVyRWwuYXR0cmlidXRlcy5vcGFxdWUgPT09ICIxIiB8fCBsYXllckVsLmF0dHJpYnV0ZXMub3BhcXVlID09PSAidHJ1ZSIgPyB0cnVlIDogZmFsc2U7CiAgICBjb25zdCBrZXl3b3JkcyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQobGF5ZXJFbCwgIktleXdvcmRMaXN0IiksCiAgICAgICJLZXl3b3JkIgogICAgKS5tYXAoZ2V0RWxlbWVudFRleHQpLmZpbHRlcigodiwgaSwgYXJyKSA9PiBhcnIuaW5kZXhPZih2KSA9PT0gaSk7CiAgICBsZXQgbWluU2NhbGVEZW5vbWluYXRvciwgbWF4U2NhbGVEZW5vbWluYXRvcjsKICAgIGlmICh2ZXJzaW9uID09PSAiMS4zLjAiKSB7CiAgICAgIG1pblNjYWxlRGVub21pbmF0b3IgPSBwYXJzZVNjYWxlRGVub21pbmF0b3IoCiAgICAgICAgIk1pblNjYWxlRGVub21pbmF0b3IiLAogICAgICAgIGluaGVyaXRlZE1pblNjYWxlRGVub20KICAgICAgKTsKICAgICAgbWF4U2NhbGVEZW5vbWluYXRvciA9IHBhcnNlU2NhbGVEZW5vbWluYXRvcigKICAgICAgICAiTWF4U2NhbGVEZW5vbWluYXRvciIsCiAgICAgICAgaW5oZXJpdGVkTWF4U2NhbGVEZW5vbQogICAgICApOwogICAgfSBlbHNlIHsKICAgICAgW21pblNjYWxlRGVub21pbmF0b3IsIG1heFNjYWxlRGVub21pbmF0b3JdID0gcGFyc2VTY2FsZUhpbnQoKTsKICAgIH0KICAgIGNvbnN0IG1ldGFkYXRhID0gZmluZENoaWxkcmVuRWxlbWVudChsYXllckVsLCAiTWV0YWRhdGFVUkwiKS5tYXAoCiAgICAgIChtZXRhZGF0YVVybEVsKSA9PiAoewogICAgICAgIHR5cGU6IGdldEVsZW1lbnRBdHRyaWJ1dGUobWV0YWRhdGFVcmxFbCwgInR5cGUiKSwKICAgICAgICBmb3JtYXQ6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQobWV0YWRhdGFVcmxFbCwgIkZvcm1hdCIpKSwKICAgICAgICB1cmw6IGdldEVsZW1lbnRBdHRyaWJ1dGUoCiAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KG1ldGFkYXRhVXJsRWwsICJPbmxpbmVSZXNvdXJjZSIpLAogICAgICAgICAgInhsaW5rOmhyZWYiCiAgICAgICAgKQogICAgICB9KQogICAgKTsKICAgIGNvbnN0IGNoaWxkcmVuID0gZmluZENoaWxkcmVuRWxlbWVudChsYXllckVsLCAiTGF5ZXIiKS5tYXAoCiAgICAgIChsYXllcikgPT4gcGFyc2VMYXllcigKICAgICAgICBsYXllciwKICAgICAgICB2ZXJzaW9uLAogICAgICAgIGF2YWlsYWJsZUNycywKICAgICAgICBzdHlsZXMsCiAgICAgICAgYXR0cmlidXRpb24sCiAgICAgICAgYm91bmRpbmdCb3hlcywKICAgICAgICBtYXhTY2FsZURlbm9taW5hdG9yLAogICAgICAgIG1pblNjYWxlRGVub21pbmF0b3IKICAgICAgKQogICAgKTsKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQobGF5ZXJFbCwgIk5hbWUiKSksCiAgICAgIHRpdGxlOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGxheWVyRWwsICJUaXRsZSIpKSwKICAgICAgYWJzdHJhY3Q6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQobGF5ZXJFbCwgIkFic3RyYWN0IikpLAogICAgICBhdmFpbGFibGVDcnMsCiAgICAgIHN0eWxlcywKICAgICAgYXR0cmlidXRpb24sCiAgICAgIGJvdW5kaW5nQm94ZXMsCiAgICAgIGtleXdvcmRzLAogICAgICBxdWVyeWFibGUsCiAgICAgIG9wYXF1ZSwKICAgICAgLi4ubWluU2NhbGVEZW5vbWluYXRvciAhPT0gbnVsbCA/IHsgbWluU2NhbGVEZW5vbWluYXRvciB9IDoge30sCiAgICAgIC4uLm1heFNjYWxlRGVub21pbmF0b3IgIT09IG51bGwgPyB7IG1heFNjYWxlRGVub21pbmF0b3IgfSA6IHt9LAogICAgICAuLi5tZXRhZGF0YS5sZW5ndGggJiYgeyBtZXRhZGF0YSB9LAogICAgICAuLi5jaGlsZHJlbi5sZW5ndGggJiYgeyBjaGlsZHJlbiB9CiAgICB9OwogIH0KICBmdW5jdGlvbiBwYXJzZUxheWVyU3R5bGUoc3R5bGVFbCkgewogICAgY29uc3QgbGVnZW5kVXJsID0gZ2V0RWxlbWVudEF0dHJpYnV0ZSgKICAgICAgZmluZENoaWxkRWxlbWVudChmaW5kQ2hpbGRFbGVtZW50KHN0eWxlRWwsICJMZWdlbmRVUkwiKSwgIk9ubGluZVJlc291cmNlIiksCiAgICAgICJ4bGluazpocmVmIgogICAgKTsKICAgIGNvbnN0IGFic3RyYWN0ID0gZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzdHlsZUVsLCAiQWJzdHJhY3QiKSk7CiAgICByZXR1cm4gewogICAgICBuYW1lOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHN0eWxlRWwsICJOYW1lIikpLAogICAgICB0aXRsZTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzdHlsZUVsLCAiVGl0bGUiKSksCiAgICAgIC4uLmFic3RyYWN0ICYmIHsgYWJzdHJhY3QgfSwKICAgICAgLi4ubGVnZW5kVXJsICYmIHsgbGVnZW5kVXJsIH0KICAgIH07CiAgfQogIGZ1bmN0aW9uIHBhcnNlTGF5ZXJBdHRyaWJ1dGlvbihhdHRyaWJ1dGlvbkVsKSB7CiAgICBjb25zdCBsb2dvVXJsID0gZ2V0RWxlbWVudEF0dHJpYnV0ZSgKICAgICAgZmluZENoaWxkRWxlbWVudCgKICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGF0dHJpYnV0aW9uRWwsICJMb2dvVVJMIiksCiAgICAgICAgIk9ubGluZVJlc291cmNlIgogICAgICApLAogICAgICAieGxpbms6aHJlZiIKICAgICk7CiAgICBjb25zdCB1cmwgPSBnZXRFbGVtZW50QXR0cmlidXRlKAogICAgICBmaW5kQ2hpbGRFbGVtZW50KGF0dHJpYnV0aW9uRWwsICJPbmxpbmVSZXNvdXJjZSIpLAogICAgICAieGxpbms6aHJlZiIKICAgICk7CiAgICBjb25zdCB0aXRsZSA9IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoYXR0cmlidXRpb25FbCwgIlRpdGxlIikpOwogICAgcmV0dXJuIHsKICAgICAgLi4udGl0bGUgJiYgeyB0aXRsZSB9LAogICAgICAuLi51cmwgJiYgeyB1cmwgfSwKICAgICAgLi4ubG9nb1VybCAmJiB7IGxvZ29VcmwgfQogICAgfTsKICB9CiAgZnVuY3Rpb24gcmVhZFByb3ZpZGVyRnJvbUNhcGFiaWxpdGllcyQxKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3Qgc2VydmljZSA9IGZpbmRDaGlsZEVsZW1lbnQoZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwgIlNlcnZpY2UiKTsKICAgIGNvbnN0IGNvbnRhY3RJbmZvcm1hdGlvbiA9IGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIkNvbnRhY3RJbmZvcm1hdGlvbiIpOwogICAgY29uc3QgY29udGFjdFBlcnNvblByaW1hcnkgPSBmaW5kQ2hpbGRFbGVtZW50KAogICAgICBjb250YWN0SW5mb3JtYXRpb24sCiAgICAgICJDb250YWN0UGVyc29uUHJpbWFyeSIKICAgICk7CiAgICBjb25zdCBhZGRyZXNzID0gZmluZENoaWxkRWxlbWVudChjb250YWN0SW5mb3JtYXRpb24sICJDb250YWN0QWRkcmVzcyIpOwogICAgcmV0dXJuIHsKICAgICAgY29udGFjdDogewogICAgICAgIG5hbWU6IGdldEVsZW1lbnRUZXh0KAogICAgICAgICAgZmluZENoaWxkRWxlbWVudChjb250YWN0UGVyc29uUHJpbWFyeSwgIkNvbnRhY3RQZXJzb24iKQogICAgICAgICksCiAgICAgICAgb3JnYW5pemF0aW9uOiBnZXRFbGVtZW50VGV4dCgKICAgICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoY29udGFjdFBlcnNvblByaW1hcnksICJDb250YWN0T3JnYW5pemF0aW9uIikKICAgICAgICApLAogICAgICAgIHBvc2l0aW9uOiBnZXRFbGVtZW50VGV4dCgKICAgICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoY29udGFjdEluZm9ybWF0aW9uLCAiQ29udGFjdFBvc2l0aW9uIikKICAgICAgICApLAogICAgICAgIHBob25lOiBnZXRFbGVtZW50VGV4dCgKICAgICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoY29udGFjdEluZm9ybWF0aW9uLCAiQ29udGFjdFZvaWNlVGVsZXBob25lIikKICAgICAgICApLAogICAgICAgIGZheDogZ2V0RWxlbWVudFRleHQoCiAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGNvbnRhY3RJbmZvcm1hdGlvbiwgIkNvbnRhY3RGYWNzaW1pbGVUZWxlcGhvbmUiKQogICAgICAgICksCiAgICAgICAgYWRkcmVzczogewogICAgICAgICAgZGVsaXZlcnlQb2ludDogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChhZGRyZXNzLCAiQWRkcmVzcyIpKSwKICAgICAgICAgIGNpdHk6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoYWRkcmVzcywgIkNpdHkiKSksCiAgICAgICAgICBhZG1pbmlzdHJhdGl2ZUFyZWE6IGdldEVsZW1lbnRUZXh0KAogICAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGFkZHJlc3MsICJTdGF0ZU9yUHJvdmluY2UiKQogICAgICAgICAgKSwKICAgICAgICAgIHBvc3RhbENvZGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoYWRkcmVzcywgIlBvc3RDb2RlIikpLAogICAgICAgICAgY291bnRyeTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChhZGRyZXNzLCAiQ291bnRyeSIpKQogICAgICAgIH0sCiAgICAgICAgZW1haWw6IGdldEVsZW1lbnRUZXh0KAogICAgICAgICAgZmluZENoaWxkRWxlbWVudChjb250YWN0SW5mb3JtYXRpb24sICJDb250YWN0RWxlY3Ryb25pY01haWxBZGRyZXNzIikKICAgICAgICApCiAgICAgIH0KICAgIH07CiAgfQogIGZ1bmN0aW9uIHJlYWRQcm92aWRlckZyb21DYXBhYmlsaXRpZXMoY2FwYWJpbGl0aWVzRG9jKSB7CiAgICBjb25zdCBzZXJ2aWNlUHJvdmlkZXIgPSBmaW5kQ2hpbGRFbGVtZW50KAogICAgICBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLAogICAgICAiU2VydmljZVByb3ZpZGVyIgogICAgKTsKICAgIGNvbnN0IHNlcnZpY2VDb250YWN0ID0gZmluZENoaWxkRWxlbWVudChzZXJ2aWNlUHJvdmlkZXIsICJTZXJ2aWNlQ29udGFjdCIpOwogICAgY29uc3QgY29udGFjdEluZm8gPSBmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2VDb250YWN0LCAiQ29udGFjdEluZm8iKTsKICAgIGNvbnN0IHBob25lID0gZmluZENoaWxkRWxlbWVudChjb250YWN0SW5mbywgIlBob25lIik7CiAgICBjb25zdCBhZGRyZXNzID0gZmluZENoaWxkRWxlbWVudChjb250YWN0SW5mbywgIkFkZHJlc3MiKTsKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZVByb3ZpZGVyLCAiUHJvdmlkZXJOYW1lIikpLAogICAgICBzaXRlOiBnZXRFbGVtZW50QXR0cmlidXRlKAogICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZVByb3ZpZGVyLCAiUHJvdmlkZXJTaXRlIiksCiAgICAgICAgInhsaW5rOmhyZWYiCiAgICAgICksCiAgICAgIGNvbnRhY3Q6IHsKICAgICAgICBuYW1lOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2VDb250YWN0LCAiSW5kaXZpZHVhbE5hbWUiKSksCiAgICAgICAgcG9zaXRpb246IGdldEVsZW1lbnRUZXh0KAogICAgICAgICAgZmluZENoaWxkRWxlbWVudChzZXJ2aWNlQ29udGFjdCwgIlBvc2l0aW9uTmFtZSIpCiAgICAgICAgKSwKICAgICAgICBwaG9uZTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChwaG9uZSwgIlZvaWNlIikpLAogICAgICAgIGZheDogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChwaG9uZSwgIkZhY3NpbWlsZSIpKSwKICAgICAgICBhZGRyZXNzOiB7CiAgICAgICAgICBkZWxpdmVyeVBvaW50OiBnZXRFbGVtZW50VGV4dCgKICAgICAgICAgICAgZmluZENoaWxkRWxlbWVudChhZGRyZXNzLCAiRGVsaXZlcnlQb2ludCIpCiAgICAgICAgICApLAogICAgICAgICAgY2l0eTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChhZGRyZXNzLCAiQ2l0eSIpKSwKICAgICAgICAgIGFkbWluaXN0cmF0aXZlQXJlYTogZ2V0RWxlbWVudFRleHQoCiAgICAgICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoYWRkcmVzcywgIkFkbWluaXN0cmF0aXZlQXJlYSIpCiAgICAgICAgICApLAogICAgICAgICAgcG9zdGFsQ29kZTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChhZGRyZXNzLCAiUG9zdGFsQ29kZSIpKSwKICAgICAgICAgIGNvdW50cnk6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoYWRkcmVzcywgIkNvdW50cnkiKSkKICAgICAgICB9LAogICAgICAgIGVtYWlsOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGFkZHJlc3MsICJFbGVjdHJvbmljTWFpbEFkZHJlc3MiKSkKICAgICAgfQogICAgfTsKICB9CiAgZnVuY3Rpb24gcmVhZE9wZXJhdGlvblVybHNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3QgdXJscyA9IHt9OwogICAgY29uc3QgY2FwYWJpbGl0aWVzID0gZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKTsKICAgIGNvbnN0IG9wZXJhdGlvbnNNZXRhZGF0YSA9IGZpbmRDaGlsZEVsZW1lbnQoCiAgICAgIGNhcGFiaWxpdGllcywKICAgICAgIk9wZXJhdGlvbnNNZXRhZGF0YSIKICAgICk7CiAgICBpZiAob3BlcmF0aW9uc01ldGFkYXRhKSB7CiAgICAgIGZpbmRDaGlsZHJlbkVsZW1lbnQob3BlcmF0aW9uc01ldGFkYXRhLCAiT3BlcmF0aW9uIikuZm9yRWFjaCgKICAgICAgICAob3BlcmF0aW9uKSA9PiB7CiAgICAgICAgICBjb25zdCBuYW1lID0gZ2V0RWxlbWVudEF0dHJpYnV0ZShvcGVyYXRpb24sICJuYW1lIik7CiAgICAgICAgICB1cmxzW25hbWVdID0gcGFyc2VPcGVyYXRpb24xMTAob3BlcmF0aW9uKTsKICAgICAgICB9CiAgICAgICk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBjYXBhYmlsaXR5ID0gZmluZENoaWxkRWxlbWVudChjYXBhYmlsaXRpZXMsICJDYXBhYmlsaXR5Iik7CiAgICAgIGNvbnN0IHJlcXVlc3QgPSBmaW5kQ2hpbGRFbGVtZW50KGNhcGFiaWxpdHksICJSZXF1ZXN0Iik7CiAgICAgIGdldENoaWxkcmVuRWxlbWVudChyZXF1ZXN0KS5mb3JFYWNoKChvcGVyYXRpb24pID0+IHsKICAgICAgICBjb25zdCBuYW1lID0gc3RyaXBOYW1lc3BhY2UoZ2V0RWxlbWVudE5hbWUob3BlcmF0aW9uKSk7CiAgICAgICAgdXJsc1tuYW1lXSA9IHBhcnNlT3BlcmF0aW9uMTAwKG9wZXJhdGlvbik7CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIHVybHM7CiAgfQogIGZ1bmN0aW9uIHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpIHsKICAgIHJldHVybiBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLmF0dHJpYnV0ZXNbInZlcnNpb24iXTsKICB9CiAgZnVuY3Rpb24gcmVhZE91dHB1dEZvcm1hdHNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3QgdmVyc2lvbiA9IHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpOwogICAgbGV0IG91dHB1dEZvcm1hdHM7CiAgICBpZiAodmVyc2lvbi5zdGFydHNXaXRoKCIxLjAiKSkgewogICAgICBjb25zdCBnZXRGZWF0dXJlID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KAogICAgICAgICAgZmluZENoaWxkRWxlbWVudChnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLCAiQ2FwYWJpbGl0eSIpLAogICAgICAgICAgIlJlcXVlc3QiCiAgICAgICAgKSwKICAgICAgICAiR2V0RmVhdHVyZSIKICAgICAgKTsKICAgICAgb3V0cHV0Rm9ybWF0cyA9IGdldENoaWxkcmVuRWxlbWVudCgKICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGdldEZlYXR1cmUsICJSZXN1bHRGb3JtYXQiKQogICAgICApLm1hcChnZXRFbGVtZW50TmFtZSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBvcGVyYXRpb25zID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgICBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLAogICAgICAgICJPcGVyYXRpb25zTWV0YWRhdGEiCiAgICAgICk7CiAgICAgIGNvbnN0IGdldEZlYXR1cmUgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KG9wZXJhdGlvbnMsICJPcGVyYXRpb24iKS5maW5kKAogICAgICAgIChlbCkgPT4gZ2V0RWxlbWVudEF0dHJpYnV0ZShlbCwgIm5hbWUiKSA9PT0gIkdldEZlYXR1cmUiCiAgICAgICk7CiAgICAgIGNvbnN0IHBhcmFtZXRlciA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoZ2V0RmVhdHVyZSwgIlBhcmFtZXRlciIpLmZpbmQoCiAgICAgICAgKGVsKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGVsLCAibmFtZSIpID09PSAib3V0cHV0Rm9ybWF0IgogICAgICApOwogICAgICBvdXRwdXRGb3JtYXRzID0gZmluZENoaWxkcmVuRWxlbWVudChwYXJhbWV0ZXIsICJWYWx1ZSIsIHRydWUpLm1hcCgKICAgICAgICBnZXRFbGVtZW50VGV4dAogICAgICApOwogICAgfQogICAgcmV0dXJuIG91dHB1dEZvcm1hdHM7CiAgfQogIGZ1bmN0aW9uIHJlYWRJbmZvRnJvbUNhcGFiaWxpdGllcyQxKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3QgdmVyc2lvbiA9IHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpOwogICAgY29uc3Qgc2VydmljZVRhZyA9IHZlcnNpb24uc3RhcnRzV2l0aCgiMS4wIikgPyAiU2VydmljZSIgOiAiU2VydmljZUlkZW50aWZpY2F0aW9uIjsKICAgIGNvbnN0IG5hbWVUYWcgPSB2ZXJzaW9uLnN0YXJ0c1dpdGgoIjEuMCIpID8gIk5hbWUiIDogIlNlcnZpY2VUeXBlIjsKICAgIGNvbnN0IHNlcnZpY2UgPSBmaW5kQ2hpbGRFbGVtZW50KGdldFJvb3RFbGVtZW50KGNhcGFiaWxpdGllc0RvYyksIHNlcnZpY2VUYWcpOwogICAgbGV0IGtleXdvcmRzOwogICAgaWYgKHZlcnNpb24uc3RhcnRzV2l0aCgiMS4wIikpIHsKICAgICAga2V5d29yZHMgPSBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJLZXl3b3JkcyIpKS5zcGxpdCgiLCIpLm1hcCgoa2V5d29yZCkgPT4ga2V5d29yZC50cmltKCkpOwogICAgfSBlbHNlIHsKICAgICAga2V5d29yZHMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KAogICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIktleXdvcmRzIiksCiAgICAgICAgIktleXdvcmQiCiAgICAgICkubWFwKGdldEVsZW1lbnRUZXh0KTsKICAgIH0KICAgIGxldCBwcm92aWRlcjsKICAgIGlmICh2ZXJzaW9uICE9PSAiMS4wLjAiKSB7CiAgICAgIHByb3ZpZGVyID0gcmVhZFByb3ZpZGVyRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgdGl0bGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIlRpdGxlIikpLAogICAgICBuYW1lOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsIG5hbWVUYWcpKSwKICAgICAgYWJzdHJhY3Q6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIkFic3RyYWN0IikpLAogICAgICBmZWVzOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJGZWVzIikpLAogICAgICBjb25zdHJhaW50czogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzZXJ2aWNlLCAiQWNjZXNzQ29uc3RyYWludHMiKSksCiAgICAgIGtleXdvcmRzLAogICAgICBwcm92aWRlciwKICAgICAgb3V0cHV0Rm9ybWF0czogcmVhZE91dHB1dEZvcm1hdHNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYykKICAgIH07CiAgfQogIGZ1bmN0aW9uIHJlYWRGZWF0dXJlVHlwZXNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3QgdmVyc2lvbiA9IHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpOwogICAgY29uc3Qgb3V0cHV0Rm9ybWF0cyA9IHJlYWRPdXRwdXRGb3JtYXRzRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpOwogICAgY29uc3QgY2FwYWJpbGl0eSA9IGZpbmRDaGlsZEVsZW1lbnQoCiAgICAgIGdldFJvb3RFbGVtZW50KGNhcGFiaWxpdGllc0RvYyksCiAgICAgICJGZWF0dXJlVHlwZUxpc3QiCiAgICApOwogICAgcmV0dXJuIGZpbmRDaGlsZHJlbkVsZW1lbnQoY2FwYWJpbGl0eSwgIkZlYXR1cmVUeXBlIikubWFwKAogICAgICAoZmVhdHVyZVR5cGVFbCkgPT4gcGFyc2VGZWF0dXJlVHlwZShmZWF0dXJlVHlwZUVsLCB2ZXJzaW9uLCBvdXRwdXRGb3JtYXRzKQogICAgKTsKICB9CiAgZnVuY3Rpb24gcGFyc2VPcGVyYXRpb24xMDAob3BlcmF0aW9uKSB7CiAgICBjb25zdCB1cmxzID0ge307CiAgICBjb25zdCBkY3BUeXBlID0gZmluZENoaWxkcmVuRWxlbWVudChvcGVyYXRpb24sICJEQ1BUeXBlIik7CiAgICBjb25zdCBodHRwID0gZGNwVHlwZS5mbGF0TWFwKChkKSA9PiBmaW5kQ2hpbGRyZW5FbGVtZW50KGQsICJIVFRQIikpOwogICAgY29uc3QgbWV0aG9kcyA9IGh0dHAuZmxhdE1hcCgoaCkgPT4gZ2V0Q2hpbGRyZW5FbGVtZW50KGgpKTsKICAgIG1ldGhvZHMuZm9yRWFjaCgobWV0aG9kKSA9PiB7CiAgICAgIGNvbnN0IG1ldGhvZE5hbWUgPSBzdHJpcE5hbWVzcGFjZShnZXRFbGVtZW50TmFtZShtZXRob2QpKTsKICAgICAgdXJsc1ttZXRob2ROYW1lXSA9IGdldEVsZW1lbnRBdHRyaWJ1dGUobWV0aG9kLCAib25saW5lUmVzb3VyY2UiKTsKICAgIH0pOwogICAgcmV0dXJuIHVybHM7CiAgfQogIGZ1bmN0aW9uIHBhcnNlT3BlcmF0aW9uMTEwKG9wZXJhdGlvbikgewogICAgY29uc3QgdXJscyA9IHt9OwogICAgY29uc3QgZGNwVHlwZSA9IGZpbmRDaGlsZHJlbkVsZW1lbnQob3BlcmF0aW9uLCAiRENQIik7CiAgICBjb25zdCBodHRwID0gZGNwVHlwZS5mbGF0TWFwKChkKSA9PiBmaW5kQ2hpbGRFbGVtZW50KGQsICJIVFRQIikpOwogICAgY29uc3QgbWV0aG9kcyA9IGh0dHAuZmxhdE1hcCgoaCkgPT4gZ2V0Q2hpbGRyZW5FbGVtZW50KGgpKTsKICAgIG1ldGhvZHMuZm9yRWFjaCgobWV0aG9kKSA9PiB7CiAgICAgIGNvbnN0IG1ldGhvZE5hbWUgPSBzdHJpcE5hbWVzcGFjZShnZXRFbGVtZW50TmFtZShtZXRob2QpKTsKICAgICAgdXJsc1ttZXRob2ROYW1lXSA9IGdldEVsZW1lbnRBdHRyaWJ1dGUobWV0aG9kLCAieGxpbms6aHJlZiIpOwogICAgfSk7CiAgICByZXR1cm4gdXJsczsKICB9CiAgZnVuY3Rpb24gcGFyc2VGZWF0dXJlVHlwZShmZWF0dXJlVHlwZUVsLCBzZXJ2aWNlVmVyc2lvbiwgZGVmYXVsdE91dHB1dEZvcm1hdHMpIHsKICAgIGNvbnN0IHNyc1RhZyA9IHNlcnZpY2VWZXJzaW9uLnN0YXJ0c1dpdGgoIjIuIikgPyAiQ1JTIiA6ICJTUlMiOwogICAgY29uc3QgZGVmYXVsdFNyc1RhZyA9IHNlcnZpY2VWZXJzaW9uLnN0YXJ0c1dpdGgoIjEuMCIpID8gIlNSUyIgOiBgRGVmYXVsdCR7c3JzVGFnfWA7CiAgICBmdW5jdGlvbiBwYXJzZUJCb3gxMDAoKSB7CiAgICAgIGNvbnN0IGJib3hFbCA9IGZpbmRDaGlsZEVsZW1lbnQoZmVhdHVyZVR5cGVFbCwgIkxhdExvbmdCb3VuZGluZ0JveCIpOwogICAgICByZXR1cm4gWyJtaW54IiwgIm1pbnkiLCAibWF4eCIsICJtYXh5Il0ubWFwKChuYW1lKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGJib3hFbCwgbmFtZSkpLm1hcChwYXJzZUZsb2F0KTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlQkJveDIoKSB7CiAgICAgIGNvbnN0IGJib3hFbCA9IGZpbmRDaGlsZEVsZW1lbnQoZmVhdHVyZVR5cGVFbCwgIldHUzg0Qm91bmRpbmdCb3giKTsKICAgICAgcmV0dXJuIFsiTG93ZXJDb3JuZXIiLCAiVXBwZXJDb3JuZXIiXS5tYXAoKGVsTmFtZSkgPT4gZmluZENoaWxkRWxlbWVudChiYm94RWwsIGVsTmFtZSkpLm1hcCgoY29ybmVyRWwpID0+IGdldEVsZW1lbnRUZXh0KGNvcm5lckVsKS5zcGxpdCgiICIpKS5yZWR1Y2UoKHByZXYsIGN1cnIpID0+IFsuLi5wcmV2LCAuLi5jdXJyXSkubWFwKHBhcnNlRmxvYXQpOwogICAgfQogICAgY29uc3Qgb3RoZXJDcnMgPSBzZXJ2aWNlVmVyc2lvbi5zdGFydHNXaXRoKCIxLjAiKSA/IFtdIDogZmluZENoaWxkcmVuRWxlbWVudChmZWF0dXJlVHlwZUVsLCBgT3RoZXIke3Nyc1RhZ31gKS5tYXAoZ2V0RWxlbWVudFRleHQpLm1hcChzaW1wbGlmeUVwc2dVcm4pOwogICAgY29uc3Qgb3V0cHV0Rm9ybWF0cyA9IHNlcnZpY2VWZXJzaW9uLnN0YXJ0c1dpdGgoIjEuMCIpID8gW10gOiBmaW5kQ2hpbGRyZW5FbGVtZW50KAogICAgICBmaW5kQ2hpbGRFbGVtZW50KGZlYXR1cmVUeXBlRWwsICJPdXRwdXRGb3JtYXRzIiksCiAgICAgICJGb3JtYXQiCiAgICApLm1hcChnZXRFbGVtZW50VGV4dCk7CiAgICBjb25zdCBrZXl3b3JkcyA9IHNlcnZpY2VWZXJzaW9uLnN0YXJ0c1dpdGgoIjEuMCIpID8gZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChmZWF0dXJlVHlwZUVsLCAiS2V5d29yZHMiKSkuc3BsaXQoIiwiKS5tYXAoKGtleXdvcmQpID0+IGtleXdvcmQudHJpbSgpKSA6IGZpbmRDaGlsZHJlbkVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQoZmVhdHVyZVR5cGVFbCwgIktleXdvcmRzIiksCiAgICAgICJLZXl3b3JkIgogICAgKS5tYXAoZ2V0RWxlbWVudFRleHQpLmZpbHRlcigodiwgaSwgYXJyKSA9PiBhcnIuaW5kZXhPZih2KSA9PT0gaSk7CiAgICBjb25zdCBtZXRhZGF0YSA9IHNlcnZpY2VWZXJzaW9uID09PSAiMi4wLjAiID8gZmluZENoaWxkcmVuRWxlbWVudChmZWF0dXJlVHlwZUVsLCAiTWV0YWRhdGFVUkwiKS5tYXAoCiAgICAgIChtZXRhZGF0YVVybEVsKSA9PiAoewogICAgICAgIHVybDogZ2V0RWxlbWVudEF0dHJpYnV0ZShtZXRhZGF0YVVybEVsLCAieGxpbms6aHJlZiIpCiAgICAgIH0pCiAgICApIDogZmluZENoaWxkcmVuRWxlbWVudChmZWF0dXJlVHlwZUVsLCAiTWV0YWRhdGFVUkwiKS5tYXAoCiAgICAgIChtZXRhZGF0YVVybEVsKSA9PiAoewogICAgICAgIGZvcm1hdDogZ2V0RWxlbWVudEF0dHJpYnV0ZShtZXRhZGF0YVVybEVsLCAiZm9ybWF0IiksCiAgICAgICAgdHlwZTogZ2V0RWxlbWVudEF0dHJpYnV0ZShtZXRhZGF0YVVybEVsLCAidHlwZSIpLAogICAgICAgIHVybDogZ2V0RWxlbWVudFRleHQobWV0YWRhdGFVcmxFbCkudHJpbSgpCiAgICAgIH0pCiAgICApOwogICAgcmV0dXJuIHsKICAgICAgbmFtZTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChmZWF0dXJlVHlwZUVsLCAiTmFtZSIpKSwKICAgICAgdGl0bGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZmVhdHVyZVR5cGVFbCwgIlRpdGxlIikpLAogICAgICBhYnN0cmFjdDogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChmZWF0dXJlVHlwZUVsLCAiQWJzdHJhY3QiKSksCiAgICAgIGRlZmF1bHRDcnM6IHNpbXBsaWZ5RXBzZ1VybigKICAgICAgICBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGZlYXR1cmVUeXBlRWwsIGRlZmF1bHRTcnNUYWcpKQogICAgICApLAogICAgICBvdGhlckNycywKICAgICAgb3V0cHV0Rm9ybWF0czogb3V0cHV0Rm9ybWF0cy5sZW5ndGggPiAwID8gb3V0cHV0Rm9ybWF0cyA6IGRlZmF1bHRPdXRwdXRGb3JtYXRzLAogICAgICBsYXRMb25Cb3VuZGluZ0JveDogc2VydmljZVZlcnNpb24uc3RhcnRzV2l0aCgiMS4wIikgPyBwYXJzZUJCb3gxMDAoKSA6IHBhcnNlQkJveDIoKSwKICAgICAga2V5d29yZHMsCiAgICAgIC4uLm1ldGFkYXRhLmxlbmd0aCAmJiB7IG1ldGFkYXRhIH0KICAgIH07CiAgfQogIGZ1bmN0aW9uIHBhcnNlQkJveCh4bWxFbGVtZW50KSB7CiAgICBjb25zdCByZXN1bHQgPSBbIkxvd2VyQ29ybmVyIiwgIlVwcGVyQ29ybmVyIl0ubWFwKChlbE5hbWUpID0+IGZpbmRDaGlsZEVsZW1lbnQoeG1sRWxlbWVudCwgZWxOYW1lKSkubWFwKChjb3JuZXJFbCkgPT4gZ2V0RWxlbWVudFRleHQoY29ybmVyRWwpLnNwbGl0KCIgIikpLnJlZHVjZSgocHJldiwgY3VycikgPT4gWy4uLnByZXYsIC4uLmN1cnJdKS5tYXAocGFyc2VGbG9hdCk7CiAgICBpZiAocmVzdWx0LnNvbWUoTnVtYmVyLmlzTmFOKSkKICAgICAgcmV0dXJuIG51bGw7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBmdW5jdGlvbiByZWFkSW5mb0Zyb21DYXBhYmlsaXRpZXMoY2FwYWJpbGl0aWVzRG9jKSB7CiAgICBjb25zdCByb290RWwgPSBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpOwogICAgY29uc3Qgc2VydmljZSA9IGZpbmRDaGlsZEVsZW1lbnQocm9vdEVsLCAiU2VydmljZUlkZW50aWZpY2F0aW9uIik7CiAgICBjb25zdCBrZXl3b3JkcyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIktleXdvcmRzIiksCiAgICAgICJLZXl3b3JkIgogICAgKS5tYXAoZ2V0RWxlbWVudFRleHQpOwogICAgY29uc3QgbWV0YWRhdGEgPSBmaW5kQ2hpbGRFbGVtZW50KHJvb3RFbCwgIk9wZXJhdGlvbnNNZXRhZGF0YSIpOwogICAgY29uc3QgZ2V0VGlsZU9wZXJhdGlvbiA9IGZpbmRDaGlsZHJlbkVsZW1lbnQobWV0YWRhdGEsICJPcGVyYXRpb24iKS5maW5kKAogICAgICAoZWwpID0+IGdldEVsZW1lbnRBdHRyaWJ1dGUoZWwsICJuYW1lIikgPT0gIkdldFRpbGUiCiAgICApOwogICAgY29uc3QgZ2V0VGlsZVVybHMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGdldFRpbGVPcGVyYXRpb24sICJHZXQiLCB0cnVlKS5yZWR1Y2UoCiAgICAgIChwcmV2LCBjdXJyKSA9PiB7CiAgICAgICAgY29uc3QgZW5jb2RpbmdUeXBlID0gZ2V0RWxlbWVudFRleHQoCiAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGN1cnIsICJWYWx1ZSIsIHRydWUpCiAgICAgICAgKTsKICAgICAgICBjb25zdCB1cmwgPSBnZXRFbGVtZW50QXR0cmlidXRlKGN1cnIsICJ4bGluazpocmVmIik7CiAgICAgICAgaWYgKGVuY29kaW5nVHlwZS50b0xvd2VyQ2FzZSgpID09PSAicmVzdGZ1bCIpCiAgICAgICAgICByZXR1cm4geyAuLi5wcmV2LCByZXN0OiB1cmwgfTsKICAgICAgICByZXR1cm4geyAuLi5wcmV2LCBrdnA6IHVybCB9OwogICAgICB9LAogICAgICB7fQogICAgKTsKICAgIHJldHVybiB7CiAgICAgIHRpdGxlOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJUaXRsZSIpKSwKICAgICAgbmFtZTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzZXJ2aWNlLCAiU2VydmljZVR5cGUiKSksCiAgICAgIGFic3RyYWN0OiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJBYnN0cmFjdCIpKSwKICAgICAgZmVlczogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzZXJ2aWNlLCAiRmVlcyIpKSwKICAgICAgY29uc3RyYWludHM6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIkFjY2Vzc0NvbnN0cmFpbnRzIikpLAogICAgICBrZXl3b3JkcywKICAgICAgcHJvdmlkZXI6IHJlYWRQcm92aWRlckZyb21DYXBhYmlsaXRpZXMoY2FwYWJpbGl0aWVzRG9jKSwKICAgICAgZ2V0VGlsZVVybHMKICAgIH07CiAgfQogIGZ1bmN0aW9uIHJlYWRNYXRyaXhTZXRzRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpIHsKICAgIGZ1bmN0aW9uIHBhcnNlTWF0cml4U2V0KGVsZW1lbnQpIHsKICAgICAgY29uc3QgdG9wTGVmdCA9IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIlRvcExlZnRDb3JuZXIiKSkuc3BsaXQoIiAiKS5tYXAocGFyc2VGbG9hdCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgaWRlbnRpZmllcjogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50LCAiSWRlbnRpZmllciIpKSwKICAgICAgICB0aWxlV2lkdGg6IHBhcnNlSW50KAogICAgICAgICAgZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50LCAiVGlsZVdpZHRoIikpCiAgICAgICAgKSwKICAgICAgICB0aWxlSGVpZ2h0OiBwYXJzZUludCgKICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIlRpbGVIZWlnaHQiKSkKICAgICAgICApLAogICAgICAgIG1hdHJpeFdpZHRoOiBwYXJzZUludCgKICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIk1hdHJpeFdpZHRoIikpCiAgICAgICAgKSwKICAgICAgICBtYXRyaXhIZWlnaHQ6IHBhcnNlSW50KAogICAgICAgICAgZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50LCAiTWF0cml4SGVpZ2h0IikpCiAgICAgICAgKSwKICAgICAgICBzY2FsZURlbm9taW5hdG9yOiBwYXJzZUZsb2F0KAogICAgICAgICAgZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50LCAiU2NhbGVEZW5vbWluYXRvciIpKQogICAgICAgICksCiAgICAgICAgdG9wTGVmdAogICAgICB9OwogICAgfQogICAgY29uc3QgY29udGVudHMgPSBmaW5kQ2hpbGRFbGVtZW50KAogICAgICBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLAogICAgICAiQ29udGVudHMiCiAgICApOwogICAgY29uc3QgbWF0cml4U2V0cyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoY29udGVudHMsICJUaWxlTWF0cml4U2V0Iik7CiAgICByZXR1cm4gbWF0cml4U2V0cy5tYXAoKGVsZW1lbnQpID0+IHsKICAgICAgY29uc3Qgd2VsbEtub3duU2NhbGVTZXQgPSBnZXRFbGVtZW50VGV4dCgKICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQsICJXZWxsS25vd25TY2FsZVNldCIpCiAgICAgICk7CiAgICAgIGNvbnN0IGJvdW5kaW5nQm94ID0gcGFyc2VCQm94KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIkJvdW5kaW5nQm94IikpOwogICAgICByZXR1cm4gewogICAgICAgIGlkZW50aWZpZXI6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIklkZW50aWZpZXIiKSksCiAgICAgICAgY3JzOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQsICJTdXBwb3J0ZWRDUlMiKSksCiAgICAgICAgdGlsZU1hdHJpY2VzOiBmaW5kQ2hpbGRyZW5FbGVtZW50KGVsZW1lbnQsICJUaWxlTWF0cml4IikubWFwKAogICAgICAgICAgcGFyc2VNYXRyaXhTZXQKICAgICAgICApLAogICAgICAgIC4uLmJvdW5kaW5nQm94ICYmIHsgYm91bmRpbmdCb3ggfSwKICAgICAgICAuLi53ZWxsS25vd25TY2FsZVNldCAmJiB7IHdlbGxLbm93blNjYWxlU2V0IH0KICAgICAgfTsKICAgIH0pOwogIH0KICBmdW5jdGlvbiByZWFkTGF5ZXJzRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpIHsKICAgIGNvbnN0IHJvb3RFbCA9IGdldFJvb3RFbGVtZW50KGNhcGFiaWxpdGllc0RvYyk7CiAgICBjb25zdCBjb250ZW50c0VsID0gZmluZENoaWxkRWxlbWVudChyb290RWwsICJDb250ZW50cyIpOwogICAgZnVuY3Rpb24gZ2V0TWF0cml4U2V0Q3JzKGNvbnRlbnRzRWwyLCBpZGVudGlmaWVyKSB7CiAgICAgIGNvbnN0IG1hdHJpeFNldCA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoY29udGVudHNFbDIsICJUaWxlTWF0cml4U2V0IikuZmluZCgKICAgICAgICAobWF0cml4U2V0RWwpID0+IHsKICAgICAgICAgIGNvbnN0IGlkZW50aWZpZXJFbCA9IGZpbmRDaGlsZEVsZW1lbnQobWF0cml4U2V0RWwsICJJZGVudGlmaWVyIik7CiAgICAgICAgICByZXR1cm4gZ2V0RWxlbWVudFRleHQoaWRlbnRpZmllckVsKSA9PT0gaWRlbnRpZmllcjsKICAgICAgICB9CiAgICAgICk7CiAgICAgIHJldHVybiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KG1hdHJpeFNldCwgIlN1cHBvcnRlZENSUyIpKTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlTWF0cml4U2V0TGluayhlbGVtZW50KSB7CiAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBnZXRFbGVtZW50VGV4dCgKICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQsICJUaWxlTWF0cml4U2V0IikKICAgICAgKTsKICAgICAgY29uc3QgY3JzID0gZ2V0TWF0cml4U2V0Q3JzKGNvbnRlbnRzRWwsIGlkZW50aWZpZXIpOwogICAgICByZXR1cm4gewogICAgICAgIGlkZW50aWZpZXIsCiAgICAgICAgY3JzLAogICAgICAgIGxpbWl0czogZmluZENoaWxkcmVuRWxlbWVudChlbGVtZW50LCAiVGlsZU1hdHJpeExpbWl0cyIsIHRydWUpLm1hcCgKICAgICAgICAgIChlbGVtZW50MikgPT4gKHsKICAgICAgICAgICAgdGlsZU1hdHJpeDogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50MiwgIlRpbGVNYXRyaXgiKSksCiAgICAgICAgICAgIG1pblRpbGVSb3c6IHBhcnNlSW50KAogICAgICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJNaW5UaWxlUm93IikpCiAgICAgICAgICAgICksCiAgICAgICAgICAgIG1pblRpbGVDb2w6IHBhcnNlSW50KAogICAgICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJNaW5UaWxlQ29sIikpCiAgICAgICAgICAgICksCiAgICAgICAgICAgIG1heFRpbGVSb3c6IHBhcnNlSW50KAogICAgICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJNYXhUaWxlUm93IikpCiAgICAgICAgICAgICksCiAgICAgICAgICAgIG1heFRpbGVDb2w6IHBhcnNlSW50KAogICAgICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJNYXhUaWxlQ29sIikpCiAgICAgICAgICAgICkKICAgICAgICAgIH0pCiAgICAgICAgKQogICAgICB9OwogICAgfQogICAgY29uc3QgZ2V0VGlsZU9wZXJhdGlvbiA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQocm9vdEVsLCAiT3BlcmF0aW9uc01ldGFkYXRhIiksCiAgICAgICJPcGVyYXRpb24iCiAgICApLmZpbmQoKGVsKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGVsLCAibmFtZSIpID09ICJHZXRUaWxlIik7CiAgICBjb25zdCBnZXRLdnBFbHQgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGdldFRpbGVPcGVyYXRpb24sICJHZXQiLCB0cnVlKS5maWx0ZXIoCiAgICAgIChlbHQpID0+IHsKICAgICAgICBjb25zdCBlbmNvZGluZ1R5cGUgPSBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGVsdCwgIlZhbHVlIiwgdHJ1ZSkpOwogICAgICAgIHJldHVybiBlbmNvZGluZ1R5cGUudG9Mb3dlckNhc2UoKSA9PT0gImt2cCI7CiAgICAgIH0KICAgIClbMF07CiAgICBjb25zdCBnZXRLdnBVcmwgPSBnZXRLdnBFbHQgPyBnZXRFbGVtZW50QXR0cmlidXRlKGdldEt2cEVsdCwgInhsaW5rOmhyZWYiKSA6ICIiOwogICAgY29uc3QgY29udGVudHMgPSBmaW5kQ2hpbGRFbGVtZW50KHJvb3RFbCwgIkNvbnRlbnRzIik7CiAgICBjb25zdCBsYXllcnMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGNvbnRlbnRzLCAiTGF5ZXIiKTsKICAgIHJldHVybiBsYXllcnMubWFwKChlbGVtZW50KSA9PiB7CiAgICAgIGNvbnN0IGxhdExvbkJvdW5kaW5nQm94ID0gcGFyc2VCQm94KAogICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIldHUzg0Qm91bmRpbmdCb3giKQogICAgICApOwogICAgICBsZXQgZGVmYXVsdFN0eWxlID0gIiI7CiAgICAgIGNvbnN0IHN0eWxlcyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCwgIlN0eWxlIikubWFwKChlbGVtZW50MikgPT4gewogICAgICAgIGNvbnN0IGxlZ2VuZFVybCA9IGdldEVsZW1lbnRBdHRyaWJ1dGUoCiAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQyLCAiTGVnZW5kVVJMIiksCiAgICAgICAgICAieGxpbms6aHJlZiIKICAgICAgICApOwogICAgICAgIGNvbnN0IGFic3RyYWN0ID0gZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50MiwgIkFic3RyYWN0IikpOwogICAgICAgIGNvbnN0IHN0eWxlID0gewogICAgICAgICAgdGl0bGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJUaXRsZSIpKSwKICAgICAgICAgIG5hbWU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJJZGVudGlmaWVyIikpLAogICAgICAgICAgLi4uYWJzdHJhY3QgJiYgeyBhYnN0cmFjdCB9LAogICAgICAgICAgLi4ubGVnZW5kVXJsICYmIHsgbGVnZW5kVXJsIH0KICAgICAgICB9OwogICAgICAgIGlmIChnZXRFbGVtZW50QXR0cmlidXRlKGVsZW1lbnQyLCAiaXNEZWZhdWx0IikgPT09ICJ0cnVlIikgewogICAgICAgICAgZGVmYXVsdFN0eWxlID0gc3R5bGUubmFtZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0eWxlOwogICAgICB9KTsKICAgICAgY29uc3Qgb3V0cHV0Rm9ybWF0cyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCwgIkZvcm1hdCIpLm1hcCgKICAgICAgICBnZXRFbGVtZW50VGV4dAogICAgICApOwogICAgICBjb25zdCByZXNvdXJjZUxpbmtzID0gZmluZENoaWxkcmVuRWxlbWVudCgKICAgICAgICBlbGVtZW50LAogICAgICAgICJSZXNvdXJjZVVSTCIKICAgICAgKS5maWx0ZXIoCiAgICAgICAgKGVsZW1lbnQyKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGVsZW1lbnQyLCAicmVzb3VyY2VUeXBlIikgPT09ICJ0aWxlIgogICAgICApLm1hcCgoZWxlbWVudDIpID0+IHsKICAgICAgICBjb25zdCBmb3JtYXQgPSBnZXRFbGVtZW50QXR0cmlidXRlKGVsZW1lbnQyLCAiZm9ybWF0Iik7CiAgICAgICAgY29uc3QgdXJsID0gZ2V0RWxlbWVudEF0dHJpYnV0ZShlbGVtZW50MiwgInRlbXBsYXRlIik7CiAgICAgICAgcmV0dXJuIHsgZm9ybWF0LCB1cmwsIGVuY29kaW5nOiAiUkVTVCIgfTsKICAgICAgfSk7CiAgICAgIGlmIChnZXRLdnBVcmwpIHsKICAgICAgICByZXNvdXJjZUxpbmtzLnB1c2goCiAgICAgICAgICAuLi5vdXRwdXRGb3JtYXRzLm1hcCgoZm9ybWF0KSA9PiAoewogICAgICAgICAgICBlbmNvZGluZzogIktWUCIsCiAgICAgICAgICAgIHVybDogZ2V0S3ZwVXJsLAogICAgICAgICAgICBmb3JtYXQKICAgICAgICAgIH0pKQogICAgICAgICk7CiAgICAgIH0KICAgICAgY29uc3QgbWF0cml4U2V0cyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCwgIlRpbGVNYXRyaXhTZXRMaW5rIikubWFwKAogICAgICAgIHBhcnNlTWF0cml4U2V0TGluawogICAgICApOwogICAgICBjb25zdCBkaW1lbnNpb25zID0gZmluZENoaWxkcmVuRWxlbWVudChlbGVtZW50LCAiRGltZW5zaW9uIikubWFwKAogICAgICAgIChlbGVtZW50MikgPT4gewogICAgICAgICAgY29uc3QgaWRlbnRpZmllciA9IGdldEVsZW1lbnRUZXh0KAogICAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQyLCAiSWRlbnRpZmllciIpCiAgICAgICAgICApOwogICAgICAgICAgY29uc3QgZGVmYXVsdFZhbHVlID0gZ2V0RWxlbWVudFRleHQoCiAgICAgICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJEZWZhdWx0IikKICAgICAgICAgICk7CiAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGVsZW1lbnQyLCAiVmFsdWVzIikubWFwKAogICAgICAgICAgICBnZXRFbGVtZW50VGV4dAogICAgICAgICAgKTsKICAgICAgICAgIHJldHVybiB7IGlkZW50aWZpZXIsIGRlZmF1bHRWYWx1ZSwgdmFsdWVzIH07CiAgICAgICAgfQogICAgICApOwogICAgICByZXR1cm4gewogICAgICAgIG5hbWU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIklkZW50aWZpZXIiKSksCiAgICAgICAgdGl0bGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIlRpdGxlIikpLAogICAgICAgIGFic3RyYWN0OiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQsICJBYnN0cmFjdCIpKSwKICAgICAgICBzdHlsZXMsCiAgICAgICAgcmVzb3VyY2VMaW5rcywKICAgICAgICBtYXRyaXhTZXRzLAogICAgICAgIGRlZmF1bHRTdHlsZSwKICAgICAgICAuLi5sYXRMb25Cb3VuZGluZ0JveCAmJiB7IGxhdExvbkJvdW5kaW5nQm94IH0sCiAgICAgICAgLi4uZGltZW5zaW9ucyAmJiB7IGRpbWVuc2lvbnMgfQogICAgICB9OwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIHBhcnNlRmVhdHVyZVByb3BzKGdldEZlYXR1cmVzRG9jLCBmZWF0dXJlVHlwZUZ1bGwsIHNlcnZpY2VWZXJzaW9uKSB7CiAgICBjb25zdCBjb2xsZWN0aW9uID0gZ2V0Um9vdEVsZW1lbnQoZ2V0RmVhdHVyZXNEb2MpOwogICAgbGV0IG1lbWJlcnM7CiAgICBpZiAoc2VydmljZVZlcnNpb24uc3RhcnRzV2l0aCgiMi4wIikpIHsKICAgICAgbWVtYmVycyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoY29sbGVjdGlvbiwgIm1lbWJlciIpLm1hcCgKICAgICAgICAocGFyZW50KSA9PiBnZXRDaGlsZHJlbkVsZW1lbnQocGFyZW50KVswXQogICAgICApOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgbWVtYmVyc1Jvb3QgPSBmaW5kQ2hpbGRFbGVtZW50KGNvbGxlY3Rpb24sICJmZWF0dXJlTWVtYmVycyIpOwogICAgICBtZW1iZXJzID0gbWVtYmVyc1Jvb3QgPyBnZXRDaGlsZHJlbkVsZW1lbnQobWVtYmVyc1Jvb3QpIDogZmluZENoaWxkcmVuRWxlbWVudChjb2xsZWN0aW9uLCAiZmVhdHVyZU1lbWJlciIpLm1hcCgKICAgICAgICAocGFyZW50KSA9PiBnZXRDaGlsZHJlbkVsZW1lbnQocGFyZW50KVswXQogICAgICApOwogICAgfQogICAgY29uc3QgaWRBdHRyID0gc2VydmljZVZlcnNpb24gPT09ICIxLjAuMCIgPyAiZmlkIiA6ICJnbWw6aWQiOwogICAgZnVuY3Rpb24gaXNFbGVtZW50UHJvcGVydHkocHJvcE5hbWUpIHsKICAgICAgcmV0dXJuIHByb3BOYW1lIGluIGZlYXR1cmVUeXBlRnVsbC5wcm9wZXJ0aWVzOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VFbGVtZW50UHJvcGVydHlWYWx1ZShwcm9wTmFtZSwgdmFsdWVBc1N0cmluZykgewogICAgICBjb25zdCB0eXBlID0gZmVhdHVyZVR5cGVGdWxsLnByb3BlcnRpZXNbcHJvcE5hbWVdOwogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlICJpbnRlZ2VyIjoKICAgICAgICAgIHJldHVybiBwYXJzZUludCh2YWx1ZUFzU3RyaW5nKTsKICAgICAgICBjYXNlICJmbG9hdCI6CiAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCh2YWx1ZUFzU3RyaW5nKTsKICAgICAgICBjYXNlICJib29sZWFuIjoKICAgICAgICAgIHJldHVybiB2YWx1ZUFzU3RyaW5nID09PSAidHJ1ZSI7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiB2YWx1ZUFzU3RyaW5nOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBnZXRQcm9wZXJ0aWVzKG1lbWJlckVsKSB7CiAgICAgIHJldHVybiBnZXRDaGlsZHJlbkVsZW1lbnQobWVtYmVyRWwpLmZpbHRlcigoZWwpID0+IGlzRWxlbWVudFByb3BlcnR5KHN0cmlwTmFtZXNwYWNlKGdldEVsZW1lbnROYW1lKGVsKSkpKS5yZWR1Y2UoKHByZXYsIGN1cnIpID0+IHsKICAgICAgICBjb25zdCBwcm9wTmFtZSA9IHN0cmlwTmFtZXNwYWNlKGdldEVsZW1lbnROYW1lKGN1cnIpKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgLi4ucHJldiwKICAgICAgICAgIFtwcm9wTmFtZV06IHBhcnNlRWxlbWVudFByb3BlcnR5VmFsdWUocHJvcE5hbWUsIGdldEVsZW1lbnRUZXh0KGN1cnIpKQogICAgICAgIH07CiAgICAgIH0sIHt9KTsKICAgIH0KICAgIHJldHVybiBtZW1iZXJzLm1hcCgoZWwpID0+ICh7CiAgICAgIGlkOiBnZXRFbGVtZW50QXR0cmlidXRlKGVsLCBpZEF0dHIpLAogICAgICBwcm9wZXJ0aWVzOiBnZXRQcm9wZXJ0aWVzKGVsKQogICAgfSkpOwogIH0KICBmdW5jdGlvbiBjb21wdXRlRmVhdHVyZVByb3BzRGV0YWlscyhmZWF0dXJlc1dpdGhQcm9wcykgewogICAgcmV0dXJuIGZlYXR1cmVzV2l0aFByb3BzLnJlZHVjZSgocHJldiwgY3VycikgPT4gewogICAgICBmb3IgKGNvbnN0IHByb3BOYW1lIGluIGN1cnIucHJvcGVydGllcykgewogICAgICAgIGNvbnN0IHByb3BWYWx1ZSA9IGN1cnIucHJvcGVydGllc1twcm9wTmFtZV07CiAgICAgICAgaWYgKCEocHJvcE5hbWUgaW4gcHJldikpIHsKICAgICAgICAgIHByZXZbcHJvcE5hbWVdID0geyB1bmlxdWVWYWx1ZXM6IFtdIH07CiAgICAgICAgfQogICAgICAgIGNvbnN0IHVuaXF1ZVZhbHVlID0gcHJldltwcm9wTmFtZV0udW5pcXVlVmFsdWVzLmZpbmQoCiAgICAgICAgICAodikgPT4gdi52YWx1ZSA9PT0gcHJvcFZhbHVlCiAgICAgICAgKTsKICAgICAgICBpZiAodW5pcXVlVmFsdWUpCiAgICAgICAgICB1bmlxdWVWYWx1ZS5jb3VudCsrOwogICAgICAgIGVsc2UKICAgICAgICAgIHByZXZbcHJvcE5hbWVdLnVuaXF1ZVZhbHVlcy5wdXNoKHsgdmFsdWU6IHByb3BWYWx1ZSwgY291bnQ6IDEgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHByZXY7CiAgICB9LCB7fSk7CiAgfQogIGZ1bmN0aW9uIGdlbmVyYXRlR2V0RmVhdHVyZVVybChzZXJ2aWNlVXJsLCB2ZXJzaW9uLCBmZWF0dXJlVHlwZSwgb3V0cHV0Rm9ybWF0LCBtYXhGZWF0dXJlcywgYXR0cmlidXRlcywgaGl0c09ubHksIG91dHB1dENycywgZXh0ZW50LCBleHRlbnRDcnMsIHN0YXJ0SW5kZXgsIHNvcnRCeSkgewogICAgY29uc3QgdHlwZVBhcmFtID0gdmVyc2lvbiA9PT0gIjIuMC4wIiA/ICJUWVBFTkFNRVMiIDogIlRZUEVOQU1FIjsKICAgIGNvbnN0IGNvdW50UGFyYW0gPSB2ZXJzaW9uID09PSAiMi4wLjAiID8gIkNPVU5UIiA6ICJNQVhGRUFUVVJFUyI7CiAgICBjb25zdCBuZXdQYXJhbXMgPSB7CiAgICAgIFNFUlZJQ0U6ICJXRlMiLAogICAgICBSRVFVRVNUOiAiR2V0RmVhdHVyZSIsCiAgICAgIFZFUlNJT046IHZlcnNpb24sCiAgICAgIFt0eXBlUGFyYW1dOiBmZWF0dXJlVHlwZQogICAgfTsKICAgIGlmIChvdXRwdXRGb3JtYXQgIT09IHZvaWQgMCkKICAgICAgbmV3UGFyYW1zLk9VVFBVVEZPUk1BVCA9IG91dHB1dEZvcm1hdDsKICAgIGlmIChhdHRyaWJ1dGVzICE9PSB2b2lkIDApCiAgICAgIG5ld1BhcmFtcy5QUk9QRVJUWU5BTUUgPSBhdHRyaWJ1dGVzLmpvaW4oIiwiKTsKICAgIGlmIChoaXRzT25seSkgewogICAgICBuZXdQYXJhbXMuUkVTVUxUVFlQRSA9ICJoaXRzIjsKICAgICAgbmV3UGFyYW1zW2NvdW50UGFyYW1dID0gIjEiOwogICAgfSBlbHNlIGlmIChtYXhGZWF0dXJlcyAhPT0gdm9pZCAwKQogICAgICBuZXdQYXJhbXNbY291bnRQYXJhbV0gPSBtYXhGZWF0dXJlcy50b1N0cmluZygxMCk7CiAgICBpZiAob3V0cHV0Q3JzKSB7CiAgICAgIG5ld1BhcmFtcy5TUlNOQU1FID0gb3V0cHV0Q3JzOwogICAgfQogICAgaWYgKGV4dGVudCkgewogICAgICBjb25zdCBleHRlbnRKb2luZWQgPSBleHRlbnQuam9pbigiLCIpOwogICAgICBuZXdQYXJhbXMuQkJPWCA9IGV4dGVudENycyA/IGAke2V4dGVudEpvaW5lZH0sJHtleHRlbnRDcnN9YCA6IGV4dGVudEpvaW5lZDsKICAgIH0KICAgIGlmIChzdGFydEluZGV4KSB7CiAgICAgIG5ld1BhcmFtcy5TVEFSVElOREVYID0gc3RhcnRJbmRleC50b1N0cmluZygxMCk7CiAgICB9CiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHNldFF1ZXJ5UGFyYW1zKHNlcnZpY2VVcmwsIG5ld1BhcmFtcykpOwogICAgaWYgKEFycmF5LmlzQXJyYXkoc29ydEJ5KSAmJiBzb3J0QnkubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBzb3J0cyA9IHNvcnRCeS5tYXAoKGZpZWxkU29ydCkgPT4gYCR7ZmllbGRTb3J0WzFdfSAke2ZpZWxkU29ydFswXX1gKS5qb2luKCIsIik7CiAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCJTT1JUQlkiLCBzb3J0cyk7CiAgICB9CiAgICByZXR1cm4gdXJsLnRvU3RyaW5nKCk7CiAgfQogIGFkZFRhc2tIYW5kbGVyKAogICAgInBhcnNlV21zQ2FwYWJpbGl0aWVzIiwKICAgIGdsb2JhbFRoaXMsCiAgICAoeyB1cmwgfSkgPT4gcXVlcnlYbWxEb2N1bWVudCh1cmwpLnRoZW4oKHhtbERvYykgPT4gY2hlY2soeG1sRG9jLCB1cmwpKS50aGVuKCh4bWxEb2MpID0+ICh7CiAgICAgIGluZm86IHJlYWRJbmZvRnJvbUNhcGFiaWxpdGllcyQyKHhtbERvYyksCiAgICAgIGxheWVyczogcmVhZExheWVyc0Zyb21DYXBhYmlsaXRpZXMkMSh4bWxEb2MpLAogICAgICB1cmw6IHJlYWRPcGVyYXRpb25VcmxzRnJvbUNhcGFiaWxpdGllcyQxKHhtbERvYyksCiAgICAgIHZlcnNpb246IHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyQxKHhtbERvYykKICAgIH0pKQogICk7CiAgYWRkVGFza0hhbmRsZXIoCiAgICAicGFyc2VXZnNDYXBhYmlsaXRpZXMiLAogICAgZ2xvYmFsVGhpcywKICAgICh7IHVybCB9KSA9PiBxdWVyeVhtbERvY3VtZW50KHVybCkudGhlbigoeG1sRG9jKSA9PiBjaGVjayh4bWxEb2MsIHVybCkpLnRoZW4oKHhtbERvYykgPT4gKHsKICAgICAgaW5mbzogcmVhZEluZm9Gcm9tQ2FwYWJpbGl0aWVzJDEoeG1sRG9jKSwKICAgICAgZmVhdHVyZVR5cGVzOiByZWFkRmVhdHVyZVR5cGVzRnJvbUNhcGFiaWxpdGllcyh4bWxEb2MpLAogICAgICB1cmw6IHJlYWRPcGVyYXRpb25VcmxzRnJvbUNhcGFiaWxpdGllcyh4bWxEb2MpLAogICAgICB2ZXJzaW9uOiByZWFkVmVyc2lvbkZyb21DYXBhYmlsaXRpZXMoeG1sRG9jKQogICAgfSkpCiAgKTsKICBhZGRUYXNrSGFuZGxlcigKICAgICJxdWVyeVdmc0ZlYXR1cmVUeXBlRGV0YWlscyIsCiAgICBnbG9iYWxUaGlzLAogICAgKHsKICAgICAgdXJsLAogICAgICBzZXJ2aWNlVmVyc2lvbiwKICAgICAgZmVhdHVyZVR5cGVGdWxsCiAgICB9KSA9PiB7CiAgICAgIGNvbnN0IGdldEZlYXR1cmVVcmwgPSBnZW5lcmF0ZUdldEZlYXR1cmVVcmwoCiAgICAgICAgdXJsLAogICAgICAgIHNlcnZpY2VWZXJzaW9uLAogICAgICAgIGZlYXR1cmVUeXBlRnVsbC5uYW1lLAogICAgICAgIHZvaWQgMCwKICAgICAgICB2b2lkIDAsCiAgICAgICAgT2JqZWN0LmtleXMoZmVhdHVyZVR5cGVGdWxsLnByb3BlcnRpZXMpCiAgICAgICk7CiAgICAgIHJldHVybiBxdWVyeVhtbERvY3VtZW50KGdldEZlYXR1cmVVcmwpLnRoZW4oKGdldEZlYXR1cmVEb2MpID0+ICh7CiAgICAgICAgcHJvcHM6IGNvbXB1dGVGZWF0dXJlUHJvcHNEZXRhaWxzKAogICAgICAgICAgcGFyc2VGZWF0dXJlUHJvcHMoZ2V0RmVhdHVyZURvYywgZmVhdHVyZVR5cGVGdWxsLCBzZXJ2aWNlVmVyc2lvbikKICAgICAgICApCiAgICAgIH0pKTsKICAgIH0KICApOwogIGFkZFRhc2tIYW5kbGVyKAogICAgInVwZGF0ZUZldGNoT3B0aW9ucyIsCiAgICBnbG9iYWxUaGlzLAogICAgKHsgb3B0aW9ucyB9KSA9PiB7CiAgICAgIHNldEZldGNoT3B0aW9ucyhvcHRpb25zKTsKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7fSk7CiAgICB9CiAgKTsKICBhZGRUYXNrSGFuZGxlcigKICAgICJwYXJzZVdtdHNDYXBhYmlsaXRpZXMiLAogICAgZ2xvYmFsVGhpcywKICAgICh7IHVybCB9KSA9PiBxdWVyeVhtbERvY3VtZW50KHVybCkudGhlbigoeG1sRG9jKSA9PiBjaGVjayh4bWxEb2MsIHVybCkpLnRoZW4oKHhtbERvYykgPT4gKHsKICAgICAgaW5mbzogcmVhZEluZm9Gcm9tQ2FwYWJpbGl0aWVzKHhtbERvYyksCiAgICAgIGxheWVyczogcmVhZExheWVyc0Zyb21DYXBhYmlsaXRpZXMoeG1sRG9jKSwKICAgICAgbWF0cml4U2V0czogcmVhZE1hdHJpeFNldHNGcm9tQ2FwYWJpbGl0aWVzKHhtbERvYykKICAgIH0pKQogICk7Cn0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXdvcmtlci1MRGtNT3gwZC5qcy5tYXAK",EO=typeof window<"u"&&window.Blob&&new Blob([atob(_B)],{type:"text/javascript;charset=utf-8"});function wre(n){let e;try{if(e=EO&&(window.URL||window.webkitURL).createObjectURL(EO),!e)throw"";const t=new Worker(e,{name:n?.name});return t.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:text/javascript;base64,"+_B,{name:n?.name})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}let RS;function Are(){return RS||(RS=new wre),RS}function Sre(n){return Cre("parseWmsCapabilities",Are(),{url:n})}var MS,TO;function Ere(){if(TO)return MS;TO=1;var n=Object.defineProperty,e=Object.getOwnPropertyDescriptor,t=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,r=(se,q)=>{for(var j in q)n(se,j,{get:q[j],enumerable:!0})},o=(se,q,j,ze)=>{if(q&&typeof q=="object"||typeof q=="function")for(let je of t(q))!i.call(se,je)&&je!==j&&n(se,je,{get:()=>q[je],enumerable:!(ze=e(q,je))||ze.enumerable});return se},s=se=>o(n({},"__esModule",{value:!0}),se),l={};r(l,{XmlCdata:()=>te,XmlComment:()=>$,XmlDeclaration:()=>ae,XmlDocument:()=>Y,XmlDocumentType:()=>de,XmlElement:()=>fe,XmlError:()=>D,XmlNode:()=>z,XmlProcessingInstruction:()=>oe,XmlText:()=>H,parseXml:()=>Ee}),MS=s(l);var u="",h=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,d=class{constructor(se){if(this.k=this.u(se,!0),this.d=0,this.length=se.length,this.l=this.k!==this.length,this.h=se,this.l){let q=[];for(let j=0,ze=0;ze<this.k;++ze)q[ze]=j,j+=se.codePointAt(j)>65535?2:1;this.A=q}}get B(){return this.d>=this.k}u(se,q=this.l){return q?se.replace(h,"_").length:se.length}p(se=1){this.d=Math.min(this.k,this.d+se)}f(se=this.d){var q;return this.l?(q=this.A[se])!=null?q:1/0:se}G(se=1){let q=this.m(se);return this.p(se),q}v(se){let q=this.f(),j=this.h.slice(q,q+se);return this.p(this.u(j)),j}w(se){let{length:q,l:j,h:ze}=this,je=this.f(),qe=je;if(j)for(;qe<q;){let yt=ze[qe],xt=yt>="\uD800"&&yt<="\uDBFF";if(xt&&(yt+=ze[qe+1]),!se(yt))break;qe+=xt?2:1}else for(;qe<q&&se(ze[qe]);)++qe;return this.v(qe-je)}b(se){let{length:q}=se,j=this.f();return se===this.h.slice(j,j+q)?(this.p(q===1?1:this.u(se)),se):u}x(se){let q=this.h.slice(this.f()).search(se);return q>0?this.v(q):u}s(se){let q=this.f(),j=this.h.indexOf(se,q);return j>0?this.v(j-q):u}m(se=1){let{d:q,h:j}=this;return this.l?j.slice(this.f(q),this.f(q+se)):j.slice(q,q+se)}n(se=0){this.d=se>=0?Math.min(this.k,se):Math.max(0,this.d+se)}},m=/["&<]/,y=/['&<]/,x=/\r\n|[\n\r\t]/g,C=/<|&|]]>/,w=Object.freeze(Object.assign(Object.create(null),{amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}));function E(se){let q=se.codePointAt(0);return q>=97&&q<=122||q>=65&&q<=90||q>=48&&q<=57||q===45||q===46||q===183||q>=768&&q<=879||q===8255||q===8256||T(se,q)}function T(se,q=se.codePointAt(0)){return q>=97&&q<=122||q>=65&&q<=90||q===58||q===95||q>=192&&q<=214||q>=216&&q<=246||q>=248&&q<=767||q>=880&&q<=893||q>=895&&q<=8191||q===8204||q===8205||q>=8304&&q<=8591||q>=11264&&q<=12271||q>=12289&&q<=55295||q>=63744&&q<=64975||q>=65008&&q<=65533||q>=65536&&q<=983039}function k(se){return se==="#"||E(se)}function G(se){let q=se.codePointAt(0);return q===32||q===9||q===10||q===13}function O(se){return se>=32&&se<=55295||se===10||se===9||se===13||se>=57344&&se<=65533||se>=65536&&se<=1114111}var V=class vB{constructor(){this.parent=null,this.start=-1,this.end=-1}get document(){var q,j;return(j=(q=this.parent)==null?void 0:q.document)!=null?j:null}get isRootNode(){return this.parent!==null&&this.parent===this.document&&this.type===vB.TYPE_ELEMENT}get preserveWhitespace(){var q;return!!((q=this.parent)!=null&&q.preserveWhitespace)}get type(){return""}toJSON(){let q={type:this.type};return this.isRootNode&&(q.isRootNode=!0),this.preserveWhitespace&&(q.preserveWhitespace=!0),this.start!==-1&&(q.start=this.start,q.end=this.end),q}};V.TYPE_CDATA="cdata",V.TYPE_COMMENT="comment",V.TYPE_DOCUMENT="document",V.TYPE_DOCUMENT_TYPE="doctype",V.TYPE_ELEMENT="element",V.TYPE_PROCESSING_INSTRUCTION="pi",V.TYPE_TEXT="text",V.TYPE_XML_DECLARATION="xmldecl";var z=V,H=class extends z{constructor(se=""){super(),this.text=se}get type(){return z.TYPE_TEXT}toJSON(){return Object.assign(z.prototype.toJSON.call(this),{text:this.text})}},te=class extends H{get type(){return z.TYPE_CDATA}},$=class extends z{constructor(se=""){super(),this.content=se}get type(){return z.TYPE_COMMENT}toJSON(){return Object.assign(z.prototype.toJSON.call(this),{content:this.content})}},ae=class extends z{constructor(se,q,j){super(),this.version=se,this.encoding=q??null,this.standalone=j??null}get type(){return z.TYPE_XML_DECLARATION}toJSON(){let se=z.prototype.toJSON.call(this);se.version=this.version;for(let q of["encoding","standalone"])this[q]!==null&&(se[q]=this[q]);return se}},fe=class bB extends z{constructor(q,j=Object.create(null),ze=[]){super(),this.name=q,this.attributes=j,this.children=ze}get isEmpty(){return this.children.length===0}get preserveWhitespace(){let q=this;for(;q instanceof bB;){if("xml:space"in q.attributes)return q.attributes["xml:space"]==="preserve";q=q.parent}return!1}get text(){return this.children.map(q=>"text"in q?q.text:"").join("")}get type(){return z.TYPE_ELEMENT}toJSON(){return Object.assign(z.prototype.toJSON.call(this),{name:this.name,attributes:this.attributes,children:this.children.map(q=>q.toJSON())})}},Y=class extends z{constructor(se=[]){super(),this.children=se}get document(){return this}get root(){for(let se of this.children)if(se instanceof fe)return se;return null}get text(){return this.children.map(se=>"text"in se?se.text:"").join("")}get type(){return z.TYPE_DOCUMENT}toJSON(){return Object.assign(z.prototype.toJSON.call(this),{children:this.children.map(se=>se.toJSON())})}},de=class extends z{constructor(se,q,j,ze){super(),this.name=se,this.publicId=q??null,this.systemId=j??null,this.internalSubset=ze??null}get type(){return z.TYPE_DOCUMENT_TYPE}toJSON(){let se=z.prototype.toJSON.call(this);se.name=this.name;for(let q of["publicId","systemId","internalSubset"])this[q]!==null&&(se[q]=this[q]);return se}},D=class extends Error{constructor(se,q,j){let ze=1,je="",qe=1;for(let Et=0;Et<q;++Et){let kt=j[Et];kt===`
`?(ze=1,je="",qe+=1):(ze+=1,je+=kt)}let yt=j.indexOf(`
`,q);je+=yt===-1?j.slice(q):j.slice(q,yt);let xt=0;je.length>50&&(ze<40?je=je.slice(0,50):(xt=ze-20,je=je.slice(xt,ze+30))),super(`${se} (line ${qe}, column ${ze})
  ${je}
`+" ".repeat(ze-xt+1)+`^
`),this.column=ze,this.excerpt=je,this.line=qe,this.name="XmlError",this.pos=q}},oe=class extends z{constructor(se,q=""){super(),this.name=se,this.content=q}get type(){return z.TYPE_PROCESSING_INSTRUCTION}toJSON(){return Object.assign(z.prototype.toJSON.call(this),{name:this.name,content:this.content})}},ue="",ge=class{constructor(se,q={}){let j=this.document=new Y;this.j=j,this.g=q,this.c=new d(se),this.g.includeOffsets&&(j.start=0,j.end=se.length),this.parse()}i(se,q){return se.parent=this.j,this.g.includeOffsets&&(se.start=this.c.f(q),se.end=this.c.f()),this.j.children.push(se),!0}y(se,q){let{children:j}=this.j,{length:ze}=j;if(se=Ne(se),ze>0){let je=j[ze-1];if(je?.type===z.TYPE_TEXT){let qe=je;return qe.text+=se,this.g.includeOffsets&&(qe.end=this.c.f()),!0}}return this.i(new H(se),q)}H(){let se=Object.create(null);for(;this.e();){let q=this.q();if(!q)break;let j=this.t()&&this.I();if(j===!1)throw this.a("Attribute value expected");if(q in se)throw this.a(`Duplicate attribute: ${q}`);if(q==="xml:space"&&j!=="default"&&j!=="preserve")throw this.a('Value of the `xml:space` attribute must be "default" or "preserve"');se[q]=j}if(this.g.sortAttributes){let q=Object.keys(se).sort(),j=Object.create(null);for(let ze=0;ze<q.length;++ze){let je=q[ze];j[je]=se[je]}se=j}return se}I(){let{c:se}=this,q=se.m();if(q!=='"'&&q!=="'")return!1;se.p();let j,ze=!1,je=ue,qe=q==='"'?m:y;e:for(;!se.B;)switch(j=se.x(qe),j&&(this.o(j),je+=j.replace(x," ")),se.m()){case q:ze=!0;break e;case"&":je+=this.C();continue;case"<":throw this.a("Unescaped `<` is not allowed in an attribute value");default:break e}if(!ze)throw this.a("Unclosed attribute");return se.p(),je}J(){let{c:se}=this,q=se.d;if(!se.b("<![CDATA["))return!1;let j=se.s("]]>");if(this.o(j),!se.b("]]>"))throw this.a("Unclosed CDATA section");return this.g.preserveCdata?this.i(new te(Ne(j)),q):this.y(j,q)}K(){let{c:se}=this,q=se.d,j=se.x(C);if(!j)return!1;if(this.o(j),se.m(3)==="]]>")throw this.a("Element content may not contain the CDATA section close delimiter `]]>`");return this.y(j,q)}D(){let{c:se}=this,q=se.d;if(!se.b("<!--"))return!1;let j=se.s("--");if(this.o(j),!se.b("-->"))throw se.m(2)==="--"?this.a("The string `--` isn't allowed inside a comment"):this.a("Unclosed comment");return this.g.preserveComments?this.i(new $(Ne(j)),q):!0}L(){let se=this.c.d,q=this.C();return q?this.y(q,se):!1}M(){let{c:se}=this,q=se.d;if(!se.b("<!DOCTYPE"))return!1;let j=this.e()&&this.q();if(!j)throw this.a("Expected a name");let ze,je;if(this.e()){if(se.b("PUBLIC")){if(ze=this.e()&&this.N(),ze===!1)throw this.a("Expected a public identifier");this.e()}if(ze!==void 0||se.b("SYSTEM")){if(this.e(),je=this.r(),je===!1)throw this.a("Expected a system identifier");this.e()}}let qe;if(se.b("[")){if(qe=se.x(/\][\x20\t\r\n]*>/),!se.b("]"))throw this.a("Unclosed internal subset");this.e()}if(!se.b(">"))throw this.a("Unclosed doctype declaration");return this.g.preserveDocumentType?this.i(new de(j,ze,je,qe),q):!0}E(){let{c:se}=this,q=se.d;if(!se.b("<"))return!1;let j=this.q();if(!j)return se.n(q),!1;let ze=this.H(),je=!!se.b("/>"),qe=new fe(j,ze);if(qe.parent=this.j,!je){if(!se.b(">"))throw this.a(`Unclosed start tag for element \`${j}\``);this.j=qe;do this.K();while(this.E()||this.L()||this.J()||this.F()||this.D());let yt=se.d,xt;if(!se.b("</")||!(xt=this.q())||xt!==j)throw se.n(yt),this.a(`Missing end tag for element ${j}`);if(this.e(),!se.b(">"))throw this.a(`Unclosed end tag for element ${j}`);this.j=qe.parent}return this.i(qe,q)}t(){return this.e(),this.c.b("=")?(this.e(),!0):!1}z(){return this.D()||this.F()||this.e()}q(){return T(this.c.m())?this.c.w(E):ue}F(){let{c:se}=this,q=se.d;if(!se.b("<?"))return!1;let j=this.q();if(j){if(j.toLowerCase()==="xml")throw se.n(q),this.a("XML declaration isn't allowed here")}else throw this.a("Invalid processing instruction");if(!this.e()){if(se.b("?>"))return this.i(new oe(j),q);throw this.a("Whitespace is required after a processing instruction name")}let ze=se.s("?>");if(this.o(ze),!se.b("?>"))throw this.a("Unterminated processing instruction");return this.i(new oe(j,Ne(ze)),q)}O(){let{c:se}=this,q=se.d;for(this.P();this.z(););if(this.M())for(;this.z(););return q<se.d}N(){let se=this.c.d,q=this.r();if(q!==!1&&!/^[-\x20\r\na-zA-Z0-9'()+,./:=?;!*#@$_%]*$/.test(q))throw this.c.n(se),this.a("Invalid character in public identifier");return q}C(){let{c:se}=this;if(!se.b("&"))return!1;let q=se.w(k);if(se.G()!==";")throw this.a("Unterminated reference (a reference must end with `;`)");let j;if(q[0]==="#"){let ze=q[1]==="x"?parseInt(q.slice(2),16):parseInt(q.slice(1),10);if(isNaN(ze))throw this.a("Invalid character reference");if(!O(ze))throw this.a("Character reference resolves to an invalid character");j=String.fromCodePoint(ze)}else if(j=w[q],j===void 0){let{ignoreUndefinedEntities:ze,resolveUndefinedEntity:je}=this.g,qe=`&${q};`;if(je){let yt=je(qe);if(yt!=null){let xt=typeof yt;if(xt!=="string")throw new TypeError(`\`resolveUndefinedEntity()\` must return a string, \`null\`, or \`undefined\`, but returned a value of type ${xt}`);return yt}}if(ze)return qe;throw se.n(-qe.length),this.a(`Named entity isn't defined: ${qe}`)}return j}r(){let{c:se}=this,q=se.b('"')||se.b("'");if(!q)return!1;let j=se.s(q);if(this.o(j),!se.b(q))throw this.a("Missing end quote");return j}e(){return!!this.c.w(G)}P(){let{c:se}=this,q=se.d;if(!se.b("<?xml"))return!1;if(!this.e())throw this.a("Invalid XML declaration");let j=!!se.b("version")&&this.t()&&this.r();if(j===!1)throw this.a("XML version is missing or invalid");if(!/^1\.[0-9]+$/.test(j))throw this.a("Invalid character in version number");let ze,je;if(this.e()){if(ze=!!se.b("encoding")&&this.t()&&this.r(),ze){if(!/^[A-Za-z][\w.-]*$/.test(ze))throw this.a("Invalid character in encoding name");this.e()}if(je=!!se.b("standalone")&&this.t()&&this.r(),je){if(je!=="yes"&&je!=="no")throw this.a('Only "yes" and "no" are permitted as values of `standalone`');this.e()}}if(!se.b("?>"))throw this.a("Invalid or unclosed XML declaration");return this.g.preserveXmlDeclaration?this.i(new ae(j,ze||void 0,je||void 0),q):!0}a(se){let{c:q}=this;return new D(se,q.d,q.h)}parse(){if(this.c.b("\uFEFF"),this.O(),!this.E())throw this.a("Root element is missing or invalid");for(;this.z(););if(!this.c.B)throw this.a("Extra content at the end of the document")}o(se){let{length:q}=se;for(let j=0;j<q;++j){let ze=se.codePointAt(j);if(!O(ze))throw this.c.n(-([...se].length-j)),this.a("Invalid character");ze>65535&&(j+=1)}}};function Ne(se){let q=0;for(;(q=se.indexOf("\r",q))!==-1;)se=se[q+1]===`
`?se.slice(0,q)+se.slice(q+1):se.slice(0,q)+`
`+se.slice(q+1);return se}function Ee(se,q){return new ge(se,q).document}return MS}var xB=Ere();class Tre extends Error{constructor(e){super(e)}}function Rre(n){let e=null;try{e=xB.parseXml(n)}catch(t){throw new Tre(t.message)}return e}function Oc(n){const e=n.indexOf(":");return e>-1?n.substr(e+1):n}function so(n){return n.children[0]}function Nc(n){return n.name||""}function pi(n,e,t=!1){const i=Oc(e);function r(o,s){return Oc(Nc(s))===i&&o.push(s),t&&Array.isArray(s.children)?[...o,...s.children.reduce(r,[])]:o}return n&&Array.isArray(n.children)?n.children.reduce(r,[]):[]}function gt(n,e,t=!1){return pi(n,e,t)[0]||null}function Ic(n){return n&&Array.isArray(n.children)?[...n.children.filter(e=>e instanceof xB.XmlElement)]:[]}function Ut(n){const e=n&&Array.isArray(n.children)?n.children.find(t=>t.type==="text"):null;return e?e.text:""}function Ki(n,e){return n&&n.attributes[e]||""}class II extends Error{constructor(e,t,i){super(e),this.httpStatus=t,this.isCrossOriginRelated=i,this.name="EndpointError"}}class IB extends Error{constructor(e,t,i,r,o){super(e),this.requestUrl=t,this.code=i,this.locator=r,this.response=o,this.name="ServiceExceptionError"}}function RO(n,e){const t=Ki(n,"code")||Ki(n,"exceptionCode"),i=Ki(n,"locator"),r=gt(n,"ExceptionText")||n,o=Ut(r).trim();return new IB(o,e,t,i,n.document)}function rk(n,e){const t=so(n),i=Oc(Nc(t));if(i==="ServiceExceptionReport"){const r=gt(t,"ServiceException");if(r)throw RO(r,e)}if(i==="ExceptionReport"){const r=gt(t,"Exception");if(r)throw RO(r,e)}return n}function Mre(n){const e={message:n.message,stack:n.stack,name:n.name};return n instanceof IB?{...e,code:n.code,locator:n.locator,response:n.response,requestUrl:n.requestUrl}:n instanceof II?{...e,httpStatus:n.httpStatus,isCrossOriginRelated:n.isCrossOriginRelated}:e}const MO=["utf-8","utf-16","iso-8859-1"],kO="utf-8";function kre(n){const e=/charset=([^;]+)/.exec(n);return e?e[1]:null}function Lre(n,e){const t=e?kre(e):null,i=t?[t,...MO]:MO;for(const r of i)try{return new TextDecoder(r,{fatal:!0}).decode(n)}catch{}return console.warn(`[ogc-client] XML document encoding could not be determined, falling back to ${kO}.`),new TextDecoder(kO).decode(n)}const Ax=new Map;let CB={};function Pre(n){CB=n}function wB(){return CB}function Gre(n,e="GET",t){let i=`${e}#${n}`;if(Ax.has(i))return Ax.get(i);const r={...wB()};r.method=e;const o=fetch(n,r).catch(s=>s).then(s=>(Ax.delete(i),s));return Ax.set(i,o),o.then(s=>{if(s instanceof Error)throw s;return s.clone()})}function cA(n){return Gre(n).catch(()=>fetch(n,{...wB(),method:"HEAD",mode:"no-cors"}).catch(e=>{throw new II(`Fetching the document failed either due to network errors or unreachable host, error is: ${e.message}`,0,!1)}).then(()=>{throw new II("The document could not be fetched due to CORS limitations",0,!0)})).then(async e=>{if(!e.ok){const r=await e.text();throw new II(`Received an error with code ${e.status}: ${r}`,e.status,!1)}const t=await e.arrayBuffer(),i=e.headers.get("Content-Type");return Lre(t,i)}).then(e=>Rre(e))}function jv(n,e){const t=n.match(/(https?%3A%2F%2F[^/]+)$/);if(t){const l=t[1],u=jv(decodeURIComponent(l),e);return n.replace(l,encodeURIComponent(u))}const i=new URL(n),r=Object.keys(e),o=r.map(l=>l.toLowerCase()),s=[];for(const l of i.searchParams.keys())o.indexOf(l.toLowerCase())>-1&&s.push(l);return s.map(l=>i.searchParams.delete(l)),r.forEach(l=>i.searchParams.set(l,e[l]===!0?"":e[l])),i.toString()}let Fre=1e3*60*60;function Ore(){return Fre}let Ap;function hA(){return Ap!==void 0?Ap:"caches"in globalThis?(Ap=caches.open("ogc-client").catch(n=>(console.info("[ogc-client] Cache could not be accessed for the following reason:",n),null)),Ap):(Ap=Promise.resolve(null),Ap)}async function Nre(n,...e){const t=await hA();if(!t)return;const i="https://cache/"+e.join("/");try{await t.put(i,new Response(JSON.stringify(n),{headers:{"x-expiry":(Date.now()+Ore()).toString(10)}}))}catch(r){console.info("[ogc-client] Caching failed once for the following reason and will not be retried:",r),Ap=Promise.resolve(null)}}async function Dre(...n){const e=await hA();if(!e)return;const t="https://cache/"+n.join("/");return e.match(t).then(i=>!!i&&parseInt(i.headers.get("x-expiry"))>Date.now())}async function Vre(...n){const e=await hA();if(!e)return;const t="https://cache/"+n.join("/"),i=await e.match(t);return i?i.clone().json():null}const Sx=new Map;async function Bre(n,...e){if(await Zre(),await Dre(...e))return Vre(...e);const t=e.join("#");if(Sx.has(t))return Sx.get(t);const i=n();i instanceof Promise&&(i.then(()=>Sx.delete(t)),Sx.set(t,i));const r=await i;return await Nre(r,...e),r}async function Zre(){const n=await hA();if(!n)return;const e=await n.keys();for(const t of e){const i=await n.match(t);parseInt(i.headers.get("x-expiry"))<=Date.now()&&await n.delete(t)}}function Wre(n,e,t,i,r,o,s,l,u,h,d,m){const x={SERVICE:"WFS",REQUEST:"GetFeature",VERSION:e,[e==="2.0.0"?"TYPENAMES":"TYPENAME"]:t};o!==void 0&&(x.PROPERTYNAME=o.join(","));const C=new URL(jv(n,x));if(Array.isArray(m)&&m.length>0){const w=m.map(E=>`${E[1]} ${E[0]}`).join(",");C.searchParams.set("SORTBY",w)}return C.toString()}function zre(n,e,t,i,r,o,s,l,u){const h=e==="1.3.0"?"CRS":"SRS",d={SERVICE:"WMS",REQUEST:"GetMap",VERSION:e,LAYERS:t,STYLES:u??""};return d.WIDTH=i.toString(),d.HEIGHT=r.toString(),d.FORMAT=l??"image/png",d[h]=o,d.BBOX=s.join(","),jv(n,d)}class Ure{_capabilitiesUrl;_capabilitiesPromise;_info;_layers;_url;_version;constructor(e){this._capabilitiesUrl=jv(e,{SERVICE:"WMS",REQUEST:"GetCapabilities"}),this._capabilitiesPromise=Bre(()=>Sre(this._capabilitiesUrl),"WMS","CAPABILITIES",this._capabilitiesUrl).then(({info:t,layers:i,url:r,version:o})=>{this._info=t,this._layers=i,this._url=r,this._version=o})}isReady(){return this._capabilitiesPromise.then(()=>this)}getServiceInfo(){return this._info}getLayers(){function e(t){return{title:t.title,name:t.name,abstract:t.abstract,..."children"in t&&{children:t.children.map(e)}}}return this._layers.map(e)}getFlattenedLayers(){return this.getLayers().flatMap(AB)}getLayerByName(e){let t=null;function i(r){if(t===null){if(r.name===e){t=r;return}"children"in r&&r.children.map(i)}}return this._layers.map(i),t}getSingleLayerName(){if(!this._layers)return null;const e=[];function t(i){i.name&&e.push(i),"children"in i&&i.children.map(t)}return this._layers.map(t),e.length===1?e[0].name:null}getVersion(){return this._version}getMapUrl(e,t){if(!this._layers)return null;const{widthPx:i,heightPx:r,crs:o,extent:s,outputFormat:l,styles:u}=t;return zre(this.getOperationUrl("GetMap")||this._capabilitiesUrl,this._version,e.join(","),i,r,o,s,l,u!==void 0?u.join(","):"")}getCapabilitiesUrl(){const e=this.getOperationUrl("GetCapabilities");return e?jv(e,{SERVICE:"WMS",REQUEST:"GetCapabilities"}):this._capabilitiesUrl}getOperationUrl(e,t="Get"){return this._url?this._url[e]?.[t]:null}}function AB(n){const e={title:n.title,name:n.name,abstract:n.abstract};return"children"in n&&Array.isArray(n.children)?[e,...n.children.flatMap(AB)]:[e]}const LO=new EventTarget;function kb(n,e,t){const i=typeof WorkerGlobalScope<"u",r=async o=>{if(o.taskName===n){let s,l;try{s=await t(o.params)}catch(h){l=Mre(h)}const u={taskName:n,requestId:o.requestId,...s&&{response:s},...l&&{error:l}};i?e.postMessage(u):LO.dispatchEvent(new CustomEvent("ogc-client.response",{detail:u}))}};i?e.addEventListener("message",o=>r(o.data)):LO.addEventListener("ogc-client.request",o=>r(o.detail))}const Xre=["EPSG:4046","EPSG:4075","EPSG:4120","EPSG:4122","EPSG:4124","EPSG:4126","EPSG:4149","EPSG:4151","EPSG:4153","EPSG:4155","EPSG:4157","EPSG:4159","EPSG:4161","EPSG:4163","EPSG:4165","EPSG:4167","EPSG:4169","EPSG:4171","EPSG:4173","EPSG:4175","EPSG:4178","EPSG:4180","EPSG:4182","EPSG:4184","EPSG:4188","EPSG:4190","EPSG:4191","EPSG:4196","EPSG:4198","EPSG:4202","EPSG:4210","EPSG:4211","EPSG:4214","EPSG:4226","EPSG:4229","EPSG:4231","EPSG:4233","EPSG:4236","EPSG:4238","EPSG:4240","EPSG:4242","EPSG:4244","EPSG:4246","EPSG:4248","EPSG:4250","EPSG:4252","EPSG:4255","EPSG:4258","EPSG:4261","EPSG:4264","EPSG:4267","EPSG:4270","EPSG:4273","EPSG:4276","EPSG:4279","EPSG:4281","EPSG:4284","EPSG:4286","EPSG:4288","EPSG:4292","EPSG:4295","EPSG:4297","EPSG:4299","EPSG:4302","EPSG:4324","EPSG:4326"];function Yre(n){return Xre.indexOf(RT(n))>-1}function RT(n){return/^urn:(?:x-)?ogc:def:crs:epsg:/.test(n.toLowerCase())?`EPSG:${/([0-9]+)$/.exec(n)[1]}`:n}function Hre(n){const e={},t=gt(so(n),"Capability"),i=gt(t,"Request");return Ic(i).forEach(r=>{const o=Oc(Nc(r));e[o]=Qre(r)}),e}function SB(n){return so(n).attributes.version}function Kre(n){const e=SB(n),t=gt(so(n),"Capability");return pi(t,"Layer").map(i=>EB(i,e))}function jre(n){const e=gt(so(n),"Capability"),t=gt(gt(e,"Request"),"GetMap");return pi(t,"Format").map(Ut)}function $re(n){const e=gt(so(n),"Capability"),t=gt(gt(e,"Request"),"GetFeatureInfo");return pi(t,"Format").map(Ut)}function Jre(n){const e=gt(so(n),"Capability"),t=gt(e,"Exception");return pi(t,"Format").map(Ut)}function qre(n){const e=gt(so(n),"Service"),t=jre(n),i=$re(n),r=Jre(n),o=pi(gt(e,"KeywordList"),"Keyword").map(Ut).filter((l,u,h)=>h.indexOf(l)===u),s=nse(n);return{title:Ut(gt(e,"Title")),name:Ut(gt(e,"Name")),abstract:Ut(gt(e,"Abstract")),outputFormats:t,infoFormats:i,exceptionFormats:r,fees:Ut(gt(e,"Fees")),constraints:Ut(gt(e,"AccessConstraints")),provider:s,keywords:o}}function Qre(n){const e={};return pi(n,"DCPType").flatMap(o=>gt(o,"HTTP")).flatMap(o=>Ic(o)).forEach(o=>{const s=gt(o,"OnlineResource"),l=Oc(Nc(o));e[l]=Ki(s,"xlink:href")}),e}function EB(n,e,t=[],i=[],r=null,o=null,s=null,l=null){const u=e==="1.3.0"?"CRS":"SRS",h=pi(n,u).map(Ut),d=h.length>0?h:t,m=pi(n,"Style").map(ese),y=m.length>0?m:i;function x(oe){const ue=Ki(oe,u);return(Yre(ue)&&e==="1.3.0"?["miny","minx","maxy","maxx"]:["minx","miny","maxx","maxy"]).map(Ne=>Ki(oe,Ne))}function C(oe){return["westBoundLongitude","southBoundLatitude","eastBoundLongitude","northBoundLatitude"].map(ue=>Ut(gt(oe,ue)))}function w(oe){return["minx","miny","maxx","maxy"].map(ue=>Ki(oe,ue))}function E(oe,ue){return oe===""?ue:Math.sqrt(.5*parseFloat(oe)**2)/28e-5}function T(){const oe=gt(n,"ScaleHint");if(!oe)return[l,s];const ue=Ki(oe,"min"),ge=Ki(oe,"max");return[E(ue,l),E(ge,s)]}function k(oe,ue){const ge=Ut(gt(n,oe));return ge===""?ue:parseFloat(ge)}const G=gt(n,"Attribution"),O=G!==null?tse(G):r,V=e==="1.3.0"?gt(n,"EX_GeographicBoundingBox"):gt(n,"LatLonBoundingBox"),z={};V&&(z["EPSG:4326"]=e==="1.3.0"?C(V):w(V));let H=pi(n,"BoundingBox").reduce((oe,ue)=>({...oe,[Ki(ue,u)]:x(ue)}),z);H=Object.keys(H).length>0||o===null?H:o;const te=n.attributes.queryable==="1"||n.attributes.queryable==="true",$=n.attributes.opaque==="1"||n.attributes.opaque==="true",ae=pi(gt(n,"KeywordList"),"Keyword").map(Ut).filter((oe,ue,ge)=>ge.indexOf(oe)===ue);let fe,Y;e==="1.3.0"?(fe=k("MinScaleDenominator",l),Y=k("MaxScaleDenominator",s)):[fe,Y]=T();const de=pi(n,"MetadataURL").map(oe=>({type:Ki(oe,"type"),format:Ut(gt(oe,"Format")),url:Ki(gt(oe,"OnlineResource"),"xlink:href")})),D=pi(n,"Layer").map(oe=>EB(oe,e,d,y,O,H,Y,fe));return{name:Ut(gt(n,"Name")),title:Ut(gt(n,"Title")),abstract:Ut(gt(n,"Abstract")),availableCrs:d,styles:y,attribution:O,boundingBoxes:H,keywords:ae,queryable:te,opaque:$,...fe!==null?{minScaleDenominator:fe}:{},...Y!==null?{maxScaleDenominator:Y}:{},...de.length&&{metadata:de},...D.length&&{children:D}}}function ese(n){const e=Ki(gt(gt(n,"LegendURL"),"OnlineResource"),"xlink:href"),t=Ut(gt(n,"Abstract"));return{name:Ut(gt(n,"Name")),title:Ut(gt(n,"Title")),...t&&{abstract:t},...e&&{legendUrl:e}}}function tse(n){const e=Ki(gt(gt(n,"LogoURL"),"OnlineResource"),"xlink:href"),t=Ki(gt(n,"OnlineResource"),"xlink:href"),i=Ut(gt(n,"Title"));return{...i&&{title:i},...t&&{url:t},...e&&{logoUrl:e}}}function nse(n){const e=gt(so(n),"Service"),t=gt(e,"ContactInformation"),i=gt(t,"ContactPersonPrimary"),r=gt(t,"ContactAddress");return{contact:{name:Ut(gt(i,"ContactPerson")),organization:Ut(gt(i,"ContactOrganization")),position:Ut(gt(t,"ContactPosition")),phone:Ut(gt(t,"ContactVoiceTelephone")),fax:Ut(gt(t,"ContactFacsimileTelephone")),address:{deliveryPoint:Ut(gt(r,"Address")),city:Ut(gt(r,"City")),administrativeArea:Ut(gt(r,"StateOrProvince")),postalCode:Ut(gt(r,"PostCode")),country:Ut(gt(r,"Country"))},email:Ut(gt(t,"ContactElectronicMailAddress"))}}}function TB(n){const e=gt(so(n),"ServiceProvider"),t=gt(e,"ServiceContact"),i=gt(t,"ContactInfo"),r=gt(i,"Phone"),o=gt(i,"Address");return{name:Ut(gt(e,"ProviderName")),site:Ki(gt(e,"ProviderSite"),"xlink:href"),contact:{name:Ut(gt(t,"IndividualName")),position:Ut(gt(t,"PositionName")),phone:Ut(gt(r,"Voice")),fax:Ut(gt(r,"Facsimile")),address:{deliveryPoint:Ut(gt(o,"DeliveryPoint")),city:Ut(gt(o,"City")),administrativeArea:Ut(gt(o,"AdministrativeArea")),postalCode:Ut(gt(o,"PostalCode")),country:Ut(gt(o,"Country"))},email:Ut(gt(o,"ElectronicMailAddress"))}}}function ise(n){const e={},t=so(n),i=gt(t,"OperationsMetadata");if(i)pi(i,"Operation").forEach(r=>{const o=Ki(r,"name");e[o]=ase(r)});else{const r=gt(t,"Capability"),o=gt(r,"Request");Ic(o).forEach(s=>{const l=Oc(Nc(s));e[l]=ose(s)})}return e}function dA(n){return so(n).attributes.version}function RB(n){const e=dA(n);let t;if(e.startsWith("1.0")){const i=gt(gt(gt(so(n),"Capability"),"Request"),"GetFeature");t=Ic(gt(i,"ResultFormat")).map(Nc)}else{const i=gt(so(n),"OperationsMetadata"),r=pi(i,"Operation").find(s=>Ki(s,"name")==="GetFeature"),o=pi(r,"Parameter").find(s=>Ki(s,"name")==="outputFormat");t=pi(o,"Value",!0).map(Ut)}return t}function rse(n){const e=dA(n),t=e.startsWith("1.0")?"Service":"ServiceIdentification",i=e.startsWith("1.0")?"Name":"ServiceType",r=gt(so(n),t);let o;e.startsWith("1.0")?o=Ut(gt(r,"Keywords")).split(",").map(l=>l.trim()):o=pi(gt(r,"Keywords"),"Keyword").map(Ut);let s;return e!=="1.0.0"&&(s=TB(n)),{title:Ut(gt(r,"Title")),name:Ut(gt(r,i)),abstract:Ut(gt(r,"Abstract")),fees:Ut(gt(r,"Fees")),constraints:Ut(gt(r,"AccessConstraints")),keywords:o,provider:s,outputFormats:RB(n)}}function sse(n){const e=dA(n),t=RB(n),i=gt(so(n),"FeatureTypeList");return pi(i,"FeatureType").map(r=>lse(r,e,t))}function ose(n){const e={};return pi(n,"DCPType").flatMap(o=>pi(o,"HTTP")).flatMap(o=>Ic(o)).forEach(o=>{const s=Oc(Nc(o));e[s]=Ki(o,"onlineResource")}),e}function ase(n){const e={};return pi(n,"DCP").flatMap(o=>gt(o,"HTTP")).flatMap(o=>Ic(o)).forEach(o=>{const s=Oc(Nc(o));e[s]=Ki(o,"xlink:href")}),e}function lse(n,e,t){const i=e.startsWith("2.")?"CRS":"SRS",r=e.startsWith("1.0")?"SRS":`Default${i}`;function o(){const m=gt(n,"LatLongBoundingBox");return["minx","miny","maxx","maxy"].map(y=>Ki(m,y)).map(parseFloat)}function s(){const m=gt(n,"WGS84BoundingBox");return["LowerCorner","UpperCorner"].map(y=>gt(m,y)).map(y=>Ut(y).split(" ")).reduce((y,x)=>[...y,...x]).map(parseFloat)}const l=e.startsWith("1.0")?[]:pi(n,`Other${i}`).map(Ut).map(RT),u=e.startsWith("1.0")?[]:pi(gt(n,"OutputFormats"),"Format").map(Ut),h=e.startsWith("1.0")?Ut(gt(n,"Keywords")).split(",").map(m=>m.trim()):pi(gt(n,"Keywords"),"Keyword").map(Ut).filter((m,y,x)=>x.indexOf(m)===y),d=e==="2.0.0"?pi(n,"MetadataURL").map(m=>({url:Ki(m,"xlink:href")})):pi(n,"MetadataURL").map(m=>({format:Ki(m,"format"),type:Ki(m,"type"),url:Ut(m).trim()}));return{name:Ut(gt(n,"Name")),title:Ut(gt(n,"Title")),abstract:Ut(gt(n,"Abstract")),defaultCrs:RT(Ut(gt(n,r))),otherCrs:l,outputFormats:u.length>0?u:t,latLonBoundingBox:e.startsWith("1.0")?o():s(),keywords:h,...d.length&&{metadata:d}}}function MB(n){const e=["LowerCorner","UpperCorner"].map(t=>gt(n,t)).map(t=>Ut(t).split(" ")).reduce((t,i)=>[...t,...i]).map(parseFloat);return e.some(Number.isNaN)?null:e}function use(n){const e=so(n),t=gt(e,"ServiceIdentification"),i=pi(gt(t,"Keywords"),"Keyword").map(Ut),r=gt(e,"OperationsMetadata"),o=pi(r,"Operation").find(l=>Ki(l,"name")=="GetTile"),s=pi(o,"Get",!0).reduce((l,u)=>{const h=Ut(gt(u,"Value",!0)),d=Ki(u,"xlink:href");return h.toLowerCase()==="restful"?{...l,rest:d}:{...l,kvp:d}},{});return{title:Ut(gt(t,"Title")),name:Ut(gt(t,"ServiceType")),abstract:Ut(gt(t,"Abstract")),fees:Ut(gt(t,"Fees")),constraints:Ut(gt(t,"AccessConstraints")),keywords:i,provider:TB(n),getTileUrls:s}}function cse(n){function e(r){const o=Ut(gt(r,"TopLeftCorner")).split(" ").map(parseFloat);return{identifier:Ut(gt(r,"Identifier")),tileWidth:parseInt(Ut(gt(r,"TileWidth"))),tileHeight:parseInt(Ut(gt(r,"TileHeight"))),matrixWidth:parseInt(Ut(gt(r,"MatrixWidth"))),matrixHeight:parseInt(Ut(gt(r,"MatrixHeight"))),scaleDenominator:parseFloat(Ut(gt(r,"ScaleDenominator"))),topLeft:o}}const t=gt(so(n),"Contents");return pi(t,"TileMatrixSet").map(r=>{const o=Ut(gt(r,"WellKnownScaleSet")),s=MB(gt(r,"BoundingBox"));return{identifier:Ut(gt(r,"Identifier")),crs:Ut(gt(r,"SupportedCRS")),tileMatrices:pi(r,"TileMatrix").map(e),...s&&{boundingBox:s},...o&&{wellKnownScaleSet:o}}})}function hse(n){const e=so(n),t=gt(e,"Contents");function i(d,m){const y=pi(d,"TileMatrixSet").find(x=>{const C=gt(x,"Identifier");return Ut(C)===m});return Ut(gt(y,"SupportedCRS"))}function r(d){const m=Ut(gt(d,"TileMatrixSet")),y=i(t,m);return{identifier:m,crs:y,limits:pi(d,"TileMatrixLimits",!0).map(x=>({tileMatrix:Ut(gt(x,"TileMatrix")),minTileRow:parseInt(Ut(gt(x,"MinTileRow"))),minTileCol:parseInt(Ut(gt(x,"MinTileCol"))),maxTileRow:parseInt(Ut(gt(x,"MaxTileRow"))),maxTileCol:parseInt(Ut(gt(x,"MaxTileCol")))}))}}const o=pi(gt(e,"OperationsMetadata"),"Operation").find(d=>Ki(d,"name")=="GetTile"),s=pi(o,"Get",!0).filter(d=>Ut(gt(d,"Value",!0)).toLowerCase()==="kvp")[0],l=s?Ki(s,"xlink:href"):"",u=gt(e,"Contents");return pi(u,"Layer").map(d=>{const m=MB(gt(d,"WGS84BoundingBox"));let y="";const x=pi(d,"Style").map(k=>{const G=Ki(gt(k,"LegendURL"),"xlink:href"),O=Ut(gt(k,"Abstract")),V={title:Ut(gt(k,"Title")),name:Ut(gt(k,"Identifier")),...O&&{abstract:O},...G&&{legendUrl:G}};return Ki(k,"isDefault")==="true"&&(y=V.name),V}),C=pi(d,"Format").map(Ut),w=pi(d,"ResourceURL").filter(k=>Ki(k,"resourceType")==="tile").map(k=>{const G=Ki(k,"format"),O=Ki(k,"template");return{format:G,url:O,encoding:"REST"}});l&&w.push(...C.map(k=>({encoding:"KVP",url:l,format:k})));const E=pi(d,"TileMatrixSetLink").map(r),T=pi(d,"Dimension").map(k=>{const G=Ut(gt(k,"Identifier")),O=Ut(gt(k,"Default")),V=pi(k,"Values").map(Ut);return{identifier:G,defaultValue:O,values:V}});return{name:Ut(gt(d,"Identifier")),title:Ut(gt(d,"Title")),abstract:Ut(gt(d,"Abstract")),styles:x,resourceLinks:w,matrixSets:E,defaultStyle:y,...m&&{latLonBoundingBox:m},...T&&{dimensions:T}}})}function dse(n,e,t){const i=so(n);let r;if(t.startsWith("2.0"))r=pi(i,"member").map(h=>Ic(h)[0]);else{const h=gt(i,"featureMembers");r=h?Ic(h):pi(i,"featureMember").map(d=>Ic(d)[0])}const o=t==="1.0.0"?"fid":"gml:id";function s(h){return h in e.properties}function l(h,d){switch(e.properties[h]){case"integer":return parseInt(d);case"float":return parseFloat(d);case"boolean":return d==="true";default:return d}}function u(h){return Ic(h).filter(d=>s(Oc(Nc(d)))).reduce((d,m)=>{const y=Oc(Nc(m));return{...d,[y]:l(y,Ut(m))}},{})}return r.map(h=>({id:Ki(h,o),properties:u(h)}))}function fse(n){return n.reduce((e,t)=>{for(const i in t.properties){const r=t.properties[i];i in e||(e[i]={uniqueValues:[]});const o=e[i].uniqueValues.find(s=>s.value===r);o?o.count++:e[i].uniqueValues.push({value:r,count:1})}return e},{})}kb("parseWmsCapabilities",globalThis,({url:n})=>cA(n).then(e=>rk(e,n)).then(e=>({info:qre(e),layers:Kre(e),url:Hre(e),version:SB(e)})));kb("parseWfsCapabilities",globalThis,({url:n})=>cA(n).then(e=>rk(e,n)).then(e=>({info:rse(e),featureTypes:sse(e),url:ise(e),version:dA(e)})));kb("queryWfsFeatureTypeDetails",globalThis,({url:n,serviceVersion:e,featureTypeFull:t})=>{const i=Wre(n,e,t.name,void 0,void 0,Object.keys(t.properties));return cA(i).then(r=>({props:fse(dse(r,t,e))}))});kb("updateFetchOptions",globalThis,({options:n})=>(Pre(n),Promise.resolve({})));kb("parseWmtsCapabilities",globalThis,({url:n})=>cA(n).then(e=>rk(e,n)).then(e=>({info:use(e),layers:hse(e),matrixSets:cse(e)})));const pse=()=>[{url:"http://wmts1.geoportail.lu/opendata/service",label:"Open Data Webservices WMS"},{url:"http://ows.terrestris.de/osm-gray/service",label:"OpenStreetMap by Terrestris (Grey)"},{url:"http://ows.terrestris.de/osm/service",label:"OpenStreetMap by Terrestris (Color)"}],DC="http://www.w3.org/2001/XMLSchema-instance";function qh(n,e){return qy().createElementNS(n,e)}function Bu(n,e){return kB(n,e,[]).join("")}function kB(n,e,t){if(n.nodeType==Node.CDATA_SECTION_NODE||n.nodeType==Node.TEXT_NODE)t.push(n.nodeValue);else{let i;for(i=n.firstChild;i;i=i.nextSibling)kB(i,e,t)}return t}function Cc(n){return"documentElement"in n}function wc(n){return new DOMParser().parseFromString(n,"application/xml")}function PO(n,e){return(function(t,i){const r=n.call(e??this,t,i);if(r!==void 0){const o=i[i.length-1];nr(o,r)}})}function Ha(n,e){return(function(t,i){const r=n.call(e??this,t,i);r!==void 0&&i[i.length-1].push(r)})}function sk(n,e){return(function(t,i){const r=n.call(this,t,i);r!==void 0&&(i[i.length-1]=r)})}function Ua(n,e,t){return(function(i,r){const o=n.call(this,i,r);if(o!==void 0){const s=r[r.length-1],l=i.localName;let u;l in s?u=s[l]:(u=[],s[l]=u),u.push(o)}})}function ut(n,e,t){return(function(i,r){const o=n.call(this,i,r);if(o!==void 0){const s=r[r.length-1],l=e!==void 0?e:i.localName;s[l]=o}})}function jt(n,e){return(function(t,i,r){n.call(this,t,i,r),r[r.length-1].node.appendChild(t)})}function LB(n,e){let t,i;return function(r,o,s){if(t===void 0){t={};const l={};l[r.localName]=n,t[r.namespaceURI]=l,i=Zu(r.localName)}PB(t,i,o,s)}}function Zu(n,e){return(function(t,i,r){const s=i[i.length-1].node;let l=n;l===void 0&&(l=r);const u=s.namespaceURI;return qh(u,l)})}const ua=Zu();function tl(n,e){const t=e.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=n[e[r]];return i}function Nt(n,e,t){t=t!==void 0?t:{};let i,r;for(i=0,r=n.length;i<r;++i)t[n[i]]=e;return t}function Tf(n,e,t,i){let r;for(r=e.firstElementChild;r;r=r.nextElementSibling){const o=n[r.namespaceURI];if(o!==void 0){const s=o[r.localName];s!==void 0&&s.call(i,r,t)}}}function Ln(n,e,t,i,r){return i.push(n),Tf(e,t,i,r),i.pop()}function PB(n,e,t,i,r,o){const s=(r!==void 0?r:t).length;let l,u;for(let h=0;h<s;++h)l=t[h],l!==void 0&&(u=e.call(o,l,i,r!==void 0?r[h]:void 0),u!==void 0&&n[u.namespaceURI][u.localName].call(o,u,l,i))}function Fr(n,e,t,i,r,o,s){return r.push(n),PB(e,t,i,r,o,s),r.pop()}let kS;function gse(){return kS===void 0&&typeof XMLSerializer<"u"&&(kS=new XMLSerializer),kS}let LS;function qy(){return LS===void 0&&typeof document<"u"&&(LS=document.implementation.createDocument("","",null)),LS}class GB{read(e){if(!e)return null;if(typeof e=="string"){const t=wc(e);return this.readFromDocument(t)}return Cc(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){Zn()}}const mse="http://www.w3.org/1999/xlink";function ok(n){return n.getAttributeNS(mse,"href")}function bf(n){const e=Bu(n,!1);return yse(e)}function yse(n){const e=/^\s*(true|1)|(false|0)\s*$/.exec(n);if(e)return e[1]!==void 0||!1}function fA(n){const e=Bu(n,!1),t=Date.parse(e);return isNaN(t)?void 0:t/1e3}function rr(n){const e=Bu(n,!1);return _se(e)}function _se(n){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(n);if(e)return parseFloat(e[1])}function wl(n){const e=Bu(n,!1);return vse(e)}function vse(n){const e=/^\s*(\d+)\s*$/.exec(n);if(e)return parseInt(e[1],10)}function pn(n){return Bu(n,!1).trim()}function Ly(n,e){ar(n,e?"1":"0")}function bse(n,e){n.appendChild(qy().createCDATASection(e))}function xse(n,e){const t=new Date(e*1e3),i=t.getUTCFullYear()+"-"+Xd(t.getUTCMonth()+1,2)+"-"+Xd(t.getUTCDate(),2)+"T"+Xd(t.getUTCHours(),2)+":"+Xd(t.getUTCMinutes(),2)+":"+Xd(t.getUTCSeconds(),2)+"Z";n.appendChild(qy().createTextNode(i))}function Za(n,e){const t=e.toPrecision();n.appendChild(qy().createTextNode(t))}function VC(n,e){const t=e.toString();n.appendChild(qy().createTextNode(t))}const Ise=/^\s/,Cse=/\s$/,wse=/(\n|\t|\r|<|&| {2})/;function ar(n,e){typeof e=="string"&&(Ise.test(e)||Cse.test(e)||wse.test(e))?e.split("]]>").forEach((t,i,r)=>{i<r.length-1&&(t+="]]"),i>0&&(t=">"+t),bse(n,t)}):n.appendChild(qy().createTextNode(e))}const il=[null,"http://www.opengis.net/ows/1.1"],Ase=Nt(il,{ServiceIdentification:ut($se),ServiceProvider:ut(qse),OperationsMetadata:ut(Kse)});class Sse extends GB{constructor(){super()}readFromNode(e){const t=Ln({},Ase,e,[]);return t||null}}const Ese=Nt(il,{DeliveryPoint:ut(pn),City:ut(pn),AdministrativeArea:ut(pn),PostalCode:ut(pn),Country:ut(pn),ElectronicMailAddress:ut(pn)}),Tse=Nt(il,{Value:Ua(Qse)}),Rse=Nt(il,{AllowedValues:ut(Zse)}),Mse=Nt(il,{Phone:ut(jse),Address:ut(Bse)}),kse=Nt(il,{HTTP:ut(Yse)}),Lse=Nt(il,{Get:Ua(Xse),Post:void 0}),Pse=Nt(il,{DCP:ut(Use)}),Gse=Nt(il,{Operation:Hse}),Fse=Nt(il,{Voice:ut(pn),Facsimile:ut(pn)}),Ose=Nt(il,{Constraint:Ua(Wse)}),Nse=Nt(il,{IndividualName:ut(pn),PositionName:ut(pn),ContactInfo:ut(zse)}),Dse=Nt(il,{Abstract:ut(pn),AccessConstraints:ut(pn),Fees:ut(pn),Title:ut(pn),ServiceTypeVersion:ut(pn),ServiceType:ut(pn)}),Vse=Nt(il,{ProviderName:ut(pn),ProviderSite:ut(ok),ServiceContact:ut(Jse)});function Bse(n,e){return Ln({},Ese,n,e)}function Zse(n,e){return Ln({},Tse,n,e)}function Wse(n,e){const t=n.getAttribute("name");if(t)return Ln({name:t},Rse,n,e)}function zse(n,e){return Ln({},Mse,n,e)}function Use(n,e){return Ln({},kse,n,e)}function Xse(n,e){const t=ok(n);if(t)return Ln({href:t},Ose,n,e)}function Yse(n,e){return Ln({},Lse,n,e)}function Hse(n,e){const t=n.getAttribute("name"),i=Ln({},Pse,n,e);if(!i)return;const r=e[e.length-1];r[t]=i}function Kse(n,e){return Ln({},Gse,n,e)}function jse(n,e){return Ln({},Fse,n,e)}function $se(n,e){return Ln({},Dse,n,e)}function Jse(n,e){return Ln({},Nse,n,e)}function qse(n,e){return Ln({},Vse,n,e)}function Qse(n,e){return pn(n)}const zc=[null,"http://www.opengis.net/wmts/1.0"],Qy=[null,"http://www.opengis.net/ows/1.1"],eoe=Nt(zc,{Contents:ut(hoe)});class toe extends GB{constructor(){super(),this.owsParser_=new Sse}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let i=this.owsParser_.readFromNode(e);return i?(i.version=t,i=Ln(i,eoe,e,[]),i||null):null}}const noe=Nt(zc,{Layer:Ua(doe),TileMatrixSet:Ua(foe)}),ioe=Nt(zc,{Style:Ua(poe),Format:Ua(pn),TileMatrixSetLink:Ua(goe),Dimension:Ua(moe),ResourceURL:Ua(yoe)},Nt(Qy,{Title:ut(pn),Abstract:ut(pn),WGS84BoundingBox:ut(OB),BoundingBox:Ua(_oe),Identifier:ut(pn)})),roe=Nt(zc,{LegendURL:Ua(voe)},Nt(Qy,{Title:ut(pn),Identifier:ut(pn)})),soe=Nt(zc,{TileMatrixSet:ut(pn),TileMatrixSetLimits:ut(xoe)}),ooe=Nt(zc,{TileMatrixLimits:Ha(Ioe)}),aoe=Nt(zc,{TileMatrix:ut(pn),MinTileRow:ut(wl),MaxTileRow:ut(wl),MinTileCol:ut(wl),MaxTileCol:ut(wl)}),loe=Nt(zc,{Default:ut(pn),Value:Ua(pn)},Nt(Qy,{Identifier:ut(pn)})),FB=Nt(Qy,{LowerCorner:Ha(MT),UpperCorner:Ha(MT)}),uoe=Nt(zc,{WellKnownScaleSet:ut(pn),TileMatrix:Ua(boe)},Nt(Qy,{SupportedCRS:ut(pn),Identifier:ut(pn),BoundingBox:ut(OB)})),coe=Nt(zc,{TopLeftCorner:ut(MT),ScaleDenominator:ut(rr),TileWidth:ut(wl),TileHeight:ut(wl),MatrixWidth:ut(wl),MatrixHeight:ut(wl)},Nt(Qy,{Identifier:ut(pn)}));function hoe(n,e){return Ln({},noe,n,e)}function doe(n,e){return Ln({},ioe,n,e)}function foe(n,e){return Ln({},uoe,n,e)}function poe(n,e){const t=Ln({},roe,n,e);if(!t)return;const i=n.getAttribute("isDefault")==="true";return t.isDefault=i,t}function goe(n,e){return Ln({},soe,n,e)}function moe(n,e){return Ln({},loe,n,e)}function yoe(n,e){const t=n.getAttribute("format"),i=n.getAttribute("template"),r=n.getAttribute("resourceType"),o={};return t&&(o.format=t),i&&(o.template=i),r&&(o.resourceType=r),o}function OB(n,e){const t=Ln([],FB,n,e);if(t.length==2)return Js(t)}function _oe(n,e){const t=n.getAttribute("crs"),i=Ln([],FB,n,e);if(i.length==2)return{extent:Js(i),crs:t}}function voe(n,e){const t={};return t.format=n.getAttribute("format"),t.href=ok(n),t}function MT(n,e){const t=pn(n).split(/\s+/);if(!t||t.length!=2)return;const i=+t[0],r=+t[1];if(!(isNaN(i)||isNaN(r)))return[i,r]}function boe(n,e){return Ln({},coe,n,e)}function xoe(n,e){return Ln([],ooe,n,e)}function Ioe(n,e){return Ln({},aoe,n,e)}class Coe{capabilitiesPromise;serviceInfo;layers;constructor(e){const t=new toe;let i="&";e.indexOf("?")===-1&&(i="?"),e.indexOf("Capabilities")===-1&&(e=e+i+"SERVICE=WMTS&REQUEST=GetCapabilities"),this.capabilitiesPromise=fetch(e).then(r=>r.text()).then(r=>{const o=t.read(r);this.serviceInfo=this.mapServiceInfo(o.ServiceIdentification),this.layers=this.mapToRemoteLayers(o.Contents?.Layer)})}mapToRemoteLayers(e){return[{type:Rc.WMTS,children:e.map(t=>({type:Rc.WMTS,abstract:t.Abstract,format:t.Format,name:t.Identifier,title:t.Title,tileMatrixSetLink:t.TileMatrixSetLink,wgs84BoundingBox:t.WGS84BoundingBox}))}]}mapServiceInfo(e){return{type:Rc.WMTS,title:e.Title,abstract:e.Abstract,fees:e.Fees,constraints:e.AccessConstraints,serviceTypeVersion:e.ServiceTypeVersion}}isReady(){return this.capabilitiesPromise.then(()=>this)}getLayerByName(e){return this.layers[0].children.filter(t=>t.name===e)[0]}getLayers(){return this.layers}getServiceInfo(){return this.serviceInfo}}const woe="https://migration.geoportail.lu/ogcproxywms",Aoe="https://migration.geoportail.lu/httpsproxy";class Soe{_wmsProxyUrl=woe;_remoteProxyUrl=Aoe;get wmsProxyUrl(){return this._wmsProxyUrl===void 0&&console.warn("Warning: proxyWmsUrl is not set."),this._wmsProxyUrl}get remoteProxyUrl(){return this._remoteProxyUrl===void 0&&console.warn("Warning: remoteProxy is not set."),this._remoteProxyUrl}getProxyfiedUrl(e){return e.indexOf("httpsproxy")>0?e:this.remoteProxyUrl+"?url="+encodeURIComponent(e)}init_v3(e,t){e&&(this._wmsProxyUrl=e),t&&(this._remoteProxyUrl=t),console.warn("Deprecated: ProxyUrlHelper.init_v3() is meant to be removed when v4 is fully operational")}}const $v=new Soe;class Eoe{async getRemoteEndpoint(e){let t;return await this.getWmsEndpoint(e).isReady().catch(async()=>{t=await this.getWmtsEndpoint(e).isReady()})||t}getWmsEndpoint(e){return new Ure($v.getProxyfiedUrl(e))}getWmtsEndpoint(e){return new Coe($v.getProxyfiedUrl(e))}async fetchRemoteWmsEndpoint(){return new Promise(e=>e(pse()))}isRemoteLayer(e){return typeof e=="string"&&(e.indexOf(Rc.WMS)===0||e.indexOf(Rc.WMTS)===0)}}const Jv=new Eoe;class NB{}class Toe extends NB{async getMetadata(e,t,i){const r=Jv.getWmsEndpoint(t);await r.isReady();const o=r?.getServiceInfo(),s=r?.getLayerByName(i);return{title:s.title,description:s.abstract,keywords:o.keywords,accessConstraints:o.constraints,serviceDescription:o.abstract}}}const Roe=new Toe;class Moe extends NB{async getMetadata(e,t,i){const r=Jv.getWmtsEndpoint(t);await r.isReady();const o=r?.getServiceInfo(),s=r?.getLayerByName(i);return{title:s.title,description:s.abstract,accessConstraints:o.constraints,serviceDescription:o.abstract}}}const koe=new Moe;class Loe{async getMetadata(e,t,i){if(e===Rc.WMS)return Roe.getMetadata(e,t,i);if(e===Rc.WMTS)return koe.getMetadata(e,t,i);throw new Error(`Unsupported service type: ${e}`)}}const Poe=new Loe,Ex=new Map,Goe="https://geocatalogue.geoportail.lu/geonetwork/srv",Foe="https://migration.geoportail.lu/legends/get_html",Ooe="https://migration.geoportail.lu/getMetadata";class Noe{async getLayerMetadata(e,t){let i;const o=Tl().findAnyLayerById(e);return Ex.has(e)?Ex.get(e):(o?i=this.getLayerMetadataLocal(o,t):i=this.getLayerMetadataRemote(e),Ex.set(e,i),i)}async getLayerMetadataRemote(e){const[t,i,r]=String(e).split("%2D").join("-").split("||");return Poe.getMetadata(t,i,r)}async getLayerMetadataLocal(e,t){const i=e.metadata,r=i?.metadata_id,o=r?await this.getLocalMetadata(Ooe,r,t):{isError:!0},s=e.name,l=i?.legend_name||"",u=e?.id,h=await this.getLegendHtml(Foe,l,u,t),d=!!h&&h.hasChildNodes();return{...o,title:s,hasLegend:d,...d&&{legendHtml:h}}}getLocalMetadata(e,t,i){return fetch(`${e}?lang=${i}&uid=${t}`).then(async r=>{const o=(await r.json()).metadata;return{name:o.title,serviceDescription:o.serviceDescription,description:o.abstract,legalConstraints:o.legalConstraints,link:jee(o.link),revisionDate:o.revisionDate,keyword:o.keyword,responsibleParty:o.responsibleParty?$ee(o.responsibleParty):void 0,metadataLink:`${Goe}/${Hee(i)}/catalog.search#/metadata/${t}`,isError:!1}}).catch(()=>({isError:!0}))}getLegendHtml(e,t,i,r){const o={lang:r,...t&&{name:t},...i&&{id:i.toString()}};if(o.lang){window.devicePixelRatio>1&&(o.dpi=(window.devicePixelRatio*96).toString());const s=`${e}?${new URLSearchParams(o).toString()}`;return fetch(s).then(async l=>{if(l.status>=400&&l.status<600)throw new Error("Server responded with error code");const u=await l.text();return u?Kee(u):void 0}).catch(()=>{})}}clearCache(){Ex.clear()}}const BC=new Noe,e_="ipv6",ZC="address",yg="applogin",xf="localforage",fy="debug",Doe="embedded",DB="embeddedserver",VB="embeddedserverprotocol",kT="features",Py="fid",cf="lang",WC="layersOpen",LT="version",PS="map_id",GO="layers",FO="bgLayer",OO="opacities",zC="theme",NO="time",DO="zoom",VO="rotation",Voe="SRS",PT="X",GT="Y",GS="crosshair",qv="serial",BB=["basemap_2015_global","topogr_global","topo_bw_jpeg"],FT="lc",OT="sliderRatio",ZB="bgOpacity",Boe="layers_indices",BO="layers_opacity",ZO="layers_visibility";var Go=(n=>(n[n.localStorage=0]="localStorage",n[n.permalink=1]="permalink",n[n.permalinkAsPath=2]="permalinkAsPath",n[n.permalinkAndLocalStorage=3]="permalinkAndLocalStorage",n))(Go||{});class WB{}function py(n,e){let t;return(...i)=>{clearTimeout(t),t=setTimeout(()=>{n.apply(i)},e)}}const Zoe=(n,e)=>{let t=null;return(...i)=>new Promise((r,o)=>{t&&clearTimeout(t),t=setTimeout(async()=>{try{const s=await n(...i);r(s)}catch(s){o(s)}},e)})};function zB(n,e){let t,i;return function(...r){const o=this;i?(clearTimeout(t),t=setTimeout(function(){Date.now()-i>=e&&(n.apply(o,r),i=Date.now())},e-(Date.now()-i))):(n.apply(o,r),i=Date.now())}}function Op(n){return n?.trim()&&!isNaN(Number(n))?Number(n):void 0}function Woe(n,e){return n?.split(e).map(t=>t!==null&&!isNaN(Number(t))?parseFloat(t):void 0)||[]}function zoe(n,e){return n?.split(e).map(ak)||[]}function ak(n){return n?.trim()==="true"?!0:n?.trim()==="false"?!1:void 0}function UB(){return window.matchMedia("(-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2), (min-resolution: 192dpi)").matches}function Mc(n){return typeof window<"u"&&window.navigator&&n.test(navigator.userAgent)}function Uoe(n){const e=new RegExp("[^/]*//[^/]+/(.*)"),t=n.match(e);return t?t[1]:null}const Xoe=Mc(/firefox/i);Mc(/safari/i)&&!Mc(/chrome/i)&&Mc(/android/i);Mc(/iP(ad|od|hone)/i);Mc(/chrome/i)&&Mc(/android/i);Mc(/chrome/i);Mc(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i);Mc(/Edge/i);function WO(n){return n.replace(/\s+/g,"_").replace(/[^a-z0-9\-_]/gi,"")||"_"}async function Yoe(n,e){const t=await fetch(n);if(!t.ok)throw new Error;const i=await t.blob();YB(e,i)}function XB(n,e,t="text/plain"){const i=new Blob([e],{type:t});YB(n,i)}function YB(n,e){const t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}function Hoe(n){return n.charAt(0).toUpperCase()+n.slice(1)}class UC extends WB{static processRules(e){return UC.ruleUseLocalStorage(e)?Go.localStorage:Go.permalink}static processRulesForKey(e,t){if(BB.includes(e))return Go.localStorage;if(e===qv)return Go.permalink;if(e===WC)return Go.localStorage}static ruleUseLocalStorage(e){return[Koe,joe,$oe].reduce((t,i)=>t||i(e),!1)}}const Koe=n=>Object.keys(n).length===0,joe=n=>Object.keys(n).length===1&&(n.hasOwnProperty(e_)||n.hasOwnProperty(yg)||n.hasOwnProperty(xf)),$oe=n=>Object.keys(n).length===3&&n.hasOwnProperty(e_)&&n.hasOwnProperty(yg)&&n.hasOwnProperty(xf);class XC extends WB{static processRules(){return Go.permalinkAndLocalStorage}static processRulesForKey(e,t){if(XC.ruleUsePermalink(e))return Go.permalink;if(e===WC||BB.includes(e))return Go.localStorage;if(e===qv||e===kT)return Go.permalink;if(e===zC)return Go.permalinkAsPath}static ruleUsePermalink(e){return[Joe,qoe,Qoe].reduce((t,i)=>t||i(e),!1)}}const Joe=n=>n===FT||n===OT,qoe=n=>n===LT,Qoe=n=>n===zC&&!0;class HB{snappedUrl;constructor(){this.snappedUrl=new URL(window.location.toString())}get length(){throw new Error("Method not implemented.")}clear(){throw new Error("Method not implemented.")}key(e){throw new Error("Method key() not implemented. "+e)}getStrippedUrl(e){const t=new URL(window.location.toString()),i=new URLSearchParams(t.search);return e!==void 0&&(i.set("X",Math.round(e[0]).toString()),i.set("Y",Math.round(e[1]).toString())),i.delete(xf),i.delete(yg),i.delete(e_),i.delete(DB),i.delete(VB),t.search=i.toString(),t}getRelativeUrl(){const e=this.getStrippedUrl(void 0);return e.pathname+e.search}async getShortUrl(e){const t=this.getStrippedUrl(e).toString().replace(/https:\/\/geoportail-luxembourg.github.io\/luxembourg-geoportail\/.+\//,"https://migration.geoportail.lu/").replace(/http:\/\/localhost:[45]173\//,"https://migration.geoportail.lu/"),i=new URLSearchParams;return i.set("url",t),await(await fetch("https://migration.geoportail.lu/short/create",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()})).json()}getSnappedUrl(){return this.snappedUrl}getSnappedParamsAsObj(){return this.getSnappedParams().reduce((e,t)=>{const[i,r]=t.split("=");return{...e,[i]:r}},{})}getSnappedParams(){return this.getSnappedUrl().search.replace("?","").split("&").filter(e=>e.split("=")[1])}setItem(e,t){const i=new URLSearchParams(new URL(window.location.toString()).search);i.set(encodeURIComponent(e),encodeURIComponent(t));try{window.history.replaceState(null,"","?"+i.toString())}catch{}}getItem(e){const t=this.getSnappedUrl().searchParams.get(e);return t!==null?decodeURIComponent(t):t}removeItem(e){const t=new URLSearchParams(new URL(window.location.toString()).search);t.delete(e);try{window.history.replaceState(null,"","?"+t.toString())}catch{}}encodeQueryParam(e,t){return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`}removeQueryParam(e){const t=new URL(window.location.href);t.searchParams.delete(e),window.history.replaceState({},document.title,t.toString())}}const Ql=new HB;class eae extends HB{getItem(e){const t=this.getSnappedUrl().pathname.split("/"),i=t.findIndex(r=>r===e);return t[i+1]}setItem(e,t){const i=new URL(window.location.toString()).search,r=`/luxembourg-geoportail/fixes/${e}/${t}${i}`;try{window.history.replaceState(null,"",r)}catch{}}}const KB=new eae;class tae{get length(){throw new Error("Method not implemented.")}clear(){throw new Error("Method not implemented.")}key(e){throw new Error("Method key() not implemented. "+e)}removeItem(e){this.getWriteStorages(e)?.map(i=>i.removeItem(e))}setItem(e,t){this.setValue(e,t)}getItem(e){return this.getValue(e)}get paramKeys(){return Ql.getSnappedParamsAsObj()}getValue(e){const t=this.correspondingStorages(UC.processRules(this.paramKeys))?.pop(),i=this.storageForKey(e,UC,t);return i?i.getItem(e):null}setValue(e,t){this.getWriteStorages(e)?.map(r=>r.setItem(e,t))}getWriteStorages(e){const t=this.correspondingStorages(XC.processRules()),i=this.storageForKey(e,XC);return i?[i]:t}storageForKey(e,t,i){return this.correspondingStorages(t.processRulesForKey(e,this.paramKeys))?.pop()??i}correspondingStorages(e){if(e===Go.permalinkAndLocalStorage)return[Ql,localStorage];if(e===Go.localStorage)return[localStorage];if(e===Go.permalink)return[Ql];if(e===Go.permalinkAsPath)return[KB]}}const Tx=new tae;function nae(n){return iae(n)||rae(n)||sae(n)||oae(n)}const iae=n=>Object.keys(n).length===0,rae=n=>{const e=Object.keys(n);return Object.keys(n).length===1&&[e_,yg,xf,Py,cf,ZC,fy].some(t=>e.indexOf(t)!==-1)},sae=n=>{const e=Object.keys(n),t=r=>e.indexOf(r)!==-1,i=[[yg,xf],[fy,Py],[cf,Py],[fy,cf],[fy,ZC],[cf,ZC]];return Object.keys(n).length===2&&i.reduce((r,o)=>r||o.every(t),!1)},oae=n=>{const e=Object.keys(n),t=s=>e.indexOf(s)!==-1,i=[e_,yg,xf].every(t),r=[fy,Py,cf].every(t),o=[fy,ZC,cf].every(t);return Object.keys(n).length===3&&(i||r||o)};class aae{intialVersion;constructor(){const e=Tx.paramKeys,t=this.getValue(LT,Op);this.intialVersion=t?Math.max(2,Math.min(t,3)):nae(e)?3:2,this.setValue(LT,3)}getInitialVersion(){return this.intialVersion}mapToEntity(e,t){return t?t(e):e}mapToStorage(e,t){return t?t(e):String(e)}getValue(e,t){return this.mapToEntity(Tx.getValue(e),t)}setValue(e,t,i){Tx.setValue(e,this.mapToStorage(t,i))}removeItem(e){Tx.removeItem(e)}}const Dn=new aae;class lae{bootstrap(){this.restore();let e;e=Rs(()=>{this.persist(),e&&e()})}persist(){const e=Jn(),{lang:t}=It(e);Pt(t,(i,r)=>{r!==i&&(Dn.setValue(cf,i),document.documentElement.setAttribute("lang",i))},{immediate:!0})}restore(){const e=Dn.getValue(cf);if(e){const{setLang:t}=Jn(),{i18next:i}=St();i.changeLanguage(e),t(e)}}}const uae=new lae,cae=at({__name:"language-selector",setup(n){const{i18next:e,t}=St(),{setLang:i}=Jn(),{lang:r}=It(Jn()),o=Ct(()=>["en","de","fr","lb"].map(u=>({label:t(u),value:u,ariaLabel:t("Change language: {{lang}}",{ns:"app",lang:u})}))),s=t("Change language",{ns:"app"});uae.bootstrap(),Pt(()=>e.language,()=>{BC.clearCache()});function l(u){e.changeLanguage(u),i(u)}return(u,h)=>(U(),Gt(ig,{class:"lux-navbar-dropdown lux-dropdown-inline text-white h-full",options:o.value,placeholder:M(s),modelValue:M(r),"onUpdate:modelValue":h[0]||(h[0]=d=>Gr(r)?r.value=d:null),onChange:l},null,8,["options","placeholder","modelValue"]))}}),hae="include";async function ks(n,e,t="GET",i){const r={},o={method:t,credentials:hae,headers:r};let s=n;if(t==="GET"){const u=new URLSearchParams(e);s=`${n}?${u.toString()}`}else e instanceof FormData?o.body=e:i==="application/json"?(r["Content-Type"]="application/json",o.body=JSON.stringify(e)):(r["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",o.body=new URLSearchParams(e));const l=await fetch(s,o);if(!l.ok)throw new Error("Error while trying to call api");return l}function Rx(n,e){return n.indexOf(e)>=0}function jB(){function n(o,s,l,u=!1,h=!1){let d="",m=l;if(l==="EPSG:3263*"){const x=Ir(o,s,"EPSG:4326");m=Math.floor(x[0])>=6?"EPSG:32632":"EPSG:32631"}const y=Ir(o,s,m);switch(m){case"EPSG:2169":d=u0(y,"{x} E | {y} N",0);break;case"EPSG:4326":if(u){const x=e(y),C=x.split(" ").slice(0,4).join(" ");d=`${x.split(" ").slice(4,8).join(" ")} | ${C}`}else if(h){const x=t(y),C=x.split(" ").slice(0,3).join(" ");d=`${x.split(" ").slice(3,6).join(" ")} | ${C}`}else d=u0(y,"{x} E | {y} N",5);break;case"EPSG:32632":d=u0(y,"{x} | {y} (UTM32N)",0);break;case"EPSG:32631":d=u0(y,"{x} | {y} (UTM31N)",0);break;default:d=u0(y,"{x} E | {y} N",0);break}return d}function e(o){return o?i(o[1],"NS")+" "+i(o[0],"EW"):""}function t(o){return o?r(o[1],"NS")+" "+r(o[0],"EW"):""}function i(o,s){const l=(o+180)%360-180,u=Math.abs(3600*l);return Math.floor(u/3600)+" "+Xd(Math.floor(u/60%60),2)+" "+Xd(Math.floor(u%60),2)+","+Math.floor((u-(u<0?Math.ceil(u):Math.floor(u)))*10)+" "+s.charAt(l<0?1:0)}function r(o,s){const l=(o+180)%360-180,h=Math.abs(3600*l)/3600,d=(h-Math.floor(h))*60,m=(d%1).toString();return Math.floor(h)+" "+Xd(Math.floor(d),2)+","+m.substring(m.indexOf(".")+1,m.indexOf(".")+6)+" "+s.charAt(l<0?1:0)}return{coordinateString:n}}function dae(n,e){const t=JSON.parse("[2.6, 47.7, 8.6, 51]"),i=gb(t,"EPSG:4326",e);n=n.replace(/,/gi,".");const r=[],o={"EPSG:32631":{regex:/(\d{6,6}[,.]?\d{0,3})\s*?\W*(\d{7,7}[,.]?\d{0,3})\s*?/,label:"UTM31N",epsgCode:"EPSG:32631"},"EPSG:32632":{regex:/(\d{6,6}[,.]?\d{0,3})\s*?\W*(\d{7,7}[,.]?\d{0,3})\s*?/,label:"UTM32N",epsgCode:"EPSG:32632"},"EPSG:2169":{regex:/(\d{4,6}[,.]?\d{0,3})\s*([E|N])?\W*(\d{4,6}\s*[,.|]?\s*?\d{0,3})\s*([E|N])?/,label:"LUREF",epsgCode:"EPSG:2169"},"EPSG:2169:V2":{regex:/(\d{4,6})\s*([E|N])?\s*[,.|]?\s*(\d{4,6})\s*([E|N])?/,label:"LUREF",epsgCode:"EPSG:2169"},"EPSG:4326":{regex:/(\d{1,2}[,.]\d{1,6})\d*\s?(latitude|lat|N|longitude|long|lon|E|east|est)?\W*(\d{1,2}[,.]\d{1,6})\d*\s?(longitude|long|lon|E|latitude|lat|N|north|nord)?/i,label:"long/lat WGS84",epsgCode:"EPSG:4326"},"EPSG:4326:DMS":{regex:/([NSEW])?(-)?(\d+(?:\.\d+)?)[:d\s]?\s?(?:(\d+(?:\.\d+)?)[':]\s?(?:(\d{1,2}(?:\.\d+)?)(?:"|||'')?)?)?\s?([NSEW])?/i,label:"long/lat WGS84 DMS",epsgCode:"EPSG:4326"}},s=["LATITUDE","LAT","N","NORTH","NORD"],l=["LONGITUDE","LONG","LON","E","EAST","EST"];for(const u in o){let h=o[u].regex.exec(n);if(u==="EPSG:2169"&&(n.match(/\./g)||[]).length===1&&(h=null),h){const d=o[u].epsgCode;let m=!1,y,x;if(d==="EPSG:32631"||d==="EPSG:32632"){if(h[1]&&h[2]){const C=[parseFloat(h[1].replace(",",".")),parseFloat(h[2].replace(",","."))],w=Ir(C,d,"EPSG:4326");(Math.floor(w[0])===5||Math.floor(w[0])===6)&&(y=parseFloat(h[1].replace(",",".")),x=parseFloat(h[2].replace(",",".")))}}else if(u==="EPSG:4326"||u==="EPSG:2169"||u==="EPSG:2169:V2")h[2]&&h[4]?Rx(s,h[2].toUpperCase())&&Rx(l,h[4].toUpperCase())?(y=parseFloat(h[3].replace(",",".")),x=parseFloat(h[1].replace(",","."))):Rx(s,h[4].toUpperCase())&&Rx(l,h[2].toUpperCase())&&(y=parseFloat(h[1].replace(",",".")),x=parseFloat(h[3].replace(",","."))):(!h[2]||h[2]==="|")&&h[4]===void 0&&(y=parseFloat(h[1].replace(",",".")),x=parseFloat(h[3].replace(",",".")));else if(u==="EPSG:4326:DMS"){const C=h;let w;C[1]?(C[6]="",w=n.substring(C[0].length-1).trim()):w=n.substring(C[0].length).trim();const E=zO(C);if(E!==void 0){const T=o[u].regex.exec(w),k=T?zO(T):void 0;k!==void 0&&(typeof E.latLon>"u"&&!isNaN(E.decDeg)&&!isNaN(k.decDeg)&&(E.latLon="lat"),E.latLon==="lat"?(x=E.decDeg,y=k.decDeg):(y=E.decDeg,x=k.decDeg),m=!0)}}if(y!==void 0&&x!==void 0){const C=new zi([y,x]).transform(d,e),w=new zi([x,y]).transform(d,e);let E=null;if(i&&Pc(i,C.getCoordinates())?E=new yi(C):d==="EPSG:4326"&&i&&Pc(i,w.getCoordinates())&&(E=new yi(w)),E){const T=E.getGeometry(),{coordinateString:k}=jB(),G=k(T.getCoordinates(),e,d,m,!1);E.set("label",G),E.set("epsgLabel",o[u].label),r.push(E)}}}}return r}function zO(n){const e={"-":-1,N:1,S:-1,E:1,W:-1},t={N:"lat",S:"lat",E:"lon",W:"lon"},i=e[n[2]]||e[n[1]]||e[n[6]]||1;if(n[3]===void 0)return;const r=Number(n[3]),o=n[4]!==void 0?Number(n[4]):0,s=n[5]!==void 0?Number(n[5]):0,l=t[n[1]]||t[n[6]];return{decDeg:i*(r+o/60+s/3600),latLon:l}}const Zh=()=>({bg_layers:[{icon_id:"route",vector_id:"roadmap",simple_style_class:"road",medium_style_class:"road",expert_style_class:"maputnik",id:556,is_default:!0},{icon_id:"topo",vector_id:"topomap",medium_style_class:"topo",expert_style_class:"maputnik",id:529},{icon_id:"topo_bw",vector_id:"topomap_gray",medium_style_class:"topo",expert_style_class:"maputnik",id:502},{icon_id:"ortho",id:530},{icon_id:"hybrid",id:501},{icon_id:"blank",id:0}],bg_layer_theme_defaults:{tourisme:502},simple_styles:{road:[{unlocalized_label:"Light grey",hillshade:!1,colors:["#ffffff","#ffffff","#d6e0d7","#e1e1e1","#cccccc","#f2f2f2"],selected:!1},{unlocalized_label:"Dark grey",hillshade:!1,colors:["#808080","#808080","#494b4a","#505052","#232426","#454545"],selected:!1},{unlocalized_label:"Dark sand",hillshade:!1,colors:["#9e9375","#9e9375","#6b6249","#403928","#b8aa84","#1a1814"],selected:!1},{unlocalized_label:"Kids",hillshade:!1,colors:["#f9c50d","#ffffff","#839836","#d6d3ce","#2a5ba8","#eeeeee"],selected:!1},{unlocalized_label:"Light mauve",hillshade:!1,colors:["#f3edf5","#f3edf5","#9d7da8","#caa9d1","#613b5c","#e5d3e6"],selected:!1},{unlocalized_label:"Light Blue",hillshade:!1,colors:["#dceaf5","#dceaf5","#5598cf","#81b7e3","#3b576e","#b6cde0"],selected:!1}]},medium_default_styles:{road:[{label:"Roads primary",color:"#f7f7f7",lines:["lu_road_trunk_primary","lu_bridge_major","lu_tunnel_major","lu_road_major_motorway"],visible:!0},{label:"Roads secondary",color:"#f7f7f7",lines:["lu_road_minor","lu_road_secondary_tertiary","lu_bridge_minor","lu_road_path","lu_bridge_path","lu_bridge_railway case","lu_bridge_path case"],visible:!0},{label:"Vegetation",color:"#B8D293",opacity:"1",fills:["lu_landcover_wood","lu_landcover_grass","lu_landuse_stadium","lu_landuse_cemetery"],visible:!0},{label:"Buildings",color:"#D6AA85",opacity:"1",fillExtrusions:["lu_building-3d_public","lu_building-3d"],fills:["lu_building","lu_building_public"],lines:["lu_bridge_railway","lu_railway","lu_tunnel_railway"],visible:!0},{label:"Water",color:"#94c1e1",lines:["lu_waterway","lu_waterway_tunnel","lu_waterway_intermittent"],fills:["lu_water"],visible:!0},{label:"Background",color:"#e7e7e7",backgrounds:["background"],visible:!0},{label:"Hillshade",hillshades:["hillshade"],visible:!0}],topo:[{label:"Primary Names",symbols:["lu_place-label_other","lu_place-label_city","lu_place-label_canton","lu_country-label-other","lu_country-label","place_label_other","place_label_city","country_label-other","country_label"],visible:!0},{label:"Secondary Names",symbols:["lu_place-label_isolated","lu_place-label_locality_forest","lu_place-label_locality_lieudit"],visible:!0},{label:"Transport",lines:["lu_tunnel_track-casing","lu_tunnel_major_motorway-casing","lu_tunnel_railway_transit","lu_tunnel_railway","lu_tunnel_railway-hatching","lu_tunnel_path","lu_tunnel_track","lu_tunnel_minor","lu_tunnel_major_motorway","lu_tunnel_secondary_tertiary","lu_tunnel_trunk_primary","lu_road_track-casing","lu_road_minor-casing","lu_road_major_motorway-casing","lu_road_secondary_tertiary-casing","lu_road_trunk_primary-casing","lu_road_pier","lu_road_path","lu_road_track","lu_road_minor","lu_road_major_motorway","lu_road_secondary_tertiary","lu_road_trunk_primary","lu_tram","lu_tram-hatching","lu_railway_transit","lu_railway","lu_railway-hatching","lu_bridge_railway-casing","lu_bridge_track-casing","lu_bridge_path-casing","lu_bridge_minor-casing","lu_bridge_major_motorway-casing","lu_bridge_secondary_tertiary-casing","lu_bridge_trunk_primary-casing","lu_bridge_railway","lu_bridge_path","lu_bridge_track","lu_bridge_minor","lu_bridge_major_motorway","lu_bridge_secondary_tertiary","lu_bridge_trunk_primary","tunnel_track-casing","tunnel_major_motorway-casing","tunnel_railway_transit","tunnel_railway_transit-hatching","tunnel_railway","tunnel_railway-hatching","tunnel_path","tunnel_track","tunnel_minor","tunnel_major_motorway","tunnel_secondary_tertiary","tunnel_trunk_primary","road_track-casing","road_minor-casing","road_major_motorway-casing","road_secondary_tertiary-casing","road_trunk_primary-casing","road_pier","road_path","road_track","road_minor","road_major_motorway","road_secondary_tertiary","road_trunk_primary","railway-transit","railway-transit-hatching","railway","railway-hatching","bridge_railway-casing","bridge_path-casing","bridge_track_casing","bridge_minor-casing","bridge_major_motorway-casing","bridge_secondary_tertiary-casing","bridge_trunk_primary-casing","bridge_railway","bridge_path","bridge_track","bridge_minor","bridge_major_motorway","bridge_secondary_tertiary","bridge_trunk_primary"],symbols:["lu_road_major-label","lu_motorway-shield","lu_road-shield"],visible:!0},{label:"Vegetation",fills:["lu_landuse_stadium","lu_landuse_cemetery","lu_landuse_gras","lu_landuse_park","lu_landuse_park-outline","lu_landuse_vineyard","lu_landuse_orchard","lu_landuse_wood","landcover_grass","landcover_wood"],visible:!0},{label:"Electricity",fills:["lu_power_station","lu_power_pylone"],lines:["lu_power_line","lu_power_station-outline"],symbols:["lu_power_station-label","lu_eolienne"],visible:!0},{label:"Contours and Height Points",lines:["lu_contour-100","lu_contour-50","lu_contour-20","lu_contour-10","lu_contour"],symbols:["lu_contour-label-100","lu_contour-label-20","lu_apex-label"],visible:!0},{label:"Hillshade",hillshades:["lu_hillshade"],visible:!0}]},http_bg_server:"wmts{1-2}",https_bg_server:"wmts{3-4}",bg_wmts_server_path:"mapproxy_4_v3/wmts/{Layer}",bg_wmts_tile_template:"{TileMatrixSet}/{TileMatrix}/{TileCol}/{TileRow}",bg_layer_projection:"EPSG:3857",olcs_extent:[5.31,49.38,6.64,50.21],olcs_extent_projection:"EPSG:3857",bg_layer_resolutions:[156543.033928,78271.516964,39135.758482,19567.879241,9783.9396205,4891.96981025,2445.98490513,1222.99245256,611.496226281,305.748113141,152.87405657,76.4370282852,38.2185141426,19.1092570713,9.55462853565,4.77731426782,2.38865713391,1.19432856696,.597164283478,.298582141739,.1492910708695,.07464553543475],bg_matrix_ids:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21"]}),YC={name:"blank",id:0};var Wh=(n=>(n.WMS="WMS",n.WFS="WFS",n.WMTS="WMTS",n.BG_WMTS="BG WMTS",n.BG_MVT="BG MVT",n["3D"]="3D",n.TILE_WMS="tileWMS",n))(Wh||{});function pA(){const n=Jn(),{myMapId:e}=It(n),t=Tl(),i=Ui(),r=la(),o=Ct(()=>{if(!e.value){const m=Zr().theme?.name;if(m)return Zh().bg_layer_theme_defaults[m]||u()}return u()});function s(m,y){const x=y?t.findBgLayerByName(y)??null:m?t.findBgLayerById(m)??null:null;l(x)}function l(m){if(m){if(m.type===Wh.WMTS||m.type===Wh.BG_WMTS)m.type="BG WMTS";else throw new Error(`Only WMTS and MVT BG layers are currently implemented (not ${m.type} for ${m.name})`);r.handleExclusionLayers(m),i.setBgLayer(r.initLayer(m))}else i.setBgLayer(null)}function u(){return d().find(m=>m.is_default)?.id||YC.id}function h(){return YC.id}function d(){return Zh().bg_layers}return{setBgLayer:s,setMapBackground:l,getBgLayersFromConfig:d,getNullId:h,getDefaultSelectedId:u,defaultSelectedBgId:o}}const gA=ca("routing",()=>{const n=Ue(null),e=Ue(""),t=Ue(0),i=Ue(!1),r=Ue(["",""]),o=Ue([0,1]),s=mi(Mp(new Ts)),l=mi(Mp(new Ts)),u=mi(Mp(new Ts)),h=mi(Mp(new Ts)),d=Ue(3),m=Ue(0),y=Ue(0),x=Ue(0),C=Ue(0),w=Ue(0),E=Ue([]),T=Ue([]),k=Ue(!1);function G(te,$,ae){n.value=te,e.value=$,t.value=ae??0,i.value=!0}function O(){i.value=!1}function V(){i.value=!0}function z(){n.value=null,e.value="",r.value=["",""],o.value=[0,1],s.value.clear(),l.value.clear(),u.value.clear(),h.value.clear(),d.value=3,m.value=0,y.value=0,x.value=0,C.value=0,w.value=0,E.value=[],T.value=[],k.value=!1}function H(){l.value.clear(),u.value.clear(),h.value.clear(),y.value=0,x.value=0,C.value=0,w.value=0,E.value=[],T.value=[],k.value=!1}return{startCoordinate:n,startLabel:e,targetRouteIndex:t,isOpen:i,routes:r,routesOrder:o,features:s,routeFeatures:l,stepFeatures:u,waypointFeatures:h,transportMode:d,criteria:m,distance:y,time:x,elevationGain:C,elevationLoss:w,routeDesc:E,profileData:T,hasResult:k,setStartPoint:G,closePanel:O,openPanel:V,reset:z,clearResults:H}}),fae=["aria-checked","aria-label"],pae={class:"ml-1 hover:underline"},y0=at({__name:"filter-toggle",props:{label:{},checked:{type:Boolean}},emits:["toggle"],setup(n,{emit:e}){const t=e;function i(){t("toggle")}return(r,o)=>(U(),ie("button",{class:"w-full text-left filter-toggle-btn",onClick:i,role:"checkbox","aria-checked":n.checked,"aria-label":n.label,tabindex:"0"},[P("i",{class:Rn(["fa-solid",n.checked?"fa-check-square":"fa-square"])},null,2),P("span",pae,K(n.label),1)],8,fae))}}),CI={cms:!0,layers:!0,address:!1,parcels:!1,localite:!1,lieudit:!1,commune:!1,flik:!1,hydro:!1,biotopes:!1,extent:!1,activeLayers:!0},pl=Ue(Object.assign({},localStorage.getItem("searchFacets")?JSON.parse(localStorage.getItem("searchFacets")):CI)),gae={address:"Adresses",parcels:"Parcelles cadastrales",localite:"Localits",lieudit:"Lieux-dits",commune:"Communes",flik:"lments agricoles",hydro:"Hydrographie",biotopes:"Biotopes"},UO={address:["Adresse","nom_de_rue"],parcels:["Parcelle"],localite:["Localit"],lieudit:["lieu_dit"],commune:["Commune"],flik:["FLIK","asta esp","FLIK_Provisoire"],hydro:["hydro","hydro_km"],biotopes:["biotope"]},mae={class:"filter-panel bg-secondary text-tertiary"},yae={class:"flex"},_ae=at({__name:"filter-panel",emits:["close"],setup(n,{expose:e,emit:t}){const i=Object.keys(CI).length,{t:r}=St(),o=t;function s(y){pl.value[y]=!pl.value[y]}function l(){localStorage.setItem("searchFacets",JSON.stringify(pl.value)),o("close")}function u(){pl.value=Object.assign({},CI)}const h=Ue(null);function d(y){const x=document.querySelectorAll(".filter-toggle-btn")[y];x&&x.focus()}function m(y){if(y.stopPropagation(),h.value===null&&(h.value=-1),y.key==="Tab"&&y.shiftKey&&h.value<=0){h.value=-1;return}if(y.key==="Tab"&&!y.shiftKey&&h.value>=i-1){h.value=-1;return}if(y.key==="ArrowDown"||y.key==="Tab"&&!y.shiftKey)y.preventDefault(),h.value<i-1&&(h.value++,d(h.value));else if(y.key==="ArrowUp"||y.key==="Tab"&&y.shiftKey)y.preventDefault(),h.value>0&&(h.value--,d(h.value));else if(y.key==="Enter"||y.key===" "||y.code==="Space"){y.preventDefault();const x=Object.keys(CI);s(x[h.value])}}return e({focusedIndex:h,focusItem:d}),(y,x)=>(U(),ie("div",mae,[P("h3",null,K(M(r)("Paramtres de recherche")),1),P("button",{class:"close-panel",onClick:x[0]||(x[0]=C=>y.$emit("close"))},""),P("div",{onKeydown:m},[P("h4",null,K(M(r)("Inclure")),1),mt(y0,{label:M(r)("Pages du site"),checked:M(pl).cms,onToggle:x[1]||(x[1]=C=>s("cms"))},null,8,["label","checked"]),mt(y0,{label:M(r)("Couches"),checked:M(pl).layers,onToggle:x[2]||(x[2]=C=>s("layers"))},null,8,["label","checked"]),x[7]||(x[7]=P("hr",{class:"section-divider"},null,-1)),P("h4",null,K(M(r)("Limiter la recherche ")),1),(U(!0),ie(Mt,null,hi(M(gae),(C,w)=>(U(),Gt(y0,{key:w,label:M(r)(C),checked:M(pl)[w],onToggle:E=>s(w)},null,8,["label","checked","onToggle"]))),128)),x[8]||(x[8]=P("hr",{class:"section-divider"},null,-1)),P("h4",null,K(M(r)("tendue")),1),mt(y0,{label:M(r)("Uniquement dans la partie actuellement visible de la carte"),checked:M(pl).extent,onToggle:x[3]||(x[3]=C=>s("extent"))},null,8,["label","checked"]),x[9]||(x[9]=P("hr",{class:"section-divider"},null,-1)),P("h4",null,K(M(r)("Avance")),1),mt(y0,{label:M(r)("Chercher dans les couches actives"),checked:M(pl).activeLayers,onToggle:x[4]||(x[4]=C=>s("activeLayers"))},null,8,["label","checked"]),x[10]||(x[10]=P("hr",{class:"section-divider"},null,-1))],32),P("div",yae,[P("button",{class:"lux-btn mr-auto",onClick:x[5]||(x[5]=C=>u())},K(M(r)("Rinitialiser")),1),P("button",{class:"lux-btn ml-auto",onClick:x[6]||(x[6]=C=>l())},K(M(r)("Sauvegarder la recherche")),1)])]))}}),vae=es(_ae,[["__scopeId","data-v-7268e4a2"]]),mA=ca("metadata",()=>{const n=mi();function e(i){n.value=i}function t(){n.value=void 0}return{metadataLayer:n,setMetadataLayer:e,clearMetadataLayer:t}},{}),bae={class:"search-dropdown"},xae={class:"search-input-wrapper"},Iae=["placeholder"],Cae={role:"listbox"},wae={key:0,class:"dropdown-title"},Aae=["onClick","onKeydown","aria-selected"],Sae=["innerHTML"],Eae={key:0,class:"search-result-routing"},Tae=["onClick"],Rae=["onClick","onKeydown"],Mae={key:1,class:"loading-indicator"},kae=at({__name:"search-dropdown",setup(n){const{setMetadataLayer:e}=mA(),{toggleRoutingOpen:t}=Jn(),i=Ct(()=>xt.value?"var(--color-tertiary)":"#ffffff"),{findThemeNamesByLayerId:r}=Tl(),{t:o,i18next:s}=St(),{maxZoom:l}=It(Ui()),u=Ue(),h=Ue(""),d=Ue(!1),m=Ue([]),y=Ue(!1),x={Adresse:["addresses"],Parcelle:["parcels","parcels_labels"],Parcelle_go:["parcels_go","parcels_labels_go"],Parcelle_prof:["parcels_prof","parcels_labels"],lieu_dit:["toponymes"],FLIK:["asta_flik_parcels"],FLIK_Provisoire:["asta_flik_parcels_provisoire"],asta_esp:["asta_esp_esp"],nom_de_rue:["roads","roads_labels"],Commune:["communes"]};let C=0;const w=["Addresses","Parcelles","Features","Layers","Website Pages","Background Layers","Coordinates"],E=Ct(()=>m.value.slice().sort((_e,Ie)=>{const pe=w.indexOf(_e.groupKey),Te=w.indexOf(Ie.groupKey);return(pe===-1?999:pe)-(Te===-1?999:Te)}));function T(_e){const{theme:Ie}=Zr();let pe=_e;_e==="Parcelle"&&typeof Ie=="string"&&["go","prof"].includes(Ie)&&(pe=pe+"_"+Ie);const Te=x[pe]||[],{findByName:We}=Tl(),tt=la();Te.forEach(function(nt){const bt=We(nt);bt!==void 0&&tt.toggleLayer(bt.id,!0,!1,!1)})}function k(_e,Ie){const pe=_e.features.filter(We=>We.properties.layer_name==="Parcelle"),Te=_e.features.filter(We=>We.properties.layer_name!=="Parcelle");pe.length&&m.value.push({header:o("Parcelles"),groupKey:"Parcelles",selectResult:Ie,results:pe.map(function(We){return{label:We.properties.label+(We.properties.layer_name?` (${o(We.properties.layer_name)})`:""),layer_name:We.properties.layer_name,entry:We,showRoutingButton:!0,showInfoButton:!1}})}),Te.length&&m.value.push({header:o("Addresses"),groupKey:"Addresses",selectResult:Ie,results:Te.map(function(We){return{label:We.properties.label+(We.properties.layer_name?` (${o(We.properties.layer_name)})`:""),layer_name:We.properties.layer_name,entry:We,showRoutingButton:!0,showInfoButton:!1}})})}function G(_e,Ie){m.value.push({header:o("Features"),groupKey:"Features",selectResult:Ie,results:_e.features.map(function(pe){return{label:pe.properties.label+(pe.properties.layer_name?` (${o(pe.properties.layer_name)})`:""),layer_name:pe.properties.layer_name,entry:pe,showRoutingButton:!0,showInfoButton:!1}})})}function O(_e){const Ie=_e.target;Ie.tagName==="A"&&Ie.hasAttribute("data-theme")&&(_e.preventDefault(),V(Ie.getAttribute("data-theme")))}function V(_e){Zr().setTheme(_e),wn()}function z(_e,Ie){m.value.push({header:o("Layers"),groupKey:"Layers",selectResult:Ie,results:_e.map(function(pe){const Te=me(pe.layer_id);return{label:o(pe.name)+Te,layer_id:pe.layer_id,name:pe.name,language:pe.language,showRoutingButton:!1,showInfoButton:!0}})})}function H(_e){const{findAnyLayerById:Ie}=Tl();if(_e.layer_id){const pe=Ie(_e.layer_id);pe&&e(pe)}}function te(_e){const Ie=gA();if(t(!0),Ie.openPanel(),_e.entry){const pe=_e.entry;let Te=null;if(pe.geometry&&pe.geometry.coordinates){const nt=pe.geometry.coordinates;pe.geometry.type==="Point"?Te=nt:Array.isArray(nt[0])&&(Te=nt[0])}else if(pe.getGeometry){const nt=pe.getGeometry();if(nt.getFirstCoordinate)Te=nt.getFirstCoordinate();else if(nt.getCoordinates){const bt=nt.getCoordinates();Te=Array.isArray(bt[0])?bt[0]:bt}}if(!Te){wn();return}const We=Ie.routes;let tt=We.findIndex(nt=>!nt||nt.trim()==="");tt===-1&&(tt=We.length),Ie.setStartPoint(Te,_e.label,tt)}wn()}function $(_e,Ie){m.value.push({header:o("Website Pages"),groupKey:"Website Pages",selectResult:Ie,results:_e.map(pe=>({label:o(pe.title),url:pe.url,text:pe.text,language:pe.language,showRoutingButton:!1,showInfoButton:!1}))})}function ae(_e){h.value=_e.label,vu.highlightFeatures([_e.entry],!0,l.value,Kn().getOlMap().getView().getProjection().getCode())}function fe(_e){switch(h.value=_e.label,T(_e.layer_name),_e.layer_name){case"Parcelle":vu.highlightFeatures([_e.entry],!0,l.value);break;case"Adresse":vu.highlightFeatures([_e.entry],!0,l.value);break;default:vu.clearFeatures(),vu.fitFeatures([_e.entry],l.value)}wn()}function Y(_e){pA().setBgLayer(_e.layer_id),wn()}function de(_e){la().toggleLayer(_e.layer_id,!0,!1,!1),wn()}function D(_e){window.open("https://www.geoportail.lu"+_e.url,"_blank"),wn(),h.value=_e.label}function oe(_e){h.value=_e.label,vu.highlightFeatures([_e.entry],!0,l.value),wn()}function ue(_e,Ie){m.value.push({header:o("Background Layers"),groupKey:"Background Layers",selectResult:Ie,results:_e.map(pe=>({label:o(pe.name),layer_id:pe.id,name:pe.name,showRoutingButton:!1,showInfoButton:!0}))})}async function ge(_e,Ie){return await(await ks(_e,Ie,"GET")).json()}async function Ne(_e,Ie){if(!pl.value.activeLayers)return!1;let pe={query:_e,limit:8,language:s.language},Te=Kn().getOlMap().getLayers().getArray().map(tt=>tt.get("queryable_id")).filter(tt=>tt!==void 0);if(pe.layers=Te.join(","),pl.value.extent){let tt=Kn().getOlMap().getView().calculateExtent();pe.extent=tt.join(",")}const We=await ge("https://migration.geoportail.lu/featuresearch",pe);Ie===C&&G(We,ae)}async function Ee(_e,Ie){let pe={query:_e,limit:8},Te=Object.keys(UO).filter(tt=>pl.value[tt]).map(tt=>UO[tt]).flat();if(Te.length>0&&(pe.layer=Te.join(",")),pl.value.extent){let tt=gb(Kn().getOlMap().getView().calculateExtent(),"EPSG:3857","EPSG:4326");pe.extent=tt.join(",")}const We=await ge("https://migration.geoportail.lu/fulltextsearch",pe);Ie===C&&k(We,fe)}async function se(_e,Ie){const Te=await ge("https://migration.geoportail.lu/layersearch",{query:_e,limit:8});Ie===C&&z(Te,de)}async function q(_e,Ie){const Te=await ge("https://migration.geoportail.lu/cmssearch",{query:_e,limit:8});Ie===C&&$(Te,D)}function j(_e,Ie){const{bgLayers:pe}=Zr();if(_e.length===0)return;const Te=pe.filter(We=>o(We.name).toLowerCase().includes(_e.toLowerCase()));Ie===C&&ue(Te,Y)}const ze={backgroundsearch:{getData:j},fulltextsearch:{getData:Ee},layersearch:{getData:se},cmssearch:{getData:q},featuresearch:{getData:Ne},coordinate:{getData:je}};function je(_e,Ie){if(Ie!==C)return;const pe=_e,Te=vu.map.getView().getProjection().getCode(),We=dae(pe,Te);m.value.push({header:o("Coordinates"),groupKey:"Coordinates",selectResult:oe,results:We.map(function(tt){return{label:tt.get("label")+" ("+tt.get("epsgLabel")+")",layer_name:"Coordinates",entry:tt,showRoutingButton:!0,showInfoButton:!1}})})}async function qe(_e,Ie){if(m.value=[],_e.length===0)return yt();y.value=!0,hn(),await Promise.all(Object.entries(ze).map(async([,pe])=>{"getData"in pe&&typeof pe.getData=="function"&&pe.getData(_e,Ie)})),Ie===C&&(y.value=!1,d.value=!0)}Pt(h,async _e=>{C++,qe(_e,C)});function yt(){vu.clearFeatures(),h.value="",m.value=[],wn()}const xt=Ue(!1);Pt(xt,_e=>{_e&&no(()=>{u.value&&(u.value.focusedIndex=0,u.value.focusItem(0))})});function Et(){if(xt.value){hn();return}wn(),kt()}function kt(){xt.value=!0}function hn(){xt.value=!1}function wn(){d.value=!1}const Ge=Ue(null);function ve(_e){const Ie=document.querySelectorAll(".dropdown-item")[_e];Ie&&Ie.focus()}function W(_e){if(_e.stopPropagation(),xt.value||!m.value.length)return;const Ie=m.value.flatMap(pe=>pe.results);if(Ge.value===null&&(Ge.value=0),_e.key==="ArrowDown")_e.preventDefault(),Ge.value<Ie.length-1&&(Ge.value++,ve(Ge.value));else if(_e.key==="ArrowUp")_e.preventDefault(),Ge.value>0&&(Ge.value--,ve(Ge.value));else if(_e.key==="Enter"||_e.key===" "||_e.code==="Space"){_e.preventDefault();let pe=Ge.value;for(const Te of m.value){if(pe<Te.results.length){Te.selectResult(Te.results[pe]);break}pe-=Te.results.length}}}function Ze(_e,Ie){let pe=0;for(let Te=0;Te<_e;Te++)pe+=m.value[Te].results.length;return pe+=Ie,Ge.value===pe}const Re=Ue(null);function ce(_e){(_e.key==="ArrowDown"||_e.key==="ArrowUp")&&d.value&&m.value.length&&(_e.preventDefault(),d.value&&(Ge.value=0,no(()=>{Re.value?.focus()})))}function me(_e){const Ie=r(_e),{themeName:pe}=It(Zr());return Ie.map(Te=>pe.value!==Te?`<br><a href="#" data-theme="${Te}">(${o("open in theme")} ${o(Te)})</a>`:"").join("")}return(_e,Ie)=>(U(),ie("div",bae,[P("div",xae,[An(P("input",{type:"text",placeholder:M(o)("Recherche adresse, parcelles, couches ..."),"onUpdate:modelValue":Ie[0]||(Ie[0]=pe=>h.value=pe),class:"w-full lux-input search-input",onKeydown:ce},null,40,Iae),[[Or,h.value]]),h.value.length?(U(),ie("button",{key:0,onClick:yt,class:"clear-button"},"  ")):Le("",!0),P("button",{class:"filter-button",onClick:Et},[P("span",{class:"filter-icon",style:Vc({color:i.value})},null,4)])]),d.value&&m.value.some(pe=>pe.results.length>0)?(U(),ie("div",{key:0,class:"dropdown",onKeydown:W,onClick:O,tabindex:"0",ref_key:"dropdownRef",ref:Re},[P("ul",Cae,[(U(!0),ie(Mt,null,hi(E.value,(pe,Te)=>(U(),ie("li",{key:Te},[pe.results.length>0?(U(),ie("div",wae,K(M(o)(pe.header)),1)):Le("",!0),P("ul",null,[(U(!0),ie(Mt,null,hi(pe.results,(We,tt)=>(U(),ie("li",{key:tt,onClick:nt=>pe.selectResult(We),class:Rn(["dropdown-item",{focused:Ze(Te,tt)}]),tabindex:"0",onKeydown:to(nt=>pe.selectResult(We),["enter"]),role:"option","aria-selected":Ze(Te,tt)},[P("span",{innerHTML:We.label},null,8,Sae),We.showRoutingButton?(U(),ie("span",Eae,[P("button",{class:"lux-btn-primary routing-button",onClick:ps(nt=>te(We),["stop"])},[...Ie[1]||(Ie[1]=[P("span",{class:"routing-icon"},null,-1)])],8,Tae)])):Le("",!0),We.showInfoButton?(U(),ie("button",{key:1,class:"search-result-info self-start before:text-[.85rem] before:transform before:translate-y-[.1rem] before:inline-block before:content-['\\f129'] fa-solid fa-fw fa-fh fa-info",onClick:[nt=>H(We),ps(nt=>H(We),["stop"])],onKeydown:[to(ps(nt=>H(We),["stop"]),["enter"]),to(ps(nt=>H(We),["stop","prevent"]),["space"])]},null,40,Rae)):Le("",!0)],42,Aae))),128))])]))),128))])],544)):Le("",!0),y.value?(U(),ie("div",Mae,K(M(o)("Loading...")),1)):Le("",!0),xt.value?(U(),Gt(vae,{key:2,ref_key:"filterPanelRef",ref:u,onClose:hn},null,512)):Le("",!0)]))}}),XO=es(kae,[["__scopeId","data-v-49549e46"]]),Lae={class:"w-full h-14 flex bg-white shadow-header z-10 shrink-0"},Pae={class:"grow flex justify-center items-center"},Gae={class:"h-full flex"},Fae={class:"hidden md:flex"},Oae={class:"hidden lg:inline-block"},Nae={class:"block md:hidden"},Dae={class:"border-l-[1px] border-stone-300 h-full"},Vae={class:"border-l-[1px] border-stone-300 h-full"},Bae=at({__name:"header-bar",setup(n){const{t:e}=St(),t=Jn(),{toggleAuthFormOpen:i,toggleThemeGrid:r}=t,{authFormOpened:o}=It(t),{themeName:s}=It(Zr()),{authenticated:l}=It(iu()),u=Ue(!1),h=Ue(!1);Pt(l,y=>y&&i(!1));function d(y){u.value=y,y&&i(!1)}function m(y){i(y),y&&(u.value=!1)}return(y,x)=>(U(),ie("header",Lae,[x[2]||(x[2]=P("div",{class:"flex-2 p-[5px]"},[P("img",{src:Y4})],-1)),P("div",Pae,[mt(XO,{class:"hidden md:block"}),h.value?(U(),Gt(XO,{key:0,class:"block md:hidden"})):Le("",!0)]),P("div",null,[P("ul",Gae,[P("li",Fae,[P("button",{class:Rn(["flex items-center before:font-icons before:text-3xl before:w-16 text-primary uppercase h-full mr-3",`before:content-${M(s)}`]),"data-cy":"selectedThemeIcon",onClick:x[0]||(x[0]=(...C)=>M(r)&&M(r)(...C))},[P("span",Oae,K(M(e)(`${M(s)}`)),1)],2)]),P("li",Nae,[P("button",{class:"lux-btn lux-dropdown-btn h-full",onClick:x[1]||(x[1]=C=>h.value=!h.value)},[P("span",{class:Rn(["before:font-icons before:text-3xl after:font-icons after:text-3xl",[{"lux-navbar-search-dropdown":!h.value},{"lux-navbar-search-close":h.value}]])},null,2)])]),P("li",Dae,[mt(cae,{"data-cy":"langSelect",class:"flex-none h-full",isOpen:u.value,onToggleDropdown:d},null,8,["isOpen"])]),P("li",Vae,[mt(H4,{"data-cy":"authFormIcon",class:"lux-navbar-dropdown lux-navbar-dropdown-auth h-full",enableClickOutside:!1,isOpen:M(o),onToggleDropdown:m},{default:Wt(()=>[mt(Vee,{class:"w-80"})]),_:1},8,["isOpen"])])])])]))}}),Zae={class:"w-full h-14 flex items-center justify-center bg-orange-600 shadow-header z-10 shrink-0",role:"alert","aria-live":"polite"},Wae={class:"flex items-center gap-3 px-4"},zae={class:"text-white"},Uae={class:"font-semibold text-base","data-cy":"offlineHeaderMessage"},Xae={class:"text-xs opacity-90 hidden sm:block"},Yae=at({__name:"header-bar-offline",setup(n){const{t:e}=St();return(t,i)=>(U(),ie("header",Zae,[P("div",Wae,[i[0]||(i[0]=P("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},[P("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3"})],-1)),P("div",zae,[P("p",Uae,K(M(e)("You are currently disconnected")),1),P("p",Xae,K(M(e)("Features requiring network connection are temporarily hidden")),1)]),i[1]||(i[1]=P("div",{class:"ml-auto hidden md:block opacity-80"},[P("img",{src:Y4,alt:"Luxembourg Government",class:"h-8 brightness-0 invert"})],-1))])]))}}),Hae=es(Yae,[["__scopeId","data-v-01f0cfe8"]]),Ll="https://migration.geoportail.lu/mymaps";async function Kae(){const n=await ks(Ll+"/maps",{});if(!n.ok)throw new Error("Error while trying to get My Maps");return await n.json()}async function jae(n){const e=await ks(Ll+"/map/"+n,{});if(!e.ok)throw new Error("Error while trying to get My Map info");return await e.json()}async function $ae(){const n=await ks(Ll+"/categories",{});if(!n.ok)throw new Error("Error while trying to get categories");return await n.json()}async function $B(n,e,t,i){const r={title:n,description:e,category_id:t,public:i},o=await ks(Ll+"/create",r,"POST");if(!o.ok)throw new Error("Error while trying to create My Map");return await o.json()}async function Jae(n,e,t,i,r){const o={title:e,description:t,category_id:i,public:r,dirty:!0},s=await ks(Ll+"/update/"+n,o,"PUT");if(!s.ok)throw new Error("Error while trying to update My Map");return await s.json()}async function JB(n,e,t,i,r,o,s,l){const u={bgLayer:e,bgOpacity:t,layers:i,layers_opacity:r,layers_visibility:o,layers_indices:s,theme:l},h=await ks(Ll+"/update/"+n,u,"PUT");if(!h.ok)throw new Error("Error while trying to update My Map");return await h.json()}async function qae(n,e,t,i,r){const o={title:e,description:t,category_id:i,public:r},s=await ks(Ll+"/copy/"+n,o,"POST");if(!s.ok)throw new Error("Error while trying to copy My Map");return await s.json()}async function Qae(n){const e=await ks(Ll+"/delete/"+n,{},"DELETE");if(!e.ok)throw new Error("Error while trying to delete My Map");return(await e.json()).success}async function ele(n){const e=await ks(Ll+"/delete_all_features/"+n,{},"DELETE");if(!e.ok)throw new Error("Error while trying to clear My Map");return(await e.json()).success}async function HC(n,e){const t={feature:e},i=await ks(Ll+"/save_feature/"+n,t,"POST");if(!i.ok)throw new Error("Error while trying to save feature to My Map");return await i.json()}async function tle(n,e){const t={orders:JSON.stringify(e)},i=await ks(Ll+"/save_order/"+n,t,"POST");if(!i.ok)throw new Error("Error while trying to save features order to My Map");return await i.json()}async function qB(n){const e=await ks(Ll+"/delete_feature/"+n,{},"DELETE");if(!e.ok)throw new Error("Error while trying to delete feature to My Map");return await e.json()}async function nle(n){const e=await ks(Ll+"/features/"+n,{});if(!e.ok)throw new Error("Error while trying to fetch My Map features");return await e.json()}const zr=ca("draw",()=>{const{t:n}=St(),{addNotification:e}=Qr(),t=Ue(void 0),i=Ue(void 0),r=Ue(void 0),o=Ue(void 0),s=Ue([]),l=Ct(()=>s.value.filter(j=>!j.map_id)),u=Ct(()=>s.value.filter(j=>j.map_id)),h=Ct(()=>i.value?s.value.find(j=>j.id===i.value):void 0),d=Ue(!1),m=Ue(void 0),y=Ue(!1),x=Ue(!1),C=mi([]),w=Ue(!1);function E(){V("drawPoint")}function T(){V("drawLabel")}function k(){V("drawLine")}function G(){V("drawPolygon")}function O(){V("drawCircle")}function V(j){const ze=o.value?.replace("edit","").replace("Continue",""),je=j?.replace("draw","").replace("Continue","");ze===je?(r.value=void 0,o.value=void 0,i.value=void 0):r.value===j?r.value=void 0:z(j)}function z(j){j&&(o.value=void 0,i.value=void 0),r.value=j}function H(j){j?r.value=void 0:i.value=void 0,o.value=j}function te(){r.value=void 0,i.value=void 0,o.value=void 0}function $(){z("drawLineContinue")}async function ae(j){if(C.value=[j],s.value=[...s.value,j],j.map_id!==void 0){const ze=await HC(j.map_id,j.toGeoJSONString()).catch(je=>e(n("Erreur inattendue lors de la sauvegarde de votre modification."),ii.ERROR));j.id=ze.id,j.fid=ze.id}}function fe(j){t.value=j.id,i.value=j.id,o.value=j.featureType.replace("drawn","edit").replace("Continue",""),r.value=void 0}function Y(j){const ze=s.value.findIndex(je=>je.id===j.id);ze!==-1&&(s.value[ze]=j),s.value=[...s.value],j.map_id!==void 0&&HC(j.map_id,j.toGeoJSONString())}function de(j){s.value=j}function D(j,ze=!0){const je=Array.isArray(j)?j:[j];ze&&je.forEach(qe=>{const yt=s.value.find(xt=>xt.id===qe);yt&&yt.map_id&&ze&&qB(yt.id).catch(xt=>e(n("Erreur inattendue lors de la sauvegarde de votre modification."),ii.ERROR))}),s.value=s.value.filter(qe=>!je.includes(qe.id)),(je.includes(t.value)||je.includes(i.value))&&(t.value=void 0,i.value=void 0)}function oe(j){t.value=void 0,i.value=void 0;const ze=s.value.filter(je=>je.map_id===j).map(je=>je.id);return D(ze,!1)}function ue(){t.value=void 0,i.value=void 0,s.value=s.value.filter(j=>j.map_id)}function ge(j){s.value=s.value.map(je=>Object.assign(je,{display_order:j.indexOf(`f-${je.id}`)}));const ze=s.value.filter(je=>je.map_id);if(ze.length>0){const je=ze[0].map_id,qe=ze.map(yt=>({fid:yt.id,display_order:yt.display_order}));tle(je,qe)}}function Ne(j){return s.value.filter(ze=>ze.getGeometry()&&j.includes(ze.getGeometry()?.getType()))}function Ee(j){return s.value.filter(ze=>j.includes(ze.id))}function se(j){w.value=j??!w.value}function q(j){y.value=j??!y.value}return{activeFeatureId:t,editingFeatureId:i,drawStateActive:r,editStateActive:o,drawnFeatures:s,drawnFeaturesExceptMyMaps:l,drawnFeaturesMyMaps:u,editingFeature:h,featureEditionDocked:d,currentDrawInteraction:m,clipLineActive:y,followRoads:x,queueAddedDrawnFeatures:C,showModalMergeLines:w,deactivateDraw:te,removeFeature:D,removeMyMapsFeature:oe,removeAllFeatures:ue,reorderFeatures:ge,toggleDrawCircle:O,toggleDrawLabel:T,toggleDrawLine:k,toggleDrawPolygon:G,toggleDrawPoint:E,toggleDrawActiveState:V,setDrawActiveState:z,setEditActiveState:H,activateDrawLineContinue:$,addDrawnFeatureToCollection:ae,selectDrawnFeature:fe,updateDrawnFeature:Y,setDrawnFeatures:de,getDrawnFeaturesOfTypes:Ne,getDrawnFeaturesWithIds:Ee,toggleDrawMergeLinesModal:se,toggleDrawCutLineMode:q}}),rg=ca("featureInfo",()=>{const n=mi(),e=mi(),t=mi(!1),i=mi(!1);function r(h){!h||h.length===0?n.value=void 0:(n.value=[...h],t.value=!1)}function o(){n.value=void 0,t.value=!1}function s(h){e.value=h}function l(h){t.value=h}function u(h){i.value=h}return{featureInfoPanelContent:n,fid:e,isLoading:t,displayStarOnMobile:i,setFeatureInfoPanelContent:r,clearContent:o,setFid:s,setLoading:l,setDisplayStarOnMobile:u}},{}),ile=["aria-label","aria-pressed"],rle={class:"block text-[13px] sm:text-base uppercase"},xh=at({__name:"button-icon",props:{label:{},icon:{},active:{type:Boolean},ariaLabel:{}},setup(n){const e=n;return(t,i)=>(U(),ie("button",{class:Rn(["h-[42px] w-full sm:h-full sm:w-16 hover:text-white hover:bg-primary",e.active?"bg-primary text-white":""]),"aria-label":e.ariaLabel||e.label,"aria-pressed":e.active!==void 0?e.active:void 0},[P("span",{class:Rn(["block text-[1.7rem] sm:text-[2rem] -mt-1.5 -mb-3 after:font-icons",e.active?"lux-close-cross":`after:content-${e.icon}`]),"aria-hidden":"true"},null,2),P("span",rle,K(e.label),1)],10,ile))}}),sle=["href"],vp=at({__name:"button-link",props:{label:{},link:{}},setup(n){const e=n;return(t,i)=>(U(),ie("a",{class:"h-full flex flex-col justify-center px-[7px] uppercase hover:text-white hover:bg-primary",href:`${e.link}`,target:"_blank"},K(t.$props.label),9,sle))}});function ef(n,e){const t=n.length;return e<0?n[e+t]:e>=t?n[e-t]:n[e]}function jm(n,e){const t=n.length;let i=Math.floor(e);const r=e-i;i>=t?i-=t:i<0&&(i+=t);let o=i+1;o>=t&&(o-=t);const s=n[i],l=s[0],u=s[1],h=n[o],d=h[0]-l,m=h[1]-u;return[l+d*r,u+m*r]}const Mx={index:-1,endIndex:NaN,closestTargetDistance:1/0};function QB(n,e,t,i){const r=n[0],o=n[1];let s=1/0,l=-1,u=NaN;for(let m=0;m<e.targets.length;++m){const y=e.targets[m],x=y.coordinates;let C=1/0,w;for(let E=0;E<x.length-1;++E){const T=x[E],k=x[E+1],G=nZ(r,o,T,k);G.squaredDistance<C&&(C=G.squaredDistance,w=E+G.along)}C<s&&(s=C,y.ring&&e.targetIndex===m&&(y.endIndex>y.startIndex?w<y.startIndex&&(w+=x.length):y.endIndex<y.startIndex&&w>y.startIndex&&(w-=x.length)),u=w,l=m)}const h=e.targets[l];let d=h.ring;if(e.targetIndex===l&&d){const m=jm(h.coordinates,u),y=t.getPixelFromCoordinate(m),x=t.getPixelFromCoordinate(e.startCoord);Bm(y,x)>i&&(d=!1)}if(d){const m=h.coordinates,y=m.length,x=h.startIndex,C=u;if(x<C){const w=Px(m,x,C);Px(m,x,C-y)<w&&(u-=y)}else{const w=Px(m,x,C);Px(m,x,C+y)<w&&(u+=y)}}return Mx.index=l,Mx.endIndex=u,Mx.closestTargetDistance=s,Mx}function eZ(n,e){const t=[];for(let i=0;i<e.length;++i){const o=e[i].getGeometry();tZ(n,o,t)}return t}function tZ(n,e,t){if(e instanceof qi){kx(n,e.getCoordinates(),!1,t);return}if(e instanceof Du){const i=e.getCoordinates();for(let r=0,o=i.length;r<o;++r)kx(n,i[r],!1,t);return}if(e instanceof Bo){const i=e.getCoordinates();for(let r=0,o=i.length;r<o;++r)kx(n,i[r],!0,t);return}if(e instanceof vf){const i=e.getCoordinates();for(let r=0,o=i.length;r<o;++r){const s=i[r];for(let l=0,u=s.length;l<u;++l)kx(n,s[l],!0,t)}return}if(e instanceof ql){const i=e.getGeometries();for(let r=0;r<i.length;++r)tZ(n,i[r],t);return}}function kx(n,e,t,i){const r=n[0],o=n[1];for(let s=0,l=e.length-1;s<l;++s){const u=e[s],h=e[s+1],d=nZ(r,o,u,h);if(d.squaredDistance===0){const m=s+d.along;i.push({coordinates:e,ring:t,startIndex:m,endIndex:m});return}}}function Lx(n,e){return Gh(n[0],n[1],e[0],e[1])}function Px(n,e,t){let i,r;e<t?(i=e,r=t):(i=t,r=e);const o=Math.ceil(i),s=Math.floor(r);if(o>s){const u=jm(n,i),h=jm(n,r);return Lx(u,h)}let l=0;if(i<o){const u=jm(n,i),h=ef(n,o);l+=Lx(u,h)}if(s<r){const u=ef(n,s),h=jm(n,r);l+=Lx(u,h)}for(let u=o;u<s-1;++u){const h=ef(n,u),d=ef(n,u+1);l+=Lx(h,d)}return l}const FS={along:0,squaredDistance:0};function nZ(n,e,t,i){const r=t[0],o=t[1],s=i[0],l=i[1],u=s-r,h=l-o;let d=0,m=r,y=o;return(u!==0||h!==0)&&(d=Wr(((n-r)*u+(e-o)*h)/(u*u+h*h),0,1),m+=u*d,y+=h*d),FS.along=d,FS.squaredDistance=Zy(Gh(n,e,m,y),10),FS}const Gx={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Fx extends Vo{constructor(e,t){super(e),this.feature=t}}class t_ extends Zc{constructor(e){const t=e;t.stopDown||(t.stopDown=Uy),super(t),this.on,this.once,this.un,this.options_=e,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=ale(this.type_),this.stopClick_=!!e.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:gf,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const r=this.mode_;if(r==="Circle")i=(o,s,l)=>{const u=s||new _f([NaN,NaN]),h=fs(o[0]),d=Oh(h,fs(o[o.length-1]));return u.setCenterAndRadius(h,Math.sqrt(d),this.geometryLayout_),u};else{let o;r==="Point"?o=zi:r==="LineString"?o=qi:r==="Polygon"&&(o=Bo),i=(s,l,u)=>(l?r==="Polygon"?s[0].length?l.setCoordinates([s[0].concat([s[0][0]])],this.geometryLayout_):l.setCoordinates([],this.geometryLayout_):l.setCoordinates(s,this.geometryLayout_):l=new o(s,this.geometryLayout_),l)}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new gs({source:new io({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:ole(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:eA,this.freehandCondition_,e.freehand?this.freehandCondition_=ay:this.freehandCondition_=e.freehandCondition?e.freehandCondition:mC,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(QE.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=ay:t=e:t=gC,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}setFreehand(e){this.freehand_=e,this.freehand_?this.freehandCondition_=ay:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:mC}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(e){e.originalEvent.type===Qn.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===Vi.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===Vi.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===Vi.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===Vi.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===Vi.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===Vi.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===Vi.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new gc(Vi.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),r=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),o=Js([i,r]),s=this.traceSource_.getFeaturesInExtent(o);if(s.length===0)return;const l=eZ(e.coordinate,s);l.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:l,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,r=e.startIndex<=t;i===r?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const r=Math.ceil(e);let o=Math.floor(t);o===t&&(o-=1),i=o-r+1}else{const r=Math.floor(e);let o=Math.ceil(t);o===t&&(o+=1),i=r-o+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const r=[];if(t<i){const o=Math.ceil(t);let s=Math.floor(i);s===i&&(s-=1);for(let l=o;l<=s;++l)r.push(ef(e.coordinates,l))}else{const o=Math.floor(t);let s=Math.ceil(i);s===i&&(s+=1);for(let l=o;l>=s;--l)r.push(ef(e.coordinates,l))}r.length&&this.appendCoordinates(r)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const l=e.map.getPixelFromCoordinate(t.startCoord);if(Bm(l,e.pixel)<this.snapTolerance_)return}const i=QB(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const u=t.targets[t.targetIndex];this.removeTracedCoordinates_(u.startIndex,u.endIndex)}const l=t.targets[i.index];this.addTracedCoordinates_(l,l.startIndex,i.endIndex)}else{const l=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(l,i.endIndex)}t.targetIndex=i.index;const r=t.targets[t.targetIndex];r.endIndex=i.endIndex;const o=jm(r.coordinates,r.endIndex),s=this.getMap().getPixelFromCoordinate(o);e.coordinate=o,e.pixel=[Math.round(s[0]),Math.round(s[1])]}handleDragEvent(e){this.ignoreNextUpEvent_=!0,super.handleDragEvent(e)}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(e),this.shouldHandle_){const r=!this.finishCoordinate_;r&&this.startDrawing_(e.coordinate),!r&&this.freehand_?this.finishDrawing():!this.freehand_&&(!r||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,r=t[0]-i[0],o=t[1]-i[1],s=r*r+o*o;if(this.shouldHandle_=this.freehand_?s>this.squaredClickTolerance_:s<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let r=!1,o=[this.finishCoordinate_];const s=this.mode_;if(s==="Point")i=!0;else if(s==="Circle")i=this.sketchCoords_.length===2;else if(s==="LineString")r=!t&&this.sketchCoords_.length>this.minPoints_;else if(s==="Polygon"){const l=this.sketchCoords_;r=l[0].length>this.minPoints_,o=[l[0][0],l[0][l[0].length-2]],t?o=[l[0][0]]:o=[l[0][0],l[0][l[0].length-2]]}if(r){const l=this.getMap();for(let u=0,h=o.length;u<h;u++){const d=o[u],m=l.getPixelFromCoordinate(d),y=e[0]-m[0],x=e[1]-m[1],C=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(y*y+x*x)<=C,i){this.finishCoordinate_=d;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new yi(new zi(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new yi);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new qi(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=cC(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new yi(new qi(this.sketchLineCoords_)));const r=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new yi,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new Fx(Gx.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),r=t.getView().getProjection(),o=cC(this.geometryLayout_);let s,l;for(;e.length<o;)e.push(0);this.mode_==="Point"?l=this.sketchCoords_:this.mode_==="Polygon"?(s=this.sketchCoords_[0],l=s[s.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(s=this.sketchCoords_,l=s[s.length-1]),l[0]=e[0],l[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,r),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let r,o;const s=this.mode_;return s==="LineString"||s==="Circle"?(this.finishCoordinate_=e.slice(),o=this.sketchCoords_,o.length>=this.maxPoints_&&(this.freehand_?o.pop():r=!0),o.push(e.slice()),this.geometryFunction_(o,t,i)):s==="Polygon"&&(o=this.sketchCoords_[0],o.length>=this.maxPoints_&&(this.freehand_?o.pop():r=!0),o.push(e.slice()),r&&(this.finishCoordinate_=o[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),r?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),r=this.mode_;for(let o=0;o<e;++o){let s;if(r==="LineString"||r==="Circle"){if(s=this.sketchCoords_,s.splice(-2,1),s.length>=2){this.finishCoordinate_=s[s.length-2].slice();const l=this.finishCoordinate_.slice();s[s.length-1]=l,this.createOrUpdateSketchPoint_(l)}this.geometryFunction_(s,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(r==="Polygon"){s=this.sketchCoords_[0],s.splice(-2,1);const l=this.sketchLine_.getGeometry();if(s.length>=2){const u=s[s.length-2].slice();s[s.length-1]=u,this.createOrUpdateSketchPoint_(u)}l.setCoordinates(s),this.geometryFunction_(this.sketchCoords_,t,i)}if(s.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const i=e.getGeometry(),r=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,r)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,r),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new $h([t])):this.type_==="MultiLineString"?e.setGeometry(new Du([t])):this.type_==="MultiPolygon"&&e.setGeometry(new vf([t])),this.dispatchEvent(new Fx(Gx.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Fx(Gx.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let r;if(t==="LineString"||t==="Circle")r=this.sketchCoords_;else if(t==="Polygon")r=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&r.shift(),r.pop();for(let s=0;s<e.length;s++)this.addToDrawing_(e[s]);const o=e[e.length-1];this.sketchFeature_=this.addToDrawing_(o),this.modifyDrawing_(o)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.sketchPoint_=new yi(new zi(r)),this.updateSketchFeatures_(),this.dispatchEvent(new Fx(Gx.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function ole(){const n=CM();return function(e,t){return n[e.getGeometry().getType()]}}function ale(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const YO=0,lv=1,HO=[0,0,0,0],gy=[],OS={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function NS(n,e,t){let i;switch(e){case"LineString":i=n;break;case"MultiLineString":case"Polygon":i=n[t[0]];break;case"MultiPolygon":i=n[t[1]][t[0]];break}return i}class wI extends Vo{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class iZ extends Zc{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:$D,this.defaultDeleteCondition_=function(i){return YH(i)&&pM(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:ay,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new PC,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new gs({source:new io({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:ule(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new Ts(this.source_.getFeatures()),this.source_.addEventListener(Ba.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Ba.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(eo.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(eo.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;e?e===!0?t=ay:t=e:t=gC,this.traceCondition_=t}addFeature_(e){const t=e.getGeometry();if(t){const r=this.SEGMENT_WRITERS_[t.getType()];r&&r(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener(Qn.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Ts;const i=this.featuresBeingModified_.getArray();for(let r=0,o=t.length;r<o;++r){const s=t[r].feature;s&&!i.includes(s)&&this.featuresBeingModified_.push(s)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new wI(OS.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Qn.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(r){e===r.feature&&i.push(r)});for(let r=i.length-1;r>=0;--r){const o=i[r];for(let s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===o&&this.dragSegments_.splice(s,1);t.remove(o)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),r={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),r)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let r=0,o=i.length;r<o;++r){const s=i[r],l={feature:e,geometry:t,depth:[r],index:r,segment:[s,s]};this.rBush_.insert(t.getExtent(),l)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,o=i.length-1;r<o;++r){const s=i.slice(r,r+2),l={feature:e,geometry:t,index:r,segment:s};this.rBush_.insert(Js(s),l)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,o=i.length;r<o;++r){const s=i[r];for(let l=0,u=s.length-1;l<u;++l){const h=s.slice(l,l+2),d={feature:e,geometry:t,depth:[r],index:l,segment:h};this.rBush_.insert(Js(h),d)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,o=i.length;r<o;++r){const s=i[r];for(let l=0,u=s.length-1;l<u;++l){const h=s.slice(l,l+2),d={feature:e,geometry:t,depth:[r],index:l,segment:h};this.rBush_.insert(Js(h),d)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,o=i.length;r<o;++r){const s=i[r];for(let l=0,u=s.length;l<u;++l){const h=s[l];for(let d=0,m=h.length-1;d<m;++d){const y=h.slice(d,d+2),x={feature:e,geometry:t,depth:[l,r],index:d,segment:y};this.rBush_.insert(Js(y),x)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),r={feature:e,geometry:t,index:YO,segment:[i,i]},o={feature:e,geometry:t,index:lv,segment:[i,i]},s=[r,o];r.featureSegments=s,o.featureSegments=s,this.rBush_.insert(sy(i),r);let l=t;this.rBush_.insert(l.getExtent(),o)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let r=0;r<i.length;++r){const o=i[r],s=this.SEGMENT_WRITERS_[o.getType()];s(e,o)}}createOrUpdateVertexFeature_(e,t,i,r){let o=this.vertexFeature_;return o?o.getGeometry().setCoordinates(e):(o=new yi(new zi(e)),this.vertexFeature_=o,this.overlay_.getSource().addFeature(o)),o.set("features",t),o.set("geometries",i),o.set("existing",r),o}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==Vi.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Vi.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==Vi.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;this.getMap().getView().getProjection();const i=[],r=this.vertexFeature_.getGeometry().getCoordinates(),o=Js([r]),s=this.rBush_.getInExtent(o),l={};s.sort(lle);for(let u=0,h=s.length;u<h;++u){const d=s[u],m=d.segment;let y=Yn(d.geometry);const x=d.depth;if(x&&(y+="-"+x.join("-")),l[y]||(l[y]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===lv){const C=jO(e,d);Jo(C,r)&&!l[y][0]&&(this.dragSegments_.push([d,0]),l[y][0]=d);continue}if(Jo(m[0],r)&&!l[y][0]){this.dragSegments_.push([d,0]),l[y][0]=d;continue}if(Jo(m[1],r)&&!l[y][1]){if(l[y][0]&&l[y][0].index===0){let C=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":C=C[x[1]];case"Polygon":if(d.index!==C[x[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),l[y][1]=d;continue}Yn(m)in this.vertexSegments_&&!l[y][0]&&!l[y][1]&&i.push(d)}return i}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const o=e.map.getPixelFromCoordinate(t.startCoord);if(Bm(o,e.pixel)<this.pixelTolerance_)return}const i=QB(e.coordinate,t,e.map,this.pixelTolerance_);if(t.targetIndex===-1&&Math.sqrt(i.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)return;if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const s=t.targets[t.targetIndex];this.removeTracedCoordinates_(s.startIndex,s.endIndex)}else for(const s of this.traceSegments_){const l=s[0],u=l.geometry,h=s[1],d=u.getCoordinates();NS(d,u.getType(),l.depth).splice(l.index+h,1),u.setCoordinates(d),h===0&&(l.index-=1)}const o=t.targets[i.index];this.addTracedCoordinates_(o,o.startIndex,i.endIndex)}else{const o=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(o,i.endIndex)}t.targetIndex=i.index;const r=t.targets[t.targetIndex];r.endIndex=i.endIndex}getTraceCandidates_(e){const t=this.getMap(),i=this.pixelTolerance_,r=t.getCoordinateFromPixel([e.pixel[0]-i,e.pixel[1]+i]),o=t.getCoordinateFromPixel([e.pixel[0]+i,e.pixel[1]-i]),s=Js([r,o]);return this.traceSource_.getFeaturesInExtent(s)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}const t=this.getTraceCandidates_(e);if(t.length===0)return;const i=eZ(e.coordinate,t);i.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:i,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,r=e.startIndex<=t;i===r?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const r=Math.ceil(e);let o=Math.floor(t);o===t&&(o-=1),i=o-r+1}else{const r=Math.floor(e);let o=Math.ceil(t);o===t&&(o+=1),i=r-o+1}if(i>0)for(const r of this.traceSegments_){const o=r[0],s=o.geometry,l=r[1];let u=r[0].index+1;l===1&&(u-=i);const h=s.getCoordinates();NS(h,s.getType(),o.depth).splice(u,i),s.setCoordinates(h),l===1&&(o.index-=i)}}addTracedCoordinates_(e,t,i){if(t===i)return;const r=[];if(t<i){const o=Math.ceil(t);let s=Math.floor(i);s===i&&(s-=1);for(let l=o;l<=s;++l)r.push(ef(e.coordinates,l))}else{const o=Math.floor(t);let s=Math.ceil(i);s===i&&(s+=1);for(let l=o;l>=s;--l)r.push(ef(e.coordinates,l))}if(r.length)for(const o of this.traceSegments_){const s=o[0],l=s.geometry,u=o[1],h=s.index+1;u===0&&r.reverse();const d=l.getCoordinates();NS(d,l.getType(),s.depth).splice(h,0,...r),l.setCoordinates(d),u===1&&(s.index+=r.length)}}updateGeometry_(e,t){const i=t[0],r=i.depth;let o;const s=i.segment,l=i.geometry,u=t[1];for(;e.length<l.getStride();)e.push(s[u][e.length]);switch(l.getType()){case"Point":o=e,s[0]=e,s[1]=e;break;case"MultiPoint":o=l.getCoordinates(),o[i.index]=e,s[0]=e,s[1]=e;break;case"LineString":o=l.getCoordinates(),o[i.index+u]=e,s[u]=e;break;case"MultiLineString":o=l.getCoordinates(),o[r[0]][i.index+u]=e,s[u]=e;break;case"Polygon":o=l.getCoordinates(),o[r[0]][i.index+u]=e,s[u]=e;break;case"MultiPolygon":o=l.getCoordinates(),o[r[1]][r[0]][i.index+u]=e,s[u]=e;break;case"Circle":const h=l;if(s[0]=e,s[1]=e,i.index===YO)this.changingFeature_=!0,h.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,this.getMap().getView().getProjection();let d=Bm(fs(h.getCenter()),fs(e));h.setRadius(d),this.changingFeature_=!1}break}o&&this.setGeometryCoordinates_(l,o)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([s])=>s));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],r=[],o=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(o){this.traceSegments_=[];for(const s of this.dragSegments_){const l=s[0];Bm(fb(o,l.segment),o)/e.map.getView().getResolution()<1&&this.traceSegments_.push(s)}}for(let s=0,l=this.dragSegments_.length;s<l;++s){const u=this.dragSegments_[s],h=u[0],d=h.feature;i.includes(d)||i.push(d);const m=h.geometry;r.includes(m)||r.push(m),this.updateGeometry_(t,u)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,i,r,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(t);if(i?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,i),this.vertexFeature_)){const r=this.vertexFeature_.getGeometry().getCoordinates();for(let o=i.length-1;o>=0;--o)this.insertVertex_(i[o],r);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],r=i.geometry;if(r.getType()==="Circle"){const o=r,s=o.getCenter(),l=i.featureSegments[0],u=i.featureSegments[1];l.segment[0]=s,l.segment[1]=s,u.segment[0]=s,u.segment[1]=s,this.rBush_.update(sy(s),l);let h=o;this.rBush_.update(h.getExtent(),u)}else this.rBush_.update(Js(i.segment),i)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new wI(OS.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){const t=this.getMap(),i=t.getPixelFromCoordinate(e);t.getView().getProjection();const r=function(l,u){return KO(e,l)-KO(e,u)};let o,s;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?u=>u===this.hitDetection_:void 0;t.forEachFeatureAtPixel(i,(u,h,d)=>{d&&d.getType()==="Point"&&(d=new zi(Jp(d.getCoordinates())));const m=d||u.getGeometry();if(m&&m.getType()==="Point"&&u instanceof yi&&this.features_.getArray().includes(u)){s=m;const y=u.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:u,geometry:s,segment:[y,y]}]}return!0},{layerFilter:l})}if(!o){const l=Xl(sy(e,HO)),u=t.getView().getResolution()*this.pixelTolerance_,h=Hw(Kh(l,u,HO));o=this.rBush_.getInExtent(h)}if(o&&o.length>0){const l=o.sort(r)[0],u=l.segment;let h=jO(e,l);const d=t.getPixelFromCoordinate(h);let m=Bm(i,d);if(s||m<=this.pixelTolerance_){const y={};if(y[Yn(u)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-e[0],this.delta_[1]=h[1]-e[1]),l.geometry.getType()==="Circle"&&l.index===lv)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[l.feature],[l.geometry],this.snappedToVertex_);else{const x=t.getPixelFromCoordinate(u[0]),C=t.getPixelFromCoordinate(u[1]),w=Oh(d,x),E=Oh(d,C);if(m=Math.sqrt(Math.min(w,E)),this.snappedToVertex_=m<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(h=w>E?u[1]:u[0]),this.createOrUpdateVertexFeature_(h,[l.feature],[l.geometry],this.snappedToVertex_);const T={};T[Yn(l.geometry)]=!0;for(let k=1,G=o.length;k<G;++k){const O=o[k].segment;if(Jo(u[0],O[0])&&Jo(u[1],O[1])||Jo(u[0],O[1])&&Jo(u[1],O[0])){const V=Yn(o[k].geometry);V in T||(T[V]=!0,y[Yn(O)]=!0)}else break}}this.vertexSegments_=y;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,r=e.feature,o=e.geometry,s=e.depth,l=e.index;let u;for(;t.length<o.getStride();)t.push(0);switch(o.getType()){case"MultiLineString":u=o.getCoordinates(),u[s[0]].splice(l+1,0,t);break;case"Polygon":u=o.getCoordinates(),u[s[0]].splice(l+1,0,t);break;case"MultiPolygon":u=o.getCoordinates(),u[s[1]][s[0]].splice(l+1,0,t);break;case"LineString":u=o.getCoordinates(),u.splice(l+1,0,t);break;default:return!1}this.setGeometryCoordinates_(o,u);const h=this.rBush_;h.remove(e),this.updateSegmentIndices_(o,l,s,1);const d={segment:[i[0],t],feature:r,geometry:o,depth:s,index:l};h.insert(Js(d.segment),d),this.dragSegments_.push([d,1]);const m={segment:[t,i[1]],feature:r,geometry:o,depth:s,index:l+1};return h.insert(Js(m.segment),m),this.dragSegments_.push([m,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const e=this.vertexFeature_?.getGeometry().getCoordinates();return e?Jp(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(Js([e])).some(({segment:i})=>Jo(i[0],e)||Jo(i[1],e))}removePoint(e){if(e&&(e=fs(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=Vi.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([r])=>r));const i=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new wI(OS.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,i}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,r,o,s,l,u,h,d,m,y,x,C;for(u=e.length-1;u>=0;--u)s=e[u],x=s[0],C=Yn(x.feature),x.depth&&(C+="-"+x.depth.join("-")),C in t||(t[C]={}),s[1]===0?(t[C].right=x,t[C].index=x.index):s[1]==1&&(t[C].left=x,t[C].index=x.index+1);for(C in t){switch(y=t[C].right,d=t[C].left,h=t[C].index,m=h-1,d!==void 0?x=d:x=y,m<0&&(m=0),l=x.geometry,o=l.getCoordinates(),r=o,i=!1,l.getType()){case"MultiLineString":o[x.depth[0]].length>2&&(o[x.depth[0]].splice(h,1),i=!0);break;case"LineString":o.length>2&&(o.splice(h,1),i=!0);break;case"MultiPolygon":r=r[x.depth[1]];case"Polygon":r=r[x.depth[0]],r.length>4&&(h==r.length-1&&(h=0),r.splice(h,1),i=!0,h===0&&(r.pop(),r.push(r[0]),m=r.length-1));break}if(i){this.setGeometryCoordinates_(l,o);const w=[];if(d!==void 0&&(this.rBush_.remove(d),w.push(d.segment[0])),y!==void 0&&(this.rBush_.remove(y),w.push(y.segment[1])),d!==void 0&&y!==void 0){const E={depth:x.depth,feature:x.feature,geometry:x.geometry,index:m,segment:w};this.rBush_.insert(Js(E.segment),E)}this.updateSegmentIndices_(l,h,x.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(Js([e])).some(({segment:i})=>!(Jo(i[0],e)||Jo(i[1],e)))}insertPoint(e){const t=e?fs(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((r,o)=>r||this.insertVertex_(o,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,r){this.rBush_.forEachInExtent(e.getExtent(),function(o){o.geometry===e&&(i===void 0||o.depth===void 0||id(o.depth,i))&&o.index>t&&(o.index+=r)})}}function lle(n,e){return n.index-e.index}function KO(n,e,t){const i=e.geometry;if(i.getType()==="Circle"){let o=i;if(e.index===lv){const s=Oh(o.getCenter(),fs(n)),l=Math.sqrt(s)-o.getRadius();return l*l}}const r=fs(n);return gy[0]=fs(e.segment[0]),gy[1]=fs(e.segment[1]),zE(r,gy)}function jO(n,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===lv)return Jp(i.getClosestPoint(fs(n)));const r=fs(n);return gy[0]=fs(e.segment[0]),gy[1]=fs(e.segment[1]),Jp(fb(r,gy))}function ule(){const n=CM();return function(e,t){return n.Point}}const Ox={SELECT:"select"};class Nx extends Vo{constructor(e,t,i,r){super(e),this.selected=t,this.deselected=i,this.mapBrowserEvent=r}}const Dx={};class KC extends Yy{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:pM,this.addCondition_=e.addCondition?e.addCondition:gC,this.removeCondition_=e.removeCondition?e.removeCondition:gC,this.toggleCondition_=e.toggleCondition?e.toggleCondition:mC,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:gf,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:cle(),this.features_=e.features||new Ts;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const i=e.layers;t=function(r){return i.includes(r)}}else t=gf;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[Yn(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[Yn(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(eo.ADD,this.boundAddFeature_),this.features_.addEventListener(eo.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(eo.ADD,this.boundAddFeature_),this.features_.removeEventListener(eo.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const i=this.findLayerOfFeature_(t);i&&this.addFeatureLayerAssociation_(t,i)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}findLayerOfFeature_(e){return this.getMap().getAllLayers().find(function(i){if(i instanceof gs&&i.getSource()&&i.getSource().hasFeature(e))return i})}getStyle(){return this.style_}applySelectedStyle_(e){const t=Yn(e);t in Dx||(Dx[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let r=t.length-1;r>=0;--r){const o=t[r];if(o!==this&&o instanceof KC&&o.getStyle()&&o.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(o.getStyle());return}}const i=Yn(e);e.setStyle(Dx[i]),delete Dx[i]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[Yn(e)]}selectFeatureInternal_(e,t,i){if(!(e instanceof yi)||!this.filter_(e,t))return;const r=this.getFeatures();return r.getArray().includes(e)||(this.addFeatureLayerAssociation_(e,t),r.push(e),i?.push(e)),e}selectFeature(e){const t=this.findLayerOfFeature_(e);if(!this.layerFilter_(t))return!1;const i=this.selectFeatureInternal_(e,t);return i&&this.dispatchEvent(new Nx(Ox.SELECT,[i],[],void 0)),!!i}removeFeatureInternal_(e,t){const i=this.getFeatures();if(!(!(e instanceof yi)||!i.getArray().includes(e)))return i.remove(e),this.removeFeatureLayerAssociation_(e),t?.push(e),e}deselectFeature(e){const t=this.removeFeatureInternal_(e);return t&&this.dispatchEvent(new Nx(Ox.SELECT,[],[t],void 0)),!!t}toggleFeature(e){this.deselectFeature(e)||this.selectFeature(e)}clearSelection(){Wy(this.featureLayerAssociation_);const e=this.getFeatures(),t=e.getArray().slice();e.clear(),t.length!==0&&this.dispatchEvent(new Nx(Ox.SELECT,[],t,void 0))}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),i=this.removeCondition_(e),r=this.toggleCondition_(e),o=!t&&!i&&!r,s=e.map,l=this.getFeatures(),u=[],h=[];if(o){let d=!1;s.forEachFeatureAtPixel(e.pixel,(m,y)=>{if(d=!0,!!this.selectFeatureInternal_(m,y,h))return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let m=l.getLength()-1;m>=0;--m){const y=l.item(m);(h.length>0&&!h.includes(y)||!d)&&this.removeFeatureInternal_(y,u)}}else s.forEachFeatureAtPixel(e.pixel,(d,m)=>{let y;if((i||r)&&(y=this.removeFeatureInternal_(d,u)),(t||r)&&!y&&(y=this.selectFeatureInternal_(d,m,h)),!!y)return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});return(h.length>0||u.length>0)&&this.dispatchEvent(new Nx(Ox.SELECT,h,u,e)),!0}}function cle(){const n=CM();return nr(n.Polygon,n.LineString),nr(n.GeometryCollection,n.LineString),function(e){return e.getGeometry()?n[e.getGeometry().getType()]:null}}class hle extends Vo{feature;constructor(e,t){super(e),this.feature=t}}class dle extends Zc{source_;features_;mapMatching_;getRouteUrl_;maxPoints_;freehand_;style_;sketchFeature_=null;sketchPoint_=null;sketchLine_=null;sketchCoords_=[];finishCoordinate_=null;lastWaypoints_="";isRequestingRoute_=!1;pointsCnt_=[];finishAfterRoute_=!1;isDoubleClick_=!1;clickTimeout_=null;active_=!0;constructor(e={}){if(super({stopDown:()=>!1,handleDownEvent:ple,handleUpEvent:gle,handleMoveEvent:mle,handleEvent:fle}),this.source_=e.source,this.features_=e.features,this.mapMatching_=e.mapMatching??!1,this.getRouteUrl_=e.getRouteUrl,this.maxPoints_=e.maxPoints??1/0,this.freehand_=e.freehand??!1,e.style)this.style_=e.style;else{const i=new t_({type:"LineString",source:new io}).overlay_;i?this.style_=i.getStyleFunction():this.style_=IM}e.existingSketch&&this.adoptExistingSketch_(e.existingSketch)}setActive(e){this.active_=e}getActive(){return this.active_}setMapMatching(e){this.mapMatching_=e}getMapMatching(){return this.mapMatching_}toggleMapMatching(){return this.mapMatching_=!this.mapMatching_,this.mapMatching_}startDrawing_(e){this.finishCoordinate_=e,this.sketchCoords_=[e.slice(),e.slice()];const t=new qi(this.sketchCoords_);this.sketchFeature_=new yi({geometry:t}),this.sketchFeature_.setStyle(this.style_),this.sketchPoint_=new yi({geometry:new zi(e)}),this.sketchPoint_.setStyle(this.style_),this.source_&&(this.source_.addFeature(this.sketchFeature_),this.sketchPoint_&&this.source_.addFeature(this.sketchPoint_)),this.updateSketchFeatures_()}adoptExistingSketch_(e){const t=e.getGeometry();if(!(t instanceof qi))return;this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates(),this.sketchFeature_.setStyle(this.style_),this.source_&&(this.source_.getFeatures().includes(this.sketchFeature_)||this.source_.addFeature(this.sketchFeature_)),this.sketchCoords_.length>=2?this.finishCoordinate_=this.sketchCoords_[this.sketchCoords_.length-2].slice():this.sketchCoords_.length===1&&(this.finishCoordinate_=this.sketchCoords_[0].slice());const i=this.sketchCoords_[this.sketchCoords_.length-1];this.sketchPoint_=new yi({geometry:new zi(i)}),this.sketchPoint_.setStyle(this.style_),this.source_&&this.sketchPoint_&&this.source_.addFeature(this.sketchPoint_)}modifyDrawing_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.sketchCoords_,r=i[i.length-1];r[0]=e[0],r[1]=e[1],this.isRequestingRoute_||t.setCoordinates(this.sketchCoords_),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),this.updateSketchFeatures_()}async addToDrawing_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.sketchCoords_;if(this.finishCoordinate_=e.slice(),i.length>=this.maxPoints_){this.finishDrawing();return}if(i[i.length-1]=e.slice(),i.push(e.slice()),!this.mapMatching_||this.freehand_||!this.getRouteUrl_){this.pointsCnt_.push(1),t.setCoordinates(i),this.updateSketchFeatures_();return}if(i.length>2){const r=Ir(i[i.length-2],"EPSG:3857","EPSG:4326"),o=Ir(i[i.length-3],"EPSG:3857","EPSG:4326"),s=`${o[1]},${o[0]},${r[1]},${r[0]}`;s!==this.lastWaypoints_&&!this.isRequestingRoute_&&(this.lastWaypoints_=s,await this.requestRoute_(s,t,e))}if(!this.isRequestingRoute_){const r=t.getCoordinates().slice(0,-1);r.push(e),t.setCoordinates(r)}}async requestRoute_(e,t,i){if(!this.getRouteUrl_)return;this.isRequestingRoute_=!0;const r=`${this.getRouteUrl_}?waypoints=${e}`;try{const s=await(await fetch(r)).json();if(s.success){const u=new Qa().readGeometry(s.geom);this.pointsCnt_.push(u.getCoordinates().length);const h=t.getCoordinates().slice(0,-2).concat(u.transform("EPSG:4326","EPSG:3857").getCoordinates());this.finishAfterRoute_||h.push(i),t.setCoordinates(h),this.sketchCoords_=h,this.finishAfterRoute_?(this.finishAfterRoute_=!1,this.finishCoordinate_=null,this.finishDrawing()):(this.updateSketchFeatures_(),h.length>=2&&(this.finishCoordinate_=h[h.length-2].slice()))}}catch{}finally{this.isRequestingRoute_=!1}}removeLastPoint(){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry(),t=this.sketchCoords_;if(this.mapMatching_&&this.pointsCnt_.length>0){const i=this.pointsCnt_.pop();t.splice(-1*i-1,i)}else t.splice(-2,1);e.setCoordinates(t),t.length>=2?this.finishCoordinate_=t[t.length-2].slice():this.finishCoordinate_=null,this.updateSketchFeatures_()}finishDrawing(){const e=this.abortDrawing_();e&&(this.dispatchEvent(new hle("drawend",e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e))}suspendDrawing(){this.sketchPoint_&&this.source_&&this.source_.removeFeature(this.sketchPoint_),this.sketchPoint_=null,this.finishCoordinate_=null}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.clickTimeout_!==null&&(window.clearTimeout(this.clickTimeout_),this.clickTimeout_=null),e&&(this.source_&&(this.source_.removeFeature(e),this.sketchPoint_&&this.source_.removeFeature(this.sketchPoint_)),this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.updateSketchFeatures_()),e}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_)}handlePointerMove_(e){return this.sketchFeature_&&this.modifyDrawing_(e.coordinate),!0}}function fle(n){const e=this;if(!e.active_)return!0;if(n.type===Vi.DBLCLICK)return e.isDoubleClick_=!0,e.clickTimeout_!==null&&(window.clearTimeout(e.clickTimeout_),e.clickTimeout_=null),e.finishDrawing(),setTimeout(()=>{e.isDoubleClick_=!1},300),!1;if(n.type==="singleclick"){if(e.isDoubleClick_)return!1;const t=n.coordinate;return e.sketchFeature_?e.addToDrawing_(t):e.startDrawing_(t),!1}return n.type==="pointermove"&&e.finishCoordinate_&&e.modifyDrawing_(n.coordinate),!0}function ple(){return!0}function gle(){return!1}function mle(n){return this.handlePointerMove_(n)}const cs={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},yle={ERROR:"error"};class _le extends Vo{constructor(e){super(yle.ERROR),this.code=e.code,this.message=e.message}}class rZ extends nu{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=xD,this.watchId_=void 0,this.addChangeListener(cs.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(cs.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=zy(Ni("EPSG:4326"),e),this.position_&&this.set(cs.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(cs.ACCURACY,t.accuracy),this.set(cs.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(cs.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(cs.HEADING,t.heading===null?void 0:aa(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const i=this.transform_(this.position_);this.set(cs.POSITION,i.slice()),this.set(cs.SPEED,t.speed===null?void 0:t.speed);const r=AH(this.position_,t.accuracy);r.applyTransform(this.transform_),this.set(cs.ACCURACY_GEOMETRY,r),this.changed()}positionError_(e){this.dispatchEvent(new _le(e))}getAccuracy(){return this.get(cs.ACCURACY)}getAccuracyGeometry(){return this.get(cs.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(cs.ALTITUDE)}getAltitudeAccuracy(){return this.get(cs.ALTITUDE_ACCURACY)}getHeading(){return this.get(cs.HEADING)}getPosition(){return this.get(cs.POSITION)}getProjection(){return this.get(cs.PROJECTION)}getSpeed(){return this.get(cs.SPEED)}getTracking(){return this.get(cs.TRACKING)}getTrackingOptions(){return this.get(cs.TRACKING_OPTIONS)}setProjection(e){this.set(cs.PROJECTION,Ni(e))}setTracking(e){this.set(cs.TRACKING,e)}setTrackingOptions(e){this.set(cs.TRACKING_OPTIONS,e)}}function vle(n,e){const t=n.canvas;e=e||{};const i=e.pixelRatio||wD,r=e.size;r&&(t.width=r[0]*i,t.height=r[1]*i,t.style.width=r[0]+"px",t.style.height=r[1]+"px");const o=[0,0,t.width,t.height],s=dI(qa(),i,i);return new q4(n,i,o,s,0)}function Vx(n,e){return Vs(n.inversePixelTransform,e.slice(0))}class lk extends mb{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(Qn.CHANGE)}release(){this.setState(Vn.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==Vn.EMPTY){if(this.state!==Vn.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}}load(){Zn()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const r=t-i+1e3/60;return r>=this.transition_?1:ED(r/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}class sZ extends lk{constructor(e,t,i,r,o,s){super(e,t,s),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_,Cl?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,r!==null&&(this.image_.crossOrigin=r)),this.unlisten_=null,this.tileLoadFunction_=o}getImage(){return this.image_}setImage(e){this.image_=e,this.state=Vn.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}handleImageError_(){this.state=Vn.ERROR,this.unlistenImage_(),this.image_=ble(),this.changed()}handleImageLoad_(){if(Cl)this.state=Vn.LOADED;else{const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=Vn.LOADED:this.state=Vn.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==Vn.ERROR&&(this.state=Vn.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Vn.IDLE&&(this.state=Vn.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=JK(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function ble(){const n=ro(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}const jo={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class hf extends nu{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+OH,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(jo.ELEMENT,this.handleElementChanged),this.addChangeListener(jo.MAP,this.handleMapChanged),this.addChangeListener(jo.OFFSET,this.handleOffsetChanged),this.addChangeListener(jo.POSITION,this.handlePositionChanged),this.addChangeListener(jo.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(jo.ELEMENT)}getId(){return this.id}getMap(){return this.get(jo.MAP)||null}getOffset(){return this.get(jo.OFFSET)}getPosition(){return this.get(jo.POSITION)}getPositioning(){return this.get(jo.POSITIONING)}handleElementChanged(){zD(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),mr(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=mn(e,wh.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(jo.ELEMENT,e)}setMap(e){this.set(jo.MAP,e)}setOffset(e){this.set(jo.OFFSET,e)}setPosition(e){this.set(jo.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(jo.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),r=this.getElement(),o=this.getRect(r,[DH(r),VH(r)]);e=e||{};const s=e.margin===void 0?20:e.margin;if(!vc(i,o)){const l=o[0]-i[0],u=i[2]-o[2],h=o[1]-i[1],d=i[3]-o[3],m=[0,0];if(l<0?m[0]=l-s:u<0&&(m[0]=Math.abs(u)+s),h<0?m[1]=h-s:d<0&&(m[1]=Math.abs(d)+s),m[0]!==0||m[1]!==0){const y=t.getView().getCenterInternal(),x=t.getPixelFromCoordinateInternal(y);if(!x)return;const C=[x[0]+m[0],x[1]+m[1]],w=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(C),duration:w.duration,easing:w.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),r=i.left+window.pageXOffset,o=i.top+window.pageYOffset;return[r,o,r+t[0],o+t[1]]}setPositioning(e){this.set(jo.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),r=e.getSize();this.updateRenderedPosition(i,r)}updateRenderedPosition(e,t){const i=this.element.style,r=this.getOffset(),o=this.getPositioning();this.setVisible(!0);const s=`${e[0]+r[0]}px`,l=`${e[1]+r[1]}px`;let u="0%",h="0%";o=="bottom-right"||o=="center-right"||o=="top-right"?u="-100%":(o=="bottom-center"||o=="center-center"||o=="top-center")&&(u="-50%"),o=="bottom-left"||o=="bottom-center"||o=="bottom-right"?h="-100%":(o=="center-left"||o=="center-center"||o=="center-right")&&(h="-50%");const d=`translate(${u}, ${h}) translate(${s}, ${l})`;this.rendered.transform_!=d&&(this.rendered.transform_=d,i.transform=d)}getOptions(){return this.options}}class uk{constructor(e,t,i,r){this.minX=e,this.maxX=t,this.minY=i,this.maxY=r}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function wm(n,e,t,i,r){return r!==void 0?(r.minX=n,r.maxX=e,r.minY=t,r.maxY=i,r):new uk(n,e,t,i)}function Lb(n,e=console){const t=n.startsWith("[")?n:`[${n}]`,i=(o,s)=>{const l=[t,...s];try{if(typeof e[o]=="function"){e[o](...l);return}}catch{}try{typeof e.log=="function"&&e.log(...l)}catch{}},r=o=>(...s)=>{i(o,s)};return{log:r("log"),info:r("info"),warn:r("warn"),error:r("error"),debug:r("debug")}}const xle="https://migration.geoportail.lu/profile.json";async function Ile(n,e,t="dhm",i=100){const r={geom:n,nbPoints:i+"",layers:t,id:e+""},o=await ks(xle,r,"POST");if(!o.ok){let l="";try{l=await o.text()}catch{}const{error:u}=Lb("PROFILE");throw u("[fetchProfileJson] non-ok response",{status:o.status,body:l}),new Error("Error while trying to get profile")}return await o.json()}function $O(n,e=1){if(!/^#[0-9A-Fa-f]{6}$/.test(n))throw new Error(`Invalid hex color string: ${n}`);const i=parseInt(n.slice(1,3),16),r=parseInt(n.slice(3,5),16),o=parseInt(n.slice(5,7),16);return[i,r,o,e]}function oZ(n){const[e,t,i]=n;if(e!==(e&255)||t!==(t&255)||i!==(i&255))throw Error(`"(${e},${t},${i})" is not a valid RGB color`);const r=DS(e.toString(16)),o=DS(t.toString(16)),s=DS(i.toString(16));return`#${r}${o}${s}`}function DS(n){return n.length===1?`0${n}`:n}function Cle(){return{angle:0,color:"#ed1c24",arrowcolor:void 0,stroke:1.25,linestyle:"plain",opacity:.2,showOrientation:!1,shape:"circle",symbolId:void 0,symboltype:void 0,size:10}}const zp=function(n,e){let t=0,i=[];n.getType()==="Polygon"?i=n.getCoordinates()[0]:n.getType()==="LineString"&&(i=n.getCoordinates());for(let r=0,o=i.length-1;r<o;++r){const s=Ir(i[r],e,Sl),l=Ir(i[r+1],e,Sl);t+=oC(s,l)}return t},NT=function(n){return Math.abs(bD(n))},wle=function(n,e){const t=Qv(n,e);return 2*Math.PI*t},Ale=function(n,e){return Math.PI*Math.pow(Qv(n,e),2)},Qv=function(n,e){const t=n.getLastCoordinate(),i=n.getCenter();return i!==null&&t!==null?zp(new qi([i,t]),e):0},ck=function(n,e,t){const i=n.getCenter(),r=t.getView().getProjection(),o=t.getView().getResolution()||0,s=Lv(r,o,i),l=o/s;e=e/Kp.m*l,n.setRadius(e)};function hk(n){const e=n.getGeometry();return n.featureType==="drawnCircle"&&e?.getType()==="Circle"&&n.setGeometry(WD(e,64)),n}function aZ(n){const e=Kn().getOlMap();if(!e)return n;const t=n.getGeometry();if(n.featureType==="drawnCircle"&&t?.getType()==="Polygon"){const i=t.getExtent(),r=[(i[0]+i[2])/2,(i[1]+i[3])/2],o=t.getCoordinates()[0];let s=0;o.forEach(u=>{const h=oC(bc(r),bc(u));h>s&&(s=h)});const l=new _f(r);e?ck(l,s,e):l.setRadius(s),n.setGeometry(l)}return n}function lZ(n){const e=n.getGeometry().getCoordinates().reverse();n.setGeometry(new qi(e))}function Sle(n){const e=zr(),t=n.filter(s=>["LineString","MultiLineString"].includes(s.getGeometry()?.getType())),i=t.shift(),r=t.map(s=>s.id);if(!i)return;const o=i.getGeometry();for(;t.length>0;){const s=o.getFirstCoordinate(),l=o.getLastCoordinate();let u,h=!1,d=!1;for(let x=0;x<t.length;x++){const w=t[x].getGeometry(),E=w.getFirstCoordinate(),T=w.getLastCoordinate(),k=new qi([s,E]),G=new qi([l,T]),O=new qi([l,E]),V=new qi([s,T]),z=k.getLength(),H=O.getLength(),te=V.getLength(),$=G.getLength();z<H&&z<te&&z<$?(u===void 0||z<u)&&(u=z,h=!0,d=!0):$<z&&$<H&&$<te?(u===void 0||$<u)&&(u=$,h=!1,d=!0):H<z&&H<te&&H<$?(u===void 0||H<u)&&(u=H,h=!1,d=!1):(u===void 0||te<u)&&(u=te,h=!0,d=!1)}let y=t.shift().getGeometry();return d&&(y=new qi(y.getCoordinates().reverse())),o.setCoordinates(h?y.getCoordinates().concat(o.getCoordinates()):o.getCoordinates().concat(y.getCoordinates())),i.resetProfileData(),e.removeFeature(r),i}}function Ele(){const n=zr(),{activateDrawLineContinue:e}=n,{currentDrawInteraction:t}=It(n),i=Kn().getOlMap();function r(s,l){const u=Rl.clone(s),h=u.getGeometry();return ck(h,l,i),u}async function o(s){e(),t.value&&(await no(),t.value?.setActive(!0),t.value?.extend(s))}return{createConcentricCircle:r,continueLine:o}}const Tle="https://migration.geoportail.lu/mymaps",Rle="https://migration.geoportail.lu/mymaps/symbol",Mle=Tle+"/getarrow",VS={dataProjection:Ml,featureProjection:Wp};class Rl extends yi{id;fid;label;description;display_order;selected;editable;map_id;saving;featureType;_featureStyle;map=Kn().getOlMap();profileData=void 0;constructor(e,t){e?(super(e.getGeometry()),this.label=e.label,this.featureType=e.featureType,this.map_id=e.map_id,this.description=e.description,this.display_order=e.display_order,this.selected=e.selected,this.editable=e.editable,this._featureStyle=e.featureStyle,this.id=e.id,this.saving=e.saving,this.setProperties(e.getProperties())):(super(t),this.editable=!1)}clone(){const e=new Rl(this,this.hasProperties()?this.getProperties():void 0);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e.id=Hv(),e}static clone(e){return e.clone()}static generateFromFeature(e,t={}){const i=Object.assign(new Rl,e,{id:Hv(),label:void 0,description:"",display_order:void 0,selected:!1,editable:!1,map_id:void 0,saving:!1,featureType:void 0},t);i.editable=i.map_id===void 0;const r=e.getGeometry()?.getType(),o={Point:"drawnPoint",LineString:"drawnLine",Polygon:"drawnPolygon",Circle:"drawnCircle"};return i.featureType===void 0&&(i.featureType=o[r]||"drawnPolygon"),i.featureStyle=Cle(),i.fromProperties(e.getProperties()),i.setStyle(i.getStyleFunction()),i}static generateFromGeoJson(e,t={}){const i=new Qa(VS).readFeature(e),r=Rl.generateFromFeature(i,t),o=i.getProperties();return r.fromProperties(o),r.setStyle(r.getStyleFunction()),r}get featureStyle(){return this._featureStyle}set featureStyle(e){this._featureStyle=e,this.changed()}fit(){const e=this.map.getSize(),t=this.getGeometry()?.getExtent();this.map.getView().fit(t,{size:e})}resetProfileData(){this.profileData=void 0}async getProfile(){const e=this.getGeometry();if(!(e?.getType()!=="LineString"&&e?.getType()!=="MultiLineString")){if(this.profileData===void 0){const t=new Qa().writeGeometry(this.getGeometry(),VS),i=await Ile(t,this.id);let r=0,o=0,s=0,l;this.profileData=i.profile.map(u=>{const h={...u,cumulativeElevation:0,elevationGain:0,elevationLoss:0},d=h.values.dhm;if(l!==void 0){const m=d-l;s=s+m,m>0?r=r+m:o=o+m}return h.cumulativeElevation=s,h.elevationGain=r,h.elevationLoss=o,l=d,h})}return this.profileData}}toProperties(){return{angle:this.featureStyle.angle,color:this.featureStyle.color,description:this.description,display_order:this.display_order,fid:this.fid,stroke:this.featureStyle.stroke,isLabel:this.featureType==="drawnLabel",linestyle:this.featureStyle.linestyle,name:this.label,opacity:this.featureStyle.opacity,showOrientation:this.featureStyle.showOrientation,shape:this.featureStyle.shape,size:this.featureStyle.size,isCircle:this.featureType==="drawnCircle",symbolId:this.featureStyle.symbolId,symboltype:this.featureStyle.symboltype,__map_id__:this.map_id}}fromProperties(e){e&&(this.description=e.description??this.description,this.display_order=e.display_order??this.display_order,this.label=e.name??this.label,this.map_id=e.__map_id__??this.map_id,e.isCircle===!0?this.featureType="drawnCircle":e.isLabel===!0&&(this.featureType="drawnLabel"),this.featureStyle={angle:e.angle??this.featureStyle.angle,color:e.color??this.featureStyle.color,stroke:e.stroke??this.featureStyle.stroke,linestyle:e.linestyle??this.featureStyle.linestyle,opacity:e.opacity??this.featureStyle.opacity,showOrientation:e.showOrientation??this.featureStyle.showOrientation,shape:e.shape??this.featureStyle.shape,size:e.size??this.featureStyle.size,symbolId:e.symbolId??this.featureStyle.symbolId,symboltype:e.symboltype??this.featureStyle.symboltype,arrowcolor:e.arrowcolor??this.featureStyle.arrowcolor})}toGeoJSONString(){const e=this.clone();return e.setProperties(this.toProperties()),new Qa().writeFeature(e.getGeometry()?.getType()==="Circle"?hk(e):e,VS)}getStyleFunction(){const e=[],t=new Hn({image:new bl({radius:6,points:4,angle:Math.PI/4,fill:new Di({color:[255,255,255,.5]}),stroke:new bi({color:[0,0,0,1]})}),geometry:function(l){const u=l.getGeometry();let h;return u instanceof qi?(h=u.getCoordinates(),new $h(h)):u instanceof Bo?(h=u.getCoordinates()[0],new $h(h)):u}}),i=new Hn({image:new ms({radius:8,fill:new Di({color:[0,0,255,.8]}),stroke:new bi({color:[255,255,255,1],width:2})}),geometry:function(l){const u=l.getGeometry();if(u instanceof _f)return new zi(u.getCenter())}}),r=new Di,o=Mle,s=this.map;return function(l,u){u===void 0&&(u=l,l=this),e.length=0,l.get("__isBeingEdited__")&&(e.push(t),l.featureType==="drawnCircle"&&l.getGeometry()?.getType()==="Circle"&&e.push(i));const h=l.display_order??0,d=l.featureStyle.color||"#FF0000",m=$O(d,1),y=$O(d,l.featureStyle.opacity??1);if(r.setColor(y),l.getGeometry()?.getType()==="LineString"&&l.featureStyle.showOrientation){let G,O,V=l.featureStyle.arrowcolor;V==null&&(V=d),l.getGeometry()?.forEachSegment(function(z,H){const te=new zi([(z[0]+H[0])/2,(z[1]+H[1])/2]),$=H[0]-z[0],ae=H[1]-z[1];if(G!=null){const fe=s.getPixelFromCoordinate(te.getCoordinates()),Y=s.getPixelFromCoordinate(G.getCoordinates()),de=Y[0]-fe[0],D=Y[1]-fe[1];O=Math.sqrt(de*de+D*D)}if(!G||O>600){const fe=o,Y=Math.PI/2-Math.atan2(ae,$);e.push(new Hn({geometry:te,zIndex:h,image:new Nu({color:V,rotation:Y,src:fe})})),G=te}})}let x;if(l.featureStyle.linestyle)switch(l.featureStyle.linestyle){case"dashed":x=[10,10];break;case"dotted":x=[1,6];break}let C,w=l.featureStyle.stroke;w>0&&(l.selected&&(w=w+3),C=new bi({color:m,width:w,lineDash:x}));let E=l.featureStyle.size;l.selected&&(E=E+3);const T={fill:r,stroke:new bi({color:m,width:E/7}),radius:E};let k=null;if(l.featureType==="drawnPoint"||l.featureType==="drawnLabel")if(l.featureStyle.symbolId){const G={...T,src:Rle+"/"+l.featureStyle.symbolId+"?scale="+E,scale:1,rotation:l.featureStyle.angle};k=new Nu(G)}else{const G=l.featureStyle.shape;G==="circle"?k=new ms(T):G==="square"?(Object.assign(T,{points:4,angle:Math.PI/4,rotation:l.featureStyle.angle}),k=new bl(T)):G==="triangle"?(Object.assign(T,{points:3,angle:0,rotation:l.featureStyle.angle}),k=new bl(T)):G==="star"?(Object.assign(T,{points:5,angle:Math.PI/4,rotation:l.featureStyle.angle,radius2:E}),k=new bl(T)):G==="cross"&&(Object.assign(T,{points:4,angle:0,rotation:l.featureStyle.angle,radius2:0}),k=new bl(T))}return l.featureType==="drawnLabel"?[new Hn({text:new Wc({text:l.label,textAlign:"left",font:"normal "+E+"px Sans-serif",rotation:l.featureStyle.angle,fill:new Di({color:m}),stroke:new bi({color:[255,255,255],width:2})})})]:(k?e.push(new Hn({image:k,fill:r,stroke:C,zIndex:h})):e.push(new Hn({fill:r,stroke:C,zIndex:h})),e)}}}let JO=!1;function Rf(){const{t:n}=St(),e=Jn(),t=Ui(),i=zr(),{drawnFeatures:r,drawnFeaturesMyMaps:o,drawnFeaturesExceptMyMaps:s}=It(i),l=Zr(),{addNotification:u}=Qr(),{authenticated:h}=It(iu()),{myMap:d,myMapId:m,myMapIsLoading:y,myMapLayersChanged:x}=It(e),{layers:C,bgLayer:w}=It(t),E=Tl(),{themeName:T}=It(l),{initLayer:k}=la(),{setBgLayer:G}=pA(),O=Ct(()=>d.value?.is_editable&&h.value?d.value.uuid:void 0);function V(){u(n("Erreur inattendue lors du chargement de votre carte."),ii.ERROR)}async function z(oe){d.value=void 0,y.value=!0;try{const[ue,ge]=await Promise.all([jae(oe),nle(oe)]),Ne=ge.features?.map(Ee=>{const se=Rl.generateFromGeoJson(Ee,{map_id:oe,id:Ee.id,fid:Ee.id,display_order:Ee.properties?.display_order});return aZ(se)});d.value=ue,Ne.forEach(Ee=>{Ee.editable=h.value&&ue.is_editable}),r.value=[...r.value,...Ne]}catch(ue){console.error("[MyMaps] loadMyMap() - ERROR",ue),V()}finally{y.value=!1}}function H(oe){m.value=oe}function te(){m.value&&i.removeMyMapsFeature(m.value),m.value=void 0,d.value=void 0}async function $(oe){const ue=await ele(oe);return ue&&(o.value.forEach(ge=>qB(ge.id)),i.removeMyMapsFeature(oe)),ue}async function ae(){if(d.value){const oe=C.value.reverse();d.value.bg_layer=w.value?.name??"blank",d.value.bg_opacity=1,d.value.layers=oe.map(ue=>ue.name).join(","),d.value.layers_opacity=oe.map(ue=>ue.opacity??"1").join(","),d.value.layers_visibility=oe.map(()=>"true").join(","),d.value.layers_indices=oe.map((ue,ge)=>ge).join(","),JB(d.value.uuid,d.value.bg_layer,d.value.bg_opacity,d.value.layers,d.value.layers_opacity,d.value.layers_visibility,d.value.layers_indices,T.value).catch(()=>u(n("Erreur inattendue lors de la mise  jour de votre carte."),ii.ERROR))}}function fe(){G(void 0,d.value?.bg_layer);const oe=d.value?.layers_opacity?d.value?.layers_opacity.split(",").map(Ne=>parseInt(Ne,10)):[],ue=d.value?.layers_visibility?d.value?.layers_visibility.split(",").map(Ne=>Ne!=="false"):[],ge=d.value?.layers?d.value?.layers.split(",").map((Ne,Ee)=>{const se=E.findByName(Ne.trim());if(se){const q=k(se);return q.opacity=ue[Ee]??!0?oe[Ee]:0,q}}).filter(Ne=>Ne!==void 0):[];if(t.removeAllLayers(),t.addLayers(...ge),d.value&&d.value.zoom!==null&&d.value.x!==null&&d.value.y!==null){const Ne=Kn().getOlMap();Ne.getView().setZoom(d.value.zoom),Ne.getView().setCenter([d.value.x,d.value.y])}else{const Ne=Kn().getOlMap(),Ee=el();o.value.forEach(se=>{se.getGeometry()&&Sy(Ee,se.getGeometry().getExtent())}),Ee[0]!==1/0&&Ee[1]!==1/0&&Ee[2]!==-1/0&&Ee[3]!==-1/0&&Ee[0]<Ee[2]&&Ee[1]<Ee[3]&&Ne.getView().fit(Ee,{padding:[20,20,20,20]})}}function Y(){JO||(Pt(m,async(oe,ue)=>{oe&&oe!==ue&&Kn().getOlMap()?z(oe):!oe&&ue&&(o.value.forEach(ge=>{ge.map_id=void 0,ge.editable=!0,ge.changed()}),d.value=void 0)},{immediate:!0}),Pt(()=>Kn().olMap,oe=>{oe&&m.value&&!d.value&&z(m.value)}),Pt(d,oe=>oe&&fe()),Pt(h,oe=>{o.value.forEach(ue=>{ue.editable=oe&&(d.value?.is_editable??!1),ue.changed()}),oe&&m.value&&d.value&&z(m.value)}),Pt([C,w,d],([oe,ue,ge])=>x.value=ge?kle(ge,oe,ue):!1,{immediate:!0,deep:!0}),JO=!0)}async function de(){if(O.value){const oe=[...s.value],ue=oe.map(ge=>ge.id).filter(ge=>ge!==void 0);ue.length>0&&i.removeFeature(ue,!1),await Promise.all(oe.map(async ge=>{ge.map_id=O.value;const Ne=await HC(ge.map_id,ge.toGeoJSONString()).catch(Ee=>{console.error("[MyMaps] Error saving feature:",Ee),u(n("Erreur inattendue lors de la sauvegarde de votre modification."),ii.ERROR)});Ne&&(ge.id=Ne.id,ge.fid=Ne.id)})),r.value=[...r.value,...oe]}}function D(){return h.value?!0:(u(n("Veuillez vous identifier afin d'accder  vos cartes")),e.toggleAuthFormOpen(!0),!1)}return{isMyMapEditable:O,init:Y,addInMyMap:de,loadMyMap:z,checkAuth:D,clearMyMap:$,closeMyMap:te,openMyMap:H,applyToMyMap:ae,resetFromMyMap:fe}}function kle(n,e,t){const i=e.map(o=>o.name).join(","),r=e.map(o=>o.opacity).join(",");return i!==(n.layers??"")||r!==(n.layers_opacity??"")||(t?.name??"blank")!==(n.bg_layer??"blank")}function yA(){const n=zr(),{drawStateActive:e,drawnFeatures:t}=It(n),{isMyMapEditable:i}=Rf();function r(o){const s=o.getGeometry()?.getType().replace("String",""),l=e.value==="drawCircle"?"drawnCircle":e.value==="drawLabel"?"drawnLabel":`drawn${s}`,u=o.get("name")||`${L6(s)} ${t.value.length+1}`,h=Rl.generateFromFeature(o,{label:u,display_order:t.value.length,featureType:l,map_id:i.value});return h.fromProperties(o.getProperties()),h}return{generateDrawnFeature:r}}function Lle(){const n=Kn().getOlMap(),e=zr(),{drawStateActive:t,editStateActive:i,followRoads:r}=It(e),{generateDrawnFeature:o}=yA(),s=Ue(!1),l=Ue(!0);let u=null,h=null;function d(){return"https://map.geoportail.lu/mymaps/getroute"}function m(){if(!n)return null;const k=n.getLayers().getArray();for(const G of k)if(G instanceof gs&&G.get("cyLayerType")==="interactionDrawLayer")return G.getSource();return null}function y(k={}){if(!n)return;let G=null;n.getInteractions().getArray().forEach(H=>{if(H instanceof t_&&H.getActive()){const te=H.overlay_;if(te){const $=te.getSource(),ae=$?.getFeatures();ae&&ae.length>0&&(G=ae[0],$.clear())}h=H,H.setActive(!1)}});const V=m();if(!V)return;u=new dle({source:V,mapMatching:k.mapMatching??l.value,getRouteUrl:d(),maxPoints:1/0,freehand:!1,existingSketch:G||void 0});const z=H=>{T(H)};u.addEventListener("drawend",z),n.addInteraction(u),s.value=!0}function x(){if(!n||!u)return;u.setActive(!1);const k=u.sketchFeature_,G=u.sketchCoords_;u.suspendDrawing(),n.removeInteraction(u),u=null,s.value=!1,h&&(i.value||(h.setActive(!0),k&&G&&(h.sketchFeature_=k,h.sketchCoords_=G,h.updateSketchFeatures_())),h=null)}function C(){if(u){const k=u.toggleMapMatching();return l.value=k,k}return l.value=!l.value,l.value}function w(){u&&u.removeLastPoint()}function E(){u&&u.finishDrawing()}function T(k){const G=k.feature,O=o(G);e.addDrawnFeatureToCollection(O),e.selectDrawnFeature(O)}return Pt(r,k=>{t.value==="drawLine"&&i.value!=="editLine"&&(k?y({mapMatching:!0}):x())}),Pt(t,(k,G)=>{k==="drawLine"&&r.value&&i.value!=="editLine"&&y({mapMatching:!0}),G==="drawLine"&&k!=="drawLine"&&i.value!=="editLine"&&(s.value&&x(),r.value=!1)}),Pt(i,(k,G)=>{k!==void 0&&s.value&&x(),G!==void 0&&k===void 0&&t.value==="drawLine"&&r.value&&y({mapMatching:!0})}),Ms(()=>{x()}),{isActive:s,mapMatchingEnabled:l,activate:y,deactivate:x,toggleMapMatching:C,removeLastPoint:w,finishDrawing:E}}const Ple={class:"block"},Om=at({__name:"button-text",props:{label:{},active:{type:Boolean}},setup(n){const e=n;return(t,i)=>(U(),ie("button",{class:Rn(["h-16 w-16 text-white hover:bg-primary",e.active?"bg-primary":"bg-tertiary"])},[P("span",Ple,K(e.label),1)],2))}}),Gle={"data-cy":"toolbarDraw"},Fle={class:"absolute bottom-full top-auto z-20 flex flex-row justify-start divide-y-0 divide-x divide-gray-400 divide-solid box-content border-y-0 border-x border-gray-400"},Ole={key:0,class:"absolute bottom-full top-auto z-10 pl-[130px] pb-16 w-[326px]","data-cy":"followRoads"},Nle={class:"flex flex-row justify-center text-white bg-tertiary hover:bg-primary py-2 box-content border-y border-x border-gray-400"},Dle={class:"cursor-pointer"},Vle=["disabled"],Ble=at({__name:"toolbar-draw",setup(n){const{t:e}=St(),t=zr(),{toggleDrawCircle:i,toggleDrawLabel:r,toggleDrawLine:o,toggleDrawPolygon:s,toggleDrawPoint:l,setDrawActiveState:u}=t,{drawStateActive:h,editStateActive:d,followRoads:m}=It(t);return Lle(),cg(()=>{u(void 0)}),(y,x)=>(U(),ie("div",Gle,[P("ul",Fle,[P("li",null,[mt(Om,{label:M(e)("Draw Point",{ns:"client"}),active:M(h)==="drawPoint"||M(d)==="editPoint",onClick:M(l),"data-cy":"drawPointButton"},null,8,["label","active","onClick"])]),P("li",null,[mt(Om,{label:M(e)("Label",{ns:"client"}),active:M(h)==="drawLabel"||M(d)==="editLabel",onClick:M(r),"data-cy":"drawLabelButton"},null,8,["label","active","onClick"])]),P("li",null,[mt(Om,{label:M(e)("Line",{ns:"client"}),active:M(h)==="drawLine"||M(d)==="editLine",onClick:M(o),"data-cy":"drawLineButton"},null,8,["label","active","onClick"])]),P("li",null,[mt(Om,{label:M(e)("Polygon",{ns:"client"}),active:M(h)==="drawPolygon"||M(d)==="editPolygon",onClick:M(s),"data-cy":"drawPolygonButton"},null,8,["label","active","onClick"])]),P("li",null,[mt(Om,{label:M(e)("Circle",{ns:"client"}),active:M(h)==="drawCircle"||M(d)==="editCircle",onClick:M(i),"data-cy":"drawCircleButton"},null,8,["label","active","onClick"])])]),M(h)==="drawLine"||M(d)==="editLine"?(U(),ie("ul",Ole,[P("li",Nle,[P("label",Dle,[An(P("input",{type:"checkbox","onUpdate:modelValue":x[0]||(x[0]=C=>Gr(m)?m.value=C:null),disabled:M(d)==="editLine",class:"mr-2 cursor-pointer"},null,8,Vle),[[Hh,M(m)]]),Bt(" "+K(M(e)("Suivre la route",{ns:"client"})),1)])])])):Le("",!0)]))}}),Zle="https://migration.geoportail.lu/raster",Wle="EPSG:3857",zle="EPSG:2169",eb=async(n,e)=>{const t=Ir(n,Wle,zle);try{const i=await fetch(`${Zle}?lon=${t[0]}&lat=${t[1]}`,{signal:e});if(!i.ok)throw new Error("Network response was not ok");return(await i.json()).dhm}catch{return null}},uZ=Zoe(eb,300),dk=1e3,cZ="interactionDrawLayer";class Ule{createOlLayer(){const e=new gs({source:new io({features:[]}),zIndex:dk,style:(t,i)=>{const r=t.getStyle();return typeof r=="function"?r.call(t,t,i):r}});return e.set("cyLayerType",cZ),e}}const qO=new Ule;class Xle{measureTooltipElement=null;measureTooltipOverlay=null;changeEventKey=null;add(e,t){this.createMeasureTooltip(e);const i=t.feature.getGeometry();if(i===void 0)return;const r=e.getView().getProjection();this.changeEventKey=mn(i,"change",()=>this.updateTootip(i,r),this)}remove(){this.removeMeasureTooltip(),this.changeEventKey!==null&&(vl(this.changeEventKey),this.changeEventKey=null)}createPersistentMeasurement(e,t){const i=document.createElement("div");i.classList.add("lux-tooltip");const r=new hf({element:i,offset:[0,-15],positioning:"bottom-center",stopEvent:!1});e.addOverlay(r);const o=e.getView().getProjection(),s=()=>{let u,h="";if(t.getType()==="LineString"){const d=t;u=d.getCoordinateAt(.5),u!=null&&(h=af(zp(d,o),1))}else if(t.getType()==="Polygon"){const d=t;d.getCoordinates()[0].length>2&&(u=d.getInteriorPoint().getCoordinates()),u!=null&&(h=sT(NT(d)))}i.innerText=h,r.setPosition(u)},l=mn(t,"change",s,this);return s(),()=>{try{e.removeOverlay(r)}catch{}try{vl(l)}catch{}try{i.parentNode&&i.parentNode.removeChild(i)}catch{}}}createMeasureTooltip(e){this.removeMeasureTooltip(),this.measureTooltipElement=document.createElement("div"),this.measureTooltipElement.classList.add("lux-tooltip"),this.measureTooltipOverlay=new hf({element:this.measureTooltipElement,offset:[0,-15],positioning:"bottom-center",stopEvent:!1}),e.addOverlay(this.measureTooltipOverlay)}removeMeasureTooltip(){this.measureTooltipElement!==null&&(this.measureTooltipElement.parentNode?.removeChild(this.measureTooltipElement),this.measureTooltipElement=null,this.measureTooltipOverlay=null)}updateTootip(e,t){let i,r="";if(e.getType()==="LineString"){const o=e;i=o.getCoordinateAt(.5),i!=null&&(r=af(zp(o,t)))}else if(e.getType()==="Polygon"){const o=e;o.getCoordinates()[0].length>2&&(i=o.getInteriorPoint().getCoordinates()),i!=null&&(r=sT(NT(o)))}else if(e.getType()==="Circle"){const o=e;i=o.getLastCoordinate();const s=o.getCenter();s!=null&&i!=null&&(r=af(zp(new qi([s,i]),t),1))}this.measureTooltipElement&&(this.measureTooltipElement.innerText=r,this.measureTooltipOverlay?.setPosition(i))}}const Eu=new Xle;function Yle(){const n=Ue(void 0),e=Ue(null),t=Ue(null),{t:i}=St(),{warn:r,error:o}=Lb("MEASURE"),s=Kn().getOlMap(),l=Ue(!1),u=Ue(null),h=Ue(null),d=Ue(null),m=Ue(null),y=Ue(null),x=[],C=new Hn({stroke:new bi({color:"#ff8c00",width:4})}),w=new Hn({stroke:new bi({color:"#ff8c00",width:2,lineDash:[6,6]})}),E=-15,T=-30,k=[0,E],G=[0,T],O="bottom-center";function V(){if(!(!y.value||!s)){try{s.removeOverlay(y.value)}catch(Y){r("[measure] removeHintOverlay failed",Y)}y.value=null}}function z(Y,de){if(s)try{V();const D=document.createElement("div");D.className="lux-tooltip lux-tooltip--hint",D.innerHTML=Y;const oe=new hf({element:D,offset:G,positioning:O,stopEvent:!1});y.value=oe,s.addOverlay(y.value);const ue=de||s.getView()&&s.getView().getCenter();ue&&y.value.setPosition(ue)}catch(D){r("[measure] showHintOverlay failed",D)}}function H([Y,de],[D,oe]){const ue=de*Math.PI/180,ge=oe*Math.PI/180,Ne=Y*Math.PI/180,Ee=D*Math.PI/180,se=Math.sin(Ee-Ne)*Math.cos(ge),q=Math.cos(ue)*Math.sin(ge)-Math.sin(ue)*Math.cos(ge)*Math.cos(Ee-Ne),ze=(Math.atan2(se,q)*180/Math.PI+360)%360;return ze>180?ze-360:ze}function te(Y,de,D){const oe=document.createElement("div");oe.className="lux-tooltip",oe.innerHTML=Y,D&&oe.dataset&&(oe.dataset.measurementId=D);const ue=new hf({element:oe,offset:k,positioning:O,stopEvent:!1});return ue.setPosition(de),s.addOverlay(ue),ue}function $(Y){if(!s)return;let de=u.value?.getSource();if(!de){try{const ue=s.getLayers().getArray();for(const ge of ue)try{if(ge.get&&ge.get("cyLayerType")==="interactionMeasureLayer"){u.value=ge,de=u.value.getSource();break}}catch{}}catch{}de||(de=new io,u.value=new gs({source:de,zIndex:dk+1}),u.value.set("cyLayerType","interactionMeasureLayer"),s.addLayer(u.value))}const D=Y==="azimuth"?"Circle":Y==="area"?"Polygon":"LineString",oe=new t_({type:D,source:de});d.value=mn(s,"pointermove",ue=>{m.value=ue.coordinate;try{y.value&&s&&y.value.setPosition(ue.coordinate)}catch(ge){r("[measure] pointermove handler failed",ge)}}),mn(oe,"drawstart",ue=>{try{if(Y!=="azimuth"){Eu.add(s,ue);try{const ge=ue.feature?.getGeometry();let Ne;if(ge&&ge.getType&&ge.getType()==="LineString"){const Ee=ge.getCoordinateAt(.5);Ee&&Ee.length>=2&&(Ne=[Ee[0],Ee[1]])}z(i(Y==="area"?"measure_continue_instruction_area":"measure_continue_instruction"),Ne)}catch(ge){r("[measure] drawstart hint update failed",ge)}}}catch(ge){r("[measure] drawstart handler failed",ge)}}),mn(oe,"drawstart",ue=>{if(!(Y!=="azimuth"||!s))try{const Ne=ue.feature.getGeometry(),Ee=Ne&&Ne.getCenter?Ne.getCenter():null;if(!Ee)return;const se=new yi({geometry:new qi([Ee,Ee])});se.set("isMeasurement",!0),se.set("isAzimuthPreview",!0),se.setStyle(w),de.addFeature(se);const q=new yi({geometry:new _f(Ee,0)});q.set("isMeasurement",!0),q.set("isAzimuthPreview",!0),q.setStyle(w),de.addFeature(q);const j=document.createElement("div");j.className="lux-tooltip",j.innerHTML="";const ze=new hf({element:j,offset:k,positioning:O,stopEvent:!1});e.value=ze,s.addOverlay(e.value);try{z(i("measure_continue_instruction_azimuth"),Ee)}catch(qe){r("[measure] showHintOverlay (azimuth) failed",qe)}const je=mn(s,"pointermove",qe=>{try{const yt=qe.coordinate;m.value=yt;const xt=[yt[0],yt[1]];try{se.getGeometry().setCoordinates([Ee,xt])}catch(Et){r("[measure] previewRadial.setCoordinates failed",Et)}try{q.getGeometry().setRadius(Math.sqrt((xt[0]-Ee[0])**2+(xt[1]-Ee[1])**2))}catch(Et){r("[measure] previewCircle.setRadius failed",Et)}try{const Et=H(bc(Ee),bc(xt)),kt=af(zp(new qi([Ee,xt]),s.getView().getProjection()));j.innerHTML=`${Et.toFixed(1)}  ${kt}`;const hn=[(Ee[0]+xt[0])/2,(Ee[1]+xt[1])/2];e.value?.setPosition(hn)}catch(Et){r("[measure] azimuth preview overlay update failed",Et)}}catch(yt){r("[measure] azimuth pointermove outer failed",yt)}});t.value={radial:se,preview:q,key:je},x.push(()=>{try{const qe=t.value?.key;qe&&vl(qe)}catch(qe){r("[measure] unByKey for azimuth preview failed",qe)}try{e.value&&s&&s.removeOverlay(e.value),e.value=null}catch(qe){r("[measure] removing azimuth preview overlay failed",qe)}try{t.value?.radial&&de.removeFeature(t.value.radial),t.value?.preview&&de.removeFeature(t.value.preview)}catch(qe){r("[measure] removing azimuth preview features failed",qe)}})}catch(ge){r("[measure] azimuth drawstart handler failed",ge)}}),mn(oe,"drawend",ue=>{const ge=ue.feature?.getGeometry();if(ge&&s&&n.value!=="azimuth"){const Ee=Eu.createPersistentMeasurement(s,ge);x.push(Ee)}if(Eu.remove(),V(),d.value){try{vl(d.value)}catch(Ee){r("[measure] unByKey(pointerMoveKey) failed",Ee)}d.value=null}const Ne=ue.feature;if(Ne){if(Y==="area")HI(async()=>{const{Fill:Ee}=await Promise.resolve().then(()=>zF);return{Fill:Ee}},void 0).then(({Fill:Ee})=>{Ne.setStyle(new Hn({stroke:new bi({color:"#ff8c00",width:3}),fill:new Ee({color:"rgba(255,140,0,0.15)"})}))});else if(Y==="azimuth"){HI(async()=>{const{Fill:se}=await Promise.resolve().then(()=>zF);return{Fill:se}},void 0).then(({Fill:se})=>{Ne.setStyle(new Hn({stroke:new bi({color:"#ff8c00",width:3}),fill:new se({color:"rgba(255,140,0,0.05)"})}))});const Ee=Ne.getGeometry();if(Ee&&Ee.getCenter&&Ee.getRadius){const se=Ee.getCenter(),q=Ee.getRadius(),j=m.value;let ze=0;j&&(ze=Math.atan2(j[1]-se[1],j[0]-se[0]));const je=[se[0]+q*Math.cos(ze),se[1]+q*Math.sin(ze)],qe=new _f(se,q);Ne.setGeometry(qe);const yt=new yi({geometry:new qi([se,je])});yt.setStyle(new Hn({stroke:new bi({color:"#ff8c00",width:2})})),yt.set("isMeasurement",!0),yt.set("isAzimuthRadial",!0),de.addFeature(yt),x.push(()=>de.removeFeature(yt));const xt=[(se[0]+je[0])/2,(se[1]+je[1])/2],Et=H(bc(se),bc(je)),kt=af(zp(new qi([se,je]),s.getView().getProjection())),hn=`${Et.toFixed(1)}`;if(e.value&&s){try{s.removeOverlay(e.value)}catch(Re){r("[measure] removing azimuth preview overlay failed",Re)}try{e.value=null}catch{}}let wn=!1;try{wn=Ne?.get&&(!!Ne.get("measurementId")||!!Ne.get("finalOverlayRef"))}catch(Re){r("[measure] checking measurementId/finalOverlayRef failed",Re)}let Ge=null;if(!wn){const Re=Hv();try{Ne.set("measurementId",Re)}catch(ce){r("[measure] setting measurementId on feature failed",ce)}try{yt.set("measurementId",Re)}catch(ce){r("[measure] setting measurementId on radial failed",ce)}Ge=te(`${hn}  ${kt}  h: N/A`,xt,Re);try{const ce=Ge?Ge.getElement&&Ge.getElement():null;ce&&ce.dataset&&(ce.dataset.measurementId=Re)}catch(ce){r("[measure] annotating final overlay element failed",ce)}try{Ne.set("finalOverlayRef",Ge)}catch(ce){r("[measure] setting finalOverlayRef failed",ce)}try{x.push(()=>{try{de.removeFeature(Ne)}catch(ce){r("[measure] removing persistent feature failed",ce)}})}catch(ce){r("[measure] registering persistent remover failed",ce)}}const ve=(Re,ce,me,_e,Ie)=>{if(Re)try{const pe=Re?Re.getElement&&Re.getElement():null;pe&&(pe.innerHTML=Ie===null?`${me.toFixed(1)}  ${_e}  h: N/A`:`${me.toFixed(1)}  ${_e}  h: ${Ie} m`),Re.setPosition(ce)}catch(pe){r("[measure] updating final overlay failed",pe)}},W=new AbortController,Ze=()=>{try{W.abort()}catch{}};x.push(Ze),(async()=>{try{const[Re,ce]=await Promise.all([eb(se,W.signal),eb(je,W.signal)]);try{const me=s.getOverlays().getArray();if(!Ge||me.indexOf(Ge)===-1){const _e=x.indexOf(Ze);_e!==-1&&x.splice(_e,1);return}}catch{}if(Re===null||ce===null)r("[measure][azimuth] elevation data missing for points",{eCenter:Re,eEdge:ce,center:se,edge:je}),ve(Ge,xt,Et,kt,null);else{const me=Math.round(ce-Re);ve(Ge,xt,Et,kt,me)}}catch(Re){o("[measure][azimuth] elevation request failed",Re);try{const ce=s.getOverlays().getArray();if(!Ge||ce.indexOf(Ge)===-1)return}catch{}ve(Ge,xt,Et,kt,null)}finally{const Re=x.indexOf(Ze);Re!==-1&&x.splice(Re,1)}})()}}else Ne.setStyle(C);Ne.set("isMeasurement",!0)}try{oe.setActive(!1),s.removeInteraction(oe)}catch(Ee){r("[measure] removing draw interaction failed",Ee)}if(t.value){try{const{radial:Ee,preview:se,key:q}=t.value;q&&vl(q),Ee&&de.removeFeature(Ee),se&&de.removeFeature(se)}catch(Ee){r("[measure] cleanup azimuth preview state failed",Ee)}t.value=null}h.value=null,n.value=void 0,l.value=!1}),s.addInteraction(oe),h.value=oe,n.value=Y,l.value=!0;try{const ue=Y==="azimuth"?"measure_start_instruction_azimuth":Y==="area"?"measure_start_instruction_area":"measure_start_instruction",ge=m.value??(s.getView()&&s.getView().getCenter());z(i(ue),ge)}catch(ue){r("[measure] showHintOverlay (start hint) failed",ue)}}function ae(){if(s&&l.value){if(h.value&&(h.value.setActive(!1),s.removeInteraction(h.value),h.value=null),Eu.remove(),d.value){try{vl(d.value)}catch(Y){r("[measure] unByKey(pointerMoveKey) failed",Y)}d.value=null}if(V(),t.value){try{const{radial:Y,preview:de,key:D}=t.value;D&&vl(D);const oe=u.value?.getSource();oe&&(Y&&oe.removeFeature(Y),de&&oe.removeFeature(de))}catch(Y){r("[measure] cleaning up azimuthPreviewState in deactivate failed",Y)}t.value=null}if(e.value&&s){try{s.removeOverlay(e.value)}catch(Y){r("[measure] removing azimuth preview overlay in deactivate failed",Y)}e.value=null}m.value=null,l.value=!1}}function fe(){ae();try{x.forEach(Y=>Y())}catch(Y){r("[measure] running persistent removers failed",Y)}x.length=0;try{s.getLayers().getArray().slice().forEach(de=>{try{const D=de.getSource&&de.getSource();if(!D||!D.getFeatures)return;D.getFeatures().slice().forEach(oe=>{try{const ue=oe.get&&(oe.get("isMeasurement")||oe.get("isAzimuthRadial")||oe.get("isAzimuth")||oe.get("isAzimuthPreview")||oe.get("measurementId")||oe.get("finalOverlayRef")),ge=oe.getGeometry&&oe.getGeometry().getType&&oe.getGeometry().getType()==="Circle";(ue||ge)&&D.removeFeature(oe)}catch(ue){r("[measure] removing measurement features failed",ue)}});try{de.get&&de.get("cyLayerType")==="interactionMeasureLayer"&&s.removeLayer(de)}catch(oe){r("[measure] removing interaction measure layer failed",oe)}}catch(D){r("[measure] iterating layers during reset failed",D)}});try{Hle(s)}catch(de){r("[measure] removeAllMeasurementOverlays failed",de)}u.value=null}catch(Y){r("[measure] reset encountered an unexpected error",Y)}m.value=null}return Ms(()=>{try{fe()}catch(Y){r("[measure] reset on unmount failed",Y)}}),{activate:$,deactivate:ae,reset:fe,isActive:l,currentMode:n,measureLayer:u}}function Hle(n){if(n)try{n.getOverlays().getArray().slice().forEach(t=>{try{const i=t.getElement&&t.getElement(),r=i&&i.dataset&&i.dataset.measurementId,o=i&&i.classList&&i.classList.contains("lux-tooltip");(r||o)&&n.removeOverlay(t)}catch{}})}catch{}}const Kle={"data-cy":"toolbarMeasure"},jle={class:"absolute bottom-full top-auto z-20 flex flex-row justify-start divide-y-0 divide-x divide-gray-400 divide-solid box-content border-y-0 border-x border-gray-400"},$le=at({__name:"toolbar-measure",setup(n){const{toggleLidarOpen:e,toggleElevationProfileToolbarOpen:t}=Jn(),{t:i}=St(),{activate:r,deactivate:o,reset:s,currentMode:l}=Yle(),u=[{label:i("Length"),active:()=>l.value==="length",onClick:()=>l.value==="length"?o():r("length")},{label:i("Surface"),active:()=>l.value==="area",onClick:()=>l.value==="area"?o():r("area")},{label:i("Azimut"),active:()=>l.value==="azimuth",onClick:()=>l.value==="azimuth"?o():r("azimuth")},{label:i("Profile"),active:()=>!1,onClick:()=>t(!0)},{label:i("Profil Lidar"),active:()=>!1,onClick:()=>e(!0)},{label:i("Reset"),active:()=>!1,onClick:()=>s()}];return(h,d)=>(U(),ie("div",Kle,[P("ul",jle,[(U(),ie(Mt,null,hi(u,(m,y)=>P("li",{key:y},[mt(Om,{label:m.label,active:m.active(),onClick:m.onClick},null,8,["label","active","onClick"])])),64))])]))}}),Jle="/luxembourg-geoportail/fixes/assets/images/profile-CttQMPxA.png";var DT="http://www.w3.org/1999/xhtml";const QO={svg:"http://www.w3.org/2000/svg",xhtml:DT,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function _A(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),QO.hasOwnProperty(e)?{space:QO[e],local:n}:n}function qle(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===DT&&e.documentElement.namespaceURI===DT?e.createElement(n):e.createElementNS(t,n)}}function Qle(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function hZ(n){var e=_A(n);return(e.local?Qle:qle)(e)}function eue(){}function fk(n){return n==null?eue:function(){return this.querySelector(n)}}function tue(n){typeof n!="function"&&(n=fk(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,l=i[r]=new Array(s),u,h,d=0;d<s;++d)(u=o[d])&&(h=n.call(u,u.__data__,d,o))&&("__data__"in u&&(h.__data__=u.__data__),l[d]=h);return new Sa(i,this._parents)}function dZ(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function nue(){return[]}function fZ(n){return n==null?nue:function(){return this.querySelectorAll(n)}}function iue(n){return function(){return dZ(n.apply(this,arguments))}}function rue(n){typeof n=="function"?n=iue(n):n=fZ(n);for(var e=this._groups,t=e.length,i=[],r=[],o=0;o<t;++o)for(var s=e[o],l=s.length,u,h=0;h<l;++h)(u=s[h])&&(i.push(n.call(u,u.__data__,h,s)),r.push(u));return new Sa(i,r)}function pZ(n){return function(){return this.matches(n)}}function gZ(n){return function(e){return e.matches(n)}}var sue=Array.prototype.find;function oue(n){return function(){return sue.call(this.children,n)}}function aue(){return this.firstElementChild}function lue(n){return this.select(n==null?aue:oue(typeof n=="function"?n:gZ(n)))}var uue=Array.prototype.filter;function cue(){return Array.from(this.children)}function hue(n){return function(){return uue.call(this.children,n)}}function due(n){return this.selectAll(n==null?cue:hue(typeof n=="function"?n:gZ(n)))}function fue(n){typeof n!="function"&&(n=pZ(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,l=i[r]=[],u,h=0;h<s;++h)(u=o[h])&&n.call(u,u.__data__,h,o)&&l.push(u);return new Sa(i,this._parents)}function mZ(n){return new Array(n.length)}function pue(){return new Sa(this._enter||this._groups.map(mZ),this._parents)}function jC(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}jC.prototype={constructor:jC,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function gue(n){return function(){return n}}function mue(n,e,t,i,r,o){for(var s=0,l,u=e.length,h=o.length;s<h;++s)(l=e[s])?(l.__data__=o[s],i[s]=l):t[s]=new jC(n,o[s]);for(;s<u;++s)(l=e[s])&&(r[s]=l)}function yue(n,e,t,i,r,o,s){var l,u,h=new Map,d=e.length,m=o.length,y=new Array(d),x;for(l=0;l<d;++l)(u=e[l])&&(y[l]=x=s.call(u,u.__data__,l,e)+"",h.has(x)?r[l]=u:h.set(x,u));for(l=0;l<m;++l)x=s.call(n,o[l],l,o)+"",(u=h.get(x))?(i[l]=u,u.__data__=o[l],h.delete(x)):t[l]=new jC(n,o[l]);for(l=0;l<d;++l)(u=e[l])&&h.get(y[l])===u&&(r[l]=u)}function _ue(n){return n.__data__}function vue(n,e){if(!arguments.length)return Array.from(this,_ue);var t=e?yue:mue,i=this._parents,r=this._groups;typeof n!="function"&&(n=gue(n));for(var o=r.length,s=new Array(o),l=new Array(o),u=new Array(o),h=0;h<o;++h){var d=i[h],m=r[h],y=m.length,x=bue(n.call(d,d&&d.__data__,h,i)),C=x.length,w=l[h]=new Array(C),E=s[h]=new Array(C),T=u[h]=new Array(y);t(d,m,w,E,T,x,e);for(var k=0,G=0,O,V;k<C;++k)if(O=w[k]){for(k>=G&&(G=k+1);!(V=E[G])&&++G<C;);O._next=V||null}}return s=new Sa(s,i),s._enter=l,s._exit=u,s}function bue(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function xue(){return new Sa(this._exit||this._groups.map(mZ),this._parents)}function Iue(n,e,t){var i=this.enter(),r=this,o=this.exit();return typeof n=="function"?(i=n(i),i&&(i=i.selection())):i=i.append(n+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?o.remove():t(o),i&&r?i.merge(r).order():r}function Cue(n){for(var e=n.selection?n.selection():n,t=this._groups,i=e._groups,r=t.length,o=i.length,s=Math.min(r,o),l=new Array(r),u=0;u<s;++u)for(var h=t[u],d=i[u],m=h.length,y=l[u]=new Array(m),x,C=0;C<m;++C)(x=h[C]||d[C])&&(y[C]=x);for(;u<r;++u)l[u]=t[u];return new Sa(l,this._parents)}function wue(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var i=n[e],r=i.length-1,o=i[r],s;--r>=0;)(s=i[r])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function Aue(n){n||(n=Sue);function e(m,y){return m&&y?n(m.__data__,y.__data__):!m-!y}for(var t=this._groups,i=t.length,r=new Array(i),o=0;o<i;++o){for(var s=t[o],l=s.length,u=r[o]=new Array(l),h,d=0;d<l;++d)(h=s[d])&&(u[d]=h);u.sort(e)}return new Sa(r,this._parents).order()}function Sue(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function Eue(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function Tue(){return Array.from(this)}function Rue(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null}function Mue(){let n=0;for(const e of this)++n;return n}function kue(){return!this.node()}function Lue(n){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var r=e[t],o=0,s=r.length,l;o<s;++o)(l=r[o])&&n.call(l,l.__data__,o,r);return this}function Pue(n){return function(){this.removeAttribute(n)}}function Gue(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Fue(n,e){return function(){this.setAttribute(n,e)}}function Oue(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function Nue(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function Due(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function Vue(n,e){var t=_A(n);if(arguments.length<2){var i=this.node();return t.local?i.getAttributeNS(t.space,t.local):i.getAttribute(t)}return this.each((e==null?t.local?Gue:Pue:typeof e=="function"?t.local?Due:Nue:t.local?Oue:Fue)(t,e))}function yZ(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function Bue(n){return function(){this.style.removeProperty(n)}}function Zue(n,e,t){return function(){this.style.setProperty(n,e,t)}}function Wue(n,e,t){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(n):this.style.setProperty(n,i,t)}}function zue(n,e,t){return arguments.length>1?this.each((e==null?Bue:typeof e=="function"?Wue:Zue)(n,e,t??"")):Gy(this.node(),n)}function Gy(n,e){return n.style.getPropertyValue(e)||yZ(n).getComputedStyle(n,null).getPropertyValue(e)}function Uue(n){return function(){delete this[n]}}function Xue(n,e){return function(){this[n]=e}}function Yue(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function Hue(n,e){return arguments.length>1?this.each((e==null?Uue:typeof e=="function"?Yue:Xue)(n,e)):this.node()[n]}function _Z(n){return n.trim().split(/^|\s+/)}function pk(n){return n.classList||new vZ(n)}function vZ(n){this._node=n,this._names=_Z(n.getAttribute("class")||"")}vZ.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function bZ(n,e){for(var t=pk(n),i=-1,r=e.length;++i<r;)t.add(e[i])}function xZ(n,e){for(var t=pk(n),i=-1,r=e.length;++i<r;)t.remove(e[i])}function Kue(n){return function(){bZ(this,n)}}function jue(n){return function(){xZ(this,n)}}function $ue(n,e){return function(){(e.apply(this,arguments)?bZ:xZ)(this,n)}}function Jue(n,e){var t=_Z(n+"");if(arguments.length<2){for(var i=pk(this.node()),r=-1,o=t.length;++r<o;)if(!i.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?$ue:e?Kue:jue)(t,e))}function que(){this.textContent=""}function Que(n){return function(){this.textContent=n}}function ece(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function tce(n){return arguments.length?this.each(n==null?que:(typeof n=="function"?ece:Que)(n)):this.node().textContent}function nce(){this.innerHTML=""}function ice(n){return function(){this.innerHTML=n}}function rce(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function sce(n){return arguments.length?this.each(n==null?nce:(typeof n=="function"?rce:ice)(n)):this.node().innerHTML}function oce(){this.nextSibling&&this.parentNode.appendChild(this)}function ace(){return this.each(oce)}function lce(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function uce(){return this.each(lce)}function cce(n){var e=typeof n=="function"?n:hZ(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function hce(){return null}function dce(n,e){var t=typeof n=="function"?n:hZ(n),i=e==null?hce:typeof e=="function"?e:fk(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),i.apply(this,arguments)||null)})}function fce(){var n=this.parentNode;n&&n.removeChild(this)}function pce(){return this.each(fce)}function gce(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function mce(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function yce(n){return this.select(n?mce:gce)}function _ce(n){return arguments.length?this.property("__data__",n):this.node().__data__}function vce(n){return function(e){n.call(this,e,this.__data__)}}function bce(n){return n.trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}})}function xce(n){return function(){var e=this.__on;if(e){for(var t=0,i=-1,r=e.length,o;t<r;++t)o=e[t],(!n.type||o.type===n.type)&&o.name===n.name?this.removeEventListener(o.type,o.listener,o.options):e[++i]=o;++i?e.length=i:delete this.__on}}}function Ice(n,e,t){return function(){var i=this.__on,r,o=vce(e);if(i){for(var s=0,l=i.length;s<l;++s)if((r=i[s]).type===n.type&&r.name===n.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=t),r.value=e;return}}this.addEventListener(n.type,o,t),r={type:n.type,name:n.name,value:e,listener:o,options:t},i?i.push(r):this.__on=[r]}}function Cce(n,e,t){var i=bce(n+""),r,o=i.length,s;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,h=l.length,d;u<h;++u)for(r=0,d=l[u];r<o;++r)if((s=i[r]).type===d.type&&s.name===d.name)return d.value}return}for(l=e?Ice:xce,r=0;r<o;++r)this.each(l(i[r],e,t));return this}function IZ(n,e,t){var i=yZ(n),r=i.CustomEvent;typeof r=="function"?r=new r(e,t):(r=i.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),n.dispatchEvent(r)}function wce(n,e){return function(){return IZ(this,n,e)}}function Ace(n,e){return function(){return IZ(this,n,e.apply(this,arguments))}}function Sce(n,e){return this.each((typeof e=="function"?Ace:wce)(n,e))}function*Ece(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,o=i.length,s;r<o;++r)(s=i[r])&&(yield s)}var gk=[null];function Sa(n,e){this._groups=n,this._parents=e}function Pb(){return new Sa([[document.documentElement]],gk)}function Tce(){return this}Sa.prototype=Pb.prototype={constructor:Sa,select:tue,selectAll:rue,selectChild:lue,selectChildren:due,filter:fue,data:vue,enter:pue,exit:xue,join:Iue,merge:Cue,selection:Tce,order:wue,sort:Aue,call:Eue,nodes:Tue,node:Rue,size:Mue,empty:kue,each:Lue,attr:Vue,style:zue,property:Hue,classed:Jue,text:tce,html:sce,raise:ace,lower:uce,append:cce,insert:dce,remove:pce,clone:yce,datum:_ce,on:Cce,dispatch:Sce,[Symbol.iterator]:Ece};function sa(n){return typeof n=="string"?new Sa([[document.querySelector(n)]],[document.documentElement]):new Sa([[n]],gk)}function Rce(n){let e;for(;e=n.sourceEvent;)n=e;return n}function bu(n,e){if(n=Rce(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var i=t.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop]}}return[n.pageX,n.pageY]}function Mce(n){return typeof n=="string"?new Sa([document.querySelectorAll(n)],[document.documentElement]):new Sa([dZ(n)],gk)}var kce={value:()=>{}};function mk(){for(var n=0,e=arguments.length,t={},i;n<e;++n){if(!(i=arguments[n]+"")||i in t||/[\s.]/.test(i))throw new Error("illegal type: "+i);t[i]=[]}return new AI(t)}function AI(n){this._=n}function Lce(n,e){return n.trim().split(/^|\s+/).map(function(t){var i="",r=t.indexOf(".");if(r>=0&&(i=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}})}AI.prototype=mk.prototype={constructor:AI,on:function(n,e){var t=this._,i=Lce(n+"",t),r,o=-1,s=i.length;if(arguments.length<2){for(;++o<s;)if((r=(n=i[o]).type)&&(r=Pce(t[r],n.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(r=(n=i[o]).type)t[r]=e5(t[r],n.name,e);else if(e==null)for(r in t)t[r]=e5(t[r],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new AI(n)},call:function(n,e){if((r=arguments.length-2)>0)for(var t=new Array(r),i=0,r,o;i<r;++i)t[i]=arguments[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(o=this._[n],i=0,r=o.length;i<r;++i)o[i].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var i=this._[n],r=0,o=i.length;r<o;++r)i[r].value.apply(e,t)}};function Pce(n,e){for(var t=0,i=n.length,r;t<i;++t)if((r=n[t]).name===e)return r.value}function e5(n,e,t){for(var i=0,r=n.length;i<r;++i)if(n[i].name===e){n[i]=kce,n=n.slice(0,i).concat(n.slice(i+1));break}return t!=null&&n.push({name:e,value:t}),n}var Fy=0,D0=0,_0=0,CZ=1e3,$C,V0,JC=0,sg=0,vA=0,tb=typeof performance=="object"&&performance.now?performance:Date,wZ=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function yk(){return sg||(wZ(Gce),sg=tb.now()+vA)}function Gce(){sg=0}function qC(){this._call=this._time=this._next=null}qC.prototype=AZ.prototype={constructor:qC,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?yk():+t)+(e==null?0:+e),!this._next&&V0!==this&&(V0?V0._next=this:$C=this,V0=this),this._call=n,this._time=t,VT()},stop:function(){this._call&&(this._call=null,this._time=1/0,VT())}};function AZ(n,e,t){var i=new qC;return i.restart(n,e,t),i}function Fce(){yk(),++Fy;for(var n=$C,e;n;)(e=sg-n._time)>=0&&n._call.call(void 0,e),n=n._next;--Fy}function t5(){sg=(JC=tb.now())+vA,Fy=D0=0;try{Fce()}finally{Fy=0,Nce(),sg=0}}function Oce(){var n=tb.now(),e=n-JC;e>CZ&&(vA-=e,JC=n)}function Nce(){for(var n,e=$C,t,i=1/0;e;)e._call?(i>e._time&&(i=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:$C=t);V0=n,VT(i)}function VT(n){if(!Fy){D0&&(D0=clearTimeout(D0));var e=n-sg;e>24?(n<1/0&&(D0=setTimeout(t5,n-tb.now()-vA)),_0&&(_0=clearInterval(_0))):(_0||(JC=tb.now(),_0=setInterval(Oce,CZ)),Fy=1,wZ(t5))}}function n5(n,e,t){var i=new qC;return e=e==null?0:+e,i.restart(r=>{i.stop(),n(r+e)},e,t),i}var Dce=mk("start","end","cancel","interrupt"),Vce=[],SZ=0,i5=1,BT=2,SI=3,r5=4,ZT=5,EI=6;function bA(n,e,t,i,r,o){var s=n.__transition;if(!s)n.__transition={};else if(t in s)return;Bce(n,t,{name:e,index:i,group:r,on:Dce,tween:Vce,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:SZ})}function _k(n,e){var t=Wu(n,e);if(t.state>SZ)throw new Error("too late; already scheduled");return t}function Uc(n,e){var t=Wu(n,e);if(t.state>SI)throw new Error("too late; already running");return t}function Wu(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function Bce(n,e,t){var i=n.__transition,r;i[e]=t,t.timer=AZ(o,0,t.time);function o(h){t.state=i5,t.timer.restart(s,t.delay,t.time),t.delay<=h&&s(h-t.delay)}function s(h){var d,m,y,x;if(t.state!==i5)return u();for(d in i)if(x=i[d],x.name===t.name){if(x.state===SI)return n5(s);x.state===r5?(x.state=EI,x.timer.stop(),x.on.call("interrupt",n,n.__data__,x.index,x.group),delete i[d]):+d<e&&(x.state=EI,x.timer.stop(),x.on.call("cancel",n,n.__data__,x.index,x.group),delete i[d])}if(n5(function(){t.state===SI&&(t.state=r5,t.timer.restart(l,t.delay,t.time),l(h))}),t.state=BT,t.on.call("start",n,n.__data__,t.index,t.group),t.state===BT){for(t.state=SI,r=new Array(y=t.tween.length),d=0,m=-1;d<y;++d)(x=t.tween[d].value.call(n,n.__data__,t.index,t.group))&&(r[++m]=x);r.length=m+1}}function l(h){for(var d=h<t.duration?t.ease.call(null,h/t.duration):(t.timer.restart(u),t.state=ZT,1),m=-1,y=r.length;++m<y;)r[m].call(n,d);t.state===ZT&&(t.on.call("end",n,n.__data__,t.index,t.group),u())}function u(){t.state=EI,t.timer.stop(),delete i[e];for(var h in i)return;delete n.__transition}}function TI(n,e){var t=n.__transition,i,r,o=!0,s;if(t){e=e==null?null:e+"";for(s in t){if((i=t[s]).name!==e){o=!1;continue}r=i.state>BT&&i.state<ZT,i.state=EI,i.timer.stop(),i.on.call(r?"interrupt":"cancel",n,n.__data__,i.index,i.group),delete t[s]}o&&delete n.__transition}}function Zce(n){return this.each(function(){TI(this,n)})}function vk(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function EZ(n,e){var t=Object.create(n.prototype);for(var i in e)t[i]=e[i];return t}function Gb(){}var nb=.7,QC=1/nb,my="\\s*([+-]?\\d+)\\s*",ib="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",kc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Wce=/^#([0-9a-f]{3,8})$/,zce=new RegExp(`^rgb\\(${my},${my},${my}\\)$`),Uce=new RegExp(`^rgb\\(${kc},${kc},${kc}\\)$`),Xce=new RegExp(`^rgba\\(${my},${my},${my},${ib}\\)$`),Yce=new RegExp(`^rgba\\(${kc},${kc},${kc},${ib}\\)$`),Hce=new RegExp(`^hsl\\(${ib},${kc},${kc}\\)$`),Kce=new RegExp(`^hsla\\(${ib},${kc},${kc},${ib}\\)$`),s5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};vk(Gb,og,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:o5,formatHex:o5,formatHex8:jce,formatHsl:$ce,formatRgb:a5,toString:a5});function o5(){return this.rgb().formatHex()}function jce(){return this.rgb().formatHex8()}function $ce(){return TZ(this).formatHsl()}function a5(){return this.rgb().formatRgb()}function og(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=Wce.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?l5(e):t===3?new Ja(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?Bx(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?Bx(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=zce.exec(n))?new Ja(e[1],e[2],e[3],1):(e=Uce.exec(n))?new Ja(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Xce.exec(n))?Bx(e[1],e[2],e[3],e[4]):(e=Yce.exec(n))?Bx(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Hce.exec(n))?h5(e[1],e[2]/100,e[3]/100,1):(e=Kce.exec(n))?h5(e[1],e[2]/100,e[3]/100,e[4]):s5.hasOwnProperty(n)?l5(s5[n]):n==="transparent"?new Ja(NaN,NaN,NaN,0):null}function l5(n){return new Ja(n>>16&255,n>>8&255,n&255,1)}function Bx(n,e,t,i){return i<=0&&(n=e=t=NaN),new Ja(n,e,t,i)}function Jce(n){return n instanceof Gb||(n=og(n)),n?(n=n.rgb(),new Ja(n.r,n.g,n.b,n.opacity)):new Ja}function WT(n,e,t,i){return arguments.length===1?Jce(n):new Ja(n,e,t,i??1)}function Ja(n,e,t,i){this.r=+n,this.g=+e,this.b=+t,this.opacity=+i}vk(Ja,WT,EZ(Gb,{brighter(n){return n=n==null?QC:Math.pow(QC,n),new Ja(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?nb:Math.pow(nb,n),new Ja(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Ja(Up(this.r),Up(this.g),Up(this.b),ew(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:u5,formatHex:u5,formatHex8:qce,formatRgb:c5,toString:c5}));function u5(){return`#${Np(this.r)}${Np(this.g)}${Np(this.b)}`}function qce(){return`#${Np(this.r)}${Np(this.g)}${Np(this.b)}${Np((isNaN(this.opacity)?1:this.opacity)*255)}`}function c5(){const n=ew(this.opacity);return`${n===1?"rgb(":"rgba("}${Up(this.r)}, ${Up(this.g)}, ${Up(this.b)}${n===1?")":`, ${n})`}`}function ew(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Up(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Np(n){return n=Up(n),(n<16?"0":"")+n.toString(16)}function h5(n,e,t,i){return i<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Au(n,e,t,i)}function TZ(n){if(n instanceof Au)return new Au(n.h,n.s,n.l,n.opacity);if(n instanceof Gb||(n=og(n)),!n)return new Au;if(n instanceof Au)return n;n=n.rgb();var e=n.r/255,t=n.g/255,i=n.b/255,r=Math.min(e,t,i),o=Math.max(e,t,i),s=NaN,l=o-r,u=(o+r)/2;return l?(e===o?s=(t-i)/l+(t<i)*6:t===o?s=(i-e)/l+2:s=(e-t)/l+4,l/=u<.5?o+r:2-o-r,s*=60):l=u>0&&u<1?0:s,new Au(s,l,u,n.opacity)}function Qce(n,e,t,i){return arguments.length===1?TZ(n):new Au(n,e,t,i??1)}function Au(n,e,t,i){this.h=+n,this.s=+e,this.l=+t,this.opacity=+i}vk(Au,Qce,EZ(Gb,{brighter(n){return n=n==null?QC:Math.pow(QC,n),new Au(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?nb:Math.pow(nb,n),new Au(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,r=2*t-i;return new Ja(BS(n>=240?n-240:n+120,r,i),BS(n,r,i),BS(n<120?n+240:n-120,r,i),this.opacity)},clamp(){return new Au(d5(this.h),Zx(this.s),Zx(this.l),ew(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=ew(this.opacity);return`${n===1?"hsl(":"hsla("}${d5(this.h)}, ${Zx(this.s)*100}%, ${Zx(this.l)*100}%${n===1?")":`, ${n})`}`}}));function d5(n){return n=(n||0)%360,n<0?n+360:n}function Zx(n){return Math.max(0,Math.min(1,n||0))}function BS(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const bk=n=>()=>n;function ehe(n,e){return function(t){return n+t*e}}function the(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(i){return Math.pow(n+i*e,t)}}function nhe(n){return(n=+n)==1?RZ:function(e,t){return t-e?the(e,t,n):bk(isNaN(e)?t:e)}}function RZ(n,e){var t=e-n;return t?ehe(n,t):bk(isNaN(n)?e:n)}const tw=(function n(e){var t=nhe(e);function i(r,o){var s=t((r=WT(r)).r,(o=WT(o)).r),l=t(r.g,o.g),u=t(r.b,o.b),h=RZ(r.opacity,o.opacity);return function(d){return r.r=s(d),r.g=l(d),r.b=u(d),r.opacity=h(d),r+""}}return i.gamma=n,i})(1);function ihe(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,i=e.slice(),r;return function(o){for(r=0;r<t;++r)i[r]=n[r]*(1-o)+e[r]*o;return i}}function rhe(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function she(n,e){var t=e?e.length:0,i=n?Math.min(t,n.length):0,r=new Array(i),o=new Array(t),s;for(s=0;s<i;++s)r[s]=xk(n[s],e[s]);for(;s<t;++s)o[s]=e[s];return function(l){for(s=0;s<i;++s)o[s]=r[s](l);return o}}function ohe(n,e){var t=new Date;return n=+n,e=+e,function(i){return t.setTime(n*(1-i)+e*i),t}}function Iu(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function ahe(n,e){var t={},i={},r;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in n?t[r]=xk(n[r],e[r]):i[r]=e[r];return function(o){for(r in t)i[r]=t[r](o);return i}}var zT=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ZS=new RegExp(zT.source,"g");function lhe(n){return function(){return n}}function uhe(n){return function(e){return n(e)+""}}function MZ(n,e){var t=zT.lastIndex=ZS.lastIndex=0,i,r,o,s=-1,l=[],u=[];for(n=n+"",e=e+"";(i=zT.exec(n))&&(r=ZS.exec(e));)(o=r.index)>t&&(o=e.slice(t,o),l[s]?l[s]+=o:l[++s]=o),(i=i[0])===(r=r[0])?l[s]?l[s]+=r:l[++s]=r:(l[++s]=null,u.push({i:s,x:Iu(i,r)})),t=ZS.lastIndex;return t<e.length&&(o=e.slice(t),l[s]?l[s]+=o:l[++s]=o),l.length<2?u[0]?uhe(u[0].x):lhe(e):(e=u.length,function(h){for(var d=0,m;d<e;++d)l[(m=u[d]).i]=m.x(h);return l.join("")})}function xk(n,e){var t=typeof e,i;return e==null||t==="boolean"?bk(e):(t==="number"?Iu:t==="string"?(i=og(e))?(e=i,tw):MZ:e instanceof og?tw:e instanceof Date?ohe:rhe(e)?ihe:Array.isArray(e)?she:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?ahe:Iu)(n,e)}function che(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}var f5=180/Math.PI,UT={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function kZ(n,e,t,i,r,o){var s,l,u;return(s=Math.sqrt(n*n+e*e))&&(n/=s,e/=s),(u=n*t+e*i)&&(t-=n*u,i-=e*u),(l=Math.sqrt(t*t+i*i))&&(t/=l,i/=l,u/=l),n*i<e*t&&(n=-n,e=-e,u=-u,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(e,n)*f5,skewX:Math.atan(u)*f5,scaleX:s,scaleY:l}}var Wx;function hhe(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?UT:kZ(e.a,e.b,e.c,e.d,e.e,e.f)}function dhe(n){return n==null||(Wx||(Wx=document.createElementNS("http://www.w3.org/2000/svg","g")),Wx.setAttribute("transform",n),!(n=Wx.transform.baseVal.consolidate()))?UT:(n=n.matrix,kZ(n.a,n.b,n.c,n.d,n.e,n.f))}function LZ(n,e,t,i){function r(h){return h.length?h.pop()+" ":""}function o(h,d,m,y,x,C){if(h!==m||d!==y){var w=x.push("translate(",null,e,null,t);C.push({i:w-4,x:Iu(h,m)},{i:w-2,x:Iu(d,y)})}else(m||y)&&x.push("translate("+m+e+y+t)}function s(h,d,m,y){h!==d?(h-d>180?d+=360:d-h>180&&(h+=360),y.push({i:m.push(r(m)+"rotate(",null,i)-2,x:Iu(h,d)})):d&&m.push(r(m)+"rotate("+d+i)}function l(h,d,m,y){h!==d?y.push({i:m.push(r(m)+"skewX(",null,i)-2,x:Iu(h,d)}):d&&m.push(r(m)+"skewX("+d+i)}function u(h,d,m,y,x,C){if(h!==m||d!==y){var w=x.push(r(x)+"scale(",null,",",null,")");C.push({i:w-4,x:Iu(h,m)},{i:w-2,x:Iu(d,y)})}else(m!==1||y!==1)&&x.push(r(x)+"scale("+m+","+y+")")}return function(h,d){var m=[],y=[];return h=n(h),d=n(d),o(h.translateX,h.translateY,d.translateX,d.translateY,m,y),s(h.rotate,d.rotate,m,y),l(h.skewX,d.skewX,m,y),u(h.scaleX,h.scaleY,d.scaleX,d.scaleY,m,y),h=d=null,function(x){for(var C=-1,w=y.length,E;++C<w;)m[(E=y[C]).i]=E.x(x);return m.join("")}}}var fhe=LZ(hhe,"px, ","px)","deg)"),phe=LZ(dhe,", ",")",")"),ghe=1e-12;function p5(n){return((n=Math.exp(n))+1/n)/2}function mhe(n){return((n=Math.exp(n))-1/n)/2}function yhe(n){return((n=Math.exp(2*n))-1)/(n+1)}const _he=(function n(e,t,i){function r(o,s){var l=o[0],u=o[1],h=o[2],d=s[0],m=s[1],y=s[2],x=d-l,C=m-u,w=x*x+C*C,E,T;if(w<ghe)T=Math.log(y/h)/e,E=function(H){return[l+H*x,u+H*C,h*Math.exp(e*H*T)]};else{var k=Math.sqrt(w),G=(y*y-h*h+i*w)/(2*h*t*k),O=(y*y-h*h-i*w)/(2*y*t*k),V=Math.log(Math.sqrt(G*G+1)-G),z=Math.log(Math.sqrt(O*O+1)-O);T=(z-V)/e,E=function(H){var te=H*T,$=p5(V),ae=h/(t*k)*($*yhe(e*te+V)-mhe(V));return[l+ae*x,u+ae*C,h*$/p5(e*te+V)]}}return E.duration=T*1e3*e/Math.SQRT2,E}return r.rho=function(o){var s=Math.max(.001,+o),l=s*s,u=l*l;return n(s,l,u)},r})(Math.SQRT2,2,4);function vhe(n,e){var t,i;return function(){var r=Uc(this,n),o=r.tween;if(o!==t){i=t=o;for(var s=0,l=i.length;s<l;++s)if(i[s].name===e){i=i.slice(),i.splice(s,1);break}}r.tween=i}}function bhe(n,e,t){var i,r;if(typeof t!="function")throw new Error;return function(){var o=Uc(this,n),s=o.tween;if(s!==i){r=(i=s).slice();for(var l={name:e,value:t},u=0,h=r.length;u<h;++u)if(r[u].name===e){r[u]=l;break}u===h&&r.push(l)}o.tween=r}}function xhe(n,e){var t=this._id;if(n+="",arguments.length<2){for(var i=Wu(this.node(),t).tween,r=0,o=i.length,s;r<o;++r)if((s=i[r]).name===n)return s.value;return null}return this.each((e==null?vhe:bhe)(t,n,e))}function Ik(n,e,t){var i=n._id;return n.each(function(){var r=Uc(this,i);(r.value||(r.value={}))[e]=t.apply(this,arguments)}),function(r){return Wu(r,i).value[e]}}function PZ(n,e){var t;return(typeof e=="number"?Iu:e instanceof og?tw:(t=og(e))?(e=t,tw):MZ)(n,e)}function Ihe(n){return function(){this.removeAttribute(n)}}function Che(n){return function(){this.removeAttributeNS(n.space,n.local)}}function whe(n,e,t){var i,r=t+"",o;return function(){var s=this.getAttribute(n);return s===r?null:s===i?o:o=e(i=s,t)}}function Ahe(n,e,t){var i,r=t+"",o;return function(){var s=this.getAttributeNS(n.space,n.local);return s===r?null:s===i?o:o=e(i=s,t)}}function She(n,e,t){var i,r,o;return function(){var s,l=t(this),u;return l==null?void this.removeAttribute(n):(s=this.getAttribute(n),u=l+"",s===u?null:s===i&&u===r?o:(r=u,o=e(i=s,l)))}}function Ehe(n,e,t){var i,r,o;return function(){var s,l=t(this),u;return l==null?void this.removeAttributeNS(n.space,n.local):(s=this.getAttributeNS(n.space,n.local),u=l+"",s===u?null:s===i&&u===r?o:(r=u,o=e(i=s,l)))}}function The(n,e){var t=_A(n),i=t==="transform"?phe:PZ;return this.attrTween(n,typeof e=="function"?(t.local?Ehe:She)(t,i,Ik(this,"attr."+n,e)):e==null?(t.local?Che:Ihe)(t):(t.local?Ahe:whe)(t,i,e))}function Rhe(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function Mhe(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function khe(n,e){var t,i;function r(){var o=e.apply(this,arguments);return o!==i&&(t=(i=o)&&Mhe(n,o)),t}return r._value=e,r}function Lhe(n,e){var t,i;function r(){var o=e.apply(this,arguments);return o!==i&&(t=(i=o)&&Rhe(n,o)),t}return r._value=e,r}function Phe(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var i=_A(n);return this.tween(t,(i.local?khe:Lhe)(i,e))}function Ghe(n,e){return function(){_k(this,n).delay=+e.apply(this,arguments)}}function Fhe(n,e){return e=+e,function(){_k(this,n).delay=e}}function Ohe(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?Ghe:Fhe)(e,n)):Wu(this.node(),e).delay}function Nhe(n,e){return function(){Uc(this,n).duration=+e.apply(this,arguments)}}function Dhe(n,e){return e=+e,function(){Uc(this,n).duration=e}}function Vhe(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?Nhe:Dhe)(e,n)):Wu(this.node(),e).duration}function Bhe(n,e){if(typeof e!="function")throw new Error;return function(){Uc(this,n).ease=e}}function Zhe(n){var e=this._id;return arguments.length?this.each(Bhe(e,n)):Wu(this.node(),e).ease}function Whe(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Uc(this,n).ease=t}}function zhe(n){if(typeof n!="function")throw new Error;return this.each(Whe(this._id,n))}function Uhe(n){typeof n!="function"&&(n=pZ(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,l=i[r]=[],u,h=0;h<s;++h)(u=o[h])&&n.call(u,u.__data__,h,o)&&l.push(u);return new Qh(i,this._parents,this._name,this._id)}function Xhe(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,i=e.length,r=t.length,o=Math.min(i,r),s=new Array(i),l=0;l<o;++l)for(var u=e[l],h=t[l],d=u.length,m=s[l]=new Array(d),y,x=0;x<d;++x)(y=u[x]||h[x])&&(m[x]=y);for(;l<i;++l)s[l]=e[l];return new Qh(s,this._parents,this._name,this._id)}function Yhe(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function Hhe(n,e,t){var i,r,o=Yhe(e)?_k:Uc;return function(){var s=o(this,n),l=s.on;l!==i&&(r=(i=l).copy()).on(e,t),s.on=r}}function Khe(n,e){var t=this._id;return arguments.length<2?Wu(this.node(),t).on.on(n):this.each(Hhe(t,n,e))}function jhe(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function $he(){return this.on("end.remove",jhe(this._id))}function Jhe(n){var e=this._name,t=this._id;typeof n!="function"&&(n=fk(n));for(var i=this._groups,r=i.length,o=new Array(r),s=0;s<r;++s)for(var l=i[s],u=l.length,h=o[s]=new Array(u),d,m,y=0;y<u;++y)(d=l[y])&&(m=n.call(d,d.__data__,y,l))&&("__data__"in d&&(m.__data__=d.__data__),h[y]=m,bA(h[y],e,t,y,h,Wu(d,t)));return new Qh(o,this._parents,e,t)}function qhe(n){var e=this._name,t=this._id;typeof n!="function"&&(n=fZ(n));for(var i=this._groups,r=i.length,o=[],s=[],l=0;l<r;++l)for(var u=i[l],h=u.length,d,m=0;m<h;++m)if(d=u[m]){for(var y=n.call(d,d.__data__,m,u),x,C=Wu(d,t),w=0,E=y.length;w<E;++w)(x=y[w])&&bA(x,e,t,w,y,C);o.push(y),s.push(d)}return new Qh(o,s,e,t)}var Qhe=Pb.prototype.constructor;function ede(){return new Qhe(this._groups,this._parents)}function tde(n,e){var t,i,r;return function(){var o=Gy(this,n),s=(this.style.removeProperty(n),Gy(this,n));return o===s?null:o===t&&s===i?r:r=e(t=o,i=s)}}function GZ(n){return function(){this.style.removeProperty(n)}}function nde(n,e,t){var i,r=t+"",o;return function(){var s=Gy(this,n);return s===r?null:s===i?o:o=e(i=s,t)}}function ide(n,e,t){var i,r,o;return function(){var s=Gy(this,n),l=t(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(n),Gy(this,n))),s===u?null:s===i&&u===r?o:(r=u,o=e(i=s,l))}}function rde(n,e){var t,i,r,o="style."+e,s="end."+o,l;return function(){var u=Uc(this,n),h=u.on,d=u.value[o]==null?l||(l=GZ(e)):void 0;(h!==t||r!==d)&&(i=(t=h).copy()).on(s,r=d),u.on=i}}function sde(n,e,t){var i=(n+="")=="transform"?fhe:PZ;return e==null?this.styleTween(n,tde(n,i)).on("end.style."+n,GZ(n)):typeof e=="function"?this.styleTween(n,ide(n,i,Ik(this,"style."+n,e))).each(rde(this._id,n)):this.styleTween(n,nde(n,i,e),t).on("end.style."+n,null)}function ode(n,e,t){return function(i){this.style.setProperty(n,e.call(this,i),t)}}function ade(n,e,t){var i,r;function o(){var s=e.apply(this,arguments);return s!==r&&(i=(r=s)&&ode(n,s,t)),i}return o._value=e,o}function lde(n,e,t){var i="style."+(n+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,ade(n,e,t??""))}function ude(n){return function(){this.textContent=n}}function cde(n){return function(){var e=n(this);this.textContent=e??""}}function hde(n){return this.tween("text",typeof n=="function"?cde(Ik(this,"text",n)):ude(n==null?"":n+""))}function dde(n){return function(e){this.textContent=n.call(this,e)}}function fde(n){var e,t;function i(){var r=n.apply(this,arguments);return r!==t&&(e=(t=r)&&dde(r)),e}return i._value=n,i}function pde(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,fde(n))}function gde(){for(var n=this._name,e=this._id,t=FZ(),i=this._groups,r=i.length,o=0;o<r;++o)for(var s=i[o],l=s.length,u,h=0;h<l;++h)if(u=s[h]){var d=Wu(u,e);bA(u,n,t,h,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Qh(i,this._parents,n,t)}function mde(){var n,e,t=this,i=t._id,r=t.size();return new Promise(function(o,s){var l={value:s},u={value:function(){--r===0&&o()}};t.each(function(){var h=Uc(this,i),d=h.on;d!==n&&(e=(n=d).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),h.on=e}),r===0&&o()})}var yde=0;function Qh(n,e,t,i){this._groups=n,this._parents=e,this._name=t,this._id=i}function FZ(){return++yde}var Ih=Pb.prototype;Qh.prototype={constructor:Qh,select:Jhe,selectAll:qhe,selectChild:Ih.selectChild,selectChildren:Ih.selectChildren,filter:Uhe,merge:Xhe,selection:ede,transition:gde,call:Ih.call,nodes:Ih.nodes,node:Ih.node,size:Ih.size,empty:Ih.empty,each:Ih.each,on:Khe,attr:The,attrTween:Phe,style:sde,styleTween:lde,text:hde,textTween:pde,remove:$he,tween:xhe,delay:Ohe,duration:Vhe,ease:Zhe,easeVarying:zhe,end:mde,[Symbol.iterator]:Ih[Symbol.iterator]};function _de(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var vde={time:null,delay:0,duration:250,ease:_de};function bde(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function xde(n){var e,t;n instanceof Qh?(e=n._id,n=n._name):(e=FZ(),(t=vde).time=yk(),n=n==null?null:n+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var s=i[o],l=s.length,u,h=0;h<l;++h)(u=s[h])&&bA(u,n,e,h,s,t||bde(u,e));return new Qh(i,this._parents,n,e)}Pb.prototype.interrupt=Zce;Pb.prototype.transition=xde;function RI(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function Ide(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function Ck(n){let e,t,i;n.length!==2?(e=RI,t=(l,u)=>RI(n(l),u),i=(l,u)=>n(l)-u):(e=n===RI||n===Ide?n:Cde,t=n,i=n);function r(l,u,h=0,d=l.length){if(h<d){if(e(u,u)!==0)return d;do{const m=h+d>>>1;t(l[m],u)<0?h=m+1:d=m}while(h<d)}return h}function o(l,u,h=0,d=l.length){if(h<d){if(e(u,u)!==0)return d;do{const m=h+d>>>1;t(l[m],u)<=0?h=m+1:d=m}while(h<d)}return h}function s(l,u,h=0,d=l.length){const m=r(l,u,h,d-1);return m>h&&i(l[m-1],u)>-i(l[m],u)?m-1:m}return{left:r,center:s,right:o}}function Cde(){return 0}function wde(n){return n===null?NaN:+n}const Ade=Ck(RI),Sde=Ade.right;Ck(wde).center;function Ede(n,e){let t,i;if(e===void 0)for(const r of n)r!=null&&(t===void 0?r>=r&&(t=i=r):(t>r&&(t=r),i<r&&(i=r)));else{let r=-1;for(let o of n)(o=e(o,++r,n))!=null&&(t===void 0?o>=o&&(t=i=o):(t>o&&(t=o),i<o&&(i=o)))}return[t,i]}const Tde=Math.sqrt(50),Rde=Math.sqrt(10),Mde=Math.sqrt(2);function nw(n,e,t){const i=(e-n)/Math.max(0,t),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),s=o>=Tde?10:o>=Rde?5:o>=Mde?2:1;let l,u,h;return r<0?(h=Math.pow(10,-r)/s,l=Math.round(n*h),u=Math.round(e*h),l/h<n&&++l,u/h>e&&--u,h=-h):(h=Math.pow(10,r)*s,l=Math.round(n/h),u=Math.round(e/h),l*h<n&&++l,u*h>e&&--u),u<l&&.5<=t&&t<2?nw(n,e,t*2):[l,u,h]}function kde(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const i=e<n,[r,o,s]=i?nw(e,n,t):nw(n,e,t);if(!(o>=r))return[];const l=o-r+1,u=new Array(l);if(i)if(s<0)for(let h=0;h<l;++h)u[h]=(o-h)/-s;else for(let h=0;h<l;++h)u[h]=(o-h)*s;else if(s<0)for(let h=0;h<l;++h)u[h]=(r+h)/-s;else for(let h=0;h<l;++h)u[h]=(r+h)*s;return u}function XT(n,e,t){return e=+e,n=+n,t=+t,nw(n,e,t)[2]}function Lde(n,e,t){e=+e,n=+n,t=+t;const i=e<n,r=i?XT(e,n,t):XT(n,e,t);return(i?-1:1)*(r<0?1/-r:r)}function Pde(n){return n}var WS=1,zS=2,YT=3,B0=4,g5=1e-6;function Gde(n){return"translate("+n+",0)"}function Fde(n){return"translate(0,"+n+")"}function Ode(n){return e=>+n(e)}function Nde(n,e){return e=Math.max(0,n.bandwidth()-e*2)/2,n.round()&&(e=Math.round(e)),t=>+n(t)+e}function Dde(){return!this.__axis}function OZ(n,e){var t=[],i=null,r=null,o=6,s=6,l=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,h=n===WS||n===B0?-1:1,d=n===B0||n===zS?"x":"y",m=n===WS||n===YT?Gde:Fde;function y(x){var C=i??(e.ticks?e.ticks.apply(e,t):e.domain()),w=r??(e.tickFormat?e.tickFormat.apply(e,t):Pde),E=Math.max(o,0)+l,T=e.range(),k=+T[0]+u,G=+T[T.length-1]+u,O=(e.bandwidth?Nde:Ode)(e.copy(),u),V=x.selection?x.selection():x,z=V.selectAll(".domain").data([null]),H=V.selectAll(".tick").data(C,e).order(),te=H.exit(),$=H.enter().append("g").attr("class","tick"),ae=H.select("line"),fe=H.select("text");z=z.merge(z.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),H=H.merge($),ae=ae.merge($.append("line").attr("stroke","currentColor").attr(d+"2",h*o)),fe=fe.merge($.append("text").attr("fill","currentColor").attr(d,h*E).attr("dy",n===WS?"0em":n===YT?"0.71em":"0.32em")),x!==V&&(z=z.transition(x),H=H.transition(x),ae=ae.transition(x),fe=fe.transition(x),te=te.transition(x).attr("opacity",g5).attr("transform",function(Y){return isFinite(Y=O(Y))?m(Y+u):this.getAttribute("transform")}),$.attr("opacity",g5).attr("transform",function(Y){var de=this.parentNode.__axis;return m((de&&isFinite(de=de(Y))?de:O(Y))+u)})),te.remove(),z.attr("d",n===B0||n===zS?s?"M"+h*s+","+k+"H"+u+"V"+G+"H"+h*s:"M"+u+","+k+"V"+G:s?"M"+k+","+h*s+"V"+u+"H"+G+"V"+h*s:"M"+k+","+u+"H"+G),H.attr("opacity",1).attr("transform",function(Y){return m(O(Y)+u)}),ae.attr(d+"2",h*o),fe.attr(d,h*E).text(w),V.filter(Dde).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",n===zS?"start":n===B0?"end":"middle"),V.each(function(){this.__axis=O})}return y.scale=function(x){return arguments.length?(e=x,y):e},y.ticks=function(){return t=Array.from(arguments),y},y.tickArguments=function(x){return arguments.length?(t=x==null?[]:Array.from(x),y):t.slice()},y.tickValues=function(x){return arguments.length?(i=x==null?null:Array.from(x),y):i&&i.slice()},y.tickFormat=function(x){return arguments.length?(r=x,y):r},y.tickSize=function(x){return arguments.length?(o=s=+x,y):o},y.tickSizeInner=function(x){return arguments.length?(o=+x,y):o},y.tickSizeOuter=function(x){return arguments.length?(s=+x,y):s},y.tickPadding=function(x){return arguments.length?(l=+x,y):l},y.offset=function(x){return arguments.length?(u=+x,y):u},y}function NZ(n){return OZ(YT,n)}function DZ(n){return OZ(B0,n)}function Vde(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function Bde(n){return function(){return n}}function Zde(n){return+n}var m5=[0,1];function $m(n){return n}function HT(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:Bde(isNaN(e)?NaN:.5)}function Wde(n,e){var t;return n>e&&(t=n,n=e,e=t),function(i){return Math.max(n,Math.min(e,i))}}function zde(n,e,t){var i=n[0],r=n[1],o=e[0],s=e[1];return r<i?(i=HT(r,i),o=t(s,o)):(i=HT(i,r),o=t(o,s)),function(l){return o(i(l))}}function Ude(n,e,t){var i=Math.min(n.length,e.length)-1,r=new Array(i),o=new Array(i),s=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++s<i;)r[s]=HT(n[s],n[s+1]),o[s]=t(e[s],e[s+1]);return function(l){var u=Sde(n,l,1,i)-1;return o[u](r[u](l))}}function Xde(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Yde(){var n=m5,e=m5,t=xk,i,r,o,s=$m,l,u,h;function d(){var y=Math.min(n.length,e.length);return s!==$m&&(s=Wde(n[0],n[y-1])),l=y>2?Ude:zde,u=h=null,m}function m(y){return y==null||isNaN(y=+y)?o:(u||(u=l(n.map(i),e,t)))(i(s(y)))}return m.invert=function(y){return s(r((h||(h=l(e,n.map(i),Iu)))(y)))},m.domain=function(y){return arguments.length?(n=Array.from(y,Zde),d()):n.slice()},m.range=function(y){return arguments.length?(e=Array.from(y),d()):e.slice()},m.rangeRound=function(y){return e=Array.from(y),t=che,d()},m.clamp=function(y){return arguments.length?(s=y?!0:$m,d()):s!==$m},m.interpolate=function(y){return arguments.length?(t=y,d()):t},m.unknown=function(y){return arguments.length?(o=y,m):o},function(y,x){return i=y,r=x,d()}}function Hde(){return Yde()($m,$m)}function Kde(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function iw(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,i=n.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+n.slice(t+1)]}function Oy(n){return n=iw(Math.abs(n)),n?n[1]:NaN}function jde(n,e){return function(t,i){for(var r=t.length,o=[],s=0,l=n[0],u=0;r>0&&l>0&&(u+l+1>i&&(l=Math.max(1,i-u)),o.push(t.substring(r-=l,r+l)),!((u+=l+1)>i));)l=n[s=(s+1)%n.length];return o.reverse().join(e)}}function $de(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var Jde=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function rw(n){if(!(e=Jde.exec(n)))throw new Error("invalid format: "+n);var e;return new wk({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}rw.prototype=wk.prototype;function wk(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}wk.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function qde(n){e:for(var e=n.length,t=1,i=-1,r;t<e;++t)switch(n[t]){case".":i=r=t;break;case"0":i===0&&(i=t),r=t;break;default:if(!+n[t])break e;i>0&&(i=0);break}return i>0?n.slice(0,i)+n.slice(r+1):n}var VZ;function Qde(n,e){var t=iw(n,e);if(!t)return n+"";var i=t[0],r=t[1],o=r-(VZ=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+iw(n,Math.max(0,e+o-1))[0]}function y5(n,e){var t=iw(n,e);if(!t)return n+"";var i=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const _5={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:Kde,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>y5(n*100,e),r:y5,s:Qde,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function v5(n){return n}var b5=Array.prototype.map,x5=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function efe(n){var e=n.grouping===void 0||n.thousands===void 0?v5:jde(b5.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",i=n.currency===void 0?"":n.currency[1]+"",r=n.decimal===void 0?".":n.decimal+"",o=n.numerals===void 0?v5:$de(b5.call(n.numerals,String)),s=n.percent===void 0?"%":n.percent+"",l=n.minus===void 0?"":n.minus+"",u=n.nan===void 0?"NaN":n.nan+"";function h(m){m=rw(m);var y=m.fill,x=m.align,C=m.sign,w=m.symbol,E=m.zero,T=m.width,k=m.comma,G=m.precision,O=m.trim,V=m.type;V==="n"?(k=!0,V="g"):_5[V]||(G===void 0&&(G=12),O=!0,V="g"),(E||y==="0"&&x==="=")&&(E=!0,y="0",x="=");var z=w==="$"?t:w==="#"&&/[boxX]/.test(V)?"0"+V.toLowerCase():"",H=w==="$"?i:/[%p]/.test(V)?s:"",te=_5[V],$=/[defgprs%]/.test(V);G=G===void 0?6:/[gprs]/.test(V)?Math.max(1,Math.min(21,G)):Math.max(0,Math.min(20,G));function ae(fe){var Y=z,de=H,D,oe,ue;if(V==="c")de=te(fe)+de,fe="";else{fe=+fe;var ge=fe<0||1/fe<0;if(fe=isNaN(fe)?u:te(Math.abs(fe),G),O&&(fe=qde(fe)),ge&&+fe==0&&C!=="+"&&(ge=!1),Y=(ge?C==="("?C:l:C==="-"||C==="("?"":C)+Y,de=(V==="s"?x5[8+VZ/3]:"")+de+(ge&&C==="("?")":""),$){for(D=-1,oe=fe.length;++D<oe;)if(ue=fe.charCodeAt(D),48>ue||ue>57){de=(ue===46?r+fe.slice(D+1):fe.slice(D))+de,fe=fe.slice(0,D);break}}}k&&!E&&(fe=e(fe,1/0));var Ne=Y.length+fe.length+de.length,Ee=Ne<T?new Array(T-Ne+1).join(y):"";switch(k&&E&&(fe=e(Ee+fe,Ee.length?T-de.length:1/0),Ee=""),x){case"<":fe=Y+fe+de+Ee;break;case"=":fe=Y+Ee+fe+de;break;case"^":fe=Ee.slice(0,Ne=Ee.length>>1)+Y+fe+de+Ee.slice(Ne);break;default:fe=Ee+Y+fe+de;break}return o(fe)}return ae.toString=function(){return m+""},ae}function d(m,y){var x=h((m=rw(m),m.type="f",m)),C=Math.max(-8,Math.min(8,Math.floor(Oy(y)/3)))*3,w=Math.pow(10,-C),E=x5[8+C/3];return function(T){return x(w*T)+E}}return{format:h,formatPrefix:d}}var zx,BZ,ZZ;tfe({thousands:",",grouping:[3],currency:["$",""]});function tfe(n){return zx=efe(n),BZ=zx.format,ZZ=zx.formatPrefix,zx}function nfe(n){return Math.max(0,-Oy(Math.abs(n)))}function ife(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Oy(e)/3)))*3-Oy(Math.abs(n)))}function rfe(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,Oy(e)-Oy(n))+1}function sfe(n,e,t,i){var r=Lde(n,e,t),o;switch(i=rw(i??",f"),i.type){case"s":{var s=Math.max(Math.abs(n),Math.abs(e));return i.precision==null&&!isNaN(o=ife(r,s))&&(i.precision=o),ZZ(i,s)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=rfe(r,Math.max(Math.abs(n),Math.abs(e))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=nfe(r))&&(i.precision=o-(i.type==="%")*2);break}}return BZ(i)}function ofe(n){var e=n.domain;return n.ticks=function(t){var i=e();return kde(i[0],i[i.length-1],t??10)},n.tickFormat=function(t,i){var r=e();return sfe(r[0],r[r.length-1],t??10,i)},n.nice=function(t){t==null&&(t=10);var i=e(),r=0,o=i.length-1,s=i[r],l=i[o],u,h,d=10;for(l<s&&(h=s,s=l,l=h,h=r,r=o,o=h);d-- >0;){if(h=XT(s,l,t),h===u)return i[r]=s,i[o]=l,e(i);if(h>0)s=Math.floor(s/h)*h,l=Math.ceil(l/h)*h;else if(h<0)s=Math.ceil(s*h)/h,l=Math.floor(l*h)/h;else break;u=h}return n},n}function Ak(){var n=Hde();return n.copy=function(){return Xde(n,Ak())},Vde.apply(n,arguments),ofe(n)}function Io(n){return function(){return n}}const KT=Math.PI,jT=2*KT,Sp=1e-6,afe=jT-Sp;function WZ(n){this._+=n[0];for(let e=1,t=n.length;e<t;++e)this._+=arguments[e]+n[e]}function lfe(n){let e=Math.floor(n);if(!(e>=0))throw new Error(`invalid digits: ${n}`);if(e>15)return WZ;const t=10**e;return function(i){this._+=i[0];for(let r=1,o=i.length;r<o;++r)this._+=Math.round(arguments[r]*t)/t+i[r]}}class ufe{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?WZ:lfe(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,i,r){this._append`Q${+e},${+t},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(e,t,i,r,o,s){this._append`C${+e},${+t},${+i},${+r},${this._x1=+o},${this._y1=+s}`}arcTo(e,t,i,r,o){if(e=+e,t=+t,i=+i,r=+r,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,l=this._y1,u=i-e,h=r-t,d=s-e,m=l-t,y=d*d+m*m;if(this._x1===null)this._append`M${this._x1=e},${this._y1=t}`;else if(y>Sp)if(!(Math.abs(m*u-h*d)>Sp)||!o)this._append`L${this._x1=e},${this._y1=t}`;else{let x=i-s,C=r-l,w=u*u+h*h,E=x*x+C*C,T=Math.sqrt(w),k=Math.sqrt(y),G=o*Math.tan((KT-Math.acos((w+y-E)/(2*T*k)))/2),O=G/k,V=G/T;Math.abs(O-1)>Sp&&this._append`L${e+O*d},${t+O*m}`,this._append`A${o},${o},0,0,${+(m*x>d*C)},${this._x1=e+V*u},${this._y1=t+V*h}`}}arc(e,t,i,r,o,s){if(e=+e,t=+t,i=+i,s=!!s,i<0)throw new Error(`negative radius: ${i}`);let l=i*Math.cos(r),u=i*Math.sin(r),h=e+l,d=t+u,m=1^s,y=s?r-o:o-r;this._x1===null?this._append`M${h},${d}`:(Math.abs(this._x1-h)>Sp||Math.abs(this._y1-d)>Sp)&&this._append`L${h},${d}`,i&&(y<0&&(y=y%jT+jT),y>afe?this._append`A${i},${i},0,1,${m},${e-l},${t-u}A${i},${i},0,1,${m},${this._x1=h},${this._y1=d}`:y>Sp&&this._append`A${i},${i},0,${+(y>=KT)},${m},${this._x1=e+i*Math.cos(o)},${this._y1=t+i*Math.sin(o)}`)}rect(e,t,i,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function zZ(n){let e=3;return n.digits=function(t){if(!arguments.length)return e;if(t==null)e=null;else{const i=Math.floor(t);if(!(i>=0))throw new RangeError(`invalid digits: ${t}`);e=i}return n},()=>new ufe(e)}function UZ(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function XZ(n){this._context=n}XZ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,e){switch(n=+n,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,e):this._context.moveTo(n,e);break;case 1:this._point=2;default:this._context.lineTo(n,e);break}}};function YZ(n){return new XZ(n)}function HZ(n){return n[0]}function KZ(n){return n[1]}function jZ(n,e){var t=Io(!0),i=null,r=YZ,o=null,s=zZ(l);n=typeof n=="function"?n:n===void 0?HZ:Io(n),e=typeof e=="function"?e:e===void 0?KZ:Io(e);function l(u){var h,d=(u=UZ(u)).length,m,y=!1,x;for(i==null&&(o=r(x=s())),h=0;h<=d;++h)!(h<d&&t(m=u[h],h,u))===y&&((y=!y)?o.lineStart():o.lineEnd()),y&&o.point(+n(m,h,u),+e(m,h,u));if(x)return o=null,x+""||null}return l.x=function(u){return arguments.length?(n=typeof u=="function"?u:Io(+u),l):n},l.y=function(u){return arguments.length?(e=typeof u=="function"?u:Io(+u),l):e},l.defined=function(u){return arguments.length?(t=typeof u=="function"?u:Io(!!u),l):t},l.curve=function(u){return arguments.length?(r=u,i!=null&&(o=r(i)),l):r},l.context=function(u){return arguments.length?(u==null?i=o=null:o=r(i=u),l):i},l}function cfe(n,e,t){var i=null,r=Io(!0),o=null,s=YZ,l=null,u=zZ(h);n=typeof n=="function"?n:n===void 0?HZ:Io(+n),e=typeof e=="function"?e:Io(e===void 0?0:+e),t=typeof t=="function"?t:t===void 0?KZ:Io(+t);function h(m){var y,x,C,w=(m=UZ(m)).length,E,T=!1,k,G=new Array(w),O=new Array(w);for(o==null&&(l=s(k=u())),y=0;y<=w;++y){if(!(y<w&&r(E=m[y],y,m))===T)if(T=!T)x=y,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),C=y-1;C>=x;--C)l.point(G[C],O[C]);l.lineEnd(),l.areaEnd()}T&&(G[y]=+n(E,y,m),O[y]=+e(E,y,m),l.point(i?+i(E,y,m):G[y],t?+t(E,y,m):O[y]))}if(k)return l=null,k+""||null}function d(){return jZ().defined(r).curve(s).context(o)}return h.x=function(m){return arguments.length?(n=typeof m=="function"?m:Io(+m),i=null,h):n},h.x0=function(m){return arguments.length?(n=typeof m=="function"?m:Io(+m),h):n},h.x1=function(m){return arguments.length?(i=m==null?null:typeof m=="function"?m:Io(+m),h):i},h.y=function(m){return arguments.length?(e=typeof m=="function"?m:Io(+m),t=null,h):e},h.y0=function(m){return arguments.length?(e=typeof m=="function"?m:Io(+m),h):e},h.y1=function(m){return arguments.length?(t=m==null?null:typeof m=="function"?m:Io(+m),h):t},h.lineX0=h.lineY0=function(){return d().x(n).y(e)},h.lineY1=function(){return d().x(n).y(t)},h.lineX1=function(){return d().x(i).y(e)},h.defined=function(m){return arguments.length?(r=typeof m=="function"?m:Io(!!m),h):r},h.curve=function(m){return arguments.length?(s=m,o!=null&&(l=s(o)),h):s},h.context=function(m){return arguments.length?(m==null?o=l=null:l=s(o=m),h):o},h}const hl={bisector:Ck,extent:Ede,axisBottom:NZ,axisLeft:DZ,scaleLinear:Ak,pointer:bu,select:sa,selectAll:Mce,area:cfe,line:jZ};function hfe(n){const e=n.light!==void 0?n.light:!1,t=e?{top:0,right:0,bottom:0,left:0}:{top:10,right:20,bottom:30,left:40},i=n.hoverCallback!==void 0?n.hoverCallback:()=>{},r=n.outCallback!==void 0?n.outCallback:()=>{},o=n.distanceExtractor,s=n.linesConfiguration,l=Object.keys(s).length,u=hl.bisector(ae=>o(ae)).left,h=n.poiExtractor,d=n.styleDefs,m=n.poiLabelAngle!==void 0?n.poiLabelAngle:-60,y=ae=>String(ae),x={xhover:y,yhover:y,xtick:y,ytick:y,xlabel:()=>"Distance",ylabel:()=>"Elevation",...n.formatter},C=n.lightXAxis!==void 0?n.lightXAxis:!1;let w,E,T;const k=n.scaleModifier;let G,O,V,z,H;const te=ae=>{ae.each(function(fe){if(hl.select(this).selectAll("svg").remove(),fe===void 0)return;V=Math.max(this.clientWidth-t.right-t.left,0),E=hl.scaleLinear().range([0,V]),O=Math.max(this.clientHeight-t.top-t.bottom,0),T=hl.scaleLinear().range([O,0]);const Y=hl.axisBottom(E),de=hl.axisLeft(T),D=l===1?hl.area().x(j=>E(o(j))).y0(O).y1(j=>{const ze=Object.keys(s)[0];return T(s[ze].zExtractor(j))}):void 0;w=hl.select(this).selectAll("svg").data([fe]);const oe=w.enter().append("svg");w=hl.select(this).selectAll("svg").data([fe]),d!==void 0&&oe.append("defs").append("style").attr("type","text/css").text(d);const ue=oe.append("g");$(),ue.style("font","11px Arial"),l===1&&ue.append("path").attr("class","area").style("fill","rgba(222, 222, 222, 0.5)"),ue.insert("g",":first-child").attr("class","grid-y"),e||(ue.append("g").attr("class","x axis").attr("transform",`translate(0,${O})`),ue.append("text").attr("class","x label").attr("text-anchor","end").attr("x",V-4).attr("y",O-4),ue.append("g").attr("class","y axis"),ue.append("text").attr("class","y label").attr("text-anchor","end").attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").style("fill","grey").text(x.ylabel()),ue.append("g").attr("class","metas").attr("transform",`translate(${V+3}, 0)`)),ue.append("g").attr("class","pois");const ge=ue.append("g").attr("class","x grid-hover");ge.append("svg:line").attr("stroke-dasharray","5,5"),ge.append("text"),ue.append("rect").attr("class","overlay").attr("width",V).attr("height",O).style("fill","none").style("pointer-events","all"),w.attr("width",V+t.left+t.right).attr("height",O+t.top+t.bottom),G=w.select("g").attr("transform",`translate(${t.left},${t.top})`),H=hl.extent(fe,j=>o(j)),E.domain(H);const Ne=(()=>{let j=[];for(const ze in s){const je=hl.extent(fe,qe=>s[ze].zExtractor(qe));je.every(Number.isFinite)&&(j=j.concat(je))}return[Math.min.apply(null,j),Math.max.apply(null,j)]})();if(T.domain(Ne),k!==void 0)k(E,T,V,O);else{const j=(Ne[1]-Ne[0])*.1;T.domain([Ne[0]-j,Ne[1]+j])}l===1&&G.select(".area").transition().attr("d",D);let Ee,se,q;for(se in s)ue.append("path").attr("class",`line ${se}`).style("stroke",s[se].color||"#F00").style("fill","none"),q=ue.append("g").attr("class",`y grid-hover ${se}`),q.append("svg:line").attr("stroke-dasharray","5,5"),q.append("text"),Ee=hl.line().x(j=>E(o(j))).y(j=>T(s[se].zExtractor(j))).defined(j=>s[se].zExtractor(j)!==null),G.select(`.line.${se}`).transition().attr("d",Ee);H[1]>2e3?z=1e3:z=1,e||(Y.tickFormat(j=>x.xtick(j/z)),C&&Y.tickValues([0,E.domain()[1]]),de.tickFormat(j=>x.ytick(j)),G.select(".x.axis").transition().call(Y),G.select(".x.label").text(x.xlabel(z)).style("fill","grey").style("shape-rendering","crispEdges"),O/15<10&&de.ticks(O/15),G.select(".y.axis").transition().call(de)),G.select(".grid-y").transition().call(de.tickSize(-V).tickFormat(()=>"")).selectAll(".tick line").style("stroke","#ccc").style("opacity",.7),G.selectAll(".axis").selectAll("path, line").style("fill","none").style("stroke","#000").style("shape-rendering","crispEdges"),G.select(".grid-y").select("path").style("stroke","none"),G.selectAll(".grid-hover line").style("stroke","#222").style("opacity",.8),G.select(".overlay").on("mouseout",()=>te.clearHighlight()).on("mousemove",j=>{const[ze]=hl.pointer(j),je=E.invert(ze);te.highlight(je)})})};te.clearHighlight=()=>{G.selectAll(".grid-hover").style("display","none"),r.call(null)},te.highlight=ae=>{const fe=w.datum(),Y=u(fe,ae);if(Y>=fe.length)return;const de=fe[Y],D=o(de);let oe;const ue=[],ge={};let Ne;for(Ne in s)oe=s[Ne].zExtractor(de),Number.isFinite(oe)?(ue.push(oe),ge[Ne]=oe,G.select(`.y.grid-hover.${Ne}`).style("display","inline").select("line").attr("x1",E(0)).attr("y1",T(oe)).attr("x2",V).attr("y2",T(oe))):G.select(`.y.grid-hover.${Ne}`).style("display","none");const Ee=T(Math.max.apply(null,ue));G.select(".x.grid-hover").style("display","inline").select("line").attr("x1",E(D)).attr("y1",O).attr("x2",E(D)).attr("y2",Number.isFinite(Ee)?Ee:0);const se=D>H[1]/2;let q=E(D);if(q+=se?-10:10,G.select(".x.grid-hover text").text(x.xhover(D)).style("text-anchor",se?"end":"start").attr("transform",`translate(${q},${O-10})`),l===1){const j=ue[0]===null?"no value":x.yhover(ue[0]);G.select(".y.grid-hover text").text(j).style("text-anchor",se?"end":"start").attr("transform",`translate(${q},${T(ue[0])-10})`)}i.call(null,de,D,ge)},te.showPois=ae=>{ae=ae!==void 0?ae:[];const fe=h,Y=w.select("g"),de=w.datum(),ue=Y.select(".pois").selectAll(".poi").data(ae,ge=>{const Ne=u(de,fe?Math.round(fe.dist(ge)*10)/10:void 0,1),Ee=de[Ne];if(Ee){let se;const q=[];for(se in s)q.push(s[se].zExtractor(Ee));const j=Math.max.apply(null,q);fe?.z(ge,j)}return fe?.id(ge)}).enter().append("g").attr("class","poi");ue.append("text").attr("x",e?0:9).attr("dy",".35em").attr("text-anchor",e?"middle":"start"),ue.append("line").style("shape-rendering","crispEdges"),ue.style("opacity",0).transition().duration(1e3).delay(100).style("opacity",1),ue.selectAll("text").attr("transform",ge=>e?[`translate(${E(fe.dist(ge))},${T(fe.z(ge))-10})`]:[`translate(${E(fe.dist(ge))},${T(fe.z(ge))-20}) rotate(${m})`]).text(ge=>fe.sort(ge)+(e?"":` - ${fe.title(ge)}`)),ue.selectAll("line").style("stroke","grey").attr("x1",ge=>E(fe.dist(ge))).attr("y1",()=>T(T.domain()[0])).attr("x2",ge=>E(fe.dist(ge))).attr("y2",ge=>T(fe.z(ge))),ue.exit().remove()};function $(){te.showPois([])}return te}const dfe=at({__name:"d3-graph-elevation",props:{showTooltip:{type:Boolean,default:!0},dataset:{},highlightDistance:{},labelXFormatter:{},labelYFormatter:{},xFormatter:{},yFormatter:{}},emits:["hover:profile","out:profile"],setup(n,{emit:e}){const t=e,i=n,r=Ue();let o,s,l=(d,m,y)=>t("hover:profile",d,m,y);sr(()=>{s=sa(r.value),o=hfe(h()),u()}),Pt(()=>i.highlightDistance,d=>{d&&d>0?o.highlight(d):o.clearHighlight()}),mn(window,"resize",py(u,50));function u(){o!==void 0&&s.datum(i.dataset).call(o)}function h(){return{linesConfiguration:{line1:{zExtractor:d=>parseFloat(d?.values?.dhm?.toPrecision(5))||0}},distanceExtractor:d=>d.dist??0,hoverCallback:l,outCallback:()=>t("out:profile"),formatter:{xhover:i.xFormatter,yhover:i.yFormatter,xlabel:i.labelXFormatter,ylabel:i.labelYFormatter}}}return(d,m)=>(U(),ie("div",{class:"h-[250px]",ref_key:"graphElement",ref:r},null,512))}}),ffe={key:1,class:"text-center"},$Z=at({__name:"elevation-profile",props:{profileData:{},highlightDistance:{}},setup(n){const{t:e}=St();return(t,i)=>n.profileData?(U(),Gt(dfe,{key:0,dataset:n.profileData,highlightDistance:n.highlightDistance,labelXFormatter:r=>`${M(e)("Distance")} [${r===1?"m":"km"}]`,labelYFormatter:()=>`${M(e)("Elevation")} [m]`,xFormatter:r=>M(af)(r,2),yFormatter:r=>M(RM)(r,1)},null,8,["dataset","highlightDistance","labelXFormatter","labelYFormatter","xFormatter","yFormatter"])):(U(),ie("div",ffe,[...i[0]||(i[0]=[P("img",{class:"inline-block min-h-64 p-1",src:Jle,alt:""},null,-1)])]))}}),Nm=new Map;function pfe(){Nm.clear()}class gfe{styleSerialToStyle(e){return e?JSON.parse(decodeURIComponent(e))||[]:[]}styleLocalStorageToStyle(e){return e?JSON.parse(e).medium||[]:[]}styleToSerial(e){return e&&e.length>0?JSON.stringify(e):""}styleToLocalStorage(e){return e&&e.length>0?JSON.stringify({medium:e}):""}}const Ux=new gfe;var gl=(n=>(n[n.simpleStyle=0]="simpleStyle",n[n.mediumStyle=1]="mediumStyle",n[n.advancedStyle=2]="advancedStyle",n))(gl||{});const mfe=["line","fill","symbol","fill-extrusion","background","hillshade"],yfe="https://vectortiles-staging.geoportail.lu",_fe="https://migration.geoportail.lu/getvtstyle",vfe="https://migration.geoportail.lu/uploadvtstyle",bfe="https://migration.geoportail.lu/deletevtstyle";class xfe{_vectortilesUrl=yfe;_mvtStylesGetUrl=_fe;_mvtStylesUploadUrl=vfe;_mvtStylesDeleteUrl=bfe;get vectortilesUrl(){return this._vectortilesUrl===void 0&&console.warn("Warning: vectortilesUrl is not set."),this._vectortilesUrl}get mvtStylesGetUrl(){return this._mvtStylesGetUrl===void 0&&console.warn("Warning: mvtStylesGetUrl is not set."),this._mvtStylesGetUrl}get mvtStylesUploadUrl(){return this._mvtStylesUploadUrl===void 0&&console.warn("Warning: mvtStylesUploadUrl is not set."),this._mvtStylesUploadUrl}get mvtStylesDeleteUrl(){return this._mvtStylesDeleteUrl===void 0&&console.warn("Warning: mvtStylesDeleteUrl is not set."),this._mvtStylesDeleteUrl}setRegisterUrl_v3(e){e.get&&(this._mvtStylesGetUrl=e.get),e.upload&&(this._mvtStylesUploadUrl=e.upload),e.delete&&(this._mvtStylesDeleteUrl=e.delete),e.vectortiles&&(this._vectortilesUrl=e.vectortiles),console.warn("Deprecated: StylesUrlHelper.setRegisterUrl_v3() is meant to be removed when v4 is fully operational")}}const Z0=new xfe;function Mf(){function n(w){const E=Ql.getItem(DB),T=Ql.getItem(VB)||"http";return(E?`${T}://${E}`:Z0.vectortilesUrl)+`/styles/${w}/style.json`}function e(w){return`${Z0.vectortilesUrl}/styles/${w}/{z}/{x}/{y}.png`}function t(w,E){const T=Mu();if(w==null)return;const k=new Map;T.bgVectorSources.forEach((G,O)=>{if(O===w.id){const V={...G,xyz_custom:E};k.set(O,V)}else k.set(O,G)}),T.setBgVectorSources(k)}function i(w,E,T=!1){const G=n(E),O=e(E),V={label:w,defaultMapBoxStyle:G,defaultMapBoxStyleXYZ:O,xyz:O,xyz_custom:"",style:G};if(!Ql.getItem(qv)){if(!T)return Promise.resolve(V)}return Promise.resolve(V)}function r(w){const E=Zh().medium_default_styles.road;if(w){w.colors.forEach((k,G)=>{E[G].color=k});const T=E.findIndex(k=>k.label==="Hillshade");E[T].visible=w.hillshade}return E}function o(w,E,T){if(!w||!E.get(w.id))return;const k=JSON.parse(JSON.stringify(E.get(w.id)));if(k&&!(!k||!k.layers))return T&&T.forEach(G=>{k?.layers.forEach((O,V)=>{for(const z of mfe)if((G[`${z}s`]||[]).includes(O.id)){const te=Object.assign({},k.layers[V].paint);G.color&&(te[`${z}-color`]=G.color,te[`${z}-opacity`]=1,k.layers[V].paint=te),k.layers[V].layout=Object.assign({},k.layers[V].layout,{visibility:G.visible?"visible":"none"})}})}),k}function s(w){return w?fetch(`${Z0.mvtStylesDeleteUrl}?id=${w}`).catch(console.warn):Promise.resolve()}async function l(w,E){await s(E);const T=new FormData,k=JSON.stringify(w),G=new Blob([k],{type:"application/json"});T.append("style",G,"style.json");const O={method:"POST",body:T};return fetch(Z0.mvtStylesUploadUrl,O).then(V=>V.json()).then(V=>V.id).catch(console.warn)}function u(w,E){if(!E)return;const T=w.maplibreMap;T&&(T.loaded()?T.setStyle(E):new Promise(k=>T.once("data",k)).then(()=>T.setStyle(E)))}function h(w){return Zh().bg_layers.find(E=>E.id==w?.id)}function d(w){return h(w)?.vector_id}function m(w){return h(w)?.vector_id!==void 0}function y(w){const E=h(w),T=[...E?.simple_style_class?[gl.simpleStyle]:[],...E?.medium_style_class?[gl.mediumStyle]:[],...E?.expert_style_class?[gl.advancedStyle]:[]];return{isEditable:E?.vector_id!==void 0,styleEditors:T}}function x(w,E){return E.map(T=>Object.assign(T,{selected:T.colors.every((k,G)=>w[G]?.color===k)}))}function C(){const w=[],E=Mu();Zh().bg_layers.forEach(T=>{if(T.vector_id){const k=i(T.icon_id,T.vector_id);w.push(k.then(G=>({id:T.id,config:G})))}}),Promise.all(w).then(T=>{const k=new Map;T.forEach(G=>k.set(G.id,G.config)),E.setBgVectorSources(k)})}return{getDefaultMapBoxStyleUrl:n,getDefaultMapBoxStyleXYZ:e,setConfigForLayer:i,getRoadStyleFromSimpleStyle:r,applyDefaultStyle:o,applyConsolidatedStyle:u,getVectorId:d,setCustomStyleSerial:t,unregisterStyle:s,registerStyle:l,checkSelection:x,isLayerStyleEditable:m,getStyleCapabilitiesFromLayer:y,initBackgroundsConfigs:C}}const Mu=ca("style",()=>{const n=Mf(),e=mi(),t=mi(new Map),i=mi(new Map),r=mi(!1),o=mi(null),s=mi();function l(C){t.value=C}function u(C){const w=new Map;i.value.forEach((E,T)=>{T!==C&&w.set(T,E)}),i.value=w}function h(C,w){const E=new Map;i.value.forEach((T,k)=>E.set(k,T)),E.set(C,w),i.value=E}function d(C){e.value=n.getRoadStyleFromSimpleStyle(C),y()}function m(C){e.value=C,y()}function y(){r.value=!1}function x(){r.value=!0}return{bgStyle:e,bgVectorSources:t,bgVectorBaseStyles:i,isExpertStyleActive:r,appliedStyle:s,removeBaseStyle:u,setBaseStyle:h,setBgVectorSources:l,setSimpleStyle:d,setStyle:m,disableExpertStyle:y,enableExpertStyle:x,styleSerial:o}},{});class Ife{styleWatcher;bootstrap(){const e=Mu();let t,i=!1;t=Rs(()=>{e.bgVectorSources&&(this.restore(!1),i&&this.persist(),i=!0,t&&t())})}persist(){const e=Mu(),{bgStyle:t}=It(e);this.styleWatcher||(this.styleWatcher=Pt(t,(i,r)=>{if(r!==i){const o=Ui();o.bgLayer&&e.bgVectorSources.has(o.bgLayer.id)&&(i&&i.length?Dn.setValue(o.bgLayer.name,i||[],Ux.styleToLocalStorage):Dn.removeItem(o.bgLayer.name),Dn.setValue(qv,i||[],Ux.styleToSerial))}},{immediate:!0}))}restore(e){const t=Mu();t.setStyle(null);const r=Ui().bgLayer;if(r){let o=[];e||(o=Dn.getValue(qv,Ux.styleSerialToStyle)),o.length===0&&(o=Dn.getValue(r.name,Ux.styleLocalStorageToStyle)),o&&o.length>0&&t.setStyle(o)}}}const JZ=new Ife;var Dp=(n=>(n.LAYER_OFFLINE_TILE="tile",n.LAYER_OFFLINE_VECTOR="vector",n.LAYER_OFFLINE_BG_VECTOR="bg_vector",n.LAYER_OFFLINE_BG_WMTS="off_bg_wmts",n))(Dp||{});const $T="id",JT="label",qZ="layer_name",sw="metadata",Cfe="queryable_id",wfe="current_time",Afe="time",Sfe="defaultMapBoxStyle";class Efe extends WM{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,r=e.viewState,o=r.resolution,s=this.getLayer().getSource(),l=e.viewHints;let u=e.extent;if(t.extent!==void 0&&(u=Ec(u,Xl(t.extent,r.projection))),!l[Jr.ANIMATING]&&!l[Jr.INTERACTING]&&!dg(u))if(s){const h=r.projection,d=s.getImage(u,o,i,h);d&&(this.loadImage(d)?this.image=d:d.getState()===Sn.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),r=Vs(t.pixelToCoordinateTransform,e.slice()),o=i.getExtent();if(o&&!Pc(o,r))return null;const s=this.image.getExtent(),l=this.image.getImage(),u=Bi(s),h=Math.floor(l.width*((r[0]-s[0])/u));if(h<0||h>=l.width)return null;const d=Ws(s),m=Math.floor(l.height*((s[3]-r[1])/d));return m<0||m>=l.height?null:this.getImageData(l,h,m)}renderFrame(e,t){const i=this.image,r=i.getExtent(),o=i.getResolution(),[s,l]=Array.isArray(o)?o:[o,o],u=i.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],d=e.pixelRatio,m=e.viewState,y=m.center,x=m.resolution,C=d*s/(x*u),w=d*l/(x*u);this.prepareContainer(e,t);const E=this.context.canvas.width,T=this.context.canvas.height,k=this.getRenderContext(e);let G=!1,O=!0;if(h.extent){const $=Xl(h.extent,m.projection);O=Zs($,e.extent),G=O&&!vc($,e.extent),G&&this.clipUnrotated(k,e,$)}const V=i.getImage(),z=Fu(this.tempTransform,E/2,T/2,C,w,0,u*(r[0]-y[0])/s,u*(y[1]-r[3])/l);this.renderedResolution=l*d/u;const H=V.width*z[0],te=V.height*z[3];if(this.getLayer().getSource().getInterpolate()||(k.imageSmoothingEnabled=!1),this.preRender(k,e),O&&H>=.5&&te>=.5){const $=z[4],ae=z[5],fe=h.opacity;fe!==1&&(k.save(),k.globalAlpha=fe),k.drawImage(V,0,0,+V.width,+V.height,$,ae,H,te),fe!==1&&k.restore()}return this.postRender(this.context,e),G&&k.restore(),k.imageSmoothingEnabled=!0,this.container}}class Tfe extends pg{constructor(e){e=e||{},super(e)}}class uv extends Tfe{constructor(e){super(e)}createRenderer(){return new Efe(this)}getData(e){return super.getData(e)}}let US;const yy=[];function I5(n,e,t,i,r){n.beginPath(),n.moveTo(0,0),n.lineTo(e,t),n.lineTo(i,r),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(e,i)+1,Math.max(t,r)),n.restore()}function XS(n,e){return Math.abs(n[e*4]-210)>2||Math.abs(n[e*4+3]-.75*255)>2}function Rfe(){if(US===void 0){const n=ro(6,6,yy);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",I5(n,4,5,4,0),I5(n,4,5,0,5);const e=n.getImageData(0,0,3,3).data;US=XS(e,0)||XS(e,4)||XS(e,8),Qw(n),yy.push(n.canvas)}return US}function rb(n,e,t,i){const r=Ir(t,e,n);let o=Lv(e,i,t);const s=e.getMetersPerUnit();s!==void 0&&(o*=s);const l=n.getMetersPerUnit();l!==void 0&&(o/=l);const u=n.getExtent();if(!u||Pc(u,r)){const h=Lv(n,o,r)/o;isFinite(h)&&h>0&&(o/=h)}return o}function Mfe(n,e,t,i){const r=Gu(t);let o=rb(n,e,r,i);return(!isFinite(o)||o<=0)&&ZR(t,function(s){return o=rb(n,e,s,i),isFinite(o)&&o>0}),o}function QZ(n,e,t,i,r,o,s,l,u,h,d,m,y,x){const C=ro(Math.round(t*n),Math.round(t*e),yy);if(m||(C.imageSmoothingEnabled=!1),u.length===0)return C.canvas;C.scale(t,t);function w(V){return Math.round(V*t)/t}C.globalCompositeOperation="lighter";const E=el();u.forEach(function(V,z,H){Sy(E,V.extent)});let T;const k=t/i,G=(m?1:1+Math.pow(2,-24))/k;(!y||u.length!==1||h!==0)&&(T=ro(Math.round(Bi(E)*k),Math.round(Ws(E)*k),yy),m||(T.imageSmoothingEnabled=!1),u.forEach(function(V,z,H){if(V.image.width>0&&V.image.height>0){if(V.clipExtent){T.save();const Y=(V.clipExtent[0]-E[0])*k,de=-(V.clipExtent[3]-E[3])*k,D=Bi(V.clipExtent)*k,oe=Ws(V.clipExtent)*k;T.rect(m?Y:Math.round(Y),m?de:Math.round(de),m?D:Math.round(Y+D)-Math.round(Y),m?oe:Math.round(de+oe)-Math.round(de)),T.clip()}const te=(V.extent[0]-E[0])*k,$=-(V.extent[3]-E[3])*k,ae=Bi(V.extent)*k,fe=Ws(V.extent)*k;T.drawImage(V.image,h,h,V.image.width-2*h,V.image.height-2*h,m?te:Math.round(te),m?$:Math.round($),m?ae:Math.round(te+ae)-Math.round(te),m?fe:Math.round($+fe)-Math.round($)),V.clipExtent&&T.restore()}}));const O=nd(s);return l.getTriangles().forEach(function(V,z,H){const te=V.source,$=V.target;let ae=te[0][0],fe=te[0][1],Y=te[1][0],de=te[1][1],D=te[2][0],oe=te[2][1];const ue=w(($[0][0]-O[0])/o),ge=w(-($[0][1]-O[1])/o),Ne=w(($[1][0]-O[0])/o),Ee=w(-($[1][1]-O[1])/o),se=w(($[2][0]-O[0])/o),q=w(-($[2][1]-O[1])/o),j=ae,ze=fe;ae=0,fe=0,Y-=j,de-=ze,D-=j,oe-=ze;const je=[[Y,de,0,0,Ne-ue],[D,oe,0,0,se-ue],[0,0,Y,de,Ee-ge],[0,0,D,oe,q-ge]],qe=cY(je);if(!qe)return;if(C.save(),C.beginPath(),Rfe()||!m){C.moveTo(Ne,Ee);const xt=4,Et=ue-Ne,kt=ge-Ee;for(let hn=0;hn<xt;hn++)C.lineTo(Ne+w((hn+1)*Et/xt),Ee+w(hn*kt/(xt-1))),hn!=xt-1&&C.lineTo(Ne+w((hn+1)*Et/xt),Ee+w((hn+1)*kt/(xt-1)));C.lineTo(se,q)}else C.moveTo(Ne,Ee),C.lineTo(ue,ge),C.lineTo(se,q);C.clip(),C.transform(qe[0],qe[2],qe[1],qe[3],ue,ge),C.translate(E[0]-j,E[3]-ze);let yt;if(T)yt=T.canvas,C.scale(G,-G);else{const xt=u[0],Et=xt.extent;yt=xt.image,C.scale(Bi(Et)/yt.width,-Ws(Et)/yt.height)}C.drawImage(yt,0,0),C.restore()}),T&&(Qw(T),yy.push(T.canvas)),d&&(C.save(),C.globalCompositeOperation="source-over",C.strokeStyle="black",C.lineWidth=1,l.getTriangles().forEach(function(V,z,H){const te=V.target,$=(te[0][0]-O[0])/o,ae=-(te[0][1]-O[1])/o,fe=(te[1][0]-O[0])/o,Y=-(te[1][1]-O[1])/o,de=(te[2][0]-O[0])/o,D=-(te[2][1]-O[1])/o;C.beginPath(),C.moveTo(fe,Y),C.lineTo($,ae),C.lineTo(de,D),C.closePath(),C.stroke()}),C.restore()),C.canvas}function qT(n){return Array.isArray(n)?Math.min(...n):n}const kfe=10,C5=.25;class eW{constructor(e,t,i,r,o,s,l){this.sourceProj_=e,this.targetProj_=t;let u={};const h=l?HE(G=>Vs(l,Ir(G,this.targetProj_,this.sourceProj_))):pf(this.targetProj_,this.sourceProj_);this.transformInv_=function(G){const O=G[0]+"/"+G[1];return u[O]||(u[O]=h(G)),u[O]},this.maxSourceExtent_=r,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Bi(r)>=Bi(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Bi(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Bi(this.targetProj_.getExtent()):null;const d=nd(i),m=Ww(i),y=Zw(i),x=Bw(i),C=this.transformInv_(d),w=this.transformInv_(m),E=this.transformInv_(y),T=this.transformInv_(x),k=kfe+(s?Math.max(0,Math.ceil(Math.log2(ZE(i)/(s*s*256*256)))):0);if(this.addQuad_(d,m,y,x,C,w,E,T,k),this.wrapsXInSource_){let G=1/0;this.triangles_.forEach(function(O,V,z){G=Math.min(G,O.source[0][0],O.source[1][0],O.source[2][0])}),this.triangles_.forEach(O=>{if(Math.max(O.source[0][0],O.source[1][0],O.source[2][0])-G>this.sourceWorldWidth_/2){const V=[[O.source[0][0],O.source[0][1]],[O.source[1][0],O.source[1][1]],[O.source[2][0],O.source[2][1]]];V[0][0]-G>this.sourceWorldWidth_/2&&(V[0][0]-=this.sourceWorldWidth_),V[1][0]-G>this.sourceWorldWidth_/2&&(V[1][0]-=this.sourceWorldWidth_),V[2][0]-G>this.sourceWorldWidth_/2&&(V[2][0]-=this.sourceWorldWidth_);const z=Math.min(V[0][0],V[1][0],V[2][0]);Math.max(V[0][0],V[1][0],V[2][0])-z<this.sourceWorldWidth_/2&&(O.source=V)}})}u={}}addTriangle_(e,t,i,r,o,s){this.triangles_.push({source:[r,o,s],target:[e,t,i]})}addQuad_(e,t,i,r,o,s,l,u,h){const d=Js([o,s,l,u]),m=this.sourceWorldWidth_?Bi(d)/this.sourceWorldWidth_:null,y=this.sourceWorldWidth_,x=this.sourceProj_.canWrapX()&&m>.5&&m<1;let C=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const E=Js([e,t,i,r]);C=Bi(E)/this.targetWorldWidth_>C5||C}!x&&this.sourceProj_.isGlobal()&&m&&(C=m>C5||C)}if(!C&&this.maxSourceExtent_&&isFinite(d[0])&&isFinite(d[1])&&isFinite(d[2])&&isFinite(d[3])&&!Zs(d,this.maxSourceExtent_))return;let w=0;if(!C&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(u[0])||!isFinite(u[1]))){if(h>0)C=!0;else if(w=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(s[0])||!isFinite(s[1])?4:0)+(!isFinite(l[0])||!isFinite(l[1])?2:0)+(!isFinite(u[0])||!isFinite(u[1])?1:0),w!=1&&w!=2&&w!=4&&w!=8)return}if(h>0){if(!C){const E=[(e[0]+i[0])/2,(e[1]+i[1])/2],T=this.transformInv_(E);let k;x?k=(Fh(o[0],y)+Fh(l[0],y))/2-Fh(T[0],y):k=(o[0]+l[0])/2-T[0];const G=(o[1]+l[1])/2-T[1];C=k*k+G*G>this.errorThresholdSquared_}if(C){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const E=[(t[0]+i[0])/2,(t[1]+i[1])/2],T=this.transformInv_(E),k=[(r[0]+e[0])/2,(r[1]+e[1])/2],G=this.transformInv_(k);this.addQuad_(e,t,E,k,o,s,T,G,h-1),this.addQuad_(k,E,i,r,G,T,l,u,h-1)}else{const E=[(e[0]+t[0])/2,(e[1]+t[1])/2],T=this.transformInv_(E),k=[(i[0]+r[0])/2,(i[1]+r[1])/2],G=this.transformInv_(k);this.addQuad_(e,E,k,r,o,T,G,u,h-1),this.addQuad_(E,t,i,k,T,s,l,G,h-1)}return}}if(x){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(w&11)==0&&this.addTriangle_(e,i,r,o,l,u),(w&14)==0&&this.addTriangle_(e,i,t,o,l,s),w&&((w&13)==0&&this.addTriangle_(t,r,e,s,u,o),(w&7)==0&&this.addTriangle_(t,r,i,s,u,l))}calculateSourceExtent(){const e=el();return this.triangles_.forEach(function(t,i,r){const o=t.source;ev(e,o[0]),ev(e,o[1]),ev(e,o[2])}),e}getTriangles(){return this.triangles_}}const tW=.5;class Lfe extends r4{constructor(e,t,i,r,o,s,l){let u=e.getExtent();u&&e.canWrapX()&&(u=u.slice(),u[0]=-1/0,u[2]=1/0);let h=t.getExtent();h&&t.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const d=h?Ec(i,h):i,m=Gu(d),y=rb(e,t,m,r),x=tW,C=new eW(e,t,d,u,y*x,r),w=C.calculateSourceExtent(),E=dg(w)?null:s(w,y,o),T=E?Sn.IDLE:Sn.EMPTY,k=E?E.getPixelRatio():1;super(i,r,k,T),this.targetProj_=t,this.maxSourceExtent_=u,this.triangulation_=C,this.targetResolution_=r,this.targetExtent_=i,this.sourceImage_=E,this.sourcePixelRatio_=k,this.interpolate_=l,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==Sn.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==Sn.LOADED){const t=Bi(this.targetExtent_)/this.targetResolution_,i=Ws(this.targetExtent_)/this.targetResolution_;this.canvas_=QZ(t,i,this.sourcePixelRatio_,qT(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==Sn.IDLE){this.state=Sn.LOADING,this.changed();const e=this.sourceImage_.getState();e==Sn.LOADED||e==Sn.ERROR?this.reproject_():(this.sourceListenerKey_=mn(this.sourceImage_,Qn.CHANGE,t=>{const i=this.sourceImage_.getState();(i==Sn.LOADED||i==Sn.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){mr(this.sourceListenerKey_),this.sourceListenerKey_=null}}const tf=4,YS={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class Pfe extends Vo{constructor(e,t){super(e),this.image=t}}class Gfe extends zM{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const i=jw(t,e,0);e=t[i]}return e}getImage(e,t,i,r){const o=this.getProjection();if(!o||!r||Nh(o,r))return o&&(r=o),this.getImageInternal(e,t,i,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Nh(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==t&&Hp(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Lfe(o,r,e,t,i,(s,l,u)=>this.getImageInternal(s,l,u,o),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,r){if(this.loader){const o=nW(e,t,i,1),s=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&vc(this.wantedExtent_,o)||vc(this.image.getExtent(),o))&&(this.wantedResolution_&&qT(this.wantedResolution_)===s||qT(this.image.getResolution())===s)))return this.image;this.wantedProjection_=r,this.wantedExtent_=o,this.wantedResolution_=s,this.image=new r4(o,s,i,this.loader),this.image.addEventListener(Qn.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case Sn.LOADING:this.loading=!0,i=YS.IMAGELOADSTART;break;case Sn.LOADED:this.loading=!1,i=YS.IMAGELOADEND;break;case Sn.ERROR:this.loading=!1,i=YS.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new Pfe(i,t))}}function Ffe(n,e){n.getImage().src=e}function nW(n,e,t,i){const r=e/t,o=Gu(n),s=Kd(Bi(n)/r,tf),l=Kd(Ws(n)/r,tf),u=Kd((i-1)*s/2,tf),h=s+2*u,d=Kd((i-1)*l/2,tf),m=l+2*d;return kv(o,r,0,[h,m])}function ow(n,e,t,i){return i!==void 0?(i[0]=n,i[1]=e,i[2]=t,i):[n,e,t]}function Ofe(n,e,t){return n+"/"+e+"/"+t}function MI(n,e,t,i,r){return`${Yn(n)},${e},${Ofe(t,i,r)}`}function iW(n){return Nfe(n[0],n[1],n[2])}function Nfe(n,e,t){return(e<<n)+t}function Dfe(n,e){const t=n[0],i=n[1],r=n[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const o=e.getFullTileRange(t);return o?o.containsXY(i,r):!0}function sb(n,e){const t=[];Object.keys(e).forEach(function(r){e[r]!==null&&e[r]!==void 0&&t.push(r+"="+encodeURIComponent(e[r]))});const i=t.join("&");return n=n.replace(/[?&]$/,""),n+=n.includes("?")?"&":"?",n+i}const Vfe=/\{z\}/g,Bfe=/\{x\}/g,Zfe=/\{y\}/g,Wfe=/\{-y\}/g;function zfe(n,e,t,i,r){return n.replace(Vfe,e.toString()).replace(Bfe,t.toString()).replace(Zfe,i.toString()).replace(Wfe,function(){if(r===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(r-i).toString()})}function rW(n){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(n);if(t){const i=t[1].charCodeAt(0),r=t[2].charCodeAt(0);let o;for(o=i;o<=r;++o)e.push(n.replace(t[0],String.fromCharCode(o)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){const i=parseInt(t[2],10);for(let r=parseInt(t[1],10);r<=i;r++)e.push(n.replace(t[0],r.toString()));return e}return e.push(n),e}const aw="1.3.0",w5=[101,101];function sW(n,e,t,i,r){r.WIDTH=t[0],r.HEIGHT=t[1];const o=i.getAxisOrientation(),s=WR(r.VERSION,"1.3")>=0;r[s?"CRS":"SRS"]=i.getCode();const l=s&&o.startsWith("ne")?[e[1],e[0],e[3],e[2]]:e;return r.BBOX=l.join(","),sb(n,r)}function oW(n,e,t,i,r,o,s){o=Object.assign({REQUEST:"GetMap"},o);const l=e/t,u=[PG(Bi(n)/l,tf),PG(Ws(n)/l,tf)];if(t!=1)switch(s){case"geoserver":const d=90*t+.5|0;"FORMAT_OPTIONS"in o?o.FORMAT_OPTIONS+=";dpi:"+d:o.FORMAT_OPTIONS="dpi:"+d;break;case"mapserver":o.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":o.DPI=90*t;break;default:throw new Error("Unknown `serverType` configured")}return sW(r,n,u,i,o)}function lw(n,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:aw,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},n)}function Ufe(n){const e=n.hidpi===void 0?!0:n.hidpi,t=Ni(n.projection||"EPSG:3857"),i=n.ratio||1.5,r=n.load||o4,o=n.crossOrigin??null;return(s,l,u)=>{s=nW(s,l,u,i),u!=1&&(!e||n.serverType===void 0)&&(u=1);const h=oW(s,l,u,t,n.url,lw(n.params,"GetMap"),n.serverType),d=new Image;return d.crossOrigin=o,r(d,h).then(m=>({image:m,extent:s,pixelRatio:u}))}}function Xfe(n,e,t){if(n.url===void 0)return;const i=Ni(n.projection||"EPSG:3857"),r=kv(e,t,0,w5),o={QUERY_LAYERS:n.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(o,lw(n.params,"GetFeatureInfo"),n.params);const s=Vm((e[0]-r[0])/t,tf),l=Vm((r[3]-e[1])/t,tf),u=WR(o.VERSION,"1.3")>=0;return o[u?"I":"X"]=s,o[u?"J":"Y"]=l,sW(n.url,r,w5,i,o)}function Yfe(n,e){if(n.url===void 0)return;const t={SERVICE:"WMS",VERSION:aw,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e!==void 0){const i=Ni(n.projection||"EPSG:3857").getMetersPerUnit()||1,r=28e-5;t.SCALE=e*i/r}if(Object.assign(t,n.params),n.params!==void 0&&t.LAYER===void 0){const i=t.LAYERS;if(!(!Array.isArray(i)||i.length!==1))return;t.LAYER=i}return sb(n.url,t)}class uw extends Gfe{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Ffe,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,i,r){const o=Ni(i),s=this.getProjection();s&&s!==o&&(t=rb(s,o,e,t),e=Ir(e,o,s));const l={url:this.url_,params:{...this.params_,...r},projection:s||o};return Xfe(l,e,t)}getLegendUrl(e,t){return Yfe({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,i,r){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==r)&&(this.loaderProjection_=r,this.loader=Ufe({crossOrigin:this.crossOrigin_,params:this.params_,projection:r,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(o,s)=>(this.image.setImage(o),this.imageLoadFunction_(this.image,s),o4(o))})),super.getImageInternal(e,t,i,r))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}function aW(){return gb([5.31,49.38,6.64,50.21],Sl,Wp)}function lW(n){return!!n?.metadata?.hasRetina&&UB()}function Hfe(n,e="https"){const t=n.imageType.split("/")[1],i=Dn.getValue(e_,ak)?"app.geoportail.lu":"geoportail.lu";return`${e==="https"?"//wmts{3-4}.":"//wmts{1-2}."}${i}/mapproxy_4_v3/wmts/{Layer}${lW(n)?"_hd":""}/{TileMatrixSet}/{TileMatrix}/{TileCol}/{TileRow}.${t}`}class Kfe{createOlLayer(e){const{name:t,layers:i,imageType:r,url:o,id:s}=e,l=new uw({url:o||$v.wmsProxyUrl,hidpi:UB(),serverType:"mapserver",params:{FORMAT:r,LAYERS:i},crossOrigin:"anonymous"});return new uv({properties:{"olcs.extent":aW(),label:t,id:s},source:l})}setLayerTime(e,t){const i=e.getParams();i.TIME=t,e.updateParams(i)}}const uW=new Kfe;function QT(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}const jfe=new Error("disposed"),$fe=[256,256];class A5 extends lk{constructor(e){const t=Vn.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=QT(this.data_);return e?[e.width,e.height]:$fe}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==Vn.IDLE&&this.state!==Vn.ERROR)return;this.state=Vn.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=Vn.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=Vn.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(jfe),this.controller_=null),super.disposeInternal()}}class cW extends lk{constructor(e,t,i,r,o,s,l,u,h,d,m,y){super(o,Vn.IDLE,y),this.renderEdges_=m!==void 0?m:!1,this.pixelRatio_=l,this.gutter_=u,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=s||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const x=r.getTileCoordExtent(this.wrappedTileCoord_),C=this.targetTileGrid_.getExtent();let w=this.sourceTileGrid_.getExtent();const E=C?Ec(x,C):x;if(ZE(E)===0){this.state=Vn.EMPTY;return}const T=e.getExtent();T&&(w?w=Ec(w,T):w=T);const k=r.getResolution(this.wrappedTileCoord_[0]),G=Mfe(e,i,E,k);if(!isFinite(G)||G<=0){this.state=Vn.EMPTY;return}const O=d!==void 0?d:tW;if(this.triangulation_=new eW(e,i,E,w,G*O,k),this.triangulation_.getTriangles().length===0){this.state=Vn.EMPTY;return}this.sourceZ_=t.getZForResolution(G);let V=this.triangulation_.calculateSourceExtent();if(w&&(e.canWrapX()?(V[1]=Wr(V[1],w[1],w[3]),V[3]=Wr(V[3],w[1],w[3])):V=Ec(V,w)),!ZE(V))this.state=Vn.EMPTY;else{let z=0,H=0;e.canWrapX()&&(z=Bi(T),H=Math.floor((V[0]-T[0])/z)),fD(V.slice(),e,!0).forEach($=>{const ae=t.getTileRangeForExtentAndZ($,this.sourceZ_);for(let fe=ae.minX;fe<=ae.maxX;fe++)for(let Y=ae.minY;Y<=ae.maxY;Y++){const de=h(this.sourceZ_,fe,Y,l);if(de){const D=H*z;this.sourceTiles_.push({tile:de,offset:D})}}++H}),this.sourceTiles_.length===0&&(this.state=Vn.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{const i=t.tile;if(i&&i.getState()==Vn.LOADED){const r=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);r[0]+=t.offset,r[2]+=t.offset;const o=this.clipExtent_?.slice();o&&(o[0]+=t.offset,o[2]+=t.offset),e.push({extent:r,clipExtent:o,image:i.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=Vn.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),r=typeof i=="number"?i:i[0],o=typeof i=="number"?i:i[1],s=this.targetTileGrid_.getResolution(t),l=this.sourceTileGrid_.getResolution(this.sourceZ_),u=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=QZ(r,o,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),s,u,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=Vn.LOADED}this.changed()}load(){if(this.state==Vn.IDLE){this.state=Vn.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const i=t.getState();if(i==Vn.IDLE||i==Vn.LOADING){e++;const r=mn(t,Qn.CHANGE,o=>{const s=t.getState();(s==Vn.LOADED||s==Vn.ERROR||s==Vn.EMPTY)&&(mr(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(r)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},i,r){t.getState()==Vn.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(mr),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Qw(this.canvas_.getContext("2d")),yy.push(this.canvas_),this.canvas_=null),super.release()}}class S5{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof Kw&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return gr(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return gr(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){gr(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function HS(n,e,t){if(!(t in n))return n[t]=new Set([e]),!0;const i=n[t],r=i.has(e);return r||i.add(e),!r}function Jfe(n,e,t){const i=n[t];return i?i.delete(e):!1}function E5(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=Ec(e,Xl(t.extent,n.viewState.projection)));const i=t.layer.getRenderSource();if(!i.getWrapX()){const r=i.getTileGridForProjection(n.viewState.projection).getExtent();r&&(e=Ec(e,r))}return e}class hW extends WM{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=el(),this.tempTileRange_=new uk(0,0,0,0),this.tempTileCoord_=ow(0,0,0);const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new S5(i),this.sourceTileCache_=null,this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new S5(512)),this.sourceTileCache_}getOrCreateTile(e,t,i,r){const o=this.tileCache_,l=this.getLayer().getSource(),u=MI(l,l.getKey(),e,t,i);let h;if(o.containsKey(u))h=o.get(u);else{const d=r.viewState.projection,m=l.getProjection();if(h=l.getTile(e,t,i,r.pixelRatio,d,!m||Nh(m,d)?void 0:this.getSourceTileCache()),!h)return null;o.set(u,h)}return h}getTile(e,t,i,r){const o=this.getOrCreateTile(e,t,i,r);return o||null}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),r=Vs(t.pixelToCoordinateTransform,e.slice()),o=i.getExtent();if(o&&!Pc(o,r))return null;const s=t.viewState,l=i.getRenderSource(),u=l.getTileGridForProjection(s.projection),h=l.getTilePixelRatio(t.pixelRatio);for(let d=u.getZForResolution(s.resolution);d>=u.getMinZoom();--d){const m=u.getTileCoordForCoordAndZ(r,d),y=this.getTile(d,m[1],m[2],t);if(!y||y.getState()!==Vn.LOADED)continue;const x=u.getOrigin(d),C=oa(u.getTileSize(d)),w=u.getResolution(d);let E;if(y instanceof sZ||y instanceof cW)E=y.getImage();else if(y instanceof A5){if(E=QT(y.getData()),!E)continue}else continue;const T=Math.floor(h*((r[0]-x[0])/w-m[1]*C[0])),k=Math.floor(h*((x[1]-r[1])/w-m[2]*C[1])),G=Math.round(h*l.getGutterForProjection(s.projection));return this.getImageData(E,T+G,k+G)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=i,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,i,r,o){const s=e.viewState,l=this.getLayer(),u=l.getRenderSource(),h=u.getTileGridForProjection(s.projection),d=Yn(u);d in e.wantedTiles||(e.wantedTiles[d]={});const m=e.wantedTiles[d],y=l.getMapInternal(),x=Math.max(i-o,h.getMinZoom(),h.getZForResolution(Math.min(l.getMaxResolution(),y?y.getView().getResolutionForZoom(Math.max(l.getMinZoom(),0)):h.getResolution(0)),u.zDirection)),C=s.rotation,w=C?hD(s.center,s.resolution,C,e.size):void 0;for(let E=i;E>=x;--E){const T=h.getTileRangeForExtentAndZ(t,E,this.tempTileRange_),k=h.getResolution(E);for(let G=T.minX;G<=T.maxX;++G)for(let O=T.minY;O<=T.maxY;++O){if(C&&!h.tileCoordIntersectsViewport([E,G,O],w))continue;const V=this.getTile(E,G,O,e);if(!V||!HS(r,V,E))continue;const H=V.getKey();if(m[H]=!0,V.getState()===Vn.IDLE&&!e.tileQueue.isKeyQueued(H)){const te=ow(E,G,O,this.tempTileCoord_);e.tileQueue.enqueue([V,d,h.getTileCoordCenter(te),k])}}}}findStaleTile_(e,t){const i=this.tileCache_,r=e[0],o=e[1],s=e[2],l=this.getStaleKeys();for(let u=0;u<l.length;++u){const h=MI(this.getLayer().getSource(),l[u],r,o,s);if(i.containsKey(h)){const d=i.peek(h);if(d.getState()===Vn.LOADED)return d.endTransition(Yn(this)),HS(t,d,r),!0}}return!1}findAltTiles_(e,t,i,r){const o=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!o)return!1;let s=!0;const l=this.tileCache_,u=this.getLayer().getRenderSource(),h=u.getKey();for(let d=o.minX;d<=o.maxX;++d)for(let m=o.minY;m<=o.maxY;++m){const y=MI(u,h,i,d,m);let x=!1;if(l.containsKey(y)){const C=l.peek(y);C.getState()===Vn.LOADED&&(HS(r,C,i),x=!0)}x||(s=!1)}return s}renderFrame(e,t){this.renderComplete=!0;const i=e.layerStatesArray[e.layerIndex],r=e.viewState,o=r.projection,s=r.resolution,l=r.center,u=e.pixelRatio,h=this.getLayer(),d=h.getSource(),m=d.getTileGridForProjection(o),y=m.getZForResolution(s,d.zDirection),x=m.getResolution(y),C=d.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==C&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=C):this.renderedSourceKey_=C;let w=e.extent;const E=d.getTilePixelRatio(u);this.prepareContainer(e,t);const T=this.context.canvas.width,k=this.context.canvas.height,G=i.extent&&Xl(i.extent);G&&(w=Ec(w,Xl(i.extent)));const O=x*T/2/E,V=x*k/2/E,z=[l[0]-O,l[1]-V,l[0]+O,l[1]+V],H={};this.renderedTiles.length=0;const te=h.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){const Ne=m.getZForResolution(r.nextResolution,d.zDirection),Ee=E5(e,e.nextExtent);this.enqueueTiles(e,Ee,Ne,H,te)}const $=E5(e,w);if(this.enqueueTiles(e,$,y,H,0),te>0&&setTimeout(()=>{this.enqueueTiles(e,$,y-1,H,te-1)},0),!(y in H))return this.container;const ae=Yn(this),fe=e.time;for(const Ne of H[y]){const Ee=Ne.getState();if(Ee===Vn.EMPTY)continue;const se=Ne.tileCoord;if(Ee===Vn.LOADED&&Ne.getAlpha(ae,fe)===1){Ne.endTransition(ae);continue}if(Ee!==Vn.ERROR&&(this.renderComplete=!1),this.findStaleTile_(se,H)){Jfe(H,Ne,y),e.animate=!0;continue}if(this.findAltTiles_(m,se,y+1,H))continue;const ze=m.getMinZoom();for(let je=y-1;je>=ze&&!this.findAltTiles_(m,se,je,H);--je);}const Y=x/s*u/E,de=this.getRenderContext(e);Fu(this.tempTransform,T/2,k/2,Y,Y,0,-T/2,-k/2),i.extent&&this.clipUnrotated(de,e,G),d.getInterpolate()||(de.imageSmoothingEnabled=!1),this.preRender(de,e);const D=Object.keys(H).map(Number);D.sort(Tc);let oe;const ue=[],ge=[];for(let Ne=D.length-1;Ne>=0;--Ne){const Ee=D[Ne],se=d.getTilePixelSize(Ee,u,o),j=m.getResolution(Ee)/x,ze=se[0]*j*Y,je=se[1]*j*Y,qe=m.getTileCoordForCoordAndZ(nd(z),Ee),yt=m.getTileCoordExtent(qe),xt=Vs(this.tempTransform,[E*(yt[0]-z[0])/x,E*(z[3]-yt[3])/x]),Et=E*d.getGutterForProjection(o);for(const kt of H[Ee]){if(kt.getState()!==Vn.LOADED)continue;const hn=kt.tileCoord,wn=qe[1]-hn[1],Ge=Math.round(xt[0]-(wn-1)*ze),ve=qe[2]-hn[2],W=Math.round(xt[1]-(ve-1)*je),Ze=Math.round(xt[0]-wn*ze),Re=Math.round(xt[1]-ve*je),ce=Ge-Ze,me=W-Re,_e=D.length===1;let Ie=!1;oe=[Ze,Re,Ze+ce,Re,Ze+ce,Re+me,Ze,Re+me];for(let pe=0,Te=ue.length;pe<Te;++pe)if(!_e&&Ee<ge[pe]){const We=ue[pe];Zs([Ze,Re,Ze+ce,Re+me],[We[0],We[3],We[4],We[7]])&&(Ie||(de.save(),Ie=!0),de.beginPath(),de.moveTo(oe[0],oe[1]),de.lineTo(oe[2],oe[3]),de.lineTo(oe[4],oe[5]),de.lineTo(oe[6],oe[7]),de.moveTo(We[6],We[7]),de.lineTo(We[4],We[5]),de.lineTo(We[2],We[3]),de.lineTo(We[0],We[1]),de.clip())}ue.push(oe),ge.push(Ee),this.drawTile(kt,e,Ze,Re,ce,me,Et,_e),Ie&&de.restore(),this.renderedTiles.unshift(kt),this.updateUsedTiles(e.usedTiles,d,kt)}}if(this.renderedResolution=x,this.extentChanged=!this.renderedExtent_||!Hp(this.renderedExtent_,z),this.renderedExtent_=z,this.renderedPixelRatio=u,this.postRender(this.context,e),i.extent&&de.restore(),de.imageSmoothingEnabled=!0,this.renderComplete){const Ne=(Ee,se)=>{const q=Yn(d),j=se.wantedTiles[q],ze=j?Object.keys(j).length:0;this.updateCacheSize(ze),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()};e.postRenderFunctions.push(Ne)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,i,r,o,s,l,u){let h;if(e instanceof A5){if(h=QT(e.getData()),!h)throw new Error("Rendering array data is not yet supported")}else h=this.getTileImage(e);if(!h)return;const d=this.getRenderContext(t),m=Yn(this),y=t.layerStatesArray[t.layerIndex],x=y.opacity*(u?e.getAlpha(m,t.time):1),C=x!==d.globalAlpha;C&&(d.save(),d.globalAlpha=x),d.drawImage(h,l,l,h.width-2*l,h.height-2*l,i,r,o,s),C&&d.restore(),x!==y.opacity?t.animate=!0:u&&e.endTransition(m)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){const r=Yn(t);r in e||(e[r]={}),e[r][i.getKey()]=!0}}const nf={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class qfe extends pg{constructor(e){e=e||{};const t=Object.assign({},e),i=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(nf.PRELOAD)}setPreload(e){this.set(nf.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(nf.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(nf.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class Jm extends qfe{constructor(e){super(e)}createRenderer(){return new hW(this,{cacheSize:this.getCacheSize()})}}const Am=[0,0,0],Fd=5;class xA{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,gr(HY(this.resolutions_,(r,o)=>o-r),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let r=0,o=this.resolutions_.length-1;r<o;++r)if(!t)t=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,gr(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=nd(i)),gr(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,gr(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:dM,gr(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((r,o)=>{const s=new uk(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const l=this.getTileRangeForExtentAndZ(i,o);s.minX=Math.max(l.minX,s.minX),s.maxX=Math.min(l.maxX,s.maxX),s.minY=Math.max(l.minY,s.minY),s.maxY=Math.min(l.maxY,s.maxY)}return s}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const r=this.getTileRangeForExtentAndZ(e,t);for(let o=r.minX,s=r.maxX;o<=s;++o)for(let l=r.minY,u=r.maxY;l<=u;++l)i([t,o,l])}forEachTileCoordParentTileRange(e,t,i,r){let o,s,l,u=null,h=e[0]-1;for(this.zoomFactor_===2?(s=e[1],l=e[2]):u=this.getTileCoordExtent(e,r);h>=this.minZoom;){if(s!==void 0&&l!==void 0?(s=Math.floor(s/2),l=Math.floor(l/2),o=wm(s,s,l,l,i)):o=this.getTileRangeForExtentAndZ(u,h,i),t(h,o))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const o=e[1]*2,s=e[2]*2;return wm(o,o+1,s,s+1,t)}const r=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const r=e[0],o=e[1],s=e[2];if(t===r)return wm(o,s,o,s,i);if(this.zoomFactor_){const u=Math.pow(this.zoomFactor_,t-r),h=Math.floor(o*u),d=Math.floor(s*u);if(t<r)return wm(h,h,d,d,i);const m=Math.floor(u*(o+1))-1,y=Math.floor(u*(s+1))-1;return wm(h,m,d,y,i)}const l=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,Am);const r=Am[1],o=Am[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,Am);const s=Am[1],l=Am[2];return wm(r,s,o,l,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),r=oa(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*i,t[1]-(e[2]+.5)*r[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),r=this.getResolution(e[0]),o=oa(this.getTileSize(e[0]),this.tmpSize_),s=i[0]+e[1]*o[0]*r,l=i[1]-(e[2]+1)*o[1]*r,u=s+o[0]*r,h=l+o[1]*r;return Gc(s,l,u,h,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,r,o){const s=this.getZForResolution(i),l=i/this.getResolution(s),u=this.getOrigin(s),h=oa(this.getTileSize(s),this.tmpSize_);let d=l*(e-u[0])/i/h[0],m=l*(u[1]-t)/i/h[1];return r?(d=Kd(d,Fd)-1,m=Kd(m,Fd)-1):(d=Vm(d,Fd),m=Vm(m,Fd)),ow(s,d,m,o)}getTileCoordForXYAndZ_(e,t,i,r,o){const s=this.getOrigin(i),l=this.getResolution(i),u=oa(this.getTileSize(i),this.tmpSize_);let h=(e-s[0])/l/u[0],d=(s[1]-t)/l/u[1];return r?(h=Kd(h,Fd)-1,d=Kd(d,Fd)-1):(h=Vm(h,Fd),d=Vm(d,Fd)),ow(i,h,d,o)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=jw(this.resolutions_,e,t||0);return Wr(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return VD(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let r=this.minZoom;r<t;++r)i[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=i}}class Sk extends xA{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function Qfe(n,e){return(function(t,i,r){if(!t)return;let o;const s=t[0];if(e){const l=e.getFullTileRange(s);l&&(o=l.getHeight()-1)}return zfe(n,s,t[1],t[2],o)})}function epe(n,e){const t=n.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=Qfe(n[r],e);return eR(i)}function eR(n){return n.length===1?n[0]:(function(e,t,i){if(!e)return;const r=iW(e),o=Fh(r,n.length);return n[o](e,t,i)})}function dW(n){let e=n.getDefaultTileGrid();return e||(e=rpe(n),n.setDefaultTileGrid(e)),e}function tpe(n,e,t){const i=e[0],r=n.getTileCoordCenter(e),o=Ek(t);if(!Pc(o,r)){const s=Bi(o),l=Math.ceil((o[0]-r[0])/s);return r[0]+=s*l,n.getTileCoordForCoordAndZ(r,i)}return e}function npe(n,e,t,i){i=i!==void 0?i:"top-left";const r=fW(n,e,t);return new xA({extent:n,origin:sY(n,i),resolutions:r,tileSize:t})}function ipe(n){const e=n||{},t=e.extent||Ni("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:fW(t,e.maxZoom,e.tileSize,e.maxResolution)};return new xA(i)}function fW(n,e,t,i){e=e!==void 0?e:kH,t=oa(t!==void 0?t:dM);const r=Ws(n),o=Bi(n);i=i>0?i:Math.max(o/t[0],r/t[1]);const s=e+1,l=new Array(s);for(let u=0;u<s;++u)l[u]=i/Math.pow(2,u);return l}function rpe(n,e,t,i){const r=Ek(n);return npe(r,e,t,i)}function Ek(n){n=Ni(n);let e=n.getExtent();if(!e){const t=180*Kp.degrees/n.getMetersPerUnit();e=Gc(-t,-t,t,t)}return e}class spe extends zM{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&oa(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||Yn(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,r,o,s){return Zn()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:dW(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const r=this.getTileGridForProjection(i),o=this.getTilePixelRatio(t),s=oa(r.getTileSize(e),this.tmpSize);return o==1?s:SK(s,o,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const i=t!==void 0?t:this.getProjection(),r=t!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=tpe(r,e,i)),Dfe(e,r)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class ope extends Vo{constructor(e,t){super(e),this.tile=t}}const KS={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class Tk extends spe{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Tk.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=Yn(t),r=t.getState();let o;r==Vn.LOADING?(this.tileLoadingKeys_[i]=!0,o=KS.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],o=r==Vn.ERROR?KS.TILELOADERROR:r==Vn.LOADED?KS.TILELOADEND:void 0),o!=null&&this.dispatchEvent(new ope(o,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=rW(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(epe(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}}class Rk extends Tk{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:pW,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:sZ,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!Nh(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Nh(t,e)))return this.tileGrid;const i=Yn(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=dW(e)),this.tileGridForProjection[i]}createTile_(e,t,i,r,o,s){const l=[e,t,i],u=this.getTileCoordForTileUrlFunction(l,o),h=u?this.tileUrlFunction(u,r,o):void 0,d=new this.tileClass(l,h!==void 0?Vn.IDLE:Vn.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return d.key=s,d.addEventListener(Qn.CHANGE,this.handleTileChange.bind(this)),d}getTile(e,t,i,r,o,s){const l=this.getProjection();if(!l||!o||Nh(l,o))return this.getTileInternal(e,t,i,r,l||o);const u=[e,t,i],h=this.getKey(),d=this.getTileGridForProjection(l),m=this.getTileGridForProjection(o),y=this.getTileCoordForTileUrlFunction(u,o),x=new cW(l,d,o,m,u,y,this.getTilePixelRatio(r),this.getGutter(),(C,w,E,T)=>this.getTileInternal(C,w,E,T,l,s),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return x.key=h,x}getTileInternal(e,t,i,r,o,s){const l=this.getKey(),u=MI(this,l,e,t,i);if(s&&s.containsKey(u))return s.get(u);const h=this.createTile_(e,t,i,r,o,l);return s?.set(u,h),h}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const i=Ni(e);if(i){const r=Yn(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}}function pW(n,e){if(Cl){const t=n.getCrossOrigin();let i="same-origin",r="same-origin";t==="anonymous"||t===""?(i="cors",r="omit"):t==="use-credentials"&&(i="cors",r="include"),fetch(e,{mode:i,credentials:r}).then(o=>{if(!o.ok)throw new Error(`HTTP ${o.status}`);return o.blob()}).then(o=>createImageBitmap(o)).then(o=>{const s=n.getImage();s.width=o.width,s.height=o.height,s.getContext("2d").drawImage(o,0,0),o.close?.(),s.dispatchEvent(new Event("load"))}).catch(()=>{n.getImage().dispatchEvent(new Event("error"))});return}n.getImage().src=e}class ob extends Rk{constructor(e){const t=e.requestEncoding!==void 0?e.requestEncoding:"KVP",i=e.tileGrid;let r=e.urls;r===void 0&&e.url!==void 0&&(r=rW(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:r,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),r&&r.length>0&&(this.tileUrlFunction=eR(r.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(eR(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?sb(e,i):e.replace(/\{(\w+?)\}/g,function(s,l){return l.toLowerCase()in i?i[l.toLowerCase()]:s});const r=this.tileGrid,o=this.dimensions_;return(function(s,l,u){if(!s)return;const h={TileMatrix:r.getMatrixId(s[0]),TileCol:s[1],TileRow:s[2]};Object.assign(h,o);let d=e;return t=="KVP"?d=sb(d,h):d=d.replace(/\{(\w+?)\}/g,function(m,y){return encodeURIComponent(h[y])}),d})}}const ape=[156543.033928,78271.516964,39135.758482,19567.879241,9783.9396205,4891.96981025,2445.98490513,1222.99245256,611.496226281,305.748113141,152.87405657,76.4370282852,38.2185141426,19.1092570713,9.55462853565,4.77731426782,2.38865713391,1.19432856696,.597164283478,.298582141739,.1492910708695,.07464553543475],lpe=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21"];class upe{createOlLayer(e){const{name:t,imageType:i,id:r}=e,o=lW(e),s=Ni(Wp),l=s.getExtent(),u=new ob({url:Hfe(e),tilePixelRatio:o?2:1,layer:t,matrixSet:`GLOBAL_WEBMERCATOR_4_V3${o?"_HD":""}`,format:i,requestEncoding:"REST",projection:s,tileGrid:new Sk({origin:nd(l),extent:l,resolutions:ape,matrixIds:lpe}),style:"default",crossOrigin:"anonymous"});return new Jm({source:u,properties:{"olcs.extent":aW(),label:t,id:r}})}setLayerTime(e,t,i){const r=e.get(sw).time_layers[i],o=t.getUrls();if(o){const s=this.transformUrls(o,r);t.setUrls(s),e.set(JT,r),e.set(qZ,r)}}transformUrls(e,t){return e.map(i=>i.replace(/[/][^/]*[/]{TileMatrixSet}/,`/${t}/{TileMatrixSet}`))}}const gW=new upe;class cpe{createOlLayer(e,t){const i=Kn(),{id:r,metadata:o,name:s}=e,l=t.get(r);if(!l)return;const u={container:i.getOlMap().getTarget(),...l},h=new SM({maplibreOptions:u,label:s,id:r,queryable_id:r,metadata:o}),d=Mu(),m=Mf();return h.getMapLibreMap().loaded()?d.setBaseStyle(r,h.getMapLibreMap().getStyle()):new Promise(y=>h.getMapLibreMap().once("data",y)).then(()=>d.setBaseStyle(r,h.getMapLibreMap().getStyle())),h.set(Sfe,m.getDefaultMapBoxStyleUrl(m.getVectorId(e))),h}}const hpe=new cpe;class tR extends Rk{constructor(e){e=e||{};const t=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=el(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,i,r){const o=Ni(i),s=this.getProjection()||o;let l=this.getTileGrid();l||(l=this.getTileGridForProjection(s));const u=Ir(e,o,s),h=rb(s,o,e,t),d=l.getZForResolution(h,this.zDirection),m=l.getResolution(d),y=l.getTileCoordForCoordAndZ(u,d);if(l.getResolutions().length<=y[0])return;let x=l.getTileCoordExtent(y,this.tmpExtent_);const C=this.gutter_;C!==0&&(x=Kh(x,m*C,x));const w={QUERY_LAYERS:this.params_.LAYERS};Object.assign(w,lw(this.params_,"GetFeatureInfo"),r);const E=Math.floor((u[0]-x[0])/m),T=Math.floor((x[3]-u[1])/m);return w[this.v13_?"I":"X"]=E,w[this.v13_?"J":"Y"]=T,this.getRequestUrl_(y,x,1,s||o,w)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;const i={SERVICE:"WMS",VERSION:aw,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const r=this.params_.LAYERS;if(!(!Array.isArray(r)||r.length===1))return;i.LAYER=r}if(e!==void 0){const r=this.getProjection()?this.getProjection().getMetersPerUnit():1,o=28e-5;i.SCALE=e*r/o}return Object.assign(i,t),sb(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,i,r,o){const s=this.urls;if(!s)return;let l;if(s.length==1)l=s[0];else{const u=Fh(iW(e),s.length);l=s[u]}return oW(t,(this.tileGrid||this.getTileGridForProjection(r)).getResolution(e[0]),i,r,l,o,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const t=[];for(const i in this.params_)t[e++]=i+"-"+this.params_[i];return t.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){const e=this.params_.VERSION||aw;this.v13_=WR(e,"1.3")>=0}tileUrlFunction(e,t,i){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(i)),r.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);const o=r.getResolution(e[0]);let s=r.getTileCoordExtent(e,this.tmpExtent_);const l=this.gutter_;l!==0&&(s=Kh(s,o*l,s));const u=Object.assign({},lw(this.params_,"GetMap"));return this.getRequestUrl_(e,s,t,i,u)}}function dpe(){const{initLayer:n}=la(),{addLayers:e,setBgLayer:t}=Ui(),{findBgLayerByName:i}=Tl();function r(s){if(s.layerType===Dp.LAYER_OFFLINE_BG_VECTOR)return i(s.key);{const l=JSON.parse(s.layerSerialization),{id:u,label:h,opacity:d}=l;let m=s.layerType;return m===Wh.BG_WMTS&&(m=Dp.LAYER_OFFLINE_BG_WMTS),{id:u,name:h,options:l,type:m,metadata:{start_opacity:d}}}}function o(s){if([Dp.LAYER_OFFLINE_TILE,Dp.LAYER_OFFLINE_BG_VECTOR].includes(s.layerType))try{const u=n(r(s));s.backgroundLayer?t(u):e(u)}catch{throw new Error("Invalid offline layer specification.")}}return{createOfflineLayer:o,offlineLayerToLayer:r}}let T5;function Ny(){const n=Ui(),e=dpe(),{isOffLine:t}=It(Jn()),{minZoom:i,maxZoom:r}=It(n),{removeAllLayers:o,setBgLayer:s}=n;function l(C){T5=C,console.warn("Deprecated: useOffline.initLocalforage_v3() is meant to be removed when v4 is fully operational")}function u(){return t.value}function h(C){t.value=C}function d(C){m(),y(C),x(C)}function m(){pfe(),o(),s(null)}function y(C){const{zooms:w}=C;i.value=w[0],r.value=w[w.length-1]}function x(C){[...C.layers].reverse().forEach(w=>e.createOfflineLayer(w))}return{localforage_v3:T5,isOffLine:t,initLocalforage_v3:l,getIsOffline:u,setIsOffline:h,doRestore:d}}class mW{createOlLayer(e){const t=this.deserializeTileLayer(e.options);return new Jm(t)}createTileLoadFunction(){const e=Ny().localforage_v3;return(i,r)=>{const o=Uoe(r);e.getItem(o).then(s=>{i.getImage().src=s||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="}).catch(()=>i.setState(3))}}}class fpe extends mW{deserializeTileLayer(e){const t=JSON.parse(e.source);if(t.tileLoadFunction=this.createTileLoadFunction(),t.gutter=parseInt("96",10),t.tileGrid){const i=new xA(JSON.parse(t.tileGrid));t.tileGrid=i}return e.source=new tR(t),e}serializeTileLayer(){throw new Error("Method not implemented.")}}const ppe=new fpe;class gpe extends mW{deserializeTileLayer(e){const t=JSON.parse(e.source);if(t.tileLoadFunction=this.createTileLoadFunction(),t.tileGrid){const i=new Sk(JSON.parse(t.tileGrid));t.tileGrid=i}return e.source=new ob(t),e}serializeTileLayer(){throw new Error("Method not implemented.")}}const mpe=new gpe;class ype{createOlLayer(e){let t;switch(this.getOfflineLayerSourceType(e)){case Wh.WMTS:t=mpe.createOlLayer(e);break;case Wh.TILE_WMS:t=ppe.createOlLayer(e);break;default:throw new Error(`Unrecognized offline layer type: ${e.type}`)}return t}getOfflineLayerSourceType(e){return e.options.sourceType}}const _pe=new ype;function vpe(){return new Hn({image:bpe})}const bpe=new ms({radius:4,fill:new Di({color:"white"}),stroke:new bi({color:"white",width:1})}),xpe=1002,Ipe="featurePositionLayer";class Cpe extends gs{geoMarker;constructor(e){const t=new io({features:[],useSpatialIndex:!1});super({...e,source:t})}moveGeoMarker(e,t){this.geoMarker?.getGeometry()||this.createGeoMarker(),this.geoMarker?.getGeometry()?.setCoordinates([e,t])}createGeoMarker(){this.geoMarker=new yi({geometry:new zi([0,0])}),this.getSource()?.clear(),this.getSource()?.addFeature(this.geoMarker)}removeGeoMarker(){this.getSource()?.clear(),this.geoMarker=void 0}}class wpe{createOlLayer(){const e=vpe(),t=new Cpe({declutter:!0,zIndex:xpe,style:e,updateWhileAnimating:!0,updateWhileInteracting:!0});return t.set("cyLayerType",Ipe),t}}const Ape=new wpe;class Spe{createOlLayer(e,t){let i;if(t&&(i=hpe.createOlLayer(e,t)),!i)switch(e.type){case"position":return this.createOlLayerFeaturePosition(e);case Wh.WMS:i=uW.createOlLayer(e);break;case Wh.WMTS:case Wh.BG_WMTS:i=gW.createOlLayer(e);break;case Dp.LAYER_OFFLINE_TILE:case Dp.LAYER_OFFLINE_BG_VECTOR:i=_pe.createOlLayer(e);break;default:throw new Error(`Unrecognized layer type: ${e.type}`)}return this.setOlProps(e,i),i}createOlLayerInteractionDraw(){return qO.createOlLayer()}createOlLayerInteractionClip(){return qO.createOlLayer()}createOlLayerFeaturePosition(e){const t=Ape.createOlLayer();return t.set($T,e.id),t.set(JT,e.name),t}setOlProps(e,t){t.set($T,e.id),t.set(JT,e.name),t.set(qZ,e.name),t.set(sw,e.metadata),t.set(Cfe,e.id),t.set(wfe,la().getLayerCurrentTime(e)),t.set(Afe,e.time),t.setOpacity(e.opacity)}}const cv=new Spe;class Epe{setLayerTime(e,t){const i=e.getSource();i instanceof uw&&uW.setLayerTime(i,t),i instanceof ob&&gW.setLayerTime(e,i,t)}}const Tpe=new Epe,Xx=-200;function Mk(){function n(C,w){if(!w)return;const E=d(w);C.addLayer(E)}function e(C,w){if(!w)return;const E=cv.createOlLayer(w);return C.addLayer(E),E}function t(C,w){return C.getLayers().getArray().find(E=>E.get("id")===w)}function i(C,w){const E=t(C,w);E&&C.removeLayer(E)}function r(C,w){const E=C.getLayers().getArray();w.forEach((T,k)=>{E.find(O=>O.get("id")===T.id)?.setZIndex(k+1)})}function o(C,w,E){const T=C.getLayers().getArray().find(k=>k.get("id")===w);T&&T.setOpacity(E)}function s(C,w){const E=la(),T=t(C,w.id),k=E.getLayerCurrentTime(w);k&&T&&Tpe.setLayerTime(T,k)}function l(C){Nm.delete(C)}function u(C){return Nm.has(C.id)}function h(C,w){Nm.set(C,w)}function d(C){const w=C.id,E=Nm.get(w);if(E)return E;{const T=cv.createOlLayer(C);return h(w,T),T}}function m(C){return C&&Nm.get(C.id)||null}function y(C,w){const T=C.getLayers().getArray().find(k=>k.getZIndex()===Xx);T&&w(T)}function x(C,w,E){const T=C.getLayers(),k=T.getArray().findIndex(V=>V.getZIndex()===Xx),G=T.getArray()[k]?.get("id");let O;w&&(u(w)?O=m(w):(O=cv.createOlLayer(w,E),h(w.id,O))),k>=0?O?(O.setZIndex(Xx),T.setAt(k,O)):T.removeAt(k):O&&(O.setZIndex(Xx),C.addLayer(O)),G&&G!==w?.id&&JZ.restore(!0)}return{addLayer:n,addFeatureLayer:e,findLayer:t,removeLayer:i,removeFromCache:l,reorderLayers:r,setLayerOpacity:o,setLayerTime:s,getLayerFromCache:m,setBgLayer:x,applyOnBgLayer:y}}const yW=ca("profile-position",()=>{const n=Ue(void 0),e=Ue(void 0);function t(i,r){n.value=i,e.value=r}return{x:n,y:e,setPosition:t}},{}),_W="lux-feat-position";let Sm;function Rpe(n,e=!0){const t=Mk(),i=yW(),r=zr(),{drawStateActive:o,editStateActive:s}=It(r),{x:l,y:u}=It(i),h=mi(n),d=mi(void 0),m=Ue(!0),y=new qi([0,0]),x=Ue(!0),C=zB(z=>V(z),15);let w,E;sr(()=>{w=Kn().getOlMap(),T(),G()}),Ms(()=>O()),Pt(()=>T9(e),z=>{x.value=z??!0,z||Sm?.removeGeoMarker()}),Pt(h,z=>{z&&k(z)}),Pt([l,u],([z,H])=>{x.value&&!o.value&&z&&H&&m.value?Sm?.moveGeoMarker(z,H):Sm?.removeGeoMarker()});function T(){if(Sm)return;const z={id:_W,type:"position"};Sm=t.addFeatureLayer(w,z)}function k(z){const H=z?.map(te=>{const $=Ir([te.x,te.y],Ml,w.getView().getProjection());return new zi($).getCoordinates().concat(te.dist)});y.setCoordinates(H)}function G(){E===void 0&&(E=mn(w,"pointermove",C))}function O(){E&&(mr(E),E=void 0,Sm?.removeGeoMarker())}function V(z){if(z.dragging||o.value||!x.value)return;let H,te;const $=w.getEventCoordinate(z.originalEvent),ae=y.getClosestPoint($),fe=ae[0]-$[0],Y=ae[1]-$[1],de=fe*fe+Y*Y,D=w.getView().getResolution();de/(D*D)<64?(d.value=ae[2],m.value=s.value!=="editLine",H=ae[0],te=ae[1]):(d.value=-1,m.value=!0),H!==void 0&&te!==void 0&&i.setPosition(H,te)}return{profileData:h,highlightDistance:d}}class IA{encodeOptions;constructor(e){this.encodeOptions={dataProjection:Sl,featureProjection:e.getView().getProjection()}}download(e,t,i="txt",r="text/plain"){const o=`${WO(e)}.${WO(i)}`;XB(o,t,r)}exploseFeatures(e){const t=[];return(Array.isArray(e)?e:[e]).forEach(i=>{switch(i.getGeometry()?.getType()){case"GeometryCollection":{i.getGeometry().getGeometriesArray().forEach(o=>t.push(this.cloneFeatureWithGeom(i,o)));break}case"MultiLineString":{i.getGeometry().getLineStrings().forEach(o=>t.push(this.cloneFeatureWithGeom(i,o)));break}case"Circle":{const r=new Rl(i);t.push(hk(r));break}default:t.push(i);break}}),t}cloneFeatureWithGeom(e,t){const i=e.clone();return i.setGeometry(t),i}}class vW extends UM{constructor(){super(),this.xmlSerializer_=gse()}getType(){return"xml"}readFeature(e,t){if(!e)return null;if(typeof e=="string"){const i=wc(e);return this.readFeatureFromDocument(i,t)}return Cc(e)?this.readFeatureFromDocument(e,t):this.readFeatureFromNode(e,t)}readFeatureFromDocument(e,t){const i=this.readFeaturesFromDocument(e,t);return i.length>0?i[0]:null}readFeatureFromNode(e,t){return null}readFeatures(e,t){if(!e)return[];if(typeof e=="string"){const i=wc(e);return this.readFeaturesFromDocument(i,t)}return Cc(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)}readFeaturesFromDocument(e,t){const i=[];for(let r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&nr(i,this.readFeaturesFromNode(r,t));return i}readFeaturesFromNode(e,t){return Zn()}readGeometry(e,t){if(!e)return null;if(typeof e=="string"){const i=wc(e);return this.readGeometryFromDocument(i,t)}return Cc(e)?this.readGeometryFromDocument(e,t):this.readGeometryFromNode(e,t)}readGeometryFromDocument(e,t){return null}readGeometryFromNode(e,t){return null}readProjection(e){if(!e)return null;if(typeof e=="string"){const t=wc(e);return this.readProjectionFromDocument(t)}return Cc(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(e){return this.dataProjection}readProjectionFromNode(e){return this.dataProjection}writeFeature(e,t){const i=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(e,t){return null}writeFeatures(e,t){const i=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(e,t){return null}writeGeometry(e,t){const i=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(e,t){return null}}const qr=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Mpe="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",kpe={rte:xW,trk:IW,wpt:CW},Lpe=Nt(qr,{rte:Ha(xW),trk:Ha(IW),wpt:Ha(CW)}),Ppe=Nt(qr,{text:ut(pn,"linkText"),type:ut(pn,"linkType")}),Gpe=Nt(qr,{name:ut(pn),email:oge,link:Fb}),Fpe=Nt(qr,{name:ut(pn),desc:ut(pn),author:ut(ige),copyright:ut(rge),link:Fb,time:ut(fA),keywords:ut(pn),bounds:sge,extensions:CA}),Ope=Nt(qr,{year:ut(wl),license:ut(pn)}),Npe=Nt(qr,{rte:jt(cge),trk:jt(hge),wpt:jt(fge)});let bW=class extends vW{constructor(e){super(),e=e||{},this.dataProjection=Ni("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,i=e.length;t<i;++t){const r=e[t];if(this.readExtensions_){const o=r.get("extensionsNode_")||null;this.readExtensions_(r,o)}r.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(wc(e)):Cc(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const i=this.readMetadataFromNode(t);if(i)return i}return null}readMetadataFromNode(e){if(!qr.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(qr.includes(t.namespaceURI)&&t.localName==="metadata")return Ln({},Fpe,t,[]);return null}readFeatureFromNode(e,t){if(!qr.includes(e.namespaceURI))return null;const i=kpe[e.localName];if(!i)return null;const r=i(e,[this.getReadOptions(e,t)]);return r?(this.handleReadExtensions_([r]),r):null}readFeaturesFromNode(e,t){if(!qr.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const i=Ln([],Lpe,e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_(i),i):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=qh("http://www.topografix.com/GPX/1/1","gpx");return i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",DC),i.setAttributeNS(DC,"xsi:schemaLocation",Mpe),i.setAttribute("version","1.1"),i.setAttribute("creator","OpenLayers"),Fr({node:i},Npe,nge,e,[t]),i}};const Dpe=Nt(qr,{name:ut(pn),cmt:ut(pn),desc:ut(pn),src:ut(pn),link:Fb,number:ut(wl),extensions:CA,type:ut(pn),rtept:age}),Vpe=Nt(qr,{ele:ut(rr),time:ut(fA)}),Bpe=Nt(qr,{name:ut(pn),cmt:ut(pn),desc:ut(pn),src:ut(pn),link:Fb,number:ut(wl),type:ut(pn),extensions:CA,trkseg:uge}),Zpe=Nt(qr,{trkpt:lge}),Wpe=Nt(qr,{ele:ut(rr),time:ut(fA)}),zpe=Nt(qr,{ele:ut(rr),time:ut(fA),magvar:ut(rr),geoidheight:ut(rr),name:ut(pn),cmt:ut(pn),desc:ut(pn),src:ut(pn),link:Fb,sym:ut(pn),type:ut(pn),fix:ut(pn),sat:ut(wl),hdop:ut(rr),vdop:ut(rr),pdop:ut(rr),ageofdgpsdata:ut(rr),dgpsid:ut(wl),extensions:CA}),Upe=["text","type"],Xpe=Nt(qr,{text:jt(ar),type:jt(ar)}),Ype=Nt(qr,["name","cmt","desc","src","link","number","type","rtept"]),Hpe=Nt(qr,{name:jt(ar),cmt:jt(ar),desc:jt(ar),src:jt(ar),link:jt(Pk),number:jt(VC),type:jt(ar),rtept:LB(jt(Gk))}),Kpe=Nt(qr,["ele","time"]),jpe=Nt(qr,["name","cmt","desc","src","link","number","type","trkseg"]),$pe=Nt(qr,{name:jt(ar),cmt:jt(ar),desc:jt(ar),src:jt(ar),link:jt(Pk),number:jt(VC),type:jt(ar),trkseg:LB(jt(dge))}),Jpe=Zu("trkpt"),qpe=Nt(qr,{trkpt:jt(Gk)}),Qpe=Nt(qr,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),ege=Nt(qr,{ele:jt(Za),time:jt(xse),magvar:jt(Za),geoidheight:jt(Za),name:jt(ar),cmt:jt(ar),desc:jt(ar),src:jt(ar),link:jt(Pk),sym:jt(ar),type:jt(ar),fix:jt(ar),sat:jt(VC),hdop:jt(Za),vdop:jt(Za),pdop:jt(Za),ageofdgpsdata:jt(Za),dgpsid:jt(VC)}),tge={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function nge(n,e,t){const i=n.getGeometry();if(i){const r=tge[i.getType()];if(r){const o=e[e.length-1].node;return qh(o.namespaceURI,r)}}}function kk(n,e,t,i){return n.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in i?(n.push(i.ele),delete i.ele,e.hasZ=!0):n.push(0),"time"in i?(n.push(i.time),delete i.time,e.hasM=!0):n.push(0),n}function Lk(n,e,t){let i="XY",r=2;if(n.hasZ&&n.hasM?(i="XYZM",r=4):n.hasZ?(i="XYZ",r=3):n.hasM&&(i="XYM",r=3),r!==4){for(let o=0,s=e.length/4;o<s;o++)e[o*r]=e[o*4],e[o*r+1]=e[o*4+1],n.hasZ&&(e[o*r+2]=e[o*4+2]),n.hasM&&(e[o*r+2]=e[o*4+3]);if(e.length=e.length/4*r,t)for(let o=0,s=t.length;o<s;o++)t[o]=t[o]/4*r}return i}function ige(n,e){const t=Ln({},Gpe,n,e);if(t)return t}function rge(n,e){const t=Ln({},Ope,n,e);if(t){const i=n.getAttribute("author");return i!==null&&(t.author=i),t}}function sge(n,e){const t=e[e.length-1],i=n.getAttribute("minlat"),r=n.getAttribute("minlon"),o=n.getAttribute("maxlat"),s=n.getAttribute("maxlon");r!==null&&i!==null&&s!==null&&o!==null&&(t.bounds=[[parseFloat(r),parseFloat(i)],[parseFloat(s),parseFloat(o)]])}function oge(n,e){const t=e[e.length-1],i=n.getAttribute("id"),r=n.getAttribute("domain");i!==null&&r!==null&&(t.email=`${i}@${r}`)}function Fb(n,e){const t=e[e.length-1],i=n.getAttribute("href");i!==null&&(t.link=i),Tf(Ppe,n,e)}function CA(n,e){const t=e[e.length-1];t.extensionsNode_=n}function age(n,e){const t=Ln({},Vpe,n,e);if(t){const i=e[e.length-1],r=i.flatCoordinates,o=i.layoutOptions;kk(r,o,n,t)}}function lge(n,e){const t=Ln({},Wpe,n,e);if(t){const i=e[e.length-1],r=i.flatCoordinates,o=i.layoutOptions;kk(r,o,n,t)}}function uge(n,e){const t=e[e.length-1];Tf(Zpe,n,e);const i=t.flatCoordinates;t.ends.push(i.length)}function xW(n,e){const t=e[0],i=Ln({flatCoordinates:[],layoutOptions:{}},Dpe,n,e);if(!i)return;const r=i.flatCoordinates;delete i.flatCoordinates;const o=i.layoutOptions;delete i.layoutOptions;const s=Lk(o,r),l=new qi(r,s);ru(l,!1,t);const u=new yi(l);return u.setProperties(i,!0),u}function IW(n,e){const t=e[0],i=Ln({flatCoordinates:[],ends:[],layoutOptions:{}},Bpe,n,e);if(!i)return;const r=i.flatCoordinates;delete i.flatCoordinates;const o=i.ends;delete i.ends;const s=i.layoutOptions;delete i.layoutOptions;const l=Lk(s,r,o),u=new Du(r,l,o);ru(u,!1,t);const h=new yi(u);return h.setProperties(i,!0),h}function CW(n,e){const t=e[0],i=Ln({},zpe,n,e);if(!i)return;const r={},o=kk([],r,n,i),s=Lk(r,o),l=new zi(o,s);ru(l,!1,t);const u=new yi(l);return u.setProperties(i,!0),u}function Pk(n,e,t){n.setAttribute("href",e);const r=t[t.length-1].properties,o=[r.linkText,r.linkType];Fr({node:n},Xpe,ua,o,t,Upe)}function Gk(n,e,t){const i=t[t.length-1],o=i.node.namespaceURI,s=i.properties;switch(n.setAttributeNS(null,"lat",String(e[1])),n.setAttributeNS(null,"lon",String(e[0])),i.geometryLayout){case"XYZM":e[3]!==0&&(s.time=e[3]);case"XYZ":e[2]!==0&&(s.ele=e[2]);break;case"XYM":e[2]!==0&&(s.time=e[2]);break}const u=n.nodeName=="rtept"?Kpe[o]:Qpe[o],h=tl(s,u);Fr({node:n,properties:s},ege,ua,h,t,u)}function cge(n,e,t){const i=t[0],r=e.getProperties(),o={node:n};o.properties=r;const s=e.getGeometry();if(s.getType()=="LineString"){const d=ru(s,!0,i);o.geometryLayout=d.getLayout(),r.rtept=d.getCoordinates()}const l=t[t.length-1].node,u=Ype[l.namespaceURI],h=tl(r,u);Fr(o,Hpe,ua,h,t,u)}function hge(n,e,t){const i=t[0],r=e.getProperties(),o={node:n};o.properties=r;const s=e.getGeometry();if(s.getType()=="MultiLineString"){const d=ru(s,!0,i);r.trkseg=d.getLineStrings()}const l=t[t.length-1].node,u=jpe[l.namespaceURI],h=tl(r,u);Fr(o,$pe,ua,h,t,u)}function dge(n,e,t){const i={node:n};i.geometryLayout=e.getLayout(),i.properties={},Fr(i,qpe,Jpe,e.getCoordinates(),t)}function fge(n,e,t){const i=t[0],r=t[t.length-1];r.properties=e.getProperties();const o=e.getGeometry();if(o.getType()=="Point"){const s=ru(o,!0,i);r.geometryLayout=s.getLayout(),Gk(n,s.getCoordinates(),t)}}class pge extends bW{writeFeaturesNode(e,t){const i=super.writeFeaturesNode(e,t);if("metadata"in t&&"name"in t.metadata){const r="http://www.topografix.com/GPX/1/1",o=qh(r,"metadata"),s=qh(r,"name");ar(s,t.metadata.name),o.appendChild(s),i.childNodes.length>0?i.insertBefore(o,i.childNodes[0]):i.appendChild(o)}return i}}class gge extends IA{export(e,t,i=!1){const r=this.prepareFeatures(e,i),o=this.generateContent(r,t);this.download(t,o,"gpx","application/gpx")}prepareFeatures(e,t=!1){e.forEach(r=>{const o=r.getProperties();"feature_name"in o&&r.set("name",o.feature_name,!0)});let i=this.exploseFeatures(e);return t?i=this.changeLineToMultiline(i):i=this.changeMultilineToLine(i),i=this.changePolygonToLine(i),i}generateContent(e,t){return new pge().writeFeatures(this.orderFeaturesForGpx(e),{...this.encodeOptions,metadata:{name:t}})}changePolygonToLine(e){return e.map(t=>{if(t.getGeometry()?.getType()==="Polygon"){const o=t.getGeometry().getLinearRing(0)?.getCoordinates()||[],s=new qi(o);return this.cloneFeatureWithGeom(t,s)}return t})}changeMultilineToLine(e){return e.reduce((t,i)=>{const r=i.getGeometry();return r?.getType()==="MultiLineString"?r.getLineStrings().forEach(s=>t.push(this.cloneFeatureWithGeom(i,s))):t.push(i),t},[])}changeLineToMultiline(e){return e.map(t=>{const i=t.getGeometry();return i?.getType()==="LineString"?this.cloneFeatureWithGeom(t,new Du([i.getCoordinates()])):t})}orderFeaturesForGpx(e){const t=[],i=[],r=[];return e.forEach(o=>{switch(o.getGeometry()?.getType()){case"Point":t.push(o);break;case"LineString":i.push(o);break;default:r.push(o);break}}),[...t,...i,...r]}}const ad=["http://www.google.com/kml/ext/2.2"],Gn=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],mge="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",R5={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},yge=Nt(Gn,{ExtendedData:VW,Region:BW,MultiGeometry:ut(OW,"geometry"),LineString:ut(GW,"geometry"),LinearRing:ut(FW,"geometry"),Point:ut(NW,"geometry"),Polygon:ut(DW,"geometry"),Style:ut(Nk),StyleMap:Qge,address:ut(pn),description:ut(pn),name:ut(pn),open:ut(bf),phoneNumber:ut(pn),styleUrl:ut(RW),visibility:ut(bf)},Nt(ad,{MultiTrack:ut(Bge,"geometry"),Track:ut(PW,"geometry")})),_ge=Nt(Gn,{ExtendedData:VW,Region:BW,Link:hme,address:ut(pn),description:ut(pn),name:ut(pn),open:ut(bf),phoneNumber:ut(pn),visibility:ut(bf)}),vge=Nt(Gn,{href:ut(TW)}),bge=Nt(Gn,{Altitude:ut(rr),Longitude:ut(rr),Latitude:ut(rr),Tilt:ut(rr),AltitudeMode:ut(pn),Heading:ut(rr),Roll:ut(rr)}),wW=Nt(Gn,{LatLonAltBox:rme,Lod:ome}),xge=Nt(Gn,["Document","Placemark"]),Ige=Nt(Gn,{Document:jt(vme),Placemark:jt(zW)});let _y,kI=null,nR,hv,dv,fv,cw,iR=null,Fk,rR=null,sR,Vp=null,M5=null,oR=null;function hw(n){return 32/Math.min(n[0],n[1])}function Cge(){_y=[255,255,255,1],kI=new Di({color:_y}),nR=[20,2],hv="pixels",dv="pixels",fv=[64,64],cw="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",iR=new Nu({anchor:nR,anchorOrigin:"bottom-left",anchorXUnits:hv,anchorYUnits:dv,crossOrigin:"anonymous",rotation:0,scale:hw(fv),size:fv,src:cw}),Fk="NO_IMAGE",rR=new bi({color:_y,width:1}),sR=new bi({color:[51,51,51,1],width:2}),Vp=new Wc({font:"bold 16px Helvetica",fill:kI,stroke:sR,scale:.8}),M5=new Hn({fill:kI,image:iR,text:Vp,stroke:rR,zIndex:0}),oR=[M5]}let Yx;function wge(n){return n}class AW extends vW{constructor(e){super(),e=e||{},oR||Cge(),this.dataProjection=Ni("EPSG:4326"),this.defaultStyle_=e.defaultStyle?e.defaultStyle:oR,this.extractStyles_=e.extractStyles!==void 0?e.extractStyles:!0,this.writeStyles_=e.writeStyles!==void 0?e.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=e.showPointNames!==void 0?e.showPointNames:!0,this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",this.iconUrlFunction_=e.iconUrlFunction?e.iconUrlFunction:wge,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(e,t){const i=Nt(Gn,{Document:PO(this.readDocumentOrFolder_,this),Folder:PO(this.readDocumentOrFolder_,this),Placemark:Ha(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),r=Ln([],i,e,t,this);if(r)return r}readPlacemark_(e,t){const i=Ln({geometry:null},yge,e,t,this);if(!i)return;const r=new yi,o=e.getAttribute("id");o!==null&&r.setId(o);const s=t[0],l=i.geometry;if(l&&ru(l,!1,s),r.setGeometry(l),delete i.geometry,this.extractStyles_){const u=i.Style,h=i.styleUrl,d=Sge(u,h,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);r.setStyle(d)}return delete i.Style,r.setProperties(i,!0),r}readSharedStyle_(e,t){const i=e.getAttribute("id");if(i!==null){const r=Nk.call(this,e,t);if(r){let o,s=e.baseURI;(!s||s=="about:blank")&&(s=window.location.href),s?o=new URL("#"+i,s).href:o="#"+i,this.sharedStyles_[o]=r}}}readSharedStyleMap_(e,t){const i=e.getAttribute("id");if(i===null)return;const r=kW.call(this,e,t);if(!r)return;let o,s=e.baseURI;(!s||s=="about:blank")&&(s=window.location.href),s?o=new URL("#"+i,s).href:o="#"+i,this.sharedStyles_[o]=r}readFeatureFromNode(e,t){if(!Gn.includes(e.namespaceURI))return null;const i=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return i||null}readFeaturesFromNode(e,t){if(!Gn.includes(e.namespaceURI))return[];let i;const r=e.localName;if(r=="Document"||r=="Folder")return i=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]),i||[];if(r=="Placemark"){const o=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return o?[o]:[]}if(r=="kml"){i=[];for(let o=e.firstElementChild;o;o=o.nextElementSibling){const s=this.readFeaturesFromNode(o,t);s&&nr(i,s)}return i}return[]}readName(e){if(e){if(typeof e=="string"){const t=wc(e);return this.readNameFromDocument(t)}return Cc(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}}readNameFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){const i=this.readNameFromNode(t);if(i)return i}}readNameFromNode(e){for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(Gn.includes(t.namespaceURI)&&t.localName=="name")return pn(t);for(let t=e.firstElementChild;t;t=t.nextElementSibling){const i=t.localName;if(Gn.includes(t.namespaceURI)&&(i=="Document"||i=="Folder"||i=="Placemark"||i=="kml")){const r=this.readNameFromNode(t);if(r)return r}}}readNetworkLinks(e){const t=[];if(typeof e=="string"){const i=wc(e);nr(t,this.readNetworkLinksFromDocument(i))}else Cc(e)?nr(t,this.readNetworkLinksFromDocument(e)):nr(t,this.readNetworkLinksFromNode(e));return t}readNetworkLinksFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&nr(t,this.readNetworkLinksFromNode(i));return t}readNetworkLinksFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(Gn.includes(i.namespaceURI)&&i.localName=="NetworkLink"){const r=Ln({},_ge,i,[]);t.push(r)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Gn.includes(i.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&nr(t,this.readNetworkLinksFromNode(i))}return t}readRegion(e){const t=[];if(typeof e=="string"){const i=wc(e);nr(t,this.readRegionFromDocument(i))}else Cc(e)?nr(t,this.readRegionFromDocument(e)):nr(t,this.readRegionFromNode(e));return t}readRegionFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&nr(t,this.readRegionFromNode(i));return t}readRegionFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(Gn.includes(i.namespaceURI)&&i.localName=="Region"){const r=Ln({},wW,i,[]);t.push(r)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Gn.includes(i.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&nr(t,this.readRegionFromNode(i))}return t}readCamera(e){const t=[];if(typeof e=="string"){const i=wc(e);nr(t,this.readCameraFromDocument(i))}else Cc(e)?nr(t,this.readCameraFromDocument(e)):nr(t,this.readCameraFromNode(e));return t}readCameraFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType===Node.ELEMENT_NODE&&nr(t,this.readCameraFromNode(i));return t}readCameraFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(Gn.includes(i.namespaceURI)&&i.localName==="Camera"){const r=Ln({},bge,i,[]);t.push(r)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Gn.includes(i.namespaceURI)&&(r==="Document"||r==="Folder"||r==="Placemark"||r==="kml")&&nr(t,this.readCameraFromNode(i))}return t}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=qh(Gn[4],"kml"),r="http://www.w3.org/2000/xmlns/";i.setAttributeNS(r,"xmlns:gx",ad[0]),i.setAttributeNS(r,"xmlns:xsi",DC),i.setAttributeNS(DC,"xsi:schemaLocation",mge);const o={node:i},s={};e.length>1?s.Document=e:e.length==1&&(s.Placemark=e[0]);const l=xge[i.namespaceURI],u=tl(s,l);return Fr(o,Ige,ua,u,[t],l,this),i}}function Age(n,e){const t=[0,0];let i="start";const r=n.getImage();if(r){const l=r.getSize();if(l&&l.length==2){const u=r.getScaleArray(),h=r.getAnchor();t[0]=u[0]*(l[0]-h[0]),t[1]=u[1]*(l[1]/2-h[1]),i="left"}}let o=n.getText();return o?(o=o.clone(),o.setFont(o.getFont()||Vp.getFont()),o.setScale(o.getScale()||Vp.getScale()),o.setFill(o.getFill()||Vp.getFill()),o.setStroke(o.getStroke()||sR)):o=Vp.clone(),o.setText(e),o.setOffsetX(t[0]),o.setOffsetY(t[1]),o.setTextAlign(i),new Hn({image:r,text:o})}function Sge(n,e,t,i,r){return(function(o,s){let l=r,u="",h=[];if(l){const m=o.getGeometry();if(m)if(m instanceof ql)h=m.getGeometriesArrayRecursive().filter(function(y){const x=y.getType();return x==="Point"||x==="MultiPoint"}),l=h.length>0;else{const y=m.getType();l=y==="Point"||y==="MultiPoint"}}l&&(u=o.get("name"),l=l&&!!u,l&&/&[^&]+;/.test(u)&&(Yx||(Yx=document.createElement("textarea")),Yx.innerHTML=u,u=Yx.value));let d=t;if(n?d=n:e&&(d=SW(e,t,i)),l){const m=Age(d[0],u);if(h.length>0){m.setGeometry(new ql(h));const y=new Hn({geometry:d[0].getGeometry(),image:null,fill:d[0].getFill(),stroke:d[0].getStroke(),text:null});return[m,y].concat(d.slice(1))}return m}return d})}function SW(n,e,t){return Array.isArray(n)?n:typeof n=="string"?SW(t[n],e,t):e}function wA(n){const e=Bu(n,!1),t=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(t){const i=t[1];return[parseInt(i.substr(6,2),16),parseInt(i.substr(4,2),16),parseInt(i.substr(2,2),16),parseInt(i.substr(0,2),16)/255]}}function EW(n){let e=Bu(n,!1);const t=[];e=e.replace(/\s*,\s*/g,",");const i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let r;for(;r=i.exec(e);){const o=parseFloat(r[1]),s=parseFloat(r[2]),l=r[3]?parseFloat(r[3]):0;t.push(o,s,l),e=e.substr(r[0].length)}if(e==="")return t}function TW(n){const e=Bu(n,!1).trim();let t=n.baseURI;return(!t||t=="about:blank")&&(t=window.location.href),t?new URL(e,t).href:e}function RW(n){const e=Bu(n,!1).trim().replace(/^(?!.*#)/,"#");let t=n.baseURI;return(!t||t=="about:blank")&&(t=window.location.href),t?new URL(e,t).href:e}function Ege(n){const e=n.getAttribute("xunits"),t=n.getAttribute("yunits");let i;return e!=="insetPixels"?t!=="insetPixels"?i="bottom-left":i="top-left":t!=="insetPixels"?i="bottom-right":i="top-right",{x:parseFloat(n.getAttribute("x")),xunits:R5[e],y:parseFloat(n.getAttribute("y")),yunits:R5[t],origin:i}}function MW(n){return rr(n)}const Tge=Nt(Gn,{Pair:qge});function kW(n,e){return Ln(void 0,Tge,n,e,this)}const Rge=Nt(Gn,{Icon:ut(zge),color:ut(wA),heading:ut(rr),hotSpot:ut(Ege),scale:ut(MW)});function Mge(n,e){const t=Ln({},Rge,n,e);if(!t)return;const i=e[e.length-1],r="Icon"in t?t.Icon:{},o=!("Icon"in t)||Object.keys(r).length>0;let s;const l=r.href;l?s=l:o&&(s=cw);let u,h,d,m="bottom-left";const y=t.hotSpot;y?(u=[y.x,y.y],h=y.xunits,d=y.yunits,m=y.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(s)&&(s.includes("pushpin")?(u=nR,h=hv,d=dv):s.includes("arrow-reverse")?(u=[54,42],h=hv,d=dv):s.includes("paddle")&&(u=[32,1],h=hv,d=dv));let x;const C=r.x,w=r.y;C!==void 0&&w!==void 0&&(x=[C,w]);let E;const T=r.w,k=r.h;T!==void 0&&k!==void 0&&(E=[T,k]);let G;const O=t.heading;O!==void 0&&(G=aa(O));const V=t.scale,z=t.color;if(o){s==cw&&(E=fv);const H=new Nu({anchor:u,anchorOrigin:m,anchorXUnits:h,anchorYUnits:d,crossOrigin:this.crossOrigin_,offset:x,offsetOrigin:"bottom-left",rotation:G,scale:V,size:E,src:this.iconUrlFunction_(s),color:z}),te=H.getScaleArray()[0],$=H.getSize();if($===null){const ae=H.getImageState();if(ae===Sn.IDLE||ae===Sn.LOADING){const fe=function(){const Y=H.getImageState();if(!(Y===Sn.IDLE||Y===Sn.LOADING)){const de=H.getSize();if(de&&de.length==2){const D=hw(de);H.setScale(te*D)}H.unlistenImageChange(fe)}};H.listenImageChange(fe),ae===Sn.IDLE&&H.load()}}else if($.length==2){const ae=hw($);H.setScale(te*ae)}i.imageStyle=H}else i.imageStyle=Fk}const kge=Nt(Gn,{color:ut(wA),scale:ut(MW)});function Lge(n,e){const t=Ln({},kge,n,e);if(!t)return;const i=e[e.length-1],r=new Wc({fill:new Di({color:"color"in t?t.color:_y}),scale:t.scale});i.textStyle=r}const Pge=Nt(Gn,{color:ut(wA),width:ut(rr)});function Gge(n,e){const t=Ln({},Pge,n,e);if(!t)return;const i=e[e.length-1],r=new bi({color:"color"in t?t.color:_y,width:"width"in t?t.width:1});i.strokeStyle=r}const Fge=Nt(Gn,{color:ut(wA),fill:ut(bf),outline:ut(bf)});function Oge(n,e){const t=Ln({},Fge,n,e);if(!t)return;const i=e[e.length-1],r=new Di({color:"color"in t?t.color:_y});i.fillStyle=r;const o=t.fill;o!==void 0&&(i.fill=o);const s=t.outline;s!==void 0&&(i.outline=s)}const Nge=Nt(Gn,{coordinates:sk(EW)});function LW(n,e){return Ln(null,Nge,n,e)}function Dge(n,e){const i=e[e.length-1].coordinates,r=Bu(n,!1),s=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(r);if(s){const l=parseFloat(s[1]),u=parseFloat(s[2]),h=parseFloat(s[3]);i.push([l,u,h])}else i.push([])}const Vge=Nt(ad,{Track:Ha(PW)});function Bge(n,e){const t=Ln([],Vge,n,e);if(t)return new Du(t)}const Zge=Nt(Gn,{when:dme},Nt(ad,{coord:Dge}));function PW(n,e){const t=Ln({coordinates:[],whens:[]},Zge,n,e);if(!t)return;const i=[],r=t.coordinates,o=t.whens;for(let s=0,l=Math.min(r.length,o.length);s<l;++s)r[s].length==3&&i.push(r[s][0],r[s][1],r[s][2],o[s]);return new qi(i,"XYZM")}const Wge=Nt(Gn,{href:ut(TW)},Nt(ad,{x:ut(rr),y:ut(rr),w:ut(rr),h:ut(rr)}));function zge(n,e){const t=Ln({},Wge,n,e);return t||null}const Uge=Nt(Gn,{coordinates:sk(EW)});function Ok(n,e){return Ln(null,Uge,n,e)}const AA=Nt(Gn,{extrude:ut(bf),tessellate:ut(bf),altitudeMode:ut(pn)});function GW(n,e){const t=Ln({},AA,n,e),i=Ok(n,e);if(i){const r=new qi(i,"XYZ");return r.setProperties(t,!0),r}}function FW(n,e){const t=Ln({},AA,n,e),i=Ok(n,e);if(i){const r=new Bo(i,"XYZ",[i.length]);return r.setProperties(t,!0),r}}const Xge=Nt(Gn,{LineString:Ha(GW),LinearRing:Ha(FW),MultiGeometry:Ha(OW),Point:Ha(NW),Polygon:Ha(DW)});function OW(n,e){const t=Ln([],Xge,n,e);if(!t)return null;if(t.length===0)return new ql(t);let i,r=!0;const o=t[0].getType();let s;for(let l=1,u=t.length;l<u;++l)if(s=t[l],s.getType()!=o){r=!1;break}if(r){let l,u;if(o=="Point"){const h=t[0];l=h.getLayout(),u=h.getFlatCoordinates();for(let d=1,m=t.length;d<m;++d)s=t[d],nr(u,s.getFlatCoordinates());i=new $h(u,l),jS(i,t)}else if(o=="LineString")i=new Du(t),jS(i,t);else if(o=="Polygon")i=new vf(t),jS(i,t);else if(o=="GeometryCollection"||o.startsWith("Multi"))i=new ql(t);else throw new Error("Unknown geometry type found")}else i=new ql(t);return i}function NW(n,e){const t=Ln({},AA,n,e),i=Ok(n,e);if(i){const r=new zi(i,"XYZ");return r.setProperties(t,!0),r}}const Yge=Nt(Gn,{innerBoundaryIs:lme,outerBoundaryIs:cme});function DW(n,e){const t=Ln({},AA,n,e),i=Ln([null],Yge,n,e);if(i&&i[0]){const r=i[0],o=[r.length];for(let l=1,u=i.length;l<u;++l)nr(r,i[l]),o.push(r.length);const s=new Bo(r,"XYZ",o);return s.setProperties(t,!0),s}}const Hge=Nt(Gn,{IconStyle:Mge,LabelStyle:Lge,LineStyle:Gge,PolyStyle:Oge});function Nk(n,e){const t=Ln({},Hge,n,e,this);if(!t)return null;let i="fillStyle"in t?t.fillStyle:kI;const r=t.fill;r!==void 0&&!r&&(i=null);let o;"imageStyle"in t?t.imageStyle!=Fk&&(o=t.imageStyle):o=iR;const s="textStyle"in t?t.textStyle:Vp,l="strokeStyle"in t?t.strokeStyle:rR,u=t.outline;return u!==void 0&&!u?[new Hn({geometry:function(h){const d=h.getGeometry(),m=d.getType();if(m==="GeometryCollection"){const y=d;return new ql(y.getGeometriesArrayRecursive().filter(function(x){const C=x.getType();return C!=="Polygon"&&C!=="MultiPolygon"}))}if(m!=="Polygon"&&m!=="MultiPolygon")return d},fill:i,image:o,stroke:l,text:s,zIndex:void 0}),new Hn({geometry:function(h){const d=h.getGeometry(),m=d.getType();if(m==="GeometryCollection"){const y=d;return new ql(y.getGeometriesArrayRecursive().filter(function(x){const C=x.getType();return C==="Polygon"||C==="MultiPolygon"}))}if(m==="Polygon"||m==="MultiPolygon")return d},fill:i,stroke:null,zIndex:void 0})]:[new Hn({fill:i,image:o,stroke:l,text:s,zIndex:void 0})]}function jS(n,e){const t=e.length,i=new Array(e.length),r=new Array(e.length),o=new Array(e.length);let s,l,u;s=!1,l=!1,u=!1;for(let h=0;h<t;++h){const d=e[h];i[h]=d.get("extrude"),r[h]=d.get("tessellate"),o[h]=d.get("altitudeMode"),s=s||i[h]!==void 0,l=l||r[h]!==void 0,u=u||o[h]}s&&n.set("extrude",i),l&&n.set("tessellate",r),u&&n.set("altitudeMode",o)}const Kge=Nt(Gn,{displayName:ut(pn),value:ut(pn)});function jge(n,e){const t=n.getAttribute("name");Tf(Kge,n,e);const i=e[e.length-1];t&&i.displayName?i[t]={value:i.value,displayName:i.displayName,toString:function(){return i.value}}:t!==null?i[t]=i.value:i.displayName!==null&&(i[i.displayName]=i.value),delete i.value}const $ge=Nt(Gn,{Data:jge,SchemaData:tme});function VW(n,e){Tf($ge,n,e)}function BW(n,e){Tf(wW,n,e)}const Jge=Nt(Gn,{Style:ut(Nk),key:ut(pn),styleUrl:ut(RW)});function qge(n,e){const t=Ln({},Jge,n,e,this);if(!t)return;const i=t.key;if(i&&i=="normal"){const r=t.styleUrl;r&&(e[e.length-1]=r);const o=t.Style;o&&(e[e.length-1]=o)}}function Qge(n,e){const t=kW.call(this,n,e);if(!t)return;const i=e[e.length-1];if(Array.isArray(t))i.Style=t;else if(typeof t=="string")i.styleUrl=t;else throw new Error("`styleMapValue` has an unknown type")}const eme=Nt(Gn,{SimpleData:nme});function tme(n,e){Tf(eme,n,e)}function nme(n,e){const t=n.getAttribute("name");if(t!==null){const i=pn(n),r=e[e.length-1];r[t]=i}}const ime=Nt(Gn,{altitudeMode:ut(pn),minAltitude:ut(rr),maxAltitude:ut(rr),north:ut(rr),south:ut(rr),east:ut(rr),west:ut(rr)});function rme(n,e){const t=Ln({},ime,n,e);if(!t)return;const i=e[e.length-1],r=[parseFloat(t.west),parseFloat(t.south),parseFloat(t.east),parseFloat(t.north)];i.extent=r,i.altitudeMode=t.altitudeMode,i.minAltitude=parseFloat(t.minAltitude),i.maxAltitude=parseFloat(t.maxAltitude)}const sme=Nt(Gn,{minLodPixels:ut(rr),maxLodPixels:ut(rr),minFadeExtent:ut(rr),maxFadeExtent:ut(rr)});function ome(n,e){const t=Ln({},sme,n,e);if(!t)return;const i=e[e.length-1];i.minLodPixels=parseFloat(t.minLodPixels),i.maxLodPixels=parseFloat(t.maxLodPixels),i.minFadeExtent=parseFloat(t.minFadeExtent),i.maxFadeExtent=parseFloat(t.maxFadeExtent)}const ame=Nt(Gn,{LinearRing:Ha(LW)});function lme(n,e){const t=Ln([],ame,n,e);t.length>0&&e[e.length-1].push(...t)}const ume=Nt(Gn,{LinearRing:sk(LW)});function cme(n,e){const t=Ln(void 0,ume,n,e);if(t){const i=e[e.length-1];i[0]=t}}function hme(n,e){Tf(vge,n,e)}function dme(n,e){const i=e[e.length-1].whens,r=Bu(n,!1),o=Date.parse(r);i.push(isNaN(o)?0:o)}function SA(n,e){const t=$l(e),r=[(t.length==4?t[3]:1)*255,t[2],t[1],t[0]];for(let o=0;o<4;++o){const s=Math.floor(r[o]).toString(16);r[o]=s.length==1?"0"+s:s}ar(n,r.join(""))}function fme(n,e,t){const i=t[t.length-1],r=i.layout,o=i.stride;let s;if(r=="XY"||r=="XYM")s=2;else if(r=="XYZ"||r=="XYZM")s=3;else throw new Error("Invalid geometry layout");const l=e.length;let u="";if(l>0){u+=e[0];for(let h=1;h<s;++h)u+=","+e[h];for(let h=o;h<l;h+=o){u+=" "+e[h];for(let d=1;d<s;++d)u+=","+e[h+d]}}ar(n,u)}const LI=Nt(Gn,{Data:jt(pme),value:jt(mme),displayName:jt(gme)});function pme(n,e,t){n.setAttribute("name",e.name);const i={node:n},r=e.value;typeof r=="object"?(r!==null&&r.displayName&&Fr(i,LI,ua,[r.displayName],t,["displayName"]),r!==null&&r.value&&Fr(i,LI,ua,[r.value],t,["value"])):Fr(i,LI,ua,[r],t,["value"])}function gme(n,e){ar(n,e)}function mme(n,e){ar(n,e)}const yme=Nt(Gn,{Placemark:jt(zW)}),_me=function(n,e,t){const i=e[e.length-1].node;return qh(i.namespaceURI,"Placemark")};function vme(n,e,t){Fr({node:n},yme,_me,e,t,void 0,this)}const bme=Zu("Data");function xme(n,e,t){const i={node:n},r=e.names,o=e.values,s=r.length;for(let l=0;l<s;l++)Fr(i,LI,bme,[{name:r[l],value:o[l]}],t)}const k5=Nt(Gn,["href"],Nt(ad,["x","y","w","h"])),L5=Nt(Gn,{href:jt(ar)},Nt(ad,{x:jt(Za),y:jt(Za),w:jt(Za),h:jt(Za)})),Ime=function(n,e,t){return qh(ad[0],"gx:"+t)};function Cme(n,e,t){const i={node:n},r=t[t.length-1].node;let o=k5[r.namespaceURI],s=tl(e,o);Fr(i,L5,ua,s,t,o),o=k5[ad[0]],s=tl(e,o),Fr(i,L5,Ime,s,t,o)}const wme=Nt(Gn,["scale","heading","Icon","color","hotSpot"]),Ame=Nt(Gn,{Icon:jt(Cme),color:jt(SA),heading:jt(Za),hotSpot:jt(qme),scale:jt(XW)});function Sme(n,e,t){const i={node:n},r={},o=e.getSrc(),s=e.getSize(),l=e.getImageSize(),u={href:o};if(s){u.w=s[0],u.h=s[1];const E=e.getAnchor(),T=e.getOrigin();if(T&&l&&T[0]!==0&&T[1]!==s[1]&&(u.x=T[0],u.y=l[1]-(T[1]+s[1])),E&&(E[0]!==s[0]/2||E[1]!==s[1]/2)){const k={x:E[0],xunits:"pixels",y:s[1]-E[1],yunits:"pixels"};r.hotSpot=k}}r.Icon=u;let h=e.getScaleArray()[0],d=s;if(d===null&&(d=fv),d.length==2){const E=hw(d);h=h/E}h!==1&&(r.scale=h);const m=e.getRotation();m!==0&&(r.heading=m);const y=e.getColor();y&&(r.color=y);const x=t[t.length-1].node,C=wme[x.namespaceURI],w=tl(r,C);Fr(i,Ame,ua,w,t,C)}const Eme=Nt(Gn,["color","scale"]),Tme=Nt(Gn,{color:jt(SA),scale:jt(XW)});function Rme(n,e,t){const i={node:n},r={},o=e.getFill();o&&(r.color=o.getColor());const s=e.getScale();s&&s!==1&&(r.scale=s);const l=t[t.length-1].node,u=Eme[l.namespaceURI],h=tl(r,u);Fr(i,Tme,ua,h,t,u)}const Mme=Nt(Gn,["color","width"]),kme=Nt(Gn,{color:jt(SA),width:jt(Za)});function Lme(n,e,t){const i={node:n},r={color:e.getColor(),width:Number(e.getWidth())||1},o=t[t.length-1].node,s=Mme[o.namespaceURI],l=tl(r,s);Fr(i,kme,ua,l,t,s)}const Pme={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},ZW=function(n,e,t){if(n){const i=e[e.length-1].node;return qh(i.namespaceURI,Pme[n.getType()])}},Gme=Zu("Point"),Fme=Zu("LineString"),Ome=Zu("LinearRing"),Nme=Zu("Polygon"),Dme=Nt(Gn,{LineString:jt(vy),Point:jt(vy),Polygon:jt(UW),GeometryCollection:jt(WW)});function WW(n,e,t){const i={node:n},r=e.getType();let o=[],s;if(r==="GeometryCollection")e.getGeometriesArrayRecursive().forEach(function(l){const u=l.getType();if(u==="MultiPoint")o=o.concat(l.getPoints());else if(u==="MultiLineString")o=o.concat(l.getLineStrings());else if(u==="MultiPolygon")o=o.concat(l.getPolygons());else if(u==="Point"||u==="LineString"||u==="Polygon")o.push(l);else throw new Error("Unknown geometry type")}),s=ZW;else if(r==="MultiPoint")o=e.getPoints(),s=Gme;else if(r==="MultiLineString")o=e.getLineStrings(),s=Fme;else if(r==="MultiPolygon")o=e.getPolygons(),s=Nme;else throw new Error("Unknown geometry type");Fr(i,Dme,s,o,t)}const Vme=Nt(Gn,{LinearRing:jt(vy)});function P5(n,e,t){Fr({node:n},Vme,Ome,[e],t)}const $S=Nt(Gn,{ExtendedData:jt(xme),MultiGeometry:jt(WW),LineString:jt(vy),LinearRing:jt(vy),Point:jt(vy),Polygon:jt(UW),Style:jt(Jme),address:jt(ar),description:jt(ar),name:jt(ar),open:jt(Ly),phoneNumber:jt(ar),styleUrl:jt(ar),visibility:jt(Ly)}),Bme=Nt(Gn,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),Zme=Zu("ExtendedData");function zW(n,e,t){const i={node:n};e.getId()&&n.setAttribute("id",e.getId());const r=e.getProperties(),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};o[e.getGeometryName()]=1;const s=Object.keys(r||{}).sort().filter(function(x){return!o[x]}),l=e.getStyleFunction();if(l){const x=l(e,0);if(x){const C=Array.isArray(x)?x:[x];let w=C;if(e.getGeometry()&&(w=C.filter(function(E){const T=E.getGeometryFunction()(e);if(T){const k=T.getType();return k==="GeometryCollection"?T.getGeometriesArrayRecursive().filter(function(G){const O=G.getType();return O==="Point"||O==="MultiPoint"}).length:k==="Point"||k==="MultiPoint"}})),this.writeStyles_){let E=C,T=C;e.getGeometry()&&(E=C.filter(function(k){const G=k.getGeometryFunction()(e);if(G){const O=G.getType();return O==="GeometryCollection"?G.getGeometriesArrayRecursive().filter(function(V){const z=V.getType();return z==="LineString"||z==="MultiLineString"}).length:O==="LineString"||O==="MultiLineString"}}),T=C.filter(function(k){const G=k.getGeometryFunction()(e);if(G){const O=G.getType();return O==="GeometryCollection"?G.getGeometriesArrayRecursive().filter(function(V){const z=V.getType();return z==="Polygon"||z==="MultiPolygon"}).length:O==="Polygon"||O==="MultiPolygon"}})),r.Style={pointStyles:w,lineStyles:E,polyStyles:T}}if(w.length&&r.name===void 0){const E=w[0].getText();E&&(r.name=E.getText())}}}const u=t[t.length-1].node,h=Bme[u.namespaceURI],d=tl(r,h);if(Fr(i,$S,ua,d,t,h),s.length>0){const x=tl(r,s);Fr(i,$S,Zme,[{names:s,values:x}],t)}const m=t[0];let y=e.getGeometry();y&&(y=ru(y,!0,m)),Fr(i,$S,ZW,[y],t)}const Wme=Nt(Gn,["extrude","tessellate","altitudeMode","coordinates"]),zme=Nt(Gn,{extrude:jt(Ly),tessellate:jt(Ly),altitudeMode:jt(ar),coordinates:jt(fme)});function vy(n,e,t){const i=e.getFlatCoordinates(),r={node:n};r.layout=e.getLayout(),r.stride=e.getStride();const o=e.getProperties();o.coordinates=i;const s=t[t.length-1].node,l=Wme[s.namespaceURI],u=tl(o,l);Fr(r,zme,ua,u,t,l)}const Ume=Nt(Gn,["color","fill","outline"]),G5=Nt(Gn,{outerBoundaryIs:jt(P5),innerBoundaryIs:jt(P5)}),Xme=Zu("innerBoundaryIs"),Yme=Zu("outerBoundaryIs");function UW(n,e,t){const i=e.getLinearRings(),r=i.shift(),o={node:n};Fr(o,G5,Xme,i,t),Fr(o,G5,Yme,[r],t)}const Hme=Nt(Gn,{color:jt(SA),fill:jt(Ly),outline:jt(Ly)});function Kme(n,e,t){const i={node:n},r=e.getFill(),o=e.getStroke(),s={color:r?r.getColor():void 0,fill:r?void 0:!1,outline:o?void 0:!1},l=t[t.length-1].node,u=Ume[l.namespaceURI],h=tl(s,u);Fr(i,Hme,ua,h,t,u)}function XW(n,e){Za(n,Math.round(e*1e6)/1e6)}const jme=Nt(Gn,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),$me=Nt(Gn,{IconStyle:jt(Sme),LabelStyle:jt(Rme),LineStyle:jt(Lme),PolyStyle:jt(Kme)});function Jme(n,e,t){const i={node:n},r={};if(e.pointStyles.length){const u=e.pointStyles[0].getText();u&&(r.LabelStyle=u);const h=e.pointStyles[0].getImage();h&&typeof h.getSrc=="function"&&(r.IconStyle=h)}if(e.lineStyles.length){const u=e.lineStyles[0].getStroke();u&&(r.LineStyle=u)}if(e.polyStyles.length){const u=e.polyStyles[0].getStroke();u&&!r.LineStyle&&(r.LineStyle=u),r.PolyStyle=e.polyStyles[0]}const o=t[t.length-1].node,s=jme[o.namespaceURI],l=tl(r,s);Fr(i,$me,ua,l,t,s)}function qme(n,e){n.setAttribute("x",String(e.x)),n.setAttribute("y",String(e.y)),n.setAttribute("xunits",e.xunits),n.setAttribute("yunits",e.yunits)}class Qme extends IA{export(e,t){const i=this.generateContent(e);this.download(t,i,"kml","application/vnd.google-earth.kml+xml")}generateContent(e){return new AW().writeFeatures(this.exploseFeatures(e),this.encodeOptions)}}const eye="https://migration.geoportail.lu/mymaps/exportgpxkml";class tye extends IA{constructor(e){super(e),this.encodeOptions.dataProjection=Ml}async export(e,t){const i=this.generateContent(e),r=eye,o=new URLSearchParams({format:"shape",name:t,doc:i}),s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()});if(!s.ok)throw new Error("Error while requesting shapefile");const l=await s.blob();this.download(t,l,"zip","application/octet-stream")}generateContent(e){return new Qa().writeFeatures(this.exploseFeatures(e),this.encodeOptions)}async fetchFileContent(e,t){return await(await fetch("mymaps/exportgpxkml",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify({doc:e,format:"shape",name:t})})).blob()}}class nye extends IA{async export(e,t){const i=await this.generateContent(e);this.download(t,i,"csv","application/csv")}async generateContent(e){const t=await e.getProfile();return t?this.getCsvContent(t):""}getCsvContent(e){return e.reduce((i,r)=>i+this.getCsvContentRow(r),`dist,MNT,y,x,lon,lat
`)}getCsvContentRow(e){const t=bc([e.x,e.y],Ml);return`${e.dist},${e.values.dhm},${e.x},${e.y},${t[0]},${t[1]}
`}}class iye{export(e,t,i,r,o=!1){this.getExporter(e,t)?.export(i,r,o)}getExporter(e,t){switch(t){case"gpx":return new gge(e);case"kml":return new Qme(e);case"shapefile":return new tye(e);case"csv":return new nye(e)}}}const Ob=new iye,rye={"data-cy":"featItemProfile",class:"lux-profile relative"},sye={class:"flex justify-between w-full px-1 gap-3 whitespace-nowrap"},oye={class:"grow cursor-default","data-cy":"featItemProfileCumul"},aye=["aria-label"],lye={key:0,class:"no-print w-full absolute mt-2 text-center"},uye={class:"text-gray-700 rounded p-2 bg-[rgba(120,120,120,0.5)]"},cye="mnt",Dk=at({__name:"feature-elevation-profile",props:{feature:{},enableExportCSV:{type:Boolean,default:!0},activatePositioning:{type:Boolean,default:!0}},emits:["close"],setup(n){const e=n,t=Rpe(void 0,()=>e.activatePositioning),i=yW(),{t:r}=St(),o=Ct(()=>hb()?.vnode?.props?.onClose),s=mi(void 0),l=Ct(()=>s.value?.length||0),u=Ct(()=>s.value&&s.value[l.value-1]),h=Ct(()=>u.value?.elevationGain),d=Ct(()=>u.value?.elevationLoss),m=Ct(()=>u.value?.cumulativeElevation),y=Ct(()=>e.feature&&!s.value),x=Ct(()=>!e.feature);sr(()=>{e.feature&&e.feature.getProfile().then(T=>s.value=T)}),Ms(()=>{i.setPosition(void 0,void 0)}),Pt(()=>e.feature,(T,k)=>{T!==k&&(e.feature&&!e.feature.profileData?(s.value=void 0,e.feature?.getProfile().then(G=>s.value=G)):s.value=void 0)}),Pt(()=>e.feature?.profileData,(T,k)=>{T!==k&&(e.feature&&!e.feature.profileData?(s.value=void 0,e.feature?.getProfile().then(G=>s.value=G)):s.value=void 0)}),Pt(s,T=>t.profileData.value=T);function C(){e.feature&&Ob.export(e.feature?.map,"csv",e.feature,e.feature.label||cye)}function w(T){const k=Ir([T.x,T.y],Ml,e.feature?.map.getView().getProjection());i.setPosition(k[0],k[1])}function E(){i.setPosition(void 0,void 0)}return(T,k)=>{const G=kl("format-measure");return U(),ie("div",rye,[P("div",sye,[P("div",oye,[s.value?(U(),ie(Mt,{key:0},[P("span",null,[k[2]||(k[2]=Bt(" +",-1)),An(P("span",null,null,512),[[G,h.value,void 0,{elevation:!0}]])]),P("span",null,[k[3]||(k[3]=Bt(" ",-1)),An(P("span",null,null,512),[[G,d.value,void 0,{elevation:!0}]])]),P("span",null,[k[4]||(k[4]=Bt(" ",-1)),An(P("span",null,null,512),[[G,m.value,void 0,{elevation:!0}]])])],64)):Le("",!0)]),n.enableExportCSV&&s.value?(U(),ie("button",{key:0,"data-cy":"featItemProfileCSV",class:"profile-export no-print text-secondary hover:underline",onClick:k[0]||(k[0]=()=>C())},K(M(r)("Export csv")),1)):Le("",!0),o.value?(U(),ie("button",{key:1,"aria-label":M(r)("Close"),class:"fa-solid fa-close text-secondary hover:text-tertiary",onClick:k[1]||(k[1]=O=>T.$emit("close"))},null,8,aye)):Le("",!0)]),y.value||x.value?(U(),ie("div",lye,[P("span",uye,K(y.value?M(r)("Please wait, the profile is loading."):x.value?M(r)("Draw a line on the map to display an elevation profile."):""),1)])):Le("",!0),mt($Z,{profileData:s.value,class:"w-full",highlightDistance:M(t).highlightDistance.value,"onHover:profile":w,"onOut:profile":E},null,8,["profileData","highlightDistance"])])}}}),EA=ca("elevation-profile",()=>{const n=Ue(!1),e=Ue(!1),t=Ue(null);return{drawElevationProfileActive:n,justFinishedDrawing:e,currentProfileFeature:t}});function hye(){const n=Jn(),e=EA(),{drawElevationProfileActive:t,currentProfileFeature:i,justFinishedDrawing:r}=It(e),{elevationProfileToolbarOpen:o}=It(n);let s;const l=new t_({type:"LineString"});let u;const h=new Hn({fill:new Di({color:"rgba(255, 204, 51, 0.2)"}),stroke:new bi({color:"rgba(255, 204, 51, 1)",width:2}),image:new ms({radius:7,fill:new Di({color:"rgba(255, 204, 51, 0.3)"})}),text:new Wc({font:"bold 12px Calibri,sans-serif",fill:new Di({color:"rgb(0 0 0)"}),stroke:new bi({color:"rgba(255, 204, 51, 1)",width:4}),overflow:!0})}),d=new gs({source:new io,zIndex:1001});function m(){s=Kn().getOlMap(),Pt(o,T=>{if(T)t.value=!0;else{t.value=!1;const k=d.getSource();k&&k.clear(),i.value=null}}),Pt(()=>i.value,T=>{const k=d.getSource();k&&(k.clear(),T&&T instanceof yi&&k.addFeature(T))}),l.setActive(!1),Pt(t,T=>{l.setActive(T)}),s.addInteraction(l),s.addLayer(d),d.setStyle(h),mn(l,"drawstart",T=>{const k=d.getSource();k&&k.clear(),i.value=null,Eu.add(s,T)}),mn(l,"drawend",T=>{y(T)}),u=mn(document,"keyup",T=>{x(T)})}function y(T){Eu.remove(),l.finishDrawing(),t.value=!1,r.value=!0,T.stopPropagation(),i.value=T.feature,setTimeout(()=>{r.value=!1},600)}function x(T){T.key==="Escape"&&(Eu.remove(),l.finishDrawing(),l.setActive(!1))}function C(){const T=d.getSource();T&&T.clear(),i.value=null}function w(){const T=i.value;return!!T&&typeof T.getGeometry=="function"&&T.getGeometry()&&T.getGeometry().getType&&T.getGeometry().getType()==="LineString"}function E(){u&&(mr(u),u=void 0);const T=d.getSource();T&&T.clear(),s&&(s.removeLayer(d),s.removeInteraction(l))}return{drawInteraction:l,drawElevationProfileActive:t,currentProfileFeature:i,init:m,clearFeature:C,hasLineFeature:w,destroy:E}}const dye={"data-cy":"toolbarElevationProfile",class:"relative"},fye={class:"absolute bottom-full top-auto z-20 flex flex-col gap-2 bg-white border border-gray-400 p-2 rounded shadow-lg"},pye={class:"flex gap-2"},gye=at({__name:"toolbar-elevation-profile",setup(n){const{t:e}=St(),t=EA(),{currentProfileFeature:i}=It(t),r=hye(),o=Kn().getOlMap(),s=Ct(()=>{if(!i.value)return;const u=new Rl;return u.setGeometry(i.value.getGeometry()),u.map=o,u.id=Date.now(),u.label=e("Elevation Profile"),u.featureType="drawnLine",u});sr(()=>{r.init()}),Ms(()=>{r.destroy()});function l(){r.clearFeature(),r.drawElevationProfileActive.value=!0}return(u,h)=>(U(),ie("div",dye,[P("div",fye,[P("div",pye,[P("button",{"data-cy":"elevationProfileRedraw",class:"px-3 py-1 bg-primary text-white rounded hover:bg-secondary",onClick:l},K(M(e)("Draw new line")),1),M(i)?(U(),ie("button",{key:0,"data-cy":"elevationProfileClear",class:"px-3 py-1 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:h[0]||(h[0]=(...d)=>M(r).clearFeature&&M(r).clearFeature(...d))},K(M(e)("Clear")),1)):Le("",!0)]),mt(Dk,{class:"w-[450px]",feature:s.value,"enable-export-c-s-v":!0,"activate-positioning":!0},null,8,["feature"])])]))}});class mye{printExtent;constructor(e){this.setPrintExtent(e||[0,0,1/0,1/0])}getPrintExtent(){return this.printExtent}setPrintExtent(e){this.printExtent=e}layerFilter(e){return!0}geometryFilter(e){return!0}feature(e,t){}line(e,t,i,r){}point(e,t,i,r){}text(e,t,i,r){}wmtsLayer(e,t,i){}wmsLayer(e,t,i){}}const YW={WMTS_PIXEL_SIZE:28e-5,CIRCLE_TO_POLYGON_SIDES:64};function JS(n){return n.length===1?`0${n}`:n}function qS(n){const e=n[0],t=n[1],i=n[2];if(e!==(e&255)||t!==(t&255)||i!==(i&255))throw new Error(`"(${e},${t},${i})" is not a valid RGB color`);const r=JS(e.toString(16)),o=JS(t.toString(16)),s=JS(i.toString(16));return`#${r}${o}${s}`}function yye(n){const e=n.getProjection(),t=n.getTileGrid();console.assert(t instanceof Sk);const i=t.getMatrixIds(),r=[],o=e.getMetersPerUnit();console.assert(!!o);for(let s=0;s<i.length;s++){const l=t.getFullTileRange(s),u=t.getResolution(s)*o;r.push({identifier:i[s],scaleDenominator:u/YW.WMTS_PIXEL_SIZE,tileSize:oa(t.getTileSize(s)),topLeftCorner:t.getOrigin(s),matrixSize:[l.maxX-l.minX+1,l.maxY-l.minY+1]})}return r}const Hx=document.createElement("canvas");function _ye(n,e){const t=Hx.getContext("2d");return Hx.width=n.width,Hx.height=n.height,t.globalAlpha=e,t.drawImage(n,0,0),Hx}function vye(n){const e=document.createElement("a");return e.href=encodeURI(n),decodeURI(e.href)}function bye(n){const e=n.getUrls();return console.assert(e.length>0),vye(e[0])}function xye(n,e,t,i,r,o){e&&n.forEach(s=>{const l=s.getGeometry();if(!l)return;const u=l.clone();u.applyTransform((d,m,y)=>Dh(d,0,d.length,y||2,i,m));const h=e(s,t);h&&(Array.isArray(h)?h.forEach(d=>{r.setStyle(d),r.drawGeometry(u)}):(r.setStyle(h),r.drawGeometry(u)),o&&o(r,u))})}function Iye(n,e,t){const i=qa(),r=Gu(n);return Fu(i,t[0]/2,t[1]/2,1/e,-1/e,0,-r[0],-r[1]),i}class Cye extends Rk{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:ipe({extent:Ek(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const wye='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Aye extends Cye{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[wye];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",r=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:(o,s)=>{const l=o.getImage();!Cl&&l instanceof HTMLImageElement&&(l.referrerPolicy="origin-when-cross-origin"),(e.tileLoadFunction||pW)(o,s)},transition:e.transition,url:r,wrapX:e.wrapX,zDirection:e.zDirection})}}const Sye={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},F5={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class Eye extends hW{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=qa(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(e,t,i,r,o,s,l,u){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,i,r,o,s,l,u)}getTile(e,t,i,r){const o=this.getOrCreateTile(e,t,i,r);if(!o)return null;const s=r.viewState,l=s.resolution,u=r.viewHints,h=this.getLayer().getSource(),d=h.getTileGridForProjection(s.projection),m=!(u[Jr.ANIMATING]||u[Jr.INTERACTING]),y=d.getZForResolution(l,h.zDirection)===e;return m&&y?o.wantedResolution=l:o.wantedResolution||(o.wantedResolution=d.getResolution(e)),o}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,i){const r=this.getLayer(),o=r.getRevision(),s=r.getRenderOrder()||null,l=e.wantedResolution,u=e.getReplayState(r);if(!u.dirty&&u.renderedResolution===l&&u.renderedRevision==o&&u.renderedRenderOrder==s)return;const h=r.getSource(),d=!!r.getDeclutter(),m=h.getTileGrid(),x=h.getTileGridForProjection(i).getTileCoordExtent(e.wrappedTileCoord),C=h.getSourceTiles(t,i,e),w=Yn(r);delete e.hitDetectionImageData[w],e.executorGroups[w]=[],u.dirty=!1;for(let E=0,T=C.length;E<T;++E){const k=C[E];if(k.getState()!=Vn.LOADED)continue;const G=h.getProjection(),O=k.tileCoord;let V=m.getTileCoordExtent(O);i&&G&&!Nh(i,G)&&(V=gb(V,G,i,32));const z=Ec(x,V),H=Kh(z,r.getRenderBuffer()*l,this.tempExtent),te=Hp(V,z)?null:H,$=new $4(0,z,l,t),ae=fT(l,t),fe=function(ue,ge){let Ne;const Ee=ue.getStyleFunction()||r.getStyleFunction();if(Ee&&(Ne=Ee(ue,l)),Ne){const se=this.renderFeature(ue,ae,Ne,$,d,ge);u.dirty=u.dirty||se}},Y=k.getFeatures();s&&s!==u.renderedRenderOrder&&Y.sort(s);for(let ue=0,ge=Y.length;ue<ge;++ue){let Ne=Y[ue];i&&k.projection&&!Nh(i,k.projection)&&(Ne=Ne.clone(),Ne.getGeometry().applyTransform(pf(k.projection,i))),(!te||Zs(te,Ne.getGeometry().getExtent()))&&fe.call(this,Ne,ue)}const de=$.finish(),D=r.getRenderMode()!=="vector"&&d&&C.length===1?null:z,oe=new J4(D,l,t,h.getOverlaps(),de,r.getRenderBuffer(),!0);e.executorGroups[w].push(oe)}u.renderedRevision=o,u.renderedRenderOrder=s,u.renderedResolution=l}forEachFeatureAtCoordinate(e,t,i,r,o){const s=t.viewState.resolution,l=t.viewState.rotation;i=i??0;const u=this.getLayer(),d=u.getSource().getTileGridForProjection(t.viewState.projection),m=Js([e]);Kh(m,s*i,m);const y={},x=function(G,O,V){let z=G.getId();z===void 0&&(z=Yn(G));const H=y[z];if(H){if(H!==!0&&V<H.distanceSq){if(V===0)return y[z]=!0,o.splice(o.lastIndexOf(H),1),r(G,u,O);H.geometry=O,H.distanceSq=V}}else{if(V===0)return y[z]=!0,r(G,u,O);o.push(y[z]={feature:G,layer:u,geometry:O,distanceSq:V,callback:r})}},C=this.renderedTiles,w=Yn(u),E=u.getDeclutter(),T=E?t.declutter?.[E]?.all().map(G=>G.value):null;let k;e:for(let G=0,O=C.length;G<O;++G){const V=C[G],z=d.getTileCoordExtent(V.wrappedTileCoord);if(!Zs(z,m))continue;const H=V.executorGroups[w];for(let te=0,$=H.length;te<$;++te)if(k=H[te].forEachFeatureAtCoordinate(e,s,l,i,x,T),k)break e}return k}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((t,i)=>{const r=this.getLayer(),o=r.getSource(),s=this.renderedProjection,l=s.getExtent(),u=this.renderedResolution,h=o.getTileGridForProjection(s),d=Vs(this.renderedPixelToCoordinateTransform_,e.slice()),m=h.getTileCoordForCoordAndResolution(d,u).toString(),y=this.renderedTiles.find(G=>G.tileCoord.toString()===m&&G.getState()===Vn.LOADED);if(!y||y.loadingSourceTiles>0){t([]);return}o.getWrapX()&&s.canWrapX()&&!vc(l,h.getTileCoordExtent(y.tileCoord))&&zw(d,s);const x=Yn(r),C=h.getTileCoordExtent(y.wrappedTileCoord),w=nd(C),E=[(d[0]-w[0])/u,(w[1]-d[1])/u],T=y.getSourceTiles().reduce((G,O)=>G.concat(O.getFeatures()),[]);let k=y.hitDetectionImageData[x];if(!k){const G=oa(h.getTileSize(h.getZForResolution(u,o.zDirection))),O=this.renderedRotation_,V=[this.getRenderTransform(h.getTileCoordCenter(y.wrappedTileCoord),u,0,xl,G[0]*xl,G[1]*xl,0)];k=Q4(G,V,T,r.getStyleFunction(),h.getTileCoordExtent(y.wrappedTileCoord),y.getReplayState(r).renderedResolution,O),y.hitDetectionImageData[x]=k}t(eV(E,T,k))})}getFeaturesInExtent(e){const t=[],i=this.getTileCache();if(i.getCount()===0)return t;const o=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),s=o.getZForResolution(this.renderedResolution),l={};return i.forEach(u=>{if(u.tileCoord[0]!==s||u.getState()!==Vn.LOADED)return;const h=u.getSourceTiles();for(let d=0,m=h.length;d<m;++d){const y=h[d],x=y.getKey();if(x in l)continue;l[x]=!0;const C=y.tileCoord;if(Zs(e,o.getTileCoordExtent(C))){const w=y.getFeatures();if(w)for(let E=0,T=w.length;E<T;++E){const k=w[E],G=k.getGeometry();Zs(e,G.getExtent())&&t.push(k)}}}}),t}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){const i=this.context,r=i.globalAlpha;i.globalAlpha=t.opacity;const o=e.viewHints,s=!(o[Jr.ANIMATING]||o[Jr.INTERACTING]),l=[this.context.canvas.width,this.context.canvas.height],u=this.getLayer().getDeclutter(),h=u?e.declutter?.[u]:void 0,d=Yn(this.getLayer()),m=this.renderedTiles;for(let y=0,x=m.length;y<x;++y){const C=m[y],w=C.executorGroups[d];if(w)for(let E=w.length-1;E>=0;--E)w[E].execute(this.context,l,this.getTileRenderTransform(C,e),e.viewState.rotation,s,MC,h)}i.globalAlpha=r}renderDeferredInternal(e){const t=this.renderedTiles,i=Yn(this.getLayer()),r=t.reduce((u,h,d)=>(h.executorGroups[i].forEach(m=>u.push({executorGroup:m,index:d})),u),[]),o=r.map(({executorGroup:u})=>u.getDeferredZIndexContexts()),s={};for(let u=0,h=r.length;u<h;++u){const d=r[u].executorGroup.getDeferredZIndexContexts();for(const m in d)s[m]=!0}Object.keys(s).map(Number).sort(Tc).forEach(u=>{o.forEach((h,d)=>{h[u]&&(h[u].forEach(m=>{const{executorGroup:y,index:x}=r[d],C=y.getRenderedContext(),w=C.globalAlpha;C.globalAlpha=this.renderedOpacity_;const E=this.tileClipContexts_[x];E&&E.draw(C),m.draw(C),E&&C.restore(),C.globalAlpha=w,m.clear()}),h[u].length=0)})})}getTileRenderTransform(e,t){const i=t.pixelRatio,r=t.viewState,o=r.center,s=r.resolution,l=r.rotation,u=t.size,h=Math.round(u[0]*i),d=Math.round(u[1]*i),y=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),x=e.tileCoord,C=y.getTileCoordExtent(e.wrappedTileCoord),w=y.getTileCoordExtent(x,this.tempExtent)[0]-C[0];return JR(dI(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(o,s,l,i,h,d,w))}postRender(e,t){const i=t.viewHints,r=!(i[Jr.ANIMATING]||i[Jr.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const o=this.getLayer(),s=o.getRenderMode(),l=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const u=o.getDeclutter(),h=u?F5[s].filter(V=>!MC.includes(V)):F5[s],d=t.viewState,m=d.rotation,y=o.getSource(),C=y.getTileGridForProjection(d.projection).getZForResolution(d.resolution,y.zDirection),w=this.renderedTiles,E=[],T=[],k=[],G=Yn(o);let O=!0;for(let V=w.length-1;V>=0;--V){const z=w[V];O=O&&!z.getReplayState(o).dirty;const H=z.executorGroups[G].filter(D=>D.hasExecutors(h));if(H.length===0)continue;const te=this.getTileRenderTransform(z,t),$=z.tileCoord[0];let ae=!1;const fe=H[0].getClipCoords(te);let Y=e,de;if(fe){de=new ZM,Y=de.getContext();for(let D=0,oe=E.length;D<oe;++D)if(C!==$&&$<T[D]){const ue=E[D];Zs([fe[0],fe[3],fe[4],fe[7]],[ue[0],ue[3],ue[4],ue[7]])&&(ae||(Y.save(),ae=!0),Y.beginPath(),Y.moveTo(fe[0],fe[1]),Y.lineTo(fe[2],fe[3]),Y.lineTo(fe[4],fe[5]),Y.lineTo(fe[6],fe[7]),Y.moveTo(ue[6],ue[7]),Y.lineTo(ue[4],ue[5]),Y.lineTo(ue[2],ue[3]),Y.lineTo(ue[0],ue[1]),Y.clip())}E.push(fe),T.push($)}for(let D=0,oe=H.length;D<oe;++D)H[D].execute(e,[e.canvas.width,e.canvas.height],te,m,r,h,t.declutter?.[u]);ae&&(Y===e?Y.restore():k[V]=de)}e.globalAlpha=l,this.ready=O,this.tileClipContexts_=k,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,i,r,o,s){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let u=0,h=i.length;u<h;++u)l=kC(r,e,i[u],t,this.boundHandleStyleImageChange_,void 0,o,s)||l;else l=kC(r,e,i,t,this.boundHandleStyleImageChange_,void 0,o,s);return l}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const i=e.getReplayState(t),r=t.getRevision(),o=e.wantedResolution;return i.renderedTileResolution!==o||i.renderedTileRevision!==r}renderTileImage_(e,t){const i=this.getLayer(),r=e.getReplayState(i),o=i.getRevision(),s=e.executorGroups[Yn(i)];r.renderedTileRevision=o;const l=e.wrappedTileCoord,u=l[0],h=i.getSource();let d=t.pixelRatio;const y=t.viewState.projection,x=h.getTileGridForProjection(y),C=x.getResolution(e.tileCoord[0]),w=t.pixelRatio/e.wantedResolution*C,E=x.getResolution(u),T=e.getContext();d=Math.round(Math.max(d,w/d));const k=h.getTilePixelSize(u,d,y);T.canvas.width=k[0],T.canvas.height=k[1];const G=d/w;if(G!==1){const H=XG(this.tmpTransform_);dI(H,G,G),T.setTransform.apply(T,H)}const O=x.getTileCoordExtent(l,this.tempExtent),V=w/E,z=XG(this.tmpTransform_);dI(z,V,-V),sH(z,-O[0],-O[3]);for(let H=0,te=s.length;H<te;++H)s[H].execute(T,[T.canvas.width*G,T.canvas.height*G],z,0,!0,Sye[i.getRenderMode()],null);r.renderedTileResolution=e.wantedResolution}}class Tye extends AM{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload;const i=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i;const r=e.renderMode||"hybrid";gr(r=="hybrid"||r=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=r,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new Eye(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(nf.PRELOAD)}getUseInterimTilesOnError(){return this.get(nf.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(nf.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(nf.USE_INTERIM_TILES_ON_ERROR,e)}}class Rye extends UM{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(Kx(e),this.adaptOptions(t))}readFeatureFromText(e,t){return Zn()}readFeatures(e,t){return this.readFeaturesFromText(Kx(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return Zn()}readGeometry(e,t){return this.readGeometryFromText(Kx(e),this.adaptOptions(t))}readGeometryFromText(e,t){return Zn()}readProjection(e){return this.readProjectionFromText(Kx(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return Zn()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return Zn()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return Zn()}}function Kx(n){return typeof n=="string"?n:""}const Eh={LINE_STRING:"LineString",POINT:"Point",POLYGON:"Polygon"},HW=Object.freeze({LineString:Eh.LINE_STRING,Point:Eh.POINT,Polygon:Eh.POLYGON,MultiLineString:Eh.LINE_STRING,MultiPoint:Eh.POINT,MultiPolygon:Eh.POLYGON});function Mye(n){return n in HW}const PI="_mfp_style",kye=n=>{const e=n.geometry;return e&&e.type==="Point"?0:1},QS=n=>{const e=Array.isArray(n)?n.join(","):n;return`[${PI} = '${e}']`};class KW{layerState_;layer_;customizer_;geojsonFormat=new Qa;deepIds_=new Map;lastDeepId_=0;constructor(e,t){this.layerState_=e,this.layer_=this.layerState_.layer,this.customizer_=t}encodeVectorLayer(e){const t=this.layer_.getSource();if(!t)return null;console.assert(t instanceof io);const i=t.getFeaturesInExtent(this.customizer_.getPrintExtent()),r=[],o={version:2};return i.forEach(l=>this.encodeFeature(l,e,r,o)),r.length<=0||Object.keys(o).length<=1?null:(r.sort((l,u)=>{const h=kye;return h(u)-h(l)}),{geoJson:{type:"FeatureCollection",features:r},opacity:this.layerState_.opacity,style:o,type:"geojson",name:this.layer_.get("name")})}encodeFeature(e,t,i,r){let o=null;const s=e.getStyleFunction()||this.layer_.getStyleFunction();s&&(o=s(e,t)),e.getGeometry().getType()==="Circle"&&(e=this.featureCircleAsPolygon(e));const l=this.geojsonFormat.writeFeatureObject(e);let u=o!==null&&!Array.isArray(o)?[o]:o;if(!u||(u=u.filter(d=>!!d),u.length===0))return;console.assert(Array.isArray(u));let h=!1;u.forEach(d=>{let m=d.getGeometry(),y;if(typeof m=="function"&&(m=m(e)),m&&typeof m=="object"){const x=e.clone();x.setGeometry(m),y=this.geojsonFormat.writeFeatureObject(x),i.push(y)}else{if(y=l,m=e.getGeometry(),!m||!this.customizer_.geometryFilter(m))return;h||(i.push(y),h=!0)}this.addVectorStyle(r,y,d)})}getDeepStyleUid(e){const t=[e];let i="";for(;t.length;){const o=t.pop();i+="_k"+Yn(o);for(const[s,l]of Object.entries(o))l!=null&&(["number","string","boolean"].includes(typeof l)?i+=`_${s}:${l}`:t.push(l))}if(this.deepIds_.has(i))return this.deepIds_.get(i).toString();const r=++this.lastDeepId_;return this.deepIds_.set(i,r),r.toString()}addVectorStyle(e,t,i){const r=this.getDeepStyleUid(i),o=QS(r);let s;if(o in e)s=!0;else{const l=this.encodeVectorStyle(t,i);s=l&&l.symbolizers.length!==0,s&&(e[o]=l)}if(s){t.properties||(t.properties={}),this.customizer_.feature(this.layerState_,t);const l=t.properties[PI];if(l){const u=[...l.split(","),r];e[QS(u)]={symbolizers:[...e[QS(l)].symbolizers,...e[o].symbolizers]},t.properties[PI]=u.join(",")}else t.properties[PI]=r}}encodeVectorStyle(e,t){const i=e.geometry.type;if(!Mye(i))return console.warn("Unsupported geometry type: ",i),null;const r=HW[i],o={symbolizers:[]},s=t.getFill(),l=t.getImage(),u=t.getStroke(),h=t.getText();return r===Eh.POLYGON?s!==null&&this.encodeVectorStylePolygon(e,o.symbolizers,s,u):r===Eh.LINE_STRING?u!==null&&this.encodeVectorStyleLine(e,o.symbolizers,u):r===Eh.POINT&&l!==null&&this.encodeVectorStylePoint(e,o.symbolizers,l),h!==null&&this.encodeVectorStyleText(e,o.symbolizers,h),o}encodeVectorStyleFill(e,t,i){let r=i.getColor();r!==null&&(console.assert(typeof r=="string"||Array.isArray(r)),r=$l(r),console.assert(Array.isArray(r),"only supporting fill colors"),t.fillColor=qS(r),t.fillOpacity=r[3])}encodeVectorStyleLine(e,t,i){const r={type:"line"};this.encodeVectorStyleStroke(e,r,i),this.customizer_.line(this.layerState_,e,r,i),t.push(r)}encodeVectorStylePoint(e,t,i){let r;i instanceof ms?r=this.encodeVectorStylePointStyleCircle(e,i):i instanceof Nu&&(r=this.encodeVectorStylePointStyleIcon(e,i)),r&&(this.customizer_.point(this.layerState_,e,r,i),t.push(r))}encodeVectorStylePointStyleCircle(e,t){const i={type:"point"};i.pointRadius=t.getRadius();const r=t.getScale();r&&(Array.isArray(r)?i.pointRadius*=(r[0]+r[1])/2:i.pointRadius*=r);const o=t.getFill();let s=t.getStroke();return o!==null&&(this.encodeVectorStyleFill(e,i,o),s||(s=new bi({color:o.getColor()}))),s!==null&&this.encodeVectorStyleStroke(e,i,s),i}encodeVectorStylePointStyleIcon(e,t){const i=t.getSrc();if(i===void 0)return;const r={type:"point",externalGraphic:i},o=t.getOpacity();o!==null&&(r.graphicOpacity=o);const s=t.getSize();if(s!==null){let u=t.getScale();Array.isArray(u)&&(u=(u[0]+u[1])/2),isNaN(u)&&(u=1);const h=s[0]*u,d=s[1]*u;r.graphicWidth=d,this.addGraphicOffset_(r,t,h,d)}let l=t.getRotation();return isNaN(l)&&(l=0),r.rotation=jh(l),r}addGraphicOffset_(e,t,i,r){if(this.hasDefaultAnchor_(t))return;const o=t.getAnchor(),s=i/2-o[0],l=r/2-o[1];e.graphicXOffset=s,e.graphicYOffset=l}hasDefaultAnchor_(e){const t=e,i=t.anchor_[0]===.5&&t.anchor_[1]===.5,r=t.anchorOrigin_==="top-left",o=t.anchorXUnits_==="fraction",s=t.anchorYUnits_==="fraction";return i&&r&&o&&s}encodeVectorStylePolygon(e,t,i,r){const o={type:"polygon"};this.encodeVectorStyleFill(e,o,i),r!==null&&this.encodeVectorStyleStroke(e,o,r),t.push(o)}encodeVectorStyleStroke(e,t,i){const r=i.getColor();if(r!==null){console.assert(typeof r=="string"||Array.isArray(r));const h=$l(r);console.assert(Array.isArray(h),"only supporting stroke colors"),t.strokeColor=qS(h),t.strokeOpacity=h[3]}const o=i.getLineDash();o!==null&&(t.strokeDashstyle=o.join(" "));const s=i.getWidth();s!==void 0&&(t.strokeWidth=s);const l=i.getLineCap();l&&(t.strokeLinecap=l);const u=i.getLineJoin();u&&(t.strokeLinejoin=u)}encodeVectorStyleText(e,t,i){if(i.getText()){const o=dC(i.getFont()||"12px sans-serif"),s={type:"text",label:i.getText(),fontFamily:o?.family??"sans-serif",fontSize:o?.size??"12px",fontStyle:o?.style??"normal",fontWeight:o?.weight??"normal",labelXOffset:i.getOffsetX(),labelYOffset:-i.getOffsetY(),labelAlign:"cm"},l=i.getFill();l!==null&&(this.encodeVectorStyleFill(e,s,l),s.fontColor=s.fillColor);const u=i.getStroke();if(u!==null){const h=u.getColor();if(h){console.assert(typeof h=="string"||Array.isArray(h));const m=$l(h);console.assert(Array.isArray(m),"only supporting stroke colors"),s.haloColor=qS(m),s.haloOpacity=m[3]}const d=u.getWidth();d!==void 0&&(s.haloRadius=d)}this.customizer_.text(this.layerState_,e,s,i),t.push(s)}}featureCircleAsPolygon(e){return new yi({...e.getProperties(),geometry:WD(e.getGeometry(),YW.CIRCLE_TO_POLYGON_SIDES)})}}class Lye{url;scratchCanvas=document.createElement("canvas");constructor(e){this.url=e}async encodeMap(e){const t=e.map.getView(),i=t.getCenter(),r=t.getProjection().getCode(),o=jh(t.getRotation()),s=e.map.getLayerGroup(),l=await this.encodeLayerGroup(s,e.printResolution,e.customizer);return{center:i,dpi:e.dpi,projection:r,rotation:o,scale:e.scale,layers:l}}async encodeLayerGroup(e,t,i){const r=e.getLayerStatesArray().filter(i.layerFilter).sort((s,l)=>(s.zIndex||0)-(l.zIndex||0)).reverse(),o=[];for(const s of r){const l=await this.encodeLayerState(s,t,i);l&&(Array.isArray(l)?o.push(...l):o.push(l))}return o}async encodeLayerState(e,t,i){if(!e.visible||t<e.minResolution||t>=e.maxResolution)return null;const r=e.layer;if(r instanceof uv)return this.encodeImageLayerState(e,i);if(r instanceof gs){const o=new KW(e,i).encodeVectorLayer(t),s=e.layer.get("renderAsSvg");return s!==void 0&&(o.renderAsSvg=s),o}return r instanceof Jm?this.encodeTileLayerState(e,i):r instanceof Tye?await this.encodeMVTLayerState(e,t,i):null}encodeImageLayerState(e,t){const i=e.layer;return i instanceof uv||console.assert(i instanceof uv),i.getSource()instanceof uw?this.encodeImageWmsLayerState(e,t):null}encodeImageWmsLayerState(e,t){const r=e.layer.getSource();console.assert(r instanceof uw);const o=r.getUrl();return o!==void 0?this.encodeWmsLayerState(e,o,r.getParams(),t):null}encodeWmsLayerState(e,t,i,r){const o=e.layer,s={...i};return["SERVICE","REQUEST","FORMAT","LAYERS","VERSION","STYLES"].forEach(l=>delete s[l]),{name:o.get("name"),baseURL:t,imageFormat:i.FORMAT,layers:i.LAYERS.split(","),customParams:s,serverType:"mapserver",type:"wms",opacity:o.getOpacity(),version:i.VERSION,useNativeAngle:!0,styles:i.STYLES?.split(",")??[""]}}encodeTileLayerState(e,t){const i=e.layer;console.assert(i instanceof Jm);const r=i.getSource();return r instanceof ob?this.encodeTileWmtsLayerState(e,t):r instanceof tR?this.encodeTileWmsLayerState(e,t):r instanceof Aye?this.encodeOSMLayerState(e,t):null}encodeTileWmsLayerState(e,t){const i=e.layer;console.assert(i instanceof Jm);const r=i.getSource();console.assert(r instanceof tR);const o=r.getUrls();console.assert(!!o);const s=this.encodeWmsLayerState(e,o[0],r.getParams(),t);return t.wmsLayer(e,s,r),s}encodeOSMLayerState(e,t){const i=e.layer;return{type:"osm",baseURL:i.getSource().getUrls()[0],opacity:e.opacity,name:i.get("name")}}encodeTileWmtsLayerState(e,t){const i=e.layer;console.assert(i instanceof Jm);const r=i.getSource();console.assert(r instanceof ob);const o=r.getDimensions(),s=Object.keys(o),l={type:"wmts",baseURL:bye(r),dimensions:s,dimensionParams:o,imageFormat:r.getFormat(),name:i.get("name"),layer:r.getLayer(),matrices:yye(r),matrixSet:r.getMatrixSet(),opacity:e.opacity,requestEncoding:r.getRequestEncoding(),style:r.getStyle(),version:r.getVersion()};return t.wmtsLayer(e,l,r),l}async encodeMVTLayerState(e,t,i){const r=e.layer,{MVTEncoder:o}=await HI(async()=>{const{MVTEncoder:x}=await import("./main-BXLgrtM0.js");return{MVTEncoder:x}},[]),s=new o,l=i.getPrintExtent(),u=Bi(l)/t,h=Ws(l)/t,d=[u,h],m={layer:r,printExtent:i.getPrintExtent(),tileResolution:t,styleResolution:t,canvasSize:d};return(await s.encodeMVTLayer(m)).filter(x=>x.baseURL.length>6).map(x=>Object.assign({type:"image",name:r.get("name"),opacity:1,imageFormat:"image/png"},x))}async encodeAsImageLayer(e,t,i,r){const o=e.layer,s=i.getPrintExtent(),l=Bi(s)/t,u=Ws(s)/t,h=[l,u],d=vle(this.scratchCanvas.getContext("2d"),{size:h,pixelRatio:1}),m=Iye(s,t,h),y=o.getSource().getFeatures(),x=o.getStyleFunction();return xye(y,x,t,m,d,r),{type:"image",extent:s,imageFormat:"image/png",opacity:1,name:o.get("name"),baseURL:_ye(this.scratchCanvas,o.getOpacity()).toDataURL("PNG")}}}const aR=39.37,lR=72;class Pye extends pg{constructor(e={}){super(e),this.context_=ro(),this.context_.canvas.style.opacity="0.5",this.context_.canvas.style.position="absolute",this.size=void 0,this.rotation=void 0,this.scale=void 0}render(e){const t=this.context_.canvas.width=e.size[0],i=this.context_.canvas.height=e.size[1],r=[t/2,i/2];this.context_.beginPath(),this.context_.moveTo(0,0),this.context_.lineTo(t,0),this.context_.lineTo(t,i),this.context_.lineTo(0,i),this.context_.lineTo(0,0),this.context_.closePath();const o=this.getSize();if(!o)return;const s=o[1],l=o[0],u=this.getScale();if(!u)return;const h=e.viewState.resolution,d=l/lR/aR*u/h/2,m=s/lR/aR*u/h/2,y=this.getRotation()!==void 0?aa(this.getRotation()):0,x=Math.sqrt(Math.pow(d,2)+Math.pow(m,2)),C=Math.atan(m/d)-y,w=Math.atan(d/m)-y,E=r[0]-Math.cos(C)*x,T=r[1]+Math.sin(C)*x,k=r[0]+Math.sin(w)*x,G=r[1]+Math.cos(w)*x,O=r[0]+Math.cos(C)*x,V=r[1]-Math.sin(C)*x,z=r[0]-Math.sin(w)*x,H=r[1]-Math.cos(w)*x;return this.context_.moveTo(E,T),this.context_.lineTo(k,G),this.context_.lineTo(O,V),this.context_.lineTo(z,H),this.context_.lineTo(E,T),this.context_.closePath(),this.context_.fillStyle="#000",this.context_.fill(),this.context_.canvas}getSize(){return this.size}getScale(){return this.scale}getRotation(){return this.rotation}setSize(e){this.size=e}setScale(e){this.scale=e}setRotation(e){this.rotation=e}}const Gye=at({__name:"notification-item",props:{notification:{}},emits:["close"],setup(n){const e=n,t=mi(!0);function i(r,o){setTimeout(()=>{t.value=!1},e.notification.duration),o()}return(r,o)=>{const s=kl("dompurify-html");return U(),Gt(Dw,{name:"fade-out",appear:"","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"transform opacity-0",onEnter:i,onAfterLeave:o[0]||(o[0]=l=>r.$emit("close"))},{default:Wt(()=>[t.value?An((U(),ie("div",{key:0,"data-cy":"notification",class:Rn(["lux-alert",`lux-${e.notification.type}`]),role:"alert"},null,2)),[[s,e.notification.message]]):Le("",!0)]),_:1})}}}),Fye={key:0,class:"lux-notifications fixed w-[calc(100%-2rem)] max-w-[500px] top-10 left-1/2 -translate-x-1/2 z-[9999] mx-4 sm:mx-0","data-cy":"alertNotifications"},Oye=at({__name:"alert-notifications",setup(n){const e=Qr(),{notifications:t}=It(e);function i(r){e.removeNotification(r)}return(r,o)=>(U(),Gt(kw,{to:"body"},[M(t).length?(U(),ie("div",Fye,[(U(!0),ie(Mt,null,hi(M(t),(s,l)=>(U(),Gt(Gye,{key:l,notification:s,onClose:()=>i(s.uuid)},null,8,["notification","onClose"]))),128))])):Le("",!0)]))}}),Nye=["title"],O5=at({__name:"background-selector-item",props:{bgTitle:{type:String,default:""},bgName:{type:String,default:""}},setup(n){const{t:e}=St(),t=n,i=Ct(()=>{const o=e(t.bgTitle),s=t.bgTitle.length>0,l=e(t.bgName);return`${o}${s?" - ":""}${l}`}),r=Ct(()=>`h-full w-full rounded-sm lux-bg-sel-icon
        lux-bg-sel-${t.bgName}
        bg-${t.bgName}_sm
        md:bg-${t.bgName}
        hd:bg-${t.bgName}_sm_hi
        hd_md:bg-${t.bgName}_hi`);return(o,s)=>(U(),ie("button",{title:i.value,class:Rn(r.value)},null,10,Nye))}}),Dye={key:0,class:"flex flex-row-reverse"},N5=at({__name:"background-selector",props:{isOpen:{type:Boolean,default:!1}},setup(n){const{t:e,i18next:t}=St(),i=pA(),r=Ui(),o=Zr(),{bgLayer:s,is3dMesh:l}=It(r),h=Ue(n.isOpen),d=Ue(!1),m=Ue([]),y=Ct(()=>s.value?.id??i.getNullId()),x=Ct(()=>m.value?.find(E=>E.id===y.value)?.name);Pt(()=>o.bgLayers,E=>{m.value=Zh().bg_layers.map(T=>Object.assign({id:T.id},E.find(k=>T.id===k.id),{name:T.icon_id}))},{immediate:!0}),Pt(()=>r.bgLayer,(E,T)=>{const k=r.layers;T===void 0&&E===null&&k?.length===0&&(i.setBgLayer(i.defaultSelectedBgId.value),E===null&&(d.value=!0))}),Pt([d,()=>t.isInitialized],([E,T])=>{E&&T&&Qr().addNotification(e("Aucune couche n'tant dfinie pour cette carte, une couche de fond a automatiquement t ajoute."))});function C(E){i.setBgLayer(E.id),h.value=!1}function w(){h.value=!h.value}return(E,T)=>M(l)?Le("",!0):(U(),ie("div",Dye,[P("div",{"data-cy":"selectedBg",class:Rn(["lux-bg-sel border border-black",h.value===!0?"hidden":"block"])},[mt(O5,{"aria-expanded":h.value,"bg-title":"Select BG layer","bg-name":x.value,onClick:w},null,8,["aria-expanded","bg-name"])],2),P("div",{"data-cy":"available-bgs",class:Rn(h.value===!0?"flex flex-col md:flex-row":"hidden")},[(U(!0),ie(Mt,null,hi(m.value,k=>(U(),ie("div",{key:k.id,class:Rn(["lux-bg-sel hover:bg-cyan-600",k.id===y.value?"border-red-500 border-2":"border-black border"])},[mt(O5,{"bg-name":k.name,onClick:G=>C(k)},null,8,["bg-name","onClick"])],2))),128))],2)]))}}),ag=ca("info",()=>{const n=Ue(void 0),e=Ue(void 0),t=Ue(!1),i=Ue(!1),r=Ue(!0),o=Ue(!1),s=Ue(!1),l=Ue(void 0);return{locationInfoCoords:n,locationInfoInfos:e,hidePointer:t,isStreetviewActive:i,noDataAtLocation:r,streetViewLoading:o,panoPositionChanging:s,svFeature:l}}),lg=ca("lidar",()=>{const n=Ue(!1),e=Ue(!1),t=Ue(!1),i=Ue(5),r=Ue(null);return{drawLidarActive:n,profileWidth:i,currentProfileFeature:r,lidarConfig:{clientConfig:{autoWidth:!0,margin:{left:40,top:10,right:0,bottom:40},pointAttributes:{},pointSum:0,tolerance:5},serverConfig:{classification_colors:{1:{color:"120, 120, 120",name:{fr:"points non classifis",en:"unclassified points",de:"nicht klassifizierte Punkte",lb:"onklassiert Punkten"},value:"unclassified points",visible:1},2:{color:"160, 82, 40",name:{fr:"sol",en:"ground",de:"Boden",lb:"Buedem"},value:"ground",visible:1},3:{color:"0, 240, 0",name:{fr:"vgtation basse",en:"low vegetation",de:"niedrige Vegetation",lb:"niddereg Vegetatioun"},value:"low vegetation",visible:1},4:{color:"0, 204, 0",name:{fr:"vgtation moyenne",en:"average vegetation",de:"mittlere Vegetation",lb:"mttel Vegetatioun"},value:"average vegetation",visible:1},5:{color:"0, 150, 0",name:{fr:"vgtation haute",en:"high vegetation",de:"hohe Vegetation",lb:"hich Vegetatioun"},value:"high vegetation",visible:1},6:{color:"255, 170, 0",name:{fr:"btiments",en:"buildings",de:"Gebude",lb:"Gebai"},value:"buildings",visible:1},7:{color:"0, 0, 0",name:{fr:"points bas (bruit)",en:"low points (noise)",de:"niedrige Punkte",lb:"niddereg Punkten"},value:"low points (noise)",visible:1},9:{color:"60, 130, 250",name:{fr:"eau",en:"water",de:"Wasser",lb:"Waasser"},value:"water",visible:1},13:{color:"255, 0, 0",name:{fr:"ponts, passerelles, viaducs",en:"bridges",de:"Brcken",lb:"Brcke"},value:"bridges",visible:1},15:{color:"255, 255, 0",name:{fr:"lignes  haute tension",en:"high voltage lines",de:"Hochspannungsleitung",lb:"hich Volt Linn"},value:"high voltage lines",visible:1}},debug:!1,default_attribute:"CLASSIFICATION",default_color:"RGB(250,150,150)",default_point_attribute:"CLASSIFICATION",default_point_cloud:"luxembourg",initialLOD:10,max_levels:{25:{max:14,width:2},50:{max:13,width:2},75:{max:13,width:3},100:{max:12,width:3},150:{max:12,width:4},250:{max:11,width:4},350:{max:11,width:4},500:{max:10,width:5},1e3:{max:10,width:5},5e3:{max:9,width:6},7500:{max:9,width:6},1e5:{max:9,width:7}},max_point_number:15e4,minLOD:0,point_attributes:{CLASSIFICATION:{bytes:1,elements:1,name:"Classification",value:"CLASSIFICATION",visible:1},COLOR_PACKED:{bytes:4,elements:4,name:"Couleur",value:"COLOR_PACKED",visible:1},INTENSITY:{bytes:2,element:1,name:"Intensit",value:"INTENSITY",visible:1},POSITION_CARTESIAN:{bytes:12,elements:3,name:"Position-cartesian",value:"POSITION_CARTESIAN",visible:0},POSITION_PROJECTED_PROFILE:{bytes:8,elements:2,name:"Position-projected",value:"POSITION_PROJECTED_PROFILE",visible:0},RGB:{bytes:3,elements:4,name:"Couleur",value:"RGBA",visible:0}},point_size:1,width:10}},measureActive:e,justFinishedDrawing:t}});function jW(n,e,t,i,r,o,s,l){return n.value!==void 0||e.value!==void 0||t.value===!0||i.value===!0||r.value===!0||o.value===!0||s.value===!0||l.value===!0}const Vye=1501,Bye="infoFeatureLayer";function Zye(){const n=Kn().getOlMap();let e=null,t=null;const{infoOpen:i,measureToolbarOpen:r}=It(Jn()),{locationInfoCoords:o,hidePointer:s}=It(ag()),{clearContent:l}=rg(),{drawStateActive:u,editStateActive:h}=It(zr()),{measureActive:d,drawLidarActive:m,justFinishedDrawing:y}=It(lg()),{drawElevationProfileActive:x,justFinishedDrawing:C}=It(EA()),w=new gs({source:new io({features:[]}),zIndex:Vye});w.set("cyLayerType",Bye),k(w),n.addLayer(w),Pt(i,G=>{G||(o.value=void 0)}),Pt([o,s],([G,O])=>{if(w.getSource()?.clear(),G&&!O){i.value=!0;const V=new yi(new zi(G));w.getSource()?.addFeature(V)}},{immediate:!0}),n.getViewport().addEventListener("contextmenu",G=>G.preventDefault()),mn(n,"pointerdown",G=>T(G));function E(G){return n.getEventCoordinate(G.originalEvent)}function T(G){e=G.pixel,t=Date.now(),G.originalEvent.button===2&&(o.value=E(G),l())}mn(n,"pointerup",G=>{if(jW(u,h,d,r,m,x,y,C))return;const O=G.originalEvent;if(e&&t!==null){const V=G.pixel,z=Math.abs(e[0]-V[0]),H=Math.abs(e[1]-V[1]),te=Date.now()-t;O.pointerType==="touch"&&z+H<6&&te>=400?(o.value=E(G),l()):O.button===0&&z+H<6&&(s.value||(o.value=void 0))}e=null,t=null}),mn(n,"pointermove",G=>{if(e!==null){const O=G.pixel,V=Math.abs(e[0]-O[0]),z=Math.abs(e[1]-O[1]);V+z>6&&(e=null,t=null)}});function k(G){const O=new Di({color:[255,255,0,.6]}),V=new bi({color:[255,155,55,1],width:3}),z=new ms({radius:10,fill:O,stroke:V});G.setStyle([new Hn({image:z})])}}const Wye={"EPSG:2169":"Luref","EPSG:4326":"Lon/Lat WGS84","EPSG:4326:DMS":"Lon/Lat WGS84 DMS","EPSG:4326:DMm":"Lon/Lat WGS84 DM","EPSG:3263*":"WGS84 UTM"},zye=[46602,53725,106944,141219];async function Uye(n,e){const t=Ir(n,e,Ml),[i,r,o]=(await Promise.allSettled([Yye(n),eb(n),Hye(t)])).map(s=>s.status==="fulfilled"?s.value:void 0);return{shortUrl:i,elevation:r,address:o,clickCoordinateLuref:t,isInBoxOfLidar:Xye(t)}}function Xye(n){return Pc(zye,n)}async function Yye(n){return(await Ql.getShortUrl(n)).short_url.replace("http://g-o.lu/migration/","https://migration.geoportail.lu/s/")}async function Hye(n){return(await(await fetch(`https://migration.geoportail.lu/geocode/reverse?easting=${n[0]}&northing=${n[1]}`)).json()).results[0]}const Vk=ca("print",()=>{const n=Ue(void 0),e=Ue(void 0);return{featureInfoPrintableRef:n,locationInfoPrintableRef:e}},{});function Kye(n){return n&&`https://migration.geoportail.lu/qr?url=${n}`}function jye(n){return n!==void 0?`https://migration.geoportail.lu/qr?url=https://migration.geoportail.lu/qr?map_id=${n}`:void 0}function D5(n){if(n)return n.startsWith("data:image")?n:(n.startsWith("/")&&"https://migration.geoportail.lu/".endsWith("/")&&(n="."+n),`https://migration.geoportail.lu/${n}`)}const $ye={class:"flex flex-row"},Jye={class:"no-print grow-[2] flex flex-col justify-end content-end"},qye={id:"short_url_title",class:"text-3xl text-white"},Qye=["value"],e_e=["src"],t_e={class:"mt-5 text-3xl text-white"},n_e={class:"lux-info-table"},i_e={style:{"text-align":"left"}},r_e={style:{"text-align":"left"}},s_e=["disabled"],o_e={class:"flex flex-wrap mt-1 gap-x-1"},a_e=["href"],l_e=["href"],u_e=["href"],c_e={class:"create-itinerary-text"},h_e={class:"lux-panel-content relative grow p-2.5 bg-primary overflow-auto"},d_e={class:"text-white"},f_e={class:"flex justify-center flex-col items-center"},p_e=["href"],g_e=at({__name:"location-info",setup(n){const{t:e}=St(),{locationInfoCoords:t,locationInfoInfos:i}=It(ag()),{currentUser:r}=It(iu()),{addNotification:o}=Qr(),s=Kn().getOlMap(),l=Ue(),u=Ue(),h=Ue(),d=Ue(),m=Ue(),y=Ue({}),x=Ue(!1),C=Ue(!1),w=Ue("Tous Publics"),E=Ue("prive");Zye(),T(t.value),Pt(t,T);async function T(D){D&&(i.value=await Uye(D,s.getView().getProjection()),l.value=i.value.shortUrl,u.value=Kye(i.value.shortUrl),m.value=i.value.clickCoordinateLuref,y.value=Object.fromEntries(Object.entries(Wye).map(([oe,ue])=>[ue,Nj(D,s.getView().getProjection(),oe)])),h.value=i.value.elevation===null?"N/A":RM(i.value.elevation),d.value=i.value.address,C.value=i.value.isInBoxOfLidar)}Pt(r,D=>{w.value=D?.role||"anonymous",E.value=D?.typeUtilisateur||"base"});const{locationInfoPrintableRef:k}=It(Vk()),G=D=>k.value=D,O=Ct(()=>w.value==="ACT"),V=Ct(()=>E.value==="etat"||E.value==="commune"||w.value==="MinTour"),z=Ct(()=>!0),H=Ct(()=>m.value?`https://lidar.geoportail.lu?COORD_X=${m.value[0]}&COORD_Y=${m.value[1]}&COORD_Z=${parseInt(h.value||"0")}`:""),te=Ct(()=>m.value?`/getRapportForageVirtuel?x=${m.value[0]}&y=${m.value[1]}`:""),$=Ct(()=>m.value?`http://streetsmart.cyclomedia.com/streetsmart?q=${m.value[0]};${m.value[1]}`:""),ae=Ct(()=>{const D=m.value?Ir(m.value,Ml,Sl):void 0;if(D===void 0)return;const oe=D[0],ue=D[1];return"https://3d.geoportail.lu?state="+encodeURIComponent(JSON.stringify([[[oe,ue,692],[oe,ue,292],400,0,-90,0],"Oblique Map",["LuxConfig","8bbdc4b3-691e-466e-9e91-2b0d57a9a53e","c627c247-8017-483a-a32e-1ff0ad5f0536","0fa7c853-d866-486c-8c2d-3470f401d44c","1f9cb759-c3dc-44ba-9253-7299701499a3","f7791a73-5132-4282-b3c4-1adb1abce06a","catalogConfig"],[],[],[["@geoportallux/lux-3dviewer-themesync",{prop:"*"}],["@geoportallux/lux-3dviewer-plugin-back-to-2d-portal",{prop:"*"}]],"ACT2023_ImagesObliques_all",[]]))}),fe=Ct(function(){const D=m.value?Ir(m.value,Ml,Sl):void 0;return m.value?`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${(D??[0,0])[1]},${(D??[0,0])[0]}&heading=0&pitch=0&fov=90`:""});function Y(){if(!t.value)return;const D=new yi(new zi(t.value)),oe=d.value&&d.value.distance<=100?mF(d.value):y.value.Luref;D.set("label",oe);const ue=Ir(t.value,s.getView().getProjection(),Sl),ge=gA(),Ne=ge.routes.findIndex(se=>!se||se.trim()===""),Ee=Ne===-1?ge.routes.length:Ne;ge.setStartPoint(ue,oe,Ee),Jn().toggleRoutingOpen(!0)}async function de(){x.value=!0;try{await Yoe(te.value,"")}catch{o(e("An error occurred while downloading forage."),ii.ERROR)}finally{x.value=!1}}return Pt(x,D=>{D?s.getViewport().style.cursor="wait":s.getViewport().style.cursor=""}),(D,oe)=>(U(),ie(Mt,null,[P("div",{ref:G},[P("div",$ye,[P("div",Jye,[P("h3",qye,K(M(e)("Short Url",{ns:"client"})),1),P("input",{"aria-labelledby":"short_url_title",onclick:"this.select();",class:"lux-input",type:"text",value:l.value,readonly:"true"},null,8,Qye)]),u.value?(U(),ie("img",{key:0,class:"mx-5 mt-5",src:u.value},null,8,e_e)):Le("",!0)]),P("div",null,[P("h3",t_e,K(M(e)("Location Coordinates",{ns:"client"})),1),P("table",null,[P("tbody",n_e,[(U(!0),ie(Mt,null,hi(y.value,(ue,ge)=>(U(),ie("tr",{key:ge},[P("th",null,K(M(e)(ge)),1),P("td",null,K(ue),1)]))),128)),P("tr",null,[P("th",null,K(M(e)("Elevation")),1),P("td",null,K(h.value),1)]),P("tr",null,[P("th",i_e,K(M(e)("Adresse la plus proche")),1),P("td",null,K(M(mF)(d.value)),1)]),P("tr",null,[P("th",r_e,K(M(e)("Distance approximative")),1),P("td",null,K(M(af)(d.value?.distance||null,0)),1)])])])])]),P("div",null,[oe[3]||(oe[3]=P("hr",null,null,-1)),O.value?(U(),ie("button",{key:0,disabled:x.value,class:"lux-btn mt-1",onClick:oe[0]||(oe[0]=ue=>de())},K(M(e)("Rapport forage virtuel")),9,s_e)):Le("",!0),P("div",o_e,[C.value?(U(),ie("a",{key:0,class:"lux-btn whitespace-nowrap",href:H.value,target:"_geoportal_ext_lidar"},K(M(e)("Lien vers la dmo lidar")),9,a_e)):Le("",!0),V.value?(U(),ie("a",{key:1,class:"lux-btn whitespace-nowrap",href:$.value,target:"_geoportal_ext_cyclomedia"},K(M(e)("Lien vers Cyclomdia")),9,l_e)):Le("",!0),z.value?(U(),ie("a",{key:2,class:"lux-btn whitespace-nowrap",href:ae.value,target:"_geoportal_ext_obliques"},K(M(e)("Images obliques")),9,u_e)):Le("",!0)]),P("div",null,[P("button",{class:"lux-btn mt-1",onClick:oe[1]||(oe[1]=ue=>Y())},[P("span",c_e,K(M(e)("Ajouter tape  mon itinraire")),1)])]),P("div",h_e,[oe[2]||(oe[2]=P("hr",null,null,-1)),P("span",d_e,K(M(e)("Suite  la modification des conditions d'utilisation de Google Street View, nous avons dsactiv son intgration dans la carte et proposons dsormais un lien direct vers le service de Google.")),1),P("div",f_e,[P("a",{class:"lux-btn whitespace-nowrap",href:fe.value,target:"_streetview_ext"},K(M(e)("Ouvrir streetView")),9,p_e)])])])],64))}}),m_e=["role"],y_e={class:"bg-white shadow-modal rounded-lg overflow-hidden w-[700px]"},__e={class:"relative flex flex-row items-center py-2 px-4 border-b-[1px]"},v_e={class:"text-xl grow"},b_e={key:0,class:"p-[15px] border-t-[1px]"},x_e={class:"flex flex-row justify-end"},kf=at({__name:"modal-dialog",props:{footer:{type:Boolean,default:!0},maxHeight:{type:Boolean,default:!1},title:String,role:{type:String,default:"dialog"}},emits:["close"],setup(n){const{t:e}=St(),t=Ue();sr(()=>{t.value.focus()});const i=mi(!0);function r(){i.value=!1}return(o,s)=>(U(),Gt(kw,{to:"body"},[s[5]||(s[5]=P("div",{class:"fixed inset-0 bg-gray-900 opacity-40 z-[1050]"},null,-1)),mt(Dw,{appear:"","enter-active-class":"duration-200 ease-out","enter-from-class":"transform opacity-0 -translate-y-60","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"transform opacity-0 -translate-y-60",onAfterLeave:s[3]||(s[3]=l=>o.$emit("close"))},{default:Wt(()=>[i.value?(U(),ie("div",{key:0,role:n.role,ref_key:"modal",ref:t,tabindex:"0",onKeydown:s[2]||(s[2]=to(ps(l=>r(),["stop"]),["esc"])),class:"fixed inset-x-0 inset-y-8 flex items-start justify-center z-[1100] outline-none"},[P("div",y_e,[P("div",__e,[P("h4",v_e,K(n.title),1),P("button",{type:"button",class:"text-slate-400 text-2xl","data-dismiss":"modal","aria-label":"Close",onClick:s[0]||(s[0]=l=>r())},[...s[4]||(s[4]=[P("span",{"aria-hidden":"true"},"",-1)])])]),P("div",{class:Rn(["p-[15px] overflow-y-auto",n.maxHeight?"max-h-96":"max-h-full"])},[ei(o.$slots,"content")],2),n.footer?(U(),ie("div",b_e,[ei(o.$slots,"footer",{},()=>[P("div",x_e,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:s[1]||(s[1]=l=>r())},K(M(e)("Close",{ns:"client"})),1)])])])):Le("",!0)])],40,m_e)):Le("",!0)]),_:3})]))}});function I_e(){const{t:n}=St();return{translate:(t,i)=>{const o=new DOMParser().parseFromString(t,"text/html");return o.querySelectorAll("[translate]").forEach(l=>{const u=l.textContent?.trim();u&&(l.textContent=n(u,i),l.removeAttribute("translate"))}),new XMLSerializer().serializeToString(o)}}}const C_e={key:0,class:"lux-legend"},w_e={key:1},uR=at({__name:"legend-item",props:{layer:{},displayEmptyLegend:{type:Boolean,default:!1}},emits:["hasLegend","removedLegend"],setup(n,{emit:e}){const{t,i18next:i}=St(),{translate:r}=I_e(),o=Ue(),s=n,l=e;Pt(()=>i.language,()=>u()),sr(()=>u()),Ms(()=>l("removedLegend"));async function u(){o.value=await BC.getLayerMetadata(s.layer.id,i.language),l("hasLegend",!!o.value?.hasLegend)}return(h,d)=>{const m=kl("dompurify-html");return o.value&&o.value.legendHtml?.innerHTML?(U(),ie("div",C_e,[ei(h.$slots,"title"),An(P("div",null,null,512),[[m,M(r)(o.value.legendHtml?.innerHTML)]])])):!o.value?.hasLegend&&n.displayEmptyLegend?(U(),ie("div",w_e,K(M(t)("The legend is not available for this layer")),1)):Le("",!0)}}}),A_e={class:"font-bold"},S_e={class:"col-span-2"},v0=at({__name:"layer-metadata-item",props:{label:{},value:{}},setup(n){const e=n;return(t,i)=>(U(),ie(Mt,null,[P("span",A_e,K(e.label),1),P("span",S_e,K(e.value),1)],64))}}),E_e={"data-cy":"metadata",class:"grid gap-2 grid-cols-3 pt-3 text-[13px] font-arial break-words"},T_e={key:2,class:"col-span-3 grid gap-2 grid-cols-3"},R_e={class:"font-bold"},M_e={class:"col-span-2"},k_e=["title"],L_e=["title"],P_e={key:4,class:"col-span-3"},G_e={class:"font-bold"},F_e={class:"col-span-2"},O_e=["href"],N_e={key:7,class:"col-span-3 grid gap-2 grid-cols-3"},D_e={class:"font-bold"},V_e={class:"col-span-2"},B_e={key:0},Z_e={key:1},W_e={key:2},z_e={key:3},U_e={key:4},X_e=["href"],Y_e={key:8,class:"grid gap-2 grid-cols-3 col-span-3"},H_e={class:"font-bold"},K_e={class:"col-span-2"},j_e=["href"],$_e={key:9,class:"col-span-3"},eE=220,J_e=at({__name:"layer-metadata",setup(n){const e=mA(),{metadataLayer:t}=It(e),{t:i,i18next:r}=St(),o=Ue(),s=Ue(!0);Pt(t,async m=>{o.value=m?await BC.getLayerMetadata(m.id,r.language):void 0,s.value=(o.value?.description?.length||0)<eE}),Pt(()=>r.language,async m=>{t.value&&(o.value=await BC.getLayerMetadata(t.value.id,m))});const l=Ct(()=>s.value?o.value?.description:o.value?.description?.slice(0,eE));function u(){s.value=!0}function h(){s.value=!1}function d(){e.clearMetadataLayer()}return(m,y)=>{const x=kl("dompurify-html");return o.value?(U(),Gt(kf,{key:0,footer:!1,"max-height":!0,title:M(i)(`${o.value.title}`,{ns:"client"}),onClose:d},{content:Wt(()=>[P("div",E_e,[o.value.name?(U(),Gt(v0,{key:0,label:M(i)("Name"),value:o.value.name},null,8,["label","value"])):Le("",!0),o.value.serviceDescription?(U(),Gt(v0,{key:1,label:M(i)("Description du Service"),value:o.value.serviceDescription},null,8,["label","value"])):Le("",!0),o.value.description?(U(),ie("div",T_e,[P("span",R_e,K(M(i)("Description")),1),P("span",M_e,[An(P("span",null,null,512),[[x,l.value]]),s.value?Le("",!0):(U(),ie("button",{key:0,title:M(i)("Display full description",{ns:"app"}),onClick:u,class:"text-secondary hover:underline"}," ... ",8,k_e)),s.value&&(l.value?.length||0)>eE?(U(),ie("button",{key:1,title:M(i)("Hide full description",{ns:"app"}),onClick:h,class:"text-secondary hover:underline"}," - ",8,L_e)):Le("",!0)])])):Le("",!0),o.value.legalConstraints?(U(),Gt(v0,{key:3,label:M(i)("Contrainte d'utilisation"),value:o.value.legalConstraints},null,8,["label","value"])):Le("",!0),o.value.link?.length!==0?(U(),ie("div",P_e,[(U(!0),ie(Mt,null,hi(o.value.link,C=>(U(),ie("div",{class:"grid gap-2 grid-cols-3",key:C},[P("span",G_e,K(M(i)("Url vers la resource")),1),P("span",F_e,[P("a",{class:"text-secondary hover:underline",target:"_blank",href:C},K(C),9,O_e)])]))),128))])):Le("",!0),o.value.revisionDate?(U(),Gt(v0,{key:5,label:M(i)("Revision date"),value:M(TM)(o.value.revisionDate,M(r).language)},null,8,["label","value"])):Le("",!0),o.value.keyword?(U(),Gt(v0,{key:6,label:M(i)("Keywords"),value:o.value.keyword?.join(",")},null,8,["label","value"])):Le("",!0),o.value.responsibleParty?(U(),ie("div",N_e,[P("div",D_e,K(M(i)("Contact")),1),P("div",V_e,[o.value.responsibleParty?.organisaton?(U(),ie("p",B_e,K(o.value.responsibleParty?.organisaton),1)):Le("",!0),o.value.responsibleParty?.name?(U(),ie("p",Z_e,K(o.value.responsibleParty?.name),1)):Le("",!0),o.value.responsibleParty?.unknown?(U(),ie("p",W_e,K(o.value.responsibleParty?.unknown),1)):Le("",!0),o.value.responsibleParty?.address?(U(),ie("p",z_e,K(o.value.responsibleParty?.address),1)):Le("",!0),o.value.responsibleParty?.email?(U(),ie("p",U_e,[P("a",{class:"text-secondary hover:underline",href:"mailto:"+o.value.responsibleParty?.email},K(o.value.responsibleParty?.email),9,X_e)])):Le("",!0)])])):Le("",!0),o.value.metadataLink?(U(),ie("div",Y_e,[P("span",H_e,K(M(i)("Link to the metadata")),1),P("span",K_e,[P("a",{class:"text-secondary hover:underline",target:"_blank",href:o.value.metadataLink},K(M(i)("link")),9,j_e)])])):Le("",!0),o.value.isError?(U(),ie("div",$_e,K(M(i)("The metadata is right now not available")),1)):M(t)?(U(),Gt(uR,{key:10,class:"mt-5 col-span-3",layer:M(t),displayEmptyLegend:!0},{title:Wt(()=>[P("h4",null,K(M(i)("Legend")),1)]),_:1},8,["layer"])):Le("",!0)])]),_:1},8,["title"])):Le("",!0)}}}),q_e={class:"flex flex-row flex-wrap pl-2.5","data-cy":"themeGrid"},Q_e=["onClick"],e0e={class:"text-2xl absolute top-5"},t0e=at({__name:"theme-grid",props:{themes:{}},setup(n){const{t:e}=St(),t=n;return(i,r)=>(U(),ie("div",q_e,[(U(!0),ie(Mt,null,hi(t.themes,o=>(U(),ie("button",{class:Rn(["relative shrink-0 h-[150px] w-1/2 px-2.5 text-start text-gray-100/40 uppercase hover:bg-[#ccc]",`bg-${o.name}-primary hover:text-${o.name}-primary`]),key:o.id,onClick:s=>i.$emit("setTheme",o.name)},[P("div",e0e,K(M(e)(`${o.name}`)),1),P("div",{class:Rn(["text-6xl absolute bottom-1 after:font-icons",`after:content-${o.name}`])},null,2)],10,Q_e))),128))]))}}),n0e=["aria-expanded"],i0e={class:"py-0.5"},r0e={class:"px-1 py-0.5 shrink-0 flex flex-row text-[12px] bg-secondary text-white"},s0e={class:"py-[3px]"},o0e={class:"flex flex-row flex-wrap ml-1 w-12"},a0e=at({__name:"theme-selector-button",props:{themes:{},themeName:{},currentTheme:{},isOpen:{type:Boolean}},setup(n){const{t:e}=St(),t=n,i=Ct(()=>t.themes?.slice(0,8)||[]);return(r,o)=>(U(),ie("button",{class:"w-full flex flex-row justify-between bg-tertiary text-white px-2 py-1.5 uppercase cursor-pointer hover:bg-white hover:text-primary","aria-expanded":t.isOpen},[P("span",i0e,K(M(e)("Theme"))+": "+K(M(e)(`${t.themeName}`)),1),P("span",r0e,[P("span",s0e,K(M(e)("Changer")),1),P("span",o0e,[(U(!0),ie(Mt,null,hi(i.value,s=>(U(),ie("div",{class:Rn(`h-2.5 w-2.5 m-px bg-${s.name}-primary`),key:s.id},null,2))),128))])])],8,n0e))}});class l0e{setCurrentThemeColors(e){const t=document.querySelector(":root");["primary","secondary","tertiary","quaternary"].forEach(r=>{const o=getComputedStyle(t).getPropertyValue(`--${e.replace(/\s/g,"_")}-${r}`);t.style.setProperty(`--color-${r}`,o)})}}const u0e=new l0e,c0e={key:0,class:"absolute inset-x-0 top-14 bottom-0 mt-1 bg-primary overflow-y-auto overflow-x-hidden"},h0e=at({__name:"theme-selector",setup(n){const e=Jn(),{setThemeGridOpen:t}=e,{themeGridOpen:i}=It(e),r=Zr(),o=Tl(),{theme:s,themes:l,themeName:u}=It(r),h=Ct(()=>l.value?.filter(y=>y.metadata?.display_in_switcher===!0)||[]);Pt(u,y=>{y&&u0e.setCurrentThemeColors(y)},{immediate:!0});function d(){t(!i.value)}function m(y){o.setTheme(y),d()}return(y,x)=>(U(),ie(Mt,null,[mt(a0e,{"data-cy":"themeSelectorButton",onClick:d,themes:h.value,currentTheme:M(s),themeName:M(u),isOpen:M(i)},null,8,["themes","currentTheme","themeName","isOpen"]),M(i)?(U(),ie("div",c0e,[mt(t0e,{onSetTheme:m,themes:h.value},null,8,["themes"])])):Le("",!0)],64))}}),d0e=["aria-expanded"],f0e={class:"leading-6"},p0e={key:0},GI=at({__name:"expandable-panel",props:{expanded:{type:Boolean},title:{}},emits:["togglePanel"],setup(n){return(e,t)=>(U(),ie(Mt,null,[P("button",{onClick:t[0]||(t[0]=i=>e.$emit("togglePanel")),class:"group w-full text-left flex px-2 py-1.5 uppercase bg-tertiary","aria-expanded":n.expanded},[P("span",{class:Rn(["grow",n.expanded?"text-white":"text-secondary"])},K(n.title),3),P("span",f0e,[P("span",{class:Rn(["fa fa-sharp fa-solid group-hover:text-white text-primary",n.expanded?"fa-caret-up":"fa-caret-down"])},null,2)])],8,d0e),mt(Dw,{name:"slide"},{default:Wt(()=>[n.expanded?(U(),ie("div",p0e,[ei(e.$slots,"default")])):Le("",!0)]),_:3})],64))}}),g0e={class:"mb-px",key:"node.id"},m0e=["data-cy"],y0e=["aria-expanded","data-cy"],_0e={class:"grow"},v0e={class:"leading-6"},b0e=["data-cy"],x0e={key:1,class:"flex text-tertiary pr-2"},I0e=["data-cy"],C0e=["data-cy"],w0e={class:"ml-1 hover:underline"},cR=at({__name:"layer-tree-node",props:{node:{}},emits:["toggleLayer","toggleParent"],setup(n,{emit:e}){const t=n,i=e,{t:r}=St(),{setMetadataLayer:o}=mA(),s=!!t.node.children,l=t.node.depth===0,u=t.node.depth>=10,h=Ct(()=>r(t.node.name,{ns:"client"}));function d(y){i("toggleLayer",y)}function m(y){i("toggleParent",y)}return(y,x)=>{const C=Q9("layer-tree-node",!0);return s?(U(),ie("div",g0e,[n.node.depth===1?(U(),ie("div",{key:0,"data-cy":`parentLayerLabel-${n.node.id}`},[mt(GI,{title:h.value,expanded:n.node.expanded,onTogglePanel:x[0]||(x[0]=w=>m(n.node))},null,8,["title","expanded"])],8,m0e)):n.node.depth>1&&!u?(U(),ie("button",{key:1,class:Rn(["w-full text-left flex px-2 py-1.5 pl-2",n.node.expanded?"text-tertiary":"bg-white text-primary"]),"aria-expanded":n.node.expanded,onClick:x[1]||(x[1]=w=>m(n.node)),"data-cy":`parentLayerLabel-${n.node.id}`},[P("div",_0e,K(h.value),1),P("div",v0e,[P("div",{class:Rn(["fa-sharp fa-solid",n.node.expanded?"fa-minus":"fa-plus"])},null,2)])],10,y0e)):Le("",!0),u?Le("",!0):(U(),ie("div",{key:2,class:Rn(["bg-secondary",[{"pl-2":n.node.depth>1},{"lux-collapse":!l},{expanded:!l&&n.node.expanded}]]),"data-cy":`subLayerLabel-${n.node.id}`},[(U(!0),ie(Mt,null,hi(n.node.children,w=>(U(),Gt(C,{key:w.id,node:w,onToggleParent:x[2]||(x[2]=E=>m(E)),onToggleLayer:x[3]||(x[3]=E=>d(E))},null,8,["node"]))),128))],10,b0e))])):(U(),ie("div",x0e,[P("button",{"data-cy":`layerMetadata-${n.node.id}`,class:"self-start before:text-[.85rem] before:transform before:translate-y-[.1rem] before:inline-block before:content-['\\f129'] fa-solid fa-fw fa-fh fa-info",onClick:x[4]||(x[4]=w=>M(o)(n.node))},null,8,I0e),P("button",{class:Rn(["w-full text-left",{"font-bold":n.node.checked}]),onClick:x[5]||(x[5]=w=>d(n.node)),"data-cy":`layerLabel-${n.node.id}`},[P("i",{class:Rn(["fa-solid",n.node.checked?"fa-check-square":"fa-square"])},null,2),P("span",w0e,K(h.value),1)],10,C0e)]))}}});function hR(n,e=0){const{name:t,id:i,children:r,metadata:o}=n;return{name:t,id:i,depth:e,children:r?.map(s=>hR(s,e+1)),checked:!1,expanded:o?.is_expanded||!1}}class A0e{toggleNode(e,t,i){return t?.id===e?{...t,[i]:!t[i]}:{...t,children:t.children?.map(r=>this.toggleNode(e,r,i))}}updateLayers(e,t){const{id:i}=e;if(e.children)return{...e,children:e.children.map(r=>this.updateLayers(r,t))};{const r=!!t?.find(o=>o.id===i);return{...e,checked:r}}}}const by=new A0e,S0e={key:0,class:"mb-7"},E0e=at({__name:"catalog-tree",setup(n){const e=Ui(),t=Zr(),i=la(),r=mi(),o=mi(),s=Ct(()=>!e.is3dActive||e.is3dActive&&!e.is3dMesh),{layerTrees_3d:l}=It(t);Rs(u);function u(){if(t.theme&&e.layers){const m=r.value&&r.value.id===t.theme?.id?r.value:hR(t.theme);r.value=by.updateLayers(m,e.layers)}}Rs(()=>{if(l.value){const m=o.value?o.value:hR(l.value);o.value=by.updateLayers(m,e.layers3d)}});function h(m,y){const x=y?o:r;x.value=by.toggleNode(m.id,x.value,"expanded")}function d(m,y){i.toggleLayer(+m.id,!m.checked,y,!0)}return(m,y)=>(U(),ie("div",null,[o.value&&M(e).is3dActive?(U(),ie("div",S0e,[(U(),Gt(cR,{node:o.value,key:o.value.id,onToggleParent:y[0]||(y[0]=x=>h(x,!0)),onToggleLayer:y[1]||(y[1]=x=>d(x,!0))},null,8,["node"]))])):Le("",!0),r.value&&s.value?(U(),Gt(cR,{node:r.value,key:r.value.id,onToggleParent:y[2]||(y[2]=x=>h(x,!1)),onToggleLayer:y[3]||(y[3]=x=>d(x,!1))},null,8,["node"])):Le("",!0)]))}}),T0e=at({__name:"catalog-tab",setup(n){const{themeGridOpen:e}=It(Jn());return(t,i)=>(U(),ie(Mt,null,[mt(h0e),M(e)===!1?(U(),Gt(E0e,{key:0,"data-cy":"catalog",class:"pt-5 absolute inset-x-2.5 bg-primary overflow-y-auto overflow-x-hidden"})):Le("",!0)],64))}});function V5(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Dc(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?V5(Object(t),!0).forEach(function(i){R0e(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):V5(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function FI(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?FI=function(e){return typeof e}:FI=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},FI(n)}function R0e(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ed(){return ed=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},ed.apply(this,arguments)}function M0e(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,o;for(o=0;o<i.length;o++)r=i[o],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function k0e(n,e){if(n==null)return{};var t=M0e(n,e),i,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)i=o[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}var L0e="1.15.6";function zh(n){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(n)}var ld=zh(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Nb=zh(/Edge/i),B5=zh(/firefox/i),pv=zh(/safari/i)&&!zh(/chrome/i)&&!zh(/android/i),Bk=zh(/iP(ad|od|hone)/i),$W=zh(/chrome/i)&&zh(/android/i),JW={capture:!1,passive:!1};function Yi(n,e,t){n.addEventListener(e,t,!ld&&JW)}function Wi(n,e,t){n.removeEventListener(e,t,!ld&&JW)}function dw(n,e){if(e){if(e[0]===">"&&(e=e.substring(1)),n)try{if(n.matches)return n.matches(e);if(n.msMatchesSelector)return n.msMatchesSelector(e);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(e)}catch{return!1}return!1}}function qW(n){return n.host&&n!==document&&n.host.nodeType?n.host:n.parentNode}function xu(n,e,t,i){if(n){t=t||document;do{if(e!=null&&(e[0]===">"?n.parentNode===t&&dw(n,e):dw(n,e))||i&&n===t)return n;if(n===t)break}while(n=qW(n))}return null}var Z5=/\s+/g;function dl(n,e,t){if(n&&e)if(n.classList)n.classList[t?"add":"remove"](e);else{var i=(" "+n.className+" ").replace(Z5," ").replace(" "+e+" "," ");n.className=(i+(t?" "+e:"")).replace(Z5," ")}}function ti(n,e,t){var i=n&&n.style;if(i){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(n,""):n.currentStyle&&(t=n.currentStyle),e===void 0?t:t[e];!(e in i)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),i[e]=t+(typeof t=="string"?"":"px")}}function xy(n,e){var t="";if(typeof n=="string")t=n;else do{var i=ti(n,"transform");i&&i!=="none"&&(t=i+" "+t)}while(!e&&(n=n.parentNode));var r=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return r&&new r(t)}function QW(n,e,t){if(n){var i=n.getElementsByTagName(e),r=0,o=i.length;if(t)for(;r<o;r++)t(i[r],r);return i}return[]}function Lc(){var n=document.scrollingElement;return n||document.documentElement}function Qs(n,e,t,i,r){if(!(!n.getBoundingClientRect&&n!==window)){var o,s,l,u,h,d,m;if(n!==window&&n.parentNode&&n!==Lc()?(o=n.getBoundingClientRect(),s=o.top,l=o.left,u=o.bottom,h=o.right,d=o.height,m=o.width):(s=0,l=0,u=window.innerHeight,h=window.innerWidth,d=window.innerHeight,m=window.innerWidth),(e||t)&&n!==window&&(r=r||n.parentNode,!ld))do if(r&&r.getBoundingClientRect&&(ti(r,"transform")!=="none"||t&&ti(r,"position")!=="static")){var y=r.getBoundingClientRect();s-=y.top+parseInt(ti(r,"border-top-width")),l-=y.left+parseInt(ti(r,"border-left-width")),u=s+o.height,h=l+o.width;break}while(r=r.parentNode);if(i&&n!==window){var x=xy(r||n),C=x&&x.a,w=x&&x.d;x&&(s/=w,l/=C,m/=C,d/=w,u=s+d,h=l+m)}return{top:s,left:l,bottom:u,right:h,width:m,height:d}}}function W5(n,e,t){for(var i=rf(n,!0),r=Qs(n)[e];i;){var o=Qs(i)[t],s=void 0;if(s=r>=o,!s)return i;if(i===Lc())break;i=rf(i,!1)}return!1}function Dy(n,e,t,i){for(var r=0,o=0,s=n.children;o<s.length;){if(s[o].style.display!=="none"&&s[o]!==ni.ghost&&(i||s[o]!==ni.dragged)&&xu(s[o],t.draggable,n,!1)){if(r===e)return s[o];r++}o++}return null}function Zk(n,e){for(var t=n.lastElementChild;t&&(t===ni.ghost||ti(t,"display")==="none"||e&&!dw(t,e));)t=t.previousElementSibling;return t||null}function Ul(n,e){var t=0;if(!n||!n.parentNode)return-1;for(;n=n.previousElementSibling;)n.nodeName.toUpperCase()!=="TEMPLATE"&&n!==ni.clone&&(!e||dw(n,e))&&t++;return t}function z5(n){var e=0,t=0,i=Lc();if(n)do{var r=xy(n),o=r.a,s=r.d;e+=n.scrollLeft*o,t+=n.scrollTop*s}while(n!==i&&(n=n.parentNode));return[e,t]}function P0e(n,e){for(var t in n)if(n.hasOwnProperty(t)){for(var i in e)if(e.hasOwnProperty(i)&&e[i]===n[t][i])return Number(t)}return-1}function rf(n,e){if(!n||!n.getBoundingClientRect)return Lc();var t=n,i=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var r=ti(t);if(t.clientWidth<t.scrollWidth&&(r.overflowX=="auto"||r.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(r.overflowY=="auto"||r.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Lc();if(i||e)return t;i=!0}}while(t=t.parentNode);return Lc()}function G0e(n,e){if(n&&e)for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}function tE(n,e){return Math.round(n.top)===Math.round(e.top)&&Math.round(n.left)===Math.round(e.left)&&Math.round(n.height)===Math.round(e.height)&&Math.round(n.width)===Math.round(e.width)}var gv;function ez(n,e){return function(){if(!gv){var t=arguments,i=this;t.length===1?n.call(i,t[0]):n.apply(i,t),gv=setTimeout(function(){gv=void 0},e)}}}function F0e(){clearTimeout(gv),gv=void 0}function tz(n,e,t){n.scrollLeft+=e,n.scrollTop+=t}function nz(n){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(n).cloneNode(!0):t?t(n).clone(!0)[0]:n.cloneNode(!0)}function iz(n,e,t){var i={};return Array.from(n.children).forEach(function(r){var o,s,l,u;if(!(!xu(r,e.draggable,n,!1)||r.animated||r===t)){var h=Qs(r);i.left=Math.min((o=i.left)!==null&&o!==void 0?o:1/0,h.left),i.top=Math.min((s=i.top)!==null&&s!==void 0?s:1/0,h.top),i.right=Math.max((l=i.right)!==null&&l!==void 0?l:-1/0,h.right),i.bottom=Math.max((u=i.bottom)!==null&&u!==void 0?u:-1/0,h.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var Ka="Sortable"+new Date().getTime();function O0e(){var n=[],e;return{captureAnimationState:function(){if(n=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(r){if(!(ti(r,"display")==="none"||r===ni.ghost)){n.push({target:r,rect:Qs(r)});var o=Dc({},n[n.length-1].rect);if(r.thisAnimationDuration){var s=xy(r,!0);s&&(o.top-=s.f,o.left-=s.e)}r.fromRect=o}})}},addAnimationState:function(i){n.push(i)},removeAnimationState:function(i){n.splice(P0e(n,{target:i}),1)},animateAll:function(i){var r=this;if(!this.options.animation){clearTimeout(e),typeof i=="function"&&i();return}var o=!1,s=0;n.forEach(function(l){var u=0,h=l.target,d=h.fromRect,m=Qs(h),y=h.prevFromRect,x=h.prevToRect,C=l.rect,w=xy(h,!0);w&&(m.top-=w.f,m.left-=w.e),h.toRect=m,h.thisAnimationDuration&&tE(y,m)&&!tE(d,m)&&(C.top-m.top)/(C.left-m.left)===(d.top-m.top)/(d.left-m.left)&&(u=D0e(C,y,x,r.options)),tE(m,d)||(h.prevFromRect=d,h.prevToRect=m,u||(u=r.options.animation),r.animate(h,C,m,u)),u&&(o=!0,s=Math.max(s,u),clearTimeout(h.animationResetTimer),h.animationResetTimer=setTimeout(function(){h.animationTime=0,h.prevFromRect=null,h.fromRect=null,h.prevToRect=null,h.thisAnimationDuration=null},u),h.thisAnimationDuration=u)}),clearTimeout(e),o?e=setTimeout(function(){typeof i=="function"&&i()},s):typeof i=="function"&&i(),n=[]},animate:function(i,r,o,s){if(s){ti(i,"transition",""),ti(i,"transform","");var l=xy(this.el),u=l&&l.a,h=l&&l.d,d=(r.left-o.left)/(u||1),m=(r.top-o.top)/(h||1);i.animatingX=!!d,i.animatingY=!!m,ti(i,"transform","translate3d("+d+"px,"+m+"px,0)"),this.forRepaintDummy=N0e(i),ti(i,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),ti(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){ti(i,"transition",""),ti(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},s)}}}}function N0e(n){return n.offsetWidth}function D0e(n,e,t,i){return Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*i.animation}var Em=[],nE={initializeByDefault:!0},Db={mount:function(e){for(var t in nE)nE.hasOwnProperty(t)&&!(t in e)&&(e[t]=nE[t]);Em.forEach(function(i){if(i.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),Em.push(e)},pluginEvent:function(e,t,i){var r=this;this.eventCanceled=!1,i.cancel=function(){r.eventCanceled=!0};var o=e+"Global";Em.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][o]&&t[s.pluginName][o](Dc({sortable:t},i)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](Dc({sortable:t},i)))})},initializePlugins:function(e,t,i,r){Em.forEach(function(l){var u=l.pluginName;if(!(!e.options[u]&&!l.initializeByDefault)){var h=new l(e,t,e.options);h.sortable=e,h.options=e.options,e[u]=h,ed(i,h.defaults)}});for(var o in e.options)if(e.options.hasOwnProperty(o)){var s=this.modifyOption(e,o,e.options[o]);typeof s<"u"&&(e.options[o]=s)}},getEventProperties:function(e,t){var i={};return Em.forEach(function(r){typeof r.eventProperties=="function"&&ed(i,r.eventProperties.call(t[r.pluginName],e))}),i},modifyOption:function(e,t,i){var r;return Em.forEach(function(o){e[o.pluginName]&&o.optionListeners&&typeof o.optionListeners[t]=="function"&&(r=o.optionListeners[t].call(e[o.pluginName],i))}),r}};function V0e(n){var e=n.sortable,t=n.rootEl,i=n.name,r=n.targetEl,o=n.cloneEl,s=n.toEl,l=n.fromEl,u=n.oldIndex,h=n.newIndex,d=n.oldDraggableIndex,m=n.newDraggableIndex,y=n.originalEvent,x=n.putSortable,C=n.extraEventProperties;if(e=e||t&&t[Ka],!!e){var w,E=e.options,T="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!ld&&!Nb?w=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(w=document.createEvent("Event"),w.initEvent(i,!0,!0)),w.to=s||t,w.from=l||t,w.item=r||t,w.clone=o,w.oldIndex=u,w.newIndex=h,w.oldDraggableIndex=d,w.newDraggableIndex=m,w.originalEvent=y,w.pullMode=x?x.lastPutMode:void 0;var k=Dc(Dc({},C),Db.getEventProperties(i,e));for(var G in k)w[G]=k[G];t&&t.dispatchEvent(w),E[T]&&E[T].call(e,w)}}var B0e=["evt"],Da=function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=i.evt,o=k0e(i,B0e);Db.pluginEvent.bind(ni)(e,t,Dc({dragEl:ln,parentEl:ws,ghostEl:gi,rootEl:rs,nextEl:Ep,lastDownEl:OI,cloneEl:hs,cloneHidden:Hd,dragStarted:W0,putSortable:Lo,activeSortable:ni.active,originalEvent:r,oldIndex:qm,oldDraggableIndex:mv,newIndex:fl,newDraggableIndex:zd,hideGhostForTarget:az,unhideGhostForTarget:lz,cloneNowHidden:function(){Hd=!0},cloneNowShown:function(){Hd=!1},dispatchSortableEvent:function(l){_a({sortable:t,name:l,originalEvent:r})}},o))};function _a(n){V0e(Dc({putSortable:Lo,cloneEl:hs,targetEl:ln,rootEl:rs,oldIndex:qm,oldDraggableIndex:mv,newIndex:fl,newDraggableIndex:zd},n))}var ln,ws,gi,rs,Ep,OI,hs,Hd,qm,fl,mv,zd,jx,Lo,Dm=!1,fw=!1,pw=[],bp,mu,iE,rE,U5,X5,W0,Tm,yv,_v=!1,$x=!1,NI,$o,sE=[],dR=!1,gw=[],TA=typeof document<"u",Jx=Bk,Y5=Nb||ld?"cssFloat":"float",Z0e=TA&&!$W&&!Bk&&"draggable"in document.createElement("div"),rz=(function(){if(TA){if(ld)return!1;var n=document.createElement("x");return n.style.cssText="pointer-events:auto",n.style.pointerEvents==="auto"}})(),sz=function(e,t){var i=ti(e),r=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=Dy(e,0,t),s=Dy(e,1,t),l=o&&ti(o),u=s&&ti(s),h=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+Qs(o).width,d=u&&parseInt(u.marginLeft)+parseInt(u.marginRight)+Qs(s).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&l.float&&l.float!=="none"){var m=l.float==="left"?"left":"right";return s&&(u.clear==="both"||u.clear===m)?"vertical":"horizontal"}return o&&(l.display==="block"||l.display==="flex"||l.display==="table"||l.display==="grid"||h>=r&&i[Y5]==="none"||s&&i[Y5]==="none"&&h+d>r)?"vertical":"horizontal"},W0e=function(e,t,i){var r=i?e.left:e.top,o=i?e.right:e.bottom,s=i?e.width:e.height,l=i?t.left:t.top,u=i?t.right:t.bottom,h=i?t.width:t.height;return r===l||o===u||r+s/2===l+h/2},z0e=function(e,t){var i;return pw.some(function(r){var o=r[Ka].options.emptyInsertThreshold;if(!(!o||Zk(r))){var s=Qs(r),l=e>=s.left-o&&e<=s.right+o,u=t>=s.top-o&&t<=s.bottom+o;if(l&&u)return i=r}}),i},oz=function(e){function t(o,s){return function(l,u,h,d){var m=l.options.group.name&&u.options.group.name&&l.options.group.name===u.options.group.name;if(o==null&&(s||m))return!0;if(o==null||o===!1)return!1;if(s&&o==="clone")return o;if(typeof o=="function")return t(o(l,u,h,d),s)(l,u,h,d);var y=(s?l:u).options.group.name;return o===!0||typeof o=="string"&&o===y||o.join&&o.indexOf(y)>-1}}var i={},r=e.group;(!r||FI(r)!="object")&&(r={name:r}),i.name=r.name,i.checkPull=t(r.pull,!0),i.checkPut=t(r.put),i.revertClone=r.revertClone,e.group=i},az=function(){!rz&&gi&&ti(gi,"display","none")},lz=function(){!rz&&gi&&ti(gi,"display","")};TA&&!$W&&document.addEventListener("click",function(n){if(fw)return n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.stopImmediatePropagation&&n.stopImmediatePropagation(),fw=!1,!1},!0);var xp=function(e){if(ln){e=e.touches?e.touches[0]:e;var t=z0e(e.clientX,e.clientY);if(t){var i={};for(var r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);i.target=i.rootEl=t,i.preventDefault=void 0,i.stopPropagation=void 0,t[Ka]._onDragOver(i)}}},U0e=function(e){ln&&ln.parentNode[Ka]._isOutsideThisEl(e.target)};function ni(n,e){if(!(n&&n.nodeType&&n.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(n));this.el=n,this.options=e=ed({},e),n[Ka]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(n.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return sz(n,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,l){s.setData("Text",l.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:ni.supportPointer!==!1&&"PointerEvent"in window&&(!pv||Bk),emptyInsertThreshold:5};Db.initializePlugins(this,n,t);for(var i in t)!(i in e)&&(e[i]=t[i]);oz(e);for(var r in this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this));this.nativeDraggable=e.forceFallback?!1:Z0e,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?Yi(n,"pointerdown",this._onTapStart):(Yi(n,"mousedown",this._onTapStart),Yi(n,"touchstart",this._onTapStart)),this.nativeDraggable&&(Yi(n,"dragover",this),Yi(n,"dragenter",this)),pw.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),ed(this,O0e())}ni.prototype={constructor:ni,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(Tm=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,ln):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,i=this.el,r=this.options,o=r.preventOnFilter,s=e.type,l=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,u=(l||e).target,h=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||u,d=r.filter;if(q0e(i),!ln&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||r.disabled)&&!h.isContentEditable&&!(!this.nativeDraggable&&pv&&u&&u.tagName.toUpperCase()==="SELECT")&&(u=xu(u,r.draggable,i,!1),!(u&&u.animated)&&OI!==u)){if(qm=Ul(u),mv=Ul(u,r.draggable),typeof d=="function"){if(d.call(this,e,u,this)){_a({sortable:t,rootEl:h,name:"filter",targetEl:u,toEl:i,fromEl:i}),Da("filter",t,{evt:e}),o&&e.preventDefault();return}}else if(d&&(d=d.split(",").some(function(m){if(m=xu(h,m.trim(),i,!1),m)return _a({sortable:t,rootEl:m,name:"filter",targetEl:u,fromEl:i,toEl:i}),Da("filter",t,{evt:e}),!0}),d)){o&&e.preventDefault();return}r.handle&&!xu(h,r.handle,i,!1)||this._prepareDragStart(e,l,u)}}},_prepareDragStart:function(e,t,i){var r=this,o=r.el,s=r.options,l=o.ownerDocument,u;if(i&&!ln&&i.parentNode===o){var h=Qs(i);if(rs=o,ln=i,ws=ln.parentNode,Ep=ln.nextSibling,OI=i,jx=s.group,ni.dragged=ln,bp={target:ln,clientX:(t||e).clientX,clientY:(t||e).clientY},U5=bp.clientX-h.left,X5=bp.clientY-h.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,ln.style["will-change"]="all",u=function(){if(Da("delayEnded",r,{evt:e}),ni.eventCanceled){r._onDrop();return}r._disableDelayedDragEvents(),!B5&&r.nativeDraggable&&(ln.draggable=!0),r._triggerDragStart(e,t),_a({sortable:r,name:"choose",originalEvent:e}),dl(ln,s.chosenClass,!0)},s.ignore.split(",").forEach(function(d){QW(ln,d.trim(),oE)}),Yi(l,"dragover",xp),Yi(l,"mousemove",xp),Yi(l,"touchmove",xp),s.supportPointer?(Yi(l,"pointerup",r._onDrop),!this.nativeDraggable&&Yi(l,"pointercancel",r._onDrop)):(Yi(l,"mouseup",r._onDrop),Yi(l,"touchend",r._onDrop),Yi(l,"touchcancel",r._onDrop)),B5&&this.nativeDraggable&&(this.options.touchStartThreshold=4,ln.draggable=!0),Da("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(Nb||ld))){if(ni.eventCanceled){this._onDrop();return}s.supportPointer?(Yi(l,"pointerup",r._disableDelayedDrag),Yi(l,"pointercancel",r._disableDelayedDrag)):(Yi(l,"mouseup",r._disableDelayedDrag),Yi(l,"touchend",r._disableDelayedDrag),Yi(l,"touchcancel",r._disableDelayedDrag)),Yi(l,"mousemove",r._delayedDragTouchMoveHandler),Yi(l,"touchmove",r._delayedDragTouchMoveHandler),s.supportPointer&&Yi(l,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=setTimeout(u,s.delay)}else u()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){ln&&oE(ln),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;Wi(e,"mouseup",this._disableDelayedDrag),Wi(e,"touchend",this._disableDelayedDrag),Wi(e,"touchcancel",this._disableDelayedDrag),Wi(e,"pointerup",this._disableDelayedDrag),Wi(e,"pointercancel",this._disableDelayedDrag),Wi(e,"mousemove",this._delayedDragTouchMoveHandler),Wi(e,"touchmove",this._delayedDragTouchMoveHandler),Wi(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?Yi(document,"pointermove",this._onTouchMove):t?Yi(document,"touchmove",this._onTouchMove):Yi(document,"mousemove",this._onTouchMove):(Yi(ln,"dragend",this),Yi(rs,"dragstart",this._onDragStart));try{document.selection?DI(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(Dm=!1,rs&&ln){Da("dragStarted",this,{evt:t}),this.nativeDraggable&&Yi(document,"dragover",U0e);var i=this.options;!e&&dl(ln,i.dragClass,!1),dl(ln,i.ghostClass,!0),ni.active=this,e&&this._appendGhost(),_a({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(mu){this._lastX=mu.clientX,this._lastY=mu.clientY,az();for(var e=document.elementFromPoint(mu.clientX,mu.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(mu.clientX,mu.clientY),e!==t);)t=e;if(ln.parentNode[Ka]._isOutsideThisEl(e),t)do{if(t[Ka]){var i=void 0;if(i=t[Ka]._onDragOver({clientX:mu.clientX,clientY:mu.clientY,target:e,rootEl:t}),i&&!this.options.dragoverBubble)break}e=t}while(t=qW(t));lz()}},_onTouchMove:function(e){if(bp){var t=this.options,i=t.fallbackTolerance,r=t.fallbackOffset,o=e.touches?e.touches[0]:e,s=gi&&xy(gi,!0),l=gi&&s&&s.a,u=gi&&s&&s.d,h=Jx&&$o&&z5($o),d=(o.clientX-bp.clientX+r.x)/(l||1)+(h?h[0]-sE[0]:0)/(l||1),m=(o.clientY-bp.clientY+r.y)/(u||1)+(h?h[1]-sE[1]:0)/(u||1);if(!ni.active&&!Dm){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if(gi){s?(s.e+=d-(iE||0),s.f+=m-(rE||0)):s={a:1,b:0,c:0,d:1,e:d,f:m};var y="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");ti(gi,"webkitTransform",y),ti(gi,"mozTransform",y),ti(gi,"msTransform",y),ti(gi,"transform",y),iE=d,rE=m,mu=o}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!gi){var e=this.options.fallbackOnBody?document.body:rs,t=Qs(ln,!0,Jx,!0,e),i=this.options;if(Jx){for($o=e;ti($o,"position")==="static"&&ti($o,"transform")==="none"&&$o!==document;)$o=$o.parentNode;$o!==document.body&&$o!==document.documentElement?($o===document&&($o=Lc()),t.top+=$o.scrollTop,t.left+=$o.scrollLeft):$o=Lc(),sE=z5($o)}gi=ln.cloneNode(!0),dl(gi,i.ghostClass,!1),dl(gi,i.fallbackClass,!0),dl(gi,i.dragClass,!0),ti(gi,"transition",""),ti(gi,"transform",""),ti(gi,"box-sizing","border-box"),ti(gi,"margin",0),ti(gi,"top",t.top),ti(gi,"left",t.left),ti(gi,"width",t.width),ti(gi,"height",t.height),ti(gi,"opacity","0.8"),ti(gi,"position",Jx?"absolute":"fixed"),ti(gi,"zIndex","100000"),ti(gi,"pointerEvents","none"),ni.ghost=gi,e.appendChild(gi),ti(gi,"transform-origin",U5/parseInt(gi.style.width)*100+"% "+X5/parseInt(gi.style.height)*100+"%")}},_onDragStart:function(e,t){var i=this,r=e.dataTransfer,o=i.options;if(Da("dragStart",this,{evt:e}),ni.eventCanceled){this._onDrop();return}Da("setupClone",this),ni.eventCanceled||(hs=nz(ln),hs.removeAttribute("id"),hs.draggable=!1,hs.style["will-change"]="",this._hideClone(),dl(hs,this.options.chosenClass,!1),ni.clone=hs),i.cloneId=DI(function(){Da("clone",i),!ni.eventCanceled&&(i.options.removeCloneOnHide||rs.insertBefore(hs,ln),i._hideClone(),_a({sortable:i,name:"clone"}))}),!t&&dl(ln,o.dragClass,!0),t?(fw=!0,i._loopId=setInterval(i._emulateDragOver,50)):(Wi(document,"mouseup",i._onDrop),Wi(document,"touchend",i._onDrop),Wi(document,"touchcancel",i._onDrop),r&&(r.effectAllowed="move",o.setData&&o.setData.call(i,r,ln)),Yi(document,"drop",i),ti(ln,"transform","translateZ(0)")),Dm=!0,i._dragStartId=DI(i._dragStarted.bind(i,t,e)),Yi(document,"selectstart",i),W0=!0,window.getSelection().removeAllRanges(),pv&&ti(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,i=e.target,r,o,s,l=this.options,u=l.group,h=ni.active,d=jx===u,m=l.sort,y=Lo||h,x,C=this,w=!1;if(dR)return;function E(Ne,Ee){Da(Ne,C,Dc({evt:e,isOwner:d,axis:x?"vertical":"horizontal",revert:s,dragRect:r,targetRect:o,canSort:m,fromSortable:y,target:i,completed:k,onMove:function(q,j){return qx(rs,t,ln,r,q,Qs(q),e,j)},changed:G},Ee))}function T(){E("dragOverAnimationCapture"),C.captureAnimationState(),C!==y&&y.captureAnimationState()}function k(Ne){return E("dragOverCompleted",{insertion:Ne}),Ne&&(d?h._hideClone():h._showClone(C),C!==y&&(dl(ln,Lo?Lo.options.ghostClass:h.options.ghostClass,!1),dl(ln,l.ghostClass,!0)),Lo!==C&&C!==ni.active?Lo=C:C===ni.active&&Lo&&(Lo=null),y===C&&(C._ignoreWhileAnimating=i),C.animateAll(function(){E("dragOverAnimationComplete"),C._ignoreWhileAnimating=null}),C!==y&&(y.animateAll(),y._ignoreWhileAnimating=null)),(i===ln&&!ln.animated||i===t&&!i.animated)&&(Tm=null),!l.dragoverBubble&&!e.rootEl&&i!==document&&(ln.parentNode[Ka]._isOutsideThisEl(e.target),!Ne&&xp(e)),!l.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),w=!0}function G(){fl=Ul(ln),zd=Ul(ln,l.draggable),_a({sortable:C,name:"change",toEl:t,newIndex:fl,newDraggableIndex:zd,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),i=xu(i,l.draggable,t,!0),E("dragOver"),ni.eventCanceled)return w;if(ln.contains(e.target)||i.animated&&i.animatingX&&i.animatingY||C._ignoreWhileAnimating===i)return k(!1);if(fw=!1,h&&!l.disabled&&(d?m||(s=ws!==rs):Lo===this||(this.lastPutMode=jx.checkPull(this,h,ln,e))&&u.checkPut(this,h,ln,e))){if(x=this._getDirection(e,i)==="vertical",r=Qs(ln),E("dragOverValid"),ni.eventCanceled)return w;if(s)return ws=rs,T(),this._hideClone(),E("revert"),ni.eventCanceled||(Ep?rs.insertBefore(ln,Ep):rs.appendChild(ln)),k(!0);var O=Zk(t,l.draggable);if(!O||K0e(e,x,this)&&!O.animated){if(O===ln)return k(!1);if(O&&t===e.target&&(i=O),i&&(o=Qs(i)),qx(rs,t,ln,r,i,o,e,!!i)!==!1)return T(),O&&O.nextSibling?t.insertBefore(ln,O.nextSibling):t.appendChild(ln),ws=t,G(),k(!0)}else if(O&&H0e(e,x,this)){var V=Dy(t,0,l,!0);if(V===ln)return k(!1);if(i=V,o=Qs(i),qx(rs,t,ln,r,i,o,e,!1)!==!1)return T(),t.insertBefore(ln,V),ws=t,G(),k(!0)}else if(i.parentNode===t){o=Qs(i);var z=0,H,te=ln.parentNode!==t,$=!W0e(ln.animated&&ln.toRect||r,i.animated&&i.toRect||o,x),ae=x?"top":"left",fe=W5(i,"top","top")||W5(ln,"top","top"),Y=fe?fe.scrollTop:void 0;Tm!==i&&(H=o[ae],_v=!1,$x=!$&&l.invertSwap||te),z=j0e(e,i,o,x,$?1:l.swapThreshold,l.invertedSwapThreshold==null?l.swapThreshold:l.invertedSwapThreshold,$x,Tm===i);var de;if(z!==0){var D=Ul(ln);do D-=z,de=ws.children[D];while(de&&(ti(de,"display")==="none"||de===gi))}if(z===0||de===i)return k(!1);Tm=i,yv=z;var oe=i.nextElementSibling,ue=!1;ue=z===1;var ge=qx(rs,t,ln,r,i,o,e,ue);if(ge!==!1)return(ge===1||ge===-1)&&(ue=ge===1),dR=!0,setTimeout(Y0e,30),T(),ue&&!oe?t.appendChild(ln):i.parentNode.insertBefore(ln,ue?oe:i),fe&&tz(fe,0,Y-fe.scrollTop),ws=ln.parentNode,H!==void 0&&!$x&&(NI=Math.abs(H-Qs(i)[ae])),G(),k(!0)}if(t.contains(ln))return k(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){Wi(document,"mousemove",this._onTouchMove),Wi(document,"touchmove",this._onTouchMove),Wi(document,"pointermove",this._onTouchMove),Wi(document,"dragover",xp),Wi(document,"mousemove",xp),Wi(document,"touchmove",xp)},_offUpEvents:function(){var e=this.el.ownerDocument;Wi(e,"mouseup",this._onDrop),Wi(e,"touchend",this._onDrop),Wi(e,"pointerup",this._onDrop),Wi(e,"pointercancel",this._onDrop),Wi(e,"touchcancel",this._onDrop),Wi(document,"selectstart",this)},_onDrop:function(e){var t=this.el,i=this.options;if(fl=Ul(ln),zd=Ul(ln,i.draggable),Da("drop",this,{evt:e}),ws=ln&&ln.parentNode,fl=Ul(ln),zd=Ul(ln,i.draggable),ni.eventCanceled){this._nulling();return}Dm=!1,$x=!1,_v=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),fR(this.cloneId),fR(this._dragStartId),this.nativeDraggable&&(Wi(document,"drop",this),Wi(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),pv&&ti(document.body,"user-select",""),ti(ln,"transform",""),e&&(W0&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),gi&&gi.parentNode&&gi.parentNode.removeChild(gi),(rs===ws||Lo&&Lo.lastPutMode!=="clone")&&hs&&hs.parentNode&&hs.parentNode.removeChild(hs),ln&&(this.nativeDraggable&&Wi(ln,"dragend",this),oE(ln),ln.style["will-change"]="",W0&&!Dm&&dl(ln,Lo?Lo.options.ghostClass:this.options.ghostClass,!1),dl(ln,this.options.chosenClass,!1),_a({sortable:this,name:"unchoose",toEl:ws,newIndex:null,newDraggableIndex:null,originalEvent:e}),rs!==ws?(fl>=0&&(_a({rootEl:ws,name:"add",toEl:ws,fromEl:rs,originalEvent:e}),_a({sortable:this,name:"remove",toEl:ws,originalEvent:e}),_a({rootEl:ws,name:"sort",toEl:ws,fromEl:rs,originalEvent:e}),_a({sortable:this,name:"sort",toEl:ws,originalEvent:e})),Lo&&Lo.save()):fl!==qm&&fl>=0&&(_a({sortable:this,name:"update",toEl:ws,originalEvent:e}),_a({sortable:this,name:"sort",toEl:ws,originalEvent:e})),ni.active&&((fl==null||fl===-1)&&(fl=qm,zd=mv),_a({sortable:this,name:"end",toEl:ws,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){Da("nulling",this),rs=ln=ws=gi=Ep=hs=OI=Hd=bp=mu=W0=fl=zd=qm=mv=Tm=yv=Lo=jx=ni.dragged=ni.ghost=ni.clone=ni.active=null,gw.forEach(function(e){e.checked=!0}),gw.length=iE=rE=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":ln&&(this._onDragOver(e),X0e(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,i=this.el.children,r=0,o=i.length,s=this.options;r<o;r++)t=i[r],xu(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||J0e(t));return e},sort:function(e,t){var i={},r=this.el;this.toArray().forEach(function(o,s){var l=r.children[s];xu(l,this.options.draggable,r,!1)&&(i[o]=l)},this),t&&this.captureAnimationState(),e.forEach(function(o){i[o]&&(r.removeChild(i[o]),r.appendChild(i[o]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return xu(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var i=this.options;if(t===void 0)return i[e];var r=Db.modifyOption(this,e,t);typeof r<"u"?i[e]=r:i[e]=t,e==="group"&&oz(i)},destroy:function(){Da("destroy",this);var e=this.el;e[Ka]=null,Wi(e,"mousedown",this._onTapStart),Wi(e,"touchstart",this._onTapStart),Wi(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(Wi(e,"dragover",this),Wi(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),pw.splice(pw.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Hd){if(Da("hideClone",this),ni.eventCanceled)return;ti(hs,"display","none"),this.options.removeCloneOnHide&&hs.parentNode&&hs.parentNode.removeChild(hs),Hd=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Hd){if(Da("showClone",this),ni.eventCanceled)return;ln.parentNode==rs&&!this.options.group.revertClone?rs.insertBefore(hs,ln):Ep?rs.insertBefore(hs,Ep):rs.appendChild(hs),this.options.group.revertClone&&this.animate(ln,hs),ti(hs,"display",""),Hd=!1}}};function X0e(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move"),n.cancelable&&n.preventDefault()}function qx(n,e,t,i,r,o,s,l){var u,h=n[Ka],d=h.options.onMove,m;return window.CustomEvent&&!ld&&!Nb?u=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(u=document.createEvent("Event"),u.initEvent("move",!0,!0)),u.to=e,u.from=n,u.dragged=t,u.draggedRect=i,u.related=r||e,u.relatedRect=o||Qs(e),u.willInsertAfter=l,u.originalEvent=s,n.dispatchEvent(u),d&&(m=d.call(h,u,s)),m}function oE(n){n.draggable=!1}function Y0e(){dR=!1}function H0e(n,e,t){var i=Qs(Dy(t.el,0,t.options,!0)),r=iz(t.el,t.options,gi),o=10;return e?n.clientX<r.left-o||n.clientY<i.top&&n.clientX<i.right:n.clientY<r.top-o||n.clientY<i.bottom&&n.clientX<i.left}function K0e(n,e,t){var i=Qs(Zk(t.el,t.options.draggable)),r=iz(t.el,t.options,gi),o=10;return e?n.clientX>r.right+o||n.clientY>i.bottom&&n.clientX>i.left:n.clientY>r.bottom+o||n.clientX>i.right&&n.clientY>i.top}function j0e(n,e,t,i,r,o,s,l){var u=i?n.clientY:n.clientX,h=i?t.height:t.width,d=i?t.top:t.left,m=i?t.bottom:t.right,y=!1;if(!s){if(l&&NI<h*r){if(!_v&&(yv===1?u>d+h*o/2:u<m-h*o/2)&&(_v=!0),_v)y=!0;else if(yv===1?u<d+NI:u>m-NI)return-yv}else if(u>d+h*(1-r)/2&&u<m-h*(1-r)/2)return $0e(e)}return y=y||s,y&&(u<d+h*o/2||u>m-h*o/2)?u>d+h/2?1:-1:0}function $0e(n){return Ul(ln)<Ul(n)?1:-1}function J0e(n){for(var e=n.tagName+n.className+n.src+n.href+n.textContent,t=e.length,i=0;t--;)i+=e.charCodeAt(t);return i.toString(36)}function q0e(n){gw.length=0;for(var e=n.getElementsByTagName("input"),t=e.length;t--;){var i=e[t];i.checked&&gw.push(i)}}function DI(n){return setTimeout(n,0)}function fR(n){return clearTimeout(n)}TA&&Yi(document,"touchmove",function(n){(ni.active||Dm)&&n.cancelable&&n.preventDefault()});ni.utils={on:Yi,off:Wi,css:ti,find:QW,is:function(e,t){return!!xu(e,t,e,!1)},extend:G0e,throttle:ez,closest:xu,toggleClass:dl,clone:nz,index:Ul,nextTick:DI,cancelNextTick:fR,detectDirection:sz,getChild:Dy,expando:Ka};ni.get=function(n){return n[Ka]};ni.mount=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(ni.utils=Dc(Dc({},ni.utils),i.utils)),Db.mount(i)})};ni.create=function(n,e){return new ni(n,e)};ni.version=L0e;var $s=[],z0,pR,gR=!1,aE,lE,mw,U0;function Q0e(){function n(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return n.prototype={dragStarted:function(t){var i=t.originalEvent;this.sortable.nativeDraggable?Yi(document,"dragover",this._handleAutoScroll):this.options.supportPointer?Yi(document,"pointermove",this._handleFallbackAutoScroll):i.touches?Yi(document,"touchmove",this._handleFallbackAutoScroll):Yi(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var i=t.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?Wi(document,"dragover",this._handleAutoScroll):(Wi(document,"pointermove",this._handleFallbackAutoScroll),Wi(document,"touchmove",this._handleFallbackAutoScroll),Wi(document,"mousemove",this._handleFallbackAutoScroll)),H5(),VI(),F0e()},nulling:function(){mw=pR=z0=gR=U0=aE=lE=null,$s.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,i){var r=this,o=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,l=document.elementFromPoint(o,s);if(mw=t,i||this.options.forceAutoScrollFallback||Nb||ld||pv){uE(t,this.options,l,i);var u=rf(l,!0);gR&&(!U0||o!==aE||s!==lE)&&(U0&&H5(),U0=setInterval(function(){var h=rf(document.elementFromPoint(o,s),!0);h!==u&&(u=h,VI()),uE(t,r.options,h,i)},10),aE=o,lE=s)}else{if(!this.options.bubbleScroll||rf(l,!0)===Lc()){VI();return}uE(t,this.options,rf(l,!1),!1)}}},ed(n,{pluginName:"scroll",initializeByDefault:!0})}function VI(){$s.forEach(function(n){clearInterval(n.pid)}),$s=[]}function H5(){clearInterval(U0)}var uE=ez(function(n,e,t,i){if(e.scroll){var r=(n.touches?n.touches[0]:n).clientX,o=(n.touches?n.touches[0]:n).clientY,s=e.scrollSensitivity,l=e.scrollSpeed,u=Lc(),h=!1,d;pR!==t&&(pR=t,VI(),z0=e.scroll,d=e.scrollFn,z0===!0&&(z0=rf(t,!0)));var m=0,y=z0;do{var x=y,C=Qs(x),w=C.top,E=C.bottom,T=C.left,k=C.right,G=C.width,O=C.height,V=void 0,z=void 0,H=x.scrollWidth,te=x.scrollHeight,$=ti(x),ae=x.scrollLeft,fe=x.scrollTop;x===u?(V=G<H&&($.overflowX==="auto"||$.overflowX==="scroll"||$.overflowX==="visible"),z=O<te&&($.overflowY==="auto"||$.overflowY==="scroll"||$.overflowY==="visible")):(V=G<H&&($.overflowX==="auto"||$.overflowX==="scroll"),z=O<te&&($.overflowY==="auto"||$.overflowY==="scroll"));var Y=V&&(Math.abs(k-r)<=s&&ae+G<H)-(Math.abs(T-r)<=s&&!!ae),de=z&&(Math.abs(E-o)<=s&&fe+O<te)-(Math.abs(w-o)<=s&&!!fe);if(!$s[m])for(var D=0;D<=m;D++)$s[D]||($s[D]={});($s[m].vx!=Y||$s[m].vy!=de||$s[m].el!==x)&&($s[m].el=x,$s[m].vx=Y,$s[m].vy=de,clearInterval($s[m].pid),(Y!=0||de!=0)&&(h=!0,$s[m].pid=setInterval((function(){i&&this.layer===0&&ni.active._onTouchMove(mw);var oe=$s[this.layer].vy?$s[this.layer].vy*l:0,ue=$s[this.layer].vx?$s[this.layer].vx*l:0;typeof d=="function"&&d.call(ni.dragged.parentNode[Ka],ue,oe,n,mw,$s[this.layer].el)!=="continue"||tz($s[this.layer].el,ue,oe)}).bind({layer:m}),24))),m++}while(e.bubbleScroll&&y!==u&&(y=rf(y,!1)));gR=h}},30),uz=function(e){var t=e.originalEvent,i=e.putSortable,r=e.dragEl,o=e.activeSortable,s=e.dispatchSortableEvent,l=e.hideGhostForTarget,u=e.unhideGhostForTarget;if(t){var h=i||o;l();var d=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,m=document.elementFromPoint(d.clientX,d.clientY);u(),h&&!h.el.contains(m)&&(s("spill"),this.onSpill({dragEl:r,putSortable:i}))}};function Wk(){}Wk.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var r=Dy(this.sortable.el,this.startIndex,this.options);r?this.sortable.el.insertBefore(t,r):this.sortable.el.appendChild(t),this.sortable.animateAll(),i&&i.animateAll()},drop:uz};ed(Wk,{pluginName:"revertOnSpill"});function zk(){}zk.prototype={onSpill:function(e){var t=e.dragEl,i=e.putSortable,r=i||this.sortable;r.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),r.animateAll()},drop:uz};ed(zk,{pluginName:"removeOnSpill"});ni.mount(new Q0e);ni.mount(zk,Wk);function yw(n,e){let t;const i={dragClass:"lux-sortable-drag",ghostClass:"lux-sortable-ghost",sort:!0,handle:".drag-handle",forceFallback:Xoe};e?.onSort&&(i.onSort=s=>e.onSort(s.to.children)),r();function r(){n&&(t=ni.create(n,{...i,...e&&(({onSort:s,...l})=>l)(e)||{}}))}function o(){t?.destroy()}return{sortable:t,destroy:o}}const cz=.5,eve=!1,_w=ca("slider",()=>{const n=Ui(),e=Ue(cz),t=Ue(eve),i=Ct(()=>[...n.layers].reverse()[0]);function r(s){let l=s;s<.1?l=.1:s>.9&&(l=.9),e.value=l}function o(s){t.value=s??!t.value}return{sliderActive:t,sliderRatio:e,sliderTopLayer:i,setRatio:r,toggleSlider:o}},{});function hz(n,e){const{t}=St();function i(){e?.emit("clickInfo",n)}return{t,onClickInfo:i}}const tve={class:"lux-layer-manager-item mt-2.5"},nve=["title"],ive={class:"flex-1 text-left cursor-default"},rve=["aria-label","title"],sve=at({__name:"layer-item-background",props:{showEditButton:{type:Boolean},layer:{}},emits:["clickEdit","clickInfo"],setup(n,{emit:e}){const t=n,i=e,{t:r,onClickInfo:o}=hz(t.layer,{emit:i}),s=Ct(()=>r('Display informations for "{{layerName}}"',{ns:"app",layerName:u()})),l=Ct(()=>!Ny().isOffLine.value);function u(){return r(t.layer.name,{ns:"client"})}return(h,d)=>(U(),ie("div",tve,[l.value?(U(),ie("button",{key:0,class:"fa fa-info w-3",title:s.value,onClick:d[0]||(d[0]=(...m)=>M(o)&&M(o)(...m))},null,8,nve)):Le("",!0),P("span",ive,K(u()),1),n.showEditButton?(U(),ie("button",{key:1,"data-cy":"openStylePanel",class:"fa fa-pencil","aria-label":M(r)("Open editor panel",{ns:"app"}),title:M(r)("Open editor panel",{ns:"app"}),onClick:d[1]||(d[1]=m=>h.$emit("clickEdit"))},null,8,rve)):Le("",!0)]))}}),ove=["id"],ave=["aria-checked","title"],lve=["id","value","aria-label"],uve=["aria-checked","aria-label"],cve=at({__name:"layer-item-sub",props:{layer:{},isOpen:{type:Boolean},isLayerComparatorOpen:{type:Boolean},displayLayerComparatorOpen:{type:Boolean}},emits:["changeOpacity","clickToggleLayerComparator"],setup(n,{emit:e}){const t=n,i=e,{t:r}=St(),o=la(),s=Ct(()=>r(o.getLayerCurrentLabel(t.layer),{ns:"client"})),l=mi((t.layer?.opacity??1)*100),u=mi((t.layer?.previousOpacity??l.value)*100);function h(){l.value===0?l.value=u.value:(u.value=l.value,l.value=0),y()}function d(x){x.target&&(l.value=parseInt(x.target.value),y())}function m(){i("clickToggleLayerComparator",t.layer)}function y(){i("changeOpacity",t.layer,l.value)}return(x,C)=>(U(),ie("div",{class:Rn(["lux-layer-manager-item-content",n.isOpen?"h-6":"h-0"]),id:`layer-manager-item-content-${n.layer.id}`,"data-cy":"myLayerSubContent"},[P("button",{class:Rn(["w-5 fa-solid",l.value===0?"fa-eye-slash":"fa-eye"]),role:"switch","aria-checked":l.value===0,title:M(r)("Toggle layer opacity for {{layerName}}",{ns:"app",layerName:s.value}),onClick:h},null,10,ave),P("input",{id:`${n.layer.id}-steps-range`,type:"range",min:"0",max:"100",value:l.value,step:"25",onChange:d,class:"m-2.5 w-16 h-[5px] rounded-lg appearance-none cursor-pointer","aria-label":M(r)("Change opacity for {{layerName}}",{ns:"app",layerName:s.value})},null,40,lve),n.displayLayerComparatorOpen?(U(),ie("button",{key:0,"data-cy":"myLayerComparatorBtn",role:"switch",class:Rn(["fa ml-auto text-sm cursor-pointer",n.isLayerComparatorOpen?"fa-adjust":"fa-circle"]),"aria-checked":n.isLayerComparatorOpen,"aria-label":M(r)("Toggle layer comparator for {{ layerName }}",{ns:"app",layerName:s.value}),onClick:m},null,10,uve)):Le("",!0)],10,ove))}}),hve=["min","max","value"],mR=at({__name:"layer-time-datepicker",props:{minDateAllowed:{default:""},maxDateAllowed:{default:""},dateValue:{}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,r=Ct(()=>SS(t.minDateAllowed)),o=Ct(()=>SS(t.maxDateAllowed));function s(l){i("change",l.target.value)}return(l,u)=>(U(),ie("input",{class:"lux-time-datepicker",type:"date",min:r.value,max:o.value,value:n.dateValue?M(SS)(n.dateValue):"",onChange:s},null,40,hve))}}),dve={class:"lux-time-slider w-full"},fve=["for"],pve=at({__name:"layer-time-datepicker-value",props:{layer:{}},emits:["changeTime"],setup(n){const{t:e}=St(),t=n,i=mi(t.layer.currentTimeMinValue);return(r,o)=>(U(),ie("div",dve,[P("div",null,[P("label",{for:`${n.layer.id}-time-slider-start`,class:"lux-time-slider-label"},K(M(e)("Date:")),9,fve),mt(mR,{id:`${n.layer.id}-time-slider-start`,"date-value":i.value,"min-date-allowed":t.layer.time?.minValue,"max-date-allowed":t.layer.time?.maxValue,onChange:o[0]||(o[0]=s=>r.$emit("changeTime",s))},null,8,["id","date-value","min-date-allowed","max-date-allowed"])])]))}}),gve={class:"lux-time-slider w-full"},mve=["for"],yve=["for"],_ve=at({__name:"layer-time-datepicker-range",props:{layer:{}},emits:["changeTime"],setup(n,{emit:e}){const{t}=St(),i=n,r=e,o=mi(i.layer.currentTimeMinValue),s=mi(i.layer.currentTimeMaxValue);function l(h){r("changeTime",h,i.layer.currentTimeMaxValue)}function u(h){r("changeTime",i.layer.currentTimeMinValue,h)}return(h,d)=>(U(),ie("div",gve,[P("div",null,[P("label",{for:`${n.layer.id}-time-slider-start`,class:"lux-time-slider-label"},K(M(t)("From:")),9,mve),mt(mR,{id:`${n.layer.id}-time-slider-start`,"date-value":o.value,"min-date-allowed":i.layer.time?.minValue,"max-date-allowed":i.layer.time?.maxValue,onChange:l},null,8,["id","date-value","min-date-allowed","max-date-allowed"])]),P("div",null,[P("label",{for:`${n.layer.id}-time-slider-end`,class:"lux-time-slider-label"},K(M(t)("To:")),9,yve),mt(mR,{id:`${n.layer.id}-time-slider-end`,"date-value":s.value,"min-date-allowed":i.layer.time?.minValue,"max-date-allowed":i.layer.time?.maxValue,onChange:u},null,8,["id","date-value","min-date-allowed","max-date-allowed"])])]))}}),vve=["onKeydown","aria-label","title"],K5=at({__name:"slider-range-thumb",props:{ariaLabel:{},maxLimit:{default:100},minLimit:{default:0},selectedValue:{}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,r=Ue(!1),o=Ue(),s=Ue(),l=Ct(()=>o.value?.offsetWidth||274),u=Ct(()=>s.value?.offsetWidth||9),h=Ue(t.selectedValue),d=Ct(()=>l.value*h.value/100-u.value/2),m=Ct(()=>({left:`${d.value}px`}));Ms(()=>{document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",T)}),Pt(()=>t.selectedValue,G=>{h.value=G});function y(G){h.value=Math.max(Math.min(G,100),0),i("change",h.value,r.value)}function x(){y(h.value-1)}function C(){y(h.value+1)}function w(){r.value=!0,document.addEventListener("mousemove",E),document.addEventListener("mouseup",T)}function E(G){r.value&&y(k(G))}function T(G){r.value=!1,y(k(G)),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",T)}function k(G){const O=o.value?.offsetWidth?(G.clientX-u.value*2)*100/o.value?.offsetWidth:0;return Math.round(Math.max(Math.min(O,t.maxLimit),t.minLimit))}return(G,O)=>(U(),ie("div",{class:"w-full",role:"slider",ref_key:"elRefTrack",ref:o},[P("button",{class:Rn(["lux-slidebar-thumb",r.value?"dragging":""]),ref_key:"elRefThumb",ref:s,style:Vc(m.value),onKeydown:[to(ps(C,["stop"]),["space"]),to(ps(C,["stop"]),["right"]),to(ps(x,["stop"]),["left"]),to(ps(x,["stop"]),["delete"])],onMousedown:w,onMousemove:E,onMouseup:T,"aria-label":n.ariaLabel,title:n.ariaLabel},null,46,vve)],512))}}),bve=at({__name:"slider-range-active-track",props:{selectedMinValue:{},selectedMaxValue:{}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,r=Ue(),o=Ue(),s=Ct(()=>r.value?Math.round(r.value.offsetWidth*t.selectedMinValue/100):0),l=Ct(()=>{let d=0;return t.selectedMaxValue!==void 0&&r.value?.offsetWidth&&(d=r.value?.offsetWidth*t.selectedMaxValue/100-s.value),Math.round(d)}),u=Ct(()=>({left:`${s.value}px`,width:`${l.value}px`}));function h(d){if(r.value){const m=r.value.getBoundingClientRect().x,y=(d.clientX-m)*100/r.value.offsetWidth;i("change",y)}}return(d,m)=>(U(),ie("div",{ref_key:"elRefFullTrack",ref:r,class:"lux-slidebar-track"},[n.selectedMaxValue!==void 0?(U(),ie("div",{key:0,ref_key:"elRefSelectionTrack",ref:o,class:"lux-slidebar-track-selection",style:Vc(u.value),onClick:h},null,4)):Le("",!0),P("div",{class:"lux-slidebar-track-full",onClick:h})],512))}}),xve={class:"lux-slidebar-fake"},j5=at({__name:"slider-range",props:{selectedMinValue:{},selectedMaxValue:{},ariaLabelMin:{},ariaLabelMax:{}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,r=Ue(t.selectedMinValue),o=Ue(t.selectedMaxValue);function s(h,d){i("change",h,t.selectedMaxValue,d)}function l(h,d){i("change",t.selectedMinValue,h,d)}function u(h){o.value===void 0?r.value=h:h>=o.value?o.value=h:h<=t.selectedMinValue?r.value=h:Math.abs(o.value-h)<Math.abs(r.value-h)?o.value=h:r.value=h,i("change",r.value,o.value,!1)}return(h,d)=>(U(),ie("div",xve,[o.value!==void 0?(U(),Gt(K5,{key:0,ariaLabel:n.ariaLabelMax,minLimit:n.selectedMinValue,selectedValue:o.value,onChange:l},null,8,["ariaLabel","minLimit","selectedValue"])):Le("",!0),mt(K5,{ariaLabel:n.ariaLabelMin,maxLimit:n.selectedMaxValue,selectedValue:r.value,onChange:s},null,8,["ariaLabel","maxLimit","selectedValue"]),mt(bve,{selectedMinValue:n.selectedMinValue,selectedMaxValue:n.selectedMaxValue,onChange:u},null,8,["selectedMinValue","selectedMaxValue"])]))}}),Ive={class:"lux-time-slider w-full"},Cve={key:0,class:"lux-time-slider-value mr-1.5"},wve={key:1,class:"lux-time-slider-range mr-1.5"},Ave={class:"lux-time-displayed-dates"},Sve={key:0,class:"lux-time-start-date grow"},Eve={key:1,class:"lux-time-slider-end-date grow text-right"},Tve=at({__name:"layer-time-slider",props:{layer:{}},emits:["changeTime"],setup(n,{emit:e}){const{t}=St(),i=n,r=e,o=Ct(E),s=Ct(()=>i.layer.time?.minValue?new Date(i.layer.time?.minValue).getTime():0),l=Ct(()=>i.layer.time?.maxValue?new Date(i.layer.time?.maxValue).getTime():0),u=Ct(()=>l.value-s.value),h=Ue(i.layer.currentTimeMaxValue),d=Ue(i.layer.currentTimeMinValue),m=Ct(()=>d.value?new Date(d.value).getTime():void 0),y=Ct(()=>h.value?new Date(h.value).getTime():void 0),x=Ct(()=>w(m.value)),C=Ct(()=>w(y.value));function w(O){return O?(O-s.value)/u.value*100:0}function E(){const O=i.layer.time,V=[];if(!O)return;if(O.values)return O.values.map(fe=>new Date(fe).getTime());const z=new Date(O.minValue),H=new Date(O.maxValue??Date.now()),te=1024,$=new Date(z.getTime()),ae=O.interval??aB;if($.setFullYear(z.getFullYear()+te*ae[0]),$.setMonth(z.getMonth()+te*ae[1],z.getDate()+te*ae[2]),$.setSeconds(z.getSeconds()+te*ae[3]),$>H)for(let fe=0;;fe++){const Y=new Date(z.getTime());if(Y.setFullYear(z.getFullYear()+fe*ae[0]),Y.setMonth(z.getMonth()+fe*ae[1],z.getDate()+fe*ae[2]),Y.setSeconds(z.getSeconds()+fe*ae[3]),Y<=H)V.push(Y.getTime());else break}return V}function T(O){const V=O/100*(l.value-s.value)+s.value,z=qie(V,{minValue:s.value,maxValue:l.value,timeValueList:o.value,timeInterval:i.layer.time?.interval});return ET(z)}function k(O,V){const z=T(O);if(d.value=z,V){const H=T(V);h.value=H}}function G(O,V,z){k(O,V),z||r("changeTime",d.value,h.value)}return(O,V)=>(U(),ie("div",Ive,[n.layer.time?.mode===M(kh).VALUE?(U(),ie("div",Cve,[mt(j5,{ariaLabelMin:`${M(t)("Edit the start date",{ns:"app"})}`,selectedMinValue:x.value,onChange:G},null,8,["ariaLabelMin","selectedMinValue"])])):Le("",!0),n.layer.time?.mode===M(kh).RANGE?(U(),ie("div",wve,[mt(j5,{ariaLabelMin:`${M(t)("Edit the start date",{ns:"app"})}`,ariaLabelMax:`${M(t)("Edit the end date",{ns:"app"})}`,selectedMinValue:x.value,selectedMaxValue:C.value,onChange:G},null,8,["ariaLabelMin","ariaLabelMax","selectedMinValue","selectedMaxValue"])])):Le("",!0),P("div",Ave,[n.layer.time?.mode===M(kh).RANGE||n.layer.time?.mode===M(kh).VALUE?(U(),ie("div",Sve,[P("span",null,K(d.value?M(AO)(d.value,n.layer.time?.resolution):"-"),1)])):Le("",!0),n.layer.time?.mode===M(kh).RANGE?(U(),ie("div",Eve,[P("span",null,K(h.value?M(AO)(h.value,n.layer.time?.resolution):"-"),1)])):Le("",!0)])]))}}),Rve=at({__name:"layer-time",props:{layer:{}},emits:["changeTime"],setup(n,{emit:e}){const t=e;function i(r,o){t("changeTime",r,o)}return(r,o)=>(U(),ie(Mt,null,[n.layer.time?.widget===M(_I).SLIDER?(U(),Gt(Tve,{key:0,layer:n.layer,onChangeTime:i},null,8,["layer"])):Le("",!0),n.layer.time?.widget===M(_I).DATEPICKER&&n.layer.time?.mode===M(kh).VALUE?(U(),Gt(pve,{key:1,layer:n.layer,onChangeTime:i},null,8,["layer"])):Le("",!0),n.layer.time?.widget===M(_I).DATEPICKER&&n.layer.time?.mode===M(kh).RANGE?(U(),Gt(_ve,{key:2,layer:n.layer,onChangeTime:i},null,8,["layer"])):Le("",!0)],64))}}),Mve={class:"lux-layer-manager-item relative"},kve={class:"w-full flex flex-nowrap items-start gap-x-2"},Lve=["title"],Pve=["aria-label","title"],Gve=["aria-expanded","aria-controls","data-cy"],Fve={class:"grow"},Ove=["title","aria-label"],$5=at({__name:"layer-item",props:{is3d:{type:Boolean},layer:{},dragHandleClassName:{},isOpen:{type:Boolean},isLayerComparatorOpen:{type:Boolean},displayLayerComparatorOpen:{type:Boolean}},emits:["clickInfo","clickToggle","clickToggleLayerComparator","clickRemove","changeOpacity","changeTime"],setup(n,{emit:e}){const t=n,i=e,{t:r,onClickInfo:o}=hz(t.layer,{emit:i}),s=la(),l=Ct(()=>r(s.getLayerCurrentLabel(t.layer),{ns:"client"})),u=Ct(()=>!Ny().isOffLine.value),h=Ct(()=>r('Sort "{{layerName}}" in the list',{ns:"app",layerName:l.value})),d=Ct(()=>r('Display informations for "{{layerName}}"',{ns:"app",layerName:l.value})),m=Ct(()=>r('Remove layer "{{layerName}}"',{ns:"app",layerName:l.value}));function y(x,C){i("changeTime",x,C)}return(x,C)=>(U(),ie("div",Mve,[P("div",kve,[P("button",{class:Rn(["fa-solid fa-bars cursor-move mt-1",n.dragHandleClassName]),title:h.value},null,10,Lve),u.value?(U(),ie("button",{key:0,class:"fa-solid fa-info mt-1","aria-label":d.value,title:d.value,onClick:C[0]||(C[0]=(...w)=>M(o)&&M(o)(...w))},null,8,Pve)):Le("",!0),P("button",{"aria-expanded":n.isOpen,"aria-controls":`layer-manager-item-content-${n.layer.id}`,"data-cy":`myLayerItemLabel-${n.layer.id}`,class:Rn([n.is3d?"cursor-default":"","grow text-left break-words w-[70%] flex items-center"]),onClick:C[1]||(C[1]=w=>x.$emit("clickToggle",n.layer))},[P("span",Fve,K(l.value),1),n.is3d?Le("",!0):(U(),ie("span",{key:0,class:Rn(["w-3.5 fa-solid",n.isOpen?"fa-xmark":"fa-ellipsis"]),"aria-hidden":"true"},null,2))],10,Gve),P("button",{class:"mt-1 fa-solid fa-trash-can",title:m.value,"aria-label":m.value,onClick:C[2]||(C[2]=w=>x.$emit("clickRemove",n.layer))},null,8,Ove)]),n.is3d?Le("",!0):(U(),Gt(cve,{key:0,layer:n.layer,isOpen:n.isOpen,isLayerComparatorOpen:n.isLayerComparatorOpen,displayLayerComparatorOpen:n.displayLayerComparatorOpen,onClickToggleLayerComparator:C[3]||(C[3]=w=>x.$emit("clickToggleLayerComparator",w)),onChangeOpacity:C[4]||(C[4]=(w,E)=>x.$emit("changeOpacity",w,E))},null,8,["layer","isOpen","isLayerComparatorOpen","displayLayerComparatorOpen"])),n.layer.time?(U(),Gt(Rve,{key:1,layer:n.layer,onChangeTime:y},null,8,["layer"])):Le("",!0)]))}}),Nve={key:0,class:"text-black"},Dve=["id"],Vve=["id"],Bve={key:2,class:"flex flex-row justify-center space-x-1 my-2"},J5="drag-handle",Zve=at({__name:"layer-manager",emits:["displayCatalog"],setup(n,{emit:e}){const{t}=St(),{setMetadataLayer:i}=mA(),r=Ui(),o=Jn(),s=Mf(),l=_w(),{bgLayer:u}=It(r),{sliderActive:h}=It(l),{isOffLine:d}=It(o),{setRemoteLayersOpen:m}=o,y=wy("sortableLayers"),x=wy("sortableLayers3d"),C=Ct(()=>[...r.layers].reverse()),w=Ct(()=>[...r.layers3d].reverse()),E=mi(),T=Ct(()=>s.isLayerStyleEditable(u.value)),k=Ct(()=>!d.value),G=e;sr(()=>{yw(y.value,{onSort:O}),yw(x.value,{onSort:V})});function O(Y,de){const D=[...Y].map(oe=>Number(oe.id)).reverse();r.reorderLayers(D,de)}function V(Y){O(Y,!0)}function z(Y,de){r.setLayerOpacity(Y.id,de/100)}function H(Y,de,D){r.setLayerTime(Y.id,de,D)}function te(Y){r.removeLayers(Y.id)}function $(Y){E.value=E.value!==Y.id?Y.id:void 0}function ae(){o.openStyleEditorPanel()}function fe(){l.toggleSlider()}return(Y,de)=>(U(),ie("div",null,[M(d)&&C.value.length===0?(U(),ie("div",Nve,K(M(t)("No layer selected",{ns:"client"})),1)):Le("",!0),w.value.length>0?(U(),ie("ul",{key:1,ref_key:"sortableLayers3d",ref:x,class:"mb-4 sortable-layers-3d"},[(U(!0),ie(Mt,null,hi(w.value,(D,oe)=>(U(),ie("li",{key:D.id,id:D.id,"data-cy":"myLayer"},[mt($5,{is3d:!0,dragHandleClassName:J5,layer:D,isOpen:E.value===D.id,isLayerComparatorOpen:M(h),displayLayerComparatorOpen:oe===0,onClickRemove:te,onClickToggle:$,onClickToggleLayerComparator:fe,onClickInfo:ue=>M(i)(D),onChangeOpacity:z,onChangeTime:(ue,ge)=>H(D,ue,ge)},null,8,["layer","isOpen","isLayerComparatorOpen","displayLayerComparatorOpen","onClickInfo","onChangeTime"])],8,Dve))),128))],512)):Le("",!0),P("ul",{ref_key:"sortableLayers",ref:y,class:"sortable-layers"},[(U(!0),ie(Mt,null,hi(C.value,(D,oe)=>(U(),ie("li",{key:D.id,id:D.id,"data-cy":"myLayer"},[mt($5,{is3d:!1,dragHandleClassName:J5,layer:D,isOpen:E.value===D.id,isLayerComparatorOpen:M(h),displayLayerComparatorOpen:oe===0,onClickRemove:te,onClickToggle:$,onClickToggleLayerComparator:fe,onClickInfo:ue=>M(i)(D),onChangeOpacity:z,onChangeTime:(ue,ge)=>H(D,ue,ge)},null,8,["layer","isOpen","isLayerComparatorOpen","displayLayerComparatorOpen","onClickInfo","onChangeTime"])],8,Vve))),128))],512),mt(sve,{layer:M(u)||M(YC),showEditButton:T.value,onClickInfo:de[0]||(de[0]=()=>M(u)&&M(i)(M(u))),onClickEdit:ae},null,8,["layer","showEditButton"]),k.value?(U(),ie("div",Bve,[P("button",{"data-cy":"addLayer",class:"bg-white text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5",onClick:de[1]||(de[1]=D=>G("displayCatalog"))},K(M(t)("+ Add layers",{ns:"client"})),1),P("button",{"data-cy":"addRemoteLayer",class:"bg-white text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5",onClick:de[2]||(de[2]=D=>M(m)(!0))},K(M(t)("+ Add external Wms",{ns:"client"})),1)])):Le("",!0),de[3]||(de[3]=P("div",{class:"lux-preload"},[P("i",{class:"fa-solid fa-trash-can"})],-1))]))}}),Wve=["data-cy"],zve={key:0,class:"lux-panel-title h-16 shrink-0 flex justify-between"},Uve=["aria-label"],Xve={key:1,class:"lux-panel-tabs flex flex-row gap-2 h-10 text-2xl"},Yve={class:"lux-panel-content relative grow p-2.5 bg-primary overflow-auto"},Lf=at({__name:"side-panel-layout",props:{dataCyValue:{},closeFn:{type:Function}},setup(n){const{t:e}=St();return(t,i)=>(U(),ie("div",{"data-cy":n.dataCyValue,class:"lux-panel flex flex-col h-full pt-1.5"},[t.$slots.header?(U(),ie("div",zve,[ei(t.$slots,"header"),P("span",null,[P("button",{"data-cy":"panelClose",onClick:i[0]||(i[0]=()=>n.closeFn()),"aria-label":M(e)("Close",{ns:"client"}),class:"fa-sharp fa-solid fa-close"},null,8,Uve)])])):Le("",!0),t.$slots.tabs?(U(),ie("div",Xve,[ei(t.$slots,"tabs")])):Le("",!0),P("div",Yve,[ei(t.$slots,"content")])],8,Wve))}}),Hve=["aria-expanded"],Kve={key:0},jve=["aria-expanded"],$ve=at({__name:"layer-panel",setup(n){const{t:e}=St(),t=Jn(),{setLayersOpen:i}=t,{myLayersTabOpen:r}=It(t),{layers:o}=It(Ui()),s=Ct(()=>!Ny().isOffLine.value),l=Ct(()=>r.value||Ny().isOffLine.value);function u(){t.setMyLayersTabOpen(!0)}function h(){t.setMyLayersTabOpen(!1)}return(d,m)=>(U(),Gt(Lf,{"data-cy-value":"layerPanel","close-fn":()=>M(i)(!1)},{header:Wt(()=>[P("h1",null,K(M(e)("layers",{ns:"client"})),1)]),tabs:Wt(()=>[P("button",{"data-cy":"myLayersButton",onClick:u,class:Rn(["text-white px-4 hover:bg-primary cursor-pointer text-center uppercase",l.value?"bg-primary":"bg-tertiary"]),"aria-expanded":l.value},[Bt(K(M(e)("my_layers",{ns:"client"}))+" ",1),M(o).length?(U(),ie("span",Kve,"("+K(M(o).length)+")",1)):Le("",!0)],10,Hve),s.value?(U(),ie("button",{key:0,"data-cy":"catalogButton",onClick:h,class:Rn(["text-white px-4 hover:bg-primary cursor-pointer text-center uppercase",l.value?"bg-tertiary":"bg-primary"]),"aria-expanded":!l.value},K(M(e)("Catalog",{ns:"client"})),11,jve)):Le("",!0)]),content:Wt(()=>[An(mt(Zve,{"data-cy":"myLayers",onDisplayCatalog:h},null,512),[[Yp,l.value]]),An(P("div",null,[mt(T0e)],512),[[Yp,!l.value]])]),_:1},8,["close-fn"]))}}),Jve={class:"lux-legends absolute"},qve={key:0,class:"text-white"},Qve={class:"pb-5"},ebe={class:"pb-5"},tbe=at({__name:"legends-panel",setup(n){const{t:e}=St(),t=Jn(),i=Ui(),r=la(),{layers:o,bgLayer:s}=It(i),l=Ct(()=>[...o.value].reverse()),u=Ue(new Map),h=Ue(!1);return Rs(()=>h.value=[...u.value].some(([d,m])=>m)),Ms(()=>u.value.clear()),IN(()=>u.value.clear()),(d,m)=>(U(),Gt(Lf,{"data-cy-value":"legendsPanel","close-fn":()=>M(t).toggleLegendsOpen(!1)},{header:Wt(()=>[P("h1",null,K(M(e)("Legends")),1)]),content:Wt(()=>[P("div",Jve,[h.value?Le("",!0):(U(),ie("div",qve,K(M(e)("Aucune lgende n'est disponible pour les couches slectionnes.")),1)),(U(!0),ie(Mt,null,hi(l.value,y=>(U(),Gt(uR,{"data-cy":"legendLayer",class:"pt-10",key:y.id,layer:y,onHasLegend:x=>u.value.set(y.id,x),onRemovedLegend:()=>u.value.delete(y.id)},{title:Wt(()=>[P("h1",Qve,K(M(e)(M(r).getLayerCurrentLabel(y))),1)]),_:2},1032,["layer","onHasLegend","onRemovedLegend"]))),128)),M(s)?(U(),Gt(uR,{"data-cy":"legendBgLayer",class:"pt-10",key:M(s).id,layer:M(s)},{title:Wt(()=>[P("h1",ebe,K(M(e)(M(r).getLayerCurrentLabel(M(s)))),1)]),_:1},8,["layer"])):Le("",!0)])]),_:1},8,["close-fn"]))}});class nbe{timeoutID;constructor(e){const t=Ui(),i=Mu(),r=Kn(),o=Mf(),s=Mk(),{getIsOffline:l}=Ny(),{appliedStyle:u}=It(i);Pt(()=>t.layers,(h,d)=>{const m={layers:d},y={layers:h},x=r.getRemovedLayers(y,m),C=r.getAddedLayers(y,m),w=r.getMutatedLayers(y,m);x.forEach(E=>s.removeLayer(e,E.id)),C.forEach(E=>{s.addLayer(e,E.layer),s.setLayerTime(e,E.layer)}),w.forEach(E=>{r.getMutationType(E.id,y,m)===EM.ON_LAYER_TYPE?(s.removeLayer(e,E.id),s.addLayer(e,E)):s.setLayerOpacity(e,E.id,E.opacity),s.setLayerTime(e,E)}),y.layers&&s.reorderLayers(e,y.layers)}),Pt(()=>t.bgLayer,h=>h!==void 0&&s.setBgLayer(e,h,i.bgVectorSources)),Rs(()=>{i.isExpertStyleActive||(u.value=o.applyDefaultStyle(t.bgLayer,i.bgVectorBaseStyles,i.bgStyle))}),Pt(u,h=>{l()||(i.bgStyle===null&&!i.isExpertStyleActive?o.unregisterStyle(i.styleSerial).then(i.styleSerial=null):(clearTimeout(this.timeoutID),this.timeoutID=setTimeout(()=>{o.registerStyle(h,i.styleSerial).then(d=>{i.styleSerial=d;const m=t?.bgLayer?.id;t?.bgLayer&&m!==void 0&&d!==void 0&&s.setBgLayer(e,t?.bgLayer,i.bgVectorSources)})},2e3))),s.applyOnBgLayer(e,d=>o.applyConsolidatedStyle(d,h))}),Pt(()=>i.bgVectorSources,(h,d)=>{for(const m of h.keys())(!d||d.get(m)!==h.get(m))&&(s.removeFromCache(m),m===t?.bgLayer?.id&&s.setBgLayer(e,t?.bgLayer,h))})}}class ibe{constructor(e){const t=e.getView(),i=Ui();t.setMaxZoom(v4),t.setMinZoom(Pj),t.setConstrainResolution(!0),Pt(()=>i.minZoom,r=>r!==void 0&&t.setMinZoom(r)),Pt(()=>i.maxZoom,r=>r!==void 0&&t.setMaxZoom(r))}}function rbe(){const n=zr(),{generateDrawnFeature:e}=yA(),{addDrawnFeatureToCollection:t}=n,{activeFeatureId:i,drawnFeatures:r}=It(n),o=Kn().getOlMap();function s(h,d="new"){let m;Eu.remove(),h.stopPropagation(),d==="new"?(m=e(h.feature),t(m)):m=r.value.find(y=>y.id===i.value),m.resetProfileData(),n.selectDrawnFeature(m)}function l(h,d){d.key==="Escape"&&(Eu.remove(),h.finishDrawing())}function u(h,d="new"){const m=new t_(h);return m.setActive(!1),mn(m,"drawstart",y=>Eu.add(o,y)),mn(m,"drawend",y=>s(y,d)),mn(document,"keyup",y=>l(m,y)),o.addInteraction(m),m}return{createDrawInteraction:u}}function sbe(){const n=zr(),{drawStateActive:e,editStateActive:t,drawnFeatures:i,currentDrawInteraction:r,editingFeatureId:o}=It(n),{createDrawInteraction:s}=rbe(),l=cv.createOlLayerInteractionDraw(),u={drawPoint:s({type:"Point"}),drawLabel:s({type:"Point"}),drawLine:s({type:"LineString"}),drawLineContinue:s({type:"LineString"},"update"),drawCircle:s({type:"Circle"}),drawPolygon:s({type:"Polygon"})};Pt(e,m=>{Object.keys(u).forEach(y=>{const x=u[y];`${[y]}`==`${m}`&&!t.value?(x.setActive(!0),r.value=x):x.setActive(!1)})}),Pt(t,m=>{if(m)Object.values(u).forEach(y=>{y.setActive(!1)});else if(e.value){const y=e.value;u[y]&&(u[y].setActive(!0),r.value=u[y])}}),Pt(i,m=>{d(m,o.value)},{flush:"post"}),Pt(o,()=>{d(i.value,o.value)});function h(m){m.addLayer(l)}function d(m,y){const x=l.getSource(),C=y?m.filter(E=>E.id!==y):m,w=x?.getFeatures()||[];w.forEach(E=>{const T=E;C.find(k=>k.id===T.id)||x?.removeFeature(E)}),C.forEach(E=>{w.find(T=>T.id===E.id)||(E.changed(),x?.addFeature(E))})}return{addDrawLayer:h,drawInteractions:u}}function obe(){const n=Kn().getOlMap(),e=Jn(),{drawStateActive:t,editStateActive:i,activeFeatureId:r,editingFeatureId:o,drawnFeatures:s}=It(zr()),{layersOpen:l,myMapsOpen:u}=It(e),{layers:h}=It(Ui());mn(n,"click",m=>d(m)),Pt([r,o],([m,y],[x,C])=>{C!==y&&y!==m&&(o.value=void 0),x!==void 0&&x!==m&&s.value.filter(w=>w.id===x).forEach(w=>{w.selected=!1,w.changed()}),s.value.filter(w=>w.id===m).forEach(w=>{w.selected=!0,w.changed()})});const d=function(m){const y=m.pixel;if(t.value!==void 0||i.value!==void 0)return!0;if(n.forEachFeatureAtPixel(y,C=>{const w=s.value.includes(C);if(w&&(l.value||u.value)&&s.value.length>0||w&&h.value.length===0)return e.toggleMyMapsOpen(!0),r.value=C.id,!0},{hitTolerance:5}))return!1}}const abe={xs:0,sm:640,md:768,lg:1024,xl:1280,"2xl":1536};function Uk(n){return window.innerWidth>=abe[n]}const lbe="https://migration.geoportail.lu/getfeatureinfo";async function q5(n){const e=await ks(lbe,n,"GET");if(!e.ok)throw new Error("Error while trying to get profile");return await e.json()}function ube(){const n=Kn().getOlMap(),{setFeatureInfoPanelContent:e,setLoading:t,setDisplayStarOnMobile:i}=rg(),{fid:r,isLoading:o}=It(rg()),{toggleInfoOpen:s}=Jn(),{layersOpen:l,myMapsOpen:u}=It(Jn()),{findById:h}=Tl(),{drawStateActive:d,editStateActive:m,drawnFeatures:y}=It(zr()),{locationInfoCoords:x,isStreetviewActive:C}=It(ag()),{maxZoom:w}=It(Ui()),{measureActive:E,drawLidarActive:T,justFinishedDrawing:k}=It(lg()),{drawElevationProfileActive:G,justFinishedDrawing:O}=It(EA()),{measureToolbarOpen:V}=It(Jn()),z=Ue([]),H=Ue([]),te=Ue([]),$=Ue([]),ae=Ue(null);function fe(){Ym.init(n),mn(n,"pointerdown",Ee=>{te.value=Ee.pixel}),mn(n,"pointerup",zB(Ee=>Y(Ee),499)),mn(n,"pointermove",Ee=>{de(Ee)}),Rs(()=>{r.value&&(async()=>await D(r.value))()})}function Y(Ee){(async()=>($.value=Ee.pixel,!(Ee.originalEvent.button===2||C.value&&x.value||jW(d,m,E,V,T,G,k,O)||o.value)&&(ae.value=window.setTimeout(()=>{let se=!1;if((l.value||u.value)&&y.value.length>0&&(se=Ne(Ee.pixel)),!se&&te.value&&$.value){const q=Math.abs(te.value[0]-$.value[0]),j=Math.abs(te.value[1]-$.value[1]);q+j<6&&(oe(Ee),te.value=null,$.value=null)}},500))))()}async function de(Ee){if(Ee.dragging||o.value)return;const se=await Promise.all(n.getLayers().getArray().filter(q=>q instanceof uv).map(async q=>{const j=q.getData(Ee.pixel);if(q.getVisible()&&q.getOpacity()>0&&!j?.every(ze=>ze===0)){const ze=q.get(sw);return ze&&ze.is_queryable}return!1})).then(q=>q.some(Boolean));n.getViewport().style.cursor=se?"pointer":""}async function D(Ee){const se=Ee.split(",");for(const q of se){const j=q.split("_")[0],ze=[j],je={};try{if(ze.length>0){t(!0),n.getViewport().style.cursor="wait";const qe=await q5({fid:q});let yt=!1;Uk("sm")?(yt=!0,i(!1)):i(!0);const xt=h(j);xt&&(je[j]=xt.layers),qe.length>0&&ue(!0,qe,je,yt,!0)}}catch{ge()}}}async function oe(Ee){const se=n.getLayers().getArray(),q=[],j={};for(let ze=se.length-1;ze>=0;ze--){const je=se[ze].get(sw);if(je!=null&&je.is_queryable&&se[ze].getVisible()&&se[ze].getOpacity()>0){const qe=se[ze].get("queryable_id");q.push(qe),j[qe]=se[ze].get("label")}}if(q.length>0){const ze=n.getView().getResolution();let je=0,qe=0;ze&&(je=20*ze,qe=1*ze);const yt=Ir(Ee.coordinate,n.getView().getProjection(),Ml),xt=[[yt[0]-je,yt[1]+je],[yt[0]+je,yt[1]-je]],Et=[[yt[0]-qe,yt[1]+qe],[yt[0]+qe,yt[1]-qe]];t(!0),n.getViewport().style.cursor="wait";const kt=n.getSize()||[0,0],wn=n.getView().calculateExtent(kt).join(","),Ge={layers:q.join(),box1:xt.join(),box2:Et.join(),srs:Wp,zoom:n.getView().getZoom(),BBOX:wn,WIDTH:kt[0],HEIGHT:kt[1],X:Ee.pixel[0],Y:Ee.pixel[1]};try{const ve=await q5(Ge);ve.length>0?ue(Ee.originalEvent.shiftKey,ve,j,!0,!1):(H.value=[],Ym.highlightFeatures(H.value,!1,w.value),ge())}catch{ge()}}}function ue(Ee,se,q,j,ze){Ee?se.forEach(yt=>{yt.layerLabel=q[yt.layer];let xt=!1;for(let Et=0;Et<z.value.length;Et++)if(z.value[Et].layer===yt.layer){xt=!0;let kt=!1;for(let hn=0;hn<yt.features.length;hn++){for(let wn=0;wn<z.value[Et].features.length;wn++)if(z.value[Et].features[wn].fid==yt.features[hn].fid){kt=!0,z.value[Et].features.splice(wn,1);break}kt||(z.value[Et].features=z.value[Et].features.concat(yt.features[hn]))}break}xt||z.value.push(yt)}):(z.value=se,z.value.forEach(yt=>{yt.layerLabel=q[yt.layer]}));const je=z.value.filter(yt=>"features"in yt&&yt.features.length>0),qe=z.value.length>0?j:!1;ge(qe),H.value=[];for(let yt=0;yt<z.value.length;yt++){const xt=z.value[yt],Et=Hm(xt.layerLabel)||Hm(xt.layer);xt.features.forEach(kt=>{try{kt.properties||(kt.properties={}),Et&&(kt.properties.layer_name="Parcelle",kt.properties.isParcel=!0)}catch{}}),H.value.push(...xt.features)}Ym.highlightFeatures(H.value,ze,w.value),e(je)}function ge(Ee=!1){s(Ee),t(!1),n.getViewport().style.cursor="",Ym.clearFeatures()}function Ne(Ee){const se=[];return n.forEachFeatureAtPixel(Ee,q=>y.value.indexOf(q)!==-1?(se.push(q),!1):!0,{hitTolerance:5}),se.length>0}return{init:fe}}function cbe(){const{t:n}=St(),{addNotification:e}=Qr(),{drawStateActive:t}=It(zr());Pt(t,i);function i(r){let o;switch(r){case"drawPoint":o=n("Click to draw the point");break;case"drawLine":case"drawLineContinue":o=n("Click to start drawing line<br>Double-click to finish");break;case"drawPolygon":o=n("Click to start drawing polygon<br>Double-click or click last point to finish");break;case"drawCircle":o=n("Click to start drawing circle");break;case"drawLabel":o=n("Click to place the label");break}o&&e(o)}return{}}function hbe(){let n,e,t;const{editStateActive:i,editingFeatureId:r,drawnFeatures:o}=It(zr()),{updateDrawnFeature:s}=zr(),l=Kn().getOlMap(),u=new gs({source:new io({features:[]}),zIndex:dk+1,style:(y,x)=>{const C=y,w=C.getStyleFunction();return w?w.call(C,C,x):[]}});u.set("cyLayerType",cZ);const h=u.getSource();l.addLayer(u),Pt(i,y=>{d(),y&&m()}),Pt(r,y=>{h.clear();const x=o.value.find(C=>C.id===y);if(x){t=x;const C=new Rl(x);C.setGeometry(x.getGeometry()?.clone()),C.set("__isBeingEdited__",!0),h.addFeature(C),l.render()}else t=void 0},{flush:"post"});function d(){n&&e&&(n.un("modifyend",e),l.removeInteraction(n),n=void 0,e=void 0)}function m(){n=new iZ({source:h,pixelTolerance:20,deleteCondition:y=>eA(y)&&pM(y)}),e=y=>{const x=y.features.getArray()[0];x.resetProfileData(),t&&x&&(t.setGeometry(x.getGeometry()?.clone()),t.resetProfileData(),t.setStyle(t.getStyleFunction()),t.changed(),s(t)),x.setStyle(x.getStyleFunction()),x.changed()},n.on("modifyend",e),l.addInteraction(n)}return{}}const dbe={0:8,1:9,2:9,3:10,4:11,5:12,6:13,7:14,8:16,9:17,10:18,11:19,12:20,13:21};class fbe{bootstrap(){this.restore(),this.persist()}persistZoom(){const e=Ui(),{zoom:t}=It(e),i=Kn().getOlMap().getView(),r=()=>{const o=i.getZoom(),s=o?Math.ceil(o):null;Dn.setValue(DO,s),t.value=s};r(),mn(i,"change:resolution",py(r,300))}persistRotation(){const e=Ui(),{rotation:t}=It(e),i=Kn().getOlMap().getView(),r=()=>{const o=i.getRotation()||0;Dn.setValue(VO,o),t.value=o};r(),mn(i,"change:rotation",py(r,300))}persistXY(){const e=Ui(),{x:t,y:i}=It(e),r=Kn().getOlMap().getView(),o=()=>{const s=r.getCenter(),l=s?Math.round(s[0]):null,u=s?Math.round(s[1]):null;Dn.setValue(PT,l),Dn.setValue(GT,u),t.value=l,i.value=u};o(),mn(r,qp.PROPERTYCHANGE,py(o,300))}persist(){this.persistXY(),this.persistZoom(),this.persistRotation()}restore(){const e=Kn().getOlMap().getView(),t=Dn.getValue(DO,Op),i=Dn.getValue(VO,Op),r=Dn.getInitialVersion(),o=Dn.getValue(PT,Op),s=Dn.getValue(GT,Op),l=Dn.getValue(Voe),u=pf(Ml,Wp);let h,d;t!==void 0?d=r===3?Number(t):dbe[t]:d=parseInt("8",10),o!=null&&s!=null?r===3&&l!=null?h=Ir([o,s],l,Wp):h=r===3?[o,s]:u([s,o],void 0,2):h=Ir([6,49.7],Sl,Wp),e.setCenter(h),e.setZoom(d),e.setRotation(i||0)}}const pbe=new fbe,Nd={ANGLE:"a",IS_RECTANGLE:"r",IS_TEXT:"t",OPACITY:"o",SHOW_MEASURE:"m",SIZE:"s",STROKE:"k"},Th={LINE_STRING:"LineString",POINT:"Point",POLYGON:"Polygon"},gbe={LineString:Th.LINE_STRING,Point:Th.POINT,Polygon:Th.POLYGON,MultiLineString:Th.LINE_STRING,MultiPoint:Th.POINT,MultiPolygon:Th.POLYGON};let vv={};class mbe extends Rye{accuracy_;encodeStyles_;propertiesFunction_;setStyle_;prevX_;prevY_;constructor(e){super();const t=e??{};this.accuracy_=t.accuracy??ybe,this.encodeStyles_=t.encodeStyles??!0,this.propertiesFunction_=t.properties??_be,this.setStyle_=t.setStyle??!0,this.prevX_=0,this.prevY_=0,vv=t.propertiesType!==void 0&&t.propertiesType}decodeCoordinates_(e,t){const i=e.length;let r=0;const o=t!==void 0?t:[];let s=o.length;for(;r<i;){let l,u=0,h=0;do l=vw.indexOf(e.charAt(r++)),h|=(l&31)<<u,u+=5;while(l>=32);const d=h&1?~(h>>1):h>>1;this.prevX_+=d,u=0,h=0;do l=vw.indexOf(e.charAt(r++)),h|=(l&31)<<u,u+=5;while(l>=32);const m=h&1?~(h>>1):h>>1;this.prevY_+=m,o[s++]=this.prevX_*this.accuracy_,o[s++]=this.prevY_*this.accuracy_}return o}encodeCoordinates_(e,t,i,r){let o="";for(let s=i;s<r;s+=t){let l=e[s],u=e[s+1];l=Math.floor(l/this.accuracy_),u=Math.floor(u/this.accuracy_);const h=l-this.prevX_,d=u-this.prevY_;this.prevX_=l,this.prevY_=u,o+=Q5(h)+Q5(d)}return o}readFeatureFromText(e){let t=e.indexOf("~");const i=t>=0?e.substring(0,t)+")":e,r=this.readGeometryFromText(i),o=new yi(r);if(t>=0){const s=e.substring(t+1,e.length-1);t=s.indexOf("~");const l=t>=0?s.substring(0,t):s;if(l!=""){const u=l.split("'");for(let h=0;h<u.length;++h){const m=u[h].split("*");let y=m[0];const x=m[1];!this.setStyle_&&vv[y]&&(y=vv[y]),o.set(y,x)}}if(t>=0){const u=s.substring(t+1);this.setStyle_?kbe(u,o):Lbe(u,o)}}return o}readFeaturesFromText(e){const t=[];for(e=e.substring(1);e.length>0;){const i=e.indexOf(")"),r=this.readFeatureFromText(e.substring(0,i+1));t.push(r),e=e.substring(i+1)}return t}readGeometryFromText(e){const t=Vbe[e[0]];return this.prevX_=0,this.prevY_=0,t.call(this,e)}getCastShortProperty(e,t){const i=Qm[t];return dz(t,e.get(i))}decodeShortProperties(e,t){const i=e.getGeometry()?.getType(),r=this.getCastShortProperty(e,"isCircle")?"drawnCircle":this.getCastShortProperty(e,"isLabel")?"drawnLabel":`drawn${i?.replace("String","")}`,o={showOrientation:!1,...Object.fromEntries(Zbe.map(h=>[h,this.getCastShortProperty(e,h)]))},s=e.get(Qm.name),l=e.get(Qm.description);Object.values(Qm).forEach(h=>e.unset(h));const u=Object.assign(new Rl,e,{id:Math.floor(Math.random()*Date.now()),label:s,description:l,display_order:t,selected:!1,map_id:void 0,saving:!1,featureType:r,featureStyle:o});return u.editable=u.map_id===void 0,u.setStyle(u.getStyleFunction()),u}writeFeatureText(e,t){const i=[];let r="";const o=e.getGeometry();o!=null&&(r=this.writeGeometryText(o,t)),r.length>0&&(r=r.substring(0,r.length-1),i.push(r));const s=[],l=function(h,d){if(d!==e.getGeometryName()){s.length!==0&&s.push("'");const m=d.replace(/[()'*]/g,"_")+"*"+h.toString().replace(/[()'*]/g,"_");s.push(m)}},u=this.propertiesFunction_(e);for(const h in u)l(u[h],h);if(s.length>0&&(i.push("~"),Array.prototype.push.apply(i,s)),this.encodeStyles_){const h=e.getStyleFunction();if(h!==void 0){let d=h.call(this,e,0);if(d!==null){const m=[];d=Array.isArray(d)?d:[d],bbe(d,o?.getType(),m),m.length>0&&(i.push("~"),Array.prototype.push.apply(i,m))}}}return i.push(")"),i.join("")}writeFeaturesText(e,t){const i=[];if(e.length>0){i.push("F");for(let r=0,o=e.length;r<o;++r)i.push(this.writeFeatureText(e[r],t))}return i.join("")}writeGeometryText(e,t){const i=Bbe[e.getType()],r=ru(e,!0,t);return this.prevX_=0,this.prevY_=0,i.call(this,r)}}const vw=".-_!*ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghjkmnpqrstuvwxyz",ybe=1;function _be(n){return n.getProperties()}function Q5(n){let e=n<<1;return n<0&&(e=~e),vbe(e)}function vbe(n){let e="";for(;n>=32;)e+=vw.charAt(32|n&31),n>>=5;return e+=vw.charAt(n),e}function bbe(n,e,t){const i=gbe[e];for(let r=0;r<n.length;++r){const o=n[r],s=o.getFill(),l=o.getImage(),u=o.getStroke(),h=o.getText();i==Th.POLYGON?s!==null&&u&&Cbe(s,u,t):i==Th.LINE_STRING?u!==null&&xbe(u,t):i==Th.POINT&&l!==null&&Ibe(l,t),h!==null&&wbe(h,t)}}function xbe(n,e){Yk(n,e)}function Ibe(n,e){if(n instanceof ms){const t=n.getRadius();e.length>0&&e.push("'"),e.push("pointRadius*"+t);const i=n.getFill();i!==null&&Xk(i,e);const r=n.getStroke();r!==null&&Yk(r,e)}}function Cbe(n,e,t){Xk(n,t),e!==null&&Yk(e,t)}function Xk(n,e,t){const i=t!==void 0?t:"fillColor",r=n.getColor();if(r!==null){const o=$l(r),s=oZ(o);e.length>0&&e.push("'"),e.push(i+"*"+s)}}function Yk(n,e){const t=n.getColor();if(t!==null){const r=$l(t),o=oZ(r);e.length>0&&e.push("'"),e.push("strokeColor*"+o)}const i=n.getWidth();i!==void 0&&(e.length>0&&e.push("'"),e.push("strokeWidth*"+i))}function wbe(n,e){const t=n.getFont();if(t!==void 0){const r=t.split(" ");r.length>=3&&(e.length>0&&e.push("'"),e.push("fontSize*"+r[1]))}const i=n.getFill();i!==null&&Xk(i,e,"fontColor")}function Abe(n){n=n.substring(2,n.length-1);const e=this.decodeCoordinates_(n,[]);return new qi(e,"XY")}function Sbe(n){n=n.substring(2,n.length-1);let e=[];const t=[],i=n.split("'");for(let r=0,o=i.length;r<o;++r)e=this?.decodeCoordinates_(i[r],e),t[r]=e.length;return new Du(e,"XY",t)}function Ebe(n){n=n.substring(2,n.length-1);const e=this?.decodeCoordinates_(n);return new zi(e)}function Tbe(n){n=n.substring(2,n.length-1);const e=this?.decodeCoordinates_(n);return new $h(e)}function Rbe(n){n=n.substring(2,n.length-1);let e=[];const t=[],i=n.split("'");for(let r=0,o=i.length;r<o;++r){e=this?.decodeCoordinates_(i[r],e);let s=e.length;r===0?(e[s++]=e[0],e[s++]=e[1]):(e[s++]=e[t[r-1]],e[s++]=e[t[r-1]+1]),t[r]=s}return new Bo(e,"XY",t)}function Mbe(n){n=n.substring(2,n.length-1);let e=[];const t=[],i=n.split(")(");for(let r=0,o=i.length;r<o;++r){const s=i[r].split("'"),l=t[r]=[];for(let u=0,h=s.length;u<h;++u){e=this?.decodeCoordinates_(s[u],e);let d=e.length;u===0?(e[d++]=e[0],e[d++]=e[1]):(e[d++]=e[l[u-1]],e[d++]=e[l[u-1]+1]),l[u]=d}}return new vf(e,"XY",t)}function kbe(n,e){if(n=="")return;const t=fz(n),i=t.fillColor,r=t.fontSize,o=t.fontColor,s=t.pointRadius,l=t.strokeColor,u=t.strokeWidth;let h;i!==void 0&&(h=new Di({color:i}));let d;l!==void 0&&u!==void 0&&(d=new bi({color:l,width:u}));let m;s!==void 0&&(m=new ms({radius:s,fill:h,stroke:d}),h=d=void 0);let y;r!==void 0&&o!==void 0&&(y=new Wc({font:r+" sans-serif",fill:new Di({color:o})}));const x=new Hn({fill:h,image:m,stroke:d,text:y});e.setStyle(x)}function Lbe(n,e){const t=fz(n),i=e.getGeometry();if(i instanceof zi?t.isLabel||t[Nd.IS_TEXT]?(delete t.strokeColor,delete t.fillColor):(delete t.fontColor,delete t.fontSize):(delete t.fontColor,i instanceof qi&&(delete t.fillColor,delete t.fillOpacity)),t.fontSize){let o=parseFloat(t.fontSize);t.fontSize.indexOf("px")!==-1&&(o=Math.round(o/1.333333)),t.fontSize=o}const r={};for(const o in t){const s=t[o];vv[o]?r[vv[o]]=s:r[o]=s}e.setProperties(r)}function dz(n,e){const t=[Nd.ANGLE,Nd.OPACITY,Nd.SIZE,Nd.STROKE,"pointRadius","strokeWidth","stroke","angle","opacity","size"],i=[Nd.IS_RECTANGLE,Nd.IS_TEXT,Nd.SHOW_MEASURE,"isCircle","isRectangle","isLabel","showMeasure","showOrientation"];return t.includes(n)?+e:i.includes(n)?e==="true":e}function fz(n){const e=n.split("'"),t={};for(let i=0;i<e.length;++i){const o=e[i].split("*"),s=o[0],l=o[1];t[s]=dz(s,l)}return t}function Pbe(n){const e=n,t=e.getFlatCoordinates(),i=e.getStride(),r=t.length;return"l("+this?.encodeCoordinates_(t,i,0,r)+")"}function Gbe(n){const e=n,t=e.getEnds(),i=t.length,r=e.getFlatCoordinates(),o=e.getStride();let s=0;const l=["L("];for(let u=0;u<i;++u){const h=t[u],d=this?.encodeCoordinates_(r,o,s,h);u!==0&&l.push("'"),l.push(d),s=h}return l.push(")"),l.join("")}function Fbe(n){const e=n,t=e.getFlatCoordinates(),i=e.getStride(),r=t.length;return"p("+this?.encodeCoordinates_(t,i,0,r)+")"}function Obe(n){const e=n,t=e.getFlatCoordinates(),i=e.getStride(),r=t.length;return"P("+this?.encodeCoordinates_(t,i,0,r)+")"}function pz(n,e,t,i,r){const o=i.length;for(let s=0;s<o;++s){const l=i[s]-e,u=this?.encodeCoordinates_(n,e,t,l);s!==0&&r.push("'"),r.push(u),t=i[s]}return t}function Nbe(n){const e=n,t=e.getFlatCoordinates(),i=e.getStride(),r=e.getEnds(),o=0,s=["a("];return pz.call(this,t,i,o,r,s),s.push(")"),s.join("")}function Dbe(n){const e=n,t=e.getFlatCoordinates(),i=e.getStride(),r=e.getEndss(),o=r.length;let s=0;const l=["A"];for(let u=0;u<o;++u){const h=r[u];l.push("("),s=pz.call(this,t,i,s,h,l),l.push(")")}return l.join("")}const Vbe={P:Tbe,L:Sbe,A:Mbe,l:Abe,p:Ebe,a:Rbe},Bbe={MultiLineString:Gbe,MultiPoint:Obe,MultiPolygon:Dbe,LineString:Pbe,Point:Fbe,Polygon:Nbe},Qm={angle:"a",color:"c",description:"d",stroke:"e",isLabel:"i",linestyle:"l",name:"n",opacity:"o",showOrientation:"r",shape:"s",size:"t",isCircle:"u",symbolId:"symbolId",symboltype:"symboltype"},Zbe=["angle","color","stroke","linestyle","opacity","showOrientation","shape","size","symbolId","symboltype"],BI=new mbe({encodeStyles:!1,properties:function(n){const e=n.toProperties();for(const t in e)if(e[t]===null||e[t]===void 0)delete e[t];else if(t==="__map_id__"||t==="fid")delete e[t];else if(Qm[t]){const i=e[t];delete e[t],e[Qm[t]]=i}return e}});window.Cypress&&(window.featureHash=BI);class Wbe{featuresToUrl(e){if(!e)return"";const t=e.filter(i=>!i.map_id).sort((i,r)=>i.display_order-r.display_order).map(i=>{const r=new Rl(i);return hk(r)});return t.length>0?BI.writeFeatures(t):""}urlToFeatures(e){return(e?BI.readFeatures(e):[]).map((r,o)=>BI.decodeShortProperties(r,o)).map(r=>aZ(r))}}const e3=new Wbe;class zbe{bootstrap(){this.restore();let e;e=Rs(()=>{this.persist(),e&&e()})}persist(){const{drawnFeatures:e}=It(zr());Pt(e,t=>{Dn.setValue(kT,t,e3.featuresToUrl)},{immediate:!0})}restore(){const{drawnFeatures:e}=It(zr()),i=Dn.getValue(kT,e3.urlToFeatures).filter(r=>r!=null);i.forEach(r=>{r.map_id=void 0}),e.value=[...e.value,...i]}}const Ube=new zbe;class Xbe{bootstrap(){this.restore();let e;e=Rs(()=>{this.persist(),e&&e()})}persist(){const{locationInfoCoords:e}=It(ag());Pt(e,t=>{t===void 0?Dn.removeItem(GS):(Dn.setValue(GS,!0),Dn.setValue(PT,t[0]),Dn.setValue(GT,t[1]))},{immediate:!0})}restore(){const{locationInfoCoords:e}=It(ag()),t=Kn().getOlMap(),i=Dn.getValue(GS);i&&i!=="false"&&(e.value=t.getView().getCenter())}}const Ybe=new Xbe,Hbe={key:0,"data-cy":"attributionControl",class:"absolute bottom-0 z-10 text-[0.8em] px-[4px] text-[#6b818f] bg-[#ffffffb3]"},Kbe=at({__name:"attribution-control",setup(n){const e=Ui(),t=Ue("");return Rs(()=>{t.value=e.bgLayer?.metadata?.attribution||""}),(i,r)=>{const o=kl("dompurify-html");return t.value?An((U(),ie("div",Hbe,null,512)),[[o,t.value]]):Le("",!0)}}});function n_(n,e){const t=new n(e),i=Kn(),r=Do("olMap");return sr(()=>{r.addControl(t),r.changed()}),Ms(()=>{const o=i.getOlMap();o.removeControl(t),o.changed()}),{control:t}}const jbe=["title"],$be=at({__name:"location-control",props:{className:{default:"location-button"},label:{default:""},tipLabel:{default:"Location"}},setup(n){const{t:e}=St(),{addNotification:t}=Qr(),i=n,r=Ue(null),o=Ue(!1);let s=null,l=null,u=null,h=null,d=null;function m(){if(window.location.protocol!=="https:"&&window.location.hostname!=="localhost"){t(e("La geolocalisation n'est disponible que dans la version scurise du Geoportail (https). Voulez-vous tre automatiquement redirig?",{ns:"client"}),ii.WARNING);return}s===null&&y(),s?.getTracking()?(C(),s?.setTracking(!1)):(x(),d?.getView().setZoom(17),s?.setTracking(!0))}function y(){d&&(s=new rZ({projection:d.getView().getProjection(),trackingOptions:{enableHighAccuracy:!0,maximumAge:6e4,timeout:7e3}}),s.on("change:tracking",()=>{o.value=s?.getTracking()??!1}),s.on("change:position",()=>{const w=s?.getPosition();w&&l&&(l.setGeometry(new zi(w)),d?.getView().setCenter(w))}),s.on("change:accuracyGeometry",()=>{const w=s?.getAccuracyGeometry();w&&u&&u.setGeometry(w)}),s.on("error",w=>{if(C(),w.message&&w.message.length>0){const E=e("Erreur lors de l'acquisition de la position :",{ns:"client"})+" "+w.message;t(E,ii.ERROR)}}))}function x(){d&&(h||(l=new yi,l.setStyle(new Hn({image:new ms({radius:6,fill:new Di({color:"#3399CC"}),stroke:new bi({color:"#fff",width:2})})})),u=new yi,u.setStyle(new Hn({fill:new Di({color:"rgba(51, 153, 204, 0.2)"}),stroke:new bi({color:"#3399CC",width:2})})),h=new gs({source:new io({features:[]}),zIndex:1e3}),d.addLayer(h)),h.getSource()?.clear(),u?.setGeometry(void 0),l?.setGeometry(void 0),u&&l&&(h.getSource()?.addFeature(u),h.getSource()?.addFeature(l)))}function C(){h?.getSource()?.clear()}return sr(()=>{d=Kn().getOlMap(),n_(rd,{...i,target:r})}),Ms(()=>{s&&s.setTracking(!1),h&&d&&d.removeLayer(h)}),(w,E)=>(U(),ie("div",{ref_key:"controlElement",ref:r,class:Rn([{"tracker-on":o.value,"tracker-off":!o.value},i.className,M(Bc),M(Af)])},[P("button",{title:M(e)(i.tipLabel),onClick:m},K(i.label),9,jbe)],2))}}),Jbe=es($be,[["__scopeId","data-v-74224a7f"]]),qbe={class:"scale-selector dropup"},Qbe=["aria-label","aria-expanded","aria-controls"],e1e=["innerHTML"],t1e=["aria-labelledby"],n1e=["onClick","aria-label"],i1e=["innerHTML"],r1e=at({__name:"scale-selector",setup(n){const{t:e}=St(),{getOlMap:t}=Kn(),i=t(),{minZoom:r,maxZoom:o}=It(Ui()),s=Ue(!1),l=Ue(null),u=Ue(null);let h=null,d=null;const m={8:"1&nbsp;:&nbsp;1'500'000",9:"1&nbsp;:&nbsp;750'000",10:"1&nbsp;:&nbsp;400'000",11:"1&nbsp;:&nbsp;200'000",12:"1&nbsp;:&nbsp;100'000",13:"1&nbsp;:&nbsp;50'000",14:"1&nbsp;:&nbsp;25'000",15:"1&nbsp;:&nbsp;12'000",16:"1&nbsp;:&nbsp;6'000",17:"1&nbsp;:&nbsp;3'000",18:"1&nbsp;:&nbsp;1'500",19:"1&nbsp;:&nbsp;750",20:"1&nbsp;:&nbsp;400",21:"1&nbsp;:&nbsp;200"},y=Ue(void 0),x=Ct(()=>{const ae=r.value??8,fe=o.value??19,Y={};return Object.keys(m).forEach(de=>{const D=Number(de);D>=ae&&D<=fe&&(Y[D]=m[D])}),Y}),C=Ct(()=>Object.keys(x.value).map(Number).sort((ae,fe)=>ae-fe)),w=ae=>x.value[ae]||m[ae]||"",E=ae=>ae.replace(/&nbsp;/g," ").replace(/'/g,"'"),T=Ct(()=>y.value!==void 0?y.value:""),k=Ct(()=>y.value?E(y.value):e("No scale")),G=ae=>{const fe=i.getView();fe&&(fe.setZoom(ae),s.value=!1),no(()=>{l.value?.focus()})},O=()=>{const ae=i.getView();if(!ae)return;const fe=Math.round(ae.getZoom()||0),Y=m[fe];Y!==void 0&&(y.value=Y)},V=()=>{h!==null&&vl(h);const ae=i.getView();ae&&(h=ae.on("change:resolution",O))},z=()=>{s.value=!s.value,s.value&&no(()=>{u.value?.querySelector("a")?.focus()})},H=ae=>{ae.key==="Enter"||ae.key===" "?(ae.preventDefault(),ae.stopPropagation(),z()):ae.key==="Escape"&&s.value?(ae.preventDefault(),ae.stopPropagation(),s.value=!1):ae.key==="ArrowDown"&&!s.value?(ae.preventDefault(),ae.stopPropagation(),z()):(ae.key==="ArrowUp"||ae.key==="ArrowDown")&&ae.stopPropagation()},te=ae=>{const fe=Array.from(u.value?.querySelectorAll("a")||[]),Y=fe.findIndex(de=>de===document.activeElement);if(ae.key==="Escape")ae.preventDefault(),ae.stopPropagation(),s.value=!1,l.value?.focus();else if(ae.key==="ArrowDown"){ae.preventDefault(),ae.stopPropagation();const de=(Y+1)%fe.length;fe[de]?.focus()}else if(ae.key==="ArrowUp"){ae.preventDefault(),ae.stopPropagation();const de=Y<=0?fe.length-1:Y-1;fe[de]?.focus()}else ae.key==="Home"?(ae.preventDefault(),ae.stopPropagation(),fe[0]?.focus()):ae.key==="End"?(ae.preventDefault(),ae.stopPropagation(),fe[fe.length-1]?.focus()):ae.key==="Tab"&&(s.value=!1)},$=ae=>{const fe=ae.target;l.value&&!l.value.contains(fe)&&u.value&&!u.value.contains(fe)&&(s.value=!1)};return sr(()=>{const ae=i.getView();if(ae){const Y=ae.getZoom();Y!==void 0&&(y.value=m[Math.round(Y)])}V();const fe=i.getView();fe&&(d=fe.on("change",()=>{V(),O()})),document.addEventListener("click",$)}),cg(()=>{h!==null&&vl(h),d!==null&&vl(d),document.removeEventListener("click",$)}),(ae,fe)=>(U(),ie("div",qbe,[P("button",{type:"button",class:"scale-button",onClick:z,onKeydown:H,ref_key:"dropdownButton",ref:l,"aria-label":M(e)("Select scale")+": "+k.value,"aria-expanded":s.value,"aria-haspopup":"true","aria-controls":s.value?"scale-menu":void 0},[P("span",{innerHTML:T.value,"aria-hidden":"true"},null,8,e1e),fe[0]||(fe[0]=Bt("",-1)),fe[1]||(fe[1]=P("span",{class:"caret","aria-hidden":"true"},null,-1))],40,Qbe),An(P("ul",{ref_key:"dropdownMenu",ref:u,id:"scale-menu",class:"scale-dropdown",role:"menu",onKeydown:te,"aria-labelledby":l.value?"scale-button":void 0},[(U(!0),ie(Mt,null,hi(C.value,Y=>(U(),ie("li",{key:Y,role:"none"},[P("a",{href:"#",role:"menuitem",onClick:ps(de=>G(Y),["prevent"]),"aria-label":E(w(Y)),tabindex:"0"},[P("span",{innerHTML:w(Y)},null,8,i1e)],8,n1e)]))),128))],40,t1e),[[Yp,s.value]])]))}}),s1e=es(r1e,[["__scopeId","data-v-1f8cd5e5"]]),cE="units",o1e=[1,2,5],b0=25.4/.28;let a1e=class extends rd{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+Bc,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(cE,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(cE)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(cE,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,r=this.getUnits(),o=r=="degrees"?"degrees":"m";let s=Lv(i,e.resolution,t,o);const l=this.minWidth_*(this.dpi_||b0)/b0,u=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||b0)/b0:void 0;let h=l*s,d="";if(r=="degrees"){const G=Kp.degrees;h*=G,h<G/60?(d="",s*=3600):h<G?(d="",s*=60):d=""}else if(r=="imperial")h<.9144?(d="in",s/=.0254):h<1609.344?(d="ft",s/=.3048):(d="mi",s/=1609.344);else if(r=="nautical")s/=1852,d="NM";else if(r=="metric")h<1e-6?(d="nm",s*=1e9):h<.001?(d="m",s*=1e6):h<1?(d="mm",s*=1e3):h<1e3?d="m":(d="km",s/=1e3);else if(r=="us")h<.9144?(d="in",s*=39.37):h<1609.344?(d="ft",s/=.30480061):(d="mi",s/=1609.3472);else throw new Error("Invalid units");let m=3*Math.floor(Math.log(l*s)/Math.log(10)),y,x,C,w=0,E,T;for(;;){C=Math.floor(m/3);const G=Math.pow(10,C);if(y=o1e[(m%3+3)%3]*G,x=Math.round(y/s),isNaN(x)){this.element.style.display="none",this.renderedVisible_=!1;return}if(u!==void 0&&x>=u){y=w,x=E,C=T;break}else if(x>=l)break;w=y,E=x,T=C,++m}const k=this.scaleBar_?this.createScaleBar(x,y,d):y.toFixed(C<0?-C:0)+" "+d;this.renderedHTML_!=k&&(this.innerElement_.innerHTML=k,this.renderedHTML_=k),this.renderedWidth_!=x&&(this.innerElement_.style.width=x+"px",this.renderedWidth_=x),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const r=this.getScaleForResolution(),o=r<1?Math.round(1/r).toLocaleString()+" : 1":"1 : "+Math.round(r).toLocaleString(),s=this.scaleBarSteps_,l=e/s,u=[this.createMarker("absolute")];for(let d=0;d<s;++d){const m=d%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";u.push(`<div><div class="ol-scale-singlebar ${m}" style="width: ${l}px;"></div>`+this.createMarker("relative")+(d%2===0||s===2?this.createStepText(d,e,!1,t,i):"")+"</div>")}return u.push(this.createStepText(s,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+o+"</div>":"")+u.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,r,o){const l=(e===0?0:Math.round(r/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+o),u=e===0?-3:t/this.scaleBarSteps_*-1,h=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${u}px;text-align: ${e===0?"left":"center"};min-width: ${h}px;left: ${i?t+"px":"unset"};">`+l+"</div>"}getScaleForResolution(){const e=Lv(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||b0,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}};const l1e={class:"scaleline-wrapper"},u1e=at({__name:"scale-line",setup(n){const{getOlMap:e}=Kn(),t=e(),i=Ue(null);let r=null;return sr(()=>{i.value&&(r=new a1e({target:i.value,units:"metric",bar:!1,text:!0,minWidth:64}),t.addControl(r))}),cg(()=>{r&&(t.removeControl(r),r=null)}),(o,s)=>(U(),ie("div",l1e,[P("div",{ref_key:"scaleLineContainer",ref:i,class:"scaleline-container"},null,512)]))}}),c1e=es(u1e,[["__scopeId","data-v-21f5738c"]]),hE="projection",t3="coordinateFormat";class h1e extends rd{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(hE,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(t3)}getProjection(){return this.get(hE)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(mn(t,Gv.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(mn(t,Gv.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(t3,e)}setProjection(e){this.set(hE,Ni(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const o=this.getProjection();o?this.transform_=zy(this.mapProjection_,o):this.transform_=xD}const r=this.getMap().getCoordinateFromPixelInternal(e);if(r){if(this.transform_(r,r),this.wrapX_){const s=this.getProjection()||this.mapProjection_;zw(r,s)}const o=this.getCoordinateFormat();o?t=o(r):t=r.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}const d1e={class:"projection-selector-wrapper"},f1e={class:"projection-selector dropup"},p1e=["aria-label","aria-expanded","aria-controls"],g1e={class:"projection-label","aria-hidden":"true"},m1e=["aria-labelledby"],y1e=["onClick","aria-current"],_1e=["aria-label"],v1e=at({__name:"projection-selector",setup(n){const{t:e}=St(),{getOlMap:t}=Kn(),i=t(),{coordinateString:r}=jB(),o=Ue(!1),s=Ue(null),l=Ue(null),u=Ue(null);let h=null;const d=[{label:"LUREF",value:"EPSG:2169"},{label:"Lon/Lat WGS84",value:"EPSG:4326"},{label:"Lon/Lat WGS84 DMS",value:"EPSG:4326:DMS"},{label:"Lon/Lat WGS84 DM",value:"EPSG:4326:DMm"},{label:"WGS84 UTM 32|31",value:"EPSG:3263*"}],m=Ue(d[0]),y=Ct(()=>m.value.label),x=G=>{if(!G)return"";const O=i.getView().getProjection().getCode(),V=m.value.value;return V==="EPSG:4326:DMS"?r(G,O,"EPSG:4326",!0,!1):V==="EPSG:4326:DMm"?r(G,O,"EPSG:4326",!1,!0):r(G,O,V,!1,!1)},C=G=>{m.value=G,o.value=!1,h&&h.setCoordinateFormat(x),no(()=>{s.value?.focus()})},w=()=>{o.value=!o.value,o.value&&no(()=>{l.value?.querySelector("a")?.focus()})},E=G=>{G.key==="Enter"||G.key===" "?(G.preventDefault(),G.stopPropagation(),w()):G.key==="Escape"&&o.value?(G.preventDefault(),G.stopPropagation(),o.value=!1):G.key==="ArrowDown"&&!o.value&&(G.preventDefault(),G.stopPropagation(),w())},T=G=>{const O=Array.from(l.value?.querySelectorAll("a")||[]),V=O.findIndex(z=>z===document.activeElement);if(G.key==="Escape")G.preventDefault(),G.stopPropagation(),o.value=!1,s.value?.focus();else if(G.key==="ArrowDown"){G.preventDefault(),G.stopPropagation();const z=(V+1)%O.length;O[z]?.focus()}else if(G.key==="ArrowUp"){G.preventDefault(),G.stopPropagation();const z=V<=0?O.length-1:V-1;O[z]?.focus()}else G.key==="Home"?(G.preventDefault(),G.stopPropagation(),O[0]?.focus()):G.key==="End"?(G.preventDefault(),G.stopPropagation(),O[O.length-1]?.focus()):G.key==="Tab"&&(o.value=!1)},k=G=>{const O=G.target;s.value&&!s.value.contains(O)&&l.value&&!l.value.contains(O)&&(o.value=!1)};return sr(()=>{u.value&&(h=new h1e({className:"custom-mouse-coordinates",target:u.value,coordinateFormat:x,projection:void 0}),i.addControl(h)),document.addEventListener("click",k)}),cg(()=>{h&&(i.removeControl(h),h=null),document.removeEventListener("click",k)}),(G,O)=>(U(),ie("div",d1e,[P("div",f1e,[P("button",{type:"button",class:"projection-button",onClick:w,onKeydown:E,ref_key:"dropdownButton",ref:s,"aria-label":M(e)("Select projection")+": "+y.value,"aria-expanded":o.value,"aria-haspopup":"true","aria-controls":o.value?"projection-menu":void 0},[P("span",g1e,K(y.value),1),O[0]||(O[0]=P("span",{class:"caret","aria-hidden":"true"},null,-1))],40,p1e),An(P("ul",{ref_key:"dropdownMenu",ref:l,id:"projection-menu",class:"projection-dropdown",role:"menu",onKeydown:T,"aria-labelledby":s.value?"projection-button":void 0},[(U(),ie(Mt,null,hi(d,V=>P("li",{key:V.value,role:"none"},[P("a",{href:"#",role:"menuitem",onClick:ps(z=>C(V),["prevent"]),class:Rn({active:V.value===m.value.value}),"aria-current":V.value===m.value.value?"true":void 0,tabindex:"0"},K(V.label),11,y1e)])),64))],40,m1e),[[Yp,o.value]])]),P("div",{ref_key:"mousePositionContainer",ref:u,class:"mouse-position",role:"status","aria-live":"polite","aria-label":M(e)("Current coordinates")},null,8,_1e)]))}}),b1e=es(v1e,[["__scopeId","data-v-5fe08aa6"]]),x1e=["aria-label"],I1e={class:"elevation-label"},C1e={class:"elevation-value",role:"status","aria-live":"polite"},w1e=at({__name:"elevation-display",setup(n){const{t:e}=St(),{getOlMap:t}=Kn(),i=t(),r=Ue("N/A");let o=null;const s=h=>h===null||h<=0?"N/A":`${h.toFixed(2)} m`,l=async h=>{if(h.coordinate)try{const d=await uZ(h.coordinate);r.value=s(d)}catch{r.value="N/A"}},u=h=>{l(h)};return sr(()=>{o=mn(i,"pointermove",u)}),cg(()=>{o&&(vl(o),o=null)}),(h,d)=>(U(),ie("div",{class:"elevation-display","aria-label":M(e)("Elevation at cursor position")},[P("span",I1e,K(M(e)("Elevation"))+":",1),P("span",C1e,K(r.value),1)],8,x1e))}}),A1e=es(w1e,[["__scopeId","data-v-71c32fcf"]]),S1e=["aria-label"],E1e={class:"infobar-item"},T1e={class:"infobar-item"},R1e={class:"!hidden lg:!flex infobar-item-projection"},M1e={class:"!hidden lg:!flex infobar-item-elevation"},k1e=at({__name:"infobar-content",setup(n){const{t:e}=St();return(t,i)=>(U(),ie("div",{class:"infobar",role:"toolbar","aria-label":M(e)("Map information toolbar")},[P("div",E1e,[mt(s1e)]),i[0]||(i[0]=P("div",{class:"infobar-separator","aria-hidden":"true"},null,-1)),P("div",T1e,[mt(c1e)]),i[1]||(i[1]=P("div",{class:"!hidden lg:!block infobar-separator","aria-hidden":"true"},null,-1)),P("div",R1e,[mt(b1e)]),i[2]||(i[2]=P("div",{class:"!hidden lg:!block infobar-separator","aria-hidden":"true"},null,-1)),P("div",M1e,[mt(A1e)])],8,S1e))}}),L1e=es(k1e,[["__scopeId","data-v-f917cdb1"]]),P1e={key:0,class:"infobar-container"},G1e=["title"],F1e=at({__name:"infobar-control",props:{className:{default:"infobar-button"},label:{default:""},tipLabel:{default:"Infobar"}},setup(n){const e=Ue(!1),{t}=St(),i=n;function r(){e.value=!e.value}return(o,s)=>(U(),ie("div",{class:Rn([[i.className,M(Af)],"infobar-wrapper"])},[e.value?(U(),ie("div",P1e,[mt(L1e)])):Le("",!0),P("div",{ref:"controlElement",class:Rn([{"infobar-on":e.value,"infobar-off":!e.value},M(Bc)])},[P("button",{title:M(t)(i.tipLabel),onClick:r},K(i.label),9,G1e)],2)],2))}}),O1e=es(F1e,[["__scopeId","data-v-d41d0ac3"]]),N1e=["href","title"],D1e=at({__name:"map-3d",props:{className:{default:"map-3d-button"},label:{default:"3D"},tipLabel:{default:"3D"}},setup(n){const e="https://3d.geoportail.lu/",t=[6.13,49.61],i=["catalogConfig","LuxConfig"],r={9:35e4,10:18e4,11:1e5,12:4e4,13:25e3,14:9e3,15:6e3,16:3500,17:1900,18:900,19:600},o=Ui(),{t:s}=St(),l=n,{x:u,y:h,zoom:d,layers:m,bgLayer:y,rotation:x}=It(o),C=Ue(null),w=Ct(()=>{const[G,O]=E(u.value,h.value),V=T(d.value??12),z=k(x.value??0),H=m.value.map(ae=>JSON.stringify([ae.name,1,0])),te=y.value?JSON.stringify([y.value.name,1,0]):null;te&&H.unshift(te);const $=`[[[${[G,O,V].join(",")}],[${[G,O,V].join(",")}],300,${z},-90,0],"cesium",["${i.join('","')}"],[${H.join(",")}],[],0]`;return`${e}?state=${encodeURIComponent($)}`});sr(()=>{window.name="lux2d",n_(rd,{...l,target:C})});function E(G,O){return G&&O?bc([G,O]):t}function T(G){const z=Math.max(9,Math.min(19,Math.round(G)));return r[z]}function k(G){const O=-((G*(180/Math.PI)+360)%360);return Math.round(O)}return(G,O)=>(U(),ie("div",{"data-cy":"3dViewerLink",ref_key:"controlElement",ref:C,class:Rn(`${l.className} ${M(Bc)} ${M(Af)}`)},[P("a",{type:"button",target:"lux3d",href:w.value,title:M(s)(l.tipLabel)},"3D",8,N1e)],2))}}),V1e=es(D1e,[["__scopeId","data-v-05085833"]]),n3=["fullscreenchange","webkitfullscreenchange"],i3={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class B1e extends rd{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const r=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=r,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(Qn.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${Bc} ${Af}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(r3(t))if(s3(t))W1e(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?Z1e(i):gz(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=s3(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(pC(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(i3.ENTERFULLSCREEN)):(pC(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(i3.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(xo.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(xo.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,r=e.length;i<r;++i)mr(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();r3(i)?this.element.classList.remove($G):this.element.classList.add($G);for(let r=0,o=n3.length;r<o;++r)e.push(mn(i,n3[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function r3(n){const e=n.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&n.fullscreenEnabled)}function s3(n){return!!(n.webkitIsFullScreen||n.fullscreenElement)}function gz(n){n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()}function Z1e(n){n.webkitRequestFullscreen?n.webkitRequestFullscreen():gz(n)}function W1e(n){n.exitFullscreen?n.exitFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen()}const z1e=at({__name:"fullscreen-control",props:{className:{},label:{default:""},labelActive:{default:""}},setup(n){return n_(B1e,n),(t,i)=>Le("",!0)}}),U1e=at({__name:"zoom-control",props:{className:{},zoomInLabel:{default:""},zoomOutLabel:{default:""}},setup(n){return n_(YD,n),(t,i)=>Le("",!0)}}),X1e=at({__name:"rotate-control",props:{className:{},label:{}},setup(n){return n_(XD,n),(t,i)=>Le("",!0)}});let Y1e=class extends rd{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null,this.fitOptions=e.fitOptions||{};const t=e.className!==void 0?e.className:"ol-zoom-extent",i=e.label!==void 0?e.label:"E",r=e.tipLabel!==void 0?e.tipLabel:"Fit to extent",o=document.createElement("button");o.setAttribute("type","button"),o.title=r,o.appendChild(typeof i=="string"?document.createTextNode(i):i),o.addEventListener(Qn.CLICK,this.handleClick_.bind(this),!1);const s=t+" "+Bc+" "+Af,l=this.element;l.className=s,l.appendChild(o)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const t=this.getMap().getView(),i=this.extent?Xl(this.extent,t.getProjection()):t.getProjection().getExtent();t.fitInternal(JE(i),this.fitOptions)}};class H1e extends Y1e{ol3dm;constructor(e){super(e)}handleZoomToExtent(){this.ol3dm&&this.ol3dm.luxCameraExtentInRadians&&this.ol3dm.is3dEnabled()||super.handleZoomToExtent()}}const K1e=at({__name:"zoom-to-extent-control",props:{className:{},label:{default:""},tipLabel:{},extent:{}},setup(n){return n_(H1e,n),(t,i)=>Le("",!0)}}),o3=at({__name:"map-container",props:{v4_standalone:{type:Boolean,default:!1}},setup(n){const e=Jn(),{embedded:t}=It(e),i=Kn(),r=Ue(null),o=i.createMap(),s=n;o.getInteractions().forEach(h=>{h instanceof tT&&o.removeInteraction(h)});const l=new tT({condition:JH});o.addInteraction(l),s.v4_standalone&&(cbe(),hbe(),sbe().addDrawLayer(o),obe(),ube().init(),vu.init(o));const u=[425152.9429259216,632446599999133e-8,914349.9239510496,6507914867875754e-9];return sr(()=>{r.value&&(new nbe(o),new ibe(o),pbe.bootstrap(),Ube.bootstrap(),Ybe.bootstrap(),o.setTarget(r.value),window.olMap=o)}),Rs(()=>{r.value&&t.value&&setTimeout(()=>{i.resize()},1e3)}),Gw("olMap",o),(h,d)=>(U(),ie("div",{id:"map-container","data-cy":"mapContainer",ref_key:"mapContainer",ref:r,class:"h-full w-full bg-white relative"},[mt(U1e),mt(K1e,{extent:u}),M(t)?Le("",!0):(U(),ie(Mt,{key:0},[mt(z1e),mt(Kbe),n.v4_standalone?(U(),Gt(V1e,{key:0})):Le("",!0),mt(Jbe),mt(O1e),mt(X1e)],64))],512))}});function j1e(n,e){return n.children&&!e.children||e.children?.length===0?1:e.children&&!n.children||n.children?.length===0?-1:0}function mz(n,e,t=0){const{name:i="",type:r=Rc.WMS,children:o}=n,s=`${r}||${e}||${i}`.split("-").join("%2D"),l=Ui();return{id:s,name:i,depth:t,children:o?.sort(j1e).map(u=>mz(u,e,t+1)),checked:l.hasLayer(s),expanded:!1}}function $1e(n){const e=decodeURIComponent(n),[t,i,r]=e.split("||");return yz({id:e,url:$v.getProxyfiedUrl(i),remoteLayer:{name:r,type:t}})}function yz({id:n,url:e,remoteLayer:t}){const{name:i="",type:r=Rc.WMS}=t;return{id:n,name:i,layers:i,url:e,type:r,imageType:K4.PNG}}const J1e={class:"relative text-center","data-cy":"remoteLayerModalContent"},q1e=["placeholder","value"],Q1e={key:0,class:"text-center"},exe={class:"lux-label"},txe={key:1,class:"text-center"},nxe={class:"lux-label"},ixe={key:2,class:"text-center"},rxe={key:3,class:"overflow-auto max-h-[calc(400px-36px)]"},sxe=at({__name:"remote-layers",setup(n){const{t:e}=St(),t=Ui(),i=la(),r=mi([]),o=mi(),{remoteLayersOpen:s}=It(Jn()),{setRemoteLayersOpen:l}=Jn();let u=!1,h,d,m;Rs(y);function y(){o.value=o.value?by.updateLayers(o.value,t.layers):void 0}Jv.fetchRemoteWmsEndpoint().then(O=>{r.value=O.map(({url:V,label:z})=>({label:z,value:V}))});async function x(O){u=!0,m=await Jv.getRemoteEndpoint(O).catch(()=>alert(e("Impossible de contacter ce WMS",{ns:"client"}))),d=O,u=!1}async function C(){const V=m?.getLayers();if(V&&V[0]){const z=mz(V[0],d);o.value=by.updateLayers(z,t.layers)}}async function w(O){d=h=O,await x(d),C()}function E(O){h=O.target.value}async function T(){await x(h),C()}function k(O){o.value=by.toggleNode(O.id,o.value,"expanded")}function G(O){const{id:V,name:z}=O,H=m;if(O.checked===!0)t.removeLayers(V);else{const te=H?.getLayerByName(z);if(te){const $=i.initLayer(yz({id:V,url:$v.getProxyfiedUrl(d),remoteLayer:te}));t.addLayers($)}}}return(O,V)=>M(s)?(U(),Gt(kf,{key:0,title:M(e)("Add external data",{ns:"client"}),onClose:V[0]||(V[0]=z=>M(l)(!1))},{content:Wt(()=>[P("div",J1e,[mt(ig,{class:"lux-remote-services-dropdown",options:r.value,placeholder:M(e)("Predefined wms",{ns:"client"}),onChange:w},null,8,["options","placeholder"]),P("input",{class:"lux-input w-[300px]",type:"url",placeholder:M(e)("Choose or write a WMS url",{ns:"client"}),value:M(d)||"",onChange:E},null,40,q1e),P("button",{type:"button",class:"lux-btn",onClick:T},K(M(e)("Get the layers",{ns:"client"})),1)]),!M(u)&&M(m)?(U(),ie("div",Q1e,[P("span",exe,K(M(e)("Description du service :",{ns:"client"})),1),Bt(" "+K(M(m).getServiceInfo()?.abstract),1)])):Le("",!0),!M(u)&&M(m)?(U(),ie("div",txe,[P("span",nxe,K(M(e)("Access constraints :",{ns:"client"})),1),Bt(" "+K(M(m).getServiceInfo()?.constraints),1)])):Le("",!0),M(u)?(U(),ie("div",ixe,[V[1]||(V[1]=P("div",{class:"fa fa-refresh fa-spin"},null,-1)),P("span",null,K(M(e)("Chargement des informations",{ns:"client"})),1)])):Le("",!0),M(u)?Le("",!0):(U(),ie("div",rxe,[o.value?(U(),Gt(cR,{key:0,class:"block p-[10px] mb-[11px]",node:o.value,onToggleParent:k,onToggleLayer:G},null,8,["node"])):Le("",!0)]))]),_:1},8,["title"])):Le("",!0)}});class oxe{bootstrap(){let e;e=Rs(()=>{this.restore(),this.persist(),e&&e()})}persist(){const e=_w();Pt([()=>e.sliderActive,()=>e.sliderRatio],([t,i],[r])=>{t!==r&&Dn.setValue(FT,t),Dn.setValue(OT,i)})}restore(){const e=Dn.getValue(FT,ak),t=Dn.getValue(OT,Op),{toggleSlider:i,setRatio:r}=_w();typeof e<"u"&&e!==null&&(i(e),typeof t!==void 0&&t!==null&&r(t??cz))}}const axe=new oxe,lxe=["onKeydown"],uxe={key:0,"data-cy":"sliderLayerLabel",class:"lux-slider-layer-label"},a3=30,cxe=at({__name:"splitter-element",props:{sliderActive:{type:Boolean},sliderRatio:{},sliderTopLayer:{},sliderOffset:{},containerOffset:{}},emits:["moveSplitBar","escSplitBar"],setup(n,{expose:e,emit:t}){const i=n,r=t,{t:o}=St(),s=Ue(null),l=Ct(()=>({left:`${i.sliderOffset}px`}));let u=!1;e({sliderElement:s});function h(E){r("moveSplitBar",E+s.value.offsetWidth/2)}function d(){u=!0,document.addEventListener("mousemove",m),document.addEventListener("mouseup",y)}function m(E){u&&h(E.clientX)}function y(){u=!1,document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",y)}function x(){const E=i.containerOffset+s.value.offsetLeft;h(E+a3)}function C(){const E=i.containerOffset+s.value.offsetLeft;h(E-a3)}function w(){r("escSplitBar")}return sr(()=>{s.value?.focus({focusVisible:!0})}),Ms(()=>{document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",y)}),(E,T)=>(U(),ie("button",{ref_key:"sliderElement",ref:s,onMousedown:d,onMousemove:m,onMouseup:y,onKeydown:[to(ps(x,["stop"]),["space"]),to(ps(x,["stop"]),["right"]),to(ps(C,["stop"]),["left"]),to(ps(C,["stop"]),["delete"]),to(ps(w,["stop"]),["esc"])],class:"left-[20px] absolute h-full w-[32px] block",style:Vc(l.value),role:"seperator","aria-controls":"map-container","data-cy":"sliderElement"},[T[1]||(T[1]=P("span",{class:"lux-slider-line"},null,-1)),T[2]||(T[2]=P("span",{class:"lux-slider-arrows"},[P("span"),P("span")],-1)),n.sliderTopLayer?(U(),ie("span",uxe,[T[0]||(T[0]=P("i",{class:"fa fa-arrow-left mr-2"},null,-1)),P("span",null,K(M(o)(n.sliderTopLayer.name)),1)])):Le("",!0)],44,lxe))}}),hxe=at({__name:"slider-comparator",setup(n){const e=_w(),t=Mk(),i=Kn().olMap,r=Ue(null),{sliderActive:o,sliderRatio:s,sliderTopLayer:l}=It(e),u=Ct(()=>r.value?.sliderElement?.offsetWidth||0),h=Ue([0,0]),d=function(){let O=i.value?.getViewport()?.parentElement?.offsetLeft;return(O===void 0||O===0)&&(O=w?.offsetLeft),O!==void 0?O:0},m=Ct(()=>i.value&&r.value?s.value*h.value[0]-r.value?.sliderElement?.offsetWidth/2:0);let y,x,C,w;axe.bootstrap(),Pt([l,o],([O,V],[z])=>{O&&V?(O!==z&&T(),E()):T(),i.value?.render()}),Pt(m,()=>{i.value?.render()});function E(){const O=t.getLayerFromCache(l.value);h.value=i.value?.getSize(),O&&(y=O.on(ja.PRERENDER,function(V){const z=V.context,H=m.value+u.value/2,te=Vx(V,[0,0]),$=Vx(V,[H,0]),ae=Vx(V,[0,h.value[1]]),fe=Vx(V,[H,h.value[1]]);z.save(),z.beginPath(),z.moveTo(te[0],te[1]),z.lineTo(ae[0],ae[1]),z.lineTo(fe[0],fe[1]),z.lineTo($[0],$[1]),z.closePath(),z.clip()}),x=O.on(ja.POSTRENDER,function(V){V.context.restore()}),C=i?.value.on("change:size",()=>{h.value=i.value?.getSize()}))}function T(){vl([y,x,C])}function k(O){const V=i.value?.getSize(),z=(O-d())/V[0];e.setRatio(z)}function G(){e.toggleSlider()}return sr(()=>{w=i.value?.getTargetElement()?.closest(".map-wrapper")}),Ms(()=>{T()}),(O,V)=>M(l)&&M(o)?(U(),Gt(cxe,{key:0,ref_key:"splitterElement",ref:r,sliderActive:M(o),sliderRatio:M(s),sliderTopLayer:M(l),sliderOffset:m.value,containerOffset:d(),onMoveSplitBar:k,onEscSplitBar:G},null,8,["sliderActive","sliderRatio","sliderTopLayer","sliderOffset","containerOffset"])):Le("",!0)}}),dxe=at({__name:"simple-style-item",props:{styleName:{},colors:{}},setup(n){const e=n;return(t,i)=>(U(!0),ie(Mt,null,hi(e.colors,(r,o)=>(U(),ie("span",{key:`${n.styleName}-${o}`,class:"grow m-px",style:Vc(`background-color: ${r}`)},"  ",4))),128))}}),fxe={class:"text-white border-2 p-[10px] m-[10px]"},pxe={class:"text-center mb-3"},gxe=["title"],mxe={class:"text-white"},yxe=["title","onClick"],_xe={class:"flex"},vxe=at({__name:"simple-style-selector",setup(n){const{t:e}=St(),t=Mu(),i=Mf(),{bgStyle:r}=It(t),o=Zh().simple_styles.road,s=Ue(o);Pt(r,u=>s.value=i.checkSelection(u||[],o),{immediate:!0});function l(u){t.setSimpleStyle(u)}return(u,h)=>(U(),ie("div",fxe,[P("h5",pxe,K(M(e)("Slectionner un set de couleurs",{ns:"client"})),1),(U(!0),ie(Mt,null,hi(s.value,d=>(U(),ie("div",{key:d.unlocalized_label,title:M(e)(d.unlocalized_label,{ns:"client"}),class:Rn(`${d.selected?"border-dotted":"border-hidden"} border-2 p-px`)},[P("span",mxe,K(M(e)(d.unlocalized_label,{ns:"client"}))+" : ",1),P("button",{title:M(e)("Select style: {{styleName}}",{ns:"app",styleName:M(e)(d.unlocalized_label)}),onClick:m=>l(d),class:"w-full"},[P("span",_xe,[mt(dxe,{colors:d.colors,"style-name":d.unlocalized_label},null,8,["colors","style-name"])])],8,yxe)],10,gxe))),128))]))}});function bxe(n){const e=xxe(n);return!e||!e.medium_style_class?[]:Zh().medium_default_styles[e.medium_style_class]}function xxe(n){return Zh().bg_layers.find(e=>e.id==n?.id)}const Ixe={class:"flex w-full items-center"},Cxe={for:"colorId",class:"w-40 m-0 font-medium"},wxe={class:"grow"},Axe=["value"],Sxe=["checked","aria-label"],Exe=at({__name:"medium-style-item",props:{style:{},colorEditable:{type:Boolean}},emits:["changeStyle"],setup(n,{emit:e}){const{t}=St(),i=n,r=e;function o(l){if(l.target){const u={...i.style,color:l.target.value};r("changeStyle",u)}}function s(l){if(l){const u={...i.style,visible:l.target.checked};r("changeStyle",u)}}return(l,u)=>(U(),ie("div",Ixe,[P("label",Cxe,K(M(t)(n.style.label)),1),P("div",wxe,[n.colorEditable&&i.style.color?(U(),ie("input",{key:0,id:"colorId",type:"color",class:"w-11 h-5 py-[1px] px-[2px]",value:i.style.color,onInput:o},null,40,Axe)):Le("",!0)]),P("input",{type:"checkbox",class:"flex-none mr-3",checked:i.style.visible,onChange:s,"aria-label":M(t)("Show or hide {{thematicName}}",{ns:"app",thematicName:i.style.label})},null,40,Sxe)]))}}),Txe={class:"text-white border-2 p-[10px] m-[10px]"},Rxe={class:"text-center mb-3"},Mxe=at({__name:"medium-style-selector",props:{layer:{}},setup(n){const e=["basemap_2015_global"],t=Mu(),{bgStyle:i}=It(t),{t:r}=St(),o=n,s=Ct(()=>e.includes(o.layer.name)),l=Ct(()=>i.value||bxe(o.layer));function u(h,d){i.value=l.value.map((m,y)=>y===h?d:m),t.disableExpertStyle()}return(h,d)=>(U(),ie("div",Txe,[P("h5",Rxe,K(s.value?M(r)("Slectionner une couleur par couche"):M(r)("Afficher une catgorie par couche")),1),(U(!0),ie(Mt,null,hi(l.value,(m,y)=>(U(),Gt(Exe,{key:m.label,style:Vc(m),onChangeStyle:x=>u(y,x),colorEditable:s.value},null,8,["style","onChangeStyle","colorEditable"]))),128))]))}});var ZI={exports:{}},kxe=ZI.exports,l3;function Lxe(){return l3||(l3=1,(function(n,e){(function(t,i){i()})(kxe,function(){function t(h,d){return typeof d>"u"?d={autoBom:!1}:typeof d!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}function i(h,d,m){var y=new XMLHttpRequest;y.open("GET",h),y.responseType="blob",y.onload=function(){u(y.response,d,m)},y.onerror=function(){console.error("could not download file")},y.send()}function r(h){var d=new XMLHttpRequest;d.open("HEAD",h,!1);try{d.send()}catch{}return 200<=d.status&&299>=d.status}function o(h){try{h.dispatchEvent(new MouseEvent("click"))}catch{var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(d)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Jd=="object"&&Jd.global===Jd?Jd:void 0,l=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(h,d,m){var y=s.URL||s.webkitURL,x=document.createElement("a");d=d||h.name||"download",x.download=d,x.rel="noopener",typeof h=="string"?(x.href=h,x.origin===location.origin?o(x):r(x.href)?i(h,d,m):o(x,x.target="_blank")):(x.href=y.createObjectURL(h),setTimeout(function(){y.revokeObjectURL(x.href)},4e4),setTimeout(function(){o(x)},0))}:"msSaveOrOpenBlob"in navigator?function(h,d,m){if(d=d||h.name||"download",typeof h!="string")navigator.msSaveOrOpenBlob(t(h,m),d);else if(r(h))i(h,d,m);else{var y=document.createElement("a");y.href=h,y.target="_blank",setTimeout(function(){o(y)})}}:function(h,d,m,y){if(y=y||open("","_blank"),y&&(y.document.title=y.document.body.innerText="downloading..."),typeof h=="string")return i(h,d,m);var x=h.type==="application/octet-stream",C=/constructor/i.test(s.HTMLElement)||s.safari,w=/CriOS\/[\d]+/.test(navigator.userAgent);if((w||x&&C||l)&&typeof FileReader<"u"){var E=new FileReader;E.onloadend=function(){var G=E.result;G=w?G:G.replace(/^data:[^;]*;/,"data:attachment/file;"),y?y.location.href=G:location=G,y=null},E.readAsDataURL(h)}else{var T=s.URL||s.webkitURL,k=T.createObjectURL(h);y?y.location=k:location.href=k,y=null,setTimeout(function(){T.revokeObjectURL(k)},4e4)}});s.saveAs=u.saveAs=u,n.exports=u})})(ZI)),ZI.exports}var _z=Lxe();const Pxe={class:"text-white border-2 p-[10px] m-[10px] flex flex-col overflow-hidden"},Gxe={class:"text-center mb-3"},Fxe={class:"flex flex-row justify-center"},Oxe={class:"absolute top-[70px] w-full text-center text-base leading-3 font-medium text-white"},Nxe={class:"text-white border-2 relative h-[100px] w-[85px] mx-[10px] my-0 mb-[15px] text-sm hover:bg-secondary"},Dxe={class:"'block z-[5] w-full h-full cursor-pointer after:absolute after:pt-[15px] after:px-[15px] after:w-full after:text-center after:content-upload",for:"uploadMvtStyle"},Vxe={class:"absolute top-[70px] w-full text-center text-base leading-3 font-medium"},Bxe=["href"],Zxe=at({__name:"expert-style-selector",setup(n){const e=Ui(),t=Mu(),i=Mf(),{appliedStyle:r}=It(t),{t:o}=St();function s(){const h=r.value,d=JSON.stringify(h),m=new Blob([d],{type:"text/plain;charset=utf-8"});_z.saveAs(m,"styles.json")}function l(h){const d=h.target.files;if(d?.length!==1)return;const m=d[0];m.type==="application/json"&&(m.text().then(y=>{t.enableExpertStyle(),r.value=JSON.parse(y)}),h.target.value="")}function u(){return t.styleSerial===null?i.getDefaultMapBoxStyleUrl(i.getVectorId(e.bgLayer)):`${Z0.mvtStylesGetUrl}?id=${t.styleSerial}`}return(h,d)=>(U(),ie("div",Pxe,[P("h5",Gxe,K(M(o)("Lancer diteur externe ou importer json")),1),P("div",Fxe,[P("a",{href:"#",class:"text-white border-2 relative h-[100px] w-[85px] mx-[10px] my-0 mb-[15px] z-5 text-sm after:absolute after:left-[20px] after:top-[10px] after:z-4 after:w-[3.6em] after:text-center after:content-download hover:bg-secondary",onClick:d[0]||(d[0]=m=>s())},[P("span",Oxe,K(M(o)("Download style")),1)]),P("div",Nxe,[P("label",Dxe,[P("span",Vxe,K(M(o)("Upload style")),1)]),P("input",{class:"invisible",type:"file",name:"uploadMvtStyle",id:"uploadMvtStyle",onChange:l},null,32)])]),P("a",{href:`https://maputnik.github.io/editor/?style=${u()}`,target:"_blank",class:"lux-btn text-center"},K(M(o)("Open Maputnik editor")),9,Bxe)]))}}),Wxe={key:0,class:"lux","data-cy":"styleSelector"},zxe={key:0,class:"mb-px"},Uxe={key:1,class:"mb-px"},Xxe={key:2,class:"mb-px"},Yxe=at({__name:"style-selector",setup(n){const{t:e}=St(),t=Ui(),i=Jn(),r=Mu(),{bgStyle:o,isExpertStyleActive:s}=It(r),{bgLayer:l}=It(t),{styleEditorOpenedSection:u}=It(i),h=Mf(),d=Ct(()=>h.getStyleCapabilitiesFromLayer(l.value)),m=Ct(()=>d.value.styleEditors);Pt(l,w=>{h.isLayerStyleEditable(w)?y():i.closeStyleEditorPanel()}),sr(()=>{y()});function y(){(!u.value||!m.value.includes(u.value))&&(u.value=m.value[0])}function x(){r.setStyle(null)}function C(w){u.value=u.value===w?void 0:w}return(w,E)=>d.value.isEditable?(U(),ie("div",Wxe,[m.value.includes(M(gl).simpleStyle)?(U(),ie("div",zxe,[mt(GI,{title:M(e)("Simple"),expanded:M(u)===M(gl).simpleStyle,onTogglePanel:E[0]||(E[0]=()=>C(M(gl).simpleStyle))},{default:Wt(()=>[mt(vxe)]),_:1},8,["title","expanded"])])):Le("",!0),m.value.includes(M(gl).mediumStyle)?(U(),ie("div",Uxe,[mt(GI,{title:M(e)("Medium"),expanded:M(u)===M(gl).mediumStyle,onTogglePanel:E[1]||(E[1]=()=>C(M(gl).mediumStyle))},{default:Wt(()=>[M(l)?(U(),Gt(Mxe,{key:0,layer:M(l)},null,8,["layer"])):Le("",!0)]),_:1},8,["title","expanded"])])):Le("",!0),m.value.includes(M(gl).advancedStyle)?(U(),ie("div",Xxe,[mt(GI,{title:M(e)("Expert (style.json)"),expanded:M(u)===M(gl).advancedStyle,onTogglePanel:E[2]||(E[2]=()=>C(M(gl).advancedStyle))},{default:Wt(()=>[M(l)?(U(),Gt(Zxe,{key:0,layer:M(l)},null,8,["layer"])):Le("",!0)]),_:1},8,["title","expanded"])])):Le("",!0),M(o)||M(s)?(U(),ie("button",{key:3,onClick:x,class:"lux-btn my-2"},K(M(e)("Rinitialiser style",{ns:"client"})),1)):Le("",!0)])):Le("",!0)}}),Hxe=at({__name:"style-panel",setup(n){const{t:e}=St(),t=Jn();return(i,r)=>(U(),Gt(Lf,{"data-cy-value":"stylePanel","close-fn":M(t).closeStyleEditorPanel},{header:Wt(()=>[P("h1",null,K(M(e)("Vector tiles editor",{ns:"client"})),1)]),content:Wt(()=>[mt(Yxe)]),_:1},8,["close-fn"]))}});class Kxe{bootstrap(){this.restore();let e;e=Rs(()=>{this.persist(),e&&e()})}persist(){this.persistLayersOpen()}persistLayersOpen(){const e=Jn(),{layersOpen:t}=It(e);Pt(t,(i,r)=>{r!==i&&Dn.setValue(WC,i)},{immediate:!0})}restore(){this.restoreLayersOpen(),this.restoreEmbeddedMode(),this.restoreIsAppMode()}restoreEmbeddedMode(){const e=Dn.getValue(Doe),t=e!==null&&e!=="false",{embedded:i}=It(Jn());i.value=t}restoreLayersOpen(){const e=Dn.getValue(WC)!=="false",{setLayersOpen:t}=Jn();t(e)}restoreIsAppMode(){const{setIsApp:e}=Jn(),t=Dn.getValue(xf)==="android"||Dn.getValue(xf)==="ios"||Dn.getValue(yg)==="yes";e(t)}}const jxe=new Kxe,Qx="-",dE=",",u3="--";class $xe{layerTimesToStrings(e){return e?e.split(u3):[]}layerIdsToLayers(e){const t=Tl(),i=la();return(e?e.split(Qx):[]).map(o=>{const s=Jv.isRemoteLayer(o)?$1e(o):t.findById(parseInt(o,10));return s?i.initLayer(s):void 0}).reverse()}layerNamesToLayersV2(e){const t=Tl(),i=la();return(e?e.split(dE):[]).map(o=>{const s=t.findByName(o);return s?i.initLayer(s):void 0}).reverse()}layersOpacitiesToNumbers(e,t=Qx){return Woe(e,t).reverse()}layersOpacitiesToNumbersV2=e=>this.layersOpacitiesToNumbers(e,dE);layersVisibilitiesToBooleansV2(e){return zoe(e,dE)}layersToLayerIds(e){return e?.map(t=>t.id).reverse().join(Qx)||""}layersToLayerOpacities(e){return e?.map(t=>t.opacity??1).reverse().join(Qx)||""}layersToLayerTimes(e){return e?.map(t=>la().getLayerCurrentTime(t)??"").reverse().join(u3)||""}bgLayerNameToBgLayer(e){const t=Tl();return e?t.findBgLayerByName(e):null}bgLayerToBgLayerName(e){return e?.name||YC.name}}const ml=new $xe,Jxe="basemap_2015_global",qxe="orthogr_2013_global",Qxe={webbasemap:"basemap_2015_global","pixelmaps-color":"topogr_global","pixelmaps-gray":"topo_bw_jpeg",streets:"streets_jpeg",voidlayer:"blank"};class eIe{bootstrap(){const e=Zr();let t;t=Rs(()=>{e.bgLayers.length>0&&(this.restore(),this.persist(),t&&t())})}persist(){const e=Ui(),{bgLayer:t}=It(e);Pt(t,(i,r)=>{r!==i&&Dn.setValue(FO,i,ml.bgLayerToBgLayerName)},{immediate:!0})}restore(){const{setMapBackground:e}=pA(),t=this.getBgLayerFromStorage();e(t)}getBgLayerFromStorage(){const e=Dn.getInitialVersion(),t=Dn.getValue(FO);return t?e===2?this.getBgLayerFromStorageV2(t):ml.bgLayerNameToBgLayer(t):ml.bgLayerNameToBgLayer(Jxe)}getBgLayerFromStorageV2(e){const t=Dn.getValue(ZB,Op);let i="";return e?i=Qxe[e]:t===0&&(i=qxe),ml.bgLayerNameToBgLayer(i)}}const tIe=new eIe;class nIe{bootstrap(){const e=Zr();let t;t=Rs(()=>{e.themes&&(this.restore(),this.persist(),t&&t())})}persist(){const e=Ui(),{layers:t}=It(e);Pt(t,(i,r)=>{r!==i&&(Dn.setValue(GO,i,ml.layersToLayerIds),Dn.setValue(OO,i,ml.layersToLayerOpacities),Dn.setValue(NO,i,ml.layersToLayerTimes))},{immediate:!0})}restore(){const e=Dn.getInitialVersion(),t=Ui(),i=Dn.getValue(GO,e===2?ml.layerNamesToLayersV2:ml.layerIdsToLayers);this.restoreLayersOpacities(i,e),this.restoreLayersTimes(i),e===2&&(Dn.removeItem(ZB),Dn.removeItem(Boe),Dn.removeItem(BO),Dn.removeItem(ZO)),t.addLayers(...i?.filter(r=>r)||[])}restoreLayersOpacities(e,t){const i=t===2?this.getOpacitiesFromStorageV2():this.getOpacitiesFromStorage();i.length&&e?.forEach((r,o)=>r&&(r.opacity=i[o]??1))}restoreLayersTimes(e){const t=Dn.getValue(NO,ml.layerTimesToStrings);t.length&&e?.forEach((i,r)=>i&&t[r]&&this.restoreLayerTime(i,t[r]))}restoreLayerTime(e,t){const i=t.split("/");e.currentTimeMinValue=i[0],e.currentTimeMaxValue=i[1]}getOpacitiesFromStorage(){return Dn.getValue(OO,ml.layersOpacitiesToNumbers)}getOpacitiesFromStorageV2(){const e=Dn.getValue(BO,ml.layersOpacitiesToNumbersV2),t=Dn.getValue(ZO,ml.layersVisibilitiesToBooleansV2);return e.map((i,r)=>t[r]?i:0).reverse()}}const iIe=new nIe;class rIe{bootstrap(){this.restore();let e;e=Rs(()=>{this.persist(),e&&e()})}persist(){const e=Jn(),{myMap:t}=It(e);Pt(t,(i,r)=>{r?.uuid!==i?.uuid&&(i?Dn.setValue(PS,i.uuid):Dn.removeItem(PS))},{immediate:!0})}restore(){const e=Dn.getValue(PS);e&&Rf().openMyMap(e)}}const sIe=new rIe;class oIe{themeToThemeName(e){return e?.name||""}}const aIe=new oIe;class lIe{bootstrap(){this.restore();let e;e=Rs(()=>{this.persist(),e&&e()})}persist(){const e=Zr();Pt(()=>e.theme,(t,i)=>{i!==t&&t&&Dn.setValue(zC,t,aIe.themeToThemeName)},{immediate:!0})}restore(){const e=Dn.getValue(zC);if(e){const{setTheme:t}=Zr();t(e)}}}const uIe=new lIe;X4();class cIe extends KW{geojsonFormatCustom=new Qa;encodeVectorStylePoint(e,t,i){let r;i instanceof ms?r=this.encodeVectorStylePointStyleCircle(e,i):i instanceof Nu?r=this.encodeVectorStylePointStyleIcon(e,i):i instanceof bl&&(r=this.encodeVectorStylePointRegularShape(e,i)),r&&(this.customizer_.point(this.layerState_,e,r,i),t.push(r))}encodeVectorStylePointRegularShape(e,t){const i={type:"point"},r=t.getPoints(),o=t.getAngle();r===4&&o!==0?i.graphicName="square":r===4&&o===0?i.graphicName="cross":r===3?i.graphicName="triangle":r===5?i.graphicName="star":r===8&&(i.graphicName="cross");const s=t.getOpacity();s!==null&&(i.graphicOpacity=s);const l=t.getSize();if(l!==null){let m=t.getScale();Array.isArray(m)&&(m=(m[0]+m[1])/2),isNaN(m)&&(m=1),i.graphicWidth=l[1]*m}let u=t.getRotation();isNaN(u)&&(u=0),i.rotation=jh(u);const h=t.getFill(),d=t.getStroke();return h!==null&&this.encodeVectorStyleFill(e,i,h),d!==null&&this.encodeVectorStyleStroke(e,i,d),i!==void 0&&i.graphicName==="cross"&&(i.strokeWidth=0,i.fillOpacity=1),i}encodeVectorStylePointStyleIcon(e,t){const i=t.getSrc();if(i===void 0)return;const r={type:"point",externalGraphic:i},o=t.getOpacity();o!==null&&(r.graphicOpacity=o);const s=t.getSize();if(s!==null){let u=t.getScale();Array.isArray(u)&&(u=(u[0]+u[1])/2),isNaN(u)&&(u=1);const h=s[0]*u,d=s[1]*u;r.graphicWidth=d,this.addGraphicOffset_(r,t,h,d)}let l=t.getRotation();return isNaN(l)&&(l=0),r.rotation=jh(l),r.labelAlign&&(r.labelAlign="lm"),r.externalGraphic&&(r.graphicFormat="image/png",r.externalGraphic.indexOf("scale=")>0?delete r.graphicWidth:r.externalGraphic.indexOf("getarrow")>0&&(r.graphicWidth=10)),r}}const c3=127;class hIe extends Lye{async encodeLayerState(e,t,i){let r;const o=e.layer;if(o instanceof SM)r=this.encodeXYZLayer_(o.getXYZ());else if(o instanceof gs){r=new cIe(e,i).encodeVectorLayer(t);const s=e.layer.get("renderAsSvg");s!==void 0&&(r.renderAsSvg=s)}else r=await super.encodeLayerState(e,t,i);return Array.isArray(r)?r=r.map(s=>this.legacyMFPAppendCustomParams(o,s)):r&&(r=this.legacyMFPAppendCustomParams(o,r)),r}legacyMFPAppendCustomParams(e,t){return t?{...t,...e instanceof gs?{}:{customParams:{TRANSPARENT:!0,MAP_RESOLUTION:c3}}}:null}encodeXYZLayer_(e){const t=e.indexOf("/{z}/{x}/{y}"),i=e.lastIndexOf(".");if(t===-1||i===-1)return;const r=e.substring(0,t),o=e.substring(i+1),s=r.substring(r.lastIndexOf("/styles/")+8);return s==="topomap"||s==="roadmap"||s==="topomap_gray"?{baseURL:"https://wms.geoportail.lu/vectortiles_wms_4_print/service",imageFormat:"image/"+o,layers:[s],customParams:{TRANSPARENT:!0,MAP_RESOLUTION:c3},type:"wms",opacity:1,version:"1.1.1",useNativeAngle:!0}:{baseURL:r,type:"OSM",imageExtension:o}}}const x0="https://migration.geoportail.lu",dIe="https://migration.geoportail.lu/legends/get_html",fIe="https://migration.geoportail.lu/short/create",h3="https://migration.geoportail.lu/printproxy",pIe="https://migration.geoportail.lu/qr",gIe=[1500,2500,5e3,1e4,15e3,2e4,25e3,5e4,8e4,1e5,125e3,2e5,25e4,4e5],fE=[[715,395],[470,650],[1065,640],[715,975],[1558,985],[1064,1475],[2255,1482],[1558,2175],[3241,2173],[2254,3155]],pE=["A4 landscape","A4 portrait","A3 landscape","A3 portrait","A2 landscape","A2 portrait","A1 landscape","A1 portrait","A0 landscape","A0 portrait"],d3=127,mIe=(n,e,t)=>Math.round(e/lR/aR*n/t);class yIe{getScales(){return Zr().theme?.metadata?.print_scales?.map(t=>+t).sort((t,i)=>t-i)||gIe}getLayouts(){return pE}async print(e,t){const i=`${h3}/report.${t.toLocaleLowerCase()||"pdf"}`,o=await(await fetch(i,{method:"POST",body:JSON.stringify(e)})).json(),s=x0+o.statusURL.replace(/print/,"printproxy");return{downloadURL:x0+o.downloadURL.replace(/print/,"printproxy"),ref:o.ref,statusURL:s}}cancel(e){return fetch(`${h3}/cancel/${e}`,{method:"DELETE"})}async getJobStatus(e){const t=await(await fetch(e)).json();return t.downloadURL&&(t.downloadURL=x0+t.downloadURL.replace(/print/,"printproxy")),t}async getSpec(e,t){const i=new hIe(x0),r=new mye,o=await this.getShortLink(),s=await i.encodeMap({map:t,scale:e.scale,printResolution:t.getView().getResolution(),dpi:d3,customizer:r});s.layers=s.layers.filter(d=>d!==null);const l=await this.getLegends(t.getLayers().getArray(),e.lang),u=[];return vz(t.getLayerGroup(),u,e.framestate),{attributes:{map:s,disclaimer:e.disclaimer,scaleTitle:e.scaleTitle,appTitle:e.appTitle,scale:e.scale,name:e.title,url:o,qrimage:`${pIe}?url=${o}`,lang:e.lang,legend:e.legend?l:null,scalebar:{geodetic:!0},dataOwner:[...new Set(u)].join(" "),dateText:e.dateText,queryResults:e.queryResults},format:e.format.toLowerCase(),layout:e.layout}}getLayersForPrint(e){return e.getLayers().getArray().filter(i=>i.get($T)!==_W)}getSize(e){return fE[pE.indexOf(e)]}getNearestScale(e,t,i){const r=this.getScales(),o=fE[pE.indexOf(t)][0]||fE[0][0];return r.reverse().find(s=>mIe(s,o,i)<e)||r[0]}async getShortLink(){const t={url:x0+KB.getRelativeUrl()};return(await(await ks(fIe,t,"POST")).json()).short_url}async getLegends(e,t){const i=[];let r=d3;const o=dIe;return e.reverse().forEach(s=>{const l=s.get("metadata"),u=l?.max_dpi;if(u!==void 0){const d=parseInt(u,10);r>d&&(r=d)}const h=l?.legend_name;if(h!==void 0)i.push({name:h});else{const d=s.get("queryable_id");if(l?.isExternalWms){const m=l?.legendUrl,y=l?.legendAccessConstraints,x=l?.legendTitle;m!==void 0&&i.push({name:null,legendUrl:m,accessConstraints:y,legendTitle:x})}else if(d!==void 0){const m=new URLSearchParams({lang:t,id:d,dpi:r.toString(),legend_title:s.get("label")});i.push({name:s.get("label"),restUrl:o+"?"+m.toString(),legendTitle:s.get("label")})}}}),i}}function vz(n,e,t){if(n instanceof Sf)n.getLayers().forEach(i=>vz(i,e,t));else{const i=n.getSource()?.getAttributions(),r=n.get("metadata")?.attribution,o=[];i&&o.push(...i(t)),r&&o.push(r),e.push(...o)}}const sf=new yIe,_Ie=1e3;function vIe(n){return typeof n=="number"&&n>=400&&n<=500||n==="error"}function bIe(){const n=Ue(null),e=Ue(null),t=Ue(!1),i=Ue(!1);let r=null;const o=async u=>{try{const{status:h,done:d,downloadURL:m}=await sf.getJobStatus(u);n.value=h,vIe(h)&&(t.value=!0,l()),h==="finished"&&d&&m&&(e.value=m,l())}catch{l()}},s=(u,h=_Ie)=>{t.value=!1,l(),i.value=!0,r=window.setInterval(()=>o(u),h)},l=()=>{r!==null&&(clearInterval(r),r=null),n.value=null,i.value=!1,t.value=!1};return Ms(()=>l()),{jobStatus:n,url:e,startPolling:s,clearPolling:l,error:t,loading:i}}function xIe(){const{t:n}=St(),{featureInfoPrintableRef:e,locationInfoPrintableRef:t}=It(Vk()),{locationInfoCoords:i}=It(ag()),{startPolling:r,clearPolling:o,url:s,error:l,loading:u}=bIe(),h=Kn().getOlMap(),d=Ue(null);async function m(T){const k=y(),G={disclaimer:n(`www.geoportail.lu est un portail d'accs aux informations golocalises, donnes et services qui sont mis  disposition par les administrations publiques luxembourgeoises. Responsabilit: Malgr la grande attention quelles portent  la justesse des informations diffuses sur ce site, les autorits ne peuvent endosser aucune responsabilit quant  la fidlit,  lexactitude,  lactualit,  la fiabilit et  lintgralit de ces informations. Information dpourvue de foi publique. 
Droits d'auteur: Administration du Cadastre et de la Topographie. http://g-o.lu/copyright`),scaleTitle:n("Echelle approximative 1:"),appTitle:n("Le goportail national du Grand-Duch du Luxembourg",{ns:"app"}),dateText:n("Date d'impression:"),queryResults:k,...T},O=await sf.getSpec(G,h);try{const V=await sf.print(O,T.format);d.value=V.ref,r(V.statusURL)}catch{d.value=null,l.value=!0,o()}}function y(){const T=C(),k=w();return`${T??""}${k??""}`||void 0}async function x(){d.value&&(await sf.cancel(d.value),d.value=null,o())}function C(){if(!(!i.value||!t.value))return E(t.value)}function w(){if(!(i.value||!e.value))return E(e.value)}function E(T){const k=T.cloneNode(!0);return k.querySelectorAll("[data-cy], [v-]").forEach(V=>{V.removeAttribute("data-cy"),V.removeAttribute("v-")}),k.querySelectorAll(".no-print").forEach(V=>V.remove()),k.innerHTML}return{print:m,abortPrint:x,url:s,error:l,loading:u}}var yR=(n=>(n.PDF="PDF",n.PNG="PNG",n))(yR||{});const IIe={"data-cy":"toolbarPrint"},CIe={class:"absolute bottom-full top-auto z-20 flex flex-col divide-gray-400 divide-solid box-content border-y border-x border-gray-400 bg-primary md:w-64 p-3 gap-3"},wIe={class:"md:w-full"},AIe=["placeholder"],SIe={class:"flex gap-1 items-center"},EIe=["id"],TIe=["for"],RIe={class:"flex gap-1 items-center secondary-button"},MIe={class:"md:w-1/2"},kIe={class:"md:w-1/2"},LIe={class:"flex gap-1 justify-end items-center"},PIe={key:0,"data-cy":"printLoading",class:"mr-4 flex gap-2 items-center"},GIe=["disabled"],FIe=["disabled"],OIe=2e3,NIe=at({__name:"toolbar-print",setup(n){const{addNotification:e}=Qr(),{t}=St(),{lang:i}=Jn(),{print:r,abortPrint:o,url:s,error:l,loading:u}=xIe(),h=Hv();let d=null;const m=Kn().getOlMap(),y=new Pye({id:"mask",opacity:0});y.setZIndex(OIe);const x=Ue(""),C=Ue(!1),w=Ct(()=>!C.value),E=Ue(""),T=Ct(()=>sf.getLayouts().map(te=>({label:t(te),value:te,ariaLabel:t("Change layout:",{ns:"app"})}))),k=te=>{E.value=te,G.value=te,y.setSize(sf.getSize(te)),m.render()},G=Ue(""),O=Ue(""),V=Ct(()=>sf.getScales().map(te=>({label:`1 : ${te.toLocaleString()}`,value:te.toString(),ariaLabel:t("Change scale:",{ns:"app"})}))),z=te=>{O.value=te,y.setScale(parseInt(te,10)),m.render()};function H(te){r({format:te,layout:E.value,scale:parseInt(O.value,10),resolution:m.getView().getResolution(),title:x.value,legend:C.value,lang:i,framestate:d})}return Pt(l,te=>{te&&e(t("An error occurred while printing"),ii.ERROR)}),Pt(s,te=>te&&window.open(te,"_blank")),sr(()=>{m.addLayer(y),y.setOpacity(.5),m.on("rendercomplete",te=>{d=te.frameState||null}),k(T.value[0].value),z(sf.getNearestScale(m.getSize()[0],E.value,m.getView().getResolution()).toString())}),Ms(()=>{m.removeLayer(y),y.setOpacity(0)}),(te,$)=>(U(),ie("div",IIe,[P("div",CIe,[P("div",wIe,[An(P("input",{class:"cursor-pointer w-full p-2 lux-input",type:"text","onUpdate:modelValue":$[0]||($[0]=ae=>x.value=ae),placeholder:M(t)("Title",{ns:"client"}),"data-cy":"printTitle"},null,8,AIe),[[Or,x.value]])]),P("div",SIe,[An(P("input",{id:M(h),class:"hover:cursor-pointer",type:"checkbox","onUpdate:modelValue":$[1]||($[1]=ae=>C.value=ae),"data-cy":"printWithLegend"},null,8,EIe),[[Hh,C.value]]),P("label",{class:"font-bold block lux-text-default hover:cursor-pointer",for:M(h)},K(M(t)("Avec lgende")),9,TIe)]),P("div",RIe,[P("div",MIe,[mt(ig,{"data-cy":"printLayouts",class:"w-full",options:T.value,modelValue:E.value,"onUpdate:modelValue":$[2]||($[2]=ae=>E.value=ae),onChange:k,direction:"up"},null,8,["options","modelValue"])]),P("div",kIe,[mt(ig,{"data-cy":"printScales",class:"w-full",options:V.value,modelValue:O.value,"onUpdate:modelValue":$[3]||($[3]=ae=>O.value=ae),onChange:z,direction:"up"},null,8,["options","modelValue"])])]),P("div",LIe,[M(u)?(U(),ie("div",PIe,[$[7]||($[7]=P("span",{class:"text-black fa-solid fa-arrows-rotate animate-spin","aria-hidden":"true"},null,-1)),P("button",{class:"btn btn-link opacity-75 text-white hover:underline hover:opacity-100",onClick:$[4]||($[4]=ae=>M(o)())},K(M(t)("Abort")),1)])):Le("",!0),P("button",{"data-cy":"printPng",class:"bg-white disabled:opacity-75 disabled:cursor-not-allowed text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5",onClick:$[5]||($[5]=ae=>H(M(yR).PNG)),disabled:M(u)||!w.value},K(M(t)("PNG")),9,GIe),P("button",{"data-cy":"printPdf",class:"bg-white disabled:opacity-75 disabled:cursor-not-allowed text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5",onClick:$[6]||($[6]=ae=>H(M(yR).PDF)),disabled:M(u)},K(M(t)("PDF")),9,FIe)])])]))}}),DIe=es(NIe,[["__scopeId","data-v-9820d18c"]]),VIe={class:"flex flex-col gap-3"},BIe={class:"md:w-full"},ZIe={for:"share-url-input",class:"block text-white text-sm font-medium mb-2"},WIe=["value","aria-label"],zIe=["value","aria-label"],UIe={class:"flex gap-1 items-center"},XIe={for:"show-long-url-checkbox",class:"font-bold block lux-text-default hover:cursor-pointer"},YIe={key:0,class:"flex gap-1 items-center"},HIe={for:"only-mymaps-checkbox",class:"font-bold block lux-text-default hover:cursor-pointer"},KIe=at({__name:"share-url",setup(n){const{t:e}=St(),t=Jn(),{myMapId:i,shareOpen:r}=It(t),o=Ue(""),s=Ue(""),l=Ue(!1),u=Ue(!1);let h=null,d="";function m(T){if(u.value&&i.value){const k=new URL(T);return k.search=`?map_id=${i.value}`,k.toString()}return T}async function y(){const T=Ql.getStrippedUrl(),k=m(T.toString());s.value=k,d=k;try{if(u.value&&i.value){const G=new URLSearchParams;G.set("url",k);const V=await(await fetch("https://migration.geoportail.lu/short/create",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:G.toString()})).json();o.value=V.short_url}else{const G=await Ql.getShortUrl(void 0);o.value=G.short_url}}catch{o.value=k}}function x(T){T.target.select()}function C(){h!==null&&clearInterval(h),h=setInterval(()=>{const T=Ql.getStrippedUrl().toString(),k=m(T);d!==k&&y()},500)}function w(){h!==null&&(clearInterval(h),h=null)}Pt(u,()=>{r.value&&y()}),Pt(r,T=>{T?(y(),C()):w()},{immediate:!0}),Ms(()=>{w()});const E=()=>!!i.value;return(T,k)=>(U(),ie("div",VIe,[P("div",BIe,[P("label",ZIe,K(M(e)("Short Url",{ns:"client"})),1),l.value?(U(),ie("input",{key:1,id:"share-url-input",type:"text",class:"w-full px-3 py-2 lux-input cursor-pointer",value:s.value,"aria-label":M(e)("Long Url",{ns:"client"}),onClick:x,readonly:"","data-cy":"shareLongUrl"},null,8,zIe)):(U(),ie("input",{key:0,id:"share-url-input",type:"text",class:"w-full px-3 py-2 lux-input cursor-pointer",value:o.value,"aria-label":M(e)("Short Url",{ns:"client"}),onClick:x,readonly:"","data-cy":"shareShortUrl"},null,8,WIe))]),P("div",UIe,[An(P("input",{id:"show-long-url-checkbox",type:"checkbox","onUpdate:modelValue":k[0]||(k[0]=G=>l.value=G),class:"hover:cursor-pointer","data-cy":"showLongUrlCheckbox"},null,512),[[Hh,l.value]]),P("label",XIe,K(M(e)("Show long url",{ns:"client"})),1)]),E()?(U(),ie("div",YIe,[An(P("input",{id:"only-mymaps-checkbox",type:"checkbox","onUpdate:modelValue":k[1]||(k[1]=G=>u.value=G),class:"hover:cursor-pointer","data-cy":"onlyMymapsCheckbox"},null,512),[[Hh,u.value]]),P("label",HIe,K(M(e)("Share only Mymaps",{ns:"client"})),1)])):Le("",!0)]))}}),jIe={class:"md:w-full"},$Ie={for:"embed-code-input",class:"block text-white text-sm font-medium mb-2"},JIe={class:"flex gap-2"},qIe=["value","aria-label"],QIe=["aria-label"],eCe={class:"flex justify-between items-center p-4 border-b"},tCe={id:"modal-title",class:"text-xl font-semibold"},nCe=["aria-label"],iCe={class:"p-4 space-y-4"},rCe={for:"iframe-size-select",class:"sr-only"},sCe=["aria-label"],oCe={value:"small"},aCe={value:"medium"},lCe={value:"large"},uCe={value:"custom"},cCe={key:0,class:"flex gap-2 items-center"},hCe={class:"border border-gray-300 overflow-auto"},dCe=["src","width","height","title"],fCe={class:"flex gap-2"},pCe={for:"iframe-code-input",class:"sr-only"},gCe=["value","aria-label"],mCe=["aria-label"],yCe=at({__name:"share-embed",setup(n){const{t:e}=St(),t=Ue(!1),i=Ue("small"),r=Ue(800),o=Ue(600),s=Ue(null),l={small:[400,300],medium:[600,450],large:[800,600],custom:[800,600]},u=Ct(()=>i.value==="custom"?r.value:l[i.value][0]),h=Ct(()=>i.value==="custom"?o.value:l[i.value][1]),d=Ct(()=>{const k=new URL(window.location.href);return k.searchParams.set("embedded","true"),k.href}),m=Ct(()=>`<iframe src="${d.value}" width="${u.value}" height="${h.value}" frameborder="0" style="border:0"></iframe>`),y=Ct(()=>`${u.value+48}px`);function x(k){k.target.select()}function C(){t.value=!0}function w(){t.value=!1}function E(){navigator.clipboard.writeText(m.value)}function T(k){if(!t.value||!s.value)return;const G=s.value.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),O=G[0],V=G[G.length-1];k.key==="Tab"?k.shiftKey&&document.activeElement===O?(k.preventDefault(),V.focus()):!k.shiftKey&&document.activeElement===V&&(k.preventDefault(),O.focus()):k.key==="Escape"&&w()}return Pt(t,k=>{k?document.addEventListener("keydown",T):document.removeEventListener("keydown",T)}),Ms(()=>{document.removeEventListener("keydown",T)}),(k,G)=>(U(),ie("div",null,[P("div",jIe,[P("label",$Ie,K(M(e)("Integrate",{ns:"client"})),1),P("div",JIe,[P("input",{id:"embed-code-input",type:"text",class:"flex-1 px-3 py-2 lux-input cursor-pointer",value:m.value,"aria-label":M(e)("Integrate",{ns:"client"}),onClick:x,readonly:"","data-cy":"embedCodeInput"},null,8,qIe),P("button",{onClick:C,class:"bg-white disabled:opacity-75 disabled:cursor-not-allowed text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5","aria-label":M(e)("Preview",{ns:"client"}),"data-cy":"previewButton"},K(M(e)("Preview",{ns:"client"})),9,QIe)])]),t.value?(U(),ie("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",onClick:ps(w,["self"]),"data-cy":"iframePreviewModal"},[P("div",{ref_key:"modalRef",ref:s,class:"bg-white rounded-lg shadow-xl mx-4 max-h-[90vh] overflow-auto",style:Vc({width:y.value,maxWidth:"90vw"})},[P("div",eCe,[P("h2",tCe,K(M(e)("Embed map",{ns:"app"})),1),P("button",{onClick:w,class:"text-gray-500 hover:text-gray-700 text-2xl leading-none","aria-label":M(e)("Close",{ns:"app"}),"data-cy":"closePreviewButton"},"  ",8,nCe)]),P("div",iCe,[P("div",null,[P("label",rCe,K(M(e)("Select iframe size",{ns:"client"})),1),An(P("select",{id:"iframe-size-select","onUpdate:modelValue":G[0]||(G[0]=O=>i.value=O),class:"w-full px-3 py-2 border border-gray-300 rounded","aria-label":M(e)("Select iframe size",{ns:"client"}),"data-cy":"iframeSizeSelect"},[P("option",oCe,K(M(e)("small",{ns:"app"})),1),P("option",aCe,K(M(e)("medium",{ns:"app"})),1),P("option",lCe,K(M(e)("large",{ns:"app"})),1),P("option",uCe,K(M(e)("custom",{ns:"app"})),1)],8,sCe),[[jN,i.value]])]),i.value==="custom"?(U(),ie("div",cCe,[G[3]||(G[3]=P("label",{for:"custom-width-input",class:"sr-only"},"Width",-1)),An(P("input",{id:"custom-width-input",type:"number","onUpdate:modelValue":G[1]||(G[1]=O=>r.value=O),min:"0",class:"w-24 px-3 py-2 border border-gray-300 rounded","aria-label":"Custom width","data-cy":"customWidthInput"},null,512),[[Or,r.value,void 0,{number:!0}]]),G[4]||(G[4]=P("span",{"aria-hidden":"true"},"X",-1)),G[5]||(G[5]=P("label",{for:"custom-height-input",class:"sr-only"},"Height",-1)),An(P("input",{id:"custom-height-input",type:"number","onUpdate:modelValue":G[2]||(G[2]=O=>o.value=O),min:"0",class:"w-24 px-3 py-2 border border-gray-300 rounded","aria-label":"Custom height","data-cy":"customHeightInput"},null,512),[[Or,o.value,void 0,{number:!0}]])])):Le("",!0),P("div",hCe,[P("iframe",{src:d.value,width:u.value,height:h.value,frameborder:"0",style:{border:"0"},title:M(e)("Embed map preview",{ns:"client"}),"data-cy":"iframePreview"},null,8,dCe)]),P("div",fCe,[P("label",pCe,K(M(e)("Iframe code",{ns:"client"})),1),P("input",{id:"iframe-code-input",type:"text",value:m.value,onClick:x,readonly:"",class:"flex-1 px-3 py-2 border border-gray-300 rounded cursor-pointer","aria-label":M(e)("Iframe code",{ns:"client"}),"data-cy":"iframeCodeInput"},null,8,gCe),P("button",{onClick:E,class:"bg-white disabled:opacity-75 disabled:cursor-not-allowed text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5","aria-label":M(e)("Copy",{ns:"client"}),"data-cy":"copyIframeCodeButton"},K(M(e)("Copy",{ns:"client"})),9,mCe)])])],4)])):Le("",!0)]))}}),_Ce={"data-cy":"sharePanel"},vCe={class:"absolute bottom-full top-auto z-20 flex flex-col divide-gray-400 divide-solid box-content border-y border-x border-gray-400 bg-primary md:w-80 p-3 gap-3"},bCe=at({__name:"share-panel",setup(n){return(e,t)=>(U(),ie("div",_Ce,[P("div",vCe,[mt(KIe),mt(yCe)])]))}}),xCe={class:"flex flex-col w-12 justify-between bg-white z-5 shrink-0 sm:flex-row sm:w-full sm:h-14 sm:shadow-footer"},ICe={class:"flex flex-col w-full sm:w-80 sm:flex-row justify-start text-primary divide-y sm:divide-y-0 sm:divide-x divide-gray-400 divide-solid box-content border-y sm:border-y-0 border-x border-gray-400"},CCe={"data-cy":"layersOpenClose"},wCe={"data-cy":"mymapsOpenClose"},ACe={key:0,"data-cy":"infoOpenClose"},SCe={key:1,"data-cy":"legendsOpenClose"},ECe={key:2},TCe={key:0,class:"hidden sm:block sm:flex-grow"},RCe={key:1,class:"hidden sm:block sm:flex-grow"},MCe={key:2,class:"w-[466px] hidden sm:flex flex-row justify-end text-gray-500 whitespace-nowrap"},kCe=["aria-pressed","aria-label"],LCe=at({__name:"footer-bar",setup(n){const{t:e,i18next:t}=St(),i=Jn(),r=zr(),o="https://geocatalogue.geoportail.lu/geonetwork/srv",{setLayersOpen:s,togglePrintToolbarOpen:l,toggleDrawToolbarOpen:u,toggleMyMapsOpen:h,toggleLegendsOpen:d,toggleInfoOpen:m,toggleShareOpen:y,toggleFeedbackOpen:x,toggleRoutingOpen:C}=i,{layersOpen:w,legendsOpen:E,drawToolbarOpen:T,measureToolbarOpen:k,elevationProfileToolbarOpen:G,styleEditorOpen:O,myMapLayersChanged:V,myMapsOpen:z,infoOpen:H,shareOpen:te,lidarOpen:$,themeGridOpen:ae,printToolbarOpen:fe,feedbackOpen:Y,routingPanelOpen:de,isOffLine:D}=It(i),{setEditActiveState:oe}=r;function ue(){const j=!w.value;s(j),j&&(O.value=!1,z.value=!1,H.value=!1,$.value=!1,de.value=!1),ae.value=!1}Pt(T,j=>{j?(k.value=!1,G.value=!1,fe.value=!1,te.value=!1,$.value=!1,de.value=!1):oe(void 0)}),Pt(k,j=>{j&&(T.value=!1,G.value=!1,fe.value=!1,te.value=!1,$.value=!1,de.value=!1)}),Pt(G,j=>{j&&(T.value=!1,k.value=!1,fe.value=!1,te.value=!1,$.value=!1,de.value=!1)}),Pt(fe,j=>{j&&(T.value=!1,k.value=!1,G.value=!1,te.value=!1,$.value=!1,de.value=!1)}),Pt(te,j=>{j&&(T.value=!1,k.value=!1,G.value=!1,fe.value=!1,$.value=!1,de.value=!1)}),Pt($,j=>{j&&(w.value=E.value=ae.value=fe.value=T.value=k.value=G.value=te.value=O.value=z.value=H.value=de.value=!1)});const ge=rg(),{displayStarOnMobile:Ne}=It(ge),{setDisplayStarOnMobile:Ee}=ge;function se(){m(),Ee(!1)}function q(){const j=!de.value;C(j),j&&(w.value=!1,E.value=!1,z.value=!1,H.value=!1,O.value=!1,$.value=!1,Y.value=!1)}return(j,ze)=>(U(),ie("footer",xCe,[P("ul",ICe,[P("li",CCe,[mt(xh,{label:M(e)("layers",{ns:"client"}),"aria-label":M(w)?M(e)("Close layers panel"):M(e)("Open layers panel to browse and add map layers"),icon:"layers",active:M(w),onClick:ue},null,8,["label","aria-label","active"])]),P("li",wCe,[mt(xh,{label:M(e)("my_maps",{ns:"client"})+(M(V)?"(*)":""),"aria-label":M(z)?M(e)("Close my maps panel"):M(e)("Open my maps panel to access saved maps"),icon:"mymaps",active:M(z),onClick:ze[0]||(ze[0]=()=>M(h)())},null,8,["label","aria-label","active"])]),M(D)?Le("",!0):(U(),ie("li",ACe,[mt(xh,{label:`${M(e)("Infos",{ns:"client"})}${M(Ne)?"(*)":""}`,"aria-label":M(H)?M(e)("Close feature info panel"):M(e)("Open feature info panel to view map details"),icon:"infos",active:M(H),onClick:se},null,8,["label","aria-label","active"])])),M(D)?Le("",!0):(U(),ie("li",SCe,[mt(xh,{label:M(e)("Legends",{ns:"client"}),"aria-label":M(E)?M(e)("Close legends panel"):M(e)("Open legends panel"),icon:"legends",active:M(E),onClick:ze[1]||(ze[1]=()=>M(d)())},null,8,["label","aria-label","active"])])),M(D)?Le("",!0):(U(),ie("li",ECe,[mt(xh,{label:M(e)("Routing",{ns:"client"}),"aria-label":M(de)?M(e)("Close routing panel"):M(e)("Open routing panel to calculate routes"),icon:"routing",active:M(de),onClick:q,"data-cy":"routingOpenClose"},null,8,["label","aria-label","active"])]))]),M(D)?(U(),ie("div",TCe)):Le("",!0),P("div",{class:Rn(["relative flex flex-col w-12 sm:flex-row justify-start text-primary divide-y sm:divide-y-0 sm:divide-x divide-gray-400 divide-solid box-content border-y sm:border-y-0 border-x border-gray-400",M(D)?"sm:w-16":"sm:w-64"])},[M(T)?(U(),Gt(Ble,{key:0})):Le("",!0),M(fe)?(U(),Gt(DIe,{key:1})):Le("",!0),M(te)?(U(),Gt(bCe,{key:2})):Le("",!0),M(G)?(U(),Gt(gye,{key:3})):Le("",!0),mt(xh,{label:M(e)("Dessin",{ns:"client"}),"aria-label":M(T)?M(e)("Close drawing toolbar"):M(e)("Open drawing toolbar to draw on the map"),icon:"draw",active:M(T),onClick:ze[2]||(ze[2]=()=>M(u)()),"data-cy":"drawButton"},null,8,["label","aria-label","active"]),M(D)?Le("",!0):(U(),ie(Mt,{key:4},[M(k)?(U(),Gt($le,{key:0})):Le("",!0),mt(xh,{label:M(e)("Mesurer",{ns:"client"}),"aria-label":M(k)?M(e)("Close measure toolbar"):M(e)("Open measure toolbar to measure distances and areas"),active:M(k),icon:"measure",onClick:ze[3]||(ze[3]=()=>k.value=!M(k))},null,8,["label","aria-label","active"])],64)),M(D)?Le("",!0):(U(),Gt(xh,{key:5,class:"hidden sm:block",label:M(e)("Imprimer",{ns:"client"}),"aria-label":M(fe)?M(e)("Close print toolbar"):M(e)("Open print toolbar to create a PDF of the map"),active:M(fe),onClick:ze[4]||(ze[4]=()=>M(l)()),icon:"print","data-cy":"printButton"},null,8,["label","aria-label","active"])),M(D)?Le("",!0):(U(),Gt(xh,{key:6,label:M(e)("Partager",{ns:"client"}),"aria-label":M(te)?M(e)("Close share panel"):M(e)("Open share panel to create a shareable link"),active:M(te),icon:"share",onClick:ze[5]||(ze[5]=()=>M(y)()),"data-cy":"shareButton"},null,8,["label","aria-label","active"]))],2),M(D)?(U(),ie("div",RCe)):(U(),ie("div",MCe,[mt(vp,{class:"hidden lg:flex text-gray-500",label:M(e)("What's new",{ns:"client"}),link:`https://geoportail.lu/${M(t).language}/questions/whats-new/`},null,8,["label","link"]),mt(vp,{class:"hidden lg:flex text-gray-500",label:M(e)("Geocatalogue",{ns:"client"}),link:M(o)},null,8,["label","link"]),P("button",{class:Rn(["hidden lg:flex h-full flex-col justify-center px-[7px] uppercase hover:text-white hover:bg-primary text-gray-500",{"bg-primary text-white":M(Y)}]),"aria-pressed":M(Y)?"true":"false","aria-label":M(e)("Feedback",{ns:"client"}),onClick:ze[6]||(ze[6]=()=>M(x)()),"data-cy":"feedbackButton"},K(M(e)("Feedback",{ns:"client"})),11,kCe),mt(vp,{class:"hidden lg:flex text-gray-500",label:M(e)("A Propos",{ns:"client"}),link:`https://www.geoportail.lu/${M(t).language}/propos/`},null,8,["label","link"]),mt(vp,{class:"hidden lg:flex text-gray-500",label:M(e)("Aide",{ns:"client"}),link:`https://www.geoportail.lu/${M(t).language}/documentation/`},null,8,["label","link"]),mt(vp,{class:"hidden lg:flex text-gray-500",label:M(e)("Contact",{ns:"client"}),link:`https://www.geoportail.lu/${M(t).language}/propos/contactez-nous/`},null,8,["label","link"]),mt(vp,{class:"text-gray-500",label:M(e)("Legalites",{ns:"client"}),link:`https://www.geoportail.lu/${M(t).language}/propos/mentions-legales/`},null,8,["label","link"]),mt(vp,{class:"text-gray-500",label:M(e)("ACT",{ns:"client"}),link:"http://www.act.public.lu/"},null,8,["label"])]))]))}}),_R={capture:!0,passive:!1};function vR(n){n.preventDefault(),n.stopImmediatePropagation()}function PCe(n){var e=n.document.documentElement,t=sa(n).on("dragstart.drag",vR,_R);"onselectstart"in e?t.on("selectstart.drag",vR,_R):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function GCe(n,e){var t=n.document.documentElement,i=sa(n).on("dragstart.drag",null);e&&(i.on("click.drag",vR,_R),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in t?i.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const eI=n=>()=>n;function FCe(n,{sourceEvent:e,target:t,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Lh(n,e,t){this.k=n,this.x=e,this.y=t}Lh.prototype={constructor:Lh,scale:function(n){return n===1?this:new Lh(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new Lh(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var bz=new Lh(1,0,0);Lh.prototype;function gE(n){n.stopImmediatePropagation()}function I0(n){n.preventDefault(),n.stopImmediatePropagation()}function OCe(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function NCe(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function f3(){return this.__zoom||bz}function DCe(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function VCe(){return navigator.maxTouchPoints||"ontouchstart"in this}function BCe(n,e,t){var i=n.invertX(e[0][0])-t[0][0],r=n.invertX(e[1][0])-t[1][0],o=n.invertY(e[0][1])-t[0][1],s=n.invertY(e[1][1])-t[1][1];return n.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function ZCe(){var n=OCe,e=NCe,t=BCe,i=DCe,r=VCe,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],l=250,u=_he,h=mk("start","zoom","end"),d,m,y,x=500,C=150,w=0,E=10;function T(D){D.property("__zoom",f3).on("wheel.zoom",te,{passive:!1}).on("mousedown.zoom",$).on("dblclick.zoom",ae).filter(r).on("touchstart.zoom",fe).on("touchmove.zoom",Y).on("touchend.zoom touchcancel.zoom",de).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}T.transform=function(D,oe,ue,ge){var Ne=D.selection?D.selection():D;Ne.property("__zoom",f3),D!==Ne?V(D,oe,ue,ge):Ne.interrupt().each(function(){z(this,arguments).event(ge).start().zoom(null,typeof oe=="function"?oe.apply(this,arguments):oe).end()})},T.scaleBy=function(D,oe,ue,ge){T.scaleTo(D,function(){var Ne=this.__zoom.k,Ee=typeof oe=="function"?oe.apply(this,arguments):oe;return Ne*Ee},ue,ge)},T.scaleTo=function(D,oe,ue,ge){T.transform(D,function(){var Ne=e.apply(this,arguments),Ee=this.__zoom,se=ue==null?O(Ne):typeof ue=="function"?ue.apply(this,arguments):ue,q=Ee.invert(se),j=typeof oe=="function"?oe.apply(this,arguments):oe;return t(G(k(Ee,j),se,q),Ne,s)},ue,ge)},T.translateBy=function(D,oe,ue,ge){T.transform(D,function(){return t(this.__zoom.translate(typeof oe=="function"?oe.apply(this,arguments):oe,typeof ue=="function"?ue.apply(this,arguments):ue),e.apply(this,arguments),s)},null,ge)},T.translateTo=function(D,oe,ue,ge,Ne){T.transform(D,function(){var Ee=e.apply(this,arguments),se=this.__zoom,q=ge==null?O(Ee):typeof ge=="function"?ge.apply(this,arguments):ge;return t(bz.translate(q[0],q[1]).scale(se.k).translate(typeof oe=="function"?-oe.apply(this,arguments):-oe,typeof ue=="function"?-ue.apply(this,arguments):-ue),Ee,s)},ge,Ne)};function k(D,oe){return oe=Math.max(o[0],Math.min(o[1],oe)),oe===D.k?D:new Lh(oe,D.x,D.y)}function G(D,oe,ue){var ge=oe[0]-ue[0]*D.k,Ne=oe[1]-ue[1]*D.k;return ge===D.x&&Ne===D.y?D:new Lh(D.k,ge,Ne)}function O(D){return[(+D[0][0]+ +D[1][0])/2,(+D[0][1]+ +D[1][1])/2]}function V(D,oe,ue,ge){D.on("start.zoom",function(){z(this,arguments).event(ge).start()}).on("interrupt.zoom end.zoom",function(){z(this,arguments).event(ge).end()}).tween("zoom",function(){var Ne=this,Ee=arguments,se=z(Ne,Ee).event(ge),q=e.apply(Ne,Ee),j=ue==null?O(q):typeof ue=="function"?ue.apply(Ne,Ee):ue,ze=Math.max(q[1][0]-q[0][0],q[1][1]-q[0][1]),je=Ne.__zoom,qe=typeof oe=="function"?oe.apply(Ne,Ee):oe,yt=u(je.invert(j).concat(ze/je.k),qe.invert(j).concat(ze/qe.k));return function(xt){if(xt===1)xt=qe;else{var Et=yt(xt),kt=ze/Et[2];xt=new Lh(kt,j[0]-Et[0]*kt,j[1]-Et[1]*kt)}se.zoom(null,xt)}})}function z(D,oe,ue){return!ue&&D.__zooming||new H(D,oe)}function H(D,oe){this.that=D,this.args=oe,this.active=0,this.sourceEvent=null,this.extent=e.apply(D,oe),this.taps=0}H.prototype={event:function(D){return D&&(this.sourceEvent=D),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(D,oe){return this.mouse&&D!=="mouse"&&(this.mouse[1]=oe.invert(this.mouse[0])),this.touch0&&D!=="touch"&&(this.touch0[1]=oe.invert(this.touch0[0])),this.touch1&&D!=="touch"&&(this.touch1[1]=oe.invert(this.touch1[0])),this.that.__zoom=oe,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(D){var oe=sa(this.that).datum();h.call(D,this.that,new FCe(D,{sourceEvent:this.sourceEvent,target:T,transform:this.that.__zoom,dispatch:h}),oe)}};function te(D,...oe){if(!n.apply(this,arguments))return;var ue=z(this,oe).event(D),ge=this.__zoom,Ne=Math.max(o[0],Math.min(o[1],ge.k*Math.pow(2,i.apply(this,arguments)))),Ee=bu(D);if(ue.wheel)(ue.mouse[0][0]!==Ee[0]||ue.mouse[0][1]!==Ee[1])&&(ue.mouse[1]=ge.invert(ue.mouse[0]=Ee)),clearTimeout(ue.wheel);else{if(ge.k===Ne)return;ue.mouse=[Ee,ge.invert(Ee)],TI(this),ue.start()}I0(D),ue.wheel=setTimeout(se,C),ue.zoom("mouse",t(G(k(ge,Ne),ue.mouse[0],ue.mouse[1]),ue.extent,s));function se(){ue.wheel=null,ue.end()}}function $(D,...oe){if(y||!n.apply(this,arguments))return;var ue=D.currentTarget,ge=z(this,oe,!0).event(D),Ne=sa(D.view).on("mousemove.zoom",j,!0).on("mouseup.zoom",ze,!0),Ee=bu(D,ue),se=D.clientX,q=D.clientY;PCe(D.view),gE(D),ge.mouse=[Ee,this.__zoom.invert(Ee)],TI(this),ge.start();function j(je){if(I0(je),!ge.moved){var qe=je.clientX-se,yt=je.clientY-q;ge.moved=qe*qe+yt*yt>w}ge.event(je).zoom("mouse",t(G(ge.that.__zoom,ge.mouse[0]=bu(je,ue),ge.mouse[1]),ge.extent,s))}function ze(je){Ne.on("mousemove.zoom mouseup.zoom",null),GCe(je.view,ge.moved),I0(je),ge.event(je).end()}}function ae(D,...oe){if(n.apply(this,arguments)){var ue=this.__zoom,ge=bu(D.changedTouches?D.changedTouches[0]:D,this),Ne=ue.invert(ge),Ee=ue.k*(D.shiftKey?.5:2),se=t(G(k(ue,Ee),ge,Ne),e.apply(this,oe),s);I0(D),l>0?sa(this).transition().duration(l).call(V,se,ge,D):sa(this).call(T.transform,se,ge,D)}}function fe(D,...oe){if(n.apply(this,arguments)){var ue=D.touches,ge=ue.length,Ne=z(this,oe,D.changedTouches.length===ge).event(D),Ee,se,q,j;for(gE(D),se=0;se<ge;++se)q=ue[se],j=bu(q,this),j=[j,this.__zoom.invert(j),q.identifier],Ne.touch0?!Ne.touch1&&Ne.touch0[2]!==j[2]&&(Ne.touch1=j,Ne.taps=0):(Ne.touch0=j,Ee=!0,Ne.taps=1+!!d);d&&(d=clearTimeout(d)),Ee&&(Ne.taps<2&&(m=j[0],d=setTimeout(function(){d=null},x)),TI(this),Ne.start())}}function Y(D,...oe){if(this.__zooming){var ue=z(this,oe).event(D),ge=D.changedTouches,Ne=ge.length,Ee,se,q,j;for(I0(D),Ee=0;Ee<Ne;++Ee)se=ge[Ee],q=bu(se,this),ue.touch0&&ue.touch0[2]===se.identifier?ue.touch0[0]=q:ue.touch1&&ue.touch1[2]===se.identifier&&(ue.touch1[0]=q);if(se=ue.that.__zoom,ue.touch1){var ze=ue.touch0[0],je=ue.touch0[1],qe=ue.touch1[0],yt=ue.touch1[1],xt=(xt=qe[0]-ze[0])*xt+(xt=qe[1]-ze[1])*xt,Et=(Et=yt[0]-je[0])*Et+(Et=yt[1]-je[1])*Et;se=k(se,Math.sqrt(xt/Et)),q=[(ze[0]+qe[0])/2,(ze[1]+qe[1])/2],j=[(je[0]+yt[0])/2,(je[1]+yt[1])/2]}else if(ue.touch0)q=ue.touch0[0],j=ue.touch0[1];else return;ue.zoom("touch",t(G(se,q,j),ue.extent,s))}}function de(D,...oe){if(this.__zooming){var ue=z(this,oe).event(D),ge=D.changedTouches,Ne=ge.length,Ee,se;for(gE(D),y&&clearTimeout(y),y=setTimeout(function(){y=null},x),Ee=0;Ee<Ne;++Ee)se=ge[Ee],ue.touch0&&ue.touch0[2]===se.identifier?delete ue.touch0:ue.touch1&&ue.touch1[2]===se.identifier&&delete ue.touch1;if(ue.touch1&&!ue.touch0&&(ue.touch0=ue.touch1,delete ue.touch1),ue.touch0)ue.touch0[1]=this.__zoom.invert(ue.touch0[0]);else if(ue.end(),ue.taps===2&&(se=bu(se,this),Math.hypot(m[0]-se[0],m[1]-se[1])<E)){var q=sa(this).on("dblclick.zoom");q&&q.apply(this,arguments)}}}return T.wheelDelta=function(D){return arguments.length?(i=typeof D=="function"?D:eI(+D),T):i},T.filter=function(D){return arguments.length?(n=typeof D=="function"?D:eI(!!D),T):n},T.touchable=function(D){return arguments.length?(r=typeof D=="function"?D:eI(!!D),T):r},T.extent=function(D){return arguments.length?(e=typeof D=="function"?D:eI([[+D[0][0],+D[0][1]],[+D[1][0],+D[1][1]]]),T):e},T.scaleExtent=function(D){return arguments.length?(o[0]=+D[0],o[1]=+D[1],T):[o[0],o[1]]},T.translateExtent=function(D){return arguments.length?(s[0][0]=+D[0][0],s[1][0]=+D[1][0],s[0][1]=+D[0][1],s[1][1]=+D[1][1],T):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},T.constrain=function(D){return arguments.length?(t=D,T):t},T.duration=function(D){return arguments.length?(l=+D,T):l},T.interpolate=function(D){return arguments.length?(u=D,T):u},T.on=function(){var D=h.on.apply(h,arguments);return D===h?T:D},T.clickDistance=function(D){return arguments.length?(w=(D=+D)*D,T):Math.sqrt(w)},T.tapDistance=function(D){return arguments.length?(E=+D,T):E},T}const js={axisBottom:NZ,axisLeft:DZ,scaleLinear:Ak,select:sa,zoom:ZCe};class WCe{manager_;scaleX;scaleY;updateScaleX=e=>e;updateScaleY=e=>e;material;width_;height_;previousDomainX=[];zoom_;svg_;constructor(e){this.manager_=e}drawPoints(e){const t=e.distance.length,i=js.select(".lidarprofile-container .lidar-canvas").node().getContext("2d"),r=this.manager_.config.serverConfig;for(let o=0;o<t;++o){const s=e.distance[o],l=e.altitude[o],u=e.color_packed[o],h=e.intensity[o],d=e.classification[o];if(r.classification_colors[d]&&r.classification_colors[d].visible){const m=this.updateScaleX(s),y=this.updateScaleY(l);i.beginPath(),i.moveTo(m,y),this.material==="COLOR_PACKED"?i.fillStyle=`rgb(${u[0]}, ${u[1]}, ${u[2]})`:this.material==="INTENSITY"?i.fillStyle=`rgb(${h}, ${h}, ${h})`:this.material==="CLASSIFICATION"?i.fillStyle=`rgb(${r.classification_colors[d].color})`:i.fillStyle=r.default_color,i.arc(m,y,r.point_size,0,2*Math.PI,!1),i.fill()}}}setupPlot(e,t){const i=js.select(".lidarprofile-container .lidar-canvas"),r=i.node();r.getContext("2d").clearRect(0,0,r.getBoundingClientRect().width,r.getBoundingClientRect().height);const s=this.manager_.config.clientConfig.margin,l=js.select(".lidarprofile-container").node(),u=l.getBoundingClientRect().width,h=l.getBoundingClientRect().height;this.width_=Math.max(u-(s.left+s.right),0),this.height_=Math.max(h-(s.top+s.bottom),0),this.material=this.manager_.config.serverConfig.default_attribute,i.attr("height",this.height_).attr("width",this.width_).style("background-color","white").style("z-index",0).style("position","absolute").style("margin-left",`${s.left}px`).style("margin-top",`${s.top}px`);const d=e[1]-e[0],m=t[1]-t[0],y=d/m,x=this.width_,C=this.height_,w=x/C;if(y<w)this.scaleX=js.scaleLinear().domain(e).range([0,this.width_]),this.scaleY=js.scaleLinear().domain(t).range([this.height_,0]);else{const k=y/w,G=m*k,O=(t[1]+t[0])/2;this.scaleX=js.scaleLinear().domain(e).range([0,this.width_]),this.scaleY=js.scaleLinear().domain([O-G/2,O+G/2]).range([this.height_,0])}this.zoom_=js.zoom().scaleExtent([-10,100]).translateExtent([[0,0],[this.width_+1e3,this.height_]]).extent([[0,0],[this.width_+1e3,this.height_]]).on("zoom",this.zoomed.bind(this)).on("end",this.zoomEnd.bind(this)),this.previousDomainX=this.scaleX.domain(),this.updateScaleX=this.scaleX,this.updateScaleY=this.scaleY,this.svg_=js.select(".lidarprofile-container svg.lidar-svg"),this.svg_.call(this.zoom_).on("dblclick.zoom",null),this.svg_.selectAll("*").remove(),this.svg_.attr("width",this.width_+s.left).attr("height",this.height_+s.top+s.bottom),this.svg_.on("mousemove",k=>{this.pointHighlight(k)});const E=js.axisBottom(this.scaleX),T=js.axisLeft(this.scaleY).tickSize(-this.width_);this.svg_.append("g").attr("class","y axis").call(T),this.svg_.append("g").attr("class","x axis").call(E),this.svg_.select(".y.axis").attr("transform",`translate(${s.left}, ${s.top})`),this.svg_.select(".x.axis").attr("transform",`translate(${s.left}, ${this.height_+s.top})`),this.svg_.select(".y.axis").selectAll("g.tick line").style("opacity","0.5").style("stroke","#b7cff7")}activateZoom(){this.svg_.call(this.zoom_)}deactivateZoom(){this.svg_.on(".zoom",null)}zoomEnd(){js.select(".lidarprofile-container .lidar-canvas").node().getContext("2d").clearRect(0,0,this.width_,this.height_),this.manager_.updateData()}zoomed(e){this.manager_.clearMeasure();const t=e.transform,i=js.select(".lidarprofile-container svg.lidar-svg"),r=js.axisBottom(this.scaleX),o=js.axisLeft(this.scaleY).tickSize(-this.width_),s=t.rescaleX(this.scaleX),l=t.rescaleY(this.scaleY),u=r.scale(s),h=o.scale(l);i.select(".x.axis").call(u),i.select(".y.axis").call(h),js.select(".lidarprofile-container .lidar-canvas").node().getContext("2d").clearRect(0,0,this.width_,this.height_),i.select(".y.axis").selectAll("g.tick line").style("opacity","0.5").style("stroke","#b7cff7"),this.updateScaleX=s,this.updateScaleY=l}pointHighlight(e){const t=js.select(".lidarprofile-container svg.lidar-svg"),i=js.select(".lidarprofile-container .lidar-info"),r=this.manager_.config.serverConfig.point_size,o=this.manager_.config.clientConfig.margin,s=this.manager_.config.clientConfig.tolerance||0,l=js.select(".lidarprofile-container .lidar-canvas").node(),u=bu(e,l),h=this.manager_.config.serverConfig.classification_colors,d=this.manager_.utils.getClosestPoint(this.manager_.profilePoints,u[0],u[1],s,this.updateScaleX,this.updateScaleY,h);if(d!=null){const m=this.updateScaleX(d.distance)+o.left,y=this.updateScaleY(d.altitude)+o.top;t.selectAll("#highlightCircle").remove(),t.append("circle").attr("id","highlightCircle").attr("cx",m).attr("cy",y).attr("r",r+3).style("fill","red");const x=d.classification??-1,C=h[x]||{},w=this.getInfoHTML(d,C,1);i.html(w),this.manager_.cartoHighlight.setElement(void 0);const E=document.createElement("div");E.className+="tooltip gmf-tooltip-measure",E.innerHTML=w,this.manager_.cartoHighlight.setElement(E);const T=new zi([d.coords[0],d.coords[1]]).transform("EPSG:2169","EPSG:3857");this.manager_.cartoHighlight.setPosition(T.getCoordinates());const k=this.manager_.lidarPointHighlight.getSource();k&&k.clear();const G=new yi(T);typeof C.color<"u"&&G.setStyle(new Hn({image:new ms({fill:new Di({color:`rgba(${C.color}, 1)`}),radius:3})})),k&&k.addFeature(G)}else{const m=this.manager_.lidarPointHighlight.getSource();m&&m.clear(),t.select("#highlightCircle").remove(),i.html(""),this.manager_.cartoHighlight.setPosition(void 0)}}getInfoHTML(e,t,i){const r=(m,y)=>parseFloat(`${m}`).toFixed(y),o=e.distance,s=e.altitude,l=t.name?t.name[Wn.language]:"",u=l!=null?String(l):"",h=e.intensity,d=[];if(o!==void 0){const m=Wn.t("Distance: ");d.push(`${m+r(o,i)}`)}if(s!==void 0){const m=Wn.t("Altitude: ");d.push(`${m+r(s,i)}`)}if(u.length>0){const m=Wn.t("Classification: ");d.push(`${m+u}`)}if(h!==void 0){const m=Wn.t("Intensity: ");d.push(`${m+r(h,0)}`)}return d.join("</br>")}changeStyle(e){this.material=e,this.clear(),this.drawPoints(this.manager_.profilePoints)}clear(){const e=js.select(".lidarprofile-container .lidar-canvas").node();e.getContext("2d").clearRect(0,0,e.width,e.height)}setClassActive(e,t){this.manager_.config.serverConfig.classification_colors=e,this.changeStyle(t)}}const p3={select:sa};class zCe{clipLineByMeasure(e,t,i){const r=new qi([]);let o=0,s=0;const l=e.getLength(),u=t/l,h=i/l;let d=e.getCoordinates().length-1,m=0;e.forEachSegment((V,z)=>{m+=1;const H=new qi([V,z]);s+=H.getLength(),t==o?r.appendCoordinate(V):t>o&&t<s&&r.appendCoordinate(e.getCoordinateAt(u)),o>t&&o<i&&r.appendCoordinate(V),i==s?r.appendCoordinate(z):(i>o&&i<s||i>o&&i>s&&m===d)&&r.appendCoordinate(e.getCoordinateAt(h)),o+=H.getLength()});const y=r.clone(),x=new yi({geometry:r.transform("EPSG:2169","EPSG:3857")}),C=new Hn({stroke:new bi({color:"rgba(255,0,0,1)",width:2,lineCap:"square"})});let w=0,E=0;d=r.getCoordinates().length-1;let T=1;r.forEachSegment((V,z)=>{if(T==1){const H=z[0]-V[0],te=z[1]-V[1];w=Math.atan2(H,te)}if(T==d){const H=z[0]-V[0],te=z[1]-V[1];E=Math.atan2(H,te)}T+=1});const k=[C],G=r.getLastCoordinate(),O=r.getFirstCoordinate();return k.push(new Hn({geometry:new zi(O),image:new bl({fill:new Di({color:"rgba(255, 0, 0, 1)"}),stroke:new bi({color:"rgba(255,0,0,1)",width:1,lineCap:"square"}),points:3,radius:5,rotation:w,angle:Math.PI/3})}),new Hn({geometry:new zi(G),image:new bl({fill:new Di({color:"rgba(255, 0, 0, 1)"}),stroke:new bi({color:"rgba(255,0,0,1)",width:1,lineCap:"square"}),points:3,radius:5,rotation:E,angle:4*Math.PI/3})})),{clippedLine:y.getCoordinates(),distanceOffset:t,bufferGeom:x,bufferStyle:k}}getNiceLOD(e,t){let i=0,r=0;for(const o in t){const s=parseInt(o,10);e<s&&t[s].max>i&&(i=t[s].max,r=t[s].width)}return{maxLOD:i,width:r}}downloadProfileAsImageFile(e){const t=p3.select(".lidarprofile-container svg.lidar-svg"),i=parseInt(t.attr("width"),10),r=parseInt(t.attr("height"),10),o=e.margin,s=document.createElement("canvas");s.style.display="none",s.width=i,s.height=r;const l=s.getContext("2d");if(l){l.fillStyle="white",l.fillRect(0,0,i,r);const u=p3.select(".lidarprofile-container .lidar-canvas").node();u instanceof HTMLCanvasElement&&l.drawImage(u,o.left,o.top,i-(o.left+o.right),r-(o.top+o.bottom));const h=new Image,d=new XMLSerializer,m=t.node(),y=d.serializeToString(m),x="lidar_profile_for_export_uid";h.id=x,h.src=`data:image/svg+xml;base64, ${btoa(y)}`,h.style.setProperty("display","none");const C=document.getElementsByTagName("body")[0];h.onload=()=>{l.drawImage(h,0,0,i,r);const w=document.getElementById(x);w&&C.removeChild(w),s.toBlob(E=>{_z.saveAs(E,"LIDAR_profile.png")})},C.appendChild(h)}}getFlatPointsByDistance(e){const t=[];for(let i=0;i<e.distance.length;i++){const r={distance:e.distance[i],altitude:e.altitude[i],color_packed:e.color_packed[i],intensity:e.intensity[i],classification:e.classification[i],coords:e.coords[i]};t.push(r)}return t.sort((i,r)=>i.distance-r.distance),t}getCSVData(e){return e.map(t=>{const i={};for(const r in t){const o=t[r];r==="altitude"?i[r]=o?o.toFixed(4):null:r==="color_packed"||r=="coords"?i[r]=o?o.join(" "):null:i[r]=o}return i})}arrayMax(e){return Math.max(...e)}arrayMin(e){let t=1/0;for(let i=0;i<e.length;i++)e[i]<t&&(t=e[i]);return t}getPytreeLinestring(e){const t=e.getCoordinates();let i="";for(let r=0;r<t.length;r++){const o=t[r][0],s=t[r][1];i+=`{${Math.round(100*o)/100}, ${Math.round(100*s)/100}},`}return i.slice(0,-1)}getClosestPoint(e,t,i,r,o,s,l){const u=e,h=r,d=[],m=[];if(u.distance&&u.altitude&&u.classification&&u.color_packed&&u.intensity&&u.coords){for(let x=0;x<u.distance.length;x++)if(o(u.distance[x])<t+h&&o(u.distance[x])>t-h&&s(u.altitude[x])<i+h&&s(u.altitude[x])>i-h){const C=Math.sqrt(Math.pow(o(u.distance[x])-t,2)+Math.pow(s(u.altitude[x])-i,2)),w=l[u.classification[x]];w&&w.visible==1&&(m.push({distance:u.distance[x],altitude:u.altitude[x],classification:u.classification[x],color_packed:u.color_packed[x],intensity:u.intensity[x],coords:u.coords[x]}),d.push(C))}}let y;if(m.length>0){const x=Math.min(...d),C=d.indexOf(x);C!=-1?y=m[C]:y=m[0]}return y}}class UCe{manager;pStart;pEnd;constructor(e){this.manager=e,this.pStart={},this.pEnd={}}clearMeasure(){this.manager.plot.activateZoom(),this.pStart={},this.pEnd={};const e=sa(".lidarprofile-container svg.lidar-svg");e.selectAll("#text_m").remove(),e.selectAll("#start_m").remove(),e.selectAll("#end_m").remove(),e.selectAll("#line_m").remove(),e.on("click",null),e.style("cursor","default")}setMeasureActive(){this.manager.plot.deactivateZoom();const e=sa(".lidarprofile-container svg.lidar-svg");e.style("cursor","pointer"),e.on("click",t=>this.measureHeight(t))}measureHeight(e){const t=sa(".lidarprofile-container svg.lidar-svg"),i=t.node(),r=sa(".lidarprofile-container .lidar-canvas").node();if(!i||!r)return;const o=bu(e,i),s=bu(e,r),l=this.manager.config.clientConfig.margin,u=o[0],h=o[1],d=2,m=this.manager.plot.updateScaleX,y=this.manager.plot.updateScaleY,x=3,C=this.manager.utils.getClosestPoint(this.manager.profilePoints,s[0],s[1],d,m,y,this.manager.config.serverConfig.classification_colors);if(this.pStart.set?this.pEnd.set||(C!==void 0?(this.pEnd.distance=C.distance,this.pEnd.altitude=C.altitude,this.pEnd.cx=m(C.distance)+l.left,this.pEnd.cy=y(C.altitude)+l.top):(this.pEnd.distance=m.invert(u),this.pEnd.altitude=y.invert(h),this.pEnd.cx=u,this.pEnd.cy=h),this.pEnd.set=!0,t.append("circle").attr("id","end_m").attr("cx",this.pEnd.cx).attr("cy",this.pEnd.cy).attr("r",x).style("fill","red"),t.append("line").attr("id","line_m").attr("x1",this.pStart.cx).attr("y1",this.pStart.cy).attr("x2",this.pEnd.cx).attr("y2",this.pEnd.cy).attr("stroke-width",2).attr("stroke","red")):(C!==void 0?(this.pStart.distance=C.distance,this.pStart.altitude=C.altitude,this.pStart.cx=m(C.distance)+l.left,this.pStart.cy=y(C.altitude)+l.top):(this.pStart.distance=m.invert(u),this.pStart.altitude=y.invert(h),this.pStart.cx=u,this.pStart.cy=h),this.pStart.set=!0,t.append("circle").attr("id","start_m").attr("cx",this.pStart.cx).attr("cy",this.pStart.cy).attr("r",x).style("fill","red")),this.pStart.set&&this.pEnd.set){const w=this.pEnd.altitude-this.pStart.altitude,E=this.pEnd.distance-this.pStart.distance,T=Math.round(10*Math.sqrt(Math.pow(w,2)+Math.pow(E,2)))/10;isNaN(T)||t.append("text").attr("id","text_m").attr("x",10+(this.pStart.cx+this.pEnd.cx)/2).attr("y",(this.pStart.cy+this.pEnd.cy)/2).text(`${T} m`).attr("font-family","sans-serif").attr("font-size","14px").style("font-weight","bold").attr("fill","red"),this.pEnd.set=!1,this.pStart.set=!1}}}const Rm={select:sa};class XCe{map=Kn().getOlMap();utils=new zCe;promise=null;plot=null;measure=null;config=null;cartoHighlight=new hf({offset:[0,-15],positioning:"bottom-center"});lidarPointHighlight=new gs({source:new io({}),style:new Hn({image:new ms({fill:new Di({color:"rgba(0, 0, 255, 1)"}),radius:3})})});lidarBuffer=new gs({source:new io({})});profilePoints=this.getEmptyProfilePoints_();isPlotSetup_=!1;line_;constructor(){}init(e){this.config=e,this.plot=new WCe(this),this.lidarBuffer.setMap(this.map),this.lidarPointHighlight.setMap(this.map),this.measure=new UCe(this)}clearBuffer(){if(this.lidarBuffer){const e=this.lidarBuffer.getSource();e&&e.clear()}}setLine(e){this.line_=e}getEmptyProfilePoints_(){return{distance:[],altitude:[],color_packed:[],intensity:[],classification:[],coords:[]}}resetPlot(){this.isPlotSetup_=!1,this.plot.clear()}arrayToCsvString(e){if(!e.length)return"";const t=Object.keys(e[0]),i=e.map(r=>t.map(o=>JSON.stringify(r[o]??"")).join(","));return[t.join(","),...i].join(`\r
`)}exportCsv(){const e=this.utils.getFlatPointsByDistance(this.profilePoints)||{},t=this.utils.getCSVData(e),i=this.arrayToCsvString(t),r=new Blob([i],{type:"text/csv"});XB("export-lidar.csv",r,"text/csv")}exportPng(){this.utils.downloadProfileAsImageFile(this.config.clientConfig)}exportLas(){const e=lg(),{profileWidth:t}=It(e);this.getProfileByLOD([],0,0,!0,t.value)}getProfileByLOD(e,t,i,r,o){this.profilePoints=this.getEmptyProfilePoints_(),Rm.select(".lidarprofile-container .lidar-error").style("visibility","hidden");let s=this.utils.getPytreeLinestring(this.line_),l;Rm.select(".lidarprofile-container .lod-info").html("");const u=this.config.serverConfig.max_levels;let h=0;if(t==0)l=this.utils.getNiceLOD(this.line_.getLength(),u);else{const m=this.plot.updateScaleX.domain();s="";for(let y=0;y<e.length;y++)s+=`{${e[y][0]},${e[y][1]}},`;s=s.slice(0,-1),l=this.utils.getNiceLOD(m[1]-m[0],u)}this.config.clientConfig.pointSum=0,this.config.clientConfig.autoWidth?h=l.width:h=this.config.serverConfig.width,h=o;const d=Wn.t("Profile width: ");if(Rm.select(".lidarprofile-container .width-info").html(`${d} ${h}m`),r)this.queryPytree_(void 0,void 0,s,t,h,!0);else for(let m=0;m<l.maxLOD;m++)m==0?(this.queryPytree_(i,this.config.serverConfig.initialLOD,s,t,h,!1),m+=this.config.serverConfig.initialLOD-1):this.queryPytree_(i+m,i+m+1,s,t,h,!1)}queryPytree_(e,t,i,r,o,s){if(!this.config)throw new Error("Missing config");if(!this.config.serverConfig)throw new Error("Missing config.serverConfig");this.map.getViewport().style.cursor="wait",document.body.style.cursor="wait";const l=Rm.select(".lidarprofile-container .lod-info");if(this.config.serverConfig.debug){let m=l.html();const y=Wn.t("Loading LOD: ");m+=`${y} ${e}-${t}...<br>`,l.html(m)}const u=this.config.serverConfig.default_point_cloud,h=s?1:0,d={method:"GET",headers:{"Content-Type":"text/plain; charset=x-user-defined"},responseType:"arraybuffer"};if(s){const m=`https://migration.geoportail.lu/profile/get?width=${o}&coordinates=${i}&pointCloud=${u}&attributes=&getLAS=${h}`;fetch(m,d).then(y=>y.blob()).then(y=>{const x=window.URL.createObjectURL(y),C=document.createElement("a");C.style.display="none",C.href=x,C.download="output.las",document.body.appendChild(C),C.click(),window.URL.revokeObjectURL(x)}).finally(()=>{this.map.getViewport().style.cursor="",document.body.style.cursor=""})}else{let m=`https://migration.geoportail.lu/profile/get?minLOD=${e}&maxLOD=${t}&width=${o}&coordinates=${i}&pointCloud=${u}&attributes=&getLAS=${h}`;(e===void 0||t===void 0)&&(m=`https://migration.geoportail.lu/profile/get?width=${o}&coordinates=${i}&pointCloud=${u}&attributes=&getLAS=${h}`),fetch(m,d).then(y=>y.arrayBuffer()).then(y=>{if(!this.config)throw new Error("Missing config");if(!this.config.serverConfig)throw new Error("Missing config.serverConfig");if(this.config.serverConfig.debug){let x=l.html();const C=Wn.t("LOD: "),w=Wn.t("loaded");x+=`${C} ${e}-${t} ${w}<br>`,l.html(x)}this.processBuffer_(y,r)}).catch(y=>{throw`Error on pytree query: ${y.message}`}).finally(()=>{this.map.getViewport().style.cursor="",document.body.style.cursor=""})}}processBuffer_(e,t){const i=Rm.select(".lidarprofile-container .lidar-error"),o=new Int32Array(e,0,4)[0],s=new Uint8Array(e,4,o);let l="";for(let T=0;T<s.length;T++)l+=String.fromCharCode(s[T]);try{JSON.parse(l)}catch{if(!this.isPlotSetup_){const k=Rm.select(".lidarprofile-container .lidar-canvas"),G=k.node();if(G&&G instanceof HTMLCanvasElement){const O=G.getContext("2d");O&&O.clearRect(0,0,G.getBoundingClientRect().width,G.getBoundingClientRect().height),k.selectAll("*").remove();const V=this.getHTMLError_();i.style("visibility","visible"),i.html(V)}}return}i.style("visibility","hidden");const u=JSON.parse(l);this.config.clientConfig.pointSum+=u.points,this.config.clientConfig.pointSum>this.config.serverConfig.max_point_number&&console.warn("Number of points is higher than Pytree configuration max value !");const h=u.pointAttributes,d=[];for(let T=0;T<h.length;T++)this.config.serverConfig.point_attributes[h[T]]!=null&&d.push(this.config.serverConfig.point_attributes[h[T]]);const m=u.scale;if(u.points<3)return;const y=this.getEmptyProfilePoints_(),x=u.bytesPerPoint,C=e.slice(4+o);for(let T=0;T<u.points;T++){const k=x*T,G=new DataView(C,k,x);let O=0;for(let V=0;V<d.length;V++){if(d[V].value=="POSITION_PROJECTED_PROFILE"){const H=G.getUint32(O,!0)*m;y.distance.push(Math.round(100*(t+H))/100),this.profilePoints.distance.push(Math.round(100*(t+H))/100)}else if(d[V].value=="CLASSIFICATION"){const z=G.getUint8(O);y.classification.push(z),this.profilePoints.classification.push(z)}else if(d[V].value=="INTENSITY"){const z=G.getUint8(O);y.intensity.push(z),this.profilePoints.intensity.push(z)}else if(d[V].value=="COLOR_PACKED"){const z=G.getUint8(O),H=G.getUint8(O+1),te=G.getUint8(O+2);y.color_packed.push([z,H,te]),this.profilePoints.color_packed.push([z,H,te])}else if(d[V].value=="POSITION_CARTESIAN"){const z=G.getInt32(O,!0)*m+u.boundingBox.lx,H=G.getInt32(O+4,!0)*m+u.boundingBox.ly,te=G.getInt32(O+8,!0)*m+u.boundingBox.lz;y.coords.push([z,H]),y.altitude.push(te),this.profilePoints.altitude.push(te),this.profilePoints.coords.push([z,H])}O=O+d[V].bytes}}const w=[0,this.line_.getLength()],E=[this.utils.arrayMin(y.altitude),this.utils.arrayMax(y.altitude)];this.isPlotSetup_||(this.plot.setupPlot(w,E),this.isPlotSetup_=!0),this.plot.drawPoints(y)}getHTMLError_(){const e=Wn.t("Lidar profile service error"),t=Wn.t("It might be offline"),i=Wn.t("Or did you attempt to draw a profile outside data extent?"),r=Wn.t("Or did you attempt to draw such a small profile that no point was returned?");return`
      <div class="lidarprofile-error">
      <p class="bold">${e}</p>
      <p>${t}</p>
      <p>${i}</p>
      <p>${r}</p>
    `}updateData(){py(this.updateData_.bind(this),200)()}updateData_(){const e=this.plot.updateScaleX.domain(),t=this.utils.clipLineByMeasure(this.line_,e[0],e[1]),i=this.lidarBuffer.getSource();i&&(i.clear(),i.addFeature(t.bufferGeom)),this.lidarBuffer.setStyle(t.bufferStyle);const r=e[1]-e[0],o=this.utils.getNiceLOD(r,this.config.serverConfig.max_levels),s=.2;if(Math.abs(e[0]-this.plot.previousDomainX[0])<s&&Math.abs(e[1]-this.plot.previousDomainX[1])<s)this.plot.drawPoints(this.profilePoints);else if(o.maxLOD<=this.config.serverConfig.initialLOD)this.plot.drawPoints(this.profilePoints);else{const l=lg(),{profileWidth:u}=It(l);this.getProfileByLOD(t.clippedLine,t.distanceOffset,0,!1,u.value)}this.plot.previousDomainX=e}clearMeasure(){this.measure&&this.measure.clearMeasure()}setMeasureActive(){this.measure&&(this.clearMeasure(),this.measure.setMeasureActive())}}let bo;function xz(){const n=Jn(),e=lg(),{drawLidarActive:t,currentProfileFeature:i,profileWidth:r,justFinishedDrawing:o}=It(e),{lidarOpen:s}=It(n);let l;const u=new t_({type:"LineString"}),h=new Hn({fill:new Di({color:"rgba(255,204,51,0.5)"}),stroke:new bi({color:"rgba(255,204,51,0.5)",width:4,lineCap:"square"})}),d=new gs({source:new io,zIndex:1001});function m(){l=Kn().getOlMap(),bo=new XCe,bo.init(e.lidarConfig),Pt(s,$=>{if($)t.value=!0;else{t.value=!1;const ae=d.getSource();ae&&ae.clear()}}),Pt(()=>i.value,$=>{const ae=d.getSource();ae&&(ae.clear(),$&&C($.getGeometry()))}),Pt(()=>r.value,()=>{const $=d.getSource();$&&($.clear(),i.value&&i.value&&C(i.value.getGeometry()))}),u.setActive(!1),Pt(t,$=>{u.setActive($)}),l.addInteraction(u),l.addLayer(d),d.setStyle(h),mn(u,"drawstart",$=>Eu.add(l,$)),mn(u,"drawend",$=>{y($)}),mn(document,"keyup",$=>{x($)})}function y($){u.finishDrawing(),t.value=!1,o.value=!0,$.stopPropagation(),i.value=$.feature,T(),setTimeout(()=>{o.value=!1},600)}function x($){$.key==="Escape"&&(u.finishDrawing(),u.setActive(!1))}function C($){const ae=$.getCoordinates();for(let fe=0;fe<ae.length-1;fe++){const Y=Ir(ae[fe],l.getView().getProjection(),"EPSG:2169"),de=Ir(ae[fe+1],l.getView().getProjection(),"EPSG:2169"),oe=w(Y,de,r.value/2).transform("EPSG:2169",l.getView().getProjection()),ue=new yi({geometry:oe});d.getSource().addFeature(ue)}}function w($,ae,fe){const[Y,de]=$,[D,oe]=ae,ue=(D-Y)/(oe-de),ge=Math.sqrt(Math.pow(fe,2)/(Math.pow(ue,2)+1)),Ne=-ue*ge,Ee=Y+ge,se=de+Ne,q=D-ge,j=oe-Ne,ze=Y-ge,je=de-Ne,qe=D+ge,yt=oe+Ne;return new Bo([[[Ee,se],[ze,je],[q,j],[qe,yt],[Ee,se]]])}function E(){bo.clearBuffer(),bo.resetPlot(),bo.getProfileByLOD([],0,e.lidarConfig.serverConfig.minLOD,!1,r.value)}function T(){bo.resetPlot(),bo.clearBuffer(),bo.setLine(i.value.clone().getGeometry().transform("EPSG:3857","EPSG:2169")),bo.getProfileByLOD([],0,e.lidarConfig.serverConfig.minLOD,!1,r.value)}function k(){bo.exportCsv()}function G(){bo.exportPng()}function O(){bo.exportLas()}function V(){const $=i.value;return!!$&&typeof $.getGeometry=="function"&&$.getGeometry()&&$.getGeometry().getType&&$.getGeometry().getType()==="LineString"}function z(){bo.resetPlot(),bo.updateData()}function H(){bo.clearMeasure(),bo.setMeasureActive()}function te(){bo.clearMeasure()}return{drawInteraction:u,drawLidarActive:t,resetPlot:E,lidarManager:bo,hasLineFeature:V,exportCsv:k,exportPng:G,exportLas:O,init:m,updateData:z,setMeasureActive:H,clearMeasure:te}}const YCe={class:"lidarprofile-container"},HCe={class:"lidar-flex"},KCe={class:"lidar-legend p-2.5 bg-primary text-white"},jCe={class:"export-tools"},$Ce=["disabled"],JCe=["disabled"],qCe=["disabled"],QCe=["disabled"],ewe=["disabled"],twe={key:0,class:"lux-alert-info"},nwe={class:"lidarprofile"},iwe={class:"lidar-svg",style:{fill:"#ffff00",position:"absolute","z-index":"1"}},rwe=at({__name:"lidar-graph-panel",setup(n){const{toggleLidarOpen:e}=Jn(),t=lg(),{measureActive:i}=It(t),{t:r}=St(),o=xz();function s(){o.exportCsv()}function l(){o.exportPng()}function u(){o.exportLas()}function h(){i.value=!i.value,i.value?d():m()}function d(){o.setMeasureActive()}function m(){i.value=!1,o.clearMeasure()}return(y,x)=>(U(),ie("div",YCe,[P("div",{class:"close",onClick:x[0]||(x[0]=C=>M(e)(!1))},""),P("div",HCe,[P("div",KCe,[P("div",jCe,[P("div",null,[P("button",{class:"lux-btn mt-3",disabled:!(M(o)&&M(o).hasLineFeature()),onClick:s},K(M(r)("Export CSV")),9,$Ce),P("button",{class:"lux-btn mt-3",disabled:!(M(o)&&M(o).hasLineFeature()),onClick:l},K(M(r)("Export PNG")),9,JCe),P("button",{class:"lux-btn mt-3",disabled:!(M(o)&&M(o).hasLineFeature()),onClick:u},K(M(r)("Export LAS")),9,qCe),P("div",null,[P("p",null,[P("button",{class:Rn(["lux-btn mt-3",{active:M(i)}]),disabled:!(M(o)&&M(o).hasLineFeature()),onClick:h},K(M(r)("Take measure")),11,QCe),P("button",{class:"lux-btn mt-3",onClick:m,disabled:!(M(o)&&M(o).hasLineFeature())},[...x[1]||(x[1]=[P("span",{class:"fa fa-eraser"},null,-1)])],8,ewe)]),M(i)?(U(),ie("p",twe,[Bt(K(M(r)("Measure distances on the profile below."))+" ",1),P("em",null,K(M(r)("(Deactivates zoom and pan on the profile!)")),1)])):Le("",!0)])])]),x[2]||(x[2]=P("hr",{style:{"margin-top":"10px"}},null,-1)),x[3]||(x[3]=P("div",{class:"width-info"},null,-1)),x[4]||(x[4]=P("div",{class:"lod-info"},null,-1)),x[5]||(x[5]=P("div",{class:"lidar-info poi-feature"},null,-1))]),P("div",nwe,[x[6]||(x[6]=P("div",{class:"lidar-error"},null,-1)),x[7]||(x[7]=P("canvas",{class:"lidar-canvas"},null,-1)),(U(),ie("svg",iwe))])])]))}}),swe=es(rwe,[["__scopeId","data-v-07412ff6"]]);function owe(n,e,t,i){const r=Kn().getOlMap(),o=gA(),s=Ct({get:()=>({routes:o.routes,routesOrder:o.routesOrder,features:o.features,routeFeatures:o.routeFeatures,stepFeatures:o.stepFeatures,transportMode:o.transportMode,criteria:o.criteria,map:r}),set:ve=>{o.routes=ve.routes,o.routesOrder=ve.routesOrder,o.transportMode=ve.transportMode,o.criteria=ve.criteria}}),l=Ct({get:()=>o.distance,set:ve=>{o.distance=ve}}),u=Ct({get:()=>o.time,set:ve=>{o.time=ve}}),h=Ct({get:()=>o.elevationGain,set:ve=>{o.elevationGain=ve}}),d=Ct({get:()=>o.elevationLoss,set:ve=>{o.elevationLoss=ve}}),m=Ct({get:()=>o.routeDesc,set:ve=>{o.routeDesc=ve}}),y=Ct({get:()=>o.profileData,set:ve=>{o.profileData=ve}}),x=Ct({get:()=>o.hasResult,set:ve=>{o.hasResult=ve}}),C=Ue(!1),w=Ct(()=>o.routeDesc.length>0);let E=null,T=null,k=null,G=null,O=null,V=null;const z=new Ts;let H=null,te=null,$=null,ae=null,fe=null;function Y(ve){for(;s.value.routes.length<=ve;)s.value.routes.push(""),s.value.routesOrder.push(s.value.routesOrder.length);for(;s.value.features.getLength()<=ve;){const W=new yi;W.set("name",""+(s.value.features.getLength()+1)),s.value.features.push(W)}}function de(){s.value.features.getArray().filter(W=>W.getGeometry()instanceof zi).length>=2&&t(s.value)}function D(){if(!r)return;H=new gs({source:new io,style:new Hn({image:new ms({radius:6,fill:new Di({color:"#ff0000"})})})}),r.addLayer(H),te=new io({features:o.routeFeatures}),$=new gs({source:te,style:new Hn({stroke:new bi({color:[255,0,0,.8],width:5})}),updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:2e3}),r.addLayer($),ae=new gs({source:new io({features:o.stepFeatures}),style:new Hn({image:new ms({radius:6,fill:new Di({color:"#2980b9"}),stroke:new bi({color:"#ffffff",width:2})})}),updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:2001}),r.addLayer(ae),fe=new gs({source:new io({features:o.waypointFeatures}),style:W=>{const Ze=W.get("name")||"";return new Hn({image:new ms({radius:10,fill:new Di({color:"#ffffff"}),stroke:new bi({color:"#2980b9",width:3})}),text:new Wc({text:String(Ze),font:"bold 12px sans-serif",fill:new Di({color:"#2980b9"}),stroke:new bi({color:"#ffffff",width:2})}),zIndex:2100})},updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:2100}),r.addLayer(fe),E=new KC({features:z,condition:jH,filter:W=>s.value.stepFeatures.getArray().indexOf(W)!==-1}),r.addInteraction(E),E.setActive(!1),T=new KC({condition:$H,filter:W=>s.value.stepFeatures.getArray().indexOf(W)!==-1}),r.addInteraction(T),T.setActive(!1),mn(T,"select",oe),k=new iZ({features:z}),r.addInteraction(k),k.setActive(!0),mn(k,"modifyend",se),s.value.routeFeatures.on("add",q),s.value.routeFeatures.on("remove",j),G=new rZ({projection:r.getView().getProjection(),trackingOptions:{enableHighAccuracy:!0,maximumAge:6e4,timeout:7e3}});const ve=r.getLayers().getArray();for(const W of ve)if(W.get("id")==="featureOverlay"){te=W.getSource()||null;break}}function oe(ve){H&&H.getSource()&&H.getSource().clear();const W=ve.target.getFeatures();if(W.getLength()>0){const Ze=W.getArray()[0],Re=Ze.getGeometry().getFirstCoordinate(),ce=new yi({geometry:new zi(Re)});H&&H.getSource().addFeature(ce),ue(Re,Ze.get("name"))}else ge()}function ue(ve,W){ge(),O=document.createElement("div"),O.classList.add("lux-tooltip"),O.innerHTML=W,V=new hf({element:O,offset:[0,-15],positioning:"bottom-center",stopEvent:!1}),r.addOverlay(V),V.setPosition(ve)}function ge(){V&&r&&r.removeOverlay(V),O&&O.parentNode&&O.parentNode.removeChild(O),O=null,V=null}function Ne(ve,W){Y(ve),s.value.features.setAt(ve,W),Et()}function Ee(ve,W,Ze){if(!r)return;const Re=Ir(W,"EPSG:4326",r.getView().getProjection()),ce=new yi({geometry:new zi(Re)});ce.set("label",Ze),ce.set("name",""+(ve+1)),Ne(ve,ce),s.value.routes[ve]=Ze,de()}function se(){const ve=s.value.features.getLength()-1,W=s.value.features.removeAt(ve),Ze=s.value.routes[ve],Re=z.getArray()[0];if(!Re)return;const ce=Re.getGeometry();if(!ce||!(ce instanceof zi))return;const me=Re.clone(),_e=ce.getFirstCoordinate();i(_e).then(Ie=>{if(Ie.count>0){const pe=Ie.results[0];let We=pe.number+","+pe.street+","+pe.postal_code+" "+pe.locality;We.length>0&&Math.round(pe.distance)<=100||(We=_e.toString()),me.set("label",We),s.value.routes[ve]=We}}),Ne(ve+1,me),W!=null&&(yt(Ze),Ne(ve+2,W)),t(s.value)}function q(){const ve=s.value.routeFeatures.getArray();if(ve.length===0){j();return}const W=ve[0],Ze=r.getView();te&&te.setAttributions(W.get("attribution")),y.value.length>0&&(h.value=y.value[y.value.length-1].elevationGain,d.value=y.value[y.value.length-1].elevationLoss),m.value=W.get("desc")||[];let Re=0,ce=0;m.value.forEach(Ie=>{const pe=[Ie.lon,Ie.lat],Te=Ir(pe,"EPSG:4326",Ze.getProjection()),We=new yi({geometry:new zi(Te)});Re+=Ie.distance,ce+=Ie.time,Ie.cumulativeDistance=Re,Ie.cumulativeTime=ce,We.set("name",Ie.description),s.value.stepFeatures.push(We)}),l.value=W.get("dist")||0,u.value=W.get("time")||0,E&&E.setActive(!0),T&&T.setActive(!0),x.value=!0;const me=r.getSize(),_e=W.getGeometry();_e&&Ze.fit(_e,{size:me})}function j(){s.value.stepFeatures.clear(),E&&E.setActive(!1),T&&T.setActive(!1),x.value=!1,te&&te.setAttributions(void 0),Et()}function ze(ve){window.location.protocol!=="https:"?C.value=!0:G&&(mn(G,"change:position",()=>{G.setTracking(!1);const Ze=G.getPosition();if(!Ze)return;const Re=new yi({geometry:new zi(Ze)}),ce=Ze.toString();Re.set("label",ce),Ne(ve+1,Re),s.value.routes[ve]=ce,t(s.value)}),G.setTracking(!0))}function je(){o.reset(),z.clear(),te&&te.setAttributions(void 0)}function qe(ve){if(ve>0&&ve<s.value.features.getArray().length-1)s.value.features.removeAt(ve),s.value.routes.splice(ve,1),s.value.routesOrder.splice(ve,1);else{s.value.routes[ve]="";const W=new yi;W.set("name",""+(ve+1)),s.value.features.setAt(ve,W)}s.value.routeFeatures.clear(),s.value.stepFeatures.clear(),z.clear(),m.value=[],te&&te.setAttributions(void 0),Et(),t(s.value)}function yt(ve){s.value.routes.push(ve||""),s.value.routesOrder.push(s.value.routesOrder.length)}function xt(){const ve=s.value.features.removeAt(s.value.features.getLength()-1),W=s.value.features.removeAt(0);W!=null&&ve!==null&&ve!==void 0&&(s.value.features.insertAt(0,ve),s.value.features.push(W));const Ze=s.value.routes[s.value.routes.length-1];s.value.routes[s.value.routes.length-1]=s.value.routes[0],s.value.routes[0]=Ze,Et(),t(s.value)}function Et(){o.waypointFeatures.clear();let ve=0;s.value.features.forEach(W=>{ve++,W!=null&&(W.set("name",""+ve),W.getGeometry()instanceof zi&&o.waypointFeatures.push(W))})}function kt(ve,W){const Ze=r.getView(),Re=Ir([ve,W],"EPSG:4326",Ze.getProjection());Ze.setCenter(Re)}function hn(ve,W,Ze){const Re=[ve,W],ce=r.getView(),me=Ir(Re,"EPSG:4326",ce.getProjection());ue(me,Ze)}function wn(){H&&H.getSource()&&H.getSource().clear(),ge()}function Ge(ve){switch(ve){case 0:return"north";case 1:case 2:case 3:return"west";case 4:return"south";case 5:case 6:case 7:return"east";default:return"north"}}return Ms(()=>{E&&r&&r.removeInteraction(E),T&&r&&r.removeInteraction(T),k&&r&&r.removeInteraction(k),H&&r&&r.removeLayer(H),$&&r&&r.removeLayer($),ae&&r&&r.removeLayer(ae),fe&&r&&r.removeLayer(fe),ge()}),{routingState:s,distance:l,time:u,elevationGain:h,elevationLoss:d,routeDesc:m,profileData:y,hasResult:x,showRedirect:C,isRoute:w,init:D,whereAmI:ze,clearRoutes:je,clearRoute:qe,addRoute:yt,exchangeRoutes:xt,center:kt,highlightPosition:hn,clearHighlight:wn,getIconDirectionClass:Ge,setRoutePoint:Ee,recalculateRoute:()=>{Et(),t(s.value)},getDistance:()=>l.value,getTime:()=>u.value,getElevationGain:()=>h.value,getElevationLoss:()=>d.value,getRoutes:()=>s.value.routes,getMode:()=>s.value.transportMode,setMode:ve=>{s.value.transportMode=ve,t(s.value)},getCriteria:()=>s.value.criteria,setCriteria:ve=>{s.value.criteria=ve,t(s.value)}}}function awe(){const n=Ue(!1),e=Ue([]);async function t(r){if(!r||r.length<2)return e.value=[],[];n.value=!0;try{const l=await(await ks("https://migration.geoportail.lu/fulltextsearch",{query:r,limit:10,layer:"Adresse,Parcelle,nom_de_rue,lieu_dit"},"GET")).json(),u=[];return l.features&&Array.isArray(l.features)&&l.features.forEach(h=>{const d=h.properties.label+(h.properties.layer_name?` (${h.properties.layer_name})`:"");let m;if(h.geometry){const y=h.geometry;if(y.type==="Point"&&y.coordinates)m=y.coordinates;else if(y.coordinates){const x=y.coordinates;Array.isArray(x)&&x.length>0&&(Array.isArray(x[0])&&x[0].length>=2?m=[x[0][0],x[0][1]]:x.length>=2&&(m=[x[0],x[1]]))}}u.push({label:d,layer_name:h.properties.layer_name||"",coordinates:m,feature:h})}),e.value=u,u}catch{return e.value=[],[]}finally{n.value=!1}}function i(){e.value=[]}return{searchAddresses:t,clearSearch:i,isSearching:n,searchResults:e}}const lwe={class:"routing-modes mb-4"},uwe={class:"flex gap-2 mb-3"},cwe=["title","aria-label","aria-pressed"],hwe=["title","aria-label","aria-pressed"],dwe=["title","aria-label","aria-pressed"],fwe=["title","aria-label"],pwe=["title","aria-label"],gwe=["title","aria-label"],mwe={class:"routing-routes mb-4",ref:"sortableRoutes"},ywe=["data-route-id"],_we={class:"route-number drag-handle"},vwe={class:"route-input-wrapper flex-1"},bwe=["onUpdate:modelValue","placeholder","route-number","aria-expanded","aria-haspopup","aria-activedescendant","aria-describedby","onInput","onBlur","onFocus","onKeydown"],xwe=["aria-label"],Iwe={id:"address-help-{{ key }}",class:"sr-only"},Cwe=["id","aria-selected","onClick","onMouseenter"],wwe={class:"tooltip-container"},Awe=["onClick","title","aria-label"],Swe=["onClick","aria-label"],Ewe={class:"tooltip routing-tooltip"},Twe={class:"current-location"},Rwe={class:"flex gap-2 mb-4"},Mwe={class:"relative"},kwe={key:0,class:"lux-dropdown-list",role:"menu"},Lwe={key:0,class:"route-info-wrapper"},Pwe={class:"mb-4"},Gwe={class:"flex gap-4"},Fwe={class:"text-xs text-tertiary uppercase"},Owe={class:"text-lg font-bold text-white"},Nwe={class:"text-xs text-tertiary uppercase"},Dwe={class:"text-lg font-bold text-white"},Vwe={key:0,class:"mb-4"},Bwe={class:"text-white mb-2"},Zwe={class:"mb-4"},Wwe={class:"flex justify-between items-center mb-2"},zwe={class:"text-white"},Uwe=["title"],Xwe={class:"route-details-scroll"},Ywe=["onMouseover","onClick"],Hwe={class:"route-instruction"},Kwe={class:"route-instruction-data"},jwe={key:1,class:"lux-alert lux-alert-info mb-3"},$we={class:"mt-1"},Jwe={key:2,class:"lux-alert lux-alert-warning"},qwe=at({__name:"RoutingPanel",props:{maxExtent:{},poiSearchServiceUrl:{}},setup(n){const{i18next:e,t}=St(),i=Jn(),r=iu(),{addNotification:o}=Qr(),{getOlMap:s}=Kn(),l="https://map.geoportail.lu/router/getroute",u=n,h=gA(),{startCoordinate:d,startLabel:m,targetRouteIndex:y}=It(h),x=wy("sortableRoutes"),C=Ue([0,1]),{routingState:w,distance:E,time:T,routeDesc:k,profileData:G,isRoute:O,showRedirect:V,init:z,whereAmI:H,clearRoutes:te,clearRoute:$,addRoute:ae,exchangeRoutes:fe,center:Y,highlightPosition:de,clearHighlight:D,getIconDirectionClass:oe,setMode:ue,setCriteria:ge,setRoutePoint:Ne,recalculateRoute:Ee}=owe(u.maxExtent,u.poiSearchServiceUrl,async Ie=>{if(!Ie.map)return;const pe=Ie.map.getView().getProjection(),Te=[];if(Ie.features.forEach(tt=>{const nt=tt.getGeometry();if(nt&&nt instanceof zi){const bt=Ir(nt.getFirstCoordinate(),pe,"EPSG:4326");Te.push(`${bt[1]},${bt[0]}`)}}),Te.length<2)return;const We=new URLSearchParams({avoid:"",criteria:String(Ie.criteria??0),lang:e.language||"fr",transportMode:String(yt(Ie.transportMode)),waypoints:Te.join(",")});try{const tt=await fetch(`${l}?${We.toString()}`);if(!tt.ok)return;const nt=await tt.json(),on=new Qa().readFeatures(nt,{dataProjection:"EPSG:4326",featureProjection:pe});Ie.routeFeatures.clear(),Ie.stepFeatures.clear(),on.forEach(an=>{Ie.routeFeatures.push(an)})}catch(tt){console.error("[Routing] Error fetching route:",tt)}},async Ie=>({count:0,results:[]})),se=Ue(!1),{searchAddresses:q,searchResults:j}=awe(),ze=Ue(null),je=Ue(-1),qe=Ue(null);function yt(Ie){return Ie===3?0:Ie===1?1:Ie===2?2:0}Pt([d,m,y],([Ie,pe,Te])=>{Ie&&pe&&(Ne(Te||0,Ie,pe),no(()=>{h.startCoordinate=null,h.startLabel=""}))}),sr(()=>{d.value&&m.value&&(Ne(y.value||0,d.value,m.value),no(()=>{h.startCoordinate=null,h.startLabel=""}))}),Pt(j,Ie=>{Ie.length>0&&ze.value!==null?(je.value=0,no(()=>Ge(ze.value))):je.value=-1});function xt(Ie){qe.value&&clearTimeout(qe.value),qe.value=window.setTimeout(()=>{const pe=w.value.routes[Ie];pe&&pe.length>=2?(ze.value=Ie,q(pe)):ze.value=null},300)}function Et(Ie,pe){w.value.routes[Ie]=pe.label,ze.value=null,je.value=-1,pe.coordinates&&Ne(Ie,pe.coordinates,pe.label)}function kt(Ie){ze.value=Ie,j.value.length>0?(je.value=0,Ge(Ie)):je.value=-1}function hn(Ie){setTimeout(()=>{ze.value===Ie&&(ze.value=null,je.value=-1)},150)}function wn(Ie,pe){if(!(ze.value!==pe||j.value.length===0))switch(Ie.key){case"ArrowDown":Ie.preventDefault(),je.value=Math.min(je.value+1,j.value.length-1),Ge(pe);break;case"ArrowUp":Ie.preventDefault(),je.value=Math.max(je.value-1,0),Ge(pe);break;case"Enter":Ie.preventDefault(),je.value>=0&&je.value<j.value.length&&Et(pe,j.value[je.value]);break;case"Escape":Ie.preventDefault(),ze.value=null,je.value=-1;break}}function Ge(Ie){no(()=>{const pe=document.getElementById(`address-${Ie}-${je.value}`);pe&&pe.scrollIntoView({behavior:"smooth",block:"nearest"})})}function ve(Ie){je.value=Ie,ze.value!==null&&Ge(ze.value)}function W(Ie){return Ie>=1e3?`${(Ie/1e3).toFixed(2)} km`:`${Math.round(Ie)} m`}function Ze(Ie){const pe=Math.floor(Ie/3600),Te=Math.floor((Ie-pe*3600)/60),We=Math.floor(Ie-pe*3600-Te*60),tt=nt=>nt<10?"0"+nt:nt.toString();return`${tt(pe)}:${tt(Te)}:${tt(We)}`}function Re(){se.value=!se.value}function ce(Ie){ge(Ie),se.value=!1}function me(){const Ie=h.routeFeatures.getArray().filter(Te=>Te.getGeometry()?.getType()==="LineString");if(Ie.length===0){o(t("Aucune route  exporter"),ii.WARNING);return}const pe=s();pe&&Ob.export(pe,"gpx",Ie,"Route",!0)}async function _e(){if(!r.isAuthenticated()){o(t("Veuillez vous identifier afin d'accder  vos cartes"),ii.INFO),i.toggleAuthFormOpen(!0);return}const Ie=t("Route du",{ns:"client"})+" "+new Date().toLocaleDateString(e.language,{day:"2-digit",month:"2-digit",year:"numeric"}),pe=w.value.routes[0]+" - "+w.value.routes[w.value.routes.length-1];try{const Te=await $B(Ie,pe,999,!1);if(!Te.success||!Te.uuid){o(t("Erreur lors de la cration de la carte"),ii.ERROR);return}const We=Te.uuid;i.myMapId=We;const tt=[...h.routeFeatures.getArray(),...h.stepFeatures.getArray()];await Promise.all(tt.map(async nt=>{const bt=new Qa().writeFeatureObject(nt,{dataProjection:"EPSG:2169",featureProjection:s()?.getView().getProjection()});await HC(We,JSON.stringify(bt))})),o(t("Une copie de votre route a t enregistre dans Mymaps.",{ns:"client"}),ii.INFO),i.toggleMyMapsOpen(!0)}catch(Te){console.error("[Routing] Error creating map from route:",Te),o(t("Erreur lors de la sauvegarde de la route"),ii.ERROR)}}return sr(()=>{z(),x.value&&yw(x.value,{onSort:()=>{const Ie=x.value;if(!Ie)return;const pe=[],Te=[],We=[];for(const nt of Ie.children)if(nt.classList.contains("routing-route-container")){const bt=parseInt(nt.getAttribute("data-route-id")||"0",10);pe.push(bt);const on=C.value.indexOf(bt);if(on>=0){Te.push(w.value.routes[on]||"");const an=w.value.features.getArray()[on];an&&We.push(an)}}pe.some((nt,bt)=>nt!==C.value[bt])&&(C.value.splice(0,C.value.length,...pe),w.value.routes.splice(0,w.value.routes.length,...Te),w.value.features.clear(),We.forEach(nt=>w.value.features.push(nt)),Ee())}})}),(Ie,pe)=>(U(),Gt(Lf,{"data-cy-value":"routingPanel","close-fn":()=>M(i).toggleRoutingOpen(!1)},{header:Wt(()=>[P("h1",null,K(M(t)("itineraire",{ns:"client"})),1)]),content:Wt(()=>[P("div",lwe,[P("div",uwe,[P("button",{class:Rn(["mode-btn",{"mode-btn-active":M(w).transportMode===3}]),onClick:pe[0]||(pe[0]=Te=>M(ue)(3)),title:M(t)("Car mode"),"aria-label":M(t)("Mode voiture"),"aria-pressed":M(w).transportMode===3},[...pe[11]||(pe[11]=[P("span",{class:"fa fa-car","aria-hidden":"true"},null,-1)])],10,cwe),P("button",{class:Rn(["mode-btn",{"mode-btn-active":M(w).transportMode===1}]),onClick:pe[1]||(pe[1]=Te=>M(ue)(1)),title:M(t)("Pedestrian mode"),"aria-label":M(t)("Mode piton"),"aria-pressed":M(w).transportMode===1},[...pe[12]||(pe[12]=[P("span",{class:"fa fa-male","aria-hidden":"true"},null,-1)])],10,hwe),P("button",{class:Rn(["mode-btn",{"mode-btn-active":M(w).transportMode===2}]),onClick:pe[2]||(pe[2]=Te=>M(ue)(2)),title:M(t)("Bicycle mode"),"aria-label":M(t)("Mode vlo"),"aria-pressed":M(w).transportMode===2},[...pe[13]||(pe[13]=[P("span",{class:"fa fa-bicycle","aria-hidden":"true"},null,-1)])],10,dwe),M(O)?(U(),ie("button",{key:0,class:"mode-btn",onClick:_e,title:M(t)("Save to my maps"),"aria-label":M(t)("Sauvegarder la route dans Mes cartes")},[...pe[14]||(pe[14]=[P("span",{class:"fa fa-save","aria-hidden":"true"},null,-1)])],8,fwe)):Le("",!0),P("button",{class:"mode-btn",onClick:pe[3]||(pe[3]=Te=>M(te)()),title:M(t)("Clear all"),"aria-label":M(t)("Effacer tous les points de route")},[...pe[15]||(pe[15]=[P("span",{class:"fa fa-trash","aria-hidden":"true"},null,-1)])],8,pwe),P("button",{class:"mode-btn",onClick:pe[4]||(pe[4]=Te=>M(fe)()),title:M(t)("Swap start and end"),"aria-label":M(t)("changer dpart et arrive")},[...pe[16]||(pe[16]=[P("span",{class:"fa fa-exchange","aria-hidden":"true"},null,-1)])],8,gwe)])]),P("div",mwe,[(U(!0),ie(Mt,null,hi(M(w).routes,(Te,We)=>(U(),ie("div",{key:C.value[We],class:"routing-route-container mb-2","data-route-id":C.value[We]},[P("div",_we,K(We+1),1),P("div",vwe,[An(P("input",{"onUpdate:modelValue":tt=>M(w).routes[We]=tt,type:"text",autocorrect:"off",autocapitalize:"none",class:"lux-input w-full",placeholder:Ie.$t("Indiquez une adresse, un lieu"),"route-number":We+1,"aria-expanded":ze.value===We&&M(j).length>0,"aria-haspopup":ze.value===We&&M(j).length>0?"listbox":void 0,"aria-activedescendant":ze.value===We&&je.value>=0?`address-${We}-${je.value}`:void 0,"aria-describedby":ze.value===We&&M(j).length>0?`address-help-${We}`:void 0,role:"combobox","aria-autocomplete":"list",onInput:tt=>xt(We),onBlur:tt=>hn(We),onFocus:tt=>kt(We),onKeydown:tt=>wn(tt,We)},null,40,bwe),[[Or,M(w).routes[We]]]),ze.value===We&&M(j).length>0?(U(),ie("div",{key:0,class:"address-dropdown",role:"listbox","aria-label":Ie.$t("Rsultats de recherche d'adresse")},[P("div",Iwe,K(Ie.$t("Utilisez les flches pour naviguer, Entre pour slectionner, chap pour fermer")),1),P("ul",null,[(U(!0),ie(Mt,null,hi(M(j),(tt,nt)=>(U(),ie("li",{key:nt,id:`address-${We}-${nt}`,class:Rn(["address-item",{"address-item-highlighted":je.value===nt}]),role:"option","aria-selected":je.value===nt,onClick:bt=>Et(We,tt),onMouseenter:bt=>ve(nt)},K(tt.label),43,Cwe))),128))])],8,xwe)):Le("",!0)]),P("div",wwe,[M(w).routes[We].length===0?(U(),ie("button",{key:0,class:"mode-btn",onClick:tt=>M(H)(We),title:M(t)("Use my location"),"aria-label":Ie.$t("Utiliser ma position actuelle pour le point {number}",{number:We+1})},[...pe[17]||(pe[17]=[P("span",{class:"fa fa-crosshairs","aria-hidden":"true"},null,-1)])],8,Awe)):(U(),ie("button",{key:1,class:"mode-btn",onClick:tt=>M($)(We),"aria-label":Ie.$t("Effacer le point de route {number}",{number:We+1})},[...pe[18]||(pe[18]=[P("span",{class:"fa fa-trash","aria-hidden":"true"},null,-1)])],8,Swe)),P("div",Ewe,[Bt(K(Ie.$t("Insrez rapidement"))+" ",1),P("span",Twe,K(Ie.$t("votre position actuelle")),1)])])],8,ywe))),128))],512),P("div",Rwe,[P("button",{class:"lux-btn flex-1",onClick:pe[5]||(pe[5]=Te=>M(ae)())},K(Ie.$t("Ajouter une tape")),1),P("div",Mwe,[P("button",{class:"lux-btn whitespace-nowrap",onClick:pe[6]||(pe[6]=Te=>Re())},[Bt(K(M(w).criteria===0?Ie.$t("Le plus rapide"):Ie.$t("Le plus court"))+" ",1),pe[19]||(pe[19]=P("span",{class:"fa fa-chevron-down ml-2"},null,-1))]),se.value?(U(),ie("ul",kwe,[P("li",{class:"lux-dropdown-list-item",onClick:pe[7]||(pe[7]=Te=>ce(0))},K(Ie.$t("Le plus rapide")),1),P("li",{class:"lux-dropdown-list-item",onClick:pe[8]||(pe[8]=Te=>ce(1))},K(Ie.$t("Le plus court")),1)])):Le("",!0)])]),M(O)?(U(),ie("div",Lwe,[P("div",Pwe,[P("div",Gwe,[P("div",null,[P("div",Fwe,K(Ie.$t("Distance")),1),P("div",Owe,K(W(M(E))),1)]),P("div",null,[P("div",Nwe,K(Ie.$t("Temps")),1),P("div",Dwe,K(Ze(M(T))),1)])])]),M(G).length>0?(U(),ie("div",Vwe,[P("h3",Bwe,K(Ie.$t("Dnivel lors de votre trajet")),1),mt($Z)])):Le("",!0),P("div",Zwe,[P("div",Wwe,[P("h3",zwe,K(Ie.$t("Dtail de votre trajet")),1),P("button",{class:"text-secondary hover:text-white text-sm",onClick:pe[9]||(pe[9]=Te=>me()),title:M(t)("Download GPX")},[pe[20]||(pe[20]=P("span",{class:"fa fa-download mr-1"},null,-1)),Bt(" "+K(Ie.$t("Tlcharger")),1)],8,Uwe)]),P("div",Xwe,[(U(!0),ie(Mt,null,hi(M(k),(Te,We)=>(U(),ie("div",{key:We,class:"route-details-step",onMouseleave:pe[10]||(pe[10]=tt=>M(D)()),onMouseover:tt=>M(de)(Te.lon,Te.lat,Te.description),onClick:tt=>M(Y)(Te.lon,Te.lat)},[P("div",Hwe,[P("span",{class:Rn(["icon-Direction",M(oe)(Te.direction)])},null,2),Bt(" "+K(Te.description),1)]),P("div",Kwe,K(W(Te.cumulativeDistance||0))+"  "+K(Ze(Te.cumulativeTime||0)),1)],40,Ywe))),128))])])])):Le("",!0),M(O)?Le("",!0):(U(),ie("div",jwe,[P("strong",null,K(Ie.$t("Petite astuce!")),1),P("p",$we,K(Ie.$t("Cliquez droit (ou appui long sur mobile)  un endroit sur la carte pour ajouter rapidement une adresse.")),1)])),M(V)?(U(),ie("div",Jwe,K(Ie.$t("Pour utiliser la golocalisation, veuillez utiliser une connexion scurise (HTTPS)")),1)):Le("",!0)]),_:1},8,["close-fn"]))}}),Qwe=es(qwe,[["__scopeId","data-v-40c51b53"]]),eAe={class:"lux-menu-popup"},tAe=["aria-expanded","aria-label"],nAe=["aria-label","aria-labelledby"],Hk=at({__name:"menu-popup",props:{items:{},direction:{},ariaLabel:{},ariaLabelledby:{}},setup(n){const e=n,t=mi(!1),i=Ue(null),r=Ue(null),o=Ue(-1);function s(C){C.stopPropagation(),l()}function l(C){const w=t.value;t.value=C??!t.value,!w&&t.value?(o.value=0,setTimeout(()=>{y(0),r.value?.focus()},100)):w&&!t.value&&(o.value=-1,i.value?.focus())}function u(){l(!1)}function h(C){if(!t.value){["Enter"," ","ArrowDown"].includes(C.key)&&(C.preventDefault(),C.stopPropagation(),l(!0));return}switch(C.key){case"Escape":C.preventDefault(),C.stopPropagation(),l(!1);break;case"ArrowDown":C.preventDefault(),C.stopPropagation(),d();break;case"ArrowUp":C.preventDefault(),C.stopPropagation(),m();break;case"ArrowLeft":case"ArrowRight":C.preventDefault(),C.stopPropagation();break;case"Home":C.preventDefault(),C.stopPropagation(),y(0);break;case"End":C.preventDefault(),C.stopPropagation(),y(e.items.length-1);break;case"Tab":C.stopPropagation(),l(!1);break;default:C.stopPropagation();break}}function d(){const C=(o.value+1)%e.items.length;y(C)}function m(){const C=o.value<=0?e.items.length-1:o.value-1;y(C)}function y(C){if(o.value=C,!r.value)return;const w=r.value.querySelectorAll('[role="menuitem"]');if(!(!w||w.length===0)&&w[C])try{w[C].focus()}catch(E){console.error("[MenuPopup] Error focusing item:",E)}}function x(C){if(t.value)try{h(C)}catch(w){console.error("[MenuPopup] Error in handleGlobalKeyDown:",w)}}return sr(()=>{document.addEventListener("click",u),document.addEventListener("keydown",x,!0)}),Ms(()=>{document.removeEventListener("click",u),document.removeEventListener("keydown",x,!0)}),Pt(t,C=>{if(!C)return;const w=i.value,E=r.value,T=w.getBoundingClientRect(),k=e.direction==="down"?T.bottom:T.top-E.offsetHeight;E.style.top=`${k}px`,E.style.left=`${T.left+T.width-E.offsetWidth}px`}),(C,w)=>(U(),ie("div",eAe,[P("button",{onClick:s,onKeydown:h,ref_key:"btnElement",ref:i,"aria-expanded":t.value,"aria-haspopup":!0,"aria-label":n.ariaLabel},[ei(C.$slots,"default")],40,tAe),(U(),Gt(kw,{to:"body"},[P("ul",{"aria-label":n.ariaLabel,"aria-labelledby":n.ariaLabelledby,class:Rn(["lux-menu-popup-list",t.value?"":"invisible"]),ref_key:"ddElement",ref:r,role:"menu",tabindex:"-1"},[(U(!0),ie(Mt,null,hi(e.items,(E,T)=>(U(),ie("li",{key:E.label,class:Rn(E.separator?"border-b-[1px] pb-2 mb-2":""),role:"none"},[E.label?ei(C.$slots,"item",{key:0,item:E,index:T,isFocused:o.value===T},()=>[Bt(K(E.label)+" "+K(E.separator),1)]):Le("",!0)],2))),128))],10,nAe)]))]))}}),Kk=at({__name:"menu-popup-item",props:{item:{},index:{},isFocused:{type:Boolean}},emits:["click"],setup(n,{emit:e}){const t=n,i=e;function r(){i("click",t.item)}function o(s){s.key==="Enter"||s.key===" "?(s.preventDefault(),s.stopPropagation(),r()):s.stopPropagation()}return(s,l)=>(U(),ie("button",{class:"lux-dropdown-list-item",onClick:r,onKeydown:ps(o,["stop"]),role:"menuitem",tabindex:"-1"},[ei(s.$slots,"default",{},()=>[Bt(K(n.item.label),1)])],32))}});class iAe extends Zc{dragSegments_;features_;lastPixel_=[0,0];listener;modified_=!1;overlay_;pixelTolerance_=10;rBush_=new PC;snappedToVertex_=!1;vertexFeature_=null;constructor(){super({handleDownEvent:oAe,handleEvent:aAe,handleUpEvent:sAe}),this.features_=new Ts,this.overlay_=cv.createOlLayerInteractionClip()}get overlay(){return this.overlay_}addFeature_(e){if(e.getGeometry()?.getType()==="LineString"){const t=e.getGeometry(),i=this.getMap();this.writeLineStringGeometry_(e,t),i&&this.lastPixel_[0]!==0&&this.lastPixel_[1]!==0&&this.handlePointerAtPixel_(this.lastPixel_,i)}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource()?.removeFeature(this.vertexFeature_),this.vertexFeature_=null),this.listener&&mr(this.listener)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(r){e===r.feature&&i.push(r)});for(let r=i.length-1;r>=0;--r)t.remove(i[r])}setMap(e){super.setMap(e),this.features_&&(this.features_.on("add",t=>{this.addFeature_(t.element)}),this.features_.on("remove",t=>{this.removeFeature_(t.element)}))}handleFeatureChange_(e){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}handleFeatureChanged(e){this.removeFeature_(e),this.addFeature_(e)}writeLineStringGeometry_(e,t){const i=t.getCoordinates();let r,o,s,l;for(r=0,o=i.length-1;r<o;++r)s=i.slice(r,r+2),l={feature:e,geometry:t,index:r,segment:s},this.rBush_.insert(Js(s),l)}createOrUpdateVertexFeature_(e){let t=this.vertexFeature_;return t?t.getGeometry().setCoordinates(e):(t=new yi(new zi(e)),this.vertexFeature_=t,this.overlay_.getSource()?.addFeature(t)),t}setActive(e){this.handlingDownUpSequence=!1,this.overlay_!==void 0&&this.vertexFeature_&&(this.overlay_.getSource()?.removeFeature(this.vertexFeature_),this.vertexFeature_=null);const t=this.getMap();t&&(e?t.getTargetElement().style.cursor="crosshair":t.getTargetElement().style.cursor=""),super.setActive(e)}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map)}handlePointerAtPixel_(e,t){if(!this.getActive())return;const i=t.getCoordinateFromPixel(e),r=function(u,h){return zE(i,u.segment)-zE(i,h.segment)},o=Kh(sy(i),t.getView().getResolution()*this.pixelTolerance_),l=this.rBush_.getInExtent(o);if(l.length>0){l.sort(r);const h=l[0].segment;let d=fb(i,h);const m=t.getPixelFromCoordinate(d);if(Math.sqrt(Oh(e,m))<=this.pixelTolerance_){const y=t.getPixelFromCoordinate(h[0]),x=t.getPixelFromCoordinate(h[1]),C=Oh(m,y),w=Oh(m,x),E=Math.sqrt(Math.min(C,w));this.snappedToVertex_=E<=this.pixelTolerance_,this.snappedToVertex_&&(d=C>w?h[1]:h[0]),this.createOrUpdateVertexFeature_(d);return}}this.vertexFeature_&&(this.overlay_.getSource()?.removeFeature(this.vertexFeature_),this.vertexFeature_=null)}}function rAe(n,e){return n.index-e.index}function sAe(){return this.handlingDownUpSequence=!1,!1}function oAe(n){if(!this.getActive())return!1;this.handlePointerAtPixel_(n.pixel,n.map),this.dragSegments_=[],this.modified_=!1;const e=this.vertexFeature_;if(e){const i=e.getGeometry().getCoordinates(),r=Js([i]),o=this.rBush_.getInExtent(r);o.sort(rAe);for(let s=0,l=o.length;s<l;++s){const u=o[s];if(u.feature!==void 0&&this.features_.getArray().indexOf(u.feature)>=0){const h=fb(i,u.segment);if(!Jo(h,i)){this.getActive()&&this.dispatchEvent(new Vo("clickmiss"));continue}this.features_.remove(u.feature);const d=u.feature.id;d&&u.feature.set("originalFeatureId",d);const m=u.feature.clone(),y=u.feature.clone(),x=m.getGeometry(),C=y.getGeometry(),w=u.feature.getGeometry(),E=w.getCoordinates().slice(0,[u.index+1]);E.push(i);const T=w.getCoordinates().slice([u.index+1]);E.push(i),T.splice(0,0,i),x.setCoordinates(E),C.setCoordinates(T),this.features_.push(m),this.features_.push(y),this.dispatchEvent(new wI("modifyend",new Ts([m,y,u.feature]),n)),this.modified_=!0}}}else this.getActive()&&this.dispatchEvent(new Vo("clickmiss"));return this.handlePointerAtPixel_(n.pixel,n.map),!!this.vertexFeature_}function aAe(n){return n instanceof gc?(!n.map.getView().getHints()[Jr.INTERACTING]&&n.type=="pointermove"&&!this.handlingDownUpSequence&&this.handlePointerMove_(n),Zc.prototype.handleEvent.call(this,n)):!0}function lAe(){const{t:n}=St(),e=zr(),t=Kn().getOlMap(),{addNotification:i}=Qr(),{clipLineActive:r,queueAddedDrawnFeatures:o,drawnFeatures:s,activeFeatureId:l}=It(e),{generateDrawnFeature:u}=yA(),h=new iAe;sr(()=>{t.addLayer(h.overlay),t.addInteraction(h),mn(h,"clickmiss",()=>{r.value&&i(n("Vous tes en mode dcoupage.<br> Veuillez cliquer sur une ligne pour la couper en deux."))}),mn(h,"modifyend",m=>{const y=m.features.getArray();if(y.length>=3){const[x,C,w]=y,E=w.get("originalFeatureId");if(!E){console.error("[ClipLine] Could not find original feature ID");return}const T=w.getProperties();Object.keys(T).forEach(z=>{z!=="geometry"&&z!=="id"&&z!=="originalFeatureId"&&(x.set(z,T[z]),C.set(z,T[z]))});const k=t.getAllLayers().filter(z=>z.get&&z.get("cyLayerType")==="interactionDrawLayer");if(k.length>0){const H=k[0].getSource();H&&H.removeFeature(w)}e.removeFeature(E);let G,O;typeof w.clone=="function"&&w.featureStyle!==void 0?(G=w.clone(),G.setGeometry(x.getGeometry().clone()),O=w.clone(),O.setGeometry(C.getGeometry().clone())):(G=u(x),O=u(C)),e.addDrawnFeatureToCollection(G),e.addDrawnFeatureToCollection(O),r.value=!1}})}),Pt(r,m=>{h.setActive(m),m&&i(n("Vous tes en mode dcoupage.<br> Veuillez cliquer sur une ligne pour la couper en deux."))}),Pt(o,m=>{m.length!==0&&no(()=>{m.forEach(y=>{if(r.value){const x=h.features_;x&&!x.getArray().includes(y)&&x.push(y)}}),o.value=[]})}),Pt(l,m=>{if(!r.value||!m)return;const y=h.features_;if(!y)return;const x=s.value.find(C=>C.id===m);x&&x.featureType==="drawnLine"&&(y.getArray().includes(x)||y.push(x))}),Pt(r,m=>{const y=h.features_;if(y)if(m){if(l.value){const x=s.value.find(C=>C.id===l.value);x&&x.featureType==="drawnLine"&&(y.getArray().includes(x)||y.push(x))}}else y.clear()});function d(m){r.value=m??!r.value}return{toggle:d}}const uAe=at({__name:"feature-menu-popup",emits:["newConcentricCircle","continueLine"],setup(n,{emit:e}){const{t}=St(),i=Rf(),r=Do("feature"),o=e,s=Ct(()=>r.map_id?!!i.isMyMapEditable.value:!0);function l(h){Ob.export(r.map,h,[r],r.label,!0)}let u=[{label:"Exporter un GPX",action:()=>l("gpx")},{label:"Exporter un KML",action:()=>l("kml")},{label:"Exporter un Shapefile",action:()=>l("shapefile")}];return r?.featureType==="drawnLine"&&s.value&&(u=[...u,{label:"Continuer la ligne",action:()=>o("continueLine")},{label:"Changer sens de la ligne",action:()=>lZ(r)}]),r?.featureType==="drawnCircle"&&s.value&&(u=[...u,{label:"Crer cercle concentrique",action:()=>o("newConcentricCircle")}]),(h,d)=>(U(),Gt(Hk,{"data-cy":"featMenuPopup",items:M(u),direction:"up",ariaLabel:M(t)("Drawings menu")},{item:Wt(({item:m})=>[mt(Kk,{"data-cy":"featMenuPopupItem",item:m,onClick:()=>m.action&&m.action()},{default:Wt(()=>[Bt(K(M(t)(m.label)),1)]),_:2},1032,["item","onClick"])]),default:Wt(()=>[d[0]||(d[0]=P("i",{class:"fa-solid fa-square-caret-down hover:text-tertiary"},null,-1))]),_:1},8,["items","ariaLabel"]))}}),g3=at({__name:"feature-confirm-delete",emits:["cancel","validate"],setup(n){const{t:e}=St();return(t,i)=>(U(),ie(Mt,null,[Bt(K(M(e)("tes-vous certain de vouloir effacer cet lment de la carte ?"))+" ",1),ei(t.$slots,"footer")],64))}}),m3=at({__name:"feature-edit-info",emits:["cancel","validate"],setup(n){const{t:e}=St(),t=Do("feature");return(i,r)=>(U(),ie(Mt,null,[Bt(K(M(e)("Modification des informations"))+" ",1),M(t)?An((U(),ie("input",{key:0,"data-cy":"featureLabelEdit",type:"text",class:"form-control block mt-2 mb-4","onUpdate:modelValue":r[0]||(r[0]=o=>M(t).label=o)},null,512)),[[Or,M(t).label]]):Le("",!0),M(t)?An((U(),ie("textarea",{key:1,rows:"3",class:"form-control block w-full","onUpdate:modelValue":r[1]||(r[1]=o=>M(t).description=o)},null,512)),[[Or,M(t).description]]):Le("",!0),ei(i.$slots,"footer")],64))}}),cAe={class:"flex"},hAe=["min","max","name","step"],dAe=["min","max","name","step"],tI=at({__name:"range-input",props:{min:{default:0},max:{default:10},step:{default:1},value:{default:0},name:{default:"range"}},emits:["change"],setup(n){const t=Ue(n.value);return(i,r)=>(U(),ie("div",cAe,[An(P("input",{type:"range",class:"m-2.5 w-16 h-[5px] rounded-lg appearance-none cursor-pointer",min:n.min,max:n.max,name:`range-${n.name}`,step:n.step,"onUpdate:modelValue":r[0]||(r[0]=o=>t.value=o),onInput:r[1]||(r[1]=o=>i.$emit("change",t.value))},null,40,hAe),[[Or,t.value,void 0,{number:!0}]]),An(P("input",{type:"number",class:"w-12",min:n.min,max:n.max,name:n.name,step:n.step,"onUpdate:modelValue":r[2]||(r[2]=o=>t.value=o),onChange:r[3]||(r[3]=o=>i.$emit("change",t.value))},null,40,dAe),[[Or,t.value]])]))}}),fAe=at({__name:"feature-edit-style-circle",props:{feature:{}},setup(n){return(e,t)=>(U(),ie(Mt,null,[ei(e.$slots,"title"),ei(e.$slots,"color"),ei(e.$slots,"lineWidth"),ei(e.$slots,"transparency"),ei(e.$slots,"footer")],64))}}),pAe=at({__name:"feature-edit-style-point",props:{feature:{}},setup(n){const e=Ue(!1);function t(){e.value=!1}return(i,r)=>e.value?ei(i.$slots,"symbolIcon",{key:1,closeEditIcon:t},()=>[ei(i.$slots,"symbolcolor")]):(U(),ie(Mt,{key:0},[ei(i.$slots,"title"),ei(i.$slots,"color"),ei(i.$slots,"styleSymbol",{openEditIcon:()=>e.value=!0}),ei(i.$slots,"size",{maxsize:900}),ei(i.$slots,"angle"),ei(i.$slots,"footer")],64))}}),gAe=at({__name:"feature-edit-style-line",props:{feature:{}},setup(n){return(e,t)=>(U(),ie(Mt,null,[ei(e.$slots,"title"),ei(e.$slots,"color"),ei(e.$slots,"lineWidth"),ei(e.$slots,"style"),ei(e.$slots,"orientation"),ei(e.$slots,"footer")],64))}}),mAe=at({__name:"feature-edit-style-polygon",props:{feature:{}},setup(n){return(e,t)=>(U(),ie(Mt,null,[ei(e.$slots,"title"),ei(e.$slots,"color"),ei(e.$slots,"lineWidth"),ei(e.$slots,"transparency"),ei(e.$slots,"footer")],64))}}),yAe=at({__name:"feature-edit-style-label",props:{feature:{}},setup(n){return(e,t)=>(U(),ie(Mt,null,[ei(e.$slots,"title"),ei(e.$slots,"color"),ei(e.$slots,"size",{maxsize:40}),ei(e.$slots,"angle"),ei(e.$slots,"footer")],64))}}),_Ae=at({__name:"feature-edit-linestyle-item",props:{linestyle:{}},emits:["changeLinestyle"],setup(n,{emit:e}){const{t}=St(),i=e,r=Do("feature");function o(s){i("changeLinestyle",s)}return(s,l)=>(U(),ie("button",{class:Rn(`lux-btn-grey${M(r).featureStyle.linestyle===n.linestyle?" pressed":""}`),onClick:l[0]||(l[0]=u=>o(n.linestyle))},K(M(t)(M(Hoe)(n.linestyle))),3))}}),vAe=["cx","cy","r","fill"],Iz=at({__name:"circleSymbol",props:{radius:{default:9},fillColor:{default:"red"}},setup(n){const t=n.radius*2;return(i,r)=>(U(),ie("svg",{height:t,width:t},[P("circle",{cx:n.radius,cy:n.radius,r:n.radius,fill:n.fillColor},null,8,vAe)]))}}),bAe=["height","width"],xAe=["fill"],Cz=at({__name:"squareSymbol",props:{fillColor:{default:"red"},height:{default:18},width:{default:18}},setup(n){return(e,t)=>(U(),ie("svg",{height:n.height,width:n.width},[P("rect",{height:"100%",width:"100%",fill:n.fillColor},null,8,xAe)],8,bAe))}}),IAe=["height","width"],CAe=["y","font-size","fill"],wz=at({__name:"crossSymbol",props:{fillColor:{default:"red"},fontSize:{default:42},height:{default:18},width:{default:18}},setup(n){return(e,t)=>(U(),ie("svg",{height:n.height,width:n.width},[P("text",{x:"1",y:n.height+2,"font-size":n.fontSize,fill:n.fillColor},"+",8,CAe)],8,IAe))}}),wAe=["height","width"],AAe=["fill"],Az=at({__name:"triangleSymbol",props:{fillColor:{default:"red"},size:{default:18}},setup(n){const e=n,t=e.size/2,i=`0,${e.size} ${t},0 ${e.size},${e.size}`;return(r,o)=>(U(),ie("svg",{height:n.size,width:n.size},[P("polygon",{points:i,fill:n.fillColor},null,8,AAe)],8,wAe))}}),SAe={class:"flex gap-2 items-center mt-1 mb-2"},EAe={class:"font-bold block"},TAe=["src"],RAe=at({__name:"feature-edit-style-symbol",emits:["clickSymbolIcon"],setup(n){const e="https://migration.geoportail.lu/mymaps/symbol",{t}=St(),i=Do("feature"),r={circle:Iz,square:Cz,cross:wz,triangle:Az};return(o,s)=>(U(),ie("div",SAe,[P("label",EAe,K(M(t)("Symbol")),1),M(i).featureStyle.symbolId?(U(),ie("button",{key:0,class:"lux-btn items-center",onClick:s[0]||(s[0]=l=>o.$emit("clickSymbolIcon")),"data-cy":"featStyleSymbolEdit"},[P("img",{class:"symbol-style max-h-10",src:`${M(e)}/${M(i).featureStyle.symbolId}`},null,8,TAe)])):(U(),ie("button",{key:1,class:"lux-btn items-center flex gap-2",onClick:s[1]||(s[1]=l=>o.$emit("clickSymbolIcon")),"data-cy":"featStyleSymbolEdit"},[Bt(K(M(t)("Symbole"))+" ",1),M(i).featureStyle.shape?(U(),Gt(cb(r[M(i).featureStyle.shape]),{key:0,fillColor:M(i).featureStyle.color},null,8,["fillColor"])):Le("",!0)]))]))}}),Sz="https://migration.geoportail.lu/mymaps/symbols",MAe="https://migration.geoportail.lu/mymaps",kAe="http://migration.geoportail.lu/mymaps/upload_symbol";let mE,yE;async function LAe(n=!1){return(!mE?.results||n)&&(mE=await(await ks(Sz,{symboltype:"public"},"GET")).json()),mE?.results}async function PAe(n=!1){return(!yE?.results||n)&&(yE=await(await ks(Sz,{symboltype:"us"},"GET")).json()),yE?.results}async function GAe(n){const e=new FormData;return e.append("file",n),await ks(kAe,e,"POST")}const FAe=["placeholder"],OAe=["id","title","onClick"],NAe={class:"w-12"},DAe=["src"],VAe={class:"break-all"},BAe=at({__name:"feature-edit-symbol-list",props:{symbols:{}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,{t:r}=St(),o=Ue(""),s=Ct(()=>o.value?t.symbols.filter(u=>u.name.includes(o.value)):t.symbols);function l(u){i("change",u)}return(u,h)=>(U(),ie("div",null,[An(P("input",{"data-cy":"featStyleSymbolFilterList",class:"text-white w-full placeholder-white border-[1px] border-gray-300 mb-2",type:"text",placeholder:M(r)("Rechercher un symbole"),"onUpdate:modelValue":h[0]||(h[0]=d=>o.value=d)},null,8,FAe),[[Or,o.value,void 0,{trim:!0}]]),Bt(" "+K(M(r)("Symbole"))+" ",1),P("ul",null,[(U(!0),ie(Mt,null,hi(s.value,d=>(U(),ie("li",{key:d.id,class:"border-b-[1px] border-b-gray-300"},[P("button",{id:d.id.toString(),class:"leading-5 p-1 items-center flex hover:bg-slate-100 w-full text-left",title:d.name,onClick:()=>l(d.id),"data-cy":"featStyleSymbolIcon"},[P("span",NAe,[P("img",{class:"max-h-10",src:`${M(MAe)}${d.url}`},null,8,DAe)]),P("span",VAe,K(d.name),1)],8,OAe)]))),128))])]))}}),ZAe={class:"border-b-gray-300 border-b-[1px] mb-2"},WAe=["data-cy","onClick"],zAe={class:"flex gap-1 my-2"},UAe=["onClick","data-cy"],XAe={class:"text-right mt-3"};var Ez=(n=>(n.configurables="Configurables",n.mySymbols="Mes symboles",n.publics="Publics",n))(Ez||{});const YAe=at({__name:"feature-edit-symbol-icon",emits:["close","changeSymbolIcon","changeSymbolShape"],setup(n,{emit:e}){const t=e,{t:i}=St(),{addNotification:r}=Qr(),o=iu(),s=Do("feature"),l={circle:Iz,square:Cz,cross:wz,triangle:Az},u=Ue("Configurables"),h=Ue(void 0),d=Ue([]);Pt(u,async C=>{if(C==="Mes symboles"||C==="Publics")try{d.value=await m(C==="Mes symboles")}catch{d.value=[]}}),sr(()=>{s.featureStyle.symbolId&&(u.value=s.featureStyle.symboltype==="us"?"Mes symboles":"Publics")});async function m(C=!1,w=!1){const E=C?await PAe(w):await LAe(w);return E.sort((T,k)=>T.name.localeCompare(k.name)),E}async function y(){if(h.value?.files&&h.value.files[0]){const C=h.value.files[0];try{await GAe(C),d.value=await m(!0,!0)}catch{r(i("Error while trying to upload new symbol."),ii.ERROR)}}}function x(C){t("changeSymbolShape",C)}return(C,w)=>(U(),ie(Mt,null,[Bt(K(M(i)("Veuillez choisir un symbole dans une des catgories"))+" ",1),P("div",ZAe,[(U(),ie(Mt,null,hi(Ez,(E,T)=>(U(),ie(Mt,{key:T},[T==="mySymbols"&&!M(o).isAuthenticated()?Le("",!0):(U(),ie("button",{key:0,"data-cy":`featStyleSymbolTab${T==="mySymbols"?"_private":""}`,onClick:()=>u.value=E,class:Rn(["lux-tab",{active:u.value===E}])},K(M(i)(E)),11,WAe))],64))),64))]),u.value==="Configurables"?(U(),ie(Mt,{key:0},[P("div",zAe,[(U(!0),ie(Mt,null,hi(Object.keys(l),E=>(U(),ie("button",{key:E,class:"lux-btn p-2 rounded-sm border-gray-600",onClick:T=>x(E),"data-cy":`featStyleSymbol_${E}`},[(U(),Gt(cb(l[E]),{fillColor:M(s).featureStyle.color},null,8,["fillColor"]))],8,UAe))),128))]),ei(C.$slots,"symbolcolor")],64)):Le("",!0),u.value==="Publics"||u.value==="Mes symboles"?(U(),Gt(BAe,{key:1,symbols:d.value,class:"max-h-80 overflow-y-auto",onChange:w[0]||(w[0]=E=>C.$emit("changeSymbolIcon",`${E}`,u.value==="Mes symboles"?"us":"public"))},null,8,["symbols"])):Le("",!0),P("div",XAe,[u.value==="Mes symboles"?(U(),ie(Mt,{key:0},[P("input",{accept:"image/*",ref_key:"fileInput",ref:h,type:"file",id:"file",hidden:"",onChange:y},null,544),P("button",{class:"lux-btn mr-2",onClick:w[1]||(w[1]=()=>h.value?.click())},K(M(i)("Importer un symbole")),1)],64)):Le("",!0),P("button",{class:"lux-btn",onClick:w[2]||(w[2]=()=>C.$emit("close")),"data-cy":"featClosePopup"},K(M(i)("Fermer")),1)])],64))}}),HAe={class:"flex gap-1 items-center"},KAe={class:"font-bold block",for:"color"},jAe={class:"md:w-2/3"},$Ae=["value"],JAe={class:"flex gap-1 items-center mt-1"},qAe={class:"font-bold block",for:"size"},QAe={key:0,class:"flex gap-1 items-center mt-1 mb-2"},e2e={class:"font-bold block",for:"angle"},t2e={class:"flex gap-1 items-center mt-1 mb-2","data-cy":"featStyleLineStyle"},n2e={class:"font-bold block"},i2e={class:"flex gap-1"},r2e={class:"flex gap-1 items-center"},s2e={class:"font-bold block",for:"color"},o2e={class:"md:w-2/3"},a2e=["value"],l2e={class:"flex gap-1 items-center mt-1"},u2e={class:"font-bold block",for:"stroke"},c2e={class:"flex gap-1 items-center mt-1"},h2e={class:"font-bold block",for:"transparency"},d2e={class:"flex gap-2 items-center mt-1 mb-2"},f2e={class:"font-bold block",for:"showOrientation"},p2e=["checked"],g2e={class:"flex gap-1 items-center mt-1 mb-2"},y3=at({__name:"feature-edit-style",emits:["cancel","validate"],setup(n){const{t:e}=St(),t=Do("feature"),i=Ct(()=>!(t.featureType==="drawnPoint"&&t.featureStyle.shape==="circle")),r={FeatureEditStyleCircle:fAe,FeatureEditStyleLine:gAe,FeatureEditStylePoint:pAe,FeatureEditStylePolygon:mAe,FeatureEditStyleLabel:yAe},o=["plain","dashed","dotted"],s=Ct(()=>t?.featureType.replace("drawn","FeatureEditStyle"));function l(T){t.featureStyle={...t.featureStyle,color:T.target.value}}function u(T){t.featureStyle={...t.featureStyle,size:T}}function h(T){t.featureStyle={...t.featureStyle,angle:T*Math.PI/180}}function d(T){t.featureStyle={...t.featureStyle,stroke:T}}function m(T){t.featureStyle={...t.featureStyle,opacity:(100-T)/100}}function y(T){t.featureStyle={...t.featureStyle,showOrientation:T.target.checked}}function x(){lZ(t)}function C(T){t.featureStyle={...t.featureStyle,linestyle:T}}function w(T,k){t.featureStyle={...t.featureStyle,shape:T,symbolId:void 0,symboltype:void 0},k&&k()}function E(T,k,G){t.featureStyle={...t.featureStyle,symbolId:T,symboltype:k,size:100,shape:void 0},G&&G()}return(T,k)=>(U(),Gt(cb(r[s.value]),{feature:M(t)},{title:Wt(()=>[Bt(K(M(e)("Style your drawing")),1)]),color:Wt(()=>[P("div",HAe,[P("label",KAe,K(M(e)("Color")),1),P("div",jAe,[P("input",{name:"color",class:"cursor-pointer",type:"color",value:M(t).featureStyle.color,onInput:l,"data-cy":"featStyleColor"},null,40,$Ae)])])]),size:Wt(G=>[P("div",JAe,[P("label",qAe,K(M(e)("Size")),1),mt(tI,{name:"size",class:"md:w-2/3",max:G.maxsize,value:M(t).featureStyle.size,"data-cy":"featStyleSize",onChange:u},null,8,["max","value"])])]),angle:Wt(()=>[i.value?(U(),ie("div",QAe,[P("label",e2e,K(M(e)("Angle")),1),mt(tI,{name:"angle",class:"md:w-2/3",min:-180,max:180,value:(Math.round(M(t).featureStyle.angle*180/Math.PI)+180)%360-180,onChange:h,"data-cy":"featStyleAngle"},null,8,["value"])])):Le("",!0)]),style:Wt(()=>[P("div",t2e,[P("label",n2e,K(M(e)("Style")),1),P("div",i2e,[(U(),ie(Mt,null,hi(o,(G,O)=>mt(_Ae,{key:O,linestyle:G,onChangeLinestyle:C},null,8,["linestyle"])),64))])])]),styleSymbol:Wt(({openEditIcon:G})=>[mt(RAe,{"data-cy":"featStyleSymbol",onClickSymbolIcon:G},null,8,["onClickSymbolIcon"])]),symbolIcon:Wt(({closeEditIcon:G})=>[mt(YAe,{onChangeSymbolIcon:(O,V)=>E(O,V,G),onChangeSymbolShape:O=>w(O,G),onClose:G},{symbolcolor:Wt(()=>[P("div",r2e,[P("label",s2e,K(M(e)("Color")),1),P("div",o2e,[P("input",{name:"color",class:"cursor-pointer",type:"color",value:M(t).featureStyle.color,onInput:l,"data-cy":"featStyleColor"},null,40,a2e)])])]),_:1},8,["onChangeSymbolIcon","onChangeSymbolShape","onClose"])]),lineWidth:Wt(()=>[P("div",l2e,[P("label",u2e,K(M(e)("Stroke width")),1),mt(tI,{name:"stroke","data-cy":"featStyleLineWidth",value:M(t).featureStyle.stroke,onChange:d},null,8,["value"])])]),transparency:Wt(()=>[P("div",c2e,[P("label",h2e,K(M(e)("Transparence")),1),mt(tI,{name:"transparency",class:"md:w-2/3","data-cy":"featStyleTransparency",max:100,value:100-M(t).featureStyle.opacity*100,onChange:m},null,8,["value"])])]),orientation:Wt(()=>[P("div",d2e,[P("label",f2e,K(M(e)("Show orientation")),1),P("input",{type:"checkbox",id:"showOrientation",onChange:y,checked:M(t).featureStyle.showOrientation},null,40,p2e)]),P("div",g2e,[P("button",{class:"lux-btn-primary",onClick:x},K(M(e)("Changer sens de la ligne")),1)])]),footer:Wt(()=>[ei(T.$slots,"footer")]),_:3},8,["feature"]))}}),m2e={class:"flex gap-2 items-center"},y2e={class:"flex items-center"},_2e={class:"mt-3 text-right"},_3=at({__name:"feature-concentric-circle",emits:["cancel","validate"],setup(n,{emit:e}){const t=e,{t:i}=St(),r=Kn().getOlMap(),o=Do("feature"),s=Ue(parseFloat(Qv(o.getGeometry(),r.getView().getProjection()).toFixed(2)));return(l,u)=>(U(),ie(Mt,null,[Bt(K(M(i)("Veuillez entrer les caractristiques de votre nouveau cercle"))+" ",1),P("div",m2e,[P("span",null,K(M(i)("Rayon:")),1),P("div",y2e,[An(P("input",{class:"form-control block bg-secondary border !border-gray-300 mr-1",type:"number","onUpdate:modelValue":u[0]||(u[0]=h=>s.value=h)},null,512),[[Or,s.value,void 0,{number:!0}]]),P("span",null,K(M(i)("mtres")),1)])]),P("div",_2e,[P("button",{"data-cy":"featureEditCancel",class:"lux-btn mr-2",onClick:u[1]||(u[1]=h=>t("cancel"))},K(M(i)("Cancel")),1),P("button",{"data-cy":"featureEditValidate",class:"lux-btn-primary",onClick:u[2]||(u[2]=h=>t("validate",{radius:s.value,baseFeature:M(o)}))},K(M(i)("Validate")),1)])],64))}}),v2e={class:"lux-drawing-item-measurements"},b2e={key:0,"data-cy":"featItemLength"},x2e={key:1,"data-cy":"featItemArea"},I2e={key:2,"data-cy":"featItemRadius",class:"flex items-center"},C2e={key:0},w2e={key:1,class:"flex"},A2e={key:3},S2e={"data-cy":"featItemElevation"},E2e=at({__name:"feature-measurements",props:{isEditingFeature:{type:Boolean}},setup(n){const{t:e}=St(),t=zr(),i=Kn().getOlMap(),r=i.getView().getProjection(),o=Ue(Do("feature")),s=Ue(o.value?.featureType||""),l=Ue(o.value?.getGeometry()),u=Ct(()=>{if(l.value){if(["drawnLine","drawnPolygon"].includes(s.value))return zp(l.value,r);if(s.value==="drawnCircle")return wle(l.value,r)}}),h=Ct(()=>{if(l.value){if(s.value==="drawnPolygon")return NT(l.value);if(s.value==="drawnCircle")return Ale(l.value,r)}}),d=Ct(()=>l.value&&s.value==="drawnCircle"?Qv(l.value,r):void 0),m=Ue(d.value||0),y=Ue();Rs(async()=>{const C=l.value.getCoordinates();l.value&&s.value==="drawnPoint"?y.value?y.value=await uZ(C):y.value=await eb(C):y.value=void 0}),Rs(()=>{m.value=s.value==="drawnCircle"?parseFloat(Qv(l.value,r).toFixed(2)):0});function x(C){if(o.value){const w=o.value.getGeometry();w?.getType()==="Circle"&&(ck(w,C,i),t.updateDrawnFeature(o.value))}}return(C,w)=>{const E=kl("format-measure");return U(),ie("div",v2e,[u.value?(U(),ie("div",b2e,[P("span",null,K(M(e)("Length:"))+"",1),An(P("span",null,null,512),[[E,u.value,void 0,{length:!0}]])])):Le("",!0),h.value?(U(),ie("div",x2e,[P("span",null,K(M(e)("Area:"))+"",1),An(P("span",null,null,512),[[E,h.value,void 0,{area:!0}]])])):Le("",!0),s.value==="drawnCircle"?(U(),ie("div",I2e,[P("span",null,K(M(e)("Rayon:"))+"",1),n.isEditingFeature?(U(),ie("div",w2e,[An(P("input",{"data-cy":"featItemInputRadius",class:"form-control block bg-secondary border !border-gray-300",type:"number","onUpdate:modelValue":w[0]||(w[0]=T=>m.value=T),onKeyup:w[1]||(w[1]=to(T=>x(m.value),["enter"]))},null,544),[[Or,m.value,void 0,{number:!0}]]),P("button",{class:"lux-btn-primary",onClick:w[2]||(w[2]=T=>x(m.value))},K(M(e)("Valider")),1)])):An((U(),ie("span",C2e,null,512)),[[E,d.value,void 0,{length:!0}]])])):Le("",!0),s.value==="drawnPoint"?(U(),ie("div",A2e,[P("span",null,K(M(e)("Elevation"))+":",1),An(P("span",S2e,null,512),[[E,y.value,"2",{elevation:!0}]])])):Le("",!0),s.value==="drawnLine"?(U(),Gt(Dk,{key:4,class:"mb-2",feature:o.value},null,8,["feature"])):Le("",!0)])}}}),T2e={key:1},R2e={class:"flex justify-between items-center mt-1 gap-2"},M2e={"data-cy":"featItemActions"},k2e={class:"flex text-primary items-center gap-1"},L2e={class:"mt-3 text-right"},P2e=at({__name:"feature-sub-content",props:{isDocked:{type:Boolean},isEditingFeature:{type:Boolean}},emits:["continueLine","toggleEditFeature","toggleDock","clickDelete","resetInfo","resetStyle","submitEditFeature","submitNewConcentricCircle"],setup(n,{emit:e}){const t=e,{t:i}=St(),r=Rf(),o=Do("feature"),s=Ct(()=>o.map_id?!!r.isMyMapEditable.value:!0);let l=o.label,u=o.description,h={...o.featureStyle};const d={FeatureConcentricCircle:_3,FeatureEditInfo:m3,FeatureEditStyle:y3,FeatureConfirmDelete:g3},m=Ue(void 0);Gw("currentEditCompKey",m);function y(){m.value==="FeatureEditStyle"?(o.selected=!0,t("resetStyle",h)):m.value==="FeatureEditInfo"&&t("resetInfo",l,u),m.value=void 0}function x(C){const w=d[m.value];switch(l=o.label,u=o.description,h={...o.featureStyle},w){case _3:t("submitNewConcentricCircle",C);break;case g3:t("clickDelete");break;case m3:case y3:o.selected=!0,t("submitEditFeature");break;default:alert("Not implemented")}m.value=void 0}return(C,w)=>m.value?(U(),Gt(cb(d[m.value]),{key:1,onCancel:y,onValidate:x},{footer:Wt(()=>[P("div",L2e,[P("button",{"data-cy":"featureEditCancel",class:"lux-btn mr-2",onClick:y},K(M(i)("Cancel")),1),P("button",{"data-cy":"featureEditValidate",class:"lux-btn-primary",onClick:x},K(M(i)("Validate")),1)])]),_:1},32)):(U(),ie(Mt,{key:0},[n.isDocked?Le("",!0):(U(),ie("i",{key:0,"data-cy":"featItemDock",class:"fa fa-object-ungroup float-right",role:"button",onClick:w[0]||(w[0]=()=>t("toggleDock"))})),n.isDocked?(U(),ie("h6",T2e,K(M(o)?.label),1)):Le("",!0),w[12]||(w[12]=P("div",{class:"min-h-2"},null,-1)),mt(E2e,{isEditingFeature:n.isEditingFeature},null,8,["isEditingFeature"]),P("div",R2e,[P("div",null,[s.value?(U(),ie("button",{key:0,"data-cy":"featItemToggleEdit",class:"lux-btn-primary",onClick:w[1]||(w[1]=E=>t("toggleEditFeature"))},K(n.isEditingFeature?M(i)("Terminer dition"):M(i)("Editer l'objet")),1)):Le("",!0)]),P("div",M2e,[P("div",k2e,[P("button",{"data-cy":"featItemActionSearch",class:"hover:text-tertiary",onClick:w[2]||(w[2]=()=>M(o)?.fit())},[...w[8]||(w[8]=[P("i",{class:"fa fa-search"},null,-1)])]),s.value?(U(),ie("button",{key:0,"data-cy":"featItemActionEdit",class:"hover:text-tertiary",onClick:w[3]||(w[3]=()=>m.value="FeatureEditInfo")},[...w[9]||(w[9]=[P("i",{class:"fa fa-pencil"},null,-1)])])):Le("",!0),s.value?(U(),ie("button",{key:1,"data-cy":"featItemActionStyle",class:"hover:text-tertiary",onClick:w[4]||(w[4]=()=>m.value="FeatureEditStyle")},[...w[10]||(w[10]=[P("i",{class:"fa fa-paint-brush"},null,-1)])])):Le("",!0),s.value?(U(),ie("button",{key:2,"data-cy":"featItemActionDelete",class:"hover:text-tertiary",onClick:w[5]||(w[5]=()=>m.value="FeatureConfirmDelete")},[...w[11]||(w[11]=[P("i",{class:"fa fa-trash"},null,-1)])])):Le("",!0),mt(uAe,{onContinueLine:w[6]||(w[6]=E=>t("continueLine")),onNewConcentricCircle:w[7]||(w[7]=()=>m.value="FeatureConcentricCircle")})])])])],64))}}),G2e=at({__name:"map-popup",props:{anchor:{}},emits:["closePopup"],setup(n,{emit:e}){const t=n,i=e,r=Kn(),o=Ue(null),s=mi(new hf({autoPan:{animation:{duration:250}}}));return sr(()=>{o.value&&(s.value.setElement(o.value),r.getOlMap().addOverlay(s.value))}),Rs(()=>{s.value.setPosition(t.anchor)}),(l,u)=>(U(),Gt(kw,{to:"body"},[P("div",{ref_key:"popupContainer",ref:o,"data-cy":"mapPopup",class:"popup"},[P("button",{class:"fa-sharp fa-solid fa-close float-right mt-2 hover:text-primary",onClick:u[0]||(u[0]=()=>i("closePopup"))}),ei(l.$slots,"default")],512)]))}});function v3(n){const e=n.getGeometry();let t;if(e)switch(e.getType()){case"Point":t=e.getFlatCoordinates();break;case"LineString":t=e.getFlatMidpoint();break;case"Polygon":t=e.getFlatInteriorPoint();break;case"Circle":t=e.getCenter();break;case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":default:console.warn(`getFeatCoordinates: Geometry type ${e.getType()} not supported, please convert to a supported geometry type before calling this function.`);break}return t}const F2e=at({__name:"feature-sub-wrapper",props:{isDocked:{type:Boolean}},emits:["closePopup"],setup(n,{emit:e}){const t=e,i=Do("feature"),r=Ue(l());function o(){t("closePopup")}const s=py(()=>{r.value=l()},1e3);function l(){return JSON.parse(JSON.stringify(v3(i)))}return Rs(()=>{i?.getGeometry()&&v3(i)&&s()}),(u,h)=>n.isDocked?(U(),Gt(G2e,{key:0,anchor:r.value,onClosePopup:o},{default:Wt(()=>[ei(u.$slots,"default")]),_:3},8,["anchor"])):ei(u.$slots,"default",{key:1})}}),O2e=["aria-expanded","aria-controls"],N2e=["id"],D2e=at({__name:"feature-item",props:{isDocked:{type:Boolean,default:!1},isEditing:{type:Boolean,default:!1},isOpen:{type:Boolean,default:!1},feature:{}},emits:["clickDelete","closePopup","continueLine","toggleFeatureSub","toggleEditFeature","toggleDock","submitFeature","submitNewConcentricCircle"],setup(n,{emit:e}){const t=n,i=t.feature,r=e;Gw("feature",i);function o(){r("toggleFeatureSub",i.id,!t.isOpen)}function s(){r("toggleEditFeature",i.id,!t.isEditing)}function l(){r("clickDelete",i.id)}function u(y,x){i.label=y,i.description=x}function h(y){i.featureStyle={...y}}function d(){r("submitFeature",i)}function m(y,x){r("submitNewConcentricCircle",y,x)}return(y,x)=>(U(),ie(Mt,null,[P("button",{"data-cy":"featItemName",class:"lux-drawing-item-label flex items-center gap-1","aria-expanded":n.isOpen,"aria-controls":`drawing-item-content-${M(i).id}`,onClick:o},[x[3]||(x[3]=P("span",{class:"sortable-handle drag-handle fa fa-reorder ui-sortable-handle cursor-move"},null,-1)),P("span",{class:Rn(["lux-icon",{point:M(i).featureType==="drawnPoint"||M(i).featureType==="drawnLabel",line:M(i).featureType==="drawnLine",polygon:M(i).featureType==="drawnPolygon"||M(i).featureType==="drawnCircle"}])},null,2),P("span",{class:Rn({selected:n.isOpen})},K(M(i).label),3)],8,O2e),n.isOpen?(U(),Gt(F2e,{key:0,isDocked:n.isDocked,onClosePopup:x[2]||(x[2]=()=>r("toggleDock"))},{default:Wt(()=>[P("div",{class:"lux-drawing-item-content",id:`drawing-item-content-${M(i).id}`},[mt(P2e,{isDocked:n.isDocked,isEditingFeature:n.isEditing,onToggleEditFeature:s,onToggleDock:x[0]||(x[0]=()=>r("toggleDock")),onClickDelete:l,onContinueLine:x[1]||(x[1]=()=>r("continueLine")),onResetInfo:u,onResetStyle:h,onSubmitEditFeature:d,onSubmitNewConcentricCircle:m},null,8,["isDocked","isEditingFeature"])],8,N2e)]),_:1},8,["isDocked"])):Le("",!0)],64))}}),V2e=["aria-activedescendant"],B2e=["id","tabindex","aria-selected","onFocus"],Tz=at({__name:"features-list",props:{features:{},idPrefix:{}},setup(n){const e=zr(),t=Ele(),{activeFeatureId:i,editingFeatureId:r,editStateActive:o,featureEditionDocked:s,drawnFeatures:l}=It(e),u=Ue(),h=wy("sortableFeatures");let d;function m(k){u.value=k}function y(k){if(k.key==="Tab"||!["ArrowDown","ArrowUp"," "].includes(k.key))return;if(k.preventDefault(),k.stopImmediatePropagation(),k.key===" "){u.value&&(i.value=i.value===u.value?void 0:u.value);return}const G=n.features.findIndex(V=>V.id===u.value),O=G===-1?0:G;if(k.key==="ArrowDown"){const V=(O+1)%n.features.length;u.value=n.features[V].id}else{const V=(O-1+n.features.length)%n.features.length;u.value=n.features[V].id}no(()=>document.getElementById(`${n.idPrefix}-${u.value}`)?.focus())}function x(k){k.fit(),t.continueLine(k)}function C(k,G){i.value=G?k:void 0,r.value=void 0,u.value=G?k:void 0,G&&no(()=>{document.getElementById(`${n.idPrefix}-${k}`)?.focus()})}function w(k,G){if(G){if(r.value===k)return;i.value=k,u.value=k;const O=l.value.find(V=>V.id===k);if(O){if(!O.editable)return;r.value=k,o.value=O.featureType.replace("drawn","edit").replace("Continue","")}}else{if(r.value===void 0)return;const O=l.value.find(V=>V.id===k);O&&O.changed(),r.value=void 0,o.value=void 0}}function E(k){const{baseFeature:G,radius:O}=k,V=t.createConcentricCircle(G,O);e.addDrawnFeatureToCollection(V),e.selectDrawnFeature(V)}function T(k){const G=[...k].map(O=>O.id);e.reorderFeatures(G)}return Pt(h,k=>{k?d=yw(k,{onSort:T}):(d?.destroy(),d=void 0)}),(k,G)=>n.features.length?(U(),ie("ul",{key:0,class:"mx-1 sortable-features",ref_key:"sortableFeatures",ref:h,role:"listbox","aria-label":"Liste des objets dessins","aria-activedescendant":u.value?`${n.idPrefix}-${u.value}`:void 0,onKeydown:y},[(U(!0),ie(Mt,null,hi(n.features,O=>(U(),ie("li",{class:"lux-drawing-item",id:`${n.idPrefix}-${O.id}`,key:O.id,role:"option",tabindex:M(i)===O.id?0:-1,"aria-selected":M(i)===O.id,onFocus:()=>m(O.id)},[mt(D2e,{isDocked:M(s),isEditing:M(r)===O.id,isOpen:M(i)===O.id,feature:O,onToggleFeatureSub:C,onToggleEditFeature:w,onToggleDock:G[0]||(G[0]=()=>s.value=!M(s)),onClosePopup:G[1]||(G[1]=()=>s.value=!1),onClickDelete:G[2]||(G[2]=V=>M(e).removeFeature(V)),onContinueLine:()=>x(O),onSubmitFeature:V=>M(e).updateDrawnFeature(V),onSubmitNewConcentricCircle:E},null,8,["isDocked","isEditing","isOpen","feature","onContinueLine","onSubmitFeature"])],40,B2e))),128))],40,V2e)):Le("",!0)}}),Z2e=at({__name:"draw-panel-features",setup(n){const e=zr(),{drawnFeaturesExceptMyMaps:t}=It(e);return(i,r)=>(U(),Gt(Tz,{features:M(t),idPrefix:"draw"},null,8,["features"]))}}),W2e={class:"text-lg"},z2e={class:"flex flex-row justify-end gap-2"},U2e=at({__name:"modal-confirm-delete-all",emits:["cancel","confirm"],setup(n,{emit:e}){const t=e,{t:i}=St();return(r,o)=>(U(),Gt(kf,{title:M(i)("Confirmation de suppression des dessins"),onClose:o[2]||(o[2]=s=>t("cancel"))},{content:Wt(()=>[P("p",W2e,K(M(i)("Etes-vous certain de vouloir effacer tous les dessins ?")),1)]),footer:Wt(()=>[P("div",z2e,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:o[0]||(o[0]=s=>t("cancel"))},K(M(i)("Annuler")),1),P("button",{class:"lux-btn","data-dismiss":"modal",onClick:o[1]||(o[1]=s=>t("confirm"))},K(M(i)("Effacer")),1)])]),_:1},8,["title"]))}}),X2e={class:"flex flex-col gap-4"},Y2e={class:"flex flex-col"},H2e={for:"mergedLineName",class:"lux-label"},K2e={class:"flex flex-col"},j2e={for:"mergedLineDescription",class:"lux-label"},$2e={class:"list-unstyled ml-2"},J2e=["id","value"],q2e=["for"],Q2e={class:"flex flex-row justify-end gap-2"},eSe=["disabled"],tSe=at({__name:"modal-merge-lines",setup(n){const{addNotification:e}=Qr(),{t}=St(),i=zr(),{showModalMergeLines:r}=It(i),o=Ue(t("Nouvelle ligne")),s=Ue(""),l=Ue([]);Pt(r,h=>{h&&i.getDrawnFeaturesOfTypes(["LineString","MultiLineString"]).length<=1&&(e(t("Il faut au moins 2 lignes disponibles pour pouvoir les fusionner."),ii.WARNING),i.toggleDrawMergeLinesModal(!1))});function u(){const h=i.getDrawnFeaturesWithIds(l.value),d=Sle(h);d&&(d.label=o.value,d.description=s.value),i.toggleDrawMergeLinesModal(!1)}return(h,d)=>M(r)?(U(),Gt(kf,{key:0,title:M(t)("Fusionner des lignes"),onClose:d[4]||(d[4]=m=>M(i).toggleDrawMergeLinesModal(!1))},{content:Wt(()=>[P("form",X2e,[P("div",Y2e,[P("label",H2e,K(M(t)("Nouveau nom")),1),An(P("input",{id:"mergedLineName",class:"lux-input",type:"text","onUpdate:modelValue":d[0]||(d[0]=m=>o.value=m)},null,512),[[Or,o.value]])]),P("div",K2e,[P("label",j2e,K(M(t)("Nouvelle description")),1),An(P("textarea",{id:"mergedLineDescription",class:"lux-input",rows:"3","onUpdate:modelValue":d[1]||(d[1]=m=>s.value=m)},null,512),[[Or,s.value]])]),P("ul",$2e,[(U(!0),ie(Mt,null,hi(M(i).getDrawnFeaturesOfTypes(["LineString","MultiLineString"]),m=>(U(),ie("li",{key:m.id},[An(P("input",{id:`featureLine-${m.id}`,type:"checkbox",class:"hidden",value:m.id,"onUpdate:modelValue":d[2]||(d[2]=y=>l.value=y)},null,8,J2e),[[Hh,l.value]]),P("label",{for:`featureLine-${m.id}`},[P("i",{class:Rn(["fa fa-solid mr-2",`${l.value.find(y=>y===m.id)?"fa-check-square":"fa-square"}`])},null,2),Bt(" "+K(m.label),1)],8,q2e)]))),128))])])]),footer:Wt(()=>[P("div",Q2e,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:d[3]||(d[3]=m=>M(i).toggleDrawMergeLinesModal(!1))},K(M(t)("Annuler")),1),P("button",{class:"lux-btn","data-dismiss":"modal",onClick:u,disabled:l.value.length<2},K(M(t)("Fusionner")),9,eSe)])]),_:1},8,["title"])):Le("",!0)}}),nSe={class:"lux-draw-panel absolute w-[93%]","data-cy":"drawPanel"},iSe={class:"lux-draw-panel-title flex"},rSe={class:"grow"},sSe=at({__name:"draw-panel",emits:["moveInMyMap","createNewMyMap"],setup(n,{emit:e}){const t=e,{t:i}=St(),r=Jn(),o=lAe(),{toggleMyMapsOpen:s}=r,{feedbackOpen:l,feedbackanfOpen:u,feedbackageOpen:h,feedbackcruesOpen:d}=It(r),m=zr(),{drawnFeaturesExceptMyMaps:y,clipLineActive:x}=It(m),C=Rf(),w=Ct(()=>{const k=[{label:"Effacer tous les dessins",action:()=>E.value=!0},{label:"Crer une nouvelle carte  partir de ces dessins",action:()=>t("createNewMyMap")},{label:"Fusionner des lignes",action:()=>m.toggleDrawMergeLinesModal(!0)},{label:x.value?"Dsactiver mode couper une ligne":"Couper une ligne",action:()=>{o.toggle(),m.deactivateDraw()}}];return C.isMyMapEditable.value&&k.unshift({label:"Copier dans ma carte",action:()=>t("moveInMyMap")}),k}),E=Ue(!1);function T(){m.removeAllFeatures()}return Pt(y,()=>{Uk("md")&&l.value!==!0&&u.value!==!0&&h.value!==!0&&d.value!==!0&&s(!0)}),(k,G)=>(U(),ie(Mt,null,[M(y).length>0?(U(),ie(Mt,{key:0},[G[3]||(G[3]=P("hr",{class:"separator my-5"},null,-1)),P("div",nSe,[P("div",iSe,[P("h5",rSe,K(M(i)("Dessins")),1),mt(Hk,{"data-cy":"drawPanelMenuPopup",items:w.value,direction:"down",ariaLabel:M(i)("Drawings menu")},{item:Wt(({item:O})=>[mt(Kk,{"data-cy":"drawPanelMenuPopupItem",item:O,onClick:O.action},{default:Wt(()=>[Bt(K(M(i)(O.label)),1)]),_:2},1032,["item","onClick"])]),default:Wt(()=>[G[2]||(G[2]=P("i",{class:"fa-solid fa-square-caret-down hover:text-tertiary"},null,-1))]),_:1},8,["items","ariaLabel"])]),mt(Z2e)]),E.value?(U(),Gt(U2e,{key:0,onCancel:G[0]||(G[0]=()=>E.value=!1),onConfirm:G[1]||(G[1]=()=>{E.value=!1,T()})})):Le("",!0)],64)):Le("",!0),mt(tSe)],64))}}),oSe=es(sSe,[["__scopeId","data-v-35e42ace"]]);var Cu=(n=>(n.COPY="copy",n.CREATE="create",n.CREATE_FROM_FEATURES="create_from_features",n.EDIT="edit",n))(Cu||{});const aSe={class:"flex flex-col gap-4"},lSe={class:"flex flex-col"},uSe={for:"map-title-input"},cSe={class:"ml-2 hover:cursor-pointer",for:"mapIsPublic"},hSe={for:"category-select",class:"sr-only"},dSe={class:"flex flex-col"},fSe={for:"map-description-input"},pSe={class:"flex flex-row justify-end gap-2"},gSe=at({__name:"my-map-edit-form",props:{map:{},mode:{}},emits:["cancel","confirm"],setup(n,{emit:e}){const t=e,i=n,{t:r}=St(),{addNotification:o}=Qr(),s=Rf(),l=Jn(),{myMapId:u}=It(l),h=Ui(),{bgLayer:d}=It(h),m=Zr(),{theme:y}=It(m),x=i.map&&i.mode===Cu.COPY,C=Ue(i.map?i.map.public:!1),w=Ue(i.map?i.map.title:r("Map without Title")),E=Ue(i.map?i.map.description:""),T=Ue(i.map?i.map.category_id+"":void 0),k=mi([]),G=Ct(()=>k.value.map(V=>({label:V.name,value:""+V.id})));async function O(){const V=T.value?parseInt(T.value,10):999;let z;try{i.map&&i.mode===Cu.COPY?z=await qae(i.map.uuid,w.value,E.value,V,C.value):i.map&&i.mode===Cu.EDIT?z=await Jae(i.map.uuid,w.value,E.value,V,C.value):(z=await $B(w.value,E.value,V,C.value),await JB(z.uuid,d.value?.name||"",1,"","","","",y.value?.name||""),z?.success&&i.mode===Cu.CREATE_FROM_FEATURES&&(u.value=z.uuid,no(()=>{s.addInMyMap()}))),z?.success?t("confirm",z.uuid):t("cancel")}catch(H){o(H,ii.ERROR)}}return wN(async()=>{k.value=await $ae()}),(V,z)=>(U(),Gt(kf,{title:M(x)?M(r)("Modify title and description of the map"):M(r)("Title and description of the map"),onClose:z[6]||(z[6]=H=>t("cancel"))},{content:Wt(()=>[P("form",aSe,[P("div",lSe,[P("label",uSe,K(M(r)("Titre de la carte")),1),An(P("input",{id:"map-title-input",class:"lux-input",type:"text","onUpdate:modelValue":z[0]||(z[0]=H=>w.value=H),required:"","aria-required":!0},null,512),[[Or,w.value]])]),P("div",null,[An(P("input",{id:"mapIsPublic","onUpdate:modelValue":z[1]||(z[1]=H=>C.value=H),type:"checkbox"},null,512),[[Hh,C.value]]),P("label",cSe,K(M(r)("Public Map")),1)]),P("div",null,[P("label",hSe,K(M(r)("Please select a Category")),1),mt(ig,{id:"category-select",class:"min-w-36",placeholder:M(r)("Please select a Category"),options:G.value,modelValue:T.value,"onUpdate:modelValue":z[2]||(z[2]=H=>T.value=H),onChange:z[3]||(z[3]=H=>T.value=H),"aria-label":M(r)("Please select a Category")},null,8,["placeholder","options","modelValue","aria-label"])]),P("div",dSe,[P("label",fSe,K(M(r)("Description")),1),An(P("textarea",{id:"map-description-input",class:"lux-input",rows:"3","onUpdate:modelValue":z[4]||(z[4]=H=>E.value=H)},null,512),[[Or,E.value]])])])]),footer:Wt(()=>[P("div",pSe,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:z[5]||(z[5]=H=>t("cancel"))},K(M(r)("Annuler")),1),P("button",{class:"lux-btn-primary","data-dismiss":"modal",onClick:O},K(n.map&&!M(x)?M(r)("Save changes"):M(r)("Save new map")),1)])]),_:1},8,["title"]))}});function nI(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var _E={exports:{}};var b3;function mSe(){return b3||(b3=1,(function(n,e){(function(t){n.exports=t()})(function(){return(function t(i,r,o){function s(h,d){if(!r[h]){if(!i[h]){var m=typeof nI=="function"&&nI;if(!d&&m)return m(h,!0);if(l)return l(h,!0);var y=new Error("Cannot find module '"+h+"'");throw y.code="MODULE_NOT_FOUND",y}var x=r[h]={exports:{}};i[h][0].call(x.exports,function(C){var w=i[h][1][C];return s(w||C)},x,x.exports,t,i,r,o)}return r[h].exports}for(var l=typeof nI=="function"&&nI,u=0;u<o.length;u++)s(o[u]);return s})({1:[function(t,i,r){var o=t("./utils"),s=t("./support"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(u){for(var h,d,m,y,x,C,w,E=[],T=0,k=u.length,G=k,O=o.getTypeOf(u)!=="string";T<u.length;)G=k-T,m=O?(h=u[T++],d=T<k?u[T++]:0,T<k?u[T++]:0):(h=u.charCodeAt(T++),d=T<k?u.charCodeAt(T++):0,T<k?u.charCodeAt(T++):0),y=h>>2,x=(3&h)<<4|d>>4,C=1<G?(15&d)<<2|m>>6:64,w=2<G?63&m:64,E.push(l.charAt(y)+l.charAt(x)+l.charAt(C)+l.charAt(w));return E.join("")},r.decode=function(u){var h,d,m,y,x,C,w=0,E=0,T="data:";if(u.substr(0,T.length)===T)throw new Error("Invalid base64 input, it looks like a data url.");var k,G=3*(u=u.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(u.charAt(u.length-1)===l.charAt(64)&&G--,u.charAt(u.length-2)===l.charAt(64)&&G--,G%1!=0)throw new Error("Invalid base64 input, bad content length.");for(k=s.uint8array?new Uint8Array(0|G):new Array(0|G);w<u.length;)h=l.indexOf(u.charAt(w++))<<2|(y=l.indexOf(u.charAt(w++)))>>4,d=(15&y)<<4|(x=l.indexOf(u.charAt(w++)))>>2,m=(3&x)<<6|(C=l.indexOf(u.charAt(w++))),k[E++]=h,x!==64&&(k[E++]=d),C!==64&&(k[E++]=m);return k}},{"./support":30,"./utils":32}],2:[function(t,i,r){var o=t("./external"),s=t("./stream/DataWorker"),l=t("./stream/Crc32Probe"),u=t("./stream/DataLengthProbe");function h(d,m,y,x,C){this.compressedSize=d,this.uncompressedSize=m,this.crc32=y,this.compression=x,this.compressedContent=C}h.prototype={getContentWorker:function(){var d=new s(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new u("data_length")),m=this;return d.on("end",function(){if(this.streamInfo.data_length!==m.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),d},getCompressedWorker:function(){return new s(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(d,m,y){return d.pipe(new l).pipe(new u("uncompressedSize")).pipe(m.compressWorker(y)).pipe(new u("compressedSize")).withStreamInfo("compression",m)},i.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,r){var o=t("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},r.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,r){var o=t("./utils"),s=(function(){for(var l,u=[],h=0;h<256;h++){l=h;for(var d=0;d<8;d++)l=1&l?3988292384^l>>>1:l>>>1;u[h]=l}return u})();i.exports=function(l,u){return l!==void 0&&l.length?o.getTypeOf(l)!=="string"?(function(h,d,m,y){var x=s,C=y+m;h^=-1;for(var w=y;w<C;w++)h=h>>>8^x[255&(h^d[w])];return-1^h})(0|u,l,l.length,0):(function(h,d,m,y){var x=s,C=y+m;h^=-1;for(var w=y;w<C;w++)h=h>>>8^x[255&(h^d.charCodeAt(w))];return-1^h})(0|u,l,l.length,0):0}},{"./utils":32}],5:[function(t,i,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(t,i,r){var o=null;o=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:o}},{lie:37}],7:[function(t,i,r){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=t("pako"),l=t("./utils"),u=t("./stream/GenericWorker"),h=o?"uint8array":"array";function d(m,y){u.call(this,"FlateWorker/"+m),this._pako=null,this._pakoAction=m,this._pakoOptions=y,this.meta={}}r.magic="\b\0",l.inherits(d,u),d.prototype.processChunk=function(m){this.meta=m.meta,this._pako===null&&this._createPako(),this._pako.push(l.transformTo(h,m.data),!1)},d.prototype.flush=function(){u.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},d.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this._pako=null},d.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var m=this;this._pako.onData=function(y){m.push({data:y,meta:m.meta})}},r.compressWorker=function(m){return new d("Deflate",m)},r.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,r){function o(x,C){var w,E="";for(w=0;w<C;w++)E+=String.fromCharCode(255&x),x>>>=8;return E}function s(x,C,w,E,T,k){var G,O,V=x.file,z=x.compression,H=k!==h.utf8encode,te=l.transformTo("string",k(V.name)),$=l.transformTo("string",h.utf8encode(V.name)),ae=V.comment,fe=l.transformTo("string",k(ae)),Y=l.transformTo("string",h.utf8encode(ae)),de=$.length!==V.name.length,D=Y.length!==ae.length,oe="",ue="",ge="",Ne=V.dir,Ee=V.date,se={crc32:0,compressedSize:0,uncompressedSize:0};C&&!w||(se.crc32=x.crc32,se.compressedSize=x.compressedSize,se.uncompressedSize=x.uncompressedSize);var q=0;C&&(q|=8),H||!de&&!D||(q|=2048);var j=0,ze=0;Ne&&(j|=16),T==="UNIX"?(ze=798,j|=(function(qe,yt){var xt=qe;return qe||(xt=yt?16893:33204),(65535&xt)<<16})(V.unixPermissions,Ne)):(ze=20,j|=(function(qe){return 63&(qe||0)})(V.dosPermissions)),G=Ee.getUTCHours(),G<<=6,G|=Ee.getUTCMinutes(),G<<=5,G|=Ee.getUTCSeconds()/2,O=Ee.getUTCFullYear()-1980,O<<=4,O|=Ee.getUTCMonth()+1,O<<=5,O|=Ee.getUTCDate(),de&&(ue=o(1,1)+o(d(te),4)+$,oe+="up"+o(ue.length,2)+ue),D&&(ge=o(1,1)+o(d(fe),4)+Y,oe+="uc"+o(ge.length,2)+ge);var je="";return je+=`
\0`,je+=o(q,2),je+=z.magic,je+=o(G,2),je+=o(O,2),je+=o(se.crc32,4),je+=o(se.compressedSize,4),je+=o(se.uncompressedSize,4),je+=o(te.length,2),je+=o(oe.length,2),{fileRecord:m.LOCAL_FILE_HEADER+je+te+oe,dirRecord:m.CENTRAL_FILE_HEADER+o(ze,2)+je+o(fe.length,2)+"\0\0\0\0"+o(j,4)+o(E,4)+te+oe+fe}}var l=t("../utils"),u=t("../stream/GenericWorker"),h=t("../utf8"),d=t("../crc32"),m=t("../signature");function y(x,C,w,E){u.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=C,this.zipPlatform=w,this.encodeFileName=E,this.streamFiles=x,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}l.inherits(y,u),y.prototype.push=function(x){var C=x.meta.percent||0,w=this.entriesCount,E=this._sources.length;this.accumulate?this.contentBuffer.push(x):(this.bytesWritten+=x.data.length,u.prototype.push.call(this,{data:x.data,meta:{currentFile:this.currentFile,percent:w?(C+100*(w-E-1))/w:100}}))},y.prototype.openedSource=function(x){this.currentSourceOffset=this.bytesWritten,this.currentFile=x.file.name;var C=this.streamFiles&&!x.file.dir;if(C){var w=s(x,C,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:w.fileRecord,meta:{percent:0}})}else this.accumulate=!0},y.prototype.closedSource=function(x){this.accumulate=!1;var C=this.streamFiles&&!x.file.dir,w=s(x,C,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(w.dirRecord),C)this.push({data:(function(E){return m.DATA_DESCRIPTOR+o(E.crc32,4)+o(E.compressedSize,4)+o(E.uncompressedSize,4)})(x),meta:{percent:100}});else for(this.push({data:w.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},y.prototype.flush=function(){for(var x=this.bytesWritten,C=0;C<this.dirRecords.length;C++)this.push({data:this.dirRecords[C],meta:{percent:100}});var w=this.bytesWritten-x,E=(function(T,k,G,O,V){var z=l.transformTo("string",V(O));return m.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(T,2)+o(T,2)+o(k,4)+o(G,4)+o(z.length,2)+z})(this.dirRecords.length,w,x,this.zipComment,this.encodeFileName);this.push({data:E,meta:{percent:100}})},y.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},y.prototype.registerPrevious=function(x){this._sources.push(x);var C=this;return x.on("data",function(w){C.processChunk(w)}),x.on("end",function(){C.closedSource(C.previous.streamInfo),C._sources.length?C.prepareNextSource():C.end()}),x.on("error",function(w){C.error(w)}),this},y.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},y.prototype.error=function(x){var C=this._sources;if(!u.prototype.error.call(this,x))return!1;for(var w=0;w<C.length;w++)try{C[w].error(x)}catch{}return!0},y.prototype.lock=function(){u.prototype.lock.call(this);for(var x=this._sources,C=0;C<x.length;C++)x[C].lock()},i.exports=y},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,r){var o=t("../compressions"),s=t("./ZipFileWorker");r.generateWorker=function(l,u,h){var d=new s(u.streamFiles,h,u.platform,u.encodeFileName),m=0;try{l.forEach(function(y,x){m++;var C=(function(k,G){var O=k||G,V=o[O];if(!V)throw new Error(O+" is not a valid compression method !");return V})(x.options.compression,u.compression),w=x.options.compressionOptions||u.compressionOptions||{},E=x.dir,T=x.date;x._compressWorker(C,w).withStreamInfo("file",{name:y,dir:E,date:T,comment:x.comment||"",unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions}).pipe(d)}),d.entriesCount=m}catch(y){d.error(y)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,r){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new o;for(var l in this)typeof this[l]!="function"&&(s[l]=this[l]);return s}}(o.prototype=t("./object")).loadAsync=t("./load"),o.support=t("./support"),o.defaults=t("./defaults"),o.version="3.10.1",o.loadAsync=function(s,l){return new o().loadAsync(s,l)},o.external=t("./external"),i.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,r){var o=t("./utils"),s=t("./external"),l=t("./utf8"),u=t("./zipEntries"),h=t("./stream/Crc32Probe"),d=t("./nodejsUtils");function m(y){return new s.Promise(function(x,C){var w=y.decompressed.getContentWorker().pipe(new h);w.on("error",function(E){C(E)}).on("end",function(){w.streamInfo.crc32!==y.decompressed.crc32?C(new Error("Corrupted zip : CRC32 mismatch")):x()}).resume()})}i.exports=function(y,x){var C=this;return x=o.extend(x||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:l.utf8decode}),d.isNode&&d.isStream(y)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",y,!0,x.optimizedBinaryString,x.base64).then(function(w){var E=new u(x);return E.load(w),E}).then(function(w){var E=[s.Promise.resolve(w)],T=w.files;if(x.checkCRC32)for(var k=0;k<T.length;k++)E.push(m(T[k]));return s.Promise.all(E)}).then(function(w){for(var E=w.shift(),T=E.files,k=0;k<T.length;k++){var G=T[k],O=G.fileNameStr,V=o.resolve(G.fileNameStr);C.file(V,G.decompressed,{binary:!0,optimizedBinaryString:!0,date:G.date,dir:G.dir,comment:G.fileCommentStr.length?G.fileCommentStr:null,unixPermissions:G.unixPermissions,dosPermissions:G.dosPermissions,createFolders:x.createFolders}),G.dir||(C.file(V).unsafeOriginalName=O)}return E.zipComment.length&&(C.comment=E.zipComment),C})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,r){var o=t("../utils"),s=t("../stream/GenericWorker");function l(u,h){s.call(this,"Nodejs stream input adapter for "+u),this._upstreamEnded=!1,this._bindStream(h)}o.inherits(l,s),l.prototype._bindStream=function(u){var h=this;(this._stream=u).pause(),u.on("data",function(d){h.push({data:d,meta:{percent:0}})}).on("error",function(d){h.isPaused?this.generatedError=d:h.error(d)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},l.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=l},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,r){var o=t("readable-stream").Readable;function s(l,u,h){o.call(this,u),this._helper=l;var d=this;l.on("data",function(m,y){d.push(m)||d._helper.pause(),h&&h(y)}).on("error",function(m){d.emit("error",m)}).on("end",function(){d.push(null)})}t("../utils").inherits(s,o),s.prototype._read=function(){this._helper.resume()},i.exports=s},{"../utils":32,"readable-stream":16}],14:[function(t,i,r){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,s);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,s)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var s=new Buffer(o);return s.fill(0),s},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(t,i,r){function o(V,z,H){var te,$=l.getTypeOf(z),ae=l.extend(H||{},d);ae.date=ae.date||new Date,ae.compression!==null&&(ae.compression=ae.compression.toUpperCase()),typeof ae.unixPermissions=="string"&&(ae.unixPermissions=parseInt(ae.unixPermissions,8)),ae.unixPermissions&&16384&ae.unixPermissions&&(ae.dir=!0),ae.dosPermissions&&16&ae.dosPermissions&&(ae.dir=!0),ae.dir&&(V=T(V)),ae.createFolders&&(te=E(V))&&k.call(this,te,!0);var fe=$==="string"&&ae.binary===!1&&ae.base64===!1;H&&H.binary!==void 0||(ae.binary=!fe),(z instanceof m&&z.uncompressedSize===0||ae.dir||!z||z.length===0)&&(ae.base64=!1,ae.binary=!0,z="",ae.compression="STORE",$="string");var Y=null;Y=z instanceof m||z instanceof u?z:C.isNode&&C.isStream(z)?new w(V,z):l.prepareContent(V,z,ae.binary,ae.optimizedBinaryString,ae.base64);var de=new y(V,Y,ae);this.files[V]=de}var s=t("./utf8"),l=t("./utils"),u=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),d=t("./defaults"),m=t("./compressedObject"),y=t("./zipObject"),x=t("./generate"),C=t("./nodejsUtils"),w=t("./nodejs/NodejsStreamInputAdapter"),E=function(V){V.slice(-1)==="/"&&(V=V.substring(0,V.length-1));var z=V.lastIndexOf("/");return 0<z?V.substring(0,z):""},T=function(V){return V.slice(-1)!=="/"&&(V+="/"),V},k=function(V,z){return z=z!==void 0?z:d.createFolders,V=T(V),this.files[V]||o.call(this,V,null,{dir:!0,createFolders:z}),this.files[V]};function G(V){return Object.prototype.toString.call(V)==="[object RegExp]"}var O={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(V){var z,H,te;for(z in this.files)te=this.files[z],(H=z.slice(this.root.length,z.length))&&z.slice(0,this.root.length)===this.root&&V(H,te)},filter:function(V){var z=[];return this.forEach(function(H,te){V(H,te)&&z.push(te)}),z},file:function(V,z,H){if(arguments.length!==1)return V=this.root+V,o.call(this,V,z,H),this;if(G(V)){var te=V;return this.filter(function(ae,fe){return!fe.dir&&te.test(ae)})}var $=this.files[this.root+V];return $&&!$.dir?$:null},folder:function(V){if(!V)return this;if(G(V))return this.filter(function($,ae){return ae.dir&&V.test($)});var z=this.root+V,H=k.call(this,z),te=this.clone();return te.root=H.name,te},remove:function(V){V=this.root+V;var z=this.files[V];if(z||(V.slice(-1)!=="/"&&(V+="/"),z=this.files[V]),z&&!z.dir)delete this.files[V];else for(var H=this.filter(function($,ae){return ae.name.slice(0,V.length)===V}),te=0;te<H.length;te++)delete this.files[H[te].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(V){var z,H={};try{if((H=l.extend(V||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=H.type.toLowerCase(),H.compression=H.compression.toUpperCase(),H.type==="binarystring"&&(H.type="string"),!H.type)throw new Error("No output type specified.");l.checkSupport(H.type),H.platform!=="darwin"&&H.platform!=="freebsd"&&H.platform!=="linux"&&H.platform!=="sunos"||(H.platform="UNIX"),H.platform==="win32"&&(H.platform="DOS");var te=H.comment||this.comment||"";z=x.generateWorker(this,H,te)}catch($){(z=new u("error")).error($)}return new h(z,H.type||"string",H.mimeType)},generateAsync:function(V,z){return this.generateInternalStream(V).accumulate(z)},generateNodeStream:function(V,z){return(V=V||{}).type||(V.type="nodebuffer"),this.generateInternalStream(V).toNodejsStream(z)}};i.exports=O},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,r){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,r){var o=t("./DataReader");function s(l){o.call(this,l);for(var u=0;u<this.data.length;u++)l[u]=255&l[u]}t("../utils").inherits(s,o),s.prototype.byteAt=function(l){return this.data[this.zero+l]},s.prototype.lastIndexOfSignature=function(l){for(var u=l.charCodeAt(0),h=l.charCodeAt(1),d=l.charCodeAt(2),m=l.charCodeAt(3),y=this.length-4;0<=y;--y)if(this.data[y]===u&&this.data[y+1]===h&&this.data[y+2]===d&&this.data[y+3]===m)return y-this.zero;return-1},s.prototype.readAndCheckSignature=function(l){var u=l.charCodeAt(0),h=l.charCodeAt(1),d=l.charCodeAt(2),m=l.charCodeAt(3),y=this.readData(4);return u===y[0]&&h===y[1]&&d===y[2]&&m===y[3]},s.prototype.readData=function(l){if(this.checkOffset(l),l===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=s},{"../utils":32,"./DataReader":18}],18:[function(t,i,r){var o=t("../utils");function s(l){this.data=l,this.length=l.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(l){this.checkIndex(this.index+l)},checkIndex:function(l){if(this.length<this.zero+l||l<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+l+"). Corrupted zip ?")},setIndex:function(l){this.checkIndex(l),this.index=l},skip:function(l){this.setIndex(this.index+l)},byteAt:function(){},readInt:function(l){var u,h=0;for(this.checkOffset(l),u=this.index+l-1;u>=this.index;u--)h=(h<<8)+this.byteAt(u);return this.index+=l,h},readString:function(l){return o.transformTo("string",this.readData(l))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var l=this.readInt(4);return new Date(Date.UTC(1980+(l>>25&127),(l>>21&15)-1,l>>16&31,l>>11&31,l>>5&63,(31&l)<<1))}},i.exports=s},{"../utils":32}],19:[function(t,i,r){var o=t("./Uint8ArrayReader");function s(l){o.call(this,l)}t("../utils").inherits(s,o),s.prototype.readData=function(l){this.checkOffset(l);var u=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,r){var o=t("./DataReader");function s(l){o.call(this,l)}t("../utils").inherits(s,o),s.prototype.byteAt=function(l){return this.data.charCodeAt(this.zero+l)},s.prototype.lastIndexOfSignature=function(l){return this.data.lastIndexOf(l)-this.zero},s.prototype.readAndCheckSignature=function(l){return l===this.readData(4)},s.prototype.readData=function(l){this.checkOffset(l);var u=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=s},{"../utils":32,"./DataReader":18}],21:[function(t,i,r){var o=t("./ArrayReader");function s(l){o.call(this,l)}t("../utils").inherits(s,o),s.prototype.readData=function(l){if(this.checkOffset(l),l===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,r){var o=t("../utils"),s=t("../support"),l=t("./ArrayReader"),u=t("./StringReader"),h=t("./NodeBufferReader"),d=t("./Uint8ArrayReader");i.exports=function(m){var y=o.getTypeOf(m);return o.checkSupport(y),y!=="string"||s.uint8array?y==="nodebuffer"?new h(m):s.uint8array?new d(o.transformTo("uint8array",m)):new l(o.transformTo("array",m)):new u(m)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,r){var o=t("./GenericWorker"),s=t("../utils");function l(u){o.call(this,"ConvertWorker to "+u),this.destType=u}s.inherits(l,o),l.prototype.processChunk=function(u){this.push({data:s.transformTo(this.destType,u.data),meta:u.meta})},i.exports=l},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,r){var o=t("./GenericWorker"),s=t("../crc32");function l(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(l,o),l.prototype.processChunk=function(u){this.streamInfo.crc32=s(u.data,this.streamInfo.crc32||0),this.push(u)},i.exports=l},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,r){var o=t("../utils"),s=t("./GenericWorker");function l(u){s.call(this,"DataLengthProbe for "+u),this.propName=u,this.withStreamInfo(u,0)}o.inherits(l,s),l.prototype.processChunk=function(u){if(u){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+u.data.length}s.prototype.processChunk.call(this,u)},i.exports=l},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,r){var o=t("../utils"),s=t("./GenericWorker");function l(u){s.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(d){h.dataIsReady=!0,h.data=d,h.max=d&&d.length||0,h.type=o.getTypeOf(d),h.isPaused||h._tickAndRepeat()},function(d){h.error(d)})}o.inherits(l,s),l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},l.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},l.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,h);break;case"uint8array":u=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":u=this.data.slice(this.index,h)}return this.index=h,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=l},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,r){function o(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,l){return this._listeners[s].push(l),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,l){if(this._listeners[s])for(var u=0;u<this._listeners[s].length;u++)this._listeners[s][u].call(this,l)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var l=this;return s.on("data",function(u){l.processChunk(u)}),s.on("end",function(){l.end()}),s.on("error",function(u){l.error(u)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,l){return this.extraStreamInfo[s]=l,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},i.exports=o},{}],29:[function(t,i,r){var o=t("../utils"),s=t("./ConvertWorker"),l=t("./GenericWorker"),u=t("../base64"),h=t("../support"),d=t("../external"),m=null;if(h.nodestream)try{m=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function y(C,w){return new d.Promise(function(E,T){var k=[],G=C._internalType,O=C._outputType,V=C._mimeType;C.on("data",function(z,H){k.push(z),w&&w(H)}).on("error",function(z){k=[],T(z)}).on("end",function(){try{var z=(function(H,te,$){switch(H){case"blob":return o.newBlob(o.transformTo("arraybuffer",te),$);case"base64":return u.encode(te);default:return o.transformTo(H,te)}})(O,(function(H,te){var $,ae=0,fe=null,Y=0;for($=0;$<te.length;$++)Y+=te[$].length;switch(H){case"string":return te.join("");case"array":return Array.prototype.concat.apply([],te);case"uint8array":for(fe=new Uint8Array(Y),$=0;$<te.length;$++)fe.set(te[$],ae),ae+=te[$].length;return fe;case"nodebuffer":return Buffer.concat(te);default:throw new Error("concat : unsupported type '"+H+"'")}})(G,k),V);E(z)}catch(H){T(H)}k=[]}).resume()})}function x(C,w,E){var T=w;switch(w){case"blob":case"arraybuffer":T="uint8array";break;case"base64":T="string"}try{this._internalType=T,this._outputType=w,this._mimeType=E,o.checkSupport(T),this._worker=C.pipe(new s(T)),C.lock()}catch(k){this._worker=new l("error"),this._worker.error(k)}}x.prototype={accumulate:function(C){return y(this,C)},on:function(C,w){var E=this;return C==="data"?this._worker.on(C,function(T){w.call(E,T.data,T.meta)}):this._worker.on(C,function(){o.delay(w,arguments,E)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(C){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new m(this,{objectMode:this._outputType!=="nodebuffer"},C)}},i.exports=x},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var o=new ArrayBuffer(0);try{r.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(o),r.blob=s.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!t("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,r){for(var o=t("./utils"),s=t("./support"),l=t("./nodejsUtils"),u=t("./stream/GenericWorker"),h=new Array(256),d=0;d<256;d++)h[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;h[254]=h[254]=1;function m(){u.call(this,"utf-8 decode"),this.leftOver=null}function y(){u.call(this,"utf-8 encode")}r.utf8encode=function(x){return s.nodebuffer?l.newBufferFrom(x,"utf-8"):(function(C){var w,E,T,k,G,O=C.length,V=0;for(k=0;k<O;k++)(64512&(E=C.charCodeAt(k)))==55296&&k+1<O&&(64512&(T=C.charCodeAt(k+1)))==56320&&(E=65536+(E-55296<<10)+(T-56320),k++),V+=E<128?1:E<2048?2:E<65536?3:4;for(w=s.uint8array?new Uint8Array(V):new Array(V),k=G=0;G<V;k++)(64512&(E=C.charCodeAt(k)))==55296&&k+1<O&&(64512&(T=C.charCodeAt(k+1)))==56320&&(E=65536+(E-55296<<10)+(T-56320),k++),E<128?w[G++]=E:(E<2048?w[G++]=192|E>>>6:(E<65536?w[G++]=224|E>>>12:(w[G++]=240|E>>>18,w[G++]=128|E>>>12&63),w[G++]=128|E>>>6&63),w[G++]=128|63&E);return w})(x)},r.utf8decode=function(x){return s.nodebuffer?o.transformTo("nodebuffer",x).toString("utf-8"):(function(C){var w,E,T,k,G=C.length,O=new Array(2*G);for(w=E=0;w<G;)if((T=C[w++])<128)O[E++]=T;else if(4<(k=h[T]))O[E++]=65533,w+=k-1;else{for(T&=k===2?31:k===3?15:7;1<k&&w<G;)T=T<<6|63&C[w++],k--;1<k?O[E++]=65533:T<65536?O[E++]=T:(T-=65536,O[E++]=55296|T>>10&1023,O[E++]=56320|1023&T)}return O.length!==E&&(O.subarray?O=O.subarray(0,E):O.length=E),o.applyFromCharCode(O)})(x=o.transformTo(s.uint8array?"uint8array":"array",x))},o.inherits(m,u),m.prototype.processChunk=function(x){var C=o.transformTo(s.uint8array?"uint8array":"array",x.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var w=C;(C=new Uint8Array(w.length+this.leftOver.length)).set(this.leftOver,0),C.set(w,this.leftOver.length)}else C=this.leftOver.concat(C);this.leftOver=null}var E=(function(k,G){var O;for((G=G||k.length)>k.length&&(G=k.length),O=G-1;0<=O&&(192&k[O])==128;)O--;return O<0||O===0?G:O+h[k[O]]>G?O:G})(C),T=C;E!==C.length&&(s.uint8array?(T=C.subarray(0,E),this.leftOver=C.subarray(E,C.length)):(T=C.slice(0,E),this.leftOver=C.slice(E,C.length))),this.push({data:r.utf8decode(T),meta:x.meta})},m.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=m,o.inherits(y,u),y.prototype.processChunk=function(x){this.push({data:r.utf8encode(x.data),meta:x.meta})},r.Utf8EncodeWorker=y},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,r){var o=t("./support"),s=t("./base64"),l=t("./nodejsUtils"),u=t("./external");function h(w){return w}function d(w,E){for(var T=0;T<w.length;++T)E[T]=255&w.charCodeAt(T);return E}t("setimmediate"),r.newBlob=function(w,E){r.checkSupport("blob");try{return new Blob([w],{type:E})}catch{try{var T=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return T.append(w),T.getBlob(E)}catch{throw new Error("Bug : can't construct the Blob.")}}};var m={stringifyByChunk:function(w,E,T){var k=[],G=0,O=w.length;if(O<=T)return String.fromCharCode.apply(null,w);for(;G<O;)E==="array"||E==="nodebuffer"?k.push(String.fromCharCode.apply(null,w.slice(G,Math.min(G+T,O)))):k.push(String.fromCharCode.apply(null,w.subarray(G,Math.min(G+T,O)))),G+=T;return k.join("")},stringifyByChar:function(w){for(var E="",T=0;T<w.length;T++)E+=String.fromCharCode(w[T]);return E},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,l.allocBuffer(1)).length===1}catch{return!1}})()}};function y(w){var E=65536,T=r.getTypeOf(w),k=!0;if(T==="uint8array"?k=m.applyCanBeUsed.uint8array:T==="nodebuffer"&&(k=m.applyCanBeUsed.nodebuffer),k)for(;1<E;)try{return m.stringifyByChunk(w,T,E)}catch{E=Math.floor(E/2)}return m.stringifyByChar(w)}function x(w,E){for(var T=0;T<w.length;T++)E[T]=w[T];return E}r.applyFromCharCode=y;var C={};C.string={string:h,array:function(w){return d(w,new Array(w.length))},arraybuffer:function(w){return C.string.uint8array(w).buffer},uint8array:function(w){return d(w,new Uint8Array(w.length))},nodebuffer:function(w){return d(w,l.allocBuffer(w.length))}},C.array={string:y,array:h,arraybuffer:function(w){return new Uint8Array(w).buffer},uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return l.newBufferFrom(w)}},C.arraybuffer={string:function(w){return y(new Uint8Array(w))},array:function(w){return x(new Uint8Array(w),new Array(w.byteLength))},arraybuffer:h,uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return l.newBufferFrom(new Uint8Array(w))}},C.uint8array={string:y,array:function(w){return x(w,new Array(w.length))},arraybuffer:function(w){return w.buffer},uint8array:h,nodebuffer:function(w){return l.newBufferFrom(w)}},C.nodebuffer={string:y,array:function(w){return x(w,new Array(w.length))},arraybuffer:function(w){return C.nodebuffer.uint8array(w).buffer},uint8array:function(w){return x(w,new Uint8Array(w.length))},nodebuffer:h},r.transformTo=function(w,E){if(E=E||"",!w)return E;r.checkSupport(w);var T=r.getTypeOf(E);return C[T][w](E)},r.resolve=function(w){for(var E=w.split("/"),T=[],k=0;k<E.length;k++){var G=E[k];G==="."||G===""&&k!==0&&k!==E.length-1||(G===".."?T.pop():T.push(G))}return T.join("/")},r.getTypeOf=function(w){return typeof w=="string"?"string":Object.prototype.toString.call(w)==="[object Array]"?"array":o.nodebuffer&&l.isBuffer(w)?"nodebuffer":o.uint8array&&w instanceof Uint8Array?"uint8array":o.arraybuffer&&w instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(w){if(!o[w.toLowerCase()])throw new Error(w+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(w){var E,T,k="";for(T=0;T<(w||"").length;T++)k+="\\x"+((E=w.charCodeAt(T))<16?"0":"")+E.toString(16).toUpperCase();return k},r.delay=function(w,E,T){setImmediate(function(){w.apply(T||null,E||[])})},r.inherits=function(w,E){function T(){}T.prototype=E.prototype,w.prototype=new T},r.extend=function(){var w,E,T={};for(w=0;w<arguments.length;w++)for(E in arguments[w])Object.prototype.hasOwnProperty.call(arguments[w],E)&&T[E]===void 0&&(T[E]=arguments[w][E]);return T},r.prepareContent=function(w,E,T,k,G){return u.Promise.resolve(E).then(function(O){return o.blob&&(O instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(O))!==-1)&&typeof FileReader<"u"?new u.Promise(function(V,z){var H=new FileReader;H.onload=function(te){V(te.target.result)},H.onerror=function(te){z(te.target.error)},H.readAsArrayBuffer(O)}):O}).then(function(O){var V=r.getTypeOf(O);return V?(V==="arraybuffer"?O=r.transformTo("uint8array",O):V==="string"&&(G?O=s.decode(O):T&&k!==!0&&(O=(function(z){return d(z,o.uint8array?new Uint8Array(z.length):new Array(z.length))})(O))),O):u.Promise.reject(new Error("Can't read the data of '"+w+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,r){var o=t("./reader/readerFor"),s=t("./utils"),l=t("./signature"),u=t("./zipEntry"),h=t("./support");function d(m){this.files=[],this.loadOptions=m}d.prototype={checkSignature:function(m){if(!this.reader.readAndCheckSignature(m)){this.reader.index-=4;var y=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(y)+", expected "+s.pretty(m)+")")}},isSignature:function(m,y){var x=this.reader.index;this.reader.setIndex(m);var C=this.reader.readString(4)===y;return this.reader.setIndex(x),C},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var m=this.reader.readData(this.zipCommentLength),y=h.uint8array?"uint8array":"array",x=s.transformTo(y,m);this.zipComment=this.loadOptions.decodeFileName(x)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var m,y,x,C=this.zip64EndOfCentralSize-44;0<C;)m=this.reader.readInt(2),y=this.reader.readInt(4),x=this.reader.readData(y),this.zip64ExtensibleData[m]={id:m,length:y,value:x}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var m,y;for(m=0;m<this.files.length;m++)y=this.files[m],this.reader.setIndex(y.localHeaderOffset),this.checkSignature(l.LOCAL_FILE_HEADER),y.readLocalPart(this.reader),y.handleUTF8(),y.processAttributes()},readCentralDir:function(){var m;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(l.CENTRAL_FILE_HEADER);)(m=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(m);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var m=this.reader.lastIndexOfSignature(l.CENTRAL_DIRECTORY_END);if(m<0)throw this.isSignature(0,l.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(m);var y=m;if(this.checkSignature(l.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(m=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(m),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,l.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var x=this.centralDirOffset+this.centralDirSize;this.zip64&&(x+=20,x+=12+this.zip64EndOfCentralSize);var C=y-x;if(0<C)this.isSignature(y,l.CENTRAL_FILE_HEADER)||(this.reader.zero=C);else if(C<0)throw new Error("Corrupted zip: missing "+Math.abs(C)+" bytes.")},prepareReader:function(m){this.reader=o(m)},load:function(m){this.prepareReader(m),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=d},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,r){var o=t("./reader/readerFor"),s=t("./utils"),l=t("./compressedObject"),u=t("./crc32"),h=t("./utf8"),d=t("./compressions"),m=t("./support");function y(x,C){this.options=x,this.loadOptions=C}y.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(x){var C,w;if(x.skip(22),this.fileNameLength=x.readInt(2),w=x.readInt(2),this.fileName=x.readData(this.fileNameLength),x.skip(w),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((C=(function(E){for(var T in d)if(Object.prototype.hasOwnProperty.call(d,T)&&d[T].magic===E)return d[T];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new l(this.compressedSize,this.uncompressedSize,this.crc32,C,x.readData(this.compressedSize))},readCentralPart:function(x){this.versionMadeBy=x.readInt(2),x.skip(2),this.bitFlag=x.readInt(2),this.compressionMethod=x.readString(2),this.date=x.readDate(),this.crc32=x.readInt(4),this.compressedSize=x.readInt(4),this.uncompressedSize=x.readInt(4);var C=x.readInt(2);if(this.extraFieldsLength=x.readInt(2),this.fileCommentLength=x.readInt(2),this.diskNumberStart=x.readInt(2),this.internalFileAttributes=x.readInt(2),this.externalFileAttributes=x.readInt(4),this.localHeaderOffset=x.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");x.skip(C),this.readExtraFields(x),this.parseZIP64ExtraField(x),this.fileComment=x.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var x=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),x==0&&(this.dosPermissions=63&this.externalFileAttributes),x==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var x=o(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=x.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=x.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=x.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=x.readInt(4))}},readExtraFields:function(x){var C,w,E,T=x.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});x.index+4<T;)C=x.readInt(2),w=x.readInt(2),E=x.readData(w),this.extraFields[C]={id:C,length:w,value:E};x.setIndex(T)},handleUTF8:function(){var x=m.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var C=this.findExtraFieldUnicodePath();if(C!==null)this.fileNameStr=C;else{var w=s.transformTo(x,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(w)}var E=this.findExtraFieldUnicodeComment();if(E!==null)this.fileCommentStr=E;else{var T=s.transformTo(x,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(T)}}},findExtraFieldUnicodePath:function(){var x=this.extraFields[28789];if(x){var C=o(x.value);return C.readInt(1)!==1||u(this.fileName)!==C.readInt(4)?null:h.utf8decode(C.readData(x.length-5))}return null},findExtraFieldUnicodeComment:function(){var x=this.extraFields[25461];if(x){var C=o(x.value);return C.readInt(1)!==1||u(this.fileComment)!==C.readInt(4)?null:h.utf8decode(C.readData(x.length-5))}return null}},i.exports=y},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,r){function o(C,w,E){this.name=C,this.dir=E.dir,this.date=E.date,this.comment=E.comment,this.unixPermissions=E.unixPermissions,this.dosPermissions=E.dosPermissions,this._data=w,this._dataBinary=E.binary,this.options={compression:E.compression,compressionOptions:E.compressionOptions}}var s=t("./stream/StreamHelper"),l=t("./stream/DataWorker"),u=t("./utf8"),h=t("./compressedObject"),d=t("./stream/GenericWorker");o.prototype={internalStream:function(C){var w=null,E="string";try{if(!C)throw new Error("No output type specified.");var T=(E=C.toLowerCase())==="string"||E==="text";E!=="binarystring"&&E!=="text"||(E="string"),w=this._decompressWorker();var k=!this._dataBinary;k&&!T&&(w=w.pipe(new u.Utf8EncodeWorker)),!k&&T&&(w=w.pipe(new u.Utf8DecodeWorker))}catch(G){(w=new d("error")).error(G)}return new s(w,E,"")},async:function(C,w){return this.internalStream(C).accumulate(w)},nodeStream:function(C,w){return this.internalStream(C||"nodebuffer").toNodejsStream(w)},_compressWorker:function(C,w){if(this._data instanceof h&&this._data.compression.magic===C.magic)return this._data.getCompressedWorker();var E=this._decompressWorker();return this._dataBinary||(E=E.pipe(new u.Utf8EncodeWorker)),h.createWorkerFrom(E,C,w)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof d?this._data:new l(this._data)}};for(var m=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],y=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},x=0;x<m.length;x++)o.prototype[m[x]]=y;i.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,r){(function(o){var s,l,u=o.MutationObserver||o.WebKitMutationObserver;if(u){var h=0,d=new u(C),m=o.document.createTextNode("");d.observe(m,{characterData:!0}),s=function(){m.data=h=++h%2}}else if(o.setImmediate||o.MessageChannel===void 0)s="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var w=o.document.createElement("script");w.onreadystatechange=function(){C(),w.onreadystatechange=null,w.parentNode.removeChild(w),w=null},o.document.documentElement.appendChild(w)}:function(){setTimeout(C,0)};else{var y=new o.MessageChannel;y.port1.onmessage=C,s=function(){y.port2.postMessage(0)}}var x=[];function C(){var w,E;l=!0;for(var T=x.length;T;){for(E=x,x=[],w=-1;++w<T;)E[w]();T=x.length}l=!1}i.exports=function(w){x.push(w)!==1||l||s()}}).call(this,typeof Jd<"u"?Jd:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,r){var o=t("immediate");function s(){}var l={},u=["REJECTED"],h=["FULFILLED"],d=["PENDING"];function m(T){if(typeof T!="function")throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,T!==s&&w(this,T)}function y(T,k,G){this.promise=T,typeof k=="function"&&(this.onFulfilled=k,this.callFulfilled=this.otherCallFulfilled),typeof G=="function"&&(this.onRejected=G,this.callRejected=this.otherCallRejected)}function x(T,k,G){o(function(){var O;try{O=k(G)}catch(V){return l.reject(T,V)}O===T?l.reject(T,new TypeError("Cannot resolve promise with itself")):l.resolve(T,O)})}function C(T){var k=T&&T.then;if(T&&(typeof T=="object"||typeof T=="function")&&typeof k=="function")return function(){k.apply(T,arguments)}}function w(T,k){var G=!1;function O(H){G||(G=!0,l.reject(T,H))}function V(H){G||(G=!0,l.resolve(T,H))}var z=E(function(){k(V,O)});z.status==="error"&&O(z.value)}function E(T,k){var G={};try{G.value=T(k),G.status="success"}catch(O){G.status="error",G.value=O}return G}(i.exports=m).prototype.finally=function(T){if(typeof T!="function")return this;var k=this.constructor;return this.then(function(G){return k.resolve(T()).then(function(){return G})},function(G){return k.resolve(T()).then(function(){throw G})})},m.prototype.catch=function(T){return this.then(null,T)},m.prototype.then=function(T,k){if(typeof T!="function"&&this.state===h||typeof k!="function"&&this.state===u)return this;var G=new this.constructor(s);return this.state!==d?x(G,this.state===h?T:k,this.outcome):this.queue.push(new y(G,T,k)),G},y.prototype.callFulfilled=function(T){l.resolve(this.promise,T)},y.prototype.otherCallFulfilled=function(T){x(this.promise,this.onFulfilled,T)},y.prototype.callRejected=function(T){l.reject(this.promise,T)},y.prototype.otherCallRejected=function(T){x(this.promise,this.onRejected,T)},l.resolve=function(T,k){var G=E(C,k);if(G.status==="error")return l.reject(T,G.value);var O=G.value;if(O)w(T,O);else{T.state=h,T.outcome=k;for(var V=-1,z=T.queue.length;++V<z;)T.queue[V].callFulfilled(k)}return T},l.reject=function(T,k){T.state=u,T.outcome=k;for(var G=-1,O=T.queue.length;++G<O;)T.queue[G].callRejected(k);return T},m.resolve=function(T){return T instanceof this?T:l.resolve(new this(s),T)},m.reject=function(T){var k=new this(s);return l.reject(k,T)},m.all=function(T){var k=this;if(Object.prototype.toString.call(T)!=="[object Array]")return this.reject(new TypeError("must be an array"));var G=T.length,O=!1;if(!G)return this.resolve([]);for(var V=new Array(G),z=0,H=-1,te=new this(s);++H<G;)$(T[H],H);return te;function $(ae,fe){k.resolve(ae).then(function(Y){V[fe]=Y,++z!==G||O||(O=!0,l.resolve(te,V))},function(Y){O||(O=!0,l.reject(te,Y))})}},m.race=function(T){var k=this;if(Object.prototype.toString.call(T)!=="[object Array]")return this.reject(new TypeError("must be an array"));var G=T.length,O=!1;if(!G)return this.resolve([]);for(var V=-1,z=new this(s);++V<G;)H=T[V],k.resolve(H).then(function(te){O||(O=!0,l.resolve(z,te))},function(te){O||(O=!0,l.reject(z,te))});var H;return z}},{immediate:36}],38:[function(t,i,r){var o={};(0,t("./lib/utils/common").assign)(o,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,r){var o=t("./zlib/deflate"),s=t("./utils/common"),l=t("./utils/strings"),u=t("./zlib/messages"),h=t("./zlib/zstream"),d=Object.prototype.toString,m=0,y=-1,x=0,C=8;function w(T){if(!(this instanceof w))return new w(T);this.options=s.assign({level:y,method:C,chunkSize:16384,windowBits:15,memLevel:8,strategy:x,to:""},T||{});var k=this.options;k.raw&&0<k.windowBits?k.windowBits=-k.windowBits:k.gzip&&0<k.windowBits&&k.windowBits<16&&(k.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var G=o.deflateInit2(this.strm,k.level,k.method,k.windowBits,k.memLevel,k.strategy);if(G!==m)throw new Error(u[G]);if(k.header&&o.deflateSetHeader(this.strm,k.header),k.dictionary){var O;if(O=typeof k.dictionary=="string"?l.string2buf(k.dictionary):d.call(k.dictionary)==="[object ArrayBuffer]"?new Uint8Array(k.dictionary):k.dictionary,(G=o.deflateSetDictionary(this.strm,O))!==m)throw new Error(u[G]);this._dict_set=!0}}function E(T,k){var G=new w(k);if(G.push(T,!0),G.err)throw G.msg||u[G.err];return G.result}w.prototype.push=function(T,k){var G,O,V=this.strm,z=this.options.chunkSize;if(this.ended)return!1;O=k===~~k?k:k===!0?4:0,typeof T=="string"?V.input=l.string2buf(T):d.call(T)==="[object ArrayBuffer]"?V.input=new Uint8Array(T):V.input=T,V.next_in=0,V.avail_in=V.input.length;do{if(V.avail_out===0&&(V.output=new s.Buf8(z),V.next_out=0,V.avail_out=z),(G=o.deflate(V,O))!==1&&G!==m)return this.onEnd(G),!(this.ended=!0);V.avail_out!==0&&(V.avail_in!==0||O!==4&&O!==2)||(this.options.to==="string"?this.onData(l.buf2binstring(s.shrinkBuf(V.output,V.next_out))):this.onData(s.shrinkBuf(V.output,V.next_out)))}while((0<V.avail_in||V.avail_out===0)&&G!==1);return O===4?(G=o.deflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===m):O!==2||(this.onEnd(m),!(V.avail_out=0))},w.prototype.onData=function(T){this.chunks.push(T)},w.prototype.onEnd=function(T){T===m&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=T,this.msg=this.strm.msg},r.Deflate=w,r.deflate=E,r.deflateRaw=function(T,k){return(k=k||{}).raw=!0,E(T,k)},r.gzip=function(T,k){return(k=k||{}).gzip=!0,E(T,k)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,r){var o=t("./zlib/inflate"),s=t("./utils/common"),l=t("./utils/strings"),u=t("./zlib/constants"),h=t("./zlib/messages"),d=t("./zlib/zstream"),m=t("./zlib/gzheader"),y=Object.prototype.toString;function x(w){if(!(this instanceof x))return new x(w);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},w||{});var E=this.options;E.raw&&0<=E.windowBits&&E.windowBits<16&&(E.windowBits=-E.windowBits,E.windowBits===0&&(E.windowBits=-15)),!(0<=E.windowBits&&E.windowBits<16)||w&&w.windowBits||(E.windowBits+=32),15<E.windowBits&&E.windowBits<48&&(15&E.windowBits)==0&&(E.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var T=o.inflateInit2(this.strm,E.windowBits);if(T!==u.Z_OK)throw new Error(h[T]);this.header=new m,o.inflateGetHeader(this.strm,this.header)}function C(w,E){var T=new x(E);if(T.push(w,!0),T.err)throw T.msg||h[T.err];return T.result}x.prototype.push=function(w,E){var T,k,G,O,V,z,H=this.strm,te=this.options.chunkSize,$=this.options.dictionary,ae=!1;if(this.ended)return!1;k=E===~~E?E:E===!0?u.Z_FINISH:u.Z_NO_FLUSH,typeof w=="string"?H.input=l.binstring2buf(w):y.call(w)==="[object ArrayBuffer]"?H.input=new Uint8Array(w):H.input=w,H.next_in=0,H.avail_in=H.input.length;do{if(H.avail_out===0&&(H.output=new s.Buf8(te),H.next_out=0,H.avail_out=te),(T=o.inflate(H,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&$&&(z=typeof $=="string"?l.string2buf($):y.call($)==="[object ArrayBuffer]"?new Uint8Array($):$,T=o.inflateSetDictionary(this.strm,z)),T===u.Z_BUF_ERROR&&ae===!0&&(T=u.Z_OK,ae=!1),T!==u.Z_STREAM_END&&T!==u.Z_OK)return this.onEnd(T),!(this.ended=!0);H.next_out&&(H.avail_out!==0&&T!==u.Z_STREAM_END&&(H.avail_in!==0||k!==u.Z_FINISH&&k!==u.Z_SYNC_FLUSH)||(this.options.to==="string"?(G=l.utf8border(H.output,H.next_out),O=H.next_out-G,V=l.buf2string(H.output,G),H.next_out=O,H.avail_out=te-O,O&&s.arraySet(H.output,H.output,G,O,0),this.onData(V)):this.onData(s.shrinkBuf(H.output,H.next_out)))),H.avail_in===0&&H.avail_out===0&&(ae=!0)}while((0<H.avail_in||H.avail_out===0)&&T!==u.Z_STREAM_END);return T===u.Z_STREAM_END&&(k=u.Z_FINISH),k===u.Z_FINISH?(T=o.inflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===u.Z_OK):k!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),!(H.avail_out=0))},x.prototype.onData=function(w){this.chunks.push(w)},x.prototype.onEnd=function(w){w===u.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},r.Inflate=x,r.inflate=C,r.inflateRaw=function(w,E){return(E=E||{}).raw=!0,C(w,E)},r.ungzip=C},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,r){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(u){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var d=h.shift();if(d){if(typeof d!="object")throw new TypeError(d+"must be non-object");for(var m in d)d.hasOwnProperty(m)&&(u[m]=d[m])}}return u},r.shrinkBuf=function(u,h){return u.length===h?u:u.subarray?u.subarray(0,h):(u.length=h,u)};var s={arraySet:function(u,h,d,m,y){if(h.subarray&&u.subarray)u.set(h.subarray(d,d+m),y);else for(var x=0;x<m;x++)u[y+x]=h[d+x]},flattenChunks:function(u){var h,d,m,y,x,C;for(h=m=0,d=u.length;h<d;h++)m+=u[h].length;for(C=new Uint8Array(m),h=y=0,d=u.length;h<d;h++)x=u[h],C.set(x,y),y+=x.length;return C}},l={arraySet:function(u,h,d,m,y){for(var x=0;x<m;x++)u[y+x]=h[d+x]},flattenChunks:function(u){return[].concat.apply([],u)}};r.setTyped=function(u){u?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,s)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,l))},r.setTyped(o)},{}],42:[function(t,i,r){var o=t("./common"),s=!0,l=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l=!1}for(var u=new o.Buf8(256),h=0;h<256;h++)u[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function d(m,y){if(y<65537&&(m.subarray&&l||!m.subarray&&s))return String.fromCharCode.apply(null,o.shrinkBuf(m,y));for(var x="",C=0;C<y;C++)x+=String.fromCharCode(m[C]);return x}u[254]=u[254]=1,r.string2buf=function(m){var y,x,C,w,E,T=m.length,k=0;for(w=0;w<T;w++)(64512&(x=m.charCodeAt(w)))==55296&&w+1<T&&(64512&(C=m.charCodeAt(w+1)))==56320&&(x=65536+(x-55296<<10)+(C-56320),w++),k+=x<128?1:x<2048?2:x<65536?3:4;for(y=new o.Buf8(k),w=E=0;E<k;w++)(64512&(x=m.charCodeAt(w)))==55296&&w+1<T&&(64512&(C=m.charCodeAt(w+1)))==56320&&(x=65536+(x-55296<<10)+(C-56320),w++),x<128?y[E++]=x:(x<2048?y[E++]=192|x>>>6:(x<65536?y[E++]=224|x>>>12:(y[E++]=240|x>>>18,y[E++]=128|x>>>12&63),y[E++]=128|x>>>6&63),y[E++]=128|63&x);return y},r.buf2binstring=function(m){return d(m,m.length)},r.binstring2buf=function(m){for(var y=new o.Buf8(m.length),x=0,C=y.length;x<C;x++)y[x]=m.charCodeAt(x);return y},r.buf2string=function(m,y){var x,C,w,E,T=y||m.length,k=new Array(2*T);for(x=C=0;x<T;)if((w=m[x++])<128)k[C++]=w;else if(4<(E=u[w]))k[C++]=65533,x+=E-1;else{for(w&=E===2?31:E===3?15:7;1<E&&x<T;)w=w<<6|63&m[x++],E--;1<E?k[C++]=65533:w<65536?k[C++]=w:(w-=65536,k[C++]=55296|w>>10&1023,k[C++]=56320|1023&w)}return d(k,C)},r.utf8border=function(m,y){var x;for((y=y||m.length)>m.length&&(y=m.length),x=y-1;0<=x&&(192&m[x])==128;)x--;return x<0||x===0?y:x+u[m[x]]>y?x:y}},{"./common":41}],43:[function(t,i,r){i.exports=function(o,s,l,u){for(var h=65535&o|0,d=o>>>16&65535|0,m=0;l!==0;){for(l-=m=2e3<l?2e3:l;d=d+(h=h+s[u++]|0)|0,--m;);h%=65521,d%=65521}return h|d<<16|0}},{}],44:[function(t,i,r){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,r){var o=(function(){for(var s,l=[],u=0;u<256;u++){s=u;for(var h=0;h<8;h++)s=1&s?3988292384^s>>>1:s>>>1;l[u]=s}return l})();i.exports=function(s,l,u,h){var d=o,m=h+u;s^=-1;for(var y=h;y<m;y++)s=s>>>8^d[255&(s^l[y])];return-1^s}},{}],46:[function(t,i,r){var o,s=t("../utils/common"),l=t("./trees"),u=t("./adler32"),h=t("./crc32"),d=t("./messages"),m=0,y=4,x=0,C=-2,w=-1,E=4,T=2,k=8,G=9,O=286,V=30,z=19,H=2*O+1,te=15,$=3,ae=258,fe=ae+$+1,Y=42,de=113,D=1,oe=2,ue=3,ge=4;function Ne(W,Ze){return W.msg=d[Ze],Ze}function Ee(W){return(W<<1)-(4<W?9:0)}function se(W){for(var Ze=W.length;0<=--Ze;)W[Ze]=0}function q(W){var Ze=W.state,Re=Ze.pending;Re>W.avail_out&&(Re=W.avail_out),Re!==0&&(s.arraySet(W.output,Ze.pending_buf,Ze.pending_out,Re,W.next_out),W.next_out+=Re,Ze.pending_out+=Re,W.total_out+=Re,W.avail_out-=Re,Ze.pending-=Re,Ze.pending===0&&(Ze.pending_out=0))}function j(W,Ze){l._tr_flush_block(W,0<=W.block_start?W.block_start:-1,W.strstart-W.block_start,Ze),W.block_start=W.strstart,q(W.strm)}function ze(W,Ze){W.pending_buf[W.pending++]=Ze}function je(W,Ze){W.pending_buf[W.pending++]=Ze>>>8&255,W.pending_buf[W.pending++]=255&Ze}function qe(W,Ze){var Re,ce,me=W.max_chain_length,_e=W.strstart,Ie=W.prev_length,pe=W.nice_match,Te=W.strstart>W.w_size-fe?W.strstart-(W.w_size-fe):0,We=W.window,tt=W.w_mask,nt=W.prev,bt=W.strstart+ae,on=We[_e+Ie-1],an=We[_e+Ie];W.prev_length>=W.good_match&&(me>>=2),pe>W.lookahead&&(pe=W.lookahead);do if(We[(Re=Ze)+Ie]===an&&We[Re+Ie-1]===on&&We[Re]===We[_e]&&We[++Re]===We[_e+1]){_e+=2,Re++;do;while(We[++_e]===We[++Re]&&We[++_e]===We[++Re]&&We[++_e]===We[++Re]&&We[++_e]===We[++Re]&&We[++_e]===We[++Re]&&We[++_e]===We[++Re]&&We[++_e]===We[++Re]&&We[++_e]===We[++Re]&&_e<bt);if(ce=ae-(bt-_e),_e=bt-ae,Ie<ce){if(W.match_start=Ze,pe<=(Ie=ce))break;on=We[_e+Ie-1],an=We[_e+Ie]}}while((Ze=nt[Ze&tt])>Te&&--me!=0);return Ie<=W.lookahead?Ie:W.lookahead}function yt(W){var Ze,Re,ce,me,_e,Ie,pe,Te,We,tt,nt=W.w_size;do{if(me=W.window_size-W.lookahead-W.strstart,W.strstart>=nt+(nt-fe)){for(s.arraySet(W.window,W.window,nt,nt,0),W.match_start-=nt,W.strstart-=nt,W.block_start-=nt,Ze=Re=W.hash_size;ce=W.head[--Ze],W.head[Ze]=nt<=ce?ce-nt:0,--Re;);for(Ze=Re=nt;ce=W.prev[--Ze],W.prev[Ze]=nt<=ce?ce-nt:0,--Re;);me+=nt}if(W.strm.avail_in===0)break;if(Ie=W.strm,pe=W.window,Te=W.strstart+W.lookahead,We=me,tt=void 0,tt=Ie.avail_in,We<tt&&(tt=We),Re=tt===0?0:(Ie.avail_in-=tt,s.arraySet(pe,Ie.input,Ie.next_in,tt,Te),Ie.state.wrap===1?Ie.adler=u(Ie.adler,pe,tt,Te):Ie.state.wrap===2&&(Ie.adler=h(Ie.adler,pe,tt,Te)),Ie.next_in+=tt,Ie.total_in+=tt,tt),W.lookahead+=Re,W.lookahead+W.insert>=$)for(_e=W.strstart-W.insert,W.ins_h=W.window[_e],W.ins_h=(W.ins_h<<W.hash_shift^W.window[_e+1])&W.hash_mask;W.insert&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[_e+$-1])&W.hash_mask,W.prev[_e&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=_e,_e++,W.insert--,!(W.lookahead+W.insert<$)););}while(W.lookahead<fe&&W.strm.avail_in!==0)}function xt(W,Ze){for(var Re,ce;;){if(W.lookahead<fe){if(yt(W),W.lookahead<fe&&Ze===m)return D;if(W.lookahead===0)break}if(Re=0,W.lookahead>=$&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+$-1])&W.hash_mask,Re=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),Re!==0&&W.strstart-Re<=W.w_size-fe&&(W.match_length=qe(W,Re)),W.match_length>=$)if(ce=l._tr_tally(W,W.strstart-W.match_start,W.match_length-$),W.lookahead-=W.match_length,W.match_length<=W.max_lazy_match&&W.lookahead>=$){for(W.match_length--;W.strstart++,W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+$-1])&W.hash_mask,Re=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart,--W.match_length!=0;);W.strstart++}else W.strstart+=W.match_length,W.match_length=0,W.ins_h=W.window[W.strstart],W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+1])&W.hash_mask;else ce=l._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++;if(ce&&(j(W,!1),W.strm.avail_out===0))return D}return W.insert=W.strstart<$-1?W.strstart:$-1,Ze===y?(j(W,!0),W.strm.avail_out===0?ue:ge):W.last_lit&&(j(W,!1),W.strm.avail_out===0)?D:oe}function Et(W,Ze){for(var Re,ce,me;;){if(W.lookahead<fe){if(yt(W),W.lookahead<fe&&Ze===m)return D;if(W.lookahead===0)break}if(Re=0,W.lookahead>=$&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+$-1])&W.hash_mask,Re=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),W.prev_length=W.match_length,W.prev_match=W.match_start,W.match_length=$-1,Re!==0&&W.prev_length<W.max_lazy_match&&W.strstart-Re<=W.w_size-fe&&(W.match_length=qe(W,Re),W.match_length<=5&&(W.strategy===1||W.match_length===$&&4096<W.strstart-W.match_start)&&(W.match_length=$-1)),W.prev_length>=$&&W.match_length<=W.prev_length){for(me=W.strstart+W.lookahead-$,ce=l._tr_tally(W,W.strstart-1-W.prev_match,W.prev_length-$),W.lookahead-=W.prev_length-1,W.prev_length-=2;++W.strstart<=me&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+$-1])&W.hash_mask,Re=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),--W.prev_length!=0;);if(W.match_available=0,W.match_length=$-1,W.strstart++,ce&&(j(W,!1),W.strm.avail_out===0))return D}else if(W.match_available){if((ce=l._tr_tally(W,0,W.window[W.strstart-1]))&&j(W,!1),W.strstart++,W.lookahead--,W.strm.avail_out===0)return D}else W.match_available=1,W.strstart++,W.lookahead--}return W.match_available&&(ce=l._tr_tally(W,0,W.window[W.strstart-1]),W.match_available=0),W.insert=W.strstart<$-1?W.strstart:$-1,Ze===y?(j(W,!0),W.strm.avail_out===0?ue:ge):W.last_lit&&(j(W,!1),W.strm.avail_out===0)?D:oe}function kt(W,Ze,Re,ce,me){this.good_length=W,this.max_lazy=Ze,this.nice_length=Re,this.max_chain=ce,this.func=me}function hn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*H),this.dyn_dtree=new s.Buf16(2*(2*V+1)),this.bl_tree=new s.Buf16(2*(2*z+1)),se(this.dyn_ltree),se(this.dyn_dtree),se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(te+1),this.heap=new s.Buf16(2*O+1),se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*O+1),se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function wn(W){var Ze;return W&&W.state?(W.total_in=W.total_out=0,W.data_type=T,(Ze=W.state).pending=0,Ze.pending_out=0,Ze.wrap<0&&(Ze.wrap=-Ze.wrap),Ze.status=Ze.wrap?Y:de,W.adler=Ze.wrap===2?0:1,Ze.last_flush=m,l._tr_init(Ze),x):Ne(W,C)}function Ge(W){var Ze=wn(W);return Ze===x&&(function(Re){Re.window_size=2*Re.w_size,se(Re.head),Re.max_lazy_match=o[Re.level].max_lazy,Re.good_match=o[Re.level].good_length,Re.nice_match=o[Re.level].nice_length,Re.max_chain_length=o[Re.level].max_chain,Re.strstart=0,Re.block_start=0,Re.lookahead=0,Re.insert=0,Re.match_length=Re.prev_length=$-1,Re.match_available=0,Re.ins_h=0})(W.state),Ze}function ve(W,Ze,Re,ce,me,_e){if(!W)return C;var Ie=1;if(Ze===w&&(Ze=6),ce<0?(Ie=0,ce=-ce):15<ce&&(Ie=2,ce-=16),me<1||G<me||Re!==k||ce<8||15<ce||Ze<0||9<Ze||_e<0||E<_e)return Ne(W,C);ce===8&&(ce=9);var pe=new hn;return(W.state=pe).strm=W,pe.wrap=Ie,pe.gzhead=null,pe.w_bits=ce,pe.w_size=1<<pe.w_bits,pe.w_mask=pe.w_size-1,pe.hash_bits=me+7,pe.hash_size=1<<pe.hash_bits,pe.hash_mask=pe.hash_size-1,pe.hash_shift=~~((pe.hash_bits+$-1)/$),pe.window=new s.Buf8(2*pe.w_size),pe.head=new s.Buf16(pe.hash_size),pe.prev=new s.Buf16(pe.w_size),pe.lit_bufsize=1<<me+6,pe.pending_buf_size=4*pe.lit_bufsize,pe.pending_buf=new s.Buf8(pe.pending_buf_size),pe.d_buf=1*pe.lit_bufsize,pe.l_buf=3*pe.lit_bufsize,pe.level=Ze,pe.strategy=_e,pe.method=Re,Ge(W)}o=[new kt(0,0,0,0,function(W,Ze){var Re=65535;for(Re>W.pending_buf_size-5&&(Re=W.pending_buf_size-5);;){if(W.lookahead<=1){if(yt(W),W.lookahead===0&&Ze===m)return D;if(W.lookahead===0)break}W.strstart+=W.lookahead,W.lookahead=0;var ce=W.block_start+Re;if((W.strstart===0||W.strstart>=ce)&&(W.lookahead=W.strstart-ce,W.strstart=ce,j(W,!1),W.strm.avail_out===0)||W.strstart-W.block_start>=W.w_size-fe&&(j(W,!1),W.strm.avail_out===0))return D}return W.insert=0,Ze===y?(j(W,!0),W.strm.avail_out===0?ue:ge):(W.strstart>W.block_start&&(j(W,!1),W.strm.avail_out),D)}),new kt(4,4,8,4,xt),new kt(4,5,16,8,xt),new kt(4,6,32,32,xt),new kt(4,4,16,16,Et),new kt(8,16,32,32,Et),new kt(8,16,128,128,Et),new kt(8,32,128,256,Et),new kt(32,128,258,1024,Et),new kt(32,258,258,4096,Et)],r.deflateInit=function(W,Ze){return ve(W,Ze,k,15,8,0)},r.deflateInit2=ve,r.deflateReset=Ge,r.deflateResetKeep=wn,r.deflateSetHeader=function(W,Ze){return W&&W.state?W.state.wrap!==2?C:(W.state.gzhead=Ze,x):C},r.deflate=function(W,Ze){var Re,ce,me,_e;if(!W||!W.state||5<Ze||Ze<0)return W?Ne(W,C):C;if(ce=W.state,!W.output||!W.input&&W.avail_in!==0||ce.status===666&&Ze!==y)return Ne(W,W.avail_out===0?-5:C);if(ce.strm=W,Re=ce.last_flush,ce.last_flush=Ze,ce.status===Y)if(ce.wrap===2)W.adler=0,ze(ce,31),ze(ce,139),ze(ce,8),ce.gzhead?(ze(ce,(ce.gzhead.text?1:0)+(ce.gzhead.hcrc?2:0)+(ce.gzhead.extra?4:0)+(ce.gzhead.name?8:0)+(ce.gzhead.comment?16:0)),ze(ce,255&ce.gzhead.time),ze(ce,ce.gzhead.time>>8&255),ze(ce,ce.gzhead.time>>16&255),ze(ce,ce.gzhead.time>>24&255),ze(ce,ce.level===9?2:2<=ce.strategy||ce.level<2?4:0),ze(ce,255&ce.gzhead.os),ce.gzhead.extra&&ce.gzhead.extra.length&&(ze(ce,255&ce.gzhead.extra.length),ze(ce,ce.gzhead.extra.length>>8&255)),ce.gzhead.hcrc&&(W.adler=h(W.adler,ce.pending_buf,ce.pending,0)),ce.gzindex=0,ce.status=69):(ze(ce,0),ze(ce,0),ze(ce,0),ze(ce,0),ze(ce,0),ze(ce,ce.level===9?2:2<=ce.strategy||ce.level<2?4:0),ze(ce,3),ce.status=de);else{var Ie=k+(ce.w_bits-8<<4)<<8;Ie|=(2<=ce.strategy||ce.level<2?0:ce.level<6?1:ce.level===6?2:3)<<6,ce.strstart!==0&&(Ie|=32),Ie+=31-Ie%31,ce.status=de,je(ce,Ie),ce.strstart!==0&&(je(ce,W.adler>>>16),je(ce,65535&W.adler)),W.adler=1}if(ce.status===69)if(ce.gzhead.extra){for(me=ce.pending;ce.gzindex<(65535&ce.gzhead.extra.length)&&(ce.pending!==ce.pending_buf_size||(ce.gzhead.hcrc&&ce.pending>me&&(W.adler=h(W.adler,ce.pending_buf,ce.pending-me,me)),q(W),me=ce.pending,ce.pending!==ce.pending_buf_size));)ze(ce,255&ce.gzhead.extra[ce.gzindex]),ce.gzindex++;ce.gzhead.hcrc&&ce.pending>me&&(W.adler=h(W.adler,ce.pending_buf,ce.pending-me,me)),ce.gzindex===ce.gzhead.extra.length&&(ce.gzindex=0,ce.status=73)}else ce.status=73;if(ce.status===73)if(ce.gzhead.name){me=ce.pending;do{if(ce.pending===ce.pending_buf_size&&(ce.gzhead.hcrc&&ce.pending>me&&(W.adler=h(W.adler,ce.pending_buf,ce.pending-me,me)),q(W),me=ce.pending,ce.pending===ce.pending_buf_size)){_e=1;break}_e=ce.gzindex<ce.gzhead.name.length?255&ce.gzhead.name.charCodeAt(ce.gzindex++):0,ze(ce,_e)}while(_e!==0);ce.gzhead.hcrc&&ce.pending>me&&(W.adler=h(W.adler,ce.pending_buf,ce.pending-me,me)),_e===0&&(ce.gzindex=0,ce.status=91)}else ce.status=91;if(ce.status===91)if(ce.gzhead.comment){me=ce.pending;do{if(ce.pending===ce.pending_buf_size&&(ce.gzhead.hcrc&&ce.pending>me&&(W.adler=h(W.adler,ce.pending_buf,ce.pending-me,me)),q(W),me=ce.pending,ce.pending===ce.pending_buf_size)){_e=1;break}_e=ce.gzindex<ce.gzhead.comment.length?255&ce.gzhead.comment.charCodeAt(ce.gzindex++):0,ze(ce,_e)}while(_e!==0);ce.gzhead.hcrc&&ce.pending>me&&(W.adler=h(W.adler,ce.pending_buf,ce.pending-me,me)),_e===0&&(ce.status=103)}else ce.status=103;if(ce.status===103&&(ce.gzhead.hcrc?(ce.pending+2>ce.pending_buf_size&&q(W),ce.pending+2<=ce.pending_buf_size&&(ze(ce,255&W.adler),ze(ce,W.adler>>8&255),W.adler=0,ce.status=de)):ce.status=de),ce.pending!==0){if(q(W),W.avail_out===0)return ce.last_flush=-1,x}else if(W.avail_in===0&&Ee(Ze)<=Ee(Re)&&Ze!==y)return Ne(W,-5);if(ce.status===666&&W.avail_in!==0)return Ne(W,-5);if(W.avail_in!==0||ce.lookahead!==0||Ze!==m&&ce.status!==666){var pe=ce.strategy===2?(function(Te,We){for(var tt;;){if(Te.lookahead===0&&(yt(Te),Te.lookahead===0)){if(We===m)return D;break}if(Te.match_length=0,tt=l._tr_tally(Te,0,Te.window[Te.strstart]),Te.lookahead--,Te.strstart++,tt&&(j(Te,!1),Te.strm.avail_out===0))return D}return Te.insert=0,We===y?(j(Te,!0),Te.strm.avail_out===0?ue:ge):Te.last_lit&&(j(Te,!1),Te.strm.avail_out===0)?D:oe})(ce,Ze):ce.strategy===3?(function(Te,We){for(var tt,nt,bt,on,an=Te.window;;){if(Te.lookahead<=ae){if(yt(Te),Te.lookahead<=ae&&We===m)return D;if(Te.lookahead===0)break}if(Te.match_length=0,Te.lookahead>=$&&0<Te.strstart&&(nt=an[bt=Te.strstart-1])===an[++bt]&&nt===an[++bt]&&nt===an[++bt]){on=Te.strstart+ae;do;while(nt===an[++bt]&&nt===an[++bt]&&nt===an[++bt]&&nt===an[++bt]&&nt===an[++bt]&&nt===an[++bt]&&nt===an[++bt]&&nt===an[++bt]&&bt<on);Te.match_length=ae-(on-bt),Te.match_length>Te.lookahead&&(Te.match_length=Te.lookahead)}if(Te.match_length>=$?(tt=l._tr_tally(Te,1,Te.match_length-$),Te.lookahead-=Te.match_length,Te.strstart+=Te.match_length,Te.match_length=0):(tt=l._tr_tally(Te,0,Te.window[Te.strstart]),Te.lookahead--,Te.strstart++),tt&&(j(Te,!1),Te.strm.avail_out===0))return D}return Te.insert=0,We===y?(j(Te,!0),Te.strm.avail_out===0?ue:ge):Te.last_lit&&(j(Te,!1),Te.strm.avail_out===0)?D:oe})(ce,Ze):o[ce.level].func(ce,Ze);if(pe!==ue&&pe!==ge||(ce.status=666),pe===D||pe===ue)return W.avail_out===0&&(ce.last_flush=-1),x;if(pe===oe&&(Ze===1?l._tr_align(ce):Ze!==5&&(l._tr_stored_block(ce,0,0,!1),Ze===3&&(se(ce.head),ce.lookahead===0&&(ce.strstart=0,ce.block_start=0,ce.insert=0))),q(W),W.avail_out===0))return ce.last_flush=-1,x}return Ze!==y?x:ce.wrap<=0?1:(ce.wrap===2?(ze(ce,255&W.adler),ze(ce,W.adler>>8&255),ze(ce,W.adler>>16&255),ze(ce,W.adler>>24&255),ze(ce,255&W.total_in),ze(ce,W.total_in>>8&255),ze(ce,W.total_in>>16&255),ze(ce,W.total_in>>24&255)):(je(ce,W.adler>>>16),je(ce,65535&W.adler)),q(W),0<ce.wrap&&(ce.wrap=-ce.wrap),ce.pending!==0?x:1)},r.deflateEnd=function(W){var Ze;return W&&W.state?(Ze=W.state.status)!==Y&&Ze!==69&&Ze!==73&&Ze!==91&&Ze!==103&&Ze!==de&&Ze!==666?Ne(W,C):(W.state=null,Ze===de?Ne(W,-3):x):C},r.deflateSetDictionary=function(W,Ze){var Re,ce,me,_e,Ie,pe,Te,We,tt=Ze.length;if(!W||!W.state||(_e=(Re=W.state).wrap)===2||_e===1&&Re.status!==Y||Re.lookahead)return C;for(_e===1&&(W.adler=u(W.adler,Ze,tt,0)),Re.wrap=0,tt>=Re.w_size&&(_e===0&&(se(Re.head),Re.strstart=0,Re.block_start=0,Re.insert=0),We=new s.Buf8(Re.w_size),s.arraySet(We,Ze,tt-Re.w_size,Re.w_size,0),Ze=We,tt=Re.w_size),Ie=W.avail_in,pe=W.next_in,Te=W.input,W.avail_in=tt,W.next_in=0,W.input=Ze,yt(Re);Re.lookahead>=$;){for(ce=Re.strstart,me=Re.lookahead-($-1);Re.ins_h=(Re.ins_h<<Re.hash_shift^Re.window[ce+$-1])&Re.hash_mask,Re.prev[ce&Re.w_mask]=Re.head[Re.ins_h],Re.head[Re.ins_h]=ce,ce++,--me;);Re.strstart=ce,Re.lookahead=$-1,yt(Re)}return Re.strstart+=Re.lookahead,Re.block_start=Re.strstart,Re.insert=Re.lookahead,Re.lookahead=0,Re.match_length=Re.prev_length=$-1,Re.match_available=0,W.next_in=pe,W.input=Te,W.avail_in=Ie,Re.wrap=_e,x},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,r){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,r){i.exports=function(o,s){var l,u,h,d,m,y,x,C,w,E,T,k,G,O,V,z,H,te,$,ae,fe,Y,de,D,oe;l=o.state,u=o.next_in,D=o.input,h=u+(o.avail_in-5),d=o.next_out,oe=o.output,m=d-(s-o.avail_out),y=d+(o.avail_out-257),x=l.dmax,C=l.wsize,w=l.whave,E=l.wnext,T=l.window,k=l.hold,G=l.bits,O=l.lencode,V=l.distcode,z=(1<<l.lenbits)-1,H=(1<<l.distbits)-1;e:do{G<15&&(k+=D[u++]<<G,G+=8,k+=D[u++]<<G,G+=8),te=O[k&z];t:for(;;){if(k>>>=$=te>>>24,G-=$,($=te>>>16&255)===0)oe[d++]=65535&te;else{if(!(16&$)){if((64&$)==0){te=O[(65535&te)+(k&(1<<$)-1)];continue t}if(32&$){l.mode=12;break e}o.msg="invalid literal/length code",l.mode=30;break e}ae=65535&te,($&=15)&&(G<$&&(k+=D[u++]<<G,G+=8),ae+=k&(1<<$)-1,k>>>=$,G-=$),G<15&&(k+=D[u++]<<G,G+=8,k+=D[u++]<<G,G+=8),te=V[k&H];n:for(;;){if(k>>>=$=te>>>24,G-=$,!(16&($=te>>>16&255))){if((64&$)==0){te=V[(65535&te)+(k&(1<<$)-1)];continue n}o.msg="invalid distance code",l.mode=30;break e}if(fe=65535&te,G<($&=15)&&(k+=D[u++]<<G,(G+=8)<$&&(k+=D[u++]<<G,G+=8)),x<(fe+=k&(1<<$)-1)){o.msg="invalid distance too far back",l.mode=30;break e}if(k>>>=$,G-=$,($=d-m)<fe){if(w<($=fe-$)&&l.sane){o.msg="invalid distance too far back",l.mode=30;break e}if(de=T,(Y=0)===E){if(Y+=C-$,$<ae){for(ae-=$;oe[d++]=T[Y++],--$;);Y=d-fe,de=oe}}else if(E<$){if(Y+=C+E-$,($-=E)<ae){for(ae-=$;oe[d++]=T[Y++],--$;);if(Y=0,E<ae){for(ae-=$=E;oe[d++]=T[Y++],--$;);Y=d-fe,de=oe}}}else if(Y+=E-$,$<ae){for(ae-=$;oe[d++]=T[Y++],--$;);Y=d-fe,de=oe}for(;2<ae;)oe[d++]=de[Y++],oe[d++]=de[Y++],oe[d++]=de[Y++],ae-=3;ae&&(oe[d++]=de[Y++],1<ae&&(oe[d++]=de[Y++]))}else{for(Y=d-fe;oe[d++]=oe[Y++],oe[d++]=oe[Y++],oe[d++]=oe[Y++],2<(ae-=3););ae&&(oe[d++]=oe[Y++],1<ae&&(oe[d++]=oe[Y++]))}break}}break}}while(u<h&&d<y);u-=ae=G>>3,k&=(1<<(G-=ae<<3))-1,o.next_in=u,o.next_out=d,o.avail_in=u<h?h-u+5:5-(u-h),o.avail_out=d<y?y-d+257:257-(d-y),l.hold=k,l.bits=G}},{}],49:[function(t,i,r){var o=t("../utils/common"),s=t("./adler32"),l=t("./crc32"),u=t("./inffast"),h=t("./inftrees"),d=1,m=2,y=0,x=-2,C=1,w=852,E=592;function T(Y){return(Y>>>24&255)+(Y>>>8&65280)+((65280&Y)<<8)+((255&Y)<<24)}function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function G(Y){var de;return Y&&Y.state?(de=Y.state,Y.total_in=Y.total_out=de.total=0,Y.msg="",de.wrap&&(Y.adler=1&de.wrap),de.mode=C,de.last=0,de.havedict=0,de.dmax=32768,de.head=null,de.hold=0,de.bits=0,de.lencode=de.lendyn=new o.Buf32(w),de.distcode=de.distdyn=new o.Buf32(E),de.sane=1,de.back=-1,y):x}function O(Y){var de;return Y&&Y.state?((de=Y.state).wsize=0,de.whave=0,de.wnext=0,G(Y)):x}function V(Y,de){var D,oe;return Y&&Y.state?(oe=Y.state,de<0?(D=0,de=-de):(D=1+(de>>4),de<48&&(de&=15)),de&&(de<8||15<de)?x:(oe.window!==null&&oe.wbits!==de&&(oe.window=null),oe.wrap=D,oe.wbits=de,O(Y))):x}function z(Y,de){var D,oe;return Y?(oe=new k,(Y.state=oe).window=null,(D=V(Y,de))!==y&&(Y.state=null),D):x}var H,te,$=!0;function ae(Y){if($){var de;for(H=new o.Buf32(512),te=new o.Buf32(32),de=0;de<144;)Y.lens[de++]=8;for(;de<256;)Y.lens[de++]=9;for(;de<280;)Y.lens[de++]=7;for(;de<288;)Y.lens[de++]=8;for(h(d,Y.lens,0,288,H,0,Y.work,{bits:9}),de=0;de<32;)Y.lens[de++]=5;h(m,Y.lens,0,32,te,0,Y.work,{bits:5}),$=!1}Y.lencode=H,Y.lenbits=9,Y.distcode=te,Y.distbits=5}function fe(Y,de,D,oe){var ue,ge=Y.state;return ge.window===null&&(ge.wsize=1<<ge.wbits,ge.wnext=0,ge.whave=0,ge.window=new o.Buf8(ge.wsize)),oe>=ge.wsize?(o.arraySet(ge.window,de,D-ge.wsize,ge.wsize,0),ge.wnext=0,ge.whave=ge.wsize):(oe<(ue=ge.wsize-ge.wnext)&&(ue=oe),o.arraySet(ge.window,de,D-oe,ue,ge.wnext),(oe-=ue)?(o.arraySet(ge.window,de,D-oe,oe,0),ge.wnext=oe,ge.whave=ge.wsize):(ge.wnext+=ue,ge.wnext===ge.wsize&&(ge.wnext=0),ge.whave<ge.wsize&&(ge.whave+=ue))),0}r.inflateReset=O,r.inflateReset2=V,r.inflateResetKeep=G,r.inflateInit=function(Y){return z(Y,15)},r.inflateInit2=z,r.inflate=function(Y,de){var D,oe,ue,ge,Ne,Ee,se,q,j,ze,je,qe,yt,xt,Et,kt,hn,wn,Ge,ve,W,Ze,Re,ce,me=0,_e=new o.Buf8(4),Ie=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Y||!Y.state||!Y.output||!Y.input&&Y.avail_in!==0)return x;(D=Y.state).mode===12&&(D.mode=13),Ne=Y.next_out,ue=Y.output,se=Y.avail_out,ge=Y.next_in,oe=Y.input,Ee=Y.avail_in,q=D.hold,j=D.bits,ze=Ee,je=se,Ze=y;e:for(;;)switch(D.mode){case C:if(D.wrap===0){D.mode=13;break}for(;j<16;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}if(2&D.wrap&&q===35615){_e[D.check=0]=255&q,_e[1]=q>>>8&255,D.check=l(D.check,_e,2,0),j=q=0,D.mode=2;break}if(D.flags=0,D.head&&(D.head.done=!1),!(1&D.wrap)||(((255&q)<<8)+(q>>8))%31){Y.msg="incorrect header check",D.mode=30;break}if((15&q)!=8){Y.msg="unknown compression method",D.mode=30;break}if(j-=4,W=8+(15&(q>>>=4)),D.wbits===0)D.wbits=W;else if(W>D.wbits){Y.msg="invalid window size",D.mode=30;break}D.dmax=1<<W,Y.adler=D.check=1,D.mode=512&q?10:12,j=q=0;break;case 2:for(;j<16;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}if(D.flags=q,(255&D.flags)!=8){Y.msg="unknown compression method",D.mode=30;break}if(57344&D.flags){Y.msg="unknown header flags set",D.mode=30;break}D.head&&(D.head.text=q>>8&1),512&D.flags&&(_e[0]=255&q,_e[1]=q>>>8&255,D.check=l(D.check,_e,2,0)),j=q=0,D.mode=3;case 3:for(;j<32;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}D.head&&(D.head.time=q),512&D.flags&&(_e[0]=255&q,_e[1]=q>>>8&255,_e[2]=q>>>16&255,_e[3]=q>>>24&255,D.check=l(D.check,_e,4,0)),j=q=0,D.mode=4;case 4:for(;j<16;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}D.head&&(D.head.xflags=255&q,D.head.os=q>>8),512&D.flags&&(_e[0]=255&q,_e[1]=q>>>8&255,D.check=l(D.check,_e,2,0)),j=q=0,D.mode=5;case 5:if(1024&D.flags){for(;j<16;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}D.length=q,D.head&&(D.head.extra_len=q),512&D.flags&&(_e[0]=255&q,_e[1]=q>>>8&255,D.check=l(D.check,_e,2,0)),j=q=0}else D.head&&(D.head.extra=null);D.mode=6;case 6:if(1024&D.flags&&(Ee<(qe=D.length)&&(qe=Ee),qe&&(D.head&&(W=D.head.extra_len-D.length,D.head.extra||(D.head.extra=new Array(D.head.extra_len)),o.arraySet(D.head.extra,oe,ge,qe,W)),512&D.flags&&(D.check=l(D.check,oe,qe,ge)),Ee-=qe,ge+=qe,D.length-=qe),D.length))break e;D.length=0,D.mode=7;case 7:if(2048&D.flags){if(Ee===0)break e;for(qe=0;W=oe[ge+qe++],D.head&&W&&D.length<65536&&(D.head.name+=String.fromCharCode(W)),W&&qe<Ee;);if(512&D.flags&&(D.check=l(D.check,oe,qe,ge)),Ee-=qe,ge+=qe,W)break e}else D.head&&(D.head.name=null);D.length=0,D.mode=8;case 8:if(4096&D.flags){if(Ee===0)break e;for(qe=0;W=oe[ge+qe++],D.head&&W&&D.length<65536&&(D.head.comment+=String.fromCharCode(W)),W&&qe<Ee;);if(512&D.flags&&(D.check=l(D.check,oe,qe,ge)),Ee-=qe,ge+=qe,W)break e}else D.head&&(D.head.comment=null);D.mode=9;case 9:if(512&D.flags){for(;j<16;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}if(q!==(65535&D.check)){Y.msg="header crc mismatch",D.mode=30;break}j=q=0}D.head&&(D.head.hcrc=D.flags>>9&1,D.head.done=!0),Y.adler=D.check=0,D.mode=12;break;case 10:for(;j<32;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}Y.adler=D.check=T(q),j=q=0,D.mode=11;case 11:if(D.havedict===0)return Y.next_out=Ne,Y.avail_out=se,Y.next_in=ge,Y.avail_in=Ee,D.hold=q,D.bits=j,2;Y.adler=D.check=1,D.mode=12;case 12:if(de===5||de===6)break e;case 13:if(D.last){q>>>=7&j,j-=7&j,D.mode=27;break}for(;j<3;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}switch(D.last=1&q,j-=1,3&(q>>>=1)){case 0:D.mode=14;break;case 1:if(ae(D),D.mode=20,de!==6)break;q>>>=2,j-=2;break e;case 2:D.mode=17;break;case 3:Y.msg="invalid block type",D.mode=30}q>>>=2,j-=2;break;case 14:for(q>>>=7&j,j-=7&j;j<32;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}if((65535&q)!=(q>>>16^65535)){Y.msg="invalid stored block lengths",D.mode=30;break}if(D.length=65535&q,j=q=0,D.mode=15,de===6)break e;case 15:D.mode=16;case 16:if(qe=D.length){if(Ee<qe&&(qe=Ee),se<qe&&(qe=se),qe===0)break e;o.arraySet(ue,oe,ge,qe,Ne),Ee-=qe,ge+=qe,se-=qe,Ne+=qe,D.length-=qe;break}D.mode=12;break;case 17:for(;j<14;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}if(D.nlen=257+(31&q),q>>>=5,j-=5,D.ndist=1+(31&q),q>>>=5,j-=5,D.ncode=4+(15&q),q>>>=4,j-=4,286<D.nlen||30<D.ndist){Y.msg="too many length or distance symbols",D.mode=30;break}D.have=0,D.mode=18;case 18:for(;D.have<D.ncode;){for(;j<3;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}D.lens[Ie[D.have++]]=7&q,q>>>=3,j-=3}for(;D.have<19;)D.lens[Ie[D.have++]]=0;if(D.lencode=D.lendyn,D.lenbits=7,Re={bits:D.lenbits},Ze=h(0,D.lens,0,19,D.lencode,0,D.work,Re),D.lenbits=Re.bits,Ze){Y.msg="invalid code lengths set",D.mode=30;break}D.have=0,D.mode=19;case 19:for(;D.have<D.nlen+D.ndist;){for(;kt=(me=D.lencode[q&(1<<D.lenbits)-1])>>>16&255,hn=65535&me,!((Et=me>>>24)<=j);){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}if(hn<16)q>>>=Et,j-=Et,D.lens[D.have++]=hn;else{if(hn===16){for(ce=Et+2;j<ce;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}if(q>>>=Et,j-=Et,D.have===0){Y.msg="invalid bit length repeat",D.mode=30;break}W=D.lens[D.have-1],qe=3+(3&q),q>>>=2,j-=2}else if(hn===17){for(ce=Et+3;j<ce;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}j-=Et,W=0,qe=3+(7&(q>>>=Et)),q>>>=3,j-=3}else{for(ce=Et+7;j<ce;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}j-=Et,W=0,qe=11+(127&(q>>>=Et)),q>>>=7,j-=7}if(D.have+qe>D.nlen+D.ndist){Y.msg="invalid bit length repeat",D.mode=30;break}for(;qe--;)D.lens[D.have++]=W}}if(D.mode===30)break;if(D.lens[256]===0){Y.msg="invalid code -- missing end-of-block",D.mode=30;break}if(D.lenbits=9,Re={bits:D.lenbits},Ze=h(d,D.lens,0,D.nlen,D.lencode,0,D.work,Re),D.lenbits=Re.bits,Ze){Y.msg="invalid literal/lengths set",D.mode=30;break}if(D.distbits=6,D.distcode=D.distdyn,Re={bits:D.distbits},Ze=h(m,D.lens,D.nlen,D.ndist,D.distcode,0,D.work,Re),D.distbits=Re.bits,Ze){Y.msg="invalid distances set",D.mode=30;break}if(D.mode=20,de===6)break e;case 20:D.mode=21;case 21:if(6<=Ee&&258<=se){Y.next_out=Ne,Y.avail_out=se,Y.next_in=ge,Y.avail_in=Ee,D.hold=q,D.bits=j,u(Y,je),Ne=Y.next_out,ue=Y.output,se=Y.avail_out,ge=Y.next_in,oe=Y.input,Ee=Y.avail_in,q=D.hold,j=D.bits,D.mode===12&&(D.back=-1);break}for(D.back=0;kt=(me=D.lencode[q&(1<<D.lenbits)-1])>>>16&255,hn=65535&me,!((Et=me>>>24)<=j);){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}if(kt&&(240&kt)==0){for(wn=Et,Ge=kt,ve=hn;kt=(me=D.lencode[ve+((q&(1<<wn+Ge)-1)>>wn)])>>>16&255,hn=65535&me,!(wn+(Et=me>>>24)<=j);){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}q>>>=wn,j-=wn,D.back+=wn}if(q>>>=Et,j-=Et,D.back+=Et,D.length=hn,kt===0){D.mode=26;break}if(32&kt){D.back=-1,D.mode=12;break}if(64&kt){Y.msg="invalid literal/length code",D.mode=30;break}D.extra=15&kt,D.mode=22;case 22:if(D.extra){for(ce=D.extra;j<ce;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}D.length+=q&(1<<D.extra)-1,q>>>=D.extra,j-=D.extra,D.back+=D.extra}D.was=D.length,D.mode=23;case 23:for(;kt=(me=D.distcode[q&(1<<D.distbits)-1])>>>16&255,hn=65535&me,!((Et=me>>>24)<=j);){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}if((240&kt)==0){for(wn=Et,Ge=kt,ve=hn;kt=(me=D.distcode[ve+((q&(1<<wn+Ge)-1)>>wn)])>>>16&255,hn=65535&me,!(wn+(Et=me>>>24)<=j);){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}q>>>=wn,j-=wn,D.back+=wn}if(q>>>=Et,j-=Et,D.back+=Et,64&kt){Y.msg="invalid distance code",D.mode=30;break}D.offset=hn,D.extra=15&kt,D.mode=24;case 24:if(D.extra){for(ce=D.extra;j<ce;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}D.offset+=q&(1<<D.extra)-1,q>>>=D.extra,j-=D.extra,D.back+=D.extra}if(D.offset>D.dmax){Y.msg="invalid distance too far back",D.mode=30;break}D.mode=25;case 25:if(se===0)break e;if(qe=je-se,D.offset>qe){if((qe=D.offset-qe)>D.whave&&D.sane){Y.msg="invalid distance too far back",D.mode=30;break}yt=qe>D.wnext?(qe-=D.wnext,D.wsize-qe):D.wnext-qe,qe>D.length&&(qe=D.length),xt=D.window}else xt=ue,yt=Ne-D.offset,qe=D.length;for(se<qe&&(qe=se),se-=qe,D.length-=qe;ue[Ne++]=xt[yt++],--qe;);D.length===0&&(D.mode=21);break;case 26:if(se===0)break e;ue[Ne++]=D.length,se--,D.mode=21;break;case 27:if(D.wrap){for(;j<32;){if(Ee===0)break e;Ee--,q|=oe[ge++]<<j,j+=8}if(je-=se,Y.total_out+=je,D.total+=je,je&&(Y.adler=D.check=D.flags?l(D.check,ue,je,Ne-je):s(D.check,ue,je,Ne-je)),je=se,(D.flags?q:T(q))!==D.check){Y.msg="incorrect data check",D.mode=30;break}j=q=0}D.mode=28;case 28:if(D.wrap&&D.flags){for(;j<32;){if(Ee===0)break e;Ee--,q+=oe[ge++]<<j,j+=8}if(q!==(4294967295&D.total)){Y.msg="incorrect length check",D.mode=30;break}j=q=0}D.mode=29;case 29:Ze=1;break e;case 30:Ze=-3;break e;case 31:return-4;case 32:default:return x}return Y.next_out=Ne,Y.avail_out=se,Y.next_in=ge,Y.avail_in=Ee,D.hold=q,D.bits=j,(D.wsize||je!==Y.avail_out&&D.mode<30&&(D.mode<27||de!==4))&&fe(Y,Y.output,Y.next_out,je-Y.avail_out)?(D.mode=31,-4):(ze-=Y.avail_in,je-=Y.avail_out,Y.total_in+=ze,Y.total_out+=je,D.total+=je,D.wrap&&je&&(Y.adler=D.check=D.flags?l(D.check,ue,je,Y.next_out-je):s(D.check,ue,je,Y.next_out-je)),Y.data_type=D.bits+(D.last?64:0)+(D.mode===12?128:0)+(D.mode===20||D.mode===15?256:0),(ze==0&&je===0||de===4)&&Ze===y&&(Ze=-5),Ze)},r.inflateEnd=function(Y){if(!Y||!Y.state)return x;var de=Y.state;return de.window&&(de.window=null),Y.state=null,y},r.inflateGetHeader=function(Y,de){var D;return Y&&Y.state?(2&(D=Y.state).wrap)==0?x:((D.head=de).done=!1,y):x},r.inflateSetDictionary=function(Y,de){var D,oe=de.length;return Y&&Y.state?(D=Y.state).wrap!==0&&D.mode!==11?x:D.mode===11&&s(1,de,oe,0)!==D.check?-3:fe(Y,de,oe,oe)?(D.mode=31,-4):(D.havedict=1,y):x},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,r){var o=t("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(d,m,y,x,C,w,E,T){var k,G,O,V,z,H,te,$,ae,fe=T.bits,Y=0,de=0,D=0,oe=0,ue=0,ge=0,Ne=0,Ee=0,se=0,q=0,j=null,ze=0,je=new o.Buf16(16),qe=new o.Buf16(16),yt=null,xt=0;for(Y=0;Y<=15;Y++)je[Y]=0;for(de=0;de<x;de++)je[m[y+de]]++;for(ue=fe,oe=15;1<=oe&&je[oe]===0;oe--);if(oe<ue&&(ue=oe),oe===0)return C[w++]=20971520,C[w++]=20971520,T.bits=1,0;for(D=1;D<oe&&je[D]===0;D++);for(ue<D&&(ue=D),Y=Ee=1;Y<=15;Y++)if(Ee<<=1,(Ee-=je[Y])<0)return-1;if(0<Ee&&(d===0||oe!==1))return-1;for(qe[1]=0,Y=1;Y<15;Y++)qe[Y+1]=qe[Y]+je[Y];for(de=0;de<x;de++)m[y+de]!==0&&(E[qe[m[y+de]]++]=de);if(H=d===0?(j=yt=E,19):d===1?(j=s,ze-=257,yt=l,xt-=257,256):(j=u,yt=h,-1),Y=D,z=w,Ne=de=q=0,O=-1,V=(se=1<<(ge=ue))-1,d===1&&852<se||d===2&&592<se)return 1;for(;;){for(te=Y-Ne,ae=E[de]<H?($=0,E[de]):E[de]>H?($=yt[xt+E[de]],j[ze+E[de]]):($=96,0),k=1<<Y-Ne,D=G=1<<ge;C[z+(q>>Ne)+(G-=k)]=te<<24|$<<16|ae|0,G!==0;);for(k=1<<Y-1;q&k;)k>>=1;if(k!==0?(q&=k-1,q+=k):q=0,de++,--je[Y]==0){if(Y===oe)break;Y=m[y+E[de]]}if(ue<Y&&(q&V)!==O){for(Ne===0&&(Ne=ue),z+=D,Ee=1<<(ge=Y-Ne);ge+Ne<oe&&!((Ee-=je[ge+Ne])<=0);)ge++,Ee<<=1;if(se+=1<<ge,d===1&&852<se||d===2&&592<se)return 1;C[O=q&V]=ue<<24|ge<<16|z-w|0}}return q!==0&&(C[z+q]=Y-Ne<<24|64<<16|0),T.bits=ue,0}},{"../utils/common":41}],51:[function(t,i,r){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,r){var o=t("../utils/common"),s=0,l=1;function u(me){for(var _e=me.length;0<=--_e;)me[_e]=0}var h=0,d=29,m=256,y=m+1+d,x=30,C=19,w=2*y+1,E=15,T=16,k=7,G=256,O=16,V=17,z=18,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],te=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],$=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fe=new Array(2*(y+2));u(fe);var Y=new Array(2*x);u(Y);var de=new Array(512);u(de);var D=new Array(256);u(D);var oe=new Array(d);u(oe);var ue,ge,Ne,Ee=new Array(x);function se(me,_e,Ie,pe,Te){this.static_tree=me,this.extra_bits=_e,this.extra_base=Ie,this.elems=pe,this.max_length=Te,this.has_stree=me&&me.length}function q(me,_e){this.dyn_tree=me,this.max_code=0,this.stat_desc=_e}function j(me){return me<256?de[me]:de[256+(me>>>7)]}function ze(me,_e){me.pending_buf[me.pending++]=255&_e,me.pending_buf[me.pending++]=_e>>>8&255}function je(me,_e,Ie){me.bi_valid>T-Ie?(me.bi_buf|=_e<<me.bi_valid&65535,ze(me,me.bi_buf),me.bi_buf=_e>>T-me.bi_valid,me.bi_valid+=Ie-T):(me.bi_buf|=_e<<me.bi_valid&65535,me.bi_valid+=Ie)}function qe(me,_e,Ie){je(me,Ie[2*_e],Ie[2*_e+1])}function yt(me,_e){for(var Ie=0;Ie|=1&me,me>>>=1,Ie<<=1,0<--_e;);return Ie>>>1}function xt(me,_e,Ie){var pe,Te,We=new Array(E+1),tt=0;for(pe=1;pe<=E;pe++)We[pe]=tt=tt+Ie[pe-1]<<1;for(Te=0;Te<=_e;Te++){var nt=me[2*Te+1];nt!==0&&(me[2*Te]=yt(We[nt]++,nt))}}function Et(me){var _e;for(_e=0;_e<y;_e++)me.dyn_ltree[2*_e]=0;for(_e=0;_e<x;_e++)me.dyn_dtree[2*_e]=0;for(_e=0;_e<C;_e++)me.bl_tree[2*_e]=0;me.dyn_ltree[2*G]=1,me.opt_len=me.static_len=0,me.last_lit=me.matches=0}function kt(me){8<me.bi_valid?ze(me,me.bi_buf):0<me.bi_valid&&(me.pending_buf[me.pending++]=me.bi_buf),me.bi_buf=0,me.bi_valid=0}function hn(me,_e,Ie,pe){var Te=2*_e,We=2*Ie;return me[Te]<me[We]||me[Te]===me[We]&&pe[_e]<=pe[Ie]}function wn(me,_e,Ie){for(var pe=me.heap[Ie],Te=Ie<<1;Te<=me.heap_len&&(Te<me.heap_len&&hn(_e,me.heap[Te+1],me.heap[Te],me.depth)&&Te++,!hn(_e,pe,me.heap[Te],me.depth));)me.heap[Ie]=me.heap[Te],Ie=Te,Te<<=1;me.heap[Ie]=pe}function Ge(me,_e,Ie){var pe,Te,We,tt,nt=0;if(me.last_lit!==0)for(;pe=me.pending_buf[me.d_buf+2*nt]<<8|me.pending_buf[me.d_buf+2*nt+1],Te=me.pending_buf[me.l_buf+nt],nt++,pe===0?qe(me,Te,_e):(qe(me,(We=D[Te])+m+1,_e),(tt=H[We])!==0&&je(me,Te-=oe[We],tt),qe(me,We=j(--pe),Ie),(tt=te[We])!==0&&je(me,pe-=Ee[We],tt)),nt<me.last_lit;);qe(me,G,_e)}function ve(me,_e){var Ie,pe,Te,We=_e.dyn_tree,tt=_e.stat_desc.static_tree,nt=_e.stat_desc.has_stree,bt=_e.stat_desc.elems,on=-1;for(me.heap_len=0,me.heap_max=w,Ie=0;Ie<bt;Ie++)We[2*Ie]!==0?(me.heap[++me.heap_len]=on=Ie,me.depth[Ie]=0):We[2*Ie+1]=0;for(;me.heap_len<2;)We[2*(Te=me.heap[++me.heap_len]=on<2?++on:0)]=1,me.depth[Te]=0,me.opt_len--,nt&&(me.static_len-=tt[2*Te+1]);for(_e.max_code=on,Ie=me.heap_len>>1;1<=Ie;Ie--)wn(me,We,Ie);for(Te=bt;Ie=me.heap[1],me.heap[1]=me.heap[me.heap_len--],wn(me,We,1),pe=me.heap[1],me.heap[--me.heap_max]=Ie,me.heap[--me.heap_max]=pe,We[2*Te]=We[2*Ie]+We[2*pe],me.depth[Te]=(me.depth[Ie]>=me.depth[pe]?me.depth[Ie]:me.depth[pe])+1,We[2*Ie+1]=We[2*pe+1]=Te,me.heap[1]=Te++,wn(me,We,1),2<=me.heap_len;);me.heap[--me.heap_max]=me.heap[1],(function(an,Ii){var ji,Pi,Mr,_i,ss,Ei,Mi=Ii.dyn_tree,zs=Ii.max_code,Ao=Ii.stat_desc.static_tree,Ea=Ii.stat_desc.has_stree,_s=Ii.stat_desc.extra_bits,Ur=Ii.stat_desc.extra_base,Xr=Ii.stat_desc.max_length,vs=0;for(_i=0;_i<=E;_i++)an.bl_count[_i]=0;for(Mi[2*an.heap[an.heap_max]+1]=0,ji=an.heap_max+1;ji<w;ji++)Xr<(_i=Mi[2*Mi[2*(Pi=an.heap[ji])+1]+1]+1)&&(_i=Xr,vs++),Mi[2*Pi+1]=_i,zs<Pi||(an.bl_count[_i]++,ss=0,Ur<=Pi&&(ss=_s[Pi-Ur]),Ei=Mi[2*Pi],an.opt_len+=Ei*(_i+ss),Ea&&(an.static_len+=Ei*(Ao[2*Pi+1]+ss)));if(vs!==0){do{for(_i=Xr-1;an.bl_count[_i]===0;)_i--;an.bl_count[_i]--,an.bl_count[_i+1]+=2,an.bl_count[Xr]--,vs-=2}while(0<vs);for(_i=Xr;_i!==0;_i--)for(Pi=an.bl_count[_i];Pi!==0;)zs<(Mr=an.heap[--ji])||(Mi[2*Mr+1]!==_i&&(an.opt_len+=(_i-Mi[2*Mr+1])*Mi[2*Mr],Mi[2*Mr+1]=_i),Pi--)}})(me,_e),xt(We,on,me.bl_count)}function W(me,_e,Ie){var pe,Te,We=-1,tt=_e[1],nt=0,bt=7,on=4;for(tt===0&&(bt=138,on=3),_e[2*(Ie+1)+1]=65535,pe=0;pe<=Ie;pe++)Te=tt,tt=_e[2*(pe+1)+1],++nt<bt&&Te===tt||(nt<on?me.bl_tree[2*Te]+=nt:Te!==0?(Te!==We&&me.bl_tree[2*Te]++,me.bl_tree[2*O]++):nt<=10?me.bl_tree[2*V]++:me.bl_tree[2*z]++,We=Te,on=(nt=0)===tt?(bt=138,3):Te===tt?(bt=6,3):(bt=7,4))}function Ze(me,_e,Ie){var pe,Te,We=-1,tt=_e[1],nt=0,bt=7,on=4;for(tt===0&&(bt=138,on=3),pe=0;pe<=Ie;pe++)if(Te=tt,tt=_e[2*(pe+1)+1],!(++nt<bt&&Te===tt)){if(nt<on)for(;qe(me,Te,me.bl_tree),--nt!=0;);else Te!==0?(Te!==We&&(qe(me,Te,me.bl_tree),nt--),qe(me,O,me.bl_tree),je(me,nt-3,2)):nt<=10?(qe(me,V,me.bl_tree),je(me,nt-3,3)):(qe(me,z,me.bl_tree),je(me,nt-11,7));We=Te,on=(nt=0)===tt?(bt=138,3):Te===tt?(bt=6,3):(bt=7,4)}}u(Ee);var Re=!1;function ce(me,_e,Ie,pe){je(me,(h<<1)+(pe?1:0),3),(function(Te,We,tt,nt){kt(Te),ze(Te,tt),ze(Te,~tt),o.arraySet(Te.pending_buf,Te.window,We,tt,Te.pending),Te.pending+=tt})(me,_e,Ie)}r._tr_init=function(me){Re||((function(){var _e,Ie,pe,Te,We,tt=new Array(E+1);for(Te=pe=0;Te<d-1;Te++)for(oe[Te]=pe,_e=0;_e<1<<H[Te];_e++)D[pe++]=Te;for(D[pe-1]=Te,Te=We=0;Te<16;Te++)for(Ee[Te]=We,_e=0;_e<1<<te[Te];_e++)de[We++]=Te;for(We>>=7;Te<x;Te++)for(Ee[Te]=We<<7,_e=0;_e<1<<te[Te]-7;_e++)de[256+We++]=Te;for(Ie=0;Ie<=E;Ie++)tt[Ie]=0;for(_e=0;_e<=143;)fe[2*_e+1]=8,_e++,tt[8]++;for(;_e<=255;)fe[2*_e+1]=9,_e++,tt[9]++;for(;_e<=279;)fe[2*_e+1]=7,_e++,tt[7]++;for(;_e<=287;)fe[2*_e+1]=8,_e++,tt[8]++;for(xt(fe,y+1,tt),_e=0;_e<x;_e++)Y[2*_e+1]=5,Y[2*_e]=yt(_e,5);ue=new se(fe,H,m+1,y,E),ge=new se(Y,te,0,x,E),Ne=new se(new Array(0),$,0,C,k)})(),Re=!0),me.l_desc=new q(me.dyn_ltree,ue),me.d_desc=new q(me.dyn_dtree,ge),me.bl_desc=new q(me.bl_tree,Ne),me.bi_buf=0,me.bi_valid=0,Et(me)},r._tr_stored_block=ce,r._tr_flush_block=function(me,_e,Ie,pe){var Te,We,tt=0;0<me.level?(me.strm.data_type===2&&(me.strm.data_type=(function(nt){var bt,on=4093624447;for(bt=0;bt<=31;bt++,on>>>=1)if(1&on&&nt.dyn_ltree[2*bt]!==0)return s;if(nt.dyn_ltree[18]!==0||nt.dyn_ltree[20]!==0||nt.dyn_ltree[26]!==0)return l;for(bt=32;bt<m;bt++)if(nt.dyn_ltree[2*bt]!==0)return l;return s})(me)),ve(me,me.l_desc),ve(me,me.d_desc),tt=(function(nt){var bt;for(W(nt,nt.dyn_ltree,nt.l_desc.max_code),W(nt,nt.dyn_dtree,nt.d_desc.max_code),ve(nt,nt.bl_desc),bt=C-1;3<=bt&&nt.bl_tree[2*ae[bt]+1]===0;bt--);return nt.opt_len+=3*(bt+1)+5+5+4,bt})(me),Te=me.opt_len+3+7>>>3,(We=me.static_len+3+7>>>3)<=Te&&(Te=We)):Te=We=Ie+5,Ie+4<=Te&&_e!==-1?ce(me,_e,Ie,pe):me.strategy===4||We===Te?(je(me,2+(pe?1:0),3),Ge(me,fe,Y)):(je(me,4+(pe?1:0),3),(function(nt,bt,on,an){var Ii;for(je(nt,bt-257,5),je(nt,on-1,5),je(nt,an-4,4),Ii=0;Ii<an;Ii++)je(nt,nt.bl_tree[2*ae[Ii]+1],3);Ze(nt,nt.dyn_ltree,bt-1),Ze(nt,nt.dyn_dtree,on-1)})(me,me.l_desc.max_code+1,me.d_desc.max_code+1,tt+1),Ge(me,me.dyn_ltree,me.dyn_dtree)),Et(me),pe&&kt(me)},r._tr_tally=function(me,_e,Ie){return me.pending_buf[me.d_buf+2*me.last_lit]=_e>>>8&255,me.pending_buf[me.d_buf+2*me.last_lit+1]=255&_e,me.pending_buf[me.l_buf+me.last_lit]=255&Ie,me.last_lit++,_e===0?me.dyn_ltree[2*Ie]++:(me.matches++,_e--,me.dyn_ltree[2*(D[Ie]+m+1)]++,me.dyn_dtree[2*j(_e)]++),me.last_lit===me.lit_bufsize-1},r._tr_align=function(me){je(me,2,3),qe(me,G,fe),(function(_e){_e.bi_valid===16?(ze(_e,_e.bi_buf),_e.bi_buf=0,_e.bi_valid=0):8<=_e.bi_valid&&(_e.pending_buf[_e.pending++]=255&_e.bi_buf,_e.bi_buf>>=8,_e.bi_valid-=8)})(me)}},{"../utils/common":41}],53:[function(t,i,r){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,r){(function(o){(function(s,l){if(!s.setImmediate){var u,h,d,m,y=1,x={},C=!1,w=s.document,E=Object.getPrototypeOf&&Object.getPrototypeOf(s);E=E&&E.setTimeout?E:s,u={}.toString.call(s.process)==="[object process]"?function(O){process.nextTick(function(){k(O)})}:(function(){if(s.postMessage&&!s.importScripts){var O=!0,V=s.onmessage;return s.onmessage=function(){O=!1},s.postMessage("","*"),s.onmessage=V,O}})()?(m="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",G,!1):s.attachEvent("onmessage",G),function(O){s.postMessage(m+O,"*")}):s.MessageChannel?((d=new MessageChannel).port1.onmessage=function(O){k(O.data)},function(O){d.port2.postMessage(O)}):w&&"onreadystatechange"in w.createElement("script")?(h=w.documentElement,function(O){var V=w.createElement("script");V.onreadystatechange=function(){k(O),V.onreadystatechange=null,h.removeChild(V),V=null},h.appendChild(V)}):function(O){setTimeout(k,0,O)},E.setImmediate=function(O){typeof O!="function"&&(O=new Function(""+O));for(var V=new Array(arguments.length-1),z=0;z<V.length;z++)V[z]=arguments[z+1];var H={callback:O,args:V};return x[y]=H,u(y),y++},E.clearImmediate=T}function T(O){delete x[O]}function k(O){if(C)setTimeout(k,0,O);else{var V=x[O];if(V){C=!0;try{(function(z){var H=z.callback,te=z.args;switch(te.length){case 0:H();break;case 1:H(te[0]);break;case 2:H(te[0],te[1]);break;case 3:H(te[0],te[1],te[2]);break;default:H.apply(l,te)}})(V)}finally{T(O),C=!1}}}}function G(O){O.source===s&&typeof O.data=="string"&&O.data.indexOf(m)===0&&k(+O.data.slice(m.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Jd<"u"?Jd:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(_E)),_E.exports}var ySe=mSe();const _Se=y4(ySe);function vSe(n,e){const i=new AW({extractStyles:!0,showPointNames:!0}).readFeatures(n,{dataProjection:Sl,featureProjection:e.getView().getProjection()});return Rz(i)}function bSe(n,e){const i=new bW().readFeatures(n,{dataProjection:Sl,featureProjection:e.getView().getProjection()});return Rz(i)}function iI(n,e){const t=n.clone();return t.setGeometry(e),t}function Rz(n){const e=[];return n.forEach(t=>{const i=t.getGeometry();switch(i?.getType()){case"MultiPolygon":{const r=i.getPolygons();e.push(...r.map(o=>iI(t,o)));break}case"MultiLineString":{const r=i.getLineStrings();e.push(...r.map(o=>iI(t,o)));break}case"MultiPoint":{const r=i.getPoints();e.push(...r.map(o=>iI(t,o)));break}case"GeometryCollection":{const r=i;e.push(...r.getGeometries().map(o=>iI(t,o)));break}default:e.push(t);break}}),e}function xSe(n){return n.split(".").pop()?.toLowerCase()}function ISe(n){return n!==void 0&&["gpx","kml","kmz"].includes(n)}function CSe(n,e){return new Promise((t,i)=>{const r=n.name,o=xSe(r);if(!ISe(o)){i(new Error(`Invalid file extension: ${o}`));return}const s=new FileReader;s.onload=async l=>{const u=l.target?.result;if(!u){i(new Error("Failed to read file content"));return}try{let h;o==="kmz"?h=await ASe(u,e):o==="kml"?h=Mz(u,e):h=wSe(u,e),t({content:u,fileName:r,extension:o,features:h})}catch(h){i(h)}},s.onerror=()=>{i(s.error||new Error("Failed to read file"))},o==="kmz"?s.readAsArrayBuffer(n):s.readAsText(n)})}function Mz(n,e){return vSe(n,e)}function wSe(n,e){return bSe(n,e)}async function ASe(n,e){const i=await new _Se().loadAsync(n),r=Object.keys(i.files).find(s=>s.toLowerCase().endsWith(".kml"));if(!r)throw new Error("No KML file found in KMZ archive");const o=await i.files[r].async("string");return Mz(o,e)}const SSe={class:"flex items-center"},ESe=["title","aria-label"],TSe=["aria-label"],RSe=["aria-label"],MSe={key:1,class:"italic"},kSe={key:0,class:"lux-alert-warning p-4 mb-2"},LSe={class:"font-bold"},PSe=["innerHTML"],GSe={class:"flex gap-2 mt-2 justify-end"},FSe={class:"flex items-center text-white mr-0.5"},OSe={class:"text-sm italic grow"},NSe=["aria-label"],DSe=["aria-label"],VSe=["aria-label"],BSe=at({__name:"my-map-info",props:{myMap:{}},emits:["close","new","open","copy","edit","share","delete","clear","resetLayers","saveLayers","draw:mergelines","draw:cutlines"],setup(n,{emit:e}){const{t}=St(),i=e,r=n,o=Kn().getOlMap(),{generateDrawnFeature:s}=yA(),{myMapLayersChanged:l}=It(Jn()),u=zr(),{drawnFeaturesMyMaps:h,clipLineActive:d}=It(u),m=Ue(null),y=Ue(null),x=Ct(()=>[{label:"Crer une nouvelle carte",action:()=>i("new")},{label:"Ouvrir une carte existante",action:()=>i("open")},{label:"Crer une copie",action:()=>i("copy",r.myMap)},{label:"Partager la carte",action:()=>i("share",r.myMap),separator:!0},{label:"Supprimer la carte",action:()=>i("delete",r.myMap)},{label:"Supprimer tous les lements de la carte",action:()=>i("clear",r.myMap)},{label:"Fusionner des lignes",action:()=>i("draw:mergelines",r.myMap)},{label:d.value?"Dsactiver mode couper une ligne":"Couper une ligne",action:()=>i("draw:cutlines",r.myMap),separator:!0},{label:"Fermer",action:()=>i("close"),separator:!0},{label:"Exporter un GPX",action:()=>C("gpx")},{label:"Exporter un KML",action:()=>C("kml")},{label:"Exporter un Shapefile",action:()=>C("shapefile")},{label:"Importer un fichier GPX/KML/KMZ",action:()=>w()}]);Pt(y,async E=>{if(E)try{const T=await CSe(E,o),{features:k}=T;k.forEach(G=>{const O=s(G);u.addDrawnFeatureToCollection(O),O.fit()})}catch(T){console.error("Error importing file:",T)}finally{y.value=null}});function C(E){Ob.export(o,E,h.value,r.myMap.title,!0)}function w(){m.value?.click()}return(E,T)=>(U(),ie(Mt,null,[P("div",SSe,[P("h2",{"data-cy":"mymap-title",class:"text-white font-bold grow max-w-full text-ellipsis overflow-hidden text-nowrap hover:cursor-pointer",role:"button",title:n.myMap.title,"aria-label":M(t)("diter le titre de la carte")+" : "+n.myMap.title,tabindex:"0",onClick:T[0]||(T[0]=k=>i("edit",n.myMap)),onKeydown:[T[1]||(T[1]=to(k=>i("edit",n.myMap),["enter"])),T[2]||(T[2]=to(ps(k=>i("edit",n.myMap),["prevent"]),["space"]))]},K(n.myMap.title),41,ESe),P("button",{onClick:T[3]||(T[3]=k=>i("close")),class:"text-slate-400 hover:text-slate-700 text-2xl","aria-label":M(t)("Close")},[...T[10]||(T[10]=[P("span",{"aria-hidden":"true"},"",-1)])],8,TSe)]),P("p",{"data-cy":"mymap-description",class:"text-white mb-2 hover:cursor-pointer",role:"button","aria-label":M(t)("diter la description de la carte"),tabindex:"0",onClick:T[4]||(T[4]=k=>i("edit",n.myMap)),onKeydown:[T[5]||(T[5]=to(k=>i("edit",n.myMap),["enter"])),T[6]||(T[6]=to(ps(k=>i("edit",n.myMap),["prevent"]),["space"]))]},[n.myMap.description?(U(),ie(Mt,{key:0},[Bt(K(n.myMap.description),1)],64)):(U(),ie("span",MSe,K(M(t)("Aucune description")),1))],40,RSe),M(l)?(U(),ie("div",kSe,[P("span",LSe,K(M(t)("Attention!")),1),T[11]||(T[11]=Bt("",-1)),P("span",{innerHTML:M(t)("Les couches slectionnes dans le catalogue sont diffrentes de celles charges avec votre carte. Voulez vous sauvegarder ces modifications dans votre carte?")},null,8,PSe),P("div",GSe,[P("button",{class:"lux-btn",onClick:T[7]||(T[7]=k=>i("resetLayers",n.myMap))},K(M(t)("Reset")),1),P("button",{class:"lux-btn",onClick:T[8]||(T[8]=k=>i("saveLayers",n.myMap))},K(M(t)("Oui")),1)])])):Le("",!0),P("div",FSe,[P("span",OSe,[n.myMap.public?(U(),ie("i",{key:0,class:"fa fa-unlock mr-1","aria-label":M(t)("Carte publique")},null,8,NSe)):(U(),ie("i",{key:1,class:"fa fa-lock mr-1","aria-label":M(t)("Carte prive")},null,8,DSe)),Bt(" "+K(M(t)("Carte cre par"))+" "+K(n.myMap.user_login),1)]),P("input",{type:"file",class:"sr-only",ref_key:"fileInputRef",ref:m,id:"gpx-kml-import",accept:".gpx,.kml,.kmz","aria-label":M(t)("Importer un fichier GPX/KML/KMZ"),onChange:T[9]||(T[9]=k=>y.value=k.target.files?.[0]||null)},null,40,VSe),mt(Hk,{"data-cy":"drawPanelMenuPopup",items:x.value,direction:"down",ariaLabel:M(t)("My Map menu")},{item:Wt(({item:k})=>[mt(Kk,{item:k,onClick:k.action},{default:Wt(()=>[Bt(K(M(t)(k.label)),1)]),_:2},1032,["item","onClick"])]),default:Wt(()=>[T[12]||(T[12]=P("i",{class:"fa-solid fa-square-caret-down hover:text-tertiary"},null,-1))]),_:1},8,["items","ariaLabel"])])],64))}}),ZSe={ref:"filtersWrapperDOM",class:"mt-2 mb-8 mx-2 flex flex-row gap-2 fixed"},WSe={for:"map-search-input",class:"sr-only"},zSe=["placeholder","aria-label"],USe={for:"category-filter",class:"sr-only"},XSe={for:"owner-filter",class:"sr-only"},YSe={ref:"resultsWrapperDOM",class:"px-2 h-96 overflow-y-auto"},HSe=["aria-label"],KSe={scope:"col",class:"py-2 text-left w-40"},jSe=["aria-label"],$Se={class:"w-5 inline-block","aria-hidden":"true"},JSe={scope:"col",class:"text-left"},qSe=["aria-label"],QSe={class:"w-5 inline-block","aria-hidden":"true"},eEe={scope:"col",class:"text-left"},tEe=["aria-label"],nEe={class:"w-5 inline-block","aria-hidden":"true"},iEe={scope:"col",class:"text-left"},rEe=["aria-label"],sEe={class:"w-5 inline-block","aria-hidden":"true"},oEe={scope:"col"},aEe={class:"sr-only"},lEe=["onClick","aria-label","onKeydown"],uEe=["title"],cEe=["aria-label"],hEe=["onClick"],dEe=["onClick"],fEe=["onClick"],pEe=["onClick","aria-label"],gEe=["onClick","aria-label"],mEe={key:0},yEe={colspan:"6",class:"pt-2 border-t-[1px] italic",role:"status"},_Ee={key:1},vEe={colspan:"6",class:"pt-2 border-t-[1px] italic",role:"status","aria-live":"polite","aria-busy":"true"},bEe={class:"flex flex-row justify-end gap-2"},xEe=at({__name:"my-maps-open-map-list",props:{maps:{},isLoadingMyMaps:{type:Boolean}},emits:["cancel","select","delete"],setup(n,{emit:e}){const t=e,i=n,{t:r}=St(),{isOffLine:o}=It(Jn()),s=Ue(""),l=Ue(""),u=Ct(()=>[{label:r("Filter results by category"),value:""}].concat([...new Set(i.maps.map(G=>G.category))].map(G=>({label:G,value:G})))),h=Ue(""),d=Ct(()=>[{label:r("Filter results by username"),value:""}].concat([...new Set(i.maps.map(G=>G.owner))].map(G=>({label:G,value:G})))),m=Ue(void 0),y=Ue(!0),x=Ct(()=>i.isLoadingMyMaps?[]:i.maps.filter(T).sort((G,O)=>k(G,O,m.value,y.value))),C=wy("filtersWrapperDOM"),w=wy("resultsWrapperDOM");sr(()=>{const G=C.value?.offsetHeight;G&&w.value&&(w.value.style.marginTop=G+32+"px"),C.value&&w.value&&(C.value.style.width=w.value.offsetWidth+"px",C.value.style.maxWidth=w.value.offsetWidth+"px")});function E(G){console.log("TODO",G)}function T(G){const O=s.value?G.title.toLowerCase().includes(s.value.toLowerCase()):!0,V=l.value?G.category.toLowerCase()===l.value.toLowerCase():!0,z=h.value?G.owner.toLowerCase()===h.value.toLowerCase():!0;return O&&V&&z}function k(G,O,V,z){const H=(z?G[V]:O[V])||"",te=(z?O[V]:G[V])||"";return H<te?-1:H>te?1:0}return(G,O)=>(U(),Gt(kf,{title:M(r)("Ouvrir une carte"),onClose:O[10]||(O[10]=V=>t("cancel"))},{content:Wt(()=>[P("div",ZSe,[P("div",null,[P("label",WSe,K(M(r)("Search Maps")),1),An(P("input",{id:"map-search-input",placeholder:M(r)("Search Maps"),class:"lux-input",type:"text","onUpdate:modelValue":O[0]||(O[0]=V=>s.value=V),"aria-label":M(r)("Search Maps")},null,8,zSe),[[Or,s.value]])]),P("div",null,[P("label",USe,K(M(r)("Filter results by category")),1),mt(ig,{id:"category-filter",class:"inline-block min-w-36 w-60",options:u.value,modelValue:l.value,"onUpdate:modelValue":O[1]||(O[1]=V=>l.value=V),onChange:O[2]||(O[2]=V=>l.value=V),"aria-label":M(r)("Filter results by category")},null,8,["options","modelValue","aria-label"])]),P("div",null,[P("label",XSe,K(M(r)("Filter results by username")),1),mt(ig,{id:"owner-filter",class:"inline-block min-w-36 w-60",options:d.value,modelValue:h.value,"onUpdate:modelValue":O[3]||(O[3]=V=>h.value=V),onChange:O[4]||(O[4]=V=>h.value=V),"aria-label":M(r)("Filter results by username")},null,8,["options","modelValue","aria-label"])])],512),O[13]||(O[13]=P("div",{class:"separator border-b-[1px] bg-white mx-2","aria-hidden":"true"},null,-1)),P("div",YSe,[P("table",{class:"w-full",role:"table","aria-label":M(r)("Liste des cartes")},[P("thead",null,[P("tr",null,[P("th",KSe,[P("button",{class:"text-left text-primary w-full text-nowrap","aria-label":M(r)("Trier par titre")+(m.value==="title"?y.value?" (croissant)":" (dcroissant)":""),onClick:O[5]||(O[5]=()=>{m.value="title",y.value=!y.value})},[Bt(K(M(r)("Titre"))+" ",1),P("span",$Se,[m.value==="title"&&!y.value?(U(),ie(Mt,{key:0},[Bt("")],64)):Le("",!0),m.value==="title"&&y.value?(U(),ie(Mt,{key:1},[Bt("")],64)):Le("",!0)])],8,jSe)]),P("th",JSe,[P("button",{class:"text-left text-primary text-nowrap w-full","aria-label":M(r)("Trier par catgorie")+(m.value==="category"?y.value?" (croissant)":" (dcroissant)":""),onClick:O[6]||(O[6]=()=>{m.value="category",y.value=!y.value})},[Bt(K(M(r)("Catgorie"))+" ",1),P("span",QSe,[m.value==="category"&&!y.value?(U(),ie(Mt,{key:0},[Bt("")],64)):Le("",!0),m.value==="category"&&y.value?(U(),ie(Mt,{key:1},[Bt("")],64)):Le("",!0)])],8,qSe)]),P("th",eEe,[P("button",{class:"text-left text-primary text-nowrap w-full","aria-label":M(r)("Trier par crateur")+(m.value==="owner"?y.value?" (croissant)":" (dcroissant)":""),onClick:O[7]||(O[7]=()=>{m.value="owner",y.value=!y.value})},[Bt(K(M(r)("Crateur carte"))+" ",1),P("span",nEe,[m.value==="owner"&&!y.value?(U(),ie(Mt,{key:0},[Bt("")],64)):Le("",!0),m.value==="owner"&&y.value?(U(),ie(Mt,{key:1},[Bt("")],64)):Le("",!0)])],8,tEe)]),P("th",iEe,[P("button",{class:"text-left text-primary text-nowrap w-full","aria-label":M(r)("Trier par date de mise  jour")+(m.value==="last_feature_update"?y.value?" (croissant)":" (dcroissant)":""),onClick:O[8]||(O[8]=()=>{m.value="last_feature_update",y.value=!y.value})},[Bt(K(M(r)("Dernire Actualisation"))+" ",1),P("span",sEe,[m.value==="last_feature_update"&&!y.value?(U(),ie(Mt,{key:0},[Bt("")],64)):Le("",!0),m.value==="last_feature_update"&&y.value?(U(),ie(Mt,{key:1},[Bt("")],64)):Le("",!0)])],8,rEe)]),P("th",oEe,[P("span",aEe,K(M(r)("Actions")),1)])])]),P("tbody",null,[(U(!0),ie(Mt,null,hi(x.value,V=>(U(),ie("tr",{class:"border-t-[1px]",key:V.uuid},[P("td",{class:"py-2 cursor-pointer text-left w-44",onClick:()=>t("select",V.uuid),role:"button","aria-label":M(r)("Ouvrir la carte")+" "+V.title,tabindex:"0",onKeydown:[to(()=>t("select",V.uuid),["enter"]),to(ps(()=>t("select",V.uuid),["prevent"]),["space"])]},[P("span",{class:"line-clamp-2 overflow-hidden",title:V.title},[P("i",{class:Rn(["mr-2 fa",{"fa-lock":!V.public,"fa-unlock":V.public}]),"aria-label":V.public?M(r)("Carte publique"):M(r)("Carte prive")},null,10,cEe),Bt(" "+K(V.title),1)],8,uEe)],40,lEe),P("td",{class:"cursor-pointer text-left",onClick:()=>t("select",V.uuid)},K(V.category),9,hEe),P("td",{class:"cursor-pointer text-left",onClick:()=>t("select",V.uuid)},K(V.owner),9,dEe),P("td",{class:"cursor-pointer text-left",onClick:()=>t("select",V.uuid)},K(M(TM)(V.last_feature_update)),9,fEe),P("td",null,[V.deletedWhileOffline?Le("",!0):(U(),ie("button",{key:0,onClick:z=>t("delete",V),"aria-label":M(r)("Supprimer la carte")+" "+V.title,class:"hover:text-red-500"},[...O[11]||(O[11]=[P("i",{class:"fa fa-trash","aria-hidden":"true"},null,-1)])],8,pEe))]),P("td",null,[M(o)&&V.dirty?(U(),ie("button",{key:0,onClick:z=>E(V),"aria-label":M(r)("Synchroniser la carte")+" "+V.title,class:"hover:text-blue-500"},[...O[12]||(O[12]=[P("i",{class:"fa fa-refresh","aria-hidden":"true"},null,-1)])],8,gEe)):Le("",!0)])]))),128)),!x.value.length&&!n.isLoadingMyMaps?(U(),ie("tr",mEe,[P("td",yEe,K(M(r)("No result",{ns:"client"})),1)])):Le("",!0),n.isLoadingMyMaps?(U(),ie("tr",_Ee,[P("td",vEe,K(M(r)("Chargement des cartes en cours",{ns:"client"})),1)])):Le("",!0)])],8,HSe)],512)]),footer:Wt(()=>[P("div",bEe,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:O[9]||(O[9]=V=>t("cancel"))},K(M(r)("Annuler")),1)])]),_:1},8,["title"]))}}),IEe={class:"font-bold"},CEe={class:"flex flex-row justify-end gap-2"},kz=at({__name:"my-map-confirm",props:{map:{},mode:{}},emits:["cancel","confirm"],setup(n){const e=n,{t}=St(),i=e.mode==="clear"?t("Confirmation de suppression des lments de la carte"):t("Confirmation de suppression de la carte");return(r,o)=>(U(),Gt(kf,{title:M(i),onClose:o[2]||(o[2]=s=>r.$emit("cancel")),role:"alertdialog"},{content:Wt(()=>[e.mode==="clear"?(U(),ie(Mt,{key:0},[Bt(K(M(t)("Etes-vous certain de vouloir effacer tous les lments de la carte ?")),1)],64)):(U(),ie(Mt,{key:1},[Bt(K(M(t)("Etes-vous certain de vouloir effacer la carte intitule :"))+" ",1),P("span",IEe,K(n.map.title),1)],64))]),footer:Wt(()=>[P("div",CEe,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:o[0]||(o[0]=s=>r.$emit("cancel"))},K(M(t)("Annuler")),1),P("button",{class:"lux-btn","data-dismiss":"modal",onClick:o[1]||(o[1]=s=>r.$emit("confirm",n.map.uuid,n.mode))},K(M(t)("Effacer")),1)])]),_:1},8,["title"]))}}),wEe=at({__name:"my-maps-open-map",props:{maps:{},isLoadingMyMaps:{type:Boolean}},emits:["cancel","select","delete"],setup(n,{emit:e}){const t=e,i=Ue(void 0);function r(s){i.value=s}function o(s){i.value=void 0,t("delete",s)}return(s,l)=>i.value?(U(),Gt(kz,{key:1,map:i.value,mode:"delete",onCancel:l[2]||(l[2]=u=>i.value=void 0),onConfirm:o},null,8,["map"])):(U(),Gt(xEe,{key:0,maps:n.maps,isLoadingMyMaps:n.isLoadingMyMaps,onCancel:l[0]||(l[0]=u=>t("cancel")),onSelect:l[1]||(l[1]=u=>t("select",u)),onDelete:r},null,8,["maps","isLoadingMyMaps"]))}}),AEe={key:0},SEe={class:"text-white"},EEe={class:"flex justify-center flex-col items-center"},TEe=["disabled","aria-busy","aria-label"],REe=at({__name:"my-maps-panel",setup(n){const{t:e}=St(),{addNotification:t}=Qr(),i=Jn(),r=Rf(),{toggleShareOpen:o}=i,{myMap:s}=It(i),l=zr(),{drawnFeaturesMyMaps:u}=It(l),h=Ue(void 0),d=mi(void 0),m=Ue(!1),y=Ue(void 0),x=Ue(void 0),C=mi([]),w=Ue(!1);async function E(){w.value=!0;try{if(C.value=await Kae(),!C.value.length){t(e("You have no existing Maps, please create a New Map"),ii.WARNING);return}}catch{t(e("Erreur lors du chargement des cartes."),ii.ERROR)}finally{w.value=!1}}async function T(){r.checkAuth()&&(m.value=!0,E())}function k(D,oe){r.checkAuth()&&(d.value=D,h.value=oe)}async function G(D){await r.loadMyMap(D),h.value!==Cu.EDIT&&t(e("Nouvelle carte cre")),h.value=void 0}async function O(D){r.openMyMap(D),m.value=!1}async function V(D){m.value=!1,te(D,"delete")}async function z(D){C.value=[],await ae(D),await E()}function H(D){te(D,"clear")}function te(D,oe){y.value=oe,x.value=D}function $(D,oe){oe==="delete"?ae(D):oe==="clear"&&fe(D)}async function ae(D){await Qae(D)?(y.value=void 0,D===s.value?.uuid&&r.closeMyMap(),t(e("MyMap successfully deleted."))):t(e("Unable to delete MyMap."),ii.ERROR)}async function fe(D){await r.clearMyMap(D)?(y.value=void 0,l.removeMyMapsFeature(D)):t(e("Unable to clear MyMap."),ii.ERROR)}function Y(){r.checkAuth()&&r.addInMyMap()}function de(){k(void 0,Cu.CREATE_FROM_FEATURES)}return Pt(h,D=>D===void 0&&(d.value=void 0)),Pt(y,D=>D===void 0&&(x.value=void 0)),Pt(s,(D,oe)=>!D&&oe&&l.removeMyMapsFeature(oe.uuid)),(D,oe)=>(U(),ie(Mt,null,[mt(Lf,{"data-cy-value":"myMapsPanel","close-fn":()=>M(i).toggleMyMapsOpen(!1)},{header:Wt(()=>[P("h1",null,K(M(e)("My Maps",{ns:"client"})),1)]),content:Wt(()=>[M(s)?(U(),ie("div",AEe,[mt(BSe,{myMap:M(s),onClose:M(r).closeMyMap,onDelete:V,onClear:H,onCopy:oe[0]||(oe[0]=ue=>k(ue,M(Cu).COPY)),onEdit:oe[1]||(oe[1]=ue=>k(ue,M(Cu).EDIT)),onNew:oe[2]||(oe[2]=()=>k(void 0,M(Cu).CREATE)),onOpen:T,onShare:oe[3]||(oe[3]=()=>M(o)(!0)),onResetLayers:M(r).resetFromMyMap,onSaveLayers:M(r).applyToMyMap,"onDraw:mergelines":oe[4]||(oe[4]=()=>M(l).toggleDrawMergeLinesModal(!0)),"onDraw:cutlines":oe[5]||(oe[5]=()=>M(l).toggleDrawCutLineMode())},null,8,["myMap","onClose","onResetLayers","onSaveLayers"]),mt(Tz,{features:M(u),idPrefix:"mymap"},null,8,["features"])])):(U(),ie(Mt,{key:1},[P("div",SEe,K(M(e)("Create, save and share your own maps.",{ns:"client"})),1),P("div",EEe,[P("button",{class:"lux-btn mt-3",onClick:T,disabled:w.value,"aria-busy":w.value,"aria-label":w.value?M(e)("Chargement en cours..."):M(e)("Ouvrir une carte",{ns:"client"})},K(M(e)("Ouvrir une carte",{ns:"client"})),9,TEe),P("button",{class:"lux-btn mt-3",onClick:oe[6]||(oe[6]=ue=>k(void 0,M(Cu).CREATE))},K(M(e)("Crer une nouvelle carte",{ns:"client"})),1)])],64)),mt(oSe,{onMoveInMyMap:Y,onCreateNewMyMap:de})]),_:1},8,["close-fn"]),x.value&&y.value?(U(),Gt(kz,{key:0,mode:y.value,map:x.value,onCancel:oe[7]||(oe[7]=ue=>y.value=void 0),onConfirm:$},null,8,["mode","map"])):Le("",!0),h.value?(U(),Gt(gSe,{key:1,mode:h.value,map:d.value,onCancel:oe[8]||(oe[8]=ue=>h.value=void 0),onConfirm:G},null,8,["mode","map"])):Le("",!0),m.value?(U(),Gt(wEe,{key:2,maps:C.value,isLoadingMyMaps:w.value,onCancel:oe[9]||(oe[9]=ue=>m.value=!1),onSelect:O,onDelete:z},null,8,["maps","isLoadingMyMaps"])):Le("",!0)],64))}});var C0={},uo={},x3;function MEe(){return x3||(x3=1,Object.defineProperty(uo,"__esModule",{value:!0}),uo.BLANK_URL=uo.relativeFirstCharacters=uo.whitespaceEscapeCharsRegex=uo.urlSchemeRegex=uo.ctrlCharactersRegex=uo.htmlCtrlEntityRegex=uo.htmlEntitiesRegex=uo.invalidProtocolRegex=void 0,uo.invalidProtocolRegex=/^([^\w]*)(javascript|data|vbscript)/im,uo.htmlEntitiesRegex=/&#(\w+)(^\w|;)?/g,uo.htmlCtrlEntityRegex=/&(newline|tab);/gi,uo.ctrlCharactersRegex=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,uo.urlSchemeRegex=/^.+(:|&colon;)/gim,uo.whitespaceEscapeCharsRegex=/(\\|%5[cC])((%(6[eE]|72|74))|[nrt])/g,uo.relativeFirstCharacters=[".","/"],uo.BLANK_URL="about:blank"),uo}var I3;function kEe(){if(I3)return C0;I3=1,Object.defineProperty(C0,"__esModule",{value:!0}),C0.sanitizeUrl=void 0;var n=MEe();function e(s){return n.relativeFirstCharacters.indexOf(s[0])>-1}function t(s){var l=s.replace(n.ctrlCharactersRegex,"");return l.replace(n.htmlEntitiesRegex,function(u,h){return String.fromCharCode(h)})}function i(s){return URL.canParse(s)}function r(s){try{return decodeURIComponent(s)}catch{return s}}function o(s){if(!s)return n.BLANK_URL;var l,u=r(s.trim());do u=t(u).replace(n.htmlCtrlEntityRegex,"").replace(n.ctrlCharactersRegex,"").replace(n.whitespaceEscapeCharsRegex,"").trim(),u=r(u),l=u.match(n.ctrlCharactersRegex)||u.match(n.htmlEntitiesRegex)||u.match(n.htmlCtrlEntityRegex)||u.match(n.whitespaceEscapeCharsRegex);while(l&&l.length>0);var h=u;if(!h)return n.BLANK_URL;if(e(h))return h;var d=h.trimStart(),m=d.match(n.urlSchemeRegex);if(!m)return h;var y=m[0].toLowerCase().trim();if(n.invalidProtocolRegex.test(y))return n.BLANK_URL;var x=d.replace(/\\/g,"/");if(y==="mailto:"||y.includes("://"))return x;if(y==="http:"||y==="https:"){if(!i(x))return n.BLANK_URL;var C=new URL(x);return C.protocol=C.protocol.toLowerCase(),C.hostname=C.hostname.toLowerCase(),C.toString()}return x}return C0.sanitizeUrl=o,C0}var ey=kEe();function i_(n,e,t="f_"){return Object.entries(n).filter(([i])=>i!=="showProfile").map(([i,r])=>({key:t+i,value:r})).sort((i,r)=>e?0:i.key.localeCompare(r.key))}function If(n){return n.attributes!==void 0&&Object.keys(n.attributes).length>0}function Ri(n,e,t){return t==null&&(t=0),n in e.attributes&&(""+e.attributes[n]).length>t}function ug(n){return n==null||n.length===0}function Fo(n){const e=String(n).toLowerCase();return e.startsWith("http://")||e.startsWith("https://")}function Vb(n,e,t){const{key:i}=n;let r=!1;return e==="2407"&&(i==="f_Cl_erosion"||i==="f_Erosion_kl"||i==="f_Erosion_Cl"||i==="f_Erosioun_K")?(t==="fr"&&i==="f_Cl_erosion"||t==="de"&&i==="f_Erosion_kl"||t==="en"&&i==="f_Erosion_Cl"||t==="lb"&&i==="f_Erosioun_K")&&(r=!0):e==="2714"&&(i==="f_LABEL_eng"||i==="f_LC_class_name_fr"||i==="f_LC_class_name_de"||i==="f_LC_class_name")?(t==="fr"&&i==="f_LC_class_name_fr"||t==="de"&&i==="f_LC_class_name_de"||t==="en"&&i==="f_LABEL_eng"||t==="lb"&&i==="f_LC_class_name")&&(r=!0):e==="2444"&&(i==="f_Betriebsform"||i==="f_Forme_d_entreprise"||i==="f_Operation_Form"||i==="f_Form_vun_Geschaeft")?(t==="fr"&&i==="f_Forme_d_entreprise"||t==="de"&&i==="f_Betriebsform"||t==="en"&&i==="f_Operation_Form"||t==="lb"&&i==="f_Form_vun_Geschaeft")&&(r=!0):i.endsWith("_FR")||i.endsWith("_DE")||i.endsWith("_EN")||i.endsWith("_LU")||i.endsWith("_LB")?(t==="fr"&&i.endsWith("_FR")||t==="de"&&i.endsWith("_DE")||t==="en"&&i.endsWith("_EN")||t==="lb"&&(i.endsWith("_LB")||i.endsWith("_LU")))&&(r=!0):r=!0,r}function Lz(n){return"fid"in n&&LEe(n.fid)}function LEe(n){return n==null?!1:n.split(",").every(t=>!!t&&t.split("_").length>=2)}function Pz(n){return ey.sanitizeUrl(n)}function Gz(n,e,t,i){const{i18next:r}=St();switch(r.language){case"de":return ey.sanitizeUrl(e??n);case"en":return ey.sanitizeUrl(t??n);case"lb":return ey.sanitizeUrl(i??n);case"fr":default:return ey.sanitizeUrl(n)}}function PEe(n,e,t=","){return n.map(i=>i.attributes[e]).join(t)}function C3(n,e){if(typeof n===void 0)return"";const{t}=St();return n.map(i=>t(e+"_"+i)).join(", ")}function rI(n){const{themes:e}=It(Zr());return e.value?.some(t=>t.name===n)}const GEe={class:"lux-poi-title","data-cy":"defaultTemplateTitle"},FEe={key:0},OEe=["href"],ur=at({__name:"info-feature-layout",props:{layers:{},currentUrl:{},getDirectLink:{type:Function,default:(n,e)=>`${e}&fid=${n.fid}`}},emits:["export"],setup(n){const{t:e}=St();return(t,i)=>(U(),ie(Mt,null,[P("h1",GEe,K(M(e)(n.layers.layerLabel)),1),ei(t.$slots,"layer-content"),(U(!0),ie(Mt,null,hi(n.layers.features,r=>(U(),ie("div",{key:r.id,class:"lux-feature-info","data-cy":"defaultTemplateAttributes"},[ei(t.$slots,"feature-content",{feature:r},()=>[Bt(K(r.id),1)]),M(Lz)(r)?(U(),ie("div",FEe,[P("a",{"data-cy":"defaultTemplateLink",class:"print:hidden",href:n.getDirectLink(r,n.currentUrl),target:"_blank"},K(M(e)("Lien direct vers cet objet")),9,OEe)])):Le("",!0)]))),128))],64))}}),NEe=at({__name:"adresse-template",props:{layers:{},currentUrl:{}},setup(n){return(e,t)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:i})=>[P("h4",null,K(i.attributes.num_affaire),1),Bt(" "+K(i.attributes.numero)+", "+K(i.attributes.rue),1),t[0]||(t[0]=P("br",null,null,-1)),Bt(" L-"+K(i.attributes.code_postal)+" "+K(i.attributes.localite),1),t[1]||(t[1]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),DEe=["href"],VEe=["src"],BEe={class:"no-print"},ZEe=at({__name:"aero-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("h3",null,K(r.attributes.name),1),P("a",{href:r.attributes.path,target:"_blank"},[r.attributes.thumbnail_path?(U(),ie("img",{key:0,src:r.attributes.thumbnail_path,alt:"thumbnail",width:"250"},null,8,VEe)):Le("",!0)],8,DEe),P("span",BEe,K(M(e)("Cliquez dans l'image pour agrandir")),1),i[0]||(i[0]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),WEe=at({__name:"affaires-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("h4",null,K(r.attributes.num_affaire),1),P("span",null,K(M(e)("Numero")),1),Bt(" : "+K(r.attributes.num_affaire),1),i[0]||(i[0]=P("br",null,null,-1)),P("span",null,K(M(e)("Numero cadastral")),1),Bt(" : "+K(r.attributes.label),1),i[1]||(i[1]=P("br",null,null,-1)),P("span",null,K(M(e)("Geometre")),1),Bt(" : "+K(r.attributes.geometre),1),i[2]||(i[2]=P("br",null,null,-1)),P("span",null,K(M(e)("Region")),1),Bt(" : "+K(r.attributes.region),1),i[3]||(i[3]=P("br",null,null,-1)),P("span",null,K(M(e)("Type")),1),Bt(" : "+K(M(e)(r.attributes.type)),1),i[4]||(i[4]=P("br",null,null,-1)),P("span",null,K(M(e)("Statut")),1),Bt(" : "+K(M(e)(r.attributes.statut)),1),i[5]||(i[5]=P("br",null,null,-1)),P("span",null,K(M(e)("Date")),1),Bt(" : "+K(r.attributes.date),1),i[6]||(i[6]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),zEe={key:0},UEe={key:1},XEe=at({__name:"asta-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>{const r=kl("format-measure");return U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:o})=>[P("span",null,K(M(e)("Numero EFA")),1),Bt(" : "+K(o.attributes.code_elem)+K(o.attributes.efa),1),i[3]||(i[3]=P("br",null,null,-1)),o.attributes.surface?(U(),ie("div",zEe,[P("span",null,K(M(e)("Surface")),1),Bt(" : "+K(Number(o.attributes.surface).toFixed(1))+" a",1),i[0]||(i[0]=P("br",null,null,-1))])):Le("",!0),o.attributes.longueur?(U(),ie("div",UEe,[P("span",null,K(M(e)("Longueur")),1),i[1]||(i[1]=Bt(" : ",-1)),An(P("span",null,null,512),[[r,o.attributes.longueur,"1",{length:!0}]]),i[2]||(i[2]=P("br",null,null,-1))])):Le("",!0)]),_:1},8,["layers","currentUrl"])}}}),ud=at({__name:"profile-feature-info",props:{feature:{}},emits:["export"],setup(n){const e=n,{t}=St(),i=Kn().getOlMap(),r=Ct(()=>new Rl(new Qa().readFeature(e.feature,{dataProjection:Ml,featureProjection:i.getView().getProjection()})));return(o,s)=>(U(),ie(Mt,null,[mt(Dk,{feature:r.value},null,8,["feature"]),P("div",null,[P("button",{class:"lux-feature-info-export",onClick:s[0]||(s[0]=l=>o.$emit("export",{feature:n.feature,format:"kml"}))},K(M(t)("Exporter KMl")),1),P("button",{class:"lux-feature-info-export",onClick:s[1]||(s[1]=l=>o.$emit("export",{feature:n.feature,format:"gpx"}))},K(M(t)("Exporter GPX")),1)])],64))}}),YEe={key:0},HEe={key:0},KEe={key:0},jEe={key:1},$Ee=["href"],JEe={key:1},qEe={key:0},QEe={key:1},eTe={key:2},tTe={key:3},nTe={key:4},iTe={key:5},rTe={key:0},sTe={key:2},oTe=at({__name:"automatic-sols-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=St();return(t,i)=>{const r=kl("dompurify-html");return U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:o})=>[o.attributes.label?(U(),ie("h4",YEe,K(M(e)(o.attributes.label)),1)):Le("",!0),M(If)(o)?(U(),ie(Mt,{key:1},[(U(!0),ie(Mt,null,hi(M(i_)(o.attributes,n.layers.ordered),s=>(U(),ie("div",{key:s.key},[!M(ug)(s.value)&&!s.key.startsWith("f_LC_class_name")&&!s.key.startsWith("f_LABEL_")?(U(),ie("span",HEe,[M(Fo)(s.value)?Le("",!0):(U(),ie("label",KEe,K(M(e)(s.key))+" : ",1)),M(Fo)(s.value)?Le("",!0):An((U(),ie("span",jEe,null,512)),[[r,s.value]]),M(Fo)(s.value)?(U(),ie("a",{key:2,href:s.value,target:"_blank"},K(M(e)(s.key)),9,$Ee)):Le("",!0)])):Le("",!0),!M(ug)(s.value)&&(s.key.startsWith("f_LC_class_name")||s.key.startsWith("f_LABEL_"))?(U(),ie("span",JEe,[M(Wn).language=="fr"&&(s.key=="f_LC_class_name_fr"||s.key=="f_LABEL_fr")?(U(),ie("label",qEe,K(M(e)(s.key))+" : ",1)):Le("",!0),M(Wn).language=="fr"&&(s.key=="f_LC_class_name_fr"||s.key=="f_LABEL_fr")?An((U(),ie("span",QEe,null,512)),[[r,s.value]]):Le("",!0),(M(Wn).language=="de"||M(Wn).language=="lb")&&(s.key=="f_LC_class_name_de"||s.key=="f_LABEL_de")?(U(),ie("label",eTe,K(M(e)(s.key))+" : ",1)):Le("",!0),(M(Wn).language=="de"||M(Wn).language=="lb")&&(s.key=="f_LC_class_name_de"||s.key=="f_LABEL_de")?An((U(),ie("span",tTe,null,512)),[[r,s.value]]):Le("",!0),M(Wn).language=="en"&&(s.key=="f_LC_class_name"||s.key=="f_LABEL_eng")?(U(),ie("label",nTe,K(M(e)(s.key))+" : ",1)):Le("",!0),M(Wn).language=="en"&&(s.key=="f_LC_class_name"||s.key=="f_LABEL_eng")?An((U(),ie("span",iTe,null,512)),[[r,s.value]]):Le("",!0)])):Le("",!0)]))),128)),n.layers.has_profile?(U(),ie("div",rTe,[mt(ud,{feature:o,onExport:i[0]||(i[0]=s=>t.$emit("export",s))},null,8,["feature"])])):Le("",!0)],64)):(U(),ie("div",sTe,[P("span",null,K(M(e)("Aucune information disponible pour cette couche")),1)]))]),_:1},8,["layers","currentUrl"])}}}),aTe=at({__name:"batiments-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("span",null,K(M(e)("Type")),1),i[0]||(i[0]=Bt(" : ",-1)),P("span",null,K(M(e)("bat_"+r.attributes.type)),1),i[1]||(i[1]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),lTe=["src"],uTe=at({__name:"bus-wo-title-template",props:{layers:{},currentUrl:{}},setup(n){const e="https://migration.geoportail.lu/getbuswidget";return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("h3",null,K(r.attributes.name),1),P("iframe",{class:"-ml-3.5",title:"bus widget",height:"300",width:"500",frameborder:"0",src:`${M(e)}${M(Gz)(`?lang=fr&id=${r.attributes.extid}`,`?lang=de&id=${r.attributes.extid}`,`?lang=en&id=${r.attributes.extid}`,`?lang=fr&id=${r.attributes.extid}`)}`},null,8,lTe)]),_:1},8,["layers","currentUrl"]))}}),cTe=["src"],hTe=at({__name:"bus-template",props:{layers:{},currentUrl:{}},setup(n){const e="https://migration.geoportail.lu/getbuswidget";return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("h3",null,K(r.attributes.name),1),P("iframe",{class:"-ml-3.5",title:"bus widget",height:"300",width:"500",frameborder:"0",src:`${M(e)}${M(Gz)(`?lang=fr&id=${r.attributes.extid}`,`?lang=de&id=${r.attributes.extid}`,`?lang=en&id=${r.attributes.extid}`,`?lang=fr&id=${r.attributes.extid}`)}`},null,8,cTe)]),_:1},8,["layers","currentUrl"]))}}),dTe={class:"lux-poi-title"},fTe={class:"lux-feature-info"},pTe={class:"poi-feature"},gTe={class:"casipo-form-container"},mTe={class:"casipo-mail"},yTe={class:"casipo-checkbox"},_Te=["innerHTML"],vTe=at({__name:"casipo-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{authenticated:e,currentUser:t}=It(iu()),r=n.layers,{addNotification:o}=Qr(),s=Ue(""),l=Ct(()=>e.value&&t.value?.mail||"");s.value=l.value;const u=Ue(!1),{t:h}=St(),d="https://migration.geoportail.lu/casipo";function m(x,C,w){return x.map(function(E){return E.attributes[C]}).join(w)}async function y(){if(!s.value&&!/^\S+@\S+\.\S+$/.test(s.value)){o(h("Veuillez saisir une adresse email valide"),ii.WARNING);return}if(!u.value){o(h("Veuillez accepter les termes du rapport"),ii.WARNING);return}const x=new URLSearchParams({email:s.value,staging:"false"});fetch(d+"/report/"+m(r.features,"textstring",",")+".pdf",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:x}),o(h("Votre rapport est en train d'tre gnr. Un email vous sera envoy  l'adresse {{email}} ds qu'il sera disponible",{email:s.value,ns:"client"}),ii.INFO)}return(x,C)=>(U(),ie(Mt,null,[P("h1",dTe,K(M(h)(M(r).layerLabel)),1),P("div",fTe,[P("div",pTe,[P("label",null,K(M(h)("Ici vous pouvez commander le rapport relatif aux site potentiellement contamins")),1),C[3]||(C[3]=P("br",null,null,-1)),C[4]||(C[4]=P("br",null,null,-1)),P("div",gTe,[P("div",mTe,[P("label",null,K(M(h)("Adresse Email")),1),An(P("input",{type:"text","onUpdate:modelValue":C[0]||(C[0]=w=>s.value=w),style:{width:"165px"}},null,512),[[Or,s.value]])]),P("div",yTe,[An(P("input",{type:"checkbox","onUpdate:modelValue":C[1]||(C[1]=w=>u.value=w),id:"terms"},null,512),[[Hh,u.value]]),P("label",{for:"terms",innerHTML:M(h)("En cochant cette case, l'utilisateur dclare avoir lu, compris et accept les <a target='_blank' rel='noopener noreferrer' href='https://files.geoportail.lu/Conditions_utilisation_CASIPO.pdf'>conditions gnrales d'utilisation </a>de ce site web")},null,8,_Te)])]),P("button",{class:"lux-btn-grey",onClick:C[2]||(C[2]=w=>y()),target:"_blank"},K(M(h)("Commander rapport")),1)])])],64))}}),bTe=es(vTe,[["__scopeId","data-v-c10938bd"]]),xTe={class:"flex flex-col"},ITe={class:"lux-poi-title","data-cy":"defaultTemplateTitle"},CTe={key:0},wTe={key:1,"data-cy":"defaultTemplateAttributes"},ATe={key:0},STe={key:0},ETe={key:1},TTe=["href"],RTe=["href"],MTe={class:"lux-solarkataster-button"},kTe={key:4},LTe={controls:"",autoplay:"",style:{width:"260px",height:"50px"}},PTe=["src"],GTe=["src"],FTe={key:2},OTe={key:3,class:"no-print"},NTe={key:4,class:"no-print"},DTe=["href"],w3=at({__name:"default-template",props:{layers:{type:Object,required:!0},currentUrl:{type:String,required:!1}},emits:["export"],setup(n){const{t:e}=St();function t(s,l){return!(s.startsWith("myenergy_solarkataster_luxemburg")||s.startsWith("eau_new_Wasserstand"))&&Fo(l.value)}function i(s,l){return s.startsWith("myenergy_solarkataster_luxemburg")&&Fo(l.value)&&l.key==="f_href"}function r(s,l){return s.startsWith("eau_new_Wasserstand")&&Fo(l.value)&&l.key==="f_Graph"}function o(s){return Fo(s.value)&&s.key==="f_AudioURL"}return(s,l)=>{const u=kl("dompurify-html");return U(),ie("div",xTe,[P("div",null,[P("h2",ITe,K(M(e)(n.layers.layerLabel)),1),(U(!0),ie(Mt,null,hi(n.layers.features,h=>(U(),ie("div",{key:h.id,class:"lux-feature-info"},[h.attributes.label?(U(),ie("h4",CTe,K(M(e)(h.attributes.label)),1)):Le("",!0),M(If)(h)?(U(),ie("div",wTe,[(U(!0),ie(Mt,null,hi(M(i_)(h.attributes,n.layers.ordered),d=>(U(),ie("div",{key:d.key},[!M(ug)(d.value)&&M(Vb)(d,n.layers.layer,M(Wn).language)?(U(),ie("div",ATe,[M(Fo)(d.value)?Le("",!0):(U(),ie("label",STe,K(M(e)(d.key))+" : ",1)),M(Fo)(d.value)?Le("",!0):An((U(),ie("span",ETe,null,512)),[[u,d.value]]),t(n.layers.layerLabel,d)?(U(),ie("a",{key:2,href:d.value,target:"_blank"},K(M(e)(d.key)),9,TTe)):Le("",!0),i(n.layers.layerLabel,d)?(U(),ie("a",{key:3,"data-cy":"defaultTemplateSolarLink",href:d.value,target:"_blank"},[P("button",MTe,[P("span",null,K(M(e)("Lien direct vers le calculateur d'efficacit conomique")),1)])],8,RTe)):Le("",!0),o(d)?(U(),ie("span",kTe,[P("audio",LTe,[P("source",{src:d.value,type:"audio/wav"},null,8,PTe)])])):Le("",!0),r(n.layers.layerLabel,d)?(U(),ie("iframe",{key:5,width:"260px",height:"560px",src:M(Pz)(d.value),title:"water level graph"},null,8,GTe)):Le("",!0)])):Le("",!0)]))),128))])):Le("",!0),n.layers.has_profile?(U(),ie("div",FTe,[mt(ud,{feature:h,onExport:l[0]||(l[0]=d=>s.$emit("export",d))},null,8,["feature"])])):Le("",!0),M(If)(h)?Le("",!0):(U(),ie("div",OTe,[P("span",null,K(M(e)("Aucune information disponible pour cette couche")),1)])),M(Lz)(h)?(U(),ie("div",NTe,[P("span",null,[P("a",{"data-cy":"defaultTemplateLink",href:n.currentUrl+"&fid="+h.fid,target:"_blank"},K(M(e)("Lien direct vers cet objet")),9,DTe)])])):Le("",!0)]))),128))])])}}}),VTe={key:0},BTe={key:0},ZTe={key:0,class:"flex"},WTe={class:"w-1/3"},zTe={class:"w-2/3"},UTe={key:1,class:"flex"},XTe=["href"],YTe={key:0},HTe={key:2},KTe=at({__name:"default-table-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=St();return(t,i)=>{const r=kl("dompurify-html");return U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:o})=>[o.attributes.label?(U(),ie("h4",VTe,K(M(e)(o.attributes.label)),1)):Le("",!0),M(If)(o)?(U(),ie(Mt,{key:1},[(U(!0),ie(Mt,null,hi(M(i_)(o.attributes,n.layers.ordered),s=>(U(),ie("div",{key:s.key},[!M(ug)(s.value)&&M(Vb)(s,n.layers.layer,M(Wn).language)?(U(),ie("span",BTe,[M(Fo)(s.value)?Le("",!0):(U(),ie("div",ZTe,[P("label",WTe,K(M(e)(s.key)),1),An(P("span",zTe,null,512),[[r,s.value]])])),M(Fo)(s.value)?(U(),ie("div",UTe,[i[1]||(i[1]=P("label",{class:"w-1/3"},null,-1)),P("a",{class:"w-2/3",href:s.value,target:"_blank"},K(M(e)(s.key)),9,XTe)])):Le("",!0)])):Le("",!0)]))),128)),n.layers.has_profile?(U(),ie("div",YTe,[mt(ud,{feature:o,onExport:i[0]||(i[0]=s=>t.$emit("export",s))},null,8,["feature"])])):Le("",!0)],64)):(U(),ie("div",HTe,[P("span",null,K(M(e)("Aucune information disponible pour cette couche")),1)]))]),_:1},8,["layers","currentUrl"])}}}),jTe={key:0},$Te={key:0},JTe={key:0,class:"flex"},qTe={class:"w-1/3"},QTe={class:"w-2/3"},eRe={key:1,class:"flex"},tRe=["href"],nRe={key:0},iRe={key:2},rRe=at({__name:"default-table-no-prefix-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=St();return(t,i)=>{const r=kl("dompurify-html");return U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:o})=>[o.attributes.label?(U(),ie("h4",jTe,K(M(e)(o.attributes.label)),1)):Le("",!0),M(If)(o)?(U(),ie(Mt,{key:1},[(U(!0),ie(Mt,null,hi(M(i_)(o.attributes,n.layers.ordered,""),s=>(U(),ie("div",{key:s.key},[!M(ug)(s.value)&&M(Vb)(s,n.layers.layer,M(Wn).language)?(U(),ie("span",$Te,[M(Fo)(s.value)?Le("",!0):(U(),ie("div",JTe,[P("label",qTe,K(M(e)(s.key)),1),An(P("span",QTe,null,512),[[r,s.value]])])),M(Fo)(s.value)?(U(),ie("div",eRe,[i[1]||(i[1]=P("label",{class:"w-1/3"},null,-1)),P("a",{class:"w-2/3",href:s.value,target:"_blank"},K(M(e)(s.key)),9,tRe)])):Le("",!0)])):Le("",!0)]))),128)),n.layers.has_profile?(U(),ie("div",nRe,[mt(ud,{feature:o,onExport:i[0]||(i[0]=s=>t.$emit("export",s))},null,8,["feature"])])):Le("",!0)],64)):(U(),ie("div",iRe,[P("span",null,K(M(e)("Aucune information disponible pour cette couche")),1)]))]),_:1},8,["layers","currentUrl"])}}}),sRe=at({__name:"flik-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("span",null,K(M(e)("Numero FLIK"))+" : ",1),Bt(" "+K(r.attributes.element)+K(r.attributes.flik),1),i[0]||(i[0]=P("br",null,null,-1)),P("span",null,K(M(e)("Surface"))+" : ",1),Bt(" "+K(r.attributes.surface)+" a",1),i[1]||(i[1]=P("br",null,null,-1)),P("span",null,K(M(e)("Perimetre"))+" : ",1),Bt(" "+K(r.attributes.perimetre)+" m",1),i[2]||(i[2]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),oRe={class:"lux-poi-title"},aRe={class:"lux-feature-info"},lRe={class:"poi-feature"},uRe={class:"forage-virtuel-form-container"},cRe={class:"forage-virtuel-mail"},hRe=at({__name:"forage-virtuel-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{authenticated:e,currentUser:t}=It(iu()),r=n.layers,{addNotification:o}=Qr(),s=Ue(""),l=Ct(()=>e.value&&t.value?.mail||"");s.value=l.value;const{t:u}=St(),h=void 0;async function d(){if(!s.value&&!/^\S+@\S+\.\S+$/.test(s.value)){o(u("Veuillez saisir une adresse email valide"),ii.WARNING);return}const m=new URLSearchParams({x:String(r.features[0].geometry.coordinates[0]),y:String(r.features[0].geometry.coordinates[1]),email:s.value,staging:"false"});fetch(h,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:m}),o(u("Votre rapport est en train d'tre gnr. Un email vous sera envoy  l'adresse {{email}} ds qu'il sera disponible",{email:s.value,ns:"client"}),ii.INFO)}return(m,y)=>(U(),ie(Mt,null,[P("h1",oRe,K(M(u)(M(r).layerLabel)),1),P("div",aRe,[P("div",lRe,[P("label",null,K(M(u)("Ici vous pouvez commander le rapport relatif au forage virtuel")),1),y[2]||(y[2]=P("br",null,null,-1)),y[3]||(y[3]=P("br",null,null,-1)),P("div",uRe,[P("div",cRe,[P("label",null,K(M(u)("Adresse Email")),1),An(P("input",{type:"text","onUpdate:modelValue":y[0]||(y[0]=x=>s.value=x),style:{width:"165px"}},null,512),[[Or,s.value]])])]),P("button",{class:"lux-btn-grey",onClick:y[1]||(y[1]=x=>d()),target:"_blank"},K(M(u)("Commander rapport")),1)])])],64))}}),dRe=es(hRe,[["__scopeId","data-v-6d0be8d4"]]),fRe={class:"lux-poi-title"},pRe={key:0},gRe={href:"https://www.mobiliteit.lu/fr/horaires-et-lignes/tram/",target:"_blank"},mRe={key:1},yRe={href:"https://www.mobiliteit.lu/fr/horaires-et-lignes/trains/",target:"_blank"},_Re={key:2},vRe=["href"],bRe=["href"],xRe=at({__name:"lignes-bus-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=St();return(t,i)=>(U(),ie(Mt,null,[P("h1",fRe,K(M(e)(n.layers.layerLabel)),1),P("table",null,[P("thead",null,[P("tr",null,[P("th",null,K(M(e)("Num ligne")),1),P("th",null,K(M(e)("Description")),1)])]),P("tbody",null,[(U(!0),ie(Mt,null,hi(n.layers.features,r=>(U(),ie("tr",{key:r.id,class:"lux-feature-info"},[r.attributes.category_id===404?(U(),ie("td",pRe,[P("a",gRe,K(r.attributes.label),1)])):Le("",!0),r.attributes.category_id===403?(U(),ie("td",mRe,[P("a",yRe,K(r.attributes.label),1)])):Le("",!0),(r.attributes.category_id??0)<403?(U(),ie("td",_Re,[P("a",{href:`https://www.mobiliteit.lu/fr/ligne/bus-${r.attributes.label}-${r.attributes.category_id===400?"avl":r.attributes.category_id===401?"rgtr":"tice"}`,target:"_blank"},K(r.attributes.label),9,vRe)])):Le("",!0),P("td",null,[P("a",{href:`?map_id=${r.attributes.map_id}`,target:"_blank"},K(r.attributes.map_description),9,bRe)])]))),128))])])],64))}}),IRe=["src"],CRe=at({__name:"meteo-template",props:{layers:{},currentUrl:{}},setup(n){return(e,t)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:i})=>[P("h3",null,K(i.attributes.stationsname)+" "+K(i.attributes.sid),1),P("iframe",{title:"meteo widget",class:"-ml-3.5",height:"150",width:"300",frameborder:"0",src:`https://dlr-web-daten1.aspdienste.de/cgi-bin/sinfoam.pl?c=92&nid=01&lid=${i.attributes.sid}`},null,8,IRe)]),_:1},8,["layers","currentUrl"]))}}),wRe=at({__name:"meteolux-europe-template",props:{layers:{},currentUrl:{}},setup(n){return(e,t)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:i})=>[P("h3",null,K(i.attributes.station)+" ("+K(i.attributes.icao)+")",1),P("label",null,K(i.attributes.weather),1),t[0]||(t[0]=Bt("",-1)),P("span",null,K(i.attributes.temperature)+"C",1)]),_:1},8,["layers","currentUrl"]))}}),ARe=at({__name:"meteolux-gr-template",props:{layers:{},currentUrl:{}},setup(n){return(e,t)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:i})=>[P("h3",null,K(i.attributes.station)+" ("+K(i.attributes.icao)+")",1),t[0]||(t[0]=P("label",null,"TAF:",-1)),t[1]||(t[1]=Bt()),P("span",null,K(i.attributes.taf),1),t[2]||(t[2]=P("br",null,null,-1)),t[3]||(t[3]=P("label",null,"Metar:",-1)),t[4]||(t[4]=Bt()),P("span",null,K(i.attributes.metar),1)]),_:1},8,["layers","currentUrl"]))}}),SRe=["href"],ERe=["src"],TRe={key:1},RRe={key:2},MRe={key:3},kRe={key:4},LRe=["src"],PRe=["href"],GRe=at({__name:"mymaps-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("h4",null,K(r.attributes.sentier),1),r.attributes.image&&r.attributes.image.trim()!==""?(U(),ie("a",{key:0,href:M(D5)(r.attributes.image),target:"_blank"},[r.attributes.thumbnail&&r.attributes.thumbnail.trim()!==""?(U(),ie("img",{key:0,src:M(D5)(r.attributes.thumbnail)},null,8,ERe)):Le("",!0)],8,SRe)):Le("",!0),i[5]||(i[5]=P("br",null,null,-1)),r.attributes.sentier?(U(),ie("span",TRe,[P("span",null,K(M(e)("sentier")),1),Bt(" : "+K(r.attributes.sentier),1),i[1]||(i[1]=P("br",null,null,-1))])):Le("",!0),r.attributes.name?(U(),ie("span",RRe,[P("span",null,K(M(e)("Name")),1),Bt(" : "+K(r.attributes.name),1),i[2]||(i[2]=P("br",null,null,-1))])):Le("",!0),r.attributes.description?(U(),ie("span",MRe,[P("span",null,K(M(e)("Description")),1),Bt(" : "+K(r.attributes.description),1),i[3]||(i[3]=P("br",null,null,-1))])):Le("",!0),r.attributes.length?(U(),ie("span",kRe,[P("span",null,K(M(e)("Longeueur")),1),Bt(" : "+K(r.attributes.length)+" Km",1),i[4]||(i[4]=P("br",null,null,-1))])):Le("",!0),mt(ud,{feature:r,onExport:i[0]||(i[0]=o=>t.$emit("export",o))},null,8,["feature"]),P("img",{src:M(jye)(r.attributes.map_id)},null,8,LRe),i[6]||(i[6]=P("br",null,null,-1)),P("a",{class:"fid-link no-print",href:`?map_id=${r.attributes.map_id}`,target:"_blank"},K(M(e)("Lien vers la carte")),9,PRe),i[7]||(i[7]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),FRe=["onClick"],ORe=at({__name:"mo-template",props:{layers:{},currentUrl:{}},setup(n){const{addNotification:e}=Qr(),t="https://shop.geoportail.lu",i=void 0,{t:r}=St(),o=function(l){for(var u=l+"=",h=document.cookie.split(";"),d=0;d<h.length;d++){for(var m=h[d];m.charAt(0)==" ";)m=m.substring(1);if(m.indexOf(u)==0){var y=m.substring(u.length,m.length);return y.indexOf('"')===0&&(y=y.substring(1,y.length-1)),y}}return""},s=async function(l,u){const m=`${location.search.includes("ipv6=true")?i:t}/Portail/commande/webservices/orderAffaireV3.jsp?numCommune=${encodeURIComponent(l)}&numMesurage=${encodeURIComponent(u)}&ticket=${encodeURIComponent(o("appAuthtktCookieName"))}`;try{const y=await fetch(m,{method:"GET",headers:{"Content-Type":"application/json"}});y.ok?(await y.json(),e(r("Fichier GML command."),ii.INFO)):e(r("Erreur lors de la commande du fichier."),ii.ERROR)}catch{e(r("Erreur lors de la commande du fichier."),ii.ERROR)}};return(l,u)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:h})=>[P("h3",null,K(h.attributes.K_MEASUREMENTID),1),P("span",null,K(M(r)("Affaire")),1),Bt(" : "+K(h.attributes.K_MEASUREMENTID),1),u[0]||(u[0]=P("br",null,null,-1)),P("span",null,K(M(r)("Commune administrative")),1),Bt(" : "+K(h.attributes.K_NOM_COMMUNE_ADMINISTRATIVE),1),u[1]||(u[1]=P("br",null,null,-1)),P("span",null,K(M(r)("Commune cadastrale")),1),Bt(" : "+K(h.attributes.K_NOM_COMMUNE_CADASTRALE),1),u[2]||(u[2]=P("br",null,null,-1)),P("span",null,K(M(r)("Mesurage")),1),Bt(" : "+K(h.attributes.K_MEASUREMENTNUMBER),1),u[3]||(u[3]=P("br",null,null,-1)),P("button",{class:"lux-btn-grey",onClick:d=>s(h.attributes.K_KATASTERGEMEINDE,h.attributes.K_MEASUREMENTNUMBER)},K(M(r)("Commander fichier GML")),9,FRe)]),_:1},8,["layers","currentUrl"]))}}),NRe={key:0},DRe=["href"],VRe={key:1},BRe=at({__name:"ng95-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St(),t="https://migration.geoportail.lu/downloadsketch";return(i,r)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:o})=>[P("h4",null,K(M(e)(o.attributes.nom)),1),P("span",null,K(M(e)("Elevation")),1),Bt(" : "+K(o.attributes.nouv_cote),1),r[0]||(r[0]=P("br",null,null,-1)),P("span",null,K(M(e)("Type")),1),Bt(" : "+K(o.attributes.type_rivet),1),r[1]||(r[1]=P("br",null,null,-1)),P("span",null,K(M(e)("Croquis")),1),r[2]||(r[2]=Bt(" : ",-1)),o.attributes.has_sketch?(U(),ie("span",NRe,[P("a",{class:"no-print",target:"_blank",download:"",href:`${M(t)}?name=${o.attributes.nom_croq}`},K(M(e)("Obtenir le fichier sous format pdf")),9,DRe)])):Le("",!0),o.attributes.has_sketch?Le("",!0):(U(),ie("span",VRe,K(M(e)("Croquis indisponible")),1))]),_:1},8,["layers","currentUrl"]))}}),ZRe={key:0},WRe=["href"],zRe={key:1},URe=at({__name:"ng95-new-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St(),t="https://migration.geoportail.lu/downloadsketch";return(i,r)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:o})=>[P("h4",null,K(M(e)(o.attributes.Nom)),1),P("span",null,K(M(e)("Elevation")),1),Bt(" : "+K(o.attributes["nouv. cote"]),1),r[0]||(r[0]=P("br",null,null,-1)),P("span",null,K(M(e)("Type")),1),Bt(" : "+K(o.attributes["type rivet"]),1),r[1]||(r[1]=P("br",null,null,-1)),P("span",null,K(M(e)("Croquis")),1),r[2]||(r[2]=Bt(" : ",-1)),o.attributes.has_sketch?(U(),ie("span",ZRe,[P("a",{class:"no-print",target:"_blank",download:"",href:`${M(t)}?id=${o.attributes.OBJECTID}&type=new`},K(M(e)("Obtenir le fichier sous format pdf")),9,WRe)])):Le("",!0),o.attributes.has_sketch?Le("",!0):(U(),ie("span",zRe,K(M(e)("Croquis indisponible")),1))]),_:1},8,["layers","currentUrl"]))}}),XRe={key:0},YRe={key:1},HRe={key:2},KRe={key:3},jRe={key:4},$Re={key:5},JRe={key:6},qRe={key:7},QRe={key:8},eMe={key:9},tMe={key:10},nMe={key:11},iMe={key:12},rMe={key:13},sMe={key:14},oMe={key:15},aMe={key:16},lMe={key:17},uMe={key:18},cMe=["href"],hMe={key:19},dMe=["href"],fMe={key:20},pMe=["href"],gMe={key:21},mMe=["href"],yMe={key:22},_Me=["src"],vMe={key:23},bMe=at({__name:"npour-poi-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=St(),{i18next:t}=St();return(i,r)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:o})=>[M(t).language=="de"&&M(Ri)("title_de",o,0)?(U(),ie("h3",XRe,K(o.attributes.title_de),1)):Le("",!0),M(t).language=="en"&&M(Ri)("title_en",o,0)?(U(),ie("h3",YRe,K(o.attributes.title_en),1)):Le("",!0),M(t).language=="lb"&&M(Ri)("title_nl",o,0)?(U(),ie("h3",HRe,K(o.attributes.title_nl),1)):Le("",!0),M(t).language=="fr"&&M(Ri)("title_fr",o,0)?(U(),ie("h3",KRe,K(o.attributes.title_fr),1)):Le("",!0),M(t).language=="de"&&M(Ri)("nom_de",o,0)?(U(),ie("h3",jRe,K(o.attributes.nom_de),1)):Le("",!0),M(t).language=="fr"&&M(Ri)("nom_fr",o,0)?(U(),ie("h3",$Re,K(o.attributes.nom_fr),1)):Le("",!0),M(t).language=="en"&&M(Ri)("nom_en",o,0)?(U(),ie("h3",JRe,K(o.attributes.nom_en),1)):Le("",!0),M(t).language=="lb"&&M(Ri)("nom_lu",o,0)?(U(),ie("h3",qRe,K(o.attributes.nom_lu),1)):Le("",!0),M(t).language=="de"&&M(Ri)("descr_de",o,0)?(U(),ie("span",QRe,K(o.attributes.descr_de),1)):Le("",!0),M(t).language=="fr"&&M(Ri)("descr_fr",o,0)?(U(),ie("span",eMe,K(o.attributes.descr_fr),1)):Le("",!0),M(t).language=="en"&&M(Ri)("descr_en",o,0)?(U(),ie("span",tMe,K(o.attributes.descr_en),1)):Le("",!0),M(t).language=="lb"&&M(Ri)("descr_nl",o,0)?(U(),ie("span",nMe,K(o.attributes.descr_nl),1)):Le("",!0),M(Ri)("number",o,0)?(U(),ie("span",iMe,K(o.attributes.number)+",",1)):Le("",!0),M(Ri)("street",o,0)?(U(),ie("span",rMe,K(o.attributes.street),1)):Le("",!0),M(Ri)("town",o,0)?(U(),ie("span",sMe,K(o.attributes.zip)+" "+K(o.attributes.town),1)):Le("",!0),M(Ri)("phone",o,1)?(U(),ie("span",oMe,[r[1]||(r[1]=P("i",{class:"fa fa-phone","aria-hidden":"true"},null,-1)),P("span",null,K(o.attributes.phone),1)])):Le("",!0),M(Ri)("fax",o,1)?(U(),ie("span",aMe,[r[2]||(r[2]=P("i",{class:"fa fa-fax","aria-hidden":"true"},null,-1)),P("span",null,K(o.attributes.fax),1)])):Le("",!0),M(Ri)("email",o,1)?(U(),ie("span",lMe,[r[3]||(r[3]=P("i",{class:"fa fa-at","aria-hidden":"true"},null,-1)),P("span",null,K(o.attributes.email),1)])):Le("",!0),M(Ri)("website",o,3)&&o.attributes.website.startsWith("http")?(U(),ie("span",uMe,[P("a",{target:"_blank",href:o.attributes.website},K(o.attributes.website),9,cMe)])):Le("",!0),M(Ri)("website",o,3)&&!o.attributes.website.startsWith("http")?(U(),ie("span",hMe,[P("a",{target:"_blank",href:"http://"+o.attributes.website},K(o.attributes.website),9,dMe)])):Le("",!0),M(t).language!="fr"&&M(Ri)("link_de",o,3)?(U(),ie("span",fMe,[P("a",{target:"_blank",href:o.attributes.link_de},K(o.attributes.link_de),9,pMe)])):Le("",!0),M(t).language=="fr"&&M(Ri)("link_fr",o,3)?(U(),ie("span",gMe,[P("a",{target:"_blank",href:o.attributes.link_fr},K(o.attributes.link_fr),9,mMe)])):Le("",!0),M(Ri)("Bild",o,3)?(U(),ie("span",yMe,[P("img",{src:o.attributes.Bild,width:"250"},null,8,_Me)])):Le("",!0),M(Ri)("longueur sentier",o,0)?(U(),ie("div",vMe,[P("span",null,K(M(e)("Longueur du sentier :")),1),P("span",null,K(o.attributes["longueur sentier"]),1)])):Le("",!0),mt(ud,{feature:o,onExport:r[0]||(r[0]=s=>i.$emit("export",s))},null,8,["feature"])]),_:1},8,["layers","currentUrl"]))}}),xMe=es(bMe,[["__scopeId","data-v-e980fdd2"]]),IMe={key:0},CMe={key:1},wMe={key:2},AMe={key:3},SMe={key:4},EMe={key:5},TMe={key:6},RMe={key:7},MMe={key:8},kMe={key:9},LMe={key:10},PMe={key:11},GMe={key:12},FMe=["href"],OMe={key:13},NMe=["href"],DMe={key:14},VMe=["src"],BMe={key:15},ZMe=at({__name:"npour-wo-address-poi-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=St(),{i18next:t}=St();return(i,r)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:o})=>[M(t).language=="de"&&M(Ri)("title_de",o,0)?(U(),ie("h3",IMe,K(o.attributes.title_de),1)):Le("",!0),M(t).language=="en"&&M(Ri)("title_en",o,0)?(U(),ie("h3",CMe,K(o.attributes.title_en),1)):Le("",!0),M(t).language=="lb"&&M(Ri)("title_nl",o,0)?(U(),ie("h3",wMe,K(o.attributes.title_nl),1)):Le("",!0),M(t).language=="fr"&&M(Ri)("title_fr",o,0)?(U(),ie("h3",AMe,K(o.attributes.title_fr),1)):Le("",!0),M(t).language=="de"&&M(Ri)("nom_de",o,0)?(U(),ie("h3",SMe,K(o.attributes.nom_de),1)):Le("",!0),M(t).language=="fr"&&M(Ri)("nom_fr",o,0)?(U(),ie("h3",EMe,K(o.attributes.nom_fr),1)):Le("",!0),M(t).language=="en"&&M(Ri)("nom_en",o,0)?(U(),ie("h3",TMe,K(o.attributes.nom_en),1)):Le("",!0),M(t).language=="lb"&&M(Ri)("nom_lu",o,0)?(U(),ie("h3",RMe,K(o.attributes.nom_lu),1)):Le("",!0),M(t).language=="de"&&M(Ri)("descr_de",o,0)?(U(),ie("span",MMe,K(o.attributes.descr_de),1)):Le("",!0),M(t).language=="fr"&&M(Ri)("descr_fr",o,0)?(U(),ie("span",kMe,K(o.attributes.descr_fr),1)):Le("",!0),M(t).language=="en"&&M(Ri)("descr_en",o,0)?(U(),ie("span",LMe,K(o.attributes.descr_en),1)):Le("",!0),M(t).language=="lb"&&M(Ri)("descr_nl",o,0)?(U(),ie("span",PMe,K(o.attributes.descr_nl),1)):Le("",!0),M(t).language!="fr"&&M(Ri)("link_de",o,3)?(U(),ie("span",GMe,[P("a",{target:"_blank",href:o.attributes.link_de},K(o.attributes.link_de),9,FMe)])):Le("",!0),M(t).language=="fr"&&M(Ri)("link_fr",o,3)?(U(),ie("span",OMe,[P("a",{target:"_blank",href:o.attributes.link_fr},K(o.attributes.link_fr),9,NMe)])):Le("",!0),M(Ri)("Bild",o,3)?(U(),ie("span",DMe,[P("img",{src:o.attributes.Bild,width:"250"},null,8,VMe)])):Le("",!0),M(Ri)("longueur sentier",o,0)?(U(),ie("div",BMe,[P("span",null,K(M(e)("Longueur du sentier :")),1),P("span",null,K(o.attributes["longueur sentier"]),1)])):Le("",!0)]),_:1},8,["layers","currentUrl"]))}}),WMe=es(ZMe,[["__scopeId","data-v-83fc1248"]]),zMe=["href"],UMe={key:1},XMe=["href"],YMe=at({__name:"pcn-pag-template",props:{layers:{},currentUrl:{}},setup(n){const e="https://migration.geoportail.lu/pagreport",{t}=St();return(i,r)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"layer-content":Wt(()=>[n.layers.features.length?(U(),ie("a",{key:0,class:"lux-btn",download:"",href:`${M(e)}/${M(PEe)(n.layers.features,"OBJECTID",",")}.pdf`,target:"_blank"},K(M(t)("Generer un rapport pour toutes les selections")),9,zMe)):(U(),ie("span",UMe,K(M(t)("Aucune information disponible pour cette couche")),1))]),"feature-content":Wt(({feature:o})=>[P("span",null,K(M(t)("Identifiant")),1),Bt(" : "+K(o.attributes.OBJECTID),1),r[0]||(r[0]=P("br",null,null,-1)),P("a",{class:"lux-btn",download:"",href:`${M(e)}/${o.attributes.OBJECTID}.pdf`,target:"_blank"},K(M(t)("Generer Rapport (peut prendre 30 sec)")),9,XMe)]),_:1},8,["layers","currentUrl"]))}}),HMe={class:"lux-poi-title"},KMe={class:"lux-feature-info"},jMe={class:"poi-feature"},$Me={class:"pag-form-container"},JMe={class:"pag-mail"},qMe={class:"pag-checkbox"},QMe=["innerHTML"],eke=at({__name:"pag-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{authenticated:e,currentUser:t}=It(iu()),r=n.layers,{addNotification:o}=Qr(),s=Ue(""),l=Ct(()=>e.value&&t.value?.mail||"");s.value=l.value;const u=Ue(!1),{t:h}=St(),d="https://migration.geoportail.lu/pag";function m(x,C,w){return x.map(function(E){return E.attributes[C]}).join(w)}async function y(){if(!s.value&&!/^\S+@\S+\.\S+$/.test(s.value)){o(h("Veuillez saisir une adresse email valide"),ii.WARNING);return}if(!u.value){o(h("Veuillez accepter les termes du rapport"),ii.WARNING);return}const x=new URLSearchParams({email:s.value,staging:"false"});fetch(d+"/report/"+m(r.features,"OBJECTID",",")+".pdf",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:x}),o(h("Votre rapport est en train d'tre gnr. Un email vous sera envoy  l'adresse {{email}} ds qu'il sera disponible",{email:s.value,ns:"client"}),ii.INFO)}return(x,C)=>(U(),ie(Mt,null,[P("h1",HMe,K(M(h)(M(r).layerLabel)),1),P("div",KMe,[P("div",jMe,[P("label",null,K(M(h)("Ici vous pouvez commander le rapport relatif aux rgles urbanistiques applicables au terrain sctionn")),1),C[3]||(C[3]=P("br",null,null,-1)),C[4]||(C[4]=P("br",null,null,-1)),P("div",$Me,[P("div",JMe,[P("label",null,K(M(h)("Adresse Email")),1),An(P("input",{type:"text","onUpdate:modelValue":C[0]||(C[0]=w=>s.value=w),style:{width:"165px"}},null,512),[[Or,s.value]])]),P("div",qMe,[An(P("input",{type:"checkbox","onUpdate:modelValue":C[1]||(C[1]=w=>u.value=w),id:"terms"},null,512),[[Hh,u.value]]),P("label",{for:"terms",innerHTML:M(h)("En cochant cette case, l'utilisateur dclare avoir lu, compris et accept les <a target='_blank' rel='noopener noreferrer' href='https://files.geoportail.lu/pag/Disclaimer.pdf'>conditions gnrales d'utilisation </a>de ce site web")},null,8,QMe)])]),P("button",{class:"lux-btn-grey",onClick:C[2]||(C[2]=w=>y()),target:"_blank"},K(M(h)("Commander rapport")),1)])])],64))}}),tke=es(eke,[["__scopeId","data-v-d5f704f5"]]),nke={class:"lux-poi-title"},ike={class:"lux-feature-info"},rke={class:"poi-feature"},ske={class:"pag-form-container"},oke={class:"pag-mail"},ake={class:"pag-checkbox"},lke=["innerHTML"],uke=at({__name:"pag-staging-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{authenticated:e,currentUser:t}=It(iu()),r=n.layers,{addNotification:o}=Qr(),s=Ue(""),l=Ct(()=>e.value&&t.value?.mail||"");s.value=l.value;const u=Ue(!1),{t:h}=St(),d="https://migration.geoportail.lu/pag";function m(x,C,w){return x.map(function(E){return E.attributes[C]}).join(w)}async function y(){if(!s.value&&!/^\S+@\S+\.\S+$/.test(s.value)){o(h("Veuillez saisir une adresse email valide"),ii.WARNING);return}if(!u.value){o(h("Veuillez accepter les termes du rapport"),ii.WARNING);return}const x=new URLSearchParams({email:s.value,staging:"true"});fetch(d+"/report/"+m(r.features,"OBJECTID",",")+".pdf",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:x}),o(h("Votre rapport est en train d'tre gnr. Un email vous sera envoy  l'adresse {{email}} ds qu'il sera disponible",{email:s.value,ns:"client"}),ii.INFO)}return(x,C)=>(U(),ie(Mt,null,[P("h1",nke,K(M(h)(M(r).layerLabel)),1),P("div",ike,[P("div",rke,[P("label",null,K(M(h)("Ici vous pouvez commander le rapport relatif aux rgles urbanistiques applicables au terrain sctionn")),1),C[3]||(C[3]=P("br",null,null,-1)),C[4]||(C[4]=P("br",null,null,-1)),P("div",ske,[P("div",oke,[P("label",null,K(M(h)("Adresse Email")),1),An(P("input",{type:"text","onUpdate:modelValue":C[0]||(C[0]=w=>s.value=w),style:{width:"165px"}},null,512),[[Or,s.value]])]),P("div",ake,[An(P("input",{type:"checkbox","onUpdate:modelValue":C[1]||(C[1]=w=>u.value=w),id:"terms"},null,512),[[Hh,u.value]]),P("label",{for:"terms",innerHTML:M(h)("En cochant cette case, l'utilisateur dclare avoir lu, compris et accept les <a target='_blank' rel='noopener noreferrer' href='https://files.geoportail.lu/pag/Disclaimer.pdf'>conditions gnrales d'utilisation </a>de ce site web")},null,8,lke)])]),P("button",{class:"lux-btn-grey",onClick:C[2]||(C[2]=w=>y()),target:"_blank"},K(M(h)("Commander rapport")),1)])])],64))}}),cke=es(uke,[["__scopeId","data-v-5ecbf7b0"]]),hke={class:"lux-poi-title"},dke={class:"lux-feature-info"},fke={class:"poi-feature"},pke={class:"pds-form-container"},gke={class:"pds-mail"},mke=at({__name:"pds-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{authenticated:e,currentUser:t}=It(iu()),r=n.layers,{addNotification:o}=Qr(),s=Ue(""),l=Ct(()=>e.value&&t.value?.mail||"");s.value=l.value;const{t:u}=St(),h="https://migration.geoportail.lu/pds";function d(y,x,C){return y.map(function(w){return w.attributes[x]}).join(C)}async function m(){if(!s.value&&!/^\S+@\S+\.\S+$/.test(s.value)){o(u("Veuillez saisir une adresse email valide"),ii.WARNING);return}const y=new URLSearchParams({email:s.value,staging:"false"});fetch(h+"/report/"+d(r.features,"textstring",",")+".pdf",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:y}),o(u("Votre attestation est en train d'tre gnr. Un email vous sera envoy  l'adresse {{email}} ds qu'il sera disponible",{email:s.value,ns:"client"}),ii.INFO)}return(y,x)=>(U(),ie(Mt,null,[P("h1",hke,K(M(u)(M(r).layerLabel)),1),P("div",dke,[P("div",fke,[P("label",null,K(M(u)(`Ici vous pouvez commander l'attestation "plans directeurs sectoriels" par rapport au terrain sctionn`)),1),x[2]||(x[2]=P("br",null,null,-1)),x[3]||(x[3]=P("br",null,null,-1)),P("div",pke,[P("div",gke,[P("label",null,K(M(u)("Adresse Email")),1),An(P("input",{type:"text","onUpdate:modelValue":x[0]||(x[0]=C=>s.value=C),style:{width:"165px"}},null,512),[[Or,s.value]])])]),P("button",{class:"lux-btn-grey",onClick:x[1]||(x[1]=C=>m()),target:"_blank"},K(M(u)("Commander rapport")),1)])])],64))}}),yke=es(mke,[["__scopeId","data-v-eadcbafd"]]),_ke=["src"],vke=at({__name:"pegel-template",props:{layers:{},currentUrl:{}},setup(n){return(e,t)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:i})=>[P("h3",null,K(i.attributes.Nom),1),P("iframe",{width:"300",height:"1500",frameborder:"0",src:M(Pz)("http://geoportail.eau.etat.lu/pdf/112/"+i.attributes.Nom+".html")},null,8,_ke)]),_:1},8,["layers","currentUrl"]))}}),bke=at({__name:"remembrements-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("span",null,K(M(e)("Nom")),1),Bt(" : "+K(r.attributes.K_NAME),1),i[0]||(i[0]=P("br",null,null,-1)),P("span",null,K(M(e)("Statut")),1),i[1]||(i[1]=Bt(" : ",-1)),P("span",null,K(M(e)("rem_status_"+r.attributes.K_STATUS)),1),i[2]||(i[2]=P("br",null,null,-1)),P("span",null,K(M(e)("Type")),1),i[3]||(i[3]=Bt(" : ",-1)),P("span",null,K(M(e)("rem_typ_"+r.attributes.K_TYP)),1)]),_:1},8,["layers","currentUrl"]))}}),xke={key:0,class:"my-3"},Ike=["href"],Cke={key:1},wke=at({__name:"sentier-nature-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const e=n,t="https://migration.geoportail.lu/downloadresource",{t:i}=St();function r(o){return`${e.currentUrl}&fid=${e.layers.layer}_${o.attributes.id_qr}`}return(o,s)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl,getDirectLink:r},{"feature-content":Wt(({feature:l})=>[P("h4",null,K(l.attributes.sentier),1),M(If)(l)?(U(),ie(Mt,{key:0},[P("div",null,[P("label",null,K(M(i)("Longueur du parcours")),1),s[1]||(s[1]=Bt(" : ",-1)),P("span",null,K(l.attributes.formatted_length),1),l.attributes.link?(U(),ie("div",xke,[P("a",{class:"lux-btn py-2",href:`${M(t)}?fid=${n.layers.layer}_${l.attributes.objectid}&attribute=link&id_attribute=objectid`,target:"_blank"},K(M(i)("Tlcharger la brochure")),9,Ike)])):Le("",!0)]),mt(ud,{feature:l,onExport:s[0]||(s[0]=u=>o.$emit("export",u))},null,8,["feature"])],64)):(U(),ie("div",Cke,K(M(i)("Aucune information disponible pour cette couche")),1))]),_:1},8,["layers","currentUrl"]))}}),Ake={class:"text-white text-3xl"},Ske=["href"],Eke=["src"],Tke=at({__name:"urplang-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("h2",Ake,K(r.attributes.nom_commune)+" "+K(r.attributes.section)+" "+K(r.attributes.feuille),1),r.attributes.thumb?(U(),ie(Mt,{key:0},[P("a",{href:r.attributes.path,target:"_blank"},[P("img",{src:r.attributes.thumb,width:"250"},null,8,Eke)],8,Ske),P("span",null,K(M(e)("Cliquez dans l'image pour agrandir")),1)],64)):Le("",!0)]),_:1},8,["layers","currentUrl"]))}}),Rke=at({__name:"viti-flik",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("span",null,K(M(e)("Numero FLIK")),1),Bt(" : "+K(r.attributes.CODE_ELEM)+K(r.attributes.FLIK),1),i[0]||(i[0]=P("br",null,null,-1)),P("span",null,K(M(e)("Commune cadastrale")),1),Bt(" : "+K(r.attributes.CODE_COM),1),i[1]||(i[1]=P("br",null,null,-1)),P("span",null,K(M(e)("Section cadastrale")),1),Bt(" : "+K(r.attributes.CODE_SECT),1),i[2]||(i[2]=P("br",null,null,-1)),P("span",null,K(M(e)("Surface")),1),Bt(" : "+K(r.attributes.F_Area_2021)+" a ",1)]),_:1},8,["layers","currentUrl"]))}}),Mke=at({__name:"viti-kleinlage",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("span",null,K(M(e)("Nom")),1),Bt(" : "+K(r.attributes.kleinlage),1)]),_:1},8,["layers","currentUrl"]))}}),kke=at({__name:"viti-name",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("span",null,K(M(e)("Nom")),1),Bt(" : "+K(r.attributes.grosslage),1)]),_:1},8,["layers","currentUrl"]))}}),Lke=at({__name:"viti-parcels",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=St();return(t,i)=>(U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:r})=>[P("span",null,K(M(e)("Numero")),1),Bt(" : V"+K(r.attributes.Weinbergsn),1),i[0]||(i[0]=P("br",null,null,-1)),P("span",null,K(M(e)("Commune")),1),Bt(" : "+K(r.attributes.CODE_COM),1),i[1]||(i[1]=P("br",null,null,-1)),P("span",null,K(M(e)("Section")),1),Bt(" : "+K(r.attributes.CODE_SECT),1),i[2]||(i[2]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),Pke={key:0,class:"mt-2 mb-3"},Gke=["src"],Fke={class:"flex flex-row justify-end"},Oke=["href"],Nke=["href"],Dke=at({__name:"info-feature-measurement-modale",props:{measurement:{}},setup(n){const e=n,t="https://migration.geoportail.lu/previewmeasurement",i="https://migration.geoportail.lu/downloadmeasurement",{t:r,i18next:o}=St(),s=Ct(()=>ey.sanitizeUrl(t+"?document_id="+e.measurement.document_id));return(l,u)=>n.measurement?(U(),Gt(kf,{key:0,footer:!0,"max-height":!0,title:M(r)("Prvisualisation du mesurage"),onClose:u[1]||(u[1]=h=>l.$emit("close"))},{content:Wt(()=>[n.measurement.isDownloadable?Le("",!0):(U(),ie("p",Pke,K(M(r)("Pour des raisons de protection de donnes, nous ne pouvons pas afficher les documents de la mensuration officielle en rsolution complte, par contre vous avez la possibilit de les commander de manire individuelle et traable")),1)),s.value?(U(),ie("img",{key:1,src:s.value},null,8,Gke)):Le("",!0)]),footer:Wt(()=>[P("div",Fke,[P("button",{type:"button",class:"lux-btn","data-dismiss":"modal",onClick:u[0]||(u[0]=h=>l.$emit("close"))},K(M(r)("Annuler")),1),n.measurement.is_downloadable?(U(),ie("a",{key:1,class:"lux-btn ml-3",target:"_blank",href:`${M(i)}?document_id=${n.measurement.document_id}`},K(M(r)("Tlcharger")),9,Nke)):(U(),ie("a",{key:0,class:"lux-btn ml-3",target:"_blank",href:`https://commande.geoportail.lu?&camefrom=mapv3&lang=${M(o).language}&documents=MESURAGE;EXTRAIT_MIXTE&ids=['${n.measurement.parcelId}']&remark=${n.measurement.description}`},K(M(r)("Commander")),9,Oke))])]),_:1},8,["title"])):Le("",!0)}}),Vke={key:0},Bke={key:0,class:"flex"},Zke={key:1,class:"flex"},Wke={class:"flex"},zke={key:2},Uke=["href"],Xke={key:3},Yke=["href"],Hke={class:"list-disc pl-6"},Kke=["onClick"],jke=["href"],$ke=["href"],Jke=["href"],qke=at({__name:"parcels-template",props:{layers:{},currentUrl:{}},setup(n){const e="https://migration.geoportail.lu/downloadmeasurement",{t}=St(),i=Ue();function r(s){i.value=s}function o(){i.value=void 0}return(s,l)=>(U(),ie(Mt,null,[i.value?(U(),Gt(Dke,{key:0,measurement:i.value,onClose:o},null,8,["measurement"])):Le("",!0),mt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:u})=>[u.attributes.PF?(U(),ie(Mt,{key:1},[P("h2",null,K(u.attributes.PF.mainNumber)+"/"+K(u.attributes.PF.additionalNumber),1),P("span",null,K(M(t)("Commune")),1),Bt(" : "+K(u.attributes.PF.townName),1),l[1]||(l[1]=P("br",null,null,-1)),P("span",null,K(M(t)("Section")),1),Bt(" : "+K(u.attributes.PF.sectionDesignation),1),l[2]||(l[2]=P("br",null,null,-1)),P("span",null,K(M(t)("Numero cadastral")),1),Bt(" : "+K(u.attributes.PF.mainNumber)+"/"+K(u.attributes.PF.additionalNumber),1),l[3]||(l[3]=P("br",null,null,-1)),P("span",null,K(M(t)("Contenance")),1),Bt(" : "+K(u.attributes.PF.capacity),1),l[4]||(l[4]=P("br",null,null,-1)),P("span",null,K(M(t)("Lieudit")),1),Bt(" : "+K(u.attributes.PF.locality),1),l[5]||(l[5]=P("br",null,null,-1)),u.attributes.PF.farmingTypes&&Object.keys(u.attributes.PF.farmingTypes).length>0?(U(),ie("div",Bke,[P("span",null,K(M(t)("Nature")),1),Bt(" : "+K(M(C3)(u.attributes.PF.farmingTypes,"pf")),1)])):Le("",!0),u.attributes.PF.occupations&&Object.keys(u.attributes.PF.occupations).length>0?(U(),ie("div",Zke,[P("span",null,K(M(t)("Occupation")),1),Bt(" : "+K(M(C3)(u.attributes.PF.occupations,"pf")),1)])):Le("",!0),P("div",Wke,[P("span",null,K(M(t)("Dernier mesurage")),1),Bt(" : "+K(u.attributes.PF.measurementNumber),1)]),M(rI)("go")?(U(),ie("div",zke,[P("a",{class:"lux-btn inline-block mb-1",href:`https://shop.geoportail.lu/Portail/express_mesurage/?ids=['${u.attributes.textstring}']&camefrom=mapv3_go&lang=${M(Wn).language}`,target:"_blank"},K(M(t)("Constitution de dossier de mesurage")),9,Uke)])):Le("",!0),M(rI)("go")||M(rI)("prof")||M(rI)("municipalities")?(U(),ie("div",Xke,[P("a",{class:"lux-btn inline-block mb-1",href:`https://xxpfo.intranet.etat.lu/xxpfoi/detail_parcelle.do?noParcelle=${u.attributes.textstring}`,target:"_blank"},K(M(t)("Ouvrir la PF")),9,Yke)])):Le("",!0),P("span",null,K(M(t)("Lien vers les mesurages")),1),l[6]||(l[6]=Bt(" : ",-1)),P("ul",Hke,[(U(!0),ie(Mt,null,hi(u.attributes.measurements,h=>(U(),ie("li",{key:h.measurementNumber},[h.document_id?(U(),ie(Mt,{key:0},[P("a",{class:"cursor-pointer",target:"_blank",onClick:d=>r(h)},"No "+K(h.measurementNumber)+" "+K(M(t)("MESURAGE_"+h.description))+" "+K(M(TM)(h.date_document)),9,Kke),h.is_downloadable?(U(),ie("a",{key:0,target:"_blank",href:`${M(e)}?document_id=${h.document_id}`},[...l[0]||(l[0]=[P("i",{class:"fa fa-download","aria-hidden":"true"},null,-1)])],8,jke)):Le("",!0)],64)):(U(),ie(Mt,{key:1},[P("span",null,K(M(t)("Mesurage non disponible")),1),Bt(" : "+K(h.measurementNumber),1)],64))]))),128))]),P("a",{class:"lux-btn inline-block mb-1",href:`https://historique.geoportail.lu/?id=${u.attributes.textstring}`,target:"_blank"},K(M(t)("Historique de la parcelle")),9,$ke),P("a",{class:"lux-btn inline-block mb-1",href:`https://commande.geoportail.lu/?ids=['${u.attributes.textstring}']&camefrom=mapv3&lang=${M(Wn).language}`,target:"_blank"},K(M(t)("Commander un extrait")),9,Jke)],64)):(U(),ie("div",Vke,K(M(t)("No parcel data available")),1))]),_:1},8,["layers","currentUrl"])],64))}}),vE=es(qke,[["__scopeId","data-v-54005743"]]),Qke={key:0},eLe={key:0},tLe={key:0},nLe={key:1},iLe=["href"],rLe={key:1},sLe={key:0,class:"ng-hide"},oLe=["href"],aLe={key:0},lLe={key:2},uLe=at({__name:"default-attachment-no-prefix-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const e="https://migration.geoportail.lu/downloadpdf",{t}=St();return(i,r)=>{const o=kl("dompurify-html");return U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:s})=>[s.attributes.label?(U(),ie("h4",Qke,K(M(t)(s.attributes.label)),1)):Le("",!0),M(If)(s)?(U(),ie(Mt,{key:1},[(U(!0),ie(Mt,null,hi(M(i_)(s.attributes,n.layers.ordered,""),l=>(U(),ie("div",{key:l.key},[!["has_sketch","sketches"].includes(l.key)&&!M(ug)(l.value)&&M(Vb)(l,n.layers.layer,M(Wn).language)?(U(),ie("span",eLe,[M(Fo)(l.value)?Le("",!0):(U(),ie("div",tLe,[P("label",null,K(M(t)(l.key))+" : ",1),An(P("span",null,null,512),[[o,l.value]])])),M(Fo)(l.value)?(U(),ie("div",nLe,[r[1]||(r[1]=P("label",null,null,-1)),P("a",{href:l.value,target:"_blank"},K(M(t)(l.key)),9,iLe)])):Le("",!0)])):["sketches"].includes(l.key)?(U(),ie("span",rLe,[P("label",null,K(M(t)("Attachment"))+" : ",1),s.attributes.has_sketch?(U(),ie("span",sLe,[P("ul",null,[(U(!0),ie(Mt,null,hi(s.attributes.sketches,u=>(U(),ie("li",{key:u.id},[P("a",{class:"no-print",target:"_blank",download:"",href:`${M(e)}?fid=${s.fid}&sketch_id=${u.id}`},K(M(t)(u.name)),9,oLe)]))),128))])])):Le("",!0)])):Le("",!0)]))),128)),n.layers.has_profile?(U(),ie("div",aLe,[mt(ud,{feature:s,onExport:r[0]||(r[0]=l=>i.$emit("export",l))},null,8,["feature"])])):Le("",!0)],64)):(U(),ie("div",lLe,[P("span",null,K(M(t)("Aucune information disponible pour cette couche")),1)]))]),_:1},8,["layers","currentUrl"])}}}),cLe={key:0},hLe={key:0},dLe={key:0},fLe={key:1},pLe=["href"],gLe={key:1},mLe={key:0,class:"ng-hide"},yLe=["href"],_Le={key:0},vLe={key:2},bLe=at({__name:"default-attachment-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const e="https://migration.geoportail.lu/downloadpdf",{t}=St();return(i,r)=>{const o=kl("dompurify-html");return U(),Gt(ur,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Wt(({feature:s})=>[s.attributes.label?(U(),ie("h4",cLe,K(M(t)(s.attributes.label)),1)):Le("",!0),M(If)(s)?(U(),ie(Mt,{key:1},[(U(!0),ie(Mt,null,hi(M(i_)(s.attributes,n.layers.ordered),l=>(U(),ie("div",{key:l.key},[!["f_has_sketch","f_sketches"].includes(l.key)&&!M(ug)(l.value)&&M(Vb)(l,n.layers.layer,M(Wn).language)?(U(),ie("span",hLe,[M(Fo)(l.value)?Le("",!0):(U(),ie("div",dLe,[P("label",null,K(M(t)(l.key))+" : ",1),An(P("span",null,null,512),[[o,l.value]])])),M(Fo)(l.value)?(U(),ie("div",fLe,[r[1]||(r[1]=P("label",null,null,-1)),P("a",{href:l.value,target:"_blank"},K(M(t)(l.key)),9,pLe)])):Le("",!0)])):["f_sketches"].includes(l.key)?(U(),ie("span",gLe,[P("label",null,K(M(t)("Fichier  tlcharger"))+" : ",1),s.attributes.has_sketch?(U(),ie("span",mLe,[P("ul",null,[(U(!0),ie(Mt,null,hi(s.attributes.sketches,u=>(U(),ie("li",{key:u.id},[P("a",{class:"no-print",target:"_blank",download:"",href:`${M(e)}?fid=${s.fid}&sketch_id=${u.id}`},K(M(t)(u.name)),9,yLe)]))),128))])])):Le("",!0)])):Le("",!0)]))),128)),n.layers.has_profile?(U(),ie("div",_Le,[mt(ud,{feature:s,onExport:r[0]||(r[0]=l=>i.$emit("export",l))},null,8,["feature"])])):Le("",!0)],64)):(U(),ie("div",vLe,[P("span",null,K(M(t)("Aucune information disponible pour cette couche")),1)]))]),_:1},8,["layers","currentUrl"])}}}),xLe=at({__name:"feature-info",props:{content:{type:Array,required:!0}},setup(n){const e=window.location.href,t=Kn().getOlMap(),{featureInfoPrintableRef:i}=It(Vk()),r=h=>i.value=h,o={"adresse.html":NEe,"aero.html":ZEe,"affaires.html":WEe,"asta_esp.html":XEe,"automatic_sols.html":oTe,"batiments.html":aTe,"bus_wo_title.html":uTe,"bus.html":hTe,"casipo.html":bTe,"default.html":w3,"default_attachment.html":bLe,"default_attachment_no_prefix.html":uLe,"default_table.html":KTe,"default_table_no_prefix.html":rRe,"flik.html":sRe,"forage_virtuel.html":dRe,"lignes_bus.html":xRe,"meteo.html":CRe,"meteolux_europe.html":wRe,"meteolux_gr.html":ARe,"mymaps.html":GRe,"mo.html":ORe,"ng95.html":BRe,"ng95_new.html":URe,"npour_poi.html":xMe,"npour_poi_wo_address.html":WMe,"parcels.html":vE,"parcels_prof.html":vE,"parcels_go.html":vE,"pcn_pag.html":YMe,"pag.html":tke,"pag_staging.html":cke,"pds.html":yke,"pegel.html":vke,"remembrements.html":bke,"sentier_nature.html":wke,"urplang.html":Tke,"viti_flik.html":Rke,"viti_kleinlage.html":Mke,"viti_name.html":kke,"viti_parcels.html":Lke},s=h=>o[h]||w3;function l(h){h.feature.attributes&&!h.feature.properties&&(h.feature.properties=h.feature.attributes);const d=new Qa().readFeature(h.feature,{dataProjection:Ml,featureProjection:t.getView().getProjection()});Ob.export(t,h.format,[d],h.feature.attributes.name||h.format,!0)}function u(...h){const[d]=h;l(d)}return(h,d)=>n.content&&n.content.length?(U(),ie("div",{key:0,ref:r,class:"absolute w-11/12"},[(U(!0),ie(Mt,null,hi(n.content,(m,y)=>(U(),Gt(cb(s(m.template)),{key:y,layers:m,currentUrl:M(e),onExport:u},null,40,["layers","currentUrl"]))),128))])):Le("",!0)}}),ILe={key:0,"data-cy":"locationInfo",class:"absolute"},CLe={key:1,class:"text-white absolute"},wLe={class:"flex flex-col gap-3 mr-5 mt-4 italic"},ALe=at({__name:"info-panel",setup(n){const{t:e}=St(),t=Jn(),{locationInfoCoords:i}=It(ag()),r=Kn().olMap,{infoOpen:o}=It(t),{clearContent:s}=rg(),{featureInfoPanelContent:l,isLoading:u}=It(rg());return Pt(o,h=>{h||s()}),(h,d)=>(U(),Gt(Lf,{"data-cy-value":"infoPanel","close-fn":()=>M(t).toggleInfoOpen(!1)},{header:Wt(()=>[P("h1",null,K(M(e)("infos",{ns:"client"})),1)]),content:Wt(()=>[M(r)?An((U(),ie("div",ILe,[mt(g_e)],512)),[[Yp,M(i)]]):Le("",!0),!M(i)&&!M(l)?(U(),ie("div",CLe,[P("ul",wLe,[P("li",null,K(M(e)("A right click (tap and hold on mobile)...",{ns:"app"})),1),P("li",null,K(M(e)("A short click (tap on mobile)...",{ns:"app"})),1)])])):Le("",!0),M(l)&&!M(u)?(U(),Gt(xLe,{key:2,content:M(l)},null,8,["content"])):Le("",!0)]),_:1},8,["close-fn"]))}}),SLe={class:"text-white"},ELe={key:0,class:"small"};const TLe=["checked","onChange"],RLe=at({__name:"lidar-config-panel",setup(n){const e=Jn(),{t,i18next:i}=St(),r=lg(),{drawLidarActive:o,profileWidth:s,measureActive:l}=It(r);function u(G,O){return["fr","en","de","lb"].includes(O)?G[O]:G.en}const h=r.lidarConfig.serverConfig.classification_colors;let d=xz();sr(()=>{d.init()});function m(){d.exportCsv()}function y(){d.exportPng()}function x(){d.exportLas()}function C(){d.resetPlot()}function w(){l.value=!l.value,l.value?E():T()}function E(){d.setMeasureActive()}function T(){l.value=!1,d.clearMeasure()}function k(G){G.visible=(G.visible+1)%2,d.updateData()}return(G,O)=>(U(),Gt(Lf,{"data-cy-value":"lidarPanel","close-fn":()=>M(e).toggleLidarOpen(!1)},{header:Wt(()=>[P("h1",null,K(M(t)("lidar",{ns:"client"})),1)]),content:Wt(()=>[P("div",SLe,[P("p",null,[P("button",{class:Rn(["lux-btn mt-3",{active:M(o)}]),onClick:O[0]||(O[0]=V=>o.value=!M(o))},K(M(t)("Draw a lidar profile")),3)]),P("p",null,[Bt(K(M(t)("Profile width"))+" ",1),An(P("input",{type:"number",min:"0",max:"1000","onUpdate:modelValue":O[1]||(O[1]=V=>Gr(s)?s.value=V:null),style:{width:"5em","margin-right":"1em"}},null,512),[[Or,M(s),void 0,{number:!0}]]),P("button",{class:"lux-btn mt-3",onClick:C},[...O[2]||(O[2]=[P("span",{class:"fa fa-refresh"},null,-1)])])]),M(o)?(U(),ie("p",ELe,[P("em",null,K(M(t)("Draw a line on the map to display the corresponding LIDAR profile. Double clic to confirm.")),1)])):Le("",!0),Le("",!0),O[5]||(O[5]=P("hr",{style:{"margin-top":"10px"}},null,-1)),P("div",null,[P("div",null,K(M(t)("Classes")),1),(U(!0),ie(Mt,null,hi(M(h),(V,z)=>(U(),ie("div",{key:z,class:"checkbox"},[P("label",null,[P("input",{type:"checkbox",checked:V.visible===1,onChange:H=>k(V)},null,40,TLe),P("span",null,K(u(V.name,M(i).language)),1)])]))),128))])])]),_:1},8,["close-fn"]))}}),MLe=es(RLe,[["__scopeId","data-v-4bf93fb6"]]),kLe={class:"feedback-content text-white"},LLe={class:"text-lg font-bold mb-4"},PLe={class:"form-group"},GLe={for:"inputEmail",class:"block mb-2 font-medium"},FLe=["aria-label"],OLe={class:"form-group"},NLe={for:"dropdownLayerPicker",class:"block mb-2 font-medium"},DLe={class:"relative"},VLe=["aria-label"],BLe={value:"",disabled:""},ZLe=["value"],WLe={class:"form-group"},zLe={for:"inputDescription",class:"block mb-2 font-medium"},ULe=["aria-label"],XLe={class:"text-sm text-gray-200 mt-1","aria-live":"polite","aria-atomic":"true",role:"status"},YLe={"aria-live":"assertive","aria-atomic":"true",class:"sr-only"},HLe={key:0},KLe={class:"form-group text-sm"},jLe={class:"mb-2"},$Le=["href"],JLe=["disabled","aria-disabled"],qLe=at({__name:"feedback-panel",setup(n){const e="https://migration.geoportail.lu/feedback",{t}=St(),i=Jn(),r=Ui(),o=iu(),{addNotification:s}=Qr(),{feedbackOpen:l,drawToolbarOpen:u}=It(i),{layers:h,bgLayer:d}=It(r),{authenticated:m,currentUser:y}=It(o),x=Ue(""),C=Ue(""),w=Ue(""),E=Ue(""),T=Ue(!1);Pt(l,z=>{z&&(m.value&&y.value?.mail?x.value=y.value.mail:x.value="",w.value="",C.value="",k(),no(()=>{document.getElementById("inputEmail")?.focus()}))},{immediate:!0});function k(){E.value=Ql.getStrippedUrl().toString()}function G(){u.value=!0}async function O(){if(!x.value||!C.value||!w.value){s(t("Please fill all required fields",{ns:"client"}),ii.WARNING);return}T.value=!0;const z={url:E.value,email:x.value,description:C.value,layer:w.value};try{if((await ks(e,z,"POST","application/json")).ok)s(t('Feedback sent to <a href="mailto:{{email}}">{{email}}</a>',{email:"support@geoportail.lu",ns:"client"}),ii.INFO),i.toggleFeedbackOpen(!1);else throw new Error("Failed to send feedback")}catch{s(t('Feedback could not be sent to <a href="mailto:{{email}}">{{email}}</a>',{email:"support@geoportail.lu",ns:"client"}),ii.ERROR)}finally{T.value=!1}}const V=Ct(()=>{const z=[];return d.value&&z.push({id:String(d.value.id),name:String(d.value.name)}),h.value.forEach(H=>{z.push({id:String(H.id),name:String(H.name)})}),z});return(z,H)=>(U(),Gt(Lf,{"data-cy-value":"feedbackPanel","close-fn":()=>M(i).toggleFeedbackOpen(!1)},{header:Wt(()=>[P("h1",null,K(M(t)("Feedback",{ns:"client"})),1)]),content:Wt(()=>[P("div",kLe,[P("h3",LLe,K(M(t)("Report a map content problem:",{ns:"client"})),1),P("form",{onSubmit:ps(O,["prevent"]),class:"flex flex-col gap-4"},[P("div",PLe,[P("label",GLe,K(M(t)("Your email",{ns:"client"})),1),An(P("input",{type:"email",required:"","onUpdate:modelValue":H[0]||(H[0]=te=>x.value=te),class:"w-full px-3 py-2 lux-input",id:"inputEmail","aria-label":M(t)("Your email",{ns:"client"}),"data-cy":"feedbackEmail"},null,8,FLe),[[Or,x.value]])]),P("div",OLe,[P("label",NLe,K(M(t)("Pick layer where problem occurs",{ns:"client"})),1),P("div",DLe,[An(P("select",{id:"dropdownLayerPicker","onUpdate:modelValue":H[1]||(H[1]=te=>w.value=te),required:"",class:"w-full px-3 py-2 lux-input appearance-none cursor-pointer","aria-label":M(t)("Pick layer where problem occurs",{ns:"client"}),"data-cy":"feedbackLayerSelect"},[P("option",BLe,K(M(t)("Please pick a layer",{ns:"client"})),1),(U(!0),ie(Mt,null,hi(V.value,te=>(U(),ie("option",{key:te.id,value:te.name},K(M(t)(te.name,{ns:"client"})),9,ZLe))),128))],8,VLe),[[jN,w.value]]),H[3]||(H[3]=P("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none fa fa-caret-down text-primary","aria-hidden":"true"},null,-1))])]),P("div",WLe,[P("label",zLe,K(M(t)("Describe the problem within the current map extent:",{ns:"client"})),1),An(P("textarea",{rows:"5",required:"",maxlength:"500","onUpdate:modelValue":H[2]||(H[2]=te=>C.value=te),class:"w-full px-3 py-2 lux-input resize-none",id:"inputDescription","aria-label":M(t)("Describe the problem within the current map extent:",{ns:"client"}),"data-cy":"feedbackDescription"},null,8,ULe),[[Or,C.value]]),P("p",XLe,K(C.value.length)+"/500 ",1)]),P("div",YLe,[T.value?(U(),ie("span",HLe,K(M(t)("Sending...",{ns:"client"})),1)):Le("",!0)]),P("div",KLe,[P("p",jLe,[P("a",{href:E.value,target:"_blank",class:"text-blue-400 hover:text-blue-300 underline"},K(M(t)("Click to view the map link that will be sent to our support team",{ns:"client"})),9,$Le)]),P("p",null,[Bt(K(M(t)("You can also use the Drawing Tools to annotate the map and send it to the support team.",{ns:"client"}))+" ",1),P("button",{type:"button",onClick:G,class:"ml-2 text-blue-400 hover:text-blue-300 underline bg-transparent border-0 p-0 cursor-pointer font-normal"},K(M(t)("Open Drawing Tools",{ns:"client"})),1)])]),P("button",{type:"submit",disabled:T.value,"aria-disabled":T.value?"true":"false",class:"lux-btn self-end","data-cy":"feedbackSubmit"},K(T.value?M(t)("Sending...",{ns:"client"}):M(t)("Send feedback to support team",{ns:"client"})),9,JLe)],32)])]),_:1},8,["close-fn"]))}}),QLe={key:0,class:"w-4/5 md:w-80 bg-secondary z-10"},ePe={key:1,class:"w-4/5 md:w-80 bg-secondary z-10"},tPe={key:2,class:"w-4/5 md:w-80 bg-secondary z-10"},nPe={key:3,class:"w-4/5 md:w-80 bg-secondary z-10"},iPe={class:"w-4/5 md:w-80 bg-secondary z-10"},rPe={key:4,class:"w-4/5 md:w-80 bg-secondary z-10"},sPe={key:5,class:"w-4/5 md:w-80 bg-secondary z-10"},oPe={class:"w-4/5 md:w-80 bg-secondary z-10"},aPe=at({__name:"side-panel",setup(n){const e=Jn(),{layersOpen:t,legendsOpen:i,myMapsOpen:r,infoOpen:o,lidarOpen:s,routingPanelOpen:l,feedbackOpen:u,styleEditorOpen:h,themeGridOpen:d,drawToolbarOpen:m}=It(e),y=JSON.parse("[2.6, 47.7, 8.6, 51]"),x="https://map.geoportail.lu/mymaps/getroute";return Pt(t,C=>{C&&(s.value=i.value=r.value=h.value=l.value=u.value=!1)}),Pt(r,C=>{C&&(h.value=t.value=d.value=i.value=o.value=l.value=u.value=!1)}),Pt(i,C=>{C&&(r.value=h.value=t.value=d.value=o.value=s.value=l.value=u.value=!1)}),Pt(m,C=>{C&&Uk("md")&&(r.value=!0,t.value=!1,i.value=!1,d.value=!1,o.value=!1,s.value=!1,u.value=!1,l.value=!1)}),Pt(o,C=>{C&&(r.value=h.value=t.value=d.value=i.value=s.value=u.value=l.value=!1)}),Pt(u,C=>{C&&(r.value=h.value=t.value=d.value=i.value=s.value=o.value=l.value=!1)}),Pt(l,C=>{C&&(t.value=i.value=r.value=h.value=u.value=o.value=s.value=d.value=!1)}),(C,w)=>(U(),ie(Mt,null,[M(t)?(U(),ie("div",QLe,[mt($ve)])):Le("",!0),M(i)?(U(),ie("div",ePe,[mt(tbe)])):Le("",!0),M(h)?(U(),ie("div",tPe,[mt(Hxe)])):Le("",!0),M(r)?(U(),ie("div",nPe,[mt(REe)])):Le("",!0),An(P("div",iPe,[mt(ALe)],512),[[Yp,M(o)]]),M(u)?(U(),ie("div",rPe,[mt(qLe)])):Le("",!0),M(l)?(U(),ie("div",sPe,[mt(Qwe,{"max-extent":M(y),"poi-search-service-url":M(x)},null,8,["max-extent","poi-search-service-url"])])):Le("",!0),An(P("div",oPe,[mt(MLe)],512),[[Yp,M(s)]])],64))}});class lPe{bootstrap(){this.restore()}restore(){const e=Dn.getValue(Py);if(e){const{setFid:t}=rg();t(e),Ql.removeQueryParam(Py)}}}const uPe=new lPe;function cPe(){const n=Jn(),e=Qr(),{t}=St(),i=Ue(!1);let r=null;const{log:o}=Lb("SW");n.isOffLine=!navigator.onLine;const s=y=>{let x=y;for(;x;){const C=x.getAttribute("data-cy");if(C&&["infoOpenClose","legendsOpenClose","printOpenClose","shareOpenClose","feedbackOpenClose"].includes(C))return!0;x=x.parentElement}return!1},l=()=>{const y=document.querySelector('[data-cy="drawOpenClose"]');return y||document.querySelector(".map-wrapper")},u=()=>{n.isOffLine=!1,r&&document.contains(r)&&setTimeout(()=>{r?.focus(),r=null},100),i.value&&(e.addNotification(t("Connection restored"),ii.INFO,3e3),i.value=!1)},h=()=>{o("[Network] Going OFFLINE - navigator.onLine:",navigator.onLine),n.isOffLine=!0,o("[Network] Set appStore.isOffLine to:",n.isOffLine),i.value=!0;const y=document.activeElement;if(y&&y!==document.body&&s(y)){r=y;const x=l();x&&setTimeout(()=>{x.focus()},100)}};return{initialize:()=>{o("[Network] Initialize - navigator.onLine:",navigator.onLine);const y=!navigator.onLine;n.isOffLine!==y?(n.isOffLine=y,o("[Network] Set initial appStore.isOffLine to:",n.isOffLine)):o("[Network] appStore.isOffLine already set to:",n.isOffLine),window.addEventListener("online",u),window.addEventListener("offline",h),navigator.onLine||(i.value=!0),setTimeout(async()=>{o("[Network] Delayed check - navigator.onLine:",navigator.onLine);try{const x="https://migration.geoportail.lu/ping",C=new AbortController,w=setTimeout(()=>C.abort(),2e3),E=await fetch(x,{method:"HEAD",cache:"no-store",signal:C.signal});if(clearTimeout(w),!E.ok)throw new Error(`HTTP ${E.status}`);o("[Network] Connectivity test: ONLINE"),n.isOffLine&&(o("[Network] Correcting state to online"),u())}catch(x){o("[Network] Connectivity test: OFFLINE",x instanceof Error?x.message:String(x)),n.isOffLine||(o("[Network] Correcting state to offline"),h())}},100)},cleanup:()=>{window.removeEventListener("online",u),window.removeEventListener("offline",h)}}}const hPe={class:"app-container flex flex-col overflow-hidden"},dPe={role:"status","aria-live":"polite","aria-atomic":"true",class:"sr-only"},fPe={key:0},pPe={class:"flex grow min-h-0"},gPe={class:"map-wrapper grow bg-blue-100 relative"},mPe={class:"absolute right-1 top-16"},yPe={key:0,class:"w-full flex-shrink-0",style:{height:"25rem"}},_Pe={key:1,class:"flex grow"},vPe={class:"map-wrapper grow bg-blue-100 relative"},bPe={class:"absolute right-1 top-2"},xPe=at({__name:"App",setup(n){const{t:e}=St(),t=Jn(),i=Mf(),r=Kn(),o=cPe(),{log:s}=Lb("SW");s("[App.vue] After useNetwork() - appStore.isOffLine:",t.isOffLine,"navigator.onLine:",navigator.onLine),sIe.bootstrap(),iIe.bootstrap(),uIe.bootstrap(),jxe.bootstrap(),JZ.bootstrap(),tIe.bootstrap(),i.initBackgroundsConfigs(),uPe.bootstrap(),sr(()=>{Rf().init()});const{embedded:l,layersOpen:u,legendsOpen:h,myMapsOpen:d,infoOpen:m,styleEditorOpen:y,lidarOpen:x,routingPanelOpen:C,isOffLine:w}=It(t);Pt(u,E),Pt(h,E),Pt(y,E),Pt(d,E),Pt(m,E),Pt(x,E),Pt(C,E);function E(){setTimeout(()=>r.resize(),50)}return sr(()=>{o.initialize(),window.addEventListener("resize",r.resize)}),Ms(()=>{o.cleanup(),window.removeEventListener("resize",r.resize)}),(T,k)=>(U(),ie("div",hPe,[P("div",dPe,[M(w)?(U(),ie("span",fPe,K(M(e)("You are offline. The following features are unavailable: Info panel, Legends, Routing, Measure tools, Print, Share, and external links.")),1)):Le("",!0)]),M(l)?(U(),ie("main",_Pe,[P("div",vPe,[mt(o3,{v4_standalone:!0})]),P("div",bPe,[mt(N5)])])):(U(),ie(Mt,{key:0},[M(w)?(U(),Gt(Hae,{key:0})):(U(),Gt(Bae,{key:1})),P("main",pPe,[mt(aPe),P("div",gPe,[mt(o3,{v4_standalone:!0}),mt(hxe,{class:"absolute top-0"}),mt(sxe),mt(J_e)]),P("div",mPe,[mt(N5)])]),mt(Dw,{name:"fade"},{default:Wt(()=>[M(x)?(U(),ie("div",yPe,[mt(swe,{class:"w-full h-full"})])):Le("",!0)]),_:1}),mt(LCe,{class:"sm:w-full flex-shrink-0 md:h-14 fixed bottom-5 sm:static"}),mt(Oye)],64))]))}}),{log:WI,error:A3,warn:Fz}=Lb("SW");X4();Wn.use(k3);Wn.init({lng:"fr",debug:!1,defaultNS:"client",returnEmptyString:!1,supportedLngs:["de","en","fr","lb"],ns:["app","client","legends","server","tooltips"],fallbackLng:"en",backend:{loadPath:"/luxembourg-geoportail/fixes/assets/locales/{{ns}}.{{lng}}.json"},nsSeparator:!1,keySeparator:!1}).then(()=>{const n=vX(xPe);n.use(JX()),n.use(IX,{i18next:Wn}),n.use($X),n.use(Bj),n.mount("#app"),Zr().loadThemes()});async function IPe(n){const e={type:"module"};try{return WI("Registering service worker as module:",n),await navigator.serviceWorker.register(n,e)}catch(t){return Fz("Module service worker registration failed, retrying as classic script",t),navigator.serviceWorker.register(n)}}function CPe(n){const e=window.setInterval(()=>{n.update()},36e5),t=()=>{window.clearInterval(e),window.removeEventListener("pagehide",t),window.removeEventListener("beforeunload",t)};return window.addEventListener("pagehide",t),window.addEventListener("beforeunload",t),t}"serviceWorker"in navigator?window.addEventListener("load",()=>{IPe("/luxembourg-geoportail/fixes/service-worker.js").then(e=>{WI("[SW]  Registered successfully:",e.scope),WI("[SW] State:",e.active?.state);const t=CPe(e);e.addEventListener("updatefound",()=>{const i=e.installing;i&&i.addEventListener("statechange",()=>{i.state==="installed"&&navigator.serviceWorker.controller&&(WI("[SW] New version available"),t())})})}).catch(e=>{A3("[SW]  Registration failed:",e),A3("[SW] Error details:",{name:e.name,message:e.message,stack:e.stack})})}):Fz("[SW]  Service Worker not supported in this browser");export{$4 as B,J4 as E,UM as F,qi as L,$h as M,Uw as P,_l as R,SPe as V,Ni as a,zi as b,Jd as c,Du as d,vf as e,Bo as f,y4 as g,Bw as h,wH as i,Bi as j,Ws as k,sH as l,qa as m,Dh as n,QD as o,vle as p,kC as r,dI as s,ru as t};
