(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();const hi=n=>typeof n=="string",H_=()=>{let n,e;const t=new Promise((i,r)=>{n=i,e=r});return t.resolve=n,t.reject=e,t},rP=n=>n==null?"":""+n,i6=(n,e,t)=>{n.forEach(i=>{e[i]&&(t[i]=e[i])})},r6=/###/g,sP=n=>n&&n.indexOf("###")>-1?n.replace(r6,"."):n,oP=n=>!n||hi(n),D0=(n,e,t)=>{const i=hi(e)?e.split("."):e;let r=0;for(;r<i.length-1;){if(oP(n))return{};const o=sP(i[r]);!n[o]&&t&&(n[o]=new t),Object.prototype.hasOwnProperty.call(n,o)?n=n[o]:n={},++r}return oP(n)?{}:{obj:n,k:sP(i[r])}},aP=(n,e,t)=>{const{obj:i,k:r}=D0(n,e,Object);if(i!==void 0||e.length===1){i[r]=t;return}let o=e[e.length-1],s=e.slice(0,e.length-1),l=D0(n,s,Object);for(;l.obj===void 0&&s.length;)o=`${s[s.length-1]}.${o}`,s=s.slice(0,s.length-1),l=D0(n,s,Object),l?.obj&&typeof l.obj[`${l.k}.${o}`]<"u"&&(l.obj=void 0);l.obj[`${l.k}.${o}`]=t},s6=(n,e,t,i)=>{const{obj:r,k:o}=D0(n,e,Object);r[o]=r[o]||[],r[o].push(t)},NI=(n,e)=>{const{obj:t,k:i}=D0(n,e);if(t&&Object.prototype.hasOwnProperty.call(t,i))return t[i]},o6=(n,e,t)=>{const i=NI(n,t);return i!==void 0?i:NI(e,t)},g3=(n,e,t)=>{for(const i in e)i!=="__proto__"&&i!=="constructor"&&(i in n?hi(n[i])||n[i]instanceof String||hi(e[i])||e[i]instanceof String?t&&(n[i]=e[i]):g3(n[i],e[i],t):n[i]=e[i]);return n},um=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var a6={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const l6=n=>hi(n)?n.replace(/[&<>"'\/]/g,e=>a6[e]):n;class u6{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}const c6=[" ",",","?","!",";"],h6=new u6(20),d6=(n,e,t)=>{e=e||"",t=t||"";const i=c6.filter(s=>e.indexOf(s)<0&&t.indexOf(s)<0);if(i.length===0)return!0;const r=h6.getRegExp(`(${i.map(s=>s==="?"?"\\?":s).join("|")})`);let o=!r.test(n);if(!o){const s=n.indexOf(t);s>0&&!r.test(n.substring(0,s))&&(o=!0)}return o},lE=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!n)return;if(n[e])return Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0;const i=e.split(t);let r=n;for(let o=0;o<i.length;){if(!r||typeof r!="object")return;let s,l="";for(let u=o;u<i.length;++u)if(u!==o&&(l+=t),l+=i[u],s=r[l],s!==void 0){if(["string","number","boolean"].indexOf(typeof s)>-1&&u<i.length-1)continue;o+=u-o+1;break}r=s}return r},DI=n=>n?.replace("_","-"),f6={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console?.[n]?.apply?.(console,e)}};class VI{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||f6,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,r){return r&&!this.debug?null:(hi(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new VI(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new VI(this.logger,e)}}var yc=new VI;class uw{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const r=this.observers[i].get(t)||0;this.observers[i].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(s=>{let[l,u]=s;for(let h=0;h<u;h++)l(...i)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(s=>{let[l,u]=s;for(let h=0;h<u;h++)l.apply(l,[e,...i])})}}class lP extends uw{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const o=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,s=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let l;e.indexOf(".")>-1?l=e.split("."):(l=[e,t],i&&(Array.isArray(i)?l.push(...i):hi(i)&&o?l.push(...i.split(o)):l.push(i)));const u=NI(this.data,l);return!u&&!t&&!i&&e.indexOf(".")>-1&&(e=l[0],t=l[1],i=l.slice(2).join(".")),u||!s||!hi(i)?u:lE(this.data?.[e]?.[t],i,o)}addResource(e,t,i,r){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const s=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator;let l=[e,t];i&&(l=l.concat(s?i.split(s):i)),e.indexOf(".")>-1&&(l=e.split("."),r=t,t=l[1]),this.addNamespaces(t),aP(this.data,l,r),o.silent||this.emit("added",e,t,i,r)}addResources(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const o in i)(hi(i[o])||Array.isArray(i[o]))&&this.addResource(e,t,o,i[o],{silent:!0});r.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,r,o){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},l=[e,t];e.indexOf(".")>-1&&(l=e.split("."),r=i,i=t,t=l[1]),this.addNamespaces(t);let u=NI(this.data,l)||{};s.skipCopy||(i=JSON.parse(JSON.stringify(i))),r?g3(u,i,o):u={...u,...i},aP(this.data,l,u),s.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(r=>t[r]&&Object.keys(t[r]).length>0)}toJSON(){return this.data}}var m3={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,i,r){return n.forEach(o=>{e=this.processors[o]?.process(e,t,i,r)??e}),e}};const uP={},cP=n=>!hi(n)&&typeof n!="boolean"&&typeof n!="number";class BI extends uw{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),i6(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=yc.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};return e==null?!1:this.resolve(e,t)?.res!==void 0}extractFromKey(e,t){let i=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const r=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let o=t.ns||this.options.defaultNS||[];const s=i&&e.indexOf(i)>-1,l=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!d6(e,i,r);if(s&&!l){const u=e.match(this.interpolator.nestingRegexp);if(u&&u.length>0)return{key:e,namespaces:hi(o)?[o]:o};const h=e.split(i);(i!==r||i===r&&this.options.ns.indexOf(h[0])>-1)&&(o=h.shift()),e=h.join(r)}return{key:e,namespaces:hi(o)?[o]:o}}translate(e,t,i){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const r=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,o=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:s,namespaces:l}=this.extractFromKey(e[e.length-1],t),u=l[l.length-1],h=t.lng||this.language,d=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(h?.toLowerCase()==="cimode"){if(d){const pe=t.nsSeparator||this.options.nsSeparator;return r?{res:`${u}${pe}${s}`,usedKey:s,exactUsedKey:s,usedLng:h,usedNS:u,usedParams:this.getUsedParamsDetails(t)}:`${u}${pe}${s}`}return r?{res:s,usedKey:s,exactUsedKey:s,usedLng:h,usedNS:u,usedParams:this.getUsedParamsDetails(t)}:s}const m=this.resolve(e,t);let y=m?.res;const x=m?.usedKey||s,C=m?.exactUsedKey||s,w=["[object Number]","[object Function]","[object RegExp]"],S=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,T=!this.i18nFormat||this.i18nFormat.handleAsObject,M=t.count!==void 0&&!hi(t.count),G=BI.hasDefaultValue(t),N=M?this.pluralResolver.getSuffix(h,t.count,t):"",V=t.ordinal&&M?this.pluralResolver.getSuffix(h,t.count,{ordinal:!1}):"",W=M&&!t.ordinal&&t.count===0,j=W&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${N}`]||t[`defaultValue${V}`]||t.defaultValue;let J=y;T&&!y&&G&&(J=j);const te=cP(J),ce=Object.prototype.toString.apply(J);if(T&&J&&te&&w.indexOf(ce)<0&&!(hi(S)&&Array.isArray(J))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const pe=this.options.returnedObjectHandler?this.options.returnedObjectHandler(x,J,{...t,ns:l}):`key '${s} (${this.language})' returned an object instead of string.`;return r?(m.res=pe,m.usedParams=this.getUsedParamsDetails(t),m):pe}if(o){const pe=Array.isArray(J),Y=pe?[]:{},he=pe?C:x;for(const D in J)if(Object.prototype.hasOwnProperty.call(J,D)){const re=`${he}${o}${D}`;G&&!y?Y[D]=this.translate(re,{...t,defaultValue:cP(j)?j[D]:void 0,joinArrays:!1,ns:l}):Y[D]=this.translate(re,{...t,joinArrays:!1,ns:l}),Y[D]===re&&(Y[D]=J[D])}y=Y}}else if(T&&hi(S)&&Array.isArray(y))y=y.join(S),y&&(y=this.extendTranslation(y,e,t,i));else{let pe=!1,Y=!1;!this.isValidLookup(y)&&G&&(pe=!0,y=j),this.isValidLookup(y)||(Y=!0,y=s);const D=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&Y?void 0:y,re=G&&j!==y&&this.options.updateMissing;if(Y||pe||re){if(this.logger.log(re?"updateKey":"missingKey",h,u,s,re?j:y),o){const we=this.resolve(s,{...t,keySeparator:!1});we&&we.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let le=[];const fe=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&fe&&fe[0])for(let we=0;we<fe.length;we++)le.push(fe[we]);else this.options.saveMissingTo==="all"?le=this.languageUtils.toResolveHierarchy(t.lng||this.language):le.push(t.lng||this.language);const Le=(we,se,Q)=>{const q=G&&Q!==y?Q:D;this.options.missingKeyHandler?this.options.missingKeyHandler(we,u,se,q,re,t):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(we,u,se,q,re,t),this.emit("missingKey",we,u,se,y)};this.options.saveMissing&&(this.options.saveMissingPlurals&&M?le.forEach(we=>{const se=this.pluralResolver.getSuffixes(we,t);W&&t[`defaultValue${this.options.pluralSeparator}zero`]&&se.indexOf(`${this.options.pluralSeparator}zero`)<0&&se.push(`${this.options.pluralSeparator}zero`),se.forEach(Q=>{Le([we],s+Q,t[`defaultValue${Q}`]||j)})}):Le(le,s,j))}y=this.extendTranslation(y,e,t,m,i),Y&&y===s&&this.options.appendNamespaceToMissingKey&&(y=`${u}:${s}`),(Y||pe)&&this.options.parseMissingKeyHandler&&(y=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${u}:${s}`:s,pe?y:void 0))}return r?(m.res=y,m.usedParams=this.getUsedParamsDetails(t),m):y}extendTranslation(e,t,i,r,o){var s=this;if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const h=hi(e)&&(i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(h){const y=e.match(this.interpolator.nestingRegexp);d=y&&y.length}let m=i.replace&&!hi(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(m={...this.options.interpolation.defaultVariables,...m}),e=this.interpolator.interpolate(e,m,i.lng||this.language||r.usedLng,i),h){const y=e.match(this.interpolator.nestingRegexp),x=y&&y.length;d<x&&(i.nest=!1)}!i.lng&&r&&r.res&&(i.lng=this.language||r.usedLng),i.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var y=arguments.length,x=new Array(y),C=0;C<y;C++)x[C]=arguments[C];return o?.[0]===x[0]&&!i.context?(s.logger.warn(`It seems you are nesting recursively key: ${x[0]} in key: ${t[0]}`),null):s.translate(...x,t)},i)),i.interpolation&&this.interpolator.reset()}const l=i.postProcess||this.options.postProcess,u=hi(l)?[l]:l;return e!=null&&u?.length&&i.applyPostProcessor!==!1&&(e=m3.handle(u,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i,r,o,s,l;return hi(e)&&(e=[e]),e.forEach(u=>{if(this.isValidLookup(i))return;const h=this.extractFromKey(u,t),d=h.key;r=d;let m=h.namespaces;this.options.fallbackNS&&(m=m.concat(this.options.fallbackNS));const y=t.count!==void 0&&!hi(t.count),x=y&&!t.ordinal&&t.count===0,C=t.context!==void 0&&(hi(t.context)||typeof t.context=="number")&&t.context!=="",w=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);m.forEach(S=>{this.isValidLookup(i)||(l=S,!uP[`${w[0]}-${S}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(l)&&(uP[`${w[0]}-${S}`]=!0,this.logger.warn(`key "${r}" for languages "${w.join(", ")}" won't get resolved as namespace "${l}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),w.forEach(T=>{if(this.isValidLookup(i))return;s=T;const M=[d];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(M,d,T,S,t);else{let N;y&&(N=this.pluralResolver.getSuffix(T,t.count,t));const V=`${this.options.pluralSeparator}zero`,W=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(y&&(M.push(d+N),t.ordinal&&N.indexOf(W)===0&&M.push(d+N.replace(W,this.options.pluralSeparator)),x&&M.push(d+V)),C){const j=`${d}${this.options.contextSeparator}${t.context}`;M.push(j),y&&(M.push(j+N),t.ordinal&&N.indexOf(W)===0&&M.push(j+N.replace(W,this.options.pluralSeparator)),x&&M.push(j+V))}}let G;for(;G=M.pop();)this.isValidLookup(i)||(o=G,i=this.getResource(T,S,G,t))}))})}),{res:i,usedKey:r,exactUsedKey:o,usedLng:s,usedNS:l}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,i,r):this.resourceStore.getResource(e,t,i,r)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=e.replace&&!hi(e.replace);let r=i?e.replace:e;if(i&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!i){r={...r};for(const o of t)delete r[o]}return r}static hasDefaultValue(e){const t="defaultValue";for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,t.length)&&e[i]!==void 0)return!0;return!1}}class hP{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=yc.create("languageUtils")}getScriptPartFromCode(e){if(e=DI(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=DI(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(hi(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(i=>{if(t)return;const r=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(i=>{if(t)return;const r=this.getLanguagePartFromCode(i);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(o=>{if(o===r)return o;if(!(o.indexOf("-")<0&&r.indexOf("-")<0)&&(o.indexOf("-")>0&&r.indexOf("-")<0&&o.substring(0,o.indexOf("-"))===r||o.indexOf(r)===0&&r.length>1))return o})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),hi(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){const i=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],o=s=>{s&&(this.isSupportedCode(s)?r.push(s):this.logger.warn(`rejecting language code not found in supportedLngs: ${s}`))};return hi(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&o(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&o(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&o(this.getLanguagePartFromCode(e))):hi(e)&&o(this.formatLanguageCode(e)),i.forEach(s=>{r.indexOf(s)<0&&o(this.formatLanguageCode(s))}),r}}const dP={zero:0,one:1,two:2,few:3,many:4,other:5},fP={select:n=>n===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class p6{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=yc.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=DI(e==="dev"?"en":e),r=t.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:i,type:r});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];let s;try{s=new Intl.PluralRules(i,{type:r})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),fP;if(!e.match(/-|_/))return fP;const u=this.languageUtils.getLanguagePartFromCode(e);s=this.getRule(u,t)}return this.pluralRulesCache[o]=s,s}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,i).map(r=>`${t}${r}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?i.resolvedOptions().pluralCategories.sort((r,o)=>dP[r]-dP[o]).map(r=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${r}`):[]}getSuffix(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=this.getRule(e,i);return r?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,i))}}const pP=function(n,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=o6(n,e,t);return!o&&r&&hi(t)&&(o=lE(n,t,i),o===void 0&&(o=lE(e,t,i))),o},u2=n=>n.replace(/\$/g,"$$$$");class g6{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=yc.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(t=>t),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:i,useRawValueToEscape:r,prefix:o,prefixEscaped:s,suffix:l,suffixEscaped:u,formatSeparator:h,unescapeSuffix:d,unescapePrefix:m,nestingPrefix:y,nestingPrefixEscaped:x,nestingSuffix:C,nestingSuffixEscaped:w,nestingOptionsSeparator:S,maxReplaces:T,alwaysFormat:M}=e.interpolation;this.escape=t!==void 0?t:l6,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=o?um(o):s||"{{",this.suffix=l?um(l):u||"}}",this.formatSeparator=h||",",this.unescapePrefix=d?"":m||"-",this.unescapeSuffix=this.unescapePrefix?"":d||"",this.nestingPrefix=y?um(y):x||um("$t("),this.nestingSuffix=C?um(C):w||um(")"),this.nestingOptionsSeparator=S||",",this.maxReplaces=T||1e3,this.alwaysFormat=M!==void 0?M:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,i)=>t?.source===i?(t.lastIndex=0,t):new RegExp(i,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,i,r){let o,s,l;const u=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},h=x=>{if(x.indexOf(this.formatSeparator)<0){const T=pP(t,u,x,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(T,void 0,i,{...r,...t,interpolationkey:x}):T}const C=x.split(this.formatSeparator),w=C.shift().trim(),S=C.join(this.formatSeparator).trim();return this.format(pP(t,u,w,this.options.keySeparator,this.options.ignoreJSONStructure),S,i,{...r,...t,interpolationkey:w})};this.resetRegExp();const d=r?.missingInterpolationHandler||this.options.missingInterpolationHandler,m=r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:x=>u2(x)},{regex:this.regexp,safeValue:x=>this.escapeValue?u2(this.escape(x)):u2(x)}].forEach(x=>{for(l=0;o=x.regex.exec(e);){const C=o[1].trim();if(s=h(C),s===void 0)if(typeof d=="function"){const S=d(e,o,r);s=hi(S)?S:""}else if(r&&Object.prototype.hasOwnProperty.call(r,C))s="";else if(m){s=o[0];continue}else this.logger.warn(`missed to pass in variable ${C} for interpolating ${e}`),s="";else!hi(s)&&!this.useRawValueToEscape&&(s=rP(s));const w=x.safeValue(s);if(e=e.replace(o[0],w),m?(x.regex.lastIndex+=s.length,x.regex.lastIndex-=o[0].length):x.regex.lastIndex=0,l++,l>=this.maxReplaces)break}}),e}nest(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,o,s;const l=(u,h)=>{const d=this.nestingOptionsSeparator;if(u.indexOf(d)<0)return u;const m=u.split(new RegExp(`${d}[ ]*{`));let y=`{${m[1]}`;u=m[0],y=this.interpolate(y,s);const x=y.match(/'/g),C=y.match(/"/g);((x?.length??0)%2===0&&!C||C.length%2!==0)&&(y=y.replace(/'/g,'"'));try{s=JSON.parse(y),h&&(s={...h,...s})}catch(w){return this.logger.warn(`failed parsing options string in nesting for key ${u}`,w),`${u}${d}${y}`}return s.defaultValue&&s.defaultValue.indexOf(this.prefix)>-1&&delete s.defaultValue,u};for(;r=this.nestingRegexp.exec(e);){let u=[];s={...i},s=s.replace&&!hi(s.replace)?s.replace:s,s.applyPostProcessor=!1,delete s.defaultValue;let h=!1;if(r[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(r[1])){const d=r[1].split(this.formatSeparator).map(m=>m.trim());r[1]=d.shift(),u=d,h=!0}if(o=t(l.call(this,r[1].trim(),s),s),o&&r[0]===e&&!hi(o))return o;hi(o)||(o=rP(o)),o||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),o=""),h&&(o=u.reduce((d,m)=>this.format(d,m,i.lng,{...i,interpolationkey:r[1].trim()}),o.trim())),e=e.replace(r[0],o),this.regexp.lastIndex=0}return e}}const m6=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const i=n.split("(");e=i[0].toLowerCase().trim();const r=i[1].substring(0,i[1].length-1);e==="currency"&&r.indexOf(":")<0?t.currency||(t.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?t.range||(t.range=r.trim()):r.split(";").forEach(s=>{if(s){const[l,...u]=s.split(":"),h=u.join(":").trim().replace(/^'+|'+$/g,""),d=l.trim();t[d]||(t[d]=h),h==="false"&&(t[d]=!1),h==="true"&&(t[d]=!0),isNaN(h)||(t[d]=parseInt(h,10))}})}return{formatName:e,formatOptions:t}},cm=n=>{const e={};return(t,i,r)=>{let o=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(o={...o,[r.interpolationkey]:void 0});const s=i+JSON.stringify(o);let l=e[s];return l||(l=n(DI(i),r),e[s]=l),l(t)}};let y6=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=yc.create("formatter"),this.options=e,this.formats={number:cm((t,i)=>{const r=new Intl.NumberFormat(t,{...i});return o=>r.format(o)}),currency:cm((t,i)=>{const r=new Intl.NumberFormat(t,{...i,style:"currency"});return o=>r.format(o)}),datetime:cm((t,i)=>{const r=new Intl.DateTimeFormat(t,{...i});return o=>r.format(o)}),relativetime:cm((t,i)=>{const r=new Intl.RelativeTimeFormat(t,{...i});return o=>r.format(o,i.range||"day")}),list:cm((t,i)=>{const r=new Intl.ListFormat(t,{...i});return o=>r.format(o)})},this.init(e)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=cm(t)}format(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const o=t.split(this.formatSeparator);if(o.length>1&&o[0].indexOf("(")>1&&o[0].indexOf(")")<0&&o.find(l=>l.indexOf(")")>-1)){const l=o.findIndex(u=>u.indexOf(")")>-1);o[0]=[o[0],...o.splice(1,l)].join(this.formatSeparator)}return o.reduce((l,u)=>{const{formatName:h,formatOptions:d}=m6(u);if(this.formats[h]){let m=l;try{const y=r?.formatParams?.[r.interpolationkey]||{},x=y.locale||y.lng||r.locale||r.lng||i;m=this.formats[h](l,x,{...d,...r,...y})}catch(y){this.logger.warn(y)}return m}else this.logger.warn(`there was no format function for ${h}`);return l},e)}};const _6=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class v6 extends uw{constructor(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=r,this.logger=yc.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(i,r.backend,r)}queueLoad(e,t,i,r){const o={},s={},l={},u={};return e.forEach(h=>{let d=!0;t.forEach(m=>{const y=`${h}|${m}`;!i.reload&&this.store.hasResourceBundle(h,m)?this.state[y]=2:this.state[y]<0||(this.state[y]===1?s[y]===void 0&&(s[y]=!0):(this.state[y]=1,d=!1,s[y]===void 0&&(s[y]=!0),o[y]===void 0&&(o[y]=!0),u[m]===void 0&&(u[m]=!0)))}),d||(l[h]=!0)}),(Object.keys(o).length||Object.keys(s).length)&&this.queue.push({pending:s,pendingCount:Object.keys(s).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(o),pending:Object.keys(s),toLoadLanguages:Object.keys(l),toLoadNamespaces:Object.keys(u)}}loaded(e,t,i){const r=e.split("|"),o=r[0],s=r[1];t&&this.emit("failedLoading",o,s,t),!t&&i&&this.store.addResourceBundle(o,s,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);const l={};this.queue.forEach(u=>{s6(u.loaded,[o],s),_6(u,e),t&&u.errors.push(t),u.pendingCount===0&&!u.done&&(Object.keys(u.loaded).forEach(h=>{l[h]||(l[h]={});const d=u.loaded[h];d.length&&d.forEach(m=>{l[h][m]===void 0&&(l[h][m]=!0)})}),u.done=!0,u.errors.length?u.callback(u.errors):u.callback())}),this.emit("loaded",l),this.queue=this.queue.filter(u=>!u.done)}read(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,s=arguments.length>5?arguments[5]:void 0;if(!e.length)return s(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:i,tried:r,wait:o,callback:s});return}this.readingCalls++;const l=(h,d)=>{if(this.readingCalls--,this.waitingReads.length>0){const m=this.waitingReads.shift();this.read(m.lng,m.ns,m.fcName,m.tried,m.wait,m.callback)}if(h&&d&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,i,r+1,o*2,s)},o);return}s(h,d)},u=this.backend[i].bind(this.backend);if(u.length===2){try{const h=u(e,t);h&&typeof h.then=="function"?h.then(d=>l(null,d)).catch(l):l(null,h)}catch(h){l(h)}return}return u(e,t,l)}prepareLoading(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();hi(e)&&(e=this.languageUtils.toResolveHierarchy(e)),hi(t)&&(t=[t]);const o=this.queueLoad(e,t,i,r);if(!o.toLoad.length)return o.pending.length||r(),null;o.toLoad.forEach(s=>{this.loadOne(s)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=e.split("|"),r=i[0],o=i[1];this.read(r,o,"read",void 0,void 0,(s,l)=>{s&&this.logger.warn(`${t}loading namespace ${o} for language ${r} failed`,s),!s&&l&&this.logger.log(`${t}loaded namespace ${o} for language ${r}`,l),this.loaded(e,s,l)})}saveMissing(e,t,i,r,o){let s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend?.create){const u={...s,isUpdate:o},h=this.backend.create.bind(this.backend);if(h.length<6)try{let d;h.length===5?d=h(e,t,i,r,u):d=h(e,t,i,r),d&&typeof d.then=="function"?d.then(m=>l(null,m)).catch(l):l(null,d)}catch(d){l(d)}else h(e,t,i,r,l,u)}!e||!e[0]||this.store.addResource(e[0],t,i,r)}}}const gP=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),hi(n[1])&&(e.defaultValue=n[1]),hi(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(i=>{e[i]=t[i]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),mP=n=>(hi(n.ns)&&(n.ns=[n.ns]),hi(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),hi(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs?.indexOf?.("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),typeof n.initImmediate=="boolean"&&(n.initAsync=n.initImmediate),n),Y1=()=>{},b6=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})};class fv extends uw{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=mP(e),this.services={},this.logger=yc,this.modules={external:[]},b6(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(i=t,t={}),t.defaultNS==null&&t.ns&&(hi(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=gP();this.options={...r,...this.options,...mP(t)},this.options.interpolation={...r.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const o=d=>d?typeof d=="function"?new d:d:null;if(!this.options.isClone){this.modules.logger?yc.init(o(this.modules.logger),this.options):yc.init(null,this.options);let d;this.modules.formatter?d=this.modules.formatter:d=y6;const m=new hP(this.options);this.store=new lP(this.options.resources,this.options);const y=this.services;y.logger=yc,y.resourceStore=this.store,y.languageUtils=m,y.pluralResolver=new p6(m,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),d&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(y.formatter=o(d),y.formatter.init(y,this.options),this.options.interpolation.format=y.formatter.format.bind(y.formatter)),y.interpolator=new g6(this.options),y.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},y.backendConnector=new v6(o(this.modules.backend),y.resourceStore,y,this.options),y.backendConnector.on("*",function(x){for(var C=arguments.length,w=new Array(C>1?C-1:0),S=1;S<C;S++)w[S-1]=arguments[S];e.emit(x,...w)}),this.modules.languageDetector&&(y.languageDetector=o(this.modules.languageDetector),y.languageDetector.init&&y.languageDetector.init(y,this.options.detection,this.options)),this.modules.i18nFormat&&(y.i18nFormat=o(this.modules.i18nFormat),y.i18nFormat.init&&y.i18nFormat.init(this)),this.translator=new BI(this.services,this.options),this.translator.on("*",function(x){for(var C=arguments.length,w=new Array(C>1?C-1:0),S=1;S<C;S++)w[S-1]=arguments[S];e.emit(x,...w)}),this.modules.external.forEach(x=>{x.init&&x.init(this)})}if(this.format=this.options.interpolation.format,i||(i=Y1),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const d=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);d.length>0&&d[0]!=="dev"&&(this.options.lng=d[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(d=>{this[d]=function(){return e.store[d](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(d=>{this[d]=function(){return e.store[d](...arguments),e}});const u=H_(),h=()=>{const d=(m,y)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),u.resolve(y),i(m,y)};if(this.languages&&!this.isInitialized)return d(null,this.t.bind(this));this.changeLanguage(this.options.lng,d)};return this.options.resources||!this.options.initAsync?h():setTimeout(h,0),u}loadResources(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Y1;const r=hi(e)?e:this.language;if(typeof e=="function"&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(r?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const o=[],s=l=>{if(!l||l==="cimode")return;this.services.languageUtils.toResolveHierarchy(l).forEach(h=>{h!=="cimode"&&o.indexOf(h)<0&&o.push(h)})};r?s(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(u=>s(u)),this.options.preload?.forEach?.(l=>s(l)),this.services.backendConnector.load(o,this.options.ns,l=>{!l&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(l)})}else i(null)}reloadResources(e,t,i){const r=H_();return typeof e=="function"&&(i=e,e=void 0),typeof t=="function"&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=Y1),this.services.backendConnector.reload(e,t,o=>{r.resolve(),i(o)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&m3.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const i=this.languages[t];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}}changeLanguage(e,t){var i=this;this.isLanguageChangingTo=e;const r=H_();this.emit("languageChanging",e);const o=u=>{this.language=u,this.languages=this.services.languageUtils.toResolveHierarchy(u),this.resolvedLanguage=void 0,this.setResolvedLanguage(u)},s=(u,h)=>{h?(o(h),this.translator.changeLanguage(h),this.isLanguageChangingTo=void 0,this.emit("languageChanged",h),this.logger.log("languageChanged",h)):this.isLanguageChangingTo=void 0,r.resolve(function(){return i.t(...arguments)}),t&&t(u,function(){return i.t(...arguments)})},l=u=>{!e&&!u&&this.services.languageDetector&&(u=[]);const h=hi(u)?u:this.services.languageUtils.getBestMatchFromCodes(u);h&&(this.language||o(h),this.translator.language||this.translator.changeLanguage(h),this.services.languageDetector?.cacheUserLanguage?.(h)),this.loadResources(h,d=>{s(d,h)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?l(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(l):this.services.languageDetector.detect(l):l(e),r}getFixedT(e,t,i){var r=this;const o=function(s,l){let u;if(typeof l!="object"){for(var h=arguments.length,d=new Array(h>2?h-2:0),m=2;m<h;m++)d[m-2]=arguments[m];u=r.options.overloadTranslationOptionHandler([s,l].concat(d))}else u={...l};u.lng=u.lng||o.lng,u.lngs=u.lngs||o.lngs,u.ns=u.ns||o.ns,u.keyPrefix!==""&&(u.keyPrefix=u.keyPrefix||i||o.keyPrefix);const y=r.options.keySeparator||".";let x;return u.keyPrefix&&Array.isArray(s)?x=s.map(C=>`${u.keyPrefix}${y}${C}`):x=u.keyPrefix?`${u.keyPrefix}${y}${s}`:s,r.t(x,u)};return hi(e)?o.lng=e:o.lngs=e,o.ns=t,o.keyPrefix=i,o}t(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.translator?.translate(...t)}exists(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.translator?.exists(...t)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=t.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,o=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const s=(l,u)=>{const h=this.services.backendConnector.state[`${l}|${u}`];return h===-1||h===0||h===2};if(t.precheck){const l=t.precheck(this,s);if(l!==void 0)return l}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||s(i,e)&&(!r||s(o,e)))}loadNamespaces(e,t){const i=H_();return this.options.ns?(hi(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{i.resolve(),t&&t(r)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){const i=H_();hi(e)&&(e=[e]);const r=this.options.preload||[],o=e.filter(s=>r.indexOf(s)<0&&this.services.languageUtils.isSupportedCode(s));return o.length?(this.options.preload=r.concat(o),this.loadResources(s=>{i.resolve(),t&&t(s)}),i):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services?.languageUtils||new hP(gP());return t.indexOf(i.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new fv(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Y1;const i=e.forkResourceStore;i&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},o=new fv(r);if((e.debug!==void 0||e.prefix!==void 0)&&(o.logger=o.logger.clone(e)),["store","services","language"].forEach(l=>{o[l]=this[l]}),o.services={...this.services},o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},i){const l=Object.keys(this.store.data).reduce((u,h)=>(u[h]={...this.store.data[h]},Object.keys(u[h]).reduce((d,m)=>(d[m]={...u[h][m]},d),{})),{});o.store=new lP(l,r),o.services.resourceStore=o.store}return o.translator=new BI(o.services,r),o.translator.on("*",function(l){for(var u=arguments.length,h=new Array(u>1?u-1:0),d=1;d<u;d++)h[d-1]=arguments[d];o.emit(l,...h)}),o.init(r,t),o.translator.options=r,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Wn=fv.createInstance();Wn.createInstance=fv.createInstance;Wn.createInstance;Wn.dir;Wn.init;Wn.loadResources;Wn.reloadResources;Wn.use;Wn.changeLanguage;Wn.getFixedT;const x6=Wn.t;Wn.exists;Wn.setDefaultNamespace;Wn.hasLoadedNamespace;Wn.loadNamespaces;Wn.loadLanguages;function uE(n){"@babel/helpers - typeof";return uE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uE(n)}function y3(){return typeof XMLHttpRequest=="function"||(typeof XMLHttpRequest>"u"?"undefined":uE(XMLHttpRequest))==="object"}function I6(n){return!!n&&typeof n.then=="function"}function C6(n){return I6(n)?n:Promise.resolve(n)}const w6="modulepreload",A6=function(n){return"/luxembourg-geoportail/builder/"+n},yP={},ZI=function(e,t,i){let r=Promise.resolve();if(t&&t.length>0){let u=function(h){return Promise.all(h.map(d=>Promise.resolve(d).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");r=u(t.map(h=>{if(h=A6(h),h in yP)return;yP[h]=!0;const d=h.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const y=document.createElement("link");if(y.rel=d?"stylesheet":w6,d||(y.as="script"),y.crossOrigin="",y.href=h,l&&y.setAttribute("nonce",l),document.head.appendChild(y),d)return new Promise((x,C)=>{y.addEventListener("load",x),y.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return r.then(s=>{for(const l of s||[])l.status==="rejected"&&o(l.reason);return e().catch(o)})};function _P(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function vP(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_P(Object(t),!0).forEach(function(i){S6(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_P(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function S6(n,e,t){return(e=E6(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function E6(n){var e=T6(n,"string");return Wp(e)=="symbol"?e:e+""}function T6(n,e){if(Wp(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(Wp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Wp(n){"@babel/helpers - typeof";return Wp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wp(n)}var hf=typeof fetch=="function"?fetch:void 0;typeof global<"u"&&global.fetch?hf=global.fetch:typeof window<"u"&&window.fetch&&(hf=window.fetch);var pv;y3()&&(typeof global<"u"&&global.XMLHttpRequest?pv=global.XMLHttpRequest:typeof window<"u"&&window.XMLHttpRequest&&(pv=window.XMLHttpRequest));var WI;typeof ActiveXObject=="function"&&(typeof global<"u"&&global.ActiveXObject?WI=global.ActiveXObject:typeof window<"u"&&window.ActiveXObject&&(WI=window.ActiveXObject));typeof hf!="function"&&(hf=void 0);if(!hf&&!pv&&!WI)try{ZI(()=>import("./browser-ponyfill-ZypeLTte.js").then(n=>n.b),[]).then(function(n){hf=n.default}).catch(function(){})}catch{}var cE=function(e,t){if(t&&Wp(t)==="object"){var i="";for(var r in t)i+="&"+encodeURIComponent(r)+"="+encodeURIComponent(t[r]);if(!i)return e;e=e+(e.indexOf("?")!==-1?"&":"?")+i.slice(1)}return e},bP=function(e,t,i,r){var o=function(u){if(!u.ok)return i(u.statusText||"Error",{status:u.status});u.text().then(function(h){i(null,{status:u.status,data:h})}).catch(i)};if(r){var s=r(e,t);if(s instanceof Promise){s.then(o).catch(i);return}}typeof fetch=="function"?fetch(e,t).then(o).catch(i):hf(e,t).then(o).catch(i)},xP=!1,R6=function(e,t,i,r){e.queryStringParams&&(t=cE(t,e.queryStringParams));var o=vP({},typeof e.customHeaders=="function"?e.customHeaders():e.customHeaders);typeof window>"u"&&typeof global<"u"&&typeof global.process<"u"&&global.process.versions&&global.process.versions.node&&(o["User-Agent"]="i18next-http-backend (node/".concat(global.process.version,"; ").concat(global.process.platform," ").concat(global.process.arch,")")),i&&(o["Content-Type"]="application/json");var s=typeof e.requestOptions=="function"?e.requestOptions(i):e.requestOptions,l=vP({method:i?"POST":"GET",body:i?e.stringify(i):void 0,headers:o},xP?{}:s),u=typeof e.alternateFetch=="function"&&e.alternateFetch.length>=1?e.alternateFetch:void 0;try{bP(t,l,r,u)}catch(h){if(!s||Object.keys(s).length===0||!h.message||h.message.indexOf("not implemented")<0)return r(h);try{Object.keys(s).forEach(function(d){delete l[d]}),bP(t,l,r,u),xP=!0}catch(d){r(d)}}},M6=function(e,t,i,r){i&&Wp(i)==="object"&&(i=cE("",i).slice(1)),e.queryStringParams&&(t=cE(t,e.queryStringParams));try{var o=pv?new pv:new WI("MSXML2.XMLHTTP.3.0");o.open(i?"POST":"GET",t,1),e.crossDomain||o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.withCredentials=!!e.withCredentials,i&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.overrideMimeType&&o.overrideMimeType("application/json");var s=e.customHeaders;if(s=typeof s=="function"?s():s,s)for(var l in s)o.setRequestHeader(l,s[l]);o.onreadystatechange=function(){o.readyState>3&&r(o.status>=400?o.statusText:null,{status:o.status,data:o.responseText})},o.send(i)}catch(u){console&&console.log(u)}},k6=function(e,t,i,r){if(typeof i=="function"&&(r=i,i=void 0),r=r||function(){},hf&&t.indexOf("file:")!==0)return R6(e,t,i,r);if(y3()||typeof ActiveXObject=="function")return M6(e,t,i,r);r(new Error("No fetch and no xhr implementation found!"))};function yy(n){"@babel/helpers - typeof";return yy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yy(n)}function IP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function c2(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?IP(Object(t),!0).forEach(function(i){_3(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):IP(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function L6(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function P6(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,v3(i.key),i)}}function G6(n,e,t){return e&&P6(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function _3(n,e,t){return(e=v3(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function v3(n){var e=F6(n,"string");return yy(e)=="symbol"?e:e+""}function F6(n,e){if(yy(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(yy(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}var O6=function(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",parse:function(t){return JSON.parse(t)},stringify:JSON.stringify,parsePayload:function(t,i,r){return _3({},i,r||"")},parseLoadPayload:function(t,i){},request:k6,reloadInterval:typeof window<"u"?!1:3600*1e3,customHeaders:{},queryStringParams:{},crossDomain:!1,withCredentials:!1,overrideMimeType:!1,requestOptions:{mode:"cors",credentials:"same-origin",cache:"default"}}},b3=(function(){function n(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};L6(this,n),this.services=e,this.options=t,this.allOptions=i,this.type="backend",this.init(e,t,i)}return G6(n,[{key:"init",value:function(t){var i=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.services=t,this.options=c2(c2(c2({},O6()),this.options||{}),r),this.allOptions=o,this.services&&this.options.reloadInterval){var s=setInterval(function(){return i.reload()},this.options.reloadInterval);yy(s)==="object"&&typeof s.unref=="function"&&s.unref()}}},{key:"readMulti",value:function(t,i,r){this._readAny(t,t,i,i,r)}},{key:"read",value:function(t,i,r){this._readAny([t],t,[i],i,r)}},{key:"_readAny",value:function(t,i,r,o,s){var l=this,u=this.options.loadPath;typeof this.options.loadPath=="function"&&(u=this.options.loadPath(t,r)),u=C6(u),u.then(function(h){if(!h)return s(null,{});var d=l.services.interpolator.interpolate(h,{lng:t.join("+"),ns:r.join("+")});l.loadUrl(d,s,i,o)})}},{key:"loadUrl",value:function(t,i,r,o){var s=this,l=typeof r=="string"?[r]:r,u=typeof o=="string"?[o]:o,h=this.options.parseLoadPayload(l,u);this.options.request(this.options,t,h,function(d,m){if(m&&(m.status>=500&&m.status<600||!m.status))return i("failed loading "+t+"; status code: "+m.status,!0);if(m&&m.status>=400&&m.status<500)return i("failed loading "+t+"; status code: "+m.status,!1);if(!m&&d&&d.message){var y=d.message.toLowerCase(),x=["failed","fetch","network","load"].find(function(S){return y.indexOf(S)>-1});if(x)return i("failed loading "+t+": "+d.message,!0)}if(d)return i(d,!1);var C,w;try{typeof m.data=="string"?C=s.options.parse(m.data,r,o):C=m.data}catch{w="failed parsing "+t+" to json"}if(w)return i(w,!1);i(null,C)})}},{key:"create",value:function(t,i,r,o,s){var l=this;if(this.options.addPath){typeof t=="string"&&(t=[t]);var u=this.options.parsePayload(i,r,o),h=0,d=[],m=[];t.forEach(function(y){var x=l.options.addPath;typeof l.options.addPath=="function"&&(x=l.options.addPath(y,i));var C=l.services.interpolator.interpolate(x,{lng:y,ns:i});l.options.request(l.options,C,u,function(w,S){h+=1,d.push(w),m.push(S),h===t.length&&typeof s=="function"&&s(d,m)})})}}},{key:"reload",value:function(){var t=this,i=this.services,r=i.backendConnector,o=i.languageUtils,s=i.logger,l=r.language;if(!(l&&l.toLowerCase()==="cimode")){var u=[],h=function(m){var y=o.toResolveHierarchy(m);y.forEach(function(x){u.indexOf(x)<0&&u.push(x)})};h(l),this.allOptions.preload&&this.allOptions.preload.forEach(function(d){return h(d)}),u.forEach(function(d){t.allOptions.ns.forEach(function(m){r.read(d,m,"read",null,null,function(y,x){y&&s.warn("loading namespace ".concat(m," for language ").concat(d," failed"),y),!y&&x&&s.log("loaded namespace ".concat(m," for language ").concat(d),x),r.loaded("".concat(d,"|").concat(m),y,x)})})})}}}])})();b3.type="backend";function hR(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Rr={},$m=[],wc=()=>{},x3=()=>!1,cw=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),dR=n=>n.startsWith("onUpdate:"),vo=Object.assign,fR=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},N6=Object.prototype.hasOwnProperty,yr=(n,e)=>N6.call(n,e),zn=Array.isArray,Jm=n=>nb(n)==="[object Map]",Gy=n=>nb(n)==="[object Set]",CP=n=>nb(n)==="[object Date]",ui=n=>typeof n=="function",ps=n=>typeof n=="string",Tu=n=>typeof n=="symbol",Er=n=>n!==null&&typeof n=="object",I3=n=>(Er(n)||ui(n))&&ui(n.then)&&ui(n.catch),C3=Object.prototype.toString,nb=n=>C3.call(n),D6=n=>nb(n).slice(8,-1),w3=n=>nb(n)==="[object Object]",hw=n=>ps(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,V0=hR(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),dw=n=>{const e=Object.create(null);return(t=>e[t]||(e[t]=n(t)))},V6=/-\w/g,ql=dw(n=>n.replace(V6,e=>e.slice(1).toUpperCase())),B6=/\B([A-Z])/g,xf=dw(n=>n.replace(B6,"-$1").toLowerCase()),fw=dw(n=>n.charAt(0).toUpperCase()+n.slice(1)),h2=dw(n=>n?`on${fw(n)}`:""),of=(n,e)=>!Object.is(n,e),Qx=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},A3=(n,e,t,i=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:i,value:t})},pw=n=>{const e=parseFloat(n);return isNaN(e)?n:e},Z6=n=>{const e=ps(n)?Number(n):NaN;return isNaN(e)?n:e};let wP;const gw=()=>wP||(wP=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Dc(n){if(zn(n)){const e={};for(let t=0;t<n.length;t++){const i=n[t],r=ps(i)?X6(i):Dc(i);if(r)for(const o in r)e[o]=r[o]}return e}else if(ps(n)||Er(n))return n}const W6=/;(?![^(]*\))/g,z6=/:([^]+)/,U6=/\/\*[^]*?\*\//g;function X6(n){const e={};return n.replace(U6,"").split(W6).forEach(t=>{if(t){const i=t.split(z6);i.length>1&&(e[i[0].trim()]=i[1].trim())}}),e}function Dn(n){let e="";if(ps(n))e=n;else if(zn(n))for(let t=0;t<n.length;t++){const i=Dn(n[t]);i&&(e+=i+" ")}else if(Er(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const Y6="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",H6=hR(Y6);function S3(n){return!!n||n===""}function K6(n,e){if(n.length!==e.length)return!1;let t=!0;for(let i=0;t&&i<n.length;i++)t=ib(n[i],e[i]);return t}function ib(n,e){if(n===e)return!0;let t=CP(n),i=CP(e);if(t||i)return t&&i?n.getTime()===e.getTime():!1;if(t=Tu(n),i=Tu(e),t||i)return n===e;if(t=zn(n),i=zn(e),t||i)return t&&i?K6(n,e):!1;if(t=Er(n),i=Er(e),t||i){if(!t||!i)return!1;const r=Object.keys(n).length,o=Object.keys(e).length;if(r!==o)return!1;for(const s in n){const l=n.hasOwnProperty(s),u=e.hasOwnProperty(s);if(l&&!u||!l&&u||!ib(n[s],e[s]))return!1}}return String(n)===String(e)}function pR(n,e){return n.findIndex(t=>ib(t,e))}const E3=n=>!!(n&&n.__v_isRef===!0),K=n=>ps(n)?n:n==null?"":zn(n)||Er(n)&&(n.toString===C3||!ui(n.toString))?E3(n)?K(n.value):JSON.stringify(n,T3,2):String(n),T3=(n,e)=>E3(e)?T3(n,e.value):Jm(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[i,r],o)=>(t[d2(i,o)+" =>"]=r,t),{})}:Gy(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>d2(t))}:Tu(e)?d2(e):Er(e)&&!zn(e)&&!w3(e)?String(e):e,d2=(n,e="")=>{var t;return Tu(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};let Ho;class R3{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ho,!e&&Ho&&(this.index=(Ho.scopes||(Ho.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Ho;try{return Ho=this,e()}finally{Ho=t}}}on(){++this._on===1&&(this.prevScope=Ho,Ho=this)}off(){this._on>0&&--this._on===0&&(Ho=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,i;for(t=0,i=this.effects.length;t<i;t++)this.effects[t].stop();for(this.effects.length=0,t=0,i=this.cleanups.length;t<i;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,i=this.scopes.length;t<i;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0}}}function M3(n){return new R3(n)}function k3(){return Ho}function j6(n,e=!1){Ho&&Ho.cleanups.push(n)}let Dr;const f2=new WeakSet;class L3{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ho&&Ho.active&&Ho.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,f2.has(this)&&(f2.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||G3(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,AP(this),F3(this);const e=Dr,t=Au;Dr=this,Au=!0;try{return this.fn()}finally{O3(this),Dr=e,Au=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)yR(e);this.deps=this.depsTail=void 0,AP(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?f2.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){hE(this)&&this.run()}get dirty(){return hE(this)}}let P3=0,B0,Z0;function G3(n,e=!1){if(n.flags|=8,e){n.next=Z0,Z0=n;return}n.next=B0,B0=n}function gR(){P3++}function mR(){if(--P3>0)return;if(Z0){let e=Z0;for(Z0=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;B0;){let e=B0;for(B0=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(i){n||(n=i)}e=t}}if(n)throw n}function F3(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function O3(n){let e,t=n.depsTail,i=t;for(;i;){const r=i.prevDep;i.version===-1?(i===t&&(t=r),yR(i),$6(i)):e=i,i.dep.activeLink=i.prevActiveLink,i.prevActiveLink=void 0,i=r}n.deps=e,n.depsTail=t}function hE(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(N3(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function N3(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===gv)||(n.globalVersion=gv,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!hE(n))))return;n.flags|=2;const e=n.dep,t=Dr,i=Au;Dr=n,Au=!0;try{F3(n);const r=n.fn(n._value);(e.version===0||of(r,n._value))&&(n.flags|=128,n._value=r,e.version++)}catch(r){throw e.version++,r}finally{Dr=t,Au=i,O3(n),n.flags&=-3}}function yR(n,e=!1){const{dep:t,prevSub:i,nextSub:r}=n;if(i&&(i.nextSub=r,n.prevSub=void 0),r&&(r.prevSub=i,n.nextSub=void 0),t.subs===n&&(t.subs=i,!i&&t.computed)){t.computed.flags&=-5;for(let o=t.computed.deps;o;o=o.nextDep)yR(o,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function $6(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Au=!0;const D3=[];function zh(){D3.push(Au),Au=!1}function Uh(){const n=D3.pop();Au=n===void 0?!0:n}function AP(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Dr;Dr=void 0;try{e()}finally{Dr=t}}}let gv=0;class J6{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class _R{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Dr||!Au||Dr===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Dr)t=this.activeLink=new J6(Dr,this),Dr.deps?(t.prevDep=Dr.depsTail,Dr.depsTail.nextDep=t,Dr.depsTail=t):Dr.deps=Dr.depsTail=t,V3(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const i=t.nextDep;i.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=i),t.prevDep=Dr.depsTail,t.nextDep=void 0,Dr.depsTail.nextDep=t,Dr.depsTail=t,Dr.deps===t&&(Dr.deps=i)}return t}trigger(e){this.version++,gv++,this.notify(e)}notify(e){gR();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{mR()}}}function V3(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let i=e.deps;i;i=i.nextDep)V3(i)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const zI=new WeakMap,Op=Symbol(""),dE=Symbol(""),mv=Symbol("");function $o(n,e,t){if(Au&&Dr){let i=zI.get(n);i||zI.set(n,i=new Map);let r=i.get(t);r||(i.set(t,r=new _R),r.map=i,r.key=t),r.track()}}function Th(n,e,t,i,r,o){const s=zI.get(n);if(!s){gv++;return}const l=u=>{u&&u.trigger()};if(gR(),e==="clear")s.forEach(l);else{const u=zn(n),h=u&&hw(t);if(u&&t==="length"){const d=Number(i);s.forEach((m,y)=>{(y==="length"||y===mv||!Tu(y)&&y>=d)&&l(m)})}else switch((t!==void 0||s.has(void 0))&&l(s.get(t)),h&&l(s.get(mv)),e){case"add":u?h&&l(s.get("length")):(l(s.get(Op)),Jm(n)&&l(s.get(dE)));break;case"delete":u||(l(s.get(Op)),Jm(n)&&l(s.get(dE)));break;case"set":Jm(n)&&l(s.get(Op));break}}mR()}function q6(n,e){const t=zI.get(n);return t&&t.get(e)}function hm(n){const e=ji(n);return e===n?e:($o(e,"iterate",mv),wl(n)?e:e.map(Ru))}function mw(n){return $o(n=ji(n),"iterate",mv),n}function Dd(n,e){return Xh(n)?Ac(n)?_y(Ru(e)):_y(e):Ru(e)}const Q6={__proto__:null,[Symbol.iterator](){return p2(this,Symbol.iterator,n=>Dd(this,n))},concat(...n){return hm(this).concat(...n.map(e=>zn(e)?hm(e):e))},entries(){return p2(this,"entries",n=>(n[1]=Dd(this,n[1]),n))},every(n,e){return ph(this,"every",n,e,void 0,arguments)},filter(n,e){return ph(this,"filter",n,e,t=>t.map(i=>Dd(this,i)),arguments)},find(n,e){return ph(this,"find",n,e,t=>Dd(this,t),arguments)},findIndex(n,e){return ph(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return ph(this,"findLast",n,e,t=>Dd(this,t),arguments)},findLastIndex(n,e){return ph(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return ph(this,"forEach",n,e,void 0,arguments)},includes(...n){return g2(this,"includes",n)},indexOf(...n){return g2(this,"indexOf",n)},join(n){return hm(this).join(n)},lastIndexOf(...n){return g2(this,"lastIndexOf",n)},map(n,e){return ph(this,"map",n,e,void 0,arguments)},pop(){return K_(this,"pop")},push(...n){return K_(this,"push",n)},reduce(n,...e){return SP(this,"reduce",n,e)},reduceRight(n,...e){return SP(this,"reduceRight",n,e)},shift(){return K_(this,"shift")},some(n,e){return ph(this,"some",n,e,void 0,arguments)},splice(...n){return K_(this,"splice",n)},toReversed(){return hm(this).toReversed()},toSorted(n){return hm(this).toSorted(n)},toSpliced(...n){return hm(this).toSpliced(...n)},unshift(...n){return K_(this,"unshift",n)},values(){return p2(this,"values",n=>Dd(this,n))}};function p2(n,e,t){const i=mw(n),r=i[e]();return i!==n&&!wl(n)&&(r._next=r.next,r.next=()=>{const o=r._next();return o.done||(o.value=t(o.value)),o}),r}const e9=Array.prototype;function ph(n,e,t,i,r,o){const s=mw(n),l=s!==n&&!wl(n),u=s[e];if(u!==e9[e]){const m=u.apply(n,o);return l?Ru(m):m}let h=t;s!==n&&(l?h=function(m,y){return t.call(this,Dd(n,m),y,n)}:t.length>2&&(h=function(m,y){return t.call(this,m,y,n)}));const d=u.call(s,h,i);return l&&r?r(d):d}function SP(n,e,t,i){const r=mw(n);let o=t;return r!==n&&(wl(n)?t.length>3&&(o=function(s,l,u){return t.call(this,s,l,u,n)}):o=function(s,l,u){return t.call(this,s,Dd(n,l),u,n)}),r[e](o,...i)}function g2(n,e,t){const i=ji(n);$o(i,"iterate",mv);const r=i[e](...t);return(r===-1||r===!1)&&_w(t[0])?(t[0]=ji(t[0]),i[e](...t)):r}function K_(n,e,t=[]){zh(),gR();const i=ji(n)[e].apply(n,t);return mR(),Uh(),i}const t9=hR("__proto__,__v_isRef,__isVue"),B3=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Tu));function n9(n){Tu(n)||(n=String(n));const e=ji(this);return $o(e,"has",n),e.hasOwnProperty(n)}class Z3{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,i){if(t==="__v_skip")return e.__v_skip;const r=this._isReadonly,o=this._isShallow;if(t==="__v_isReactive")return!r;if(t==="__v_isReadonly")return r;if(t==="__v_isShallow")return o;if(t==="__v_raw")return i===(r?o?d9:X3:o?U3:z3).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(i)?e:void 0;const s=zn(e);if(!r){let u;if(s&&(u=Q6[t]))return u;if(t==="hasOwnProperty")return n9}const l=Reflect.get(e,t,Pr(e)?e:i);if((Tu(t)?B3.has(t):t9(t))||(r||$o(e,"get",t),o))return l;if(Pr(l)){const u=s&&hw(t)?l:l.value;return r&&Er(u)?pE(u):u}return Er(l)?r?pE(l):yw(l):l}}class W3 extends Z3{constructor(e=!1){super(!1,e)}set(e,t,i,r){let o=e[t];const s=zn(e)&&hw(t);if(!this._isShallow){const h=Xh(o);if(!wl(i)&&!Xh(i)&&(o=ji(o),i=ji(i)),!s&&Pr(o)&&!Pr(i))return h||(o.value=i),!0}const l=s?Number(t)<e.length:yr(e,t),u=Reflect.set(e,t,i,Pr(e)?e:r);return e===ji(r)&&(l?of(i,o)&&Th(e,"set",t,i):Th(e,"add",t,i)),u}deleteProperty(e,t){const i=yr(e,t);e[t];const r=Reflect.deleteProperty(e,t);return r&&i&&Th(e,"delete",t,void 0),r}has(e,t){const i=Reflect.has(e,t);return(!Tu(t)||!B3.has(t))&&$o(e,"has",t),i}ownKeys(e){return $o(e,"iterate",zn(e)?"length":Op),Reflect.ownKeys(e)}}class i9 extends Z3{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const r9=new W3,s9=new i9,o9=new W3(!0);const fE=n=>n,H1=n=>Reflect.getPrototypeOf(n);function a9(n,e,t){return function(...i){const r=this.__v_raw,o=ji(r),s=Jm(o),l=n==="entries"||n===Symbol.iterator&&s,u=n==="keys"&&s,h=r[n](...i),d=t?fE:e?_y:Ru;return!e&&$o(o,"iterate",u?dE:Op),{next(){const{value:m,done:y}=h.next();return y?{value:m,done:y}:{value:l?[d(m[0]),d(m[1])]:d(m),done:y}},[Symbol.iterator](){return this}}}}function K1(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function l9(n,e){const t={get(r){const o=this.__v_raw,s=ji(o),l=ji(r);n||(of(r,l)&&$o(s,"get",r),$o(s,"get",l));const{has:u}=H1(s),h=e?fE:n?_y:Ru;if(u.call(s,r))return h(o.get(r));if(u.call(s,l))return h(o.get(l));o!==s&&o.get(r)},get size(){const r=this.__v_raw;return!n&&$o(ji(r),"iterate",Op),r.size},has(r){const o=this.__v_raw,s=ji(o),l=ji(r);return n||(of(r,l)&&$o(s,"has",r),$o(s,"has",l)),r===l?o.has(r):o.has(r)||o.has(l)},forEach(r,o){const s=this,l=s.__v_raw,u=ji(l),h=e?fE:n?_y:Ru;return!n&&$o(u,"iterate",Op),l.forEach((d,m)=>r.call(o,h(d),h(m),s))}};return vo(t,n?{add:K1("add"),set:K1("set"),delete:K1("delete"),clear:K1("clear")}:{add(r){!e&&!wl(r)&&!Xh(r)&&(r=ji(r));const o=ji(this);return H1(o).has.call(o,r)||(o.add(r),Th(o,"add",r,r)),this},set(r,o){!e&&!wl(o)&&!Xh(o)&&(o=ji(o));const s=ji(this),{has:l,get:u}=H1(s);let h=l.call(s,r);h||(r=ji(r),h=l.call(s,r));const d=u.call(s,r);return s.set(r,o),h?of(o,d)&&Th(s,"set",r,o):Th(s,"add",r,o),this},delete(r){const o=ji(this),{has:s,get:l}=H1(o);let u=s.call(o,r);u||(r=ji(r),u=s.call(o,r)),l&&l.call(o,r);const h=o.delete(r);return u&&Th(o,"delete",r,void 0),h},clear(){const r=ji(this),o=r.size!==0,s=r.clear();return o&&Th(r,"clear",void 0,void 0),s}}),["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=a9(r,n,e)}),t}function vR(n,e){const t=l9(n,e);return(i,r,o)=>r==="__v_isReactive"?!n:r==="__v_isReadonly"?n:r==="__v_raw"?i:Reflect.get(yr(t,r)&&r in i?t:i,r,o)}const u9={get:vR(!1,!1)},c9={get:vR(!1,!0)},h9={get:vR(!0,!1)};const z3=new WeakMap,U3=new WeakMap,X3=new WeakMap,d9=new WeakMap;function f9(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function p9(n){return n.__v_skip||!Object.isExtensible(n)?0:f9(D6(n))}function yw(n){return Xh(n)?n:bR(n,!1,r9,u9,z3)}function g9(n){return bR(n,!1,o9,c9,U3)}function pE(n){return bR(n,!0,s9,h9,X3)}function bR(n,e,t,i,r){if(!Er(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const o=p9(n);if(o===0)return n;const s=r.get(n);if(s)return s;const l=new Proxy(n,o===2?i:t);return r.set(n,l),l}function Ac(n){return Xh(n)?Ac(n.__v_raw):!!(n&&n.__v_isReactive)}function Xh(n){return!!(n&&n.__v_isReadonly)}function wl(n){return!!(n&&n.__v_isShallow)}function _w(n){return n?!!n.__v_raw:!1}function ji(n){const e=n&&n.__v_raw;return e?ji(e):n}function xR(n){return!yr(n,"__v_skip")&&Object.isExtensible(n)&&A3(n,"__v_skip",!0),n}const Ru=n=>Er(n)?yw(n):n,_y=n=>Er(n)?pE(n):n;function Pr(n){return n?n.__v_isRef===!0:!1}function Ke(n){return Y3(n,!1)}function Ei(n){return Y3(n,!0)}function Y3(n,e){return Pr(n)?n:new m9(n,e)}class m9{constructor(e,t){this.dep=new _R,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:ji(e),this._value=t?e:Ru(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,i=this.__v_isShallow||wl(e)||Xh(e);e=i?e:ji(e),of(e,t)&&(this._rawValue=e,this._value=i?e:Ru(e),this.dep.trigger())}}function k(n){return Pr(n)?n.value:n}function y9(n){return ui(n)?n():k(n)}const _9={get:(n,e,t)=>e==="__v_raw"?n:k(Reflect.get(n,e,t)),set:(n,e,t,i)=>{const r=n[e];return Pr(r)&&!Pr(t)?(r.value=t,!0):Reflect.set(n,e,t,i)}};function H3(n){return Ac(n)?n:new Proxy(n,_9)}function v9(n){const e=zn(n)?new Array(n.length):{};for(const t in n)e[t]=j3(n,t);return e}class b9{constructor(e,t,i){this._object=e,this._key=t,this._defaultValue=i,this.__v_isRef=!0,this._value=void 0,this._raw=ji(e);let r=!0,o=e;if(!zn(e)||!hw(String(t)))do r=!_w(o)||wl(o);while(r&&(o=o.__v_raw));this._shallow=r}get value(){let e=this._object[this._key];return this._shallow&&(e=k(e)),this._value=e===void 0?this._defaultValue:e}set value(e){if(this._shallow&&Pr(this._raw[this._key])){const t=this._object[this._key];if(Pr(t)){t.value=e;return}}this._object[this._key]=e}get dep(){return q6(this._raw,this._key)}}class x9{constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function K3(n,e,t){return Pr(n)?n:ui(n)?new x9(n):Er(n)&&arguments.length>1?j3(n,e,t):Ke(n)}function j3(n,e,t){return new b9(n,e,t)}class I9{constructor(e,t,i){this.fn=e,this.setter=t,this._value=void 0,this.dep=new _R(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=gv-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=i}notify(){if(this.flags|=16,!(this.flags&8)&&Dr!==this)return G3(this,!0),!0}get value(){const e=this.dep.track();return N3(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function C9(n,e,t=!1){let i,r;return ui(n)?i=n:(i=n.get,r=n.set),new I9(i,r,t)}const j1={},UI=new WeakMap;let vp;function w9(n,e=!1,t=vp){if(t){let i=UI.get(t);i||UI.set(t,i=[]),i.push(n)}}function A9(n,e,t=Rr){const{immediate:i,deep:r,once:o,scheduler:s,augmentJob:l,call:u}=t,h=N=>r?N:wl(N)||r===!1||r===0?Rh(N,1):Rh(N);let d,m,y,x,C=!1,w=!1;if(Pr(n)?(m=()=>n.value,C=wl(n)):Ac(n)?(m=()=>h(n),C=!0):zn(n)?(w=!0,C=n.some(N=>Ac(N)||wl(N)),m=()=>n.map(N=>{if(Pr(N))return N.value;if(Ac(N))return h(N);if(ui(N))return u?u(N,2):N()})):ui(n)?e?m=u?()=>u(n,2):n:m=()=>{if(y){zh();try{y()}finally{Uh()}}const N=vp;vp=d;try{return u?u(n,3,[x]):n(x)}finally{vp=N}}:m=wc,e&&r){const N=m,V=r===!0?1/0:r;m=()=>Rh(N(),V)}const S=k3(),T=()=>{d.stop(),S&&S.active&&fR(S.effects,d)};if(o&&e){const N=e;e=(...V)=>{N(...V),T()}}let M=w?new Array(n.length).fill(j1):j1;const G=N=>{if(!(!(d.flags&1)||!d.dirty&&!N))if(e){const V=d.run();if(r||C||(w?V.some((W,j)=>of(W,M[j])):of(V,M))){y&&y();const W=vp;vp=d;try{const j=[V,M===j1?void 0:w&&M[0]===j1?[]:M,x];M=V,u?u(e,3,j):e(...j)}finally{vp=W}}}else d.run()};return l&&l(G),d=new L3(m),d.scheduler=s?()=>s(G,!1):G,x=N=>w9(N,!1,d),y=d.onStop=()=>{const N=UI.get(d);if(N){if(u)u(N,4);else for(const V of N)V();UI.delete(d)}},e?i?G(!0):M=d.run():s?s(G.bind(null,!0),!0):d.run(),T.pause=d.pause.bind(d),T.resume=d.resume.bind(d),T.stop=T,T}function Rh(n,e=1/0,t){if(e<=0||!Er(n)||n.__v_skip||(t=t||new Map,(t.get(n)||0)>=e))return n;if(t.set(n,e),e--,Pr(n))Rh(n.value,e,t);else if(zn(n))for(let i=0;i<n.length;i++)Rh(n[i],e,t);else if(Gy(n)||Jm(n))n.forEach(i=>{Rh(i,e,t)});else if(w3(n)){for(const i in n)Rh(n[i],e,t);for(const i of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,i)&&Rh(n[i],e,t)}return n}function rb(n,e,t,i){try{return i?n(...i):n()}catch(r){vw(r,e,t)}}function Mu(n,e,t,i){if(ui(n)){const r=rb(n,e,t,i);return r&&I3(r)&&r.catch(o=>{vw(o,e,t)}),r}if(zn(n)){const r=[];for(let o=0;o<n.length;o++)r.push(Mu(n[o],e,t,i));return r}}function vw(n,e,t,i=!0){const r=e?e.vnode:null,{errorHandler:o,throwUnhandledErrorInProduction:s}=e&&e.appContext.config||Rr;if(e){let l=e.parent;const u=e.proxy,h=`https://vuejs.org/error-reference/#runtime-${t}`;for(;l;){const d=l.ec;if(d){for(let m=0;m<d.length;m++)if(d[m](n,u,h)===!1)return}l=l.parent}if(o){zh(),rb(o,null,10,[n,u,h]),Uh();return}}S9(n,t,r,i,s)}function S9(n,e,t,i=!0,r=!1){if(r)throw n;console.error(n)}const va=[];let fc=-1;const qm=[];let Vd=null,Em=0;const $3=Promise.resolve();let XI=null;function aa(n){const e=XI||$3;return n?e.then(this?n.bind(this):n):e}function E9(n){let e=fc+1,t=va.length;for(;e<t;){const i=e+t>>>1,r=va[i],o=yv(r);o<n||o===n&&r.flags&2?e=i+1:t=i}return e}function IR(n){if(!(n.flags&1)){const e=yv(n),t=va[va.length-1];!t||!(n.flags&2)&&e>=yv(t)?va.push(n):va.splice(E9(e),0,n),n.flags|=1,J3()}}function J3(){XI||(XI=$3.then(Q3))}function T9(n){zn(n)?qm.push(...n):Vd&&n.id===-1?Vd.splice(Em+1,0,n):n.flags&1||(qm.push(n),n.flags|=1),J3()}function EP(n,e,t=fc+1){for(;t<va.length;t++){const i=va[t];if(i&&i.flags&2){if(n&&i.id!==n.uid)continue;va.splice(t,1),t--,i.flags&4&&(i.flags&=-2),i(),i.flags&4||(i.flags&=-2)}}}function q3(n){if(qm.length){const e=[...new Set(qm)].sort((t,i)=>yv(t)-yv(i));if(qm.length=0,Vd){Vd.push(...e);return}for(Vd=e,Em=0;Em<Vd.length;Em++){const t=Vd[Em];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Vd=null,Em=0}}const yv=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Q3(n){try{for(fc=0;fc<va.length;fc++){const e=va[fc];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),rb(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;fc<va.length;fc++){const e=va[fc];e&&(e.flags&=-2)}fc=-1,va.length=0,q3(),XI=null,(va.length||qm.length)&&Q3()}}let Lo=null,eN=null;function YI(n){const e=Lo;return Lo=n,eN=n&&n.type.__scopeId||null,e}function Xt(n,e=Lo,t){if(!e||n._n)return n;const i=(...r)=>{i._d&&jI(-1);const o=YI(e);let s;try{s=n(...r)}finally{YI(o),i._d&&jI(1)}return s};return i._n=!0,i._c=!0,i._d=!0,i}function Sn(n,e){if(Lo===null)return n;const t=Sw(Lo),i=n.dirs||(n.dirs=[]);for(let r=0;r<e.length;r++){let[o,s,l,u=Rr]=e[r];o&&(ui(o)&&(o={mounted:o,updated:o}),o.deep&&Rh(s),i.push({dir:o,instance:t,value:s,oldValue:void 0,arg:l,modifiers:u}))}return n}function ap(n,e,t,i){const r=n.dirs,o=e&&e.dirs;for(let s=0;s<r.length;s++){const l=r[s];o&&(l.oldValue=o[s].value);let u=l.dir[i];u&&(zh(),Mu(u,t,8,[n.el,l,n,e]),Uh())}}const tN=Symbol("_vte"),nN=n=>n.__isTeleport,W0=n=>n&&(n.disabled||n.disabled===""),TP=n=>n&&(n.defer||n.defer===""),RP=n=>typeof SVGElement<"u"&&n instanceof SVGElement,MP=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,gE=(n,e)=>{const t=n&&n.to;return ps(t)?e?e(t):null:t},iN={name:"Teleport",__isTeleport:!0,process(n,e,t,i,r,o,s,l,u,h){const{mc:d,pc:m,pbc:y,o:{insert:x,querySelector:C,createText:w,createComment:S}}=h,T=W0(e.props);let{shapeFlag:M,children:G,dynamicChildren:N}=e;if(n==null){const V=e.el=w(""),W=e.anchor=w("");x(V,t,i),x(W,t,i);const j=(te,ce)=>{M&16&&d(G,te,ce,r,o,s,l,u)},J=()=>{const te=e.target=gE(e.props,C),ce=rN(te,e,w,x);te&&(s!=="svg"&&RP(te)?s="svg":s!=="mathml"&&MP(te)&&(s="mathml"),r&&r.isCE&&(r.ce._teleportTargets||(r.ce._teleportTargets=new Set)).add(te),T||(j(te,ce),eI(e,!1)))};T&&(j(t,W),eI(e,!0)),TP(e.props)?(e.el.__isMounted=!1,_a(()=>{J(),delete e.el.__isMounted},o)):J()}else{if(TP(e.props)&&n.el.__isMounted===!1){_a(()=>{iN.process(n,e,t,i,r,o,s,l,u,h)},o);return}e.el=n.el,e.targetStart=n.targetStart;const V=e.anchor=n.anchor,W=e.target=n.target,j=e.targetAnchor=n.targetAnchor,J=W0(n.props),te=J?t:W,ce=J?V:j;if(s==="svg"||RP(W)?s="svg":(s==="mathml"||MP(W))&&(s="mathml"),N?(y(n.dynamicChildren,N,te,r,o,s,l),TR(n,e,!0)):u||m(n,e,te,ce,r,o,s,l,!1),T)J?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):$1(e,t,V,h,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const pe=e.target=gE(e.props,C);pe&&$1(e,pe,null,h,0)}else J&&$1(e,W,j,h,1);eI(e,T)}},remove(n,e,t,{um:i,o:{remove:r}},o){const{shapeFlag:s,children:l,anchor:u,targetStart:h,targetAnchor:d,target:m,props:y}=n;if(m&&(r(h),r(d)),o&&r(u),s&16){const x=o||!W0(y);for(let C=0;C<l.length;C++){const w=l[C];i(w,e,t,x,!!w.dynamicChildren)}}},move:$1,hydrate:R9};function $1(n,e,t,{o:{insert:i},m:r},o=2){o===0&&i(n.targetAnchor,e,t);const{el:s,anchor:l,shapeFlag:u,children:h,props:d}=n,m=o===2;if(m&&i(s,e,t),(!m||W0(d))&&u&16)for(let y=0;y<h.length;y++)r(h[y],e,t,2);m&&i(l,e,t)}function R9(n,e,t,i,r,o,{o:{nextSibling:s,parentNode:l,querySelector:u,insert:h,createText:d}},m){function y(w,S,T,M){S.anchor=m(s(w),S,l(w),t,i,r,o),S.targetStart=T,S.targetAnchor=M}const x=e.target=gE(e.props,u),C=W0(e.props);if(x){const w=x._lpa||x.firstChild;if(e.shapeFlag&16)if(C)y(n,e,w,w&&s(w));else{e.anchor=s(n);let S=w;for(;S;){if(S&&S.nodeType===8){if(S.data==="teleport start anchor")e.targetStart=S;else if(S.data==="teleport anchor"){e.targetAnchor=S,x._lpa=e.targetAnchor&&s(e.targetAnchor);break}}S=s(S)}e.targetAnchor||rN(x,e,d,h),m(w&&s(w),e,x,t,i,r,o)}eI(e,C)}else C&&e.shapeFlag&16&&y(n,e,n,s(n));return e.anchor&&s(e.anchor)}const bw=iN;function eI(n,e){const t=n.ctx;if(t&&t.ut){let i,r;for(e?(i=n.el,r=n.anchor):(i=n.targetStart,r=n.targetAnchor);i&&i!==r;)i.nodeType===1&&i.setAttribute("data-v-owner",t.uid),i=i.nextSibling;t.ut()}}function rN(n,e,t,i){const r=e.targetStart=t(""),o=e.targetAnchor=t("");return r[tN]=o,n&&(i(r,n),i(o,n)),o}const wh=Symbol("_leaveCb"),J1=Symbol("_enterCb");function M9(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return gr(()=>{n.isMounted=!0}),og(()=>{n.isUnmounting=!0}),n}const Dl=[Function,Array],sN={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Dl,onEnter:Dl,onAfterEnter:Dl,onEnterCancelled:Dl,onBeforeLeave:Dl,onLeave:Dl,onAfterLeave:Dl,onLeaveCancelled:Dl,onBeforeAppear:Dl,onAppear:Dl,onAfterAppear:Dl,onAppearCancelled:Dl},oN=n=>{const e=n.subTree;return e.component?oN(e.component):e},k9={name:"BaseTransition",props:sN,setup(n,{slots:e}){const t=ob(),i=M9();return()=>{const r=e.default&&uN(e.default(),!0);if(!r||!r.length)return;const o=aN(r),s=ji(n),{mode:l}=s;if(i.isLeaving)return m2(o);const u=kP(o);if(!u)return m2(o);let h=mE(u,s,i,t,m=>h=m);u.type!==qo&&_v(u,h);let d=t.subTree&&kP(t.subTree);if(d&&d.type!==qo&&!Ap(d,u)&&oN(t).type!==qo){let m=mE(d,s,i,t);if(_v(d,m),l==="out-in"&&u.type!==qo)return i.isLeaving=!0,m.afterLeave=()=>{i.isLeaving=!1,t.job.flags&8||t.update(),delete m.afterLeave,d=void 0},m2(o);l==="in-out"&&u.type!==qo?m.delayLeave=(y,x,C)=>{const w=lN(i,d);w[String(d.key)]=d,y[wh]=()=>{x(),y[wh]=void 0,delete h.delayedLeave,d=void 0},h.delayedLeave=()=>{C(),delete h.delayedLeave,d=void 0}}:d=void 0}else d&&(d=void 0);return o}}};function aN(n){let e=n[0];if(n.length>1){for(const t of n)if(t.type!==qo){e=t;break}}return e}const L9=k9;function lN(n,e){const{leavingVNodes:t}=n;let i=t.get(e.type);return i||(i=Object.create(null),t.set(e.type,i)),i}function mE(n,e,t,i,r){const{appear:o,mode:s,persisted:l=!1,onBeforeEnter:u,onEnter:h,onAfterEnter:d,onEnterCancelled:m,onBeforeLeave:y,onLeave:x,onAfterLeave:C,onLeaveCancelled:w,onBeforeAppear:S,onAppear:T,onAfterAppear:M,onAppearCancelled:G}=e,N=String(n.key),V=lN(t,n),W=(te,ce)=>{te&&Mu(te,i,9,ce)},j=(te,ce)=>{const pe=ce[1];W(te,ce),zn(te)?te.every(Y=>Y.length<=1)&&pe():te.length<=1&&pe()},J={mode:s,persisted:l,beforeEnter(te){let ce=u;if(!t.isMounted)if(o)ce=S||u;else return;te[wh]&&te[wh](!0);const pe=V[N];pe&&Ap(n,pe)&&pe.el[wh]&&pe.el[wh](),W(ce,[te])},enter(te){let ce=h,pe=d,Y=m;if(!t.isMounted)if(o)ce=T||h,pe=M||d,Y=G||m;else return;let he=!1;const D=te[J1]=re=>{he||(he=!0,re?W(Y,[te]):W(pe,[te]),J.delayedLeave&&J.delayedLeave(),te[J1]=void 0)};ce?j(ce,[te,D]):D()},leave(te,ce){const pe=String(n.key);if(te[J1]&&te[J1](!0),t.isUnmounting)return ce();W(y,[te]);let Y=!1;const he=te[wh]=D=>{Y||(Y=!0,ce(),D?W(w,[te]):W(C,[te]),te[wh]=void 0,V[pe]===n&&delete V[pe])};V[pe]=n,x?j(x,[te,he]):he()},clone(te){const ce=mE(te,e,t,i,r);return r&&r(ce),ce}};return J}function m2(n){if(xw(n))return n=df(n),n.children=null,n}function kP(n){if(!xw(n))return nN(n.type)&&n.children?aN(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&ui(t.default))return t.default()}}function _v(n,e){n.shapeFlag&6&&n.component?(n.transition=e,_v(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function uN(n,e=!1,t){let i=[],r=0;for(let o=0;o<n.length;o++){let s=n[o];const l=t==null?s.key:String(t)+String(s.key!=null?s.key:o);s.type===Et?(s.patchFlag&128&&r++,i=i.concat(uN(s.children,e,l))):(e||s.type!==qo)&&i.push(l!=null?df(s,{key:l}):s)}if(r>1)for(let o=0;o<i.length;o++)i[o].patchFlag=-2;return i}function st(n,e){return ui(n)?vo({name:n.name},e,{setup:n}):n}function cN(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function vv(n){const e=ob(),t=Ei(null);if(e){const r=e.refs===Rr?e.refs={}:e.refs;Object.defineProperty(r,n,{enumerable:!0,get:()=>t.value,set:o=>t.value=o})}return t}const HI=new WeakMap;function z0(n,e,t,i,r=!1){if(zn(n)){n.forEach((C,w)=>z0(C,e&&(zn(e)?e[w]:e),t,i,r));return}if(Qm(i)&&!r){i.shapeFlag&512&&i.type.__asyncResolved&&i.component.subTree.component&&z0(n,e,t,i.component.subTree);return}const o=i.shapeFlag&4?Sw(i.component):i.el,s=r?null:o,{i:l,r:u}=n,h=e&&e.r,d=l.refs===Rr?l.refs={}:l.refs,m=l.setupState,y=ji(m),x=m===Rr?x3:C=>yr(y,C);if(h!=null&&h!==u){if(LP(e),ps(h))d[h]=null,x(h)&&(m[h]=null);else if(Pr(h)){h.value=null;const C=e;C.k&&(d[C.k]=null)}}if(ui(u))rb(u,l,12,[s,d]);else{const C=ps(u),w=Pr(u);if(C||w){const S=()=>{if(n.f){const T=C?x(u)?m[u]:d[u]:u.value;if(r)zn(T)&&fR(T,o);else if(zn(T))T.includes(o)||T.push(o);else if(C)d[u]=[o],x(u)&&(m[u]=d[u]);else{const M=[o];u.value=M,n.k&&(d[n.k]=M)}}else C?(d[u]=s,x(u)&&(m[u]=s)):w&&(u.value=s,n.k&&(d[n.k]=s))};if(s){const T=()=>{S(),HI.delete(n)};T.id=-1,HI.set(n,T),_a(T,t)}else LP(n),S()}}}function LP(n){const e=HI.get(n);e&&(e.flags|=8,HI.delete(n))}gw().requestIdleCallback;gw().cancelIdleCallback;const Qm=n=>!!n.type.__asyncLoader,xw=n=>n.type.__isKeepAlive;function hN(n,e){dN(n,"a",e)}function P9(n,e){dN(n,"da",e)}function dN(n,e,t=Qo){const i=n.__wdc||(n.__wdc=()=>{let r=t;for(;r;){if(r.isDeactivated)return;r=r.parent}return n()});if(Iw(e,i,t),t){let r=t.parent;for(;r&&r.parent;)xw(r.parent.vnode)&&G9(i,e,t,r),r=r.parent}}function G9(n,e,t,i){const r=Iw(e,n,i,!0);Ds(()=>{fR(i[e],r)},t)}function Iw(n,e,t=Qo,i=!1){if(t){const r=t[n]||(t[n]=[]),o=e.__weh||(e.__weh=(...s)=>{zh();const l=ab(t),u=Mu(e,t,n,s);return l(),Uh(),u});return i?r.unshift(o):r.push(o),o}}const ed=n=>(e,t=Qo)=>{(!Iv||n==="sp")&&Iw(n,(...i)=>e(...i),t)},fN=ed("bm"),gr=ed("m"),F9=ed("bu"),O9=ed("u"),og=ed("bum"),Ds=ed("um"),N9=ed("sp"),D9=ed("rtg"),V9=ed("rtc");function B9(n,e=Qo){Iw("ec",n,e)}const CR="components",Z9="directives";function W9(n,e){return wR(CR,n,!0,e)||n}const pN=Symbol.for("v-ndc");function sb(n){return ps(n)?wR(CR,n,!1)||n:n||pN}function Tl(n){return wR(Z9,n)}function wR(n,e,t=!0,i=!1){const r=Lo||Qo;if(r){const o=r.type;if(n===CR){const l=RU(o,!1);if(l&&(l===e||l===ql(e)||l===fw(ql(e))))return o}const s=PP(r[n]||o[n],e)||PP(r.appContext[n],e);return!s&&i?o:s}}function PP(n,e){return n&&(n[e]||n[ql(e)]||n[fw(ql(e))])}function yi(n,e,t,i){let r;const o=t,s=zn(n);if(s||ps(n)){const l=s&&Ac(n);let u=!1,h=!1;l&&(u=!wl(n),h=Xh(n),n=mw(n)),r=new Array(n.length);for(let d=0,m=n.length;d<m;d++)r[d]=e(u?h?_y(Ru(n[d])):Ru(n[d]):n[d],d,void 0,o)}else if(typeof n=="number"){r=new Array(n);for(let l=0;l<n;l++)r[l]=e(l+1,l,void 0,o)}else if(Er(n))if(n[Symbol.iterator])r=Array.from(n,(l,u)=>e(l,u,void 0,o));else{const l=Object.keys(n);r=new Array(l.length);for(let u=0,h=l.length;u<h;u++){const d=l[u];r[u]=e(n[d],d,u,o)}}else r=[];return r}function Jn(n,e,t={},i,r){if(Lo.ce||Lo.parent&&Qm(Lo.parent)&&Lo.parent.ce){const h=Object.keys(t).length>0;return e!=="default"&&(t.name=e),U(),Mt(Et,null,[mt("slot",t,i&&i())],h?-2:64)}let o=n[e];o&&o._c&&(o._d=!1),U();const s=o&&gN(o(t)),l=t.key||s&&s.key,u=Mt(Et,{key:(l&&!Tu(l)?l:`_${e}`)+(!s&&i?"_fb":"")},s||(i?i():[]),s&&n._===1?64:-2);return!r&&u.scopeId&&(u.slotScopeIds=[u.scopeId+"-s"]),o&&o._c&&(o._d=!0),u}function gN(n){return n.some(e=>xv(e)?!(e.type===qo||e.type===Et&&!gN(e.children)):!0)?n:null}const yE=n=>n?PN(n)?Sw(n):yE(n.parent):null,U0=vo(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>yE(n.parent),$root:n=>yE(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>yN(n),$forceUpdate:n=>n.f||(n.f=()=>{IR(n.update)}),$nextTick:n=>n.n||(n.n=aa.bind(n.proxy)),$watch:n=>eU.bind(n)}),y2=(n,e)=>n!==Rr&&!n.__isScriptSetup&&yr(n,e),z9={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:i,data:r,props:o,accessCache:s,type:l,appContext:u}=n;if(e[0]!=="$"){const y=s[e];if(y!==void 0)switch(y){case 1:return i[e];case 2:return r[e];case 4:return t[e];case 3:return o[e]}else{if(y2(i,e))return s[e]=1,i[e];if(r!==Rr&&yr(r,e))return s[e]=2,r[e];if(yr(o,e))return s[e]=3,o[e];if(t!==Rr&&yr(t,e))return s[e]=4,t[e];_E&&(s[e]=0)}}const h=U0[e];let d,m;if(h)return e==="$attrs"&&$o(n.attrs,"get",""),h(n);if((d=l.__cssModules)&&(d=d[e]))return d;if(t!==Rr&&yr(t,e))return s[e]=4,t[e];if(m=u.config.globalProperties,yr(m,e))return m[e]},set({_:n},e,t){const{data:i,setupState:r,ctx:o}=n;return y2(r,e)?(r[e]=t,!0):i!==Rr&&yr(i,e)?(i[e]=t,!0):yr(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(o[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:i,appContext:r,props:o,type:s}},l){let u;return!!(t[l]||n!==Rr&&l[0]!=="$"&&yr(n,l)||y2(e,l)||yr(o,l)||yr(i,l)||yr(U0,l)||yr(r.config.globalProperties,l)||(u=s.__cssModules)&&u[l])},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:yr(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function GP(n){return zn(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let _E=!0;function U9(n){const e=yN(n),t=n.proxy,i=n.ctx;_E=!1,e.beforeCreate&&FP(e.beforeCreate,n,"bc");const{data:r,computed:o,methods:s,watch:l,provide:u,inject:h,created:d,beforeMount:m,mounted:y,beforeUpdate:x,updated:C,activated:w,deactivated:S,beforeDestroy:T,beforeUnmount:M,destroyed:G,unmounted:N,render:V,renderTracked:W,renderTriggered:j,errorCaptured:J,serverPrefetch:te,expose:ce,inheritAttrs:pe,components:Y,directives:he,filters:D}=e;if(h&&X9(h,i,null),s)for(const fe in s){const Le=s[fe];ui(Le)&&(i[fe]=Le.bind(t))}if(r){const fe=r.call(t,t);Er(fe)&&(n.data=yw(fe))}if(_E=!0,o)for(const fe in o){const Le=o[fe],we=ui(Le)?Le.bind(t,t):ui(Le.get)?Le.get.bind(t,t):wc,se=!ui(Le)&&ui(Le.set)?Le.set.bind(t):wc,Q=At({get:we,set:se});Object.defineProperty(i,fe,{enumerable:!0,configurable:!0,get:()=>Q.value,set:q=>Q.value=q})}if(l)for(const fe in l)mN(l[fe],i,t,fe);if(u){const fe=ui(u)?u.call(t):u;Reflect.ownKeys(fe).forEach(Le=>{Cw(Le,fe[Le])})}d&&FP(d,n,"c");function le(fe,Le){zn(Le)?Le.forEach(we=>fe(we.bind(t))):Le&&fe(Le.bind(t))}if(le(fN,m),le(gr,y),le(F9,x),le(O9,C),le(hN,w),le(P9,S),le(B9,J),le(V9,W),le(D9,j),le(og,M),le(Ds,N),le(N9,te),zn(ce))if(ce.length){const fe=n.exposed||(n.exposed={});ce.forEach(Le=>{Object.defineProperty(fe,Le,{get:()=>t[Le],set:we=>t[Le]=we,enumerable:!0})})}else n.exposed||(n.exposed={});V&&n.render===wc&&(n.render=V),pe!=null&&(n.inheritAttrs=pe),Y&&(n.components=Y),he&&(n.directives=he),te&&cN(n)}function X9(n,e,t=wc){zn(n)&&(n=vE(n));for(const i in n){const r=n[i];let o;Er(r)?"default"in r?o=Go(r.from||i,r.default,!0):o=Go(r.from||i):o=Go(r),Pr(o)?Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:()=>o.value,set:s=>o.value=s}):e[i]=o}}function FP(n,e,t){Mu(zn(n)?n.map(i=>i.bind(e.proxy)):n.bind(e.proxy),e,t)}function mN(n,e,t,i){let r=i.includes(".")?vN(t,i):()=>t[i];if(ps(n)){const o=e[n];ui(o)&&kt(r,o)}else if(ui(n))kt(r,n.bind(t));else if(Er(n))if(zn(n))n.forEach(o=>mN(o,e,t,i));else{const o=ui(n.handler)?n.handler.bind(t):e[n.handler];ui(o)&&kt(r,o,n)}}function yN(n){const e=n.type,{mixins:t,extends:i}=e,{mixins:r,optionsCache:o,config:{optionMergeStrategies:s}}=n.appContext,l=o.get(e);let u;return l?u=l:!r.length&&!t&&!i?u=e:(u={},r.length&&r.forEach(h=>KI(u,h,s,!0)),KI(u,e,s)),Er(e)&&o.set(e,u),u}function KI(n,e,t,i=!1){const{mixins:r,extends:o}=e;o&&KI(n,o,t,!0),r&&r.forEach(s=>KI(n,s,t,!0));for(const s in e)if(!(i&&s==="expose")){const l=Y9[s]||t&&t[s];n[s]=l?l(n[s],e[s]):e[s]}return n}const Y9={data:OP,props:NP,emits:NP,methods:y0,computed:y0,beforeCreate:ma,created:ma,beforeMount:ma,mounted:ma,beforeUpdate:ma,updated:ma,beforeDestroy:ma,beforeUnmount:ma,destroyed:ma,unmounted:ma,activated:ma,deactivated:ma,errorCaptured:ma,serverPrefetch:ma,components:y0,directives:y0,watch:K9,provide:OP,inject:H9};function OP(n,e){return e?n?function(){return vo(ui(n)?n.call(this,this):n,ui(e)?e.call(this,this):e)}:e:n}function H9(n,e){return y0(vE(n),vE(e))}function vE(n){if(zn(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function ma(n,e){return n?[...new Set([].concat(n,e))]:e}function y0(n,e){return n?vo(Object.create(null),n,e):e}function NP(n,e){return n?zn(n)&&zn(e)?[...new Set([...n,...e])]:vo(Object.create(null),GP(n),GP(e??{})):e}function K9(n,e){if(!n)return e;if(!e)return n;const t=vo(Object.create(null),n);for(const i in e)t[i]=ma(n[i],e[i]);return t}function _N(){return{app:null,config:{isNativeTag:x3,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let j9=0;function $9(n,e){return function(i,r=null){ui(i)||(i=vo({},i)),r!=null&&!Er(r)&&(r=null);const o=_N(),s=new WeakSet,l=[];let u=!1;const h=o.app={_uid:j9++,_component:i,_props:r,_container:null,_context:o,_instance:null,version:LU,get config(){return o.config},set config(d){},use(d,...m){return s.has(d)||(d&&ui(d.install)?(s.add(d),d.install(h,...m)):ui(d)&&(s.add(d),d(h,...m))),h},mixin(d){return o.mixins.includes(d)||o.mixins.push(d),h},component(d,m){return m?(o.components[d]=m,h):o.components[d]},directive(d,m){return m?(o.directives[d]=m,h):o.directives[d]},mount(d,m,y){if(!u){const x=h._ceVNode||mt(i,r);return x.appContext=o,y===!0?y="svg":y===!1&&(y=void 0),n(x,d,y),u=!0,h._container=d,d.__vue_app__=h,Sw(x.component)}},onUnmount(d){l.push(d)},unmount(){u&&(Mu(l,h._instance,16),n(null,h._container),delete h._container.__vue_app__)},provide(d,m){return o.provides[d]=m,h},runWithContext(d){const m=Np;Np=h;try{return d()}finally{Np=m}}};return h}}let Np=null;function Cw(n,e){if(Qo){let t=Qo.provides;const i=Qo.parent&&Qo.parent.provides;i===t&&(t=Qo.provides=Object.create(i)),t[n]=e}}function Go(n,e,t=!1){const i=ob();if(i||Np){let r=Np?Np._context.provides:i?i.parent==null||i.ce?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:void 0;if(r&&n in r)return r[n];if(arguments.length>1)return t&&ui(e)?e.call(i&&i.proxy):e}}function J9(){return!!(ob()||Np)}const q9=Symbol.for("v-scx"),Q9=()=>Go(q9);function Ss(n,e){return AR(n,null,e)}function kt(n,e,t){return AR(n,e,t)}function AR(n,e,t=Rr){const{immediate:i,deep:r,flush:o,once:s}=t,l=vo({},t),u=e&&i||!e&&o!=="post";let h;if(Iv){if(o==="sync"){const x=Q9();h=x.__watcherHandles||(x.__watcherHandles=[])}else if(!u){const x=()=>{};return x.stop=wc,x.resume=wc,x.pause=wc,x}}const d=Qo;l.call=(x,C,w)=>Mu(x,d,C,w);let m=!1;o==="post"?l.scheduler=x=>{_a(x,d&&d.suspense)}:o!=="sync"&&(m=!0,l.scheduler=(x,C)=>{C?x():IR(x)}),l.augmentJob=x=>{e&&(x.flags|=4),m&&(x.flags|=2,d&&(x.id=d.uid,x.i=d))};const y=A9(n,e,l);return Iv&&(h?h.push(y):u&&y()),y}function eU(n,e,t){const i=this.proxy,r=ps(n)?n.includes(".")?vN(i,n):()=>i[n]:n.bind(i,i);let o;ui(e)?o=e:(o=e.handler,t=e);const s=ab(this),l=AR(r,o.bind(i),t);return s(),l}function vN(n,e){const t=e.split(".");return()=>{let i=n;for(let r=0;r<t.length&&i;r++)i=i[t[r]];return i}}const tU=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${ql(e)}Modifiers`]||n[`${xf(e)}Modifiers`];function nU(n,e,...t){if(n.isUnmounted)return;const i=n.vnode.props||Rr;let r=t;const o=e.startsWith("update:"),s=o&&tU(i,e.slice(7));s&&(s.trim&&(r=t.map(d=>ps(d)?d.trim():d)),s.number&&(r=t.map(pw)));let l,u=i[l=h2(e)]||i[l=h2(ql(e))];!u&&o&&(u=i[l=h2(xf(e))]),u&&Mu(u,n,6,r);const h=i[l+"Once"];if(h){if(!n.emitted)n.emitted={};else if(n.emitted[l])return;n.emitted[l]=!0,Mu(h,n,6,r)}}const iU=new WeakMap;function bN(n,e,t=!1){const i=t?iU:e.emitsCache,r=i.get(n);if(r!==void 0)return r;const o=n.emits;let s={},l=!1;if(!ui(n)){const u=h=>{const d=bN(h,e,!0);d&&(l=!0,vo(s,d))};!t&&e.mixins.length&&e.mixins.forEach(u),n.extends&&u(n.extends),n.mixins&&n.mixins.forEach(u)}return!o&&!l?(Er(n)&&i.set(n,null),null):(zn(o)?o.forEach(u=>s[u]=null):vo(s,o),Er(n)&&i.set(n,s),s)}function ww(n,e){return!n||!cw(e)?!1:(e=e.slice(2).replace(/Once$/,""),yr(n,e[0].toLowerCase()+e.slice(1))||yr(n,xf(e))||yr(n,e))}function DP(n){const{type:e,vnode:t,proxy:i,withProxy:r,propsOptions:[o],slots:s,attrs:l,emit:u,render:h,renderCache:d,props:m,data:y,setupState:x,ctx:C,inheritAttrs:w}=n,S=YI(n);let T,M;try{if(t.shapeFlag&4){const N=r||i,V=N;T=gc(h.call(V,N,d,m,x,y,C)),M=l}else{const N=e;T=gc(N.length>1?N(m,{attrs:l,slots:s,emit:u}):N(m,null)),M=e.props?l:rU(l)}}catch(N){X0.length=0,vw(N,n,1),T=mt(qo)}let G=T;if(M&&w!==!1){const N=Object.keys(M),{shapeFlag:V}=G;N.length&&V&7&&(o&&N.some(dR)&&(M=sU(M,o)),G=df(G,M,!1,!0))}return t.dirs&&(G=df(G,null,!1,!0),G.dirs=G.dirs?G.dirs.concat(t.dirs):t.dirs),t.transition&&_v(G,t.transition),T=G,YI(S),T}const rU=n=>{let e;for(const t in n)(t==="class"||t==="style"||cw(t))&&((e||(e={}))[t]=n[t]);return e},sU=(n,e)=>{const t={};for(const i in n)(!dR(i)||!(i.slice(9)in e))&&(t[i]=n[i]);return t};function oU(n,e,t){const{props:i,children:r,component:o}=n,{props:s,children:l,patchFlag:u}=e,h=o.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&u>=0){if(u&1024)return!0;if(u&16)return i?VP(i,s,h):!!s;if(u&8){const d=e.dynamicProps;for(let m=0;m<d.length;m++){const y=d[m];if(s[y]!==i[y]&&!ww(h,y))return!0}}}else return(r||l)&&(!l||!l.$stable)?!0:i===s?!1:i?s?VP(i,s,h):!0:!!s;return!1}function VP(n,e,t){const i=Object.keys(e);if(i.length!==Object.keys(n).length)return!0;for(let r=0;r<i.length;r++){const o=i[r];if(e[o]!==n[o]&&!ww(t,o))return!0}return!1}function aU({vnode:n,parent:e},t){for(;e;){const i=e.subTree;if(i.suspense&&i.suspense.activeBranch===n&&(i.el=n.el),i===n)(n=e.vnode).el=t,e=e.parent;else break}}const xN={},IN=()=>Object.create(xN),CN=n=>Object.getPrototypeOf(n)===xN;function lU(n,e,t,i=!1){const r={},o=IN();n.propsDefaults=Object.create(null),wN(n,e,r,o);for(const s in n.propsOptions[0])s in r||(r[s]=void 0);t?n.props=i?r:g9(r):n.type.props?n.props=r:n.props=o,n.attrs=o}function uU(n,e,t,i){const{props:r,attrs:o,vnode:{patchFlag:s}}=n,l=ji(r),[u]=n.propsOptions;let h=!1;if((i||s>0)&&!(s&16)){if(s&8){const d=n.vnode.dynamicProps;for(let m=0;m<d.length;m++){let y=d[m];if(ww(n.emitsOptions,y))continue;const x=e[y];if(u)if(yr(o,y))x!==o[y]&&(o[y]=x,h=!0);else{const C=ql(y);r[C]=bE(u,l,C,x,n,!1)}else x!==o[y]&&(o[y]=x,h=!0)}}}else{wN(n,e,r,o)&&(h=!0);let d;for(const m in l)(!e||!yr(e,m)&&((d=xf(m))===m||!yr(e,d)))&&(u?t&&(t[m]!==void 0||t[d]!==void 0)&&(r[m]=bE(u,l,m,void 0,n,!0)):delete r[m]);if(o!==l)for(const m in o)(!e||!yr(e,m))&&(delete o[m],h=!0)}h&&Th(n.attrs,"set","")}function wN(n,e,t,i){const[r,o]=n.propsOptions;let s=!1,l;if(e)for(let u in e){if(V0(u))continue;const h=e[u];let d;r&&yr(r,d=ql(u))?!o||!o.includes(d)?t[d]=h:(l||(l={}))[d]=h:ww(n.emitsOptions,u)||(!(u in i)||h!==i[u])&&(i[u]=h,s=!0)}if(o){const u=ji(t),h=l||Rr;for(let d=0;d<o.length;d++){const m=o[d];t[m]=bE(r,u,m,h[m],n,!yr(h,m))}}return s}function bE(n,e,t,i,r,o){const s=n[t];if(s!=null){const l=yr(s,"default");if(l&&i===void 0){const u=s.default;if(s.type!==Function&&!s.skipFactory&&ui(u)){const{propsDefaults:h}=r;if(t in h)i=h[t];else{const d=ab(r);i=h[t]=u.call(null,e),d()}}else i=u;r.ce&&r.ce._setProp(t,i)}s[0]&&(o&&!l?i=!1:s[1]&&(i===""||i===xf(t))&&(i=!0))}return i}const cU=new WeakMap;function AN(n,e,t=!1){const i=t?cU:e.propsCache,r=i.get(n);if(r)return r;const o=n.props,s={},l=[];let u=!1;if(!ui(n)){const d=m=>{u=!0;const[y,x]=AN(m,e,!0);vo(s,y),x&&l.push(...x)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!o&&!u)return Er(n)&&i.set(n,$m),$m;if(zn(o))for(let d=0;d<o.length;d++){const m=ql(o[d]);BP(m)&&(s[m]=Rr)}else if(o)for(const d in o){const m=ql(d);if(BP(m)){const y=o[d],x=s[m]=zn(y)||ui(y)?{type:y}:vo({},y),C=x.type;let w=!1,S=!0;if(zn(C))for(let T=0;T<C.length;++T){const M=C[T],G=ui(M)&&M.name;if(G==="Boolean"){w=!0;break}else G==="String"&&(S=!1)}else w=ui(C)&&C.name==="Boolean";x[0]=w,x[1]=S,(w||yr(x,"default"))&&l.push(m)}}const h=[s,l];return Er(n)&&i.set(n,h),h}function BP(n){return n[0]!=="$"&&!V0(n)}const SR=n=>n==="_"||n==="_ctx"||n==="$stable",ER=n=>zn(n)?n.map(gc):[gc(n)],hU=(n,e,t)=>{if(e._n)return e;const i=Xt((...r)=>ER(e(...r)),t);return i._c=!1,i},SN=(n,e,t)=>{const i=n._ctx;for(const r in n){if(SR(r))continue;const o=n[r];if(ui(o))e[r]=hU(r,o,i);else if(o!=null){const s=ER(o);e[r]=()=>s}}},EN=(n,e)=>{const t=ER(e);n.slots.default=()=>t},TN=(n,e,t)=>{for(const i in e)(t||!SR(i))&&(n[i]=e[i])},dU=(n,e,t)=>{const i=n.slots=IN();if(n.vnode.shapeFlag&32){const r=e._;r?(TN(i,e,t),t&&A3(i,"_",r,!0)):SN(e,i)}else e&&EN(n,e)},fU=(n,e,t)=>{const{vnode:i,slots:r}=n;let o=!0,s=Rr;if(i.shapeFlag&32){const l=e._;l?t&&l===1?o=!1:TN(r,e,t):(o=!e.$stable,SN(e,r)),s=e}else e&&(EN(n,e),s={default:1});if(o)for(const l in r)!SR(l)&&s[l]==null&&delete r[l]},_a=_U;function pU(n){return gU(n)}function gU(n,e){const t=gw();t.__VUE__=!0;const{insert:i,remove:r,patchProp:o,createElement:s,createText:l,createComment:u,setText:h,setElementText:d,parentNode:m,nextSibling:y,setScopeId:x=wc,insertStaticContent:C}=n,w=(Ne,Be,z,We=null,ke=null,ge=null,ie=void 0,Ce=null,Te=!!Be.dynamicChildren)=>{if(Ne===Be)return;Ne&&!Ap(Ne,Be)&&(We=Pt(Ne),q(Ne,ke,ge,!0),Ne=null),Be.patchFlag===-2&&(Te=!1,Be.dynamicChildren=null);const{type:De,ref:Ze,shapeFlag:Je}=Be;switch(De){case Aw:S(Ne,Be,z,We);break;case qo:T(Ne,Be,z,We);break;case v2:Ne==null&&M(Be,z,We,ie);break;case Et:Y(Ne,Be,z,We,ke,ge,ie,Ce,Te);break;default:Je&1?V(Ne,Be,z,We,ke,ge,ie,Ce,Te):Je&6?he(Ne,Be,z,We,ke,ge,ie,Ce,Te):(Je&64||Je&128)&&De.process(Ne,Be,z,We,ke,ge,ie,Ce,Te,yn)}Ze!=null&&ke?z0(Ze,Ne&&Ne.ref,ge,Be||Ne,!Be):Ze==null&&Ne&&Ne.ref!=null&&z0(Ne.ref,null,ge,Ne,!0)},S=(Ne,Be,z,We)=>{if(Ne==null)i(Be.el=l(Be.children),z,We);else{const ke=Be.el=Ne.el;Be.children!==Ne.children&&h(ke,Be.children)}},T=(Ne,Be,z,We)=>{Ne==null?i(Be.el=u(Be.children||""),z,We):Be.el=Ne.el},M=(Ne,Be,z,We)=>{[Ne.el,Ne.anchor]=C(Ne.children,Be,z,We,Ne.el,Ne.anchor)},G=({el:Ne,anchor:Be},z,We)=>{let ke;for(;Ne&&Ne!==Be;)ke=y(Ne),i(Ne,z,We),Ne=ke;i(Be,z,We)},N=({el:Ne,anchor:Be})=>{let z;for(;Ne&&Ne!==Be;)z=y(Ne),r(Ne),Ne=z;r(Be)},V=(Ne,Be,z,We,ke,ge,ie,Ce,Te)=>{if(Be.type==="svg"?ie="svg":Be.type==="math"&&(ie="mathml"),Ne==null)W(Be,z,We,ke,ge,ie,Ce,Te);else{const De=Ne.el&&Ne.el._isVueCE?Ne.el:null;try{De&&De._beginPatch(),te(Ne,Be,ke,ge,ie,Ce,Te)}finally{De&&De._endPatch()}}},W=(Ne,Be,z,We,ke,ge,ie,Ce)=>{let Te,De;const{props:Ze,shapeFlag:Je,transition:dt,dirs:ft}=Ne;if(Te=Ne.el=s(Ne.type,ge,Ze&&Ze.is,Ze),Je&8?d(Te,Ne.children):Je&16&&J(Ne.children,Te,null,We,ke,_2(Ne,ge),ie,Ce),ft&&ap(Ne,null,We,"created"),j(Te,Ne,Ne.scopeId,ie,We),Ze){for(const hn in Ze)hn!=="value"&&!V0(hn)&&o(Te,hn,null,Ze[hn],ge,We);"value"in Ze&&o(Te,"value",null,Ze.value,ge),(De=Ze.onVnodeBeforeMount)&&hc(De,We,Ne)}ft&&ap(Ne,null,We,"beforeMount");const Tt=mU(ke,dt);Tt&&dt.beforeEnter(Te),i(Te,Be,z),((De=Ze&&Ze.onVnodeMounted)||Tt||ft)&&_a(()=>{De&&hc(De,We,Ne),Tt&&dt.enter(Te),ft&&ap(Ne,null,We,"mounted")},ke)},j=(Ne,Be,z,We,ke)=>{if(z&&x(Ne,z),We)for(let ge=0;ge<We.length;ge++)x(Ne,We[ge]);if(ke){let ge=ke.subTree;if(Be===ge||MN(ge.type)&&(ge.ssContent===Be||ge.ssFallback===Be)){const ie=ke.vnode;j(Ne,ie,ie.scopeId,ie.slotScopeIds,ke.parent)}}},J=(Ne,Be,z,We,ke,ge,ie,Ce,Te=0)=>{for(let De=Te;De<Ne.length;De++){const Ze=Ne[De]=Ce?Bd(Ne[De]):gc(Ne[De]);w(null,Ze,Be,z,We,ke,ge,ie,Ce)}},te=(Ne,Be,z,We,ke,ge,ie)=>{const Ce=Be.el=Ne.el;let{patchFlag:Te,dynamicChildren:De,dirs:Ze}=Be;Te|=Ne.patchFlag&16;const Je=Ne.props||Rr,dt=Be.props||Rr;let ft;if(z&&lp(z,!1),(ft=dt.onVnodeBeforeUpdate)&&hc(ft,z,Be,Ne),Ze&&ap(Be,Ne,z,"beforeUpdate"),z&&lp(z,!0),(Je.innerHTML&&dt.innerHTML==null||Je.textContent&&dt.textContent==null)&&d(Ce,""),De?ce(Ne.dynamicChildren,De,Ce,z,We,_2(Be,ke),ge):ie||Le(Ne,Be,Ce,null,z,We,_2(Be,ke),ge,!1),Te>0){if(Te&16)pe(Ce,Je,dt,z,ke);else if(Te&2&&Je.class!==dt.class&&o(Ce,"class",null,dt.class,ke),Te&4&&o(Ce,"style",Je.style,dt.style,ke),Te&8){const Tt=Be.dynamicProps;for(let hn=0;hn<Tt.length;hn++){const cn=Tt[hn],vi=Je[cn],Hi=dt[cn];(Hi!==vi||cn==="value")&&o(Ce,cn,vi,Hi,ke,z)}}Te&1&&Ne.children!==Be.children&&d(Ce,Be.children)}else!ie&&De==null&&pe(Ce,Je,dt,z,ke);((ft=dt.onVnodeUpdated)||Ze)&&_a(()=>{ft&&hc(ft,z,Be,Ne),Ze&&ap(Be,Ne,z,"updated")},We)},ce=(Ne,Be,z,We,ke,ge,ie)=>{for(let Ce=0;Ce<Be.length;Ce++){const Te=Ne[Ce],De=Be[Ce],Ze=Te.el&&(Te.type===Et||!Ap(Te,De)||Te.shapeFlag&198)?m(Te.el):z;w(Te,De,Ze,null,We,ke,ge,ie,!0)}},pe=(Ne,Be,z,We,ke)=>{if(Be!==z){if(Be!==Rr)for(const ge in Be)!V0(ge)&&!(ge in z)&&o(Ne,ge,Be[ge],null,ke,We);for(const ge in z){if(V0(ge))continue;const ie=z[ge],Ce=Be[ge];ie!==Ce&&ge!=="value"&&o(Ne,ge,Ce,ie,ke,We)}"value"in z&&o(Ne,"value",Be.value,z.value,ke)}},Y=(Ne,Be,z,We,ke,ge,ie,Ce,Te)=>{const De=Be.el=Ne?Ne.el:l(""),Ze=Be.anchor=Ne?Ne.anchor:l("");let{patchFlag:Je,dynamicChildren:dt,slotScopeIds:ft}=Be;ft&&(Ce=Ce?Ce.concat(ft):ft),Ne==null?(i(De,z,We),i(Ze,z,We),J(Be.children||[],z,Ze,ke,ge,ie,Ce,Te)):Je>0&&Je&64&&dt&&Ne.dynamicChildren?(ce(Ne.dynamicChildren,dt,z,ke,ge,ie,Ce),(Be.key!=null||ke&&Be===ke.subTree)&&TR(Ne,Be,!0)):Le(Ne,Be,z,Ze,ke,ge,ie,Ce,Te)},he=(Ne,Be,z,We,ke,ge,ie,Ce,Te)=>{Be.slotScopeIds=Ce,Ne==null?Be.shapeFlag&512?ke.ctx.activate(Be,z,We,ie,Te):D(Be,z,We,ke,ge,ie,Te):re(Ne,Be,Te)},D=(Ne,Be,z,We,ke,ge,ie)=>{const Ce=Ne.component=wU(Ne,We,ke);if(xw(Ne)&&(Ce.ctx.renderer=yn),AU(Ce,!1,ie),Ce.asyncDep){if(ke&&ke.registerDep(Ce,le,ie),!Ne.el){const Te=Ce.subTree=mt(qo);T(null,Te,Be,z),Ne.placeholder=Te.el}}else le(Ce,Ne,Be,z,ke,ge,ie)},re=(Ne,Be,z)=>{const We=Be.component=Ne.component;if(oU(Ne,Be,z))if(We.asyncDep&&!We.asyncResolved){fe(We,Be,z);return}else We.next=Be,We.update();else Be.el=Ne.el,We.vnode=Be},le=(Ne,Be,z,We,ke,ge,ie)=>{const Ce=()=>{if(Ne.isMounted){let{next:Je,bu:dt,u:ft,parent:Tt,vnode:hn}=Ne;{const Tr=RN(Ne);if(Tr){Je&&(Je.el=hn.el,fe(Ne,Je,ie)),Tr.asyncDep.then(()=>{Ne.isUnmounted||Ce()});return}}let cn=Je,vi;lp(Ne,!1),Je?(Je.el=hn.el,fe(Ne,Je,ie)):Je=hn,dt&&Qx(dt),(vi=Je.props&&Je.props.onVnodeBeforeUpdate)&&hc(vi,Tt,Je,hn),lp(Ne,!0);const Hi=DP(Ne),Li=Ne.subTree;Ne.subTree=Hi,w(Li,Hi,m(Li.el),Pt(Li),Ne,ke,ge),Je.el=Hi.el,cn===null&&aU(Ne,Hi.el),ft&&_a(ft,ke),(vi=Je.props&&Je.props.onVnodeUpdated)&&_a(()=>hc(vi,Tt,Je,hn),ke)}else{let Je;const{el:dt,props:ft}=Be,{bm:Tt,m:hn,parent:cn,root:vi,type:Hi}=Ne,Li=Qm(Be);lp(Ne,!1),Tt&&Qx(Tt),!Li&&(Je=ft&&ft.onVnodeBeforeMount)&&hc(Je,cn,Be),lp(Ne,!0);{vi.ce&&vi.ce._def.shadowRoot!==!1&&vi.ce._injectChildStyle(Hi);const Tr=Ne.subTree=DP(Ne);w(null,Tr,z,We,Ne,ke,ge),Be.el=Tr.el}if(hn&&_a(hn,ke),!Li&&(Je=ft&&ft.onVnodeMounted)){const Tr=Be;_a(()=>hc(Je,cn,Tr),ke)}(Be.shapeFlag&256||cn&&Qm(cn.vnode)&&cn.vnode.shapeFlag&256)&&Ne.a&&_a(Ne.a,ke),Ne.isMounted=!0,Be=z=We=null}};Ne.scope.on();const Te=Ne.effect=new L3(Ce);Ne.scope.off();const De=Ne.update=Te.run.bind(Te),Ze=Ne.job=Te.runIfDirty.bind(Te);Ze.i=Ne,Ze.id=Ne.uid,Te.scheduler=()=>IR(Ze),lp(Ne,!0),De()},fe=(Ne,Be,z)=>{Be.component=Ne;const We=Ne.vnode.props;Ne.vnode=Be,Ne.next=null,uU(Ne,Be.props,We,z),fU(Ne,Be.children,z),zh(),EP(Ne),Uh()},Le=(Ne,Be,z,We,ke,ge,ie,Ce,Te=!1)=>{const De=Ne&&Ne.children,Ze=Ne?Ne.shapeFlag:0,Je=Be.children,{patchFlag:dt,shapeFlag:ft}=Be;if(dt>0){if(dt&128){se(De,Je,z,We,ke,ge,ie,Ce,Te);return}else if(dt&256){we(De,Je,z,We,ke,ge,ie,Ce,Te);return}}ft&8?(Ze&16&&Lt(De,ke,ge),Je!==De&&d(z,Je)):Ze&16?ft&16?se(De,Je,z,We,ke,ge,ie,Ce,Te):Lt(De,ke,ge,!0):(Ze&8&&d(z,""),ft&16&&J(Je,z,We,ke,ge,ie,Ce,Te))},we=(Ne,Be,z,We,ke,ge,ie,Ce,Te)=>{Ne=Ne||$m,Be=Be||$m;const De=Ne.length,Ze=Be.length,Je=Math.min(De,Ze);let dt;for(dt=0;dt<Je;dt++){const ft=Be[dt]=Te?Bd(Be[dt]):gc(Be[dt]);w(Ne[dt],ft,z,null,ke,ge,ie,Ce,Te)}De>Ze?Lt(Ne,ke,ge,!0,!1,Je):J(Be,z,We,ke,ge,ie,Ce,Te,Je)},se=(Ne,Be,z,We,ke,ge,ie,Ce,Te)=>{let De=0;const Ze=Be.length;let Je=Ne.length-1,dt=Ze-1;for(;De<=Je&&De<=dt;){const ft=Ne[De],Tt=Be[De]=Te?Bd(Be[De]):gc(Be[De]);if(Ap(ft,Tt))w(ft,Tt,z,null,ke,ge,ie,Ce,Te);else break;De++}for(;De<=Je&&De<=dt;){const ft=Ne[Je],Tt=Be[dt]=Te?Bd(Be[dt]):gc(Be[dt]);if(Ap(ft,Tt))w(ft,Tt,z,null,ke,ge,ie,Ce,Te);else break;Je--,dt--}if(De>Je){if(De<=dt){const ft=dt+1,Tt=ft<Ze?Be[ft].el:We;for(;De<=dt;)w(null,Be[De]=Te?Bd(Be[De]):gc(Be[De]),z,Tt,ke,ge,ie,Ce,Te),De++}}else if(De>dt)for(;De<=Je;)q(Ne[De],ke,ge,!0),De++;else{const ft=De,Tt=De,hn=new Map;for(De=Tt;De<=dt;De++){const wi=Be[De]=Te?Bd(Be[De]):gc(Be[De]);wi.key!=null&&hn.set(wi.key,De)}let cn,vi=0;const Hi=dt-Tt+1;let Li=!1,Tr=0;const pi=new Array(Hi);for(De=0;De<Hi;De++)pi[De]=0;for(De=ft;De<=Je;De++){const wi=Ne[De];if(vi>=Hi){q(wi,ke,ge,!0);continue}let Ti;if(wi.key!=null)Ti=hn.get(wi.key);else for(cn=Tt;cn<=dt;cn++)if(pi[cn-Tt]===0&&Ap(wi,Be[cn])){Ti=cn;break}Ti===void 0?q(wi,ke,ge,!0):(pi[Ti-Tt]=De+1,Ti>=Tr?Tr=Ti:Li=!0,w(wi,Be[Ti],z,null,ke,ge,ie,Ce,Te),vi++)}const rs=Li?yU(pi):$m;for(cn=rs.length-1,De=Hi-1;De>=0;De--){const wi=Tt+De,Ti=Be[wi],Bs=Be[wi+1],xo=wi+1<Ze?Bs.el||Bs.placeholder:We;pi[De]===0?w(null,Ti,z,xo,ke,ge,ie,Ce,Te):Li&&(cn<0||De!==rs[cn]?Q(Ti,z,xo,2):cn--)}}},Q=(Ne,Be,z,We,ke=null)=>{const{el:ge,type:ie,transition:Ce,children:Te,shapeFlag:De}=Ne;if(De&6){Q(Ne.component.subTree,Be,z,We);return}if(De&128){Ne.suspense.move(Be,z,We);return}if(De&64){ie.move(Ne,Be,z,yn);return}if(ie===Et){i(ge,Be,z);for(let Je=0;Je<Te.length;Je++)Q(Te[Je],Be,z,We);i(Ne.anchor,Be,z);return}if(ie===v2){G(Ne,Be,z);return}if(We!==2&&De&1&&Ce)if(We===0)Ce.beforeEnter(ge),i(ge,Be,z),_a(()=>Ce.enter(ge),ke);else{const{leave:Je,delayLeave:dt,afterLeave:ft}=Ce,Tt=()=>{Ne.ctx.isUnmounted?r(ge):i(ge,Be,z)},hn=()=>{ge._isLeaving&&ge[wh](!0),Je(ge,()=>{Tt(),ft&&ft()})};dt?dt(ge,Tt,hn):hn()}else i(ge,Be,z)},q=(Ne,Be,z,We=!1,ke=!1)=>{const{type:ge,props:ie,ref:Ce,children:Te,dynamicChildren:De,shapeFlag:Ze,patchFlag:Je,dirs:dt,cacheIndex:ft}=Ne;if(Je===-2&&(ke=!1),Ce!=null&&(zh(),z0(Ce,null,z,Ne,!0),Uh()),ft!=null&&(Be.renderCache[ft]=void 0),Ze&256){Be.ctx.deactivate(Ne);return}const Tt=Ze&1&&dt,hn=!Qm(Ne);let cn;if(hn&&(cn=ie&&ie.onVnodeBeforeUnmount)&&hc(cn,Be,Ne),Ze&6)qe(Ne.component,z,We);else{if(Ze&128){Ne.suspense.unmount(z,We);return}Tt&&ap(Ne,null,Be,"beforeUnmount"),Ze&64?Ne.type.remove(Ne,Be,z,yn,We):De&&!De.hasOnce&&(ge!==Et||Je>0&&Je&64)?Lt(De,Be,z,!1,!0):(ge===Et&&Je&384||!ke&&Ze&16)&&Lt(Te,Be,z),We&&$e(Ne)}(hn&&(cn=ie&&ie.onVnodeUnmounted)||Tt)&&_a(()=>{cn&&hc(cn,Be,Ne),Tt&&ap(Ne,null,Be,"unmounted")},z)},$e=Ne=>{const{type:Be,el:z,anchor:We,transition:ke}=Ne;if(Be===Et){Qe(z,We);return}if(Be===v2){N(Ne);return}const ge=()=>{r(z),ke&&!ke.persisted&&ke.afterLeave&&ke.afterLeave()};if(Ne.shapeFlag&1&&ke&&!ke.persisted){const{leave:ie,delayLeave:Ce}=ke,Te=()=>ie(z,ge);Ce?Ce(Ne.el,ge,Te):Te()}else ge()},Qe=(Ne,Be)=>{let z;for(;Ne!==Be;)z=y(Ne),r(Ne),Ne=z;r(Be)},qe=(Ne,Be,z)=>{const{bum:We,scope:ke,job:ge,subTree:ie,um:Ce,m:Te,a:De}=Ne;ZP(Te),ZP(De),We&&Qx(We),ke.stop(),ge&&(ge.flags|=8,q(ie,Ne,Be,z)),Ce&&_a(Ce,Be),_a(()=>{Ne.isUnmounted=!0},Be)},Lt=(Ne,Be,z,We=!1,ke=!1,ge=0)=>{for(let ie=ge;ie<Ne.length;ie++)q(Ne[ie],Be,z,We,ke)},Pt=Ne=>{if(Ne.shapeFlag&6)return Pt(Ne.component.subTree);if(Ne.shapeFlag&128)return Ne.suspense.next();const Be=y(Ne.anchor||Ne.el),z=Be&&Be[tN];return z?y(z):Be};let zt=!1;const Dt=(Ne,Be,z)=>{Ne==null?Be._vnode&&q(Be._vnode,null,null,!0):w(Be._vnode||null,Ne,Be,null,null,null,z),Be._vnode=Ne,zt||(zt=!0,EP(),q3(),zt=!1)},yn={p:w,um:q,m:Q,r:$e,mt:D,mc:J,pc:Le,pbc:ce,n:Pt,o:n};return{render:Dt,hydrate:void 0,createApp:$9(Dt)}}function _2({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function lp({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function mU(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function TR(n,e,t=!1){const i=n.children,r=e.children;if(zn(i)&&zn(r))for(let o=0;o<i.length;o++){const s=i[o];let l=r[o];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=r[o]=Bd(r[o]),l.el=s.el),!t&&l.patchFlag!==-2&&TR(s,l)),l.type===Aw&&l.patchFlag!==-1&&(l.el=s.el),l.type===qo&&!l.el&&(l.el=s.el)}}function yU(n){const e=n.slice(),t=[0];let i,r,o,s,l;const u=n.length;for(i=0;i<u;i++){const h=n[i];if(h!==0){if(r=t[t.length-1],n[r]<h){e[i]=r,t.push(i);continue}for(o=0,s=t.length-1;o<s;)l=o+s>>1,n[t[l]]<h?o=l+1:s=l;h<n[t[o]]&&(o>0&&(e[i]=t[o-1]),t[o]=i)}}for(o=t.length,s=t[o-1];o-- >0;)t[o]=s,s=e[s];return t}function RN(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:RN(e)}function ZP(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const MN=n=>n.__isSuspense;function _U(n,e){e&&e.pendingBranch?zn(n)?e.effects.push(...n):e.effects.push(n):T9(n)}const Et=Symbol.for("v-fgt"),Aw=Symbol.for("v-txt"),qo=Symbol.for("v-cmt"),v2=Symbol.for("v-stc"),X0=[];let xl=null;function U(n=!1){X0.push(xl=n?null:[])}function vU(){X0.pop(),xl=X0[X0.length-1]||null}let bv=1;function jI(n,e=!1){bv+=n,n<0&&xl&&e&&(xl.hasOnce=!0)}function kN(n){return n.dynamicChildren=bv>0?xl||$m:null,vU(),bv>0&&xl&&xl.push(n),n}function oe(n,e,t,i,r,o){return kN(P(n,e,t,i,r,o,!0))}function Mt(n,e,t,i,r){return kN(mt(n,e,t,i,r,!0))}function xv(n){return n?n.__v_isVNode===!0:!1}function Ap(n,e){return n.type===e.type&&n.key===e.key}const LN=({key:n})=>n??null,tI=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?ps(n)||Pr(n)||ui(n)?{i:Lo,r:n,k:e,f:!!t}:n:null);function P(n,e=null,t=null,i=0,r=null,o=n===Et?0:1,s=!1,l=!1){const u={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&LN(e),ref:e&&tI(e),scopeId:eN,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:i,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:Lo};return l?(RR(u,t),o&128&&n.normalize(u)):t&&(u.shapeFlag|=ps(t)?8:16),bv>0&&!s&&xl&&(u.patchFlag>0||o&6)&&u.patchFlag!==32&&xl.push(u),u}const mt=bU;function bU(n,e=null,t=null,i=0,r=null,o=!1){if((!n||n===pN)&&(n=qo),xv(n)){const l=df(n,e,!0);return t&&RR(l,t),bv>0&&!o&&xl&&(l.shapeFlag&6?xl[xl.indexOf(n)]=l:xl.push(l)),l.patchFlag=-2,l}if(MU(n)&&(n=n.__vccOpts),e){e=xU(e);let{class:l,style:u}=e;l&&!ps(l)&&(e.class=Dn(l)),Er(u)&&(_w(u)&&!zn(u)&&(u=vo({},u)),e.style=Dc(u))}const s=ps(n)?1:MN(n)?128:nN(n)?64:Er(n)?4:ui(n)?2:0;return P(n,e,t,i,r,s,o,!0)}function xU(n){return n?_w(n)||CN(n)?vo({},n):n:null}function df(n,e,t=!1,i=!1){const{props:r,ref:o,patchFlag:s,children:l,transition:u}=n,h=e?MR(r||{},e):r,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:h,key:h&&LN(h),ref:e&&e.ref?t&&o?zn(o)?o.concat(tI(e)):[o,tI(e)]:tI(e):o,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:l,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Et?s===-1?16:s|16:s,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:u,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&df(n.ssContent),ssFallback:n.ssFallback&&df(n.ssFallback),placeholder:n.placeholder,el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return u&&i&&_v(d,u.clone(d)),d}function Bt(n=" ",e=0){return mt(Aw,null,n,e)}function Ge(n="",e=!1){return e?(U(),Mt(qo,null,n)):mt(qo,null,n)}function gc(n){return n==null||typeof n=="boolean"?mt(qo):zn(n)?mt(Et,null,n.slice()):xv(n)?Bd(n):mt(Aw,null,String(n))}function Bd(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:df(n)}function RR(n,e){let t=0;const{shapeFlag:i}=n;if(e==null)e=null;else if(zn(e))t=16;else if(typeof e=="object")if(i&65){const r=e.default;r&&(r._c&&(r._d=!1),RR(n,r()),r._c&&(r._d=!0));return}else{t=32;const r=e._;!r&&!CN(e)?e._ctx=Lo:r===3&&Lo&&(Lo.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else ui(e)?(e={default:e,_ctx:Lo},t=32):(e=String(e),i&64?(t=16,e=[Bt(e)]):t=8);n.children=e,n.shapeFlag|=t}function MR(...n){const e={};for(let t=0;t<n.length;t++){const i=n[t];for(const r in i)if(r==="class")e.class!==i.class&&(e.class=Dn([e.class,i.class]));else if(r==="style")e.style=Dc([e.style,i.style]);else if(cw(r)){const o=e[r],s=i[r];s&&o!==s&&!(zn(o)&&o.includes(s))&&(e[r]=o?[].concat(o,s):s)}else r!==""&&(e[r]=i[r])}return e}function hc(n,e,t,i=null){Mu(n,e,7,[t,i])}const IU=_N();let CU=0;function wU(n,e,t){const i=n.type,r=(e?e.appContext:n.appContext)||IU,o={uid:CU++,vnode:n,type:i,parent:e,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new R3(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(r.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:AN(i,r),emitsOptions:bN(i,r),emit:null,emitted:null,propsDefaults:Rr,inheritAttrs:i.inheritAttrs,ctx:Rr,data:Rr,props:Rr,attrs:Rr,slots:Rr,refs:Rr,setupState:Rr,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return o.ctx={_:o},o.root=e?e.root:o,o.emit=nU.bind(null,o),n.ce&&n.ce(o),o}let Qo=null;const ob=()=>Qo||Lo;let $I,xE;{const n=gw(),e=(t,i)=>{let r;return(r=n[t])||(r=n[t]=[]),r.push(i),o=>{r.length>1?r.forEach(s=>s(o)):r[0](o)}};$I=e("__VUE_INSTANCE_SETTERS__",t=>Qo=t),xE=e("__VUE_SSR_SETTERS__",t=>Iv=t)}const ab=n=>{const e=Qo;return $I(n),n.scope.on(),()=>{n.scope.off(),$I(e)}},WP=()=>{Qo&&Qo.scope.off(),$I(null)};function PN(n){return n.vnode.shapeFlag&4}let Iv=!1;function AU(n,e=!1,t=!1){e&&xE(e);const{props:i,children:r}=n.vnode,o=PN(n);lU(n,i,o,e),dU(n,r,t||e);const s=o?SU(n,e):void 0;return e&&xE(!1),s}function SU(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,z9);const{setup:i}=t;if(i){zh();const r=n.setupContext=i.length>1?TU(n):null,o=ab(n),s=rb(i,n,0,[n.props,r]),l=I3(s);if(Uh(),o(),(l||n.sp)&&!Qm(n)&&cN(n),l){if(s.then(WP,WP),e)return s.then(u=>{zP(n,u)}).catch(u=>{vw(u,n,0)});n.asyncDep=s}else zP(n,s)}else GN(n)}function zP(n,e,t){ui(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Er(e)&&(n.setupState=H3(e)),GN(n)}function GN(n,e,t){const i=n.type;n.render||(n.render=i.render||wc);{const r=ab(n);zh();try{U9(n)}finally{Uh(),r()}}}const EU={get(n,e){return $o(n,"get",""),n[e]}};function TU(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,EU),slots:n.slots,emit:n.emit,expose:e}}function Sw(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(H3(xR(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in U0)return U0[t](n)},has(e,t){return t in e||t in U0}})):n.proxy}function RU(n,e=!0){return ui(n)?n.displayName||n.name:n.name||e&&n.__name}function MU(n){return ui(n)&&"__vccOpts"in n}const At=(n,e)=>C9(n,e,Iv);function kU(n,e,t){try{jI(-1);const i=arguments.length;return i===2?Er(e)&&!zn(e)?xv(e)?mt(n,null,[e]):mt(n,e):mt(n,null,e):(i>3?t=Array.prototype.slice.call(arguments,2):i===3&&xv(t)&&(t=[t]),mt(n,e,t))}finally{jI(1)}}const LU="3.5.25";let IE;const UP=typeof window<"u"&&window.trustedTypes;if(UP)try{IE=UP.createPolicy("vue",{createHTML:n=>n})}catch{}const FN=IE?n=>IE.createHTML(n):n=>n,PU="http://www.w3.org/2000/svg",GU="http://www.w3.org/1998/Math/MathML",Ih=typeof document<"u"?document:null,XP=Ih&&Ih.createElement("template"),FU={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,i)=>{const r=e==="svg"?Ih.createElementNS(PU,n):e==="mathml"?Ih.createElementNS(GU,n):t?Ih.createElement(n,{is:t}):Ih.createElement(n);return n==="select"&&i&&i.multiple!=null&&r.setAttribute("multiple",i.multiple),r},createText:n=>Ih.createTextNode(n),createComment:n=>Ih.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ih.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,i,r,o){const s=t?t.previousSibling:e.lastChild;if(r&&(r===o||r.nextSibling))for(;e.insertBefore(r.cloneNode(!0),t),!(r===o||!(r=r.nextSibling)););else{XP.innerHTML=FN(i==="svg"?`<svg>${n}</svg>`:i==="mathml"?`<math>${n}</math>`:n);const l=XP.content;if(i==="svg"||i==="mathml"){const u=l.firstChild;for(;u.firstChild;)l.appendChild(u.firstChild);l.removeChild(u)}e.insertBefore(l,t)}return[s?s.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Td="transition",j_="animation",Cv=Symbol("_vtc"),ON={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},OU=vo({},sN,ON),NU=n=>(n.displayName="Transition",n.props=OU,n),Ew=NU((n,{slots:e})=>kU(L9,DU(n),e)),up=(n,e=[])=>{zn(n)?n.forEach(t=>t(...e)):n&&n(...e)},YP=n=>n?zn(n)?n.some(e=>e.length>1):n.length>1:!1;function DU(n){const e={};for(const Y in n)Y in ON||(e[Y]=n[Y]);if(n.css===!1)return e;const{name:t="v",type:i,duration:r,enterFromClass:o=`${t}-enter-from`,enterActiveClass:s=`${t}-enter-active`,enterToClass:l=`${t}-enter-to`,appearFromClass:u=o,appearActiveClass:h=s,appearToClass:d=l,leaveFromClass:m=`${t}-leave-from`,leaveActiveClass:y=`${t}-leave-active`,leaveToClass:x=`${t}-leave-to`}=n,C=VU(r),w=C&&C[0],S=C&&C[1],{onBeforeEnter:T,onEnter:M,onEnterCancelled:G,onLeave:N,onLeaveCancelled:V,onBeforeAppear:W=T,onAppear:j=M,onAppearCancelled:J=G}=e,te=(Y,he,D,re)=>{Y._enterCancelled=re,cp(Y,he?d:l),cp(Y,he?h:s),D&&D()},ce=(Y,he)=>{Y._isLeaving=!1,cp(Y,m),cp(Y,x),cp(Y,y),he&&he()},pe=Y=>(he,D)=>{const re=Y?j:M,le=()=>te(he,Y,D);up(re,[he,le]),HP(()=>{cp(he,Y?u:o),gh(he,Y?d:l),YP(re)||KP(he,i,w,le)})};return vo(e,{onBeforeEnter(Y){up(T,[Y]),gh(Y,o),gh(Y,s)},onBeforeAppear(Y){up(W,[Y]),gh(Y,u),gh(Y,h)},onEnter:pe(!1),onAppear:pe(!0),onLeave(Y,he){Y._isLeaving=!0;const D=()=>ce(Y,he);gh(Y,m),Y._enterCancelled?(gh(Y,y),JP(Y)):(JP(Y),gh(Y,y)),HP(()=>{Y._isLeaving&&(cp(Y,m),gh(Y,x),YP(N)||KP(Y,i,S,D))}),up(N,[Y,D])},onEnterCancelled(Y){te(Y,!1,void 0,!0),up(G,[Y])},onAppearCancelled(Y){te(Y,!0,void 0,!0),up(J,[Y])},onLeaveCancelled(Y){ce(Y),up(V,[Y])}})}function VU(n){if(n==null)return null;if(Er(n))return[b2(n.enter),b2(n.leave)];{const e=b2(n);return[e,e]}}function b2(n){return Z6(n)}function gh(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[Cv]||(n[Cv]=new Set)).add(e)}function cp(n,e){e.split(/\s+/).forEach(i=>i&&n.classList.remove(i));const t=n[Cv];t&&(t.delete(e),t.size||(n[Cv]=void 0))}function HP(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let BU=0;function KP(n,e,t,i){const r=n._endId=++BU,o=()=>{r===n._endId&&i()};if(t!=null)return setTimeout(o,t);const{type:s,timeout:l,propCount:u}=ZU(n,e);if(!s)return i();const h=s+"end";let d=0;const m=()=>{n.removeEventListener(h,y),o()},y=x=>{x.target===n&&++d>=u&&m()};setTimeout(()=>{d<u&&m()},l+1),n.addEventListener(h,y)}function ZU(n,e){const t=window.getComputedStyle(n),i=C=>(t[C]||"").split(", "),r=i(`${Td}Delay`),o=i(`${Td}Duration`),s=jP(r,o),l=i(`${j_}Delay`),u=i(`${j_}Duration`),h=jP(l,u);let d=null,m=0,y=0;e===Td?s>0&&(d=Td,m=s,y=o.length):e===j_?h>0&&(d=j_,m=h,y=u.length):(m=Math.max(s,h),d=m>0?s>h?Td:j_:null,y=d?d===Td?o.length:u.length:0);const x=d===Td&&/\b(?:transform|all)(?:,|$)/.test(i(`${Td}Property`).toString());return{type:d,timeout:m,propCount:y,hasTransform:x}}function jP(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,i)=>$P(t)+$P(n[i])))}function $P(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function JP(n){return(n?n.ownerDocument:document).body.offsetHeight}function WU(n,e,t){const i=n[Cv];i&&(e=(e?[e,...i]:[...i]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const JI=Symbol("_vod"),NN=Symbol("_vsh"),zp={name:"show",beforeMount(n,{value:e},{transition:t}){n[JI]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):$_(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:i}){!e!=!t&&(i?e?(i.beforeEnter(n),$_(n,!0),i.enter(n)):i.leave(n,()=>{$_(n,!1)}):$_(n,e))},beforeUnmount(n,{value:e}){$_(n,e)}};function $_(n,e){n.style.display=e?n[JI]:"none",n[NN]=!e}const zU=Symbol(""),UU=/(?:^|;)\s*display\s*:/;function XU(n,e,t){const i=n.style,r=ps(t);let o=!1;if(t&&!r){if(e)if(ps(e))for(const s of e.split(";")){const l=s.slice(0,s.indexOf(":")).trim();t[l]==null&&nI(i,l,"")}else for(const s in e)t[s]==null&&nI(i,s,"");for(const s in t)s==="display"&&(o=!0),nI(i,s,t[s])}else if(r){if(e!==t){const s=i[zU];s&&(t+=";"+s),i.cssText=t,o=UU.test(t)}}else e&&n.removeAttribute("style");JI in n&&(n[JI]=o?i.display:"",n[NN]&&(i.display="none"))}const qP=/\s*!important$/;function nI(n,e,t){if(zn(t))t.forEach(i=>nI(n,e,i));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const i=YU(n,e);qP.test(t)?n.setProperty(xf(i),t.replace(qP,""),"important"):n[i]=t}}const QP=["Webkit","Moz","ms"],x2={};function YU(n,e){const t=x2[e];if(t)return t;let i=ql(e);if(i!=="filter"&&i in n)return x2[e]=i;i=fw(i);for(let r=0;r<QP.length;r++){const o=QP[r]+i;if(o in n)return x2[e]=o}return e}const eG="http://www.w3.org/1999/xlink";function tG(n,e,t,i,r,o=H6(e)){i&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(eG,e.slice(6,e.length)):n.setAttributeNS(eG,e,t):t==null||o&&!S3(t)?n.removeAttribute(e):n.setAttribute(e,o?"":Tu(t)?String(t):t)}function nG(n,e,t,i,r){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?FN(t):t);return}const o=n.tagName;if(e==="value"&&o!=="PROGRESS"&&!o.includes("-")){const l=o==="OPTION"?n.getAttribute("value")||"":n.value,u=t==null?n.type==="checkbox"?"on":"":String(t);(l!==u||!("_value"in n))&&(n.value=u),t==null&&n.removeAttribute(e),n._value=t;return}let s=!1;if(t===""||t==null){const l=typeof n[e];l==="boolean"?t=S3(t):t==null&&l==="string"?(t="",s=!0):l==="number"&&(t=0,s=!0)}try{n[e]=t}catch{}s&&n.removeAttribute(r||e)}function Ud(n,e,t,i){n.addEventListener(e,t,i)}function HU(n,e,t,i){n.removeEventListener(e,t,i)}const iG=Symbol("_vei");function KU(n,e,t,i,r=null){const o=n[iG]||(n[iG]={}),s=o[e];if(i&&s)s.value=i;else{const[l,u]=jU(e);if(i){const h=o[e]=qU(i,r);Ud(n,l,h,u)}else s&&(HU(n,l,s,u),o[e]=void 0)}}const rG=/(?:Once|Passive|Capture)$/;function jU(n){let e;if(rG.test(n)){e={};let i;for(;i=n.match(rG);)n=n.slice(0,n.length-i[0].length),e[i[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):xf(n.slice(2)),e]}let I2=0;const $U=Promise.resolve(),JU=()=>I2||($U.then(()=>I2=0),I2=Date.now());function qU(n,e){const t=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=t.attached)return;Mu(QU(i,t.value),e,5,[i])};return t.value=n,t.attached=JU(),t}function QU(n,e){if(zn(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(i=>r=>!r._stopped&&i&&i(r))}else return e}const sG=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,eX=(n,e,t,i,r,o)=>{const s=r==="svg";e==="class"?WU(n,i,s):e==="style"?XU(n,t,i):cw(e)?dR(e)||KU(n,e,t,i,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):tX(n,e,i,s))?(nG(n,e,i),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&tG(n,e,i,s,o,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!ps(i))?nG(n,ql(e),i,o,e):(e==="true-value"?n._trueValue=i:e==="false-value"&&(n._falseValue=i),tG(n,e,i,s))};function tX(n,e,t,i){if(i)return!!(e==="innerHTML"||e==="textContent"||e in n&&sG(e)&&ui(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="sandbox"&&n.tagName==="IFRAME"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const r=n.tagName;if(r==="IMG"||r==="VIDEO"||r==="CANVAS"||r==="SOURCE")return!1}return sG(e)&&ps(t)?!1:e in n}const vy=n=>{const e=n.props["onUpdate:modelValue"]||!1;return zn(e)?t=>Qx(e,t):e};function nX(n){n.target.composing=!0}function oG(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Lh=Symbol("_assign");function aG(n,e,t){return e&&(n=n.trim()),t&&(n=pw(n)),n}const Zr={created(n,{modifiers:{lazy:e,trim:t,number:i}},r){n[Lh]=vy(r);const o=i||r.props&&r.props.type==="number";Ud(n,e?"change":"input",s=>{s.target.composing||n[Lh](aG(n.value,t,o))}),(t||o)&&Ud(n,"change",()=>{n.value=aG(n.value,t,o)}),e||(Ud(n,"compositionstart",nX),Ud(n,"compositionend",oG),Ud(n,"change",oG))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:i,trim:r,number:o}},s){if(n[Lh]=vy(s),n.composing)return;const l=(o||n.type==="number")&&!/^0\d/.test(n.value)?pw(n.value):n.value,u=e??"";l!==u&&(document.activeElement===n&&n.type!=="range"&&(i&&e===t||r&&n.value.trim()===u)||(n.value=u))}},Yh={deep:!0,created(n,e,t){n[Lh]=vy(t),Ud(n,"change",()=>{const i=n._modelValue,r=wv(n),o=n.checked,s=n[Lh];if(zn(i)){const l=pR(i,r),u=l!==-1;if(o&&!u)s(i.concat(r));else if(!o&&u){const h=[...i];h.splice(l,1),s(h)}}else if(Gy(i)){const l=new Set(i);o?l.add(r):l.delete(r),s(l)}else s(VN(n,o))})},mounted:lG,beforeUpdate(n,e,t){n[Lh]=vy(t),lG(n,e,t)}};function lG(n,{value:e,oldValue:t},i){n._modelValue=e;let r;if(zn(e))r=pR(e,i.props.value)>-1;else if(Gy(e))r=e.has(i.props.value);else{if(e===t)return;r=ib(e,VN(n,!0))}n.checked!==r&&(n.checked=r)}const DN={deep:!0,created(n,{value:e,modifiers:{number:t}},i){const r=Gy(e);Ud(n,"change",()=>{const o=Array.prototype.filter.call(n.options,s=>s.selected).map(s=>t?pw(wv(s)):wv(s));n[Lh](n.multiple?r?new Set(o):o:o[0]),n._assigning=!0,aa(()=>{n._assigning=!1})}),n[Lh]=vy(i)},mounted(n,{value:e}){uG(n,e)},beforeUpdate(n,e,t){n[Lh]=vy(t)},updated(n,{value:e}){n._assigning||uG(n,e)}};function uG(n,e){const t=n.multiple,i=zn(e);if(!(t&&!i&&!Gy(e))){for(let r=0,o=n.options.length;r<o;r++){const s=n.options[r],l=wv(s);if(t)if(i){const u=typeof l;u==="string"||u==="number"?s.selected=e.some(h=>String(h)===String(l)):s.selected=pR(e,l)>-1}else s.selected=e.has(l);else if(ib(wv(s),e)){n.selectedIndex!==r&&(n.selectedIndex=r);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function wv(n){return"_value"in n?n._value:n.value}function VN(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const iX=["ctrl","shift","alt","meta"],rX={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>iX.some(t=>n[`${t}Key`]&&!e.includes(t))},fs=(n,e)=>{const t=n._withMods||(n._withMods={}),i=e.join(".");return t[i]||(t[i]=((r,...o)=>{for(let s=0;s<e.length;s++){const l=rX[e[s]];if(l&&l(r,e))return}return n(r,...o)}))},sX={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Js=(n,e)=>{const t=n._withKeys||(n._withKeys={}),i=e.join(".");return t[i]||(t[i]=(r=>{if(!("key"in r))return;const o=xf(r.key);if(e.some(s=>s===o||sX[s]===o))return n(r)}))},oX=vo({patchProp:eX},FU);let cG;function aX(){return cG||(cG=pU(oX))}const lX=((...n)=>{const e=aX().createApp(...n),{mount:t}=e;return e.mount=i=>{const r=cX(i);if(!r)return;const o=e._component;!ui(o)&&!o.render&&!o.template&&(o.template=r.innerHTML),r.nodeType===1&&(r.textContent="");const s=t(r,!1,uX(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),s},e});function uX(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function cX(n){return ps(n)?document.querySelector(n):n}var BN=Symbol();function hX(n,{i18next:e,rerenderOn:t=["languageChanged","loaded","added","removed"],slotStart:i="{",slotEnd:r="}"}){const o=Ei(new Date),s=()=>aa(()=>{o.value=new Date}),l=()=>o.value;t.forEach(d=>{var m;switch(d){case"added":case"removed":(m=e.store)==null||m.on(d,s);break;default:e.on(d,s);break}}),n.component("i18next",pX);const u=()=>e.isInitialized;n.config.globalProperties.$t=hG(e.t.bind(e),l,u);const h=new Proxy(e,{get(d,m){return l(),Reflect.get(d,m)}});n.config.globalProperties.$i18next=h,n.provide(BN,{i18next:h,slotPattern:fX(i,r),withAccessRecording(d,m){return hG(d,l,m)}})}function Ct(n,e){const{i18next:t,withAccessRecording:i}=ZN();let r;return r=t.getFixedT(null,null,void 0),{i18next:t,t:i(r,dX(t,n))}}function dX(n,e=[]){let t;return()=>{if(t===void 0)if(n.isInitialized){const r=(typeof e=="string"?[e]:e).filter(o=>!n.hasLoadedNamespace(o));r.length?(t=!1,n.loadNamespaces(r).then(()=>t=!0)):t=!0}else return!1;return t}}function hG(n,e,t){return new Proxy(n,{apply:function(i,r,o){return e(),t()?Reflect.apply(i,r,o):""}})}function ZN(){const n=Go(BN);if(!n)throw new Error("i18next-vue: Make sure to register the i18next-vue plugin using app.use(...).");return n}function fX(n,e){const t=`${n}\\s*([a-z0-9\\-]+)\\s*${e}`;return new RegExp(t,"gi")}var pX=st({props:{translation:{type:String,required:!0}},setup(n,{slots:e}){const{slotPattern:t}=ZN();return()=>{const i=n.translation,r=[];let o,s=0;for(;(o=t.exec(i))!==null;){r.push(i.substring(s,o.index));const l=e[o[1]];l?r.push(...l()):r.push(o[0]),s=t.lastIndex}return r.push(i.substring(s)),r}}});const{entries:WN,setPrototypeOf:dG,isFrozen:gX,getPrototypeOf:mX,getOwnPropertyDescriptor:yX}=Object;let{freeze:Ca,seal:Ql,create:CE}=Object,{apply:wE,construct:AE}=typeof Reflect<"u"&&Reflect;Ca||(Ca=function(e){return e});Ql||(Ql=function(e){return e});wE||(wE=function(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];return e.apply(t,r)});AE||(AE=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return new e(...i)});const q1=wa(Array.prototype.forEach),_X=wa(Array.prototype.lastIndexOf),fG=wa(Array.prototype.pop),J_=wa(Array.prototype.push),vX=wa(Array.prototype.splice),iI=wa(String.prototype.toLowerCase),C2=wa(String.prototype.toString),w2=wa(String.prototype.match),q_=wa(String.prototype.replace),bX=wa(String.prototype.indexOf),xX=wa(String.prototype.trim),gu=wa(Object.prototype.hasOwnProperty),ga=wa(RegExp.prototype.test),Q_=IX(TypeError);function wa(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return wE(n,e,i)}}function IX(n){return function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return AE(n,t)}}function Fi(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:iI;dG&&dG(n,null);let i=e.length;for(;i--;){let r=e[i];if(typeof r=="string"){const o=t(r);o!==r&&(gX(e)||(e[i]=o),r=o)}n[r]=!0}return n}function CX(n){for(let e=0;e<n.length;e++)gu(n,e)||(n[e]=null);return n}function dc(n){const e=CE(null);for(const[t,i]of WN(n))gu(n,t)&&(Array.isArray(i)?e[t]=CX(i):i&&typeof i=="object"&&i.constructor===Object?e[t]=dc(i):e[t]=i);return e}function e0(n,e){for(;n!==null;){const i=yX(n,e);if(i){if(i.get)return wa(i.get);if(typeof i.value=="function")return wa(i.value)}n=mX(n)}function t(){return null}return t}const pG=Ca(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),A2=Ca(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),S2=Ca(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),wX=Ca(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),E2=Ca(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),AX=Ca(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),gG=Ca(["#text"]),mG=Ca(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),T2=Ca(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),yG=Ca(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Q1=Ca(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),SX=Ql(/\{\{[\w\W]*|[\w\W]*\}\}/gm),EX=Ql(/<%[\w\W]*|[\w\W]*%>/gm),TX=Ql(/\$\{[\w\W]*/gm),RX=Ql(/^data-[\-\w.\u00B7-\uFFFF]+$/),MX=Ql(/^aria-[\-\w]+$/),zN=Ql(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),kX=Ql(/^(?:\w+script|data):/i),LX=Ql(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),UN=Ql(/^html$/i),PX=Ql(/^[a-z][.\w]*(-[.\w]+)+$/i);var _G=Object.freeze({__proto__:null,ARIA_ATTR:MX,ATTR_WHITESPACE:LX,CUSTOM_ELEMENT:PX,DATA_ATTR:RX,DOCTYPE_NAME:UN,ERB_EXPR:EX,IS_ALLOWED_URI:zN,IS_SCRIPT_OR_DATA:kX,MUSTACHE_EXPR:SX,TMPLIT_EXPR:TX});const t0={element:1,text:3,progressingInstruction:7,comment:8,document:9},GX=function(){return typeof window>"u"?null:window},FX=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let i=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(i=t.getAttribute(r));const o="dompurify"+(i?"#"+i:"");try{return e.createPolicy(o,{createHTML(s){return s},createScriptURL(s){return s}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},vG=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function XN(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:GX();const e=Ot=>XN(Ot);if(e.version="3.3.1",e.removed=[],!n||!n.document||n.document.nodeType!==t0.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const i=t,r=i.currentScript,{DocumentFragment:o,HTMLTemplateElement:s,Node:l,Element:u,NodeFilter:h,NamedNodeMap:d=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:m,DOMParser:y,trustedTypes:x}=n,C=u.prototype,w=e0(C,"cloneNode"),S=e0(C,"remove"),T=e0(C,"nextSibling"),M=e0(C,"childNodes"),G=e0(C,"parentNode");if(typeof s=="function"){const Ot=t.createElement("template");Ot.content&&Ot.content.ownerDocument&&(t=Ot.content.ownerDocument)}let N,V="";const{implementation:W,createNodeIterator:j,createDocumentFragment:J,getElementsByTagName:te}=t,{importNode:ce}=i;let pe=vG();e.isSupported=typeof WN=="function"&&typeof G=="function"&&W&&W.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Y,ERB_EXPR:he,TMPLIT_EXPR:D,DATA_ATTR:re,ARIA_ATTR:le,IS_SCRIPT_OR_DATA:fe,ATTR_WHITESPACE:Le,CUSTOM_ELEMENT:we}=_G;let{IS_ALLOWED_URI:se}=_G,Q=null;const q=Fi({},[...pG,...A2,...S2,...E2,...gG]);let $e=null;const Qe=Fi({},[...mG,...T2,...yG,...Q1]);let qe=Object.seal(CE(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Lt=null,Pt=null;const zt=Object.seal(CE(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Dt=!0,yn=!0,tn=!1,Ne=!0,Be=!1,z=!0,We=!1,ke=!1,ge=!1,ie=!1,Ce=!1,Te=!1,De=!0,Ze=!1;const Je="user-content-";let dt=!0,ft=!1,Tt={},hn=null;const cn=Fi({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let vi=null;const Hi=Fi({},["audio","video","img","source","image","track"]);let Li=null;const Tr=Fi({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),pi="http://www.w3.org/1998/Math/MathML",rs="http://www.w3.org/2000/svg",wi="http://www.w3.org/1999/xhtml";let Ti=wi,Bs=!1,xo=null;const Ea=Fi({},[pi,rs,wi],C2);let ms=Fi({},["mi","mo","mn","ms","mtext"]),Wr=Fi({},["annotation-xml"]);const zr=Fi({},["title","style","font","a","script"]);let ys=null;const Ml=["application/xhtml+xml","text/html"],Ai="text/html";let ee=null,ue=null;const me=t.createElement("form"),xe=function(Re){return Re instanceof RegExp||Re instanceof Function},Ae=function(){let Re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(ue&&ue===Re)){if((!Re||typeof Re!="object")&&(Re={}),Re=dc(Re),ys=Ml.indexOf(Re.PARSER_MEDIA_TYPE)===-1?Ai:Re.PARSER_MEDIA_TYPE,ee=ys==="application/xhtml+xml"?C2:iI,Q=gu(Re,"ALLOWED_TAGS")?Fi({},Re.ALLOWED_TAGS,ee):q,$e=gu(Re,"ALLOWED_ATTR")?Fi({},Re.ALLOWED_ATTR,ee):Qe,xo=gu(Re,"ALLOWED_NAMESPACES")?Fi({},Re.ALLOWED_NAMESPACES,C2):Ea,Li=gu(Re,"ADD_URI_SAFE_ATTR")?Fi(dc(Tr),Re.ADD_URI_SAFE_ATTR,ee):Tr,vi=gu(Re,"ADD_DATA_URI_TAGS")?Fi(dc(Hi),Re.ADD_DATA_URI_TAGS,ee):Hi,hn=gu(Re,"FORBID_CONTENTS")?Fi({},Re.FORBID_CONTENTS,ee):cn,Lt=gu(Re,"FORBID_TAGS")?Fi({},Re.FORBID_TAGS,ee):dc({}),Pt=gu(Re,"FORBID_ATTR")?Fi({},Re.FORBID_ATTR,ee):dc({}),Tt=gu(Re,"USE_PROFILES")?Re.USE_PROFILES:!1,Dt=Re.ALLOW_ARIA_ATTR!==!1,yn=Re.ALLOW_DATA_ATTR!==!1,tn=Re.ALLOW_UNKNOWN_PROTOCOLS||!1,Ne=Re.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Be=Re.SAFE_FOR_TEMPLATES||!1,z=Re.SAFE_FOR_XML!==!1,We=Re.WHOLE_DOCUMENT||!1,ie=Re.RETURN_DOM||!1,Ce=Re.RETURN_DOM_FRAGMENT||!1,Te=Re.RETURN_TRUSTED_TYPE||!1,ge=Re.FORCE_BODY||!1,De=Re.SANITIZE_DOM!==!1,Ze=Re.SANITIZE_NAMED_PROPS||!1,dt=Re.KEEP_CONTENT!==!1,ft=Re.IN_PLACE||!1,se=Re.ALLOWED_URI_REGEXP||zN,Ti=Re.NAMESPACE||wi,ms=Re.MATHML_TEXT_INTEGRATION_POINTS||ms,Wr=Re.HTML_INTEGRATION_POINTS||Wr,qe=Re.CUSTOM_ELEMENT_HANDLING||{},Re.CUSTOM_ELEMENT_HANDLING&&xe(Re.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(qe.tagNameCheck=Re.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Re.CUSTOM_ELEMENT_HANDLING&&xe(Re.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(qe.attributeNameCheck=Re.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Re.CUSTOM_ELEMENT_HANDLING&&typeof Re.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(qe.allowCustomizedBuiltInElements=Re.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Be&&(yn=!1),Ce&&(ie=!0),Tt&&(Q=Fi({},gG),$e=[],Tt.html===!0&&(Fi(Q,pG),Fi($e,mG)),Tt.svg===!0&&(Fi(Q,A2),Fi($e,T2),Fi($e,Q1)),Tt.svgFilters===!0&&(Fi(Q,S2),Fi($e,T2),Fi($e,Q1)),Tt.mathMl===!0&&(Fi(Q,E2),Fi($e,yG),Fi($e,Q1))),Re.ADD_TAGS&&(typeof Re.ADD_TAGS=="function"?zt.tagCheck=Re.ADD_TAGS:(Q===q&&(Q=dc(Q)),Fi(Q,Re.ADD_TAGS,ee))),Re.ADD_ATTR&&(typeof Re.ADD_ATTR=="function"?zt.attributeCheck=Re.ADD_ATTR:($e===Qe&&($e=dc($e)),Fi($e,Re.ADD_ATTR,ee))),Re.ADD_URI_SAFE_ATTR&&Fi(Li,Re.ADD_URI_SAFE_ATTR,ee),Re.FORBID_CONTENTS&&(hn===cn&&(hn=dc(hn)),Fi(hn,Re.FORBID_CONTENTS,ee)),Re.ADD_FORBID_CONTENTS&&(hn===cn&&(hn=dc(hn)),Fi(hn,Re.ADD_FORBID_CONTENTS,ee)),dt&&(Q["#text"]=!0),We&&Fi(Q,["html","head","body"]),Q.table&&(Fi(Q,["tbody"]),delete Lt.tbody),Re.TRUSTED_TYPES_POLICY){if(typeof Re.TRUSTED_TYPES_POLICY.createHTML!="function")throw Q_('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof Re.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Q_('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');N=Re.TRUSTED_TYPES_POLICY,V=N.createHTML("")}else N===void 0&&(N=FX(x,r)),N!==null&&typeof V=="string"&&(V=N.createHTML(""));Ca&&Ca(Re),ue=Re}},Ye=Fi({},[...A2,...S2,...wX]),ze=Fi({},[...E2,...AX]),ye=function(Re){let _t=G(Re);(!_t||!_t.tagName)&&(_t={namespaceURI:Ti,tagName:"template"});const Kt=iI(Re.tagName),mn=iI(_t.tagName);return xo[Re.namespaceURI]?Re.namespaceURI===rs?_t.namespaceURI===wi?Kt==="svg":_t.namespaceURI===pi?Kt==="svg"&&(mn==="annotation-xml"||ms[mn]):!!Ye[Kt]:Re.namespaceURI===pi?_t.namespaceURI===wi?Kt==="math":_t.namespaceURI===rs?Kt==="math"&&Wr[mn]:!!ze[Kt]:Re.namespaceURI===wi?_t.namespaceURI===rs&&!Wr[mn]||_t.namespaceURI===pi&&!ms[mn]?!1:!ze[Kt]&&(zr[Kt]||!Ye[Kt]):!!(ys==="application/xhtml+xml"&&xo[Re.namespaceURI]):!1},Se=function(Re){J_(e.removed,{element:Re});try{G(Re).removeChild(Re)}catch{S(Re)}},tt=function(Re,_t){try{J_(e.removed,{attribute:_t.getAttributeNode(Re),from:_t})}catch{J_(e.removed,{attribute:null,from:_t})}if(_t.removeAttribute(Re),Re==="is")if(ie||Ce)try{Se(_t)}catch{}else try{_t.setAttribute(Re,"")}catch{}},bt=function(Re){let _t=null,Kt=null;if(ge)Re="<remove></remove>"+Re;else{const En=w2(Re,/^[\r\n\t ]+/);Kt=En&&En[0]}ys==="application/xhtml+xml"&&Ti===wi&&(Re='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Re+"</body></html>");const mn=N?N.createHTML(Re):Re;if(Ti===wi)try{_t=new y().parseFromString(mn,ys)}catch{}if(!_t||!_t.documentElement){_t=W.createDocument(Ti,"template",null);try{_t.documentElement.innerHTML=Bs?V:mn}catch{}}const Bn=_t.body||_t.documentElement;return Re&&Kt&&Bn.insertBefore(t.createTextNode(Kt),Bn.childNodes[0]||null),Ti===wi?te.call(_t,We?"html":"body")[0]:We?_t.documentElement:Bn},St=function(Re){return j.call(Re.ownerDocument||Re,Re,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null)},ct=function(Re){return Re instanceof m&&(typeof Re.nodeName!="string"||typeof Re.textContent!="string"||typeof Re.removeChild!="function"||!(Re.attributes instanceof d)||typeof Re.removeAttribute!="function"||typeof Re.setAttribute!="function"||typeof Re.namespaceURI!="string"||typeof Re.insertBefore!="function"||typeof Re.hasChildNodes!="function")},It=function(Re){return typeof l=="function"&&Re instanceof l};function qt(Ot,Re,_t){q1(Ot,Kt=>{Kt.call(e,Re,_t,ue)})}const nn=function(Re){let _t=null;if(qt(pe.beforeSanitizeElements,Re,null),ct(Re))return Se(Re),!0;const Kt=ee(Re.nodeName);if(qt(pe.uponSanitizeElement,Re,{tagName:Kt,allowedTags:Q}),z&&Re.hasChildNodes()&&!It(Re.firstElementChild)&&ga(/<[/\w!]/g,Re.innerHTML)&&ga(/<[/\w!]/g,Re.textContent)||Re.nodeType===t0.progressingInstruction||z&&Re.nodeType===t0.comment&&ga(/<[/\w]/g,Re.data))return Se(Re),!0;if(!(zt.tagCheck instanceof Function&&zt.tagCheck(Kt))&&(!Q[Kt]||Lt[Kt])){if(!Lt[Kt]&&$t(Kt)&&(qe.tagNameCheck instanceof RegExp&&ga(qe.tagNameCheck,Kt)||qe.tagNameCheck instanceof Function&&qe.tagNameCheck(Kt)))return!1;if(dt&&!hn[Kt]){const mn=G(Re)||Re.parentNode,Bn=M(Re)||Re.childNodes;if(Bn&&mn){const En=Bn.length;for(let qi=En-1;qi>=0;--qi){const ai=w(Bn[qi],!0);ai.__removalCount=(Re.__removalCount||0)+1,mn.insertBefore(ai,T(Re))}}}return Se(Re),!0}return Re instanceof u&&!ye(Re)||(Kt==="noscript"||Kt==="noembed"||Kt==="noframes")&&ga(/<\/no(script|embed|frames)/i,Re.innerHTML)?(Se(Re),!0):(Be&&Re.nodeType===t0.text&&(_t=Re.textContent,q1([Y,he,D],mn=>{_t=q_(_t,mn," ")}),Re.textContent!==_t&&(J_(e.removed,{element:Re.cloneNode()}),Re.textContent=_t)),qt(pe.afterSanitizeElements,Re,null),!1)},pt=function(Re,_t,Kt){if(De&&(_t==="id"||_t==="name")&&(Kt in t||Kt in me))return!1;if(!(yn&&!Pt[_t]&&ga(re,_t))){if(!(Dt&&ga(le,_t))){if(!(zt.attributeCheck instanceof Function&&zt.attributeCheck(_t,Re))){if(!$e[_t]||Pt[_t]){if(!($t(Re)&&(qe.tagNameCheck instanceof RegExp&&ga(qe.tagNameCheck,Re)||qe.tagNameCheck instanceof Function&&qe.tagNameCheck(Re))&&(qe.attributeNameCheck instanceof RegExp&&ga(qe.attributeNameCheck,_t)||qe.attributeNameCheck instanceof Function&&qe.attributeNameCheck(_t,Re))||_t==="is"&&qe.allowCustomizedBuiltInElements&&(qe.tagNameCheck instanceof RegExp&&ga(qe.tagNameCheck,Kt)||qe.tagNameCheck instanceof Function&&qe.tagNameCheck(Kt))))return!1}else if(!Li[_t]){if(!ga(se,q_(Kt,Le,""))){if(!((_t==="src"||_t==="xlink:href"||_t==="href")&&Re!=="script"&&bX(Kt,"data:")===0&&vi[Re])){if(!(tn&&!ga(fe,q_(Kt,Le,"")))){if(Kt)return!1}}}}}}}return!0},$t=function(Re){return Re!=="annotation-xml"&&w2(Re,we)},Ut=function(Re){qt(pe.beforeSanitizeAttributes,Re,null);const{attributes:_t}=Re;if(!_t||ct(Re))return;const Kt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:$e,forceKeepAttr:void 0};let mn=_t.length;for(;mn--;){const Bn=_t[mn],{name:En,namespaceURI:qi,value:ai}=Bn,ir=ee(En),Pi=ai;let Rn=En==="value"?Pi:xX(Pi);if(Kt.attrName=ir,Kt.attrValue=Rn,Kt.keepAttr=!0,Kt.forceKeepAttr=void 0,qt(pe.uponSanitizeAttribute,Re,Kt),Rn=Kt.attrValue,Ze&&(ir==="id"||ir==="name")&&(tt(En,Re),Rn=Je+Rn),z&&ga(/((--!?|])>)|<\/(style|title|textarea)/i,Rn)){tt(En,Re);continue}if(ir==="attributename"&&w2(Rn,"href")){tt(En,Re);continue}if(Kt.forceKeepAttr)continue;if(!Kt.keepAttr){tt(En,Re);continue}if(!Ne&&ga(/\/>/i,Rn)){tt(En,Re);continue}Be&&q1([Y,he,D],Zs=>{Rn=q_(Rn,Zs," ")});const bi=ee(Re.nodeName);if(!pt(bi,ir,Rn)){tt(En,Re);continue}if(N&&typeof x=="object"&&typeof x.getAttributeType=="function"&&!qi)switch(x.getAttributeType(bi,ir)){case"TrustedHTML":{Rn=N.createHTML(Rn);break}case"TrustedScriptURL":{Rn=N.createScriptURL(Rn);break}}if(Rn!==Pi)try{qi?Re.setAttributeNS(qi,En,Rn):Re.setAttribute(En,Rn),ct(Re)?Se(Re):fG(e.removed)}catch{tt(En,Re)}}qt(pe.afterSanitizeAttributes,Re,null)},Yt=function Ot(Re){let _t=null;const Kt=St(Re);for(qt(pe.beforeSanitizeShadowDOM,Re,null);_t=Kt.nextNode();)qt(pe.uponSanitizeShadowNode,_t,null),nn(_t),Ut(_t),_t.content instanceof o&&Ot(_t.content);qt(pe.afterSanitizeShadowDOM,Re,null)};return e.sanitize=function(Ot){let Re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_t=null,Kt=null,mn=null,Bn=null;if(Bs=!Ot,Bs&&(Ot="<!-->"),typeof Ot!="string"&&!It(Ot))if(typeof Ot.toString=="function"){if(Ot=Ot.toString(),typeof Ot!="string")throw Q_("dirty is not a string, aborting")}else throw Q_("toString is not a function");if(!e.isSupported)return Ot;if(ke||Ae(Re),e.removed=[],typeof Ot=="string"&&(ft=!1),ft){if(Ot.nodeName){const ai=ee(Ot.nodeName);if(!Q[ai]||Lt[ai])throw Q_("root node is forbidden and cannot be sanitized in-place")}}else if(Ot instanceof l)_t=bt("<!---->"),Kt=_t.ownerDocument.importNode(Ot,!0),Kt.nodeType===t0.element&&Kt.nodeName==="BODY"||Kt.nodeName==="HTML"?_t=Kt:_t.appendChild(Kt);else{if(!ie&&!Be&&!We&&Ot.indexOf("<")===-1)return N&&Te?N.createHTML(Ot):Ot;if(_t=bt(Ot),!_t)return ie?null:Te?V:""}_t&&ge&&Se(_t.firstChild);const En=St(ft?Ot:_t);for(;mn=En.nextNode();)nn(mn),Ut(mn),mn.content instanceof o&&Yt(mn.content);if(ft)return Ot;if(ie){if(Ce)for(Bn=J.call(_t.ownerDocument);_t.firstChild;)Bn.appendChild(_t.firstChild);else Bn=_t;return($e.shadowroot||$e.shadowrootmode)&&(Bn=ce.call(i,Bn,!0)),Bn}let qi=We?_t.outerHTML:_t.innerHTML;return We&&Q["!doctype"]&&_t.ownerDocument&&_t.ownerDocument.doctype&&_t.ownerDocument.doctype.name&&ga(UN,_t.ownerDocument.doctype.name)&&(qi="<!DOCTYPE "+_t.ownerDocument.doctype.name+`>
`+qi),Be&&q1([Y,he,D],ai=>{qi=q_(qi,ai," ")}),N&&Te?N.createHTML(qi):qi},e.setConfig=function(){let Ot=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ae(Ot),ke=!0},e.clearConfig=function(){ue=null,ke=!1},e.isValidAttribute=function(Ot,Re,_t){ue||Ae({});const Kt=ee(Ot),mn=ee(Re);return pt(Kt,mn,_t)},e.addHook=function(Ot,Re){typeof Re=="function"&&J_(pe[Ot],Re)},e.removeHook=function(Ot,Re){if(Re!==void 0){const _t=_X(pe[Ot],Re);return _t===-1?void 0:vX(pe[Ot],_t,1)[0]}return fG(pe[Ot])},e.removeHooks=function(Ot){pe[Ot]=[]},e.removeAllHooks=function(){pe=vG()},e}var OX=XN();function NX(n,e){const t=n.hooks??{};let i;for(i in t){const r=t[i];r!==void 0&&e.addHook(i,r)}}function YN(){return OX()}function DX(n={},e=YN){const t=e();NX(n,t);const i=function(s){const l=s.value;if(s.oldValue===l)return;const u=`${l}`,h=s.arg,d=n.namedConfigurations,m=n.default??{};return d&&h!==void 0?t.sanitize(u,d[h]??m):t.sanitize(u,m)},r=function(s,l){const u=i(l);u!==void 0&&(s.innerHTML=u)},o={mounted:r,updated:r};return n.enableSSRPropsSupport?{...o,getSSRProps(s){return{innerHTML:i(s)}}}:o}const VX={install(n,e={},t=YN){n.directive("dompurify-html",DX(e,t))}};let HN;const Tw=n=>HN=n,KN=Symbol();function SE(n){return n&&typeof n=="object"&&Object.prototype.toString.call(n)==="[object Object]"&&typeof n.toJSON!="function"}var Y0;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})(Y0||(Y0={}));function BX(){const n=M3(!0),e=n.run(()=>Ke({}));let t=[],i=[];const r=xR({install(o){Tw(r),r._a=o,o.provide(KN,r),o.config.globalProperties.$pinia=r,i.forEach(s=>t.push(s)),i=[]},use(o){return this._a?t.push(o):i.push(o),this},_p:t,_a:null,_e:n,_s:new Map,state:e});return r}const jN=()=>{};function bG(n,e,t,i=jN){n.push(e);const r=()=>{const o=n.indexOf(e);o>-1&&(n.splice(o,1),i())};return!t&&k3()&&j6(r),r}function dm(n,...e){n.slice().forEach(t=>{t(...e)})}const ZX=n=>n(),xG=Symbol(),R2=Symbol();function EE(n,e){n instanceof Map&&e instanceof Map?e.forEach((t,i)=>n.set(i,t)):n instanceof Set&&e instanceof Set&&e.forEach(n.add,n);for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t],r=n[t];SE(r)&&SE(i)&&n.hasOwnProperty(t)&&!Pr(i)&&!Ac(i)?n[t]=EE(r,i):n[t]=i}return n}const WX=Symbol();function zX(n){return!SE(n)||!n.hasOwnProperty(WX)}const{assign:Od}=Object;function UX(n){return!!(Pr(n)&&n.effect)}function XX(n,e,t,i){const{state:r,actions:o,getters:s}=e,l=t.state.value[n];let u;function h(){l||(t.state.value[n]=r?r():{});const d=v9(t.state.value[n]);return Od(d,o,Object.keys(s||{}).reduce((m,y)=>(m[y]=xR(At(()=>{Tw(t);const x=t._s.get(n);return s[y].call(x,x)})),m),{}))}return u=$N(n,h,e,t,i,!0),u}function $N(n,e,t={},i,r,o){let s;const l=Od({actions:{}},t),u={deep:!0};let h,d,m=[],y=[],x;const C=i.state.value[n];!o&&!C&&(i.state.value[n]={}),Ke({});let w;function S(J){let te;h=d=!1,typeof J=="function"?(J(i.state.value[n]),te={type:Y0.patchFunction,storeId:n,events:x}):(EE(i.state.value[n],J),te={type:Y0.patchObject,payload:J,storeId:n,events:x});const ce=w=Symbol();aa().then(()=>{w===ce&&(h=!0)}),d=!0,dm(m,te,i.state.value[n])}const T=o?function(){const{state:te}=t,ce=te?te():{};this.$patch(pe=>{Od(pe,ce)})}:jN;function M(){s.stop(),m=[],y=[],i._s.delete(n)}const G=(J,te="")=>{if(xG in J)return J[R2]=te,J;const ce=function(){Tw(i);const pe=Array.from(arguments),Y=[],he=[];function D(fe){Y.push(fe)}function re(fe){he.push(fe)}dm(y,{args:pe,name:ce[R2],store:V,after:D,onError:re});let le;try{le=J.apply(this&&this.$id===n?this:V,pe)}catch(fe){throw dm(he,fe),fe}return le instanceof Promise?le.then(fe=>(dm(Y,fe),fe)).catch(fe=>(dm(he,fe),Promise.reject(fe))):(dm(Y,le),le)};return ce[xG]=!0,ce[R2]=te,ce},N={_p:i,$id:n,$onAction:bG.bind(null,y),$patch:S,$reset:T,$subscribe(J,te={}){const ce=bG(m,J,te.detached,()=>pe()),pe=s.run(()=>kt(()=>i.state.value[n],Y=>{(te.flush==="sync"?d:h)&&J({storeId:n,type:Y0.direct,events:x},Y)},Od({},u,te)));return ce},$dispose:M},V=yw(N);i._s.set(n,V);const j=(i._a&&i._a.runWithContext||ZX)(()=>i._e.run(()=>(s=M3()).run(()=>e({action:G}))));for(const J in j){const te=j[J];if(Pr(te)&&!UX(te)||Ac(te))o||(C&&zX(te)&&(Pr(te)?te.value=C[J]:EE(te,C[J])),i.state.value[n][J]=te);else if(typeof te=="function"){const ce=G(te,J);j[J]=ce,l.actions[J]=te}}return Od(V,j),Od(ji(V),j),Object.defineProperty(V,"$state",{get:()=>i.state.value[n],set:J=>{S(te=>{Od(te,J)})}}),i._p.forEach(J=>{Od(V,s.run(()=>J({store:V,app:i._a,pinia:i,options:l})))}),C&&o&&t.hydrate&&t.hydrate(V.$state,C),h=!0,d=!0,V}function Sa(n,e,t){let i,r;const o=typeof e=="function";typeof n=="string"?(i=n,r=o?t:e):(r=n,i=n.id);function s(l,u){const h=J9();return l=l||(h?Go(KN,null):null),l&&Tw(l),l=HN,l._s.has(i)||(o?$N(i,e,r,l):XX(i,r,l)),l._s.get(i)}return s.$id=i,s}function xt(n){{const e=ji(n),t={};for(const i in e){const r=e[i];r.effect?t[i]=At({get:()=>n[i],set(o){n[i]=o}}):(Pr(r)||Ac(r))&&(t[i]=K3(n,i))}return t}}function JN(...n){console.warn(...n)}const _o={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Ks(n){const e=Qa();for(let t=0,i=n.length;t<i;++t)H0(e,n[t]);return e}function YX(n,e,t){const i=Math.min.apply(null,n),r=Math.min.apply(null,e),o=Math.max.apply(null,n),s=Math.max.apply(null,e);return Pc(i,r,o,s,t)}function Hh(n,e,t){return t?(t[0]=n[0]-e,t[1]=n[1]-e,t[2]=n[2]+e,t[3]=n[3]+e,t):[n[0]-e,n[1]-e,n[2]+e,n[3]+e]}function qN(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n.slice()}function ag(n,e,t){let i,r;return e<n[0]?i=n[0]-e:n[2]<e?i=e-n[2]:i=0,t<n[1]?r=n[1]-t:n[3]<t?r=t-n[3]:r=0,i*i+r*r}function Lc(n,e){return kR(n,e[0],e[1])}function _c(n,e){return n[0]<=e[0]&&e[2]<=n[2]&&n[1]<=e[1]&&e[3]<=n[3]}function kR(n,e,t){return n[0]<=e&&e<=n[2]&&n[1]<=t&&t<=n[3]}function TE(n,e){const t=n[0],i=n[1],r=n[2],o=n[3],s=e[0],l=e[1];let u=_o.UNKNOWN;return s<t?u=u|_o.LEFT:s>r&&(u=u|_o.RIGHT),l<i?u=u|_o.BELOW:l>o&&(u=u|_o.ABOVE),u===_o.UNKNOWN&&(u=_o.INTERSECTING),u}function Qa(){return[1/0,1/0,-1/0,-1/0]}function Pc(n,e,t,i,r){return r?(r[0]=n,r[1]=e,r[2]=t,r[3]=i,r):[n,e,t,i]}function Fy(n){return Pc(1/0,1/0,-1/0,-1/0,n)}function ey(n,e){const t=n[0],i=n[1];return Pc(t,i,t,i,e)}function LR(n,e,t,i,r){const o=Fy(r);return QN(o,n,e,t,i)}function Up(n,e){return n[0]==e[0]&&n[2]==e[2]&&n[1]==e[1]&&n[3]==e[3]}function by(n,e){return e[0]<n[0]&&(n[0]=e[0]),e[2]>n[2]&&(n[2]=e[2]),e[1]<n[1]&&(n[1]=e[1]),e[3]>n[3]&&(n[3]=e[3]),n}function H0(n,e){e[0]<n[0]&&(n[0]=e[0]),e[0]>n[2]&&(n[2]=e[0]),e[1]<n[1]&&(n[1]=e[1]),e[1]>n[3]&&(n[3]=e[1])}function QN(n,e,t,i,r){for(;t<i;t+=r)HX(n,e[t],e[t+1]);return n}function HX(n,e,t){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}function PR(n,e){let t;return t=e(Rw(n)),t||(t=e(Mw(n)),t)||(t=e(kw(n)),t)||(t=e(td(n)),t)?t:!1}function RE(n){let e=0;return lg(n)||(e=Ni(n)*Ns(n)),e}function Rw(n){return[n[0],n[1]]}function Mw(n){return[n[2],n[1]]}function ku(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function KX(n,e){let t;if(e==="bottom-left")t=Rw(n);else if(e==="bottom-right")t=Mw(n);else if(e==="top-left")t=td(n);else if(e==="top-right")t=kw(n);else throw new Error("Invalid corner");return t}function Av(n,e,t,i,r){const[o,s,l,u,h,d,m,y]=eD(n,e,t,i);return Pc(Math.min(o,l,h,m),Math.min(s,u,d,y),Math.max(o,l,h,m),Math.max(s,u,d,y),r)}function eD(n,e,t,i){const r=e*i[0]/2,o=e*i[1]/2,s=Math.cos(t),l=Math.sin(t),u=r*s,h=r*l,d=o*s,m=o*l,y=n[0],x=n[1];return[y-u+m,x-h-d,y-u-m,x-h+d,y+u-m,x+h+d,y+u+m,x+h-d,y-u+m,x-h-d]}function Ns(n){return n[3]-n[1]}function Sc(n,e,t){const i=t||Qa();return Os(n,e)?(n[0]>e[0]?i[0]=n[0]:i[0]=e[0],n[1]>e[1]?i[1]=n[1]:i[1]=e[1],n[2]<e[2]?i[2]=n[2]:i[2]=e[2],n[3]<e[3]?i[3]=n[3]:i[3]=e[3]):Fy(i),i}function td(n){return[n[0],n[3]]}function kw(n){return[n[2],n[3]]}function Ni(n){return n[2]-n[0]}function Os(n,e){return n[0]<=e[2]&&n[2]>=e[0]&&n[1]<=e[3]&&n[3]>=e[1]}function lg(n){return n[2]<n[0]||n[3]<n[1]}function jX(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n}function $X(n,e,t){let i=!1;const r=TE(n,e),o=TE(n,t);if(r===_o.INTERSECTING||o===_o.INTERSECTING)i=!0;else{const s=n[0],l=n[1],u=n[2],h=n[3],d=e[0],m=e[1],y=t[0],x=t[1],C=(x-m)/(y-d);let w,S;o&_o.ABOVE&&!(r&_o.ABOVE)&&(w=y-(x-h)/C,i=w>=s&&w<=u),!i&&o&_o.RIGHT&&!(r&_o.RIGHT)&&(S=x-(y-u)*C,i=S>=l&&S<=h),!i&&o&_o.BELOW&&!(r&_o.BELOW)&&(w=y-(x-l)/C,i=w>=s&&w<=u),!i&&o&_o.LEFT&&!(r&_o.LEFT)&&(S=x-(y-s)*C,i=S>=l&&S<=h)}return i}function JX(n,e,t,i){if(lg(n))return Fy(t);let r=[];if(i>1){const l=n[2]-n[0],u=n[3]-n[1];for(let h=0;h<i;++h)r.push(n[0]+l*h/i,n[1],n[2],n[1]+u*h/i,n[2]-l*h/i,n[3],n[0],n[3]-u*h/i)}else r=[n[0],n[1],n[2],n[1],n[2],n[3],n[0],n[3]];e(r,r,2);const o=[],s=[];for(let l=0,u=r.length;l<u;l+=2)o.push(r[l]),s.push(r[l+1]);return YX(o,s,t)}function tD(n,e){const t=e.getExtent(),i=ku(n);if(e.canWrapX()&&(i[0]<t[0]||i[0]>=t[2])){const r=Ni(t),s=Math.floor((i[0]-t[0])/r)*r;n[0]-=s,n[2]-=s}return n}function nD(n,e,t){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[i[0],n[1],i[2],n[3]]];tD(n,e);const r=Ni(i);if(Ni(n)>r&&!t)return[[i[0],n[1],i[2],n[3]]];if(n[0]<i[0])return[[n[0]+r,n[1],i[2],n[3]],[i[0],n[1],n[2],n[3]]];if(n[2]>i[2])return[[n[0],n[1],i[2],n[3]],[i[0],n[1],n[2]-r,n[3]]]}return[n]}function Br(n,e,t){return Math.min(Math.max(n,e),t)}function qX(n,e,t,i,r,o){const s=r-t,l=o-i;if(s!==0||l!==0){const u=((n-t)*s+(e-i)*l)/(s*s+l*l);u>1?(t=r,i=o):u>0&&(t+=s*u,i+=l*u)}return Ph(n,e,t,i)}function Ph(n,e,t,i){const r=t-n,o=i-e;return r*r+o*o}function QX(n){const e=n.length;for(let i=0;i<e;i++){let r=i,o=Math.abs(n[i][i]);for(let l=i+1;l<e;l++){const u=Math.abs(n[l][i]);u>o&&(o=u,r=l)}if(o===0)return null;const s=n[r];n[r]=n[i],n[i]=s;for(let l=i+1;l<e;l++){const u=-n[l][i]/n[i][i];for(let h=i;h<e+1;h++)i==h?n[l][h]=0:n[l][h]+=u*n[i][h]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=n[i][e]/n[i][i];for(let r=i-1;r>=0;r--)n[r][e]-=n[r][i]*t[i]}return t}function Kh(n){return n*180/Math.PI}function ra(n){return n*Math.PI/180}function Gh(n,e){const t=n%e;return t*e<0?t+e:t}function ml(n,e,t){return n+t*(e-n)}function Oy(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}function IG(n,e){return Math.round(Oy(n,e))}function Om(n,e){return Math.floor(Oy(n,e))}function Kd(n,e){return Math.ceil(Oy(n,e))}function ME(n,e,t){if(n>=e&&n<t)return n;const i=t-e;return((n-e)%i+i)%i+e}function Xd(n,e,t){const i=""+n;let r=i.indexOf(".");return r=r===-1?i.length:r,r>e?i:new Array(1+e-r).join("0")+i}function GR(n,e){const t=(""+n).split("."),i=(""+e).split(".");for(let r=0;r<Math.max(t.length,i.length);r++){const o=parseInt(t[r]||"0",10),s=parseInt(i[r]||"0",10);if(o>s)return 1;if(s>o)return-1}return 0}function eY(n,e){return n[0]+=+e[0],n[1]+=+e[1],n}function lb(n,e){const t=n[0],i=n[1],r=e[0],o=e[1],s=r[0],l=r[1],u=o[0],h=o[1],d=u-s,m=h-l,y=d===0&&m===0?0:(d*(t-s)+m*(i-l))/(d*d+m*m||0);let x,C;return y<=0?(x=s,C=l):y>=1?(x=u,C=h):(x=s+y*d,C=l+y*m),[x,C]}function n0(n,e,t){return n?e.replace("{x}",n[0].toFixed(t)).replace("{y}",n[1].toFixed(t)):""}function Yo(n,e){let t=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=e[i]){t=!1;break}return t}function FR(n,e){const t=Math.cos(e),i=Math.sin(e),r=n[0]*t-n[1]*i,o=n[1]*t+n[0]*i;return n[0]=r,n[1]=o,n}function tY(n,e){return n[0]*=e,n[1]*=e,n}function Fh(n,e){const t=n[0]-e[0],i=n[1]-e[1];return t*t+i*i}function Nm(n,e){return Math.sqrt(Fh(n,e))}function kE(n,e){return Fh(n,lb(n,e))}function Lw(n,e){if(e.canWrapX()){const t=Ni(e.getExtent()),i=iD(n,e,t);i&&(n[0]-=i*t)}return n}function iD(n,e,t){const i=e.getExtent();let r=0;return e.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(t=t||Ni(i),r=Math.floor((n[0]-i[0])/t)),r}const Xp={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let Pw=class{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Xp[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const ub=6378137,Dm=Math.PI*ub,nY=[-Dm,-Dm,Dm,Dm],iY=[-180,-85,180,85],ex=ub*Math.log(Math.tan(Math.PI/2));class fm extends Pw{constructor(e){super({code:e,units:"m",extent:nY,global:!0,worldExtent:iY,getPointResolution:function(t,i){return t/Math.cosh(i[1]/ub)}})}}const CG=[new fm("EPSG:3857"),new fm("EPSG:102100"),new fm("EPSG:102113"),new fm("EPSG:900913"),new fm("http://www.opengis.net/def/crs/EPSG/0/3857"),new fm("http://www.opengis.net/gml/srs/epsg.xml#3857")];function rY(n,e,t,i){const r=n.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=n.slice():e=new Array(r));for(let o=0;o<r;o+=i){e[o]=Dm*n[o]/180;let s=ub*Math.log(Math.tan(Math.PI*(+n[o+1]+90)/360));s>ex?s=ex:s<-ex&&(s=-ex),e[o+1]=s}return e}function sY(n,e,t,i){const r=n.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=n.slice():e=new Array(r));for(let o=0;o<r;o+=i)e[o]=180*n[o]/Dm,e[o+1]=360*Math.atan(Math.exp(n[o+1]/ub))/Math.PI-90;return e}const oY=6378137,wG=[-180,-90,180,90],aY=Math.PI*oY/180;class hp extends Pw{constructor(e,t){super({code:e,units:"degrees",extent:wG,axisOrientation:t,global:!0,metersPerUnit:aY,worldExtent:wG})}}const AG=[new hp("CRS:84"),new hp("EPSG:4326","neu"),new hp("urn:ogc:def:crs:OGC:1.3:CRS84"),new hp("urn:ogc:def:crs:OGC:2:84"),new hp("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new hp("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new hp("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let LE={};function rI(n){return LE[n]||LE[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function lY(n,e){LE[n]=e}function cb(n){for(const e in n)delete n[e]}function Yp(n){let e;for(e in n)return!1;return!e}let ty={};function Hp(n,e,t){const i=n.getCode(),r=e.getCode();i in ty||(ty[i]={}),ty[i][r]=t}function sI(n,e){return n in ty&&e in ty[n]?ty[n][e]:null}const qI=.9996,Yl=.00669438,Gw=Yl*Yl,Fw=Gw*Yl,Ep=Yl/(1-Yl),SG=Math.sqrt(1-Yl),xy=(1-SG)/(1+SG),rD=xy*xy,OR=rD*xy,NR=OR*xy,sD=NR*xy,oD=1-Yl/4-3*Gw/64-5*Fw/256,uY=3*Yl/8+3*Gw/32+45*Fw/1024,cY=15*Gw/256+45*Fw/1024,hY=35*Fw/3072,dY=3/2*xy-27/32*OR+269/512*sD,fY=21/16*rD-55/32*NR,pY=151/96*OR-417/128*sD,gY=1097/512*NR,QI=6378137;function mY(n,e,t){const i=n-5e5,s=(t.north?e:e-1e7)/qI/(QI*oD),l=s+dY*Math.sin(2*s)+fY*Math.sin(4*s)+pY*Math.sin(6*s)+gY*Math.sin(8*s),u=Math.sin(l),h=u*u,d=Math.cos(l),m=u/d,y=m*m,x=y*y,C=1-Yl*h,w=Math.sqrt(1-Yl*h),S=QI/w,T=(1-Yl)/C,M=Ep*d**2,G=M*M,N=i/(S*qI),V=N*N,W=V*N,j=W*N,J=j*N,te=J*N,ce=l-m/T*(V/2-j/24*(5+3*y+10*M-4*G-9*Ep))+te/720*(61+90*y+298*M+45*x-252*Ep-3*G);let pe=(N-W/6*(1+2*y+M)+J/120*(5-2*M+28*y-3*G+8*Ep+24*x))/d;return pe=ME(pe+ra(aD(t.number)),-Math.PI,Math.PI),[Kh(pe),Kh(ce)]}const EG=-80,TG=84,yY=-180,_Y=180;function vY(n,e,t){n=ME(n,yY,_Y),e<EG?e=EG:e>TG&&(e=TG);const i=ra(e),r=Math.sin(i),o=Math.cos(i),s=r/o,l=s*s,u=l*l,h=ra(n),d=aD(t.number),m=ra(d),y=QI/Math.sqrt(1-Yl*r**2),x=Ep*o**2,C=o*ME(h-m,-Math.PI,Math.PI),w=C*C,S=w*C,T=S*C,M=T*C,G=M*C,N=QI*(oD*i-uY*Math.sin(2*i)+cY*Math.sin(4*i)-hY*Math.sin(6*i)),V=qI*y*(C+S/6*(1-l+x)+M/120*(5-18*l+u+72*x-58*Ep))+5e5;let W=qI*(N+y*s*(w/2+T/24*(5-l+9*x+4*x**2)+G/720*(61-58*l+u+600*x-330*Ep)));return t.north||(W+=1e7),[V,W]}function aD(n){return(n-1)*6-180+3}const bY=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function lD(n){let e=0;for(const r of bY){const o=n.match(r);if(o){e=parseInt(o[1]);break}}if(!e)return null;let t=0,i=!1;return e>32700&&e<32761?t=e-32700:e>32600&&e<32661&&(i=!0,t=e-32600),t?{number:t,north:i}:null}function RG(n,e){return function(t,i,r,o){const s=t.length;r=r>1?r:2,o=o??r,i||(r>2?i=t.slice():i=new Array(s));for(let l=0;l<s;l+=o){const u=t[l],h=t[l+1],d=n(u,h,e);i[l]=d[0],i[l+1]=d[1]}return i}}function xY(n){return lD(n)?new Pw({code:n,units:"m"}):null}function IY(n){const e=lD(n.getCode());return e?{forward:RG(vY,e),inverse:RG(mY,e)}:null}const DR=63710088e-1;function eC(n,e,t){t=t||DR;const i=ra(n[1]),r=ra(e[1]),o=(r-i)/2,s=ra(e[0]-n[0])/2,l=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(i)*Math.cos(r);return 2*t*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}function tx(n,e){let t=0;const i=n.length;let r=n[i-1][0],o=n[i-1][1];for(let s=0;s<i;s++){const l=n[s][0],u=n[s][1];t+=ra(l-r)*(2+Math.sin(ra(o))+Math.sin(ra(u))),r=l,o=u}return t*e*e/2}function uD(n,e){e=e||{};const t=e.radius||DR,i=e.projection||"EPSG:3857",r=n.getType();r!=="GeometryCollection"&&(n=n.clone().transform(i,"EPSG:4326"));let o=0,s,l,u,h,d,m;switch(r){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":{for(s=n.getCoordinates(),o=Math.abs(tx(s[0],t)),u=1,h=s.length;u<h;++u)o-=Math.abs(tx(s[u],t));break}case"MultiPolygon":{for(s=n.getCoordinates(),u=0,h=s.length;u<h;++u)for(l=s[u],o+=Math.abs(tx(l[0],t)),d=1,m=l.length;d<m;++d)o-=Math.abs(tx(l[d],t));break}case"GeometryCollection":{const y=n.getGeometries();for(u=0,h=y.length;u<h;++u)o+=uD(y[u],e);break}default:throw new Error("Unsupported geometry type: "+r)}return o}function CY(n,e,t,i){i=i||DR;const r=ra(n[1]),o=ra(n[0]),s=e/i,l=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(t)),u=o+Math.atan2(Math.sin(t)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(l));return[Kh(u),Kh(l)]}const wY=[IY],AY=[xY];let PE=!0;function SY(n){PE=!1}function VR(n,e){if(e!==void 0){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];e=e}else e=n.slice();return e}function cD(n,e){if(e!==void 0&&n!==e){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];n=e}return n}function tC(n){lY(n.getCode(),n),Hp(n,n,VR)}function EY(n){n.forEach(tC)}function Oi(n){if(typeof n!="string")return n;const e=rI(n);if(e)return e;for(const t of AY){const i=t(n);if(i)return i}return null}function Sv(n,e,t,i){n=Oi(n);let r;const o=n.getPointResolutionFunc();if(o){if(r=o(e,t),i&&i!==n.getUnits()){const s=n.getMetersPerUnit();s&&(r=r*s/Xp[i])}}else{const s=n.getUnits();if(s=="degrees"&&!i||i=="degrees")r=e;else{const l=Ny(n,Oi("EPSG:4326"));if(!l&&s!=="degrees")r=e*n.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=l(h,h,2);const d=eC(h.slice(0,2),h.slice(2,4)),m=eC(h.slice(4,6),h.slice(6,8));r=(d+m)/2}const u=i?Xp[i]:n.getMetersPerUnit();u!==void 0&&(r/=u)}}return r}function GE(n){EY(n),n.forEach(function(e){n.forEach(function(t){e!==t&&Hp(e,t,VR)})})}function TY(n,e,t,i){n.forEach(function(r){e.forEach(function(o){Hp(r,o,t),Hp(o,r,i)})})}function BR(n,e){return n?typeof n=="string"?Oi(n):n:Oi(e)}function FE(n){return(function(e,t,i,r){const o=e.length;i=i!==void 0?i:2,r=r??i,t=t!==void 0?t:new Array(o);for(let s=0;s<o;s+=r){const l=n(e.slice(s,s+i)),u=l.length;for(let h=0,d=r;h<d;++h)t[s+h]=h>=u?e[s+h]:l[h]}return t})}function RY(n,e,t,i){const r=Oi(n),o=Oi(e);Hp(r,o,FE(t)),Hp(o,r,FE(i))}function vc(n,e){const t=gs(n,e!==void 0?e:"EPSG:3857","EPSG:4326"),i=t[0];return(i<-180||i>180)&&(t[0]=Gh(i+180,360)-180),t}function Oh(n,e){if(n===e)return!0;const t=n.getUnits()===e.getUnits();return(n.getCode()===e.getCode()||Ny(n,e)===VR)&&t}function Ny(n,e){const t=n.getCode(),i=e.getCode();let r=sI(t,i);if(r)return r;let o=null,s=null;for(const u of wY)o||(o=u(n)),s||(s=u(e));if(!o&&!s)return null;const l="EPSG:4326";if(s)if(o)r=M2(o.inverse,s.forward);else{const u=sI(t,l);u&&(r=M2(u,s.forward))}else{const u=sI(l,i);u&&(r=M2(o.inverse,u))}return r&&(tC(n),tC(e),Hp(n,e,r)),r}function M2(n,e){return function(t,i,r,o){return i=n(t,i,r,o),e(i,i,r,o)}}function ff(n,e){const t=Oi(n),i=Oi(e);return Ny(t,i)}function gs(n,e,t){const i=ff(e,t);if(!i){const r=Oi(e).getCode(),o=Oi(t).getCode();throw new Error(`No transform available between ${r} and ${o}`)}return i(n,void 0,n.length)}function hb(n,e,t,i){const r=ff(e,t);return JX(n,r,void 0,i)}let MY=null;function kY(){return MY}function Kp(n,e){return n}function ds(n,e){return PE&&!Yo(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(PE=!1,JN("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function Ow(n,e){return n}function Wl(n,e){return n}function MG(n,e,t){return function(i){let r,o;if(n.canWrapX()){const s=n.getExtent(),l=Ni(s);i=i.slice(0),o=iD(i,n,l),o&&(i[0]=i[0]-o*l),i[0]=Br(i[0],s[0],s[2]),i[1]=Br(i[1],s[1],s[3]),r=t(i)}else r=t(i);return o&&e.canWrapX()&&(r[0]+=o*Ni(e.getExtent())),r}}function LY(){GE(CG),GE(AG),TY(AG,CG,rY,sY)}LY();const Jo={ADD:"add",REMOVE:"remove"},jp={PROPERTYCHANGE:"propertychange"},$n={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Nw{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function PY(n,e,t){let i,r;t=t||Ec;let o=0,s=n.length,l=!1;for(;o<s;)i=o+(s-o>>1),r=+t(n[i],e),r<0?o=i+1:(s=i,l=!r);return l?o:~o}function Ec(n,e){return n>e?1:n<e?-1:0}function GY(n,e){return n<e?1:n>e?-1:0}function Dw(n,e,t){if(n[0]<=e)return 0;const i=n.length;if(e<=n[i-1])return i-1;if(typeof t=="function"){for(let r=1;r<i;++r){const o=n[r];if(o===e)return r;if(o<e)return t(e,n[r-1],o)>0?r-1:r}return i-1}if(t>0){for(let r=1;r<i;++r)if(n[r]<e)return r-1;return i-1}if(t<0){for(let r=1;r<i;++r)if(n[r]<=e)return r;return i-1}for(let r=1;r<i;++r){if(n[r]==e)return r;if(n[r]<e)return n[r-1]-e<e-n[r]?r-1:r}return i-1}function FY(n,e,t){for(;e<t;){const i=n[e];n[e]=n[t],n[t]=i,++e,--t}}function dr(n,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let r=0;r<i;r++)n[n.length]=t[r]}function nd(n,e){const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function OY(n,e,t){const i=e||Ec;return n.every(function(r,o){if(o===0)return!0;const s=i(n[o-1],r);return!(s>0||s===0)})}function Iy(){return!0}function Dy(){return!1}function Ev(){}function hD(n){let e,t,i;return function(){const r=Array.prototype.slice.call(arguments);return(!t||this!==i||!nd(r,t))&&(i=this,t=r,e=n.apply(this,arguments)),e}}function dD(n){function e(){let t;try{t=n()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}class la{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class db extends Nw{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),r=i[e]||(i[e]=[]);r.includes(t)||r.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const o=t?new la(e):e;o.target||(o.target=this.eventTarget_||this);const s=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});i in s||(s[i]=0,l[i]=0),++s[i];let u;for(let h=0,d=r.length;h<d;++h)if("handleEvent"in r[h]?u=r[h].handleEvent(o):u=r[h].call(this,o),u===!1||o.propagationStopped){u=!1;break}if(--s[i]===0){let h=l[i];for(delete l[i];h--;)this.removeEventListener(i,Ev);delete s[i]}return u}disposeInternal(){this.listeners_&&cb(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const i=this.listeners_[e];if(!i)return;const r=i.indexOf(t);r!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[r]=Ev,++this.pendingRemovals_[e]):(i.splice(r,1),i.length===0&&delete this.listeners_[e]))}}function In(n,e,t,i,r){if(r){const s=t;t=function(l){return n.removeEventListener(e,t),s.call(i??this,l)}}else i&&i!==n&&(t=t.bind(i));const o={target:n,type:e,listener:t};return n.addEventListener(e,t),o}function nC(n,e,t,i){return In(n,e,t,i,!0)}function pr(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),cb(n))}class fb extends db{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent($n.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,r=new Array(i);for(let o=0;o<i;++o)r[o]=In(this,e[o],t);return r}return In(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const r=e.length;i=new Array(r);for(let o=0;o<r;++o)i[o]=nC(this,e[o],t)}else i=nC(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)_l(i);else if(Array.isArray(e))for(let r=0,o=e.length;r<o;++r)this.removeEventListener(e[r],t);else this.removeEventListener(e,t)}}fb.prototype.on;fb.prototype.once;fb.prototype.un;function _l(n){if(Array.isArray(n))for(let e=0,t=n.length;e<t;++e)pr(n[e]);else pr(n)}function Zn(){throw new Error("Unimplemented abstract method.")}let NY=0;function ti(n){return n.ol_uid||(n.ol_uid=String(++NY))}const vLe="10.7.0";class kG extends la{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class eu extends fb{constructor(e){super(),this.on,this.once,this.un,ti(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new kG(i,e,t)),i=jp.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new kG(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const r=this.values_||(this.values_={});if(i)r[e]=t;else{const o=r[e];r[e]=t,o!==t&&this.notify(e,o)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],Yp(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}const LG={LENGTH:"length"};class nx extends la{constructor(e,t,i){super(e),this.element=t,this.index=i}}class na extends eu{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e??[],this.unique_)for(let i=1,r=this.array_.length;i<r;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,r=t.length;i<r;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(LG.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new nx(Jo.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,r=t.length;i<r;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new nx(Jo.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const r=this.array_[e];this.array_[e]=t,this.dispatchEvent(new nx(Jo.REMOVE,r,e)),this.dispatchEvent(new nx(Jo.ADD,t,e))}updateLength_(){this.set(LG.LENGTH,this.array_.length)}assertUnique_(e,t){const i=this.array_;for(let r=0,o=i.length;r<o;++r)if(i[r]===e&&r!==t)throw new Error("Duplicate item added to a unique collection")}}class Tm extends la{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class pc extends Tm{constructor(e,t,i,r,o,s){super(e,t,o),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=s}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Bi={SINGLECLICK:"singleclick",CLICK:$n.CLICK,DBLCLICK:$n.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},$p=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",DY=$p.includes("safari")&&!$p.includes("chrom");DY&&($p.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test($p));const VY=$p.includes("webkit")&&!$p.includes("edge"),ZR=$p.includes("macintosh"),fD=typeof devicePixelRatio<"u"?devicePixelRatio:1,Il=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,WR=typeof Image<"u"&&Image.prototype.decode,pD=typeof createImageBitmap=="function",gD=(function(){let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return n})(),Tv={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTEROUT:"pointerout"};class BY extends db{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=In(i,Tv.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=In(i,Tv.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener($n.TOUCHMOVE,this.boundHandleTouchMove_,gD?{passive:!1}:!1)}emulateClick_(e){let t=new pc(Bi.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new pc(Bi.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new pc(Bi.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==Bi.POINTERUP||t.type==Bi.POINTERCANCEL){delete this.trackedTouches_[i];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==t.target){delete this.trackedTouches_[r];break}}else(t.type==Bi.POINTERDOWN||t.type==Bi.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new pc(Bi.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(pr),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new pc(Bi.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(In(i,Bi.POINTERMOVE,this.handlePointerMove_,this),In(i,Bi.POINTERUP,this.handlePointerUp_,this),In(this.element_,Bi.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(In(this.element_.getRootNode(),Bi.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new pc(Bi.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new pc(Bi.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(pr(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener($n.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(pr(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(pr),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Ch={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},mo={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Vn={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function fr(n,e){if(!n)throw new Error(e)}const iC=1/0;class ZY{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,cb(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(i);return delete this.queuedElements_[r],i}enqueue(e){fr(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=iC?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,r=t.length,o=t[e],s=i[e],l=e;for(;e<r>>1;){const u=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),d=h<r&&i[h]<i[u]?h:u;t[e]=t[d],i[e]=i[d],e=d}t[e]=o,i[e]=s,this.siftDown_(l,e)}siftDown_(e,t){const i=this.elements_,r=this.priorities_,o=i[t],s=r[t];for(;t>e;){const l=this.getParentIndex_(t);if(r[l]>s)i[t]=i[l],r[t]=r[l],t=l;else break}i[t]=o,r[t]=s}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let r=0;const o=t.length;let s,l,u;for(l=0;l<o;++l)s=t[l],u=e(s),u==iC?delete this.queuedElements_[this.keyFunction_(s)]:(i[r]=u,t[r++]=s);t.length=r,i.length=r,this.heapify_()}}class WY extends ZY{constructor(e,t){super(i=>e.apply(null,i),i=>i[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener($n.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===Vn.LOADED||i===Vn.ERROR||i===Vn.EMPTY){i!==Vn.ERROR&&t.removeEventListener($n.CHANGE,this.boundHandleTileChange_);const r=t.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;){const r=this.dequeue()[0],o=r.getKey();r.getState()===Vn.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,r.load())}}}function zY(n,e,t,i,r){if(!n||!(t in n.wantedTiles)||!n.wantedTiles[t][e.getKey()])return iC;const o=n.viewState.center,s=i[0]-o[0],l=i[1]-o[1];return 65536*Math.log(r)+Math.sqrt(s*s+l*l)/r}const jr={ANIMATING:0,INTERACTING:1},hu={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function PG(n,e,t){return(function(i,r,o,s,l){if(!i)return;if(!r&&!e)return i;const u=e?0:o[0]*r,h=e?0:o[1]*r,d=l?l[0]:0,m=l?l[1]:0;let y=n[0]+u/2+d,x=n[2]-u/2+d,C=n[1]+h/2+m,w=n[3]-h/2+m;y>x&&(y=(x+y)/2,x=y),C>w&&(C=(w+C)/2,w=C);let S=Br(i[0],y,x),T=Br(i[1],C,w);if(s&&t&&r){const M=30*r;S+=-M*Math.log(1+Math.max(0,y-i[0])/M)+M*Math.log(1+Math.max(0,i[0]-x)/M),T+=-M*Math.log(1+Math.max(0,C-i[1])/M)+M*Math.log(1+Math.max(0,i[1]-w)/M)}return[S,T]})}function UY(n){return n}function mD(n){return Math.pow(n,3)}function Vy(n){return 1-mD(1-n)}function XY(n){return 3*n*n-2*n*n*n}function YY(n){return n}const yD=new Array(6);function qa(){return[1,0,0,1,0,0]}function GG(n){return UR(n,1,0,0,1,0,0)}function zR(n,e){const t=n[0],i=n[1],r=n[2],o=n[3],s=n[4],l=n[5],u=e[0],h=e[1],d=e[2],m=e[3],y=e[4],x=e[5];return n[0]=t*u+r*h,n[1]=i*u+o*h,n[2]=t*d+r*m,n[3]=i*d+o*m,n[4]=t*y+r*x+s,n[5]=i*y+o*x+l,n}function UR(n,e,t,i,r,o,s){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n[4]=o,n[5]=s,n}function HY(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n}function Gs(n,e){const t=e[0],i=e[1];return e[0]=n[0]*t+n[2]*i+n[4],e[1]=n[1]*t+n[3]*i+n[5],e}function oI(n,e,t){return zR(n,UR(yD,e,0,0,t,0,0))}function KY(n,e,t){return zR(n,UR(yD,1,0,0,1,e,t))}function Lu(n,e,t,i,r,o,s,l){const u=Math.sin(o),h=Math.cos(o);return n[0]=i*h,n[1]=r*u,n[2]=-i*u,n[3]=r*h,n[4]=s*i*h-l*i*u+e,n[5]=s*r*u+l*r*h+t,n}function _D(n,e){const t=jY(e);fr(t!==0,"Transformation matrix cannot be inverted");const i=e[0],r=e[1],o=e[2],s=e[3],l=e[4],u=e[5];return n[0]=s/t,n[1]=-r/t,n[2]=-o/t,n[3]=i/t,n[4]=(o*u-s*l)/t,n[5]=-(i*u-r*l)/t,n}function jY(n){return n[0]*n[3]-n[1]*n[2]}const $Y=[1e5,1e5,1e5,1e5,2,2];function JY(n){return"matrix("+n.join(", ")+")"}function OE(n){return n.substring(7,n.length-1).split(",").map(parseFloat)}function qY(n,e){const t=OE(n),i=OE(e);for(let r=0;r<6;++r)if(Math.round((t[r]-i[r])*$Y[r])!==0)return!1;return!0}function Nh(n,e,t,i,r,o,s){o=o||[],s=s||2;let l=0;for(let u=e;u<t;u+=i){const h=n[u],d=n[u+1];o[l++]=r[0]*h+r[2]*d+r[4],o[l++]=r[1]*h+r[3]*d+r[5];for(let m=2;m<s;m++)o[l++]=n[u+m]}return o&&o.length!=l&&(o.length=l),o}function XR(n,e,t,i,r,o,s){s=s||[];const l=Math.cos(r),u=Math.sin(r),h=o[0],d=o[1];let m=0;for(let y=e;y<t;y+=i){const x=n[y]-h,C=n[y+1]-d;s[m++]=h+x*l-C*u,s[m++]=d+x*u+C*l;for(let w=y+2;w<y+i;++w)s[m++]=n[w]}return s&&s.length!=m&&(s.length=m),s}function QY(n,e,t,i,r,o,s,l){l=l||[];const u=s[0],h=s[1];let d=0;for(let m=e;m<t;m+=i){const y=n[m]-u,x=n[m+1]-h;l[d++]=u+r*y,l[d++]=h+o*x;for(let C=m+2;C<m+i;++C)l[d++]=n[C]}return l&&l.length!=d&&(l.length=d),l}function eH(n,e,t,i,r,o,s){s=s||[];let l=0;for(let u=e;u<t;u+=i){s[l++]=n[u]+r,s[l++]=n[u+1]+o;for(let h=u+2;h<u+i;++h)s[l++]=n[h]}return s&&s.length!=l&&(s.length=l),s}const FG=qa(),tH=[NaN,NaN];class vD extends eu{constructor(){super(),this.extent_=Qa(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=hD((e,t,i)=>{if(!i)return this.getSimplifiedGeometry(t);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return Zn()}closestPointXY(e,t,i,r){return Zn()}containsXY(e,t){return this.closestPointXY(e,t,tH,Number.MIN_VALUE)===0}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return Zn()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Fy(t),this.extentRevision_=this.getRevision()}return jX(this.extent_,e)}rotate(e,t){Zn()}scale(e,t,i){Zn()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return Zn()}getType(){return Zn()}applyTransform(e){Zn()}intersectsExtent(e){return Zn()}translate(e,t){Zn()}transform(e,t){const i=Oi(e),r=i.getUnits()=="tile-pixels"?function(o,s,l){const u=i.getExtent(),h=i.getWorldExtent(),d=Ns(h)/Ns(u);Lu(FG,h[0],h[3],d,-d,0,0,0);const m=Nh(o,0,o.length,l,FG,s),y=ff(i,t);return y?y(m,m,l):m}:ff(i,t);return this.applyTransform(r),this}}class If extends vD{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return LR(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return Zn()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=rC(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){Zn()}setLayout(e,t,i){let r;if(e)r=rC(e);else{for(let o=0;o<i;++o){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}r=t.length,e=ug(r)}this.layout=e,this.stride=r}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();XR(i,0,i.length,r,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=ku(this.getExtent()));const r=this.getFlatCoordinates();if(r){const o=this.getStride();QY(r,0,r.length,o,e,t,i,r),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();eH(i,0,i.length,r,e,t,i),this.changed()}}}function ug(n){let e;return n==2?e="XY":n==3?e="XYZ":n==4&&(e="XYZM"),e}function rC(n){let e;return n=="XY"?e=2:n=="XYZ"||n=="XYM"?e=3:n=="XYZM"&&(e=4),e}function nH(n,e,t){const i=n.getFlatCoordinates();if(!i)return null;const r=n.getStride();return Nh(i,0,i.length,r,e,t)}function bD(n,e,t,i){let r=0;const o=n[t-i],s=n[t-i+1];let l=0,u=0;for(;e<t;e+=i){const h=n[e]-o,d=n[e+1]-s;r+=u*h-l*d,l=h,u=d}return r/2}function xD(n,e,t,i){let r=0;for(let o=0,s=t.length;o<s;++o){const l=t[o];r+=bD(n,e,l,i),e=l}return r}function iH(n,e,t,i){let r=0;for(let o=0,s=t.length;o<s;++o){const l=t[o];r+=xD(n,e,l,i),e=l[l.length-1]}return r}function OG(n,e,t,i,r,o,s){const l=n[e],u=n[e+1],h=n[t]-l,d=n[t+1]-u;let m;if(h===0&&d===0)m=e;else{const y=((r-l)*h+(o-u)*d)/(h*h+d*d);if(y>1)m=t;else if(y>0){for(let x=0;x<i;++x)s[x]=ml(n[e+x],n[t+x],y);s.length=i;return}else m=e}for(let y=0;y<i;++y)s[y]=n[m+y];s.length=i}function YR(n,e,t,i,r){let o=n[e],s=n[e+1];for(e+=i;e<t;e+=i){const l=n[e],u=n[e+1],h=Ph(o,s,l,u);h>r&&(r=h),o=l,s=u}return r}function HR(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o){const l=t[o];r=YR(n,e,l,i,r),e=l}return r}function rH(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o){const l=t[o];r=HR(n,e,l,i,r),e=l[l.length-1]}return r}function KR(n,e,t,i,r,o,s,l,u,h,d){if(e==t)return h;let m,y;if(r===0){if(y=Ph(s,l,n[e],n[e+1]),y<h){for(m=0;m<i;++m)u[m]=n[e+m];return u.length=i,y}return h}d=d||[NaN,NaN];let x=e+i;for(;x<t;)if(OG(n,x-i,x,i,s,l,d),y=Ph(s,l,d[0],d[1]),y<h){for(h=y,m=0;m<i;++m)u[m]=d[m];u.length=i,x+=i}else x+=i*Math.max((Math.sqrt(y)-Math.sqrt(h))/r|0,1);if(o&&(OG(n,t-i,e,i,s,l,d),y=Ph(s,l,d[0],d[1]),y<h)){for(h=y,m=0;m<i;++m)u[m]=d[m];u.length=i}return h}function jR(n,e,t,i,r,o,s,l,u,h,d){d=d||[NaN,NaN];for(let m=0,y=t.length;m<y;++m){const x=t[m];h=KR(n,e,x,i,r,o,s,l,u,h,d),e=x}return h}function sH(n,e,t,i,r,o,s,l,u,h,d){d=d||[NaN,NaN];for(let m=0,y=t.length;m<y;++m){const x=t[m];h=jR(n,e,x,i,r,o,s,l,u,h,d),e=x[x.length-1]}return h}function ID(n,e,t,i){for(let r=0,o=t.length;r<o;++r)n[e++]=t[r];return e}function Vw(n,e,t,i){for(let r=0,o=t.length;r<o;++r){const s=t[r];for(let l=0;l<i;++l)n[e++]=s[l]}return e}function pb(n,e,t,i,r){r=r||[];let o=0;for(let s=0,l=t.length;s<l;++s){const u=Vw(n,e,t[s],i);r[o++]=u,e=u}return r.length=o,r}function CD(n,e,t,i,r){r=r||[];let o=0;for(let s=0,l=t.length;s<l;++s){const u=pb(n,e,t[s],i,r[o]);u.length===0&&(u[0]=e),r[o++]=u,e=u[u.length-1]}return r.length=o,r}function jd(n,e,t,i,r){r=r!==void 0?r:[];let o=0;for(let s=e;s<t;s+=i)r[o++]=n.slice(s,s+i);return r.length=o,r}function Rv(n,e,t,i,r){r=r!==void 0?r:[];let o=0;for(let s=0,l=t.length;s<l;++s){const u=t[s];r[o++]=jd(n,e,u,i,r[o]),e=u}return r.length=o,r}function NE(n,e,t,i,r){r=r!==void 0?r:[];let o=0;for(let s=0,l=t.length;s<l;++s){const u=t[s];r[o++]=u.length===1&&u[0]===e?[]:Rv(n,e,u,i,r[o]),e=u[u.length-1]}return r.length=o,r}function Bw(n,e,t,i,r,o,s){const l=(t-e)/i;if(l<3){for(;e<t;e+=i)o[s++]=n[e],o[s++]=n[e+1];return s}const u=new Array(l);u[0]=1,u[l-1]=1;const h=[e,t-i];let d=0;for(;h.length>0;){const m=h.pop(),y=h.pop();let x=0;const C=n[y],w=n[y+1],S=n[m],T=n[m+1];for(let M=y+i;M<m;M+=i){const G=n[M],N=n[M+1],V=qX(G,N,C,w,S,T);V>x&&(d=M,x=V)}x>r&&(u[(d-e)/i]=1,y+i<d&&h.push(y,d),d+i<m&&h.push(d,m))}for(let m=0;m<l;++m)u[m]&&(o[s++]=n[e+m*i],o[s++]=n[e+m*i+1]);return s}function wD(n,e,t,i,r,o,s,l){for(let u=0,h=t.length;u<h;++u){const d=t[u];s=Bw(n,e,d,i,r,o,s),l.push(s),e=d}return s}function bp(n,e){return e*Math.round(n/e)}function oH(n,e,t,i,r,o,s){if(e==t)return s;let l=bp(n[e],r),u=bp(n[e+1],r);e+=i,o[s++]=l,o[s++]=u;let h,d;do if(h=bp(n[e],r),d=bp(n[e+1],r),e+=i,e==t)return o[s++]=h,o[s++]=d,s;while(h==l&&d==u);for(;e<t;){const m=bp(n[e],r),y=bp(n[e+1],r);if(e+=i,m==h&&y==d)continue;const x=h-l,C=d-u,w=m-l,S=y-u;if(x*S==C*w&&(x<0&&w<x||x==w||x>0&&w>x)&&(C<0&&S<C||C==S||C>0&&S>C)){h=m,d=y;continue}o[s++]=h,o[s++]=d,l=h,u=d,h=m,d=y}return o[s++]=h,o[s++]=d,s}function $R(n,e,t,i,r,o,s,l){for(let u=0,h=t.length;u<h;++u){const d=t[u];s=oH(n,e,d,i,r,o,s),l.push(s),e=d}return s}function aH(n,e,t,i,r,o,s,l){for(let u=0,h=t.length;u<h;++u){const d=t[u],m=[];s=$R(n,e,d,i,r,o,s,m),l.push(m),e=d[d.length-1]}return s}class Mv extends If{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new Mv(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,r){return r<ag(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(YR(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),KR(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,r))}getArea(){return bD(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return jd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=Bw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Mv(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Vw(this.flatCoordinates,0,e,this.stride),this.changed()}}let Mr=class AD extends If{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new AD(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){const o=this.flatCoordinates,s=Ph(e,t,o[0],o[1]);if(s<r){const l=this.stride;for(let u=0;u<l;++u)i[u]=o[u];return i.length=l,s}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return ey(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return kR(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ID(this.flatCoordinates,0,e,this.stride),this.changed()}};function lH(n,e,t,i,r){return!PR(r,function(s){return!Tp(n,e,t,i,s[0],s[1])})}function Tp(n,e,t,i,r,o){let s=0,l=n[t-i],u=n[t-i+1];for(;e<t;e+=i){const h=n[e],d=n[e+1];u<=o?d>o&&(h-l)*(o-u)-(r-l)*(d-u)>0&&s++:d<=o&&(h-l)*(o-u)-(r-l)*(d-u)<0&&s--,l=h,u=d}return s!==0}function JR(n,e,t,i,r,o){if(t.length===0||!Tp(n,e,t[0],i,r,o))return!1;for(let s=1,l=t.length;s<l;++s)if(Tp(n,t[s-1],t[s],i,r,o))return!1;return!0}function uH(n,e,t,i,r,o){if(t.length===0)return!1;for(let s=0,l=t.length;s<l;++s){const u=t[s];if(JR(n,e,u,i,r,o))return!0;e=u[u.length-1]}return!1}function qR(n,e,t,i,r,o,s){let l,u,h,d,m,y,x;const C=r[o+1],w=[];for(let M=0,G=t.length;M<G;++M){const N=t[M];for(d=n[N-i],y=n[N-i+1],l=e;l<N;l+=i)m=n[l],x=n[l+1],(C<=y&&x<=C||y<=C&&C<=x)&&(h=(C-y)/(x-y)*(m-d)+d,w.push(h)),d=m,y=x}let S=NaN,T=-1/0;for(w.sort(Ec),d=w[0],l=1,u=w.length;l<u;++l){m=w[l];const M=Math.abs(m-d);M>T&&(h=(d+m)/2,JR(n,e,t,i,h,C)&&(S=h,T=M)),d=m}return isNaN(S)&&(S=r[o]),s?(s.push(S,C,T),s):[S,C,T]}function SD(n,e,t,i,r){let o=[];for(let s=0,l=t.length;s<l;++s){const u=t[s];o=qR(n,e,u,i,r,2*s,o),e=u[u.length-1]}return o}function ED(n,e,t,i,r){let o;for(e+=i;e<t;e+=i)if(o=r(n.slice(e-i,e),n.slice(e,e+i)),o)return o;return!1}function Zw(n,e,t,i,r,o){return o=o??QN(Qa(),n,e,t,i),Os(r,o)?o[0]>=r[0]&&o[2]<=r[2]||o[1]>=r[1]&&o[3]<=r[3]?!0:ED(n,e,t,i,function(s,l){return $X(r,s,l)}):!1}function cH(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o){if(Zw(n,e,t[o],i,r))return!0;e=t[o]}return!1}function TD(n,e,t,i,r){return!!(Zw(n,e,t,i,r)||Tp(n,e,t,i,r[0],r[1])||Tp(n,e,t,i,r[0],r[3])||Tp(n,e,t,i,r[2],r[1])||Tp(n,e,t,i,r[2],r[3]))}function RD(n,e,t,i,r){if(!TD(n,e,t[0],i,r))return!1;if(t.length===1)return!0;for(let o=1,s=t.length;o<s;++o)if(lH(n,t[o-1],t[o],i,r)&&!Zw(n,t[o-1],t[o],i,r))return!1;return!0}function hH(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o){const l=t[o];if(RD(n,e,l,i,r))return!0;e=l[l.length-1]}return!1}function dH(n,e,t,i){for(;e<t-i;){for(let r=0;r<i;++r){const o=n[e+r];n[e+r]=n[t-i+r],n[t-i+r]=o}e+=i,t-=i}}function QR(n,e,t,i){let r=0,o=n[t-i],s=n[t-i+1];for(;e<t;e+=i){const l=n[e],u=n[e+1];r+=(l-o)*(u+s),o=l,s=u}return r===0?void 0:r>0}function eM(n,e,t,i,r){r=r!==void 0?r:!1;for(let o=0,s=t.length;o<s;++o){const l=t[o],u=QR(n,e,l,i);if(o===0){if(r&&u||!r&&!u)return!1}else if(r&&!u||!r&&u)return!1;e=l}return!0}function MD(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o){const l=t[o];if(!eM(n,e,l,i,r))return!1;l.length&&(e=l[l.length-1])}return!0}function sC(n,e,t,i,r){r=r!==void 0?r:!1;for(let o=0,s=t.length;o<s;++o){const l=t[o],u=QR(n,e,l,i);(o===0?r&&u||!r&&!u:r&&!u||!r&&u)&&dH(n,e,l,i),e=l}return e}function DE(n,e,t,i,r){for(let o=0,s=t.length;o<s;++o)e=sC(n,e,t[o],i,r);return e}function fH(n,e){const t=[];let i=0,r=0,o;for(let s=0,l=e.length;s<l;++s){const u=e[s],h=QR(n,i,u,2);if(o===void 0&&(o=h),h===o)t.push(e.slice(r,s+1));else{if(t.length===0)continue;t[t.length-1].push(e[r])}r=s+1,i=u}return t}class Fo extends If{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?dr(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Fo(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<ag(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(HR(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),jR(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,r))}containsXY(e,t){return JR(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return xD(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),sC(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Rv(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=ku(this.getExtent());this.flatInteriorPoint_=qR(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Mr(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Mv(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,r=[];let o=0;for(let s=0,l=i.length;s<l;++s){const u=i[s],h=new Mv(t.slice(o,u),e);r.push(h),o=u}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;eM(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=sC(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=$R(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new Fo(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return RD(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=pb(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function pH(n,e,t,i){t=t||32;const r=[];for(let o=0;o<t;++o)dr(r,CY(n,e,2*Math.PI*o/t,i));return r.push(r[0],r[1]),new Fo(r,"XY",[r.length])}function VE(n){if(lg(n))throw new Error("Cannot create polygon from empty extent");const e=n[0],t=n[1],i=n[2],r=n[3],o=[e,t,e,r,i,r,i,t,e,t];return new Fo(o,"XY",[o.length])}function kD(n,e,t){e=e||32;const i=n.getStride(),r=n.getLayout(),o=n.getCenter(),s=i*(e+1),l=new Array(s);for(let d=0;d<s;d+=i){l[d]=0,l[d+1]=0;for(let m=2;m<i;m++)l[d+m]=o[m]}const u=[l.length],h=new Fo(l,r,u);return gH(h,o,n.getRadius()),h}function gH(n,e,t,i){const r=n.getFlatCoordinates(),o=n.getStride(),s=r.length/o-1,l=0;for(let u=0;u<=s;++u){const h=u*o,d=l+Gh(u,s)*2*Math.PI/s;r[h]=e[0]+t*Math.cos(d),r[h+1]=e[1]+t*Math.sin(d)}n.changed()}function tM(n,e,t,i){const r=Ni(e)/t[0],o=Ns(e)/t[1];return i?Math.min(n,Math.max(r,o)):Math.min(n,Math.min(r,o))}function nM(n,e,t){let i=Math.min(n,e);const r=50;return i*=Math.log(1+r*Math.max(0,n/e-1))/r+1,t&&(i=Math.max(i,t),i/=Math.log(1+r*Math.max(0,t/n-1))/r+1),Br(i,t/2,e*2)}function mH(n,e,t,i){return e=e!==void 0?e:!0,(function(r,o,s,l){if(r!==void 0){const u=n[0],h=n[n.length-1],d=t?tM(u,t,s,i):u;if(l)return e?nM(r,d,h):Br(r,h,d);const m=Math.min(d,r),y=Math.floor(Dw(n,m,o));return n[y]>d&&y<n.length-1?n[y+1]:n[y]}})}function yH(n,e,t,i,r,o){return i=i!==void 0?i:!0,t=t!==void 0?t:0,(function(s,l,u,h){if(s!==void 0){const d=r?tM(e,r,u,o):e;if(h)return i?nM(s,d,t):Br(s,t,d);const m=1e-9,y=Math.ceil(Math.log(e/d)/Math.log(n)-m),x=-l*(.5-m)+.5,C=Math.min(d,s),w=Math.floor(Math.log(e/C)/Math.log(n)+x),S=Math.max(y,w),T=e/Math.pow(n,S);return Br(T,t,d)}})}function NG(n,e,t,i,r){return t=t!==void 0?t:!0,(function(o,s,l,u){if(o!==void 0){const h=i?tM(n,i,l,r):n;return!t||!u?Br(o,e,h):nM(o,h,e)}})}function iM(n){if(n!==void 0)return 0}function DG(n){if(n!==void 0)return n}function _H(n){const e=2*Math.PI/n;return(function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t})}function vH(n){const e=ra(5);return(function(t,i){return i||t===void 0?t:Math.abs(t)<=e?0:t})}const bH=42,rM=256,k2=0;class mc extends eu{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=BR(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&SY(),e.center&&(e.center=ds(e.center,this.projection_)),e.extent&&(e.extent=Wl(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const l in hu)delete t[l];this.setProperties(t,!0);const i=IH(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const r=xH(e),o=i.constraint,s=CH(e);this.constraints_={center:r,resolution:o,rotation:s},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const r=e||[0,0,0,0];t=t||[0,0,0,0];const o=this.getResolution(),s=o/2*(r[3]-t[3]+t[1]-r[1]),l=o/2*(r[0]-t[0]+t[2]-r[2]);this.setCenterInternal([i[0]+s,i[1]-l])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let r=arguments[i];r.center&&(r=Object.assign({},r),r.center=ds(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=ds(r.anchor,this.getProjection())),t[i]=r}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let r=0;for(;r<t&&!this.isDef();++r){const d=arguments[r];d.center&&this.setCenterInternal(d.center),d.zoom!==void 0?this.setZoom(d.zoom):d.resolution&&this.setResolution(d.resolution),d.rotation!==void 0&&this.setRotation(d.rotation)}if(r===t){i&&ix(i,!0);return}let o=Date.now(),s=this.targetCenter_.slice(),l=this.targetResolution_,u=this.targetRotation_;const h=[];for(;r<t;++r){const d=arguments[r],m={start:o,complete:!1,anchor:d.anchor,duration:d.duration!==void 0?d.duration:1e3,easing:d.easing||XY,callback:i};if(d.center&&(m.sourceCenter=s,m.targetCenter=d.center.slice(),s=m.targetCenter),d.zoom!==void 0?(m.sourceResolution=l,m.targetResolution=this.getResolutionForZoom(d.zoom),l=m.targetResolution):d.resolution&&(m.sourceResolution=l,m.targetResolution=d.resolution,l=m.targetResolution),d.rotation!==void 0){m.sourceRotation=u;const y=Gh(d.rotation-u+Math.PI,2*Math.PI)-Math.PI;m.targetRotation=u+y,u=m.targetRotation}wH(m)?m.complete=!0:o+=m.duration,h.push(m)}this.animations_.push(h),this.setHint(jr.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[jr.ANIMATING]>0}getInteracting(){return this.hints_[jr.INTERACTING]>0}cancelAnimations(){this.setHint(jr.ANIMATING,-this.hints_[jr.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const r=this.animations_[t];if(r[0].callback&&ix(r[0].callback,!1),!e)for(let o=0,s=r.length;o<s;++o){const l=r[o];if(!l.complete){e=l.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const r=this.animations_[i];let o=!0;for(let s=0,l=r.length;s<l;++s){const u=r[s];if(u.complete)continue;const h=e-u.start;let d=u.duration>0?h/u.duration:1;d>=1?(u.complete=!0,d=1):o=!1;const m=u.easing(d);if(u.sourceCenter){const y=u.sourceCenter[0],x=u.sourceCenter[1],C=u.targetCenter[0],w=u.targetCenter[1];this.nextCenter_=u.targetCenter;const S=y+m*(C-y),T=x+m*(w-x);this.targetCenter_=[S,T]}if(u.sourceResolution&&u.targetResolution){const y=m===1?u.targetResolution:u.sourceResolution+m*(u.targetResolution-u.sourceResolution);if(u.anchor){const x=this.getViewportSize_(this.getRotation()),C=this.constraints_.resolution(y,0,x,!0);this.targetCenter_=this.calculateCenterZoom(C,u.anchor)}this.nextResolution_=u.targetResolution,this.targetResolution_=y,this.applyTargetState_(!0)}if(u.sourceRotation!==void 0&&u.targetRotation!==void 0){const y=m===1?Gh(u.targetRotation+Math.PI,2*Math.PI)-Math.PI:u.sourceRotation+m*(u.targetRotation-u.sourceRotation);if(u.anchor){const x=this.constraints_.rotation(y,!0);this.targetCenter_=this.calculateCenterRotate(x,u.anchor)}this.nextRotation_=u.targetRotation,this.targetRotation_=y}if(this.applyTargetState_(!0),t=!0,!u.complete)break}if(o){this.animations_[i]=null,this.setHint(jr.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const s=r[0].callback;s&&ix(s,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const r=this.getCenterInternal();return r!==void 0&&(i=[r[0]-t[0],r[1]-t[1]],FR(i,e-this.getRotation()),eY(i,t)),i}calculateCenterZoom(e,t){let i;const r=this.getCenterInternal(),o=this.getResolution();if(r!==void 0&&o!==void 0){const s=t[0]-e*(t[0]-r[0])/o,l=t[1]-e*(t[1]-r[1])/o;i=[s,l]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],r=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(r*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(r*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Kp(e,this.getProjection())}getCenterInternal(){return this.get(hu.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return Ow(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();fr(t,"The view center is not defined");const i=this.getResolution();fr(i!==void 0,"The view resolution is not defined");const r=this.getRotation();return fr(r!==void 0,"The view rotation is not defined"),Av(t,i,r,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(hu.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(Wl(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=Ni(e)/t[0],r=Ns(e)/t[1];return Math.max(i,r)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(t/i)/Math.log(e);return(function(o){return t/Math.pow(e,o*r)})}getRotation(){return this.get(hu.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,o=Math.log(i/r)/t;return(function(s){return Math.log(i/s)/t/o})}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let r=this.getCenterInternal();const o=this.padding_;if(o){const s=this.getViewportSizeMinusPadding_();r=L2(r,this.getViewportSize_(),[s[0]/2+o[3],s[1]/2+o[0]],t,i)}return{center:r.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,r;if(this.resolutions_){const o=Dw(this.resolutions_,e,1);t=o,i=this.resolutions_[o],o==this.resolutions_.length-1?r=2:r=i/this.resolutions_[o+1]}else i=this.maxResolution_,r=this.zoomFactor_;return t+Math.log(i/e)/Math.log(r)}getResolutionForZoom(e){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];const t=Br(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,Br(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(fr(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){fr(!lg(e),"Cannot fit empty extent provided as `geometry`");const r=Wl(e,this.getProjection());i=VE(r)}else if(e.getType()==="Circle"){const r=Wl(e.getExtent(),this.getProjection());i=VE(r),i.rotate(this.getRotation(),ku(r))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),r=Math.sin(-t),o=e.getFlatCoordinates(),s=e.getStride();let l=1/0,u=1/0,h=-1/0,d=-1/0;for(let m=0,y=o.length;m<y;m+=s){const x=o[m]*i-o[m+1]*r,C=o[m]*r+o[m+1]*i;l=Math.min(l,x),u=Math.min(u,C),h=Math.max(h,x),d=Math.max(d,C)}return[l,u,h,d]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const r=t.padding!==void 0?t.padding:[0,0,0,0],o=t.nearest!==void 0?t.nearest:!1;let s;t.minResolution!==void 0?s=t.minResolution:t.maxZoom!==void 0?s=this.getResolutionForZoom(t.maxZoom):s=0;const l=this.rotatedExtentForGeometry(e);let u=this.getResolutionForExtentInternal(l,[i[0]-r[1]-r[3],i[1]-r[0]-r[2]]);u=isNaN(u)?s:Math.max(u,s),u=this.getConstrainedResolution(u,o?0:1);const h=this.getRotation(),d=Math.sin(h),m=Math.cos(h),y=ku(l);y[0]+=(r[1]-r[3])/2*u,y[1]+=(r[0]-r[2])/2*u;const x=y[0]*m-y[1]*d,C=y[1]*m+y[0]*d,w=this.getConstrainedCenter([x,C],u),S=t.callback?t.callback:Ev;t.duration!==void 0?this.animateInternal({resolution:u,center:w,duration:t.duration,easing:t.easing},S):(this.targetResolution_=u,this.targetCenter_=w,this.applyTargetState_(!1,!0),ix(S,!0))}centerOn(e,t,i){this.centerOnInternal(ds(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(L2(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,r){let o;const s=this.padding_;if(s&&e){const l=this.getViewportSizeMinusPadding_(-i),u=L2(e,r,[l[0]/2+s[3],l[1]/2+s[0]],t,i);o=[e[0]-u[0],e[1]-u[1]]}return o}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Kp(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&ds(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*e,0,r,i);t&&(this.targetCenter_=this.calculateCenterZoom(o,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=ds(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(r,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&ds(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,r=this.constraints_.rotation(this.targetRotation_,i),o=this.getViewportSize_(r),s=this.constraints_.resolution(this.targetResolution_,0,o,i),l=this.constraints_.center(this.targetCenter_,s,o,i,this.calculateCenterShift(this.targetCenter_,s,r,o));this.get(hu.ROTATION)!==r&&this.set(hu.ROTATION,r),this.get(hu.RESOLUTION)!==s&&(this.set(hu.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),(!l||!this.get(hu.CENTER)||!Yo(this.get(hu.CENTER),l))&&this.set(hu.CENTER,l),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const r=t||0,o=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(o),l=this.constraints_.resolution(this.targetResolution_,r,s),u=this.constraints_.center(this.targetCenter_,l,s,!1,this.calculateCenterShift(this.targetCenter_,l,o,s));if(e===0&&!this.cancelAnchor_){this.targetResolution_=l,this.targetRotation_=o,this.targetCenter_=u,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==l||this.getRotation()!==o||!this.getCenterInternal()||!Yo(this.getCenterInternal(),u))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:u,resolution:l,duration:e,easing:Vy,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(jr.INTERACTING,1)}endInteraction(e,t,i){i=i&&ds(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(jr.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function ix(n,e){setTimeout(function(){n(e)},0)}function xH(n){if(n.extent!==void 0){const t=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return PG(n.extent,n.constrainOnlyCenter,t)}const e=BR(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,PG(t,!1,!1)}return UY}function IH(n){let e,t,i,s=n.minZoom!==void 0?n.minZoom:k2,l=n.maxZoom!==void 0?n.maxZoom:28;const u=n.zoomFactor!==void 0?n.zoomFactor:2,h=n.multiWorld!==void 0?n.multiWorld:!1,d=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,m=n.showFullExtent!==void 0?n.showFullExtent:!1,y=BR(n.projection,"EPSG:3857"),x=y.getExtent();let C=n.constrainOnlyCenter,w=n.extent;if(!h&&!w&&y.isGlobal()&&(C=!1,w=x),n.resolutions!==void 0){const S=n.resolutions;t=S[s],i=S[l]!==void 0?S[l]:S[S.length-1],n.constrainResolution?e=mH(S,d,!C&&w,m):e=NG(t,i,d,!C&&w,m)}else{const T=(x?Math.max(Ni(x),Ns(x)):360*Xp.degrees/y.getMetersPerUnit())/rM/Math.pow(2,k2),M=T/Math.pow(2,28-k2);t=n.maxResolution,t!==void 0?s=0:t=T/Math.pow(u,s),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=t/Math.pow(u,l):i=T/Math.pow(u,l):i=M),l=s+Math.floor(Math.log(t/i)/Math.log(u)),i=t/Math.pow(u,l-s),n.constrainResolution?e=yH(u,t,i,d,!C&&w,m):e=NG(t,i,d,!C&&w,m)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:s,zoomFactor:u}}function CH(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const t=n.constrainRotation;return t===void 0||t===!0?vH():t===!1?DG:typeof t=="number"?_H(t):DG}return iM}function wH(n){return!(n.sourceCenter&&n.targetCenter&&!Yo(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function L2(n,e,t,i,r){const o=Math.cos(-r);let s=Math.sin(-r),l=n[0]*o-n[1]*s,u=n[1]*o+n[0]*s;l+=(e[0]/2-t[0])*i,u+=(t[1]-e[1]/2)*i,s=-s;const h=l*o-u*s,d=u*o+l*s;return[h,d]}const rx="ol-hidden",AH="ol-selectable",Vc="ol-unselectable",VG="ol-unsupported",Cf="ol-control",BG="ol-collapsed",SH=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),ZG=["style","variant","weight","size","lineHeight","family"],BE={normal:400,bold:700},oC=function(n){const e=n.match(SH);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let i=0,r=ZG.length;i<r;++i){const o=e[i+1];o!==void 0&&(t[ZG[i]]=typeof o=="string"?o.trim():o)}return isNaN(Number(t.weight))&&t.weight in BE&&(t.weight=BE[t.weight]),t.families=t.family.split(/,\s?/).map(i=>i.trim().replace(/^['"]|['"]$/g,"")),t};function qs(n,e,t,i){let r;return t&&t.length?r=t.shift():Il?r=new class extends OffscreenCanvas{style={}}(n??300,e??150):r=document.createElement("canvas"),n&&(r.width=n),e&&(r.height=e),r.getContext("2d",i)}let P2;function aC(){return P2||(P2=qs(1,1)),P2}function Ww(n){const e=n.canvas;e.width=1,e.height=1,n.clearRect(0,0,1,1)}function EH(n){let e=n.offsetWidth;const t=getComputedStyle(n);return e+=parseInt(t.marginLeft,10)+parseInt(t.marginRight,10),e}function TH(n){let e=n.offsetHeight;const t=getComputedStyle(n);return e+=parseInt(t.marginTop,10)+parseInt(t.marginBottom,10),e}function lC(n,e){const t=e.parentNode;t&&t.replaceChild(n,e)}function LD(n){for(;n.lastChild;)n.lastChild.remove()}function RH(n,e){const t=n.childNodes;for(let i=0;;++i){const r=t[i],o=e[i];if(!r&&!o)break;if(r!==o){if(!r){n.appendChild(o);continue}if(!o){n.removeChild(r),--i;continue}n.insertBefore(o,r)}}}function PD(){return new Proxy({childNodes:[],appendChild:function(e){return this.childNodes.push(e),e},remove:function(){},removeChild:function(e){const t=this.childNodes.indexOf(e);if(t===-1)throw new Error("Node to remove was not found");return this.childNodes.splice(t,1),e},insertBefore:function(e,t){const i=this.childNodes.indexOf(t);if(i===-1)throw new Error("Reference node not found");return this.childNodes.splice(i,0,e),e},style:{}},{get(e,t,i){return t==="firstElementChild"?e.childNodes.length>0?e.childNodes[0]:null:Reflect.get(e,t,i)}})}function $d(n){return typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}class id extends eu{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&this.element?.remove();for(let t=0,i=this.listenerKeys.length;t<i;++t)pr(this.listenerKeys[t]);if(this.listenerKeys.length=0,this.map_=e,e){const t=this.target_??e.getOverlayContainerStopEvent();this.element&&t.appendChild(this.element),this.render!==Ev&&this.listenerKeys.push(In(e,Ch.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class MH extends id{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",r=e.expandClassName!==void 0?e.expandClassName:t+"-expand",o=e.collapseLabel!==void 0?e.collapseLabel:"",s=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o,this.collapseLabel_.className=s):this.collapseLabel_=o;const l=e.label!==void 0?e.label:"i";typeof l=="string"?(this.label_=document.createElement("span"),this.label_.textContent=l,this.label_.className=r):this.label_=l;const u=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(u),this.toggleButton_.addEventListener($n.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+Vc+" "+Cf+(this.collapsed_&&this.collapsible_?" "+BG:"")+(this.collapsible_?"":" ol-uncollapsible"),d=this.element;d.className=h,d.appendChild(this.toggleButton_),d.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=this.getMap().getAllLayers(),i=new Set(t.flatMap(r=>r.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(r=>i.add(r)):i.add(this.attributions_)),!this.overrideCollapsible_){const r=!t.some(o=>o.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(r)}return Array.from(i)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(r=>dD(()=>r))),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!nd(t,this.renderedAttributions_)){LD(this.ulElement_);for(let r=0,o=t.length;r<o;++r){const s=document.createElement("li");s.innerHTML=t[r],this.ulElement_.appendChild(s)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(BG),this.collapsed_?lC(this.collapseLabel_,this.label_):lC(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class GD extends id{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"",r=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(r));const o=e.tipLabel?e.tipLabel:"Reset rotation",s=document.createElement("button");s.className=t+"-reset",s.setAttribute("type","button"),s.title=o,s.appendChild(this.label_),s.addEventListener($n.CLICK,this.handleClick_.bind(this),!1);const l=t+" "+Vc+" "+Cf,u=this.element;u.className=l,u.appendChild(s),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(rx)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:Vy}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const r="rotate("+i+"rad)";if(this.autoHide_){const o=this.element.classList.contains(rx);!o&&i===0?this.element.classList.add(rx):o&&i!==0&&this.element.classList.remove(rx)}this.label_.style.transform=r}this.rotation_=i}}class FD extends id{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,r=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",o=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",s=e.zoomInLabel!==void 0?e.zoomInLabel:"+",l=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",u=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",d=document.createElement("button");d.className=r,d.setAttribute("type","button"),d.title=u,d.appendChild(typeof s=="string"?document.createTextNode(s):s),d.addEventListener($n.CLICK,this.handleClick_.bind(this,i),!1);const m=document.createElement("button");m.className=o,m.setAttribute("type","button"),m.title=h,m.appendChild(typeof l=="string"?document.createTextNode(l):l),m.addEventListener($n.CLICK,this.handleClick_.bind(this,-i),!1);const y=t+" "+Vc+" "+Cf,x=this.element;x.className=y,x.appendChild(d),x.appendChild(m),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const r=i.getZoom();if(r!==void 0){const o=i.getConstrainedZoom(r+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:o,duration:this.duration_,easing:Vy})):i.setZoom(o)}}}function kH(n){n=n||{};const e=new na;return(n.zoom===void 0||n.zoom)&&e.push(new FD(n.zoomOptions)),(n.rotate===void 0||n.rotate)&&e.push(new GD(n.rotateOptions)),(n.attribution===void 0||n.attribution)&&e.push(new MH(n.attributionOptions)),e}class LH{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const r=this.points_[t+2]-this.points_[i+2];if(r<1e3/60)return!1;const o=this.points_[t]-this.points_[i],s=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(s,o),this.initialVelocity_=Math.sqrt(o*o+s*s)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const ZE={ACTIVE:"active"};class gb extends eu{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(ZE.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(ZE.ACTIVE,e)}setMap(e){this.map_=e}}function PH(n,e,t){const i=n.getCenterInternal();if(i){const r=[i[0]+e[0],i[1]+e[1]];n.animateInternal({duration:t!==void 0?t:250,easing:YY,center:n.getConstrainedCenter(r)})}}function sM(n,e,t,i){const r=n.getZoom();if(r===void 0)return;const o=n.getConstrainedZoom(r+e),s=n.getResolutionForZoom(o);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:s,anchor:t,duration:i!==void 0?i:250,easing:Vy})}class GH extends gb{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==Bi.DBLCLICK){const i=e.originalEvent,r=e.map,o=e.coordinate,s=i.shiftKey?-this.delta_:this.delta_,l=r.getView();sM(l,s,o,this.duration_),i.preventDefault(),t=!0}return!t}}function WE(n){const e=arguments;return function(t){let i=!0;for(let r=0,o=e.length;r<o&&(i=i&&e[r](t),!!i);++r);return i}}const FH=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},OH=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},NH=function(n){const e=n.map.getTargetElement(),t=e.getRootNode(),i=n.map.getOwnerDocument().activeElement;return t instanceof ShadowRoot?t.host.contains(i):e.contains(i)},OD=function(n){const e=n.map.getTargetElement(),t=e.getRootNode();return(t instanceof ShadowRoot?t.host:e).hasAttribute("tabindex")?NH(n):!0},ny=Iy,ND=function(n){const e=n.originalEvent;return"pointerId"in e&&e.button==0&&!(VY&&ZR&&e.ctrlKey)},DD=Dy,VD=function(n){return n.type==Bi.SINGLECLICK},zw=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},DH=function(n){const e=n.originalEvent;return!e.altKey&&(ZR?e.metaKey:e.ctrlKey)&&!e.shiftKey},VH=function(n){const e=n.originalEvent;return ZR?e.metaKey:e.ctrlKey},zE=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},BD=function(n){const e=n.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},G2=function(n){const e=n.originalEvent;return"pointerId"in e&&e.pointerType=="mouse"},ZD=function(n){const e=n.originalEvent;return"pointerId"in e&&e.isPrimary&&e.button===0};class Bc extends gb{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Bi.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Bi.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==Bi.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==Bi.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function oM(n){const e=n.length;let t=0,i=0;for(let r=0;r<e;r++)t+=n[r].clientX,i+=n[r].clientY;return{clientX:t/e,clientY:i/e}}class BH extends Bc{constructor(e){super({stopDown:Dy}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:WE(zw,ZD);this.condition_=e.onFocusOnly?WE(OD,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,r=t.getEventPixel(oM(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const o=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],l=e.map.getView();tY(o,l.getResolution()),FR(o,l.getRotation()),l.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),s=i.getCenterInternal(),l=t.getPixelFromCoordinateInternal(s),u=t.getCoordinateFromPixelInternal([l[0]-r*Math.cos(o),l[1]-r*Math.sin(o)]);i.animateInternal({center:i.getConstrainedCenter(u),duration:500,easing:Vy})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class UE extends Bc{constructor(e){e=e||{},super({stopDown:Dy}),this.condition_=e.condition?e.condition:OH,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!G2(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===iM)return;const r=t.getSize(),o=e.pixel,s=Math.atan2(r[1]/2-o[1],o[0]-r[0]/2);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;i.adjustRotationInternal(-l)}this.lastAngle_=s}handleUpEvent(e){return G2(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return G2(e)&&ND(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class ZH extends Nw{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",r=this.element_.style;r.left=Math.min(e[0],t[0])+i,r.top=Math.min(e[1],t[1])+i,r.width=Math.abs(t[0]-e[0])+i,r.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,t=this.endPixel_,r=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new Fo([r])}getGeometry(){return this.geometry_}}const pm={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class i0 extends la{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class WH extends Bc{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new ZH(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??ND,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const r=i[0]-t[0],o=i[1]-t[1];return r*r+o*o>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new i0(pm.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new i0(t?pm.BOXEND:pm.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new i0(pm.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new i0(pm.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new i0(pm.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}}class zH extends WH{constructor(e){e=e||{};const t=e.condition?e.condition:zE;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let r=this.getGeometry();if(this.out_){const o=i.rotatedExtentForGeometry(r),s=i.getResolutionForExtentInternal(o),l=i.getResolution()/s;r=r.clone(),r.scale(l*l)}i.fitInternal(r,{duration:this.duration_,easing:Vy})}}const dp={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class UH extends gb{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return zw(t)&&BD(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==$n.KEYDOWN){const i=e.originalEvent,r=i.key;if(this.condition_(e)&&(r==dp.DOWN||r==dp.LEFT||r==dp.RIGHT||r==dp.UP)){const s=e.map.getView(),l=s.getResolution()*this.pixelDelta_;let u=0,h=0;r==dp.DOWN?h=-l:r==dp.LEFT?u=-l:r==dp.RIGHT?u=l:h=l;const d=[u,h];FR(d,s.getRotation()),PH(s,d,this.duration_),i.preventDefault(),t=!0}}return!t}}class XH extends gb{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!VH(t)&&BD(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==$n.KEYDOWN||e.type==$n.KEYPRESS){const i=e.originalEvent,r=i.key;if(this.condition_(e)&&(r==="+"||r==="-")){const o=e.map,s=r==="+"?this.delta_:-this.delta_,l=o.getView();sM(l,s,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const YH=40,HH=300;class KH extends gb{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:ny;this.condition_=e.onFocusOnly?WE(OD,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==$n.WHEEL)return!0;const i=e.map,r=e.originalEvent;r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let o=r.deltaY;switch(r.deltaMode){case WheelEvent.DOM_DELTA_LINE:o*=YH;break;case WheelEvent.DOM_DELTA_PAGE:o*=HH;break}if(o===0)return!1;this.lastDelta_=o;const s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(o)<4?"trackpad":"wheel");const l=i.getView();if(this.mode_==="trackpad"&&!(l.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(l.getAnimating()&&l.cancelAnimations(),l.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),l.adjustZoom(-o/this.deltaPerZoom_,this.lastAnchor_?i.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=s,!1;this.totalDelta_+=o;const u=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),u),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-Br(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),sM(t,i,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class jH extends Bc{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Dy),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],r=this.targetPointers[1],o=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(this.lastAngle_!==void 0){const u=o-this.lastAngle_;this.rotationDelta_+=u,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=u}this.lastAngle_=o;const s=e.map,l=s.getView();l.getConstraints().rotation!==iM&&(this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(oM(this.targetPointers))),this.rotating_&&(s.render(),l.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class $H extends Bc{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Dy),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],r=this.targetPointers[1],o=i.clientX-r.clientX,s=i.clientY-r.clientY,l=Math.sqrt(o*o+s*s);this.lastDistance_!==void 0&&(t=this.lastDistance_/l),this.lastDistance_=l;const u=e.map,h=u.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=u.getCoordinateFromPixelInternal(u.getEventPixel(oM(this.targetPointers))),u.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),r=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function JH(n){n=n||{};const e=new na,t=new LH(-.005,.05,100);return(n.altShiftDragRotate===void 0||n.altShiftDragRotate)&&e.push(new UE),(n.doubleClickZoom===void 0||n.doubleClickZoom)&&e.push(new GH({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan===void 0||n.dragPan)&&e.push(new BH({onFocusOnly:n.onFocusOnly,kinetic:t})),(n.pinchRotate===void 0||n.pinchRotate)&&e.push(new jH),(n.pinchZoom===void 0||n.pinchZoom)&&e.push(new $H({duration:n.zoomDuration})),(n.keyboard===void 0||n.keyboard)&&(e.push(new UH),e.push(new XH({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom===void 0||n.mouseWheelZoom)&&e.push(new KH({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom===void 0||n.shiftDragZoom)&&e.push(new zH({duration:n.zoomDuration})),e}const Sr={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class WD extends eu{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[Sr.OPACITY]=e.opacity!==void 0?e.opacity:1,fr(typeof t[Sr.OPACITY]=="number","Layer opacity must be a number"),t[Sr.VISIBLE]=e.visible!==void 0?e.visible:!0,t[Sr.Z_INDEX]=e.zIndex,t[Sr.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[Sr.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[Sr.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[Sr.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=Br(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return Zn()}getLayerStatesArray(e){return Zn()}getExtent(){return this.get(Sr.EXTENT)}getMaxResolution(){return this.get(Sr.MAX_RESOLUTION)}getMinResolution(){return this.get(Sr.MIN_RESOLUTION)}getMinZoom(){return this.get(Sr.MIN_ZOOM)}getMaxZoom(){return this.get(Sr.MAX_ZOOM)}getOpacity(){return this.get(Sr.OPACITY)}getSourceState(){return Zn()}getVisible(){return this.get(Sr.VISIBLE)}getZIndex(){return this.get(Sr.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(Sr.EXTENT,e)}setMaxResolution(e){this.set(Sr.MAX_RESOLUTION,e)}setMinResolution(e){this.set(Sr.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(Sr.MAX_ZOOM,e)}setMinZoom(e){this.set(Sr.MIN_ZOOM,e)}setOpacity(e){fr(typeof e=="number","Layer opacity must be a number"),this.set(Sr.OPACITY,e)}setVisible(e){this.set(Sr.VISIBLE,e)}setZIndex(e){this.set(Sr.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Rd={ADDLAYER:"addlayer",REMOVELAYER:"removelayer"};class Zd extends la{constructor(e,t){super(e),this.layer=t}}const F2={LAYERS:"layers"};class wf extends WD{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(F2.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new na(i.slice(),{unique:!0}):fr(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new na(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(pr),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(In(e,Jo.ADD,this.handleLayersAdd_,this),In(e,Jo.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(pr);cb(this.listenerKeys_);const t=e.getArray();for(let i=0,r=t.length;i<r;i++){const o=t[i];this.registerLayerListeners_(o),this.dispatchEvent(new Zd(Rd.ADDLAYER,o))}this.changed()}registerLayerListeners_(e){const t=[In(e,jp.PROPERTYCHANGE,this.handleLayerChange_,this),In(e,$n.CHANGE,this.handleLayerChange_,this)];e instanceof wf&&t.push(In(e,Rd.ADDLAYER,this.handleLayerGroupAdd_,this),In(e,Rd.REMOVELAYER,this.handleLayerGroupRemove_,this)),this.listenerKeys_[ti(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new Zd(Rd.ADDLAYER,e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Zd(Rd.REMOVELAYER,e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Zd(Rd.ADDLAYER,t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=ti(t);this.listenerKeys_[i].forEach(pr),delete this.listenerKeys_[i],this.dispatchEvent(new Zd(Rd.REMOVELAYER,t)),this.changed()}getLayers(){return this.get(F2.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let r=0,o=i.length;r<o;++r)this.dispatchEvent(new Zd(Rd.REMOVELAYER,i[r]))}this.set(F2.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(s){s.getLayerStatesArray(t)});const r=this.getLayerState();let o=r.zIndex;!e&&r.zIndex===void 0&&(o=0);for(let s=i,l=t.length;s<l;s++){const u=t[s];u.opacity*=r.opacity,u.visible=u.visible&&r.visible,u.maxResolution=Math.min(u.maxResolution,r.maxResolution),u.minResolution=Math.max(u.minResolution,r.minResolution),u.minZoom=Math.max(u.minZoom,r.minZoom),u.maxZoom=Math.min(u.maxZoom,r.maxZoom),r.extent!==void 0&&(u.extent!==void 0?u.extent=Sc(u.extent,r.extent):u.extent=r.extent),u.zIndex===void 0&&(u.zIndex=o)}return t}getSourceState(){return"ready"}}const ja={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class cg extends WD{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(Sr.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(Sr.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(pr(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=In(e,$n.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof mc?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let r;if(t.layerStatesArray){if(r=t.layerStatesArray.find(s=>s.layer===this),!r)return!1}else r=this.getLayerState();const o=this.getExtent();return aM(r,t.viewState)&&(!o||Os(o,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];const t=this.getSource()?.getAttributions();if(!t)return[];const i=e instanceof mc?e.getViewStateAndExtent():e;let r=t(i);return Array.isArray(r)||(r=[r]),r}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(Sr.MAP,e)}getMapInternal(){return this.get(Sr.MAP)}setMap(e){this.mapPrecomposeKey_&&(pr(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(pr(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=In(e,ja.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=In(this,$n.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,i=this.getLayerState(!1);fr(!t.some(r=>r.layer===i.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(i)}setSource(e){this.set(Sr.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function aM(n,e){if(!n.visible)return!1;const t=e.resolution;if(t<n.minResolution||t>=n.maxResolution)return!1;const i=e.zoom;return i>n.minZoom&&i<=n.maxZoom}function zD(n,e,t=0,i=n.length-1,r=qH){for(;i>t;){if(i-t>600){const u=i-t+1,h=e-t+1,d=Math.log(u),m=.5*Math.exp(2*d/3),y=.5*Math.sqrt(d*m*(u-m)/u)*(h-u/2<0?-1:1),x=Math.max(t,Math.floor(e-h*m/u+y)),C=Math.min(i,Math.floor(e+(u-h)*m/u+y));zD(n,e,x,C,r)}const o=n[e];let s=t,l=i;for(r0(n,t,e),r(n[i],o)>0&&r0(n,t,i);s<l;){for(r0(n,s,l),s++,l--;r(n[s],o)<0;)s++;for(;r(n[l],o)>0;)l--}r(n[t],o)===0?r0(n,t,l):(l++,r0(n,l,i)),l<=e&&(t=l+1),e<=l&&(i=l-1)}}function r0(n,e,t){const i=n[e];n[e]=n[t],n[t]=i}function qH(n,e){return n<e?-1:n>e?1:0}let UD=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!ox(e,t))return i;const r=this.toBBox,o=[];for(;t;){for(let s=0;s<t.children.length;s++){const l=t.children[s],u=t.leaf?r(l):l;ox(e,u)&&(t.leaf?i.push(l):N2(e,u)?this._all(l,i):o.push(l))}t=o.pop()}return i}collides(e){let t=this.data;if(!ox(e,t))return!1;const i=[];for(;t;){for(let r=0;r<t.children.length;r++){const o=t.children[r],s=t.leaf?this.toBBox(o):o;if(ox(e,s)){if(t.leaf||N2(e,s))return!0;i.push(o)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Rm([]),this}remove(e,t){if(!e)return this;let i=this.data;const r=this.toBBox(e),o=[],s=[];let l,u,h;for(;i||o.length;){if(i||(i=o.pop(),u=o[o.length-1],l=s.pop(),h=!0),i.leaf){const d=QH(e,i.children,t);if(d!==-1)return i.children.splice(d,1),o.push(i),this._condense(o),this}!h&&!i.leaf&&N2(i,r)?(o.push(i),s.push(l),l=0,u=i,i=i.children[0]):u?(l++,i=u.children[l],h=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,r){const o=i-t+1;let s=this._maxEntries,l;if(o<=s)return l=Rm(e.slice(t,i+1)),gm(l,this.toBBox),l;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),l=Rm([]),l.leaf=!1,l.height=r;const u=Math.ceil(o/s),h=u*Math.ceil(Math.sqrt(s));WG(e,t,i,h,this.compareMinX);for(let d=t;d<=i;d+=h){const m=Math.min(d+h-1,i);WG(e,d,m,u,this.compareMinY);for(let y=d;y<=m;y+=u){const x=Math.min(y+u-1,m);l.children.push(this._build(e,y,x,r-1))}}return gm(l,this.toBBox),l}_chooseSubtree(e,t,i,r){for(;r.push(t),!(t.leaf||r.length-1===i);){let o=1/0,s=1/0,l;for(let u=0;u<t.children.length;u++){const h=t.children[u],d=O2(h),m=nK(e,h)-d;m<s?(s=m,o=d<o?d:o,l=h):m===s&&d<o&&(o=d,l=h)}t=l||t.children[0]}return t}_insert(e,t,i){const r=i?e:this.toBBox(e),o=[],s=this._chooseSubtree(r,this.data,t,o);for(s.children.push(e),v0(s,r);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(r,o,t)}_split(e,t){const i=e[t],r=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,r);const s=this._chooseSplitIndex(i,o,r),l=Rm(i.children.splice(s,i.children.length-s));l.height=i.height,l.leaf=i.leaf,gm(i,this.toBBox),gm(l,this.toBBox),t?e[t-1].children.push(l):this._splitRoot(i,l)}_splitRoot(e,t){this.data=Rm([e,t]),this.data.height=e.height+1,this.data.leaf=!1,gm(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let r,o=1/0,s=1/0;for(let l=t;l<=i-t;l++){const u=_0(e,0,l,this.toBBox),h=_0(e,l,i,this.toBBox),d=iK(u,h),m=O2(u)+O2(h);d<o?(o=d,r=l,s=m<s?m:s):d===o&&m<s&&(s=m,r=l)}return r||i-t}_chooseSplitAxis(e,t,i){const r=e.leaf?this.compareMinX:eK,o=e.leaf?this.compareMinY:tK,s=this._allDistMargin(e,t,i,r),l=this._allDistMargin(e,t,i,o);s<l&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);const o=this.toBBox,s=_0(e,0,t,o),l=_0(e,i-t,i,o);let u=sx(s)+sx(l);for(let h=t;h<i-t;h++){const d=e.children[h];v0(s,e.leaf?o(d):d),u+=sx(s)}for(let h=i-t-1;h>=t;h--){const d=e.children[h];v0(l,e.leaf?o(d):d),u+=sx(l)}return u}_adjustParentBBoxes(e,t,i){for(let r=i;r>=0;r--)v0(t[r],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():gm(e[t],this.toBBox)}};function QH(n,e,t){if(!t)return e.indexOf(n);for(let i=0;i<e.length;i++)if(t(n,e[i]))return i;return-1}function gm(n,e){_0(n,0,n.children.length,e,n)}function _0(n,e,t,i,r){r||(r=Rm(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o=e;o<t;o++){const s=n.children[o];v0(r,n.leaf?i(s):s)}return r}function v0(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function eK(n,e){return n.minX-e.minX}function tK(n,e){return n.minY-e.minY}function O2(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function sx(n){return n.maxX-n.minX+(n.maxY-n.minY)}function nK(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function iK(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),r=Math.min(n.maxX,e.maxX),o=Math.min(n.maxY,e.maxY);return Math.max(0,r-t)*Math.max(0,o-i)}function N2(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function ox(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function Rm(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function WG(n,e,t,i,r){const o=[e,t];for(;o.length;){if(t=o.pop(),e=o.pop(),t-e<=i)continue;const s=e+Math.ceil((t-e)/i/2)*i;zD(n,s,e,t,r),o.push(e,s,s,t)}}const lM=[NaN,NaN,NaN,0];let D2;function rK(){return D2||(D2=qs(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),D2}const sK=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,oK=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,aK=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,lK=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function ax(n,e){return n.endsWith("%")?Number(n.substring(0,n.length-1))/e:Number(n)}function K0(n){throw new Error('failed to parse "'+n+'" as color')}function XD(n){if(n.toLowerCase().startsWith("rgb")){const o=n.match(oK)||n.match(sK)||n.match(aK);if(o){const s=o[4],l=100/255;return[Br(ax(o[1],l)+.5|0,0,255),Br(ax(o[2],l)+.5|0,0,255),Br(ax(o[3],l)+.5|0,0,255),s!==void 0?Br(ax(s,100),0,1):1]}K0(n)}if(n.startsWith("#")){if(lK.test(n)){const o=n.substring(1),s=o.length<=4?1:2,l=[0,0,0,255];for(let u=0,h=o.length;u<h;u+=s){let d=parseInt(o.substring(u,u+s),16);s===1&&(d+=d<<4),l[u/s]=d}return l[3]=l[3]/255,l}K0(n)}const e=rK();e.fillStyle="#abcdef";let t=e.fillStyle;e.fillStyle=n,e.fillStyle===t&&(e.fillStyle="#fedcba",t=e.fillStyle,e.fillStyle=n,e.fillStyle===t&&K0(n));const i=e.fillStyle;if(i.startsWith("#")||i.startsWith("rgba"))return XD(i);e.clearRect(0,0,1,1),e.fillRect(0,0,1,1);const r=Array.from(e.getImageData(0,0,1,1).data);return r[3]=Oy(r[3]/255,3),r}function uK(n){return typeof n=="string"?n:cM(n)}const cK=1024,s0={};let V2=0;function hK(n){if(n.length===4)return n;const e=n.slice();return e[3]=1,e}function B2(n){return n>.0031308?Math.pow(n,1/2.4)*269.025-14.025:n*3294.6}function Z2(n){return n>.2068965?Math.pow(n,3):(n-4/29)*(108/841)}function W2(n){return n>10.314724?Math.pow((n+14.025)/269.025,2.4):n/3294.6}function z2(n){return n>.0088564?Math.pow(n,1/3):n/(108/841)+4/29}function zG(n){const e=W2(n[0]),t=W2(n[1]),i=W2(n[2]),r=z2(e*.222488403+t*.716873169+i*.06060791),o=500*(z2(e*.452247074+t*.399439023+i*.148375274)-r),s=200*(r-z2(e*.016863605+t*.117638439+i*.865350722)),l=Math.atan2(s,o)*(180/Math.PI);return[116*r-16,Math.sqrt(o*o+s*s),l<0?l+360:l,n[3]]}function dK(n){const e=(n[0]+16)/116,t=n[1],i=n[2]*Math.PI/180,r=Z2(e),o=Z2(e+t/500*Math.cos(i)),s=Z2(e-t/200*Math.sin(i)),l=B2(o*3.021973625-r*1.617392459-s*.404875592),u=B2(o*-.943766287+r*1.916279586+s*.027607165),h=B2(o*.069407491-r*.22898585+s*1.159737864);return[Br(l+.5|0,0,255),Br(u+.5|0,0,255),Br(h+.5|0,0,255),n[3]]}function uM(n){if(n==="none")return lM;if(s0.hasOwnProperty(n))return s0[n];if(V2>=cK){let t=0;for(const i in s0)(t++&3)===0&&(delete s0[i],--V2)}const e=XD(n);e.length!==4&&K0(n);for(const t of e)isNaN(t)&&K0(n);return s0[n]=e,++V2,e}function Hl(n){return Array.isArray(n)?n:uM(n)}function cM(n){let e=n[0];e!=(e|0)&&(e=e+.5|0);let t=n[1];t!=(t|0)&&(t=t+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const r=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+e+","+t+","+i+","+r+")"}function UG(n){return n[0]>0&&n[1]>0}function fK(n,e,t){return t===void 0&&(t=[0,0]),t[0]=n[0]*e+.5|0,t[1]=n[1]*e+.5|0,t}function ia(n,e){return Array.isArray(n)?n:(e===void 0?e=[n,n]:(e[0]=n,e[1]=n),e)}let hg=0;const ba=1<<hg++,Xi=1<<hg++,Wa=1<<hg++,xu=1<<hg++,Jp=1<<hg++,b0=1<<hg++,lx=Math.pow(2,hg)-1,hM={[ba]:"boolean",[Xi]:"number",[Wa]:"string",[xu]:"color",[Jp]:"number[]",[b0]:"size"},pK=Object.keys(hM).map(Number).sort(Ec);function gK(n){return n in hM}function x0(n){const e=[];for(const t of pK)I0(n,t)&&e.push(hM[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function I0(n,e){return(n&e)===e}function Md(n,e){return n===e}class so{constructor(e,t){if(!gK(e))throw new Error(`literal expressions must have a specific type, got ${x0(e)}`);this.type=e,this.value=t}}class mK{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function YD(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Po(n,e,t){switch(typeof n){case"boolean":{if(Md(e,Wa))return new so(Wa,n?"true":"false");if(!I0(e,ba))throw new Error(`got a boolean, but expected ${x0(e)}`);return new so(ba,n)}case"number":{if(Md(e,b0))return new so(b0,ia(n));if(Md(e,ba))return new so(ba,!!n);if(Md(e,Wa))return new so(Wa,n.toString());if(!I0(e,Xi))throw new Error(`got a number, but expected ${x0(e)}`);return new so(Xi,n)}case"string":{if(Md(e,xu))return new so(xu,uM(n));if(Md(e,ba))return new so(ba,!!n);if(!I0(e,Wa))throw new Error(`got a string, but expected ${x0(e)}`);return new so(Wa,n)}}if(!Array.isArray(n))throw new Error("expression must be an array or a primitive value");if(n.length===0)throw new Error("empty expression");if(typeof n[0]=="string")return EK(n,e,t);for(const i of n)if(typeof i!="number")throw new Error("expected an array of numbers");if(Md(e,b0)){if(n.length!==2)throw new Error(`expected an array of two values for a size, got ${n.length}`);return new so(b0,n)}if(Md(e,xu)){if(n.length===3)return new so(xu,[...n,1]);if(n.length===4)return new so(xu,n);throw new Error(`expected an array of 3 or 4 values for a color, got ${n.length}`)}if(!I0(e,Jp))throw new Error(`got an array of numbers, but expected ${x0(e)}`);return new so(Jp,n)}const wt={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},yK={[wt.Get]:ii(Ci(1,1/0),XG),[wt.Var]:ii(Ci(1,1),_K),[wt.Has]:ii(Ci(1,1/0),XG),[wt.Id]:ii(vK,mm),[wt.Concat]:ii(Ci(2,1/0),cr(Wa)),[wt.GeometryType]:ii(bK,mm),[wt.LineMetric]:ii(mm),[wt.Resolution]:ii(U2,mm),[wt.Zoom]:ii(U2,mm),[wt.Time]:ii(U2,mm),[wt.Any]:ii(Ci(2,1/0),cr(ba)),[wt.All]:ii(Ci(2,1/0),cr(ba)),[wt.Not]:ii(Ci(1,1),cr(ba)),[wt.Equal]:ii(Ci(2,2),cr(lx)),[wt.NotEqual]:ii(Ci(2,2),cr(lx)),[wt.GreaterThan]:ii(Ci(2,2),cr(Xi)),[wt.GreaterThanOrEqualTo]:ii(Ci(2,2),cr(Xi)),[wt.LessThan]:ii(Ci(2,2),cr(Xi)),[wt.LessThanOrEqualTo]:ii(Ci(2,2),cr(Xi)),[wt.Multiply]:ii(Ci(2,1/0),YG),[wt.Coalesce]:ii(Ci(2,1/0),YG),[wt.Divide]:ii(Ci(2,2),cr(Xi)),[wt.Add]:ii(Ci(2,1/0),cr(Xi)),[wt.Subtract]:ii(Ci(2,2),cr(Xi)),[wt.Clamp]:ii(Ci(3,3),cr(Xi)),[wt.Mod]:ii(Ci(2,2),cr(Xi)),[wt.Pow]:ii(Ci(2,2),cr(Xi)),[wt.Abs]:ii(Ci(1,1),cr(Xi)),[wt.Floor]:ii(Ci(1,1),cr(Xi)),[wt.Ceil]:ii(Ci(1,1),cr(Xi)),[wt.Round]:ii(Ci(1,1),cr(Xi)),[wt.Sin]:ii(Ci(1,1),cr(Xi)),[wt.Cos]:ii(Ci(1,1),cr(Xi)),[wt.Atan]:ii(Ci(1,2),cr(Xi)),[wt.Sqrt]:ii(Ci(1,1),cr(Xi)),[wt.Match]:ii(Ci(4,1/0),HG,IK),[wt.Between]:ii(Ci(3,3),cr(Xi)),[wt.Interpolate]:ii(Ci(6,1/0),HG,CK),[wt.Case]:ii(Ci(3,1/0),xK,wK),[wt.In]:ii(Ci(2,2),AK),[wt.Number]:ii(Ci(1,1/0),cr(lx)),[wt.String]:ii(Ci(1,1/0),cr(lx)),[wt.Array]:ii(Ci(1,1/0),cr(Xi)),[wt.Color]:ii(Ci(1,4),cr(Xi)),[wt.Band]:ii(Ci(1,3),cr(Xi)),[wt.Palette]:ii(Ci(2,2),SK),[wt.ToString]:ii(Ci(1,1),cr(ba|Xi|Wa|xu))};function XG(n,e,t){const i=n.length-1,r=new Array(i);for(let o=0;o<i;++o){const s=n[o+1];switch(typeof s){case"number":{r[o]=new so(Xi,s);break}case"string":{r[o]=new so(Wa,s);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${s}`)}o===0&&t.properties.add(String(s))}return r}function _K(n,e,t){const i=n[1];if(typeof i!="string")throw new Error("expected a string argument for var operation");return t.variables.add(i),[new so(Wa,i)]}function vK(n,e,t){t.featureId=!0}function bK(n,e,t){t.geometryType=!0}function U2(n,e,t){t.mapState=!0}function mm(n,e,t){const i=n[0];if(n.length!==1)throw new Error(`expected no arguments for ${i} operation`);return[]}function Ci(n,e){return function(t,i,r){const o=t[0],s=t.length-1;if(n===e){if(s!==n){const l=n===1?"":"s";throw new Error(`expected ${n} argument${l} for ${o}, got ${s}`)}}else if(s<n||s>e){const l=e===1/0?`${n} or more`:`${n} to ${e}`;throw new Error(`expected ${l} arguments for ${o}, got ${s}`)}}}function YG(n,e,t){const i=n.length-1,r=new Array(i);for(let o=0;o<i;++o){const s=Po(n[o+1],e,t);r[o]=s}return r}function cr(n){return function(e,t,i){const r=e.length-1,o=new Array(r);for(let s=0;s<r;++s){const l=Po(e[s+1],n,i);o[s]=l}return o}}function xK(n,e,t){const i=n[0],r=n.length-1;if(r%2===0)throw new Error(`expected an odd number of arguments for ${i}, got ${r} instead`)}function HG(n,e,t){const i=n[0],r=n.length-1;if(r%2===1)throw new Error(`expected an even number of arguments for operation ${i}, got ${r} instead`)}function IK(n,e,t){const i=n.length-1,r=Wa|Xi|ba,o=Po(n[1],r,t),s=Po(n[n.length-1],e,t),l=new Array(i-2);for(let u=0;u<i-2;u+=2){try{const h=Po(n[u+2],o.type,t);l[u]=h}catch(h){throw new Error(`failed to parse argument ${u+1} of match expression: ${h.message}`)}try{const h=Po(n[u+3],s.type,t);l[u+1]=h}catch(h){throw new Error(`failed to parse argument ${u+2} of match expression: ${h.message}`)}}return[o,...l,s]}function CK(n,e,t){const i=n[1];let r;switch(i[0]){case"linear":r=1;break;case"exponential":const u=i[1];if(typeof u!="number"||u<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(u)} instead`);r=u;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(i)}`)}const o=new so(Xi,r);let s;try{s=Po(n[2],Xi,t)}catch(u){throw new Error(`failed to parse argument 1 in interpolate expression: ${u.message}`)}const l=new Array(n.length-3);for(let u=0;u<l.length;u+=2){try{const h=Po(n[u+3],Xi,t);l[u]=h}catch(h){throw new Error(`failed to parse argument ${u+2} for interpolate expression: ${h.message}`)}try{const h=Po(n[u+4],e,t);l[u+1]=h}catch(h){throw new Error(`failed to parse argument ${u+3} for interpolate expression: ${h.message}`)}}return[o,s,...l]}function wK(n,e,t){const i=Po(n[n.length-1],e,t),r=new Array(n.length-1);for(let o=0;o<r.length-1;o+=2){try{const s=Po(n[o+1],ba,t);r[o]=s}catch(s){throw new Error(`failed to parse argument ${o} of case expression: ${s.message}`)}try{const s=Po(n[o+2],i.type,t);r[o+1]=s}catch(s){throw new Error(`failed to parse argument ${o+1} of case expression: ${s.message}`)}}return r[r.length-1]=i,r}function AK(n,e,t){let i=n[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');let r;if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],r=Wa}else r=Xi;const o=new Array(i.length);for(let l=0;l<o.length;l++)try{const u=Po(i[l],r,t);o[l]=u}catch(u){throw new Error(`failed to parse haystack item ${l} for "in" expression: ${u.message}`)}return[Po(n[1],r,t),...o]}function SK(n,e,t){let i;try{i=Po(n[1],Xi,t)}catch(s){throw new Error(`failed to parse first argument in palette expression: ${s.message}`)}const r=n[2];if(!Array.isArray(r))throw new Error("the second argument of palette must be an array");const o=new Array(r.length);for(let s=0;s<o.length;s++){let l;try{l=Po(r[s],xu,t)}catch(u){throw new Error(`failed to parse color at index ${s} in palette expression: ${u.message}`)}if(!(l instanceof so))throw new Error(`the palette color at index ${s} must be a literal value`);o[s]=l}return[i,...o]}function ii(...n){return function(e,t,i){const r=e[0];let o;for(let s=0;s<n.length;s++){const l=n[s](e,t,i);if(s==n.length-1){if(!l)throw new Error("expected last argument validator to return the parsed args");o=l}}return new mK(t,r,...o)}}function EK(n,e,t){const i=n[0],r=yK[i];if(!r)throw new Error(`unknown operator: ${i}`);return r(n,e,t)}function HD(n){if(!n)return"";const e=n.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return HD(n.getGeometries()[0]);default:return""}}function KD(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function rd(n,e,t){const i=Po(n,e,t);return Pu(i)}function Pu(n,e){if(n instanceof so){if(n.type===xu&&typeof n.value=="string"){const i=uM(n.value);return function(){return i}}return function(){return n.value}}const t=n.operator;switch(t){case wt.Number:case wt.String:case wt.Coalesce:return TK(n);case wt.Get:case wt.Var:case wt.Has:return RK(n);case wt.Id:return i=>i.featureId;case wt.GeometryType:return i=>i.geometryType;case wt.Concat:{const i=n.args.map(r=>Pu(r));return r=>"".concat(...i.map(o=>o(r).toString()))}case wt.Resolution:return i=>i.resolution;case wt.Any:case wt.All:case wt.Between:case wt.In:case wt.Not:return kK(n);case wt.Equal:case wt.NotEqual:case wt.LessThan:case wt.LessThanOrEqualTo:case wt.GreaterThan:case wt.GreaterThanOrEqualTo:return MK(n);case wt.Multiply:case wt.Divide:case wt.Add:case wt.Subtract:case wt.Clamp:case wt.Mod:case wt.Pow:case wt.Abs:case wt.Floor:case wt.Ceil:case wt.Round:case wt.Sin:case wt.Cos:case wt.Atan:case wt.Sqrt:return LK(n);case wt.Case:return PK(n);case wt.Match:return GK(n);case wt.Interpolate:return FK(n);case wt.ToString:return OK(n);default:throw new Error(`Unsupported operator ${t}`)}}function TK(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let o=0;o<i;++o)r[o]=Pu(n.args[o]);switch(t){case wt.Coalesce:return o=>{for(let s=0;s<i;++s){const l=r[s](o);if(typeof l<"u"&&l!==null)return l}throw new Error("Expected one of the values to be non-null")};case wt.Number:case wt.String:return o=>{for(let s=0;s<i;++s){const l=r[s](o);if(typeof l===t)return l}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function RK(n,e){const i=n.args[0].value;switch(n.operator){case wt.Get:return r=>{const o=n.args;let s=r.properties[i];for(let l=1,u=o.length;l<u;++l){const d=o[l].value;s=s[d]}return s};case wt.Var:return r=>r.variables[i];case wt.Has:return r=>{const o=n.args;if(!(i in r.properties))return!1;let s=r.properties[i];for(let l=1,u=o.length;l<u;++l){const d=o[l].value;if(!s||!Object.hasOwn(s,d))return!1;s=s[d]}return!0};default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function MK(n,e){const t=n.operator,i=Pu(n.args[0]),r=Pu(n.args[1]);switch(t){case wt.Equal:return o=>i(o)===r(o);case wt.NotEqual:return o=>i(o)!==r(o);case wt.LessThan:return o=>i(o)<r(o);case wt.LessThanOrEqualTo:return o=>i(o)<=r(o);case wt.GreaterThan:return o=>i(o)>r(o);case wt.GreaterThanOrEqualTo:return o=>i(o)>=r(o);default:throw new Error(`Unsupported comparison operator ${t}`)}}function kK(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let o=0;o<i;++o)r[o]=Pu(n.args[o]);switch(t){case wt.Any:return o=>{for(let s=0;s<i;++s)if(r[s](o))return!0;return!1};case wt.All:return o=>{for(let s=0;s<i;++s)if(!r[s](o))return!1;return!0};case wt.Between:return o=>{const s=r[0](o),l=r[1](o),u=r[2](o);return s>=l&&s<=u};case wt.In:return o=>{const s=r[0](o);for(let l=1;l<i;++l)if(s===r[l](o))return!0;return!1};case wt.Not:return o=>!r[0](o);default:throw new Error(`Unsupported logical operator ${t}`)}}function LK(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let o=0;o<i;++o)r[o]=Pu(n.args[o]);switch(t){case wt.Multiply:return o=>{let s=1;for(let l=0;l<i;++l)s*=r[l](o);return s};case wt.Divide:return o=>r[0](o)/r[1](o);case wt.Add:return o=>{let s=0;for(let l=0;l<i;++l)s+=r[l](o);return s};case wt.Subtract:return o=>r[0](o)-r[1](o);case wt.Clamp:return o=>{const s=r[0](o),l=r[1](o);if(s<l)return l;const u=r[2](o);return s>u?u:s};case wt.Mod:return o=>r[0](o)%r[1](o);case wt.Pow:return o=>Math.pow(r[0](o),r[1](o));case wt.Abs:return o=>Math.abs(r[0](o));case wt.Floor:return o=>Math.floor(r[0](o));case wt.Ceil:return o=>Math.ceil(r[0](o));case wt.Round:return o=>Math.round(r[0](o));case wt.Sin:return o=>Math.sin(r[0](o));case wt.Cos:return o=>Math.cos(r[0](o));case wt.Atan:return i===2?o=>Math.atan2(r[0](o),r[1](o)):o=>Math.atan(r[0](o));case wt.Sqrt:return o=>Math.sqrt(r[0](o));default:throw new Error(`Unsupported numeric operator ${t}`)}}function PK(n,e){const t=n.args.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=Pu(n.args[r]);return r=>{for(let o=0;o<t-1;o+=2)if(i[o](r))return i[o+1](r);return i[t-1](r)}}function GK(n,e){const t=n.args.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=Pu(n.args[r]);return r=>{const o=i[0](r);for(let s=1;s<t-1;s+=2)if(o===i[s](r))return i[s+1](r);return i[t-1](r)}}function FK(n,e){const t=n.args.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=Pu(n.args[r]);return r=>{const o=i[0](r),s=i[1](r);let l,u;for(let h=2;h<t;h+=2){const d=i[h](r);let m=i[h+1](r);const y=Array.isArray(m);if(y&&(m=hK(m)),d>=s)return h===2?m:y?NK(o,s,l,u,d,m):C0(o,s,l,u,d,m);l=d,u=m}return u}}function OK(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let o=0;o<i;++o)r[o]=Pu(n.args[o]);switch(t){case wt.ToString:return o=>{const s=r[0](o);return n.args[0].type===xu?cM(s):s.toString()};default:throw new Error(`Unsupported convert operator ${t}`)}}function C0(n,e,t,i,r,o){const s=r-t;if(s===0)return i;const l=e-t,u=n===1?l/s:(Math.pow(n,l)-1)/(Math.pow(n,s)-1);return i+u*(o-i)}function NK(n,e,t,i,r,o){if(r-t===0)return i;const l=zG(i),u=zG(o);let h=u[2]-l[2];h>180?h-=360:h<-180&&(h+=360);const d=[C0(n,e,t,l[0],r,u[0]),C0(n,e,t,l[1],r,u[1]),l[2]+C0(n,e,t,0,r,h),C0(n,e,t,i[3],r,o[3])];return dK(d)}const An={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class jD extends db{constructor(e,t,i,r){super(),this.extent=e,this.pixelRatio_=i,this.resolution=t,this.state=typeof r=="function"?An.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent($n.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==An.IDLE&&this.loader){this.state=An.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;dD(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(i=>{"image"in i&&(this.image_=i.image),"extent"in i&&(this.extent=i.extent),"resolution"in i&&(this.resolution=i.resolution),"pixelRatio"in i&&(this.pixelRatio_=i.pixelRatio),(i instanceof HTMLImageElement||pD&&i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement)&&(this.image_=i),this.state=An.LOADED}).catch(i=>{this.state=An.ERROR,console.error(i)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function DK(n,e,t){const i=n;let r=!0,o=!1,s=!1;const l=[nC(i,$n.LOAD,function(){s=!0,o||e()})];return i.src&&WR?(o=!0,i.decode().then(function(){r&&e()}).catch(function(u){r&&(s?e():t())})):l.push(nC(i,$n.ERROR,t)),function(){r=!1,l.forEach(pr)}}function VK(n,e){return new Promise((t,i)=>{function r(){s(),t(n)}function o(){s(),i(new Error("Image load error"))}function s(){n.removeEventListener("load",r),n.removeEventListener("error",o)}n.addEventListener("load",r),n.addEventListener("error",o)})}function $D(n,e){return e&&(n.src=e),n.src&&WR?new Promise((t,i)=>n.decode().then(()=>t(n)).catch(r=>n.complete&&n.width?t(n):i(r))):VK(n)}function JD(n,e){return e&&(n.src=e),n.src&&WR&&pD?n.decode().then(()=>createImageBitmap(n)).catch(t=>{if(n.complete&&n.width)return n;throw t}):$D(n)}class BK{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];(e++&3)===0&&!i.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,i){const r=X2(e,t,i);return r in this.cache_?this.cache_[r]:null}getPattern(e,t,i){const r=X2(e,t,i);return r in this.patternCache_?this.patternCache_[r]:null}set(e,t,i,r,o){const s=X2(e,t,i),l=s in this.cache_;this.cache_[s]=r,o&&(r.getImageState()===An.IDLE&&r.load(),r.getImageState()===An.LOADING?r.ready().then(()=>{this.patternCache_[s]=aC().createPattern(r.getImage(1),"repeat")}):this.patternCache_[s]=aC().createPattern(r.getImage(1),"repeat")),l||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function X2(n,e,t){const i=t?Hl(t):"null";return e+":"+n+":"+i}const zl=new BK;let o0=null;class dM extends db{constructor(e,t,i,r,o){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=o,this.imageState_=r===void 0?An.IDLE:r,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===An.LOADED){o0||(o0=qs(1,1,void 0,{willReadFrequently:!0})),o0.drawImage(this.image_,0,0);try{o0.getImageData(0,0,1,1),this.tainted_=!1}catch{o0=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent($n.CHANGE)}handleImageError_(){this.imageState_=An.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=An.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=qs(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===An.IDLE){this.image_||this.initializeImage_(),this.imageState_=An.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&$D(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==An.LOADED)return;const t=this.image_,i=qs(Math.ceil(t.width*e),Math.ceil(t.height*e)),r=i.canvas;i.scale(e,e),i.drawImage(t,0,0),i.globalCompositeOperation="multiply",i.fillStyle=uK(this.color_),i.fillRect(0,0,r.width/e,r.height/e),i.globalCompositeOperation="destination-in",i.drawImage(t,0,0),this.canvas_[e]=r}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===An.LOADED||this.imageState_===An.ERROR)e();else{const t=()=>{(this.imageState_===An.LOADED||this.imageState_===An.ERROR)&&(this.removeEventListener($n.CHANGE,t),e())};this.addEventListener($n.CHANGE,t)}})),this.ready_}}function uC(n,e,t,i,r,o){let s=e===void 0?void 0:zl.get(e,t,r);return s||(s=new dM(n,n&&"src"in n?n.src||void 0:e,t,i,r),zl.set(e,t,r,s,o)),o&&s&&!zl.getPattern(e,t,r)&&zl.set(e,t,r,s,o),s}function bc(n){return n?Array.isArray(n)?cM(n):typeof n=="object"&&"src"in n?ZK(n):n:null}function ZK(n){if(!n.offset||!n.size)return zl.getPattern(n.src,"anonymous",n.color);const e=n.src+":"+n.offset,t=zl.getPattern(e,void 0,n.color);if(t)return t;const i=zl.get(n.src,"anonymous",null);if(i.getImageState()!==An.LOADED)return null;const r=qs(n.size[0],n.size[1]);return r.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),uC(r.canvas,e,void 0,An.LOADED,n.color,!0),zl.getPattern(e,void 0,n.color)}const qD="10px sans-serif",za="#000",Cy="round",Dh=[],Vh=0,wy="round",kv=10,Lv="#000",Pv="center",cC="middle",Rp=[0,0,0,0],Gv=1,Mm=new eu;let a0=null,KG;const XE={},WK=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function zK(n,e,t){return`${n} ${e} 16px "${t}"`}const UK=(function(){let e,t;async function i(o){await t.ready;const s=await t.load(o);if(s.length===0)return!1;const l=oC(o),u=l.families[0].toLowerCase(),h=l.weight;return s.some(d=>{const m=d.family.replace(/^['"]|['"]$/g,"").toLowerCase(),y=BE[d.weight]||d.weight;return m===u&&d.style===l.style&&y==h})}async function r(){await t.ready;let o=!0;const s=Mm.getProperties(),l=Object.keys(s).filter(u=>s[u]<100);for(let u=l.length-1;u>=0;--u){const h=l[u];let d=s[h];d<100&&(await i(h)?(cb(XE),Mm.set(h,100)):(d+=10,Mm.set(h,d,!0),d<100&&(o=!1)))}e=void 0,o||(e=setTimeout(r,100))}return async function(o){t||(t=Il?self.fonts:document.fonts);const s=oC(o);if(!s)return;const l=s.families;let u=!1;for(const h of l){if(WK.has(h))continue;const d=zK(s.style,s.weight,h);Mm.get(d)===void 0&&(Mm.set(d,0,!0),u=!0)}u&&(clearTimeout(e),e=setTimeout(r,100))}})(),XK=(function(){let n;return function(e){let t=XE[e];if(t==null){if(Il){const i=oC(e),r=QD(e,"g");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=e,document.body.appendChild(n),t=n.offsetHeight,document.body.removeChild(n);XE[e]=t}return t}})();function QD(n,e){return a0||(a0=qs(1,1)),n!=KG&&(a0.font=n,KG=a0.font),a0.measureText(e)}function e4(n,e){return QD(n,e).width}function jG(n,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((r,o)=>Math.max(r,e4(n,o)),0);return t[e]=i,i}function YK(n,e){const t=[],i=[],r=[];let o=0,s=0,l=0,u=0;for(let h=0,d=e.length;h<=d;h+=2){const m=e[h];if(m===`
`||h===d){o=Math.max(o,s),r.push(s),s=0,l+=u,u=0;continue}const y=e[h+1]||n.font,x=e4(y,m);t.push(x),s+=x;const C=XK(y);i.push(C),u=Math.max(u,C)}return{width:o,height:l,widths:t,heights:i,lineWidths:r}}function HK(n,e,t,i,r,o,s,l,u,h,d){n.save(),t!==1&&(n.globalAlpha===void 0?n.globalAlpha=m=>m.globalAlpha*=t:n.globalAlpha*=t),e&&n.transform.apply(n,e),i.contextInstructions?(n.translate(u,h),n.scale(d[0],d[1]),KK(i,n)):d[0]<0||d[1]<0?(n.translate(u,h),n.scale(d[0],d[1]),n.drawImage(i,r,o,s,l,0,0,s,l)):n.drawImage(i,r,o,s,l,u,h,s*d[0],l*d[1]),n.restore()}function KK(n,e){const t=n.contextInstructions;for(let i=0,r=t.length;i<r;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class mb{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=ia(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new mb({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Zn()}getImage(e){return Zn()}getHitDetectionImage(){return Zn()}getPixelRatio(e){return 1}getImageState(){return Zn()}getImageSize(){return Zn()}getOrigin(){return Zn()}getSize(){return Zn()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=ia(e)}listenImageChange(e){Zn()}load(){Zn()}unlistenImageChange(e){Zn()}ready(){return Promise.resolve()}}class vl extends mb{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?An.LOADING:An.LOADED,this.imageState_===An.LOADING&&this.ready().then(()=>this.imageState_=An.LOADED),this.render()}clone(){const e=this.getScale(),t=new vl({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){const t=this.fill_?.getKey(),i=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${t}`+Object.values(this.renderOptions_).join(",");let r=zl.get(i,null,null)?.getImage(1);if(!r){const o=this.renderOptions_,s=Math.ceil(o.size*e),l=qs(s,s);this.draw_(o,l,e),r=l.canvas,zl.set(i,null,null,new dM(r,void 0,null,An.LOADED,null))}return r}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let r=this.radius,o=this.radius2_===void 0?r:this.radius2_;if(r<o){const W=r;r=o,o=W}const s=this.radius2_===void 0?this.points_:this.points_*2,l=2*Math.PI/s,u=o*Math.sin(l),h=Math.sqrt(o*o-u*u),d=r-h,m=Math.sqrt(u*u+d*d),y=m/u;if(e==="miter"&&y<=i)return y*t;const x=t/2/y,C=t/2*(d/m),S=Math.sqrt((r+x)*(r+x)+C*C)-r;if(this.radius2_===void 0||e==="bevel")return S*2;const T=r*Math.sin(l),M=Math.sqrt(r*r-T*T),G=o-M,V=Math.sqrt(T*T+G*G)/T;if(V<=i){const W=V*t/2-o-r;return 2*Math.max(S,W)}return S*2}createRenderOptions(){let e=Cy,t=wy,i=0,r=null,o=0,s,l=0;this.stroke_&&(s=bc(this.stroke_.getColor()??Lv),l=this.stroke_.getWidth()??Gv,r=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??wy,e=this.stroke_.getLineCap()??Cy,i=this.stroke_.getMiterLimit()??kv);const u=this.calculateLineJoinSize_(t,l,i),h=Math.max(this.radius,this.radius2_||0),d=Math.ceil(2*h+u);return{strokeStyle:s,strokeWidth:l,size:d,lineCap:e,lineDash:r,lineDashOffset:o,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let r=this.fill_.getColor();r===null&&(r=za),t.fillStyle=bc(r),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let i=this.fill_.getColor(),r=0;typeof i=="string"&&(i=Hl(i)),i===null?r=1:Array.isArray(i)&&(r=i.length===4?i[3]:1),r===0&&(t=qs(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const i=this.radius;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const r=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const o=this.angle_-Math.PI/2,s=2*Math.PI/t;for(let l=0;l<t;l++){const u=o+l*s,h=l%2===0?i:r;e.lineTo(h*Math.cos(u),h*Math.sin(u))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=za,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Qs extends vl{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new Qs({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius=e,this.render()}}class Ji{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new Ji({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=uC(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===An.IDLE&&t.load(),t.getImageState()===An.LOADING&&(this.patternImage_=t)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?ti(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:Hl(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function $G(n,e,t,i){return t!==void 0&&i!==void 0?[t/n,i/e]:t!==void 0?t/n:i!==void 0?i/e:1}class Gu extends mb{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,r=e.scale!==void 0?e.scale:1,o=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:r,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:o,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const s=e.img!==void 0?e.img:null;let l=e.src;fr(!(l!==void 0&&s),"`image` and `src` cannot be provided at the same time"),(l===void 0||l.length===0)&&s&&(l=s.src||ti(s)),fr(l!==void 0&&l.length>0,"A defined and non-empty `src` or `image` must be provided"),fr(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let u;if(e.src!==void 0?u=An.IDLE:s!==void 0&&("complete"in s?s.complete?u=s.src?An.LOADED:An.IDLE:u=An.LOADING:u=An.LOADED),this.color_=e.color!==void 0?Hl(e.color):null,this.iconImage_=uC(s,l,this.crossOrigin_,u,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let h,d;if(e.size)[h,d]=e.size;else{const m=this.getImage(1);if(m.width&&m.height)h=m.width,d=m.height;else if(m instanceof HTMLImageElement){this.initialOptions_=e;const y=()=>{if(this.unlistenImageChange(y),!this.initialOptions_)return;const x=this.iconImage_.getSize();this.setScale($G(x[0],x[1],e.width,e.height))};this.listenImageChange(y);return}}h!==void 0&&this.setScale($G(h,d,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new Gu({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=r[0]),this.anchorYUnits_=="fraction"&&(e[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+r[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}setSrc(e){this.iconImage_=uC(null,e,this.crossOrigin_,An.IDLE,this.color_)}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==An.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==An.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener($n.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener($n.CHANGE,e)}ready(){return this.iconImage_.ready()}}class ki{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new ki({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}class qn{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=JG,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new qn({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=JG,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function jK(n){let e;if(typeof n=="function")e=n;else{let t;Array.isArray(n)?t=n:(fr(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[n]),e=function(){return t}}return e}let Y2=null;function fM(n,e){if(!Y2){const t=new Ji({color:"rgba(255,255,255,0.4)"}),i=new ki({color:"#3399CC",width:1.25});Y2=[new qn({image:new Qs({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return Y2}function t4(){const n={},e=[255,255,255,1],t=[0,153,255,1],i=3;return n.Polygon=[new qn({fill:new Ji({color:[255,255,255,.5]})})],n.MultiPolygon=n.Polygon,n.LineString=[new qn({stroke:new ki({color:e,width:i+2})}),new qn({stroke:new ki({color:t,width:i})})],n.MultiLineString=n.LineString,n.Circle=n.Polygon.concat(n.LineString),n.Point=[new qn({image:new Qs({radius:i*2,fill:new Ji({color:t}),stroke:new ki({color:e,width:i/2})}),zIndex:1/0})],n.MultiPoint=n.Point,n.GeometryCollection=n.Polygon.concat(n.LineString,n.Point),n}function JG(n){return n.getGeometry()}const $K="#333";class sd{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=ia(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new Ji({color:$K}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new sd({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()instanceof Ji?this.getFill().clone():this.getFill(),stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=ia(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}function JK(n){return!0}function qK(n){const e=YD(),t=QK(n,e),i=KD();return function(r,o){if(i.properties=r.getPropertiesInternal(),i.resolution=o,e.featureId){const s=r.getId();s!==void 0?i.featureId=s:i.featureId=null}return e.geometryType&&(i.geometryType=HD(r.getGeometry())),t(i)}}function qG(n){const e=YD(),t=n.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=YE(n[s],e);const r=KD(),o=new Array(t);return function(s,l){if(r.properties=s.getPropertiesInternal(),r.resolution=l,e.featureId){const h=s.getId();h!==void 0?r.featureId=h:r.featureId=null}let u=0;for(let h=0;h<t;++h){const d=i[h](r);d&&(o[u]=d,u+=1)}return o.length=u,o}}function QK(n,e){const t=n.length,i=new Array(t);for(let r=0;r<t;++r){const o=n[r],s="filter"in o?rd(o.filter,ba,e):JK;let l;if(Array.isArray(o.style)){const u=o.style.length;l=new Array(u);for(let h=0;h<u;++h)l[h]=YE(o.style[h],e)}else l=[YE(o.style,e)];i[r]={filter:s,styles:l}}return function(r){const o=[];let s=!1;for(let l=0;l<t;++l){const u=i[l].filter;if(u(r)&&!(n[l].else&&s)){s=!0;for(const h of i[l].styles){const d=h(r);d&&o.push(d)}}}return o}}function YE(n,e){const t=Fv(n,"",e),i=Ov(n,"",e),r=ej(n,e),o=tj(n,e),s=Xa(n,"z-index",e);if(!t&&!i&&!r&&!o&&!Yp(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const l=new qn;return function(u){let h=!0;if(t){const d=t(u);d&&(h=!1),l.setFill(d)}if(i){const d=i(u);d&&(h=!1),l.setStroke(d)}if(r){const d=r(u);d&&(h=!1),l.setText(d)}if(o){const d=o(u);d&&(h=!1),l.setImage(d)}return s&&l.setZIndex(s(u)),h?null:l}}function Fv(n,e,t){let i;if(e+"fill-pattern-src"in n)i=sj(n,e+"fill-",t);else{if(n[e+"fill-color"]==="none")return o=>null;i=pM(n,e+"fill-color",t)}if(!i)return null;const r=new Ji;return function(o){const s=i(o);return s===lM?null:(r.setColor(s),r)}}function Ov(n,e,t){const i=Xa(n,e+"stroke-width",t),r=pM(n,e+"stroke-color",t);if(!i&&!r)return null;const o=Ah(n,e+"stroke-line-cap",t),s=Ah(n,e+"stroke-line-join",t),l=n4(n,e+"stroke-line-dash",t),u=Xa(n,e+"stroke-line-dash-offset",t),h=Xa(n,e+"stroke-miter-limit",t),d=new ki;return function(m){if(r){const y=r(m);if(y===lM)return null;d.setColor(y)}if(i&&d.setWidth(i(m)),o){const y=o(m);if(y!=="butt"&&y!=="round"&&y!=="square")throw new Error("Expected butt, round, or square line cap");d.setLineCap(y)}if(s){const y=s(m);if(y!=="bevel"&&y!=="round"&&y!=="miter")throw new Error("Expected bevel, round, or miter line join");d.setLineJoin(y)}return l&&d.setLineDash(l(m)),u&&d.setLineDashOffset(u(m)),h&&d.setMiterLimit(h(m)),d}}function ej(n,e){const t="text-",i=Ah(n,t+"value",e);if(!i)return null;const r=Fv(n,t,e),o=Fv(n,t+"background-",e),s=Ov(n,t,e),l=Ov(n,t+"background-",e),u=Ah(n,t+"font",e),h=Xa(n,t+"max-angle",e),d=Xa(n,t+"offset-x",e),m=Xa(n,t+"offset-y",e),y=iy(n,t+"overflow",e),x=Ah(n,t+"placement",e),C=Xa(n,t+"repeat",e),w=Uw(n,t+"scale",e),S=iy(n,t+"rotate-with-view",e),T=Xa(n,t+"rotation",e),M=Ah(n,t+"align",e),G=Ah(n,t+"justify",e),N=Ah(n,t+"baseline",e),V=iy(n,t+"keep-upright",e),W=n4(n,t+"padding",e),j=Xw(n,t+"declutter-mode"),J=new sd({declutterMode:j});return function(te){if(J.setText(i(te)),r&&J.setFill(r(te)),o&&J.setBackgroundFill(o(te)),s&&J.setStroke(s(te)),l&&J.setBackgroundStroke(l(te)),u&&J.setFont(u(te)),h&&J.setMaxAngle(h(te)),d&&J.setOffsetX(d(te)),m&&J.setOffsetY(m(te)),y&&J.setOverflow(y(te)),x){const ce=x(te);if(ce!=="point"&&ce!=="line")throw new Error("Expected point or line for text-placement");J.setPlacement(ce)}if(C&&J.setRepeat(C(te)),w&&J.setScale(w(te)),S&&J.setRotateWithView(S(te)),T&&J.setRotation(T(te)),M){const ce=M(te);if(ce!=="left"&&ce!=="center"&&ce!=="right"&&ce!=="end"&&ce!=="start")throw new Error("Expected left, right, center, start, or end for text-align");J.setTextAlign(ce)}if(G){const ce=G(te);if(ce!=="left"&&ce!=="right"&&ce!=="center")throw new Error("Expected left, right, or center for text-justify");J.setJustify(ce)}if(N){const ce=N(te);if(ce!=="bottom"&&ce!=="top"&&ce!=="middle"&&ce!=="alphabetic"&&ce!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");J.setTextBaseline(ce)}return W&&J.setPadding(W(te)),V&&J.setKeepUpright(V(te)),J}}function tj(n,e){return"icon-src"in n?nj(n,e):"shape-points"in n?ij(n,e):"circle-radius"in n?rj(n,e):null}function nj(n,e){const t="icon-",i=t+"src",r=i4(n[i],i),o=hC(n,t+"anchor",e),s=Uw(n,t+"scale",e),l=Xa(n,t+"opacity",e),u=hC(n,t+"displacement",e),h=Xa(n,t+"rotation",e),d=iy(n,t+"rotate-with-view",e),m=eF(n,t+"anchor-origin"),y=tF(n,t+"anchor-x-units"),x=tF(n,t+"anchor-y-units"),C=uj(n,t+"color"),w=aj(n,t+"cross-origin"),S=lj(n,t+"offset"),T=eF(n,t+"offset-origin"),M=dC(n,t+"width"),G=dC(n,t+"height"),N=oj(n,t+"size"),V=Xw(n,t+"declutter-mode"),W=new Gu({src:r,anchorOrigin:m,anchorXUnits:y,anchorYUnits:x,color:C,crossOrigin:w,offset:S,offsetOrigin:T,height:G,width:M,size:N,declutterMode:V});return function(j){return l&&W.setOpacity(l(j)),u&&W.setDisplacement(u(j)),h&&W.setRotation(h(j)),d&&W.setRotateWithView(d(j)),s&&W.setScale(s(j)),o&&W.setAnchor(o(j)),W}}function ij(n,e){const t="shape-",i=t+"points",r=t+"radius",o=HE(n[i],i),s=HE(n[r],r),l=Fv(n,t,e),u=Ov(n,t,e),h=Uw(n,t+"scale",e),d=hC(n,t+"displacement",e),m=Xa(n,t+"rotation",e),y=iy(n,t+"rotate-with-view",e),x=dC(n,t+"radius2"),C=dC(n,t+"angle"),w=Xw(n,t+"declutter-mode"),S=new vl({points:o,radius:s,radius2:x,angle:C,declutterMode:w});return function(T){return l&&S.setFill(l(T)),u&&S.setStroke(u(T)),d&&S.setDisplacement(d(T)),m&&S.setRotation(m(T)),y&&S.setRotateWithView(y(T)),h&&S.setScale(h(T)),S}}function rj(n,e){const t="circle-",i=Fv(n,t,e),r=Ov(n,t,e),o=Xa(n,t+"radius",e),s=Uw(n,t+"scale",e),l=hC(n,t+"displacement",e),u=Xa(n,t+"rotation",e),h=iy(n,t+"rotate-with-view",e),d=Xw(n,t+"declutter-mode"),m=new Qs({radius:5,declutterMode:d});return function(y){return o&&m.setRadius(o(y)),i&&m.setFill(i(y)),r&&m.setStroke(r(y)),l&&m.setDisplacement(l(y)),u&&m.setRotation(u(y)),h&&m.setRotateWithView(h(y)),s&&m.setScale(s(y)),m}}function Xa(n,e,t){if(!(e in n))return;const i=rd(n[e],Xi,t);return function(r){return HE(i(r),e)}}function Ah(n,e,t){if(!(e in n))return null;const i=rd(n[e],Wa,t);return function(r){return i4(i(r),e)}}function sj(n,e,t){const i=Ah(n,e+"pattern-src",t),r=QG(n,e+"pattern-offset",t),o=QG(n,e+"pattern-size",t),s=pM(n,e+"color",t);return function(l){return{src:i(l),offset:r&&r(l),size:o&&o(l),color:s&&s(l)}}}function iy(n,e,t){if(!(e in n))return null;const i=rd(n[e],ba,t);return function(r){const o=i(r);if(typeof o!="boolean")throw new Error(`Expected a boolean for ${e}`);return o}}function pM(n,e,t){if(!(e in n))return null;const i=rd(n[e],xu,t);return function(r){return r4(i(r),e)}}function n4(n,e,t){if(!(e in n))return null;const i=rd(n[e],Jp,t);return function(r){return yb(i(r),e)}}function hC(n,e,t){if(!(e in n))return null;const i=rd(n[e],Jp,t);return function(r){const o=yb(i(r),e);if(o.length!==2)throw new Error(`Expected two numbers for ${e}`);return o}}function QG(n,e,t){if(!(e in n))return null;const i=rd(n[e],Jp,t);return function(r){return s4(i(r),e)}}function Uw(n,e,t){if(!(e in n))return null;const i=rd(n[e],Jp|Xi,t);return function(r){return cj(i(r),e)}}function dC(n,e){const t=n[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function oj(n,e){const t=n[e];if(t!==void 0){if(typeof t=="number")return ia(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function aj(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function eF(n,e){const t=n[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function tF(n,e){const t=n[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function lj(n,e){const t=n[e];if(t!==void 0)return yb(t,e)}function Xw(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function uj(n,e){const t=n[e];if(t!==void 0)return r4(t,e)}function yb(n,e){if(!Array.isArray(n))throw new Error(`Expected an array for ${e}`);const t=n.length;for(let i=0;i<t;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return n}function i4(n,e){if(typeof n!="string")throw new Error(`Expected a string for ${e}`);return n}function HE(n,e){if(typeof n!="number")throw new Error(`Expected a number for ${e}`);return n}function r4(n,e){if(typeof n=="string")return n;const t=yb(n,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function s4(n,e){const t=yb(n,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function cj(n,e){return typeof n=="number"?n:s4(n,e)}const nF={RENDER_ORDER:"renderOrder"};class gM extends cg{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(nF.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const i=this.getDeclutter();i in e.declutter||(e.declutter[i]=new UD(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(nF.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?fM:e;const t=hj(e);this.styleFunction_=e===null?void 0:jK(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}}function hj(n){if(n===void 0)return fM;if(!n)return null;if(typeof n=="function"||n instanceof qn)return n;if(!Array.isArray(n))return qG([n]);if(n.length===0)return[];const e=n.length,t=n[0];if(t instanceof qn){const r=new Array(e);for(let o=0;o<e;++o){const s=n[o];if(!(s instanceof qn))throw new Error("Expected a list of style instances");r[o]=s}return r}if("style"in t){const r=new Array(e);for(let o=0;o<e;++o){const s=n[o];if(!("style"in s))throw new Error("Expected a list of rules with a style property");r[o]=s}return qK(r)}return qG(n)}class o4 extends la{constructor(e,t,i,r){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=r}}class dj extends Nw{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){Zn()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;Lu(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),_D(r,i)}forEachFeatureAtCoordinate(e,t,i,r,o,s,l,u){let h;const d=t.viewState;function m(N,V,W,j){return o.call(s,V,N?W:null,j)}const y=d.projection,x=Lw(e.slice(),y),C=[[0,0]];if(y.canWrapX()&&r){const N=y.getExtent(),V=Ni(N);C.push([-V,0],[V,0])}const w=t.layerStatesArray,S=w.length,T=[],M=[];for(let N=0;N<C.length;N++)for(let V=S-1;V>=0;--V){const W=w[V],j=W.layer;if(j.hasRenderer()&&aM(W,d)&&l.call(u,j)){const J=j.getRenderer(),te=j.getSource();if(J&&te){const ce=te.getWrapX()?x:e,pe=m.bind(null,W.managed);M[0]=ce[0]+C[N][0],M[1]=ce[1]+C[N][1],h=J.forEachFeatureAtCoordinate(M,t,i,pe,T)}if(h)return h}}if(T.length===0)return;const G=1/T.length;return T.forEach((N,V)=>N.distanceSq+=V*G),T.sort((N,V)=>N.distanceSq-V.distanceSq),T.some(N=>h=N.callback(N.feature,N.layer,N.geometry)),h}hasFeatureAtCoordinate(e,t,i,r,o,s){return this.forEachFeatureAtCoordinate(e,t,i,r,Iy,this,o,s)!==void 0}getMap(){return this.map_}renderFrame(e){Zn()}scheduleExpireIconCache(e){zl.canExpireCache()&&e.postRenderFunctions.push(fj)}}function fj(n,e){zl.expire()}class pj extends dj{constructor(e){super(e),this.fontChangeListenerKey_=In(Mm,jp.PROPERTYCHANGE,e.redrawText,e),this.element_=Il?PD():document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Vc+" ol-layers";const i=e.getViewport();i&&i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const r=new o4(e,void 0,t);i.dispatchEvent(r)}}disposeInternal(){pr(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(ja.PRECOMPOSE,e);const t=e.layerStatesArray.sort((h,d)=>h.zIndex-d.zIndex);t.some(h=>h.layer instanceof gM&&h.layer.getDeclutter())&&(e.declutter={});const r=e.viewState;this.children_.length=0;const o=[];let s=null;for(let h=0,d=t.length;h<d;++h){const m=t[h];e.layerIndex=h;const y=m.layer,x=y.getSourceState();if(!aM(m,r)||x!="ready"&&x!="undefined"){y.unrender();continue}const C=y.render(e,s);C&&(C!==s&&(this.children_.push(C),s=C),o.push(m))}this.declutter(e,o),RH(this.element_,this.children_);const u=this.getMap().getTargetElement();if($d(u)){const h=u.getContext("2d");for(const d of this.children_){const m=d.firstElementChild||d,y=d.style.backgroundColor;if(y&&(!$d(m)||m.width>0)&&(h.fillStyle=y,h.fillRect(0,0,u.width,u.height)),$d(m)&&m.width>0){const x=d.style.opacity||m.style.opacity;h.globalAlpha=x===""?1:Number(x);const C=m.style.transform;if(C)h.setTransform(...OE(C));else{const w=parseFloat(m.style.width)/m.width,S=parseFloat(m.style.height)/m.height;h.setTransform(w,0,0,S,0,0)}h.drawImage(m,0,0)}}h.globalAlpha=1,h.setTransform(1,0,0,1,0,0)}this.dispatchRenderEvent(ja.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let i=t.length-1;i>=0;--i){const r=t[i],o=r.layer;o.getDeclutter()&&o.renderDeclutter(e,r)}t.forEach(i=>i.layer.renderDeferred(e))}}}function a4(n){if(n instanceof cg){n.setMapInternal(null);return}n instanceof wf&&n.getLayers().forEach(a4)}function l4(n,e){if(n instanceof cg){n.setMapInternal(e);return}if(n instanceof wf){const t=n.getLayers().getArray();for(let i=0,r=t.length;i<r;++i)l4(t[i],e)}}let gj=class extends eu{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=mj(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:fD,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=qa(),this.pixelToCoordinateTransform_=qa(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,Il||(this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_)),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,Il||(this.resizeObserver_=new ResizeObserver(()=>this.updateSize())),this.controls=t.controls||(Il?new na:kH()),this.interactions=t.interactions||(Il?new na:JH({onFocusOnly:!0})),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new WY(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(mo.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(mo.VIEW,this.handleViewChanged_),this.addChangeListener(mo.SIZE,this.handleSizeChanged_),this.addChangeListener(mo.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof mc)&&e.view.then(function(r){i.setView(new mc(r))}),this.controls.addEventListener(Jo.ADD,r=>{r.element.setMap(this)}),this.controls.addEventListener(Jo.REMOVE,r=>{r.element.setMap(null)}),this.interactions.addEventListener(Jo.ADD,r=>{r.element.setMap(this)}),this.interactions.addEventListener(Jo.REMOVE,r=>{r.element.setMap(null)}),this.overlays_.addEventListener(Jo.ADD,r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener(Jo.REMOVE,r=>{const o=r.element.getId();o!==void 0&&delete this.overlayIdIndex_[o.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){l4(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_?.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const o=i.hitTolerance!==void 0?i.hitTolerance:0,s=i.layerFilter!==void 0?i.layerFilter:Iy,l=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,o,l,t,null,s,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(r){i.push(r)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(r){r instanceof wf?t(r.getLayers()):e.push(r)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const r=t.layerFilter!==void 0?t.layerFilter:Iy,o=t.hitTolerance!==void 0?t.hitTolerance:0,s=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,o,s,r,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),r=this.getSize(),o=i.width/r[0],s=i.height/r[1],l="changedTouches"in e?e.changedTouches[0]:e;return[(l.clientX-i.left)/o,(l.clientY-i.top)/s]}getTarget(){return this.get(mo.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Kp(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?Gs(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(mo.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof na){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const r=e[t];if(!r.visible)continue;const o=r.layer.getRenderer();if(o&&!o.ready)return!0;const s=r.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(e){const t=ds(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?Gs(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(mo.SIZE)}getView(){return this.get(mo.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,r){return zY(this.frameState_,e,t,i,r)}handleBrowserEvent(e,t){t=t||e.type;const i=new pc(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===Tv.POINTERDOWN||i===$n.WHEEL||i===$n.KEYDOWN){const r=this.getOwnerDocument(),o=this.viewport_.getRootNode?this.viewport_.getRootNode():r,s=t.target,l=o instanceof ShadowRoot?o.host===s?o.host.ownerDocument:o:o===r?r.documentElement:o;if(this.overlayContainerStopEvent_.contains(s)||!l.contains(s))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const r=this.getInteractions().getArray().slice();for(let o=r.length-1;o>=0;o--){const s=r[o];if(s.getMap()!==this||!s.getActive()||!this.getTargetElement())continue;if(!s.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let r=this.maxTilesLoading_,o=r;if(e){const s=e.viewHints;if(s[jr.ANIMATING]||s[jr.INTERACTING]){const l=Date.now()-e.time>8;r=l?0:8,o=l?0:2}}t.getTilesLoading()<r&&(t.reprioritize(),t.loadMoreTiles(r,o))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(ja.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(ja.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Tm(Ch.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Tm(Ch.LOADSTART,this,e))));const i=this.postRenderFunctions_;if(e)for(let r=0,o=i.length;r<o;++r)i[r](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,r=this.targetChangeHandlerKeys_.length;i<r;++i)pr(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener($n.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener($n.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_&&!$d(this.targetElement_)){this.resizeObserver_?.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{if($d(t)||t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new pj(this)),!$d(t)){this.mapBrowserEventHandler_=new BY(this,this.moveTolerance_);for(const r in Bi)this.mapBrowserEventHandler_.addEventListener(Bi[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener($n.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener($n.WHEEL,this.boundHandleBrowserEvent_,gD?{passive:!1}:!1);let i;if(this.keyboardEventTarget_)i=this.keyboardEventTarget_;else{const r=t.getRootNode();i=r instanceof ShadowRoot?r.host:t}if(this.targetChangeHandlerKeys_=[In(i,$n.KEYDOWN,this.handleBrowserEvent,this),In(i,$n.KEYPRESS,this.handleBrowserEvent,this)],t instanceof HTMLElement){const r=t.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_?.observe(t)}}this.updateSize()}}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(pr(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(pr(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=In(e,jp.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=In(e,$n.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(pr),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Zd("addlayer",e)),this.layerGroupPropertyListenerKeys_=[In(e,jp.PROPERTYCHANGE,this.render,this),In(e,$n.CHANGE,this.render,this),In(e,"addlayer",this.handleLayerAdd_,this),In(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const e=this.frameState_.layerStatesArray;for(let t=0,i=e.length;t<i;++t){const r=e[t].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){a4(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),r=this.frameState_;let o=null;if(t!==void 0&&UG(t)&&i&&i.isDef()){const s=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=i.getState();if(o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Av(l.center,l.resolution,l.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:l,viewHints:s,wantedTiles:{},mapId:ti(this),renderTargets:{}},l.nextCenter&&l.nextResolution){const u=isNaN(l.nextRotation)?l.rotation:l.nextRotation;o.nextExtent=Av(l.nextCenter,l.nextResolution,u,t)}}this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),r&&(!this.previousExtent_||!lg(this.previousExtent_)&&!Up(o.extent,this.previousExtent_))&&(this.dispatchEvent(new Tm(Ch.MOVESTART,this,r)),this.previousExtent_=Fy(this.previousExtent_)),this.previousExtent_&&!o.viewHints[jr.ANIMATING]&&!o.viewHints[jr.INTERACTING]&&!Up(o.extent,this.previousExtent_)&&(this.dispatchEvent(new Tm(Ch.MOVEEND,this,o)),qN(o.extent,this.previousExtent_))),this.dispatchEvent(new Tm(Ch.POSTRENDER,this,o)),this.renderComplete_=(this.hasListener(Ch.LOADSTART)||this.hasListener(Ch.LOADEND)||this.hasListener(ja.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Zd("removelayer",t)),this.set(mo.LAYERGROUP,e)}setSize(e){this.set(mo.SIZE,e)}setTarget(e){this.set(mo.TARGET,e)}setView(e){if(!e||e instanceof mc){this.set(mo.VIEW,e);return}this.set(mo.VIEW,new mc);const t=this;e.then(function(i){t.setView(new mc(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){let r,o;if($d(e))r=e.width,o=e.height;else{const s=getComputedStyle(e);r=e.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=e.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth)}!isNaN(r)&&!isNaN(o)&&(t=[Math.max(0,r),Math.max(0,o)],!UG(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&JN("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!nd(t,i))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function mj(n){let e=null;n.keyboardEventTarget!==void 0&&(e=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const t={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new wf({layers:n.layers});t[mo.LAYERGROUP]=i,t[mo.TARGET]=n.target,t[mo.VIEW]=n.view instanceof mc?n.view:new mc;let r;n.controls!==void 0&&(Array.isArray(n.controls)?r=new na(n.controls.slice()):(fr(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=n.controls));let o;n.interactions!==void 0&&(Array.isArray(n.interactions)?o=new na(n.interactions.slice()):(fr(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),o=n.interactions));let s;return n.overlays!==void 0?Array.isArray(n.overlays)?s=new na(n.overlays.slice()):(fr(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),s=n.overlays):s=new na,{controls:r,interactions:o,keyboardEventTarget:e,overlays:s,values:t}}var Jd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function u4(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var aI={exports:{}},yj=aI.exports,iF;function _j(){return iF||(iF=1,(function(n,e){(function(t,i){n.exports=i()})(yj,(function(){var t,i,r;function o(s,l){if(!t)t=l;else if(!i)i=l;else{var u="var sharedChunk = {}; ("+t+")(sharedChunk); ("+i+")(sharedChunk);",h={};t(h),r=l(h),typeof window<"u"&&(r.workerUrl=window.URL.createObjectURL(new Blob([u],{type:"text/javascript"})))}}return o(["exports"],(function(s){function l(a,c){return a(c={exports:{}},c.exports),c.exports}var u=h;function h(a,c,f,v){this.cx=3*a,this.bx=3*(f-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(v-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=v,this.p2x=f,this.p2y=v}h.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},h.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},h.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},h.prototype.solveCurveX=function(a,c){var f,v,I,A,R;for(c===void 0&&(c=1e-6),I=a,R=0;R<8;R++){if(A=this.sampleCurveX(I)-a,Math.abs(A)<c)return I;var O=this.sampleCurveDerivativeX(I);if(Math.abs(O)<1e-6)break;I-=A/O}if((I=a)<(f=0))return f;if(I>(v=1))return v;for(;f<v;){if(A=this.sampleCurveX(I),Math.abs(A-a)<c)return I;a>A?f=I:v=I,I=.5*(v-f)+f}return I},h.prototype.solve=function(a,c){return this.sampleCurveY(this.solveCurveX(a,c))};var d=m;function m(a,c){this.x=a,this.y=c}m.prototype={clone:function(){return new m(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,c){return this.clone()._rotateAround(a,c)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var c=a.x-this.x,f=a.y-this.y;return c*c+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,c){return Math.atan2(this.x*c-this.y*a,this.x*a+this.y*c)},_matMult:function(a){var c=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=c,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var c=Math.cos(a),f=Math.sin(a),v=f*this.x+c*this.y;return this.x=c*this.x-f*this.y,this.y=v,this},_rotateAround:function(a,c){var f=Math.cos(a),v=Math.sin(a),I=c.y+v*(this.x-c.x)+f*(this.y-c.y);return this.x=c.x+f*(this.x-c.x)-v*(this.y-c.y),this.y=I,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},m.convert=function(a){return a instanceof m?a:Array.isArray(a)?new m(a[0],a[1]):a};var y=typeof self<"u"?self:{},x=Math.pow(2,53)-1;function C(a,c,f,v){var I=new u(a,c,f,v);return function(A){return I.solve(A)}}var w=C(.25,.1,.25,1);function S(a,c,f){return Math.min(f,Math.max(c,a))}function T(a,c,f){var v=f-c,I=((a-c)%v+v)%v+c;return I===c?f:I}function M(a){for(var c=[],f=arguments.length-1;f-- >0;)c[f]=arguments[f+1];for(var v=0,I=c;v<I.length;v+=1){var A=I[v];for(var R in A)a[R]=A[R]}return a}var G=1;function N(){return G++}function V(){return(function a(c){return c?(c^16*Math.random()>>c/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)})()}function W(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function j(a,c){a.forEach((function(f){c[f]&&(c[f]=c[f].bind(c))}))}function J(a,c){return a.indexOf(c,a.length-c.length)!==-1}function te(a,c,f){var v={};for(var I in a)v[I]=c.call(f||this,a[I],I,a);return v}function ce(a,c,f){var v={};for(var I in a)c.call(f||this,a[I],I,a)&&(v[I]=a[I]);return v}function pe(a){return Array.isArray(a)?a.map(pe):typeof a=="object"&&a?te(a,pe):a}var Y={};function he(a){Y[a]||(typeof console<"u"&&console.warn(a),Y[a]=!0)}function D(a,c,f){return(f.y-a.y)*(c.x-a.x)>(c.y-a.y)*(f.x-a.x)}function re(a){for(var c=0,f=0,v=a.length,I=v-1,A=void 0,R=void 0;f<v;I=f++)c+=((R=a[I]).x-(A=a[f]).x)*(A.y+R.y);return c}function le(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function fe(a){var c={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(v,I,A,R){var O=A||R;return c[I]=!O||O.toLowerCase(),""})),c["max-age"]){var f=parseInt(c["max-age"],10);isNaN(f)?delete c["max-age"]:c["max-age"]=f}return c}var Le=null;function we(a){if(Le==null){var c=a.navigator?a.navigator.userAgent:null;Le=!!a.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Le}function se(a){try{var c=y[a];return c.setItem("_mapbox_test_",1),c.removeItem("_mapbox_test_"),!0}catch{return!1}}var Q,q,$e,Qe,qe=y.performance&&y.performance.now?y.performance.now.bind(y.performance):Date.now.bind(Date),Lt=y.requestAnimationFrame||y.mozRequestAnimationFrame||y.webkitRequestAnimationFrame||y.msRequestAnimationFrame,Pt=y.cancelAnimationFrame||y.mozCancelAnimationFrame||y.webkitCancelAnimationFrame||y.msCancelAnimationFrame,zt={now:qe,frame:function(a){var c=Lt(a);return{cancel:function(){return Pt(c)}}},getImageData:function(a,c){c===void 0&&(c=0);var f=y.document.createElement("canvas"),v=f.getContext("2d");if(!v)throw new Error("failed to create canvas 2d context");return f.width=a.width,f.height=a.height,v.drawImage(a,0,0,a.width,a.height),v.getImageData(-c,-c,a.width+2*c,a.height+2*c)},resolveURL:function(a){return Q||(Q=y.document.createElement("a")),Q.href=a,Q.href},hardwareConcurrency:y.navigator&&y.navigator.hardwareConcurrency||4,get devicePixelRatio(){return y.devicePixelRatio},get prefersReducedMotion(){return!!y.matchMedia&&(q==null&&(q=y.matchMedia("(prefers-reduced-motion: reduce)")),q.matches)}},Dt={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},yn={supported:!1,testSupport:function(a){!tn&&Qe&&(Ne?Be(a):$e=a)}},tn=!1,Ne=!1;function Be(a){var c=a.createTexture();a.bindTexture(a.TEXTURE_2D,c);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Qe),a.isContextLost())return;yn.supported=!0}catch{}a.deleteTexture(c),tn=!0}y.document&&((Qe=y.document.createElement("img")).onload=function(){$e&&Be($e),$e=null,Ne=!0},Qe.onerror=function(){tn=!0,$e=null},Qe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var z="01",We=function(a,c){this._transformRequestFn=a,this._customAccessToken=c,this._createSkuToken()};function ke(a){return a.indexOf("mapbox:")===0}We.prototype._createSkuToken=function(){var a=(function(){for(var c="",f=0;f<10;f++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",z,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},We.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},We.prototype.transformRequest=function(a,c){return this._transformRequestFn&&this._transformRequestFn(a,c)||{url:a}},We.prototype.normalizeStyleURL=function(a,c){if(!ke(a))return a;var f=Te(a);return f.path="/styles/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||c)},We.prototype.normalizeGlyphsURL=function(a,c){if(!ke(a))return a;var f=Te(a);return f.path="/fonts/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||c)},We.prototype.normalizeSourceURL=function(a,c){if(!ke(a))return a;var f=Te(a);return f.path="/v4/"+f.authority+".json",f.params.push("secure"),this._makeAPIURL(f,this._customAccessToken||c)},We.prototype.normalizeSpriteURL=function(a,c,f,v){var I=Te(a);return ke(a)?(I.path="/styles/v1"+I.path+"/sprite"+c+f,this._makeAPIURL(I,this._customAccessToken||v)):(I.path+=""+c+f,De(I))},We.prototype.normalizeTileURL=function(a,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!ke(a))return a;var f=Te(a);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,(zt.devicePixelRatio>=2||c===512?"@2x":"")+(yn.supported?".webp":"$1")),f.path=f.path.replace(/^.+\/v4\//,"/"),f.path="/v4"+f.path;var v=this._customAccessToken||(function(I){for(var A=0,R=I;A<R.length;A+=1){var O=R[A].match(/^access_token=(.*)$/);if(O)return O[1]}return null})(f.params)||Dt.ACCESS_TOKEN;return Dt.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&f.params.push("sku="+this._skuToken),this._makeAPIURL(f,v)},We.prototype.canonicalizeTileURL=function(a,c){var f=Te(a);if(!f.path.match(/(^\/v4\/)/)||!f.path.match(/\.[\w]+$/))return a;var v="mapbox://tiles/";v+=f.path.replace("/v4/","");var I=f.params;return c&&(I=I.filter((function(A){return!A.match(/^access_token=/)}))),I.length&&(v+="?"+I.join("&")),v},We.prototype.canonicalizeTileset=function(a,c){for(var f=!!c&&ke(c),v=[],I=0,A=a.tiles||[];I<A.length;I+=1){var R=A[I];ie(R)?v.push(this.canonicalizeTileURL(R,f)):v.push(R)}return v},We.prototype._makeAPIURL=function(a,c){var f="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",v=Te(Dt.API_URL);if(a.protocol=v.protocol,a.authority=v.authority,a.protocol==="http"){var I=a.params.indexOf("secure");I>=0&&a.params.splice(I,1)}if(v.path!=="/"&&(a.path=""+v.path+a.path),!Dt.REQUIRE_ACCESS_TOKEN)return De(a);if(!(c=c||Dt.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+f);if(c[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+f);return a.params=a.params.filter((function(A){return A.indexOf("access_token")===-1})),a.params.push("access_token="+c),De(a)};var ge=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ie(a){return ge.test(a)}var Ce=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Te(a){var c=a.match(Ce);if(!c)throw new Error("Unable to parse URL object");return{protocol:c[1],authority:c[2],path:c[3]||"/",params:c[4]?c[4].split("&"):[]}}function De(a){var c=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+c}function Ze(a){if(!a)return null;var c=a.split(".");if(!c||c.length!==3)return null;try{return JSON.parse(decodeURIComponent(y.atob(c[1]).split("").map((function(f){return"%"+("00"+f.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch{return null}}var Je=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Je.prototype.getStorageKey=function(a){var c,f=Ze(Dt.ACCESS_TOKEN);return c=f&&f.u?y.btoa(encodeURIComponent(f.u).replace(/%([0-9A-F]{2})/g,(function(v,I){return String.fromCharCode(+("0x"+I))}))):Dt.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+c:"mapbox.eventData:"+c},Je.prototype.fetchEventData=function(){var a=se("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid");if(a)try{var v=y.localStorage.getItem(c);v&&(this.eventData=JSON.parse(v));var I=y.localStorage.getItem(f);I&&(this.anonId=I)}catch{he("Unable to read from LocalStorage")}},Je.prototype.saveEventData=function(){var a=se("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid");if(a)try{y.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&y.localStorage.setItem(c,JSON.stringify(this.eventData))}catch{he("Unable to write to LocalStorage")}},Je.prototype.processRequests=function(a){},Je.prototype.postEvent=function(a,c,f,v){var I=this;if(Dt.EVENTS_URL){var A=Te(Dt.EVENTS_URL);A.params.push("access_token="+(v||Dt.ACCESS_TOKEN||""));var R={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:z,userId:this.anonId},O=c?M(R,c):R,Z={url:De(A),headers:{"Content-Type":"text/plain"},body:JSON.stringify([O])};this.pendingRequest=Ai(Z,(function(X){I.pendingRequest=null,f(X),I.saveEventData(),I.processRequests(v)}))}},Je.prototype.queueRequest=function(a,c){this.queue.push(a),this.processRequests(c)};var dt,ft,Tt=(function(a){function c(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.postMapLoadEvent=function(f,v,I,A){this.skuToken=I;var R=!(!A&&!Dt.ACCESS_TOKEN),O=Array.isArray(f)&&f.some((function(Z){return ke(Z)||ie(Z)}));Dt.EVENTS_URL&&R&&O&&this.queueRequest({id:v,timestamp:Date.now()},A)},c.prototype.processRequests=function(f){var v=this;if(!this.pendingRequest&&this.queue.length!==0){var I=this.queue.shift(),A=I.id,R=I.timestamp;A&&this.success[A]||(this.anonId||this.fetchEventData(),W(this.anonId)||(this.anonId=V()),this.postEvent(R,{skuToken:this.skuToken},(function(O){O||A&&(v.success[A]=!0)}),f))}},c})(Je),hn=new((function(a){function c(f){a.call(this,"appUserTurnstile"),this._customAccessToken=f}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.postTurnstileEvent=function(f,v){Dt.EVENTS_URL&&Dt.ACCESS_TOKEN&&Array.isArray(f)&&f.some((function(I){return ke(I)||ie(I)}))&&this.queueRequest(Date.now(),v)},c.prototype.processRequests=function(f){var v=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var I=Ze(Dt.ACCESS_TOKEN),A=I?I.u:Dt.ACCESS_TOKEN,R=A!==this.eventData.tokenU;W(this.anonId)||(this.anonId=V(),R=!0);var O=this.queue.shift();if(this.eventData.lastSuccess){var Z=new Date(this.eventData.lastSuccess),X=new Date(O),$=(O-this.eventData.lastSuccess)/864e5;R=R||$>=1||$<-1||Z.getDate()!==X.getDate()}else R=!0;if(!R)return this.processRequests();this.postEvent(O,{"enabled.telemetry":!1},(function(ne){ne||(v.eventData.lastSuccess=O,v.eventData.tokenU=A)}),f)}},c})(Je)),cn=hn.postTurnstileEvent.bind(hn),vi=new Tt,Hi=vi.postMapLoadEvent.bind(vi),Li=500,Tr=50;function pi(){y.caches&&!dt&&(dt=y.caches.open("mapbox-tiles"))}function rs(a){var c=a.indexOf("?");return c<0?a:a.slice(0,c)}var wi,Ti=1/0;function Bs(){return wi==null&&(wi=y.OffscreenCanvas&&new y.OffscreenCanvas(1,1).getContext("2d")&&typeof y.createImageBitmap=="function"),wi}var xo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(xo);var Ea=(function(a){function c(f,v,I){v===401&&ie(I)&&(f+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,f),this.status=v,this.url=I,this.name=this.constructor.name,this.message=f}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},c})(Error),ms=le()?function(){return self.worker&&self.worker.referrer}:function(){return(y.location.protocol==="blob:"?y.parent:y).location.href},Wr,zr,ys=function(a,c){if(!(/^file:/.test(f=a.url)||/^file:/.test(ms())&&!/^\w+:/.test(f))){if(y.fetch&&y.Request&&y.AbortController&&y.Request.prototype.hasOwnProperty("signal"))return(function(v,I){var A,R=new y.AbortController,O=new y.Request(v.url,{method:v.method||"GET",body:v.body,credentials:v.credentials,headers:v.headers,referrer:ms(),signal:R.signal}),Z=!1,X=!1,$=(A=O.url).indexOf("sku=")>0&&ie(A);v.type==="json"&&O.headers.set("Accept","application/json");var ne=function(_e,Me,Pe){if(!X){if(_e&&_e.message!=="SecurityError"&&he(_e),Me&&Pe)return de(Me);var He=Date.now();y.fetch(O).then((function(Ve){if(Ve.ok){var et=$?Ve.clone():null;return de(Ve,et,He)}return I(new Ea(Ve.statusText,Ve.status,v.url))})).catch((function(Ve){Ve.code!==20&&I(new Error(Ve.message))}))}},de=function(_e,Me,Pe){(v.type==="arrayBuffer"?_e.arrayBuffer():v.type==="json"?_e.json():_e.text()).then((function(He){X||(Me&&Pe&&(function(Ve,et,it){if(pi(),dt){var rt={status:et.status,statusText:et.statusText,headers:new y.Headers};et.headers.forEach((function(yt,Rt){return rt.headers.set(Rt,yt)}));var lt=fe(et.headers.get("Cache-Control")||"");lt["no-store"]||(lt["max-age"]&&rt.headers.set("Expires",new Date(it+1e3*lt["max-age"]).toUTCString()),new Date(rt.headers.get("Expires")).getTime()-it<42e4||(function(yt,Rt){if(ft===void 0)try{new Response(new ReadableStream),ft=!0}catch{ft=!1}ft?Rt(yt.body):yt.blob().then(Rt)})(et,(function(yt){var Rt=new y.Response(yt,rt);pi(),dt&&dt.then((function(Zt){return Zt.put(rs(Ve.url),Rt)})).catch((function(Zt){return he(Zt.message)}))})))}})(O,Me,Pe),Z=!0,I(null,He,_e.headers.get("Cache-Control"),_e.headers.get("Expires")))})).catch((function(He){X||I(new Error(He.message))}))};return $?(function(_e,Me){if(pi(),!dt)return Me(null);var Pe=rs(_e.url);dt.then((function(He){He.match(Pe).then((function(Ve){var et=(function(it){if(!it)return!1;var rt=new Date(it.headers.get("Expires")||0),lt=fe(it.headers.get("Cache-Control")||"");return rt>Date.now()&&!lt["no-cache"]})(Ve);He.delete(Pe),et&&He.put(Pe,Ve.clone()),Me(null,Ve,et)})).catch(Me)})).catch(Me)})(O,ne):ne(null,null),{cancel:function(){X=!0,Z||R.abort()}}})(a,c);if(le()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,c,void 0,!0)}var f;return(function(v,I){var A=new y.XMLHttpRequest;for(var R in A.open(v.method||"GET",v.url,!0),v.type==="arrayBuffer"&&(A.responseType="arraybuffer"),v.headers)A.setRequestHeader(R,v.headers[R]);return v.type==="json"&&(A.responseType="text",A.setRequestHeader("Accept","application/json")),A.withCredentials=v.credentials==="include",A.onerror=function(){I(new Error(A.statusText))},A.onload=function(){if((A.status>=200&&A.status<300||A.status===0)&&A.response!==null){var O=A.response;if(v.type==="json")try{O=JSON.parse(A.response)}catch(Z){return I(Z)}I(null,O,A.getResponseHeader("Cache-Control"),A.getResponseHeader("Expires"))}else I(new Ea(A.statusText,A.status,v.url))},A.send(v.body),{cancel:function(){return A.abort()}}})(a,c)},Ml=function(a,c){return ys(M(a,{type:"arrayBuffer"}),c)},Ai=function(a,c){return ys(M(a,{method:"POST"}),c)},ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Wr=[],zr=0;var ue=function(a,c){if(yn.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),zr>=Dt.MAX_PARALLEL_IMAGE_REQUESTS){var f={requestParameters:a,callback:c,cancelled:!1,cancel:function(){this.cancelled=!0}};return Wr.push(f),f}zr++;var v=!1,I=function(){if(!v)for(v=!0,zr--;Wr.length&&zr<Dt.MAX_PARALLEL_IMAGE_REQUESTS;){var R=Wr.shift();R.cancelled||(R.cancel=ue(R.requestParameters,R.callback).cancel)}},A=Ml(a,(function(R,O,Z,X){I(),R?c(R):O&&(Bs()?(function($,ne){var de=new y.Blob([new Uint8Array($)],{type:"image/png"});y.createImageBitmap(de).then((function(_e){ne(null,_e)})).catch((function(_e){ne(new Error("Could not load image because of "+_e.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))})(O,c):(function($,ne,de,_e){var Me=new y.Image,Pe=y.URL;Me.onload=function(){ne(null,Me),Pe.revokeObjectURL(Me.src),Me.onload=null,y.requestAnimationFrame((function(){Me.src=ee}))},Me.onerror=function(){return ne(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var He=new y.Blob([new Uint8Array($)],{type:"image/png"});Me.cacheControl=de,Me.expires=_e,Me.src=$.byteLength?Pe.createObjectURL(He):ee})(O,c,Z,X))}));return{cancel:function(){A.cancel(),I()}}};function me(a,c,f){f[a]&&f[a].indexOf(c)!==-1||(f[a]=f[a]||[],f[a].push(c))}function xe(a,c,f){if(f&&f[a]){var v=f[a].indexOf(c);v!==-1&&f[a].splice(v,1)}}var Ae=function(a,c){c===void 0&&(c={}),M(this,c),this.type=a},Ye=(function(a){function c(f,v){v===void 0&&(v={}),a.call(this,"error",M({error:f},v))}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c})(Ae),ze=function(){};ze.prototype.on=function(a,c){return this._listeners=this._listeners||{},me(a,c,this._listeners),this},ze.prototype.off=function(a,c){return xe(a,c,this._listeners),xe(a,c,this._oneTimeListeners),this},ze.prototype.once=function(a,c){return this._oneTimeListeners=this._oneTimeListeners||{},me(a,c,this._oneTimeListeners),this},ze.prototype.fire=function(a,c){typeof a=="string"&&(a=new Ae(a,c||{}));var f=a.type;if(this.listens(f)){a.target=this;for(var v=0,I=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];v<I.length;v+=1)I[v].call(this,a);for(var A=0,R=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];A<R.length;A+=1){var O=R[A];xe(f,O,this._oneTimeListeners),O.call(this,a)}var Z=this._eventedParent;Z&&(M(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),Z.fire(a))}else a instanceof Ye&&console.error(a.error);return this},ze.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},ze.prototype.setEventedParent=function(a,c){return this._eventedParent=a,this._eventedParentData=c,this};var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Se=function(a,c,f,v){this.message=(a?a+": ":"")+f,v&&(this.identifier=v),c!=null&&c.__line__&&(this.line=c.__line__)};function tt(a){var c=a.value;return c?[new Se(a.key,c,"constants have been deprecated as of v8")]:[]}function bt(a){for(var c=[],f=arguments.length-1;f-- >0;)c[f]=arguments[f+1];for(var v=0,I=c;v<I.length;v+=1){var A=I[v];for(var R in A)a[R]=A[R]}return a}function St(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function ct(a){if(Array.isArray(a))return a.map(ct);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var c={};for(var f in a)c[f]=ct(a[f]);return c}return St(a)}var It=(function(a){function c(f,v){a.call(this,v),this.message=v,this.key=f}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c})(Error),qt=function(a,c){c===void 0&&(c=[]),this.parent=a,this.bindings={};for(var f=0,v=c;f<v.length;f+=1){var I=v[f];this.bindings[I[0]]=I[1]}};qt.prototype.concat=function(a){return new qt(this,a)},qt.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},qt.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var nn={kind:"null"},pt={kind:"number"},$t={kind:"string"},Ut={kind:"boolean"},Yt={kind:"color"},Ot={kind:"object"},Re={kind:"value"},_t={kind:"collator"},Kt={kind:"formatted"},mn={kind:"resolvedImage"};function Bn(a,c){return{kind:"array",itemType:a,N:c}}function En(a){if(a.kind==="array"){var c=En(a.itemType);return typeof a.N=="number"?"array<"+c+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+c+">"}return a.kind}var qi=[nn,pt,$t,Ut,Yt,Kt,Ot,Bn(Re),mn];function ai(a,c){if(c.kind==="error")return null;if(a.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!ai(a.itemType,c.itemType))&&(typeof a.N!="number"||a.N===c.N))return null}else{if(a.kind===c.kind)return null;if(a.kind==="value"){for(var f=0,v=qi;f<v.length;f+=1)if(!ai(v[f],c))return null}}return"Expected "+En(a)+" but found "+En(c)+" instead."}function ir(a,c){return c.some((function(f){return f.kind===a.kind}))}function Pi(a,c){return c.some((function(f){return f==="null"?a===null:f==="array"?Array.isArray(a):f==="object"?a&&!Array.isArray(a)&&typeof a=="object":f===typeof a}))}var Rn=l((function(a,c){var f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function v(O){return(O=Math.round(O))<0?0:O>255?255:O}function I(O){return v(O[O.length-1]==="%"?parseFloat(O)/100*255:parseInt(O))}function A(O){return(Z=O[O.length-1]==="%"?parseFloat(O)/100:parseFloat(O))<0?0:Z>1?1:Z;var Z}function R(O,Z,X){return X<0?X+=1:X>1&&(X-=1),6*X<1?O+(Z-O)*X*6:2*X<1?Z:3*X<2?O+(Z-O)*(2/3-X)*6:O}try{c.parseCSSColor=function(O){var Z,X=O.replace(/ /g,"").toLowerCase();if(X in f)return f[X].slice();if(X[0]==="#")return X.length===4?(Z=parseInt(X.substr(1),16))>=0&&Z<=4095?[(3840&Z)>>4|(3840&Z)>>8,240&Z|(240&Z)>>4,15&Z|(15&Z)<<4,1]:null:X.length===7&&(Z=parseInt(X.substr(1),16))>=0&&Z<=16777215?[(16711680&Z)>>16,(65280&Z)>>8,255&Z,1]:null;var $=X.indexOf("("),ne=X.indexOf(")");if($!==-1&&ne+1===X.length){var de=X.substr(0,$),_e=X.substr($+1,ne-($+1)).split(","),Me=1;switch(de){case"rgba":if(_e.length!==4)return null;Me=A(_e.pop());case"rgb":return _e.length!==3?null:[I(_e[0]),I(_e[1]),I(_e[2]),Me];case"hsla":if(_e.length!==4)return null;Me=A(_e.pop());case"hsl":if(_e.length!==3)return null;var Pe=(parseFloat(_e[0])%360+360)%360/360,He=A(_e[1]),Ve=A(_e[2]),et=Ve<=.5?Ve*(He+1):Ve+He-Ve*He,it=2*Ve-et;return[v(255*R(it,et,Pe+1/3)),v(255*R(it,et,Pe)),v(255*R(it,et,Pe-1/3)),Me];default:return null}}return null}}catch{}})).parseCSSColor,bi=function(a,c,f,v){v===void 0&&(v=1),this.r=a,this.g=c,this.b=f,this.a=v};bi.parse=function(a){if(a){if(a instanceof bi)return a;if(typeof a=="string"){var c=Rn(a);if(c)return new bi(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3])}}},bi.prototype.toString=function(){var a=this.toArray(),c=a[1],f=a[2],v=a[3];return"rgba("+Math.round(a[0])+","+Math.round(c)+","+Math.round(f)+","+v+")"},bi.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},bi.black=new bi(0,0,0,1),bi.white=new bi(1,1,1,1),bi.transparent=new bi(0,0,0,0),bi.red=new bi(1,0,0,1);var Zs=function(a,c,f){this.sensitivity=a?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Zs.prototype.compare=function(a,c){return this.collator.compare(a,c)},Zs.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Mf=function(a,c,f,v,I){this.text=a,this.image=c,this.scale=f,this.fontStack=v,this.textColor=I},Es=function(a){this.sections=a};Es.fromString=function(a){return new Es([new Mf(a,null,null,null,null)])},Es.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some((function(a){return a.text.length!==0||a.image&&a.image.name.length!==0}))},Es.factory=function(a){return a instanceof Es?a:Es.fromString(a)},Es.prototype.toString=function(){return this.sections.length===0?"":this.sections.map((function(a){return a.text})).join("")},Es.prototype.serialize=function(){for(var a=["format"],c=0,f=this.sections;c<f.length;c+=1){var v=f[c];if(v.image)a.push(["image",v.image.name]);else{a.push(v.text);var I={};v.fontStack&&(I["text-font"]=["literal",v.fontStack.split(",")]),v.scale&&(I["font-scale"]=v.scale),v.textColor&&(I["text-color"]=["rgba"].concat(v.textColor.toArray())),a.push(I)}}return a};var Io=function(a){this.name=a.name,this.available=a.available};function Jy(a,c,f,v){return typeof a=="number"&&a>=0&&a<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof f=="number"&&f>=0&&f<=255?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:"Invalid rgba value ["+[a,c,f,v].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof v=="number"?[a,c,f,v]:[a,c,f]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function kf(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof bi||a instanceof Zs||a instanceof Es||a instanceof Io)return!0;if(Array.isArray(a)){for(var c=0,f=a;c<f.length;c+=1)if(!kf(f[c]))return!1;return!0}if(typeof a=="object"){for(var v in a)if(!kf(a[v]))return!1;return!0}return!1}function Ur(a){if(a===null)return nn;if(typeof a=="string")return $t;if(typeof a=="boolean")return Ut;if(typeof a=="number")return pt;if(a instanceof bi)return Yt;if(a instanceof Zs)return _t;if(a instanceof Es)return Kt;if(a instanceof Io)return mn;if(Array.isArray(a)){for(var c,f=a.length,v=0,I=a;v<I.length;v+=1){var A=Ur(I[v]);if(c){if(c===A)continue;c=Re;break}c=A}return Bn(c||Re,f)}return Ot}function Lf(a){var c=typeof a;return a===null?"":c==="string"||c==="number"||c==="boolean"?String(a):a instanceof bi||a instanceof Es||a instanceof Io?a.toString():JSON.stringify(a)}Io.prototype.toString=function(){return this.name},Io.fromString=function(a){return a?new Io({name:a,available:!1}):null},Io.prototype.serialize=function(){return["image",this.name]};var oo=function(a,c){this.type=a,this.value=c};oo.parse=function(a,c){if(a.length!==2)return c.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!kf(a[1]))return c.error("invalid value");var f=a[1],v=Ur(f),I=c.expectedType;return v.kind!=="array"||v.N!==0||!I||I.kind!=="array"||typeof I.N=="number"&&I.N!==0||(v=I),new oo(v,f)},oo.prototype.evaluate=function(){return this.value},oo.prototype.eachChild=function(){},oo.prototype.outputDefined=function(){return!0},oo.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof bi?["rgba"].concat(this.value.toArray()):this.value instanceof Es?this.value.serialize():this.value};var Ts=function(a){this.name="ExpressionEvaluationError",this.message=a};Ts.prototype.toJSON=function(){return this.message};var Ta={string:$t,number:pt,boolean:Ut,object:Ot},xr=function(a,c){this.type=a,this.args=c};xr.parse=function(a,c){if(a.length<2)return c.error("Expected at least one argument.");var f,v=1,I=a[0];if(I==="array"){var A,R;if(a.length>2){var O=a[1];if(typeof O!="string"||!(O in Ta)||O==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);A=Ta[O],v++}else A=Re;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return c.error('The length argument to "array" must be a positive integer literal',2);R=a[2],v++}f=Bn(A,R)}else f=Ta[I];for(var Z=[];v<a.length;v++){var X=c.parse(a[v],v,Re);if(!X)return null;Z.push(X)}return new xr(f,Z)},xr.prototype.evaluate=function(a){for(var c=0;c<this.args.length;c++){var f=this.args[c].evaluate(a);if(!ai(this.type,Ur(f)))return f;if(c===this.args.length-1)throw new Ts("Expected value to be of type "+En(this.type)+", but found "+En(Ur(f))+" instead.")}return null},xr.prototype.eachChild=function(a){this.args.forEach(a)},xr.prototype.outputDefined=function(){return this.args.every((function(a){return a.outputDefined()}))},xr.prototype.serialize=function(){var a=this.type,c=[a.kind];if(a.kind==="array"){var f=a.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){c.push(f.kind);var v=a.N;(typeof v=="number"||this.args.length>1)&&c.push(v)}}return c.concat(this.args.map((function(I){return I.serialize()})))};var il=function(a){this.type=Kt,this.sections=a};il.parse=function(a,c){if(a.length<2)return c.error("Expected at least one argument.");var f=a[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");for(var v=[],I=!1,A=1;A<=a.length-1;++A){var R=a[A];if(I&&typeof R=="object"&&!Array.isArray(R)){I=!1;var O=null;if(R["font-scale"]&&!(O=c.parse(R["font-scale"],1,pt)))return null;var Z=null;if(R["text-font"]&&!(Z=c.parse(R["text-font"],1,Bn($t))))return null;var X=null;if(R["text-color"]&&!(X=c.parse(R["text-color"],1,Yt)))return null;var $=v[v.length-1];$.scale=O,$.font=Z,$.textColor=X}else{var ne=c.parse(a[A],1,Re);if(!ne)return null;var de=ne.type.kind;if(de!=="string"&&de!=="value"&&de!=="null"&&de!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");I=!0,v.push({content:ne,scale:null,font:null,textColor:null})}}return new il(v)},il.prototype.evaluate=function(a){return new Es(this.sections.map((function(c){var f=c.content.evaluate(a);return Ur(f)===mn?new Mf("",f,null,null,null):new Mf(Lf(f),null,c.scale?c.scale.evaluate(a):null,c.font?c.font.evaluate(a).join(","):null,c.textColor?c.textColor.evaluate(a):null)})))},il.prototype.eachChild=function(a){for(var c=0,f=this.sections;c<f.length;c+=1){var v=f[c];a(v.content),v.scale&&a(v.scale),v.font&&a(v.font),v.textColor&&a(v.textColor)}},il.prototype.outputDefined=function(){return!1},il.prototype.serialize=function(){for(var a=["format"],c=0,f=this.sections;c<f.length;c+=1){var v=f[c];a.push(v.content.serialize());var I={};v.scale&&(I["font-scale"]=v.scale.serialize()),v.font&&(I["text-font"]=v.font.serialize()),v.textColor&&(I["text-color"]=v.textColor.serialize()),a.push(I)}return a};var ca=function(a){this.type=mn,this.input=a};ca.parse=function(a,c){if(a.length!==2)return c.error("Expected two arguments.");var f=c.parse(a[1],1,$t);return f?new ca(f):c.error("No image name provided.")},ca.prototype.evaluate=function(a){var c=this.input.evaluate(a),f=Io.fromString(c);return f&&a.availableImages&&(f.available=a.availableImages.indexOf(c)>-1),f},ca.prototype.eachChild=function(a){a(this.input)},ca.prototype.outputDefined=function(){return!1},ca.prototype.serialize=function(){return["image",this.input.serialize()]};var Ob={"to-boolean":Ut,"to-color":Yt,"to-number":pt,"to-string":$t},Ra=function(a,c){this.type=a,this.args=c};Ra.parse=function(a,c){if(a.length<2)return c.error("Expected at least one argument.");var f=a[0];if((f==="to-boolean"||f==="to-string")&&a.length!==2)return c.error("Expected one argument.");for(var v=Ob[f],I=[],A=1;A<a.length;A++){var R=c.parse(a[A],A,Re);if(!R)return null;I.push(R)}return new Ra(v,I)},Ra.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var c,f,v=0,I=this.args;v<I.length;v+=1){if(f=null,(c=I[v].evaluate(a))instanceof bi)return c;if(typeof c=="string"){var A=a.parseColor(c);if(A)return A}else if(Array.isArray(c)&&!(f=c.length<3||c.length>4?"Invalid rbga value "+JSON.stringify(c)+": expected an array containing either three or four numeric values.":Jy(c[0],c[1],c[2],c[3])))return new bi(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Ts(f||"Could not parse color from value '"+(typeof c=="string"?c:String(JSON.stringify(c)))+"'")}if(this.type.kind==="number"){for(var R=null,O=0,Z=this.args;O<Z.length;O+=1){if((R=Z[O].evaluate(a))===null)return 0;var X=Number(R);if(!isNaN(X))return X}throw new Ts("Could not convert "+JSON.stringify(R)+" to number.")}return this.type.kind==="formatted"?Es.fromString(Lf(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Io.fromString(Lf(this.args[0].evaluate(a))):Lf(this.args[0].evaluate(a))},Ra.prototype.eachChild=function(a){this.args.forEach(a)},Ra.prototype.outputDefined=function(){return this.args.every((function(a){return a.outputDefined()}))},Ra.prototype.serialize=function(){if(this.type.kind==="formatted")return new il([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ca(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild((function(c){a.push(c.serialize())})),a};var yA=["Unknown","Point","LineString","Polygon"],iu=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};iu.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},iu.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?yA[this.feature.type]:this.feature.type:null},iu.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},iu.prototype.canonicalID=function(){return this.canonical},iu.prototype.properties=function(){return this.feature&&this.feature.properties||{}},iu.prototype.parseColor=function(a){var c=this._parseColorCache[a];return c||(c=this._parseColorCache[a]=bi.parse(a)),c};var Ws=function(a,c,f,v){this.name=a,this.type=c,this._evaluate=f,this.args=v};Ws.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Ws.prototype.eachChild=function(a){this.args.forEach(a)},Ws.prototype.outputDefined=function(){return!1},Ws.prototype.serialize=function(){return[this.name].concat(this.args.map((function(a){return a.serialize()})))},Ws.parse=function(a,c){var f,v=a[0],I=Ws.definitions[v];if(!I)return c.error('Unknown expression "'+v+'". If you wanted a literal array, use ["literal", [...]].',0);for(var A=Array.isArray(I)?I[0]:I.type,R=Array.isArray(I)?[[I[1],I[2]]]:I.overloads,O=R.filter((function(bn){var Qt=bn[0];return!Array.isArray(Qt)||Qt.length===a.length-1})),Z=null,X=0,$=O;X<$.length;X+=1){var ne=$[X],de=ne[0],_e=ne[1];Z=new Xu(c.registry,c.path,null,c.scope);for(var Me=[],Pe=!1,He=1;He<a.length;He++){var Ve=a[He],et=Array.isArray(de)?de[He-1]:de.type,it=Z.parse(Ve,1+Me.length,et);if(!it){Pe=!0;break}Me.push(it)}if(!Pe)if(Array.isArray(de)&&de.length!==Me.length)Z.error("Expected "+de.length+" arguments, but found "+Me.length+" instead.");else{for(var rt=0;rt<Me.length;rt++){var lt=Array.isArray(de)?de[rt]:de.type,yt=Me[rt];Z.concat(rt+1).checkSubtype(lt,yt.type)}if(Z.errors.length===0)return new Ws(v,A,_e,Me)}}if(O.length===1)(f=c.errors).push.apply(f,Z.errors);else{for(var Rt=(O.length?O:R).map((function(bn){var Qt;return Qt=bn[0],Array.isArray(Qt)?"("+Qt.map(En).join(", ")+")":"("+En(Qt.type)+"...)"})).join(" | "),Zt=[],gn=1;gn<a.length;gn++){var Jt=c.parse(a[gn],1+Zt.length);if(!Jt)return null;Zt.push(En(Jt.type))}c.error("Expected arguments of type "+Rt+", but found ("+Zt.join(", ")+") instead.")}return null},Ws.register=function(a,c){for(var f in Ws.definitions=c,c)a[f]=Ws};var kl=function(a,c,f){this.type=_t,this.locale=f,this.caseSensitive=a,this.diacriticSensitive=c};function ao(a,c){a[0]=Math.min(a[0],c[0]),a[1]=Math.min(a[1],c[1]),a[2]=Math.max(a[2],c[0]),a[3]=Math.max(a[3],c[1])}function zc(a,c){return!(a[0]<=c[0]||a[2]>=c[2]||a[1]<=c[1]||a[3]>=c[3])}function _A(a,c){var f=(180+a[0])/360,v=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,I=Math.pow(2,c.z);return[Math.round(f*I*8192),Math.round(v*I*8192)]}function vA(a,c,f){return c[1]>a[1]!=f[1]>a[1]&&a[0]<(f[0]-c[0])*(a[1]-c[1])/(f[1]-c[1])+c[0]}function qy(a,c){for(var f,v,I,A,R,O,Z,X=!1,$=0,ne=c.length;$<ne;$++)for(var de=c[$],_e=0,Me=de.length;_e<Me-1;_e++){if((A=(f=a)[0]-(v=de[_e])[0])*(Z=f[1]-(I=de[_e+1])[1])-(O=f[0]-I[0])*(R=f[1]-v[1])==0&&A*O<=0&&R*Z<=0)return!1;vA(a,de[_e],de[_e+1])&&(X=!X)}return X}function bA(a,c){for(var f=0;f<c.length;f++)if(qy(a,c[f]))return!0;return!1}function Nb(a,c,f,v){var I=v[0]-f[0],A=v[1]-f[1],R=(a[0]-f[0])*A-I*(a[1]-f[1]),O=(c[0]-f[0])*A-I*(c[1]-f[1]);return R>0&&O<0||R<0&&O>0}function xA(a,c,f){for(var v=0,I=f;v<I.length;v+=1)for(var A=I[v],R=0;R<A.length-1;++R)if((ne=[($=A[R+1])[0]-(X=A[R])[0],$[1]-X[1]])[0]*(de=[(Z=c)[0]-(O=a)[0],Z[1]-O[1]])[1]-ne[1]*de[0]!=0&&Nb(O,Z,X,$)&&Nb(X,$,O,Z))return!0;var O,Z,X,$,ne,de;return!1}function Db(a,c){for(var f=0;f<a.length;++f)if(!qy(a[f],c))return!1;for(var v=0;v<a.length-1;++v)if(xA(a[v],a[v+1],c))return!1;return!0}function Vb(a,c){for(var f=0;f<c.length;f++)if(Db(a,c[f]))return!0;return!1}function cd(a,c,f){for(var v=[],I=0;I<a.length;I++){for(var A=[],R=0;R<a[I].length;R++){var O=_A(a[I][R],f);ao(c,O),A.push(O)}v.push(A)}return v}function Qy(a,c,f){for(var v=[],I=0;I<a.length;I++){var A=cd(a[I],c,f);v.push(A)}return v}function Pf(a,c,f,v){if(a[0]<f[0]||a[0]>f[2]){var I=.5*v,A=a[0]-f[0]>I?-v:f[0]-a[0]>I?v:0;A===0&&(A=a[0]-f[2]>I?-v:f[2]-a[0]>I?v:0),a[0]+=A}ao(c,a)}function Bb(a,c,f,v){for(var I=8192*Math.pow(2,v.z),A=[8192*v.x,8192*v.y],R=[],O=0,Z=a;O<Z.length;O+=1)for(var X=0,$=Z[O];X<$.length;X+=1){var ne=$[X],de=[ne.x+A[0],ne.y+A[1]];Pf(de,c,f,I),R.push(de)}return R}function gg(a,c,f,v){for(var I,A=8192*Math.pow(2,v.z),R=[8192*v.x,8192*v.y],O=[],Z=0,X=a;Z<X.length;Z+=1){for(var $=[],ne=0,de=X[Z];ne<de.length;ne+=1){var _e=de[ne],Me=[_e.x+R[0],_e.y+R[1]];ao(c,Me),$.push(Me)}O.push($)}if(c[2]-c[0]<=A/2){(I=c)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(var Pe=0,He=O;Pe<He.length;Pe+=1)for(var Ve=0,et=He[Pe];Ve<et.length;Ve+=1)Pf(et[Ve],c,f,A)}return O}kl.parse=function(a,c){if(a.length!==2)return c.error("Expected one argument.");var f=a[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");var v=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Ut);if(!v)return null;var I=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Ut);if(!I)return null;var A=null;return f.locale&&!(A=c.parse(f.locale,1,$t))?null:new kl(v,I,A)},kl.prototype.evaluate=function(a){return new Zs(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},kl.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},kl.prototype.outputDefined=function(){return!1},kl.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Ma=function(a,c){this.type=Ut,this.geojson=a,this.geometries=c};function Wu(a){if(a instanceof Ws&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ma)return!1;var c=!0;return a.eachChild((function(f){c&&!Wu(f)&&(c=!1)})),c}function zu(a){if(a instanceof Ws&&a.name==="feature-state")return!1;var c=!0;return a.eachChild((function(f){c&&!zu(f)&&(c=!1)})),c}function Uc(a,c){if(a instanceof Ws&&c.indexOf(a.name)>=0)return!1;var f=!0;return a.eachChild((function(v){f&&!Uc(v,c)&&(f=!1)})),f}Ma.parse=function(a,c){if(a.length!==2)return c.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(kf(a[1])){var f=a[1];if(f.type==="FeatureCollection")for(var v=0;v<f.features.length;++v){var I=f.features[v].geometry.type;if(I==="Polygon"||I==="MultiPolygon")return new Ma(f,f.features[v].geometry)}else if(f.type==="Feature"){var A=f.geometry.type;if(A==="Polygon"||A==="MultiPolygon")return new Ma(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Ma(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ma.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(c,f){var v=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],A=c.canonicalID();if(f.type==="Polygon"){var R=cd(f.coordinates,I,A),O=Bb(c.geometry(),v,I,A);if(!zc(v,I))return!1;for(var Z=0,X=O;Z<X.length;Z+=1)if(!qy(X[Z],R))return!1}if(f.type==="MultiPolygon"){var $=Qy(f.coordinates,I,A),ne=Bb(c.geometry(),v,I,A);if(!zc(v,I))return!1;for(var de=0,_e=ne;de<_e.length;de+=1)if(!bA(_e[de],$))return!1}return!0})(a,this.geometries);if(a.geometryType()==="LineString")return(function(c,f){var v=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],A=c.canonicalID();if(f.type==="Polygon"){var R=cd(f.coordinates,I,A),O=gg(c.geometry(),v,I,A);if(!zc(v,I))return!1;for(var Z=0,X=O;Z<X.length;Z+=1)if(!Db(X[Z],R))return!1}if(f.type==="MultiPolygon"){var $=Qy(f.coordinates,I,A),ne=gg(c.geometry(),v,I,A);if(!zc(v,I))return!1;for(var de=0,_e=ne;de<_e.length;de+=1)if(!Vb(_e[de],$))return!1}return!0})(a,this.geometries)}return!1},Ma.prototype.eachChild=function(){},Ma.prototype.outputDefined=function(){return!0},Ma.prototype.serialize=function(){return["within",this.geojson]};var Uu=function(a,c){this.type=c.type,this.name=a,this.boundExpression=c};Uu.parse=function(a,c){if(a.length!==2||typeof a[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");var f=a[1];return c.scope.has(f)?new Uu(f,c.scope.get(f)):c.error('Unknown variable "'+f+'". Make sure "'+f+'" has been bound in an enclosing "let" expression before using it.',1)},Uu.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},Uu.prototype.eachChild=function(){},Uu.prototype.outputDefined=function(){return!1},Uu.prototype.serialize=function(){return["var",this.name]};var Xu=function(a,c,f,v,I){c===void 0&&(c=[]),v===void 0&&(v=new qt),I===void 0&&(I=[]),this.registry=a,this.path=c,this.key=c.map((function(A){return"["+A+"]"})).join(""),this.scope=v,this.errors=I,this.expectedType=f};function mg(a,c){for(var f,v=a.length-1,I=0,A=v,R=0;I<=A;)if((f=a[R=Math.floor((I+A)/2)])<=c){if(R===v||c<a[R+1])return R;I=R+1}else{if(!(f>c))throw new Ts("Input is not a number.");A=R-1}return 0}Xu.prototype.parse=function(a,c,f,v,I){return I===void 0&&(I={}),c?this.concat(c,f,v)._parse(a,I):this._parse(a,I)},Xu.prototype._parse=function(a,c){function f(X,$,ne){return ne==="assert"?new xr($,[X]):ne==="coerce"?new Ra($,[X]):X}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var v=a[0];if(typeof v!="string")return this.error("Expression name must be a string, but found "+typeof v+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var I=this.registry[v];if(I){var A=I.parse(a,this);if(!A)return null;if(this.expectedType){var R=this.expectedType,O=A.type;if(R.kind!=="string"&&R.kind!=="number"&&R.kind!=="boolean"&&R.kind!=="object"&&R.kind!=="array"||O.kind!=="value")if(R.kind!=="color"&&R.kind!=="formatted"&&R.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string"){if(this.checkSubtype(R,O))return null}else A=f(A,R,c.typeAnnotation||"coerce");else A=f(A,R,c.typeAnnotation||"assert")}if(!(A instanceof oo)&&A.type.kind!=="resolvedImage"&&(function X($){if($ instanceof Uu)return X($.boundExpression);if($ instanceof Ws&&$.name==="error"||$ instanceof kl||$ instanceof Ma)return!1;var ne=$ instanceof Ra||$ instanceof xr,de=!0;return $.eachChild((function(_e){de=ne?de&&X(_e):de&&_e instanceof oo})),!!de&&Wu($)&&Uc($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])})(A)){var Z=new iu;try{A=new oo(A.type,A.evaluate(Z))}catch(X){return this.error(X.message),null}}return A}return this.error('Unknown expression "'+v+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},Xu.prototype.concat=function(a,c,f){var v=typeof a=="number"?this.path.concat(a):this.path,I=f?this.scope.concat(f):this.scope;return new Xu(this.registry,v,c||null,I,this.errors)},Xu.prototype.error=function(a){for(var c=[],f=arguments.length-1;f-- >0;)c[f]=arguments[f+1];var v=""+this.key+c.map((function(I){return"["+I+"]"})).join("");this.errors.push(new It(v,a))},Xu.prototype.checkSubtype=function(a,c){var f=ai(a,c);return f&&this.error(f),f};var Oo=function(a,c,f){this.type=a,this.input=c,this.labels=[],this.outputs=[];for(var v=0,I=f;v<I.length;v+=1){var A=I[v],R=A[1];this.labels.push(A[0]),this.outputs.push(R)}};function qr(a,c,f){return a*(1-f)+c*f}Oo.parse=function(a,c){if(a.length-1<4)return c.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return c.error("Expected an even number of arguments.");var f=c.parse(a[1],1,pt);if(!f)return null;var v=[],I=null;c.expectedType&&c.expectedType.kind!=="value"&&(I=c.expectedType);for(var A=1;A<a.length;A+=2){var R=A===1?-1/0:a[A],O=a[A+1],Z=A,X=A+1;if(typeof R!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(v.length&&v[v.length-1][0]>=R)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Z);var $=c.parse(O,X,I);if(!$)return null;I=I||$.type,v.push([R,$])}return new Oo(I,f,v)},Oo.prototype.evaluate=function(a){var c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(a);var v=this.input.evaluate(a);if(v<=c[0])return f[0].evaluate(a);var I=c.length;return v>=c[I-1]?f[I-1].evaluate(a):f[mg(c,v)].evaluate(a)},Oo.prototype.eachChild=function(a){a(this.input);for(var c=0,f=this.outputs;c<f.length;c+=1)a(f[c])},Oo.prototype.outputDefined=function(){return this.outputs.every((function(a){return a.outputDefined()}))},Oo.prototype.serialize=function(){for(var a=["step",this.input.serialize()],c=0;c<this.labels.length;c++)c>0&&a.push(this.labels[c]),a.push(this.outputs[c].serialize());return a};var hd=Object.freeze({__proto__:null,number:qr,color:function(a,c,f){return new bi(qr(a.r,c.r,f),qr(a.g,c.g,f),qr(a.b,c.b,f),qr(a.a,c.a,f))},array:function(a,c,f){return a.map((function(v,I){return qr(v,c[I],f)}))}}),Zb=6/29*3*(6/29),IA=Math.PI/180,CA=180/Math.PI;function e_(a){return a>.008856451679035631?Math.pow(a,1/3):a/Zb+4/29}function t_(a){return a>6/29?a*a*a:Zb*(a-4/29)}function n_(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function i_(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Wb(a){var c=i_(a.r),f=i_(a.g),v=i_(a.b),I=e_((.4124564*c+.3575761*f+.1804375*v)/.95047),A=e_((.2126729*c+.7151522*f+.072175*v)/1);return{l:116*A-16,a:500*(I-A),b:200*(A-e_((.0193339*c+.119192*f+.9503041*v)/1.08883)),alpha:a.a}}function zb(a){var c=(a.l+16)/116,f=isNaN(a.a)?c:c+a.a/500,v=isNaN(a.b)?c:c-a.b/200;return c=1*t_(c),f=.95047*t_(f),v=1.08883*t_(v),new bi(n_(3.2404542*f-1.5371385*c-.4985314*v),n_(-.969266*f+1.8760108*c+.041556*v),n_(.0556434*f-.2040259*c+1.0572252*v),a.alpha)}function wA(a,c,f){var v=c-a;return a+f*(v>180||v<-180?v-360*Math.round(v/360):v)}var Gf={forward:Wb,reverse:zb,interpolate:function(a,c,f){return{l:qr(a.l,c.l,f),a:qr(a.a,c.a,f),b:qr(a.b,c.b,f),alpha:qr(a.alpha,c.alpha,f)}}},Ff={forward:function(a){var c=Wb(a),f=c.l,v=c.a,I=c.b,A=Math.atan2(I,v)*CA;return{h:A<0?A+360:A,c:Math.sqrt(v*v+I*I),l:f,alpha:a.a}},reverse:function(a){var c=a.h*IA,f=a.c;return zb({l:a.l,a:Math.cos(c)*f,b:Math.sin(c)*f,alpha:a.alpha})},interpolate:function(a,c,f){return{h:wA(a.h,c.h,f),c:qr(a.c,c.c,f),l:qr(a.l,c.l,f),alpha:qr(a.alpha,c.alpha,f)}}},Ub=Object.freeze({__proto__:null,lab:Gf,hcl:Ff}),zs=function(a,c,f,v,I){this.type=a,this.operator=c,this.interpolation=f,this.input=v,this.labels=[],this.outputs=[];for(var A=0,R=I;A<R.length;A+=1){var O=R[A],Z=O[1];this.labels.push(O[0]),this.outputs.push(Z)}};function r_(a,c,f,v){var I=v-f,A=a-f;return I===0?0:c===1?A/I:(Math.pow(c,A)-1)/(Math.pow(c,I)-1)}zs.interpolationFactor=function(a,c,f,v){var I=0;if(a.name==="exponential")I=r_(c,a.base,f,v);else if(a.name==="linear")I=r_(c,1,f,v);else if(a.name==="cubic-bezier"){var A=a.controlPoints;I=new u(A[0],A[1],A[2],A[3]).solve(r_(c,1,f,v))}return I},zs.parse=function(a,c){var f=a[0],v=a[1],I=a[2],A=a.slice(3);if(!Array.isArray(v)||v.length===0)return c.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){var R=v[1];if(typeof R!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:R}}else{if(v[0]!=="cubic-bezier")return c.error("Unknown interpolation type "+String(v[0]),1,0);var O=v.slice(1);if(O.length!==4||O.some((function(He){return typeof He!="number"||He<0||He>1})))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:O}}if(a.length-1<4)return c.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(!(I=c.parse(I,2,pt)))return null;var Z=[],X=null;f==="interpolate-hcl"||f==="interpolate-lab"?X=Yt:c.expectedType&&c.expectedType.kind!=="value"&&(X=c.expectedType);for(var $=0;$<A.length;$+=2){var ne=A[$],de=A[$+1],_e=$+3,Me=$+4;if(typeof ne!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_e);if(Z.length&&Z[Z.length-1][0]>=ne)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',_e);var Pe=c.parse(de,Me,X);if(!Pe)return null;X=X||Pe.type,Z.push([ne,Pe])}return X.kind==="number"||X.kind==="color"||X.kind==="array"&&X.itemType.kind==="number"&&typeof X.N=="number"?new zs(X,f,v,I,Z):c.error("Type "+En(X)+" is not interpolatable.")},zs.prototype.evaluate=function(a){var c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(a);var v=this.input.evaluate(a);if(v<=c[0])return f[0].evaluate(a);var I=c.length;if(v>=c[I-1])return f[I-1].evaluate(a);var A=mg(c,v),R=zs.interpolationFactor(this.interpolation,v,c[A],c[A+1]),O=f[A].evaluate(a),Z=f[A+1].evaluate(a);return this.operator==="interpolate"?hd[this.type.kind.toLowerCase()](O,Z,R):this.operator==="interpolate-hcl"?Ff.reverse(Ff.interpolate(Ff.forward(O),Ff.forward(Z),R)):Gf.reverse(Gf.interpolate(Gf.forward(O),Gf.forward(Z),R))},zs.prototype.eachChild=function(a){a(this.input);for(var c=0,f=this.outputs;c<f.length;c+=1)a(f[c])},zs.prototype.outputDefined=function(){return this.outputs.every((function(a){return a.outputDefined()}))},zs.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var c=[this.operator,a,this.input.serialize()],f=0;f<this.labels.length;f++)c.push(this.labels[f],this.outputs[f].serialize());return c};var Yu=function(a,c){this.type=a,this.args=c};Yu.parse=function(a,c){if(a.length<2)return c.error("Expectected at least one argument.");var f=null,v=c.expectedType;v&&v.kind!=="value"&&(f=v);for(var I=[],A=0,R=a.slice(1);A<R.length;A+=1){var O=c.parse(R[A],1+I.length,f,void 0,{typeAnnotation:"omit"});if(!O)return null;f=f||O.type,I.push(O)}var Z=v&&I.some((function(X){return ai(v,X.type)}));return new Yu(Z?Re:f,I)},Yu.prototype.evaluate=function(a){for(var c,f=null,v=0,I=0,A=this.args;I<A.length&&(v++,(f=A[I].evaluate(a))&&f instanceof Io&&!f.available&&(c||(c=f.name),f=null,v===this.args.length&&(f=c)),f===null);I+=1);return f},Yu.prototype.eachChild=function(a){this.args.forEach(a)},Yu.prototype.outputDefined=function(){return this.args.every((function(a){return a.outputDefined()}))},Yu.prototype.serialize=function(){var a=["coalesce"];return this.eachChild((function(c){a.push(c.serialize())})),a};var Hu=function(a,c){this.type=c.type,this.bindings=[].concat(a),this.result=c};Hu.prototype.evaluate=function(a){return this.result.evaluate(a)},Hu.prototype.eachChild=function(a){for(var c=0,f=this.bindings;c<f.length;c+=1)a(f[c][1]);a(this.result)},Hu.parse=function(a,c){if(a.length<4)return c.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var f=[],v=1;v<a.length-1;v+=2){var I=a[v];if(typeof I!="string")return c.error("Expected string, but found "+typeof I+" instead.",v);if(/[^a-zA-Z0-9_]/.test(I))return c.error("Variable names must contain only alphanumeric characters or '_'.",v);var A=c.parse(a[v+1],v+1);if(!A)return null;f.push([I,A])}var R=c.parse(a[a.length-1],a.length-1,c.expectedType,f);return R?new Hu(f,R):null},Hu.prototype.outputDefined=function(){return this.result.outputDefined()},Hu.prototype.serialize=function(){for(var a=["let"],c=0,f=this.bindings;c<f.length;c+=1){var v=f[c];a.push(v[0],v[1].serialize())}return a.push(this.result.serialize()),a};var Xc=function(a,c,f){this.type=a,this.index=c,this.input=f};Xc.parse=function(a,c){if(a.length!==3)return c.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var f=c.parse(a[1],1,pt),v=c.parse(a[2],2,Bn(c.expectedType||Re));return f&&v?new Xc(v.type.itemType,f,v):null},Xc.prototype.evaluate=function(a){var c=this.index.evaluate(a),f=this.input.evaluate(a);if(c<0)throw new Ts("Array index out of bounds: "+c+" < 0.");if(c>=f.length)throw new Ts("Array index out of bounds: "+c+" > "+(f.length-1)+".");if(c!==Math.floor(c))throw new Ts("Array index must be an integer, but found "+c+" instead.");return f[c]},Xc.prototype.eachChild=function(a){a(this.index),a(this.input)},Xc.prototype.outputDefined=function(){return!1},Xc.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Yc=function(a,c){this.type=Ut,this.needle=a,this.haystack=c};Yc.parse=function(a,c){if(a.length!==3)return c.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var f=c.parse(a[1],1,Re),v=c.parse(a[2],2,Re);return f&&v?ir(f.type,[Ut,$t,pt,nn,Re])?new Yc(f,v):c.error("Expected first argument to be of type boolean, string, number or null, but found "+En(f.type)+" instead"):null},Yc.prototype.evaluate=function(a){var c=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!f)return!1;if(!Pi(c,["boolean","string","number","null"]))throw new Ts("Expected first argument to be of type boolean, string, number or null, but found "+En(Ur(c))+" instead.");if(!Pi(f,["string","array"]))throw new Ts("Expected second argument to be of type array or string, but found "+En(Ur(f))+" instead.");return f.indexOf(c)>=0},Yc.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Yc.prototype.outputDefined=function(){return!0},Yc.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Ku=function(a,c,f){this.type=pt,this.needle=a,this.haystack=c,this.fromIndex=f};Ku.parse=function(a,c){if(a.length<=2||a.length>=5)return c.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var f=c.parse(a[1],1,Re),v=c.parse(a[2],2,Re);if(!f||!v)return null;if(!ir(f.type,[Ut,$t,pt,nn,Re]))return c.error("Expected first argument to be of type boolean, string, number or null, but found "+En(f.type)+" instead");if(a.length===4){var I=c.parse(a[3],3,pt);return I?new Ku(f,v,I):null}return new Ku(f,v)},Ku.prototype.evaluate=function(a){var c=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!Pi(c,["boolean","string","number","null"]))throw new Ts("Expected first argument to be of type boolean, string, number or null, but found "+En(Ur(c))+" instead.");if(!Pi(f,["string","array"]))throw new Ts("Expected second argument to be of type array or string, but found "+En(Ur(f))+" instead.");if(this.fromIndex){var v=this.fromIndex.evaluate(a);return f.indexOf(c,v)}return f.indexOf(c)},Ku.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},Ku.prototype.outputDefined=function(){return!1},Ku.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Hc=function(a,c,f,v,I,A){this.inputType=a,this.type=c,this.input=f,this.cases=v,this.outputs=I,this.otherwise=A};Hc.parse=function(a,c){if(a.length<5)return c.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return c.error("Expected an even number of arguments.");var f,v;c.expectedType&&c.expectedType.kind!=="value"&&(v=c.expectedType);for(var I={},A=[],R=2;R<a.length-1;R+=2){var O=a[R],Z=a[R+1];Array.isArray(O)||(O=[O]);var X=c.concat(R);if(O.length===0)return X.error("Expected at least one branch label.");for(var $=0,ne=O;$<ne.length;$+=1){var de=ne[$];if(typeof de!="number"&&typeof de!="string")return X.error("Branch labels must be numbers or strings.");if(typeof de=="number"&&Math.abs(de)>Number.MAX_SAFE_INTEGER)return X.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof de=="number"&&Math.floor(de)!==de)return X.error("Numeric branch labels must be integer values.");if(f){if(X.checkSubtype(f,Ur(de)))return null}else f=Ur(de);if(I[String(de)]!==void 0)return X.error("Branch labels must be unique.");I[String(de)]=A.length}var _e=c.parse(Z,R,v);if(!_e)return null;v=v||_e.type,A.push(_e)}var Me=c.parse(a[1],1,Re);if(!Me)return null;var Pe=c.parse(a[a.length-1],a.length-1,v);return Pe?Me.type.kind!=="value"&&c.concat(1).checkSubtype(f,Me.type)?null:new Hc(f,v,Me,I,A,Pe):null},Hc.prototype.evaluate=function(a){var c=this.input.evaluate(a);return(Ur(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(a)},Hc.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Hc.prototype.outputDefined=function(){return this.outputs.every((function(a){return a.outputDefined()}))&&this.otherwise.outputDefined()},Hc.prototype.serialize=function(){for(var a=this,c=["match",this.input.serialize()],f=[],v={},I=0,A=Object.keys(this.cases).sort();I<A.length;I+=1){var R=A[I];(ne=v[this.cases[R]])===void 0?(v[this.cases[R]]=f.length,f.push([this.cases[R],[R]])):f[ne][1].push(R)}for(var O=function(_e){return a.inputType.kind==="number"?Number(_e):_e},Z=0,X=f;Z<X.length;Z+=1){var $=X[Z],ne=$[0],de=$[1];c.push(de.length===1?O(de[0]):de.map(O)),c.push(this.outputs[outputIndex$1].serialize())}return c.push(this.otherwise.serialize()),c};var Kc=function(a,c,f){this.type=a,this.branches=c,this.otherwise=f};Kc.parse=function(a,c){if(a.length<4)return c.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return c.error("Expected an odd number of arguments.");var f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);for(var v=[],I=1;I<a.length-1;I+=2){var A=c.parse(a[I],I,Ut);if(!A)return null;var R=c.parse(a[I+1],I+1,f);if(!R)return null;v.push([A,R]),f=f||R.type}var O=c.parse(a[a.length-1],a.length-1,f);return O?new Kc(f,v,O):null},Kc.prototype.evaluate=function(a){for(var c=0,f=this.branches;c<f.length;c+=1){var v=f[c],I=v[1];if(v[0].evaluate(a))return I.evaluate(a)}return this.otherwise.evaluate(a)},Kc.prototype.eachChild=function(a){for(var c=0,f=this.branches;c<f.length;c+=1){var v=f[c],I=v[1];a(v[0]),a(I)}a(this.otherwise)},Kc.prototype.outputDefined=function(){return this.branches.every((function(a){return a[1].outputDefined()}))&&this.otherwise.outputDefined()},Kc.prototype.serialize=function(){var a=["case"];return this.eachChild((function(c){a.push(c.serialize())})),a};var ju=function(a,c,f,v){this.type=a,this.input=c,this.beginIndex=f,this.endIndex=v};function Xb(a,c){return a==="=="||a==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function Yb(a,c,f,v){return v.compare(c,f)===0}function Qi(a,c,f){var v=a!=="=="&&a!=="!=";return(function(){function I(A,R,O){this.type=Ut,this.lhs=A,this.rhs=R,this.collator=O,this.hasUntypedArgument=A.type.kind==="value"||R.type.kind==="value"}return I.parse=function(A,R){if(A.length!==3&&A.length!==4)return R.error("Expected two or three arguments.");var O=A[0],Z=R.parse(A[1],1,Re);if(!Z)return null;if(!Xb(O,Z.type))return R.concat(1).error('"'+O+`" comparisons are not supported for type '`+En(Z.type)+"'.");var X=R.parse(A[2],2,Re);if(!X)return null;if(!Xb(O,X.type))return R.concat(2).error('"'+O+`" comparisons are not supported for type '`+En(X.type)+"'.");if(Z.type.kind!==X.type.kind&&Z.type.kind!=="value"&&X.type.kind!=="value")return R.error("Cannot compare types '"+En(Z.type)+"' and '"+En(X.type)+"'.");v&&(Z.type.kind==="value"&&X.type.kind!=="value"?Z=new xr(X.type,[Z]):Z.type.kind!=="value"&&X.type.kind==="value"&&(X=new xr(Z.type,[X])));var $=null;if(A.length===4){if(Z.type.kind!=="string"&&X.type.kind!=="string"&&Z.type.kind!=="value"&&X.type.kind!=="value")return R.error("Cannot use collator to compare non-string types.");if(!($=R.parse(A[3],3,_t)))return null}return new I(Z,X,$)},I.prototype.evaluate=function(A){var R=this.lhs.evaluate(A),O=this.rhs.evaluate(A);if(v&&this.hasUntypedArgument){var Z=Ur(R),X=Ur(O);if(Z.kind!==X.kind||Z.kind!=="string"&&Z.kind!=="number")throw new Ts('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+Z.kind+", "+X.kind+") instead.")}if(this.collator&&!v&&this.hasUntypedArgument){var $=Ur(R),ne=Ur(O);if($.kind!=="string"||ne.kind!=="string")return c(A,R,O)}return this.collator?f(A,R,O,this.collator.evaluate(A)):c(A,R,O)},I.prototype.eachChild=function(A){A(this.lhs),A(this.rhs),this.collator&&A(this.collator)},I.prototype.outputDefined=function(){return!0},I.prototype.serialize=function(){var A=[a];return this.eachChild((function(R){A.push(R.serialize())})),A},I})()}ju.parse=function(a,c){if(a.length<=2||a.length>=5)return c.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var f=c.parse(a[1],1,Re),v=c.parse(a[2],2,pt);if(!f||!v)return null;if(!ir(f.type,[Bn(Re),$t,Re]))return c.error("Expected first argument to be of type array or string, but found "+En(f.type)+" instead");if(a.length===4){var I=c.parse(a[3],3,pt);return I?new ju(f.type,f,v,I):null}return new ju(f.type,f,v)},ju.prototype.evaluate=function(a){var c=this.input.evaluate(a),f=this.beginIndex.evaluate(a);if(!Pi(c,["string","array"]))throw new Ts("Expected first argument to be of type array or string, but found "+En(Ur(c))+" instead.");if(this.endIndex){var v=this.endIndex.evaluate(a);return c.slice(f,v)}return c.slice(f)},ju.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},ju.prototype.outputDefined=function(){return!1},ju.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var AA=Qi("==",(function(a,c,f){return c===f}),Yb),yg=Qi("!=",(function(a,c,f){return c!==f}),(function(a,c,f,v){return!Yb(0,c,f,v)})),Hb=Qi("<",(function(a,c,f){return c<f}),(function(a,c,f,v){return v.compare(c,f)<0})),Kb=Qi(">",(function(a,c,f){return c>f}),(function(a,c,f,v){return v.compare(c,f)>0})),jb=Qi("<=",(function(a,c,f){return c<=f}),(function(a,c,f,v){return v.compare(c,f)<=0})),$b=Qi(">=",(function(a,c,f){return c>=f}),(function(a,c,f,v){return v.compare(c,f)>=0})),jc=function(a,c,f,v,I){this.type=$t,this.number=a,this.locale=c,this.currency=f,this.minFractionDigits=v,this.maxFractionDigits=I};jc.parse=function(a,c){if(a.length!==3)return c.error("Expected two arguments.");var f=c.parse(a[1],1,pt);if(!f)return null;var v=a[2];if(typeof v!="object"||Array.isArray(v))return c.error("NumberFormat options argument must be an object.");var I=null;if(v.locale&&!(I=c.parse(v.locale,1,$t)))return null;var A=null;if(v.currency&&!(A=c.parse(v.currency,1,$t)))return null;var R=null;if(v["min-fraction-digits"]&&!(R=c.parse(v["min-fraction-digits"],1,pt)))return null;var O=null;return v["max-fraction-digits"]&&!(O=c.parse(v["max-fraction-digits"],1,pt))?null:new jc(f,I,A,R,O)},jc.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},jc.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},jc.prototype.outputDefined=function(){return!1},jc.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var $u=function(a){this.type=pt,this.input=a};$u.parse=function(a,c){if(a.length!==2)return c.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var f=c.parse(a[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error("Expected argument of type string or array, but found "+En(f.type)+" instead."):new $u(f):null},$u.prototype.evaluate=function(a){var c=this.input.evaluate(a);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Ts("Expected value to be of type string or array, but found "+En(Ur(c))+" instead.")},$u.prototype.eachChild=function(a){a(this.input)},$u.prototype.outputDefined=function(){return!1},$u.prototype.serialize=function(){var a=["length"];return this.eachChild((function(c){a.push(c.serialize())})),a};var $c={"==":AA,"!=":yg,">":Kb,"<":Hb,">=":$b,"<=":jb,array:xr,at:Xc,boolean:xr,case:Kc,coalesce:Yu,collator:kl,format:il,image:ca,in:Yc,"index-of":Ku,interpolate:zs,"interpolate-hcl":zs,"interpolate-lab":zs,length:$u,let:Hu,literal:oo,match:Hc,number:xr,"number-format":jc,object:xr,slice:ju,step:Oo,string:xr,"to-boolean":Ra,"to-color":Ra,"to-number":Ra,"to-string":Ra,var:Uu,within:Ma};function Jb(a,c){var f=c[0],v=c[1],I=c[2],A=c[3];f=f.evaluate(a),v=v.evaluate(a),I=I.evaluate(a);var R=A?A.evaluate(a):1,O=Jy(f,v,I,R);if(O)throw new Ts(O);return new bi(f/255*R,v/255*R,I/255*R,R)}function qb(a,c){return a in c}function s_(a,c){var f=c[a];return f===void 0?null:f}function Jc(a){return{type:a}}function Qb(a){return{result:"success",value:a}}function qc(a){return{result:"error",value:a}}function Qc(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function e1(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Of(a){return!!a.expression&&a.expression.interpolated}function ar(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function _g(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function SA(a){return a}function dd(a,c,f){return a!==void 0?a:c!==void 0?c:f!==void 0?f:void 0}function t1(a,c,f,v,I){return dd(typeof f===I?v[f]:void 0,a.default,c.default)}function EA(a,c,f){if(ar(f)!=="number")return dd(a.default,c.default);var v=a.stops.length;if(v===1||f<=a.stops[0][0])return a.stops[0][1];if(f>=a.stops[v-1][0])return a.stops[v-1][1];var I=mg(a.stops.map((function(A){return A[0]})),f);return a.stops[I][1]}function n1(a,c,f){var v=a.base!==void 0?a.base:1;if(ar(f)!=="number")return dd(a.default,c.default);var I=a.stops.length;if(I===1||f<=a.stops[0][0])return a.stops[0][1];if(f>=a.stops[I-1][0])return a.stops[I-1][1];var A=mg(a.stops.map((function(ne){return ne[0]})),f),R=(function(ne,de,_e,Me){var Pe=Me-_e,He=ne-_e;return Pe===0?0:de===1?He/Pe:(Math.pow(de,He)-1)/(Math.pow(de,Pe)-1)})(f,v,a.stops[A][0],a.stops[A+1][0]),O=a.stops[A][1],Z=a.stops[A+1][1],X=hd[c.type]||SA;if(a.colorSpace&&a.colorSpace!=="rgb"){var $=Ub[a.colorSpace];X=function(ne,de){return $.reverse($.interpolate($.forward(ne),$.forward(de),R))}}return typeof O.evaluate=="function"?{evaluate:function(){for(var ne=[],de=arguments.length;de--;)ne[de]=arguments[de];var _e=O.evaluate.apply(void 0,ne),Me=Z.evaluate.apply(void 0,ne);if(_e!==void 0&&Me!==void 0)return X(_e,Me,R)}}:X(O,Z,R)}function vg(a,c,f){return c.type==="color"?f=bi.parse(f):c.type==="formatted"?f=Es.fromString(f.toString()):c.type==="resolvedImage"?f=Io.fromString(f.toString()):ar(f)===c.type||c.type==="enum"&&c.values[f]||(f=void 0),dd(f,a.default,c.default)}Ws.register($c,{error:[{kind:"error"},[$t],function(a,c){throw new Ts(c[0].evaluate(a))}],typeof:[$t,[Re],function(a,c){return En(Ur(c[0].evaluate(a)))}],"to-rgba":[Bn(pt,4),[Yt],function(a,c){return c[0].evaluate(a).toArray()}],rgb:[Yt,[pt,pt,pt],Jb],rgba:[Yt,[pt,pt,pt,pt],Jb],has:{type:Ut,overloads:[[[$t],function(a,c){return qb(c[0].evaluate(a),a.properties())}],[[$t,Ot],function(a,c){var f=c[1];return qb(c[0].evaluate(a),f.evaluate(a))}]]},get:{type:Re,overloads:[[[$t],function(a,c){return s_(c[0].evaluate(a),a.properties())}],[[$t,Ot],function(a,c){var f=c[1];return s_(c[0].evaluate(a),f.evaluate(a))}]]},"feature-state":[Re,[$t],function(a,c){return s_(c[0].evaluate(a),a.featureState||{})}],properties:[Ot,[],function(a){return a.properties()}],"geometry-type":[$t,[],function(a){return a.geometryType()}],id:[Re,[],function(a){return a.id()}],zoom:[pt,[],function(a){return a.globals.zoom}],"heatmap-density":[pt,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[pt,[],function(a){return a.globals.lineProgress||0}],accumulated:[Re,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[pt,Jc(pt),function(a,c){for(var f=0,v=0,I=c;v<I.length;v+=1)f+=I[v].evaluate(a);return f}],"*":[pt,Jc(pt),function(a,c){for(var f=1,v=0,I=c;v<I.length;v+=1)f*=I[v].evaluate(a);return f}],"-":{type:pt,overloads:[[[pt,pt],function(a,c){var f=c[1];return c[0].evaluate(a)-f.evaluate(a)}],[[pt],function(a,c){return-c[0].evaluate(a)}]]},"/":[pt,[pt,pt],function(a,c){var f=c[1];return c[0].evaluate(a)/f.evaluate(a)}],"%":[pt,[pt,pt],function(a,c){var f=c[1];return c[0].evaluate(a)%f.evaluate(a)}],ln2:[pt,[],function(){return Math.LN2}],pi:[pt,[],function(){return Math.PI}],e:[pt,[],function(){return Math.E}],"^":[pt,[pt,pt],function(a,c){var f=c[1];return Math.pow(c[0].evaluate(a),f.evaluate(a))}],sqrt:[pt,[pt],function(a,c){return Math.sqrt(c[0].evaluate(a))}],log10:[pt,[pt],function(a,c){return Math.log(c[0].evaluate(a))/Math.LN10}],ln:[pt,[pt],function(a,c){return Math.log(c[0].evaluate(a))}],log2:[pt,[pt],function(a,c){return Math.log(c[0].evaluate(a))/Math.LN2}],sin:[pt,[pt],function(a,c){return Math.sin(c[0].evaluate(a))}],cos:[pt,[pt],function(a,c){return Math.cos(c[0].evaluate(a))}],tan:[pt,[pt],function(a,c){return Math.tan(c[0].evaluate(a))}],asin:[pt,[pt],function(a,c){return Math.asin(c[0].evaluate(a))}],acos:[pt,[pt],function(a,c){return Math.acos(c[0].evaluate(a))}],atan:[pt,[pt],function(a,c){return Math.atan(c[0].evaluate(a))}],min:[pt,Jc(pt),function(a,c){return Math.min.apply(Math,c.map((function(f){return f.evaluate(a)})))}],max:[pt,Jc(pt),function(a,c){return Math.max.apply(Math,c.map((function(f){return f.evaluate(a)})))}],abs:[pt,[pt],function(a,c){return Math.abs(c[0].evaluate(a))}],round:[pt,[pt],function(a,c){var f=c[0].evaluate(a);return f<0?-Math.round(-f):Math.round(f)}],floor:[pt,[pt],function(a,c){return Math.floor(c[0].evaluate(a))}],ceil:[pt,[pt],function(a,c){return Math.ceil(c[0].evaluate(a))}],"filter-==":[Ut,[$t,Re],function(a,c){var f=c[0],v=c[1];return a.properties()[f.value]===v.value}],"filter-id-==":[Ut,[Re],function(a,c){var f=c[0];return a.id()===f.value}],"filter-type-==":[Ut,[$t],function(a,c){var f=c[0];return a.geometryType()===f.value}],"filter-<":[Ut,[$t,Re],function(a,c){var f=c[0],v=c[1],I=a.properties()[f.value],A=v.value;return typeof I==typeof A&&I<A}],"filter-id-<":[Ut,[Re],function(a,c){var f=c[0],v=a.id(),I=f.value;return typeof v==typeof I&&v<I}],"filter->":[Ut,[$t,Re],function(a,c){var f=c[0],v=c[1],I=a.properties()[f.value],A=v.value;return typeof I==typeof A&&I>A}],"filter-id->":[Ut,[Re],function(a,c){var f=c[0],v=a.id(),I=f.value;return typeof v==typeof I&&v>I}],"filter-<=":[Ut,[$t,Re],function(a,c){var f=c[0],v=c[1],I=a.properties()[f.value],A=v.value;return typeof I==typeof A&&I<=A}],"filter-id-<=":[Ut,[Re],function(a,c){var f=c[0],v=a.id(),I=f.value;return typeof v==typeof I&&v<=I}],"filter->=":[Ut,[$t,Re],function(a,c){var f=c[0],v=c[1],I=a.properties()[f.value],A=v.value;return typeof I==typeof A&&I>=A}],"filter-id->=":[Ut,[Re],function(a,c){var f=c[0],v=a.id(),I=f.value;return typeof v==typeof I&&v>=I}],"filter-has":[Ut,[Re],function(a,c){return c[0].value in a.properties()}],"filter-has-id":[Ut,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[Ut,[Bn($t)],function(a,c){return c[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[Ut,[Bn(Re)],function(a,c){return c[0].value.indexOf(a.id())>=0}],"filter-in-small":[Ut,[$t,Bn(Re)],function(a,c){var f=c[0];return c[1].value.indexOf(a.properties()[f.value])>=0}],"filter-in-large":[Ut,[$t,Bn(Re)],function(a,c){var f=c[0],v=c[1];return(function(I,A,R,O){for(;R<=O;){var Z=R+O>>1;if(A[Z]===I)return!0;A[Z]>I?O=Z-1:R=Z+1}return!1})(a.properties()[f.value],v.value,0,v.value.length-1)}],all:{type:Ut,overloads:[[[Ut,Ut],function(a,c){var f=c[1];return c[0].evaluate(a)&&f.evaluate(a)}],[Jc(Ut),function(a,c){for(var f=0,v=c;f<v.length;f+=1)if(!v[f].evaluate(a))return!1;return!0}]]},any:{type:Ut,overloads:[[[Ut,Ut],function(a,c){var f=c[1];return c[0].evaluate(a)||f.evaluate(a)}],[Jc(Ut),function(a,c){for(var f=0,v=c;f<v.length;f+=1)if(v[f].evaluate(a))return!0;return!1}]]},"!":[Ut,[Ut],function(a,c){return!c[0].evaluate(a)}],"is-supported-script":[Ut,[$t],function(a,c){var f=a.globals&&a.globals.isSupportedScript;return!f||f(c[0].evaluate(a))}],upcase:[$t,[$t],function(a,c){return c[0].evaluate(a).toUpperCase()}],downcase:[$t,[$t],function(a,c){return c[0].evaluate(a).toLowerCase()}],concat:[$t,Jc(Re),function(a,c){return c.map((function(f){return Lf(f.evaluate(a))})).join("")}],"resolved-locale":[$t,[_t],function(a,c){return c[0].evaluate(a).resolvedLocale()}]});var fd=function(a,c){this.expression=a,this._warningHistory={},this._evaluator=new iu,this._defaultValue=c?(function(f){return f.type==="color"&&_g(f.default)?new bi(0,0,0,0):f.type==="color"?bi.parse(f.default)||null:f.default===void 0?null:f.default})(c):null,this._enumValues=c&&c.type==="enum"?c.values:null};function Nf(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in $c}function bg(a,c){var f=new Xu($c,[],c?(function(I){var A={color:Yt,string:$t,number:pt,enum:$t,boolean:Ut,formatted:Kt,resolvedImage:mn};return I.type==="array"?Bn(A[I.value]||Re,I.length):A[I.type]})(c):void 0),v=f.parse(a,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?Qb(new fd(v,c)):qc(f.errors)}fd.prototype.evaluateWithoutErrorHandling=function(a,c,f,v,I,A){return this._evaluator.globals=a,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=v,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)},fd.prototype.evaluate=function(a,c,f,v,I,A){this._evaluator.globals=a,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=v,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=A||null;try{var R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Ts("Expected value to be one of "+Object.keys(this._enumValues).map((function(O){return JSON.stringify(O)})).join(", ")+", but found "+JSON.stringify(R)+" instead.");return R}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console<"u"&&console.warn(O.message)),this._defaultValue}};var Df=function(a,c){this.kind=a,this._styleExpression=c,this.isStateDependent=a!=="constant"&&!zu(c.expression)};Df.prototype.evaluateWithoutErrorHandling=function(a,c,f,v,I,A){return this._styleExpression.evaluateWithoutErrorHandling(a,c,f,v,I,A)},Df.prototype.evaluate=function(a,c,f,v,I,A){return this._styleExpression.evaluate(a,c,f,v,I,A)};var pd=function(a,c,f,v){this.kind=a,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=a!=="camera"&&!zu(c.expression),this.interpolationType=v};function i1(a,c){if((a=bg(a,c)).result==="error")return a;var f=a.value.expression,v=Wu(f);if(!v&&!Qc(c))return qc([new It("","data expressions not supported")]);var I=Uc(f,["zoom"]);if(!I&&!e1(c))return qc([new It("","zoom expressions not supported")]);var A=(function R(O){var Z=null;if(O instanceof Hu)Z=R(O.result);else if(O instanceof Yu)for(var X=0,$=O.args;X<$.length&&!(Z=R($[X]));X+=1);else(O instanceof Oo||O instanceof zs)&&O.input instanceof Ws&&O.input.name==="zoom"&&(Z=O);return Z instanceof It||O.eachChild((function(ne){var de=R(ne);de instanceof It?Z=de:!Z&&de?Z=new It("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):Z&&de&&Z!==de&&(Z=new It("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),Z})(f);return A||I?A instanceof It?qc([A]):A instanceof zs&&!Of(c)?qc([new It("",'"interpolate" expressions cannot be used with this property')]):Qb(A?new pd(v?"camera":"composite",a.value,A.labels,A instanceof zs?A.interpolation:void 0):new Df(v?"constant":"source",a.value)):qc([new It("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}pd.prototype.evaluateWithoutErrorHandling=function(a,c,f,v,I,A){return this._styleExpression.evaluateWithoutErrorHandling(a,c,f,v,I,A)},pd.prototype.evaluate=function(a,c,f,v,I,A){return this._styleExpression.evaluate(a,c,f,v,I,A)},pd.prototype.interpolationFactor=function(a,c,f){return this.interpolationType?zs.interpolationFactor(this.interpolationType,a,c,f):0};var gd=function(a,c){this._parameters=a,this._specification=c,bt(this,(function f(v,I){var A,R,O,Z=I.type==="color",X=v.stops&&typeof v.stops[0][0]=="object",$=X||!(X||v.property!==void 0),ne=v.type||(Of(I)?"exponential":"interval");if(Z&&((v=bt({},v)).stops&&(v.stops=v.stops.map((function(Jt){return[Jt[0],bi.parse(Jt[1])]}))),v.default=bi.parse(v.default?v.default:I.default)),v.colorSpace&&v.colorSpace!=="rgb"&&!Ub[v.colorSpace])throw new Error("Unknown color space: "+v.colorSpace);if(ne==="exponential")A=n1;else if(ne==="interval")A=EA;else if(ne==="categorical"){A=t1,R=Object.create(null);for(var de=0,_e=v.stops;de<_e.length;de+=1){var Me=_e[de];R[Me[0]]=Me[1]}O=typeof v.stops[0][0]}else{if(ne!=="identity")throw new Error('Unknown function type "'+ne+'"');A=vg}if(X){for(var Pe={},He=[],Ve=0;Ve<v.stops.length;Ve++){var et=v.stops[Ve],it=et[0].zoom;Pe[it]===void 0&&(Pe[it]={zoom:it,type:v.type,property:v.property,default:v.default,stops:[]},He.push(it)),Pe[it].stops.push([et[0].value,et[1]])}for(var rt=[],lt=0,yt=He;lt<yt.length;lt+=1){var Rt=yt[lt];rt.push([Pe[Rt].zoom,f(Pe[Rt],I)])}var Zt={name:"linear"};return{kind:"composite",interpolationType:Zt,interpolationFactor:zs.interpolationFactor.bind(void 0,Zt),zoomStops:rt.map((function(Jt){return Jt[0]})),evaluate:function(Jt,bn){var Qt=Jt.zoom;return n1({stops:rt,base:v.base},I,Qt).evaluate(Qt,bn)}}}if($){var gn=ne==="exponential"?{name:"exponential",base:v.base!==void 0?v.base:1}:null;return{kind:"camera",interpolationType:gn,interpolationFactor:zs.interpolationFactor.bind(void 0,gn),zoomStops:v.stops.map((function(Jt){return Jt[0]})),evaluate:function(Jt){return A(v,I,Jt.zoom,R,O)}}}return{kind:"source",evaluate:function(Jt,bn){var Qt=bn&&bn.properties?bn.properties[v.property]:void 0;return Qt===void 0?dd(v.default,I.default):A(v,I,Qt,R,O)}}})(this._parameters,this._specification))};function rl(a){var c=a.key,f=a.value,v=a.valueSpec||{},I=a.objectElementValidators||{},A=a.style,R=a.styleSpec,O=[],Z=ar(f);if(Z!=="object")return[new Se(c,f,"object expected, "+Z+" found")];for(var X in f){var $=X.split(".")[0],ne=v[$]||v["*"],de=void 0;if(I[$])de=I[$];else if(v[$])de=gi;else if(I["*"])de=I["*"];else{if(!v["*"]){O.push(new Se(c,f[X],'unknown property "'+X+'"'));continue}de=gi}O=O.concat(de({key:(c&&c+".")+X,value:f[X],valueSpec:ne,style:A,styleSpec:R,object:f,objectKey:X},f))}for(var _e in v)I[_e]||v[_e].required&&v[_e].default===void 0&&f[_e]===void 0&&O.push(new Se(c,f,'missing required property "'+_e+'"'));return O}function r1(a){var c=a.value,f=a.valueSpec,v=a.style,I=a.styleSpec,A=a.key,R=a.arrayElementValidator||gi;if(ar(c)!=="array")return[new Se(A,c,"array expected, "+ar(c)+" found")];if(f.length&&c.length!==f.length)return[new Se(A,c,"array length "+f.length+" expected, length "+c.length+" found")];if(f["min-length"]&&c.length<f["min-length"])return[new Se(A,c,"array length at least "+f["min-length"]+" expected, length "+c.length+" found")];var O={type:f.value,values:f.values};I.$version<7&&(O.function=f.function),ar(f.value)==="object"&&(O=f.value);for(var Z=[],X=0;X<c.length;X++)Z=Z.concat(R({array:c,arrayIndex:X,value:c[X],valueSpec:O,style:v,styleSpec:I,key:A+"["+X+"]"}));return Z}function s1(a){var c=a.key,f=a.value,v=a.valueSpec,I=ar(f);return I==="number"&&f!=f&&(I="NaN"),I!=="number"?[new Se(c,f,"number expected, "+I+" found")]:"minimum"in v&&f<v.minimum?[new Se(c,f,f+" is less than the minimum value "+v.minimum)]:"maximum"in v&&f>v.maximum?[new Se(c,f,f+" is greater than the maximum value "+v.maximum)]:[]}function o1(a){var c,f,v,I=a.valueSpec,A=St(a.value.type),R={},O=A!=="categorical"&&a.value.property===void 0,Z=!O,X=ar(a.value.stops)==="array"&&ar(a.value.stops[0])==="array"&&ar(a.value.stops[0][0])==="object",$=rl({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(_e){if(A==="identity")return[new Se(_e.key,_e.value,'identity function may not have a "stops" property')];var Me=[],Pe=_e.value;return Me=Me.concat(r1({key:_e.key,value:Pe,valueSpec:_e.valueSpec,style:_e.style,styleSpec:_e.styleSpec,arrayElementValidator:ne})),ar(Pe)==="array"&&Pe.length===0&&Me.push(new Se(_e.key,Pe,"array must have at least one stop")),Me},default:function(_e){return gi({key:_e.key,value:_e.value,valueSpec:I,style:_e.style,styleSpec:_e.styleSpec})}}});return A==="identity"&&O&&$.push(new Se(a.key,a.value,'missing required property "property"')),A==="identity"||a.value.stops||$.push(new Se(a.key,a.value,'missing required property "stops"')),A==="exponential"&&a.valueSpec.expression&&!Of(a.valueSpec)&&$.push(new Se(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(Z&&!Qc(a.valueSpec)?$.push(new Se(a.key,a.value,"property functions not supported")):O&&!e1(a.valueSpec)&&$.push(new Se(a.key,a.value,"zoom functions not supported"))),A!=="categorical"&&!X||a.value.property!==void 0||$.push(new Se(a.key,a.value,'"property" property is required')),$;function ne(_e){var Me=[],Pe=_e.value,He=_e.key;if(ar(Pe)!=="array")return[new Se(He,Pe,"array expected, "+ar(Pe)+" found")];if(Pe.length!==2)return[new Se(He,Pe,"array length 2 expected, length "+Pe.length+" found")];if(X){if(ar(Pe[0])!=="object")return[new Se(He,Pe,"object expected, "+ar(Pe[0])+" found")];if(Pe[0].zoom===void 0)return[new Se(He,Pe,"object stop key must have zoom")];if(Pe[0].value===void 0)return[new Se(He,Pe,"object stop key must have value")];if(v&&v>St(Pe[0].zoom))return[new Se(He,Pe[0].zoom,"stop zoom values must appear in ascending order")];St(Pe[0].zoom)!==v&&(v=St(Pe[0].zoom),f=void 0,R={}),Me=Me.concat(rl({key:He+"[0]",value:Pe[0],valueSpec:{zoom:{}},style:_e.style,styleSpec:_e.styleSpec,objectElementValidators:{zoom:s1,value:de}}))}else Me=Me.concat(de({key:He+"[0]",value:Pe[0],style:_e.style,styleSpec:_e.styleSpec},Pe));return Nf(ct(Pe[1]))?Me.concat([new Se(He+"[1]",Pe[1],"expressions are not allowed in function stops.")]):Me.concat(gi({key:He+"[1]",value:Pe[1],valueSpec:I,style:_e.style,styleSpec:_e.styleSpec}))}function de(_e,Me){var Pe=ar(_e.value),He=St(_e.value),Ve=_e.value!==null?_e.value:Me;if(c){if(Pe!==c)return[new Se(_e.key,Ve,Pe+" stop domain type must match previous stop domain type "+c)]}else c=Pe;if(Pe!=="number"&&Pe!=="string"&&Pe!=="boolean")return[new Se(_e.key,Ve,"stop domain value must be a number, string, or boolean")];if(Pe!=="number"&&A!=="categorical"){var et="number expected, "+Pe+" found";return Qc(I)&&A===void 0&&(et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Se(_e.key,Ve,et)]}return A!=="categorical"||Pe!=="number"||isFinite(He)&&Math.floor(He)===He?A!=="categorical"&&Pe==="number"&&f!==void 0&&He<f?[new Se(_e.key,Ve,"stop domain values must appear in ascending order")]:(f=He,A==="categorical"&&He in R?[new Se(_e.key,Ve,"stop domain values must be unique")]:(R[He]=!0,[])):[new Se(_e.key,Ve,"integer expected, found "+He)]}}function eh(a){var c=(a.expressionContext==="property"?i1:bg)(ct(a.value),a.valueSpec);if(c.result==="error")return c.value.map((function(v){return new Se(""+a.key+v.key,a.value,v.message)}));var f=c.value.expression||c.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!f.outputDefined())return[new Se(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!zu(f))return[new Se(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!zu(f))return[new Se(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Uc(f,["zoom","feature-state"]))return[new Se(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Wu(f))return[new Se(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vf(a){var c=a.key,f=a.value,v=a.valueSpec,I=[];return Array.isArray(v.values)?v.values.indexOf(St(f))===-1&&I.push(new Se(c,f,"expected one of ["+v.values.join(", ")+"], "+JSON.stringify(f)+" found")):Object.keys(v.values).indexOf(St(f))===-1&&I.push(new Se(c,f,"expected one of ["+Object.keys(v.values).join(", ")+"], "+JSON.stringify(f)+" found")),I}function xg(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var c=0,f=a.slice(1);c<f.length;c+=1){var v=f[c];if(!xg(v)&&typeof v!="boolean")return!1}return!0;default:return!0}}gd.deserialize=function(a){return new gd(a._parameters,a._specification)},gd.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var o_={type:"boolean",default:!1};function Ig(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};xg(a)||(a=Cg(a));var c=bg(a,o_);if(c.result==="error")throw new Error(c.value.map((function(f){return f.key+": "+f.message})).join(", "));return{filter:function(f,v,I){return c.value.evaluate(f,v,{},I)},needGeometry:(function f(v){if(!Array.isArray(v))return!1;if(v[0]==="within")return!0;for(var I=1;I<v.length;I++)if(f(v[I]))return!0;return!1})(a)}}function TA(a,c){return a<c?-1:a>c?1:0}function Cg(a){if(!a)return!0;var c,f=a[0];return a.length<=1?f!=="any":f==="=="?a_(a[1],a[2],"=="):f==="!="?wg(a_(a[1],a[2],"==")):f==="<"||f===">"||f==="<="||f===">="?a_(a[1],a[2],f):f==="any"?(c=a.slice(1),["any"].concat(c.map(Cg))):f==="all"?["all"].concat(a.slice(1).map(Cg)):f==="none"?["all"].concat(a.slice(1).map(Cg).map(wg)):f==="in"?a1(a[1],a.slice(2)):f==="!in"?wg(a1(a[1],a.slice(2))):f==="has"?l1(a[1]):f==="!has"?wg(l1(a[1])):f!=="within"||a}function a_(a,c,f){switch(a){case"$type":return["filter-type-"+f,c];case"$id":return["filter-id-"+f,c];default:return["filter-"+f,a,c]}}function a1(a,c){if(c.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some((function(f){return typeof f!=typeof c[0]}))?["filter-in-large",a,["literal",c.sort(TA)]]:["filter-in-small",a,["literal",c]]}}function l1(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function wg(a){return["!",a]}function l_(a){return xg(ct(a.value))?eh(bt({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):(function c(f){var v=f.value,I=f.key;if(ar(v)!=="array")return[new Se(I,v,"array expected, "+ar(v)+" found")];var A,R=f.styleSpec,O=[];if(v.length<1)return[new Se(I,v,"filter array must have at least 1 element")];switch(O=O.concat(Vf({key:I+"[0]",value:v[0],valueSpec:R.filter_operator,style:f.style,styleSpec:f.styleSpec})),St(v[0])){case"<":case"<=":case">":case">=":v.length>=2&&St(v[1])==="$type"&&O.push(new Se(I,v,'"$type" cannot be use with operator "'+v[0]+'"'));case"==":case"!=":v.length!==3&&O.push(new Se(I,v,'filter array for operator "'+v[0]+'" must have 3 elements'));case"in":case"!in":v.length>=2&&(A=ar(v[1]))!=="string"&&O.push(new Se(I+"[1]",v[1],"string expected, "+A+" found"));for(var Z=2;Z<v.length;Z++)A=ar(v[Z]),St(v[1])==="$type"?O=O.concat(Vf({key:I+"["+Z+"]",value:v[Z],valueSpec:R.geometry_type,style:f.style,styleSpec:f.styleSpec})):A!=="string"&&A!=="number"&&A!=="boolean"&&O.push(new Se(I+"["+Z+"]",v[Z],"string, number, or boolean expected, "+A+" found"));break;case"any":case"all":case"none":for(var X=1;X<v.length;X++)O=O.concat(c({key:I+"["+X+"]",value:v[X],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":A=ar(v[1]),v.length!==2?O.push(new Se(I,v,'filter array for "'+v[0]+'" operator must have 2 elements')):A!=="string"&&O.push(new Se(I+"[1]",v[1],"string expected, "+A+" found"));break;case"within":A=ar(v[1]),v.length!==2?O.push(new Se(I,v,'filter array for "'+v[0]+'" operator must have 2 elements')):A!=="object"&&O.push(new Se(I+"[1]",v[1],"object expected, "+A+" found"))}return O})(a)}function u_(a,c){var f=a.key,v=a.style,I=a.styleSpec,A=a.value,R=a.objectKey,O=I[c+"_"+a.layerType];if(!O)return[];var Z=R.match(/^(.*)-transition$/);if(c==="paint"&&Z&&O[Z[1]]&&O[Z[1]].transition)return gi({key:f,value:A,valueSpec:I.transition,style:v,styleSpec:I});var X,$=a.valueSpec||O[R];if(!$)return[new Se(f,A,'unknown property "'+R+'"')];if(ar(A)==="string"&&Qc($)&&!$.tokens&&(X=/^{([^}]+)}$/.exec(A)))return[new Se(f,A,'"'+R+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(X[1])+" }`.")];var ne=[];return a.layerType==="symbol"&&(R==="text-field"&&v&&!v.glyphs&&ne.push(new Se(f,A,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&_g(ct(A))&&St(A.type)==="identity"&&ne.push(new Se(f,A,'"text-font" does not support identity functions'))),ne.concat(gi({key:a.key,value:A,valueSpec:$,style:v,styleSpec:I,expressionContext:"property",propertyType:c,propertyKey:R}))}function c_(a){return u_(a,"paint")}function Bf(a){return u_(a,"layout")}function u1(a){var c=[],f=a.value,v=a.key,I=a.style,A=a.styleSpec;f.type||f.ref||c.push(new Se(v,f,'either "type" or "ref" is required'));var R,O=St(f.type),Z=St(f.ref);if(f.id)for(var X=St(f.id),$=0;$<a.arrayIndex;$++){var ne=I.layers[$];St(ne.id)===X&&c.push(new Se(v,f.id,'duplicate layer id "'+f.id+'", previously used at line '+ne.id.__line__))}if("ref"in f)["type","source","source-layer","filter","layout"].forEach((function(Me){Me in f&&c.push(new Se(v,f[Me],'"'+Me+'" is prohibited for ref layers'))})),I.layers.forEach((function(Me){St(Me.id)===Z&&(R=Me)})),R?R.ref?c.push(new Se(v,f.ref,"ref cannot reference another ref layer")):O=St(R.type):c.push(new Se(v,f.ref,'ref layer "'+Z+'" not found'));else if(O!=="background")if(f.source){var de=I.sources&&I.sources[f.source],_e=de&&St(de.type);de?_e==="vector"&&O==="raster"?c.push(new Se(v,f.source,'layer "'+f.id+'" requires a raster source')):_e==="raster"&&O!=="raster"?c.push(new Se(v,f.source,'layer "'+f.id+'" requires a vector source')):_e!=="vector"||f["source-layer"]?_e==="raster-dem"&&O!=="hillshade"?c.push(new Se(v,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="line"||!f.paint||!f.paint["line-gradient"]||_e==="geojson"&&de.lineMetrics||c.push(new Se(v,f,'layer "'+f.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):c.push(new Se(v,f,'layer "'+f.id+'" must specify a "source-layer"')):c.push(new Se(v,f.source,'source "'+f.source+'" not found'))}else c.push(new Se(v,f,'missing required property "source"'));return c=c.concat(rl({key:v,value:f,valueSpec:A.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return gi({key:v+".type",value:f.type,valueSpec:A.layer.type,style:a.style,styleSpec:a.styleSpec,object:f,objectKey:"type"})},filter:l_,layout:function(Me){return rl({layer:f,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Pe){return Bf(bt({layerType:O},Pe))}}})},paint:function(Me){return rl({layer:f,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Pe){return c_(bt({layerType:O},Pe))}}})}}}))}function th(a){var c=a.value,f=a.key,v=ar(c);return v!=="string"?[new Se(f,c,"string expected, "+v+" found")]:[]}var Ir={promoteId:function(a){var c=a.key,f=a.value;if(ar(f)==="string")return th({key:c,value:f});var v=[];for(var I in f)v.push.apply(v,th({key:c+"."+I,value:f[I]}));return v}};function Ag(a){var c=a.value,f=a.key,v=a.styleSpec,I=a.style;if(!c.type)return[new Se(f,c,'"type" is required')];var A,R=St(c.type);switch(R){case"vector":case"raster":case"raster-dem":return rl({key:f,value:c,valueSpec:v["source_"+R.replace("-","_")],style:a.style,styleSpec:v,objectElementValidators:Ir});case"geojson":if(A=rl({key:f,value:c,valueSpec:v.source_geojson,style:I,styleSpec:v,objectElementValidators:Ir}),c.cluster)for(var O in c.clusterProperties){var Z=c.clusterProperties[O],X=Z[0],$=typeof X=="string"?[X,["accumulated"],["get",O]]:X;A.push.apply(A,eh({key:f+"."+O+".map",value:Z[1],expressionContext:"cluster-map"})),A.push.apply(A,eh({key:f+"."+O+".reduce",value:$,expressionContext:"cluster-reduce"}))}return A;case"video":return rl({key:f,value:c,valueSpec:v.source_video,style:I,styleSpec:v});case"image":return rl({key:f,value:c,valueSpec:v.source_image,style:I,styleSpec:v});case"canvas":return[new Se(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vf({key:f+".type",value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function nh(a){var c=a.value,f=a.styleSpec,v=f.light,I=a.style,A=[],R=ar(c);if(c===void 0)return A;if(R!=="object")return A.concat([new Se("light",c,"object expected, "+R+" found")]);for(var O in c){var Z=O.match(/^(.*)-transition$/);A=A.concat(Z&&v[Z[1]]&&v[Z[1]].transition?gi({key:O,value:c[O],valueSpec:f.transition,style:I,styleSpec:f}):v[O]?gi({key:O,value:c[O],valueSpec:v[O],style:I,styleSpec:f}):[new Se(O,c[O],'unknown property "'+O+'"')])}return A}var Ju={"*":function(){return[]},array:r1,boolean:function(a){var c=a.value,f=a.key,v=ar(c);return v!=="boolean"?[new Se(f,c,"boolean expected, "+v+" found")]:[]},number:s1,color:function(a){var c=a.key,f=a.value,v=ar(f);return v!=="string"?[new Se(c,f,"color expected, "+v+" found")]:Rn(f)===null?[new Se(c,f,'color expected, "'+f+'" found')]:[]},constants:tt,enum:Vf,filter:l_,function:o1,layer:u1,object:rl,source:Ag,light:nh,string:th,formatted:function(a){return th(a).length===0?[]:eh(a)},resolvedImage:function(a){return th(a).length===0?[]:eh(a)}};function gi(a){var c=a.value,f=a.valueSpec,v=a.styleSpec;return f.expression&&_g(St(c))?o1(a):f.expression&&Nf(ct(c))?eh(a):f.type&&Ju[f.type]?Ju[f.type](a):rl(bt({},a,{valueSpec:f.type?v[f.type]:f}))}function lr(a){var c=a.value,f=a.key,v=th(a);return v.length||(c.indexOf("{fontstack}")===-1&&v.push(new Se(f,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&v.push(new Se(f,c,'"glyphs" url must include a "{range}" token'))),v}function ha(a,c){c===void 0&&(c=ye);var f=[];return f=f.concat(gi({key:"",value:a,valueSpec:c.$root,styleSpec:c,style:a,objectElementValidators:{glyphs:lr,"*":function(){return[]}}})),a.constants&&(f=f.concat(tt({key:"constants",value:a.constants}))),Zf(f)}function Zf(a){return[].concat(a).sort((function(c,f){return c.line-f.line}))}function md(a){return function(){for(var c=[],f=arguments.length;f--;)c[f]=arguments[f];return Zf(a.apply(this,c))}}ha.source=md(Ag),ha.light=md(nh),ha.layer=md(u1),ha.filter=md(l_),ha.paintProperty=md(c_),ha.layoutProperty=md(Bf);var Wf=ha,RA=Wf.light,MA=Wf.paintProperty,zf=Wf.layoutProperty;function Uf(a,c){var f=!1;if(c&&c.length)for(var v=0,I=c;v<I.length;v+=1)a.fire(new Ye(new Error(I[v].message))),f=!0;return f}var ru=ss;function ss(a,c,f){var v=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var I=new Int32Array(this.arrayBuffer);a=I[0],this.d=(c=I[1])+2*(f=I[2]);for(var A=0;A<this.d*this.d;A++){var R=I[3+A],O=I[3+A+1];v.push(R===O?null:I.subarray(R,O))}var Z=I[3+v.length+1];this.keys=I.subarray(I[3+v.length],Z),this.bboxes=I.subarray(Z),this.insert=this._insertReadonly}else{this.d=c+2*f;for(var X=0;X<this.d*this.d;X++)v.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=a,this.padding=f,this.scale=c/a,this.uid=0;var $=f/c*a;this.min=-$,this.max=a+$}ss.prototype.insert=function(a,c,f,v,I){this._forEachCell(c,f,v,I,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(I)},ss.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ss.prototype._insertCell=function(a,c,f,v,I,A){this.cells[I].push(A)},ss.prototype.query=function(a,c,f,v,I){var A=this.min,R=this.max;if(a<=A&&c<=A&&R<=f&&R<=v&&!I)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(a,c,f,v,this._queryCell,O,{},I),O},ss.prototype._queryCell=function(a,c,f,v,I,A,R,O){var Z=this.cells[I];if(Z!==null)for(var X=this.keys,$=this.bboxes,ne=0;ne<Z.length;ne++){var de=Z[ne];if(R[de]===void 0){var _e=4*de;(O?O($[_e+0],$[_e+1],$[_e+2],$[_e+3]):a<=$[_e+2]&&c<=$[_e+3]&&f>=$[_e+0]&&v>=$[_e+1])?(R[de]=!0,A.push(X[de])):R[de]=!1}}},ss.prototype._forEachCell=function(a,c,f,v,I,A,R,O){for(var Z=this._convertToCellCoord(a),X=this._convertToCellCoord(c),$=this._convertToCellCoord(f),ne=this._convertToCellCoord(v),de=Z;de<=$;de++)for(var _e=X;_e<=ne;_e++){var Me=this.d*_e+de;if((!O||O(this._convertFromCellCoord(de),this._convertFromCellCoord(_e),this._convertFromCellCoord(de+1),this._convertFromCellCoord(_e+1)))&&I.call(this,a,c,f,v,Me,A,R,O))return}},ss.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},ss.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},ss.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,c=3+this.cells.length+1+1,f=0,v=0;v<this.cells.length;v++)f+=this.cells[v].length;var I=new Int32Array(c+f+this.keys.length+this.bboxes.length);I[0]=this.extent,I[1]=this.n,I[2]=this.padding;for(var A=c,R=0;R<a.length;R++){var O=a[R];I[3+R]=A,I.set(O,A),A+=O.length}return I[3+a.length]=A,I.set(this.keys,A),I[3+a.length+1]=A+=this.keys.length,I.set(this.bboxes,A),A+=this.bboxes.length,I.buffer};var Xf=y.ImageData,c1=y.ImageBitmap,Qr={};function sn(a,c,f){f===void 0&&(f={}),Object.defineProperty(c,"_classRegistryKey",{value:a,writeable:!1}),Qr[a]={klass:c,omit:f.omit||[],shallow:f.shallow||[]}}for(var No in sn("Object",Object),ru.serialize=function(a,c){var f=a.toArrayBuffer();return c&&c.push(f),{buffer:f}},ru.deserialize=function(a){return new ru(a.buffer)},sn("Grid",ru),sn("Color",bi),sn("Error",Error),sn("ResolvedImage",Io),sn("StylePropertyFunction",gd),sn("StyleExpression",fd,{omit:["_evaluator"]}),sn("ZoomDependentExpression",pd),sn("ZoomConstantExpression",Df),sn("CompoundExpression",Ws,{omit:["_evaluate"]}),$c)$c[No]._classRegistryKey||sn("Expression_"+No,$c[No]);function Sg(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function yd(a){return c1&&a instanceof c1}function sl(a,c){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Sg(a)||yd(a))return c&&c.push(a),a;if(ArrayBuffer.isView(a)){var f=a;return c&&c.push(f.buffer),f}if(a instanceof Xf)return c&&c.push(a.data.buffer),a;if(Array.isArray(a)){for(var v=[],I=0,A=a;I<A.length;I+=1)v.push(sl(A[I],c));return v}if(typeof a=="object"){var R=a.constructor,O=R._classRegistryKey;if(!O)throw new Error("can't serialize object of unregistered class");var Z=R.serialize?R.serialize(a,c):{};if(!R.serialize){for(var X in a)if(a.hasOwnProperty(X)&&!(Qr[O].omit.indexOf(X)>=0)){var $=a[X];Z[X]=Qr[O].shallow.indexOf(X)>=0?$:sl($,c)}a instanceof Error&&(Z.message=a.message)}if(Z.$name)throw new Error("$name property is reserved for worker serialization logic.");return O!=="Object"&&(Z.$name=O),Z}throw new Error("can't serialize object of type "+typeof a)}function Do(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Sg(a)||yd(a)||ArrayBuffer.isView(a)||a instanceof Xf)return a;if(Array.isArray(a))return a.map(Do);if(typeof a=="object"){var c=a.$name||"Object",f=Qr[c].klass;if(!f)throw new Error("can't deserialize unregistered class "+c);if(f.deserialize)return f.deserialize(a);for(var v=Object.create(f.prototype),I=0,A=Object.keys(a);I<A.length;I+=1){var R=A[I];if(R!=="$name"){var O=a[R];v[R]=Qr[c].shallow.indexOf(R)>=0?O:Do(O)}}return v}throw new Error("can't deserialize object of type "+typeof a)}var h_=function(){this.first=!0};h_.prototype.update=function(a,c){var f=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=f,!0))};var Ht={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function d_(a){for(var c=0,f=a;c<f.length;c+=1)if(Eg(f[c].charCodeAt(0)))return!0;return!1}function Eg(a){return!(a!==746&&a!==747&&(a<4352||!(Ht["Bopomofo Extended"](a)||Ht.Bopomofo(a)||Ht["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ht["CJK Compatibility Ideographs"](a)||Ht["CJK Compatibility"](a)||Ht["CJK Radicals Supplement"](a)||Ht["CJK Strokes"](a)||!(!Ht["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Ht["CJK Unified Ideographs Extension A"](a)||Ht["CJK Unified Ideographs"](a)||Ht["Enclosed CJK Letters and Months"](a)||Ht["Hangul Compatibility Jamo"](a)||Ht["Hangul Jamo Extended-A"](a)||Ht["Hangul Jamo Extended-B"](a)||Ht["Hangul Jamo"](a)||Ht["Hangul Syllables"](a)||Ht.Hiragana(a)||Ht["Ideographic Description Characters"](a)||Ht.Kanbun(a)||Ht["Kangxi Radicals"](a)||Ht["Katakana Phonetic Extensions"](a)||Ht.Katakana(a)&&a!==12540||!(!Ht["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Ht["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ht["Unified Canadian Aboriginal Syllabics"](a)||Ht["Unified Canadian Aboriginal Syllabics Extended"](a)||Ht["Vertical Forms"](a)||Ht["Yijing Hexagram Symbols"](a)||Ht["Yi Syllables"](a)||Ht["Yi Radicals"](a))))}function f_(a){return!(Eg(a)||(function(c){return!!(Ht["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||Ht["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||Ht["Letterlike Symbols"](c)||Ht["Number Forms"](c)||Ht["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||Ht["Control Pictures"](c)&&c!==9251||Ht["Optical Character Recognition"](c)||Ht["Enclosed Alphanumerics"](c)||Ht["Geometric Shapes"](c)||Ht["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||Ht["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||Ht["CJK Symbols and Punctuation"](c)||Ht.Katakana(c)||Ht["Private Use Area"](c)||Ht["CJK Compatibility Forms"](c)||Ht["Small Form Variants"](c)||Ht["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)})(a))}function ka(a){return a>=1424&&a<=2303||Ht["Arabic Presentation Forms-A"](a)||Ht["Arabic Presentation Forms-B"](a)}function Vo(a,c){return!(!c&&ka(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ht.Khmer(a))}function Tg(a){for(var c=0,f=a;c<f.length;c+=1)if(ka(f[c].charCodeAt(0)))return!0;return!1}var Rg=null,Bo="unavailable",su=null,h1=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Bo="error"),Rg&&Rg(a)};function Yf(){p_.fire(new Ae("pluginStateChange",{pluginStatus:Bo,pluginURL:su}))}var p_=new ze,g_=function(){return Bo},ol=function(){if(Bo!=="deferred"||!su)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bo="loading",Yf(),su&&Ml({url:su},(function(a){a?h1(a):(Bo="loaded",Yf())}))},da={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Bo==="loaded"||da.applyArabicShaping!=null},isLoading:function(){return Bo==="loading"},setState:function(a){Bo=a.pluginStatus,su=a.pluginURL},isParsed:function(){return da.applyArabicShaping!=null&&da.processBidirectionalText!=null&&da.processStyledBidirectionalText!=null},getPluginURL:function(){return su}},li=function(a,c){this.zoom=a,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new h_,this.transition={})};li.prototype.isSupportedScript=function(a){return(function(c,f){for(var v=0,I=c;v<I.length;v+=1)if(!Vo(I[v].charCodeAt(0),f))return!1;return!0})(a,da.isLoaded())},li.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},li.prototype.getCrossfadeParameters=function(){var a=this.zoom,c=a-Math.floor(a),f=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}};var Ll=function(a,c){this.property=a,this.value=c,this.expression=(function(f,v){if(_g(f))return new gd(f,v);if(Nf(f)){var I=i1(f,v);if(I.result==="error")throw new Error(I.value.map((function(R){return R.key+": "+R.message})).join(", "));return I.value}var A=f;return typeof f=="string"&&v.type==="color"&&(A=bi.parse(f)),{kind:"constant",evaluate:function(){return A}}})(c===void 0?a.specification.default:c,a.specification)};Ll.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Ll.prototype.possiblyEvaluate=function(a,c,f){return this.property.possiblyEvaluate(this,a,c,f)};var La=function(a){this.property=a,this.value=new Ll(a,void 0)};La.prototype.transitioned=function(a,c){return new ih(this.property,this.value,c,M({},a.transition,this.transition),a.now)},La.prototype.untransitioned=function(){return new ih(this.property,this.value,null,{},0)};var Us=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};Us.prototype.getValue=function(a){return pe(this._values[a].value.value)},Us.prototype.setValue=function(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new La(this._values[a].property)),this._values[a].value=new Ll(this._values[a].property,c===null?void 0:pe(c))},Us.prototype.getTransition=function(a){return pe(this._values[a].transition)},Us.prototype.setTransition=function(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new La(this._values[a].property)),this._values[a].transition=pe(c)||void 0},Us.prototype.serialize=function(){for(var a={},c=0,f=Object.keys(this._values);c<f.length;c+=1){var v=f[c],I=this.getValue(v);I!==void 0&&(a[v]=I);var A=this.getTransition(v);A!==void 0&&(a[v+"-transition"]=A)}return a},Us.prototype.transitioned=function(a,c){for(var f=new qu(this._properties),v=0,I=Object.keys(this._values);v<I.length;v+=1){var A=I[v];f._values[A]=this._values[A].transitioned(a,c._values[A])}return f},Us.prototype.untransitioned=function(){for(var a=new qu(this._properties),c=0,f=Object.keys(this._values);c<f.length;c+=1){var v=f[c];a._values[v]=this._values[v].untransitioned()}return a};var ih=function(a,c,f,v,I){this.property=a,this.value=c,this.begin=I+v.delay||0,this.end=this.begin+v.duration||0,a.specification.transition&&(v.delay||v.duration)&&(this.prior=f)};ih.prototype.possiblyEvaluate=function(a,c,f){var v=a.now||0,I=this.value.possiblyEvaluate(a,c,f),A=this.prior;if(A){if(v>this.end)return this.prior=null,I;if(this.value.isDataDriven())return this.prior=null,I;if(v<this.begin)return A.possiblyEvaluate(a,c,f);var R=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(a,c,f),I,(function(O){if(O<=0)return 0;if(O>=1)return 1;var Z=O*O,X=Z*O;return 4*(O<.5?X:3*(O-Z)+X-.75)})(R))}return I};var qu=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};qu.prototype.possiblyEvaluate=function(a,c,f){for(var v=new Hf(this._properties),I=0,A=Object.keys(this._values);I<A.length;I+=1){var R=A[I];v._values[R]=this._values[R].possiblyEvaluate(a,c,f)}return v},qu.prototype.hasTransition=function(){for(var a=0,c=Object.keys(this._values);a<c.length;a+=1)if(this._values[c[a]].prior)return!0;return!1};var al=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};al.prototype.getValue=function(a){return pe(this._values[a].value)},al.prototype.setValue=function(a,c){this._values[a]=new Ll(this._values[a].property,c===null?void 0:pe(c))},al.prototype.serialize=function(){for(var a={},c=0,f=Object.keys(this._values);c<f.length;c+=1){var v=f[c],I=this.getValue(v);I!==void 0&&(a[v]=I)}return a},al.prototype.possiblyEvaluate=function(a,c,f){for(var v=new Hf(this._properties),I=0,A=Object.keys(this._values);I<A.length;I+=1){var R=A[I];v._values[R]=this._values[R].possiblyEvaluate(a,c,f)}return v};var lo=function(a,c,f){this.property=a,this.value=c,this.parameters=f};lo.prototype.isConstant=function(){return this.value.kind==="constant"},lo.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},lo.prototype.evaluate=function(a,c,f,v){return this.property.evaluate(this.value,this.parameters,a,c,f,v)};var Hf=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};Hf.prototype.get=function(a){return this._values[a]};var _n=function(a){this.specification=a};_n.prototype.possiblyEvaluate=function(a,c){return a.expression.evaluate(c)},_n.prototype.interpolate=function(a,c,f){var v=hd[this.specification.type];return v?v(a,c,f):a};var ln=function(a,c){this.specification=a,this.overrides=c};ln.prototype.possiblyEvaluate=function(a,c,f,v){return new lo(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(c,null,{},f,v)}:a.expression,c)},ln.prototype.interpolate=function(a,c,f){if(a.value.kind!=="constant"||c.value.kind!=="constant")return a;if(a.value.value===void 0||c.value.value===void 0)return new lo(this,{kind:"constant",value:void 0},a.parameters);var v=hd[this.specification.type];return v?new lo(this,{kind:"constant",value:v(a.value.value,c.value.value,f)},a.parameters):a},ln.prototype.evaluate=function(a,c,f,v,I,A){return a.kind==="constant"?a.value:a.evaluate(c,f,v,I,A)};var Mg=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.possiblyEvaluate=function(f,v,I,A){if(f.value===void 0)return new lo(this,{kind:"constant",value:void 0},v);if(f.expression.kind==="constant"){var R=f.expression.evaluate(v,null,{},I,A),O=f.property.specification.type==="resolvedImage"&&typeof R!="string"?R.name:R,Z=this._calculate(O,O,O,v);return new lo(this,{kind:"constant",value:Z},v)}if(f.expression.kind==="camera"){var X=this._calculate(f.expression.evaluate({zoom:v.zoom-1}),f.expression.evaluate({zoom:v.zoom}),f.expression.evaluate({zoom:v.zoom+1}),v);return new lo(this,{kind:"constant",value:X},v)}return new lo(this,f.expression,v)},c.prototype.evaluate=function(f,v,I,A,R,O){if(f.kind==="source"){var Z=f.evaluate(v,I,A,R,O);return this._calculate(Z,Z,Z,v)}return f.kind==="composite"?this._calculate(f.evaluate({zoom:Math.floor(v.zoom)-1},I,A),f.evaluate({zoom:Math.floor(v.zoom)},I,A),f.evaluate({zoom:Math.floor(v.zoom)+1},I,A),v):f.value},c.prototype._calculate=function(f,v,I,A){return A.zoom>A.zoomHistory.lastIntegerZoom?{from:f,to:v}:{from:I,to:v}},c.prototype.interpolate=function(f){return f},c})(ln),uo=function(a){this.specification=a};uo.prototype.possiblyEvaluate=function(a,c,f,v){if(a.value!==void 0){if(a.expression.kind==="constant"){var I=a.expression.evaluate(c,null,{},f,v);return this._calculate(I,I,I,c)}return this._calculate(a.expression.evaluate(new li(Math.floor(c.zoom-1),c)),a.expression.evaluate(new li(Math.floor(c.zoom),c)),a.expression.evaluate(new li(Math.floor(c.zoom+1),c)),c)}},uo.prototype._calculate=function(a,c,f,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:a,to:c}:{from:f,to:c}},uo.prototype.interpolate=function(a){return a};var ll=function(a){this.specification=a};ll.prototype.possiblyEvaluate=function(a,c,f,v){return!!a.expression.evaluate(c,null,{},f,v)},ll.prototype.interpolate=function(){return!1};var Xs=function(a){for(var c in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var f=a[c];f.specification.overridable&&this.overridableProperties.push(c);var v=this.defaultPropertyValues[c]=new Ll(f,void 0),I=this.defaultTransitionablePropertyValues[c]=new La(f);this.defaultTransitioningPropertyValues[c]=I.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=v.possiblyEvaluate({})}};sn("DataDrivenProperty",ln),sn("DataConstantProperty",_n),sn("CrossFadedDataDrivenProperty",Mg),sn("CrossFadedProperty",uo),sn("ColorRampProperty",ll);var Pl=(function(a){function c(f,v){if(a.call(this),this.id=f.id,this.type=f.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},f.type!=="custom"&&(this.metadata=(f=f).metadata,this.minzoom=f.minzoom,this.maxzoom=f.maxzoom,f.type!=="background"&&(this.source=f.source,this.sourceLayer=f["source-layer"],this.filter=f.filter),v.layout&&(this._unevaluatedLayout=new al(v.layout)),v.paint)){for(var I in this._transitionablePaint=new Us(v.paint),f.paint)this.setPaintProperty(I,f.paint[I],{validate:!1});for(var A in f.layout)this.setLayoutProperty(A,f.layout[A],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Hf(v.paint)}}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},c.prototype.getLayoutProperty=function(f){return f==="visibility"?this.visibility:this._unevaluatedLayout.getValue(f)},c.prototype.setLayoutProperty=function(f,v,I){I===void 0&&(I={}),v!=null&&this._validate(zf,"layers."+this.id+".layout."+f,f,v,I)||(f!=="visibility"?this._unevaluatedLayout.setValue(f,v):this.visibility=v)},c.prototype.getPaintProperty=function(f){return J(f,"-transition")?this._transitionablePaint.getTransition(f.slice(0,-11)):this._transitionablePaint.getValue(f)},c.prototype.setPaintProperty=function(f,v,I){if(I===void 0&&(I={}),v!=null&&this._validate(MA,"layers."+this.id+".paint."+f,f,v,I))return!1;if(J(f,"-transition"))return this._transitionablePaint.setTransition(f.slice(0,-11),v||void 0),!1;var A=this._transitionablePaint._values[f],R=A.property.specification["property-type"]==="cross-faded-data-driven",O=A.value.isDataDriven(),Z=A.value;this._transitionablePaint.setValue(f,v),this._handleSpecialPaintPropertyUpdate(f);var X=this._transitionablePaint._values[f].value;return X.isDataDriven()||O||R||this._handleOverridablePaintPropertyUpdate(f,Z,X)},c.prototype._handleSpecialPaintPropertyUpdate=function(f){},c.prototype._handleOverridablePaintPropertyUpdate=function(f,v,I){return!1},c.prototype.isHidden=function(f){return!!(this.minzoom&&f<this.minzoom)||!!(this.maxzoom&&f>=this.maxzoom)||this.visibility==="none"},c.prototype.updateTransitions=function(f){this._transitioningPaint=this._transitionablePaint.transitioned(f,this._transitioningPaint)},c.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},c.prototype.recalculate=function(f,v){f.getCrossfadeParameters&&(this._crossfadeParameters=f.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(f,void 0,v)),this.paint=this._transitioningPaint.possiblyEvaluate(f,void 0,v)},c.prototype.serialize=function(){var f={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(f.layout=f.layout||{},f.layout.visibility=this.visibility),ce(f,(function(v,I){return!(v===void 0||I==="layout"&&!Object.keys(v).length||I==="paint"&&!Object.keys(v).length)}))},c.prototype._validate=function(f,v,I,A,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Uf(this,f.call(Wf,{key:v,layerType:this.type,objectKey:I,value:A,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))},c.prototype.is3D=function(){return!1},c.prototype.isTileClipped=function(){return!1},c.prototype.hasOffscreenPass=function(){return!1},c.prototype.resize=function(){},c.prototype.isStateDependent=function(){for(var f in this.paint._values){var v=this.paint.get(f);if(v instanceof lo&&Qc(v.property.specification)&&(v.value.kind==="source"||v.value.kind==="composite")&&v.value.isStateDependent)return!0}return!1},c})(ze),m_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},kg=function(a,c){this._structArray=a,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Di=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Rs(a,c){c===void 0&&(c=1);var f=0,v=0;return{members:a.map((function(I){var A=m_[I.type].BYTES_PER_ELEMENT,R=f=d1(f,Math.max(c,A)),O=I.components||1;return v=Math.max(v,A),f+=A*O,{name:I.name,type:I.type,components:O,offset:R}})),size:d1(f,Math.max(v,c)),alignment:c}}function d1(a,c){return Math.ceil(a/c)*c}Di.serialize=function(a,c){return a._trim(),c&&(a.isTransferred=!0,c.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Di.deserialize=function(a){var c=Object.create(this.prototype);return c.arrayBuffer=a.arrayBuffer,c.length=a.length,c.capacity=a.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c},Di.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Di.prototype.clear=function(){this.length=0},Di.prototype.resize=function(a){this.reserve(a),this.length=a},Di.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}},Di.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var rh=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v){var I=this.length;return this.resize(I+1),this.emplace(I,f,v)},c.prototype.emplace=function(f,v,I){var A=2*f;return this.int16[A+0]=v,this.int16[A+1]=I,f},c})(Di);rh.prototype.bytesPerElement=4,sn("StructArrayLayout2i4",rh);var y_=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A){var R=this.length;return this.resize(R+1),this.emplace(R,f,v,I,A)},c.prototype.emplace=function(f,v,I,A,R){var O=4*f;return this.int16[O+0]=v,this.int16[O+1]=I,this.int16[O+2]=A,this.int16[O+3]=R,f},c})(Di);y_.prototype.bytesPerElement=8,sn("StructArrayLayout4i8",y_);var ou=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,O){var Z=this.length;return this.resize(Z+1),this.emplace(Z,f,v,I,A,R,O)},c.prototype.emplace=function(f,v,I,A,R,O,Z){var X=6*f;return this.int16[X+0]=v,this.int16[X+1]=I,this.int16[X+2]=A,this.int16[X+3]=R,this.int16[X+4]=O,this.int16[X+5]=Z,f},c})(Di);ou.prototype.bytesPerElement=12,sn("StructArrayLayout2i4i12",ou);var Zo=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,O){var Z=this.length;return this.resize(Z+1),this.emplace(Z,f,v,I,A,R,O)},c.prototype.emplace=function(f,v,I,A,R,O,Z){var X=4*f,$=8*f;return this.int16[X+0]=v,this.int16[X+1]=I,this.uint8[$+4]=A,this.uint8[$+5]=R,this.uint8[$+6]=O,this.uint8[$+7]=Z,f},c})(Di);Zo.prototype.bytesPerElement=8,sn("StructArrayLayout2i4ub8",Zo);var _d=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v){var I=this.length;return this.resize(I+1),this.emplace(I,f,v)},c.prototype.emplace=function(f,v,I){var A=2*f;return this.float32[A+0]=v,this.float32[A+1]=I,f},c})(Di);_d.prototype.bytesPerElement=8,sn("StructArrayLayout2f8",_d);var Gl=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,O,Z,X,$,ne){var de=this.length;return this.resize(de+1),this.emplace(de,f,v,I,A,R,O,Z,X,$,ne)},c.prototype.emplace=function(f,v,I,A,R,O,Z,X,$,ne,de){var _e=10*f;return this.uint16[_e+0]=v,this.uint16[_e+1]=I,this.uint16[_e+2]=A,this.uint16[_e+3]=R,this.uint16[_e+4]=O,this.uint16[_e+5]=Z,this.uint16[_e+6]=X,this.uint16[_e+7]=$,this.uint16[_e+8]=ne,this.uint16[_e+9]=de,f},c})(Di);Gl.prototype.bytesPerElement=20,sn("StructArrayLayout10ui20",Gl);var Lg=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,O,Z,X,$,ne,de,_e){var Me=this.length;return this.resize(Me+1),this.emplace(Me,f,v,I,A,R,O,Z,X,$,ne,de,_e)},c.prototype.emplace=function(f,v,I,A,R,O,Z,X,$,ne,de,_e,Me){var Pe=12*f;return this.int16[Pe+0]=v,this.int16[Pe+1]=I,this.int16[Pe+2]=A,this.int16[Pe+3]=R,this.uint16[Pe+4]=O,this.uint16[Pe+5]=Z,this.uint16[Pe+6]=X,this.uint16[Pe+7]=$,this.int16[Pe+8]=ne,this.int16[Pe+9]=de,this.int16[Pe+10]=_e,this.int16[Pe+11]=Me,f},c})(Di);Lg.prototype.bytesPerElement=24,sn("StructArrayLayout4i4ui4i24",Lg);var vd=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I){var A=this.length;return this.resize(A+1),this.emplace(A,f,v,I)},c.prototype.emplace=function(f,v,I,A){var R=3*f;return this.float32[R+0]=v,this.float32[R+1]=I,this.float32[R+2]=A,f},c})(Di);vd.prototype.bytesPerElement=12,sn("StructArrayLayout3f12",vd);var Kf=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f){var v=this.length;return this.resize(v+1),this.emplace(v,f)},c.prototype.emplace=function(f,v){return this.uint32[1*f+0]=v,f},c})(Di);Kf.prototype.bytesPerElement=4,sn("StructArrayLayout1ul4",Kf);var __=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,O,Z,X,$){var ne=this.length;return this.resize(ne+1),this.emplace(ne,f,v,I,A,R,O,Z,X,$)},c.prototype.emplace=function(f,v,I,A,R,O,Z,X,$,ne){var de=10*f,_e=5*f;return this.int16[de+0]=v,this.int16[de+1]=I,this.int16[de+2]=A,this.int16[de+3]=R,this.int16[de+4]=O,this.int16[de+5]=Z,this.uint32[_e+3]=X,this.uint16[de+8]=$,this.uint16[de+9]=ne,f},c})(Di);__.prototype.bytesPerElement=20,sn("StructArrayLayout6i1ul2ui20",__);var bd=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,O){var Z=this.length;return this.resize(Z+1),this.emplace(Z,f,v,I,A,R,O)},c.prototype.emplace=function(f,v,I,A,R,O,Z){var X=6*f;return this.int16[X+0]=v,this.int16[X+1]=I,this.int16[X+2]=A,this.int16[X+3]=R,this.int16[X+4]=O,this.int16[X+5]=Z,f},c})(Di);bd.prototype.bytesPerElement=12,sn("StructArrayLayout2i2i2i12",bd);var sh=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R){var O=this.length;return this.resize(O+1),this.emplace(O,f,v,I,A,R)},c.prototype.emplace=function(f,v,I,A,R,O){var Z=4*f,X=8*f;return this.float32[Z+0]=v,this.float32[Z+1]=I,this.float32[Z+2]=A,this.int16[X+6]=R,this.int16[X+7]=O,f},c})(Di);sh.prototype.bytesPerElement=16,sn("StructArrayLayout2f1f2i16",sh);var v_=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A){var R=this.length;return this.resize(R+1),this.emplace(R,f,v,I,A)},c.prototype.emplace=function(f,v,I,A,R){var O=12*f,Z=3*f;return this.uint8[O+0]=v,this.uint8[O+1]=I,this.float32[Z+1]=A,this.float32[Z+2]=R,f},c})(Di);v_.prototype.bytesPerElement=12,sn("StructArrayLayout2ub2f12",v_);var Qu=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I){var A=this.length;return this.resize(A+1),this.emplace(A,f,v,I)},c.prototype.emplace=function(f,v,I,A){var R=3*f;return this.uint16[R+0]=v,this.uint16[R+1]=I,this.uint16[R+2]=A,f},c})(Di);Qu.prototype.bytesPerElement=6,sn("StructArrayLayout3ui6",Qu);var ec=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,O,Z,X,$,ne,de,_e,Me,Pe,He,Ve,et){var it=this.length;return this.resize(it+1),this.emplace(it,f,v,I,A,R,O,Z,X,$,ne,de,_e,Me,Pe,He,Ve,et)},c.prototype.emplace=function(f,v,I,A,R,O,Z,X,$,ne,de,_e,Me,Pe,He,Ve,et,it){var rt=24*f,lt=12*f,yt=48*f;return this.int16[rt+0]=v,this.int16[rt+1]=I,this.uint16[rt+2]=A,this.uint16[rt+3]=R,this.uint32[lt+2]=O,this.uint32[lt+3]=Z,this.uint32[lt+4]=X,this.uint16[rt+10]=$,this.uint16[rt+11]=ne,this.uint16[rt+12]=de,this.float32[lt+7]=_e,this.float32[lt+8]=Me,this.uint8[yt+36]=Pe,this.uint8[yt+37]=He,this.uint8[yt+38]=Ve,this.uint32[lt+10]=et,this.int16[rt+22]=it,f},c})(Di);ec.prototype.bytesPerElement=48,sn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ec);var Pg=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A,R,O,Z,X,$,ne,de,_e,Me,Pe,He,Ve,et,it,rt,lt,yt,Rt,Zt,gn,Jt,bn,Qt,jn){var Mn=this.length;return this.resize(Mn+1),this.emplace(Mn,f,v,I,A,R,O,Z,X,$,ne,de,_e,Me,Pe,He,Ve,et,it,rt,lt,yt,Rt,Zt,gn,Jt,bn,Qt,jn)},c.prototype.emplace=function(f,v,I,A,R,O,Z,X,$,ne,de,_e,Me,Pe,He,Ve,et,it,rt,lt,yt,Rt,Zt,gn,Jt,bn,Qt,jn,Mn){var un=34*f,ni=17*f;return this.int16[un+0]=v,this.int16[un+1]=I,this.int16[un+2]=A,this.int16[un+3]=R,this.int16[un+4]=O,this.int16[un+5]=Z,this.int16[un+6]=X,this.int16[un+7]=$,this.uint16[un+8]=ne,this.uint16[un+9]=de,this.uint16[un+10]=_e,this.uint16[un+11]=Me,this.uint16[un+12]=Pe,this.uint16[un+13]=He,this.uint16[un+14]=Ve,this.uint16[un+15]=et,this.uint16[un+16]=it,this.uint16[un+17]=rt,this.uint16[un+18]=lt,this.uint16[un+19]=yt,this.uint16[un+20]=Rt,this.uint16[un+21]=Zt,this.uint16[un+22]=gn,this.uint32[ni+12]=Jt,this.float32[ni+13]=bn,this.float32[ni+14]=Qt,this.float32[ni+15]=jn,this.float32[ni+16]=Mn,f},c})(Di);Pg.prototype.bytesPerElement=68,sn("StructArrayLayout8i15ui1ul4f68",Pg);var tc=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f){var v=this.length;return this.resize(v+1),this.emplace(v,f)},c.prototype.emplace=function(f,v){return this.float32[1*f+0]=v,f},c})(Di);tc.prototype.bytesPerElement=4,sn("StructArrayLayout1f4",tc);var Pa=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I){var A=this.length;return this.resize(A+1),this.emplace(A,f,v,I)},c.prototype.emplace=function(f,v,I,A){var R=3*f;return this.int16[R+0]=v,this.int16[R+1]=I,this.int16[R+2]=A,f},c})(Di);Pa.prototype.bytesPerElement=6,sn("StructArrayLayout3i6",Pa);var b_=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I){var A=this.length;return this.resize(A+1),this.emplace(A,f,v,I)},c.prototype.emplace=function(f,v,I,A){var R=4*f;return this.uint32[2*f+0]=v,this.uint16[R+2]=I,this.uint16[R+3]=A,f},c})(Di);b_.prototype.bytesPerElement=8,sn("StructArrayLayout1ul2ui8",b_);var jf=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v){var I=this.length;return this.resize(I+1),this.emplace(I,f,v)},c.prototype.emplace=function(f,v,I){var A=2*f;return this.uint16[A+0]=v,this.uint16[A+1]=I,f},c})(Di);jf.prototype.bytesPerElement=4,sn("StructArrayLayout2ui4",jf);var x_=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f){var v=this.length;return this.resize(v+1),this.emplace(v,f)},c.prototype.emplace=function(f,v){return this.uint16[1*f+0]=v,f},c})(Di);x_.prototype.bytesPerElement=2,sn("StructArrayLayout1ui2",x_);var Gg=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},c.prototype.emplaceBack=function(f,v,I,A){var R=this.length;return this.resize(R+1),this.emplace(R,f,v,I,A)},c.prototype.emplace=function(f,v,I,A,R){var O=4*f;return this.float32[O+0]=v,this.float32[O+1]=I,this.float32[O+2]=A,this.float32[O+3]=R,f},c})(Di);Gg.prototype.bytesPerElement=16,sn("StructArrayLayout4f16",Gg);var p=(function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c;var f={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return f.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},f.x1.get=function(){return this._structArray.int16[this._pos2+2]},f.y1.get=function(){return this._structArray.int16[this._pos2+3]},f.x2.get=function(){return this._structArray.int16[this._pos2+4]},f.y2.get=function(){return this._structArray.int16[this._pos2+5]},f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.anchorPoint.get=function(){return new d(this.anchorPointX,this.anchorPointY)},Object.defineProperties(c.prototype,f),c})(kg);p.prototype.size=20;var _=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.get=function(f){return new p(this,f)},c})(__);sn("CollisionBoxArray",_);var g=(function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},f.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},f.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},f.segment.get=function(){return this._structArray.uint16[this._pos2+10]},f.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},f.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},f.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},f.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},f.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},f.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},f.placedOrientation.set=function(v){this._structArray.uint8[this._pos1+37]=v},f.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},f.hidden.set=function(v){this._structArray.uint8[this._pos1+38]=v},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},f.crossTileID.set=function(v){this._structArray.uint32[this._pos4+10]=v},f.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(c.prototype,f),c})(kg);g.prototype.size=48;var b=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.get=function(f){return new g(this,f)},c})(ec);sn("PlacedSymbolArray",b);var E=(function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},f.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},f.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},f.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},f.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},f.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},f.key.get=function(){return this._structArray.uint16[this._pos2+8]},f.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},f.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},f.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},f.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},f.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},f.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},f.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},f.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},f.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},f.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},f.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},f.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},f.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},f.crossTileID.set=function(v){this._structArray.uint32[this._pos4+12]=v},f.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},f.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},f.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},f.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(c.prototype,f),c})(kg);E.prototype.size=68;var L=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.get=function(f){return new E(this,f)},c})(Pg);sn("SymbolInstanceArray",L);var F=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.getoffsetX=function(f){return this.float32[1*f+0]},c})(tc);sn("GlyphOffsetArray",F);var B=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.getx=function(f){return this.int16[3*f+0]},c.prototype.gety=function(f){return this.int16[3*f+1]},c.prototype.gettileUnitDistanceFromAnchor=function(f){return this.int16[3*f+2]},c})(Pa);sn("SymbolLineVertexArray",B);var H=(function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c;var f={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(c.prototype,f),c})(kg);H.prototype.size=8;var ae=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.get=function(f){return new H(this,f)},c})(b_);sn("FeatureIndexArray",ae);var ve=Rs([{name:"a_pos",components:2,type:"Int16"}],4).members,be=function(a){a===void 0&&(a=[]),this.segments=a};function Ie(a,c){return 256*(a=S(Math.floor(a),0,255))+S(Math.floor(c),0,255)}be.prototype.prepareSegment=function(a,c,f,v){var I=this.segments[this.segments.length-1];return a>be.MAX_VERTEX_ARRAY_LENGTH&&he("Max vertices per segment is "+be.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!I||I.vertexLength+a>be.MAX_VERTEX_ARRAY_LENGTH||I.sortKey!==v)&&(I={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},v!==void 0&&(I.sortKey=v),this.segments.push(I)),I},be.prototype.get=function(){return this.segments},be.prototype.destroy=function(){for(var a=0,c=this.segments;a<c.length;a+=1){var f=c[a];for(var v in f.vaos)f.vaos[v].destroy()}},be.simpleSegment=function(a,c,f,v){return new be([{vertexOffset:a,primitiveOffset:c,vertexLength:f,primitiveLength:v,vaos:{},sortKey:0}])},be.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,sn("SegmentVector",be);var Oe=Rs([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Fe=l((function(a){a.exports=function(c,f){var v,I,A,R,O,Z,X,$;for(I=c.length-(v=3&c.length),A=f,O=3432918353,Z=461845907,$=0;$<I;)X=255&c.charCodeAt($)|(255&c.charCodeAt(++$))<<8|(255&c.charCodeAt(++$))<<16|(255&c.charCodeAt(++$))<<24,++$,A=27492+(65535&(R=5*(65535&(A=(A^=X=(65535&(X=(X=(65535&X)*O+(((X>>>16)*O&65535)<<16)&4294967295)<<15|X>>>17))*Z+(((X>>>16)*Z&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch(X=0,v){case 3:X^=(255&c.charCodeAt($+2))<<16;case 2:X^=(255&c.charCodeAt($+1))<<8;case 1:A^=X=(65535&(X=(X=(65535&(X^=255&c.charCodeAt($)))*O+(((X>>>16)*O&65535)<<16)&4294967295)<<15|X>>>17))*Z+(((X>>>16)*Z&65535)<<16)&4294967295}return A^=c.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0}})),Xe=l((function(a){a.exports=function(c,f){for(var v,I=c.length,A=f^I,R=0;I>=4;)v=1540483477*(65535&(v=255&c.charCodeAt(R)|(255&c.charCodeAt(++R))<<8|(255&c.charCodeAt(++R))<<16|(255&c.charCodeAt(++R))<<24))+((1540483477*(v>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(v=1540483477*(65535&(v^=v>>>24))+((1540483477*(v>>>16)&65535)<<16)),I-=4,++R;switch(I){case 3:A^=(255&c.charCodeAt(R+2))<<16;case 2:A^=(255&c.charCodeAt(R+1))<<8;case 1:A=1540483477*(65535&(A^=255&c.charCodeAt(R)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0}})),Ee=Fe,Ue=Xe;Ee.murmur3=Fe,Ee.murmur2=Ue;var je=function(){this.ids=[],this.positions=[],this.indexed=!1};je.prototype.add=function(a,c,f,v){this.ids.push(ut(a)),this.positions.push(c,f,v)},je.prototype.getPositions=function(a){for(var c=ut(a),f=0,v=this.ids.length-1;f<v;){var I=f+v>>1;this.ids[I]>=c?v=I:f=I+1}for(var A=[];this.ids[f]===c;)A.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return A},je.serialize=function(a,c){var f=new Float64Array(a.ids),v=new Uint32Array(a.positions);return(function I(A,R,O,Z){for(;O<Z;){for(var X=A[O+Z>>1],$=O-1,ne=Z+1;;){do $++;while(A[$]<X);do ne--;while(A[ne]>X);if($>=ne)break;ot(A,$,ne),ot(R,3*$,3*ne),ot(R,3*$+1,3*ne+1),ot(R,3*$+2,3*ne+2)}ne-O<Z-ne?(I(A,R,O,ne),O=ne+1):(I(A,R,ne+1,Z),Z=ne)}})(f,v,0,f.length-1),c&&c.push(f.buffer,v.buffer),{ids:f,positions:v}},je.deserialize=function(a){var c=new je;return c.ids=a.ids,c.positions=a.positions,c.indexed=!0,c};var nt=Math.pow(2,53)-1;function ut(a){var c=+a;return!isNaN(c)&&c<=nt?c:Ee(String(a))}function ot(a,c,f){var v=a[c];a[c]=a[f],a[f]=v}sn("FeaturePositionMap",je);var ht=function(a,c){this.gl=a.gl,this.location=c},vt=(function(a){function c(f,v){a.call(this,f,v),this.current=0}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))},c})(ht),Nt=(function(a){function c(f,v){a.call(this,f,v),this.current=0}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))},c})(ht),Gt=(function(a){function c(f,v){a.call(this,f,v),this.current=[0,0]}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))},c})(ht),en=(function(a){function c(f,v){a.call(this,f,v),this.current=[0,0,0]}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))},c})(ht),vn=(function(a){function c(f,v){a.call(this,f,v),this.current=[0,0,0,0]}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3]))},c})(ht),wn=(function(a){function c(f,v){a.call(this,f,v),this.current=bi.transparent}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a))},c})(ht),Cn=new Float32Array(16),xi=(function(a){function c(f,v){a.call(this,f,v),this.current=Cn}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.set=function(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(var v=1;v<16;v++)if(f[v]!==this.current[v]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}},c})(ht);function rn(a){return[Ie(255*a.r,255*a.g),Ie(255*a.b,255*a.a)]}var On=function(a,c,f){this.value=a,this.uniformNames=c.map((function(v){return"u_"+v})),this.type=f};On.prototype.setUniform=function(a,c,f){a.set(f.constantOr(this.value))},On.prototype.getBinding=function(a,c,f){return this.type==="color"?new wn(a,c):new Nt(a,c)};var Hn=function(a,c){this.uniformNames=c.map((function(f){return"u_"+f})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Hn.prototype.setConstantPatternPositions=function(a,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=a.tlbr},Hn.prototype.setUniform=function(a,c,f,v){var I=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;I&&a.set(I)},Hn.prototype.getBinding=function(a,c,f){return f.substr(0,9)==="u_pattern"?new vn(a,c):new Nt(a,c)};var Fn=function(a,c,f,v){this.expression=a,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map((function(I){return{name:"a_"+I,type:"Float32",components:f==="color"?2:1,offset:0}})),this.paintVertexArray=new v};Fn.prototype.populatePaintArray=function(a,c,f,v,I){var A=this.paintVertexArray.length,R=this.expression.evaluate(new li(0),c,{},v,[],I);this.paintVertexArray.resize(a),this._setPaintValue(A,a,R)},Fn.prototype.updatePaintArray=function(a,c,f,v){var I=this.expression.evaluate({zoom:0},f,v);this._setPaintValue(a,c,I)},Fn.prototype._setPaintValue=function(a,c,f){if(this.type==="color")for(var v=rn(f),I=a;I<c;I++)this.paintVertexArray.emplace(I,v[0],v[1]);else{for(var A=a;A<c;A++)this.paintVertexArray.emplace(A,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}},Fn.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Fn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Gn=function(a,c,f,v,I,A){this.expression=a,this.uniformNames=c.map((function(R){return"u_"+R+"_t"})),this.type=f,this.useIntegerZoom=v,this.zoom=I,this.maxValue=0,this.paintVertexAttributes=c.map((function(R){return{name:"a_"+R,type:"Float32",components:f==="color"?4:2,offset:0}})),this.paintVertexArray=new A};Gn.prototype.populatePaintArray=function(a,c,f,v,I){var A=this.expression.evaluate(new li(this.zoom),c,{},v,[],I),R=this.expression.evaluate(new li(this.zoom+1),c,{},v,[],I),O=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(O,a,A,R)},Gn.prototype.updatePaintArray=function(a,c,f,v){var I=this.expression.evaluate({zoom:this.zoom},f,v),A=this.expression.evaluate({zoom:this.zoom+1},f,v);this._setPaintValue(a,c,I,A)},Gn.prototype._setPaintValue=function(a,c,f,v){if(this.type==="color")for(var I=rn(f),A=rn(v),R=a;R<c;R++)this.paintVertexArray.emplace(R,I[0],I[1],A[0],A[1]);else{for(var O=a;O<c;O++)this.paintVertexArray.emplace(O,f,v);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(v))}},Gn.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Gn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Gn.prototype.setUniform=function(a,c){var f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,v=S(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);a.set(v)},Gn.prototype.getBinding=function(a,c,f){return new Nt(a,c)};var Yn=function(a,c,f,v,I,A){this.expression=a,this.type=c,this.useIntegerZoom=f,this.zoom=v,this.layerId=A,this.zoomInPaintVertexArray=new I,this.zoomOutPaintVertexArray=new I};Yn.prototype.populatePaintArray=function(a,c,f){var v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(v,a,c.patterns&&c.patterns[this.layerId],f)},Yn.prototype.updatePaintArray=function(a,c,f,v,I){this._setPaintValues(a,c,f.patterns&&f.patterns[this.layerId],I)},Yn.prototype._setPaintValues=function(a,c,f,v){if(v&&f){var I=v[f.min],A=v[f.mid],R=v[f.max];if(I&&A&&R)for(var O=a;O<c;O++)this.zoomInPaintVertexArray.emplace(O,A.tl[0],A.tl[1],A.br[0],A.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],A.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,A.tl[0],A.tl[1],A.br[0],A.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],A.pixelRatio,R.pixelRatio)}},Yn.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,Oe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,Oe.members,this.expression.isStateDependent))},Yn.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Ln=function(a,c,f){this.binders={},this._buffers=[];var v=[];for(var I in a.paint._values)if(f(I)){var A=a.paint.get(I);if(A instanceof lo&&Qc(A.property.specification)){var R=_s(I,a.type),O=A.value,Z=A.property.specification.type,X=A.property.useIntegerZoom,$=A.property.specification["property-type"],ne=$==="cross-faded"||$==="cross-faded-data-driven";if(O.kind==="constant")this.binders[I]=ne?new Hn(O.value,R):new On(O.value,R,Z),v.push("/u_"+I);else if(O.kind==="source"||ne){var de=Fr(I,Z,"source");this.binders[I]=ne?new Yn(O,Z,X,c,de,a.id):new Fn(O,R,Z,de),v.push("/a_"+I)}else{var _e=Fr(I,Z,"composite");this.binders[I]=new Gn(O,R,Z,X,c,_e),v.push("/z_"+I)}}}this.cacheKey=v.sort().join("")};Ln.prototype.getMaxValue=function(a){var c=this.binders[a];return c instanceof Fn||c instanceof Gn?c.maxValue:0},Ln.prototype.populatePaintArrays=function(a,c,f,v,I){for(var A in this.binders){var R=this.binders[A];(R instanceof Fn||R instanceof Gn||R instanceof Yn)&&R.populatePaintArray(a,c,f,v,I)}},Ln.prototype.setConstantPatternPositions=function(a,c){for(var f in this.binders){var v=this.binders[f];v instanceof Hn&&v.setConstantPatternPositions(a,c)}},Ln.prototype.updatePaintArrays=function(a,c,f,v,I){var A=!1;for(var R in a)for(var O=0,Z=c.getPositions(R);O<Z.length;O+=1){var X=Z[O],$=f.feature(X.index);for(var ne in this.binders){var de=this.binders[ne];if((de instanceof Fn||de instanceof Gn||de instanceof Yn)&&de.expression.isStateDependent===!0){var _e=v.paint.get(ne);de.expression=_e.value,de.updatePaintArray(X.start,X.end,$,a[R],I),A=!0}}}return A},Ln.prototype.defines=function(){var a=[];for(var c in this.binders){var f=this.binders[c];(f instanceof On||f instanceof Hn)&&a.push.apply(a,f.uniformNames.map((function(v){return"#define HAS_UNIFORM_"+v})))}return a},Ln.prototype.getBinderAttributes=function(){var a=[];for(var c in this.binders){var f=this.binders[c];if(f instanceof Fn||f instanceof Gn)for(var v=0;v<f.paintVertexAttributes.length;v++)a.push(f.paintVertexAttributes[v].name);else if(f instanceof Yn)for(var I=0;I<Oe.members.length;I++)a.push(Oe.members[I].name)}return a},Ln.prototype.getBinderUniforms=function(){var a=[];for(var c in this.binders){var f=this.binders[c];if(f instanceof On||f instanceof Hn||f instanceof Gn)for(var v=0,I=f.uniformNames;v<I.length;v+=1)a.push(I[v])}return a},Ln.prototype.getPaintVertexBuffers=function(){return this._buffers},Ln.prototype.getUniforms=function(a,c){var f=[];for(var v in this.binders){var I=this.binders[v];if(I instanceof On||I instanceof Hn||I instanceof Gn)for(var A=0,R=I.uniformNames;A<R.length;A+=1){var O=R[A];if(c[O]){var Z=I.getBinding(a,c[O],O);f.push({name:O,property:v,binding:Z})}}}return f},Ln.prototype.setUniforms=function(a,c,f,v){for(var I=0,A=c;I<A.length;I+=1){var R=A[I],O=R.name,Z=R.property;this.binders[Z].setUniform(R.binding,v,f.get(Z),O)}},Ln.prototype.updatePaintBuffers=function(a){for(var c in this._buffers=[],this.binders){var f=this.binders[c];if(a&&f instanceof Yn){var v=a.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(f instanceof Fn||f instanceof Gn)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}},Ln.prototype.upload=function(a){for(var c in this.binders){var f=this.binders[c];(f instanceof Fn||f instanceof Gn||f instanceof Yn)&&f.upload(a)}this.updatePaintBuffers()},Ln.prototype.destroy=function(){for(var a in this.binders){var c=this.binders[a];(c instanceof Fn||c instanceof Gn||c instanceof Yn)&&c.destroy()}};var Tn=function(a,c,f){f===void 0&&(f=function(){return!0}),this.programConfigurations={};for(var v=0,I=a;v<I.length;v+=1){var A=I[v];this.programConfigurations[A.id]=new Ln(A,c,f)}this.needsUpload=!1,this._featureMap=new je,this._bufferOffset=0};function _s(a,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(c+"-","").replace(/-/g,"_")]}function Fr(a,c,f){var v={color:{source:_d,composite:Gg},number:{source:tc,composite:_d}},I=(function(A){return{"line-pattern":{source:Gl,composite:Gl},"fill-pattern":{source:Gl,composite:Gl},"fill-extrusion-pattern":{source:Gl,composite:Gl}}[A]})(a);return I&&I[f]||v[c][f]}Tn.prototype.populatePaintArrays=function(a,c,f,v,I,A){for(var R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(a,c,v,I,A);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Tn.prototype.updatePaintArrays=function(a,c,f,v){for(var I=0,A=f;I<A.length;I+=1){var R=A[I];this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(a,this._featureMap,c,R,v)||this.needsUpload}},Tn.prototype.get=function(a){return this.programConfigurations[a]},Tn.prototype.upload=function(a){if(this.needsUpload){for(var c in this.programConfigurations)this.programConfigurations[c].upload(a);this.needsUpload=!1}},Tn.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},sn("ConstantBinder",On),sn("CrossFadedConstantBinder",Hn),sn("SourceExpressionBinder",Fn),sn("CrossFadedCompositeBinder",Yn),sn("CompositeExpressionBinder",Gn),sn("ProgramConfiguration",Ln,{omit:["_buffers"]}),sn("ProgramConfigurationSet",Tn);var to=Math.pow(2,14)-1,Ms=-to-1;function kr(a){for(var c=8192/a.extent,f=a.loadGeometry(),v=0;v<f.length;v++)for(var I=f[v],A=0;A<I.length;A++){var R=I[A],O=Math.round(R.x*c),Z=Math.round(R.y*c);R.x=S(O,Ms,to),R.y=S(Z,Ms,to),(O<R.x||O>R.x+1||Z<R.y||Z>R.y+1)&&he("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return f}function Xr(a,c){return{type:a.type,id:a.id,properties:a.properties,geometry:c?kr(a):[]}}function Wo(a,c,f,v,I){a.emplaceBack(2*c+(v+1)/2,2*f+(I+1)/2)}var co=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((function(c){return c.id})),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new rh,this.indexArray=new Qu,this.segments=new be,this.programConfigurations=new Tn(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter((function(c){return c.isStateDependent()})).map((function(c){return c.id}))};function nc(a,c){for(var f=0;f<a.length;f++)if(Fl(c,a[f]))return!0;for(var v=0;v<c.length;v++)if(Fl(a,c[v]))return!0;return!!$f(a,c)}function Co(a,c,f){return!!Fl(a,c)||!!ic(c,a,f)}function ul(a,c){if(a.length===1)return Jf(c,a[0]);for(var f=0;f<c.length;f++)for(var v=c[f],I=0;I<v.length;I++)if(Fl(a,v[I]))return!0;for(var A=0;A<a.length;A++)if(Jf(c,a[A]))return!0;for(var R=0;R<c.length;R++)if($f(a,c[R]))return!0;return!1}function Ga(a,c,f){if(a.length>1){if($f(a,c))return!0;for(var v=0;v<c.length;v++)if(ic(c[v],a,f))return!0}for(var I=0;I<a.length;I++)if(ic(a[I],c,f))return!0;return!1}function $f(a,c){if(a.length===0||c.length===0)return!1;for(var f=0;f<a.length-1;f++)for(var v=a[f],I=a[f+1],A=0;A<c.length-1;A++)if(xd(v,I,c[A],c[A+1]))return!0;return!1}function xd(a,c,f,v){return D(a,f,v)!==D(c,f,v)&&D(a,c,f)!==D(a,c,v)}function ic(a,c,f){var v=f*f;if(c.length===1)return a.distSqr(c[0])<v;for(var I=1;I<c.length;I++)if(Id(a,c[I-1],c[I])<v)return!0;return!1}function Id(a,c,f){var v=c.distSqr(f);if(v===0)return a.distSqr(c);var I=((a.x-c.x)*(f.x-c.x)+(a.y-c.y)*(f.y-c.y))/v;return a.distSqr(I<0?c:I>1?f:f.sub(c)._mult(I)._add(c))}function Jf(a,c){for(var f,v,I,A=!1,R=0;R<a.length;R++)for(var O=0,Z=(f=a[R]).length-1;O<f.length;Z=O++)(v=f[O]).y>c.y!=(I=f[Z]).y>c.y&&c.x<(I.x-v.x)*(c.y-v.y)/(I.y-v.y)+v.x&&(A=!A);return A}function Fl(a,c){for(var f=!1,v=0,I=a.length-1;v<a.length;I=v++){var A=a[v],R=a[I];A.y>c.y!=R.y>c.y&&c.x<(R.x-A.x)*(c.y-A.y)/(R.y-A.y)+A.x&&(f=!f)}return f}function qf(a,c,f){var v=f[0],I=f[2];if(a.x<v.x&&c.x<v.x||a.x>I.x&&c.x>I.x||a.y<v.y&&c.y<v.y||a.y>I.y&&c.y>I.y)return!1;var A=D(a,c,f[0]);return A!==D(a,c,f[1])||A!==D(a,c,f[2])||A!==D(a,c,f[3])}function Ol(a,c,f){var v=c.paint.get(a).value;return v.kind==="constant"?v.value:f.programConfigurations.get(c.id).getMaxValue(a)}function vs(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function au(a,c,f,v,I){if(!c[0]&&!c[1])return a;var A=d.convert(c)._mult(I);f==="viewport"&&A._rotate(-v);for(var R=[],O=0;O<a.length;O++)R.push(a[O].sub(A));return R}co.prototype.populate=function(a,c,f){var v=this.layers[0],I=[],A=null;v.type==="circle"&&(A=v.layout.get("circle-sort-key"));for(var R=0,O=a;R<O.length;R+=1){var Z=O[R],X=Z.feature,$=Z.id,ne=Z.index,de=Z.sourceLayerIndex,_e=this.layers[0]._featureFilter.needGeometry,Me=Xr(X,_e);if(this.layers[0]._featureFilter.filter(new li(this.zoom),Me,f)){var Pe=A?A.evaluate(Me,{},f):void 0,He={id:$,properties:X.properties,type:X.type,sourceLayerIndex:de,index:ne,geometry:_e?Me.geometry:kr(X),patterns:{},sortKey:Pe};I.push(He)}}A&&I.sort((function(Zt,gn){return Zt.sortKey-gn.sortKey}));for(var Ve=0,et=I;Ve<et.length;Ve+=1){var it=et[Ve],rt=it.geometry,lt=it.index,yt=it.sourceLayerIndex,Rt=a[lt].feature;this.addFeature(it,rt,lt,f),c.featureIndex.insert(Rt,rt,lt,yt,this.index)}},co.prototype.update=function(a,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,c,this.stateDependentLayers,f)},co.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},co.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},co.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ve),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},co.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},co.prototype.addFeature=function(a,c,f,v){for(var I=0,A=c;I<A.length;I+=1)for(var R=0,O=A[I];R<O.length;R+=1){var Z=O[R],X=Z.x,$=Z.y;if(!(X<0||X>=8192||$<0||$>=8192)){var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),de=ne.vertexLength;Wo(this.layoutVertexArray,X,$,-1,-1),Wo(this.layoutVertexArray,X,$,1,-1),Wo(this.layoutVertexArray,X,$,1,1),Wo(this.layoutVertexArray,X,$,-1,1),this.indexArray.emplaceBack(de,de+1,de+2),this.indexArray.emplaceBack(de,de+3,de+2),ne.vertexLength+=4,ne.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,{},v)},sn("CircleBucket",co,{omit:["layers"]});var rc=new Xs({"circle-sort-key":new ln(ye.layout_circle["circle-sort-key"])}),oh={paint:new Xs({"circle-radius":new ln(ye.paint_circle["circle-radius"]),"circle-color":new ln(ye.paint_circle["circle-color"]),"circle-blur":new ln(ye.paint_circle["circle-blur"]),"circle-opacity":new ln(ye.paint_circle["circle-opacity"]),"circle-translate":new _n(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new _n(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _n(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _n(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ln(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ln(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ln(ye.paint_circle["circle-stroke-opacity"])}),layout:rc},Gi=typeof Float32Array<"u"?Float32Array:Array;function fa(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function wo(a,c,f){var v=c[0],I=c[1],A=c[2],R=c[3],O=c[4],Z=c[5],X=c[6],$=c[7],ne=c[8],de=c[9],_e=c[10],Me=c[11],Pe=c[12],He=c[13],Ve=c[14],et=c[15],it=f[0],rt=f[1],lt=f[2],yt=f[3];return a[0]=it*v+rt*O+lt*ne+yt*Pe,a[1]=it*I+rt*Z+lt*de+yt*He,a[2]=it*A+rt*X+lt*_e+yt*Ve,a[3]=it*R+rt*$+lt*Me+yt*et,a[4]=(it=f[4])*v+(rt=f[5])*O+(lt=f[6])*ne+(yt=f[7])*Pe,a[5]=it*I+rt*Z+lt*de+yt*He,a[6]=it*A+rt*X+lt*_e+yt*Ve,a[7]=it*R+rt*$+lt*Me+yt*et,a[8]=(it=f[8])*v+(rt=f[9])*O+(lt=f[10])*ne+(yt=f[11])*Pe,a[9]=it*I+rt*Z+lt*de+yt*He,a[10]=it*A+rt*X+lt*_e+yt*Ve,a[11]=it*R+rt*$+lt*Me+yt*et,a[12]=(it=f[12])*v+(rt=f[13])*O+(lt=f[14])*ne+(yt=f[15])*Pe,a[13]=it*I+rt*Z+lt*de+yt*He,a[14]=it*A+rt*X+lt*_e+yt*Ve,a[15]=it*R+rt*$+lt*Me+yt*et,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,c=0,f=arguments.length;f--;)c+=a[f]*a[f];return Math.sqrt(c)});var ah,kA=wo;function Fg(a,c,f){var v=c[0],I=c[1],A=c[2],R=c[3];return a[0]=f[0]*v+f[4]*I+f[8]*A+f[12]*R,a[1]=f[1]*v+f[5]*I+f[9]*A+f[13]*R,a[2]=f[2]*v+f[6]*I+f[10]*A+f[14]*R,a[3]=f[3]*v+f[7]*I+f[11]*A+f[15]*R,a}ah=new Gi(3),Gi!=Float32Array&&(ah[0]=0,ah[1]=0,ah[2]=0),(function(){var a=new Gi(4);Gi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)})();var LA=((function(){var a=new Gi(2);Gi!=Float32Array&&(a[0]=0,a[1]=0)})(),(function(a){function c(f){a.call(this,f,oh)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.createBucket=function(f){return new co(f)},c.prototype.queryRadius=function(f){var v=f;return Ol("circle-radius",this,v)+Ol("circle-stroke-width",this,v)+vs(this.paint.get("circle-translate"))},c.prototype.queryIntersectsFeature=function(f,v,I,A,R,O,Z,X){for(var $=au(f,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),O.angle,Z),ne=this.paint.get("circle-radius").evaluate(v,I)+this.paint.get("circle-stroke-width").evaluate(v,I),de=this.paint.get("circle-pitch-alignment")==="map",_e=de?$:(function(Rt,Zt){return Rt.map((function(gn){return Qf(gn,Zt)}))})($,X),Me=de?ne*Z:ne,Pe=0,He=A;Pe<He.length;Pe+=1)for(var Ve=0,et=He[Pe];Ve<et.length;Ve+=1){var it=et[Ve],rt=de?it:Qf(it,X),lt=Me,yt=Fg([],[it.x,it.y,0,1],X);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?lt*=yt[3]/O.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(lt*=O.cameraToCenterDistance/yt[3]),Co(_e,rt,lt))return!0}return!1},c})(Pl));function Qf(a,c){var f=Fg([],[a.x,a.y,0,1],c);return new d(f[0]/f[3],f[1]/f[3])}var f1=(function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c})(co);function Cd(a,c,f,v){var I=c.width,A=c.height;if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==I*A*f)throw new RangeError("mismatched image size")}else v=new Uint8Array(I*A*f);return a.width=I,a.height=A,a.data=v,a}function Og(a,c,f){var v=c.width,I=c.height;if(v!==a.width||I!==a.height){var A=Cd({},{width:v,height:I},f);PA(a,A,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,v),height:Math.min(a.height,I)},f),a.width=v,a.height=I,a.data=A.data}}function PA(a,c,f,v,I,A){if(I.width===0||I.height===0)return c;if(I.width>a.width||I.height>a.height||f.x>a.width-I.width||f.y>a.height-I.height)throw new RangeError("out of range source coordinates for image copy");if(I.width>c.width||I.height>c.height||v.x>c.width-I.width||v.y>c.height-I.height)throw new RangeError("out of range destination coordinates for image copy");for(var R=a.data,O=c.data,Z=0;Z<I.height;Z++)for(var X=((f.y+Z)*a.width+f.x)*A,$=((v.y+Z)*c.width+v.x)*A,ne=0;ne<I.width*A;ne++)O[$+ne]=R[X+ne];return c}sn("HeatmapBucket",f1,{omit:["layers"]});var ep=function(a,c){Cd(this,a,1,c)};ep.prototype.resize=function(a){Og(this,a,1)},ep.prototype.clone=function(){return new ep({width:this.width,height:this.height},new Uint8Array(this.data))},ep.copy=function(a,c,f,v,I){PA(a,c,f,v,I,1)};var zo=function(a,c){Cd(this,a,4,c)};zo.prototype.resize=function(a){Og(this,a,4)},zo.prototype.replace=function(a,c){c?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},zo.prototype.clone=function(){return new zo({width:this.width,height:this.height},new Uint8Array(this.data))},zo.copy=function(a,c,f,v,I){PA(a,c,f,v,I,4)},sn("AlphaImage",ep),sn("RGBAImage",zo);var Az={paint:new Xs({"heatmap-radius":new ln(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ln(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _n(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ll(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _n(ye.paint_heatmap["heatmap-opacity"])})};function Dk(a){var c={},f=a.resolution||256,v=a.clips?a.clips.length:1,I=a.image||new zo({width:f,height:v}),A=function(Me,Pe,He){c[a.evaluationKey]=He;var Ve=a.expression.evaluate(c);I.data[Me+Pe+0]=Math.floor(255*Ve.r/Ve.a),I.data[Me+Pe+1]=Math.floor(255*Ve.g/Ve.a),I.data[Me+Pe+2]=Math.floor(255*Ve.b/Ve.a),I.data[Me+Pe+3]=Math.floor(255*Ve.a)};if(a.clips)for(var R=0,O=0;R<v;++R,O+=4*f)for(var Z=0,X=0;Z<f;Z++,X+=4){var $=Z/(f-1),ne=a.clips[R];A(O,X,ne.start*(1-$)+ne.end*$)}else for(var de=0,_e=0;de<f;de++,_e+=4)A(0,_e,de/(f-1));return I}var Sz=(function(a){function c(f){a.call(this,f,Az),this._updateColorRamp()}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.createBucket=function(f){return new f1(f)},c.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="heatmap-color"&&this._updateColorRamp()},c.prototype._updateColorRamp=function(){this.colorRamp=Dk({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},c.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},c.prototype.queryRadius=function(){return 0},c.prototype.queryIntersectsFeature=function(){return!1},c.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},c})(Pl),Ez={paint:new Xs({"hillshade-illumination-direction":new _n(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _n(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _n(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _n(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _n(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _n(ye.paint_hillshade["hillshade-accent-color"])})},Tz=(function(a){function c(f){a.call(this,f,Ez)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},c})(Pl),Rz=Rs([{name:"a_pos",components:2,type:"Int16"}],4).members,GA=p1,Mz=p1;function p1(a,c,f){f=f||2;var v,I,A,R,O,Z,X,$=c&&c.length,ne=$?c[0]*f:a.length,de=Vk(a,0,ne,f,!0),_e=[];if(!de||de.next===de.prev)return _e;if($&&(de=(function(Pe,He,Ve,et){var it,rt,lt,yt=[];for(it=0,rt=He.length;it<rt;it++)(lt=Vk(Pe,He[it]*et,it<rt-1?He[it+1]*et:Pe.length,et,!1))===lt.next&&(lt.steiner=!0),yt.push(Dz(lt));for(yt.sort(Fz),it=0;it<yt.length;it++)Oz(yt[it],Ve),Ve=wd(Ve,Ve.next);return Ve})(a,c,de,f)),a.length>80*f){v=A=a[0],I=R=a[1];for(var Me=f;Me<ne;Me+=f)(O=a[Me])<v&&(v=O),(Z=a[Me+1])<I&&(I=Z),O>A&&(A=O),Z>R&&(R=Z);X=(X=Math.max(A-v,R-I))!==0?1/X:0}return I_(de,_e,f,v,I,X),_e}function Vk(a,c,f,v,I){var A,R;if(I===NA(a,c,f,v)>0)for(A=c;A<f;A+=v)R=Wk(A,a[A],a[A+1],R);else for(A=f-v;A>=c;A-=v)R=Wk(A,a[A],a[A+1],R);return R&&g1(R,R.next)&&(w_(R),R=R.next),R}function wd(a,c){if(!a)return a;c||(c=a);var f,v=a;do if(f=!1,v.steiner||!g1(v,v.next)&&os(v.prev,v,v.next)!==0)v=v.next;else{if(w_(v),(v=c=v.prev)===v.next)break;f=!0}while(f||v!==c);return c}function I_(a,c,f,v,I,A,R){if(a){!R&&A&&(function($,ne,de,_e){var Me=$;do Me.z===null&&(Me.z=FA(Me.x,Me.y,ne,de,_e)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==$);Me.prevZ.nextZ=null,Me.prevZ=null,(function(Pe){var He,Ve,et,it,rt,lt,yt,Rt,Zt=1;do{for(Ve=Pe,Pe=null,rt=null,lt=0;Ve;){for(lt++,et=Ve,yt=0,He=0;He<Zt&&(yt++,et=et.nextZ);He++);for(Rt=Zt;yt>0||Rt>0&&et;)yt!==0&&(Rt===0||!et||Ve.z<=et.z)?(it=Ve,Ve=Ve.nextZ,yt--):(it=et,et=et.nextZ,Rt--),rt?rt.nextZ=it:Pe=it,it.prevZ=rt,rt=it;Ve=et}rt.nextZ=null,Zt*=2}while(lt>1)})(Me)})(a,v,I,A);for(var O,Z,X=a;a.prev!==a.next;)if(O=a.prev,Z=a.next,A?Lz(a,v,I,A):kz(a))c.push(O.i/f),c.push(a.i/f),c.push(Z.i/f),w_(a),a=Z.next,X=Z.next;else if((a=Z)===X){R?R===1?I_(a=Pz(wd(a),c,f),c,f,v,I,A,2):R===2&&Gz(a,c,f,v,I,A):I_(wd(a),c,f,v,I,A,1);break}}}function kz(a){var c=a.prev,f=a,v=a.next;if(os(c,f,v)>=0)return!1;for(var I=a.next.next;I!==a.prev;){if(Ng(c.x,c.y,f.x,f.y,v.x,v.y,I.x,I.y)&&os(I.prev,I,I.next)>=0)return!1;I=I.next}return!0}function Lz(a,c,f,v){var I=a.prev,A=a,R=a.next;if(os(I,A,R)>=0)return!1;for(var O=I.x>A.x?I.x>R.x?I.x:R.x:A.x>R.x?A.x:R.x,Z=I.y>A.y?I.y>R.y?I.y:R.y:A.y>R.y?A.y:R.y,X=FA(I.x<A.x?I.x<R.x?I.x:R.x:A.x<R.x?A.x:R.x,I.y<A.y?I.y<R.y?I.y:R.y:A.y<R.y?A.y:R.y,c,f,v),$=FA(O,Z,c,f,v),ne=a.prevZ,de=a.nextZ;ne&&ne.z>=X&&de&&de.z<=$;){if(ne!==a.prev&&ne!==a.next&&Ng(I.x,I.y,A.x,A.y,R.x,R.y,ne.x,ne.y)&&os(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,de!==a.prev&&de!==a.next&&Ng(I.x,I.y,A.x,A.y,R.x,R.y,de.x,de.y)&&os(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ne&&ne.z>=X;){if(ne!==a.prev&&ne!==a.next&&Ng(I.x,I.y,A.x,A.y,R.x,R.y,ne.x,ne.y)&&os(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;de&&de.z<=$;){if(de!==a.prev&&de!==a.next&&Ng(I.x,I.y,A.x,A.y,R.x,R.y,de.x,de.y)&&os(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function Pz(a,c,f){var v=a;do{var I=v.prev,A=v.next.next;!g1(I,A)&&Bk(I,v,v.next,A)&&C_(I,A)&&C_(A,I)&&(c.push(I.i/f),c.push(v.i/f),c.push(A.i/f),w_(v),w_(v.next),v=a=A),v=v.next}while(v!==a);return wd(v)}function Gz(a,c,f,v,I,A){var R=a;do{for(var O=R.next.next;O!==R.prev;){if(R.i!==O.i&&Vz(R,O)){var Z=Zk(R,O);return R=wd(R,R.next),Z=wd(Z,Z.next),I_(R,c,f,v,I,A),void I_(Z,c,f,v,I,A)}O=O.next}R=R.next}while(R!==a)}function Fz(a,c){return a.x-c.x}function Oz(a,c){if(c=(function(v,I){var A,R=I,O=v.x,Z=v.y,X=-1/0;do{if(Z<=R.y&&Z>=R.next.y&&R.next.y!==R.y){var $=R.x+(Z-R.y)*(R.next.x-R.x)/(R.next.y-R.y);if($<=O&&$>X){if(X=$,$===O){if(Z===R.y)return R;if(Z===R.next.y)return R.next}A=R.x<R.next.x?R:R.next}}R=R.next}while(R!==I);if(!A)return null;if(O===X)return A;var ne,de=A,_e=A.x,Me=A.y,Pe=1/0;R=A;do O>=R.x&&R.x>=_e&&O!==R.x&&Ng(Z<Me?O:X,Z,_e,Me,Z<Me?X:O,Z,R.x,R.y)&&(ne=Math.abs(Z-R.y)/(O-R.x),C_(R,v)&&(ne<Pe||ne===Pe&&(R.x>A.x||R.x===A.x&&Nz(A,R)))&&(A=R,Pe=ne)),R=R.next;while(R!==de);return A})(a,c)){var f=Zk(c,a);wd(c,c.next),wd(f,f.next)}}function Nz(a,c){return os(a.prev,a,c.prev)<0&&os(c.next,a,a.next)<0}function FA(a,c,f,v,I){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-f)*I)|a<<8))|a<<4))|a<<2))|a<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=32767*(c-v)*I)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function Dz(a){var c=a,f=a;do(c.x<f.x||c.x===f.x&&c.y<f.y)&&(f=c),c=c.next;while(c!==a);return f}function Ng(a,c,f,v,I,A,R,O){return(I-R)*(c-O)-(a-R)*(A-O)>=0&&(a-R)*(v-O)-(f-R)*(c-O)>=0&&(f-R)*(A-O)-(I-R)*(v-O)>=0}function Vz(a,c){return a.next.i!==c.i&&a.prev.i!==c.i&&!(function(f,v){var I=f;do{if(I.i!==f.i&&I.next.i!==f.i&&I.i!==v.i&&I.next.i!==v.i&&Bk(I,I.next,f,v))return!0;I=I.next}while(I!==f);return!1})(a,c)&&(C_(a,c)&&C_(c,a)&&(function(f,v){var I=f,A=!1,R=(f.x+v.x)/2,O=(f.y+v.y)/2;do I.y>O!=I.next.y>O&&I.next.y!==I.y&&R<(I.next.x-I.x)*(O-I.y)/(I.next.y-I.y)+I.x&&(A=!A),I=I.next;while(I!==f);return A})(a,c)&&(os(a.prev,a,c.prev)||os(a,c.prev,c))||g1(a,c)&&os(a.prev,a,a.next)>0&&os(c.prev,c,c.next)>0)}function os(a,c,f){return(c.y-a.y)*(f.x-c.x)-(c.x-a.x)*(f.y-c.y)}function g1(a,c){return a.x===c.x&&a.y===c.y}function Bk(a,c,f,v){var I=y1(os(a,c,f)),A=y1(os(a,c,v)),R=y1(os(f,v,a)),O=y1(os(f,v,c));return I!==A&&R!==O||!(I!==0||!m1(a,f,c))||!(A!==0||!m1(a,v,c))||!(R!==0||!m1(f,a,v))||!(O!==0||!m1(f,c,v))}function m1(a,c,f){return c.x<=Math.max(a.x,f.x)&&c.x>=Math.min(a.x,f.x)&&c.y<=Math.max(a.y,f.y)&&c.y>=Math.min(a.y,f.y)}function y1(a){return a>0?1:a<0?-1:0}function C_(a,c){return os(a.prev,a,a.next)<0?os(a,c,a.next)>=0&&os(a,a.prev,c)>=0:os(a,c,a.prev)<0||os(a,a.next,c)<0}function Zk(a,c){var f=new OA(a.i,a.x,a.y),v=new OA(c.i,c.x,c.y),I=a.next,A=c.prev;return a.next=c,c.prev=a,f.next=I,I.prev=f,v.next=f,f.prev=v,A.next=v,v.prev=A,v}function Wk(a,c,f,v){var I=new OA(a,c,f);return v?(I.next=v.next,I.prev=v,v.next.prev=I,v.next=I):(I.prev=I,I.next=I),I}function w_(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function OA(a,c,f){this.i=a,this.x=c,this.y=f,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function NA(a,c,f,v){for(var I=0,A=c,R=f-v;A<f;A+=v)I+=(a[R]-a[A])*(a[A+1]+a[R+1]),R=A;return I}function Bz(a,c,f,v,I){(function A(R,O,Z,X,$){for(;X>Z;){if(X-Z>600){var ne=X-Z+1,de=O-Z+1,_e=Math.log(ne),Me=.5*Math.exp(2*_e/3),Pe=.5*Math.sqrt(_e*Me*(ne-Me)/ne)*(de-ne/2<0?-1:1);A(R,O,Math.max(Z,Math.floor(O-de*Me/ne+Pe)),Math.min(X,Math.floor(O+(ne-de)*Me/ne+Pe)),$)}var He=R[O],Ve=Z,et=X;for(A_(R,Z,O),$(R[X],He)>0&&A_(R,Z,X);Ve<et;){for(A_(R,Ve,et),Ve++,et--;$(R[Ve],He)<0;)Ve++;for(;$(R[et],He)>0;)et--}$(R[Z],He)===0?A_(R,Z,et):A_(R,++et,X),et<=O&&(Z=et+1),O<=et&&(X=et-1)}})(a,c,f,v||a.length-1,I||Zz)}function A_(a,c,f){var v=a[c];a[c]=a[f],a[f]=v}function Zz(a,c){return a<c?-1:a>c?1:0}function DA(a,c){var f=a.length;if(f<=1)return[a];for(var v,I,A=[],R=0;R<f;R++){var O=re(a[R]);O!==0&&(a[R].area=Math.abs(O),I===void 0&&(I=O<0),I===O<0?(v&&A.push(v),v=[a[R]]):v.push(a[R]))}if(v&&A.push(v),c>1)for(var Z=0;Z<A.length;Z++)A[Z].length<=c||(Bz(A[Z],c,1,A[Z].length-1,Wz),A[Z]=A[Z].slice(0,c));return A}function Wz(a,c){return c.area-a.area}function VA(a,c,f){for(var v=f.patternDependencies,I=!1,A=0,R=c;A<R.length;A+=1){var O=R[A].paint.get(a+"-pattern");O.isConstant()||(I=!0);var Z=O.constantOr(null);Z&&(I=!0,v[Z.to]=!0,v[Z.from]=!0)}return I}function BA(a,c,f,v,I){for(var A=I.patternDependencies,R=0,O=c;R<O.length;R+=1){var Z=O[R],X=Z.paint.get(a+"-pattern").value;if(X.kind!=="constant"){var $=X.evaluate({zoom:v-1},f,{},I.availableImages),ne=X.evaluate({zoom:v},f,{},I.availableImages),de=X.evaluate({zoom:v+1},f,{},I.availableImages);ne=ne&&ne.name?ne.name:ne,de=de&&de.name?de.name:de,A[$=$&&$.name?$.name:$]=!0,A[ne]=!0,A[de]=!0,f.patterns[Z.id]={min:$,mid:ne,max:de}}}return f}p1.deviation=function(a,c,f,v){var I=c&&c.length,A=Math.abs(NA(a,0,I?c[0]*f:a.length,f));if(I)for(var R=0,O=c.length;R<O;R++)A-=Math.abs(NA(a,c[R]*f,R<O-1?c[R+1]*f:a.length,f));var Z=0;for(R=0;R<v.length;R+=3){var X=v[R]*f,$=v[R+1]*f,ne=v[R+2]*f;Z+=Math.abs((a[X]-a[ne])*(a[$+1]-a[X+1])-(a[X]-a[$])*(a[ne+1]-a[X+1]))}return A===0&&Z===0?0:Math.abs((Z-A)/A)},p1.flatten=function(a){for(var c=a[0][0].length,f={vertices:[],holes:[],dimensions:c},v=0,I=0;I<a.length;I++){for(var A=0;A<a[I].length;A++)for(var R=0;R<c;R++)f.vertices.push(a[I][A][R]);I>0&&f.holes.push(v+=a[I-1].length)}return f},GA.default=Mz;var lu=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((function(c){return c.id})),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rh,this.indexArray=new Qu,this.indexArray2=new jf,this.programConfigurations=new Tn(a.layers,a.zoom),this.segments=new be,this.segments2=new be,this.stateDependentLayerIds=this.layers.filter((function(c){return c.isStateDependent()})).map((function(c){return c.id}))};lu.prototype.populate=function(a,c,f){this.hasPattern=VA("fill",this.layers,c);for(var v=this.layers[0].layout.get("fill-sort-key"),I=[],A=0,R=a;A<R.length;A+=1){var O=R[A],Z=O.feature,X=O.id,$=O.index,ne=O.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,_e=Xr(Z,de);if(this.layers[0]._featureFilter.filter(new li(this.zoom),_e,f)){var Me=v?v.evaluate(_e,{},f,c.availableImages):void 0,Pe={id:X,properties:Z.properties,type:Z.type,sourceLayerIndex:ne,index:$,geometry:de?_e.geometry:kr(Z),patterns:{},sortKey:Me};I.push(Pe)}}v&&I.sort((function(Rt,Zt){return Rt.sortKey-Zt.sortKey}));for(var He=0,Ve=I;He<Ve.length;He+=1){var et=Ve[He],it=et.geometry,rt=et.index,lt=et.sourceLayerIndex;if(this.hasPattern){var yt=BA("fill",this.layers,et,this.zoom,c);this.patternFeatures.push(yt)}else this.addFeature(et,it,rt,f,{});c.featureIndex.insert(a[rt].feature,it,rt,lt,this.index)}},lu.prototype.update=function(a,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,c,this.stateDependentLayers,f)},lu.prototype.addFeatures=function(a,c,f){for(var v=0,I=this.patternFeatures;v<I.length;v+=1){var A=I[v];this.addFeature(A,A.geometry,A.index,c,f)}},lu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},lu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},lu.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Rz),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},lu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},lu.prototype.addFeature=function(a,c,f,v,I){for(var A=0,R=DA(c,500);A<R.length;A+=1){for(var O=R[A],Z=0,X=0,$=O;X<$.length;X+=1)Z+=$[X].length;for(var ne=this.segments.prepareSegment(Z,this.layoutVertexArray,this.indexArray),de=ne.vertexLength,_e=[],Me=[],Pe=0,He=O;Pe<He.length;Pe+=1){var Ve=He[Pe];if(Ve.length!==0){Ve!==O[0]&&Me.push(_e.length/2);var et=this.segments2.prepareSegment(Ve.length,this.layoutVertexArray,this.indexArray2),it=et.vertexLength;this.layoutVertexArray.emplaceBack(Ve[0].x,Ve[0].y),this.indexArray2.emplaceBack(it+Ve.length-1,it),_e.push(Ve[0].x),_e.push(Ve[0].y);for(var rt=1;rt<Ve.length;rt++)this.layoutVertexArray.emplaceBack(Ve[rt].x,Ve[rt].y),this.indexArray2.emplaceBack(it+rt-1,it+rt),_e.push(Ve[rt].x),_e.push(Ve[rt].y);et.vertexLength+=Ve.length,et.primitiveLength+=Ve.length}}for(var lt=GA(_e,Me),yt=0;yt<lt.length;yt+=3)this.indexArray.emplaceBack(de+lt[yt],de+lt[yt+1],de+lt[yt+2]);ne.vertexLength+=Z,ne.primitiveLength+=lt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,I,v)},sn("FillBucket",lu,{omit:["layers","patternFeatures"]});var zz=new Xs({"fill-sort-key":new ln(ye.layout_fill["fill-sort-key"])}),Uz={paint:new Xs({"fill-antialias":new _n(ye.paint_fill["fill-antialias"]),"fill-opacity":new ln(ye.paint_fill["fill-opacity"]),"fill-color":new ln(ye.paint_fill["fill-color"]),"fill-outline-color":new ln(ye.paint_fill["fill-outline-color"]),"fill-translate":new _n(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new _n(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mg(ye.paint_fill["fill-pattern"])}),layout:zz},Xz=(function(a){function c(f){a.call(this,f,Uz)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.recalculate=function(f,v){a.prototype.recalculate.call(this,f,v);var I=this.paint._values["fill-outline-color"];I.value.kind==="constant"&&I.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},c.prototype.createBucket=function(f){return new lu(f)},c.prototype.queryRadius=function(){return vs(this.paint.get("fill-translate"))},c.prototype.queryIntersectsFeature=function(f,v,I,A,R,O,Z){return ul(au(f,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),O.angle,Z),A)},c.prototype.isTileClipped=function(){return!0},c})(Pl),Yz=Rs([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,zk=Dg;function Dg(a,c,f,v,I){this.properties={},this.extent=f,this.type=0,this._pbf=a,this._geometry=-1,this._keys=v,this._values=I,a.readFields(Hz,this,c)}function Hz(a,c,f){a==1?c.id=f.readVarint():a==2?(function(v,I){for(var A=v.readVarint()+v.pos;v.pos<A;){var R=I._keys[v.readVarint()],O=I._values[v.readVarint()];I.properties[R]=O}})(f,c):a==3?c.type=f.readVarint():a==4&&(c._geometry=f.pos)}function Kz(a){for(var c,f,v=0,I=0,A=a.length,R=A-1;I<A;R=I++)v+=((f=a[R]).x-(c=a[I]).x)*(c.y+f.y);return v}Dg.types=["Unknown","Point","LineString","Polygon"],Dg.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var c,f=a.readVarint()+a.pos,v=1,I=0,A=0,R=0,O=[];a.pos<f;){if(I<=0){var Z=a.readVarint();v=7&Z,I=Z>>3}if(I--,v===1||v===2)A+=a.readSVarint(),R+=a.readSVarint(),v===1&&(c&&O.push(c),c=[]),c.push(new d(A,R));else{if(v!==7)throw new Error("unknown command "+v);c&&c.push(c[0].clone())}}return c&&O.push(c),O},Dg.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var c=a.readVarint()+a.pos,f=1,v=0,I=0,A=0,R=1/0,O=-1/0,Z=1/0,X=-1/0;a.pos<c;){if(v<=0){var $=a.readVarint();f=7&$,v=$>>3}if(v--,f===1||f===2)(I+=a.readSVarint())<R&&(R=I),I>O&&(O=I),(A+=a.readSVarint())<Z&&(Z=A),A>X&&(X=A);else if(f!==7)throw new Error("unknown command "+f)}return[R,Z,O,X]},Dg.prototype.toGeoJSON=function(a,c,f){var v,I,A=this.extent*Math.pow(2,f),R=this.extent*a,O=this.extent*c,Z=this.loadGeometry(),X=Dg.types[this.type];function $(_e){for(var Me=0;Me<_e.length;Me++){var Pe=_e[Me];_e[Me]=[360*(Pe.x+R)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(Pe.y+O)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var ne=[];for(v=0;v<Z.length;v++)ne[v]=Z[v][0];$(Z=ne);break;case 2:for(v=0;v<Z.length;v++)$(Z[v]);break;case 3:for(Z=(function(_e){var Me=_e.length;if(Me<=1)return[_e];for(var Pe,He,Ve=[],et=0;et<Me;et++){var it=Kz(_e[et]);it!==0&&(He===void 0&&(He=it<0),He===it<0?(Pe&&Ve.push(Pe),Pe=[_e[et]]):Pe.push(_e[et]))}return Pe&&Ve.push(Pe),Ve})(Z),v=0;v<Z.length;v++)for(I=0;I<Z[v].length;I++)$(Z[v][I])}Z.length===1?Z=Z[0]:X="Multi"+X;var de={type:"Feature",geometry:{type:X,coordinates:Z},properties:this.properties};return"id"in this&&(de.id=this.id),de};var Uk=Xk;function Xk(a,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(jz,this,c),this.length=this._features.length}function jz(a,c,f){a===15?c.version=f.readVarint():a===1?c.name=f.readString():a===5?c.extent=f.readVarint():a===2?c._features.push(f.pos):a===3?c._keys.push(f.readString()):a===4&&c._values.push((function(v){for(var I=null,A=v.readVarint()+v.pos;v.pos<A;){var R=v.readVarint()>>3;I=R===1?v.readString():R===2?v.readFloat():R===3?v.readDouble():R===4?v.readVarint64():R===5?v.readVarint():R===6?v.readSVarint():R===7?v.readBoolean():null}return I})(f))}function $z(a,c,f){if(a===3){var v=new Uk(f,f.readVarint()+f.pos);v.length&&(c[v.name]=v)}}Xk.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var c=this._pbf.readVarint()+this._pbf.pos;return new zk(this._pbf,c,this.extent,this._keys,this._values)};var Vg={VectorTile:function(a,c){this.layers=a.readFields($z,{},c)},VectorTileFeature:zk,VectorTileLayer:Uk},Jz=Vg.VectorTileFeature.types,ZA=Math.pow(2,13);function S_(a,c,f,v,I,A,R,O){a.emplaceBack(c,f,2*Math.floor(v*ZA)+R,I*ZA*2,A*ZA*2,Math.round(O))}var uu=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((function(c){return c.id})),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new ou,this.indexArray=new Qu,this.programConfigurations=new Tn(a.layers,a.zoom),this.segments=new be,this.stateDependentLayerIds=this.layers.filter((function(c){return c.isStateDependent()})).map((function(c){return c.id}))};function qz(a,c){return a.x===c.x&&(a.x<0||a.x>8192)||a.y===c.y&&(a.y<0||a.y>8192)}uu.prototype.populate=function(a,c,f){this.features=[],this.hasPattern=VA("fill-extrusion",this.layers,c);for(var v=0,I=a;v<I.length;v+=1){var A=I[v],R=A.feature,O=A.id,Z=A.index,X=A.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,ne=Xr(R,$);if(this.layers[0]._featureFilter.filter(new li(this.zoom),ne,f)){var de={id:O,sourceLayerIndex:X,index:Z,geometry:$?ne.geometry:kr(R),properties:R.properties,type:R.type,patterns:{}};this.hasPattern?this.features.push(BA("fill-extrusion",this.layers,de,this.zoom,c)):this.addFeature(de,de.geometry,Z,f,{}),c.featureIndex.insert(R,de.geometry,Z,X,this.index,!0)}}},uu.prototype.addFeatures=function(a,c,f){for(var v=0,I=this.features;v<I.length;v+=1){var A=I[v];this.addFeature(A,A.geometry,A.index,c,f)}},uu.prototype.update=function(a,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,c,this.stateDependentLayers,f)},uu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},uu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},uu.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Yz),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},uu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},uu.prototype.addFeature=function(a,c,f,v,I){for(var A=0,R=DA(c,500);A<R.length;A+=1){for(var O=R[A],Z=0,X=0,$=O;X<$.length;X+=1)Z+=$[X].length;for(var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),de=0,_e=O;de<_e.length;de+=1){var Me=_e[de];if(Me.length!==0&&!((ni=Me).every((function(Un){return Un.x<0}))||ni.every((function(Un){return Un.x>8192}))||ni.every((function(Un){return Un.y<0}))||ni.every((function(Un){return Un.y>8192}))))for(var Pe=0,He=0;He<Me.length;He++){var Ve=Me[He];if(He>=1){var et=Me[He-1];if(!qz(Ve,et)){ne.vertexLength+4>be.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var it=Ve.sub(et)._perp()._unit(),rt=et.dist(Ve);Pe+rt>32768&&(Pe=0),S_(this.layoutVertexArray,Ve.x,Ve.y,it.x,it.y,0,0,Pe),S_(this.layoutVertexArray,Ve.x,Ve.y,it.x,it.y,0,1,Pe),S_(this.layoutVertexArray,et.x,et.y,it.x,it.y,0,0,Pe+=rt),S_(this.layoutVertexArray,et.x,et.y,it.x,it.y,0,1,Pe);var lt=ne.vertexLength;this.indexArray.emplaceBack(lt,lt+2,lt+1),this.indexArray.emplaceBack(lt+1,lt+2,lt+3),ne.vertexLength+=4,ne.primitiveLength+=2}}}}if(ne.vertexLength+Z>be.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(Z,this.layoutVertexArray,this.indexArray)),Jz[a.type]==="Polygon"){for(var yt=[],Rt=[],Zt=ne.vertexLength,gn=0,Jt=O;gn<Jt.length;gn+=1){var bn=Jt[gn];if(bn.length!==0){bn!==O[0]&&Rt.push(yt.length/2);for(var Qt=0;Qt<bn.length;Qt++){var jn=bn[Qt];S_(this.layoutVertexArray,jn.x,jn.y,0,0,1,1,0),yt.push(jn.x),yt.push(jn.y)}}}for(var Mn=GA(yt,Rt),un=0;un<Mn.length;un+=3)this.indexArray.emplaceBack(Zt+Mn[un],Zt+Mn[un+2],Zt+Mn[un+1]);ne.primitiveLength+=Mn.length/3,ne.vertexLength+=Z}}var ni;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,I,v)},sn("FillExtrusionBucket",uu,{omit:["layers","features"]});var Qz={paint:new Xs({"fill-extrusion-opacity":new _n(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ln(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _n(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _n(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mg(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ln(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ln(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _n(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},e8=(function(a){function c(f){a.call(this,f,Qz)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.createBucket=function(f){return new uu(f)},c.prototype.queryRadius=function(){return vs(this.paint.get("fill-extrusion-translate"))},c.prototype.is3D=function(){return!0},c.prototype.queryIntersectsFeature=function(f,v,I,A,R,O,Z,X){var $=au(f,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),O.angle,Z),ne=this.paint.get("fill-extrusion-height").evaluate(v,I),de=this.paint.get("fill-extrusion-base").evaluate(v,I),_e=(function(Pe,He,Ve,et){for(var it=[],rt=0,lt=Pe;rt<lt.length;rt+=1){var yt=lt[rt],Rt=[yt.x,yt.y,0,1];Fg(Rt,Rt,He),it.push(new d(Rt[0]/Rt[3],Rt[1]/Rt[3]))}return it})($,X),Me=(function(Pe,He,Ve,et){for(var it=[],rt=[],lt=et[8]*He,yt=et[9]*He,Rt=et[10]*He,Zt=et[11]*He,gn=et[8]*Ve,Jt=et[9]*Ve,bn=et[10]*Ve,Qt=et[11]*Ve,jn=0,Mn=Pe;jn<Mn.length;jn+=1){for(var un=[],ni=[],Un=0,_i=Mn[jn];Un<_i.length;Un+=1){var xn=_i[Un],Ri=xn.x,wr=xn.y,Or=et[0]*Ri+et[4]*wr+et[12],Lr=et[1]*Ri+et[5]*wr+et[13],Ar=et[2]*Ri+et[6]*wr+et[14],Nr=et[3]*Ri+et[7]*wr+et[15],bs=Ar+Rt,xs=Nr+Zt,fo=Or+gn,Ls=Lr+Jt,po=Ar+bn,Yr=Nr+Qt,Ps=new d((Or+lt)/xs,(Lr+yt)/xs);Ps.z=bs/xs,un.push(Ps);var ci=new d(fo/Yr,Ls/Yr);ci.z=po/Yr,ni.push(ci)}it.push(un),rt.push(ni)}return[it,rt]})(A,de,ne,X);return(function(Pe,He,Ve){var et=1/0;ul(Ve,He)&&(et=Yk(Ve,He[0]));for(var it=0;it<He.length;it++)for(var rt=He[it],lt=Pe[it],yt=0;yt<rt.length-1;yt++){var Rt=rt[yt],Zt=[Rt,rt[yt+1],lt[yt+1],lt[yt],Rt];nc(Ve,Zt)&&(et=Math.min(et,Yk(Ve,Zt)))}return et!==1/0&&et})(Me[0],Me[1],_e)},c})(Pl);function E_(a,c){return a.x*c.x+a.y*c.y}function Yk(a,c){if(a.length===1){for(var f,v=0,I=c[v++];!f||I.equals(f);)if(!(f=c[v++]))return 1/0;for(;v<c.length;v++){var A=c[v],R=a[0],O=f.sub(I),Z=A.sub(I),X=R.sub(I),$=E_(O,O),ne=E_(O,Z),de=E_(Z,Z),_e=E_(X,O),Me=E_(X,Z),Pe=$*de-ne*ne,He=(de*_e-ne*Me)/Pe,Ve=($*Me-ne*_e)/Pe,et=I.z*(1-He-Ve)+f.z*He+A.z*Ve;if(isFinite(et))return et}return 1/0}for(var it=1/0,rt=0,lt=c;rt<lt.length;rt+=1)it=Math.min(it,lt[rt].z);return it}var t8=Rs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,n8=Rs([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,i8=Vg.VectorTileFeature.types,r8=Math.cos(Math.PI/180*37.5),Hk=Math.pow(2,14)/.5,Ao=function(a){var c=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((function(f){return f.id})),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(f){c.gradients[f.id]={}})),this.layoutVertexArray=new Zo,this.layoutVertexArray2=new _d,this.indexArray=new Qu,this.programConfigurations=new Tn(a.layers,a.zoom),this.segments=new be,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(f){return f.isStateDependent()})).map((function(f){return f.id}))};Ao.prototype.populate=function(a,c,f){this.hasPattern=VA("line",this.layers,c);for(var v=this.layers[0].layout.get("line-sort-key"),I=[],A=0,R=a;A<R.length;A+=1){var O=R[A],Z=O.feature,X=O.id,$=O.index,ne=O.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,_e=Xr(Z,de);if(this.layers[0]._featureFilter.filter(new li(this.zoom),_e,f)){var Me=v?v.evaluate(_e,{},f):void 0,Pe={id:X,properties:Z.properties,type:Z.type,sourceLayerIndex:ne,index:$,geometry:de?_e.geometry:kr(Z),patterns:{},sortKey:Me};I.push(Pe)}}v&&I.sort((function(Rt,Zt){return Rt.sortKey-Zt.sortKey}));for(var He=0,Ve=I;He<Ve.length;He+=1){var et=Ve[He],it=et.geometry,rt=et.index,lt=et.sourceLayerIndex;if(this.hasPattern){var yt=BA("line",this.layers,et,this.zoom,c);this.patternFeatures.push(yt)}else this.addFeature(et,it,rt,f,{});c.featureIndex.insert(a[rt].feature,it,rt,lt,this.index)}},Ao.prototype.update=function(a,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,c,this.stateDependentLayers,f)},Ao.prototype.addFeatures=function(a,c,f){for(var v=0,I=this.patternFeatures;v<I.length;v+=1){var A=I[v];this.addFeature(A,A.geometry,A.index,c,f)}},Ao.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ao.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ao.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,n8)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,t8),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ao.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ao.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},Ao.prototype.addFeature=function(a,c,f,v,I){var A=this.layers[0].layout,R=A.get("line-join").evaluate(a,{}),O=A.get("line-cap"),Z=A.get("line-miter-limit"),X=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var $=0,ne=c;$<ne.length;$+=1)this.addLine(ne[$],a,R,O,Z,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,I,v)},Ao.prototype.addLine=function(a,c,f,v,I,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var R=0;R<a.length-1;R++)this.totalDistance+=a[R].dist(a[R+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var O=i8[c.type]==="Polygon",Z=a.length;Z>=2&&a[Z-1].equals(a[Z-2]);)Z--;for(var X=0;X<Z-1&&a[X].equals(a[X+1]);)X++;if(!(Z<(O?3:2))){f==="bevel"&&(I=1.05);var $,ne=this.overscaling<=16?122880/(512*this.overscaling):0,de=this.segments.prepareSegment(10*Z,this.layoutVertexArray,this.indexArray),_e=void 0,Me=void 0,Pe=void 0,He=void 0;this.e1=this.e2=-1,O&&(He=a[X].sub($=a[Z-2])._unit()._perp());for(var Ve=X;Ve<Z;Ve++)if(!(Me=Ve===Z-1?O?a[X+1]:void 0:a[Ve+1])||!a[Ve].equals(Me)){He&&(Pe=He),$&&(_e=$),$=a[Ve],He=Me?Me.sub($)._unit()._perp():Pe;var et=(Pe=Pe||He).add(He);et.x===0&&et.y===0||et._unit();var it=Pe.x*He.x+Pe.y*He.y,rt=et.x*He.x+et.y*He.y,lt=rt!==0?1/rt:1/0,yt=2*Math.sqrt(2-2*rt),Rt=rt<r8&&_e&&Me,Zt=Pe.x*He.y-Pe.y*He.x>0;if(Rt&&Ve>X){var gn=$.dist(_e);if(gn>2*ne){var Jt=$.sub($.sub(_e)._mult(ne/gn)._round());this.updateDistance(_e,Jt),this.addCurrentVertex(Jt,Pe,0,0,de),_e=Jt}}var bn=_e&&Me,Qt=bn?f:O?"butt":v;if(bn&&Qt==="round"&&(lt<A?Qt="miter":lt<=2&&(Qt="fakeround")),Qt==="miter"&&lt>I&&(Qt="bevel"),Qt==="bevel"&&(lt>2&&(Qt="flipbevel"),lt<I&&(Qt="miter")),_e&&this.updateDistance(_e,$),Qt==="miter")et._mult(lt),this.addCurrentVertex($,et,0,0,de);else if(Qt==="flipbevel"){if(lt>100)et=He.mult(-1);else{var jn=lt*Pe.add(He).mag()/Pe.sub(He).mag();et._perp()._mult(jn*(Zt?-1:1))}this.addCurrentVertex($,et,0,0,de),this.addCurrentVertex($,et.mult(-1),0,0,de)}else if(Qt==="bevel"||Qt==="fakeround"){var Mn=-Math.sqrt(lt*lt-1),un=Zt?Mn:0,ni=Zt?0:Mn;if(_e&&this.addCurrentVertex($,Pe,un,ni,de),Qt==="fakeround")for(var Un=Math.round(180*yt/Math.PI/20),_i=1;_i<Un;_i++){var xn=_i/Un;if(xn!==.5){var Ri=xn-.5;xn+=xn*Ri*(xn-1)*((1.0904+it*(it*(3.55645-1.43519*it)-3.2452))*Ri*Ri+(.848013+it*(.215638*it-1.06021)))}var wr=He.sub(Pe)._mult(xn)._add(Pe)._unit()._mult(Zt?-1:1);this.addHalfVertex($,wr.x,wr.y,!1,Zt,0,de)}Me&&this.addCurrentVertex($,He,-un,-ni,de)}else if(Qt==="butt")this.addCurrentVertex($,et,0,0,de);else if(Qt==="square"){var Or=_e?1:-1;this.addCurrentVertex($,et,Or,Or,de)}else Qt==="round"&&(_e&&(this.addCurrentVertex($,Pe,0,0,de),this.addCurrentVertex($,Pe,1,1,de,!0)),Me&&(this.addCurrentVertex($,He,-1,-1,de,!0),this.addCurrentVertex($,He,0,0,de)));if(Rt&&Ve<Z-1){var Lr=$.dist(Me);if(Lr>2*ne){var Ar=$.add(Me.sub($)._mult(ne/Lr)._round());this.updateDistance($,Ar),this.addCurrentVertex(Ar,He,0,0,de),$=Ar}}}}},Ao.prototype.addCurrentVertex=function(a,c,f,v,I,A){A===void 0&&(A=!1);var R=c.y*v-c.x,O=-c.y-c.x*v;this.addHalfVertex(a,c.x+c.y*f,c.y-c.x*f,A,!1,f,I),this.addHalfVertex(a,R,O,A,!0,-v,I),this.distance>Hk/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,c,f,v,I,A))},Ao.prototype.addHalfVertex=function(a,c,f,v,I,A,R){var O=.5*(this.lineClips?this.scaledDistance*(Hk-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(v?1:0),(a.y<<1)+(I?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(A===0?0:A<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var Z=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Z),R.primitiveLength++),I?this.e2=Z:this.e1=Z},Ao.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ao.prototype.updateDistance=function(a,c){this.distance+=a.dist(c),this.updateScaledDistance()},sn("LineBucket",Ao,{omit:["layers","patternFeatures"]});var s8=new Xs({"line-cap":new _n(ye.layout_line["line-cap"]),"line-join":new ln(ye.layout_line["line-join"]),"line-miter-limit":new _n(ye.layout_line["line-miter-limit"]),"line-round-limit":new _n(ye.layout_line["line-round-limit"]),"line-sort-key":new ln(ye.layout_line["line-sort-key"])}),Kk={paint:new Xs({"line-opacity":new ln(ye.paint_line["line-opacity"]),"line-color":new ln(ye.paint_line["line-color"]),"line-translate":new _n(ye.paint_line["line-translate"]),"line-translate-anchor":new _n(ye.paint_line["line-translate-anchor"]),"line-width":new ln(ye.paint_line["line-width"]),"line-gap-width":new ln(ye.paint_line["line-gap-width"]),"line-offset":new ln(ye.paint_line["line-offset"]),"line-blur":new ln(ye.paint_line["line-blur"]),"line-dasharray":new uo(ye.paint_line["line-dasharray"]),"line-pattern":new Mg(ye.paint_line["line-pattern"]),"line-gradient":new ll(ye.paint_line["line-gradient"])}),layout:s8},jk=new((function(a){function c(){a.apply(this,arguments)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.possiblyEvaluate=function(f,v){return v=new li(Math.floor(v.zoom),{now:v.now,fadeDuration:v.fadeDuration,zoomHistory:v.zoomHistory,transition:v.transition}),a.prototype.possiblyEvaluate.call(this,f,v)},c.prototype.evaluate=function(f,v,I,A){return v=M({},v,{zoom:Math.floor(v.zoom)}),a.prototype.evaluate.call(this,f,v,I,A)},c})(ln))(Kk.paint.properties["line-width"].specification);jk.useIntegerZoom=!0;var o8=(function(a){function c(f){a.call(this,f,Kk),this.gradientVersion=0}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Oo,this.gradientVersion=(this.gradientVersion+1)%x)},c.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},c.prototype.recalculate=function(f,v){a.prototype.recalculate.call(this,f,v),this.paint._values["line-floorwidth"]=jk.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,f)},c.prototype.createBucket=function(f){return new Ao(f)},c.prototype.queryRadius=function(f){var v=f,I=$k(Ol("line-width",this,v),Ol("line-gap-width",this,v)),A=Ol("line-offset",this,v);return I/2+Math.abs(A)+vs(this.paint.get("line-translate"))},c.prototype.queryIntersectsFeature=function(f,v,I,A,R,O,Z){var X=au(f,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),O.angle,Z),$=Z/2*$k(this.paint.get("line-width").evaluate(v,I),this.paint.get("line-gap-width").evaluate(v,I)),ne=this.paint.get("line-offset").evaluate(v,I);return ne&&(A=(function(de,_e){for(var Me=[],Pe=new d(0,0),He=0;He<de.length;He++){for(var Ve=de[He],et=[],it=0;it<Ve.length;it++){var rt=Ve[it],lt=Ve[it+1],yt=it===0?Pe:rt.sub(Ve[it-1])._unit()._perp(),Rt=it===Ve.length-1?Pe:lt.sub(rt)._unit()._perp(),Zt=yt._add(Rt)._unit();Zt._mult(1/(Zt.x*Rt.x+Zt.y*Rt.y)),et.push(Zt._mult(_e)._add(rt))}Me.push(et)}return Me})(A,ne*Z)),(function(de,_e,Me){for(var Pe=0;Pe<_e.length;Pe++){var He=_e[Pe];if(de.length>=3){for(var Ve=0;Ve<He.length;Ve++)if(Fl(de,He[Ve]))return!0}if(Ga(de,He,Me))return!0}return!1})(X,A,$)},c.prototype.isTileClipped=function(){return!0},c})(Pl);function $k(a,c){return c>0?c+2*a:a}var a8=Rs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),l8=Rs([{name:"a_projected_pos",components:3,type:"Float32"}],4),u8=(Rs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Rs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Jk=(Rs([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Rs([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),c8=Rs([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function h8(a,c,f){return a.sections.forEach((function(v){v.text=(function(I,A,R){var O=A.layout.get("text-transform").evaluate(R,{});return O==="uppercase"?I=I.toLocaleUpperCase():O==="lowercase"&&(I=I.toLocaleLowerCase()),da.applyArabicShaping&&(I=da.applyArabicShaping(I)),I})(v.text,c,f)})),a}Rs([{name:"triangle",components:3,type:"Uint16"}]),Rs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Rs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Rs([{type:"Float32",name:"offsetX"}]),Rs([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var T_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},qk=function(a,c,f,v,I){var A,R,O=8*I-v-1,Z=(1<<O)-1,X=Z>>1,$=-7,ne=I-1,de=-1,_e=a[c+ne];for(ne+=de,A=_e&(1<<-$)-1,_e>>=-$,$+=O;$>0;A=256*A+a[c+ne],ne+=de,$-=8);for(R=A&(1<<-$)-1,A>>=-$,$+=v;$>0;R=256*R+a[c+ne],ne+=de,$-=8);if(A===0)A=1-X;else{if(A===Z)return R?NaN:1/0*(_e?-1:1);R+=Math.pow(2,v),A-=X}return(_e?-1:1)*R*Math.pow(2,A-v)},Qk=function(a,c,f,v,I,A){var R,O,Z,X=8*A-I-1,$=(1<<X)-1,ne=$>>1,de=I===23?Math.pow(2,-24)-Math.pow(2,-77):0,_e=0,Me=1,Pe=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(O=isNaN(c)?1:0,R=$):(R=Math.floor(Math.log(c)/Math.LN2),c*(Z=Math.pow(2,-R))<1&&(R--,Z*=2),(c+=R+ne>=1?de/Z:de*Math.pow(2,1-ne))*Z>=2&&(R++,Z/=2),R+ne>=$?(O=0,R=$):R+ne>=1?(O=(c*Z-1)*Math.pow(2,I),R+=ne):(O=c*Math.pow(2,ne-1)*Math.pow(2,I),R=0));I>=8;a[f+_e]=255&O,_e+=Me,O/=256,I-=8);for(R=R<<I|O,X+=I;X>0;a[f+_e]=255&R,_e+=Me,R/=256,X-=8);a[f+_e-Me]|=128*Pe},_1=ur;function ur(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}ur.Varint=0,ur.Fixed64=1,ur.Bytes=2,ur.Fixed32=5;var eL=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function lh(a){return a.type===ur.Bytes?a.readVarint()+a.pos:a.pos+1}function Bg(a,c,f){return f?4294967296*c+(a>>>0):4294967296*(c>>>0)+(a>>>0)}function tL(a,c,f){var v=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));f.realloc(v);for(var I=f.pos-1;I>=a;I--)f.buf[I+v]=f.buf[I]}function d8(a,c){for(var f=0;f<a.length;f++)c.writeVarint(a[f])}function f8(a,c){for(var f=0;f<a.length;f++)c.writeSVarint(a[f])}function p8(a,c){for(var f=0;f<a.length;f++)c.writeFloat(a[f])}function g8(a,c){for(var f=0;f<a.length;f++)c.writeDouble(a[f])}function m8(a,c){for(var f=0;f<a.length;f++)c.writeBoolean(a[f])}function y8(a,c){for(var f=0;f<a.length;f++)c.writeFixed32(a[f])}function _8(a,c){for(var f=0;f<a.length;f++)c.writeSFixed32(a[f])}function v8(a,c){for(var f=0;f<a.length;f++)c.writeFixed64(a[f])}function b8(a,c){for(var f=0;f<a.length;f++)c.writeSFixed64(a[f])}function v1(a,c){return(a[c]|a[c+1]<<8|a[c+2]<<16)+16777216*a[c+3]}function Zg(a,c,f){a[f]=c,a[f+1]=c>>>8,a[f+2]=c>>>16,a[f+3]=c>>>24}function nL(a,c){return(a[c]|a[c+1]<<8|a[c+2]<<16)+(a[c+3]<<24)}function x8(a,c,f){a===1&&f.readMessage(I8,c)}function I8(a,c,f){if(a===3){var v=f.readMessage(C8,{}),I=v.width,A=v.height,R=v.left,O=v.top,Z=v.advance;c.push({id:v.id,bitmap:new ep({width:I+6,height:A+6},v.bitmap),metrics:{width:I,height:A,left:R,top:O,advance:Z}})}}function C8(a,c,f){a===1?c.id=f.readVarint():a===2?c.bitmap=f.readBytes():a===3?c.width=f.readVarint():a===4?c.height=f.readVarint():a===5?c.left=f.readSVarint():a===6?c.top=f.readSVarint():a===7&&(c.advance=f.readVarint())}function iL(a){for(var c=0,f=0,v=0,I=a;v<I.length;v+=1){var A=I[v];c+=A.w*A.h,f=Math.max(f,A.w)}a.sort((function(Pe,He){return He.h-Pe.h}));for(var R=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),f),h:1/0}],O=0,Z=0,X=0,$=a;X<$.length;X+=1)for(var ne=$[X],de=R.length-1;de>=0;de--){var _e=R[de];if(!(ne.w>_e.w||ne.h>_e.h)){if(ne.x=_e.x,ne.y=_e.y,Z=Math.max(Z,ne.y+ne.h),O=Math.max(O,ne.x+ne.w),ne.w===_e.w&&ne.h===_e.h){var Me=R.pop();de<R.length&&(R[de]=Me)}else ne.h===_e.h?(_e.x+=ne.w,_e.w-=ne.w):ne.w===_e.w?(_e.y+=ne.h,_e.h-=ne.h):(R.push({x:_e.x+ne.w,y:_e.y,w:_e.w-ne.w,h:ne.h}),_e.y+=ne.h,_e.h-=ne.h);break}}return{w:O,h:Z,fill:c/(O*Z)||0}}ur.prototype={destroy:function(){this.buf=null},readFields:function(a,c,f){for(f=f||this.length;this.pos<f;){var v=this.readVarint(),I=v>>3,A=this.pos;this.type=7&v,a(I,c,this),this.pos===A&&this.skip(v)}return c},readMessage:function(a,c){return this.readFields(a,c,this.readVarint()+this.pos)},readFixed32:function(){var a=v1(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=nL(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=v1(this.buf,this.pos)+4294967296*v1(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=v1(this.buf,this.pos)+4294967296*nL(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=qk(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=qk(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var c,f,v=this.buf;return c=127&(f=v[this.pos++]),f<128?c:(c|=(127&(f=v[this.pos++]))<<7,f<128?c:(c|=(127&(f=v[this.pos++]))<<14,f<128?c:(c|=(127&(f=v[this.pos++]))<<21,f<128?c:(function(I,A,R){var O,Z,X=R.buf;if(O=(112&(Z=X[R.pos++]))>>4,Z<128||(O|=(127&(Z=X[R.pos++]))<<3,Z<128)||(O|=(127&(Z=X[R.pos++]))<<10,Z<128)||(O|=(127&(Z=X[R.pos++]))<<17,Z<128)||(O|=(127&(Z=X[R.pos++]))<<24,Z<128)||(O|=(1&(Z=X[R.pos++]))<<31,Z<128))return Bg(I,O,A);throw new Error("Expected varint not more than 10 bytes")})(c|=(15&(f=v[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,c=this.pos;return this.pos=a,a-c>=12&&eL?(function(f,v,I){return eL.decode(f.subarray(v,I))})(this.buf,c,a):(function(f,v,I){for(var A="",R=v;R<I;){var O,Z,X,$=f[R],ne=null,de=$>239?4:$>223?3:$>191?2:1;if(R+de>I)break;de===1?$<128&&(ne=$):de===2?(192&(O=f[R+1]))==128&&(ne=(31&$)<<6|63&O)<=127&&(ne=null):de===3?(Z=f[R+2],(192&(O=f[R+1]))==128&&(192&Z)==128&&((ne=(15&$)<<12|(63&O)<<6|63&Z)<=2047||ne>=55296&&ne<=57343)&&(ne=null)):de===4&&(Z=f[R+2],X=f[R+3],(192&(O=f[R+1]))==128&&(192&Z)==128&&(192&X)==128&&((ne=(15&$)<<18|(63&O)<<12|(63&Z)<<6|63&X)<=65535||ne>=1114112)&&(ne=null)),ne===null?(ne=65533,de=1):ne>65535&&(ne-=65536,A+=String.fromCharCode(ne>>>10&1023|55296),ne=56320|1023&ne),A+=String.fromCharCode(ne),R+=de}return A})(this.buf,c,a)},readBytes:function(){var a=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,a);return this.pos=a,c},readPackedVarint:function(a,c){if(this.type!==ur.Bytes)return a.push(this.readVarint(c));var f=lh(this);for(a=a||[];this.pos<f;)a.push(this.readVarint(c));return a},readPackedSVarint:function(a){if(this.type!==ur.Bytes)return a.push(this.readSVarint());var c=lh(this);for(a=a||[];this.pos<c;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==ur.Bytes)return a.push(this.readBoolean());var c=lh(this);for(a=a||[];this.pos<c;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==ur.Bytes)return a.push(this.readFloat());var c=lh(this);for(a=a||[];this.pos<c;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==ur.Bytes)return a.push(this.readDouble());var c=lh(this);for(a=a||[];this.pos<c;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==ur.Bytes)return a.push(this.readFixed32());var c=lh(this);for(a=a||[];this.pos<c;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==ur.Bytes)return a.push(this.readSFixed32());var c=lh(this);for(a=a||[];this.pos<c;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==ur.Bytes)return a.push(this.readFixed64());var c=lh(this);for(a=a||[];this.pos<c;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==ur.Bytes)return a.push(this.readSFixed64());var c=lh(this);for(a=a||[];this.pos<c;)a.push(this.readSFixed64());return a},skip:function(a){var c=7&a;if(c===ur.Varint)for(;this.buf[this.pos++]>127;);else if(c===ur.Bytes)this.pos=this.readVarint()+this.pos;else if(c===ur.Fixed32)this.pos+=4;else{if(c!==ur.Fixed64)throw new Error("Unimplemented type: "+c);this.pos+=8}},writeTag:function(a,c){this.writeVarint(a<<3|c)},realloc:function(a){for(var c=this.length||16;c<this.pos+a;)c*=2;if(c!==this.length){var f=new Uint8Array(c);f.set(this.buf),this.buf=f,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Zg(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Zg(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Zg(this.buf,-1&a,this.pos),Zg(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Zg(this.buf,-1&a,this.pos),Zg(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?(function(c,f){var v,I;if(c>=0?(v=c%4294967296|0,I=c/4294967296|0):(I=~(-c/4294967296),4294967295^(v=~(-c%4294967296))?v=v+1|0:(v=0,I=I+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),(function(A,R,O){O.buf[O.pos++]=127&A|128,A>>>=7,O.buf[O.pos++]=127&A|128,A>>>=7,O.buf[O.pos++]=127&A|128,A>>>=7,O.buf[O.pos++]=127&A|128,O.buf[O.pos]=127&(A>>>=7)})(v,0,f),(function(A,R){var O=(7&A)<<4;R.buf[R.pos++]|=O|((A>>>=3)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A|((A>>>=7)?128:0),A&&(R.buf[R.pos++]=127&A)))))})(I,f)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var c=this.pos;this.pos=(function(v,I,A){for(var R,O,Z=0;Z<I.length;Z++){if((R=I.charCodeAt(Z))>55295&&R<57344){if(!O){R>56319||Z+1===I.length?(v[A++]=239,v[A++]=191,v[A++]=189):O=R;continue}if(R<56320){v[A++]=239,v[A++]=191,v[A++]=189,O=R;continue}R=O-55296<<10|R-56320|65536,O=null}else O&&(v[A++]=239,v[A++]=191,v[A++]=189,O=null);R<128?v[A++]=R:(R<2048?v[A++]=R>>6|192:(R<65536?v[A++]=R>>12|224:(v[A++]=R>>18|240,v[A++]=R>>12&63|128),v[A++]=R>>6&63|128),v[A++]=63&R|128)}return A})(this.buf,a,this.pos);var f=this.pos-c;f>=128&&tL(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeFloat:function(a){this.realloc(4),Qk(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Qk(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var c=a.length;this.writeVarint(c),this.realloc(c);for(var f=0;f<c;f++)this.buf[this.pos++]=a[f]},writeRawMessage:function(a,c){this.pos++;var f=this.pos;a(c,this);var v=this.pos-f;v>=128&&tL(f,v,this),this.pos=f-1,this.writeVarint(v),this.pos+=v},writeMessage:function(a,c,f){this.writeTag(a,ur.Bytes),this.writeRawMessage(c,f)},writePackedVarint:function(a,c){c.length&&this.writeMessage(a,d8,c)},writePackedSVarint:function(a,c){c.length&&this.writeMessage(a,f8,c)},writePackedBoolean:function(a,c){c.length&&this.writeMessage(a,m8,c)},writePackedFloat:function(a,c){c.length&&this.writeMessage(a,p8,c)},writePackedDouble:function(a,c){c.length&&this.writeMessage(a,g8,c)},writePackedFixed32:function(a,c){c.length&&this.writeMessage(a,y8,c)},writePackedSFixed32:function(a,c){c.length&&this.writeMessage(a,_8,c)},writePackedFixed64:function(a,c){c.length&&this.writeMessage(a,v8,c)},writePackedSFixed64:function(a,c){c.length&&this.writeMessage(a,b8,c)},writeBytesField:function(a,c){this.writeTag(a,ur.Bytes),this.writeBytes(c)},writeFixed32Field:function(a,c){this.writeTag(a,ur.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(a,c){this.writeTag(a,ur.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(a,c){this.writeTag(a,ur.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(a,c){this.writeTag(a,ur.Fixed64),this.writeSFixed64(c)},writeVarintField:function(a,c){this.writeTag(a,ur.Varint),this.writeVarint(c)},writeSVarintField:function(a,c){this.writeTag(a,ur.Varint),this.writeSVarint(c)},writeStringField:function(a,c){this.writeTag(a,ur.Bytes),this.writeString(c)},writeFloatField:function(a,c){this.writeTag(a,ur.Fixed32),this.writeFloat(c)},writeDoubleField:function(a,c){this.writeTag(a,ur.Fixed64),this.writeDouble(c)},writeBooleanField:function(a,c){this.writeVarintField(a,!!c)}};var b1=function(a,c){var f=c.pixelRatio,v=c.version,I=c.stretchX,A=c.stretchY,R=c.content;this.paddedRect=a,this.pixelRatio=f,this.stretchX=I,this.stretchY=A,this.content=R,this.version=v},R_={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};R_.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},R_.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},R_.tlbr.get=function(){return this.tl.concat(this.br)},R_.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(b1.prototype,R_);var M_=function(a,c){var f={},v={};this.haveRenderCallbacks=[];var I=[];this.addImages(a,f,I),this.addImages(c,v,I);var A=iL(I),R=new zo({width:A.w||1,height:A.h||1});for(var O in a){var Z=a[O],X=f[O].paddedRect;zo.copy(Z.data,R,{x:0,y:0},{x:X.x+1,y:X.y+1},Z.data)}for(var $ in c){var ne=c[$],de=v[$].paddedRect,_e=de.x+1,Me=de.y+1,Pe=ne.data.width,He=ne.data.height;zo.copy(ne.data,R,{x:0,y:0},{x:_e,y:Me},ne.data),zo.copy(ne.data,R,{x:0,y:He-1},{x:_e,y:Me-1},{width:Pe,height:1}),zo.copy(ne.data,R,{x:0,y:0},{x:_e,y:Me+He},{width:Pe,height:1}),zo.copy(ne.data,R,{x:Pe-1,y:0},{x:_e-1,y:Me},{width:1,height:He}),zo.copy(ne.data,R,{x:0,y:0},{x:_e+Pe,y:Me},{width:1,height:He})}this.image=R,this.iconPositions=f,this.patternPositions=v};M_.prototype.addImages=function(a,c,f){for(var v in a){var I=a[v],A={x:0,y:0,w:I.data.width+2,h:I.data.height+2};f.push(A),c[v]=new b1(A,I),I.hasRenderCallback&&this.haveRenderCallbacks.push(v)}},M_.prototype.patchUpdatedImages=function(a,c){for(var f in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[f],a.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],a.getImage(f),c)},M_.prototype.patchUpdatedImage=function(a,c,f){if(a&&c&&a.version!==c.version){a.version=c.version;var v=a.tl;f.update(c.data,void 0,{x:v[0],y:v[1]})}},sn("ImagePosition",b1),sn("ImageAtlas",M_);var Fa={horizontal:1,vertical:2,horizontalOnly:3},Wg=function(){this.scale=1,this.fontStack="",this.imageName=null};Wg.forText=function(a,c){var f=new Wg;return f.scale=a||1,f.fontStack=c,f},Wg.forImage=function(a){var c=new Wg;return c.imageName=a,c};var ho=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function x1(a,c,f,v,I,A,R,O,Z,X,$,ne,de,_e,Me,Pe){var He,Ve=ho.fromFeature(a,I);ne===Fa.vertical&&Ve.verticalizePunctuation();var et=da.processBidirectionalText,it=da.processStyledBidirectionalText;if(et&&Ve.sections.length===1){He=[];for(var rt=0,lt=et(Ve.toString(),WA(Ve,X,A,c,v,_e,Me));rt<lt.length;rt+=1){var yt=lt[rt],Rt=new ho;Rt.text=yt,Rt.sections=Ve.sections;for(var Zt=0;Zt<yt.length;Zt++)Rt.sectionIndex.push(0);He.push(Rt)}}else if(it){He=[];for(var gn=0,Jt=it(Ve.text,Ve.sectionIndex,WA(Ve,X,A,c,v,_e,Me));gn<Jt.length;gn+=1){var bn=Jt[gn],Qt=new ho;Qt.text=bn[0],Qt.sectionIndex=bn[1],Qt.sections=Ve.sections,He.push(Qt)}}else He=(function(un,ni){for(var Un=[],_i=un.text,xn=0,Ri=0,wr=ni;Ri<wr.length;Ri+=1){var Or=wr[Ri];Un.push(un.substring(xn,Or)),xn=Or}return xn<_i.length&&Un.push(un.substring(xn,_i.length)),Un})(Ve,WA(Ve,X,A,c,v,_e,Me));var jn=[],Mn={positionedLines:jn,text:Ve.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:ne,iconsInText:!1,verticalizable:!1};return(function(un,ni,Un,_i,xn,Ri,wr,Or,Lr,Ar,Nr,bs){for(var xs=0,fo=-17,Ls=0,po=0,Yr=Or==="right"?1:Or==="left"?0:.5,Ps=0,ci=0,er=xn;ci<er.length;ci+=1){var zi=er[ci];zi.trim();var Ii=zi.getMaxScale(),So=24*(Ii-1),no={positionedGlyphs:[],lineOffset:0};un.positionedLines[Ps]=no;var mr=no.positionedGlyphs,es=0;if(zi.length()){for(var io=0;io<zi.length();io++){var Mi=zi.getSection(io),sc=zi.getSectionIndex(io),Oa=zi.getCharCode(io),oc=0,Hr=null,ac=null,Nl=null,$g=24,rp=!(Lr===Fa.horizontal||!Nr&&!Eg(Oa)||Nr&&(I1[Oa]||(dh=Oa,Ht.Arabic(dh)||Ht["Arabic Supplement"](dh)||Ht["Arabic Extended-A"](dh)||Ht["Arabic Presentation Forms-A"](dh)||Ht["Arabic Presentation Forms-B"](dh))));if(Mi.imageName){var Jg=_i[Mi.imageName];if(!Jg)continue;Nl=Mi.imageName,un.iconsInText=un.iconsInText||!0,ac=Jg.paddedRect;var hh=Jg.displaySize;Mi.scale=24*Mi.scale/bs,oc=So+(24-hh[1]*Mi.scale),$g=(Hr={width:hh[0],height:hh[1],left:1,top:-3,advance:rp?hh[1]:hh[0]}).advance;var qg=rp?hh[0]*Mi.scale-24*Ii:hh[1]*Mi.scale-24*Ii;qg>0&&qg>es&&(es=qg)}else{var k1=Un[Mi.fontStack],Qg=k1&&k1[Oa];if(Qg&&Qg.rect)ac=Qg.rect,Hr=Qg.metrics;else{var P_=ni[Mi.fontStack],L1=P_&&P_[Oa];if(!L1)continue;Hr=L1.metrics}oc=24*(Ii-Mi.scale)}rp?(un.verticalizable=!0,mr.push({glyph:Oa,imageName:Nl,x:xs,y:fo+oc,vertical:rp,scale:Mi.scale,fontStack:Mi.fontStack,sectionIndex:sc,metrics:Hr,rect:ac}),xs+=$g*Mi.scale+Ar):(mr.push({glyph:Oa,imageName:Nl,x:xs,y:fo+oc,vertical:rp,scale:Mi.scale,fontStack:Mi.fontStack,sectionIndex:sc,metrics:Hr,rect:ac}),xs+=Hr.advance*Mi.scale+Ar)}mr.length!==0&&(Ls=Math.max(xs-Ar,Ls),A8(mr,0,mr.length-1,Yr,es)),xs=0;var P1=Ri*Ii+es;no.lineOffset=Math.max(es,So),fo+=P1,po=Math.max(P1,po),++Ps}else fo+=Ri,++Ps}var dh,G_=fo- -17,em=zA(wr),Sd=em.horizontalAlign,tm=em.verticalAlign;(function(G1,F1,F_,O_,O1,N_,D_,V_,N1){var nm,D1=(F1-F_)*O1;nm=N_!==D_?-V_*O_- -17:(-O_*N1+.5)*D_;for(var im=0,B_=G1;im<B_.length;im+=1)for(var sp=0,Z_=B_[im].positionedGlyphs;sp<Z_.length;sp+=1){var rm=Z_[sp];rm.x+=D1,rm.y+=nm}})(un.positionedLines,Yr,Sd,tm,Ls,po,Ri,G_,xn.length),un.top+=-tm*G_,un.bottom=un.top+G_,un.left+=-Sd*Ls,un.right=un.left+Ls})(Mn,c,f,v,He,R,O,Z,ne,X,de,Pe),!(function(un){for(var ni=0,Un=un;ni<Un.length;ni+=1)if(Un[ni].positionedGlyphs.length!==0)return!1;return!0})(jn)&&Mn}ho.fromFeature=function(a,c){for(var f=new ho,v=0;v<a.sections.length;v++){var I=a.sections[v];I.image?f.addImageSection(I):f.addTextSection(I,c)}return f},ho.prototype.length=function(){return this.text.length},ho.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},ho.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},ho.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},ho.prototype.verticalizePunctuation=function(){this.text=(function(a){for(var c="",f=0;f<a.length;f++){var v=a.charCodeAt(f+1)||null,I=a.charCodeAt(f-1)||null;c+=v&&f_(v)&&!T_[a[f+1]]||I&&f_(I)&&!T_[a[f-1]]||!T_[a[f]]?a[f]:T_[a[f]]}return c})(this.text)},ho.prototype.trim=function(){for(var a=0,c=0;c<this.text.length&&I1[this.text.charCodeAt(c)];c++)a++;for(var f=this.text.length,v=this.text.length-1;v>=0&&v>=a&&I1[this.text.charCodeAt(v)];v--)f--;this.text=this.text.substring(a,f),this.sectionIndex=this.sectionIndex.slice(a,f)},ho.prototype.substring=function(a,c){var f=new ho;return f.text=this.text.substring(a,c),f.sectionIndex=this.sectionIndex.slice(a,c),f.sections=this.sections,f},ho.prototype.toString=function(){return this.text},ho.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce((function(c,f){return Math.max(c,a.sections[f].scale)}),0)},ho.prototype.addTextSection=function(a,c){this.text+=a.text,this.sections.push(Wg.forText(a.scale,a.fontStack||c));for(var f=this.sections.length-1,v=0;v<a.text.length;++v)this.sectionIndex.push(f)},ho.prototype.addImageSection=function(a){var c=a.image?a.image.name:"";if(c.length!==0){var f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Wg.forImage(c)),this.sectionIndex.push(this.sections.length-1)):he("Reached maximum number of images 6401")}else he("Can't add FormattedSection with an empty image.")},ho.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var I1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pa={};function rL(a,c,f,v,I,A){if(c.imageName){var R=v[c.imageName];return R?R.displaySize[0]*c.scale*24/A+I:0}var O=f[c.fontStack],Z=O&&O[a];return Z?Z.metrics.advance*c.scale+I:0}function sL(a,c,f,v){var I=Math.pow(a-c,2);return v?a<c?I/2:2*I:I+Math.abs(f)*f}function w8(a,c,f){var v=0;return a===10&&(v-=1e4),f&&(v+=150),a!==40&&a!==65288||(v+=50),c!==41&&c!==65289||(v+=50),v}function oL(a,c,f,v,I,A){for(var R=null,O=sL(c,f,I,A),Z=0,X=v;Z<X.length;Z+=1){var $=X[Z],ne=sL(c-$.x,f,I,A)+$.badness;ne<=O&&(R=$,O=ne)}return{index:a,x:c,priorBreak:R,badness:O}}function WA(a,c,f,v,I,A,R){if(A!=="point")return[];if(!a)return[];for(var O,Z=[],X=(function(He,Ve,et,it,rt,lt){for(var yt=0,Rt=0;Rt<He.length();Rt++){var Zt=He.getSection(Rt);yt+=rL(He.getCharCode(Rt),Zt,it,rt,Ve,lt)}return yt/Math.max(1,Math.ceil(yt/et))})(a,c,f,v,I,R),$=a.text.indexOf("")>=0,ne=0,de=0;de<a.length();de++){var _e=a.getSection(de),Me=a.getCharCode(de);if(I1[Me]||(ne+=rL(Me,_e,v,I,c,R)),de<a.length()-1){var Pe=!((O=Me)<11904||!(Ht["Bopomofo Extended"](O)||Ht.Bopomofo(O)||Ht["CJK Compatibility Forms"](O)||Ht["CJK Compatibility Ideographs"](O)||Ht["CJK Compatibility"](O)||Ht["CJK Radicals Supplement"](O)||Ht["CJK Strokes"](O)||Ht["CJK Symbols and Punctuation"](O)||Ht["CJK Unified Ideographs Extension A"](O)||Ht["CJK Unified Ideographs"](O)||Ht["Enclosed CJK Letters and Months"](O)||Ht["Halfwidth and Fullwidth Forms"](O)||Ht.Hiragana(O)||Ht["Ideographic Description Characters"](O)||Ht["Kangxi Radicals"](O)||Ht["Katakana Phonetic Extensions"](O)||Ht.Katakana(O)||Ht["Vertical Forms"](O)||Ht["Yi Radicals"](O)||Ht["Yi Syllables"](O)));(pa[Me]||Pe||_e.imageName)&&Z.push(oL(de+1,ne,X,Z,w8(Me,a.getCharCode(de+1),Pe&&$),!1))}}return(function He(Ve){return Ve?He(Ve.priorBreak).concat(Ve.index):[]})(oL(a.length(),ne,X,Z,0,!0))}function zA(a){var c=.5,f=.5;switch(a){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:c,verticalAlign:f}}function A8(a,c,f,v,I){if(v||I)for(var A=a[f],R=(a[f].x+A.metrics.advance*A.scale)*v,O=c;O<=f;O++)a[O].x-=R,a[O].y+=I}function aL(a,c,f,v,I,A){var R,O=a.image;if(O.content){var Z=O.content,X=O.pixelRatio||1;R=[Z[0]/X,Z[1]/X,O.displaySize[0]-Z[2]/X,O.displaySize[1]-Z[3]/X]}var $,ne,de,_e,Me=c.left*A,Pe=c.right*A;f==="width"||f==="both"?(_e=I[0]+Me-v[3],ne=I[0]+Pe+v[1]):ne=(_e=I[0]+(Me+Pe-O.displaySize[0])/2)+O.displaySize[0];var He=c.top*A,Ve=c.bottom*A;return f==="height"||f==="both"?($=I[1]+He-v[0],de=I[1]+Ve+v[2]):de=($=I[1]+(He+Ve-O.displaySize[1])/2)+O.displaySize[1],{image:O,top:$,right:ne,bottom:de,left:_e,collisionPadding:R}}pa[10]=!0,pa[32]=!0,pa[38]=!0,pa[40]=!0,pa[41]=!0,pa[43]=!0,pa[45]=!0,pa[47]=!0,pa[173]=!0,pa[183]=!0,pa[8203]=!0,pa[8208]=!0,pa[8211]=!0,pa[8231]=!0;var zg=(function(a){function c(f,v,I,A){a.call(this,f,v),this.angle=I,A!==void 0&&(this.segment=A)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.clone=function(){return new c(this.x,this.y,this.angle,this.segment)},c})(d);function UA(a,c){var f=c.expression;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new li(a+1))};if(f.kind==="source")return{kind:"source"};for(var v=f.zoomStops,I=f.interpolationType,A=0;A<v.length&&v[A]<=a;)A++;for(var R=A=Math.max(0,A-1);R<v.length&&v[R]<a+1;)R++;R=Math.min(v.length-1,R);var O=v[A],Z=v[R];return f.kind==="composite"?{kind:"composite",minZoom:O,maxZoom:Z,interpolationType:I}:{kind:"camera",minZoom:O,maxZoom:Z,minSize:f.evaluate(new li(O)),maxSize:f.evaluate(new li(Z)),interpolationType:I}}function lL(a,c,f){var v=c.uSize,I=f.lowerSize;return a.kind==="source"?I/128:a.kind==="composite"?qr(I/128,f.upperSize/128,c.uSizeT):v}function uL(a,c){var f=0,v=0;if(a.kind==="constant")v=a.layoutSize;else if(a.kind!=="source"){var I=a.interpolationType,A=I?S(zs.interpolationFactor(I,c,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?v=qr(a.minSize,a.maxSize,A):f=A}return{uSizeT:f,uSize:v}}sn("Anchor",zg);var S8=Object.freeze({__proto__:null,getSizeData:UA,evaluateSizeForFeature:lL,evaluateSizeForZoom:uL,SIZE_PACK_FACTOR:128});function cL(a,c,f,v,I){if(c.segment===void 0)return!0;for(var A=c,R=c.segment+1,O=0;O>-f/2;){if(--R<0)return!1;O-=a[R].dist(A),A=a[R]}O+=a[R].dist(a[R+1]),R++;for(var Z=[],X=0;O<f/2;){var $=a[R],ne=a[R+1];if(!ne)return!1;var de=a[R-1].angleTo($)-$.angleTo(ne);for(de=Math.abs((de+3*Math.PI)%(2*Math.PI)-Math.PI),Z.push({distance:O,angleDelta:de}),X+=de;O-Z[0].distance>v;)X-=Z.shift().angleDelta;if(X>I)return!1;R++,O+=$.dist(ne)}return!0}function hL(a){for(var c=0,f=0;f<a.length-1;f++)c+=a[f].dist(a[f+1]);return c}function dL(a,c,f){return a?.6*c*f:0}function fL(a,c){return Math.max(a?a.right-a.left:0,c?c.right-c.left:0)}function E8(a,c,f,v,I,A){for(var R=dL(f,I,A),O=fL(f,v)*A,Z=0,X=hL(a)/2,$=0;$<a.length-1;$++){var ne=a[$],de=a[$+1],_e=ne.dist(de);if(Z+_e>X){var Me=(X-Z)/_e,Pe=qr(ne.x,de.x,Me),He=qr(ne.y,de.y,Me),Ve=new zg(Pe,He,de.angleTo(ne),$);return Ve._round(),!R||cL(a,Ve,O,R,c)?Ve:void 0}Z+=_e}}function T8(a,c,f,v,I,A,R,O,Z){var X=dL(v,A,R),$=fL(v,I),ne=$*R,de=a[0].x===0||a[0].x===Z||a[0].y===0||a[0].y===Z;return c-ne<c/4&&(c=ne+c/4),(function _e(Me,Pe,He,Ve,et,it,rt,lt,yt){for(var Rt=it/2,Zt=hL(Me),gn=0,Jt=Pe-He,bn=[],Qt=0;Qt<Me.length-1;Qt++){for(var jn=Me[Qt],Mn=Me[Qt+1],un=jn.dist(Mn),ni=Mn.angleTo(jn);Jt+He<gn+un;){var Un=((Jt+=He)-gn)/un,_i=qr(jn.x,Mn.x,Un),xn=qr(jn.y,Mn.y,Un);if(_i>=0&&_i<yt&&xn>=0&&xn<yt&&Jt-Rt>=0&&Jt+Rt<=Zt){var Ri=new zg(_i,xn,ni,Qt);Ri._round(),Ve&&!cL(Me,Ri,it,Ve,et)||bn.push(Ri)}}gn+=un}return lt||bn.length||rt||(bn=_e(Me,gn/2,He,Ve,et,it,rt,!0,yt)),bn})(a,de?c/2*O%c:($/2+2*A)*R*O%c,c,X,f,ne,de,!1,Z)}function pL(a,c,f,v,I){for(var A=[],R=0;R<a.length;R++)for(var O=a[R],Z=void 0,X=0;X<O.length-1;X++){var $=O[X],ne=O[X+1];$.x<c&&ne.x<c||($.x<c?$=new d(c,$.y+(c-$.x)/(ne.x-$.x)*(ne.y-$.y))._round():ne.x<c&&(ne=new d(c,$.y+(c-$.x)/(ne.x-$.x)*(ne.y-$.y))._round()),$.y<f&&ne.y<f||($.y<f?$=new d($.x+(f-$.y)/(ne.y-$.y)*(ne.x-$.x),f)._round():ne.y<f&&(ne=new d($.x+(f-$.y)/(ne.y-$.y)*(ne.x-$.x),f)._round()),$.x>=v&&ne.x>=v||($.x>=v?$=new d(v,$.y+(v-$.x)/(ne.x-$.x)*(ne.y-$.y))._round():ne.x>=v&&(ne=new d(v,$.y+(v-$.x)/(ne.x-$.x)*(ne.y-$.y))._round()),$.y>=I&&ne.y>=I||($.y>=I?$=new d($.x+(I-$.y)/(ne.y-$.y)*(ne.x-$.x),I)._round():ne.y>=I&&(ne=new d($.x+(I-$.y)/(ne.y-$.y)*(ne.x-$.x),I)._round()),Z&&$.equals(Z[Z.length-1])||A.push(Z=[$]),Z.push(ne)))))}return A}function gL(a,c,f,v){var I=[],A=a.image,R=A.pixelRatio,O=A.paddedRect.w-2,Z=A.paddedRect.h-2,X=a.right-a.left,$=a.bottom-a.top,ne=A.stretchX||[[0,O]],de=A.stretchY||[[0,Z]],_e=function(_i,xn){return _i+xn[1]-xn[0]},Me=ne.reduce(_e,0),Pe=de.reduce(_e,0),He=O-Me,Ve=Z-Pe,et=0,it=Me,rt=0,lt=Pe,yt=0,Rt=He,Zt=0,gn=Ve;if(A.content&&v){var Jt=A.content;et=C1(ne,0,Jt[0]),rt=C1(de,0,Jt[1]),it=C1(ne,Jt[0],Jt[2]),lt=C1(de,Jt[1],Jt[3]),yt=Jt[0]-et,Zt=Jt[1]-rt,Rt=Jt[2]-Jt[0]-it,gn=Jt[3]-Jt[1]-lt}var bn=function(_i,xn,Ri,wr){var Or=w1(_i.stretch-et,it,X,a.left),Lr=A1(_i.fixed-yt,Rt,_i.stretch,Me),Ar=w1(xn.stretch-rt,lt,$,a.top),Nr=A1(xn.fixed-Zt,gn,xn.stretch,Pe),bs=w1(Ri.stretch-et,it,X,a.left),xs=A1(Ri.fixed-yt,Rt,Ri.stretch,Me),fo=w1(wr.stretch-rt,lt,$,a.top),Ls=A1(wr.fixed-Zt,gn,wr.stretch,Pe),po=new d(Or,Ar),Yr=new d(bs,Ar),Ps=new d(bs,fo),ci=new d(Or,fo),er=new d(Lr/R,Nr/R),zi=new d(xs/R,Ls/R),Ii=c*Math.PI/180;if(Ii){var So=Math.sin(Ii),no=Math.cos(Ii),mr=[no,-So,So,no];po._matMult(mr),Yr._matMult(mr),ci._matMult(mr),Ps._matMult(mr)}var es=_i.stretch+_i.fixed,io=xn.stretch+xn.fixed;return{tl:po,tr:Yr,bl:ci,br:Ps,tex:{x:A.paddedRect.x+1+es,y:A.paddedRect.y+1+io,w:Ri.stretch+Ri.fixed-es,h:wr.stretch+wr.fixed-io},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:er,pixelOffsetBR:zi,minFontScaleX:Rt/R/X,minFontScaleY:gn/R/$,isSDF:f}};if(v&&(A.stretchX||A.stretchY))for(var Qt=mL(ne,He,Me),jn=mL(de,Ve,Pe),Mn=0;Mn<Qt.length-1;Mn++)for(var un=Qt[Mn],ni=Qt[Mn+1],Un=0;Un<jn.length-1;Un++)I.push(bn(un,jn[Un],ni,jn[Un+1]));else I.push(bn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:O+1},{fixed:0,stretch:Z+1}));return I}function C1(a,c,f){for(var v=0,I=0,A=a;I<A.length;I+=1){var R=A[I];v+=Math.max(c,Math.min(f,R[1]))-Math.max(c,Math.min(f,R[0]))}return v}function mL(a,c,f){for(var v=[{fixed:-1,stretch:0}],I=0,A=a;I<A.length;I+=1){var R=A[I],O=R[0],Z=R[1],X=v[v.length-1];v.push({fixed:O-X.stretch,stretch:X.stretch}),v.push({fixed:O-X.stretch,stretch:X.stretch+(Z-O)})}return v.push({fixed:c+1,stretch:f}),v}function w1(a,c,f,v){return a/c*f+v}function A1(a,c,f,v){return a-c*f/v}var S1=function(a,c,f,v,I,A,R,O,Z,X){if(this.boxStartIndex=a.length,Z){var $=A.top,ne=A.bottom,de=A.collisionPadding;de&&($-=de[1],ne+=de[3]);var _e=ne-$;_e>0&&(_e=Math.max(10,_e),this.circleDiameter=_e)}else{var Me=A.top*R-O,Pe=A.bottom*R+O,He=A.left*R-O,Ve=A.right*R+O,et=A.collisionPadding;if(et&&(He-=et[0]*R,Me-=et[1]*R,Ve+=et[2]*R,Pe+=et[3]*R),X){var it=new d(He,Me),rt=new d(Ve,Me),lt=new d(He,Pe),yt=new d(Ve,Pe),Rt=X*Math.PI/180;it._rotate(Rt),rt._rotate(Rt),lt._rotate(Rt),yt._rotate(Rt),He=Math.min(it.x,rt.x,lt.x,yt.x),Ve=Math.max(it.x,rt.x,lt.x,yt.x),Me=Math.min(it.y,rt.y,lt.y,yt.y),Pe=Math.max(it.y,rt.y,lt.y,yt.y)}a.emplaceBack(c.x,c.y,He,Me,Ve,Pe,f,v,I)}this.boxEndIndex=a.length},Ug=function(a,c){if(a===void 0&&(a=[]),c===void 0&&(c=R8),this.data=a,this.length=this.data.length,this.compare=c,this.length>0)for(var f=(this.length>>1)-1;f>=0;f--)this._down(f)};function R8(a,c){return a<c?-1:a>c?1:0}function M8(a,c,f){f===void 0&&(f=!1);for(var v=1/0,I=1/0,A=-1/0,R=-1/0,O=a[0],Z=0;Z<O.length;Z++){var X=O[Z];(!Z||X.x<v)&&(v=X.x),(!Z||X.y<I)&&(I=X.y),(!Z||X.x>A)&&(A=X.x),(!Z||X.y>R)&&(R=X.y)}var $=Math.min(A-v,R-I),ne=$/2,de=new Ug([],k8);if($===0)return new d(v,I);for(var _e=v;_e<A;_e+=$)for(var Me=I;Me<R;Me+=$)de.push(new Xg(_e+ne,Me+ne,ne,a));for(var Pe=(function(et){for(var it=0,rt=0,lt=0,yt=et[0],Rt=0,Zt=yt.length,gn=Zt-1;Rt<Zt;gn=Rt++){var Jt=yt[Rt],bn=yt[gn],Qt=Jt.x*bn.y-bn.x*Jt.y;rt+=(Jt.x+bn.x)*Qt,lt+=(Jt.y+bn.y)*Qt,it+=3*Qt}return new Xg(rt/it,lt/it,0,et)})(a),He=de.length;de.length;){var Ve=de.pop();(Ve.d>Pe.d||!Pe.d)&&(Pe=Ve,f&&console.log("found best %d after %d probes",Math.round(1e4*Ve.d)/1e4,He)),Ve.max-Pe.d<=c||(de.push(new Xg(Ve.p.x-(ne=Ve.h/2),Ve.p.y-ne,ne,a)),de.push(new Xg(Ve.p.x+ne,Ve.p.y-ne,ne,a)),de.push(new Xg(Ve.p.x-ne,Ve.p.y+ne,ne,a)),de.push(new Xg(Ve.p.x+ne,Ve.p.y+ne,ne,a)),He+=4)}return f&&(console.log("num probes: "+He),console.log("best distance: "+Pe.d)),Pe.p}function k8(a,c){return c.max-a.max}function Xg(a,c,f,v){this.p=new d(a,c),this.h=f,this.d=(function(I,A){for(var R=!1,O=1/0,Z=0;Z<A.length;Z++)for(var X=A[Z],$=0,ne=X.length,de=ne-1;$<ne;de=$++){var _e=X[$],Me=X[de];_e.y>I.y!=Me.y>I.y&&I.x<(Me.x-_e.x)*(I.y-_e.y)/(Me.y-_e.y)+_e.x&&(R=!R),O=Math.min(O,Id(I,_e,Me))}return(R?1:-1)*Math.sqrt(O)})(this.p,v),this.max=this.d+this.h*Math.SQRT2}Ug.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},Ug.prototype.pop=function(){if(this.length!==0){var a=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),a}},Ug.prototype.peek=function(){return this.data[0]},Ug.prototype._up=function(a){for(var c=this.data,f=this.compare,v=c[a];a>0;){var I=a-1>>1,A=c[I];if(f(v,A)>=0)break;c[a]=A,a=I}c[a]=v},Ug.prototype._down=function(a){for(var c=this.data,f=this.compare,v=this.length>>1,I=c[a];a<v;){var A=1+(a<<1),R=c[A],O=A+1;if(O<this.length&&f(c[O],R)<0&&(A=O,R=c[O]),f(R,I)>=0)break;c[a]=R,a=A}c[a]=I};var XA=Number.POSITIVE_INFINITY;function yL(a,c){return c[1]!==XA?(function(f,v,I){var A=0,R=0;switch(v=Math.abs(v),I=Math.abs(I),f){case"top-right":case"top-left":case"top":R=I-7;break;case"bottom-right":case"bottom-left":case"bottom":R=7-I}switch(f){case"top-right":case"bottom-right":case"right":A=-v;break;case"top-left":case"bottom-left":case"left":A=v}return[A,R]})(a,c[0],c[1]):(function(f,v){var I=0,A=0;v<0&&(v=0);var R=v/Math.sqrt(2);switch(f){case"top-right":case"top-left":A=R-7;break;case"bottom-right":case"bottom-left":A=7-R;break;case"bottom":A=7-v;break;case"top":A=v-7}switch(f){case"top-right":case"bottom-right":I=-R;break;case"top-left":case"bottom-left":I=R;break;case"left":I=v;break;case"right":I=-v}return[I,A]})(a,c[0])}function YA(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function _L(a,c,f,v,I,A,R,O,Z,X,$,ne,de,_e,Me){var Pe=(function(rt,lt,yt,Rt,Zt,gn,Jt,bn){for(var Qt=Rt.layout.get("text-rotate").evaluate(gn,{})*Math.PI/180,jn=[],Mn=0,un=lt.positionedLines;Mn<un.length;Mn+=1)for(var ni=un[Mn],Un=0,_i=ni.positionedGlyphs;Un<_i.length;Un+=1){var xn=_i[Un];if(xn.rect){var Ri=xn.rect||{},wr=4,Or=!0,Lr=1,Ar=0,Nr=(Zt||bn)&&xn.vertical,bs=xn.metrics.advance*xn.scale/2;if(bn&&lt.verticalizable&&(Ar=ni.lineOffset/2-(xn.imageName?-(24-xn.metrics.width*xn.scale)/2:24*(xn.scale-1))),xn.imageName){var xs=Jt[xn.imageName];Or=xs.sdf,wr=1/(Lr=xs.pixelRatio)}var fo=Zt?[xn.x+bs,xn.y]:[0,0],Ls=Zt?[0,0]:[xn.x+bs+yt[0],xn.y+yt[1]-Ar],po=[0,0];Nr&&(po=Ls,Ls=[0,0]);var Yr=(xn.metrics.left-wr)*xn.scale-bs+Ls[0],Ps=(-xn.metrics.top-wr)*xn.scale+Ls[1],ci=Yr+Ri.w*xn.scale/Lr,er=Ps+Ri.h*xn.scale/Lr,zi=new d(Yr,Ps),Ii=new d(ci,Ps),So=new d(Yr,er),no=new d(ci,er);if(Nr){var mr=new d(-bs,bs- -17),es=-Math.PI/2,io=12-bs,Mi=new d(22-io,-(xn.imageName?io:0)),sc=new(Function.prototype.bind.apply(d,[null].concat(po)));zi._rotateAround(es,mr)._add(Mi)._add(sc),Ii._rotateAround(es,mr)._add(Mi)._add(sc),So._rotateAround(es,mr)._add(Mi)._add(sc),no._rotateAround(es,mr)._add(Mi)._add(sc)}if(Qt){var Oa=Math.sin(Qt),oc=Math.cos(Qt),Hr=[oc,-Oa,Oa,oc];zi._matMult(Hr),Ii._matMult(Hr),So._matMult(Hr),no._matMult(Hr)}var ac=new d(0,0),Nl=new d(0,0);jn.push({tl:zi,tr:Ii,bl:So,br:no,tex:Ri,writingMode:lt.writingMode,glyphOffset:fo,sectionIndex:xn.sectionIndex,isSDF:Or,pixelOffsetTL:ac,pixelOffsetBR:Nl,minFontScaleX:0,minFontScaleY:0})}}return jn})(0,f,O,I,A,R,v,a.allowVerticalPlacement),He=a.textSizeData,Ve=null;He.kind==="source"?(Ve=[128*I.layout.get("text-size").evaluate(R,{})])[0]>32640&&he(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):He.kind==="composite"&&((Ve=[128*_e.compositeTextSizes[0].evaluate(R,{},Me),128*_e.compositeTextSizes[1].evaluate(R,{},Me)])[0]>32640||Ve[1]>32640)&&he(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Pe,Ve,O,A,R,X,c,Z.lineStartIndex,Z.lineLength,de,Me);for(var et=0,it=$;et<it.length;et+=1)ne[it[et]]=a.text.placedSymbolArray.length-1;return 4*Pe.length}function vL(a){for(var c in a)return a[c];return null}function L8(a,c,f,v){var I=a.compareText;if(c in I){for(var A=I[c],R=A.length-1;R>=0;R--)if(v.dist(A[R])<f)return!0}else I[c]=[];return I[c].push(v),!1}var P8=Vg.VectorTileFeature.types,G8=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function E1(a,c,f,v,I,A,R,O,Z,X,$,ne,de){var _e=O?Math.min(32640,Math.round(O[0])):0,Me=O?Math.min(32640,Math.round(O[1])):0;a.emplaceBack(c,f,Math.round(32*v),Math.round(32*I),A,R,(_e<<1)+(Z?1:0),Me,16*X,16*$,256*ne,256*de)}function HA(a,c,f){a.emplaceBack(c.x,c.y,f),a.emplaceBack(c.x,c.y,f),a.emplaceBack(c.x,c.y,f),a.emplaceBack(c.x,c.y,f)}function F8(a){for(var c=0,f=a.sections;c<f.length;c+=1)if(Tg(f[c].text))return!0;return!1}var Yg=function(a){this.layoutVertexArray=new Lg,this.indexArray=new Qu,this.programConfigurations=a,this.segments=new be,this.dynamicLayoutVertexArray=new vd,this.opacityVertexArray=new Kf,this.placedSymbolArray=new b};Yg.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Yg.prototype.upload=function(a,c,f,v){this.isEmpty()||(f&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,a8.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,l8.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,G8,!0),this.opacityVertexBuffer.itemSize=1),(f||v)&&this.programConfigurations.upload(a))},Yg.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},sn("SymbolBuffers",Yg);var k_=function(a,c,f){this.layoutVertexArray=new a,this.layoutAttributes=c,this.indexArray=new f,this.segments=new be,this.collisionVertexArray=new v_};k_.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,u8.members,!0)},k_.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},sn("CollisionBuffers",k_);var Ki=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((function(A){return A.id})),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fa([]),this.placementViewportMatrix=fa([]);var c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=UA(this.zoom,c["text-size"]),this.iconSizeData=UA(this.zoom,c["icon-size"]);var f=this.layers[0].layout,v=f.get("symbol-sort-key"),I=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=I!=="viewport-y"&&v.constantOr(1)!==void 0,this.sortFeaturesByY=(I==="viewport-y"||I==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map((function(A){return Fa[A]}))),this.stateDependentLayerIds=this.layers.filter((function(A){return A.isStateDependent()})).map((function(A){return A.id})),this.sourceID=a.sourceID};Ki.prototype.createArrays=function(){this.text=new Yg(new Tn(this.layers,this.zoom,(function(a){return/^text/.test(a)}))),this.icon=new Yg(new Tn(this.layers,this.zoom,(function(a){return/^icon/.test(a)}))),this.glyphOffsetArray=new F,this.lineVertexArray=new B,this.symbolInstances=new L},Ki.prototype.calculateGlyphDependencies=function(a,c,f,v,I){for(var A=0;A<a.length;A++)if(c[a.charCodeAt(A)]=!0,(f||v)&&I){var R=T_[a.charAt(A)];R&&(c[R.charCodeAt(0)]=!0)}},Ki.prototype.populate=function(a,c,f){var v=this.layers[0],I=v.layout,A=I.get("text-font"),R=I.get("text-field"),O=I.get("icon-image"),Z=(R.value.kind!=="constant"||R.value.value instanceof Es&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),X=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,$=I.get("symbol-sort-key");if(this.features=[],Z||X){for(var ne=c.iconDependencies,de=c.glyphDependencies,_e=c.availableImages,Me=new li(this.zoom),Pe=0,He=a;Pe<He.length;Pe+=1){var Ve=He[Pe],et=Ve.feature,it=Ve.id,rt=Ve.index,lt=Ve.sourceLayerIndex,yt=v._featureFilter.needGeometry,Rt=Xr(et,yt);if(v._featureFilter.filter(Me,Rt,f)){yt||(Rt.geometry=kr(et));var Zt=void 0;if(Z){var gn=v.getValueAndResolveTokens("text-field",Rt,f,_e),Jt=Es.factory(gn);F8(Jt)&&(this.hasRTLText=!0),(!this.hasRTLText||g_()==="unavailable"||this.hasRTLText&&da.isParsed())&&(Zt=h8(Jt,v,Rt))}var bn=void 0;if(X){var Qt=v.getValueAndResolveTokens("icon-image",Rt,f,_e);bn=Qt instanceof Io?Qt:Io.fromString(Qt)}if(Zt||bn){var jn=this.sortFeaturesByKey?$.evaluate(Rt,{},f):void 0;if(this.features.push({id:it,text:Zt,icon:bn,index:rt,sourceLayerIndex:lt,geometry:Rt.geometry,properties:et.properties,type:P8[et.type],sortKey:jn}),bn&&(ne[bn.name]=!0),Zt){var Mn=A.evaluate(Rt,{},f).join(","),un=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fa.vertical)>=0;for(var ni=0,Un=Zt.sections;ni<Un.length;ni+=1){var _i=Un[ni];if(_i.image)ne[_i.image.name]=!0;else{var xn=d_(Zt.toString()),Ri=_i.fontStack||Mn,wr=de[Ri]=de[Ri]||{};this.calculateGlyphDependencies(_i.text,wr,un,this.allowVerticalPlacement,xn)}}}}}}I.get("symbol-placement")==="line"&&(this.features=(function(Or){var Lr={},Ar={},Nr=[],bs=0;function xs(mr){Nr.push(Or[mr]),bs++}function fo(mr,es,io){var Mi=Ar[mr];return delete Ar[mr],Ar[es]=Mi,Nr[Mi].geometry[0].pop(),Nr[Mi].geometry[0]=Nr[Mi].geometry[0].concat(io[0]),Mi}function Ls(mr,es,io){var Mi=Lr[es];return delete Lr[es],Lr[mr]=Mi,Nr[Mi].geometry[0].shift(),Nr[Mi].geometry[0]=io[0].concat(Nr[Mi].geometry[0]),Mi}function po(mr,es,io){var Mi=io?es[0][es[0].length-1]:es[0][0];return mr+":"+Mi.x+":"+Mi.y}for(var Yr=0;Yr<Or.length;Yr++){var Ps=Or[Yr],ci=Ps.geometry,er=Ps.text?Ps.text.toString():null;if(er){var zi=po(er,ci),Ii=po(er,ci,!0);if(zi in Ar&&Ii in Lr&&Ar[zi]!==Lr[Ii]){var So=Ls(zi,Ii,ci),no=fo(zi,Ii,Nr[So].geometry);delete Lr[zi],delete Ar[Ii],Ar[po(er,Nr[no].geometry,!0)]=no,Nr[So].geometry=null}else zi in Ar?fo(zi,Ii,ci):Ii in Lr?Ls(zi,Ii,ci):(xs(Yr),Lr[zi]=bs-1,Ar[Ii]=bs-1)}else xs(Yr)}return Nr.filter((function(mr){return mr.geometry}))})(this.features)),this.sortFeaturesByKey&&this.features.sort((function(Or,Lr){return Or.sortKey-Lr.sortKey}))}},Ki.prototype.update=function(a,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(a,c,this.layers,f))},Ki.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Ki.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ki.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ki.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Ki.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Ki.prototype.addToLineVertexArray=function(a,c){var f=this.lineVertexArray.length;if(a.segment!==void 0){for(var v=a.dist(c[a.segment+1]),I=a.dist(c[a.segment]),A={},R=a.segment+1;R<c.length;R++)A[R]={x:c[R].x,y:c[R].y,tileUnitDistanceFromAnchor:v},R<c.length-1&&(v+=c[R+1].dist(c[R]));for(var O=a.segment||0;O>=0;O--)A[O]={x:c[O].x,y:c[O].y,tileUnitDistanceFromAnchor:I},O>0&&(I+=c[O-1].dist(c[O]));for(var Z=0;Z<c.length;Z++){var X=A[Z];this.lineVertexArray.emplaceBack(X.x,X.y,X.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}},Ki.prototype.addSymbols=function(a,c,f,v,I,A,R,O,Z,X,$,ne){for(var de=a.indexArray,_e=a.layoutVertexArray,Me=a.segments.prepareSegment(4*c.length,_e,de,this.canOverlap?A.sortKey:void 0),Pe=this.glyphOffsetArray.length,He=Me.vertexLength,Ve=this.allowVerticalPlacement&&R===Fa.vertical?Math.PI/2:0,et=A.text&&A.text.sections,it=0;it<c.length;it++){var rt=c[it],lt=rt.tl,yt=rt.tr,Rt=rt.bl,Zt=rt.br,gn=rt.tex,Jt=rt.pixelOffsetTL,bn=rt.pixelOffsetBR,Qt=rt.minFontScaleX,jn=rt.minFontScaleY,Mn=rt.glyphOffset,un=rt.isSDF,ni=rt.sectionIndex,Un=Me.vertexLength,_i=Mn[1];E1(_e,O.x,O.y,lt.x,_i+lt.y,gn.x,gn.y,f,un,Jt.x,Jt.y,Qt,jn),E1(_e,O.x,O.y,yt.x,_i+yt.y,gn.x+gn.w,gn.y,f,un,bn.x,Jt.y,Qt,jn),E1(_e,O.x,O.y,Rt.x,_i+Rt.y,gn.x,gn.y+gn.h,f,un,Jt.x,bn.y,Qt,jn),E1(_e,O.x,O.y,Zt.x,_i+Zt.y,gn.x+gn.w,gn.y+gn.h,f,un,bn.x,bn.y,Qt,jn),HA(a.dynamicLayoutVertexArray,O,Ve),de.emplaceBack(Un,Un+1,Un+2),de.emplaceBack(Un+1,Un+2,Un+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mn[0]),it!==c.length-1&&ni===c[it+1].sectionIndex||a.programConfigurations.populatePaintArrays(_e.length,A,A.index,{},ne,et&&et[ni])}a.placedSymbolArray.emplaceBack(O.x,O.y,Pe,this.glyphOffsetArray.length-Pe,He,Z,X,O.segment,f?f[0]:0,f?f[1]:0,v[0],v[1],R,0,!1,0,$)},Ki.prototype._addCollisionDebugVertex=function(a,c,f,v,I,A){return c.emplaceBack(0,0),a.emplaceBack(f.x,f.y,v,I,Math.round(A.x),Math.round(A.y))},Ki.prototype.addCollisionDebugVertices=function(a,c,f,v,I,A,R){var O=I.segments.prepareSegment(4,I.layoutVertexArray,I.indexArray),Z=O.vertexLength,X=I.layoutVertexArray,$=I.collisionVertexArray,ne=R.anchorX,de=R.anchorY;this._addCollisionDebugVertex(X,$,A,ne,de,new d(a,c)),this._addCollisionDebugVertex(X,$,A,ne,de,new d(f,c)),this._addCollisionDebugVertex(X,$,A,ne,de,new d(f,v)),this._addCollisionDebugVertex(X,$,A,ne,de,new d(a,v)),O.vertexLength+=4;var _e=I.indexArray;_e.emplaceBack(Z,Z+1),_e.emplaceBack(Z+1,Z+2),_e.emplaceBack(Z+2,Z+3),_e.emplaceBack(Z+3,Z),O.primitiveLength+=4},Ki.prototype.addDebugCollisionBoxes=function(a,c,f,v){for(var I=a;I<c;I++){var A=this.collisionBoxArray.get(I);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,v?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,f)}},Ki.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new k_(bd,Jk.members,jf),this.iconCollisionBox=new k_(bd,Jk.members,jf);for(var a=0;a<this.symbolInstances.length;a++){var c=this.symbolInstances.get(a);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}},Ki.prototype._deserializeCollisionBoxesForSymbol=function(a,c,f,v,I,A,R,O,Z){for(var X={},$=c;$<f;$++){var ne=a.get($);X.textBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},X.textFeatureIndex=ne.featureIndex;break}for(var de=v;de<I;de++){var _e=a.get(de);X.verticalTextBox={x1:_e.x1,y1:_e.y1,x2:_e.x2,y2:_e.y2,anchorPointX:_e.anchorPointX,anchorPointY:_e.anchorPointY},X.verticalTextFeatureIndex=_e.featureIndex;break}for(var Me=A;Me<R;Me++){var Pe=a.get(Me);X.iconBox={x1:Pe.x1,y1:Pe.y1,x2:Pe.x2,y2:Pe.y2,anchorPointX:Pe.anchorPointX,anchorPointY:Pe.anchorPointY},X.iconFeatureIndex=Pe.featureIndex;break}for(var He=O;He<Z;He++){var Ve=a.get(He);X.verticalIconBox={x1:Ve.x1,y1:Ve.y1,x2:Ve.x2,y2:Ve.y2,anchorPointX:Ve.anchorPointX,anchorPointY:Ve.anchorPointY},X.verticalIconFeatureIndex=Ve.featureIndex;break}return X},Ki.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var c=0;c<this.symbolInstances.length;c++){var f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}},Ki.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ki.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ki.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Ki.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Ki.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Ki.prototype.addIndicesForPlacedSymbol=function(a,c){for(var f=a.placedSymbolArray.get(c),v=f.vertexStartIndex+4*f.numGlyphs,I=f.vertexStartIndex;I<v;I+=4)a.indexArray.emplaceBack(I,I+1,I+2),a.indexArray.emplaceBack(I+1,I+2,I+3)},Ki.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var c=Math.sin(a),f=Math.cos(a),v=[],I=[],A=[],R=0;R<this.symbolInstances.length;++R){A.push(R);var O=this.symbolInstances.get(R);v.push(0|Math.round(c*O.anchorX+f*O.anchorY)),I.push(O.featureIndex)}return A.sort((function(Z,X){return v[Z]-v[X]||I[X]-I[Z]})),A},Ki.prototype.addToSortKeyRanges=function(a,c){var f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:a,symbolInstanceEnd:a+1})},Ki.prototype.sortFeatures=function(a){var c=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var f=0,v=this.symbolInstanceIndexes;f<v.length;f+=1){var I=this.symbolInstances.get(v[f]);this.featureSortOrder.push(I.featureIndex),[I.rightJustifiedTextSymbolIndex,I.centerJustifiedTextSymbolIndex,I.leftJustifiedTextSymbolIndex].forEach((function(A,R,O){A>=0&&O.indexOf(A)===R&&c.addIndicesForPlacedSymbol(c.text,A)})),I.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,I.verticalPlacedTextSymbolIndex),I.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,I.placedIconSymbolIndex),I.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,I.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},sn("SymbolBucket",Ki,{omit:["layers","collisionBoxArray","features","compareText"]}),Ki.MAX_GLYPHS=65535,Ki.addDynamicAttributes=HA;var O8=new Xs({"symbol-placement":new _n(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new _n(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _n(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ln(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _n(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _n(ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _n(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new _n(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _n(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new ln(ye.layout_symbol["icon-size"]),"icon-text-fit":new _n(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _n(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new ln(ye.layout_symbol["icon-image"]),"icon-rotate":new ln(ye.layout_symbol["icon-rotate"]),"icon-padding":new _n(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new _n(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new ln(ye.layout_symbol["icon-offset"]),"icon-anchor":new ln(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _n(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _n(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _n(ye.layout_symbol["text-rotation-alignment"]),"text-field":new ln(ye.layout_symbol["text-field"]),"text-font":new ln(ye.layout_symbol["text-font"]),"text-size":new ln(ye.layout_symbol["text-size"]),"text-max-width":new ln(ye.layout_symbol["text-max-width"]),"text-line-height":new _n(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new ln(ye.layout_symbol["text-letter-spacing"]),"text-justify":new ln(ye.layout_symbol["text-justify"]),"text-radial-offset":new ln(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _n(ye.layout_symbol["text-variable-anchor"]),"text-anchor":new ln(ye.layout_symbol["text-anchor"]),"text-max-angle":new _n(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new _n(ye.layout_symbol["text-writing-mode"]),"text-rotate":new ln(ye.layout_symbol["text-rotate"]),"text-padding":new _n(ye.layout_symbol["text-padding"]),"text-keep-upright":new _n(ye.layout_symbol["text-keep-upright"]),"text-transform":new ln(ye.layout_symbol["text-transform"]),"text-offset":new ln(ye.layout_symbol["text-offset"]),"text-allow-overlap":new _n(ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _n(ye.layout_symbol["text-ignore-placement"]),"text-optional":new _n(ye.layout_symbol["text-optional"])}),KA={paint:new Xs({"icon-opacity":new ln(ye.paint_symbol["icon-opacity"]),"icon-color":new ln(ye.paint_symbol["icon-color"]),"icon-halo-color":new ln(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new ln(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ln(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new _n(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new _n(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new ln(ye.paint_symbol["text-opacity"]),"text-color":new ln(ye.paint_symbol["text-color"],{runtimeType:Yt,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new ln(ye.paint_symbol["text-halo-color"]),"text-halo-width":new ln(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new ln(ye.paint_symbol["text-halo-blur"]),"text-translate":new _n(ye.paint_symbol["text-translate"]),"text-translate-anchor":new _n(ye.paint_symbol["text-translate-anchor"])}),layout:O8},Hg=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:nn,this.defaultValue=a};Hg.prototype.evaluate=function(a){if(a.formattedSection){var c=this.defaultValue.property.overrides;if(c&&c.hasOverride(a.formattedSection))return c.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},Hg.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},Hg.prototype.outputDefined=function(){return!1},Hg.prototype.serialize=function(){return null},sn("FormatSectionOverride",Hg,{omit:["defaultValue"]});var N8=(function(a){function c(f){a.call(this,f,KA)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.recalculate=function(f,v){if(a.prototype.recalculate.call(this,f,v),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var I=this.layout.get("text-writing-mode");if(I){for(var A=[],R=0,O=I;R<O.length;R+=1){var Z=O[R];A.indexOf(Z)<0&&A.push(Z)}this.layout._values["text-writing-mode"]=A}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},c.prototype.getValueAndResolveTokens=function(f,v,I,A){var R=this.layout.get(f).evaluate(v,{},I,A),O=this._unevaluatedLayout._values[f];return O.isDataDriven()||Nf(O.value)||!R?R:(function(Z,X){return X.replace(/{([^{}]+)}/g,(function($,ne){return ne in Z?String(Z[ne]):""}))})(v.properties,R)},c.prototype.createBucket=function(f){return new Ki(f)},c.prototype.queryRadius=function(){return 0},c.prototype.queryIntersectsFeature=function(){return!1},c.prototype._setPaintOverrides=function(){for(var f=0,v=KA.paint.overridableProperties;f<v.length;f+=1){var I=v[f];if(c.hasPaintOverride(this.layout,I)){var A,R=this.paint.get(I),O=new Hg(R),Z=new fd(O,R.property.specification);A=R.value.kind==="constant"||R.value.kind==="source"?new Df("source",Z):new pd("composite",Z,R.value.zoomStops,R.value._interpolationType),this.paint._values[I]=new lo(R.property,A,R.parameters)}}},c.prototype._handleOverridablePaintPropertyUpdate=function(f,v,I){return!(!this.layout||v.isDataDriven()||I.isDataDriven())&&c.hasPaintOverride(this.layout,f)},c.hasPaintOverride=function(f,v){var I=f.get("text-field"),A=KA.paint.properties[v],R=!1,O=function($){for(var ne=0,de=$;ne<de.length;ne+=1)if(A.overrides&&A.overrides.hasOverride(de[ne]))return void(R=!0)};if(I.value.kind==="constant"&&I.value.value instanceof Es)O(I.value.value.sections);else if(I.value.kind==="source"){var Z=function($){R||($ instanceof oo&&Ur($.value)===Kt?O($.value.sections):$ instanceof il?O($.sections):$.eachChild(Z))},X=I.value;X._styleExpression&&Z(X._styleExpression.expression)}return R},c})(Pl),D8={paint:new Xs({"background-color":new _n(ye.paint_background["background-color"]),"background-pattern":new uo(ye.paint_background["background-pattern"]),"background-opacity":new _n(ye.paint_background["background-opacity"])})},V8=(function(a){function c(f){a.call(this,f,D8)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c})(Pl),B8={paint:new Xs({"raster-opacity":new _n(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new _n(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _n(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _n(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new _n(ye.paint_raster["raster-saturation"]),"raster-contrast":new _n(ye.paint_raster["raster-contrast"]),"raster-resampling":new _n(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new _n(ye.paint_raster["raster-fade-duration"])})},Z8=(function(a){function c(f){a.call(this,f,B8)}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c})(Pl),W8=(function(a){function c(f){a.call(this,f,{}),this.implementation=f}return a&&(c.__proto__=a),(c.prototype=Object.create(a&&a.prototype)).constructor=c,c.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},c.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},c.prototype.recalculate=function(){},c.prototype.updateTransitions=function(){},c.prototype.hasTransition=function(){},c.prototype.serialize=function(){},c.prototype.onAdd=function(f){this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},c.prototype.onRemove=function(f){this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},c})(Pl),z8={circle:LA,heatmap:Sz,hillshade:Tz,fill:Xz,"fill-extrusion":e8,line:o8,symbol:N8,background:V8,raster:Z8},bL=y.HTMLImageElement,xL=y.HTMLCanvasElement,IL=y.HTMLVideoElement,CL=y.ImageData,T1=y.ImageBitmap,tp=function(a,c,f,v){this.context=a,this.format=f,this.texture=a.gl.createTexture(),this.update(c,v)};tp.prototype.update=function(a,c,f){var v=a.width,I=a.height,A=!(this.size&&this.size[0]===v&&this.size[1]===I||f),R=this.context,O=R.gl;if(this.useMipmap=!!(c&&c.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!c||c.premultiply!==!1)),A)this.size=[v,I],a instanceof bL||a instanceof xL||a instanceof IL||a instanceof CL||T1&&a instanceof T1?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,a):O.texImage2D(O.TEXTURE_2D,0,this.format,v,I,0,this.format,O.UNSIGNED_BYTE,a.data);else{var Z=f||{x:0,y:0},X=Z.x,$=Z.y;a instanceof bL||a instanceof xL||a instanceof IL||a instanceof CL||T1&&a instanceof T1?O.texSubImage2D(O.TEXTURE_2D,0,X,$,O.RGBA,O.UNSIGNED_BYTE,a):O.texSubImage2D(O.TEXTURE_2D,0,X,$,v,I,O.RGBA,O.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)},tp.prototype.bind=function(a,c,f){var v=this.context.gl;v.bindTexture(v.TEXTURE_2D,this.texture),f!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=v.LINEAR),a!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,a),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,f||a),this.filter=a),c!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,c),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,c),this.wrap=c)},tp.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},tp.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var jA=function(a){var c=this;this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){c._triggered=!1,c._callback()})};jA.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){a._triggered=!1,a._callback()}),0))},jA.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Kg=function(a,c,f){this.target=a,this.parent=c,this.mapId=f,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},j(["receive","process"],this),this.invoker=new jA(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=le()?a:y};function wL(a,c,f){var v=2*Math.PI*6378137/256/Math.pow(2,f);return[a*v-2*Math.PI*6378137/2,c*v-2*Math.PI*6378137/2]}Kg.prototype.send=function(a,c,f,v,I){var A=this;I===void 0&&(I=!1);var R=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(this.callbacks[R]=f);var O=we(this.globalScope)?void 0:[];return this.target.postMessage({id:R,type:a,hasCallback:!!f,targetMapId:v,mustQueue:I,sourceMapId:this.mapId,data:sl(c,O)},O),{cancel:function(){f&&delete A.callbacks[R],A.target.postMessage({id:R,type:"<cancel>",targetMapId:v,sourceMapId:A.mapId})}}},Kg.prototype.receive=function(a){var c=a.data,f=c.id;if(f&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){delete this.tasks[f];var v=this.cancelCallbacks[f];delete this.cancelCallbacks[f],v&&v()}else le()||c.mustQueue?(this.tasks[f]=c,this.taskQueue.push(f),this.invoker.trigger()):this.processTask(f,c)},Kg.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),c=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),c&&this.processTask(a,c)}},Kg.prototype.processTask=function(a,c){var f=this;if(c.type==="<response>"){var v=this.callbacks[a];delete this.callbacks[a],v&&(c.error?v(Do(c.error)):v(null,Do(c.data)))}else{var I=!1,A=we(this.globalScope)?void 0:[],R=c.hasCallback?function($,ne){I=!0,delete f.cancelCallbacks[a],f.target.postMessage({id:a,type:"<response>",sourceMapId:f.mapId,error:$?sl($):null,data:sl(ne,A)},A)}:function($){I=!0},O=null,Z=Do(c.data);if(this.parent[c.type])O=this.parent[c.type](c.sourceMapId,Z,R);else if(this.parent.getWorkerSource){var X=c.type.split(".");O=this.parent.getWorkerSource(c.sourceMapId,X[0],Z.source)[X[1]](Z,R)}else R(new Error("Could not find function "+c.type));!I&&O&&O.cancel&&(this.cancelCallbacks[a]=O.cancel)}},Kg.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var as=function(a,c){a&&(c?this.setSouthWest(a).setNorthEast(c):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};as.prototype.setNorthEast=function(a){return this._ne=a instanceof Cr?new Cr(a.lng,a.lat):Cr.convert(a),this},as.prototype.setSouthWest=function(a){return this._sw=a instanceof Cr?new Cr(a.lng,a.lat):Cr.convert(a),this},as.prototype.extend=function(a){var c,f,v=this._sw,I=this._ne;if(a instanceof Cr)c=a,f=a;else{if(!(a instanceof as))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(as.convert(a)):this.extend(Cr.convert(a)):this;if(f=a._ne,!(c=a._sw)||!f)return this}return v||I?(v.lng=Math.min(c.lng,v.lng),v.lat=Math.min(c.lat,v.lat),I.lng=Math.max(f.lng,I.lng),I.lat=Math.max(f.lat,I.lat)):(this._sw=new Cr(c.lng,c.lat),this._ne=new Cr(f.lng,f.lat)),this},as.prototype.getCenter=function(){return new Cr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},as.prototype.getSouthWest=function(){return this._sw},as.prototype.getNorthEast=function(){return this._ne},as.prototype.getNorthWest=function(){return new Cr(this.getWest(),this.getNorth())},as.prototype.getSouthEast=function(){return new Cr(this.getEast(),this.getSouth())},as.prototype.getWest=function(){return this._sw.lng},as.prototype.getSouth=function(){return this._sw.lat},as.prototype.getEast=function(){return this._ne.lng},as.prototype.getNorth=function(){return this._ne.lat},as.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},as.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},as.prototype.isEmpty=function(){return!(this._sw&&this._ne)},as.prototype.contains=function(a){var c=Cr.convert(a),f=c.lng,v=c.lat,I=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(I=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=v&&v<=this._ne.lat&&I},as.convert=function(a){return!a||a instanceof as?a:new as(a)};var Cr=function(a,c){if(isNaN(a)||isNaN(c))throw new Error("Invalid LngLat object: ("+a+", "+c+")");if(this.lng=+a,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Cr.prototype.wrap=function(){return new Cr(T(this.lng,-180,180),this.lat)},Cr.prototype.toArray=function(){return[this.lng,this.lat]},Cr.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Cr.prototype.distanceTo=function(a){var c=Math.PI/180,f=this.lat*c,v=a.lat*c,I=Math.sin(f)*Math.sin(v)+Math.cos(f)*Math.cos(v)*Math.cos((a.lng-this.lng)*c);return 63710088e-1*Math.acos(Math.min(I,1))},Cr.prototype.toBounds=function(a){a===void 0&&(a=0);var c=360*a/40075017,f=c/Math.cos(Math.PI/180*this.lat);return new as(new Cr(this.lng-f,this.lat-c),new Cr(this.lng+f,this.lat+c))},Cr.convert=function(a){if(a instanceof Cr)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Cr(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Cr(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var AL=2*Math.PI*63710088e-1;function SL(a){return AL*Math.cos(a*Math.PI/180)}function EL(a){return(180+a)/360}function TL(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function RL(a,c){return a/SL(c)}function $A(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var np=function(a,c,f){f===void 0&&(f=0),this.x=+a,this.y=+c,this.z=+f};np.fromLngLat=function(a,c){c===void 0&&(c=0);var f=Cr.convert(a);return new np(EL(f.lng),TL(f.lat),RL(c,f.lat))},np.prototype.toLngLat=function(){return new Cr(360*this.x-180,$A(this.y))},np.prototype.toAltitude=function(){return this.z*SL($A(this.y))},np.prototype.meterInMercatorCoordinateUnits=function(){return 1/AL*(a=$A(this.y),1/Math.cos(a*Math.PI/180));var a};var ip=function(a,c,f){this.z=a,this.x=c,this.y=f,this.key=L_(0,a,a,c,f)};ip.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},ip.prototype.url=function(a,c){var f,v,I,A,R,O=(v=this.y,I=this.z,A=wL(256*(f=this.x),256*(v=Math.pow(2,I)-v-1),I),R=wL(256*(f+1),256*(v+1),I),A[0]+","+A[1]+","+R[0]+","+R[1]),Z=(function(X,$,ne){for(var de,_e="",Me=X;Me>0;Me--)_e+=($&(de=1<<Me-1)?1:0)+(ne&de?2:0);return _e})(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",Z).replace("{bbox-epsg-3857}",O)},ip.prototype.getTilePoint=function(a){var c=Math.pow(2,this.z);return new d(8192*(a.x*c-this.x),8192*(a.y*c-this.y))},ip.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var ML=function(a,c){this.wrap=a,this.canonical=c,this.key=L_(a,c.z,c.z,c.x,c.y)},ls=function(a,c,f,v,I){this.overscaledZ=a,this.wrap=c,this.canonical=new ip(f,+v,+I),this.key=L_(c,a,f,v,I)};function L_(a,c,f,v,I){(a*=2)<0&&(a=-1*a-1);var A=1<<f;return(A*A*a+A*I+v).toString(36)+f.toString(36)+c.toString(36)}ls.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},ls.prototype.scaledTo=function(a){var c=this.canonical.z-a;return a>this.canonical.z?new ls(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ls(a,this.wrap,a,this.canonical.x>>c,this.canonical.y>>c)},ls.prototype.calculateScaledKey=function(a,c){var f=this.canonical.z-a;return a>this.canonical.z?L_(this.wrap*+c,a,this.canonical.z,this.canonical.x,this.canonical.y):L_(this.wrap*+c,a,a,this.canonical.x>>f,this.canonical.y>>f)},ls.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var c=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>c&&a.canonical.y===this.canonical.y>>c},ls.prototype.children=function(a){if(this.overscaledZ>=a)return[new ls(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var c=this.canonical.z+1,f=2*this.canonical.x,v=2*this.canonical.y;return[new ls(c,this.wrap,c,f,v),new ls(c,this.wrap,c,f+1,v),new ls(c,this.wrap,c,f,v+1),new ls(c,this.wrap,c,f+1,v+1)]},ls.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},ls.prototype.wrapped=function(){return new ls(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.unwrapTo=function(a){return new ls(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ls.prototype.toUnwrapped=function(){return new ML(this.wrap,this.canonical)},ls.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ls.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new np(a.x-this.wrap,a.y))},sn("CanonicalTileID",ip),sn("OverscaledTileID",ls,{omit:["posMatrix"]});var uh=function(a,c,f){if(this.uid=a,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return he('"'+f+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=c.height;var v=this.dim=c.height-2;this.data=new Uint32Array(c.data.buffer),this.encoding=f||"mapbox";for(var I=0;I<v;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(v,I)]=this.data[this._idx(v-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,v)]=this.data[this._idx(I,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)]};uh.prototype.get=function(a,c){var f=new Uint8Array(this.data.buffer),v=4*this._idx(a,c);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[v],f[v+1],f[v+2])},uh.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},uh.prototype._idx=function(a,c){if(a<-1||a>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(a+1)},uh.prototype._unpackMapbox=function(a,c,f){return(256*a*256+256*c+f)/10-1e4},uh.prototype._unpackTerrarium=function(a,c,f){return 256*a+c+f/256-32768},uh.prototype.getPixels=function(){return new zo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},uh.prototype.backfillBorder=function(a,c,f){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var v=c*this.dim,I=c*this.dim+this.dim,A=f*this.dim,R=f*this.dim+this.dim;switch(c){case-1:v=I-1;break;case 1:I=v+1}switch(f){case-1:A=R-1;break;case 1:R=A+1}for(var O=-c*this.dim,Z=-f*this.dim,X=A;X<R;X++)for(var $=v;$<I;$++)this.data[this._idx($,X)]=a.data[this._idx($+O,X+Z)]},sn("DEMData",uh);var R1=function(a){this._stringToNumber={},this._numberToString=[];for(var c=0;c<a.length;c++){var f=a[c];this._stringToNumber[f]=c,this._numberToString[c]=f}};R1.prototype.encode=function(a){return this._stringToNumber[a]},R1.prototype.decode=function(a){return this._numberToString[a]};var M1=function(a,c,f,v,I){this.type="Feature",this._vectorTileFeature=a,a._z=c,a._x=f,a._y=v,this.properties=a.properties,this.id=I},JA={geometry:{configurable:!0}};JA.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},JA.geometry.set=function(a){this._geometry=a},M1.prototype.toJSON=function(){var a={geometry:this.geometry};for(var c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(a[c]=this[c]);return a},Object.defineProperties(M1.prototype,JA);var jg=function(){this.state={},this.stateChanges={},this.deletedStates={}};jg.prototype.updateState=function(a,c,f){var v=String(c);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][v]=this.stateChanges[a][v]||{},M(this.stateChanges[a][v],f),this.deletedStates[a]===null)for(var I in this.deletedStates[a]={},this.state[a])I!==v&&(this.deletedStates[a][I]=null);else if(this.deletedStates[a]&&this.deletedStates[a][v]===null)for(var A in this.deletedStates[a][v]={},this.state[a][v])f[A]||(this.deletedStates[a][v][A]=null);else for(var R in f)this.deletedStates[a]&&this.deletedStates[a][v]&&this.deletedStates[a][v][R]===null&&delete this.deletedStates[a][v][R]},jg.prototype.removeFeatureState=function(a,c,f){if(this.deletedStates[a]!==null){var v=String(c);if(this.deletedStates[a]=this.deletedStates[a]||{},f&&c!==void 0)this.deletedStates[a][v]!==null&&(this.deletedStates[a][v]=this.deletedStates[a][v]||{},this.deletedStates[a][v][f]=null);else if(c!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][v])for(f in this.deletedStates[a][v]={},this.stateChanges[a][v])this.deletedStates[a][v][f]=null;else this.deletedStates[a][v]=null;else this.deletedStates[a]=null}},jg.prototype.getState=function(a,c){var f=String(c),v=M({},(this.state[a]||{})[f],(this.stateChanges[a]||{})[f]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var I=this.deletedStates[a][c];if(I===null)return{};for(var A in I)delete v[A]}return v},jg.prototype.initializeTileState=function(a,c){a.setFeatureState(this.state,c)},jg.prototype.coalesceChanges=function(a,c){var f={};for(var v in this.stateChanges){this.state[v]=this.state[v]||{};var I={};for(var A in this.stateChanges[v])this.state[v][A]||(this.state[v][A]={}),M(this.state[v][A],this.stateChanges[v][A]),I[A]=this.state[v][A];f[v]=I}for(var R in this.deletedStates){this.state[R]=this.state[R]||{};var O={};if(this.deletedStates[R]===null)for(var Z in this.state[R])O[Z]={},this.state[R][Z]={};else for(var X in this.deletedStates[R]){if(this.deletedStates[R][X]===null)this.state[R][X]={};else for(var $=0,ne=Object.keys(this.deletedStates[R][X]);$<ne.length;$+=1)delete this.state[R][X][ne[$]];O[X]=this.state[R][X]}f[R]=f[R]||{},M(f[R],O)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(var de in a)a[de].setFeatureState(f,c)};var ch=function(a,c){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new ru(8192,16,0),this.grid3D=new ru(8192,16,0),this.featureIndexArray=new ae,this.promoteId=c};function kL(a,c,f,v,I){return te(a,(function(A,R){var O=c instanceof Hf?c.get(R):null;return O&&O.evaluate?O.evaluate(f,v,I):O}))}function LL(a){for(var c=1/0,f=1/0,v=-1/0,I=-1/0,A=0,R=a;A<R.length;A+=1){var O=R[A];c=Math.min(c,O.x),f=Math.min(f,O.y),v=Math.max(v,O.x),I=Math.max(I,O.y)}return{minX:c,minY:f,maxX:v,maxY:I}}function U8(a,c){return c-a}ch.prototype.insert=function(a,c,f,v,I,A){var R=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,v,I);for(var O=A?this.grid3D:this.grid,Z=0;Z<c.length;Z++){for(var X=c[Z],$=[1/0,1/0,-1/0,-1/0],ne=0;ne<X.length;ne++){var de=X[ne];$[0]=Math.min($[0],de.x),$[1]=Math.min($[1],de.y),$[2]=Math.max($[2],de.x),$[3]=Math.max($[3],de.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&O.insert(R,$[0],$[1],$[2],$[3])}},ch.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Vg.VectorTile(new _1(this.rawTileData)).layers,this.sourceLayerCoder=new R1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ch.prototype.query=function(a,c,f,v){var I=this;this.loadVTLayers();for(var A=a.params||{},R=8192/a.tileSize/a.scale,O=Ig(A.filter),Z=a.queryGeometry,X=a.queryPadding*R,$=LL(Z),ne=this.grid.query($.minX-X,$.minY-X,$.maxX+X,$.maxY+X),de=LL(a.cameraQueryGeometry),_e=this.grid3D.query(de.minX-X,de.minY-X,de.maxX+X,de.maxY+X,(function(rt,lt,yt,Rt){return(function(Zt,gn,Jt,bn,Qt){for(var jn=0,Mn=Zt;jn<Mn.length;jn+=1){var un=Mn[jn];if(gn<=un.x&&Jt<=un.y&&bn>=un.x&&Qt>=un.y)return!0}var ni=[new d(gn,Jt),new d(gn,Qt),new d(bn,Qt),new d(bn,Jt)];if(Zt.length>2){for(var Un=0,_i=ni;Un<_i.length;Un+=1)if(Fl(Zt,_i[Un]))return!0}for(var xn=0;xn<Zt.length-1;xn++)if(qf(Zt[xn],Zt[xn+1],ni))return!0;return!1})(a.cameraQueryGeometry,rt-X,lt-X,yt+X,Rt+X)})),Me=0,Pe=_e;Me<Pe.length;Me+=1)ne.push(Pe[Me]);ne.sort(U8);for(var He,Ve={},et=function(rt){var lt=ne[rt];if(lt!==He){He=lt;var yt=I.featureIndexArray.get(lt),Rt=null;I.loadMatchingFeature(Ve,yt.bucketIndex,yt.sourceLayerIndex,yt.featureIndex,O,A.layers,A.availableImages,c,f,v,(function(Zt,gn,Jt){return Rt||(Rt=kr(Zt)),gn.queryIntersectsFeature(Z,Zt,Jt,Rt,I.z,a.transform,R,a.pixelPosMatrix)}))}},it=0;it<ne.length;it++)et(it);return Ve},ch.prototype.loadMatchingFeature=function(a,c,f,v,I,A,R,O,Z,X,$){var ne=this.bucketLayerIDs[c];if(!A||(function(Zt,gn){for(var Jt=0;Jt<Zt.length;Jt++)if(gn.indexOf(Zt[Jt])>=0)return!0;return!1})(A,ne)){var de=this.sourceLayerCoder.decode(f),_e=this.vtLayers[de].feature(v);if(I.needGeometry){var Me=Xr(_e,!0);if(!I.filter(new li(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!I.filter(new li(this.tileID.overscaledZ),_e))return;for(var Pe=this.getId(_e,de),He=0;He<ne.length;He++){var Ve=ne[He];if(!(A&&A.indexOf(Ve)<0)){var et=O[Ve];if(et){var it={};Pe!==void 0&&X&&(it=X.getState(et.sourceLayer||"_geojsonTileLayer",Pe));var rt=M({},Z[Ve]);rt.paint=kL(rt.paint,et.paint,_e,it,R),rt.layout=kL(rt.layout,et.layout,_e,it,R);var lt=!$||$(_e,et,it);if(lt){var yt=new M1(_e,this.z,this.x,this.y,Pe);yt.layer=rt;var Rt=a[Ve];Rt===void 0&&(Rt=a[Ve]=[]),Rt.push({featureIndex:v,feature:yt,intersectionZ:lt})}}}}}},ch.prototype.lookupSymbolFeatures=function(a,c,f,v,I,A,R,O){var Z={};this.loadVTLayers();for(var X=Ig(I),$=0,ne=a;$<ne.length;$+=1)this.loadMatchingFeature(Z,f,v,ne[$],X,A,R,O,c);return Z},ch.prototype.hasLayer=function(a){for(var c=0,f=this.bucketLayerIDs;c<f.length;c+=1)for(var v=0,I=f[c];v<I.length;v+=1)if(a===I[v])return!0;return!1},ch.prototype.getId=function(a,c){var f=a.id;return this.promoteId&&typeof(f=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]])=="boolean"&&(f=Number(f)),f},sn("FeatureIndex",ch,{omit:["rawTileData","sourceLayerCoder"]});var ks=function(a,c){this.tileID=a,this.uid=N(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ks.prototype.registerFadeDuration=function(a){var c=a+this.timeAdded;c<zt.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)},ks.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ks.prototype.loadVectorData=function(a,c,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var v in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=(function(X,$){var ne={};if(!$)return ne;for(var de=function(){var Pe=Me[_e],He=Pe.layerIds.map((function(it){return $.getLayer(it)})).filter(Boolean);if(He.length!==0){Pe.layers=He,Pe.stateDependentLayerIds&&(Pe.stateDependentLayers=Pe.stateDependentLayerIds.map((function(it){return He.filter((function(rt){return rt.id===it}))[0]})));for(var Ve=0,et=He;Ve<et.length;Ve+=1)ne[et[Ve].id]=Pe}},_e=0,Me=X;_e<Me.length;_e+=1)de();return ne})(a.buckets,c.style),this.hasSymbolBuckets=!1,this.buckets){var I=this.buckets[v];if(I instanceof Ki){if(this.hasSymbolBuckets=!0,!f)break;I.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var A in this.buckets){var R=this.buckets[A];if(R instanceof Ki&&R.hasRTLText){this.hasRTLText=!0,da.isLoading()||da.isLoaded()||g_()!=="deferred"||ol();break}}for(var O in this.queryPadding=0,this.buckets){var Z=this.buckets[O];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(O).queryRadius(Z))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new _},ks.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ks.prototype.getBucket=function(a){return this.buckets[a.id]},ks.prototype.upload=function(a){for(var c in this.buckets){var f=this.buckets[c];f.uploadPending()&&f.upload(a)}var v=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new tp(a,this.imageAtlas.image,v.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new tp(a,this.glyphAtlasImage,v.ALPHA),this.glyphAtlasImage=null)},ks.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},ks.prototype.queryRenderedFeatures=function(a,c,f,v,I,A,R,O,Z,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:I,scale:A,tileSize:this.tileSize,pixelPosMatrix:X,transform:O,params:R,queryPadding:this.queryPadding*Z},a,c,f):{}},ks.prototype.querySourceFeatures=function(a,c){var f=this.latestFeatureIndex;if(f&&f.rawTileData){var v=f.loadVTLayers(),I=c?c.sourceLayer:"",A=v._geojsonTileLayer||v[I];if(A)for(var R=Ig(c&&c.filter),O=this.tileID.canonical,Z=O.z,X=O.x,$=O.y,ne={z:Z,x:X,y:$},de=0;de<A.length;de++){var _e=A.feature(de);if(R.needGeometry){var Me=Xr(_e,!0);if(!R.filter(new li(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!R.filter(new li(this.tileID.overscaledZ),_e))continue;var Pe=f.getId(_e,I),He=new M1(_e,Z,X,$,Pe);He.tile=ne,a.push(He)}}},ks.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ks.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ks.prototype.setExpiryData=function(a){var c=this.expirationTime;if(a.cacheControl){var f=fe(a.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var v=Date.now(),I=!1;if(this.expirationTime>v)I=!1;else if(c)if(this.expirationTime<c)I=!0;else{var A=this.expirationTime-c;A?this.expirationTime=v+Math.max(A,3e4):I=!0}else I=!0;I?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ks.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ks.prototype.setFeatureState=function(a,c){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var f=this.latestFeatureIndex.loadVTLayers();for(var v in this.buckets)if(c.style.hasLayer(v)){var I=this.buckets[v],A=I.layers[0].sourceLayer||"_geojsonTileLayer",R=f[A],O=a[A];if(R&&O&&Object.keys(O).length!==0){I.update(O,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});var Z=c&&c.style&&c.style.getLayer(v);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(I)))}}}},ks.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ks.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<zt.now()},ks.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ks.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=zt.now()+a},ks.prototype.setDependencies=function(a,c){for(var f={},v=0,I=c;v<I.length;v+=1)f[I[v]]=!0;this.dependencies[a]=f},ks.prototype.hasDependency=function(a,c){for(var f=0,v=a;f<v.length;f+=1){var I=this.dependencies[v[f]];if(I){for(var A=0,R=c;A<R.length;A+=1)if(I[R[A]])return!0}}return!1};var Ad=y.performance,PL=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Ad.mark(this._marks.start)};PL.prototype.finish=function(){Ad.mark(this._marks.end);var a=Ad.getEntriesByName(this._marks.measure);return a.length===0&&(Ad.measure(this._marks.measure,this._marks.start,this._marks.end),a=Ad.getEntriesByName(this._marks.measure),Ad.clearMarks(this._marks.start),Ad.clearMarks(this._marks.end),Ad.clearMeasures(this._marks.measure)),a},s.Actor=Kg,s.AlphaImage=ep,s.CanonicalTileID=ip,s.CollisionBoxArray=_,s.Color=bi,s.DEMData=uh,s.DataConstantProperty=_n,s.DictionaryCoder=R1,s.EXTENT=8192,s.ErrorEvent=Ye,s.EvaluationParameters=li,s.Event=Ae,s.Evented=ze,s.FeatureIndex=ch,s.FillBucket=lu,s.FillExtrusionBucket=uu,s.ImageAtlas=M_,s.ImagePosition=b1,s.LineBucket=Ao,s.LngLat=Cr,s.LngLatBounds=as,s.MercatorCoordinate=np,s.ONE_EM=24,s.OverscaledTileID=ls,s.Point=d,s.Point$1=d,s.Properties=Xs,s.Protobuf=_1,s.RGBAImage=zo,s.RequestManager=We,s.RequestPerformance=PL,s.ResourceType=xo,s.SegmentVector=be,s.SourceFeatureState=jg,s.StructArrayLayout1ui2=x_,s.StructArrayLayout2f1f2i16=sh,s.StructArrayLayout2i4=rh,s.StructArrayLayout3ui6=Qu,s.StructArrayLayout4i8=y_,s.SymbolBucket=Ki,s.Texture=tp,s.Tile=ks,s.Transitionable=Us,s.Uniform1f=Nt,s.Uniform1i=vt,s.Uniform2f=Gt,s.Uniform3f=en,s.Uniform4f=vn,s.UniformColor=wn,s.UniformMatrix4f=xi,s.UnwrappedTileID=ML,s.ValidationError=Se,s.WritingMode=Fa,s.ZoomHistory=h_,s.add=function(a,c,f){return a[0]=c[0]+f[0],a[1]=c[1]+f[1],a[2]=c[2]+f[2],a},s.addDynamicAttributes=HA,s.asyncAll=function(a,c,f){if(!a.length)return f(null,[]);var v=a.length,I=new Array(a.length),A=null;a.forEach((function(R,O){c(R,(function(Z,X){Z&&(A=Z),I[O]=X,--v==0&&f(A,I)}))}))},s.bezier=C,s.bindAll=j,s.browser=zt,s.cacheEntryPossiblyAdded=function(a){++Ti>Tr&&(a.getActor().send("enforceCacheSizeLimit",Li),Ti=0)},s.clamp=S,s.clearTileCache=function(a){var c=y.caches.delete("mapbox-tiles");a&&c.catch(a).then((function(){return a()}))},s.clipLine=pL,s.clone=function(a){var c=new Gi(16);return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},s.clone$1=pe,s.clone$2=function(a){var c=new Gi(3);return c[0]=a[0],c[1]=a[1],c[2]=a[2],c},s.collisionCircleLayout=c8,s.config=Dt,s.create=function(){var a=new Gi(16);return Gi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},s.create$1=function(){var a=new Gi(9);return Gi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},s.create$2=function(){var a=new Gi(4);return Gi!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},s.createCommonjsModule=l,s.createExpression=bg,s.createLayout=Rs,s.createStyleLayer=function(a){return a.type==="custom"?new W8(a):new z8[a.type](a)},s.cross=function(a,c,f){var v=c[0],I=c[1],A=c[2],R=f[0],O=f[1],Z=f[2];return a[0]=I*Z-A*O,a[1]=A*R-v*Z,a[2]=v*O-I*R,a},s.deepEqual=function a(c,f){if(Array.isArray(c)){if(!Array.isArray(f)||c.length!==f.length)return!1;for(var v=0;v<c.length;v++)if(!a(c[v],f[v]))return!1;return!0}if(typeof c=="object"&&c!==null&&f!==null){if(typeof f!="object"||Object.keys(c).length!==Object.keys(f).length)return!1;for(var I in c)if(!a(c[I],f[I]))return!1;return!0}return c===f},s.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]},s.dot$1=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]},s.ease=w,s.emitValidationErrors=Uf,s.endsWith=J,s.enforceCacheSizeLimit=function(a){pi(),dt&&dt.then((function(c){c.keys().then((function(f){for(var v=0;v<f.length-a;v++)c.delete(f[v])}))}))},s.evaluateSizeForFeature=lL,s.evaluateSizeForZoom=uL,s.evaluateVariableOffset=yL,s.evented=p_,s.extend=M,s.featureFilter=Ig,s.filterObject=ce,s.fromRotation=function(a,c){var f=Math.sin(c),v=Math.cos(c);return a[0]=v,a[1]=f,a[2]=0,a[3]=-f,a[4]=v,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},s.getAnchorAlignment=zA,s.getAnchorJustification=YA,s.getArrayBuffer=Ml,s.getImage=ue,s.getJSON=function(a,c){return ys(M(a,{type:"json"}),c)},s.getRTLTextPluginStatus=g_,s.getReferrer=ms,s.getVideo=function(a,c){var f,v,I=y.document.createElement("video");I.muted=!0,I.onloadstart=function(){c(null,I)};for(var A=0;A<a.length;A++){var R=y.document.createElement("source");f=a[A],v=void 0,(v=y.document.createElement("a")).href=f,(v.protocol!==y.document.location.protocol||v.host!==y.document.location.host)&&(I.crossOrigin="Anonymous"),R.src=a[A],I.appendChild(R)}return{cancel:function(){}}},s.identity=fa,s.invert=function(a,c){var f=c[0],v=c[1],I=c[2],A=c[3],R=c[4],O=c[5],Z=c[6],X=c[7],$=c[8],ne=c[9],de=c[10],_e=c[11],Me=c[12],Pe=c[13],He=c[14],Ve=c[15],et=f*O-v*R,it=f*Z-I*R,rt=f*X-A*R,lt=v*Z-I*O,yt=v*X-A*O,Rt=I*X-A*Z,Zt=$*Pe-ne*Me,gn=$*He-de*Me,Jt=$*Ve-_e*Me,bn=ne*He-de*Pe,Qt=ne*Ve-_e*Pe,jn=de*Ve-_e*He,Mn=et*jn-it*Qt+rt*bn+lt*Jt-yt*gn+Rt*Zt;return Mn?(a[0]=(O*jn-Z*Qt+X*bn)*(Mn=1/Mn),a[1]=(I*Qt-v*jn-A*bn)*Mn,a[2]=(Pe*Rt-He*yt+Ve*lt)*Mn,a[3]=(de*yt-ne*Rt-_e*lt)*Mn,a[4]=(Z*Jt-R*jn-X*gn)*Mn,a[5]=(f*jn-I*Jt+A*gn)*Mn,a[6]=(He*rt-Me*Rt-Ve*it)*Mn,a[7]=($*Rt-de*rt+_e*it)*Mn,a[8]=(R*Qt-O*Jt+X*Zt)*Mn,a[9]=(v*Jt-f*Qt-A*Zt)*Mn,a[10]=(Me*yt-Pe*rt+Ve*et)*Mn,a[11]=(ne*rt-$*yt-_e*et)*Mn,a[12]=(O*gn-R*bn-Z*Zt)*Mn,a[13]=(f*bn-v*gn+I*Zt)*Mn,a[14]=(Pe*it-Me*lt-He*et)*Mn,a[15]=($*lt-ne*it+de*et)*Mn,a):null},s.isChar=Ht,s.isMapboxURL=ke,s.keysDifference=function(a,c){var f=[];for(var v in a)v in c||f.push(v);return f},s.makeRequest=ys,s.mapObject=te,s.mercatorXfromLng=EL,s.mercatorYfromLat=TL,s.mercatorZfromAltitude=RL,s.mul=kA,s.multiply=wo,s.mvt=Vg,s.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},s.normalize=function(a,c){var f=c[0],v=c[1],I=c[2],A=f*f+v*v+I*I;return A>0&&(A=1/Math.sqrt(A)),a[0]=c[0]*A,a[1]=c[1]*A,a[2]=c[2]*A,a},s.number=qr,s.offscreenCanvasSupported=Bs,s.ortho=function(a,c,f,v,I,A,R){var O=1/(c-f),Z=1/(v-I),X=1/(A-R);return a[0]=-2*O,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*Z,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*X,a[11]=0,a[12]=(c+f)*O,a[13]=(I+v)*Z,a[14]=(R+A)*X,a[15]=1,a},s.parseGlyphPBF=function(a){return new _1(a).readFields(x8,[])},s.pbf=_1,s.performSymbolLayout=function(a,c,f,v,I,A,R){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var O=a.layers[0].layout,Z=a.layers[0]._unevaluatedLayout._values,X={};if(a.textSizeData.kind==="composite"){var $=a.textSizeData,ne=$.maxZoom;X.compositeTextSizes=[Z["text-size"].possiblyEvaluate(new li($.minZoom),R),Z["text-size"].possiblyEvaluate(new li(ne),R)]}if(a.iconSizeData.kind==="composite"){var de=a.iconSizeData,_e=de.maxZoom;X.compositeIconSizes=[Z["icon-size"].possiblyEvaluate(new li(de.minZoom),R),Z["icon-size"].possiblyEvaluate(new li(_e),R)]}X.layoutTextSize=Z["text-size"].possiblyEvaluate(new li(a.zoom+1),R),X.layoutIconSize=Z["icon-size"].possiblyEvaluate(new li(a.zoom+1),R),X.textMaxSize=Z["text-size"].possiblyEvaluate(new li(18));for(var Me=24*O.get("text-line-height"),Pe=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",He=O.get("text-keep-upright"),Ve=O.get("text-size"),et=function(){var lt=rt[it],yt=O.get("text-font").evaluate(lt,{},R).join(","),Rt=Ve.evaluate(lt,{},R),Zt=X.layoutTextSize.evaluate(lt,{},R),gn=X.layoutIconSize.evaluate(lt,{},R),Jt={horizontal:{},vertical:void 0},bn=lt.text,Qt=[0,0];if(bn){var jn=bn.toString(),Mn=24*O.get("text-letter-spacing").evaluate(lt,{},R),un=(function(ci){for(var er=0,zi=ci;er<zi.length;er+=1)if(Ii=zi[er].charCodeAt(0),Ht.Arabic(Ii)||Ht["Arabic Supplement"](Ii)||Ht["Arabic Extended-A"](Ii)||Ht["Arabic Presentation Forms-A"](Ii)||Ht["Arabic Presentation Forms-B"](Ii))return!1;var Ii;return!0})(jn)?Mn:0,ni=O.get("text-anchor").evaluate(lt,{},R),Un=O.get("text-variable-anchor");if(!Un){var _i=O.get("text-radial-offset").evaluate(lt,{},R);Qt=_i?yL(ni,[24*_i,XA]):O.get("text-offset").evaluate(lt,{},R).map((function(ci){return 24*ci}))}var xn=Pe?"center":O.get("text-justify").evaluate(lt,{},R),Ri=O.get("symbol-placement"),wr=Ri==="point"?24*O.get("text-max-width").evaluate(lt,{},R):0,Or=function(){a.allowVerticalPlacement&&d_(jn)&&(Jt.vertical=x1(bn,c,f,I,yt,wr,Me,ni,"left",un,Qt,Fa.vertical,!0,Ri,Zt,Rt))};if(!Pe&&Un){for(var Lr=xn==="auto"?Un.map((function(ci){return YA(ci)})):[xn],Ar=!1,Nr=0;Nr<Lr.length;Nr++){var bs=Lr[Nr];if(!Jt.horizontal[bs])if(Ar)Jt.horizontal[bs]=Jt.horizontal[0];else{var xs=x1(bn,c,f,I,yt,wr,Me,"center",bs,un,Qt,Fa.horizontal,!1,Ri,Zt,Rt);xs&&(Jt.horizontal[bs]=xs,Ar=xs.positionedLines.length===1)}}Or()}else{xn==="auto"&&(xn=YA(ni));var fo=x1(bn,c,f,I,yt,wr,Me,ni,xn,un,Qt,Fa.horizontal,!1,Ri,Zt,Rt);fo&&(Jt.horizontal[xn]=fo),Or(),d_(jn)&&Pe&&He&&(Jt.vertical=x1(bn,c,f,I,yt,wr,Me,ni,xn,un,Qt,Fa.vertical,!1,Ri,Zt,Rt))}}var Ls=void 0,po=!1;if(lt.icon&&lt.icon.name){var Yr=v[lt.icon.name];Yr&&(Ls=(function(ci,er,zi){var Ii=zA(zi),So=er[0]-ci.displaySize[0]*Ii.horizontalAlign,no=er[1]-ci.displaySize[1]*Ii.verticalAlign;return{image:ci,top:no,bottom:no+ci.displaySize[1],left:So,right:So+ci.displaySize[0]}})(I[lt.icon.name],O.get("icon-offset").evaluate(lt,{},R),O.get("icon-anchor").evaluate(lt,{},R)),po=Yr.sdf,a.sdfIcons===void 0?a.sdfIcons=Yr.sdf:a.sdfIcons!==Yr.sdf&&he("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Yr.pixelRatio!==a.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var Ps=vL(Jt.horizontal)||Jt.vertical;a.iconsInText=!!Ps&&Ps.iconsInText,(Ps||Ls)&&(function(ci,er,zi,Ii,So,no,mr,es,io,Mi,sc){var Oa=no.textMaxSize.evaluate(er,{});Oa===void 0&&(Oa=mr);var oc,Hr=ci.layers[0].layout,ac=Hr.get("icon-offset").evaluate(er,{},sc),Nl=vL(zi.horizontal),$g=mr/24,rp=ci.tilePixelRatio*$g,Jg=ci.tilePixelRatio*Oa/24,hh=ci.tilePixelRatio*es,qg=ci.tilePixelRatio*Hr.get("symbol-spacing"),k1=Hr.get("text-padding")*ci.tilePixelRatio,Qg=Hr.get("icon-padding")*ci.tilePixelRatio,P_=Hr.get("text-max-angle")/180*Math.PI,L1=Hr.get("text-rotation-alignment")==="map"&&Hr.get("symbol-placement")!=="point",P1=Hr.get("icon-rotation-alignment")==="map"&&Hr.get("symbol-placement")!=="point",dh=Hr.get("symbol-placement"),G_=qg/2,em=Hr.get("icon-text-fit");Ii&&em!=="none"&&(ci.allowVerticalPlacement&&zi.vertical&&(oc=aL(Ii,zi.vertical,em,Hr.get("icon-text-fit-padding"),ac,$g)),Nl&&(Ii=aL(Ii,Nl,em,Hr.get("icon-text-fit-padding"),ac,$g)));var Sd=function(X8,W_){W_.x<0||W_.x>=8192||W_.y<0||W_.y>=8192||(function(Kr,cu,Y8,Ed,t2,OL,V1,lc,B1,z_,Z1,W1,n2,NL,U_,DL,VL,BL,ZL,WL,Na,z1,zL,uc,H8){var UL,op,sm,om,am,lm=Kr.addToLineVertexArray(cu,Y8),XL=0,YL=0,HL=0,KL=0,i2=-1,r2=-1,fh={},jL=Ee(""),s2=0,o2=0;if(lc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(s2=(UL=lc.layout.get("text-offset").evaluate(Na,{},uc).map((function(Y_){return 24*Y_})))[0],o2=UL[1]):(s2=24*lc.layout.get("text-radial-offset").evaluate(Na,{},uc),o2=XA),Kr.allowVerticalPlacement&&Ed.vertical){var $L=lc.layout.get("text-rotate").evaluate(Na,{},uc)+90;om=new S1(B1,cu,z_,Z1,W1,Ed.vertical,n2,NL,U_,$L),V1&&(am=new S1(B1,cu,z_,Z1,W1,V1,VL,BL,U_,$L))}if(t2){var a2=lc.layout.get("icon-rotate").evaluate(Na,{}),JL=lc.layout.get("icon-text-fit")!=="none",qL=gL(t2,a2,zL,JL),l2=V1?gL(V1,a2,zL,JL):void 0;sm=new S1(B1,cu,z_,Z1,W1,t2,VL,BL,!1,a2),XL=4*qL.length;var QL=Kr.iconSizeData,X_=null;QL.kind==="source"?(X_=[128*lc.layout.get("icon-size").evaluate(Na,{})])[0]>32640&&he(Kr.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):QL.kind==="composite"&&((X_=[128*z1.compositeIconSizes[0].evaluate(Na,{},uc),128*z1.compositeIconSizes[1].evaluate(Na,{},uc)])[0]>32640||X_[1]>32640)&&he(Kr.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Kr.addSymbols(Kr.icon,qL,X_,WL,ZL,Na,!1,cu,lm.lineStartIndex,lm.lineLength,-1,uc),i2=Kr.icon.placedSymbolArray.length-1,l2&&(YL=4*l2.length,Kr.addSymbols(Kr.icon,l2,X_,WL,ZL,Na,Fa.vertical,cu,lm.lineStartIndex,lm.lineLength,-1,uc),r2=Kr.icon.placedSymbolArray.length-1)}for(var eP in Ed.horizontal){var U1=Ed.horizontal[eP];if(!op){jL=Ee(U1.text);var K8=lc.layout.get("text-rotate").evaluate(Na,{},uc);op=new S1(B1,cu,z_,Z1,W1,U1,n2,NL,U_,K8)}var tP=U1.positionedLines.length===1;if(HL+=_L(Kr,cu,U1,OL,lc,U_,Na,DL,lm,Ed.vertical?Fa.horizontal:Fa.horizontalOnly,tP?Object.keys(Ed.horizontal):[eP],fh,i2,z1,uc),tP)break}Ed.vertical&&(KL+=_L(Kr,cu,Ed.vertical,OL,lc,U_,Na,DL,lm,Fa.vertical,["vertical"],fh,r2,z1,uc));var j8=op?op.boxStartIndex:Kr.collisionBoxArray.length,$8=op?op.boxEndIndex:Kr.collisionBoxArray.length,J8=om?om.boxStartIndex:Kr.collisionBoxArray.length,q8=om?om.boxEndIndex:Kr.collisionBoxArray.length,Q8=sm?sm.boxStartIndex:Kr.collisionBoxArray.length,e6=sm?sm.boxEndIndex:Kr.collisionBoxArray.length,t6=am?am.boxStartIndex:Kr.collisionBoxArray.length,n6=am?am.boxEndIndex:Kr.collisionBoxArray.length,cc=-1,X1=function(Y_,iP){return Y_&&Y_.circleDiameter?Math.max(Y_.circleDiameter,iP):iP};cc=X1(op,cc),cc=X1(om,cc),cc=X1(sm,cc);var nP=(cc=X1(am,cc))>-1?1:0;nP&&(cc*=H8/24),Kr.glyphOffsetArray.length>=Ki.MAX_GLYPHS&&he("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Na.sortKey!==void 0&&Kr.addToSortKeyRanges(Kr.symbolInstances.length,Na.sortKey),Kr.symbolInstances.emplaceBack(cu.x,cu.y,fh.right>=0?fh.right:-1,fh.center>=0?fh.center:-1,fh.left>=0?fh.left:-1,fh.vertical||-1,i2,r2,jL,j8,$8,J8,q8,Q8,e6,t6,n6,z_,HL,KL,XL,YL,nP,0,n2,s2,o2,cc)})(ci,W_,X8,zi,Ii,So,oc,ci.layers[0],ci.collisionBoxArray,er.index,er.sourceLayerIndex,ci.index,rp,k1,L1,io,hh,Qg,P1,ac,er,no,Mi,sc,mr)};if(dh==="line")for(var tm=0,G1=pL(er.geometry,0,0,8192,8192);tm<G1.length;tm+=1)for(var F1=G1[tm],F_=0,O_=T8(F1,qg,P_,zi.vertical||Nl,Ii,24,Jg,ci.overscaling,8192);F_<O_.length;F_+=1){var O1=O_[F_];Nl&&L8(ci,Nl.text,G_,O1)||Sd(F1,O1)}else if(dh==="line-center")for(var N_=0,D_=er.geometry;N_<D_.length;N_+=1){var V_=D_[N_];if(V_.length>1){var N1=E8(V_,P_,zi.vertical||Nl,Ii,24,Jg);N1&&Sd(V_,N1)}}else if(er.type==="Polygon")for(var nm=0,D1=DA(er.geometry,0);nm<D1.length;nm+=1){var im=D1[nm],B_=M8(im,16);Sd(im[0],new zg(B_.x,B_.y,0))}else if(er.type==="LineString")for(var sp=0,Z_=er.geometry;sp<Z_.length;sp+=1){var rm=Z_[sp];Sd(rm,new zg(rm[0].x,rm[0].y,0))}else if(er.type==="Point")for(var qA=0,GL=er.geometry;qA<GL.length;qA+=1)for(var QA=0,FL=GL[qA];QA<FL.length;QA+=1){var e2=FL[QA];Sd([e2],new zg(e2.x,e2.y,0))}})(a,lt,Jt,Ls,v,X,Zt,gn,Qt,po,R)},it=0,rt=a.features;it<rt.length;it+=1)et();A&&a.generateCollisionDebugBuffers()},s.perspective=function(a,c,f,v,I){var A,R=1/Math.tan(c/2);return a[0]=R/f,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=R,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,I!=null&&I!==1/0?(a[10]=(I+v)*(A=1/(v-I)),a[14]=2*I*v*A):(a[10]=-1,a[14]=-2*v),a},s.pick=function(a,c){for(var f={},v=0;v<c.length;v++){var I=c[v];I in a&&(f[I]=a[I])}return f},s.plugin=da,s.polygonIntersectsPolygon=nc,s.postMapLoadEvent=Hi,s.postTurnstileEvent=cn,s.potpack=iL,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.register=sn,s.registerForPluginStateChange=function(a){return a({pluginStatus:Bo,pluginURL:su}),p_.on("pluginStateChange",a),a},s.renderColorRamp=Dk,s.rotate=function(a,c,f){var v=c[0],I=c[1],A=c[2],R=c[3],O=Math.sin(f),Z=Math.cos(f);return a[0]=v*Z+A*O,a[1]=I*Z+R*O,a[2]=v*-O+A*Z,a[3]=I*-O+R*Z,a},s.rotateX=function(a,c,f){var v=Math.sin(f),I=Math.cos(f),A=c[4],R=c[5],O=c[6],Z=c[7],X=c[8],$=c[9],ne=c[10],de=c[11];return c!==a&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]),a[4]=A*I+X*v,a[5]=R*I+$*v,a[6]=O*I+ne*v,a[7]=Z*I+de*v,a[8]=X*I-A*v,a[9]=$*I-R*v,a[10]=ne*I-O*v,a[11]=de*I-Z*v,a},s.rotateZ=function(a,c,f){var v=Math.sin(f),I=Math.cos(f),A=c[0],R=c[1],O=c[2],Z=c[3],X=c[4],$=c[5],ne=c[6],de=c[7];return c!==a&&(a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]),a[0]=A*I+X*v,a[1]=R*I+$*v,a[2]=O*I+ne*v,a[3]=Z*I+de*v,a[4]=X*I-A*v,a[5]=$*I-R*v,a[6]=ne*I-O*v,a[7]=de*I-Z*v,a},s.scale=function(a,c,f){var v=f[0],I=f[1],A=f[2];return a[0]=c[0]*v,a[1]=c[1]*v,a[2]=c[2]*v,a[3]=c[3]*v,a[4]=c[4]*I,a[5]=c[5]*I,a[6]=c[6]*I,a[7]=c[7]*I,a[8]=c[8]*A,a[9]=c[9]*A,a[10]=c[10]*A,a[11]=c[11]*A,a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],a},s.scale$1=function(a,c,f){return a[0]=c[0]*f,a[1]=c[1]*f,a[2]=c[2]*f,a[3]=c[3]*f,a},s.scale$2=function(a,c,f){return a[0]=c[0]*f,a[1]=c[1]*f,a[2]=c[2]*f,a},s.setCacheLimits=function(a,c){Li=a,Tr=c},s.setRTLTextPlugin=function(a,c,f){if(f===void 0&&(f=!1),Bo==="deferred"||Bo==="loading"||Bo==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");su=zt.resolveURL(a),Bo="deferred",Rg=c,Yf(),f||ol()},s.sphericalToCartesian=function(a){var c=a[0],f=a[1],v=a[2];return f+=90,f*=Math.PI/180,v*=Math.PI/180,{x:c*Math.cos(f)*Math.sin(v),y:c*Math.sin(f)*Math.sin(v),z:c*Math.cos(v)}},s.sqrLen=function(a){var c=a[0],f=a[1];return c*c+f*f},s.styleSpec=ye,s.sub=function(a,c,f){return a[0]=c[0]-f[0],a[1]=c[1]-f[1],a[2]=c[2]-f[2],a},s.symbolSize=S8,s.transformMat3=function(a,c,f){var v=c[0],I=c[1],A=c[2];return a[0]=v*f[0]+I*f[3]+A*f[6],a[1]=v*f[1]+I*f[4]+A*f[7],a[2]=v*f[2]+I*f[5]+A*f[8],a},s.transformMat4=Fg,s.translate=function(a,c,f){var v,I,A,R,O,Z,X,$,ne,de,_e,Me,Pe=f[0],He=f[1],Ve=f[2];return c===a?(a[12]=c[0]*Pe+c[4]*He+c[8]*Ve+c[12],a[13]=c[1]*Pe+c[5]*He+c[9]*Ve+c[13],a[14]=c[2]*Pe+c[6]*He+c[10]*Ve+c[14],a[15]=c[3]*Pe+c[7]*He+c[11]*Ve+c[15]):(I=c[1],A=c[2],R=c[3],O=c[4],Z=c[5],X=c[6],$=c[7],ne=c[8],de=c[9],_e=c[10],Me=c[11],a[0]=v=c[0],a[1]=I,a[2]=A,a[3]=R,a[4]=O,a[5]=Z,a[6]=X,a[7]=$,a[8]=ne,a[9]=de,a[10]=_e,a[11]=Me,a[12]=v*Pe+O*He+ne*Ve+c[12],a[13]=I*Pe+Z*He+de*Ve+c[13],a[14]=A*Pe+X*He+_e*Ve+c[14],a[15]=R*Pe+$*He+Me*Ve+c[15]),a},s.triggerPluginCompletionEvent=h1,s.uniqueId=N,s.validateCustomStyleLayer=function(a){var c=[],f=a.id;return f===void 0&&c.push({message:"layers."+f+': missing required property "id"'}),a.render===void 0&&c.push({message:"layers."+f+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&c.push({message:"layers."+f+': property "renderingMode" must be either "2d" or "3d"'}),c},s.validateLight=RA,s.validateStyle=Wf,s.values=function(a){var c=[];for(var f in a)c.push(a[f]);return c},s.vectorTile=Vg,s.version="1.13.3",s.warnOnce=he,s.webpSupported=yn,s.window=y,s.wrap=T})),o(["./shared"],(function(s){function l(ee){var ue=typeof ee;if(ue==="number"||ue==="boolean"||ue==="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){for(var me="[",xe=0,Ae=ee;xe<Ae.length;xe+=1)me+=l(Ae[xe])+",";return me+"]"}for(var Ye=Object.keys(ee).sort(),ze="{",ye=0;ye<Ye.length;ye++)ze+=JSON.stringify(Ye[ye])+":"+l(ee[Ye[ye]])+",";return ze+"}"}function u(ee){for(var ue="",me=0,xe=s.refProperties;me<xe.length;me+=1)ue+="/"+l(ee[xe[me]]);return ue}var h=function(ee){this.keyCache={},ee&&this.replace(ee)};h.prototype.replace=function(ee){this._layerConfigs={},this._layers={},this.update(ee,[])},h.prototype.update=function(ee,ue){for(var me=this,xe=0,Ae=ee;xe<Ae.length;xe+=1){var Ye=Ae[xe];this._layerConfigs[Ye.id]=Ye;var ze=this._layers[Ye.id]=s.createStyleLayer(Ye);ze._featureFilter=s.featureFilter(ze.filter),this.keyCache[Ye.id]&&delete this.keyCache[Ye.id]}for(var ye=0,Se=ue;ye<Se.length;ye+=1){var tt=Se[ye];delete this.keyCache[tt],delete this._layerConfigs[tt],delete this._layers[tt]}this.familiesBySource={};for(var bt=0,St=(function(Ut,Yt){for(var Ot={},Re=0;Re<Ut.length;Re++){var _t=Yt&&Yt[Ut[Re].id]||u(Ut[Re]);Yt&&(Yt[Ut[Re].id]=_t);var Kt=Ot[_t];Kt||(Kt=Ot[_t]=[]),Kt.push(Ut[Re])}var mn=[];for(var Bn in Ot)mn.push(Ot[Bn]);return mn})(s.values(this._layerConfigs),this.keyCache);bt<St.length;bt+=1){var ct=St[bt].map((function(Ut){return me._layers[Ut.id]})),It=ct[0];if(It.visibility!=="none"){var qt=It.source||"",nn=this.familiesBySource[qt];nn||(nn=this.familiesBySource[qt]={});var pt=It.sourceLayer||"_geojsonTileLayer",$t=nn[pt];$t||($t=nn[pt]=[]),$t.push(ct)}}};var d=function(ee){var ue={},me=[];for(var xe in ee){var Ae=ee[xe],Ye=ue[xe]={};for(var ze in Ae){var ye=Ae[+ze];if(ye&&ye.bitmap.width!==0&&ye.bitmap.height!==0){var Se={x:0,y:0,w:ye.bitmap.width+2,h:ye.bitmap.height+2};me.push(Se),Ye[ze]={rect:Se,metrics:ye.metrics}}}}var tt=s.potpack(me),bt=new s.AlphaImage({width:tt.w||1,height:tt.h||1});for(var St in ee){var ct=ee[St];for(var It in ct){var qt=ct[+It];if(qt&&qt.bitmap.width!==0&&qt.bitmap.height!==0){var nn=ue[St][It].rect;s.AlphaImage.copy(qt.bitmap,bt,{x:0,y:0},{x:nn.x+1,y:nn.y+1},qt.bitmap)}}}this.image=bt,this.positions=ue};s.register("GlyphAtlas",d);var m=function(ee){this.tileID=new s.OverscaledTileID(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.uid=ee.uid,this.zoom=ee.zoom,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.returnDependencies=!!ee.returnDependencies,this.promoteId=ee.promoteId};function y(ee,ue,me){for(var xe=new s.EvaluationParameters(ue),Ae=0,Ye=ee;Ae<Ye.length;Ae+=1)Ye[Ae].recalculate(xe,me)}function x(ee,ue){var me=s.getArrayBuffer(ee.request,(function(xe,Ae,Ye,ze){xe?ue(xe):Ae&&ue(null,{vectorTile:new s.vectorTile.VectorTile(new s.pbf(Ae)),rawData:Ae,cacheControl:Ye,expires:ze})}));return function(){me.cancel(),ue()}}m.prototype.parse=function(ee,ue,me,xe,Ae){var Ye=this;this.status="parsing",this.data=ee,this.collisionBoxArray=new s.CollisionBoxArray;var ze=new s.DictionaryCoder(Object.keys(ee.layers).sort()),ye=new s.FeatureIndex(this.tileID,this.promoteId);ye.bucketLayerIDs=[];var Se,tt,bt,St,ct={},It={featureIndex:ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},qt=ue.familiesBySource[this.source];for(var nn in qt){var pt=ee.layers[nn];if(pt){pt.version===1&&s.warnOnce('Vector tile source "'+this.source+'" layer "'+nn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var $t=ze.encode(nn),Ut=[],Yt=0;Yt<pt.length;Yt++){var Ot=pt.feature(Yt),Re=ye.getId(Ot,nn);Ut.push({feature:Ot,id:Re,index:Yt,sourceLayerIndex:$t})}for(var _t=0,Kt=qt[nn];_t<Kt.length;_t+=1){var mn=Kt[_t],Bn=mn[0];Bn.minzoom&&this.zoom<Math.floor(Bn.minzoom)||Bn.maxzoom&&this.zoom>=Bn.maxzoom||Bn.visibility!=="none"&&(y(mn,this.zoom,me),(ct[Bn.id]=Bn.createBucket({index:ye.bucketLayerIDs.length,layers:mn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$t,sourceID:this.source})).populate(Ut,It,this.tileID.canonical),ye.bucketLayerIDs.push(mn.map((function(Pi){return Pi.id}))))}}}var En=s.mapObject(It.glyphDependencies,(function(Pi){return Object.keys(Pi).map(Number)}));Object.keys(En).length?xe.send("getGlyphs",{uid:this.uid,stacks:En},(function(Pi,Rn){Se||(Se=Pi,tt=Rn,ir.call(Ye))})):tt={};var qi=Object.keys(It.iconDependencies);qi.length?xe.send("getImages",{icons:qi,source:this.source,tileID:this.tileID,type:"icons"},(function(Pi,Rn){Se||(Se=Pi,bt=Rn,ir.call(Ye))})):bt={};var ai=Object.keys(It.patternDependencies);function ir(){if(Se)return Ae(Se);if(tt&&bt&&St){var Pi=new d(tt),Rn=new s.ImageAtlas(bt,St);for(var bi in ct){var Zs=ct[bi];Zs instanceof s.SymbolBucket?(y(Zs.layers,this.zoom,me),s.performSymbolLayout(Zs,tt,Pi.positions,bt,Rn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Zs.hasPattern&&(Zs instanceof s.LineBucket||Zs instanceof s.FillBucket||Zs instanceof s.FillExtrusionBucket)&&(y(Zs.layers,this.zoom,me),Zs.addFeatures(It,this.tileID.canonical,Rn.patternPositions))}this.status="done",Ae(null,{buckets:s.values(ct).filter((function(Mf){return!Mf.isEmpty()})),featureIndex:ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pi.image,imageAtlas:Rn,glyphMap:this.returnDependencies?tt:null,iconMap:this.returnDependencies?bt:null,glyphPositions:this.returnDependencies?Pi.positions:null})}}ai.length?xe.send("getImages",{icons:ai,source:this.source,tileID:this.tileID,type:"patterns"},(function(Pi,Rn){Se||(Se=Pi,St=Rn,ir.call(Ye))})):St={},ir.call(this)};var C=function(ee,ue,me,xe){this.actor=ee,this.layerIndex=ue,this.availableImages=me,this.loadVectorData=xe||x,this.loading={},this.loaded={}};C.prototype.loadTile=function(ee,ue){var me=this,xe=ee.uid;this.loading||(this.loading={});var Ae=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new s.RequestPerformance(ee.request),Ye=this.loading[xe]=new m(ee);Ye.abort=this.loadVectorData(ee,(function(ze,ye){if(delete me.loading[xe],ze||!ye)return Ye.status="done",me.loaded[xe]=Ye,ue(ze);var Se=ye.rawData,tt={};ye.expires&&(tt.expires=ye.expires),ye.cacheControl&&(tt.cacheControl=ye.cacheControl);var bt={};if(Ae){var St=Ae.finish();St&&(bt.resourceTiming=JSON.parse(JSON.stringify(St)))}Ye.vectorTile=ye.vectorTile,Ye.parse(ye.vectorTile,me.layerIndex,me.availableImages,me.actor,(function(ct,It){if(ct||!It)return ue(ct);ue(null,s.extend({rawTileData:Se.slice(0)},It,tt,bt))})),me.loaded=me.loaded||{},me.loaded[xe]=Ye}))},C.prototype.reloadTile=function(ee,ue){var me=this,xe=this.loaded,Ae=ee.uid,Ye=this;if(xe&&xe[Ae]){var ze=xe[Ae];ze.showCollisionBoxes=ee.showCollisionBoxes;var ye=function(Se,tt){var bt=ze.reloadCallback;bt&&(delete ze.reloadCallback,ze.parse(ze.vectorTile,Ye.layerIndex,me.availableImages,Ye.actor,bt)),ue(Se,tt)};ze.status==="parsing"?ze.reloadCallback=ye:ze.status==="done"&&(ze.vectorTile?ze.parse(ze.vectorTile,this.layerIndex,this.availableImages,this.actor,ye):ye())}},C.prototype.abortTile=function(ee,ue){var me=this.loading,xe=ee.uid;me&&me[xe]&&me[xe].abort&&(me[xe].abort(),delete me[xe]),ue()},C.prototype.removeTile=function(ee,ue){var me=this.loaded,xe=ee.uid;me&&me[xe]&&delete me[xe],ue()};var w=s.window.ImageBitmap,S=function(){this.loaded={}};function T(ee,ue){if(ee.length!==0){M(ee[0],ue);for(var me=1;me<ee.length;me++)M(ee[me],!ue)}}function M(ee,ue){for(var me=0,xe=0,Ae=0,Ye=ee.length,ze=Ye-1;Ae<Ye;ze=Ae++){var ye=(ee[Ae][0]-ee[ze][0])*(ee[ze][1]+ee[Ae][1]),Se=me+ye;xe+=Math.abs(me)>=Math.abs(ye)?me-Se+ye:ye-Se+me,me=Se}me+xe>=0!=!!ue&&ee.reverse()}S.prototype.loadTile=function(ee,ue){var me=ee.uid,xe=ee.encoding,Ae=ee.rawImageData,Ye=w&&Ae instanceof w?this.getImageData(Ae):Ae,ze=new s.DEMData(me,Ye,xe);this.loaded=this.loaded||{},this.loaded[me]=ze,ue(null,ze)},S.prototype.getImageData=function(ee){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);var ue=this.offscreenCanvasContext.getImageData(-1,-1,ee.width+2,ee.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:ue.width,height:ue.height},ue.data)},S.prototype.removeTile=function(ee){var ue=this.loaded,me=ee.uid;ue&&ue[me]&&delete ue[me]};var G=s.vectorTile.VectorTileFeature.prototype.toGeoJSON,N=function(ee){this._feature=ee,this.extent=s.EXTENT,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))};N.prototype.loadGeometry=function(){if(this._feature.type===1){for(var ee=[],ue=0,me=this._feature.geometry;ue<me.length;ue+=1){var xe=me[ue];ee.push([new s.Point$1(xe[0],xe[1])])}return ee}for(var Ae=[],Ye=0,ze=this._feature.geometry;Ye<ze.length;Ye+=1){for(var ye=[],Se=0,tt=ze[Ye];Se<tt.length;Se+=1){var bt=tt[Se];ye.push(new s.Point$1(bt[0],bt[1]))}Ae.push(ye)}return Ae},N.prototype.toGeoJSON=function(ee,ue,me){return G.call(this,ee,ue,me)};var V=function(ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=ee.length,this._features=ee};V.prototype.feature=function(ee){return new N(this._features[ee])};var W=s.vectorTile.VectorTileFeature,j=J;function J(ee,ue){this.options=ue||{},this.features=ee,this.length=ee.length}function te(ee,ue){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=ue||4096}J.prototype.feature=function(ee){return new te(this.features[ee],this.options.extent)},te.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var ue=0;ue<ee.length;ue++){for(var me=ee[ue],xe=[],Ae=0;Ae<me.length;Ae++)xe.push(new s.Point$1(me[Ae][0],me[Ae][1]));this.geometry.push(xe)}return this.geometry},te.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,ue=1/0,me=-1/0,xe=1/0,Ae=-1/0,Ye=0;Ye<ee.length;Ye++)for(var ze=ee[Ye],ye=0;ye<ze.length;ye++){var Se=ze[ye];ue=Math.min(ue,Se.x),me=Math.max(me,Se.x),xe=Math.min(xe,Se.y),Ae=Math.max(Ae,Se.y)}return[ue,xe,me,Ae]},te.prototype.toGeoJSON=W.prototype.toGeoJSON;var ce=Y,pe=j;function Y(ee){var ue=new s.pbf;return(function(me,xe){for(var Ae in me.layers)xe.writeMessage(3,he,me.layers[Ae])})(ee,ue),ue.finish()}function he(ee,ue){var me;ue.writeVarintField(15,ee.version||1),ue.writeStringField(1,ee.name||""),ue.writeVarintField(5,ee.extent||4096);var xe={keys:[],values:[],keycache:{},valuecache:{}};for(me=0;me<ee.length;me++)xe.feature=ee.feature(me),ue.writeMessage(2,D,xe);var Ae=xe.keys;for(me=0;me<Ae.length;me++)ue.writeStringField(3,Ae[me]);var Ye=xe.values;for(me=0;me<Ye.length;me++)ue.writeMessage(4,we,Ye[me])}function D(ee,ue){var me=ee.feature;me.id!==void 0&&ue.writeVarintField(1,me.id),ue.writeMessage(2,re,ee),ue.writeVarintField(3,me.type),ue.writeMessage(4,Le,me)}function re(ee,ue){var me=ee.feature,xe=ee.keys,Ae=ee.values,Ye=ee.keycache,ze=ee.valuecache;for(var ye in me.properties){var Se=Ye[ye];Se===void 0&&(xe.push(ye),Ye[ye]=Se=xe.length-1),ue.writeVarint(Se);var tt=me.properties[ye],bt=typeof tt;bt!=="string"&&bt!=="boolean"&&bt!=="number"&&(tt=JSON.stringify(tt));var St=bt+":"+tt,ct=ze[St];ct===void 0&&(Ae.push(tt),ze[St]=ct=Ae.length-1),ue.writeVarint(ct)}}function le(ee,ue){return(ue<<3)+(7&ee)}function fe(ee){return ee<<1^ee>>31}function Le(ee,ue){for(var me=ee.loadGeometry(),xe=ee.type,Ae=0,Ye=0,ze=me.length,ye=0;ye<ze;ye++){var Se=me[ye],tt=1;xe===1&&(tt=Se.length),ue.writeVarint(le(1,tt));for(var bt=xe===3?Se.length-1:Se.length,St=0;St<bt;St++){St===1&&xe!==1&&ue.writeVarint(le(2,bt-1));var ct=Se[St].x-Ae,It=Se[St].y-Ye;ue.writeVarint(fe(ct)),ue.writeVarint(fe(It)),Ae+=ct,Ye+=It}xe===3&&ue.writeVarint(le(7,1))}}function we(ee,ue){var me=typeof ee;me==="string"?ue.writeStringField(1,ee):me==="boolean"?ue.writeBooleanField(7,ee):me==="number"&&(ee%1!=0?ue.writeDoubleField(3,ee):ee<0?ue.writeSVarintField(6,ee):ue.writeVarintField(5,ee))}function se(ee,ue,me,xe){Q(ee,me,xe),Q(ue,2*me,2*xe),Q(ue,2*me+1,2*xe+1)}function Q(ee,ue,me){var xe=ee[ue];ee[ue]=ee[me],ee[me]=xe}function q(ee,ue,me,xe){var Ae=ee-me,Ye=ue-xe;return Ae*Ae+Ye*Ye}ce.fromVectorTileJs=Y,ce.fromGeojsonVt=function(ee,ue){ue=ue||{};var me={};for(var xe in ee)me[xe]=new j(ee[xe].features,ue),me[xe].name=xe,me[xe].version=ue.version,me[xe].extent=ue.extent;return Y({layers:me})},ce.GeoJSONWrapper=pe;var $e=function(ee){return ee[0]},Qe=function(ee){return ee[1]},qe=function(ee,ue,me,xe,Ae){ue===void 0&&(ue=$e),me===void 0&&(me=Qe),xe===void 0&&(xe=64),Ae===void 0&&(Ae=Float64Array),this.nodeSize=xe,this.points=ee;for(var Ye=ee.length<65536?Uint16Array:Uint32Array,ze=this.ids=new Ye(ee.length),ye=this.coords=new Ae(2*ee.length),Se=0;Se<ee.length;Se++)ze[Se]=Se,ye[2*Se]=ue(ee[Se]),ye[2*Se+1]=me(ee[Se]);(function tt(bt,St,ct,It,qt,nn){if(!(qt-It<=ct)){var pt=It+qt>>1;(function $t(Ut,Yt,Ot,Re,_t,Kt){for(;_t>Re;){if(_t-Re>600){var mn=_t-Re+1,Bn=Ot-Re+1,En=Math.log(mn),qi=.5*Math.exp(2*En/3),ai=.5*Math.sqrt(En*qi*(mn-qi)/mn)*(Bn-mn/2<0?-1:1);$t(Ut,Yt,Ot,Math.max(Re,Math.floor(Ot-Bn*qi/mn+ai)),Math.min(_t,Math.floor(Ot+(mn-Bn)*qi/mn+ai)),Kt)}var ir=Yt[2*Ot+Kt],Pi=Re,Rn=_t;for(se(Ut,Yt,Re,Ot),Yt[2*_t+Kt]>ir&&se(Ut,Yt,Re,_t);Pi<Rn;){for(se(Ut,Yt,Pi,Rn),Pi++,Rn--;Yt[2*Pi+Kt]<ir;)Pi++;for(;Yt[2*Rn+Kt]>ir;)Rn--}Yt[2*Re+Kt]===ir?se(Ut,Yt,Re,Rn):se(Ut,Yt,++Rn,_t),Rn<=Ot&&(Re=Rn+1),Ot<=Rn&&(_t=Rn-1)}})(bt,St,pt,It,qt,nn%2),tt(bt,St,ct,It,pt-1,nn+1),tt(bt,St,ct,pt+1,qt,nn+1)}})(ze,ye,xe,0,ze.length-1,0)};qe.prototype.range=function(ee,ue,me,xe){return(function(Ae,Ye,ze,ye,Se,tt,bt){for(var St,ct,It=[0,Ae.length-1,0],qt=[];It.length;){var nn=It.pop(),pt=It.pop(),$t=It.pop();if(pt-$t<=bt)for(var Ut=$t;Ut<=pt;Ut++)ct=Ye[2*Ut+1],(St=Ye[2*Ut])>=ze&&St<=Se&&ct>=ye&&ct<=tt&&qt.push(Ae[Ut]);else{var Yt=Math.floor(($t+pt)/2);ct=Ye[2*Yt+1],(St=Ye[2*Yt])>=ze&&St<=Se&&ct>=ye&&ct<=tt&&qt.push(Ae[Yt]);var Ot=(nn+1)%2;(nn===0?ze<=St:ye<=ct)&&(It.push($t),It.push(Yt-1),It.push(Ot)),(nn===0?Se>=St:tt>=ct)&&(It.push(Yt+1),It.push(pt),It.push(Ot))}}return qt})(this.ids,this.coords,ee,ue,me,xe,this.nodeSize)},qe.prototype.within=function(ee,ue,me){return(function(xe,Ae,Ye,ze,ye,Se){for(var tt=[0,xe.length-1,0],bt=[],St=ye*ye;tt.length;){var ct=tt.pop(),It=tt.pop(),qt=tt.pop();if(It-qt<=Se)for(var nn=qt;nn<=It;nn++)q(Ae[2*nn],Ae[2*nn+1],Ye,ze)<=St&&bt.push(xe[nn]);else{var pt=Math.floor((qt+It)/2),$t=Ae[2*pt],Ut=Ae[2*pt+1];q($t,Ut,Ye,ze)<=St&&bt.push(xe[pt]);var Yt=(ct+1)%2;(ct===0?Ye-ye<=$t:ze-ye<=Ut)&&(tt.push(qt),tt.push(pt-1),tt.push(Yt)),(ct===0?Ye+ye>=$t:ze+ye>=Ut)&&(tt.push(pt+1),tt.push(It),tt.push(Yt))}}return bt})(this.ids,this.coords,ee,ue,me,this.nodeSize)};var Lt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ee){return ee}},Pt=function(ee){this.options=z(Object.create(Lt),ee),this.trees=new Array(this.options.maxZoom+1)};function zt(ee,ue,me,xe,Ae){return{x:ee,y:ue,zoom:1/0,id:me,parentId:-1,numPoints:xe,properties:Ae}}function Dt(ee,ue){var me=ee.geometry.coordinates,xe=me[1];return{x:Ne(me[0]),y:Be(xe),zoom:1/0,index:ue,parentId:-1}}function yn(ee){return{type:"Feature",id:ee.id,properties:tn(ee),geometry:{type:"Point",coordinates:[(xe=ee.x,360*(xe-.5)),(ue=ee.y,me=(180-360*ue)*Math.PI/180,360*Math.atan(Math.exp(me))/Math.PI-90)]}};var ue,me,xe}function tn(ee){var ue=ee.numPoints,me=ue>=1e4?Math.round(ue/1e3)+"k":ue>=1e3?Math.round(ue/100)/10+"k":ue;return z(z({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:ue,point_count_abbreviated:me})}function Ne(ee){return ee/360+.5}function Be(ee){var ue=Math.sin(ee*Math.PI/180),me=.5-.25*Math.log((1+ue)/(1-ue))/Math.PI;return me<0?0:me>1?1:me}function z(ee,ue){for(var me in ue)ee[me]=ue[me];return ee}function We(ee){return ee.x}function ke(ee){return ee.y}function ge(ee,ue,me,xe,Ae,Ye){var ze=Ae-me,ye=Ye-xe;if(ze!==0||ye!==0){var Se=((ee-me)*ze+(ue-xe)*ye)/(ze*ze+ye*ye);Se>1?(me=Ae,xe=Ye):Se>0&&(me+=ze*Se,xe+=ye*Se)}return(ze=ee-me)*ze+(ye=ue-xe)*ye}function ie(ee,ue,me,xe){var Ae={id:ee===void 0?null:ee,type:ue,geometry:me,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return(function(Ye){var ze=Ye.geometry,ye=Ye.type;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ce(Ye,ze);else if(ye==="Polygon"||ye==="MultiLineString")for(var Se=0;Se<ze.length;Se++)Ce(Ye,ze[Se]);else if(ye==="MultiPolygon")for(Se=0;Se<ze.length;Se++)for(var tt=0;tt<ze[Se].length;tt++)Ce(Ye,ze[Se][tt])})(Ae),Ae}function Ce(ee,ue){for(var me=0;me<ue.length;me+=3)ee.minX=Math.min(ee.minX,ue[me]),ee.minY=Math.min(ee.minY,ue[me+1]),ee.maxX=Math.max(ee.maxX,ue[me]),ee.maxY=Math.max(ee.maxY,ue[me+1])}function Te(ee,ue,me,xe){if(ue.geometry){var Ae=ue.geometry.coordinates,Ye=ue.geometry.type,ze=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2),ye=[],Se=ue.id;if(me.promoteId?Se=ue.properties[me.promoteId]:me.generateId&&(Se=xe||0),Ye==="Point")De(Ae,ye);else if(Ye==="MultiPoint")for(var tt=0;tt<Ae.length;tt++)De(Ae[tt],ye);else if(Ye==="LineString")Ze(Ae,ye,ze,!1);else if(Ye==="MultiLineString"){if(me.lineMetrics){for(tt=0;tt<Ae.length;tt++)Ze(Ae[tt],ye=[],ze,!1),ee.push(ie(Se,"LineString",ye,ue.properties));return}Je(Ae,ye,ze,!1)}else if(Ye==="Polygon")Je(Ae,ye,ze,!0);else{if(Ye!=="MultiPolygon"){if(Ye==="GeometryCollection"){for(tt=0;tt<ue.geometry.geometries.length;tt++)Te(ee,{id:Se,geometry:ue.geometry.geometries[tt],properties:ue.properties},me,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(tt=0;tt<Ae.length;tt++){var bt=[];Je(Ae[tt],bt,ze,!0),ye.push(bt)}}ee.push(ie(Se,Ye,ye,ue.properties))}}function De(ee,ue){ue.push(dt(ee[0])),ue.push(ft(ee[1])),ue.push(0)}function Ze(ee,ue,me,xe){for(var Ae,Ye,ze=0,ye=0;ye<ee.length;ye++){var Se=dt(ee[ye][0]),tt=ft(ee[ye][1]);ue.push(Se),ue.push(tt),ue.push(0),ye>0&&(ze+=xe?(Ae*tt-Se*Ye)/2:Math.sqrt(Math.pow(Se-Ae,2)+Math.pow(tt-Ye,2))),Ae=Se,Ye=tt}var bt=ue.length-3;ue[2]=1,(function St(ct,It,qt,nn){for(var pt,$t=nn,Ut=qt-It>>1,Yt=qt-It,Ot=ct[It],Re=ct[It+1],_t=ct[qt],Kt=ct[qt+1],mn=It+3;mn<qt;mn+=3){var Bn=ge(ct[mn],ct[mn+1],Ot,Re,_t,Kt);if(Bn>$t)pt=mn,$t=Bn;else if(Bn===$t){var En=Math.abs(mn-Ut);En<Yt&&(pt=mn,Yt=En)}}$t>nn&&(pt-It>3&&St(ct,It,pt,nn),ct[pt+2]=$t,qt-pt>3&&St(ct,pt,qt,nn))})(ue,0,bt,me),ue[bt+2]=1,ue.size=Math.abs(ze),ue.start=0,ue.end=ue.size}function Je(ee,ue,me,xe){for(var Ae=0;Ae<ee.length;Ae++){var Ye=[];Ze(ee[Ae],Ye,me,xe),ue.push(Ye)}}function dt(ee){return ee/360+.5}function ft(ee){var ue=Math.sin(ee*Math.PI/180),me=.5-.25*Math.log((1+ue)/(1-ue))/Math.PI;return me<0?0:me>1?1:me}function Tt(ee,ue,me,xe,Ae,Ye,ze,ye){if(xe/=ue,Ye>=(me/=ue)&&ze<xe)return ee;if(ze<me||Ye>=xe)return null;for(var Se=[],tt=0;tt<ee.length;tt++){var bt=ee[tt],St=bt.geometry,ct=bt.type,It=Ae===0?bt.minX:bt.minY,qt=Ae===0?bt.maxX:bt.maxY;if(It>=me&&qt<xe)Se.push(bt);else if(!(qt<me||It>=xe)){var nn=[];if(ct==="Point"||ct==="MultiPoint")hn(St,nn,me,xe,Ae);else if(ct==="LineString")cn(St,nn,me,xe,Ae,!1,ye.lineMetrics);else if(ct==="MultiLineString")Hi(St,nn,me,xe,Ae,!1);else if(ct==="Polygon")Hi(St,nn,me,xe,Ae,!0);else if(ct==="MultiPolygon")for(var pt=0;pt<St.length;pt++){var $t=[];Hi(St[pt],$t,me,xe,Ae,!0),$t.length&&nn.push($t)}if(nn.length){if(ye.lineMetrics&&ct==="LineString"){for(pt=0;pt<nn.length;pt++)Se.push(ie(bt.id,ct,nn[pt],bt.tags));continue}ct!=="LineString"&&ct!=="MultiLineString"||(nn.length===1?(ct="LineString",nn=nn[0]):ct="MultiLineString"),ct!=="Point"&&ct!=="MultiPoint"||(ct=nn.length===3?"Point":"MultiPoint"),Se.push(ie(bt.id,ct,nn,bt.tags))}}}return Se.length?Se:null}function hn(ee,ue,me,xe,Ae){for(var Ye=0;Ye<ee.length;Ye+=3){var ze=ee[Ye+Ae];ze>=me&&ze<=xe&&(ue.push(ee[Ye]),ue.push(ee[Ye+1]),ue.push(ee[Ye+2]))}}function cn(ee,ue,me,xe,Ae,Ye,ze){for(var ye,Se,tt=vi(ee),bt=Ae===0?Tr:pi,St=ee.start,ct=0;ct<ee.length-3;ct+=3){var It=ee[ct],qt=ee[ct+1],nn=ee[ct+2],pt=ee[ct+3],$t=ee[ct+4],Ut=Ae===0?It:qt,Yt=Ae===0?pt:$t,Ot=!1;ze&&(ye=Math.sqrt(Math.pow(It-pt,2)+Math.pow(qt-$t,2))),Ut<me?Yt>me&&(Se=bt(tt,It,qt,pt,$t,me),ze&&(tt.start=St+ye*Se)):Ut>xe?Yt<xe&&(Se=bt(tt,It,qt,pt,$t,xe),ze&&(tt.start=St+ye*Se)):Li(tt,It,qt,nn),Yt<me&&Ut>=me&&(Se=bt(tt,It,qt,pt,$t,me),Ot=!0),Yt>xe&&Ut<=xe&&(Se=bt(tt,It,qt,pt,$t,xe),Ot=!0),!Ye&&Ot&&(ze&&(tt.end=St+ye*Se),ue.push(tt),tt=vi(ee)),ze&&(St+=ye)}var Re=ee.length-3;It=ee[Re],qt=ee[Re+1],nn=ee[Re+2],(Ut=Ae===0?It:qt)>=me&&Ut<=xe&&Li(tt,It,qt,nn),Re=tt.length-3,Ye&&Re>=3&&(tt[Re]!==tt[0]||tt[Re+1]!==tt[1])&&Li(tt,tt[0],tt[1],tt[2]),tt.length&&ue.push(tt)}function vi(ee){var ue=[];return ue.size=ee.size,ue.start=ee.start,ue.end=ee.end,ue}function Hi(ee,ue,me,xe,Ae,Ye){for(var ze=0;ze<ee.length;ze++)cn(ee[ze],ue,me,xe,Ae,Ye,!1)}function Li(ee,ue,me,xe){ee.push(ue),ee.push(me),ee.push(xe)}function Tr(ee,ue,me,xe,Ae,Ye){var ze=(Ye-ue)/(xe-ue);return ee.push(Ye),ee.push(me+(Ae-me)*ze),ee.push(1),ze}function pi(ee,ue,me,xe,Ae,Ye){var ze=(Ye-me)/(Ae-me);return ee.push(ue+(xe-ue)*ze),ee.push(Ye),ee.push(1),ze}function rs(ee,ue){for(var me=[],xe=0;xe<ee.length;xe++){var Ae,Ye=ee[xe],ze=Ye.type;if(ze==="Point"||ze==="MultiPoint"||ze==="LineString")Ae=wi(Ye.geometry,ue);else if(ze==="MultiLineString"||ze==="Polygon"){Ae=[];for(var ye=0;ye<Ye.geometry.length;ye++)Ae.push(wi(Ye.geometry[ye],ue))}else if(ze==="MultiPolygon")for(Ae=[],ye=0;ye<Ye.geometry.length;ye++){for(var Se=[],tt=0;tt<Ye.geometry[ye].length;tt++)Se.push(wi(Ye.geometry[ye][tt],ue));Ae.push(Se)}me.push(ie(Ye.id,ze,Ae,Ye.tags))}return me}function wi(ee,ue){var me=[];me.size=ee.size,ee.start!==void 0&&(me.start=ee.start,me.end=ee.end);for(var xe=0;xe<ee.length;xe+=3)me.push(ee[xe]+ue,ee[xe+1],ee[xe+2]);return me}function Ti(ee,ue){if(ee.transformed)return ee;var me,xe,Ae,Ye=1<<ee.z,ze=ee.x,ye=ee.y;for(me=0;me<ee.features.length;me++){var Se=ee.features[me],tt=Se.geometry,bt=Se.type;if(Se.geometry=[],bt===1)for(xe=0;xe<tt.length;xe+=2)Se.geometry.push(Bs(tt[xe],tt[xe+1],ue,Ye,ze,ye));else for(xe=0;xe<tt.length;xe++){var St=[];for(Ae=0;Ae<tt[xe].length;Ae+=2)St.push(Bs(tt[xe][Ae],tt[xe][Ae+1],ue,Ye,ze,ye));Se.geometry.push(St)}}return ee.transformed=!0,ee}function Bs(ee,ue,me,xe,Ae,Ye){return[Math.round(me*(ee*xe-Ae)),Math.round(me*(ue*xe-Ye))]}function xo(ee,ue,me,xe,Ae){for(var Ye=ue===Ae.maxZoom?0:Ae.tolerance/((1<<ue)*Ae.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:me,y:xe,z:ue,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ye=0;ye<ee.length;ye++){ze.numFeatures++,Ea(ze,ee[ye],Ye,Ae);var Se=ee[ye].minX,tt=ee[ye].minY,bt=ee[ye].maxX,St=ee[ye].maxY;Se<ze.minX&&(ze.minX=Se),tt<ze.minY&&(ze.minY=tt),bt>ze.maxX&&(ze.maxX=bt),St>ze.maxY&&(ze.maxY=St)}return ze}function Ea(ee,ue,me,xe){var Ae=ue.geometry,Ye=ue.type,ze=[];if(Ye==="Point"||Ye==="MultiPoint")for(var ye=0;ye<Ae.length;ye+=3)ze.push(Ae[ye]),ze.push(Ae[ye+1]),ee.numPoints++,ee.numSimplified++;else if(Ye==="LineString")ms(ze,Ae,ee,me,!1,!1);else if(Ye==="MultiLineString"||Ye==="Polygon")for(ye=0;ye<Ae.length;ye++)ms(ze,Ae[ye],ee,me,Ye==="Polygon",ye===0);else if(Ye==="MultiPolygon")for(var Se=0;Se<Ae.length;Se++){var tt=Ae[Se];for(ye=0;ye<tt.length;ye++)ms(ze,tt[ye],ee,me,!0,ye===0)}if(ze.length){var bt=ue.tags||null;if(Ye==="LineString"&&xe.lineMetrics){for(var St in bt={},ue.tags)bt[St]=ue.tags[St];bt.mapbox_clip_start=Ae.start/Ae.size,bt.mapbox_clip_end=Ae.end/Ae.size}var ct={geometry:ze,type:Ye==="Polygon"||Ye==="MultiPolygon"?3:Ye==="LineString"||Ye==="MultiLineString"?2:1,tags:bt};ue.id!==null&&(ct.id=ue.id),ee.features.push(ct)}}function ms(ee,ue,me,xe,Ae,Ye){var ze=xe*xe;if(xe>0&&ue.size<(Ae?ze:xe))me.numPoints+=ue.length/3;else{for(var ye=[],Se=0;Se<ue.length;Se+=3)(xe===0||ue[Se+2]>ze)&&(me.numSimplified++,ye.push(ue[Se]),ye.push(ue[Se+1])),me.numPoints++;Ae&&(function(tt,bt){for(var St=0,ct=0,It=tt.length,qt=It-2;ct<It;qt=ct,ct+=2)St+=(tt[ct]-tt[qt])*(tt[ct+1]+tt[qt+1]);if(St>0===bt)for(ct=0,It=tt.length;ct<It/2;ct+=2){var nn=tt[ct],pt=tt[ct+1];tt[ct]=tt[It-2-ct],tt[ct+1]=tt[It-1-ct],tt[It-2-ct]=nn,tt[It-1-ct]=pt}})(ye,Ye),ee.push(ye)}}function Wr(ee,ue){var me=(ue=this.options=(function(Ae,Ye){for(var ze in Ye)Ae[ze]=Ye[ze];return Ae})(Object.create(this.options),ue)).debug;if(me&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");var xe=(function(Ae,Ye){var ze=[];if(Ae.type==="FeatureCollection")for(var ye=0;ye<Ae.features.length;ye++)Te(ze,Ae.features[ye],Ye,ye);else Te(ze,Ae.type==="Feature"?Ae:{geometry:Ae},Ye);return ze})(ee,ue);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(xe=(function(Ae,Ye){var ze=Ye.buffer/Ye.extent,ye=Ae,Se=Tt(Ae,1,-1-ze,ze,0,-1,2,Ye),tt=Tt(Ae,1,1-ze,2+ze,0,-1,2,Ye);return(Se||tt)&&(ye=Tt(Ae,1,-ze,1+ze,0,-1,2,Ye)||[],Se&&(ye=rs(Se,1).concat(ye)),tt&&(ye=ye.concat(rs(tt,-1)))),ye})(xe,ue)).length&&this.splitTile(xe,0,0,0),me&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function zr(ee,ue,me){return 32*((1<<ee)*me+ue)+ee}function ys(ee,ue){var me=ee.tileID.canonical;if(!this._geoJSONIndex)return ue(null,null);var xe=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!xe)return ue(null,null);var Ae=new V(xe.features),Ye=ce(Ae);Ye.byteOffset===0&&Ye.byteLength===Ye.buffer.byteLength||(Ye=new Uint8Array(Ye)),ue(null,{vectorTile:Ae,rawData:Ye.buffer})}Pt.prototype.load=function(ee){var ue=this.options,me=ue.log,xe=ue.minZoom,Ae=ue.maxZoom,Ye=ue.nodeSize;me&&console.time("total time");var ze="prepare "+ee.length+" points";me&&console.time(ze),this.points=ee;for(var ye=[],Se=0;Se<ee.length;Se++)ee[Se].geometry&&ye.push(Dt(ee[Se],Se));this.trees[Ae+1]=new qe(ye,We,ke,Ye,Float32Array),me&&console.timeEnd(ze);for(var tt=Ae;tt>=xe;tt--){var bt=+Date.now();ye=this._cluster(ye,tt),this.trees[tt]=new qe(ye,We,ke,Ye,Float32Array),me&&console.log("z%d: %d clusters in %dms",tt,ye.length,+Date.now()-bt)}return me&&console.timeEnd("total time"),this},Pt.prototype.getClusters=function(ee,ue){var me=((ee[0]+180)%360+360)%360-180,xe=Math.max(-90,Math.min(90,ee[1])),Ae=ee[2]===180?180:((ee[2]+180)%360+360)%360-180,Ye=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)me=-180,Ae=180;else if(me>Ae){var ze=this.getClusters([me,xe,180,Ye],ue),ye=this.getClusters([-180,xe,Ae,Ye],ue);return ze.concat(ye)}for(var Se=this.trees[this._limitZoom(ue)],tt=[],bt=0,St=Se.range(Ne(me),Be(Ye),Ne(Ae),Be(xe));bt<St.length;bt+=1){var ct=Se.points[St[bt]];tt.push(ct.numPoints?yn(ct):this.points[ct.index])}return tt},Pt.prototype.getChildren=function(ee){var ue=this._getOriginId(ee),me=this._getOriginZoom(ee),xe="No cluster with the specified id.",Ae=this.trees[me];if(!Ae)throw new Error(xe);var Ye=Ae.points[ue];if(!Ye)throw new Error(xe);for(var ze=this.options.radius/(this.options.extent*Math.pow(2,me-1)),ye=[],Se=0,tt=Ae.within(Ye.x,Ye.y,ze);Se<tt.length;Se+=1){var bt=Ae.points[tt[Se]];bt.parentId===ee&&ye.push(bt.numPoints?yn(bt):this.points[bt.index])}if(ye.length===0)throw new Error(xe);return ye},Pt.prototype.getLeaves=function(ee,ue,me){var xe=[];return this._appendLeaves(xe,ee,ue=ue||10,me=me||0,0),xe},Pt.prototype.getTile=function(ee,ue,me){var xe=this.trees[this._limitZoom(ee)],Ae=Math.pow(2,ee),Ye=this.options,ze=Ye.radius/Ye.extent,ye=(me-ze)/Ae,Se=(me+1+ze)/Ae,tt={features:[]};return this._addTileFeatures(xe.range((ue-ze)/Ae,ye,(ue+1+ze)/Ae,Se),xe.points,ue,me,Ae,tt),ue===0&&this._addTileFeatures(xe.range(1-ze/Ae,ye,1,Se),xe.points,Ae,me,Ae,tt),ue===Ae-1&&this._addTileFeatures(xe.range(0,ye,ze/Ae,Se),xe.points,-1,me,Ae,tt),tt.features.length?tt:null},Pt.prototype.getClusterExpansionZoom=function(ee){for(var ue=this._getOriginZoom(ee)-1;ue<=this.options.maxZoom;){var me=this.getChildren(ee);if(ue++,me.length!==1)break;ee=me[0].properties.cluster_id}return ue},Pt.prototype._appendLeaves=function(ee,ue,me,xe,Ae){for(var Ye=0,ze=this.getChildren(ue);Ye<ze.length;Ye+=1){var ye=ze[Ye],Se=ye.properties;if(Se&&Se.cluster?Ae+Se.point_count<=xe?Ae+=Se.point_count:Ae=this._appendLeaves(ee,Se.cluster_id,me,xe,Ae):Ae<xe?Ae++:ee.push(ye),ee.length===me)break}return Ae},Pt.prototype._addTileFeatures=function(ee,ue,me,xe,Ae,Ye){for(var ze=0,ye=ee;ze<ye.length;ze+=1){var Se=ue[ye[ze]],tt=Se.numPoints,bt={type:1,geometry:[[Math.round(this.options.extent*(Se.x*Ae-me)),Math.round(this.options.extent*(Se.y*Ae-xe))]],tags:tt?tn(Se):this.points[Se.index].properties},St=void 0;tt?St=Se.id:this.options.generateId?St=Se.index:this.points[Se.index].id&&(St=this.points[Se.index].id),St!==void 0&&(bt.id=St),Ye.features.push(bt)}},Pt.prototype._limitZoom=function(ee){return Math.max(this.options.minZoom,Math.min(+ee,this.options.maxZoom+1))},Pt.prototype._cluster=function(ee,ue){for(var me=[],xe=this.options,Ae=xe.reduce,Ye=xe.minPoints,ze=xe.radius/(xe.extent*Math.pow(2,ue)),ye=0;ye<ee.length;ye++){var Se=ee[ye];if(!(Se.zoom<=ue)){Se.zoom=ue;for(var tt=this.trees[ue+1],bt=tt.within(Se.x,Se.y,ze),St=Se.numPoints||1,ct=St,It=0,qt=bt;It<qt.length;It+=1){var nn=tt.points[qt[It]];nn.zoom>ue&&(ct+=nn.numPoints||1)}if(ct>=Ye){for(var pt=Se.x*St,$t=Se.y*St,Ut=Ae&&St>1?this._map(Se,!0):null,Yt=(ye<<5)+(ue+1)+this.points.length,Ot=0,Re=bt;Ot<Re.length;Ot+=1){var _t=tt.points[Re[Ot]];if(!(_t.zoom<=ue)){_t.zoom=ue;var Kt=_t.numPoints||1;pt+=_t.x*Kt,$t+=_t.y*Kt,_t.parentId=Yt,Ae&&(Ut||(Ut=this._map(Se,!0)),Ae(Ut,this._map(_t)))}}Se.parentId=Yt,me.push(zt(pt/ct,$t/ct,Yt,ct,Ut))}else if(me.push(Se),ct>1)for(var mn=0,Bn=bt;mn<Bn.length;mn+=1){var En=tt.points[Bn[mn]];En.zoom<=ue||(En.zoom=ue,me.push(En))}}}return me},Pt.prototype._getOriginId=function(ee){return ee-this.points.length>>5},Pt.prototype._getOriginZoom=function(ee){return(ee-this.points.length)%32},Pt.prototype._map=function(ee,ue){if(ee.numPoints)return ue?z({},ee.properties):ee.properties;var me=this.points[ee.index].properties,xe=this.options.map(me);return ue&&xe===me?z({},xe):xe},Wr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wr.prototype.splitTile=function(ee,ue,me,xe,Ae,Ye,ze){for(var ye=[ee,ue,me,xe],Se=this.options,tt=Se.debug;ye.length;){xe=ye.pop(),me=ye.pop(),ue=ye.pop(),ee=ye.pop();var bt=1<<ue,St=zr(ue,me,xe),ct=this.tiles[St];if(!ct&&(tt>1&&console.time("creation"),ct=this.tiles[St]=xo(ee,ue,me,xe,Se),this.tileCoords.push({z:ue,x:me,y:xe}),tt)){tt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,me,xe,ct.numFeatures,ct.numPoints,ct.numSimplified),console.timeEnd("creation"));var It="z"+ue;this.stats[It]=(this.stats[It]||0)+1,this.total++}if(ct.source=ee,Ae){if(ue===Se.maxZoom||ue===Ae)continue;var qt=1<<Ae-ue;if(me!==Math.floor(Ye/qt)||xe!==Math.floor(ze/qt))continue}else if(ue===Se.indexMaxZoom||ct.numPoints<=Se.indexMaxPoints)continue;if(ct.source=null,ee.length!==0){tt>1&&console.time("clipping");var nn,pt,$t,Ut,Yt,Ot,Re=.5*Se.buffer/Se.extent,_t=.5-Re,Kt=.5+Re,mn=1+Re;nn=pt=$t=Ut=null,Yt=Tt(ee,bt,me-Re,me+Kt,0,ct.minX,ct.maxX,Se),Ot=Tt(ee,bt,me+_t,me+mn,0,ct.minX,ct.maxX,Se),ee=null,Yt&&(nn=Tt(Yt,bt,xe-Re,xe+Kt,1,ct.minY,ct.maxY,Se),pt=Tt(Yt,bt,xe+_t,xe+mn,1,ct.minY,ct.maxY,Se),Yt=null),Ot&&($t=Tt(Ot,bt,xe-Re,xe+Kt,1,ct.minY,ct.maxY,Se),Ut=Tt(Ot,bt,xe+_t,xe+mn,1,ct.minY,ct.maxY,Se),Ot=null),tt>1&&console.timeEnd("clipping"),ye.push(nn||[],ue+1,2*me,2*xe),ye.push(pt||[],ue+1,2*me,2*xe+1),ye.push($t||[],ue+1,2*me+1,2*xe),ye.push(Ut||[],ue+1,2*me+1,2*xe+1)}}},Wr.prototype.getTile=function(ee,ue,me){var xe=this.options,Ae=xe.extent,Ye=xe.debug;if(ee<0||ee>24)return null;var ze=1<<ee,ye=zr(ee,ue=(ue%ze+ze)%ze,me);if(this.tiles[ye])return Ti(this.tiles[ye],Ae);Ye>1&&console.log("drilling down to z%d-%d-%d",ee,ue,me);for(var Se,tt=ee,bt=ue,St=me;!Se&&tt>0;)tt--,bt=Math.floor(bt/2),St=Math.floor(St/2),Se=this.tiles[zr(tt,bt,St)];return Se&&Se.source?(Ye>1&&console.log("found parent tile z%d-%d-%d",tt,bt,St),Ye>1&&console.time("drilling down"),this.splitTile(Se.source,tt,bt,St,ee,ue,me),Ye>1&&console.timeEnd("drilling down"),this.tiles[ye]?Ti(this.tiles[ye],Ae):null):null};var Ml=(function(ee){function ue(me,xe,Ae,Ye){ee.call(this,me,xe,Ae,ys),Ye&&(this.loadGeoJSON=Ye)}return ee&&(ue.__proto__=ee),(ue.prototype=Object.create(ee&&ee.prototype)).constructor=ue,ue.prototype.loadData=function(me,xe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=xe,this._pendingLoadDataParams=me,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ue.prototype._loadData=function(){var me=this;if(this._pendingCallback&&this._pendingLoadDataParams){var xe=this._pendingCallback,Ae=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ye=!!(Ae&&Ae.request&&Ae.request.collectResourceTiming)&&new s.RequestPerformance(Ae.request);this.loadGeoJSON(Ae,(function(ze,ye){if(ze||!ye)return xe(ze);if(typeof ye!="object")return xe(new Error("Input data given to '"+Ae.source+"' is not a valid GeoJSON object."));(function ct(It,qt){var nn,pt=It&&It.type;if(pt==="FeatureCollection")for(nn=0;nn<It.features.length;nn++)ct(It.features[nn],qt);else if(pt==="GeometryCollection")for(nn=0;nn<It.geometries.length;nn++)ct(It.geometries[nn],qt);else if(pt==="Feature")ct(It.geometry,qt);else if(pt==="Polygon")T(It.coordinates,qt);else if(pt==="MultiPolygon")for(nn=0;nn<It.coordinates.length;nn++)T(It.coordinates[nn],qt);return It})(ye,!0);try{if(Ae.filter){var Se=s.createExpression(Ae.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map((function(ct){return ct.key+": "+ct.message})).join(", "));var tt=ye.features.filter((function(ct){return Se.value.evaluate({zoom:0},ct)}));ye={type:"FeatureCollection",features:tt}}me._geoJSONIndex=Ae.cluster?new Pt((function(ct){var It=ct.superclusterOptions,qt=ct.clusterProperties;if(!qt||!It)return It;for(var nn={},pt={},$t={accumulated:null,zoom:0},Ut={properties:null},Yt=Object.keys(qt),Ot=0,Re=Yt;Ot<Re.length;Ot+=1){var _t=Re[Ot],Kt=qt[_t],mn=Kt[0],Bn=s.createExpression(Kt[1]),En=s.createExpression(typeof mn=="string"?[mn,["accumulated"],["get",_t]]:mn);nn[_t]=Bn.value,pt[_t]=En.value}return It.map=function(qi){Ut.properties=qi;for(var ai={},ir=0,Pi=Yt;ir<Pi.length;ir+=1){var Rn=Pi[ir];ai[Rn]=nn[Rn].evaluate($t,Ut)}return ai},It.reduce=function(qi,ai){Ut.properties=ai;for(var ir=0,Pi=Yt;ir<Pi.length;ir+=1){var Rn=Pi[ir];$t.accumulated=qi[Rn],qi[Rn]=pt[Rn].evaluate($t,Ut)}},It})(Ae)).load(ye.features):(function(ct,It){return new Wr(ct,It)})(ye,Ae.geojsonVtOptions)}catch(ct){return xe(ct)}me.loaded={};var bt={};if(Ye){var St=Ye.finish();St&&(bt.resourceTiming={},bt.resourceTiming[Ae.source]=JSON.parse(JSON.stringify(St)))}xe(null,bt)}))}},ue.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ue.prototype.reloadTile=function(me,xe){var Ae=this.loaded;return Ae&&Ae[me.uid]?ee.prototype.reloadTile.call(this,me,xe):this.loadTile(me,xe)},ue.prototype.loadGeoJSON=function(me,xe){if(me.request)s.getJSON(me.request,xe);else{if(typeof me.data!="string")return xe(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."));try{return xe(null,JSON.parse(me.data))}catch{return xe(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."))}}},ue.prototype.removeSource=function(me,xe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),xe()},ue.prototype.getClusterExpansionZoom=function(me,xe){try{xe(null,this._geoJSONIndex.getClusterExpansionZoom(me.clusterId))}catch(Ae){xe(Ae)}},ue.prototype.getClusterChildren=function(me,xe){try{xe(null,this._geoJSONIndex.getChildren(me.clusterId))}catch(Ae){xe(Ae)}},ue.prototype.getClusterLeaves=function(me,xe){try{xe(null,this._geoJSONIndex.getLeaves(me.clusterId,me.limit,me.offset))}catch(Ae){xe(Ae)}},ue})(C),Ai=function(ee){var ue=this;this.self=ee,this.actor=new s.Actor(ee,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:C,geojson:Ml},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(me,xe){if(ue.workerSourceTypes[me])throw new Error('Worker source with name "'+me+'" already registered.');ue.workerSourceTypes[me]=xe},this.self.registerRTLTextPlugin=function(me){if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=me.applyArabicShaping,s.plugin.processBidirectionalText=me.processBidirectionalText,s.plugin.processStyledBidirectionalText=me.processStyledBidirectionalText}};return Ai.prototype.setReferrer=function(ee,ue){this.referrer=ue},Ai.prototype.setImages=function(ee,ue,me){for(var xe in this.availableImages[ee]=ue,this.workerSources[ee]){var Ae=this.workerSources[ee][xe];for(var Ye in Ae)Ae[Ye].availableImages=ue}me()},Ai.prototype.setLayers=function(ee,ue,me){this.getLayerIndex(ee).replace(ue),me()},Ai.prototype.updateLayers=function(ee,ue,me){this.getLayerIndex(ee).update(ue.layers,ue.removedIds),me()},Ai.prototype.loadTile=function(ee,ue,me){this.getWorkerSource(ee,ue.type,ue.source).loadTile(ue,me)},Ai.prototype.loadDEMTile=function(ee,ue,me){this.getDEMWorkerSource(ee,ue.source).loadTile(ue,me)},Ai.prototype.reloadTile=function(ee,ue,me){this.getWorkerSource(ee,ue.type,ue.source).reloadTile(ue,me)},Ai.prototype.abortTile=function(ee,ue,me){this.getWorkerSource(ee,ue.type,ue.source).abortTile(ue,me)},Ai.prototype.removeTile=function(ee,ue,me){this.getWorkerSource(ee,ue.type,ue.source).removeTile(ue,me)},Ai.prototype.removeDEMTile=function(ee,ue){this.getDEMWorkerSource(ee,ue.source).removeTile(ue)},Ai.prototype.removeSource=function(ee,ue,me){if(this.workerSources[ee]&&this.workerSources[ee][ue.type]&&this.workerSources[ee][ue.type][ue.source]){var xe=this.workerSources[ee][ue.type][ue.source];delete this.workerSources[ee][ue.type][ue.source],xe.removeSource!==void 0?xe.removeSource(ue,me):me()}},Ai.prototype.loadWorkerSource=function(ee,ue,me){try{this.self.importScripts(ue.url),me()}catch(xe){me(xe.toString())}},Ai.prototype.syncRTLPluginState=function(ee,ue,me){try{s.plugin.setState(ue);var xe=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&xe!=null){this.self.importScripts(xe);var Ae=s.plugin.isParsed();me(Ae?void 0:new Error("RTL Text Plugin failed to import scripts from "+xe),Ae)}}catch(Ye){me(Ye.toString())}},Ai.prototype.getAvailableImages=function(ee){var ue=this.availableImages[ee];return ue||(ue=[]),ue},Ai.prototype.getLayerIndex=function(ee){var ue=this.layerIndexes[ee];return ue||(ue=this.layerIndexes[ee]=new h),ue},Ai.prototype.getWorkerSource=function(ee,ue,me){var xe=this;return this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][ue]||(this.workerSources[ee][ue]={}),this.workerSources[ee][ue][me]||(this.workerSources[ee][ue][me]=new this.workerSourceTypes[ue]({send:function(Ae,Ye,ze){xe.actor.send(Ae,Ye,ze,ee)}},this.getLayerIndex(ee),this.getAvailableImages(ee))),this.workerSources[ee][ue][me]},Ai.prototype.getDEMWorkerSource=function(ee,ue){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][ue]||(this.demWorkerSources[ee][ue]=new S),this.demWorkerSources[ee][ue]},Ai.prototype.enforceCacheSizeLimit=function(ee,ue){s.enforceCacheSizeLimit(ue)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ai(self)),Ai})),o(["./shared"],(function(s){var l=s.createCommonjsModule((function(p){function _(E){return!g(E)}function g(E){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var F,B,H=new Blob([""],{type:"text/javascript"}),ae=URL.createObjectURL(H);try{B=new Worker(ae),F=!0}catch{F=!1}return B&&B.terminate(),URL.revokeObjectURL(ae),F})()?"Uint8ClampedArray"in window?ArrayBuffer.isView?(function(){var F=document.createElement("canvas");F.width=F.height=1;var B=F.getContext("2d");if(!B)return!1;var H=B.getImageData(0,0,1,1);return H&&H.width===F.width})()?(b[L=E&&E.failIfMajorPerformanceCaveat]===void 0&&(b[L]=(function(F){var B=(function(ae){var ve=document.createElement("canvas"),be=Object.create(_.webGLContextAttributes);return be.failIfMajorPerformanceCaveat=ae,ve.probablySupportsContext?ve.probablySupportsContext("webgl",be)||ve.probablySupportsContext("experimental-webgl",be):ve.supportsContext?ve.supportsContext("webgl",be)||ve.supportsContext("experimental-webgl",be):ve.getContext("webgl",be)||ve.getContext("experimental-webgl",be)})(F);if(!B)return!1;var H=B.createShader(B.VERTEX_SHADER);return!(!H||B.isContextLost())&&(B.shaderSource(H,"void main() {}"),B.compileShader(H),B.getShaderParameter(H,B.COMPILE_STATUS)===!0)})(L)),b[L]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var L}p.exports?p.exports=_:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=_,window.mapboxgl.notSupportedReason=g);var b={};_.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),u={create:function(p,_,g){var b=s.window.document.createElement(p);return _!==void 0&&(b.className=_),g&&g.appendChild(b),b},createNS:function(p,_){return s.window.document.createElementNS(p,_)}},h=s.window.document&&s.window.document.documentElement.style;function d(p){if(!h)return p[0];for(var _=0;_<p.length;_++)if(p[_]in h)return p[_];return p[0]}var m,y=d(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);u.disableDrag=function(){h&&y&&(m=h[y],h[y]="none")},u.enableDrag=function(){h&&y&&(h[y]=m)};var x=d(["transform","WebkitTransform"]);u.setTransform=function(p,_){p.style[x]=_};var C=!1;try{var w=Object.defineProperty({},"passive",{get:function(){C=!0}});s.window.addEventListener("test",w,w),s.window.removeEventListener("test",w,w)}catch{C=!1}u.addEventListener=function(p,_,g,b){b===void 0&&(b={}),p.addEventListener(_,g,"passive"in b&&C?b:b.capture)},u.removeEventListener=function(p,_,g,b){b===void 0&&(b={}),p.removeEventListener(_,g,"passive"in b&&C?b:b.capture)};var S=function(p){p.preventDefault(),p.stopPropagation(),s.window.removeEventListener("click",S,!0)};function T(p){var _=p.userImage;return!!(_&&_.render&&_.render())&&(p.data.replace(new Uint8Array(_.data.buffer)),!0)}u.suppressClick=function(){s.window.addEventListener("click",S,!0),s.window.setTimeout((function(){s.window.removeEventListener("click",S,!0)}),0)},u.mousePos=function(p,_){var g=p.getBoundingClientRect();return new s.Point(_.clientX-g.left-p.clientLeft,_.clientY-g.top-p.clientTop)},u.touchPos=function(p,_){for(var g=p.getBoundingClientRect(),b=[],E=0;E<_.length;E++)b.push(new s.Point(_[E].clientX-g.left-p.clientLeft,_[E].clientY-g.top-p.clientTop));return b},u.mouseButton=function(p){return s.window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button},u.remove=function(p){p.parentNode&&p.parentNode.removeChild(p)};var M=(function(p){function _(){p.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.isLoaded=function(){return this.loaded},_.prototype.setLoaded=function(g){if(this.loaded!==g&&(this.loaded=g,g)){for(var b=0,E=this.requestors;b<E.length;b+=1){var L=E[b];this._notify(L.ids,L.callback)}this.requestors=[]}},_.prototype.getImage=function(g){return this.images[g]},_.prototype.addImage=function(g,b){this._validate(g,b)&&(this.images[g]=b)},_.prototype._validate=function(g,b){var E=!0;return this._validateStretch(b.stretchX,b.data&&b.data.width)||(this.fire(new s.ErrorEvent(new Error('Image "'+g+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(b.stretchY,b.data&&b.data.height)||(this.fire(new s.ErrorEvent(new Error('Image "'+g+'" has invalid "stretchY" value'))),E=!1),this._validateContent(b.content,b)||(this.fire(new s.ErrorEvent(new Error('Image "'+g+'" has invalid "content" value'))),E=!1),E},_.prototype._validateStretch=function(g,b){if(!g)return!0;for(var E=0,L=0,F=g;L<F.length;L+=1){var B=F[L];if(B[0]<E||B[1]<B[0]||b<B[1])return!1;E=B[1]}return!0},_.prototype._validateContent=function(g,b){return!(g&&(g.length!==4||g[0]<0||b.data.width<g[0]||g[1]<0||b.data.height<g[1]||g[2]<0||b.data.width<g[2]||g[3]<0||b.data.height<g[3]||g[2]<g[0]||g[3]<g[1]))},_.prototype.updateImage=function(g,b){b.version=this.images[g].version+1,this.images[g]=b,this.updatedImages[g]=!0},_.prototype.removeImage=function(g){var b=this.images[g];delete this.images[g],delete this.patterns[g],b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()},_.prototype.listImages=function(){return Object.keys(this.images)},_.prototype.getImages=function(g,b){var E=!0;if(!this.isLoaded())for(var L=0,F=g;L<F.length;L+=1)this.images[F[L]]||(E=!1);this.isLoaded()||E?this._notify(g,b):this.requestors.push({ids:g,callback:b})},_.prototype._notify=function(g,b){for(var E={},L=0,F=g;L<F.length;L+=1){var B=F[L];this.images[B]||this.fire(new s.Event("styleimagemissing",{id:B}));var H=this.images[B];H?E[B]={data:H.data.clone(),pixelRatio:H.pixelRatio,sdf:H.sdf,version:H.version,stretchX:H.stretchX,stretchY:H.stretchY,content:H.content,hasRenderCallback:!!(H.userImage&&H.userImage.render)}:s.warnOnce('Image "'+B+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}b(null,E)},_.prototype.getPixelSize=function(){var g=this.atlasImage;return{width:g.width,height:g.height}},_.prototype.getPattern=function(g){var b=this.patterns[g],E=this.getImage(g);if(!E)return null;if(b&&b.position.version===E.version)return b.position;if(b)b.position.version=E.version;else{var L={w:E.data.width+2,h:E.data.height+2,x:0,y:0},F=new s.ImagePosition(L,E);this.patterns[g]={bin:L,position:F}}return this._updatePatternAtlas(),this.patterns[g].position},_.prototype.bind=function(g){var b=g.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(g,this.atlasImage,b.RGBA),this.atlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE)},_.prototype._updatePatternAtlas=function(){var g=[];for(var b in this.patterns)g.push(this.patterns[b].bin);var E=s.potpack(g),L=E.w,F=E.h,B=this.atlasImage;for(var H in B.resize({width:L||1,height:F||1}),this.patterns){var ae=this.patterns[H].bin,ve=ae.x+1,be=ae.y+1,Ie=this.images[H].data,Oe=Ie.width,Fe=Ie.height;s.RGBAImage.copy(Ie,B,{x:0,y:0},{x:ve,y:be},{width:Oe,height:Fe}),s.RGBAImage.copy(Ie,B,{x:0,y:Fe-1},{x:ve,y:be-1},{width:Oe,height:1}),s.RGBAImage.copy(Ie,B,{x:0,y:0},{x:ve,y:be+Fe},{width:Oe,height:1}),s.RGBAImage.copy(Ie,B,{x:Oe-1,y:0},{x:ve-1,y:be},{width:1,height:Fe}),s.RGBAImage.copy(Ie,B,{x:0,y:0},{x:ve+Oe,y:be},{width:1,height:Fe})}this.dirty=!0},_.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},_.prototype.dispatchRenderCallbacks=function(g){for(var b=0,E=g;b<E.length;b+=1){var L=E[b];if(!this.callbackDispatchedThisFrame[L]){this.callbackDispatchedThisFrame[L]=!0;var F=this.images[L];T(F)&&this.updateImage(L,F)}}},_})(s.Evented),G=W,N=W,V=1e20;function W(p,_,g,b,E,L){this.fontSize=p||24,this.buffer=_===void 0?3:_,this.cutoff=b||.25,this.fontFamily=E||"sans-serif",this.fontWeight=L||"normal",this.radius=g||8;var F=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=F,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(F*F),this.gridInner=new Float64Array(F*F),this.f=new Float64Array(F),this.d=new Float64Array(F),this.z=new Float64Array(F+1),this.v=new Int16Array(F),this.middle=Math.round(F/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function j(p,_,g,b,E,L,F){for(var B=0;B<_;B++){for(var H=0;H<g;H++)b[H]=p[H*_+B];for(J(b,E,L,F,g),H=0;H<g;H++)p[H*_+B]=E[H]}for(H=0;H<g;H++){for(B=0;B<_;B++)b[B]=p[H*_+B];for(J(b,E,L,F,_),B=0;B<_;B++)p[H*_+B]=Math.sqrt(E[B])}}function J(p,_,g,b,E){g[0]=0,b[0]=-V,b[1]=+V;for(var L=1,F=0;L<E;L++){for(var B=(p[L]+L*L-(p[g[F]]+g[F]*g[F]))/(2*L-2*g[F]);B<=b[F];)F--,B=(p[L]+L*L-(p[g[F]]+g[F]*g[F]))/(2*L-2*g[F]);g[++F]=L,b[F]=B,b[F+1]=+V}for(L=0,F=0;L<E;L++){for(;b[F+1]<L;)F++;_[L]=(L-g[F])*(L-g[F])+p[g[F]]}}W.prototype.draw=function(p){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(p,this.buffer,this.middle);for(var _=this.ctx.getImageData(0,0,this.size,this.size),g=new Uint8ClampedArray(this.size*this.size),b=0;b<this.size*this.size;b++){var E=_.data[4*b+3]/255;this.gridOuter[b]=E===1?0:E===0?V:Math.pow(Math.max(0,.5-E),2),this.gridInner[b]=E===1?V:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(j(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),j(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),b=0;b<this.size*this.size;b++)g[b]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[b]-this.gridInner[b])/this.radius+this.cutoff))));return g},G.default=N;var te=function(p,_){this.requestManager=p,this.localIdeographFontFamily=_,this.entries={}};te.prototype.setURL=function(p){this.url=p},te.prototype.getGlyphs=function(p,_){var g=this,b=[];for(var E in p)for(var L=0,F=p[E];L<F.length;L+=1)b.push({stack:E,id:F[L]});s.asyncAll(b,(function(B,H){var ae=B.stack,ve=B.id,be=g.entries[ae];be||(be=g.entries[ae]={glyphs:{},requests:{},ranges:{}});var Ie=be.glyphs[ve];if(Ie===void 0){if(Ie=g._tinySDF(be,ae,ve))return be.glyphs[ve]=Ie,void H(null,{stack:ae,id:ve,glyph:Ie});var Oe=Math.floor(ve/256);if(256*Oe>65535)H(new Error("glyphs > 65535 not supported"));else if(be.ranges[Oe])H(null,{stack:ae,id:ve,glyph:Ie});else{var Fe=be.requests[Oe];Fe||(Fe=be.requests[Oe]=[],te.loadGlyphRange(ae,Oe,g.url,g.requestManager,(function(Xe,Ee){if(Ee){for(var Ue in Ee)g._doesCharSupportLocalGlyph(+Ue)||(be.glyphs[+Ue]=Ee[+Ue]);be.ranges[Oe]=!0}for(var je=0,nt=Fe;je<nt.length;je+=1)(0,nt[je])(Xe,Ee);delete be.requests[Oe]}))),Fe.push((function(Xe,Ee){Xe?H(Xe):Ee&&H(null,{stack:ae,id:ve,glyph:Ee[ve]||null})}))}}else H(null,{stack:ae,id:ve,glyph:Ie})}),(function(B,H){if(B)_(B);else if(H){for(var ae={},ve=0,be=H;ve<be.length;ve+=1){var Ie=be[ve],Oe=Ie.stack,Fe=Ie.id,Xe=Ie.glyph;(ae[Oe]||(ae[Oe]={}))[Fe]=Xe&&{id:Xe.id,bitmap:Xe.bitmap.clone(),metrics:Xe.metrics}}_(null,ae)}}))},te.prototype._doesCharSupportLocalGlyph=function(p){return!!this.localIdeographFontFamily&&(s.isChar["CJK Unified Ideographs"](p)||s.isChar["Hangul Syllables"](p)||s.isChar.Hiragana(p)||s.isChar.Katakana(p))},te.prototype._tinySDF=function(p,_,g){var b=this.localIdeographFontFamily;if(b&&this._doesCharSupportLocalGlyph(g)){var E=p.tinySDF;if(!E){var L="400";/bold/i.test(_)?L="900":/medium/i.test(_)?L="500":/light/i.test(_)&&(L="200"),E=p.tinySDF=new te.TinySDF(24,3,8,.25,b,L)}return{id:g,bitmap:new s.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(g))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},te.loadGlyphRange=function(p,_,g,b,E){var L=256*_,F=L+255,B=b.transformRequest(b.normalizeGlyphsURL(g).replace("{fontstack}",p).replace("{range}",L+"-"+F),s.ResourceType.Glyphs);s.getArrayBuffer(B,(function(H,ae){if(H)E(H);else if(ae){for(var ve={},be=0,Ie=s.parseGlyphPBF(ae);be<Ie.length;be+=1){var Oe=Ie[be];ve[Oe.id]=Oe}E(null,ve)}}))},te.TinySDF=G;var ce=function(){this.specification=s.styleSpec.light.position};ce.prototype.possiblyEvaluate=function(p,_){return s.sphericalToCartesian(p.expression.evaluate(_))},ce.prototype.interpolate=function(p,_,g){return{x:s.number(p.x,_.x,g),y:s.number(p.y,_.y,g),z:s.number(p.z,_.z,g)}};var pe=new s.Properties({anchor:new s.DataConstantProperty(s.styleSpec.light.anchor),position:new ce,color:new s.DataConstantProperty(s.styleSpec.light.color),intensity:new s.DataConstantProperty(s.styleSpec.light.intensity)}),Y=(function(p){function _(g){p.call(this),this._transitionable=new s.Transitionable(pe),this.setLight(g),this._transitioning=this._transitionable.untransitioned()}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getLight=function(){return this._transitionable.serialize()},_.prototype.setLight=function(g,b){if(b===void 0&&(b={}),!this._validate(s.validateLight,g,b))for(var E in g){var L=g[E];s.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-11),L):this._transitionable.setValue(E,L)}},_.prototype.updateTransitions=function(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)},_.prototype.hasTransition=function(){return this._transitioning.hasTransition()},_.prototype.recalculate=function(g){this.properties=this._transitioning.possiblyEvaluate(g)},_.prototype._validate=function(g,b,E){return(!E||E.validate!==!1)&&s.emitValidationErrors(this,g.call(s.validateStyle,s.extend({value:b,style:{glyphs:!0,sprite:!0},styleSpec:s.styleSpec})))},_})(s.Evented),he=function(p,_){this.width=p,this.height=_,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};he.prototype.getDash=function(p,_){var g=p.join(",")+String(_);return this.dashEntry[g]||(this.dashEntry[g]=this.addDash(p,_)),this.dashEntry[g]},he.prototype.getDashRanges=function(p,_,g){var b=[],E=p.length%2==1?-p[p.length-1]*g:0,L=p[0]*g,F=!0;b.push({left:E,right:L,isDash:F,zeroLength:p[0]===0});for(var B=p[0],H=1;H<p.length;H++){var ae=p[H];b.push({left:E=B*g,right:L=(B+=ae)*g,isDash:F=!F,zeroLength:ae===0})}return b},he.prototype.addRoundDash=function(p,_,g){for(var b=_/2,E=-g;E<=g;E++)for(var L=this.width*(this.nextRow+g+E),F=0,B=p[F],H=0;H<this.width;H++){H/B.right>1&&(B=p[++F]);var ae=Math.abs(H-B.left),ve=Math.abs(H-B.right),be=Math.min(ae,ve),Ie=void 0,Oe=E/g*(b+1);if(B.isDash){var Fe=b-Math.abs(Oe);Ie=Math.sqrt(be*be+Fe*Fe)}else Ie=b-Math.sqrt(be*be+Oe*Oe);this.data[L+H]=Math.max(0,Math.min(255,Ie+128))}},he.prototype.addRegularDash=function(p){for(var _=p.length-1;_>=0;--_){var g=p[_],b=p[_+1];g.zeroLength?p.splice(_,1):b&&b.isDash===g.isDash&&(b.left=g.left,p.splice(_,1))}var E=p[0],L=p[p.length-1];E.isDash===L.isDash&&(E.left=L.left-this.width,L.right=E.right+this.width);for(var F=this.width*this.nextRow,B=0,H=p[B],ae=0;ae<this.width;ae++){ae/H.right>1&&(H=p[++B]);var ve=Math.abs(ae-H.left),be=Math.abs(ae-H.right),Ie=Math.min(ve,be);this.data[F+ae]=Math.max(0,Math.min(255,(H.isDash?Ie:-Ie)+128))}},he.prototype.addDash=function(p,_){var g=_?7:0,b=2*g+1;if(this.nextRow+b>this.height)return s.warnOnce("LineAtlas out of space"),null;for(var E=0,L=0;L<p.length;L++)E+=p[L];if(E!==0){var F=this.width/E,B=this.getDashRanges(p,this.width,F);_?this.addRoundDash(B,F,g):this.addRegularDash(B)}var H={y:(this.nextRow+g+.5)/this.height,height:2*g/this.height,width:E};return this.nextRow+=b,this.dirty=!0,H},he.prototype.bind=function(p){var _=p.gl;this.texture?(_.bindTexture(_.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,_.texSubImage2D(_.TEXTURE_2D,0,0,0,this.width,this.height,_.ALPHA,_.UNSIGNED_BYTE,this.data))):(this.texture=_.createTexture(),_.bindTexture(_.TEXTURE_2D,this.texture),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.REPEAT),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.REPEAT),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR),_.texImage2D(_.TEXTURE_2D,0,_.ALPHA,this.width,this.height,0,_.ALPHA,_.UNSIGNED_BYTE,this.data))};var D=function p(_,g){this.workerPool=_,this.actors=[],this.currentActor=0,this.id=s.uniqueId();for(var b=this.workerPool.acquire(this.id),E=0;E<b.length;E++){var L=new p.Actor(b[E],g,this.id);L.name="Worker "+E,this.actors.push(L)}};function re(p,_,g){var b=function(E,L){if(E)return g(E);if(L){var F=s.pick(s.extend(L,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);L.vector_layers&&(F.vectorLayers=L.vector_layers,F.vectorLayerIds=F.vectorLayers.map((function(B){return B.id}))),F.tiles=_.canonicalizeTileset(F,p.url),g(null,F)}};return p.url?s.getJSON(_.transformRequest(_.normalizeSourceURL(p.url),s.ResourceType.Source),b):s.browser.frame((function(){return b(null,p)}))}D.prototype.broadcast=function(p,_,g){s.asyncAll(this.actors,(function(b,E){b.send(p,_,E)}),g=g||function(){})},D.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},D.prototype.remove=function(){this.actors.forEach((function(p){p.remove()})),this.actors=[],this.workerPool.release(this.id)},D.Actor=s.Actor;var le=function(p,_,g){this.bounds=s.LngLatBounds.convert(this.validateBounds(p)),this.minzoom=_||0,this.maxzoom=g||24};le.prototype.validateBounds=function(p){return Array.isArray(p)&&p.length===4?[Math.max(-180,p[0]),Math.max(-90,p[1]),Math.min(180,p[2]),Math.min(90,p[3])]:[-180,-90,180,90]},le.prototype.contains=function(p){var _=Math.pow(2,p.z),g=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*_),b=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*_),E=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*_),L=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*_);return p.x>=g&&p.x<E&&p.y>=b&&p.y<L};var fe=(function(p){function _(g,b,E,L){if(p.call(this),this.id=g,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(b,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},b),this._collectResourceTiming=b.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(L)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(){var g=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=re(this._options,this.map._requestManager,(function(b,E){g._tileJSONRequest=null,g._loaded=!0,b?g.fire(new s.ErrorEvent(b)):E&&(s.extend(g,E),E.bounds&&(g.tileBounds=new le(E.bounds,g.minzoom,g.maxzoom)),s.postTurnstileEvent(E.tiles,g.map._requestManager._customAccessToken),s.postMapLoadEvent(E.tiles,g.map._getMapId(),g.map._requestManager._skuToken,g.map._requestManager._customAccessToken),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))}))},_.prototype.loaded=function(){return this._loaded},_.prototype.hasTile=function(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)},_.prototype.onAdd=function(g){this.map=g,this.load()},_.prototype.setSourceProperty=function(g){this._tileJSONRequest&&this._tileJSONRequest.cancel(),g(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},_.prototype.setTiles=function(g){var b=this;return this.setSourceProperty((function(){b._options.tiles=g})),this},_.prototype.setUrl=function(g){var b=this;return this.setSourceProperty((function(){b.url=g,b._options.url=g})),this},_.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},_.prototype.serialize=function(){return s.extend({},this._options)},_.prototype.loadTile=function(g,b){var E=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),L={request:this.map._requestManager.transformRequest(E,s.ResourceType.Tile),uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function F(B,H){return delete g.request,g.aborted?b(null):B&&B.status!==404?b(B):(H&&H.resourceTiming&&(g.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&g.setExpiryData(H),g.loadVectorData(H,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),b(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}L.request.collectResourceTiming=this._collectResourceTiming,g.actor&&g.state!=="expired"?g.state==="loading"?g.reloadCallback=b:g.request=g.actor.send("reloadTile",L,F.bind(this)):(g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",L,F.bind(this)))},_.prototype.abortTile=function(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id},void 0)},_.prototype.unloadTile=function(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id},void 0)},_.prototype.hasTransition=function(){return!1},_})(s.Evented),Le=(function(p){function _(g,b,E,L){p.call(this),this.id=g,this.dispatcher=E,this.setEventedParent(L),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},b),s.extend(this,s.pick(b,["url","scheme","tileSize"]))}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(){var g=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=re(this._options,this.map._requestManager,(function(b,E){g._tileJSONRequest=null,g._loaded=!0,b?g.fire(new s.ErrorEvent(b)):E&&(s.extend(g,E),E.bounds&&(g.tileBounds=new le(E.bounds,g.minzoom,g.maxzoom)),s.postTurnstileEvent(E.tiles),s.postMapLoadEvent(E.tiles,g.map._getMapId(),g.map._requestManager._skuToken),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),g.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))}))},_.prototype.loaded=function(){return this._loaded},_.prototype.onAdd=function(g){this.map=g,this.load()},_.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},_.prototype.serialize=function(){return s.extend({},this._options)},_.prototype.hasTile=function(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)},_.prototype.loadTile=function(g,b){var E=this,L=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);g.request=s.getImage(this.map._requestManager.transformRequest(L,s.ResourceType.Tile),(function(F,B){if(delete g.request,g.aborted)g.state="unloaded",b(null);else if(F)g.state="errored",b(F);else if(B){E.map._refreshExpiredTiles&&g.setExpiryData(B),delete B.cacheControl,delete B.expires;var H=E.map.painter.context,ae=H.gl;g.texture=E.map.painter.getTileTexture(B.width),g.texture?g.texture.update(B,{useMipmap:!0}):(g.texture=new s.Texture(H,B,ae.RGBA,{useMipmap:!0}),g.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE,ae.LINEAR_MIPMAP_NEAREST),H.extTextureFilterAnisotropic&&ae.texParameterf(ae.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax)),g.state="loaded",s.cacheEntryPossiblyAdded(E.dispatcher),b(null)}}))},_.prototype.abortTile=function(g,b){g.request&&(g.request.cancel(),delete g.request),b()},_.prototype.unloadTile=function(g,b){g.texture&&this.map.painter.saveTileTexture(g.texture),b()},_.prototype.hasTransition=function(){return!1},_})(s.Evented),we=(function(p){function _(g,b,E,L){p.call(this,g,b,E,L),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},b),this.encoding=b.encoding||"mapbox"}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},_.prototype.loadTile=function(g,b){var E=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function L(F,B){F&&(g.state="errored",b(F)),B&&(g.dem=B,g.needsHillshadePrepare=!0,g.state="loaded",b(null))}g.request=s.getImage(this.map._requestManager.transformRequest(E,s.ResourceType.Tile),(function(F,B){if(delete g.request,g.aborted)g.state="unloaded",b(null);else if(F)g.state="errored",b(F);else if(B){this.map._refreshExpiredTiles&&g.setExpiryData(B),delete B.cacheControl,delete B.expires;var H=s.window.ImageBitmap&&B instanceof s.window.ImageBitmap&&s.offscreenCanvasSupported()?B:s.browser.getImageData(B,1),ae={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:H,encoding:this.encoding};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",ae,L.bind(this)))}}).bind(this)),g.neighboringTiles=this._getNeighboringTiles(g.tileID)},_.prototype._getNeighboringTiles=function(g){var b=g.canonical,E=Math.pow(2,b.z),L=(b.x-1+E)%E,F=b.x===0?g.wrap-1:g.wrap,B=(b.x+1+E)%E,H=b.x+1===E?g.wrap+1:g.wrap,ae={};return ae[new s.OverscaledTileID(g.overscaledZ,F,b.z,L,b.y).key]={backfilled:!1},ae[new s.OverscaledTileID(g.overscaledZ,H,b.z,B,b.y).key]={backfilled:!1},b.y>0&&(ae[new s.OverscaledTileID(g.overscaledZ,F,b.z,L,b.y-1).key]={backfilled:!1},ae[new s.OverscaledTileID(g.overscaledZ,g.wrap,b.z,b.x,b.y-1).key]={backfilled:!1},ae[new s.OverscaledTileID(g.overscaledZ,H,b.z,B,b.y-1).key]={backfilled:!1}),b.y+1<E&&(ae[new s.OverscaledTileID(g.overscaledZ,F,b.z,L,b.y+1).key]={backfilled:!1},ae[new s.OverscaledTileID(g.overscaledZ,g.wrap,b.z,b.x,b.y+1).key]={backfilled:!1},ae[new s.OverscaledTileID(g.overscaledZ,H,b.z,B,b.y+1).key]={backfilled:!1}),ae},_.prototype.unloadTile=function(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded",g.actor&&g.actor.send("removeDEMTile",{uid:g.uid,source:this.id})},_})(Le),se=(function(p){function _(g,b,E,L){p.call(this),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(L),this._data=b.data,this._options=s.extend({},b),this._collectResourceTiming=b.collectResourceTiming,this._resourceTiming=[],b.maxzoom!==void 0&&(this.maxzoom=b.maxzoom),b.type&&(this.type=b.type),b.attribution&&(this.attribution=b.attribution),this.promoteId=b.promoteId;var F=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:b.cluster||!1,geojsonVtOptions:{buffer:(b.buffer!==void 0?b.buffer:128)*F,tolerance:(b.tolerance!==void 0?b.tolerance:.375)*F,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:b.lineMetrics||!1,generateId:b.generateId||!1},superclusterOptions:{maxZoom:b.clusterMaxZoom!==void 0?Math.min(b.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,b.clusterMinPoints||2),extent:s.EXTENT,radius:(b.clusterRadius||50)*F,log:!1,generateId:b.generateId||!1},clusterProperties:b.clusterProperties,filter:b.filter},b.workerOptions)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(){var g=this;this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(b){if(b)g.fire(new s.ErrorEvent(b));else{var E={dataType:"source",sourceDataType:"metadata"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(E.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new s.Event("data",E))}}))},_.prototype.onAdd=function(g){this.map=g,this.load()},_.prototype.setData=function(g){var b=this;return this._data=g,this.fire(new s.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(E){if(E)b.fire(new s.ErrorEvent(E));else{var L={dataType:"source",sourceDataType:"content"};b._collectResourceTiming&&b._resourceTiming&&b._resourceTiming.length>0&&(L.resourceTiming=b._resourceTiming,b._resourceTiming=[]),b.fire(new s.Event("data",L))}})),this},_.prototype.getClusterExpansionZoom=function(g,b){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},b),this},_.prototype.getClusterChildren=function(g,b){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},b),this},_.prototype.getClusterLeaves=function(g,b,E,L){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:b,offset:E},L),this},_.prototype._updateWorkerData=function(g){var b=this;this._loaded=!1;var E=s.extend({},this.workerOptions),L=this._data;typeof L=="string"?(E.request=this.map._requestManager.transformRequest(s.browser.resolveURL(L),s.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(L),this.actor.send(this.type+".loadData",E,(function(F,B){b._removed||B&&B.abandoned||(b._loaded=!0,B&&B.resourceTiming&&B.resourceTiming[b.id]&&(b._resourceTiming=B.resourceTiming[b.id].slice(0)),b.actor.send(b.type+".coalesce",{source:E.source},null),g(F))}))},_.prototype.loaded=function(){return this._loaded},_.prototype.loadTile=function(g,b){var E=this,L=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(L,{type:this.type,uid:g.uid,tileID:g.tileID,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(F,B){return delete g.request,g.unloadVectorData(),g.aborted?b(null):F?b(F):(g.loadVectorData(B,E.map.painter,L==="reloadTile"),b(null))}))},_.prototype.abortTile=function(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0},_.prototype.unloadTile=function(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})},_.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},_.prototype.serialize=function(){return s.extend({},this._options,{type:this.type,data:this._data})},_.prototype.hasTransition=function(){return!1},_})(s.Evented),Q=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),q=(function(p){function _(g,b,E,L){p.call(this),this.id=g,this.dispatcher=E,this.coordinates=b.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(L),this.options=b}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(g,b){var E=this;this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(function(L,F){E._loaded=!0,L?E.fire(new s.ErrorEvent(L)):F&&(E.image=F,g&&(E.coordinates=g),b&&b(),E._finishLoading())}))},_.prototype.loaded=function(){return this._loaded},_.prototype.updateImage=function(g){var b=this;return this.image&&g.url?(this.options.url=g.url,this.load(g.coordinates,(function(){b.texture=null})),this):this},_.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))},_.prototype.onAdd=function(g){this.map=g,this.load()},_.prototype.setCoordinates=function(g){var b=this;this.coordinates=g;var E=g.map(s.MercatorCoordinate.fromLngLat);this.tileID=(function(F){for(var B=1/0,H=1/0,ae=-1/0,ve=-1/0,be=0,Ie=F;be<Ie.length;be+=1){var Oe=Ie[be];B=Math.min(B,Oe.x),H=Math.min(H,Oe.y),ae=Math.max(ae,Oe.x),ve=Math.max(ve,Oe.y)}var Fe=Math.max(ae-B,ve-H),Xe=Math.max(0,Math.floor(-Math.log(Fe)/Math.LN2)),Ee=Math.pow(2,Xe);return new s.CanonicalTileID(Xe,Math.floor((B+ae)/2*Ee),Math.floor((H+ve)/2*Ee))})(E),this.minzoom=this.maxzoom=this.tileID.z;var L=E.map((function(F){return b.tileID.getTilePoint(F)._round()}));return this._boundsArray=new s.StructArrayLayout4i8,this._boundsArray.emplaceBack(L[0].x,L[0].y,0,0),this._boundsArray.emplaceBack(L[1].x,L[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(L[3].x,L[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(L[2].x,L[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this},_.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var g=this.map.painter.context,b=g.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Q.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new s.Texture(g,this.image,b.RGBA),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE)),this.tiles){var L=this.tiles[E];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture)}}},_.prototype.loadTile=function(g,b){this.tileID&&this.tileID.equals(g.tileID.canonical)?(this.tiles[String(g.tileID.wrap)]=g,g.buckets={},b(null)):(g.state="errored",b(null))},_.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},_.prototype.hasTransition=function(){return!1},_})(s.Evented),$e=(function(p){function _(g,b,E,L){p.call(this,g,b,E,L),this.roundZoom=!0,this.type="video",this.options=b}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(){var g=this;this._loaded=!1;var b=this.options;this.urls=[];for(var E=0,L=b.urls;E<L.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(L[E],s.ResourceType.Source).url);s.getVideo(this.urls,(function(F,B){g._loaded=!0,F?g.fire(new s.ErrorEvent(F)):B&&(g.video=B,g.video.loop=!0,g.video.setAttribute("playsinline",""),g.video.addEventListener("playing",(function(){g.map.triggerRepaint()})),g.map&&g.video.play(),g._finishLoading())}))},_.prototype.pause=function(){this.video&&this.video.pause()},_.prototype.play=function(){this.video&&this.video.play()},_.prototype.seek=function(g){if(this.video){var b=this.video.seekable;g<b.start(0)||g>b.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+b.start(0)+" and "+b.end(0)+"-second mark."))):this.video.currentTime=g}},_.prototype.getVideo=function(){return this.video},_.prototype.onAdd=function(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},_.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var g=this.map.painter.context,b=g.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,Q.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.texSubImage2D(b.TEXTURE_2D,0,0,0,b.RGBA,b.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(g,this.video,b.RGBA),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE)),this.tiles){var L=this.tiles[E];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture)}}},_.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},_.prototype.hasTransition=function(){return this.video&&!this.video.paused},_})(q),Qe=(function(p){function _(g,b,E,L){p.call(this,g,b,E,L),b.coordinates?Array.isArray(b.coordinates)&&b.coordinates.length===4&&!b.coordinates.some((function(F){return!Array.isArray(F)||F.length!==2||F.some((function(B){return typeof B!="number"}))}))||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'missing required property "coordinates"'))),b.animate&&typeof b.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'optional "animate" property must be a boolean value'))),b.canvas?typeof b.canvas=="string"||b.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError("sources."+g,null,'missing required property "canvas"'))),this.options=b,this.animate=b.animate===void 0||b.animate}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},_.prototype.getCanvas=function(){return this.canvas},_.prototype.onAdd=function(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()},_.prototype.onRemove=function(){this.pause()},_.prototype.prepare=function(){var g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var b=this.map.painter.context,E=b.gl;for(var L in this.boundsBuffer||(this.boundsBuffer=b.createVertexBuffer(this._boundsArray,Q.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(b,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var F=this.tiles[L];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture)}}},_.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},_.prototype.hasTransition=function(){return this._playing},_.prototype._hasInvalidDimensions=function(){for(var g=0,b=[this.canvas.width,this.canvas.height];g<b.length;g+=1){var E=b[g];if(isNaN(E)||E<=0)return!0}return!1},_})(q),qe={vector:fe,raster:Le,"raster-dem":we,geojson:se,video:$e,image:q,canvas:Qe};function Lt(p,_){var g=s.identity([]);return s.translate(g,g,[1,1,0]),s.scale(g,g,[.5*p.width,.5*p.height,1]),s.multiply(g,g,p.calculatePosMatrix(_.toUnwrapped()))}function Pt(p,_,g,b,E,L){var F=(function(Xe,Ee,Ue){if(Xe)for(var je=0,nt=Xe;je<nt.length;je+=1){var ut=Ee[nt[je]];if(ut&&ut.source===Ue&&ut.type==="fill-extrusion")return!0}else for(var ot in Ee){var ht=Ee[ot];if(ht.source===Ue&&ht.type==="fill-extrusion")return!0}return!1})(E&&E.layers,_,p.id),B=L.maxPitchScaleFactor(),H=p.tilesIn(b,B,F);H.sort(zt);for(var ae=[],ve=0,be=H;ve<be.length;ve+=1){var Ie=be[ve];ae.push({wrappedTileID:Ie.tileID.wrapped().key,queryResults:Ie.tile.queryRenderedFeatures(_,g,p._state,Ie.queryGeometry,Ie.cameraQueryGeometry,Ie.scale,E,L,B,Lt(p.transform,Ie.tileID))})}var Oe=(function(Xe){for(var Ee={},Ue={},je=0,nt=Xe;je<nt.length;je+=1){var ut=nt[je],ot=ut.queryResults,ht=ut.wrappedTileID,vt=Ue[ht]=Ue[ht]||{};for(var Nt in ot)for(var Gt=ot[Nt],en=vt[Nt]=vt[Nt]||{},vn=Ee[Nt]=Ee[Nt]||[],wn=0,Cn=Gt;wn<Cn.length;wn+=1){var xi=Cn[wn];en[xi.featureIndex]||(en[xi.featureIndex]=!0,vn.push(xi))}}return Ee})(ae);for(var Fe in Oe)Oe[Fe].forEach((function(Xe){var Ee=Xe.feature,Ue=p.getFeatureState(Ee.layer["source-layer"],Ee.id);Ee.source=Ee.layer.source,Ee.layer["source-layer"]&&(Ee.sourceLayer=Ee.layer["source-layer"]),Ee.state=Ue}));return Oe}function zt(p,_){var g=p.tileID,b=_.tileID;return g.overscaledZ-b.overscaledZ||g.canonical.y-b.canonical.y||g.wrap-b.wrap||g.canonical.x-b.canonical.x}var Dt=function(p,_){this.max=p,this.onRemove=_,this.reset()};Dt.prototype.reset=function(){for(var p in this.data)for(var _=0,g=this.data[p];_<g.length;_+=1){var b=g[_];b.timeout&&clearTimeout(b.timeout),this.onRemove(b.value)}return this.data={},this.order=[],this},Dt.prototype.add=function(p,_,g){var b=this,E=p.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var L={value:_,timeout:void 0};if(g!==void 0&&(L.timeout=setTimeout((function(){b.remove(p,L)}),g)),this.data[E].push(L),this.order.push(E),this.order.length>this.max){var F=this._getAndRemoveByKey(this.order[0]);F&&this.onRemove(F)}return this},Dt.prototype.has=function(p){return p.wrapped().key in this.data},Dt.prototype.getAndRemove=function(p){return this.has(p)?this._getAndRemoveByKey(p.wrapped().key):null},Dt.prototype._getAndRemoveByKey=function(p){var _=this.data[p].shift();return _.timeout&&clearTimeout(_.timeout),this.data[p].length===0&&delete this.data[p],this.order.splice(this.order.indexOf(p),1),_.value},Dt.prototype.getByKey=function(p){var _=this.data[p];return _?_[0].value:null},Dt.prototype.get=function(p){return this.has(p)?this.data[p.wrapped().key][0].value:null},Dt.prototype.remove=function(p,_){if(!this.has(p))return this;var g=p.wrapped().key,b=_===void 0?0:this.data[g].indexOf(_),E=this.data[g][b];return this.data[g].splice(b,1),E.timeout&&clearTimeout(E.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(E.value),this.order.splice(this.order.indexOf(g),1),this},Dt.prototype.setMaxSize=function(p){for(this.max=p;this.order.length>this.max;){var _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this},Dt.prototype.filter=function(p){var _=[];for(var g in this.data)for(var b=0,E=this.data[g];b<E.length;b+=1){var L=E[b];p(L.value)||_.push(L)}for(var F=0,B=_;F<B.length;F+=1){var H=B[F];this.remove(H.value.tileID,H)}};var yn=function(p,_,g){this.context=p;var b=p.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),p.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,_.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete _.arrayBuffer};yn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},yn.prototype.updateData=function(p){var _=this.context.gl;this.context.unbindVAO(),this.bind(),_.bufferSubData(_.ELEMENT_ARRAY_BUFFER,0,p.arrayBuffer)},yn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var tn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ne=function(p,_,g,b){this.length=_.length,this.attributes=g,this.itemSize=_.bytesPerElement,this.dynamicDraw=b,this.context=p;var E=p.gl;this.buffer=E.createBuffer(),p.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,_.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete _.arrayBuffer};Ne.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ne.prototype.updateData=function(p){var _=this.context.gl;this.bind(),_.bufferSubData(_.ARRAY_BUFFER,0,p.arrayBuffer)},Ne.prototype.enableAttributes=function(p,_){for(var g=0;g<this.attributes.length;g++){var b=_.attributes[this.attributes[g].name];b!==void 0&&p.enableVertexAttribArray(b)}},Ne.prototype.setVertexAttribPointers=function(p,_,g){for(var b=0;b<this.attributes.length;b++){var E=this.attributes[b],L=_.attributes[E.name];L!==void 0&&p.vertexAttribPointer(L,E.components,p[tn[E.type]],!1,this.itemSize,E.offset+this.itemSize*(g||0))}},Ne.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Be=function(p){this.gl=p.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Be.prototype.get=function(){return this.current},Be.prototype.set=function(p){},Be.prototype.getDefault=function(){return this.default},Be.prototype.setDefault=function(){this.set(this.default)};var z=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return s.Color.transparent},_.prototype.set=function(g){var b=this.current;(g.r!==b.r||g.g!==b.g||g.b!==b.b||g.a!==b.a||this.dirty)&&(this.gl.clearColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)},_})(Be),We=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return 1},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.clearDepth(g),this.current=g,this.dirty=!1)},_})(Be),ke=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return 0},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.clearStencil(g),this.current=g,this.dirty=!1)},_})(Be),ge=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return[!0,!0,!0,!0]},_.prototype.set=function(g){var b=this.current;(g[0]!==b[0]||g[1]!==b[1]||g[2]!==b[2]||g[3]!==b[3]||this.dirty)&&(this.gl.colorMask(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)},_})(Be),ie=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!0},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.depthMask(g),this.current=g,this.dirty=!1)},_})(Be),Ce=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return 255},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.stencilMask(g),this.current=g,this.dirty=!1)},_})(Be),Te=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},_.prototype.set=function(g){var b=this.current;(g.func!==b.func||g.ref!==b.ref||g.mask!==b.mask||this.dirty)&&(this.gl.stencilFunc(g.func,g.ref,g.mask),this.current=g,this.dirty=!1)},_})(Be),De=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){var g=this.gl;return[g.KEEP,g.KEEP,g.KEEP]},_.prototype.set=function(g){var b=this.current;(g[0]!==b[0]||g[1]!==b[1]||g[2]!==b[2]||this.dirty)&&(this.gl.stencilOp(g[0],g[1],g[2]),this.current=g,this.dirty=!1)},_})(Be),Ze=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;g?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST),this.current=g,this.dirty=!1}},_})(Be),Je=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return[0,1]},_.prototype.set=function(g){var b=this.current;(g[0]!==b[0]||g[1]!==b[1]||this.dirty)&&(this.gl.depthRange(g[0],g[1]),this.current=g,this.dirty=!1)},_})(Be),dt=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;g?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST),this.current=g,this.dirty=!1}},_})(Be),ft=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return this.gl.LESS},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.depthFunc(g),this.current=g,this.dirty=!1)},_})(Be),Tt=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;g?b.enable(b.BLEND):b.disable(b.BLEND),this.current=g,this.dirty=!1}},_})(Be),hn=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){var g=this.gl;return[g.ONE,g.ZERO]},_.prototype.set=function(g){var b=this.current;(g[0]!==b[0]||g[1]!==b[1]||this.dirty)&&(this.gl.blendFunc(g[0],g[1]),this.current=g,this.dirty=!1)},_})(Be),cn=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return s.Color.transparent},_.prototype.set=function(g){var b=this.current;(g.r!==b.r||g.g!==b.g||g.b!==b.b||g.a!==b.a||this.dirty)&&(this.gl.blendColor(g.r,g.g,g.b,g.a),this.current=g,this.dirty=!1)},_})(Be),vi=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return this.gl.FUNC_ADD},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.blendEquation(g),this.current=g,this.dirty=!1)},_})(Be),Hi=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;g?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE),this.current=g,this.dirty=!1}},_})(Be),Li=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return this.gl.BACK},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.cullFace(g),this.current=g,this.dirty=!1)},_})(Be),Tr=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return this.gl.CCW},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.frontFace(g),this.current=g,this.dirty=!1)},_})(Be),pi=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)},_})(Be),rs=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return this.gl.TEXTURE0},_.prototype.set=function(g){(g!==this.current||this.dirty)&&(this.gl.activeTexture(g),this.current=g,this.dirty=!1)},_})(Be),wi=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){var g=this.gl;return[0,0,g.drawingBufferWidth,g.drawingBufferHeight]},_.prototype.set=function(g){var b=this.current;(g[0]!==b[0]||g[1]!==b[1]||g[2]!==b[2]||g[3]!==b[3]||this.dirty)&&(this.gl.viewport(g[0],g[1],g[2],g[3]),this.current=g,this.dirty=!1)},_})(Be),Ti=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,g),this.current=g,this.dirty=!1}},_})(Be),Bs=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.bindRenderbuffer(b.RENDERBUFFER,g),this.current=g,this.dirty=!1}},_})(Be),xo=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.bindTexture(b.TEXTURE_2D,g),this.current=g,this.dirty=!1}},_})(Be),Ea=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.bindBuffer(b.ARRAY_BUFFER,g),this.current=g,this.dirty=!1}},_})(Be),ms=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){var b=this.gl;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,g),this.current=g,this.dirty=!1},_})(Be),Wr=(function(p){function _(g){p.call(this,g),this.vao=g.extVertexArrayObject}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_.prototype.set=function(g){this.vao&&(g!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(g),this.current=g,this.dirty=!1)},_})(Be),zr=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return 4},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.pixelStorei(b.UNPACK_ALIGNMENT,g),this.current=g,this.dirty=!1}},_})(Be),ys=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,g),this.current=g,this.dirty=!1}},_})(Be),Ml=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return!1},_.prototype.set=function(g){if(g!==this.current||this.dirty){var b=this.gl;b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,g),this.current=g,this.dirty=!1}},_})(Be),Ai=(function(p){function _(g,b){p.call(this,g),this.context=g,this.parent=b}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getDefault=function(){return null},_})(Be),ee=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.setDirty=function(){this.dirty=!0},_.prototype.set=function(g){if(g!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var b=this.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,g,0),this.current=g,this.dirty=!1}},_})(Ai),ue=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.set=function(g){if(g!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var b=this.gl;b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,g),this.current=g,this.dirty=!1}},_})(Ai),me=function(p,_,g,b){this.context=p,this.width=_,this.height=g;var E=this.framebuffer=p.gl.createFramebuffer();this.colorAttachment=new ee(p,E),b&&(this.depthAttachment=new ue(p,E))};me.prototype.destroy=function(){var p=this.context.gl,_=this.colorAttachment.get();if(_&&p.deleteTexture(_),this.depthAttachment){var g=this.depthAttachment.get();g&&p.deleteRenderbuffer(g)}p.deleteFramebuffer(this.framebuffer)};var xe=function(p,_,g){this.func=p,this.mask=_,this.range=g};xe.ReadOnly=!1,xe.ReadWrite=!0,xe.disabled=new xe(519,xe.ReadOnly,[0,1]);var Ae=function(p,_,g,b,E,L){this.test=p,this.ref=_,this.mask=g,this.fail=b,this.depthFail=E,this.pass=L};Ae.disabled=new Ae({func:519,mask:0},0,0,7680,7680,7680);var Ye=function(p,_,g){this.blendFunction=p,this.blendColor=_,this.mask=g};Ye.disabled=new Ye(Ye.Replace=[1,0],s.Color.transparent,[!1,!1,!1,!1]),Ye.unblended=new Ye(Ye.Replace,s.Color.transparent,[!0,!0,!0,!0]),Ye.alphaBlended=new Ye([1,771],s.Color.transparent,[!0,!0,!0,!0]);var ze=function(p,_,g){this.enable=p,this.mode=_,this.frontFace=g};ze.disabled=new ze(!1,1029,2305),ze.backCCW=new ze(!0,1029,2305);var ye=function(p){this.gl=p,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new z(this),this.clearDepth=new We(this),this.clearStencil=new ke(this),this.colorMask=new ge(this),this.depthMask=new ie(this),this.stencilMask=new Ce(this),this.stencilFunc=new Te(this),this.stencilOp=new De(this),this.stencilTest=new Ze(this),this.depthRange=new Je(this),this.depthTest=new dt(this),this.depthFunc=new ft(this),this.blend=new Tt(this),this.blendFunc=new hn(this),this.blendColor=new cn(this),this.blendEquation=new vi(this),this.cullFace=new Hi(this),this.cullFaceSide=new Li(this),this.frontFace=new Tr(this),this.program=new pi(this),this.activeTexture=new rs(this),this.viewport=new wi(this),this.bindFramebuffer=new Ti(this),this.bindRenderbuffer=new Bs(this),this.bindTexture=new xo(this),this.bindVertexBuffer=new Ea(this),this.bindElementBuffer=new ms(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Wr(this),this.pixelStoreUnpack=new zr(this),this.pixelStoreUnpackPremultiplyAlpha=new ys(this),this.pixelStoreUnpackFlipY=new Ml(this),this.extTextureFilterAnisotropic=p.getExtension("EXT_texture_filter_anisotropic")||p.getExtension("MOZ_EXT_texture_filter_anisotropic")||p.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=p.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=p.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(p.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=p.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=p.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=p.getParameter(p.MAX_TEXTURE_SIZE)};ye.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ye.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ye.prototype.createIndexBuffer=function(p,_){return new yn(this,p,_)},ye.prototype.createVertexBuffer=function(p,_,g){return new Ne(this,p,_,g)},ye.prototype.createRenderbuffer=function(p,_,g){var b=this.gl,E=b.createRenderbuffer();return this.bindRenderbuffer.set(E),b.renderbufferStorage(b.RENDERBUFFER,p,_,g),this.bindRenderbuffer.set(null),E},ye.prototype.createFramebuffer=function(p,_,g){return new me(this,p,_,g)},ye.prototype.clear=function(p){var _=p.color,g=p.depth,b=this.gl,E=0;_&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(_),this.colorMask.set([!0,!0,!0,!0])),g!==void 0&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),b.clear(E)},ye.prototype.setCullFace=function(p){p.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(p.mode),this.frontFace.set(p.frontFace))},ye.prototype.setDepthMode=function(p){p.func!==this.gl.ALWAYS||p.mask?(this.depthTest.set(!0),this.depthFunc.set(p.func),this.depthMask.set(p.mask),this.depthRange.set(p.range)):this.depthTest.set(!1)},ye.prototype.setStencilMode=function(p){p.test.func!==this.gl.ALWAYS||p.mask?(this.stencilTest.set(!0),this.stencilMask.set(p.mask),this.stencilOp.set([p.fail,p.depthFail,p.pass]),this.stencilFunc.set({func:p.test.func,ref:p.ref,mask:p.test.mask})):this.stencilTest.set(!1)},ye.prototype.setColorMode=function(p){s.deepEqual(p.blendFunction,Ye.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(p.blendFunction),this.blendColor.set(p.blendColor)),this.colorMask.set(p.mask)},ye.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Se=(function(p){function _(g,b,E){var L=this;p.call(this),this.id=g,this.dispatcher=E,this.on("data",(function(F){F.dataType==="source"&&F.sourceDataType==="metadata"&&(L._sourceLoaded=!0),L._sourceLoaded&&!L._paused&&F.dataType==="source"&&F.sourceDataType==="content"&&(L.reload(),L.transform&&L.update(L.transform))})),this.on("error",(function(){L._sourceErrored=!0})),this._source=(function(F,B,H,ae){var ve=new qe[B.type](F,B,H,ae);if(ve.id!==F)throw new Error("Expected Source id to be "+F+" instead of "+ve.id);return s.bindAll(["load","abort","unload","serialize","prepare"],ve),ve})(g,b,E,this),this._tiles={},this._cache=new Dt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new s.SourceFeatureState}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.onAdd=function(g){this.map=g,this._maxTileCacheSize=g?g._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(g)},_.prototype.onRemove=function(g){this._source&&this._source.onRemove&&this._source.onRemove(g)},_.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var g in this._tiles){var b=this._tiles[g];if(b.state!=="loaded"&&b.state!=="errored")return!1}return!0},_.prototype.getSource=function(){return this._source},_.prototype.pause=function(){this._paused=!0},_.prototype.resume=function(){if(this._paused){var g=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,g&&this.reload(),this.transform&&this.update(this.transform)}},_.prototype._loadTile=function(g,b){return this._source.loadTile(g,b)},_.prototype._unloadTile=function(g){if(this._source.unloadTile)return this._source.unloadTile(g,(function(){}))},_.prototype._abortTile=function(g){if(this._source.abortTile)return this._source.abortTile(g,(function(){}))},_.prototype.serialize=function(){return this._source.serialize()},_.prototype.prepare=function(g){for(var b in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[b];E.upload(g),E.prepare(this.map.style.imageManager)}},_.prototype.getIds=function(){return s.values(this._tiles).map((function(g){return g.tileID})).sort(tt).map((function(g){return g.key}))},_.prototype.getRenderableIds=function(g){var b=this,E=[];for(var L in this._tiles)this._isIdRenderable(L,g)&&E.push(this._tiles[L]);return g?E.sort((function(F,B){var H=F.tileID,ae=B.tileID,ve=new s.Point(H.canonical.x,H.canonical.y)._rotate(b.transform.angle),be=new s.Point(ae.canonical.x,ae.canonical.y)._rotate(b.transform.angle);return H.overscaledZ-ae.overscaledZ||be.y-ve.y||be.x-ve.x})).map((function(F){return F.tileID.key})):E.map((function(F){return F.tileID})).sort(tt).map((function(F){return F.key}))},_.prototype.hasRenderableParent=function(g){var b=this.findLoadedParent(g,0);return!!b&&this._isIdRenderable(b.tileID.key)},_.prototype._isIdRenderable=function(g,b){return this._tiles[g]&&this._tiles[g].hasData()&&!this._coveredTiles[g]&&(b||!this._tiles[g].holdingForFade())},_.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var g in this._cache.reset(),this._tiles)this._tiles[g].state!=="errored"&&this._reloadTile(g,"reloading")},_.prototype._reloadTile=function(g,b){var E=this._tiles[g];E&&(E.state!=="loading"&&(E.state=b),this._loadTile(E,this._tileLoaded.bind(this,E,g,b)))},_.prototype._tileLoaded=function(g,b,E,L){if(L)return g.state="errored",void(L.status!==404?this._source.fire(new s.ErrorEvent(L,{tile:g})):this.update(this.transform));g.timeAdded=s.browser.now(),E==="expired"&&(g.refreshedUponExpiration=!0),this._setTileReloadTimer(b,g),this.getSource().type==="raster-dem"&&g.dem&&this._backfillDEM(g),this._state.initializeTileState(g,this.map?this.map.painter:null),this._source.fire(new s.Event("data",{dataType:"source",tile:g,coord:g.tileID}))},_.prototype._backfillDEM=function(g){for(var b=this.getRenderableIds(),E=0;E<b.length;E++){var L=b[E];if(g.neighboringTiles&&g.neighboringTiles[L]){var F=this.getTileByID(L);B(g,F),B(F,g)}}function B(H,ae){H.needsHillshadePrepare=!0;var ve=ae.tileID.canonical.x-H.tileID.canonical.x,be=ae.tileID.canonical.y-H.tileID.canonical.y,Ie=Math.pow(2,H.tileID.canonical.z),Oe=ae.tileID.key;ve===0&&be===0||Math.abs(be)>1||(Math.abs(ve)>1&&(Math.abs(ve+Ie)===1?ve+=Ie:Math.abs(ve-Ie)===1&&(ve-=Ie)),ae.dem&&H.dem&&(H.dem.backfillBorder(ae.dem,ve,be),H.neighboringTiles&&H.neighboringTiles[Oe]&&(H.neighboringTiles[Oe].backfilled=!0)))}},_.prototype.getTile=function(g){return this.getTileByID(g.key)},_.prototype.getTileByID=function(g){return this._tiles[g]},_.prototype._retainLoadedChildren=function(g,b,E,L){for(var F in this._tiles){var B=this._tiles[F];if(!(L[F]||!B.hasData()||B.tileID.overscaledZ<=b||B.tileID.overscaledZ>E)){for(var H=B.tileID;B&&B.tileID.overscaledZ>b+1;){var ae=B.tileID.scaledTo(B.tileID.overscaledZ-1);(B=this._tiles[ae.key])&&B.hasData()&&(H=ae)}for(var ve=H;ve.overscaledZ>b;)if(g[(ve=ve.scaledTo(ve.overscaledZ-1)).key]){L[H.key]=H;break}}}},_.prototype.findLoadedParent=function(g,b){if(g.key in this._loadedParentTiles){var E=this._loadedParentTiles[g.key];return E&&E.tileID.overscaledZ>=b?E:null}for(var L=g.overscaledZ-1;L>=b;L--){var F=g.scaledTo(L),B=this._getLoadedTile(F);if(B)return B}},_.prototype._getLoadedTile=function(g){var b=this._tiles[g.key];return b&&b.hasData()?b:this._cache.getByKey(g.wrapped().key)},_.prototype.updateCacheSize=function(g){var b=Math.ceil(g.width/this._source.tileSize)+1,E=Math.ceil(g.height/this._source.tileSize)+1,L=Math.floor(b*E*5),F=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,L):L;this._cache.setMaxSize(F)},_.prototype.handleWrapJump=function(g){var b=Math.round((g-(this._prevLng===void 0?g:this._prevLng))/360);if(this._prevLng=g,b){var E={};for(var L in this._tiles){var F=this._tiles[L];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+b),E[F.tileID.key]=F}for(var B in this._tiles=E,this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(var H in this._tiles)this._setTileReloadTimer(H,this._tiles[H])}},_.prototype.update=function(g){var b=this;if(this.transform=g,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(g),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=g.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(vt){return new s.OverscaledTileID(vt.canonical.z,vt.wrap,vt.canonical.z,vt.canonical.x,vt.canonical.y)})):(E=g.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter((function(vt){return b._source.hasTile(vt)})))):E=[];var L=g.coveringZoomLevel(this._source),F=Math.max(L-_.maxOverzooming,this._source.minzoom),B=Math.max(L+_.maxUnderzooming,this._source.minzoom),H=this._updateRetainedTiles(E,L);if(bt(this._source.type)){for(var ae={},ve={},be=0,Ie=Object.keys(H);be<Ie.length;be+=1){var Oe=Ie[be],Fe=H[Oe],Xe=this._tiles[Oe];if(Xe&&!(Xe.fadeEndTime&&Xe.fadeEndTime<=s.browser.now())){var Ee=this.findLoadedParent(Fe,F);Ee&&(this._addTile(Ee.tileID),ae[Ee.tileID.key]=Ee.tileID),ve[Oe]=Fe}}for(var Ue in this._retainLoadedChildren(ve,L,B,H),ae)H[Ue]||(this._coveredTiles[Ue]=!0,H[Ue]=ae[Ue])}for(var je in H)this._tiles[je].clearFadeHold();for(var nt=0,ut=s.keysDifference(this._tiles,H);nt<ut.length;nt+=1){var ot=ut[nt],ht=this._tiles[ot];ht.hasSymbolBuckets&&!ht.holdingForFade()?ht.setHoldDuration(this.map._fadeDuration):ht.hasSymbolBuckets&&!ht.symbolFadeFinished()||this._removeTile(ot)}this._updateLoadedParentTileCache()}},_.prototype.releaseSymbolFadeTiles=function(){for(var g in this._tiles)this._tiles[g].holdingForFade()&&this._removeTile(g)},_.prototype._updateRetainedTiles=function(g,b){for(var E={},L={},F=Math.max(b-_.maxOverzooming,this._source.minzoom),B=Math.max(b+_.maxUnderzooming,this._source.minzoom),H={},ae=0,ve=g;ae<ve.length;ae+=1){var be=ve[ae],Ie=this._addTile(be);E[be.key]=be,Ie.hasData()||b<this._source.maxzoom&&(H[be.key]=be)}this._retainLoadedChildren(H,b,B,E);for(var Oe=0,Fe=g;Oe<Fe.length;Oe+=1){var Xe=Fe[Oe],Ee=this._tiles[Xe.key];if(!Ee.hasData()){if(b+1>this._source.maxzoom){var Ue=Xe.children(this._source.maxzoom)[0],je=this.getTile(Ue);if(je&&je.hasData()){E[Ue.key]=Ue;continue}}else{var nt=Xe.children(this._source.maxzoom);if(E[nt[0].key]&&E[nt[1].key]&&E[nt[2].key]&&E[nt[3].key])continue}for(var ut=Ee.wasRequested(),ot=Xe.overscaledZ-1;ot>=F;--ot){var ht=Xe.scaledTo(ot);if(L[ht.key]||(L[ht.key]=!0,!(Ee=this.getTile(ht))&&ut&&(Ee=this._addTile(ht)),Ee&&(E[ht.key]=ht,ut=Ee.wasRequested(),Ee.hasData())))break}}}return E},_.prototype._updateLoadedParentTileCache=function(){for(var g in this._loadedParentTiles={},this._tiles){for(var b=[],E=void 0,L=this._tiles[g].tileID;L.overscaledZ>0;){if(L.key in this._loadedParentTiles){E=this._loadedParentTiles[L.key];break}b.push(L.key);var F=L.scaledTo(L.overscaledZ-1);if(E=this._getLoadedTile(F))break;L=F}for(var B=0,H=b;B<H.length;B+=1)this._loadedParentTiles[H[B]]=E}},_.prototype._addTile=function(g){var b=this._tiles[g.key];if(b)return b;(b=this._cache.getAndRemove(g))&&(this._setTileReloadTimer(g.key,b),b.tileID=g,this._state.initializeTileState(b,this.map?this.map.painter:null),this._cacheTimers[g.key]&&(clearTimeout(this._cacheTimers[g.key]),delete this._cacheTimers[g.key],this._setTileReloadTimer(g.key,b)));var E=!!b;return E||(b=new s.Tile(g,this._source.tileSize*g.overscaleFactor()),this._loadTile(b,this._tileLoaded.bind(this,b,g.key,b.state))),b?(b.uses++,this._tiles[g.key]=b,E||this._source.fire(new s.Event("dataloading",{tile:b,coord:b.tileID,dataType:"source"})),b):null},_.prototype._setTileReloadTimer=function(g,b){var E=this;g in this._timers&&(clearTimeout(this._timers[g]),delete this._timers[g]);var L=b.getExpiryTimeout();L&&(this._timers[g]=setTimeout((function(){E._reloadTile(g,"expired"),delete E._timers[g]}),L))},_.prototype._removeTile=function(g){var b=this._tiles[g];b&&(b.uses--,delete this._tiles[g],this._timers[g]&&(clearTimeout(this._timers[g]),delete this._timers[g]),b.uses>0||(b.hasData()&&b.state!=="reloading"?this._cache.add(b.tileID,b,b.getExpiryTimeout()):(b.aborted=!0,this._abortTile(b),this._unloadTile(b))))},_.prototype.clearTiles=function(){for(var g in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(g);this._cache.reset()},_.prototype.tilesIn=function(g,b,E){var L=this,F=[],B=this.transform;if(!B)return F;for(var H=E?B.getCameraQueryGeometry(g):g,ae=g.map((function(ot){return B.pointCoordinate(ot)})),ve=H.map((function(ot){return B.pointCoordinate(ot)})),be=this.getIds(),Ie=1/0,Oe=1/0,Fe=-1/0,Xe=-1/0,Ee=0,Ue=ve;Ee<Ue.length;Ee+=1){var je=Ue[Ee];Ie=Math.min(Ie,je.x),Oe=Math.min(Oe,je.y),Fe=Math.max(Fe,je.x),Xe=Math.max(Xe,je.y)}for(var nt=function(ot){var ht=L._tiles[be[ot]];if(!ht.holdingForFade()){var vt=ht.tileID,Nt=Math.pow(2,B.zoom-ht.tileID.overscaledZ),Gt=b*ht.queryPadding*s.EXTENT/ht.tileSize/Nt,en=[vt.getTilePoint(new s.MercatorCoordinate(Ie,Oe)),vt.getTilePoint(new s.MercatorCoordinate(Fe,Xe))];if(en[0].x-Gt<s.EXTENT&&en[0].y-Gt<s.EXTENT&&en[1].x+Gt>=0&&en[1].y+Gt>=0){var vn=ae.map((function(Cn){return vt.getTilePoint(Cn)})),wn=ve.map((function(Cn){return vt.getTilePoint(Cn)}));F.push({tile:ht,tileID:vt,queryGeometry:vn,cameraQueryGeometry:wn,scale:Nt})}}},ut=0;ut<be.length;ut++)nt(ut);return F},_.prototype.getVisibleCoordinates=function(g){for(var b=this,E=this.getRenderableIds(g).map((function(H){return b._tiles[H].tileID})),L=0,F=E;L<F.length;L+=1){var B=F[L];B.posMatrix=this.transform.calculatePosMatrix(B.toUnwrapped())}return E},_.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(bt(this._source.type))for(var g in this._tiles){var b=this._tiles[g];if(b.fadeEndTime!==void 0&&b.fadeEndTime>=s.browser.now())return!0}return!1},_.prototype.setFeatureState=function(g,b,E){this._state.updateState(g=g||"_geojsonTileLayer",b,E)},_.prototype.removeFeatureState=function(g,b,E){this._state.removeFeatureState(g=g||"_geojsonTileLayer",b,E)},_.prototype.getFeatureState=function(g,b){return this._state.getState(g=g||"_geojsonTileLayer",b)},_.prototype.setDependencies=function(g,b,E){var L=this._tiles[g];L&&L.setDependencies(b,E)},_.prototype.reloadTilesForDependencies=function(g,b){for(var E in this._tiles)this._tiles[E].hasDependency(g,b)&&this._reloadTile(E,"reloading");this._cache.filter((function(L){return!L.hasDependency(g,b)}))},_})(s.Evented);function tt(p,_){var g=Math.abs(2*p.wrap)-+(p.wrap<0),b=Math.abs(2*_.wrap)-+(_.wrap<0);return p.overscaledZ-_.overscaledZ||b-g||_.canonical.y-p.canonical.y||_.canonical.x-p.canonical.x}function bt(p){return p==="raster"||p==="image"||p==="video"}function St(){return new s.window.Worker(Gg.workerUrl)}Se.maxOverzooming=10,Se.maxUnderzooming=3;var ct="mapboxgl_preloaded_worker_pool",It=function(){this.active={}};It.prototype.acquire=function(p){if(!this.workers)for(this.workers=[];this.workers.length<It.workerCount;)this.workers.push(new St);return this.active[p]=!0,this.workers.slice()},It.prototype.release=function(p){delete this.active[p],this.numActive()===0&&(this.workers.forEach((function(_){_.terminate()})),this.workers=null)},It.prototype.isPreloaded=function(){return!!this.active[ct]},It.prototype.numActive=function(){return Object.keys(this.active).length};var qt,nn=Math.floor(s.browser.hardwareConcurrency/2);function pt(){return qt||(qt=new It),qt}function $t(p,_){var g={};for(var b in p)b!=="ref"&&(g[b]=p[b]);return s.refProperties.forEach((function(E){E in _&&(g[E]=_[E])})),g}function Ut(p){p=p.slice();for(var _=Object.create(null),g=0;g<p.length;g++)_[p[g].id]=p[g];for(var b=0;b<p.length;b++)"ref"in p[b]&&(p[b]=$t(p[b],_[p[b].ref]));return p}It.workerCount=Math.max(Math.min(nn,6),1);var Yt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ot(p,_,g){g.push({command:Yt.addSource,args:[p,_[p]]})}function Re(p,_,g){_.push({command:Yt.removeSource,args:[p]}),g[p]=!0}function _t(p,_,g,b){Re(p,g,b),Ot(p,_,g)}function Kt(p,_,g){var b;for(b in p[g])if(p[g].hasOwnProperty(b)&&b!=="data"&&!s.deepEqual(p[g][b],_[g][b]))return!1;for(b in _[g])if(_[g].hasOwnProperty(b)&&b!=="data"&&!s.deepEqual(p[g][b],_[g][b]))return!1;return!0}function mn(p,_,g,b,E,L){var F;for(F in _=_||{},p=p||{})p.hasOwnProperty(F)&&(s.deepEqual(p[F],_[F])||g.push({command:L,args:[b,F,_[F],E]}));for(F in _)_.hasOwnProperty(F)&&!p.hasOwnProperty(F)&&(s.deepEqual(p[F],_[F])||g.push({command:L,args:[b,F,_[F],E]}))}function Bn(p){return p.id}function En(p,_){return p[_.id]=_,p}var qi=function(p,_){this.reset(p,_)};qi.prototype.reset=function(p,_){this.points=p||[],this._distances=[0];for(var g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(_||0,.5*this.length),this.paddedLength=this.length-2*this.padding},qi.prototype.lerp=function(p){if(this.points.length===1)return this.points[0];p=s.clamp(p,0,1);for(var _=1,g=this._distances[_],b=p*this.paddedLength+this.padding;g<b&&_<this._distances.length;)g=this._distances[++_];var E=_-1,L=this._distances[E],F=g-L,B=F>0?(b-L)/F:0;return this.points[E].mult(1-B).add(this.points[_].mult(B))};var ai=function(p,_,g){var b=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(p/g),this.yCellCount=Math.ceil(_/g);for(var L=0;L<this.xCellCount*this.yCellCount;L++)b.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=p,this.height=_,this.xScale=this.xCellCount/p,this.yScale=this.yCellCount/_,this.boxUid=0,this.circleUid=0};function ir(p,_,g,b,E){var L=s.create();return _?(s.scale(L,L,[1/E,1/E,1]),g||s.rotateZ(L,L,b.angle)):s.multiply(L,b.labelPlaneMatrix,p),L}function Pi(p,_,g,b,E){if(_){var L=s.clone(p);return s.scale(L,L,[E,E,1]),g||s.rotateZ(L,L,-b.angle),L}return b.glCoordMatrix}function Rn(p,_){var g=[p.x,p.y,0,1];Ts(g,g,_);var b=g[3];return{point:new s.Point(g[0]/b,g[1]/b),signedDistanceFromCamera:b}}function bi(p,_){return .5+p/_*.5}function Zs(p,_){var g=p[0]/p[3],b=p[1]/p[3];return g>=-_[0]&&g<=_[0]&&b>=-_[1]&&b<=_[1]}function Mf(p,_,g,b,E,L,F,B){var H=b?p.textSizeData:p.iconSizeData,ae=s.evaluateSizeForZoom(H,g.transform.zoom),ve=[256/g.width*2+1,256/g.height*2+1],be=b?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;be.clear();for(var Ie=p.lineVertexArray,Oe=b?p.text.placedSymbolArray:p.icon.placedSymbolArray,Fe=g.transform.width/g.transform.height,Xe=!1,Ee=0;Ee<Oe.length;Ee++){var Ue=Oe.get(Ee);if(Ue.hidden||Ue.writingMode===s.WritingMode.vertical&&!Xe)oo(Ue.numGlyphs,be);else{Xe=!1;var je=[Ue.anchorX,Ue.anchorY,0,1];if(s.transformMat4(je,je,_),Zs(je,ve)){var nt=bi(g.transform.cameraToCenterDistance,je[3]),ut=s.evaluateSizeForFeature(H,ae,Ue),ot=F?ut/nt:ut*nt,ht=new s.Point(Ue.anchorX,Ue.anchorY),vt=Rn(ht,E).point,Nt={},Gt=Jy(Ue,ot,!1,B,_,E,L,p.glyphOffsetArray,Ie,be,vt,ht,Nt,Fe);Xe=Gt.useVertical,(Gt.notEnoughRoom||Xe||Gt.needsFlipping&&Jy(Ue,ot,!0,B,_,E,L,p.glyphOffsetArray,Ie,be,vt,ht,Nt,Fe).notEnoughRoom)&&oo(Ue.numGlyphs,be)}else oo(Ue.numGlyphs,be)}}b?p.text.dynamicLayoutVertexBuffer.updateData(be):p.icon.dynamicLayoutVertexBuffer.updateData(be)}function Es(p,_,g,b,E,L,F,B,H,ae,ve){var be=B.glyphStartIndex+B.numGlyphs,Ie=B.lineStartIndex,Oe=B.lineStartIndex+B.lineLength,Fe=_.getoffsetX(B.glyphStartIndex),Xe=_.getoffsetX(be-1),Ee=Ur(p*Fe,g,b,E,L,F,B.segment,Ie,Oe,H,ae,ve);if(!Ee)return null;var Ue=Ur(p*Xe,g,b,E,L,F,B.segment,Ie,Oe,H,ae,ve);return Ue?{first:Ee,last:Ue}:null}function Io(p,_,g,b){return p===s.WritingMode.horizontal&&Math.abs(g.y-_.y)>Math.abs(g.x-_.x)*b?{useVertical:!0}:(p===s.WritingMode.vertical?_.y<g.y:_.x>g.x)?{needsFlipping:!0}:null}function Jy(p,_,g,b,E,L,F,B,H,ae,ve,be,Ie,Oe){var Fe,Xe=_/24,Ee=p.lineOffsetX*Xe,Ue=p.lineOffsetY*Xe;if(p.numGlyphs>1){var je=p.glyphStartIndex+p.numGlyphs,nt=p.lineStartIndex,ut=p.lineStartIndex+p.lineLength,ot=Es(Xe,B,Ee,Ue,g,ve,be,p,H,L,Ie);if(!ot)return{notEnoughRoom:!0};var ht=Rn(ot.first.point,F).point,vt=Rn(ot.last.point,F).point;if(b&&!g){var Nt=Io(p.writingMode,ht,vt,Oe);if(Nt)return Nt}Fe=[ot.first];for(var Gt=p.glyphStartIndex+1;Gt<je-1;Gt++)Fe.push(Ur(Xe*B.getoffsetX(Gt),Ee,Ue,g,ve,be,p.segment,nt,ut,H,L,Ie));Fe.push(ot.last)}else{if(b&&!g){var en=Rn(be,E).point,vn=p.lineStartIndex+p.segment+1,wn=new s.Point(H.getx(vn),H.gety(vn)),Cn=Rn(wn,E),xi=Cn.signedDistanceFromCamera>0?Cn.point:kf(be,wn,en,1,E),rn=Io(p.writingMode,en,xi,Oe);if(rn)return rn}var On=Ur(Xe*B.getoffsetX(p.glyphStartIndex),Ee,Ue,g,ve,be,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,H,L,Ie);if(!On)return{notEnoughRoom:!0};Fe=[On]}for(var Hn=0,Fn=Fe;Hn<Fn.length;Hn+=1){var Gn=Fn[Hn];s.addDynamicAttributes(ae,Gn.point,Gn.angle)}return{}}function kf(p,_,g,b,E){var L=Rn(p.add(p.sub(_)._unit()),E).point,F=g.sub(L);return g.add(F._mult(b/F.mag()))}function Ur(p,_,g,b,E,L,F,B,H,ae,ve,be){var Ie=b?p-_:p+_,Oe=Ie>0?1:-1,Fe=0;b&&(Oe*=-1,Fe=Math.PI),Oe<0&&(Fe+=Math.PI);for(var Xe=Oe>0?B+F:B+F+1,Ee=E,Ue=E,je=0,nt=0,ut=Math.abs(Ie),ot=[];je+nt<=ut;){if((Xe+=Oe)<B||Xe>=H)return null;if(Ue=Ee,ot.push(Ee),(Ee=be[Xe])===void 0){var ht=new s.Point(ae.getx(Xe),ae.gety(Xe)),vt=Rn(ht,ve);if(vt.signedDistanceFromCamera>0)Ee=be[Xe]=vt.point;else{var Nt=Xe-Oe;Ee=kf(je===0?L:new s.Point(ae.getx(Nt),ae.gety(Nt)),ht,Ue,ut-je+1,ve)}}je+=nt,nt=Ue.dist(Ee)}var Gt=(ut-je)/nt,en=Ee.sub(Ue),vn=en.mult(Gt)._add(Ue);vn._add(en._unit()._perp()._mult(g*Oe));var wn=Fe+Math.atan2(Ee.y-Ue.y,Ee.x-Ue.x);return ot.push(vn),{point:vn,angle:wn,path:ot}}ai.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ai.prototype.insert=function(p,_,g,b,E){this._forEachCell(_,g,b,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(p),this.bboxes.push(_),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(E)},ai.prototype.insertCircle=function(p,_,g,b){this._forEachCell(_-b,g-b,_+b,g+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(p),this.circles.push(_),this.circles.push(g),this.circles.push(b)},ai.prototype._insertBoxCell=function(p,_,g,b,E,L){this.boxCells[E].push(L)},ai.prototype._insertCircleCell=function(p,_,g,b,E,L){this.circleCells[E].push(L)},ai.prototype._query=function(p,_,g,b,E,L){if(g<0||p>this.width||b<0||_>this.height)return!E&&[];var F=[];if(p<=0&&_<=0&&this.width<=g&&this.height<=b){if(E)return!0;for(var B=0;B<this.boxKeys.length;B++)F.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(var H=0;H<this.circleKeys.length;H++){var ae=this.circles[3*H],ve=this.circles[3*H+1],be=this.circles[3*H+2];F.push({key:this.circleKeys[H],x1:ae-be,y1:ve-be,x2:ae+be,y2:ve+be})}return L?F.filter(L):F}return this._forEachCell(p,_,g,b,this._queryCell,F,{hitTest:E,seenUids:{box:{},circle:{}}},L),E?F.length>0:F},ai.prototype._queryCircle=function(p,_,g,b,E){var L=p-g,F=p+g,B=_-g,H=_+g;if(F<0||L>this.width||H<0||B>this.height)return!b&&[];var ae=[];return this._forEachCell(L,B,F,H,this._queryCellCircle,ae,{hitTest:b,circle:{x:p,y:_,radius:g},seenUids:{box:{},circle:{}}},E),b?ae.length>0:ae},ai.prototype.query=function(p,_,g,b,E){return this._query(p,_,g,b,!1,E)},ai.prototype.hitTest=function(p,_,g,b,E){return this._query(p,_,g,b,!0,E)},ai.prototype.hitTestCircle=function(p,_,g,b){return this._queryCircle(p,_,g,!0,b)},ai.prototype._queryCell=function(p,_,g,b,E,L,F,B){var H=F.seenUids,ae=this.boxCells[E];if(ae!==null)for(var ve=this.bboxes,be=0,Ie=ae;be<Ie.length;be+=1){var Oe=Ie[be];if(!H.box[Oe]){H.box[Oe]=!0;var Fe=4*Oe;if(p<=ve[Fe+2]&&_<=ve[Fe+3]&&g>=ve[Fe+0]&&b>=ve[Fe+1]&&(!B||B(this.boxKeys[Oe]))){if(F.hitTest)return L.push(!0),!0;L.push({key:this.boxKeys[Oe],x1:ve[Fe],y1:ve[Fe+1],x2:ve[Fe+2],y2:ve[Fe+3]})}}}var Xe=this.circleCells[E];if(Xe!==null)for(var Ee=this.circles,Ue=0,je=Xe;Ue<je.length;Ue+=1){var nt=je[Ue];if(!H.circle[nt]){H.circle[nt]=!0;var ut=3*nt;if(this._circleAndRectCollide(Ee[ut],Ee[ut+1],Ee[ut+2],p,_,g,b)&&(!B||B(this.circleKeys[nt]))){if(F.hitTest)return L.push(!0),!0;var ot=Ee[ut],ht=Ee[ut+1],vt=Ee[ut+2];L.push({key:this.circleKeys[nt],x1:ot-vt,y1:ht-vt,x2:ot+vt,y2:ht+vt})}}}},ai.prototype._queryCellCircle=function(p,_,g,b,E,L,F,B){var H=F.circle,ae=F.seenUids,ve=this.boxCells[E];if(ve!==null)for(var be=this.bboxes,Ie=0,Oe=ve;Ie<Oe.length;Ie+=1){var Fe=Oe[Ie];if(!ae.box[Fe]){ae.box[Fe]=!0;var Xe=4*Fe;if(this._circleAndRectCollide(H.x,H.y,H.radius,be[Xe+0],be[Xe+1],be[Xe+2],be[Xe+3])&&(!B||B(this.boxKeys[Fe])))return L.push(!0),!0}}var Ee=this.circleCells[E];if(Ee!==null)for(var Ue=this.circles,je=0,nt=Ee;je<nt.length;je+=1){var ut=nt[je];if(!ae.circle[ut]){ae.circle[ut]=!0;var ot=3*ut;if(this._circlesCollide(Ue[ot],Ue[ot+1],Ue[ot+2],H.x,H.y,H.radius)&&(!B||B(this.circleKeys[ut])))return L.push(!0),!0}}},ai.prototype._forEachCell=function(p,_,g,b,E,L,F,B){for(var H=this._convertToXCellCoord(p),ae=this._convertToYCellCoord(_),ve=this._convertToXCellCoord(g),be=this._convertToYCellCoord(b),Ie=H;Ie<=ve;Ie++)for(var Oe=ae;Oe<=be;Oe++)if(E.call(this,p,_,g,b,this.xCellCount*Oe+Ie,L,F,B))return},ai.prototype._convertToXCellCoord=function(p){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(p*this.xScale)))},ai.prototype._convertToYCellCoord=function(p){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(p*this.yScale)))},ai.prototype._circlesCollide=function(p,_,g,b,E,L){var F=b-p,B=E-_,H=g+L;return H*H>F*F+B*B},ai.prototype._circleAndRectCollide=function(p,_,g,b,E,L,F){var B=(L-b)/2,H=Math.abs(p-(b+B));if(H>B+g)return!1;var ae=(F-E)/2,ve=Math.abs(_-(E+ae));if(ve>ae+g)return!1;if(H<=B||ve<=ae)return!0;var be=H-B,Ie=ve-ae;return be*be+Ie*Ie<=g*g};var Lf=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function oo(p,_){for(var g=0;g<p;g++){var b=_.length;_.resize(b+4),_.float32.set(Lf,3*b)}}function Ts(p,_,g){var b=_[0],E=_[1];return p[0]=g[0]*b+g[4]*E+g[12],p[1]=g[1]*b+g[5]*E+g[13],p[3]=g[3]*b+g[7]*E+g[15],p}var Ta=function(p,_,g){_===void 0&&(_=new ai(p.width+200,p.height+200,25)),g===void 0&&(g=new ai(p.width+200,p.height+200,25)),this.transform=p,this.grid=_,this.ignoredGrid=g,this.pitchfactor=Math.cos(p._pitch)*p.cameraToCenterDistance,this.screenRightBoundary=p.width+100,this.screenBottomBoundary=p.height+100,this.gridRightBoundary=p.width+200,this.gridBottomBoundary=p.height+200};function xr(p,_,g){return _*(s.EXTENT/(p.tileSize*Math.pow(2,g-p.tileID.overscaledZ)))}Ta.prototype.placeCollisionBox=function(p,_,g,b,E){var L=this.projectAndGetPerspectiveRatio(b,p.anchorPointX,p.anchorPointY),F=g*L.perspectiveRatio,B=p.x1*F+L.point.x,H=p.y1*F+L.point.y,ae=p.x2*F+L.point.x,ve=p.y2*F+L.point.y;return!this.isInsideGrid(B,H,ae,ve)||!_&&this.grid.hitTest(B,H,ae,ve,E)?{box:[],offscreen:!1}:{box:[B,H,ae,ve],offscreen:this.isOffscreen(B,H,ae,ve)}},Ta.prototype.placeCollisionCircles=function(p,_,g,b,E,L,F,B,H,ae,ve,be,Ie){var Oe=[],Fe=new s.Point(_.anchorX,_.anchorY),Xe=Rn(Fe,L),Ee=bi(this.transform.cameraToCenterDistance,Xe.signedDistanceFromCamera),Ue=(ae?E/Ee:E*Ee)/s.ONE_EM,je=Rn(Fe,F).point,nt=Es(Ue,b,_.lineOffsetX*Ue,_.lineOffsetY*Ue,!1,je,Fe,_,g,F,{}),ut=!1,ot=!1,ht=!0;if(nt){for(var vt=.5*be*Ee+Ie,Nt=new s.Point(-100,-100),Gt=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),en=new qi,vn=nt.first,wn=nt.last,Cn=[],xi=vn.path.length-1;xi>=1;xi--)Cn.push(vn.path[xi]);for(var rn=1;rn<wn.path.length;rn++)Cn.push(wn.path[rn]);var On=2.5*vt;if(B){var Hn=Cn.map((function(Ga){return Rn(Ga,B)}));Cn=Hn.some((function(Ga){return Ga.signedDistanceFromCamera<=0}))?[]:Hn.map((function(Ga){return Ga.point}))}var Fn=[];if(Cn.length>0){for(var Gn=Cn[0].clone(),Yn=Cn[0].clone(),Ln=1;Ln<Cn.length;Ln++)Gn.x=Math.min(Gn.x,Cn[Ln].x),Gn.y=Math.min(Gn.y,Cn[Ln].y),Yn.x=Math.max(Yn.x,Cn[Ln].x),Yn.y=Math.max(Yn.y,Cn[Ln].y);Fn=Gn.x>=Nt.x&&Yn.x<=Gt.x&&Gn.y>=Nt.y&&Yn.y<=Gt.y?[Cn]:Yn.x<Nt.x||Gn.x>Gt.x||Yn.y<Nt.y||Gn.y>Gt.y?[]:s.clipLine([Cn],Nt.x,Nt.y,Gt.x,Gt.y)}for(var Tn=0,_s=Fn;Tn<_s.length;Tn+=1){var Fr;en.reset(_s[Tn],.25*vt),Fr=en.length<=.5*vt?1:Math.ceil(en.paddedLength/On)+1;for(var to=0;to<Fr;to++){var Ms=to/Math.max(Fr-1,1),kr=en.lerp(Ms),Xr=kr.x+100,Wo=kr.y+100;Oe.push(Xr,Wo,vt,0);var co=Xr-vt,nc=Wo-vt,Co=Xr+vt,ul=Wo+vt;if(ht=ht&&this.isOffscreen(co,nc,Co,ul),ot=ot||this.isInsideGrid(co,nc,Co,ul),!p&&this.grid.hitTestCircle(Xr,Wo,vt,ve)&&(ut=!0,!H))return{circles:[],offscreen:!1,collisionDetected:ut}}}}return{circles:!H&&ut||!ot?[]:Oe,offscreen:ht,collisionDetected:ut}},Ta.prototype.queryRenderedSymbols=function(p){if(p.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var _=[],g=1/0,b=1/0,E=-1/0,L=-1/0,F=0,B=p;F<B.length;F+=1){var H=B[F],ae=new s.Point(H.x+100,H.y+100);g=Math.min(g,ae.x),b=Math.min(b,ae.y),E=Math.max(E,ae.x),L=Math.max(L,ae.y),_.push(ae)}for(var ve={},be={},Ie=0,Oe=this.grid.query(g,b,E,L).concat(this.ignoredGrid.query(g,b,E,L));Ie<Oe.length;Ie+=1){var Fe=Oe[Ie],Xe=Fe.key;if(ve[Xe.bucketInstanceId]===void 0&&(ve[Xe.bucketInstanceId]={}),!ve[Xe.bucketInstanceId][Xe.featureIndex]){var Ee=[new s.Point(Fe.x1,Fe.y1),new s.Point(Fe.x2,Fe.y1),new s.Point(Fe.x2,Fe.y2),new s.Point(Fe.x1,Fe.y2)];s.polygonIntersectsPolygon(_,Ee)&&(ve[Xe.bucketInstanceId][Xe.featureIndex]=!0,be[Xe.bucketInstanceId]===void 0&&(be[Xe.bucketInstanceId]=[]),be[Xe.bucketInstanceId].push(Xe.featureIndex))}}return be},Ta.prototype.insertCollisionBox=function(p,_,g,b,E){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:E},p[0],p[1],p[2],p[3])},Ta.prototype.insertCollisionCircles=function(p,_,g,b,E){for(var L=_?this.ignoredGrid:this.grid,F={bucketInstanceId:g,featureIndex:b,collisionGroupID:E},B=0;B<p.length;B+=4)L.insertCircle(F,p[B],p[B+1],p[B+2])},Ta.prototype.projectAndGetPerspectiveRatio=function(p,_,g){var b=[_,g,0,1];return Ts(b,b,p),{point:new s.Point((b[0]/b[3]+1)/2*this.transform.width+100,(-b[1]/b[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}},Ta.prototype.isOffscreen=function(p,_,g,b){return g<100||p>=this.screenRightBoundary||b<100||_>this.screenBottomBoundary},Ta.prototype.isInsideGrid=function(p,_,g,b){return g>=0&&p<this.gridRightBoundary&&b>=0&&_<this.gridBottomBoundary},Ta.prototype.getViewportMatrix=function(){var p=s.identity([]);return s.translate(p,p,[-100,-100,0]),p};var il=function(p,_,g,b){this.opacity=p?Math.max(0,Math.min(1,p.opacity+(p.placed?_:-_))):b&&g?1:0,this.placed=g};il.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var ca=function(p,_,g,b,E){this.text=new il(p?p.text:null,_,g,E),this.icon=new il(p?p.icon:null,_,b,E)};ca.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ob=function(p,_,g){this.text=p,this.icon=_,this.skipFade=g},Ra=function(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]},yA=function(p,_,g,b,E){this.bucketInstanceId=p,this.featureIndex=_,this.sourceLayerIndex=g,this.bucketIndex=b,this.tileID=E},iu=function(p){this.crossSourceCollisions=p,this.maxGroupID=0,this.collisionGroups={}};function Ws(p,_,g,b,E){var L=s.getAnchorAlignment(p),F=-(L.horizontalAlign-.5)*_,B=-(L.verticalAlign-.5)*g,H=s.evaluateVariableOffset(p,b);return new s.Point(F+H[0]*E,B+H[1]*E)}function kl(p,_,g,b,E,L){var F=p.x1,B=p.x2,H=p.y1,ae=p.y2,ve=p.anchorPointX,be=p.anchorPointY,Ie=new s.Point(_,g);return b&&Ie._rotate(E?L:-L),{x1:F+Ie.x,y1:H+Ie.y,x2:B+Ie.x,y2:ae+Ie.y,anchorPointX:ve,anchorPointY:be}}iu.prototype.get=function(p){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[p]){var _=++this.maxGroupID;this.collisionGroups[p]={ID:_,predicate:function(g){return g.collisionGroupID===_}}}return this.collisionGroups[p]};var ao=function(p,_,g,b){this.transform=p.clone(),this.collisionIndex=new Ta(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new iu(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}};function zc(p,_,g,b,E){p.emplaceBack(_?1:0,g?1:0,b||0,E||0),p.emplaceBack(_?1:0,g?1:0,b||0,E||0),p.emplaceBack(_?1:0,g?1:0,b||0,E||0),p.emplaceBack(_?1:0,g?1:0,b||0,E||0)}ao.prototype.getBucketParts=function(p,_,g,b){var E=g.getBucket(_),L=g.latestFeatureIndex;if(E&&L&&_.id===E.layerIds[0]){var F=g.collisionBoxArray,B=E.layers[0].layout,H=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),ae=g.tileSize/s.EXTENT,ve=this.transform.calculatePosMatrix(g.tileID.toUnwrapped()),be=B.get("text-pitch-alignment")==="map",Ie=B.get("text-rotation-alignment")==="map",Oe=xr(g,1,this.transform.zoom),Fe=ir(ve,be,Ie,this.transform,Oe),Xe=null;if(be){var Ee=Pi(ve,be,Ie,this.transform,Oe);Xe=s.multiply([],this.transform.labelPlaneMatrix,Ee)}this.retainedQueryData[E.bucketInstanceId]=new yA(E.bucketInstanceId,L,E.sourceLayerIndex,E.index,g.tileID);var Ue={bucket:E,layout:B,posMatrix:ve,textLabelPlaneMatrix:Fe,labelToScreenMatrix:Xe,scale:H,textPixelRatio:ae,holdingForFade:g.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(b)for(var je=0,nt=E.sortKeyRanges;je<nt.length;je+=1){var ut=nt[je];p.push({sortKey:ut.sortKey,symbolInstanceStart:ut.symbolInstanceStart,symbolInstanceEnd:ut.symbolInstanceEnd,parameters:Ue})}else p.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ue})}},ao.prototype.attemptAnchorPlacement=function(p,_,g,b,E,L,F,B,H,ae,ve,be,Ie,Oe,Fe){var Xe,Ee=[be.textOffset0,be.textOffset1],Ue=Ws(p,g,b,Ee,E),je=this.collisionIndex.placeCollisionBox(kl(_,Ue.x,Ue.y,L,F,this.transform.angle),ve,B,H,ae.predicate);if(!Fe||this.collisionIndex.placeCollisionBox(kl(Fe,Ue.x,Ue.y,L,F,this.transform.angle),ve,B,H,ae.predicate).box.length!==0)return je.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[be.crossTileID]&&this.prevPlacement.placements[be.crossTileID]&&this.prevPlacement.placements[be.crossTileID].text&&(Xe=this.prevPlacement.variableOffsets[be.crossTileID].anchor),this.variableOffsets[be.crossTileID]={textOffset:Ee,width:g,height:b,anchor:p,textBoxScale:E,prevAnchor:Xe},this.markUsedJustification(Ie,p,be,Oe),Ie.allowVerticalPlacement&&(this.markUsedOrientation(Ie,Oe,be),this.placedOrientations[be.crossTileID]=Oe),{shift:Ue,placedGlyphBoxes:je}):void 0},ao.prototype.placeLayerBucketPart=function(p,_,g){var b=this,E=p.parameters,L=E.bucket,F=E.layout,B=E.posMatrix,H=E.textLabelPlaneMatrix,ae=E.labelToScreenMatrix,ve=E.textPixelRatio,be=E.holdingForFade,Ie=E.collisionBoxArray,Oe=E.partiallyEvaluatedTextSize,Fe=E.collisionGroup,Xe=F.get("text-optional"),Ee=F.get("icon-optional"),Ue=F.get("text-allow-overlap"),je=F.get("icon-allow-overlap"),nt=F.get("text-rotation-alignment")==="map",ut=F.get("text-pitch-alignment")==="map",ot=F.get("icon-text-fit")!=="none",ht=F.get("symbol-z-order")==="viewport-y",vt=Ue&&(je||!L.hasIconData()||Ee),Nt=je&&(Ue||!L.hasTextData()||Xe);!L.collisionArrays&&Ie&&L.deserializeCollisionBoxes(Ie);var Gt=function(rn,On){if(!_[rn.crossTileID])if(be)b.placements[rn.crossTileID]=new Ob(!1,!1,!1);else{var Hn,Fn=!1,Gn=!1,Yn=!0,Ln=null,Tn={box:null,offscreen:null},_s={box:null,offscreen:null},Fr=null,to=null,Ms=0,kr=0,Xr=0;On.textFeatureIndex?Ms=On.textFeatureIndex:rn.useRuntimeCollisionCircles&&(Ms=rn.featureIndex),On.verticalTextFeatureIndex&&(kr=On.verticalTextFeatureIndex);var Wo=On.textBox;if(Wo){var co=function(Gi){var fa=s.WritingMode.horizontal;if(L.allowVerticalPlacement&&!Gi&&b.prevPlacement){var wo=b.prevPlacement.placedOrientations[rn.crossTileID];wo&&(b.placedOrientations[rn.crossTileID]=wo,b.markUsedOrientation(L,fa=wo,rn))}return fa},nc=function(Gi,fa){if(L.allowVerticalPlacement&&rn.numVerticalGlyphVertices>0&&On.verticalTextBox)for(var wo=0,ah=L.writingModes;wo<ah.length&&(ah[wo]===s.WritingMode.vertical?(Tn=fa(),_s=Tn):Tn=Gi(),!(Tn&&Tn.box&&Tn.box.length));wo+=1);else Tn=Gi()};if(F.get("text-variable-anchor")){var Co=F.get("text-variable-anchor");if(b.prevPlacement&&b.prevPlacement.variableOffsets[rn.crossTileID]){var ul=b.prevPlacement.variableOffsets[rn.crossTileID];Co.indexOf(ul.anchor)>0&&(Co=Co.filter((function(Gi){return Gi!==ul.anchor}))).unshift(ul.anchor)}var Ga=function(Gi,fa,wo){for(var ah=Gi.x2-Gi.x1,kA=Gi.y2-Gi.y1,Fg=rn.textBoxScale,LA=ot&&!je?fa:null,Qf={box:[],offscreen:!1},f1=Ue?2*Co.length:Co.length,Cd=0;Cd<f1;++Cd){var Og=b.attemptAnchorPlacement(Co[Cd%Co.length],Gi,ah,kA,Fg,nt,ut,ve,B,Fe,Cd>=Co.length,rn,L,wo,LA);if(Og&&(Qf=Og.placedGlyphBoxes)&&Qf.box&&Qf.box.length){Fn=!0,Ln=Og.shift;break}}return Qf};nc((function(){return Ga(Wo,On.iconBox,s.WritingMode.horizontal)}),(function(){var Gi=On.verticalTextBox;return L.allowVerticalPlacement&&!(Tn&&Tn.box&&Tn.box.length)&&rn.numVerticalGlyphVertices>0&&Gi?Ga(Gi,On.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}})),Tn&&(Fn=Tn.box,Yn=Tn.offscreen);var $f=co(Tn&&Tn.box);if(!Fn&&b.prevPlacement){var xd=b.prevPlacement.variableOffsets[rn.crossTileID];xd&&(b.variableOffsets[rn.crossTileID]=xd,b.markUsedJustification(L,xd.anchor,rn,$f))}}else{var ic=function(Gi,fa){var wo=b.collisionIndex.placeCollisionBox(Gi,Ue,ve,B,Fe.predicate);return wo&&wo.box&&wo.box.length&&(b.markUsedOrientation(L,fa,rn),b.placedOrientations[rn.crossTileID]=fa),wo};nc((function(){return ic(Wo,s.WritingMode.horizontal)}),(function(){var Gi=On.verticalTextBox;return L.allowVerticalPlacement&&rn.numVerticalGlyphVertices>0&&Gi?ic(Gi,s.WritingMode.vertical):{box:null,offscreen:null}})),co(Tn&&Tn.box&&Tn.box.length)}}if(Fn=(Hn=Tn)&&Hn.box&&Hn.box.length>0,Yn=Hn&&Hn.offscreen,rn.useRuntimeCollisionCircles){var Id=L.text.placedSymbolArray.get(rn.centerJustifiedTextSymbolIndex),Jf=s.evaluateSizeForFeature(L.textSizeData,Oe,Id),Fl=F.get("text-padding");Fr=b.collisionIndex.placeCollisionCircles(Ue,Id,L.lineVertexArray,L.glyphOffsetArray,Jf,B,H,ae,g,ut,Fe.predicate,rn.collisionCircleDiameter,Fl),Fn=Ue||Fr.circles.length>0&&!Fr.collisionDetected,Yn=Yn&&Fr.offscreen}if(On.iconFeatureIndex&&(Xr=On.iconFeatureIndex),On.iconBox){var qf=function(Gi){var fa=ot&&Ln?kl(Gi,Ln.x,Ln.y,nt,ut,b.transform.angle):Gi;return b.collisionIndex.placeCollisionBox(fa,je,ve,B,Fe.predicate)};Gn=_s&&_s.box&&_s.box.length&&On.verticalIconBox?(to=qf(On.verticalIconBox)).box.length>0:(to=qf(On.iconBox)).box.length>0,Yn=Yn&&to.offscreen}var Ol=Xe||rn.numHorizontalGlyphVertices===0&&rn.numVerticalGlyphVertices===0,vs=Ee||rn.numIconVertices===0;if(Ol||vs?vs?Ol||(Gn=Gn&&Fn):Fn=Gn&&Fn:Gn=Fn=Gn&&Fn,Fn&&Hn&&Hn.box&&b.collisionIndex.insertCollisionBox(Hn.box,F.get("text-ignore-placement"),L.bucketInstanceId,_s&&_s.box&&kr?kr:Ms,Fe.ID),Gn&&to&&b.collisionIndex.insertCollisionBox(to.box,F.get("icon-ignore-placement"),L.bucketInstanceId,Xr,Fe.ID),Fr&&(Fn&&b.collisionIndex.insertCollisionCircles(Fr.circles,F.get("text-ignore-placement"),L.bucketInstanceId,Ms,Fe.ID),g)){var au=L.bucketInstanceId,rc=b.collisionCircleArrays[au];rc===void 0&&(rc=b.collisionCircleArrays[au]=new Ra);for(var oh=0;oh<Fr.circles.length;oh+=4)rc.circles.push(Fr.circles[oh+0]),rc.circles.push(Fr.circles[oh+1]),rc.circles.push(Fr.circles[oh+2]),rc.circles.push(Fr.collisionDetected?1:0)}b.placements[rn.crossTileID]=new Ob(Fn||vt,Gn||Nt,Yn||L.justReloaded),_[rn.crossTileID]=!0}};if(ht)for(var en=L.getSortedSymbolIndexes(this.transform.angle),vn=en.length-1;vn>=0;--vn){var wn=en[vn];Gt(L.symbolInstances.get(wn),L.collisionArrays[wn])}else for(var Cn=p.symbolInstanceStart;Cn<p.symbolInstanceEnd;Cn++)Gt(L.symbolInstances.get(Cn),L.collisionArrays[Cn]);if(g&&L.bucketInstanceId in this.collisionCircleArrays){var xi=this.collisionCircleArrays[L.bucketInstanceId];s.invert(xi.invProjMatrix,B),xi.viewportMatrix=this.collisionIndex.getViewportMatrix()}L.justReloaded=!1},ao.prototype.markUsedJustification=function(p,_,g,b){var E;E=b===s.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(_)];for(var L=0,F=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];L<F.length;L+=1){var B=F[L];B>=0&&(p.text.placedSymbolArray.get(B).crossTileID=E>=0&&B!==E?0:g.crossTileID)}},ao.prototype.markUsedOrientation=function(p,_,g){for(var b=_===s.WritingMode.horizontal||_===s.WritingMode.horizontalOnly?_:0,E=_===s.WritingMode.vertical?_:0,L=0,F=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];L<F.length;L+=1)p.text.placedSymbolArray.get(F[L]).placedOrientation=b;g.verticalPlacedTextSymbolIndex&&(p.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=E)},ao.prototype.commit=function(p){this.commitTime=p,this.zoomAtLastRecencyCheck=this.transform.zoom;var _=this.prevPlacement,g=!1;this.prevZoomAdjustment=_?_.zoomAdjustment(this.transform.zoom):0;var b=_?_.symbolFadeChange(p):1,E=_?_.opacities:{},L=_?_.variableOffsets:{},F=_?_.placedOrientations:{};for(var B in this.placements){var H=this.placements[B],ae=E[B];ae?(this.opacities[B]=new ca(ae,b,H.text,H.icon),g=g||H.text!==ae.text.placed||H.icon!==ae.icon.placed):(this.opacities[B]=new ca(null,b,H.text,H.icon,H.skipFade),g=g||H.text||H.icon)}for(var ve in E){var be=E[ve];if(!this.opacities[ve]){var Ie=new ca(be,b,!1,!1);Ie.isHidden()||(this.opacities[ve]=Ie,g=g||be.text.placed||be.icon.placed)}}for(var Oe in L)this.variableOffsets[Oe]||!this.opacities[Oe]||this.opacities[Oe].isHidden()||(this.variableOffsets[Oe]=L[Oe]);for(var Fe in F)this.placedOrientations[Fe]||!this.opacities[Fe]||this.opacities[Fe].isHidden()||(this.placedOrientations[Fe]=F[Fe]);g?this.lastPlacementChangeTime=p:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=_?_.lastPlacementChangeTime:p)},ao.prototype.updateLayerOpacities=function(p,_){for(var g={},b=0,E=_;b<E.length;b+=1){var L=E[b],F=L.getBucket(p);F&&L.latestFeatureIndex&&p.id===F.layerIds[0]&&this.updateBucketOpacities(F,g,L.collisionBoxArray)}},ao.prototype.updateBucketOpacities=function(p,_,g){var b=this;p.hasTextData()&&p.text.opacityVertexArray.clear(),p.hasIconData()&&p.icon.opacityVertexArray.clear(),p.hasIconCollisionBoxData()&&p.iconCollisionBox.collisionVertexArray.clear(),p.hasTextCollisionBoxData()&&p.textCollisionBox.collisionVertexArray.clear();var E=p.layers[0].layout,L=new ca(null,0,!1,!1,!0),F=E.get("text-allow-overlap"),B=E.get("icon-allow-overlap"),H=E.get("text-variable-anchor"),ae=E.get("text-rotation-alignment")==="map",ve=E.get("text-pitch-alignment")==="map",be=E.get("icon-text-fit")!=="none",Ie=new ca(null,0,F&&(B||!p.hasIconData()||E.get("icon-optional")),B&&(F||!p.hasTextData()||E.get("text-optional")),!0);!p.collisionArrays&&g&&(p.hasIconCollisionBoxData()||p.hasTextCollisionBoxData())&&p.deserializeCollisionBoxes(g);for(var Oe=function(Ue,je,nt){for(var ut=0;ut<je/4;ut++)Ue.opacityVertexArray.emplaceBack(nt)},Fe=function(Ue){var je=p.symbolInstances.get(Ue),nt=je.numHorizontalGlyphVertices,ut=je.numVerticalGlyphVertices,ot=je.crossTileID,ht=b.opacities[ot];_[ot]?ht=L:ht||(b.opacities[ot]=ht=Ie),_[ot]=!0;var vt=je.numIconVertices>0,Nt=b.placedOrientations[je.crossTileID],Gt=Nt===s.WritingMode.vertical,en=Nt===s.WritingMode.horizontal||Nt===s.WritingMode.horizontalOnly;if(nt>0||ut>0){var vn=Vb(ht.text);Oe(p.text,nt,Gt?cd:vn),Oe(p.text,ut,en?cd:vn);var wn=ht.text.isHidden();[je.rightJustifiedTextSymbolIndex,je.centerJustifiedTextSymbolIndex,je.leftJustifiedTextSymbolIndex].forEach((function(Tn){Tn>=0&&(p.text.placedSymbolArray.get(Tn).hidden=wn||Gt?1:0)})),je.verticalPlacedTextSymbolIndex>=0&&(p.text.placedSymbolArray.get(je.verticalPlacedTextSymbolIndex).hidden=wn||en?1:0);var Cn=b.variableOffsets[je.crossTileID];Cn&&b.markUsedJustification(p,Cn.anchor,je,Nt);var xi=b.placedOrientations[je.crossTileID];xi&&(b.markUsedJustification(p,"left",je,xi),b.markUsedOrientation(p,xi,je))}if(vt){var rn=Vb(ht.icon),On=!(be&&je.verticalPlacedIconSymbolIndex&&Gt);je.placedIconSymbolIndex>=0&&(Oe(p.icon,je.numIconVertices,On?rn:cd),p.icon.placedSymbolArray.get(je.placedIconSymbolIndex).hidden=ht.icon.isHidden()),je.verticalPlacedIconSymbolIndex>=0&&(Oe(p.icon,je.numVerticalIconVertices,On?cd:rn),p.icon.placedSymbolArray.get(je.verticalPlacedIconSymbolIndex).hidden=ht.icon.isHidden())}if(p.hasIconCollisionBoxData()||p.hasTextCollisionBoxData()){var Hn=p.collisionArrays[Ue];if(Hn){var Fn=new s.Point(0,0);if(Hn.textBox||Hn.verticalTextBox){var Gn=!0;if(H){var Yn=b.variableOffsets[ot];Yn?(Fn=Ws(Yn.anchor,Yn.width,Yn.height,Yn.textOffset,Yn.textBoxScale),ae&&Fn._rotate(ve?b.transform.angle:-b.transform.angle)):Gn=!1}Hn.textBox&&zc(p.textCollisionBox.collisionVertexArray,ht.text.placed,!Gn||Gt,Fn.x,Fn.y),Hn.verticalTextBox&&zc(p.textCollisionBox.collisionVertexArray,ht.text.placed,!Gn||en,Fn.x,Fn.y)}var Ln=!!(!en&&Hn.verticalIconBox);Hn.iconBox&&zc(p.iconCollisionBox.collisionVertexArray,ht.icon.placed,Ln,be?Fn.x:0,be?Fn.y:0),Hn.verticalIconBox&&zc(p.iconCollisionBox.collisionVertexArray,ht.icon.placed,!Ln,be?Fn.x:0,be?Fn.y:0)}}},Xe=0;Xe<p.symbolInstances.length;Xe++)Fe(Xe);if(p.sortFeatures(this.transform.angle),this.retainedQueryData[p.bucketInstanceId]&&(this.retainedQueryData[p.bucketInstanceId].featureSortOrder=p.featureSortOrder),p.hasTextData()&&p.text.opacityVertexBuffer&&p.text.opacityVertexBuffer.updateData(p.text.opacityVertexArray),p.hasIconData()&&p.icon.opacityVertexBuffer&&p.icon.opacityVertexBuffer.updateData(p.icon.opacityVertexArray),p.hasIconCollisionBoxData()&&p.iconCollisionBox.collisionVertexBuffer&&p.iconCollisionBox.collisionVertexBuffer.updateData(p.iconCollisionBox.collisionVertexArray),p.hasTextCollisionBoxData()&&p.textCollisionBox.collisionVertexBuffer&&p.textCollisionBox.collisionVertexBuffer.updateData(p.textCollisionBox.collisionVertexArray),p.bucketInstanceId in this.collisionCircleArrays){var Ee=this.collisionCircleArrays[p.bucketInstanceId];p.placementInvProjMatrix=Ee.invProjMatrix,p.placementViewportMatrix=Ee.viewportMatrix,p.collisionCircleArray=Ee.circles,delete this.collisionCircleArrays[p.bucketInstanceId]}},ao.prototype.symbolFadeChange=function(p){return this.fadeDuration===0?1:(p-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},ao.prototype.zoomAdjustment=function(p){return Math.max(0,(this.transform.zoom-p)/1.5)},ao.prototype.hasTransitions=function(p){return this.stale||p-this.lastPlacementChangeTime<this.fadeDuration},ao.prototype.stillRecent=function(p,_){var g=this.zoomAtLastRecencyCheck===_?1-this.zoomAdjustment(_):1;return this.zoomAtLastRecencyCheck=_,this.commitTime+this.fadeDuration*g>p},ao.prototype.setStale=function(){this.stale=!0};var _A=Math.pow(2,25),vA=Math.pow(2,24),qy=Math.pow(2,17),bA=Math.pow(2,16),Nb=Math.pow(2,9),xA=Math.pow(2,8),Db=Math.pow(2,1);function Vb(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;var _=p.placed?1:0,g=Math.floor(127*p.opacity);return g*_A+_*vA+g*qy+_*bA+g*Nb+_*xA+g*Db+_}var cd=0,Qy=function(p){this._sortAcrossTiles=p.layout.get("symbol-z-order")!=="viewport-y"&&p.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Qy.prototype.continuePlacement=function(p,_,g,b,E){for(var L=this._bucketParts;this._currentTileIndex<p.length;)if(_.getBucketParts(L,b,p[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,L.sort((function(F,B){return F.sortKey-B.sortKey})));this._currentPartIndex<L.length;)if(_.placeLayerBucketPart(L[this._currentPartIndex],this._seenCrossTileIDs,g),this._currentPartIndex++,E())return!0;return!1};var Pf=function(p,_,g,b,E,L,F){this.placement=new ao(p,E,L,F),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=b,this._done=!1};Pf.prototype.isDone=function(){return this._done},Pf.prototype.continuePlacement=function(p,_,g){for(var b=this,E=s.browser.now(),L=function(){var H=s.browser.now()-E;return!b._forceFullPlacement&&H>2};this._currentPlacementIndex>=0;){var F=_[p[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(F.type==="symbol"&&(!F.minzoom||F.minzoom<=B)&&(!F.maxzoom||F.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new Qy(F)),this._inProgressLayer.continuePlacement(g[F.source],this.placement,this._showCollisionBoxes,F,L))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Pf.prototype.commit=function(p){return this.placement.commit(p),this.placement};var Bb=512/s.EXTENT/2,gg=function(p,_,g){this.tileID=p,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(var b=0;b<_.length;b++){var E=_.get(b),L=E.key;this.indexedSymbolInstances[L]||(this.indexedSymbolInstances[L]=[]),this.indexedSymbolInstances[L].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,p)})}};gg.prototype.getScaledCoordinates=function(p,_){var g=Bb/Math.pow(2,_.canonical.z-this.tileID.canonical.z);return{x:Math.floor((_.canonical.x*s.EXTENT+p.anchorX)*g),y:Math.floor((_.canonical.y*s.EXTENT+p.anchorY)*g)}},gg.prototype.findMatches=function(p,_,g){for(var b=this.tileID.canonical.z<_.canonical.z?1:Math.pow(2,this.tileID.canonical.z-_.canonical.z),E=0;E<p.length;E++){var L=p.get(E);if(!L.crossTileID){var F=this.indexedSymbolInstances[L.key];if(F)for(var B=this.getScaledCoordinates(L,_),H=0,ae=F;H<ae.length;H+=1){var ve=ae[H];if(Math.abs(ve.coord.x-B.x)<=b&&Math.abs(ve.coord.y-B.y)<=b&&!g[ve.crossTileID]){g[ve.crossTileID]=!0,L.crossTileID=ve.crossTileID;break}}}}};var Ma=function(){this.maxCrossTileID=0};Ma.prototype.generate=function(){return++this.maxCrossTileID};var Wu=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Wu.prototype.handleWrapJump=function(p){var _=Math.round((p-this.lng)/360);if(_!==0)for(var g in this.indexes){var b=this.indexes[g],E={};for(var L in b){var F=b[L];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+_),E[F.tileID.key]=F}this.indexes[g]=E}this.lng=p},Wu.prototype.addBucket=function(p,_,g){if(this.indexes[p.overscaledZ]&&this.indexes[p.overscaledZ][p.key]){if(this.indexes[p.overscaledZ][p.key].bucketInstanceId===_.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(p.overscaledZ,this.indexes[p.overscaledZ][p.key])}for(var b=0;b<_.symbolInstances.length;b++)_.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[p.overscaledZ]||(this.usedCrossTileIDs[p.overscaledZ]={});var E=this.usedCrossTileIDs[p.overscaledZ];for(var L in this.indexes){var F=this.indexes[L];if(Number(L)>p.overscaledZ)for(var B in F){var H=F[B];H.tileID.isChildOf(p)&&H.findMatches(_.symbolInstances,p,E)}else{var ae=F[p.scaledTo(Number(L)).key];ae&&ae.findMatches(_.symbolInstances,p,E)}}for(var ve=0;ve<_.symbolInstances.length;ve++){var be=_.symbolInstances.get(ve);be.crossTileID||(be.crossTileID=g.generate(),E[be.crossTileID]=!0)}return this.indexes[p.overscaledZ]===void 0&&(this.indexes[p.overscaledZ]={}),this.indexes[p.overscaledZ][p.key]=new gg(p,_.symbolInstances,_.bucketInstanceId),!0},Wu.prototype.removeBucketCrossTileIDs=function(p,_){for(var g in _.indexedSymbolInstances)for(var b=0,E=_.indexedSymbolInstances[g];b<E.length;b+=1)delete this.usedCrossTileIDs[p][E[b].crossTileID]},Wu.prototype.removeStaleBuckets=function(p){var _=!1;for(var g in this.indexes){var b=this.indexes[g];for(var E in b)p[b[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,b[E]),delete b[E],_=!0)}return _};var zu=function(){this.layerIndexes={},this.crossTileIDs=new Ma,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};zu.prototype.addLayer=function(p,_,g){var b=this.layerIndexes[p.id];b===void 0&&(b=this.layerIndexes[p.id]=new Wu);var E=!1,L={};b.handleWrapJump(g);for(var F=0,B=_;F<B.length;F+=1){var H=B[F],ae=H.getBucket(p);ae&&p.id===ae.layerIds[0]&&(ae.bucketInstanceId||(ae.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(H.tileID,ae,this.crossTileIDs)&&(E=!0),L[ae.bucketInstanceId]=!0)}return b.removeStaleBuckets(L)&&(E=!0),E},zu.prototype.pruneUnusedLayers=function(p){var _={};for(var g in p.forEach((function(b){_[b]=!0})),this.layerIndexes)_[g]||delete this.layerIndexes[g]};var Uc=function(p,_){return s.emitValidationErrors(p,_&&_.filter((function(g){return g.identifier!=="source.canvas"})))},Uu=s.pick(Yt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Xu=s.pick(Yt,["setCenter","setZoom","setBearing","setPitch"]),mg=(function(){var p={},_=s.styleSpec.$version;for(var g in s.styleSpec.$root){var b,E=s.styleSpec.$root[g];E.required&&(b=g==="version"?_:E.type==="array"?[]:{})!=null&&(p[g]=b)}return p})(),Oo=(function(p){function _(g,b){var E=this;b===void 0&&(b={}),p.call(this),this.map=g,this.dispatcher=new D(pt(),this),this.imageManager=new M,this.imageManager.setEventedParent(this),this.glyphManager=new te(g._requestManager,b.localIdeographFontFamily),this.lineAtlas=new he(256,512),this.crossTileSymbolIndex=new zu,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());var L=this;this._rtlTextPluginCallback=_.registerForPluginStateChange((function(F){L.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:F.pluginStatus,pluginURL:F.pluginURL},(function(B,H){if(s.triggerPluginCompletionEvent(B),H&&H.every((function(ve){return ve})))for(var ae in L.sourceCaches)L.sourceCaches[ae].reload()}))})),this.on("data",(function(F){if(F.dataType==="source"&&F.sourceDataType==="metadata"){var B=E.sourceCaches[F.sourceId];if(B){var H=B.getSource();if(H&&H.vectorLayerIds)for(var ae in E._layers){var ve=E._layers[ae];ve.source===H.id&&E._validateLayer(ve)}}}}))}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.loadURL=function(g,b){var E=this;b===void 0&&(b={}),this.fire(new s.Event("dataloading",{dataType:"style"}));var L=typeof b.validate=="boolean"?b.validate:!s.isMapboxURL(g);g=this.map._requestManager.normalizeStyleURL(g,b.accessToken);var F=this.map._requestManager.transformRequest(g,s.ResourceType.Style);this._request=s.getJSON(F,(function(B,H){E._request=null,B?E.fire(new s.ErrorEvent(B)):H&&E._load(H,L)}))},_.prototype.loadJSON=function(g,b){var E=this;b===void 0&&(b={}),this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.browser.frame((function(){E._request=null,E._load(g,b.validate!==!1)}))},_.prototype.loadEmpty=function(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(mg,!1)},_.prototype._load=function(g,b){if(!b||!Uc(this,s.validateStyle(g))){for(var E in this._loaded=!0,this.stylesheet=g,g.sources)this.addSource(E,g.sources[E],{validate:!1});g.sprite?this._loadSprite(g.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(g.glyphs);var L=Ut(this.stylesheet.layers);this._order=L.map((function(ae){return ae.id})),this._layers={},this._serializedLayers={};for(var F=0,B=L;F<B.length;F+=1){var H=B[F];(H=s.createStyleLayer(H)).setEventedParent(this,{layer:{id:H.id}}),this._layers[H.id]=H,this._serializedLayers[H.id]=H.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Y(this.stylesheet.light),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}},_.prototype._loadSprite=function(g){var b=this;this._spriteRequest=(function(E,L,F){var B,H,ae,ve=s.browser.devicePixelRatio>1?"@2x":"",be=s.getJSON(L.transformRequest(L.normalizeSpriteURL(E,ve,".json"),s.ResourceType.SpriteJSON),(function(Fe,Xe){be=null,ae||(ae=Fe,B=Xe,Oe())})),Ie=s.getImage(L.transformRequest(L.normalizeSpriteURL(E,ve,".png"),s.ResourceType.SpriteImage),(function(Fe,Xe){Ie=null,ae||(ae=Fe,H=Xe,Oe())}));function Oe(){if(ae)F(ae);else if(B&&H){var Fe=s.browser.getImageData(H),Xe={};for(var Ee in B){var Ue=B[Ee],je=Ue.width,nt=Ue.height,ut=Ue.x,ot=Ue.y,ht=Ue.sdf,vt=Ue.pixelRatio,Nt=Ue.stretchX,Gt=Ue.stretchY,en=Ue.content,vn=new s.RGBAImage({width:je,height:nt});s.RGBAImage.copy(Fe,vn,{x:ut,y:ot},{x:0,y:0},{width:je,height:nt}),Xe[Ee]={data:vn,pixelRatio:vt,sdf:ht,stretchX:Nt,stretchY:Gt,content:en}}F(null,Xe)}}return{cancel:function(){be&&(be.cancel(),be=null),Ie&&(Ie.cancel(),Ie=null)}}})(g,this.map._requestManager,(function(E,L){if(b._spriteRequest=null,E)b.fire(new s.ErrorEvent(E));else if(L)for(var F in L)b.imageManager.addImage(F,L[F]);b.imageManager.setLoaded(!0),b._availableImages=b.imageManager.listImages(),b.dispatcher.broadcast("setImages",b._availableImages),b.fire(new s.Event("data",{dataType:"style"}))}))},_.prototype._validateLayer=function(g){var b=this.sourceCaches[g.source];if(b){var E=g.sourceLayer;if(E){var L=b.getSource();(L.type==="geojson"||L.vectorLayerIds&&L.vectorLayerIds.indexOf(E)===-1)&&this.fire(new s.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+L.id+'" as specified by style layer "'+g.id+'"')))}}},_.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var g in this.sourceCaches)if(!this.sourceCaches[g].loaded())return!1;return!!this.imageManager.isLoaded()},_.prototype._serializeLayers=function(g){for(var b=[],E=0,L=g;E<L.length;E+=1){var F=this._layers[L[E]];F.type!=="custom"&&b.push(F.serialize())}return b},_.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var g in this.sourceCaches)if(this.sourceCaches[g].hasTransition())return!0;for(var b in this._layers)if(this._layers[b].hasTransition())return!0;return!1},_.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},_.prototype.update=function(g){if(this._loaded){var b=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),L=Object.keys(this._removedLayers);for(var F in(E.length||L.length)&&this._updateWorkerLayers(E,L),this._updatedSources){var B=this._updatedSources[F];B==="reload"?this._reloadSource(F):B==="clear"&&this._clearSource(F)}for(var H in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[H].updateTransitions(g);this.light.updateTransitions(g),this._resetUpdates()}var ae={};for(var ve in this.sourceCaches){var be=this.sourceCaches[ve];ae[ve]=be.used,be.used=!1}for(var Ie=0,Oe=this._order;Ie<Oe.length;Ie+=1){var Fe=this._layers[Oe[Ie]];Fe.recalculate(g,this._availableImages),!Fe.isHidden(g.zoom)&&Fe.source&&(this.sourceCaches[Fe.source].used=!0)}for(var Xe in ae){var Ee=this.sourceCaches[Xe];ae[Xe]!==Ee.used&&Ee.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Xe}))}this.light.recalculate(g),this.z=g.zoom,b&&this.fire(new s.Event("data",{dataType:"style"}))}},_.prototype._updateTilesForChangedImages=function(){var g=Object.keys(this._changedImages);if(g.length){for(var b in this.sourceCaches)this.sourceCaches[b].reloadTilesForDependencies(["icons","patterns"],g);this._changedImages={}}},_.prototype._updateWorkerLayers=function(g,b){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(g),removedIds:b})},_.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},_.prototype.setState=function(g){var b=this;if(this._checkLoaded(),Uc(this,s.validateStyle(g)))return!1;(g=s.clone$1(g)).layers=Ut(g.layers);var E=(function(F,B){if(!F)return[{command:Yt.setStyle,args:[B]}];var H=[];try{if(!s.deepEqual(F.version,B.version))return[{command:Yt.setStyle,args:[B]}];s.deepEqual(F.center,B.center)||H.push({command:Yt.setCenter,args:[B.center]}),s.deepEqual(F.zoom,B.zoom)||H.push({command:Yt.setZoom,args:[B.zoom]}),s.deepEqual(F.bearing,B.bearing)||H.push({command:Yt.setBearing,args:[B.bearing]}),s.deepEqual(F.pitch,B.pitch)||H.push({command:Yt.setPitch,args:[B.pitch]}),s.deepEqual(F.sprite,B.sprite)||H.push({command:Yt.setSprite,args:[B.sprite]}),s.deepEqual(F.glyphs,B.glyphs)||H.push({command:Yt.setGlyphs,args:[B.glyphs]}),s.deepEqual(F.transition,B.transition)||H.push({command:Yt.setTransition,args:[B.transition]}),s.deepEqual(F.light,B.light)||H.push({command:Yt.setLight,args:[B.light]});var ae={},ve=[];(function(Ie,Oe,Fe,Xe){var Ee;for(Ee in Oe=Oe||{},Ie=Ie||{})Ie.hasOwnProperty(Ee)&&(Oe.hasOwnProperty(Ee)||Re(Ee,Fe,Xe));for(Ee in Oe)Oe.hasOwnProperty(Ee)&&(Ie.hasOwnProperty(Ee)?s.deepEqual(Ie[Ee],Oe[Ee])||(Ie[Ee].type==="geojson"&&Oe[Ee].type==="geojson"&&Kt(Ie,Oe,Ee)?Fe.push({command:Yt.setGeoJSONSourceData,args:[Ee,Oe[Ee].data]}):_t(Ee,Oe,Fe,Xe)):Ot(Ee,Oe,Fe))})(F.sources,B.sources,ve,ae);var be=[];F.layers&&F.layers.forEach((function(Ie){ae[Ie.source]?H.push({command:Yt.removeLayer,args:[Ie.id]}):be.push(Ie)})),H=H.concat(ve),(function(Ie,Oe,Fe){Oe=Oe||[];var Xe,Ee,Ue,je,nt,ut,ot,ht=(Ie=Ie||[]).map(Bn),vt=Oe.map(Bn),Nt=Ie.reduce(En,{}),Gt=Oe.reduce(En,{}),en=ht.slice(),vn=Object.create(null);for(Xe=0,Ee=0;Xe<ht.length;Xe++)Gt.hasOwnProperty(Ue=ht[Xe])?Ee++:(Fe.push({command:Yt.removeLayer,args:[Ue]}),en.splice(en.indexOf(Ue,Ee),1));for(Xe=0,Ee=0;Xe<vt.length;Xe++)en[en.length-1-Xe]!==(Ue=vt[vt.length-1-Xe])&&(Nt.hasOwnProperty(Ue)?(Fe.push({command:Yt.removeLayer,args:[Ue]}),en.splice(en.lastIndexOf(Ue,en.length-Ee),1)):Ee++,Fe.push({command:Yt.addLayer,args:[Gt[Ue],ut=en[en.length-Xe]]}),en.splice(en.length-Xe,0,Ue),vn[Ue]=!0);for(Xe=0;Xe<vt.length;Xe++)if(je=Nt[Ue=vt[Xe]],nt=Gt[Ue],!vn[Ue]&&!s.deepEqual(je,nt))if(s.deepEqual(je.source,nt.source)&&s.deepEqual(je["source-layer"],nt["source-layer"])&&s.deepEqual(je.type,nt.type)){for(ot in mn(je.layout,nt.layout,Fe,Ue,null,Yt.setLayoutProperty),mn(je.paint,nt.paint,Fe,Ue,null,Yt.setPaintProperty),s.deepEqual(je.filter,nt.filter)||Fe.push({command:Yt.setFilter,args:[Ue,nt.filter]}),s.deepEqual(je.minzoom,nt.minzoom)&&s.deepEqual(je.maxzoom,nt.maxzoom)||Fe.push({command:Yt.setLayerZoomRange,args:[Ue,nt.minzoom,nt.maxzoom]}),je)je.hasOwnProperty(ot)&&ot!=="layout"&&ot!=="paint"&&ot!=="filter"&&ot!=="metadata"&&ot!=="minzoom"&&ot!=="maxzoom"&&(ot.indexOf("paint.")===0?mn(je[ot],nt[ot],Fe,Ue,ot.slice(6),Yt.setPaintProperty):s.deepEqual(je[ot],nt[ot])||Fe.push({command:Yt.setLayerProperty,args:[Ue,ot,nt[ot]]}));for(ot in nt)nt.hasOwnProperty(ot)&&!je.hasOwnProperty(ot)&&ot!=="layout"&&ot!=="paint"&&ot!=="filter"&&ot!=="metadata"&&ot!=="minzoom"&&ot!=="maxzoom"&&(ot.indexOf("paint.")===0?mn(je[ot],nt[ot],Fe,Ue,ot.slice(6),Yt.setPaintProperty):s.deepEqual(je[ot],nt[ot])||Fe.push({command:Yt.setLayerProperty,args:[Ue,ot,nt[ot]]}))}else Fe.push({command:Yt.removeLayer,args:[Ue]}),ut=en[en.lastIndexOf(Ue)+1],Fe.push({command:Yt.addLayer,args:[nt,ut]})})(be,B.layers,H)}catch(Ie){console.warn("Unable to compute style diff:",Ie),H=[{command:Yt.setStyle,args:[B]}]}return H})(this.serialize(),g).filter((function(F){return!(F.command in Xu)}));if(E.length===0)return!1;var L=E.filter((function(F){return!(F.command in Uu)}));if(L.length>0)throw new Error("Unimplemented: "+L.map((function(F){return F.command})).join(", ")+".");return E.forEach((function(F){F.command!=="setTransition"&&b[F.command].apply(b,F.args)})),this.stylesheet=g,!0},_.prototype.addImage=function(g,b){if(this.getImage(g))return this.fire(new s.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(g,b),this._afterImageUpdated(g)},_.prototype.updateImage=function(g,b){this.imageManager.updateImage(g,b)},_.prototype.getImage=function(g){return this.imageManager.getImage(g)},_.prototype.removeImage=function(g){if(!this.getImage(g))return this.fire(new s.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(g),this._afterImageUpdated(g)},_.prototype._afterImageUpdated=function(g){this._availableImages=this.imageManager.listImages(),this._changedImages[g]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))},_.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},_.prototype.addSource=function(g,b,E){var L=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[g]!==void 0)throw new Error("There is already a source with this ID");if(!b.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(b).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(b.type)>=0&&this._validate(s.validateStyle.source,"sources."+g,b,null,E))){this.map&&this.map._collectResourceTiming&&(b.collectResourceTiming=!0);var F=this.sourceCaches[g]=new Se(g,b,this.dispatcher);F.style=this,F.setEventedParent(this,(function(){return{isSourceLoaded:L.loaded(),source:F.serialize(),sourceId:g}})),F.onAdd(this.map),this._changed=!0}},_.prototype.removeSource=function(g){if(this._checkLoaded(),this.sourceCaches[g]===void 0)throw new Error("There is no source with this ID");for(var b in this._layers)if(this._layers[b].source===g)return this.fire(new s.ErrorEvent(new Error('Source "'+g+'" cannot be removed while layer "'+b+'" is using it.')));var E=this.sourceCaches[g];delete this.sourceCaches[g],delete this._updatedSources[g],E.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},_.prototype.setGeoJSONSourceData=function(g,b){this._checkLoaded(),this.sourceCaches[g].getSource().setData(b),this._changed=!0},_.prototype.getSource=function(g){return this.sourceCaches[g]&&this.sourceCaches[g].getSource()},_.prototype.addLayer=function(g,b,E){E===void 0&&(E={}),this._checkLoaded();var L=g.id;if(this.getLayer(L))this.fire(new s.ErrorEvent(new Error('Layer with id "'+L+'" already exists on this map')));else{var F;if(g.type==="custom"){if(Uc(this,s.validateCustomStyleLayer(g)))return;F=s.createStyleLayer(g)}else{if(typeof g.source=="object"&&(this.addSource(L,g.source),g=s.clone$1(g),g=s.extend(g,{source:L})),this._validate(s.validateStyle.layer,"layers."+L,g,{arrayIndex:-1},E))return;F=s.createStyleLayer(g),this._validateLayer(F),F.setEventedParent(this,{layer:{id:L}}),this._serializedLayers[F.id]=F.serialize()}var B=b?this._order.indexOf(b):this._order.length;if(b&&B===-1)this.fire(new s.ErrorEvent(new Error('Layer with id "'+b+'" does not exist on this map.')));else{if(this._order.splice(B,0,L),this._layerOrderChanged=!0,this._layers[L]=F,this._removedLayers[L]&&F.source&&F.type!=="custom"){var H=this._removedLayers[L];delete this._removedLayers[L],H.type!==F.type?this._updatedSources[F.source]="clear":(this._updatedSources[F.source]="reload",this.sourceCaches[F.source].pause())}this._updateLayer(F),F.onAdd&&F.onAdd(this.map)}}},_.prototype.moveLayer=function(g,b){if(this._checkLoaded(),this._changed=!0,this._layers[g]){if(g!==b){var E=this._order.indexOf(g);this._order.splice(E,1);var L=b?this._order.indexOf(b):this._order.length;b&&L===-1?this.fire(new s.ErrorEvent(new Error('Layer with id "'+b+'" does not exist on this map.'))):(this._order.splice(L,0,g),this._layerOrderChanged=!0)}}else this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be moved.")))},_.prototype.removeLayer=function(g){this._checkLoaded();var b=this._layers[g];if(b){b.setEventedParent(null);var E=this._order.indexOf(g);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[g]=b,delete this._layers[g],delete this._serializedLayers[g],delete this._updatedLayers[g],delete this._updatedPaintProps[g],b.onRemove&&b.onRemove(this.map)}else this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be removed.")))},_.prototype.getLayer=function(g){return this._layers[g]},_.prototype.hasLayer=function(g){return g in this._layers},_.prototype.setLayerZoomRange=function(g,b,E){this._checkLoaded();var L=this.getLayer(g);L?L.minzoom===b&&L.maxzoom===E||(b!=null&&(L.minzoom=b),E!=null&&(L.maxzoom=E),this._updateLayer(L)):this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot have zoom extent.")))},_.prototype.setFilter=function(g,b,E){E===void 0&&(E={}),this._checkLoaded();var L=this.getLayer(g);if(L){if(!s.deepEqual(L.filter,b))return b==null?(L.filter=void 0,void this._updateLayer(L)):void(this._validate(s.validateStyle.filter,"layers."+L.id+".filter",b,null,E)||(L.filter=s.clone$1(b),this._updateLayer(L)))}else this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be filtered.")))},_.prototype.getFilter=function(g){return s.clone$1(this.getLayer(g).filter)},_.prototype.setLayoutProperty=function(g,b,E,L){L===void 0&&(L={}),this._checkLoaded();var F=this.getLayer(g);F?s.deepEqual(F.getLayoutProperty(b),E)||(F.setLayoutProperty(b,E,L),this._updateLayer(F)):this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be styled.")))},_.prototype.getLayoutProperty=function(g,b){var E=this.getLayer(g);if(E)return E.getLayoutProperty(b);this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style.")))},_.prototype.setPaintProperty=function(g,b,E,L){L===void 0&&(L={}),this._checkLoaded();var F=this.getLayer(g);F?s.deepEqual(F.getPaintProperty(b),E)||(F.setPaintProperty(b,E,L)&&this._updateLayer(F),this._changed=!0,this._updatedPaintProps[g]=!0):this.fire(new s.ErrorEvent(new Error("The layer '"+g+"' does not exist in the map's style and cannot be styled.")))},_.prototype.getPaintProperty=function(g,b){return this.getLayer(g).getPaintProperty(b)},_.prototype.setFeatureState=function(g,b){this._checkLoaded();var E=g.source,L=g.sourceLayer,F=this.sourceCaches[E];if(F!==void 0){var B=F.getSource().type;B==="geojson"&&L?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):B!=="vector"||L?(g.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),F.setFeatureState(L,g.id,b)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},_.prototype.removeFeatureState=function(g,b){this._checkLoaded();var E=g.source,L=this.sourceCaches[E];if(L!==void 0){var F=L.getSource().type,B=F==="vector"?g.sourceLayer:void 0;F!=="vector"||B?b&&typeof g.id!="string"&&typeof g.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):L.removeFeatureState(B,g.id,b):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},_.prototype.getFeatureState=function(g){this._checkLoaded();var b=g.source,E=g.sourceLayer,L=this.sourceCaches[b];if(L!==void 0){if(L.getSource().type!=="vector"||E)return g.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),L.getFeatureState(E,g.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},_.prototype.getTransition=function(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},_.prototype.serialize=function(){return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s.mapObject(this.sourceCaches,(function(g){return g.serialize()})),layers:this._serializeLayers(this._order)},(function(g){return g!==void 0}))},_.prototype._updateLayer=function(g){this._updatedLayers[g.id]=!0,g.source&&!this._updatedSources[g.source]&&this.sourceCaches[g.source].getSource().type!=="raster"&&(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause()),this._changed=!0},_.prototype._flattenAndSortRenderedFeatures=function(g){for(var b=this,E=function(Nt){return b._layers[Nt].type==="fill-extrusion"},L={},F=[],B=this._order.length-1;B>=0;B--){var H=this._order[B];if(E(H)){L[H]=B;for(var ae=0,ve=g;ae<ve.length;ae+=1){var be=ve[ae][H];if(be)for(var Ie=0,Oe=be;Ie<Oe.length;Ie+=1)F.push(Oe[Ie])}}}F.sort((function(Nt,Gt){return Gt.intersectionZ-Nt.intersectionZ}));for(var Fe=[],Xe=this._order.length-1;Xe>=0;Xe--){var Ee=this._order[Xe];if(E(Ee))for(var Ue=F.length-1;Ue>=0;Ue--){var je=F[Ue].feature;if(L[je.layer.id]<Xe)break;Fe.push(je),F.pop()}else for(var nt=0,ut=g;nt<ut.length;nt+=1){var ot=ut[nt][Ee];if(ot)for(var ht=0,vt=ot;ht<vt.length;ht+=1)Fe.push(vt[ht].feature)}}return Fe},_.prototype.queryRenderedFeatures=function(g,b,E){b&&b.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",b.filter,null,b);var L={};if(b&&b.layers){if(!Array.isArray(b.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var F=0,B=b.layers;F<B.length;F+=1){var H=B[F],ae=this._layers[H];if(!ae)return this.fire(new s.ErrorEvent(new Error("The layer '"+H+"' does not exist in the map's style and cannot be queried for features."))),[];L[ae.source]=!0}}var ve=[];for(var be in b.availableImages=this._availableImages,this.sourceCaches)b.layers&&!L[be]||ve.push(Pt(this.sourceCaches[be],this._layers,this._serializedLayers,g,b,E));return this.placement&&ve.push((function(Ie,Oe,Fe,Xe,Ee,Ue,je){for(var nt={},ut=Ue.queryRenderedSymbols(Xe),ot=[],ht=0,vt=Object.keys(ut).map(Number);ht<vt.length;ht+=1)ot.push(je[vt[ht]]);ot.sort(zt);for(var Nt=function(){var Cn=en[Gt],xi=Cn.featureIndex.lookupSymbolFeatures(ut[Cn.bucketInstanceId],Oe,Cn.bucketIndex,Cn.sourceLayerIndex,Ee.filter,Ee.layers,Ee.availableImages,Ie);for(var rn in xi){var On=nt[rn]=nt[rn]||[],Hn=xi[rn];Hn.sort((function(Yn,Ln){var Tn=Cn.featureSortOrder;if(Tn){var _s=Tn.indexOf(Yn.featureIndex);return Tn.indexOf(Ln.featureIndex)-_s}return Ln.featureIndex-Yn.featureIndex}));for(var Fn=0,Gn=Hn;Fn<Gn.length;Fn+=1)On.push(Gn[Fn])}},Gt=0,en=ot;Gt<en.length;Gt+=1)Nt();var vn=function(Cn){nt[Cn].forEach((function(xi){var rn=xi.feature,On=Fe[Ie[Cn].source].getFeatureState(rn.layer["source-layer"],rn.id);rn.source=rn.layer.source,rn.layer["source-layer"]&&(rn.sourceLayer=rn.layer["source-layer"]),rn.state=On}))};for(var wn in nt)vn(wn);return nt})(this._layers,this._serializedLayers,this.sourceCaches,g,b,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ve)},_.prototype.querySourceFeatures=function(g,b){b&&b.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",b.filter,null,b);var E=this.sourceCaches[g];return E?(function(L,F){for(var B=L.getRenderableIds().map((function(Oe){return L.getTileByID(Oe)})),H=[],ae={},ve=0;ve<B.length;ve++){var be=B[ve],Ie=be.tileID.canonical.key;ae[Ie]||(ae[Ie]=!0,be.querySourceFeatures(H,F))}return H})(E,b):[]},_.prototype.addSourceType=function(g,b,E){return _.getSourceType(g)?E(new Error('A source type called "'+g+'" already exists.')):(_.setSourceType(g,b),b.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:g,url:b.workerSourceURL},E):E(null,null))},_.prototype.getLight=function(){return this.light.getLight()},_.prototype.setLight=function(g,b){b===void 0&&(b={}),this._checkLoaded();var E=this.light.getLight(),L=!1;for(var F in g)if(!s.deepEqual(g[F],E[F])){L=!0;break}if(L){var B={now:s.browser.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(g,b),this.light.updateTransitions(B)}},_.prototype._validate=function(g,b,E,L,F){return F===void 0&&(F={}),(!F||F.validate!==!1)&&Uc(this,g.call(s.validateStyle,s.extend({key:b,style:this.serialize(),value:E,styleSpec:s.styleSpec},L)))},_.prototype._remove=function(){for(var g in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[g].setEventedParent(null);for(var b in this.sourceCaches)this.sourceCaches[b].clearTiles(),this.sourceCaches[b].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},_.prototype._clearSource=function(g){this.sourceCaches[g].clearTiles()},_.prototype._reloadSource=function(g){this.sourceCaches[g].resume(),this.sourceCaches[g].reload()},_.prototype._updateSources=function(g){for(var b in this.sourceCaches)this.sourceCaches[b].update(g)},_.prototype._generateCollisionBoxes=function(){for(var g in this.sourceCaches)this._reloadSource(g)},_.prototype._updatePlacement=function(g,b,E,L,F){F===void 0&&(F=!1);for(var B=!1,H=!1,ae={},ve=0,be=this._order;ve<be.length;ve+=1){var Ie=this._layers[be[ve]];if(Ie.type==="symbol"){if(!ae[Ie.source]){var Oe=this.sourceCaches[Ie.source];ae[Ie.source]=Oe.getRenderableIds(!0).map((function(je){return Oe.getTileByID(je)})).sort((function(je,nt){return nt.tileID.overscaledZ-je.tileID.overscaledZ||(je.tileID.isLessThan(nt.tileID)?-1:1)}))}var Fe=this.crossTileSymbolIndex.addLayer(Ie,ae[Ie.source],g.center.lng);B=B||Fe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((F=F||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.browser.now(),g.zoom))&&(this.pauseablePlacement=new Pf(g,this._order,F,b,E,L,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ae),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.browser.now()),H=!0),B&&this.pauseablePlacement.placement.setStale()),H||B)for(var Xe=0,Ee=this._order;Xe<Ee.length;Xe+=1){var Ue=this._layers[Ee[Xe]];Ue.type==="symbol"&&this.placement.updateLayerOpacities(Ue,ae[Ue.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.browser.now())},_.prototype._releaseSymbolFadeTiles=function(){for(var g in this.sourceCaches)this.sourceCaches[g].releaseSymbolFadeTiles()},_.prototype.getImages=function(g,b,E){this.imageManager.getImages(b.icons,E),this._updateTilesForChangedImages();var L=this.sourceCaches[b.source];L&&L.setDependencies(b.tileID.key,b.type,b.icons)},_.prototype.getGlyphs=function(g,b,E){this.glyphManager.getGlyphs(b.stacks,E)},_.prototype.getResource=function(g,b,E){return s.makeRequest(b,E)},_})(s.Evented);Oo.getSourceType=function(p){return qe[p]},Oo.setSourceType=function(p,_){qe[p]=_},Oo.registerForPluginStateChange=s.registerForPluginStateChange;var qr=s.createLayout([{name:"a_pos",type:"Int16",components:2}]),hd=Qi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Zb=Qi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),IA=Qi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),CA=Qi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),e_=Qi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),t_=Qi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),n_=Qi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),i_=Qi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Wb=Qi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),zb=Qi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),wA=Qi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Gf=Qi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Ff=Qi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Ub=Qi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),zs=Qi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),r_=Qi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Yu=Qi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Hu=Qi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Xc=Qi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Yc=Qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ku=Qi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Hc=Qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Kc=Qi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ju=Qi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Xb=Qi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Yb=Qi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Qi(p,_){var g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=_.match(/attribute ([\w]+) ([\w]+)/g),E=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),L=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),F=L?L.concat(E):E,B={};return{fragmentSource:p=p.replace(g,(function(H,ae,ve,be,Ie){return B[Ie]=!0,ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
varying `+ve+" "+be+" "+Ie+`;
#else
uniform `+ve+" "+be+" u_"+Ie+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ie+`
    `+ve+" "+be+" "+Ie+" = u_"+Ie+`;
#endif
`})),vertexSource:_=_.replace(g,(function(H,ae,ve,be,Ie){var Oe=be==="float"?"vec2":"vec4",Fe=Ie.match(/color/)?"color":Oe;return B[Ie]?ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
uniform lowp float u_`+Ie+`_t;
attribute `+ve+" "+Oe+" a_"+Ie+`;
varying `+ve+" "+be+" "+Ie+`;
#else
uniform `+ve+" "+be+" u_"+Ie+`;
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ie+" = a_"+Ie+`;
#else
    `+ve+" "+be+" "+Ie+" = u_"+Ie+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ie+" = unpack_mix_"+Fe+"(a_"+Ie+", u_"+Ie+`_t);
#else
    `+ve+" "+be+" "+Ie+" = u_"+Ie+`;
#endif
`:ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
uniform lowp float u_`+Ie+`_t;
attribute `+ve+" "+Oe+" a_"+Ie+`;
#else
uniform `+ve+" "+be+" u_"+Ie+`;
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+ve+" "+be+" "+Ie+" = a_"+Ie+`;
#else
    `+ve+" "+be+" "+Ie+" = u_"+Ie+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+ve+" "+be+" "+Ie+" = unpack_mix_"+Fe+"(a_"+Ie+", u_"+Ie+`_t);
#else
    `+ve+" "+be+" "+Ie+" = u_"+Ie+`;
#endif
`})),staticAttributes:b,staticUniforms:F}}var AA=Object.freeze({__proto__:null,prelude:hd,background:Zb,backgroundPattern:IA,circle:CA,clippingMask:e_,heatmap:t_,heatmapTexture:n_,collisionBox:i_,collisionCircle:Wb,debug:zb,fill:wA,fillOutline:Gf,fillOutlinePattern:Ff,fillPattern:Ub,fillExtrusion:zs,fillExtrusionPattern:r_,hillshadePrepare:Yu,hillshade:Hu,line:Xc,lineGradient:Yc,linePattern:Ku,lineSDF:Hc,raster:Kc,symbolIcon:ju,symbolSDF:Xb,symbolTextAndIcon:Yb}),yg=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Hb(p){for(var _=[],g=0;g<p.length;g++)if(p[g]!==null){var b=p[g].split(" ");_.push(b.pop())}return _}yg.prototype.bind=function(p,_,g,b,E,L,F,B){this.context=p;for(var H=this.boundPaintVertexBuffers.length!==b.length,ae=0;!H&&ae<b.length;ae++)this.boundPaintVertexBuffers[ae]!==b[ae]&&(H=!0);p.extVertexArrayObject&&this.vao&&this.boundProgram===_&&this.boundLayoutVertexBuffer===g&&!H&&this.boundIndexBuffer===E&&this.boundVertexOffset===L&&this.boundDynamicVertexBuffer===F&&this.boundDynamicVertexBuffer2===B?(p.bindVertexArrayOES.set(this.vao),F&&F.bind(),E&&E.dynamicDraw&&E.bind(),B&&B.bind()):this.freshBind(_,g,b,E,L,F,B)},yg.prototype.freshBind=function(p,_,g,b,E,L,F){var B,H=p.numAttributes,ae=this.context,ve=ae.gl;if(ae.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ae.extVertexArrayObject.createVertexArrayOES(),ae.bindVertexArrayOES.set(this.vao),B=0,this.boundProgram=p,this.boundLayoutVertexBuffer=_,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=b,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=L,this.boundDynamicVertexBuffer2=F;else{B=ae.currentNumAttributes||0;for(var be=H;be<B;be++)ve.disableVertexAttribArray(be)}_.enableAttributes(ve,p);for(var Ie=0,Oe=g;Ie<Oe.length;Ie+=1)Oe[Ie].enableAttributes(ve,p);L&&L.enableAttributes(ve,p),F&&F.enableAttributes(ve,p),_.bind(),_.setVertexAttribPointers(ve,p,E);for(var Fe=0,Xe=g;Fe<Xe.length;Fe+=1){var Ee=Xe[Fe];Ee.bind(),Ee.setVertexAttribPointers(ve,p,E)}L&&(L.bind(),L.setVertexAttribPointers(ve,p,E)),b&&b.bind(),F&&(F.bind(),F.setVertexAttribPointers(ve,p,E)),ae.currentNumAttributes=H},yg.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Kb=function(p,_,g,b,E,L){var F=p.gl;this.program=F.createProgram();for(var B=Hb(g.staticAttributes),H=b?b.getBinderAttributes():[],ae=B.concat(H),ve=g.staticUniforms?Hb(g.staticUniforms):[],be=b?b.getBinderUniforms():[],Ie=[],Oe=0,Fe=ve.concat(be);Oe<Fe.length;Oe+=1){var Xe=Fe[Oe];Ie.indexOf(Xe)<0&&Ie.push(Xe)}var Ee=b?b.defines():[];L&&Ee.push("#define OVERDRAW_INSPECTOR;");var Ue=Ee.concat(hd.fragmentSource,g.fragmentSource).join(`
`),je=Ee.concat(hd.vertexSource,g.vertexSource).join(`
`),nt=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())this.failedToCreate=!0;else{F.shaderSource(nt,Ue),F.compileShader(nt),F.attachShader(this.program,nt);var ut=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())this.failedToCreate=!0;else{F.shaderSource(ut,je),F.compileShader(ut),F.attachShader(this.program,ut),this.attributes={};var ot={};this.numAttributes=ae.length;for(var ht=0;ht<this.numAttributes;ht++)ae[ht]&&(F.bindAttribLocation(this.program,ht,ae[ht]),this.attributes[ae[ht]]=ht);F.linkProgram(this.program),F.deleteShader(ut),F.deleteShader(nt);for(var vt=0;vt<Ie.length;vt++){var Nt=Ie[vt];if(Nt&&!ot[Nt]){var Gt=F.getUniformLocation(this.program,Nt);Gt&&(ot[Nt]=Gt)}}this.fixedUniforms=E(p,ot),this.binderUniforms=b?b.getUniforms(p,ot):[]}}};function jb(p,_,g){var b=1/xr(g,1,_.transform.tileZoom),E=Math.pow(2,g.tileID.overscaledZ),L=g.tileSize*Math.pow(2,_.transform.tileZoom)/E,F=L*(g.tileID.canonical.x+g.tileID.wrap*E),B=L*g.tileID.canonical.y;return{u_image:0,u_texsize:g.imageAtlasTexture.size,u_scale:[b,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[F>>16,B>>16],u_pixel_coord_lower:[65535&F,65535&B]}}Kb.prototype.draw=function(p,_,g,b,E,L,F,B,H,ae,ve,be,Ie,Oe,Fe,Xe){var Ee,Ue=p.gl;if(!this.failedToCreate){for(var je in p.program.set(this.program),p.setDepthMode(g),p.setStencilMode(b),p.setColorMode(E),p.setCullFace(L),this.fixedUniforms)this.fixedUniforms[je].set(F[je]);Oe&&Oe.setUniforms(p,this.binderUniforms,be,{zoom:Ie});for(var nt=(Ee={},Ee[Ue.LINES]=2,Ee[Ue.TRIANGLES]=3,Ee[Ue.LINE_STRIP]=1,Ee)[_],ut=0,ot=ve.get();ut<ot.length;ut+=1){var ht=ot[ut],vt=ht.vaos||(ht.vaos={});(vt[B]||(vt[B]=new yg)).bind(p,this,H,Oe?Oe.getPaintVertexBuffers():[],ae,ht.vertexOffset,Fe,Xe),Ue.drawElements(_,ht.primitiveLength*nt,Ue.UNSIGNED_SHORT,ht.primitiveOffset*nt*2)}}};var $b=function(p,_,g,b){var E=_.style.light,L=E.properties.get("position"),F=[L.x,L.y,L.z],B=s.create$1();E.properties.get("anchor")==="viewport"&&s.fromRotation(B,-_.transform.angle),s.transformMat3(F,F,B);var H=E.properties.get("color");return{u_matrix:p,u_lightpos:F,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+g,u_opacity:b}},jc=function(p,_,g,b,E,L,F){return s.extend($b(p,_,g,b),jb(L,_,F),{u_height_factor:-Math.pow(2,E.overscaledZ)/F.tileSize/8})},$u=function(p){return{u_matrix:p}},$c=function(p,_,g,b){return s.extend($u(p),jb(g,_,b))},Jb=function(p,_){return{u_matrix:p,u_world:_}},qb=function(p,_,g,b,E){return s.extend($c(p,_,g,b),{u_world:E})},s_=function(p,_,g,b){var E,L,F=p.transform;if(b.paint.get("circle-pitch-alignment")==="map"){var B=xr(g,1,F.zoom);E=!0,L=[B,B]}else E=!1,L=F.pixelsToGLUnits;return{u_camera_to_center_distance:F.cameraToCenterDistance,u_scale_with_map:+(b.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(_.posMatrix,g,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:s.browser.devicePixelRatio,u_extrude_scale:L}},Jc=function(p,_,g){var b=xr(g,1,_.zoom),E=Math.pow(2,_.zoom-g.tileID.overscaledZ),L=g.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:_.cameraToCenterDistance,u_pixels_to_tile_units:b,u_extrude_scale:[_.pixelsToGLUnits[0]/(b*E),_.pixelsToGLUnits[1]/(b*E)],u_overscale_factor:L}},Qb=function(p,_,g){return{u_matrix:p,u_inv_matrix:_,u_camera_to_center_distance:g.cameraToCenterDistance,u_viewport_size:[g.width,g.height]}},qc=function(p,_,g){return g===void 0&&(g=1),{u_matrix:p,u_color:_,u_overlay:0,u_overlay_scale:g}},Qc=function(p){return{u_matrix:p}},e1=function(p,_,g,b){return{u_matrix:p,u_extrude_scale:xr(_,1,g),u_intensity:b}},Of=function(p,_,g){var b=p.transform;return{u_matrix:t1(p,_,g),u_ratio:1/xr(_,1,b.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},ar=function(p,_,g,b){return s.extend(Of(p,_,g),{u_image:0,u_image_height:b})},_g=function(p,_,g,b){var E=p.transform,L=dd(_,E);return{u_matrix:t1(p,_,g),u_texsize:_.imageAtlasTexture.size,u_ratio:1/xr(_,1,E.zoom),u_device_pixel_ratio:s.browser.devicePixelRatio,u_image:0,u_scale:[L,b.fromScale,b.toScale],u_fade:b.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},SA=function(p,_,g,b,E){var L=p.lineAtlas,F=dd(_,p.transform),B=g.layout.get("line-cap")==="round",H=L.getDash(b.from,B),ae=L.getDash(b.to,B),ve=H.width*E.fromScale,be=ae.width*E.toScale;return s.extend(Of(p,_,g),{u_patternscale_a:[F/ve,-H.height/2],u_patternscale_b:[F/be,-ae.height/2],u_sdfgamma:L.width/(256*Math.min(ve,be)*s.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:ae.y,u_mix:E.t})};function dd(p,_){return 1/xr(p,1,_.tileZoom)}function t1(p,_,g){return p.translatePosMatrix(_.tileID.posMatrix,_,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}var EA=function(p,_,g,b,E){return{u_matrix:p,u_tl_parent:_,u_scale_parent:g,u_buffer_scale:1,u_fade_t:b.mix,u_opacity:b.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(F=E.paint.get("raster-saturation"),F>0?1-1/(1.001-F):-F),u_contrast_factor:(L=E.paint.get("raster-contrast"),L>0?1/(1-L):1+L),u_spin_weights:n1(E.paint.get("raster-hue-rotate"))};var L,F};function n1(p){p*=Math.PI/180;var _=Math.sin(p),g=Math.cos(p);return[(2*g+1)/3,(-Math.sqrt(3)*_-g+1)/3,(Math.sqrt(3)*_-g+1)/3]}var vg,fd=function(p,_,g,b,E,L,F,B,H,ae){var ve=E.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:_?_.uSizeT:0,u_size:_?_.uSize:0,u_camera_to_center_distance:ve.cameraToCenterDistance,u_pitch:ve.pitch/360*2*Math.PI,u_rotate_symbol:+g,u_aspect_ratio:ve.width/ve.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:L,u_label_plane_matrix:F,u_coord_matrix:B,u_is_text:+H,u_pitch_with_map:+b,u_texsize:ae,u_texture:0}},Nf=function(p,_,g,b,E,L,F,B,H,ae,ve){var be=E.transform;return s.extend(fd(p,_,g,b,E,L,F,B,H,ae),{u_gamma_scale:b?Math.cos(be._pitch)*be.cameraToCenterDistance:1,u_device_pixel_ratio:s.browser.devicePixelRatio,u_is_halo:1})},bg=function(p,_,g,b,E,L,F,B,H,ae){return s.extend(Nf(p,_,g,b,E,L,F,B,!0,H),{u_texsize_icon:ae,u_texture_icon:1})},Df=function(p,_,g){return{u_matrix:p,u_opacity:_,u_color:g}},pd=function(p,_,g,b,E,L){return s.extend((function(F,B,H,ae){var ve=H.imageManager.getPattern(F.from.toString()),be=H.imageManager.getPattern(F.to.toString()),Ie=H.imageManager.getPixelSize(),Oe=Ie.width,Fe=Ie.height,Xe=Math.pow(2,ae.tileID.overscaledZ),Ee=ae.tileSize*Math.pow(2,H.transform.tileZoom)/Xe,Ue=Ee*(ae.tileID.canonical.x+ae.tileID.wrap*Xe),je=Ee*ae.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ve.tl,u_pattern_br_a:ve.br,u_pattern_tl_b:be.tl,u_pattern_br_b:be.br,u_texsize:[Oe,Fe],u_mix:B.t,u_pattern_size_a:ve.displaySize,u_pattern_size_b:be.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/xr(ae,1,H.transform.tileZoom),u_pixel_coord_upper:[Ue>>16,je>>16],u_pixel_coord_lower:[65535&Ue,65535&je]}})(b,L,g,E),{u_matrix:p,u_opacity:_})},i1={fillExtrusion:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_lightpos:new s.Uniform3f(p,_.u_lightpos),u_lightintensity:new s.Uniform1f(p,_.u_lightintensity),u_lightcolor:new s.Uniform3f(p,_.u_lightcolor),u_vertical_gradient:new s.Uniform1f(p,_.u_vertical_gradient),u_opacity:new s.Uniform1f(p,_.u_opacity)}},fillExtrusionPattern:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_lightpos:new s.Uniform3f(p,_.u_lightpos),u_lightintensity:new s.Uniform1f(p,_.u_lightintensity),u_lightcolor:new s.Uniform3f(p,_.u_lightcolor),u_vertical_gradient:new s.Uniform1f(p,_.u_vertical_gradient),u_height_factor:new s.Uniform1f(p,_.u_height_factor),u_image:new s.Uniform1i(p,_.u_image),u_texsize:new s.Uniform2f(p,_.u_texsize),u_pixel_coord_upper:new s.Uniform2f(p,_.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(p,_.u_pixel_coord_lower),u_scale:new s.Uniform3f(p,_.u_scale),u_fade:new s.Uniform1f(p,_.u_fade),u_opacity:new s.Uniform1f(p,_.u_opacity)}},fill:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix)}},fillPattern:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_image:new s.Uniform1i(p,_.u_image),u_texsize:new s.Uniform2f(p,_.u_texsize),u_pixel_coord_upper:new s.Uniform2f(p,_.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(p,_.u_pixel_coord_lower),u_scale:new s.Uniform3f(p,_.u_scale),u_fade:new s.Uniform1f(p,_.u_fade)}},fillOutline:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_world:new s.Uniform2f(p,_.u_world)}},fillOutlinePattern:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_world:new s.Uniform2f(p,_.u_world),u_image:new s.Uniform1i(p,_.u_image),u_texsize:new s.Uniform2f(p,_.u_texsize),u_pixel_coord_upper:new s.Uniform2f(p,_.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(p,_.u_pixel_coord_lower),u_scale:new s.Uniform3f(p,_.u_scale),u_fade:new s.Uniform1f(p,_.u_fade)}},circle:function(p,_){return{u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(p,_.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(p,_.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(p,_.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(p,_.u_matrix)}},collisionBox:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(p,_.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(p,_.u_extrude_scale),u_overscale_factor:new s.Uniform1f(p,_.u_overscale_factor)}},collisionCircle:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_inv_matrix:new s.UniformMatrix4f(p,_.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(p,_.u_viewport_size)}},debug:function(p,_){return{u_color:new s.UniformColor(p,_.u_color),u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_overlay:new s.Uniform1i(p,_.u_overlay),u_overlay_scale:new s.Uniform1f(p,_.u_overlay_scale)}},clippingMask:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix)}},heatmap:function(p,_){return{u_extrude_scale:new s.Uniform1f(p,_.u_extrude_scale),u_intensity:new s.Uniform1f(p,_.u_intensity),u_matrix:new s.UniformMatrix4f(p,_.u_matrix)}},heatmapTexture:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_world:new s.Uniform2f(p,_.u_world),u_image:new s.Uniform1i(p,_.u_image),u_color_ramp:new s.Uniform1i(p,_.u_color_ramp),u_opacity:new s.Uniform1f(p,_.u_opacity)}},hillshade:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_image:new s.Uniform1i(p,_.u_image),u_latrange:new s.Uniform2f(p,_.u_latrange),u_light:new s.Uniform2f(p,_.u_light),u_shadow:new s.UniformColor(p,_.u_shadow),u_highlight:new s.UniformColor(p,_.u_highlight),u_accent:new s.UniformColor(p,_.u_accent)}},hillshadePrepare:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_image:new s.Uniform1i(p,_.u_image),u_dimension:new s.Uniform2f(p,_.u_dimension),u_zoom:new s.Uniform1f(p,_.u_zoom),u_unpack:new s.Uniform4f(p,_.u_unpack)}},line:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_ratio:new s.Uniform1f(p,_.u_ratio),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(p,_.u_units_to_pixels)}},lineGradient:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_ratio:new s.Uniform1f(p,_.u_ratio),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(p,_.u_units_to_pixels),u_image:new s.Uniform1i(p,_.u_image),u_image_height:new s.Uniform1f(p,_.u_image_height)}},linePattern:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_texsize:new s.Uniform2f(p,_.u_texsize),u_ratio:new s.Uniform1f(p,_.u_ratio),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_image:new s.Uniform1i(p,_.u_image),u_units_to_pixels:new s.Uniform2f(p,_.u_units_to_pixels),u_scale:new s.Uniform3f(p,_.u_scale),u_fade:new s.Uniform1f(p,_.u_fade)}},lineSDF:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_ratio:new s.Uniform1f(p,_.u_ratio),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(p,_.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(p,_.u_patternscale_a),u_patternscale_b:new s.Uniform2f(p,_.u_patternscale_b),u_sdfgamma:new s.Uniform1f(p,_.u_sdfgamma),u_image:new s.Uniform1i(p,_.u_image),u_tex_y_a:new s.Uniform1f(p,_.u_tex_y_a),u_tex_y_b:new s.Uniform1f(p,_.u_tex_y_b),u_mix:new s.Uniform1f(p,_.u_mix)}},raster:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_tl_parent:new s.Uniform2f(p,_.u_tl_parent),u_scale_parent:new s.Uniform1f(p,_.u_scale_parent),u_buffer_scale:new s.Uniform1f(p,_.u_buffer_scale),u_fade_t:new s.Uniform1f(p,_.u_fade_t),u_opacity:new s.Uniform1f(p,_.u_opacity),u_image0:new s.Uniform1i(p,_.u_image0),u_image1:new s.Uniform1i(p,_.u_image1),u_brightness_low:new s.Uniform1f(p,_.u_brightness_low),u_brightness_high:new s.Uniform1f(p,_.u_brightness_high),u_saturation_factor:new s.Uniform1f(p,_.u_saturation_factor),u_contrast_factor:new s.Uniform1f(p,_.u_contrast_factor),u_spin_weights:new s.Uniform3f(p,_.u_spin_weights)}},symbolIcon:function(p,_){return{u_is_size_zoom_constant:new s.Uniform1i(p,_.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(p,_.u_is_size_feature_constant),u_size_t:new s.Uniform1f(p,_.u_size_t),u_size:new s.Uniform1f(p,_.u_size),u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_pitch:new s.Uniform1f(p,_.u_pitch),u_rotate_symbol:new s.Uniform1i(p,_.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(p,_.u_aspect_ratio),u_fade_change:new s.Uniform1f(p,_.u_fade_change),u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(p,_.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(p,_.u_coord_matrix),u_is_text:new s.Uniform1i(p,_.u_is_text),u_pitch_with_map:new s.Uniform1i(p,_.u_pitch_with_map),u_texsize:new s.Uniform2f(p,_.u_texsize),u_texture:new s.Uniform1i(p,_.u_texture)}},symbolSDF:function(p,_){return{u_is_size_zoom_constant:new s.Uniform1i(p,_.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(p,_.u_is_size_feature_constant),u_size_t:new s.Uniform1f(p,_.u_size_t),u_size:new s.Uniform1f(p,_.u_size),u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_pitch:new s.Uniform1f(p,_.u_pitch),u_rotate_symbol:new s.Uniform1i(p,_.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(p,_.u_aspect_ratio),u_fade_change:new s.Uniform1f(p,_.u_fade_change),u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(p,_.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(p,_.u_coord_matrix),u_is_text:new s.Uniform1i(p,_.u_is_text),u_pitch_with_map:new s.Uniform1i(p,_.u_pitch_with_map),u_texsize:new s.Uniform2f(p,_.u_texsize),u_texture:new s.Uniform1i(p,_.u_texture),u_gamma_scale:new s.Uniform1f(p,_.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(p,_.u_is_halo)}},symbolTextAndIcon:function(p,_){return{u_is_size_zoom_constant:new s.Uniform1i(p,_.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(p,_.u_is_size_feature_constant),u_size_t:new s.Uniform1f(p,_.u_size_t),u_size:new s.Uniform1f(p,_.u_size),u_camera_to_center_distance:new s.Uniform1f(p,_.u_camera_to_center_distance),u_pitch:new s.Uniform1f(p,_.u_pitch),u_rotate_symbol:new s.Uniform1i(p,_.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(p,_.u_aspect_ratio),u_fade_change:new s.Uniform1f(p,_.u_fade_change),u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(p,_.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(p,_.u_coord_matrix),u_is_text:new s.Uniform1i(p,_.u_is_text),u_pitch_with_map:new s.Uniform1i(p,_.u_pitch_with_map),u_texsize:new s.Uniform2f(p,_.u_texsize),u_texsize_icon:new s.Uniform2f(p,_.u_texsize_icon),u_texture:new s.Uniform1i(p,_.u_texture),u_texture_icon:new s.Uniform1i(p,_.u_texture_icon),u_gamma_scale:new s.Uniform1f(p,_.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(p,_.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(p,_.u_is_halo)}},background:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_opacity:new s.Uniform1f(p,_.u_opacity),u_color:new s.UniformColor(p,_.u_color)}},backgroundPattern:function(p,_){return{u_matrix:new s.UniformMatrix4f(p,_.u_matrix),u_opacity:new s.Uniform1f(p,_.u_opacity),u_image:new s.Uniform1i(p,_.u_image),u_pattern_tl_a:new s.Uniform2f(p,_.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(p,_.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(p,_.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(p,_.u_pattern_br_b),u_texsize:new s.Uniform2f(p,_.u_texsize),u_mix:new s.Uniform1f(p,_.u_mix),u_pattern_size_a:new s.Uniform2f(p,_.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(p,_.u_pattern_size_b),u_scale_a:new s.Uniform1f(p,_.u_scale_a),u_scale_b:new s.Uniform1f(p,_.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(p,_.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(p,_.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(p,_.u_tile_units_to_pixels)}}};function gd(p,_,g,b,E,L,F){for(var B=p.context,H=B.gl,ae=p.useProgram("collisionBox"),ve=[],be=0,Ie=0,Oe=0;Oe<b.length;Oe++){var Fe=b[Oe],Xe=_.getTile(Fe),Ee=Xe.getBucket(g);if(Ee){var Ue=Fe.posMatrix;E[0]===0&&E[1]===0||(Ue=p.translatePosMatrix(Fe.posMatrix,Xe,E,L));var je=F?Ee.textCollisionBox:Ee.iconCollisionBox,nt=Ee.collisionCircleArray;if(nt.length>0){var ut=s.create(),ot=Ue;s.mul(ut,Ee.placementInvProjMatrix,p.transform.glCoordMatrix),s.mul(ut,ut,Ee.placementViewportMatrix),ve.push({circleArray:nt,circleOffset:Ie,transform:ot,invTransform:ut}),Ie=be+=nt.length/4}je&&ae.draw(B,H.LINES,xe.disabled,Ae.disabled,p.colorModeForRenderPass(),ze.disabled,Jc(Ue,p.transform,Xe),g.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,null,p.transform.zoom,null,null,je.collisionVertexBuffer)}}if(F&&ve.length){var ht=p.useProgram("collisionCircle"),vt=new s.StructArrayLayout2f1f2i16;vt.resize(4*be),vt._trim();for(var Nt=0,Gt=0,en=ve;Gt<en.length;Gt+=1)for(var vn=en[Gt],wn=0;wn<vn.circleArray.length/4;wn++){var Cn=4*wn,xi=vn.circleArray[Cn+0],rn=vn.circleArray[Cn+1],On=vn.circleArray[Cn+2],Hn=vn.circleArray[Cn+3];vt.emplace(Nt++,xi,rn,On,Hn,0),vt.emplace(Nt++,xi,rn,On,Hn,1),vt.emplace(Nt++,xi,rn,On,Hn,2),vt.emplace(Nt++,xi,rn,On,Hn,3)}(!vg||vg.length<2*be)&&(vg=(function(Fr){var to=2*Fr,Ms=new s.StructArrayLayout3ui6;Ms.resize(to),Ms._trim();for(var kr=0;kr<to;kr++){var Xr=6*kr;Ms.uint16[Xr+0]=4*kr+0,Ms.uint16[Xr+1]=4*kr+1,Ms.uint16[Xr+2]=4*kr+2,Ms.uint16[Xr+3]=4*kr+2,Ms.uint16[Xr+4]=4*kr+3,Ms.uint16[Xr+5]=4*kr+0}return Ms})(be));for(var Fn=B.createIndexBuffer(vg,!0),Gn=B.createVertexBuffer(vt,s.collisionCircleLayout.members,!0),Yn=0,Ln=ve;Yn<Ln.length;Yn+=1){var Tn=Ln[Yn],_s=Qb(Tn.transform,Tn.invTransform,p.transform);ht.draw(B,H.TRIANGLES,xe.disabled,Ae.disabled,p.colorModeForRenderPass(),ze.disabled,_s,g.id,Gn,Fn,s.SegmentVector.simpleSegment(0,2*Tn.circleOffset,Tn.circleArray.length,Tn.circleArray.length/2),null,p.transform.zoom,null,null,null)}Gn.destroy(),Fn.destroy()}}var rl=s.identity(new Float32Array(16));function r1(p,_,g,b,E,L){var F=s.getAnchorAlignment(p),B=-(F.horizontalAlign-.5)*_,H=-(F.verticalAlign-.5)*g,ae=s.evaluateVariableOffset(p,b);return new s.Point((B/E+ae[0])*L,(H/E+ae[1])*L)}function s1(p,_,g,b,E,L,F,B,H,ae,ve){var be=p.text.placedSymbolArray,Ie=p.text.dynamicLayoutVertexArray,Oe=p.icon.dynamicLayoutVertexArray,Fe={};Ie.clear();for(var Xe=0;Xe<be.length;Xe++){var Ee=be.get(Xe),Ue=Ee.hidden||!Ee.crossTileID||p.allowVerticalPlacement&&!Ee.placedOrientation?null:b[Ee.crossTileID];if(Ue){var je=new s.Point(Ee.anchorX,Ee.anchorY),nt=Rn(je,g?B:F),ut=bi(L.cameraToCenterDistance,nt.signedDistanceFromCamera),ot=E.evaluateSizeForFeature(p.textSizeData,ae,Ee)*ut/s.ONE_EM;g&&(ot*=p.tilePixelRatio/H);for(var ht=r1(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textBoxScale,ot),vt=g?Rn(je.add(ht),F).point:nt.point.add(_?ht.rotate(-L.angle):ht),Nt=p.allowVerticalPlacement&&Ee.placedOrientation===s.WritingMode.vertical?Math.PI/2:0,Gt=0;Gt<Ee.numGlyphs;Gt++)s.addDynamicAttributes(Ie,vt,Nt);ve&&Ee.associatedIconIndex>=0&&(Fe[Ee.associatedIconIndex]={shiftedAnchor:vt,angle:Nt})}else oo(Ee.numGlyphs,Ie)}if(ve){Oe.clear();for(var en=p.icon.placedSymbolArray,vn=0;vn<en.length;vn++){var wn=en.get(vn);if(wn.hidden)oo(wn.numGlyphs,Oe);else{var Cn=Fe[vn];if(Cn)for(var xi=0;xi<wn.numGlyphs;xi++)s.addDynamicAttributes(Oe,Cn.shiftedAnchor,Cn.angle);else oo(wn.numGlyphs,Oe)}}p.icon.dynamicLayoutVertexBuffer.updateData(Oe)}p.text.dynamicLayoutVertexBuffer.updateData(Ie)}function o1(p,_,g){return g.iconsInText&&_?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function eh(p,_,g,b,E,L,F,B,H,ae,ve,be){for(var Ie=p.context,Oe=Ie.gl,Fe=p.transform,Xe=B==="map",Ee=H==="map",Ue=Xe&&g.layout.get("symbol-placement")!=="point",je=Xe&&!Ee&&!Ue,nt=g.layout.get("symbol-sort-key").constantOr(1)!==void 0,ut=!1,ot=p.depthModeForSublayer(0,xe.ReadOnly),ht=g.layout.get("text-variable-anchor"),vt=[],Nt=0,Gt=b;Nt<Gt.length;Nt+=1){var en=Gt[Nt],vn=_.getTile(en),wn=vn.getBucket(g);if(wn){var Cn=E?wn.text:wn.icon;if(Cn&&Cn.segments.get().length){var xi=Cn.programConfigurations.get(g.id),rn=E||wn.sdfIcons,On=E?wn.textSizeData:wn.iconSizeData,Hn=Ee||Fe.pitch!==0,Fn=p.useProgram(o1(rn,E,wn),xi),Gn=s.evaluateSizeForZoom(On,Fe.zoom),Yn=void 0,Ln=[0,0],Tn=void 0,_s=void 0,Fr=null,to=void 0;if(E)Tn=vn.glyphAtlasTexture,_s=Oe.LINEAR,Yn=vn.glyphAtlasTexture.size,wn.iconsInText&&(Ln=vn.imageAtlasTexture.size,Fr=vn.imageAtlasTexture,to=Hn||p.options.rotating||p.options.zooming||On.kind==="composite"||On.kind==="camera"?Oe.LINEAR:Oe.NEAREST);else{var Ms=g.layout.get("icon-size").constantOr(0)!==1||wn.iconsNeedLinear;Tn=vn.imageAtlasTexture,_s=rn||p.options.rotating||p.options.zooming||Ms||Hn?Oe.LINEAR:Oe.NEAREST,Yn=vn.imageAtlasTexture.size}var kr=xr(vn,1,p.transform.zoom),Xr=ir(en.posMatrix,Ee,Xe,p.transform,kr),Wo=Pi(en.posMatrix,Ee,Xe,p.transform,kr),co=ht&&wn.hasTextData(),nc=g.layout.get("icon-text-fit")!=="none"&&co&&wn.hasIconData();Ue&&Mf(wn,en.posMatrix,p,E,Xr,Wo,Ee,ae);var Co=p.translatePosMatrix(en.posMatrix,vn,L,F),ul=Ue||E&&ht||nc?rl:Xr,Ga=p.translatePosMatrix(Wo,vn,L,F,!0),$f=rn&&g.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,xd={program:Fn,buffers:Cn,uniformValues:rn?wn.iconsInText?bg(On.kind,Gn,je,Ee,p,Co,ul,Ga,Yn,Ln):Nf(On.kind,Gn,je,Ee,p,Co,ul,Ga,E,Yn):fd(On.kind,Gn,je,Ee,p,Co,ul,Ga,E,Yn),atlasTexture:Tn,atlasTextureIcon:Fr,atlasInterpolation:_s,atlasInterpolationIcon:to,isSDF:rn,hasHalo:$f};if(nt&&wn.canOverlap){ut=!0;for(var ic=0,Id=Cn.segments.get();ic<Id.length;ic+=1){var Jf=Id[ic];vt.push({segments:new s.SegmentVector([Jf]),sortKey:Jf.sortKey,state:xd})}}else vt.push({segments:Cn.segments,sortKey:0,state:xd})}}}ut&&vt.sort((function(rc,oh){return rc.sortKey-oh.sortKey}));for(var Fl=0,qf=vt;Fl<qf.length;Fl+=1){var Ol=qf[Fl],vs=Ol.state;if(Ie.activeTexture.set(Oe.TEXTURE0),vs.atlasTexture.bind(vs.atlasInterpolation,Oe.CLAMP_TO_EDGE),vs.atlasTextureIcon&&(Ie.activeTexture.set(Oe.TEXTURE1),vs.atlasTextureIcon&&vs.atlasTextureIcon.bind(vs.atlasInterpolationIcon,Oe.CLAMP_TO_EDGE)),vs.isSDF){var au=vs.uniformValues;vs.hasHalo&&(au.u_is_halo=1,Vf(vs.buffers,Ol.segments,g,p,vs.program,ot,ve,be,au)),au.u_is_halo=0}Vf(vs.buffers,Ol.segments,g,p,vs.program,ot,ve,be,vs.uniformValues)}}function Vf(p,_,g,b,E,L,F,B,H){var ae=b.context;E.draw(ae,ae.gl.TRIANGLES,L,F,B,ze.disabled,H,g.id,p.layoutVertexBuffer,p.indexBuffer,_,g.paint,b.transform.zoom,p.programConfigurations.get(g.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function xg(p,_,g,b,E,L,F){var B,H,ae,ve,be,Ie=p.context.gl,Oe=g.paint.get("fill-pattern"),Fe=Oe&&Oe.constantOr(1),Xe=g.getCrossfadeParameters();F?(H=Fe&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=Ie.LINES):(H=Fe?"fillPattern":"fill",B=Ie.TRIANGLES);for(var Ee=0,Ue=b;Ee<Ue.length;Ee+=1){var je=Ue[Ee],nt=_.getTile(je);if(!Fe||nt.patternsLoaded()){var ut=nt.getBucket(g);if(ut){var ot=ut.programConfigurations.get(g.id),ht=p.useProgram(H,ot);Fe&&(p.context.activeTexture.set(Ie.TEXTURE0),nt.imageAtlasTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),ot.updatePaintBuffers(Xe));var vt=Oe.constantOr(null);if(vt&&nt.imageAtlas){var Nt=nt.imageAtlas,Gt=Nt.patternPositions[vt.to.toString()],en=Nt.patternPositions[vt.from.toString()];Gt&&en&&ot.setConstantPatternPositions(Gt,en)}var vn=p.translatePosMatrix(je.posMatrix,nt,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));if(F){ve=ut.indexBuffer2,be=ut.segments2;var wn=[Ie.drawingBufferWidth,Ie.drawingBufferHeight];ae=H==="fillOutlinePattern"&&Fe?qb(vn,p,Xe,nt,wn):Jb(vn,wn)}else ve=ut.indexBuffer,be=ut.segments,ae=Fe?$c(vn,p,Xe,nt):$u(vn);ht.draw(p.context,B,E,p.stencilModeForClipping(je),L,ze.disabled,ae,g.id,ut.layoutVertexBuffer,ve,be,g.paint,p.transform.zoom,ot)}}}}function o_(p,_,g,b,E,L,F){for(var B=p.context,H=B.gl,ae=g.paint.get("fill-extrusion-pattern"),ve=ae.constantOr(1),be=g.getCrossfadeParameters(),Ie=g.paint.get("fill-extrusion-opacity"),Oe=0,Fe=b;Oe<Fe.length;Oe+=1){var Xe=Fe[Oe],Ee=_.getTile(Xe),Ue=Ee.getBucket(g);if(Ue){var je=Ue.programConfigurations.get(g.id),nt=p.useProgram(ve?"fillExtrusionPattern":"fillExtrusion",je);ve&&(p.context.activeTexture.set(H.TEXTURE0),Ee.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),je.updatePaintBuffers(be));var ut=ae.constantOr(null);if(ut&&Ee.imageAtlas){var ot=Ee.imageAtlas,ht=ot.patternPositions[ut.to.toString()],vt=ot.patternPositions[ut.from.toString()];ht&&vt&&je.setConstantPatternPositions(ht,vt)}var Nt=p.translatePosMatrix(Xe.posMatrix,Ee,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),Gt=g.paint.get("fill-extrusion-vertical-gradient"),en=ve?jc(Nt,p,Gt,Ie,Xe,be,Ee):$b(Nt,p,Gt,Ie);nt.draw(B,B.gl.TRIANGLES,E,L,F,ze.backCCW,en,g.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,g.paint,p.transform.zoom,je)}}}function Ig(p,_,g,b,E,L){var F=p.context,B=F.gl,H=_.fbo;if(H){var ae=p.useProgram("hillshade");F.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,H.colorAttachment.get());var ve=(function(be,Ie,Oe){var Fe=Oe.paint.get("hillshade-shadow-color"),Xe=Oe.paint.get("hillshade-highlight-color"),Ee=Oe.paint.get("hillshade-accent-color"),Ue=Oe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Oe.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ue-=be.transform.angle);var je,nt,ut,ot=!be.options.moving;return{u_matrix:be.transform.calculatePosMatrix(Ie.tileID.toUnwrapped(),ot),u_image:0,u_latrange:(je=Ie.tileID,nt=Math.pow(2,je.canonical.z),ut=je.canonical.y,[new s.MercatorCoordinate(0,ut/nt).toLngLat().lat,new s.MercatorCoordinate(0,(ut+1)/nt).toLngLat().lat]),u_light:[Oe.paint.get("hillshade-exaggeration"),Ue],u_shadow:Fe,u_highlight:Xe,u_accent:Ee}})(p,_,g);ae.draw(F,B.TRIANGLES,b,E,L,ze.disabled,ve,g.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}}function TA(p,_,g,b,E,L){var F=p.context,B=F.gl,H=_.dem;if(H&&H.data){var ae=H.dim,ve=H.stride,be=H.getPixels();if(F.activeTexture.set(B.TEXTURE1),F.pixelStoreUnpackPremultiplyAlpha.set(!1),_.demTexture=_.demTexture||p.getTileTexture(ve),_.demTexture){var Ie=_.demTexture;Ie.update(be,{premultiply:!1}),Ie.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else _.demTexture=new s.Texture(F,be,B.RGBA,{premultiply:!1}),_.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);F.activeTexture.set(B.TEXTURE0);var Oe=_.fbo;if(!Oe){var Fe=new s.Texture(F,{width:ae,height:ae,data:null},B.RGBA);Fe.bind(B.LINEAR,B.CLAMP_TO_EDGE),(Oe=_.fbo=F.createFramebuffer(ae,ae,!0)).colorAttachment.set(Fe.texture)}F.bindFramebuffer.set(Oe.framebuffer),F.viewport.set([0,0,ae,ae]),p.useProgram("hillshadePrepare").draw(F,B.TRIANGLES,b,E,L,ze.disabled,(function(Xe,Ee){var Ue=Ee.stride,je=s.create();return s.ortho(je,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(je,je,[0,-s.EXTENT,0]),{u_matrix:je,u_image:1,u_dimension:[Ue,Ue],u_zoom:Xe.overscaledZ,u_unpack:Ee.getUnpackVector()}})(_.tileID,H),g.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),_.needsHillshadePrepare=!1}}function Cg(p,_,g,b,E){var L=b.paint.get("raster-fade-duration");if(L>0){var F=s.browser.now(),B=(F-p.timeAdded)/L,H=_?(F-_.timeAdded)/L:-1,ae=g.getSource(),ve=E.coveringZoomLevel({tileSize:ae.tileSize,roundZoom:ae.roundZoom}),be=!_||Math.abs(_.tileID.overscaledZ-ve)>Math.abs(p.tileID.overscaledZ-ve),Ie=be&&p.refreshedUponExpiration?1:s.clamp(be?B:1-H,0,1);return p.refreshedUponExpiration&&B>=1&&(p.refreshedUponExpiration=!1),_?{opacity:1,mix:1-Ie}:{opacity:Ie,mix:0}}return{opacity:1,mix:0}}var a_=new s.Color(1,0,0,1),a1=new s.Color(0,1,0,1),l1=new s.Color(0,0,1,1),wg=new s.Color(1,0,1,1),l_=new s.Color(0,1,1,1);function u_(p,_,g,b){Bf(p,0,_+g/2,p.transform.width,g,b)}function c_(p,_,g,b){Bf(p,_-g/2,0,g,p.transform.height,b)}function Bf(p,_,g,b,E,L){var F=p.context,B=F.gl;B.enable(B.SCISSOR_TEST),B.scissor(_*s.browser.devicePixelRatio,g*s.browser.devicePixelRatio,b*s.browser.devicePixelRatio,E*s.browser.devicePixelRatio),F.clear({color:L}),B.disable(B.SCISSOR_TEST)}function u1(p,_,g){var b=p.context,E=b.gl,L=g.posMatrix,F=p.useProgram("debug"),B=xe.disabled,H=Ae.disabled,ae=p.colorModeForRenderPass();b.activeTexture.set(E.TEXTURE0),p.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),F.draw(b,E.LINE_STRIP,B,H,ae,ze.disabled,qc(L,s.Color.red),"$debug",p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments);var ve=_.getTileByID(g.key).latestRawTileData,be=Math.floor((ve&&ve.byteLength||0)/1024),Ie=_.getTile(g).tileSize,Oe=512/Math.min(Ie,512)*(g.overscaledZ/p.transform.zoom)*.5,Fe=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(Fe+=" => "+g.overscaledZ),(function(Xe,Ee){Xe.initDebugOverlayCanvas();var Ue=Xe.debugOverlayCanvas,je=Xe.context.gl,nt=Xe.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,Ue.width,Ue.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(Ee,5,5),nt.strokeText(Ee,5,5),Xe.debugOverlayTexture.update(Ue),Xe.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)})(p,Fe+" "+be+"kb"),F.draw(b,E.TRIANGLES,B,H,Ye.alphaBlended,ze.disabled,qc(L,s.Color.transparent,Oe),"$debug",p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments)}var th={symbol:function(p,_,g,b,E){if(p.renderPass==="translucent"){var L=Ae.disabled,F=p.colorModeForRenderPass();g.layout.get("text-variable-anchor")&&(function(B,H,ae,ve,be,Ie,Oe){for(var Fe=H.transform,Xe=be==="map",Ee=Ie==="map",Ue=0,je=B;Ue<je.length;Ue+=1){var nt=je[Ue],ut=ve.getTile(nt),ot=ut.getBucket(ae);if(ot&&ot.text&&ot.text.segments.get().length){var ht=s.evaluateSizeForZoom(ot.textSizeData,Fe.zoom),vt=xr(ut,1,H.transform.zoom),Nt=ir(nt.posMatrix,Ee,Xe,H.transform,vt),Gt=ae.layout.get("icon-text-fit")!=="none"&&ot.hasIconData();if(ht){var en=Math.pow(2,Fe.zoom-ut.tileID.overscaledZ);s1(ot,Xe,Ee,Oe,s.symbolSize,Fe,Nt,nt.posMatrix,en,ht,Gt)}}}})(b,p,g,_,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),E),g.paint.get("icon-opacity").constantOr(1)!==0&&eh(p,_,g,b,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),L,F),g.paint.get("text-opacity").constantOr(1)!==0&&eh(p,_,g,b,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),L,F),_.map.showCollisionBoxes&&(gd(p,_,g,b,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),gd(p,_,g,b,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))}},circle:function(p,_,g,b){if(p.renderPass==="translucent"){var E=g.paint.get("circle-opacity"),L=g.paint.get("circle-stroke-width"),F=g.paint.get("circle-stroke-opacity"),B=g.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||L.constantOr(1)!==0&&F.constantOr(1)!==0){for(var H=p.context,ae=H.gl,ve=p.depthModeForSublayer(0,xe.ReadOnly),be=Ae.disabled,Ie=p.colorModeForRenderPass(),Oe=[],Fe=0;Fe<b.length;Fe++){var Xe=b[Fe],Ee=_.getTile(Xe),Ue=Ee.getBucket(g);if(Ue){var je=Ue.programConfigurations.get(g.id),nt={programConfiguration:je,program:p.useProgram("circle",je),layoutVertexBuffer:Ue.layoutVertexBuffer,indexBuffer:Ue.indexBuffer,uniformValues:s_(p,Xe,Ee,g)};if(B)for(var ut=0,ot=Ue.segments.get();ut<ot.length;ut+=1){var ht=ot[ut];Oe.push({segments:new s.SegmentVector([ht]),sortKey:ht.sortKey,state:nt})}else Oe.push({segments:Ue.segments,sortKey:0,state:nt})}}B&&Oe.sort((function(vn,wn){return vn.sortKey-wn.sortKey}));for(var vt=0,Nt=Oe;vt<Nt.length;vt+=1){var Gt=Nt[vt],en=Gt.state;en.program.draw(H,ae.TRIANGLES,ve,be,Ie,ze.disabled,en.uniformValues,g.id,en.layoutVertexBuffer,en.indexBuffer,Gt.segments,g.paint,p.transform.zoom,en.programConfiguration)}}}},heatmap:function(p,_,g,b){if(g.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){var E=p.context,L=E.gl,F=Ae.disabled,B=new Ye([L.ONE,L.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(Oe,Fe,Xe){var Ee=Oe.gl;Oe.activeTexture.set(Ee.TEXTURE1),Oe.viewport.set([0,0,Fe.width/4,Fe.height/4]);var Ue=Xe.heatmapFbo;if(Ue)Ee.bindTexture(Ee.TEXTURE_2D,Ue.colorAttachment.get()),Oe.bindFramebuffer.set(Ue.framebuffer);else{var je=Ee.createTexture();Ee.bindTexture(Ee.TEXTURE_2D,je),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_WRAP_S,Ee.CLAMP_TO_EDGE),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_WRAP_T,Ee.CLAMP_TO_EDGE),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_MIN_FILTER,Ee.LINEAR),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_MAG_FILTER,Ee.LINEAR),Ue=Xe.heatmapFbo=Oe.createFramebuffer(Fe.width/4,Fe.height/4,!1),(function(nt,ut,ot,ht){var vt=nt.gl;vt.texImage2D(vt.TEXTURE_2D,0,vt.RGBA,ut.width/4,ut.height/4,0,vt.RGBA,nt.extRenderToTextureHalfFloat?nt.extTextureHalfFloat.HALF_FLOAT_OES:vt.UNSIGNED_BYTE,null),ht.colorAttachment.set(ot)})(Oe,Fe,je,Ue)}})(E,p,g),E.clear({color:s.Color.transparent});for(var H=0;H<b.length;H++){var ae=b[H];if(!_.hasRenderableParent(ae)){var ve=_.getTile(ae),be=ve.getBucket(g);if(be){var Ie=be.programConfigurations.get(g.id);p.useProgram("heatmap",Ie).draw(E,L.TRIANGLES,xe.disabled,F,B,ze.disabled,e1(ae.posMatrix,ve,p.transform.zoom,g.paint.get("heatmap-intensity")),g.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,g.paint,p.transform.zoom,Ie)}}}E.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),(function(Oe,Fe){var Xe=Oe.context,Ee=Xe.gl,Ue=Fe.heatmapFbo;if(Ue){Xe.activeTexture.set(Ee.TEXTURE0),Ee.bindTexture(Ee.TEXTURE_2D,Ue.colorAttachment.get()),Xe.activeTexture.set(Ee.TEXTURE1);var je=Fe.colorRampTexture;je||(je=Fe.colorRampTexture=new s.Texture(Xe,Fe.colorRamp,Ee.RGBA)),je.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),Oe.useProgram("heatmapTexture").draw(Xe,Ee.TRIANGLES,xe.disabled,Ae.disabled,Oe.colorModeForRenderPass(),ze.disabled,(function(nt,ut,ot,ht){var vt=s.create();s.ortho(vt,0,nt.width,nt.height,0,0,1);var Nt=nt.context.gl;return{u_matrix:vt,u_world:[Nt.drawingBufferWidth,Nt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ut.paint.get("heatmap-opacity")}})(Oe,Fe),Fe.id,Oe.viewportBuffer,Oe.quadTriangleIndexBuffer,Oe.viewportSegments,Fe.paint,Oe.transform.zoom)}})(p,g))},line:function(p,_,g,b){if(p.renderPass==="translucent"){var E=g.paint.get("line-opacity"),L=g.paint.get("line-width");if(E.constantOr(1)!==0&&L.constantOr(1)!==0)for(var F=p.depthModeForSublayer(0,xe.ReadOnly),B=p.colorModeForRenderPass(),H=g.paint.get("line-dasharray"),ae=g.paint.get("line-pattern"),ve=ae.constantOr(1),be=g.paint.get("line-gradient"),Ie=g.getCrossfadeParameters(),Oe=ve?"linePattern":H?"lineSDF":be?"lineGradient":"line",Fe=p.context,Xe=Fe.gl,Ee=!0,Ue=0,je=b;Ue<je.length;Ue+=1){var nt=je[Ue],ut=_.getTile(nt);if(!ve||ut.patternsLoaded()){var ot=ut.getBucket(g);if(ot){var ht=ot.programConfigurations.get(g.id),vt=p.context.program.get(),Nt=p.useProgram(Oe,ht),Gt=Ee||Nt.program!==vt,en=ae.constantOr(null);if(en&&ut.imageAtlas){var vn=ut.imageAtlas,wn=vn.patternPositions[en.to.toString()],Cn=vn.patternPositions[en.from.toString()];wn&&Cn&&ht.setConstantPatternPositions(wn,Cn)}var xi=ve?_g(p,ut,g,Ie):H?SA(p,ut,g,H,Ie):be?ar(p,ut,g,ot.lineClipsArray.length):Of(p,ut,g);if(ve)Fe.activeTexture.set(Xe.TEXTURE0),ut.imageAtlasTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE),ht.updatePaintBuffers(Ie);else if(H&&(Gt||p.lineAtlas.dirty))Fe.activeTexture.set(Xe.TEXTURE0),p.lineAtlas.bind(Fe);else if(be){var rn=ot.gradients[g.id],On=rn.texture;if(g.gradientVersion!==rn.version){var Hn=256;if(g.stepInterpolant){var Fn=_.getSource().maxzoom,Gn=nt.canonical.z===Fn?Math.ceil(1<<p.transform.maxZoom-nt.canonical.z):1;Hn=s.clamp(s.nextPowerOfTwo(ot.maxLineLength/s.EXTENT*1024*Gn),256,Fe.maxTextureSize)}rn.gradient=s.renderColorRamp({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:Hn,image:rn.gradient||void 0,clips:ot.lineClipsArray}),rn.texture?rn.texture.update(rn.gradient):rn.texture=new s.Texture(Fe,rn.gradient,Xe.RGBA),rn.version=g.gradientVersion,On=rn.texture}Fe.activeTexture.set(Xe.TEXTURE0),On.bind(g.stepInterpolant?Xe.NEAREST:Xe.LINEAR,Xe.CLAMP_TO_EDGE)}Nt.draw(Fe,Xe.TRIANGLES,F,p.stencilModeForClipping(nt),B,ze.disabled,xi,g.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,g.paint,p.transform.zoom,ht,ot.layoutVertexBuffer2),Ee=!1}}}}},fill:function(p,_,g,b){var E=g.paint.get("fill-color"),L=g.paint.get("fill-opacity");if(L.constantOr(1)!==0){var F=p.colorModeForRenderPass(),B=g.paint.get("fill-pattern"),H=p.opaquePassEnabledForLayer()&&!B.constantOr(1)&&E.constantOr(s.Color.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===H){var ae=p.depthModeForSublayer(1,p.renderPass==="opaque"?xe.ReadWrite:xe.ReadOnly);xg(p,_,g,b,ae,F,!1)}if(p.renderPass==="translucent"&&g.paint.get("fill-antialias")){var ve=p.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,xe.ReadOnly);xg(p,_,g,b,ve,F,!0)}}},"fill-extrusion":function(p,_,g,b){var E=g.paint.get("fill-extrusion-opacity");if(E!==0&&p.renderPass==="translucent"){var L=new xe(p.context.gl.LEQUAL,xe.ReadWrite,p.depthRangeFor3D);if(E!==1||g.paint.get("fill-extrusion-pattern").constantOr(1))o_(p,_,g,b,L,Ae.disabled,Ye.disabled),o_(p,_,g,b,L,p.stencilModeFor3D(),p.colorModeForRenderPass());else{var F=p.colorModeForRenderPass();o_(p,_,g,b,L,Ae.disabled,F)}}},hillshade:function(p,_,g,b){if(p.renderPass==="offscreen"||p.renderPass==="translucent"){for(var E=p.context,L=p.depthModeForSublayer(0,xe.ReadOnly),F=p.colorModeForRenderPass(),B=p.renderPass==="translucent"?p.stencilConfigForOverlap(b):[{},b],H=B[0],ae=0,ve=B[1];ae<ve.length;ae+=1){var be=ve[ae],Ie=_.getTile(be);Ie.needsHillshadePrepare&&p.renderPass==="offscreen"?TA(p,Ie,g,L,Ae.disabled,F):p.renderPass==="translucent"&&Ig(p,Ie,g,L,H[be.overscaledZ],F)}E.viewport.set([0,0,p.width,p.height])}},raster:function(p,_,g,b){if(p.renderPass==="translucent"&&g.paint.get("raster-opacity")!==0&&b.length)for(var E=p.context,L=E.gl,F=_.getSource(),B=p.useProgram("raster"),H=p.colorModeForRenderPass(),ae=F instanceof q?[{},b]:p.stencilConfigForOverlap(b),ve=ae[0],be=ae[1],Ie=be[be.length-1].overscaledZ,Oe=!p.options.moving,Fe=0,Xe=be;Fe<Xe.length;Fe+=1){var Ee=Xe[Fe],Ue=p.depthModeForSublayer(Ee.overscaledZ-Ie,g.paint.get("raster-opacity")===1?xe.ReadWrite:xe.ReadOnly,L.LESS),je=_.getTile(Ee),nt=p.transform.calculatePosMatrix(Ee.toUnwrapped(),Oe);je.registerFadeDuration(g.paint.get("raster-fade-duration"));var ut=_.findLoadedParent(Ee,0),ot=Cg(je,ut,_,g,p.transform),ht=void 0,vt=void 0,Nt=g.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;E.activeTexture.set(L.TEXTURE0),je.texture.bind(Nt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(L.TEXTURE1),ut?(ut.texture.bind(Nt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),ht=Math.pow(2,ut.tileID.overscaledZ-je.tileID.overscaledZ),vt=[je.tileID.canonical.x*ht%1,je.tileID.canonical.y*ht%1]):je.texture.bind(Nt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);var Gt=EA(nt,vt||[0,0],ht||1,ot,g);F instanceof q?B.draw(E,L.TRIANGLES,Ue,Ae.disabled,H,ze.disabled,Gt,g.id,F.boundsBuffer,p.quadTriangleIndexBuffer,F.boundsSegments):B.draw(E,L.TRIANGLES,Ue,ve[Ee.overscaledZ],H,ze.disabled,Gt,g.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}},background:function(p,_,g){var b=g.paint.get("background-color"),E=g.paint.get("background-opacity");if(E!==0){var L=p.context,F=L.gl,B=p.transform,H=B.tileSize,ae=g.paint.get("background-pattern");if(!p.isPatternMissing(ae)){var ve=!ae&&b.a===1&&E===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass===ve){var be=Ae.disabled,Ie=p.depthModeForSublayer(0,ve==="opaque"?xe.ReadWrite:xe.ReadOnly),Oe=p.colorModeForRenderPass(),Fe=p.useProgram(ae?"backgroundPattern":"background"),Xe=B.coveringTiles({tileSize:H});ae&&(L.activeTexture.set(F.TEXTURE0),p.imageManager.bind(p.context));for(var Ee=g.getCrossfadeParameters(),Ue=0,je=Xe;Ue<je.length;Ue+=1){var nt=je[Ue],ut=p.transform.calculatePosMatrix(nt.toUnwrapped()),ot=ae?pd(ut,E,p,ae,{tileID:nt,tileSize:H},Ee):Df(ut,E,b);Fe.draw(L,F.TRIANGLES,Ie,be,Oe,ze.disabled,ot,g.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}}}},debug:function(p,_,g){for(var b=0;b<g.length;b++)u1(p,_,g[b])},custom:function(p,_,g){var b=p.context,E=g.implementation;if(p.renderPass==="offscreen"){var L=E.prerender;L&&(p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),L.call(E,b.gl,p.transform.customLayerMatrix()),b.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),b.setStencilMode(Ae.disabled);var F=E.renderingMode==="3d"?new xe(p.context.gl.LEQUAL,xe.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,xe.ReadOnly);b.setDepthMode(F),E.render(b.gl,p.transform.customLayerMatrix()),b.setDirty(),p.setBaseState(),b.bindFramebuffer.set(null)}}},Ir=function(p,_){this.context=new ye(p),this.transform=_,this._tileTextures={},this.setup(),this.numSublayers=Se.maxUnderzooming+Se.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zu,this.gpuTimers={}};Ir.prototype.resize=function(p,_){if(this.width=p*s.browser.devicePixelRatio,this.height=_*s.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var g=0,b=this.style._order;g<b.length;g+=1)this.style._layers[b[g]].resize()},Ir.prototype.setup=function(){var p=this.context,_=new s.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(s.EXTENT,0),_.emplaceBack(0,s.EXTENT),_.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=p.createVertexBuffer(_,qr.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);var g=new s.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(s.EXTENT,0),g.emplaceBack(0,s.EXTENT),g.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=p.createVertexBuffer(g,qr.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);var b=new s.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(s.EXTENT,0,s.EXTENT,0),b.emplaceBack(0,s.EXTENT,0,s.EXTENT),b.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=p.createVertexBuffer(b,Q.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);var E=new s.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=p.createVertexBuffer(E,qr.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);var L=new s.StructArrayLayout1ui2;L.emplaceBack(0),L.emplaceBack(1),L.emplaceBack(3),L.emplaceBack(2),L.emplaceBack(0),this.tileBorderIndexBuffer=p.createIndexBuffer(L);var F=new s.StructArrayLayout3ui6;F.emplaceBack(0,1,2),F.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=p.createIndexBuffer(F),this.emptyTexture=new s.Texture(p,{width:1,height:1,data:new Uint8Array([0,0,0,0])},p.gl.RGBA);var B=this.context.gl;this.stencilClearMode=new Ae({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)},Ir.prototype.clearStencil=function(){var p=this.context,_=p.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var g=s.create();s.ortho(g,0,this.width,this.height,0,0,1),s.scale(g,g,[_.drawingBufferWidth,_.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(p,_.TRIANGLES,xe.disabled,this.stencilClearMode,Ye.disabled,ze.disabled,Qc(g),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ir.prototype._renderTileClippingMasks=function(p,_){if(this.currentStencilSource!==p.source&&p.isTileClipped()&&_&&_.length){this.currentStencilSource=p.source;var g=this.context,b=g.gl;this.nextStencilID+_.length>256&&this.clearStencil(),g.setColorMode(Ye.disabled),g.setDepthMode(xe.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var L=0,F=_;L<F.length;L+=1){var B=F[L],H=this._tileClippingMaskIDs[B.key]=this.nextStencilID++;E.draw(g,b.TRIANGLES,xe.disabled,new Ae({func:b.ALWAYS,mask:0},H,255,b.KEEP,b.KEEP,b.REPLACE),Ye.disabled,ze.disabled,Qc(B.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ir.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var p=this.nextStencilID++,_=this.context.gl;return new Ae({func:_.NOTEQUAL,mask:255},p,255,_.KEEP,_.KEEP,_.REPLACE)},Ir.prototype.stencilModeForClipping=function(p){var _=this.context.gl;return new Ae({func:_.EQUAL,mask:255},this._tileClippingMaskIDs[p.key],0,_.KEEP,_.KEEP,_.REPLACE)},Ir.prototype.stencilConfigForOverlap=function(p){var _,g=this.context.gl,b=p.sort((function(H,ae){return ae.overscaledZ-H.overscaledZ})),E=b[b.length-1].overscaledZ,L=b[0].overscaledZ-E+1;if(L>1){this.currentStencilSource=void 0,this.nextStencilID+L>256&&this.clearStencil();for(var F={},B=0;B<L;B++)F[B+E]=new Ae({func:g.GEQUAL,mask:255},B+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=L,[F,b]}return[(_={},_[E]=Ae.disabled,_),b]},Ir.prototype.colorModeForRenderPass=function(){var p=this.context.gl;return this._showOverdrawInspector?new Ye([p.CONSTANT_COLOR,p.ONE],new s.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ye.unblended:Ye.alphaBlended},Ir.prototype.depthModeForSublayer=function(p,_,g){if(!this.opaquePassEnabledForLayer())return xe.disabled;var b=1-((1+this.currentLayer)*this.numSublayers+p)*this.depthEpsilon;return new xe(g||this.context.gl.LEQUAL,_,[b,b])},Ir.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ir.prototype.render=function(p,_){var g=this;this.style=p,this.options=_,this.lineAtlas=p.lineAtlas,this.imageManager=p.imageManager,this.glyphManager=p.glyphManager,this.symbolFadeChange=p.placement.symbolFadeChange(s.browser.now()),this.imageManager.beginFrame();var b=this.style._order,E=this.style.sourceCaches;for(var L in E){var F=E[L];F.used&&F.prepare(this.context)}var B,H,ae={},ve={},be={};for(var Ie in E){var Oe=E[Ie];ae[Ie]=Oe.getVisibleCoordinates(),ve[Ie]=ae[Ie].slice().reverse(),be[Ie]=Oe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Fe=0;Fe<b.length;Fe++)if(this.style._layers[b[Fe]].is3D()){this.opaquePassCutoff=Fe;break}this.renderPass="offscreen";for(var Xe=0,Ee=b;Xe<Ee.length;Xe+=1){var Ue=this.style._layers[Ee[Xe]];if(Ue.hasOffscreenPass()&&!Ue.isHidden(this.transform.zoom)){var je=ve[Ue.source];(Ue.type==="custom"||je.length)&&this.renderLayer(this,E[Ue.source],Ue,je)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:_.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=_.showOverdrawInspector,this.depthRangeFor3D=[0,1-(p._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){var nt=this.style._layers[b[this.currentLayer]],ut=E[nt.source],ot=ae[nt.source];this._renderTileClippingMasks(nt,ot),this.renderLayer(this,ut,nt,ot)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){var ht=this.style._layers[b[this.currentLayer]],vt=E[ht.source],Nt=(ht.type==="symbol"?be:ve)[ht.source];this._renderTileClippingMasks(ht,ae[ht.source]),this.renderLayer(this,vt,ht,Nt)}this.options.showTileBoundaries&&(s.values(this.style._layers).forEach((function(Gt){Gt.source&&!Gt.isHidden(g.transform.zoom)&&(Gt.source!==(H&&H.id)&&(H=g.style.sourceCaches[Gt.source]),(!B||B.getSource().maxzoom<H.getSource().maxzoom)&&(B=H))})),B&&th.debug(this,B,B.getVisibleCoordinates())),this.options.showPadding&&(function(Gt){var en=Gt.transform.padding;u_(Gt,Gt.transform.height-(en.top||0),3,a_),u_(Gt,en.bottom||0,3,a1),c_(Gt,en.left||0,3,l1),c_(Gt,Gt.transform.width-(en.right||0),3,wg);var vn=Gt.transform.centerPoint;(function(wn,Cn,xi,rn){Bf(wn,Cn-1,xi-10,2,20,rn),Bf(wn,Cn-10,xi-1,20,2,rn)})(Gt,vn.x,Gt.transform.height-vn.y,l_)})(this),this.context.setDefault()},Ir.prototype.renderLayer=function(p,_,g,b){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="custom"||b.length)&&(this.id=g.id,this.gpuTimingStart(g),th[g.type](p,_,g,b,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ir.prototype.gpuTimingStart=function(p){if(this.options.gpuTiming){var _=this.context.extTimerQuery,g=this.gpuTimers[p.id];g||(g=this.gpuTimers[p.id]={calls:0,cpuTime:0,query:_.createQueryEXT()}),g.calls++,_.beginQueryEXT(_.TIME_ELAPSED_EXT,g.query)}},Ir.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var p=this.context.extTimerQuery;p.endQueryEXT(p.TIME_ELAPSED_EXT)}},Ir.prototype.collectGpuTimers=function(){var p=this.gpuTimers;return this.gpuTimers={},p},Ir.prototype.queryGpuTimers=function(p){var _={};for(var g in p){var b=p[g],E=this.context.extTimerQuery,L=E.getQueryObjectEXT(b.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(b.query),_[g]=L}return _},Ir.prototype.translatePosMatrix=function(p,_,g,b,E){if(!g[0]&&!g[1])return p;var L=E?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(L){var F=Math.sin(L),B=Math.cos(L);g=[g[0]*B-g[1]*F,g[0]*F+g[1]*B]}var H=[E?g[0]:xr(_,g[0],this.transform.zoom),E?g[1]:xr(_,g[1],this.transform.zoom),0],ae=new Float32Array(16);return s.translate(ae,p,H),ae},Ir.prototype.saveTileTexture=function(p){var _=this._tileTextures[p.size[0]];_?_.push(p):this._tileTextures[p.size[0]]=[p]},Ir.prototype.getTileTexture=function(p){var _=this._tileTextures[p];return _&&_.length>0?_.pop():null},Ir.prototype.isPatternMissing=function(p){if(!p)return!1;if(!p.from||!p.to)return!0;var _=this.imageManager.getPattern(p.from.toString()),g=this.imageManager.getPattern(p.to.toString());return!_||!g},Ir.prototype.useProgram=function(p,_){this.cache=this.cache||{};var g=""+p+(_?_.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[g]||(this.cache[g]=new Kb(this.context,p,AA[p],_,i1[p],this._showOverdrawInspector)),this.cache[g]},Ir.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ir.prototype.setBaseState=function(){var p=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(p.FUNC_ADD)},Ir.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ir.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Ag=function(p,_){this.points=p,this.planes=_};Ag.fromInvProjectionMatrix=function(p,_,g){var b=Math.pow(2,g),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(F){return s.transformMat4([],F,p)})).map((function(F){return s.scale$1([],F,1/F[3]/_*b)})),L=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(F){var B=s.sub([],E[F[0]],E[F[1]]),H=s.sub([],E[F[2]],E[F[1]]),ae=s.normalize([],s.cross([],B,H)),ve=-s.dot(ae,E[F[1]]);return ae.concat(ve)}));return new Ag(E,L)};var nh=function(p,_){this.min=p,this.max=_,this.center=s.scale$2([],s.add([],this.min,this.max),.5)};nh.prototype.quadrant=function(p){for(var _=[p%2==0,p<2],g=s.clone$2(this.min),b=s.clone$2(this.max),E=0;E<_.length;E++)g[E]=_[E]?this.min[E]:this.center[E],b[E]=_[E]?this.center[E]:this.max[E];return b[2]=this.max[2],new nh(g,b)},nh.prototype.distanceX=function(p){return Math.max(Math.min(this.max[0],p[0]),this.min[0])-p[0]},nh.prototype.distanceY=function(p){return Math.max(Math.min(this.max[1],p[1]),this.min[1])-p[1]},nh.prototype.intersects=function(p){for(var _=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],g=!0,b=0;b<p.planes.length;b++){for(var E=p.planes[b],L=0,F=0;F<_.length;F++)L+=s.dot$1(E,_[F])>=0;if(L===0)return 0;L!==_.length&&(g=!1)}if(g)return 2;for(var B=0;B<3;B++){for(var H=Number.MAX_VALUE,ae=-Number.MAX_VALUE,ve=0;ve<p.points.length;ve++){var be=p.points[ve][B]-this.min[B];H=Math.min(H,be),ae=Math.max(ae,be)}if(ae<0||H>this.max[B]-this.min[B])return 0}return 1};var Ju=function(p,_,g,b){if(p===void 0&&(p=0),_===void 0&&(_=0),g===void 0&&(g=0),b===void 0&&(b=0),isNaN(p)||p<0||isNaN(_)||_<0||isNaN(g)||g<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=p,this.bottom=_,this.left=g,this.right=b};Ju.prototype.interpolate=function(p,_,g){return _.top!=null&&p.top!=null&&(this.top=s.number(p.top,_.top,g)),_.bottom!=null&&p.bottom!=null&&(this.bottom=s.number(p.bottom,_.bottom,g)),_.left!=null&&p.left!=null&&(this.left=s.number(p.left,_.left,g)),_.right!=null&&p.right!=null&&(this.right=s.number(p.right,_.right,g)),this},Ju.prototype.getCenter=function(p,_){var g=s.clamp((this.left+p-this.right)/2,0,p),b=s.clamp((this.top+_-this.bottom)/2,0,_);return new s.Point(g,b)},Ju.prototype.equals=function(p){return this.top===p.top&&this.bottom===p.bottom&&this.left===p.left&&this.right===p.right},Ju.prototype.clone=function(){return new Ju(this.top,this.bottom,this.left,this.right)},Ju.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var gi=function(p,_,g,b,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=p||0,this._maxZoom=_||22,this._minPitch=g??0,this._maxPitch=b??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ju,this._posMatrixCache={},this._alignedPosMatrixCache={}},lr={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};gi.prototype.clone=function(){var p=new gi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return p.tileSize=this.tileSize,p.latRange=this.latRange,p.width=this.width,p.height=this.height,p._center=this._center,p.zoom=this.zoom,p.angle=this.angle,p._fov=this._fov,p._pitch=this._pitch,p._unmodified=this._unmodified,p._edgeInsets=this._edgeInsets.clone(),p._calcMatrices(),p},lr.minZoom.get=function(){return this._minZoom},lr.minZoom.set=function(p){this._minZoom!==p&&(this._minZoom=p,this.zoom=Math.max(this.zoom,p))},lr.maxZoom.get=function(){return this._maxZoom},lr.maxZoom.set=function(p){this._maxZoom!==p&&(this._maxZoom=p,this.zoom=Math.min(this.zoom,p))},lr.minPitch.get=function(){return this._minPitch},lr.minPitch.set=function(p){this._minPitch!==p&&(this._minPitch=p,this.pitch=Math.max(this.pitch,p))},lr.maxPitch.get=function(){return this._maxPitch},lr.maxPitch.set=function(p){this._maxPitch!==p&&(this._maxPitch=p,this.pitch=Math.min(this.pitch,p))},lr.renderWorldCopies.get=function(){return this._renderWorldCopies},lr.renderWorldCopies.set=function(p){p===void 0?p=!0:p===null&&(p=!1),this._renderWorldCopies=p},lr.worldSize.get=function(){return this.tileSize*this.scale},lr.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},lr.size.get=function(){return new s.Point(this.width,this.height)},lr.bearing.get=function(){return-this.angle/Math.PI*180},lr.bearing.set=function(p){var _=-s.wrap(p,-180,180)*Math.PI/180;this.angle!==_&&(this._unmodified=!1,this.angle=_,this._calcMatrices(),this.rotationMatrix=s.create$2(),s.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},lr.pitch.get=function(){return this._pitch/Math.PI*180},lr.pitch.set=function(p){var _=s.clamp(p,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==_&&(this._unmodified=!1,this._pitch=_,this._calcMatrices())},lr.fov.get=function(){return this._fov/Math.PI*180},lr.fov.set=function(p){p=Math.max(.01,Math.min(60,p)),this._fov!==p&&(this._unmodified=!1,this._fov=p/180*Math.PI,this._calcMatrices())},lr.zoom.get=function(){return this._zoom},lr.zoom.set=function(p){var _=Math.min(Math.max(p,this.minZoom),this.maxZoom);this._zoom!==_&&(this._unmodified=!1,this._zoom=_,this.scale=this.zoomScale(_),this.tileZoom=Math.floor(_),this.zoomFraction=_-this.tileZoom,this._constrain(),this._calcMatrices())},lr.center.get=function(){return this._center},lr.center.set=function(p){p.lat===this._center.lat&&p.lng===this._center.lng||(this._unmodified=!1,this._center=p,this._constrain(),this._calcMatrices())},lr.padding.get=function(){return this._edgeInsets.toJSON()},lr.padding.set=function(p){this._edgeInsets.equals(p)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,p,1),this._calcMatrices())},lr.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},gi.prototype.isPaddingEqual=function(p){return this._edgeInsets.equals(p)},gi.prototype.interpolatePadding=function(p,_,g){this._unmodified=!1,this._edgeInsets.interpolate(p,_,g),this._constrain(),this._calcMatrices()},gi.prototype.coveringZoomLevel=function(p){var _=(p.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/p.tileSize));return Math.max(0,_)},gi.prototype.getVisibleUnwrappedCoordinates=function(p){var _=[new s.UnwrappedTileID(0,p)];if(this._renderWorldCopies)for(var g=this.pointCoordinate(new s.Point(0,0)),b=this.pointCoordinate(new s.Point(this.width,0)),E=this.pointCoordinate(new s.Point(this.width,this.height)),L=this.pointCoordinate(new s.Point(0,this.height)),F=Math.floor(Math.min(g.x,b.x,E.x,L.x)),B=Math.floor(Math.max(g.x,b.x,E.x,L.x)),H=F-1;H<=B+1;H++)H!==0&&_.push(new s.UnwrappedTileID(H,p));return _},gi.prototype.coveringTiles=function(p){var _=this.coveringZoomLevel(p),g=_;if(p.minzoom!==void 0&&_<p.minzoom)return[];p.maxzoom!==void 0&&_>p.maxzoom&&(_=p.maxzoom);var b=s.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,_),L=[E*b.x,E*b.y,0],F=Ag.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_),B=p.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(B=_);var H=function(Gt){return{aabb:new nh([Gt*E,0,0],[(Gt+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Gt,fullyVisible:!1}},ae=[],ve=[],be=_,Ie=p.reparseOverscaled?g:_;if(this._renderWorldCopies)for(var Oe=1;Oe<=3;Oe++)ae.push(H(-Oe)),ae.push(H(Oe));for(ae.push(H(0));ae.length>0;){var Fe=ae.pop(),Xe=Fe.x,Ee=Fe.y,Ue=Fe.fullyVisible;if(!Ue){var je=Fe.aabb.intersects(F);if(je===0)continue;Ue=je===2}var nt=Fe.aabb.distanceX(L),ut=Fe.aabb.distanceY(L),ot=Math.max(Math.abs(nt),Math.abs(ut));if(Fe.zoom===be||ot>3+(1<<be-Fe.zoom)-2&&Fe.zoom>=B)ve.push({tileID:new s.OverscaledTileID(Fe.zoom===be?Ie:Fe.zoom,Fe.wrap,Fe.zoom,Xe,Ee),distanceSq:s.sqrLen([L[0]-.5-Xe,L[1]-.5-Ee])});else for(var ht=0;ht<4;ht++){var vt=(Xe<<1)+ht%2,Nt=(Ee<<1)+(ht>>1);ae.push({aabb:Fe.aabb.quadrant(ht),zoom:Fe.zoom+1,x:vt,y:Nt,wrap:Fe.wrap,fullyVisible:Ue})}}return ve.sort((function(Gt,en){return Gt.distanceSq-en.distanceSq})).map((function(Gt){return Gt.tileID}))},gi.prototype.resize=function(p,_){this.width=p,this.height=_,this.pixelsToGLUnits=[2/p,-2/_],this._constrain(),this._calcMatrices()},lr.unmodified.get=function(){return this._unmodified},gi.prototype.zoomScale=function(p){return Math.pow(2,p)},gi.prototype.scaleZoom=function(p){return Math.log(p)/Math.LN2},gi.prototype.project=function(p){var _=s.clamp(p.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.Point(s.mercatorXfromLng(p.lng)*this.worldSize,s.mercatorYfromLat(_)*this.worldSize)},gi.prototype.unproject=function(p){return new s.MercatorCoordinate(p.x/this.worldSize,p.y/this.worldSize).toLngLat()},lr.point.get=function(){return this.project(this.center)},gi.prototype.setLocationAtPoint=function(p,_){var g=this.pointCoordinate(_),b=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(p),L=new s.MercatorCoordinate(E.x-(g.x-b.x),E.y-(g.y-b.y));this.center=this.coordinateLocation(L),this._renderWorldCopies&&(this.center=this.center.wrap())},gi.prototype.locationPoint=function(p){return this.coordinatePoint(this.locationCoordinate(p))},gi.prototype.pointLocation=function(p){return this.coordinateLocation(this.pointCoordinate(p))},gi.prototype.locationCoordinate=function(p){return s.MercatorCoordinate.fromLngLat(p)},gi.prototype.coordinateLocation=function(p){return p.toLngLat()},gi.prototype.pointCoordinate=function(p){var _=[p.x,p.y,0,1],g=[p.x,p.y,1,1];s.transformMat4(_,_,this.pixelMatrixInverse),s.transformMat4(g,g,this.pixelMatrixInverse);var b=_[3],E=g[3],L=_[1]/b,F=g[1]/E,B=_[2]/b,H=g[2]/E,ae=B===H?0:(0-B)/(H-B);return new s.MercatorCoordinate(s.number(_[0]/b,g[0]/E,ae)/this.worldSize,s.number(L,F,ae)/this.worldSize)},gi.prototype.coordinatePoint=function(p){var _=[p.x*this.worldSize,p.y*this.worldSize,0,1];return s.transformMat4(_,_,this.pixelMatrix),new s.Point(_[0]/_[3],_[1]/_[3])},gi.prototype.getBounds=function(){return new s.LngLatBounds().extend(this.pointLocation(new s.Point(0,0))).extend(this.pointLocation(new s.Point(this.width,0))).extend(this.pointLocation(new s.Point(this.width,this.height))).extend(this.pointLocation(new s.Point(0,this.height)))},gi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},gi.prototype.setMaxBounds=function(p){p?(this.lngRange=[p.getWest(),p.getEast()],this.latRange=[p.getSouth(),p.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},gi.prototype.calculatePosMatrix=function(p,_){_===void 0&&(_=!1);var g=p.key,b=_?this._alignedPosMatrixCache:this._posMatrixCache;if(b[g])return b[g];var E=p.canonical,L=this.worldSize/this.zoomScale(E.z),F=E.x+Math.pow(2,E.z)*p.wrap,B=s.identity(new Float64Array(16));return s.translate(B,B,[F*L,E.y*L,0]),s.scale(B,B,[L/s.EXTENT,L/s.EXTENT,1]),s.multiply(B,_?this.alignedProjMatrix:this.projMatrix,B),b[g]=new Float32Array(B),b[g]},gi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},gi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var p,_,g,b,E=-90,L=90,F=-180,B=180,H=this.size,ae=this._unmodified;if(this.latRange){var ve=this.latRange;E=s.mercatorYfromLat(ve[1])*this.worldSize,p=(L=s.mercatorYfromLat(ve[0])*this.worldSize)-E<H.y?H.y/(L-E):0}if(this.lngRange){var be=this.lngRange;F=s.mercatorXfromLng(be[0])*this.worldSize,_=(B=s.mercatorXfromLng(be[1])*this.worldSize)-F<H.x?H.x/(B-F):0}var Ie=this.point,Oe=Math.max(_||0,p||0);if(Oe)return this.center=this.unproject(new s.Point(_?(B+F)/2:Ie.x,p?(L+E)/2:Ie.y)),this.zoom+=this.scaleZoom(Oe),this._unmodified=ae,void(this._constraining=!1);if(this.latRange){var Fe=Ie.y,Xe=H.y/2;Fe-Xe<E&&(b=E+Xe),Fe+Xe>L&&(b=L-Xe)}if(this.lngRange){var Ee=Ie.x,Ue=H.x/2;Ee-Ue<F&&(g=F+Ue),Ee+Ue>B&&(g=B-Ue)}g===void 0&&b===void 0||(this.center=this.unproject(new s.Point(g!==void 0?g:Ie.x,b!==void 0?b:Ie.y))),this._unmodified=ae,this._constraining=!1}},gi.prototype._calcMatrices=function(){if(this.height){var p=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var _=Math.PI/2+this._pitch,g=this._fov*(.5+p.y/this.height),b=Math.sin(g)*this.cameraToCenterDistance/Math.sin(s.clamp(Math.PI-_-g,.01,Math.PI-.01)),E=this.point,L=E.x,F=E.y,B=1.01*(Math.cos(Math.PI/2-this._pitch)*b+this.cameraToCenterDistance),H=this.height/50,ae=new Float64Array(16);s.perspective(ae,this._fov,this.width/this.height,H,B),ae[8]=2*-p.x/this.width,ae[9]=2*p.y/this.height,s.scale(ae,ae,[1,-1,1]),s.translate(ae,ae,[0,0,-this.cameraToCenterDistance]),s.rotateX(ae,ae,this._pitch),s.rotateZ(ae,ae,this.angle),s.translate(ae,ae,[-L,-F,0]),this.mercatorMatrix=s.scale([],ae,[this.worldSize,this.worldSize,this.worldSize]),s.scale(ae,ae,[1,1,s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ae,this.invProjMatrix=s.invert([],this.projMatrix);var ve=this.width%2/2,be=this.height%2/2,Ie=Math.cos(this.angle),Oe=Math.sin(this.angle),Fe=L-Math.round(L)+Ie*ve+Oe*be,Xe=F-Math.round(F)+Ie*be+Oe*ve,Ee=new Float64Array(ae);if(s.translate(Ee,Ee,[Fe>.5?Fe-1:Fe,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=Ee,ae=s.create(),s.scale(ae,ae,[this.width/2,-this.height/2,1]),s.translate(ae,ae,[1,-1,0]),this.labelPlaneMatrix=ae,ae=s.create(),s.scale(ae,ae,[1,-1,1]),s.translate(ae,ae,[-1,-1,0]),s.scale(ae,ae,[2/this.width,2/this.height,1]),this.glCoordMatrix=ae,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ae=s.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ae,this._posMatrixCache={},this._alignedPosMatrixCache={}}},gi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var p=this.pointCoordinate(new s.Point(0,0)),_=[p.x*this.worldSize,p.y*this.worldSize,0,1];return s.transformMat4(_,_,this.pixelMatrix)[3]/this.cameraToCenterDistance},gi.prototype.getCameraPoint=function(){var p=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,p))},gi.prototype.getCameraQueryGeometry=function(p){var _=this.getCameraPoint();if(p.length===1)return[p[0],_];for(var g=_.x,b=_.y,E=_.x,L=_.y,F=0,B=p;F<B.length;F+=1){var H=B[F];g=Math.min(g,H.x),b=Math.min(b,H.y),E=Math.max(E,H.x),L=Math.max(L,H.y)}return[new s.Point(g,b),new s.Point(E,b),new s.Point(E,L),new s.Point(g,L),new s.Point(g,b)]},Object.defineProperties(gi.prototype,lr);var ha=function(p){var _,g,b,E;this._hashName=p&&encodeURIComponent(p),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(_=this._updateHashUnthrottled.bind(this),g=!1,b=null,E=function(){b=null,g&&(_(),b=setTimeout(E,300),g=!1)},function(){return g=!0,b||E(),b})};ha.prototype.addTo=function(p){return this._map=p,s.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ha.prototype.remove=function(){return s.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ha.prototype.getHashString=function(p){var _=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,b=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),L=Math.round(_.lng*E)/E,F=Math.round(_.lat*E)/E,B=this._map.getBearing(),H=this._map.getPitch(),ae="";if(ae+=p?"/"+L+"/"+F+"/"+g:g+"/"+F+"/"+L,(B||H)&&(ae+="/"+Math.round(10*B)/10),H&&(ae+="/"+Math.round(H)),this._hashName){var ve=this._hashName,be=!1,Ie=s.window.location.hash.slice(1).split("&").map((function(Oe){var Fe=Oe.split("=")[0];return Fe===ve?(be=!0,Fe+"="+ae):Oe})).filter((function(Oe){return Oe}));return be||Ie.push(ve+"="+ae),"#"+Ie.join("&")}return"#"+ae},ha.prototype._getCurrentHash=function(){var p,_=this,g=s.window.location.hash.replace("#","");return this._hashName?(g.split("&").map((function(b){return b.split("=")})).forEach((function(b){b[0]===_._hashName&&(p=b)})),(p&&p[1]||"").split("/")):g.split("/")},ha.prototype._onHashChange=function(){var p=this._getCurrentHash();if(p.length>=3&&!p.some((function(g){return isNaN(g)}))){var _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(p[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:_,pitch:+(p[4]||0)}),!0}return!1},ha.prototype._updateHashUnthrottled=function(){var p=s.window.location.href.replace(/(#.+)?$/,this.getHashString());try{s.window.history.replaceState(s.window.history.state,null,p)}catch{}};var Zf={linearity:.3,easing:s.bezier(0,0,.3,1)},md=s.extend({deceleration:2500,maxSpeed:1400},Zf),Wf=s.extend({deceleration:20,maxSpeed:1400},Zf),RA=s.extend({deceleration:1e3,maxSpeed:360},Zf),MA=s.extend({deceleration:1e3,maxSpeed:90},Zf),zf=function(p){this._map=p,this.clear()};function Uf(p,_){(!p.duration||p.duration<_.duration)&&(p.duration=_.duration,p.easing=_.easing)}function ru(p,_,g){var b=g.maxSpeed,E=g.linearity,L=g.deceleration,F=s.clamp(p*E/(_/1e3),-b,b),B=Math.abs(F)/(L*E);return{easing:g.easing,duration:1e3*B,amount:F*(B/2)}}zf.prototype.clear=function(){this._inertiaBuffer=[]},zf.prototype.record=function(p){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.browser.now(),settings:p})},zf.prototype._drainInertiaBuffer=function(){for(var p=this._inertiaBuffer,_=s.browser.now();p.length>0&&_-p[0].time>160;)p.shift()},zf.prototype._onMoveEnd=function(p){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var _={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0},g=0,b=this._inertiaBuffer;g<b.length;g+=1){var E=b[g].settings;_.zoom+=E.zoomDelta||0,_.bearing+=E.bearingDelta||0,_.pitch+=E.pitchDelta||0,E.panDelta&&_.pan._add(E.panDelta),E.around&&(_.around=E.around),E.pinchAround&&(_.pinchAround=E.pinchAround)}var L=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,F={};if(_.pan.mag()){var B=ru(_.pan.mag(),L,s.extend({},md,p||{}));F.offset=_.pan.mult(B.amount/_.pan.mag()),F.center=this._map.transform.center,Uf(F,B)}if(_.zoom){var H=ru(_.zoom,L,Wf);F.zoom=this._map.transform.zoom+H.amount,Uf(F,H)}if(_.bearing){var ae=ru(_.bearing,L,RA);F.bearing=this._map.transform.bearing+s.clamp(ae.amount,-179,179),Uf(F,ae)}if(_.pitch){var ve=ru(_.pitch,L,MA);F.pitch=this._map.transform.pitch+ve.amount,Uf(F,ve)}if(F.zoom||F.bearing){var be=_.pinchAround===void 0?_.around:_.pinchAround;F.around=be?this._map.unproject(be):this._map.getCenter()}return this.clear(),s.extend(F,{noMoveStart:!0})}};var ss=(function(p){function _(b,E,L,F){F===void 0&&(F={});var B=u.mousePos(E.getCanvasContainer(),L),H=E.unproject(B);p.call(this,b,s.extend({point:B,lngLat:H,originalEvent:L},F)),this._defaultPrevented=!1,this.target=E}p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_;var g={defaultPrevented:{configurable:!0}};return _.prototype.preventDefault=function(){this._defaultPrevented=!0},g.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(_.prototype,g),_})(s.Event),Xf=(function(p){function _(b,E,L){var F=b==="touchend"?L.changedTouches:L.touches,B=u.touchPos(E.getCanvasContainer(),F),H=B.map((function(be){return E.unproject(be)})),ae=B.reduce((function(be,Ie,Oe,Fe){return be.add(Ie.div(Fe.length))}),new s.Point(0,0)),ve=E.unproject(ae);p.call(this,b,{points:B,point:ae,lngLats:H,lngLat:ve,originalEvent:L}),this._defaultPrevented=!1}p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_;var g={defaultPrevented:{configurable:!0}};return _.prototype.preventDefault=function(){this._defaultPrevented=!0},g.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(_.prototype,g),_})(s.Event),c1=(function(p){function _(b,E,L){p.call(this,b,{originalEvent:L}),this._defaultPrevented=!1}p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_;var g={defaultPrevented:{configurable:!0}};return _.prototype.preventDefault=function(){this._defaultPrevented=!0},g.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(_.prototype,g),_})(s.Event),Qr=function(p,_){this._map=p,this._clickTolerance=_.clickTolerance};Qr.prototype.reset=function(){delete this._mousedownPos},Qr.prototype.wheel=function(p){return this._firePreventable(new c1(p.type,this._map,p))},Qr.prototype.mousedown=function(p,_){return this._mousedownPos=_,this._firePreventable(new ss(p.type,this._map,p))},Qr.prototype.mouseup=function(p){this._map.fire(new ss(p.type,this._map,p))},Qr.prototype.click=function(p,_){this._mousedownPos&&this._mousedownPos.dist(_)>=this._clickTolerance||this._map.fire(new ss(p.type,this._map,p))},Qr.prototype.dblclick=function(p){return this._firePreventable(new ss(p.type,this._map,p))},Qr.prototype.mouseover=function(p){this._map.fire(new ss(p.type,this._map,p))},Qr.prototype.mouseout=function(p){this._map.fire(new ss(p.type,this._map,p))},Qr.prototype.touchstart=function(p){return this._firePreventable(new Xf(p.type,this._map,p))},Qr.prototype.touchmove=function(p){this._map.fire(new Xf(p.type,this._map,p))},Qr.prototype.touchend=function(p){this._map.fire(new Xf(p.type,this._map,p))},Qr.prototype.touchcancel=function(p){this._map.fire(new Xf(p.type,this._map,p))},Qr.prototype._firePreventable=function(p){if(this._map.fire(p),p.defaultPrevented)return{}},Qr.prototype.isEnabled=function(){return!0},Qr.prototype.isActive=function(){return!1},Qr.prototype.enable=function(){},Qr.prototype.disable=function(){};var sn=function(p){this._map=p};sn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},sn.prototype.mousemove=function(p){this._map.fire(new ss(p.type,this._map,p))},sn.prototype.mousedown=function(){this._delayContextMenu=!0},sn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ss("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},sn.prototype.contextmenu=function(p){this._delayContextMenu?this._contextMenuEvent=p:this._map.fire(new ss(p.type,this._map,p)),this._map.listens("contextmenu")&&p.preventDefault()},sn.prototype.isEnabled=function(){return!0},sn.prototype.isActive=function(){return!1},sn.prototype.enable=function(){},sn.prototype.disable=function(){};var No=function(p,_){this._map=p,this._el=p.getCanvasContainer(),this._container=p.getContainer(),this._clickTolerance=_.clickTolerance||1};function Sg(p,_){for(var g={},b=0;b<p.length;b++)g[p[b].identifier]=_[b];return g}No.prototype.isEnabled=function(){return!!this._enabled},No.prototype.isActive=function(){return!!this._active},No.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},No.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},No.prototype.mousedown=function(p,_){this.isEnabled()&&p.shiftKey&&p.button===0&&(u.disableDrag(),this._startPos=this._lastPos=_,this._active=!0)},No.prototype.mousemoveWindow=function(p,_){if(this._active){var g=_;if(!(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)){var b=this._startPos;this._lastPos=g,this._box||(this._box=u.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",p));var E=Math.min(b.x,g.x),L=Math.max(b.x,g.x),F=Math.min(b.y,g.y),B=Math.max(b.y,g.y);u.setTransform(this._box,"translate("+E+"px,"+F+"px)"),this._box.style.width=L-E+"px",this._box.style.height=B-F+"px"}}},No.prototype.mouseupWindow=function(p,_){var g=this;if(this._active&&p.button===0){var b=this._startPos,E=_;if(this.reset(),u.suppressClick(),b.x!==E.x||b.y!==E.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:p})),{cameraAnimation:function(L){return L.fitScreenCoordinates(b,E,g._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",p)}},No.prototype.keydown=function(p){this._active&&p.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",p))},No.prototype.blur=function(){this.reset()},No.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(u.remove(this._box),this._box=null),u.enableDrag(),delete this._startPos,delete this._lastPos},No.prototype._fireEvent=function(p,_){return this._map.fire(new s.Event(p,{originalEvent:_}))};var yd=function(p){this.reset(),this.numTouches=p.numTouches};yd.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},yd.prototype.touchstart=function(p,_,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=p.timeStamp),g.length===this.numTouches&&(this.centroid=(function(b){for(var E=new s.Point(0,0),L=0,F=b;L<F.length;L+=1)E._add(F[L]);return E.div(b.length)})(_),this.touches=Sg(g,_)))},yd.prototype.touchmove=function(p,_,g){if(!this.aborted&&this.centroid){var b=Sg(g,_);for(var E in this.touches){var L=b[E];(!L||L.dist(this.touches[E])>30)&&(this.aborted=!0)}}},yd.prototype.touchend=function(p,_,g){if((!this.centroid||p.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){var b=!this.aborted&&this.centroid;if(this.reset(),b)return b}};var sl=function(p){this.singleTap=new yd(p),this.numTaps=p.numTaps,this.reset()};sl.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},sl.prototype.touchstart=function(p,_,g){this.singleTap.touchstart(p,_,g)},sl.prototype.touchmove=function(p,_,g){this.singleTap.touchmove(p,_,g)},sl.prototype.touchend=function(p,_,g){var b=this.singleTap.touchend(p,_,g);if(b){var E=p.timeStamp-this.lastTime<500,L=!this.lastTap||this.lastTap.dist(b)<30;if(E&&L||this.reset(),this.count++,this.lastTime=p.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}};var Do=function(){this._zoomIn=new sl({numTouches:1,numTaps:2}),this._zoomOut=new sl({numTouches:2,numTaps:1}),this.reset()};Do.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Do.prototype.touchstart=function(p,_,g){this._zoomIn.touchstart(p,_,g),this._zoomOut.touchstart(p,_,g)},Do.prototype.touchmove=function(p,_,g){this._zoomIn.touchmove(p,_,g),this._zoomOut.touchmove(p,_,g)},Do.prototype.touchend=function(p,_,g){var b=this,E=this._zoomIn.touchend(p,_,g),L=this._zoomOut.touchend(p,_,g);return E?(this._active=!0,p.preventDefault(),setTimeout((function(){return b.reset()}),0),{cameraAnimation:function(F){return F.easeTo({duration:300,zoom:F.getZoom()+1,around:F.unproject(E)},{originalEvent:p})}}):L?(this._active=!0,p.preventDefault(),setTimeout((function(){return b.reset()}),0),{cameraAnimation:function(F){return F.easeTo({duration:300,zoom:F.getZoom()-1,around:F.unproject(L)},{originalEvent:p})}}):void 0},Do.prototype.touchcancel=function(){this.reset()},Do.prototype.enable=function(){this._enabled=!0},Do.prototype.disable=function(){this._enabled=!1,this.reset()},Do.prototype.isEnabled=function(){return this._enabled},Do.prototype.isActive=function(){return this._active};var h_={0:1,2:2},Ht=function(p){this.reset(),this._clickTolerance=p.clickTolerance||1};Ht.prototype.blur=function(){this.reset()},Ht.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Ht.prototype._correctButton=function(p,_){return!1},Ht.prototype._move=function(p,_){return{}},Ht.prototype.mousedown=function(p,_){if(!this._lastPoint){var g=u.mouseButton(p);this._correctButton(p,g)&&(this._lastPoint=_,this._eventButton=g)}},Ht.prototype.mousemoveWindow=function(p,_){var g=this._lastPoint;if(g){if(p.preventDefault(),(function(b,E){var L=h_[E];return b.buttons===void 0||(b.buttons&L)!==L})(p,this._eventButton))this.reset();else if(this._moved||!(_.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=_,this._move(g,_)}},Ht.prototype.mouseupWindow=function(p){this._lastPoint&&u.mouseButton(p)===this._eventButton&&(this._moved&&u.suppressClick(),this.reset())},Ht.prototype.enable=function(){this._enabled=!0},Ht.prototype.disable=function(){this._enabled=!1,this.reset()},Ht.prototype.isEnabled=function(){return this._enabled},Ht.prototype.isActive=function(){return this._active};var d_=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.mousedown=function(g,b){p.prototype.mousedown.call(this,g,b),this._lastPoint&&(this._active=!0)},_.prototype._correctButton=function(g,b){return b===0&&!g.ctrlKey},_.prototype._move=function(g,b){return{around:b,panDelta:b.sub(g)}},_})(Ht),Eg=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype._correctButton=function(g,b){return b===0&&g.ctrlKey||b===2},_.prototype._move=function(g,b){var E=.8*(b.x-g.x);if(E)return this._active=!0,{bearingDelta:E}},_.prototype.contextmenu=function(g){g.preventDefault()},_})(Ht),f_=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype._correctButton=function(g,b){return b===0&&g.ctrlKey||b===2},_.prototype._move=function(g,b){var E=-.5*(b.y-g.y);if(E)return this._active=!0,{pitchDelta:E}},_.prototype.contextmenu=function(g){g.preventDefault()},_})(Ht),ka=function(p){this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset()};ka.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)},ka.prototype.touchstart=function(p,_,g){return this._calculateTransform(p,_,g)},ka.prototype.touchmove=function(p,_,g){if(this._active&&!(g.length<this._minTouches))return p.preventDefault(),this._calculateTransform(p,_,g)},ka.prototype.touchend=function(p,_,g){this._calculateTransform(p,_,g),this._active&&g.length<this._minTouches&&this.reset()},ka.prototype.touchcancel=function(){this.reset()},ka.prototype._calculateTransform=function(p,_,g){g.length>0&&(this._active=!0);var b=Sg(g,_),E=new s.Point(0,0),L=new s.Point(0,0),F=0;for(var B in b){var H=b[B],ae=this._touches[B];ae&&(E._add(H),L._add(H.sub(ae)),F++,b[B]=H)}if(this._touches=b,!(F<this._minTouches)&&L.mag()){var ve=L.div(F);if(this._sum._add(ve),!(this._sum.mag()<this._clickTolerance))return{around:E.div(F),panDelta:ve}}},ka.prototype.enable=function(){this._enabled=!0},ka.prototype.disable=function(){this._enabled=!1,this.reset()},ka.prototype.isEnabled=function(){return this._enabled},ka.prototype.isActive=function(){return this._active};var Vo=function(){this.reset()};function Tg(p,_,g){for(var b=0;b<p.length;b++)if(p[b].identifier===g)return _[b]}function Rg(p,_){return Math.log(p/_)/Math.LN2}Vo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Vo.prototype._start=function(p){},Vo.prototype._move=function(p,_,g){return{}},Vo.prototype.touchstart=function(p,_,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([_[0],_[1]]))},Vo.prototype.touchmove=function(p,_,g){if(this._firstTwoTouches){p.preventDefault();var b=this._firstTwoTouches,E=b[1],L=Tg(g,_,b[0]),F=Tg(g,_,E);if(L&&F){var B=this._aroundCenter?null:L.add(F).div(2);return this._move([L,F],B,p)}}},Vo.prototype.touchend=function(p,_,g){if(this._firstTwoTouches){var b=this._firstTwoTouches,E=b[1],L=Tg(g,_,b[0]),F=Tg(g,_,E);L&&F||(this._active&&u.suppressClick(),this.reset())}},Vo.prototype.touchcancel=function(){this.reset()},Vo.prototype.enable=function(p){this._enabled=!0,this._aroundCenter=!!p&&p.around==="center"},Vo.prototype.disable=function(){this._enabled=!1,this.reset()},Vo.prototype.isEnabled=function(){return this._enabled},Vo.prototype.isActive=function(){return this._active};var Bo=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.reset=function(){p.prototype.reset.call(this),delete this._distance,delete this._startDistance},_.prototype._start=function(g){this._startDistance=this._distance=g[0].dist(g[1])},_.prototype._move=function(g,b){var E=this._distance;if(this._distance=g[0].dist(g[1]),this._active||!(Math.abs(Rg(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Rg(this._distance,E),pinchAround:b}},_})(Vo);function su(p,_){return 180*p.angleWith(_)/Math.PI}var h1=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.reset=function(){p.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},_.prototype._start=function(g){this._startVector=this._vector=g[0].sub(g[1]),this._minDiameter=g[0].dist(g[1])},_.prototype._move=function(g,b){var E=this._vector;if(this._vector=g[0].sub(g[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:su(this._vector,E),pinchAround:b}},_.prototype._isBelowThreshold=function(g){this._minDiameter=Math.min(this._minDiameter,g.mag());var b=25/(Math.PI*this._minDiameter)*360,E=su(g,this._startVector);return Math.abs(E)<b},_})(Vo);function Yf(p){return Math.abs(p.y)>Math.abs(p.x)}var p_=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.reset=function(){p.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},_.prototype._start=function(g){this._lastPoints=g,Yf(g[0].sub(g[1]))&&(this._valid=!1)},_.prototype._move=function(g,b,E){var L=g[0].sub(this._lastPoints[0]),F=g[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(L,F,E.timeStamp),this._valid)return this._lastPoints=g,this._active=!0,{pitchDelta:(L.y+F.y)/2*-.5}},_.prototype.gestureBeginsVertically=function(g,b,E){if(this._valid!==void 0)return this._valid;var L=g.mag()>=2,F=b.mag()>=2;if(L||F){if(!L||!F)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var B=g.y>0==b.y>0;return Yf(g)&&Yf(b)&&B}},_})(Vo),g_={panStep:100,bearingStep:15,pitchStep:10},ol=function(){var p=g_;this._panStep=p.panStep,this._bearingStep=p.bearingStep,this._pitchStep=p.pitchStep,this._rotationDisabled=!1};function da(p){return p*(2-p)}ol.prototype.blur=function(){this.reset()},ol.prototype.reset=function(){this._active=!1},ol.prototype.keydown=function(p){var _=this;if(!(p.altKey||p.ctrlKey||p.metaKey)){var g=0,b=0,E=0,L=0,F=0;switch(p.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:p.shiftKey?b=-1:(p.preventDefault(),L=-1);break;case 39:p.shiftKey?b=1:(p.preventDefault(),L=1);break;case 38:p.shiftKey?E=1:(p.preventDefault(),F=-1);break;case 40:p.shiftKey?E=-1:(p.preventDefault(),F=1);break;default:return}return this._rotationDisabled&&(b=0,E=0),{cameraAnimation:function(B){var H=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:da,zoom:g?Math.round(H)+g*(p.shiftKey?2:1):H,bearing:B.getBearing()+b*_._bearingStep,pitch:B.getPitch()+E*_._pitchStep,offset:[-L*_._panStep,-F*_._panStep],center:B.getCenter()},{originalEvent:p})}}}},ol.prototype.enable=function(){this._enabled=!0},ol.prototype.disable=function(){this._enabled=!1,this.reset()},ol.prototype.isEnabled=function(){return this._enabled},ol.prototype.isActive=function(){return this._active},ol.prototype.disableRotation=function(){this._rotationDisabled=!0},ol.prototype.enableRotation=function(){this._rotationDisabled=!1};var li=function(p,_){this._map=p,this._el=p.getCanvasContainer(),this._handler=_,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,s.bindAll(["_onTimeout"],this)};li.prototype.setZoomRate=function(p){this._defaultZoomRate=p},li.prototype.setWheelZoomRate=function(p){this._wheelZoomRate=p},li.prototype.isEnabled=function(){return!!this._enabled},li.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},li.prototype.isZooming=function(){return!!this._zooming},li.prototype.enable=function(p){this.isEnabled()||(this._enabled=!0,this._aroundCenter=p&&p.around==="center")},li.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},li.prototype.wheel=function(p){if(this.isEnabled()){var _=p.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*p.deltaY:p.deltaY,g=s.browser.now(),b=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,_!==0&&_%4.000244140625==0?this._type="wheel":_!==0&&Math.abs(_)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=_,this._timeout=setTimeout(this._onTimeout,40,p)):this._type||(this._type=Math.abs(b*_)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,_+=this._lastValue)),p.shiftKey&&_&&(_/=4),this._type&&(this._lastWheelEvent=p,this._delta-=_,this._active||this._start(p)),p.preventDefault()}},li.prototype._onTimeout=function(p){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},li.prototype._start=function(p){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var _=u.mousePos(this._el,p);this._around=s.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(_)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},li.prototype.renderFrame=function(){var p=this;if(this._frameId&&(this._frameId=null,this.isActive())){var _=this._map.transform;if(this._delta!==0){var g=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,b=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&b!==0&&(b=1/b);var E=typeof this._targetZoom=="number"?_.zoomScale(this._targetZoom):_.scale;this._targetZoom=Math.min(_.maxZoom,Math.max(_.minZoom,_.scaleZoom(E*b))),this._type==="wheel"&&(this._startZoom=_.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var L,F=typeof this._targetZoom=="number"?this._targetZoom:_.zoom,B=this._startZoom,H=this._easing,ae=!1;if(this._type==="wheel"&&B&&H){var ve=Math.min((s.browser.now()-this._lastWheelEventTime)/200,1),be=H(ve);L=s.number(B,F,be),ve<1?this._frameId||(this._frameId=!0):ae=!0}else L=F,ae=!0;return this._active=!0,ae&&(this._active=!1,this._finishTimeout=setTimeout((function(){p._zooming=!1,p._handler._triggerRenderFrame(),delete p._targetZoom,delete p._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!ae,zoomDelta:L-_.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},li.prototype._smoothOutEasing=function(p){var _=s.ease;if(this._prevEase){var g=this._prevEase,b=(s.browser.now()-g.start)/g.duration,E=g.easing(b+.01)-g.easing(b),L=.27/Math.sqrt(E*E+1e-4)*.01,F=Math.sqrt(.0729-L*L);_=s.bezier(L,F,.25,1)}return this._prevEase={start:s.browser.now(),duration:p,easing:_},_},li.prototype.blur=function(){this.reset()},li.prototype.reset=function(){this._active=!1};var Ll=function(p,_){this._clickZoom=p,this._tapZoom=_};Ll.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Ll.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Ll.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Ll.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var La=function(){this.reset()};La.prototype.reset=function(){this._active=!1},La.prototype.blur=function(){this.reset()},La.prototype.dblclick=function(p,_){return p.preventDefault(),{cameraAnimation:function(g){g.easeTo({duration:300,zoom:g.getZoom()+(p.shiftKey?-1:1),around:g.unproject(_)},{originalEvent:p})}}},La.prototype.enable=function(){this._enabled=!0},La.prototype.disable=function(){this._enabled=!1,this.reset()},La.prototype.isEnabled=function(){return this._enabled},La.prototype.isActive=function(){return this._active};var Us=function(){this._tap=new sl({numTouches:1,numTaps:1}),this.reset()};Us.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Us.prototype.touchstart=function(p,_,g){this._swipePoint||(this._tapTime&&p.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=_[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(p,_,g))},Us.prototype.touchmove=function(p,_,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;var b=_[0],E=b.y-this._swipePoint.y;return this._swipePoint=b,p.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(p,_,g)},Us.prototype.touchend=function(p,_,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(p,_,g)&&(this._tapTime=p.timeStamp)},Us.prototype.touchcancel=function(){this.reset()},Us.prototype.enable=function(){this._enabled=!0},Us.prototype.disable=function(){this._enabled=!1,this.reset()},Us.prototype.isEnabled=function(){return this._enabled},Us.prototype.isActive=function(){return this._active};var ih=function(p,_,g){this._el=p,this._mousePan=_,this._touchPan=g};ih.prototype.enable=function(p){this._inertiaOptions=p||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},ih.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},ih.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},ih.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var qu=function(p,_,g){this._pitchWithRotate=p.pitchWithRotate,this._mouseRotate=_,this._mousePitch=g};qu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},qu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},qu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},qu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var al=function(p,_,g,b){this._el=p,this._touchZoom=_,this._touchRotate=g,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0};al.prototype.enable=function(p){this._touchZoom.enable(p),this._rotationDisabled||this._touchRotate.enable(p),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},al.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},al.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},al.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},al.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},al.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var lo=function(p){return p.zoom||p.drag||p.pitch||p.rotate},Hf=(function(p){function _(){p.apply(this,arguments)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_})(s.Event);function _n(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}var ln=function(p,_){this._map=p,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new zf(p),this._bearingSnap=_.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(_),s.bindAll(["handleEvent","handleWindowEvent"],this);var g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[s.window,"blur",void 0]];for(var b=0,E=this._listeners;b<E.length;b+=1){var L=E[b],F=L[0];u.addEventListener(F,L[1],F===s.window.document?this.handleWindowEvent:this.handleEvent,L[2])}};ln.prototype.destroy=function(){for(var p=0,_=this._listeners;p<_.length;p+=1){var g=_[p],b=g[0];u.removeEventListener(b,g[1],b===s.window.document?this.handleWindowEvent:this.handleEvent,g[2])}},ln.prototype._addDefaultHandlers=function(p){var _=this._map,g=_.getCanvasContainer();this._add("mapEvent",new Qr(_,p));var b=_.boxZoom=new No(_,p);this._add("boxZoom",b);var E=new Do,L=new La;_.doubleClickZoom=new Ll(L,E),this._add("tapZoom",E),this._add("clickZoom",L);var F=new Us;this._add("tapDragZoom",F);var B=_.touchPitch=new p_;this._add("touchPitch",B);var H=new Eg(p),ae=new f_(p);_.dragRotate=new qu(p,H,ae),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",ae,["mouseRotate"]);var ve=new d_(p),be=new ka(p);_.dragPan=new ih(g,ve,be),this._add("mousePan",ve),this._add("touchPan",be,["touchZoom","touchRotate"]);var Ie=new h1,Oe=new Bo;_.touchZoomRotate=new al(g,Oe,Ie,F),this._add("touchRotate",Ie,["touchPan","touchZoom"]),this._add("touchZoom",Oe,["touchPan","touchRotate"]);var Fe=_.scrollZoom=new li(_,this);this._add("scrollZoom",Fe,["mousePan"]);var Xe=_.keyboard=new ol;this._add("keyboard",Xe),this._add("blockableMapEvent",new sn(_));for(var Ee=0,Ue=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ee<Ue.length;Ee+=1){var je=Ue[Ee];p.interactive&&p[je]&&_[je].enable(p[je])}},ln.prototype._add=function(p,_,g){this._handlers.push({handlerName:p,handler:_,allowed:g}),this._handlersById[p]=_},ln.prototype.stop=function(p){if(!this._updatingCamera){for(var _=0,g=this._handlers;_<g.length;_+=1)g[_].handler.reset();this._inertia.clear(),this._fireEvents({},{},p),this._changes=[]}},ln.prototype.isActive=function(){for(var p=0,_=this._handlers;p<_.length;p+=1)if(_[p].handler.isActive())return!0;return!1},ln.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},ln.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},ln.prototype.isMoving=function(){return!!lo(this._eventsInProgress)||this.isZooming()},ln.prototype._blockedByActive=function(p,_,g){for(var b in p)if(b!==g&&(!_||_.indexOf(b)<0))return!0;return!1},ln.prototype.handleWindowEvent=function(p){this.handleEvent(p,p.type+"Window")},ln.prototype._getMapTouches=function(p){for(var _=[],g=0,b=p;g<b.length;g+=1){var E=b[g];this._el.contains(E.target)&&_.push(E)}return _},ln.prototype.handleEvent=function(p,_){this._updatingCamera=!0;for(var g=p.type==="renderFrame"?void 0:p,b={needsRenderFrame:!1},E={},L={},F=p.touches?this._getMapTouches(p.touches):void 0,B=F?u.touchPos(this._el,F):u.mousePos(this._el,p),H=0,ae=this._handlers;H<ae.length;H+=1){var ve=ae[H],be=ve.handlerName,Ie=ve.handler,Oe=ve.allowed;if(Ie.isEnabled()){var Fe=void 0;this._blockedByActive(L,Oe,be)?Ie.reset():Ie[_||p.type]&&(Fe=Ie[_||p.type](p,B,F),this.mergeHandlerResult(b,E,Fe,be,g),Fe&&Fe.needsRenderFrame&&this._triggerRenderFrame()),(Fe||Ie.isActive())&&(L[be]=Ie)}}var Xe={};for(var Ee in this._previousActiveHandlers)L[Ee]||(Xe[Ee]=g);this._previousActiveHandlers=L,(Object.keys(Xe).length||_n(b))&&(this._changes.push([b,E,Xe]),this._triggerRenderFrame()),(Object.keys(L).length||_n(b))&&this._map._stop(!0),this._updatingCamera=!1;var Ue=b.cameraAnimation;Ue&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ue(this._map))},ln.prototype.mergeHandlerResult=function(p,_,g,b,E){if(g){s.extend(p,g);var L={handlerName:b,originalEvent:g.originalEvent||E};g.zoomDelta!==void 0&&(_.zoom=L),g.panDelta!==void 0&&(_.drag=L),g.pitchDelta!==void 0&&(_.pitch=L),g.bearingDelta!==void 0&&(_.rotate=L)}},ln.prototype._applyChanges=function(){for(var p={},_={},g={},b=0,E=this._changes;b<E.length;b+=1){var L=E[b],F=L[0],B=L[1],H=L[2];F.panDelta&&(p.panDelta=(p.panDelta||new s.Point(0,0))._add(F.panDelta)),F.zoomDelta&&(p.zoomDelta=(p.zoomDelta||0)+F.zoomDelta),F.bearingDelta&&(p.bearingDelta=(p.bearingDelta||0)+F.bearingDelta),F.pitchDelta&&(p.pitchDelta=(p.pitchDelta||0)+F.pitchDelta),F.around!==void 0&&(p.around=F.around),F.pinchAround!==void 0&&(p.pinchAround=F.pinchAround),F.noInertia&&(p.noInertia=F.noInertia),s.extend(_,B),s.extend(g,H)}this._updateMapTransform(p,_,g),this._changes=[]},ln.prototype._updateMapTransform=function(p,_,g){var b=this._map,E=b.transform;if(!_n(p))return this._fireEvents(_,g,!0);var L=p.panDelta,F=p.zoomDelta,B=p.bearingDelta,H=p.pitchDelta,ae=p.around,ve=p.pinchAround;ve!==void 0&&(ae=ve),b._stop(!0),ae=ae||b.transform.centerPoint;var be=E.pointLocation(L?ae.sub(L):ae);B&&(E.bearing+=B),H&&(E.pitch+=H),F&&(E.zoom+=F),E.setLocationAtPoint(be,ae),this._map._update(),p.noInertia||this._inertia.record(p),this._fireEvents(_,g,!0)},ln.prototype._fireEvents=function(p,_,g){var b=this,E=lo(this._eventsInProgress),L=lo(p),F={};for(var B in p)this._eventsInProgress[B]||(F[B+"start"]=p[B].originalEvent),this._eventsInProgress[B]=p[B];for(var H in!E&&L&&this._fireEvent("movestart",L.originalEvent),F)this._fireEvent(H,F[H]);for(var ae in L&&this._fireEvent("move",L.originalEvent),p)this._fireEvent(ae,p[ae].originalEvent);var ve,be={};for(var Ie in this._eventsInProgress){var Oe=this._eventsInProgress[Ie],Fe=Oe.handlerName,Xe=Oe.originalEvent;this._handlersById[Fe].isActive()||(delete this._eventsInProgress[Ie],be[Ie+"end"]=ve=_[Fe]||Xe)}for(var Ee in be)this._fireEvent(Ee,be[Ee]);var Ue=lo(this._eventsInProgress);if(g&&(E||L)&&!Ue){this._updatingCamera=!0;var je=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),nt=function(ut){return ut!==0&&-b._bearingSnap<ut&&ut<b._bearingSnap};je?(nt(je.bearing||this._map.getBearing())&&(je.bearing=0),this._map.easeTo(je,{originalEvent:ve})):(this._map.fire(new s.Event("moveend",{originalEvent:ve})),nt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},ln.prototype._fireEvent=function(p,_){this._map.fire(new s.Event(p,_?{originalEvent:_}:{}))},ln.prototype._requestFrame=function(){var p=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(_){delete p._frameId,p.handleEvent(new Hf("renderFrame",{timeStamp:_})),p._applyChanges()}))},ln.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Mg=(function(p){function _(g,b){p.call(this),this._moving=!1,this._zooming=!1,this.transform=g,this._bearingSnap=b.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.getCenter=function(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)},_.prototype.setCenter=function(g,b){return this.jumpTo({center:g},b)},_.prototype.panBy=function(g,b,E){return g=s.Point.convert(g).mult(-1),this.panTo(this.transform.center,s.extend({offset:g},b),E)},_.prototype.panTo=function(g,b,E){return this.easeTo(s.extend({center:g},b),E)},_.prototype.getZoom=function(){return this.transform.zoom},_.prototype.setZoom=function(g,b){return this.jumpTo({zoom:g},b),this},_.prototype.zoomTo=function(g,b,E){return this.easeTo(s.extend({zoom:g},b),E)},_.prototype.zoomIn=function(g,b){return this.zoomTo(this.getZoom()+1,g,b),this},_.prototype.zoomOut=function(g,b){return this.zoomTo(this.getZoom()-1,g,b),this},_.prototype.getBearing=function(){return this.transform.bearing},_.prototype.setBearing=function(g,b){return this.jumpTo({bearing:g},b),this},_.prototype.getPadding=function(){return this.transform.padding},_.prototype.setPadding=function(g,b){return this.jumpTo({padding:g},b),this},_.prototype.rotateTo=function(g,b,E){return this.easeTo(s.extend({bearing:g},b),E)},_.prototype.resetNorth=function(g,b){return this.rotateTo(0,s.extend({duration:1e3},g),b),this},_.prototype.resetNorthPitch=function(g,b){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},g),b),this},_.prototype.snapToNorth=function(g,b){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(g,b):this},_.prototype.getPitch=function(){return this.transform.pitch},_.prototype.setPitch=function(g,b){return this.jumpTo({pitch:g},b),this},_.prototype.cameraForBounds=function(g,b){g=s.LngLatBounds.convert(g);var E=b&&b.bearing||0;return this._cameraForBoxAndBearing(g.getNorthWest(),g.getSouthEast(),E,b)},_.prototype._cameraForBoxAndBearing=function(g,b,E,L){var F={top:0,bottom:0,right:0,left:0};if(typeof(L=s.extend({padding:F,offset:[0,0],maxZoom:this.transform.maxZoom},L)).padding=="number"){var B=L.padding;L.padding={top:B,bottom:B,right:B,left:B}}L.padding=s.extend(F,L.padding);var H=this.transform,ae=H.padding,ve=H.project(s.LngLat.convert(g)),be=H.project(s.LngLat.convert(b)),Ie=ve.rotate(-E*Math.PI/180),Oe=be.rotate(-E*Math.PI/180),Fe=new s.Point(Math.max(Ie.x,Oe.x),Math.max(Ie.y,Oe.y)),Xe=new s.Point(Math.min(Ie.x,Oe.x),Math.min(Ie.y,Oe.y)),Ee=Fe.sub(Xe),Ue=(H.width-(ae.left+ae.right+L.padding.left+L.padding.right))/Ee.x,je=(H.height-(ae.top+ae.bottom+L.padding.top+L.padding.bottom))/Ee.y;if(!(je<0||Ue<0)){var nt=Math.min(H.scaleZoom(H.scale*Math.min(Ue,je)),L.maxZoom),ut=typeof L.offset.x=="number"?new s.Point(L.offset.x,L.offset.y):s.Point.convert(L.offset),ot=new s.Point((L.padding.left-L.padding.right)/2,(L.padding.top-L.padding.bottom)/2).rotate(E*Math.PI/180),ht=ut.add(ot).mult(H.scale/H.zoomScale(nt));return{center:H.unproject(ve.add(be).div(2).sub(ht)),zoom:nt,bearing:E}}s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},_.prototype.fitBounds=function(g,b,E){return this._fitInternal(this.cameraForBounds(g,b),b,E)},_.prototype.fitScreenCoordinates=function(g,b,E,L,F){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.Point.convert(g)),this.transform.pointLocation(s.Point.convert(b)),E,L),L,F)},_.prototype._fitInternal=function(g,b,E){return g?(delete(b=s.extend(g,b)).padding,b.linear?this.easeTo(b,E):this.flyTo(b,E)):this},_.prototype.jumpTo=function(g,b){this.stop();var E=this.transform,L=!1,F=!1,B=!1;return"zoom"in g&&E.zoom!==+g.zoom&&(L=!0,E.zoom=+g.zoom),g.center!==void 0&&(E.center=s.LngLat.convert(g.center)),"bearing"in g&&E.bearing!==+g.bearing&&(F=!0,E.bearing=+g.bearing),"pitch"in g&&E.pitch!==+g.pitch&&(B=!0,E.pitch=+g.pitch),g.padding==null||E.isPaddingEqual(g.padding)||(E.padding=g.padding),this.fire(new s.Event("movestart",b)).fire(new s.Event("move",b)),L&&this.fire(new s.Event("zoomstart",b)).fire(new s.Event("zoom",b)).fire(new s.Event("zoomend",b)),F&&this.fire(new s.Event("rotatestart",b)).fire(new s.Event("rotate",b)).fire(new s.Event("rotateend",b)),B&&this.fire(new s.Event("pitchstart",b)).fire(new s.Event("pitch",b)).fire(new s.Event("pitchend",b)),this.fire(new s.Event("moveend",b))},_.prototype.easeTo=function(g,b){var E=this;this._stop(!1,g.easeId),((g=s.extend({offset:[0,0],duration:500,easing:s.ease},g)).animate===!1||!g.essential&&s.browser.prefersReducedMotion)&&(g.duration=0);var L=this.transform,F=this.getZoom(),B=this.getBearing(),H=this.getPitch(),ae=this.getPadding(),ve="zoom"in g?+g.zoom:F,be="bearing"in g?this._normalizeBearing(g.bearing,B):B,Ie="pitch"in g?+g.pitch:H,Oe="padding"in g?g.padding:L.padding,Fe=s.Point.convert(g.offset),Xe=L.centerPoint.add(Fe),Ee=L.pointLocation(Xe),Ue=s.LngLat.convert(g.center||Ee);this._normalizeCenter(Ue);var je,nt,ut=L.project(Ee),ot=L.project(Ue).sub(ut),ht=L.zoomScale(ve-F);g.around&&(je=s.LngLat.convert(g.around),nt=L.locationPoint(je));var vt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ve!==F,this._rotating=this._rotating||B!==be,this._pitching=this._pitching||Ie!==H,this._padding=!L.isPaddingEqual(Oe),this._easeId=g.easeId,this._prepareEase(b,g.noMoveStart,vt),this._ease((function(Nt){if(E._zooming&&(L.zoom=s.number(F,ve,Nt)),E._rotating&&(L.bearing=s.number(B,be,Nt)),E._pitching&&(L.pitch=s.number(H,Ie,Nt)),E._padding&&(L.interpolatePadding(ae,Oe,Nt),Xe=L.centerPoint.add(Fe)),je)L.setLocationAtPoint(je,nt);else{var Gt=L.zoomScale(L.zoom-F),en=ve>F?Math.min(2,ht):Math.max(.5,ht),vn=Math.pow(en,1-Nt),wn=L.unproject(ut.add(ot.mult(Nt*vn)).mult(Gt));L.setLocationAtPoint(L.renderWorldCopies?wn.wrap():wn,Xe)}E._fireMoveEvents(b)}),(function(Nt){E._afterEase(b,Nt)}),g),this},_.prototype._prepareEase=function(g,b,E){E===void 0&&(E={}),this._moving=!0,b||E.moving||this.fire(new s.Event("movestart",g)),this._zooming&&!E.zooming&&this.fire(new s.Event("zoomstart",g)),this._rotating&&!E.rotating&&this.fire(new s.Event("rotatestart",g)),this._pitching&&!E.pitching&&this.fire(new s.Event("pitchstart",g))},_.prototype._fireMoveEvents=function(g){this.fire(new s.Event("move",g)),this._zooming&&this.fire(new s.Event("zoom",g)),this._rotating&&this.fire(new s.Event("rotate",g)),this._pitching&&this.fire(new s.Event("pitch",g))},_.prototype._afterEase=function(g,b){if(!this._easeId||!b||this._easeId!==b){delete this._easeId;var E=this._zooming,L=this._rotating,F=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new s.Event("zoomend",g)),L&&this.fire(new s.Event("rotateend",g)),F&&this.fire(new s.Event("pitchend",g)),this.fire(new s.Event("moveend",g))}},_.prototype.flyTo=function(g,b){var E=this;if(!g.essential&&s.browser.prefersReducedMotion){var L=s.pick(g,["center","zoom","bearing","pitch","around"]);return this.jumpTo(L,b)}this.stop(),g=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},g);var F=this.transform,B=this.getZoom(),H=this.getBearing(),ae=this.getPitch(),ve=this.getPadding(),be="zoom"in g?s.clamp(+g.zoom,F.minZoom,F.maxZoom):B,Ie="bearing"in g?this._normalizeBearing(g.bearing,H):H,Oe="pitch"in g?+g.pitch:ae,Fe="padding"in g?g.padding:F.padding,Xe=F.zoomScale(be-B),Ee=s.Point.convert(g.offset),Ue=F.centerPoint.add(Ee),je=F.pointLocation(Ue),nt=s.LngLat.convert(g.center||je);this._normalizeCenter(nt);var ut=F.project(je),ot=F.project(nt).sub(ut),ht=g.curve,vt=Math.max(F.width,F.height),Nt=vt/Xe,Gt=ot.mag();if("minZoom"in g){var en=s.clamp(Math.min(g.minZoom,B,be),F.minZoom,F.maxZoom),vn=vt/F.zoomScale(en-B);ht=Math.sqrt(vn/Gt*2)}var wn=ht*ht;function Cn(Ln){var Tn=(Nt*Nt-vt*vt+(Ln?-1:1)*wn*wn*Gt*Gt)/(2*(Ln?Nt:vt)*wn*Gt);return Math.log(Math.sqrt(Tn*Tn+1)-Tn)}function xi(Ln){return(Math.exp(Ln)-Math.exp(-Ln))/2}function rn(Ln){return(Math.exp(Ln)+Math.exp(-Ln))/2}var On=Cn(0),Hn=function(Ln){return rn(On)/rn(On+ht*Ln)},Fn=function(Ln){return vt*((rn(On)*(xi(Tn=On+ht*Ln)/rn(Tn))-xi(On))/wn)/Gt;var Tn},Gn=(Cn(1)-On)/ht;if(Math.abs(Gt)<1e-6||!isFinite(Gn)){if(Math.abs(vt-Nt)<1e-6)return this.easeTo(g,b);var Yn=Nt<vt?-1:1;Gn=Math.abs(Math.log(Nt/vt))/ht,Fn=function(){return 0},Hn=function(Ln){return Math.exp(Yn*ht*Ln)}}return g.duration="duration"in g?+g.duration:1e3*Gn/("screenSpeed"in g?+g.screenSpeed/ht:+g.speed),g.maxDuration&&g.duration>g.maxDuration&&(g.duration=0),this._zooming=!0,this._rotating=H!==Ie,this._pitching=Oe!==ae,this._padding=!F.isPaddingEqual(Fe),this._prepareEase(b,!1),this._ease((function(Ln){var Tn=Ln*Gn,_s=1/Hn(Tn);F.zoom=Ln===1?be:B+F.scaleZoom(_s),E._rotating&&(F.bearing=s.number(H,Ie,Ln)),E._pitching&&(F.pitch=s.number(ae,Oe,Ln)),E._padding&&(F.interpolatePadding(ve,Fe,Ln),Ue=F.centerPoint.add(Ee));var Fr=Ln===1?nt:F.unproject(ut.add(ot.mult(Fn(Tn))).mult(_s));F.setLocationAtPoint(F.renderWorldCopies?Fr.wrap():Fr,Ue),E._fireMoveEvents(b)}),(function(){return E._afterEase(b)}),g),this},_.prototype.isEasing=function(){return!!this._easeFrameId},_.prototype.stop=function(){return this._stop()},_.prototype._stop=function(g,b){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,b)}if(!g){var L=this.handlers;L&&L.stop(!1)}return this},_.prototype._ease=function(g,b,E){E.animate===!1||E.duration===0?(g(1),b()):(this._easeStart=s.browser.now(),this._easeOptions=E,this._onEaseFrame=g,this._onEaseEnd=b,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},_.prototype._renderFrameCallback=function(){var g=Math.min((s.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},_.prototype._normalizeBearing=function(g,b){g=s.wrap(g,-180,180);var E=Math.abs(g-b);return Math.abs(g-360-b)<E&&(g-=360),Math.abs(g+360-b)<E&&(g+=360),g},_.prototype._normalizeCenter=function(g){var b=this.transform;if(b.renderWorldCopies&&!b.lngRange){var E=g.lng-b.center.lng;g.lng+=E>180?-360:E<-180?360:0}},_})(s.Evented),uo=function(p){p===void 0&&(p={}),this.options=p,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};uo.prototype.getDefaultPosition=function(){return"bottom-right"},uo.prototype.onAdd=function(p){var _=this.options&&this.options.compact;return this._map=p,this._container=u.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=u.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=u.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),_&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),_===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},uo.prototype.onRemove=function(){u.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},uo.prototype._setElementTitle=function(p,_){var g=this._map._getUIString("AttributionControl."+_);p.title=g,p.setAttribute("aria-label",g)},uo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},uo.prototype._updateEditLink=function(){var p=this._editLink;p||(p=this._editLink=this._container.querySelector(".mapbox-improve-map"));var _=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(p){var g=_.reduce((function(b,E,L){return E.value&&(b+=E.key+"="+E.value+(L<_.length-1?"&":"")),b}),"?");p.href=s.config.FEEDBACK_URL+"/"+g+(this._map._hash?this._map._hash.getHashString(!0):""),p.rel="noopener nofollow",this._setElementTitle(p,"MapFeedback")}},uo.prototype._updateData=function(p){!p||p.sourceDataType!=="metadata"&&p.sourceDataType!=="visibility"&&p.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},uo.prototype._updateAttributions=function(){if(this._map.style){var p=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?p=p.concat(this.options.customAttribution.map((function(B){return typeof B!="string"?"":B}))):typeof this.options.customAttribution=="string"&&p.push(this.options.customAttribution)),this._map.style.stylesheet){var _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}var g=this._map.style.sourceCaches;for(var b in g){var E=g[b];if(E.used){var L=E.getSource();L.attribution&&p.indexOf(L.attribution)<0&&p.push(L.attribution)}}p.sort((function(B,H){return B.length-H.length}));var F=(p=p.filter((function(B,H){for(var ae=H+1;ae<p.length;ae++)if(p[ae].indexOf(B)>=0)return!1;return!0}))).join(" | ");F!==this._attribHTML&&(this._attribHTML=F,p.length?(this._innerContainer.innerHTML=F,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},uo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var ll=function(){s.bindAll(["_updateLogo"],this),s.bindAll(["_updateCompact"],this)};ll.prototype.onAdd=function(p){this._map=p,this._container=u.create("div","mapboxgl-ctrl");var _=u.create("a","mapboxgl-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://www.mapbox.com/",_.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),_.setAttribute("rel","noopener nofollow"),this._container.appendChild(_),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ll.prototype.onRemove=function(){u.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ll.prototype.getDefaultPosition=function(){return"bottom-left"},ll.prototype._updateLogo=function(p){p&&p.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ll.prototype._logoRequired=function(){if(this._map.style){var p=this._map.style.sourceCaches;for(var _ in p)if(p[_].getSource().mapbox_logo)return!0;return!1}},ll.prototype._updateCompact=function(){var p=this._container.children;if(p.length){var _=p[0];this._map.getCanvasContainer().offsetWidth<250?_.classList.add("mapboxgl-compact"):_.classList.remove("mapboxgl-compact")}};var Xs=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Xs.prototype.add=function(p){var _=++this._id;return this._queue.push({callback:p,id:_,cancelled:!1}),_},Xs.prototype.remove=function(p){for(var _=this._currentlyRunning,g=0,b=_?this._queue.concat(_):this._queue;g<b.length;g+=1){var E=b[g];if(E.id===p)return void(E.cancelled=!0)}},Xs.prototype.run=function(p){p===void 0&&(p=0);var _=this._currentlyRunning=this._queue;this._queue=[];for(var g=0,b=_;g<b.length;g+=1){var E=b[g];if(!E.cancelled&&(E.callback(p),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Xs.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Pl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},m_=s.window.HTMLImageElement,kg=s.window.HTMLElement,Di=s.window.ImageBitmap,Rs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},d1=(function(p){function _(b){var E=this;if((b=s.extend({},Rs,b)).minZoom!=null&&b.maxZoom!=null&&b.minZoom>b.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(b.minPitch!=null&&b.maxPitch!=null&&b.minPitch>b.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(b.minPitch!=null&&b.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(b.maxPitch!=null&&b.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var L=new gi(b.minZoom,b.maxZoom,b.minPitch,b.maxPitch,b.renderWorldCopies);if(p.call(this,L,b),this._interactive=b.interactive,this._maxTileCacheSize=b.maxTileCacheSize,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._antialias=b.antialias,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,this._refreshExpiredTiles=b.refreshExpiredTiles,this._fadeDuration=b.fadeDuration,this._crossSourceCollisions=b.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=b.collectResourceTiming,this._renderTaskQueue=new Xs,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Pl,b.locale),this._clickTolerance=b.clickTolerance,this._requestManager=new s.RequestManager(b.transformRequest,b.accessToken),typeof b.container=="string"){if(this._container=s.window.document.getElementById(b.container),!this._container)throw new Error("Container '"+b.container+"' not found.")}else{if(!(b.container instanceof kg))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(b.maxBounds&&this.setMaxBounds(b.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return E._update(!1)})),this.on("moveend",(function(){return E._update(!1)})),this.on("zoom",(function(){return E._update(!0)})),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ln(this,b),this._hash=b.hash&&new ha(typeof b.hash=="string"&&b.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}),b.bounds&&(this.resize(),this.fitBounds(b.bounds,s.extend({},b.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=b.localIdeographFontFamily,b.style&&this.setStyle(b.style,{localIdeographFontFamily:b.localIdeographFontFamily}),b.attributionControl&&this.addControl(new uo({customAttribution:b.customAttribution})),this.addControl(new ll,b.logoPosition),this.on("style.load",(function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)})),this.on("data",(function(F){E._update(F.dataType==="style"),E.fire(new s.Event(F.dataType+"data",F))})),this.on("dataloading",(function(F){E.fire(new s.Event(F.dataType+"dataloading",F))}))}p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_;var g={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return _.prototype._getMapId=function(){return this._mapId},_.prototype.addControl=function(b,E){if(E===void 0&&(E=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var L=b.onAdd(this);this._controls.push(b);var F=this._controlPositions[E];return E.indexOf("bottom")!==-1?F.insertBefore(L,F.firstChild):F.appendChild(L),this},_.prototype.removeControl=function(b){if(!b||!b.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(b);return E>-1&&this._controls.splice(E,1),b.onRemove(this),this},_.prototype.hasControl=function(b){return this._controls.indexOf(b)>-1},_.prototype.resize=function(b){var E=this._containerDimensions(),L=E[0],F=E[1];if(L===this.transform.width&&F===this.transform.height)return this;this._resizeCanvas(L,F),this.transform.resize(L,F),this.painter.resize(L,F);var B=!this._moving;return B&&this.fire(new s.Event("movestart",b)).fire(new s.Event("move",b)),this.fire(new s.Event("resize",b)),B&&this.fire(new s.Event("moveend",b)),this},_.prototype.getBounds=function(){return this.transform.getBounds()},_.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},_.prototype.setMaxBounds=function(b){return this.transform.setMaxBounds(s.LngLatBounds.convert(b)),this._update()},_.prototype.setMinZoom=function(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},_.prototype.getMinZoom=function(){return this.transform.minZoom},_.prototype.setMaxZoom=function(b){if((b=b??22)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")},_.prototype.getMaxZoom=function(){return this.transform.maxZoom},_.prototype.setMinPitch=function(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},_.prototype.getMinPitch=function(){return this.transform.minPitch},_.prototype.setMaxPitch=function(b){if((b=b??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")},_.prototype.getMaxPitch=function(){return this.transform.maxPitch},_.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},_.prototype.setRenderWorldCopies=function(b){return this.transform.renderWorldCopies=b,this._update()},_.prototype.project=function(b){return this.transform.locationPoint(s.LngLat.convert(b))},_.prototype.unproject=function(b){return this.transform.pointLocation(s.Point.convert(b))},_.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},_.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},_.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},_.prototype._createDelegatedListener=function(b,E,L){var F,B=this;if(b==="mouseenter"||b==="mouseover"){var H=!1;return{layer:E,listener:L,delegates:{mousemove:function(ve){var be=B.getLayer(E)?B.queryRenderedFeatures(ve.point,{layers:[E]}):[];be.length?H||(H=!0,L.call(B,new ss(b,B,ve.originalEvent,{features:be}))):H=!1},mouseout:function(){H=!1}}}}if(b==="mouseleave"||b==="mouseout"){var ae=!1;return{layer:E,listener:L,delegates:{mousemove:function(ve){(B.getLayer(E)?B.queryRenderedFeatures(ve.point,{layers:[E]}):[]).length?ae=!0:ae&&(ae=!1,L.call(B,new ss(b,B,ve.originalEvent)))},mouseout:function(ve){ae&&(ae=!1,L.call(B,new ss(b,B,ve.originalEvent)))}}}}return{layer:E,listener:L,delegates:(F={},F[b]=function(ve){var be=B.getLayer(E)?B.queryRenderedFeatures(ve.point,{layers:[E]}):[];be.length&&(ve.features=be,L.call(B,ve),delete ve.features)},F)}},_.prototype.on=function(b,E,L){if(L===void 0)return p.prototype.on.call(this,b,E);var F=this._createDelegatedListener(b,E,L);for(var B in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(F),F.delegates)this.on(B,F.delegates[B]);return this},_.prototype.once=function(b,E,L){if(L===void 0)return p.prototype.once.call(this,b,E);var F=this._createDelegatedListener(b,E,L);for(var B in F.delegates)this.once(B,F.delegates[B]);return this},_.prototype.off=function(b,E,L){var F=this;return L===void 0?p.prototype.off.call(this,b,E):(this._delegatedListeners&&this._delegatedListeners[b]&&(function(B){for(var H=B[b],ae=0;ae<H.length;ae++){var ve=H[ae];if(ve.layer===E&&ve.listener===L){for(var be in ve.delegates)F.off(be,ve.delegates[be]);return H.splice(ae,1),F}}})(this._delegatedListeners),this)},_.prototype.queryRenderedFeatures=function(b,E){if(!this.style)return[];var L;if(E!==void 0||b===void 0||b instanceof s.Point||Array.isArray(b)||(E=b,b=void 0),E=E||{},(b=b||[[0,0],[this.transform.width,this.transform.height]])instanceof s.Point||typeof b[0]=="number")L=[s.Point.convert(b)];else{var F=s.Point.convert(b[0]),B=s.Point.convert(b[1]);L=[F,new s.Point(B.x,F.y),B,new s.Point(F.x,B.y),F]}return this.style.queryRenderedFeatures(L,E,this.transform)},_.prototype.querySourceFeatures=function(b,E){return this.style.querySourceFeatures(b,E)},_.prototype.setStyle=function(b,E){return(E=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(b,E))},_.prototype._getUIString=function(b){var E=this._locale[b];if(E==null)throw new Error("Missing UI string '"+b+"'");return E},_.prototype._updateStyle=function(b,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),b?(this.style=new Oo(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b):this.style.loadJSON(b),this):(delete this.style,this)},_.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},_.prototype._diffStyle=function(b,E){var L=this;if(typeof b=="string"){var F=this._requestManager.normalizeStyleURL(b),B=this._requestManager.transformRequest(F,s.ResourceType.Style);s.getJSON(B,(function(H,ae){H?L.fire(new s.ErrorEvent(H)):ae&&L._updateDiff(ae,E)}))}else typeof b=="object"&&this._updateDiff(b,E)},_.prototype._updateDiff=function(b,E){try{this.style.setState(b)&&this._update(!0)}catch(L){s.warnOnce("Unable to perform style diff: "+(L.message||L.error||L)+".  Rebuilding the style from scratch."),this._updateStyle(b,E)}},_.prototype.getStyle=function(){if(this.style)return this.style.serialize()},_.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")},_.prototype.addSource=function(b,E){return this._lazyInitEmptyStyle(),this.style.addSource(b,E),this._update(!0)},_.prototype.isSourceLoaded=function(b){var E=this.style&&this.style.sourceCaches[b];if(E!==void 0)return E.loaded();this.fire(new s.ErrorEvent(new Error("There is no source with ID '"+b+"'")))},_.prototype.areTilesLoaded=function(){var b=this.style&&this.style.sourceCaches;for(var E in b){var L=b[E]._tiles;for(var F in L){var B=L[F];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0},_.prototype.addSourceType=function(b,E,L){return this._lazyInitEmptyStyle(),this.style.addSourceType(b,E,L)},_.prototype.removeSource=function(b){return this.style.removeSource(b),this._update(!0)},_.prototype.getSource=function(b){return this.style.getSource(b)},_.prototype.addImage=function(b,E,L){L===void 0&&(L={});var F=L.pixelRatio;F===void 0&&(F=1);var B=L.sdf;B===void 0&&(B=!1);var H=L.stretchX,ae=L.stretchY,ve=L.content;if(this._lazyInitEmptyStyle(),E instanceof m_||Di&&E instanceof Di){var be=s.browser.getImageData(E);this.style.addImage(b,{data:new s.RGBAImage({width:be.width,height:be.height},be.data),pixelRatio:F,stretchX:H,stretchY:ae,content:ve,sdf:B,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ie=E;this.style.addImage(b,{data:new s.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:F,stretchX:H,stretchY:ae,content:ve,sdf:B,version:0,userImage:Ie}),Ie.onAdd&&Ie.onAdd(this,b)}},_.prototype.updateImage=function(b,E){var L=this.style.getImage(b);if(!L)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var F=E instanceof m_||Di&&E instanceof Di?s.browser.getImageData(E):E,B=F.width,H=F.height,ae=F.data;return B===void 0||H===void 0?this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):B!==L.data.width||H!==L.data.height?this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(L.data.replace(ae,!(E instanceof m_||Di&&E instanceof Di)),void this.style.updateImage(b,L))},_.prototype.hasImage=function(b){return b?!!this.style.getImage(b):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)},_.prototype.removeImage=function(b){this.style.removeImage(b)},_.prototype.loadImage=function(b,E){s.getImage(this._requestManager.transformRequest(b,s.ResourceType.Image),E)},_.prototype.listImages=function(){return this.style.listImages()},_.prototype.addLayer=function(b,E){return this._lazyInitEmptyStyle(),this.style.addLayer(b,E),this._update(!0)},_.prototype.moveLayer=function(b,E){return this.style.moveLayer(b,E),this._update(!0)},_.prototype.removeLayer=function(b){return this.style.removeLayer(b),this._update(!0)},_.prototype.getLayer=function(b){return this.style.getLayer(b)},_.prototype.setLayerZoomRange=function(b,E,L){return this.style.setLayerZoomRange(b,E,L),this._update(!0)},_.prototype.setFilter=function(b,E,L){return L===void 0&&(L={}),this.style.setFilter(b,E,L),this._update(!0)},_.prototype.getFilter=function(b){return this.style.getFilter(b)},_.prototype.setPaintProperty=function(b,E,L,F){return F===void 0&&(F={}),this.style.setPaintProperty(b,E,L,F),this._update(!0)},_.prototype.getPaintProperty=function(b,E){return this.style.getPaintProperty(b,E)},_.prototype.setLayoutProperty=function(b,E,L,F){return F===void 0&&(F={}),this.style.setLayoutProperty(b,E,L,F),this._update(!0)},_.prototype.getLayoutProperty=function(b,E){return this.style.getLayoutProperty(b,E)},_.prototype.setLight=function(b,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(b,E),this._update(!0)},_.prototype.getLight=function(){return this.style.getLight()},_.prototype.setFeatureState=function(b,E){return this.style.setFeatureState(b,E),this._update()},_.prototype.removeFeatureState=function(b,E){return this.style.removeFeatureState(b,E),this._update()},_.prototype.getFeatureState=function(b){return this.style.getFeatureState(b)},_.prototype.getContainer=function(){return this._container},_.prototype.getCanvasContainer=function(){return this._canvasContainer},_.prototype.getCanvas=function(){return this._canvas},_.prototype._containerDimensions=function(){var b=0,E=0;return this._container&&(b=this._container.clientWidth||400,E=this._container.clientHeight||300),[b,E]},_.prototype._detectMissingCSS=function(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},_.prototype._setupContainer=function(){var b=this._container;b.classList.add("mapboxgl-map"),(this._missingCSSCanary=u.create("div","mapboxgl-canary",b)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=u.create("div","mapboxgl-canvas-container",b);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=u.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var L=this._containerDimensions();this._resizeCanvas(L[0],L[1]);var F=this._controlContainer=u.create("div","mapboxgl-control-container",b),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(H){B[H]=u.create("div","mapboxgl-ctrl-"+H,F)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},_.prototype._resizeCanvas=function(b,E){var L=s.browser.devicePixelRatio||1;this._canvas.width=L*b,this._canvas.height=L*E,this._canvas.style.width=b+"px",this._canvas.style.height=E+"px"},_.prototype._setupPainter=function(){var b=s.extend({},l.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",b)||this._canvas.getContext("experimental-webgl",b);E?(this.painter=new Ir(E,this.transform),s.webpSupported.testSupport(E)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))},_.prototype._contextLost=function(b){b.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:b}))},_.prototype._contextRestored=function(b){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:b}))},_.prototype._onMapScroll=function(b){if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},_.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},_.prototype._update=function(b){return this.style?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this},_.prototype._requestRenderFrame=function(b){return this._update(),this._renderTaskQueue.add(b)},_.prototype._cancelRenderFrame=function(b){this._renderTaskQueue.remove(b)},_.prototype._render=function(b){var E,L=this,F=0,B=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=B.createQueryEXT(),B.beginQueryEXT(B.TIME_ELAPSED_EXT,E),F=s.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),!this._removed){var H=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ae=this.transform.zoom,ve=s.browser.now();this.style.zoomHistory.update(ae,ve);var be=new s.EvaluationParameters(ae,{now:ve,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ie=be.crossFadingFactor();Ie===1&&Ie===this._crossFadingFactor||(H=!0,this._crossFadingFactor=Ie),this.style.update(be)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||H)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Oe=s.browser.now()-F;B.endQueryEXT(B.TIME_ELAPSED_EXT,E),setTimeout((function(){var Ee=B.getQueryObjectEXT(E,B.QUERY_RESULT_EXT)/1e6;B.deleteQueryEXT(E),L.fire(new s.Event("gpu-timing-frame",{cpuTime:Oe,gpuTime:Ee}))}),50)}if(this.listens("gpu-timing-layer")){var Fe=this.painter.collectGpuTimers();setTimeout((function(){var Ee=L.painter.queryGpuTimers(Fe);L.fire(new s.Event("gpu-timing-layer",{layerTimes:Ee}))}),50)}var Xe=this._sourcesDirty||this._styleDirty||this._placementDirty;return Xe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||Xe||(this._fullyLoaded=!0),this}},_.prototype.remove=function(){this._hash&&this._hash.remove();for(var b=0,E=this._controls;b<E.length;b+=1)E[b].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));var L=this.painter.context.gl.getExtension("WEBGL_lose_context");L&&L.loseContext(),rh(this._canvasContainer),rh(this._controlContainer),rh(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new s.Event("remove"))},_.prototype.triggerRepaint=function(){var b=this;this.style&&!this._frame&&(this._frame=s.browser.frame((function(E){b._frame=null,b._render(E)})))},_.prototype._onWindowOnline=function(){this._update()},_.prototype._onWindowResize=function(b){this._trackResize&&this.resize({originalEvent:b})._update()},g.showTileBoundaries.get=function(){return!!this._showTileBoundaries},g.showTileBoundaries.set=function(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())},g.showPadding.get=function(){return!!this._showPadding},g.showPadding.set=function(b){this._showPadding!==b&&(this._showPadding=b,this._update())},g.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},g.showCollisionBoxes.set=function(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())},g.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},g.showOverdrawInspector.set=function(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())},g.repaint.get=function(){return!!this._repaint},g.repaint.set=function(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())},g.vertices.get=function(){return!!this._vertices},g.vertices.set=function(b){this._vertices=b,this._update()},_.prototype._setCacheLimits=function(b,E){s.setCacheLimits(b,E)},g.version.get=function(){return s.version},Object.defineProperties(_.prototype,g),_})(Mg);function rh(p){p.parentNode&&p.parentNode.removeChild(p)}var y_={showCompass:!0,showZoom:!0,visualizePitch:!1},ou=function(p){var _=this;this.options=s.extend({},y_,p),this._container=u.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(g){return g.preventDefault()})),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(g){return _._map.zoomIn({},{originalEvent:g})})),u.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(g){return _._map.zoomOut({},{originalEvent:g})})),u.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(g){_.options.visualizePitch?_._map.resetNorthPitch({},{originalEvent:g}):_._map.resetNorth({},{originalEvent:g})})),this._compassIcon=u.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ou.prototype._updateZoomButtons=function(){var p=this._map.getZoom(),_=p===this._map.getMaxZoom(),g=p===this._map.getMinZoom();this._zoomInButton.disabled=_,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",_.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},ou.prototype._rotateCompassArrow=function(){var p=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=p},ou.prototype.onAdd=function(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Zo(this._map,this._compass,this.options.visualizePitch)),this._container},ou.prototype.onRemove=function(){u.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ou.prototype._createButton=function(p,_){var g=u.create("button",p,this._container);return g.type="button",g.addEventListener("click",_),g},ou.prototype._setButtonTitle=function(p,_){var g=this._map._getUIString("NavigationControl."+_);p.title=g,p.setAttribute("aria-label",g)};var Zo=function(p,_,g){g===void 0&&(g=!1),this._clickTolerance=10,this.element=_,this.mouseRotate=new Eg({clickTolerance:p.dragRotate._mouseRotate._clickTolerance}),this.map=p,g&&(this.mousePitch=new f_({clickTolerance:p.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener(_,"mousedown",this.mousedown),u.addEventListener(_,"touchstart",this.touchstart,{passive:!1}),u.addEventListener(_,"touchmove",this.touchmove),u.addEventListener(_,"touchend",this.touchend),u.addEventListener(_,"touchcancel",this.reset)};function _d(p,_,g){if(p=new s.LngLat(p.lng,p.lat),_){var b=new s.LngLat(p.lng-360,p.lat),E=new s.LngLat(p.lng+360,p.lat),L=g.locationPoint(p).distSqr(_);g.locationPoint(b).distSqr(_)<L?p=b:g.locationPoint(E).distSqr(_)<L&&(p=E)}for(;Math.abs(p.lng-g.center.lng)>180;){var F=g.locationPoint(p);if(F.x>=0&&F.y>=0&&F.x<=g.width&&F.y<=g.height)break;p.lng>g.center.lng?p.lng-=360:p.lng+=360}return p}Zo.prototype.down=function(p,_){this.mouseRotate.mousedown(p,_),this.mousePitch&&this.mousePitch.mousedown(p,_),u.disableDrag()},Zo.prototype.move=function(p,_){var g=this.map,b=this.mouseRotate.mousemoveWindow(p,_);if(b&&b.bearingDelta&&g.setBearing(g.getBearing()+b.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(p,_);E&&E.pitchDelta&&g.setPitch(g.getPitch()+E.pitchDelta)}},Zo.prototype.off=function(){var p=this.element;u.removeEventListener(p,"mousedown",this.mousedown),u.removeEventListener(p,"touchstart",this.touchstart,{passive:!1}),u.removeEventListener(p,"touchmove",this.touchmove),u.removeEventListener(p,"touchend",this.touchend),u.removeEventListener(p,"touchcancel",this.reset),this.offTemp()},Zo.prototype.offTemp=function(){u.enableDrag(),u.removeEventListener(s.window,"mousemove",this.mousemove),u.removeEventListener(s.window,"mouseup",this.mouseup)},Zo.prototype.mousedown=function(p){this.down(s.extend({},p,{ctrlKey:!0,preventDefault:function(){return p.preventDefault()}}),u.mousePos(this.element,p)),u.addEventListener(s.window,"mousemove",this.mousemove),u.addEventListener(s.window,"mouseup",this.mouseup)},Zo.prototype.mousemove=function(p){this.move(p,u.mousePos(this.element,p))},Zo.prototype.mouseup=function(p){this.mouseRotate.mouseupWindow(p),this.mousePitch&&this.mousePitch.mouseupWindow(p),this.offTemp()},Zo.prototype.touchstart=function(p){p.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=u.touchPos(this.element,p.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return p.preventDefault()}},this._startPos))},Zo.prototype.touchmove=function(p){p.targetTouches.length!==1?this.reset():(this._lastPos=u.touchPos(this.element,p.targetTouches)[0],this.move({preventDefault:function(){return p.preventDefault()}},this._lastPos))},Zo.prototype.touchend=function(p){p.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Zo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Gl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Lg(p,_,g){var b=p.classList;for(var E in Gl)b.remove("mapboxgl-"+g+"-anchor-"+E);b.add("mapboxgl-"+g+"-anchor-"+_)}var vd,Kf=(function(p){function _(g,b){if(p.call(this),(g instanceof s.window.HTMLElement||b)&&(g=s.extend({element:g},b)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=g&&g.anchor||"center",this._color=g&&g.color||"#3FB1CE",this._scale=g&&g.scale||1,this._draggable=g&&g.draggable||!1,this._clickTolerance=g&&g.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=g&&g.rotation||0,this._rotationAlignment=g&&g.rotationAlignment||"auto",this._pitchAlignment=g&&g.pitchAlignment&&g.pitchAlignment!=="auto"?g.pitchAlignment:this._rotationAlignment,g&&g.element)this._element=g.element,this._offset=s.Point.convert(g&&g.offset||[0,0]);else{this._defaultMarker=!0,this._element=u.create("div"),this._element.setAttribute("aria-label","Map marker");var E=u.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var L=u.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"stroke","none"),L.setAttributeNS(null,"stroke-width","1"),L.setAttributeNS(null,"fill","none"),L.setAttributeNS(null,"fill-rule","evenodd");var F=u.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill-rule","nonzero");var B=u.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");for(var H=0,ae=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];H<ae.length;H+=1){var ve=ae[H],be=u.createNS("http://www.w3.org/2000/svg","ellipse");be.setAttributeNS(null,"opacity","0.04"),be.setAttributeNS(null,"cx","10.5"),be.setAttributeNS(null,"cy","5.80029008"),be.setAttributeNS(null,"rx",ve.rx),be.setAttributeNS(null,"ry",ve.ry),B.appendChild(be)}var Ie=u.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"fill",this._color);var Oe=u.createNS("http://www.w3.org/2000/svg","path");Oe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ie.appendChild(Oe);var Fe=u.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"opacity","0.25"),Fe.setAttributeNS(null,"fill","#000000");var Xe=u.createNS("http://www.w3.org/2000/svg","path");Xe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Fe.appendChild(Xe);var Ee=u.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ee.setAttributeNS(null,"fill","#FFFFFF");var Ue=u.createNS("http://www.w3.org/2000/svg","g");Ue.setAttributeNS(null,"transform","translate(8.0, 8.0)");var je=u.createNS("http://www.w3.org/2000/svg","circle");je.setAttributeNS(null,"fill","#000000"),je.setAttributeNS(null,"opacity","0.25"),je.setAttributeNS(null,"cx","5.5"),je.setAttributeNS(null,"cy","5.5"),je.setAttributeNS(null,"r","5.4999962");var nt=u.createNS("http://www.w3.org/2000/svg","circle");nt.setAttributeNS(null,"fill","#FFFFFF"),nt.setAttributeNS(null,"cx","5.5"),nt.setAttributeNS(null,"cy","5.5"),nt.setAttributeNS(null,"r","5.4999962"),Ue.appendChild(je),Ue.appendChild(nt),F.appendChild(B),F.appendChild(Ie),F.appendChild(Fe),F.appendChild(Ee),F.appendChild(Ue),E.appendChild(F),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=s.Point.convert(g&&g.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(ut){ut.preventDefault()})),this._element.addEventListener("mousedown",(function(ut){ut.preventDefault()})),Lg(this._element,this._anchor,"marker"),this._popup=null}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.addTo=function(g){return this.remove(),this._map=g,g.getCanvasContainer().appendChild(this._element),g.on("move",this._update),g.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},_.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),u.remove(this._element),this._popup&&this._popup.remove(),this},_.prototype.getLngLat=function(){return this._lngLat},_.prototype.setLngLat=function(g){return this._lngLat=s.LngLat.convert(g),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},_.prototype.getElement=function(){return this._element},_.prototype.setPopup=function(g){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),g){if(!("offset"in g.options)){var b=Math.sqrt(Math.pow(13.5,2)/2);g.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=g,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},_.prototype._onKeyPress=function(g){var b=g.code,E=g.charCode||g.keyCode;b!=="Space"&&b!=="Enter"&&E!==32&&E!==13||this.togglePopup()},_.prototype._onMapClick=function(g){var b=g.originalEvent.target,E=this._element;this._popup&&(b===E||E.contains(b))&&this.togglePopup()},_.prototype.getPopup=function(){return this._popup},_.prototype.togglePopup=function(){var g=this._popup;return g?(g.isOpen()?g.remove():g.addTo(this._map),this):this},_.prototype._update=function(g){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=_d(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(b="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),g&&g.type!=="moveend"||(this._pos=this._pos.round()),u.setTransform(this._element,Gl[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+b)}},_.prototype.getOffset=function(){return this._offset},_.prototype.setOffset=function(g){return this._offset=s.Point.convert(g),this._update(),this},_.prototype._onMove=function(g){if(!this._isDragging){var b=this._clickTolerance||this._map._clickTolerance;this._isDragging=g.point.dist(this._pointerdownPos)>=b}this._isDragging&&(this._pos=g.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))},_.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"},_.prototype._addDragHandler=function(g){this._element.contains(g.originalEvent.target)&&(g.preventDefault(),this._positionDelta=g.point.sub(this._pos).add(this._offset),this._pointerdownPos=g.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},_.prototype.setDraggable=function(g){return this._draggable=!!g,this._map&&(g?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},_.prototype.isDraggable=function(){return this._draggable},_.prototype.setRotation=function(g){return this._rotation=g||0,this._update(),this},_.prototype.getRotation=function(){return this._rotation},_.prototype.setRotationAlignment=function(g){return this._rotationAlignment=g||"auto",this._update(),this},_.prototype.getRotationAlignment=function(){return this._rotationAlignment},_.prototype.setPitchAlignment=function(g){return this._pitchAlignment=g&&g!=="auto"?g:this._rotationAlignment,this._update(),this},_.prototype.getPitchAlignment=function(){return this._pitchAlignment},_})(s.Evented),__={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},bd=0,sh=!1,v_=(function(p){function _(g){p.call(this),this.options=s.extend({},__,g),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.onAdd=function(g){var b;return this._map=g,this._container=u.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),b=this._setupUI,vd!==void 0?b(vd):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then((function(E){b(vd=E.state!=="denied")})):b(vd=!!s.window.navigator.geolocation),this._container},_.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),u.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,bd=0,sh=!1},_.prototype._isOutOfMapMaxBounds=function(g){var b=this._map.getMaxBounds(),E=g.coords;return b&&(E.longitude<b.getWest()||E.longitude>b.getEast()||E.latitude<b.getSouth()||E.latitude>b.getNorth())},_.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},_.prototype._onSuccess=function(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",g)),this._finish()}},_.prototype._updateCamera=function(g){var b=new s.LngLat(g.coords.longitude,g.coords.latitude),E=g.coords.accuracy,L=this._map.getBearing(),F=s.extend({bearing:L},this.options.fitBoundsOptions);this._map.fitBounds(b.toBounds(E),F,{geolocateSource:!0})},_.prototype._updateMarker=function(g){if(g){var b=new s.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(b).addTo(this._map),this._userLocationDotMarker.setLngLat(b).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},_.prototype._updateCircleRadius=function(){var g=this._map._container.clientHeight/2,b=this._map.unproject([0,g]),E=this._map.unproject([1,g]),L=b.distanceTo(E),F=Math.ceil(2*this._accuracy/L);this._circleElement.style.width=F+"px",this._circleElement.style.height=F+"px"},_.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},_.prototype._onError=function(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&sh)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",g)),this._finish()}},_.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},_.prototype._setupUI=function(g){var b=this;if(this._container.addEventListener("contextmenu",(function(F){return F.preventDefault()})),this._geolocateButton=u.create("button","mapboxgl-ctrl-geolocate",this._container),u.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",g===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var L=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=L,this._geolocateButton.setAttribute("aria-label",L)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=u.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Kf(this._dotElement),this._circleElement=u.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Kf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(F){F.geolocateSource||b._watchState!=="ACTIVE_LOCK"||F.originalEvent&&F.originalEvent.type==="resize"||(b._watchState="BACKGROUND",b._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),b._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),b.fire(new s.Event("trackuserlocationend")))}))},_.prototype.trigger=function(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":bd--,sh=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++bd>1?(g={maximumAge:6e5,timeout:0},sh=!0):(g=this.options.positionOptions,sh=!1),this._geolocationWatchID=s.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else s.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},_.prototype._clearWatch=function(){s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},_})(s.Evented),Qu={maxWidth:100,unit:"metric"},ec=function(p){this.options=s.extend({},Qu,p),s.bindAll(["_onMove","setUnit"],this)};function Pg(p,_,g){var b=g&&g.maxWidth||100,E=p._container.clientHeight/2,L=p.unproject([0,E]),F=p.unproject([b,E]),B=L.distanceTo(F);if(g&&g.unit==="imperial"){var H=3.2808*B;H>5280?tc(_,b,H/5280,p._getUIString("ScaleControl.Miles")):tc(_,b,H,p._getUIString("ScaleControl.Feet"))}else g&&g.unit==="nautical"?tc(_,b,B/1852,p._getUIString("ScaleControl.NauticalMiles")):B>=1e3?tc(_,b,B/1e3,p._getUIString("ScaleControl.Kilometers")):tc(_,b,B,p._getUIString("ScaleControl.Meters"))}function tc(p,_,g,b){var E,L,F,B=(E=g,(L=Math.pow(10,(""+Math.floor(E)).length-1))*(F=(F=E/L)>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:(function(H){var ae=Math.pow(10,Math.ceil(-Math.log(H)/Math.LN10));return Math.round(H*ae)/ae})(F)));p.style.width=_*(B/g)+"px",p.innerHTML=B+"&nbsp;"+b}ec.prototype.getDefaultPosition=function(){return"bottom-left"},ec.prototype._onMove=function(){Pg(this._map,this._container,this.options)},ec.prototype.onAdd=function(p){return this._map=p,this._container=u.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ec.prototype.onRemove=function(){u.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},ec.prototype.setUnit=function(p){this.options.unit=p,Pg(this._map,this._container,this.options)};var Pa=function(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof s.window.HTMLElement?this._container=p.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in s.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in s.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in s.window.document&&(this._fullscreenchange="MSFullscreenChange")};Pa.prototype.onAdd=function(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=u.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Pa.prototype.onRemove=function(){u.remove(this._controlContainer),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Pa.prototype._checkFullscreenSupport=function(){return!!(s.window.document.fullscreenEnabled||s.window.document.mozFullScreenEnabled||s.window.document.msFullscreenEnabled||s.window.document.webkitFullscreenEnabled)},Pa.prototype._setupUI=function(){var p=this._fullscreenButton=u.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);u.create("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden",!0),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Pa.prototype._updateTitle=function(){var p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p},Pa.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Pa.prototype._isFullscreen=function(){return this._fullscreen},Pa.prototype._changeIcon=function(){(s.window.document.fullscreenElement||s.window.document.mozFullScreenElement||s.window.document.webkitFullscreenElement||s.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Pa.prototype._onClickFullscreen=function(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.mozCancelFullScreen?s.window.document.mozCancelFullScreen():s.window.document.msExitFullscreen?s.window.document.msExitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var b_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},jf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),x_=(function(p){function _(g){p.call(this),this.options=s.extend(Object.create(b_),g),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return p&&(_.__proto__=p),(_.prototype=Object.create(p&&p.prototype)).constructor=_,_.prototype.addTo=function(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this},_.prototype.isOpen=function(){return!!this._map},_.prototype.remove=function(){return this._content&&u.remove(this._content),this._container&&(u.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this},_.prototype.getLngLat=function(){return this._lngLat},_.prototype.setLngLat=function(g){return this._lngLat=s.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},_.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},_.prototype.getElement=function(){return this._container},_.prototype.setText=function(g){return this.setDOMContent(s.window.document.createTextNode(g))},_.prototype.setHTML=function(g){var b,E=s.window.document.createDocumentFragment(),L=s.window.document.createElement("body");for(L.innerHTML=g;b=L.firstChild;)E.appendChild(b);return this.setDOMContent(E)},_.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},_.prototype.setMaxWidth=function(g){return this.options.maxWidth=g,this._update(),this},_.prototype.setDOMContent=function(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=u.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this},_.prototype.addClassName=function(g){this._container&&this._container.classList.add(g)},_.prototype.removeClassName=function(g){this._container&&this._container.classList.remove(g)},_.prototype.setOffset=function(g){return this.options.offset=g,this._update(),this},_.prototype.toggleClassName=function(g){if(this._container)return this._container.classList.toggle(g)},_.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=u.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},_.prototype._onMouseUp=function(g){this._update(g.point)},_.prototype._onMouseMove=function(g){this._update(g.point)},_.prototype._onDrag=function(g){this._update(g.point)},_.prototype._update=function(g){var b=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=u.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=u.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(be){return b._container.classList.add(be)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_d(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||g)){var E=this._pos=this._trackPointer&&g?g:this._map.project(this._lngLat),L=this.options.anchor,F=(function be(Ie){if(Ie){if(typeof Ie=="number"){var Oe=Math.round(Math.sqrt(.5*Math.pow(Ie,2)));return{center:new s.Point(0,0),top:new s.Point(0,Ie),"top-left":new s.Point(Oe,Oe),"top-right":new s.Point(-Oe,Oe),bottom:new s.Point(0,-Ie),"bottom-left":new s.Point(Oe,-Oe),"bottom-right":new s.Point(-Oe,-Oe),left:new s.Point(Ie,0),right:new s.Point(-Ie,0)}}if(Ie instanceof s.Point||Array.isArray(Ie)){var Fe=s.Point.convert(Ie);return{center:Fe,top:Fe,"top-left":Fe,"top-right":Fe,bottom:Fe,"bottom-left":Fe,"bottom-right":Fe,left:Fe,right:Fe}}return{center:s.Point.convert(Ie.center||[0,0]),top:s.Point.convert(Ie.top||[0,0]),"top-left":s.Point.convert(Ie["top-left"]||[0,0]),"top-right":s.Point.convert(Ie["top-right"]||[0,0]),bottom:s.Point.convert(Ie.bottom||[0,0]),"bottom-left":s.Point.convert(Ie["bottom-left"]||[0,0]),"bottom-right":s.Point.convert(Ie["bottom-right"]||[0,0]),left:s.Point.convert(Ie.left||[0,0]),right:s.Point.convert(Ie.right||[0,0])}}return be(new s.Point(0,0))})(this.options.offset);if(!L){var B,H=this._container.offsetWidth,ae=this._container.offsetHeight;B=E.y+F.bottom.y<ae?["top"]:E.y>this._map.transform.height-ae?["bottom"]:[],E.x<H/2?B.push("left"):E.x>this._map.transform.width-H/2&&B.push("right"),L=B.length===0?"bottom":B.join("-")}var ve=E.add(F[L]).round();u.setTransform(this._container,Gl[L]+" translate("+ve.x+"px,"+ve.y+"px)"),Lg(this._container,L,"popup")}},_.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var g=this._container.querySelector(jf);g&&g.focus()}},_.prototype._onClose=function(){this.remove()},_})(s.Evented),Gg={version:s.version,supported:l,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:d1,NavigationControl:ou,GeolocateControl:v_,AttributionControl:uo,ScaleControl:ec,FullscreenControl:Pa,Popup:x_,Marker:Kf,Style:Oo,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,config:s.config,prewarm:function(){pt().acquire(ct)},clearPrewarmedResources:function(){var p=qt;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(ct),qt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(p){s.config.ACCESS_TOKEN=p},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(p){s.config.API_URL=p},get workerCount(){return It.workerCount},set workerCount(p){It.workerCount=p},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){s.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage:function(p){s.clearTileCache(p)},workerUrl:""};return Gg})),r}))})(aI)),aI.exports}var vj=_j();const rF=u4(vj);class mM extends cg{constructor(e){const t=Object.assign({},e);delete t.accessToken,delete t.style,delete t.container,delete t.xyz,super(t),this.set("xyz",e.maplibreOptions.xyz),this.set("xyz_custom",e.maplibreOptions.xyz_custom),this.xyz_=e.xyz,e.accessToken&&(rF.accessToken=e.accessToken),this.map_=new rF.Map({container:e.maplibreOptions.container,style:e.maplibreOptions.style,attributionControl:!1,interactive:!1}),this.maplibreMap=this.map_}getMapBoxMap(){return this.map_}getMapLibreMap(){return this.map_}render(e){const t=this.map_.getCanvas(),i=e.viewState;t.style.position="absolute";const r=this.getVisible();t.style.display=r?"block":"none";const o=this.getOpacity().toString();o!==t.style.opacity&&(t.style.opacity=o);const s=i.rotation;return s&&this.map_.rotateTo(Kh(-s),{animate:!1}),this.map_.jumpTo({center:vc(i.center),zoom:i.zoom-1,animate:!1}),this.map_._frame&&(this.map_._frame.cancel(),this.map_._frame=null),this.map_._render(),t}setLayerVisibility(e,t){this.map_.setLayoutProperty(e,"visibility",t?"visible":"none")}getStyle(){return this.map_.getStyle()}getXYZ(){return this.get("xyz")}}function c4(n,e,t){t(n,e)&&n instanceof wf&&n.getLayers().forEach(r=>{c4(r,[...e,n],t)})}const h4=parseInt("19",10),bj=parseInt("8",10);var yM=(n=>(n.ON_LAYER_TYPE="ON_LAYER_TYPE",n))(yM||{});const Dp="EPSG:3857",Fu="EPSG:4326",tu="EPSG:2169",xj=JSON.parse("[2.6, 47.7, 8.6, 51]"),Ij=parseInt("8",10);let H2;const K2=Ei();function Kn(){function n(){return H2}function e(){return!!K2.value}function t(){return K2.value=H2=new gj({view:new mc({center:[682439,6379152],constrainResolution:!0,enableRotation:!0,extent:hb(xj,"EPSG:4326","EPSG:3857"),multiWorld:!1,zoom:Ij}),controls:[],keyboardEventTarget:document}),H2}function i(x,C){return x.id===C.id}function r(x,C){return x===C}function o(x,C){return x.layers?.some(w=>i(w,C))}function s(x,C){const w=x?.layers?.find(S=>i(S,C));return!r(w,C)}function l(x,C){return!(C===null||!("layers"in x)||!("layers"in C)||typeof C.layers>"u"||typeof x.layers>"u"||x.layers===C.layers)}function u(x,C){return!("layers"in x)||typeof x.layers>"u"?[]:C===null||!("layers"in C)?x.layers.map((w,S)=>({layer:w,position:S})):x.layers===C.layers?[]:x.layers.reduce((w,S,T)=>o(C,S)?w:[...w,{layer:S,position:T}],[])}function h(x,C){return l(x,C)?C.layers.reduce((w,S)=>o(x,S)?w:[...w,S],[]):[]}function d(x,C){return l(x,C)?x.layers.reduce((w,S)=>s(C,S)?[...w,S]:w,[]):[]}function m(x,C,w){const S=C.layers?.find(M=>M.id===x),T=w?.layers?.find(M=>M.id===x);return S?.type!==T?.type?yM.ON_LAYER_TYPE:null}function y(){const x=Kn().getOlMap();x.updateSize(),c4(x.getLayerGroup(),[],C=>(C instanceof mM&&C.getMapLibreMap().resize(),!0))}return{olMap:K2,getOlMap:n,hasOlMap:e,createMap:t,equalsLayer:i,hasLayer:o,layerHasChanged:s,contextHasChanged:l,getAddedLayers:u,getRemovedLayers:h,getMutatedLayers:d,getMutationType:m,resize:y}}function _M(n,e="fr-FR"){return n?new Intl.DateTimeFormat(e,{dateStyle:"short",timeStyle:"short"}).format(new Date(n)):""}function Cj(n,e,t){if(n==null||isNaN(n))return Wn.t("N/A",{ns:"client"});switch(t){case"elevation":return vM(n,e);case"area":return KE(n,e);case"length":default:return af(n,e)}}function vM(n,e=0){return isNaN(+n)?n:`${(+n).toFixed(e)} m`}function af(n,e=2){return n===null?Wn.t("N/A",{ns:"client"}):n<1e3?`${n.toFixed(e)} m`:n>=1e3?`${(n/1e3).toFixed(e)} km`:""}function KE(n,e=2){return n===null?Wn.t("N/A",{ns:"client"}):n<1e6?`${n.toFixed(e)} m`:n>=1e6?`${(n/1e6).toFixed(e)} km`:""}function sF(n){return n===void 0?Wn.t("N/A",{ns:"client"}):`${n.number}, ${n.street}, ${n.postal_code} ${n.locality}`}function wj(n,e,t){const i=t.split(":")[2];let r=t,o;i!==void 0?r=t.slice(0,t.lastIndexOf(":")):t.endsWith("*")&&(o=vc(n,e)[0]<=6?"UTM31N":"UTM32N",r=t.replace("3*",o.slice(3,5)));const s=gs(n,e,r),l=r===Fu,u=s.map((d,m)=>(l?Aj(d):d)<0?"WS"[m]:"EN"[m]),h=s.map(d=>l?Sj(d,i):Math.abs(Math.round(d)).toString());return o!==void 0?`${h.join(" | ")}  (${o})`:h.map((d,m)=>`${d} ${u[m]}`).join(" | ")}function Aj(n){return(n+180)%360-180}function Sj(n,e){const t=(n+180)%360-180,i=Math.abs(t);if(e===void 0)return Math.round(i*1e6)/1e6;const r=Math.floor(i),o=i%1*60;if(e==="DMm"){const s=Math.round(o*1e6)/1e6;return`${r} ${s}`}if(e==="DMS"){const s=Math.floor(o),l=Math.round(o%1*600)/10;return`${r} ${s} ${l}`}return"N/A"}const Ej={install(n){n.directive("format-measure",Tj)}};function Tj(n,e){let t,i=e.value;const r=e?.arg!==void 0?+e?.arg:void 0;try{t=Object.keys(e.modifiers)[0]}catch{}i=Cj(i,r,t),n.textContent=i}function Rj(n){const e=Object.keys(n.defs),t=e.length;let i,r;for(i=0;i<t;++i){const o=e[i];if(!rI(o)){const s=n.defs(o);let l=s.units;!l&&s.projName==="longlat"&&(l="degrees"),tC(new Pw({code:o,axisOrientation:s.axis,metersPerUnit:s.to_meter,units:l}))}}for(i=0;i<t;++i){const o=e[i],s=rI(o);for(r=0;r<t;++r){const l=e[r],u=rI(l);if(!sI(o,l))if(n.defs[o]===n.defs[l])GE([s,u]);else{const h=n(o,l);RY(s,u,MG(s,u,h.forward),MG(u,s,h.inverse))}}}}function Mj(n){n("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),n("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),n("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var e=1;e<=60;++e)n("EPSG:"+(32600+e),"+proj=utm +zone="+e+" +datum=WGS84 +units=m"),n("EPSG:"+(32700+e),"+proj=utm +zone="+e+" +south +datum=WGS84 +units=m");n("EPSG:5041","+title=WGS 84 / UPS North (E,N) +proj=stere +lat_0=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),n("EPSG:5042","+title=WGS 84 / UPS South (E,N) +proj=stere +lat_0=-90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),n.WGS84=n["EPSG:4326"],n["EPSG:3785"]=n["EPSG:3857"],n.GOOGLE=n["EPSG:3857"],n["EPSG:900913"]=n["EPSG:3857"],n["EPSG:102113"]=n["EPSG:3857"]}var qp=1,Qp=2,ry=3,kj=4,jE=5,oF=6378137,Lj=6356752314e-3,aF=.0066943799901413165,j0=484813681109536e-20,Vt=Math.PI/2,Pj=.16666666666666666,Gj=.04722222222222222,Fj=.022156084656084655,on=1e-10,ws=.017453292519943295,$a=57.29577951308232,_r=Math.PI/4,Nv=Math.PI*2,Fs=3.14159265359,tl={};tl.greenwich=0;tl.lisbon=-9.131906111111;tl.paris=2.337229166667;tl.bogota=-74.080916666667;tl.madrid=-3.687938888889;tl.rome=12.452333333333;tl.bern=7.439583333333;tl.jakarta=106.807719444444;tl.ferro=-17.666666666667;tl.brussels=4.367975;tl.stockholm=18.058277777778;tl.athens=23.7163375;tl.oslo=10.722916666667;const Oj={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var lF=/[\s_\-\/\(\)]/g;function pf(n,e){if(n[e])return n[e];for(var t=Object.keys(n),i=e.toLowerCase().replace(lF,""),r=-1,o,s;++r<t.length;)if(o=t[r],s=o.toLowerCase().replace(lF,""),s===i)return n[o]}function $E(n){var e={},t=n.split("+").map(function(l){return l.trim()}).filter(function(l){return l}).reduce(function(l,u){var h=u.split("=");return h.push(!0),l[h[0].toLowerCase()]=h[1],l},{}),i,r,o,s={proj:"projName",datum:"datumCode",rf:function(l){e.rf=parseFloat(l)},lat_0:function(l){e.lat0=l*ws},lat_1:function(l){e.lat1=l*ws},lat_2:function(l){e.lat2=l*ws},lat_ts:function(l){e.lat_ts=l*ws},lon_0:function(l){e.long0=l*ws},lon_1:function(l){e.long1=l*ws},lon_2:function(l){e.long2=l*ws},alpha:function(l){e.alpha=parseFloat(l)*ws},gamma:function(l){e.rectified_grid_angle=parseFloat(l)*ws},lonc:function(l){e.longc=l*ws},x_0:function(l){e.x0=parseFloat(l)},y_0:function(l){e.y0=parseFloat(l)},k_0:function(l){e.k0=parseFloat(l)},k:function(l){e.k0=parseFloat(l)},a:function(l){e.a=parseFloat(l)},b:function(l){e.b=parseFloat(l)},r:function(l){e.a=e.b=parseFloat(l)},r_a:function(){e.R_A=!0},zone:function(l){e.zone=parseInt(l,10)},south:function(){e.utmSouth=!0},towgs84:function(l){e.datum_params=l.split(",").map(function(u){return parseFloat(u)})},to_meter:function(l){e.to_meter=parseFloat(l)},units:function(l){e.units=l;var u=pf(Oj,l);u&&(e.to_meter=u.to_meter)},from_greenwich:function(l){e.from_greenwich=l*ws},pm:function(l){var u=pf(tl,l);e.from_greenwich=(u||parseFloat(l))*ws},nadgrids:function(l){l==="@null"?e.datumCode="none":e.nadgrids=l},axis:function(l){var u="ewnsud";l.length===3&&u.indexOf(l.substr(0,1))!==-1&&u.indexOf(l.substr(1,1))!==-1&&u.indexOf(l.substr(2,1))!==-1&&(e.axis=l)},approx:function(){e.approx=!0},over:function(){e.over=!0}};for(i in t)r=t[i],i in s?(o=s[i],typeof o=="function"?o(r):e[o]=r):e[i]=r;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e.projStr=n,e}class d4{static getId(e){const t=e.find(i=>Array.isArray(i)&&i[0]==="ID");return t&&t.length>=3?{authority:t[1],code:parseInt(t[2],10)}:null}static convertUnit(e,t="unit"){if(!e||e.length<3)return{type:t,name:"unknown",conversion_factor:null};const i=e[1],r=parseFloat(e[2])||null,o=e.find(l=>Array.isArray(l)&&l[0]==="ID"),s=o?{authority:o[1],code:parseInt(o[2],10)}:null;return{type:t,name:i,conversion_factor:r,id:s}}static convertAxis(e){const t=e[1]||"Unknown";let i;const r=t.match(/^\((.)\)$/);if(r){const h=r[1].toUpperCase();if(h==="E")i="east";else if(h==="N")i="north";else if(h==="U")i="up";else throw new Error(`Unknown axis abbreviation: ${h}`)}else i=e[2]?e[2].toLowerCase():"unknown";const o=e.find(h=>Array.isArray(h)&&h[0]==="ORDER"),s=o?parseInt(o[1],10):null,l=e.find(h=>Array.isArray(h)&&(h[0]==="LENGTHUNIT"||h[0]==="ANGLEUNIT"||h[0]==="SCALEUNIT")),u=this.convertUnit(l);return{name:t,direction:i,unit:u,order:s}}static extractAxes(e){return e.filter(t=>Array.isArray(t)&&t[0]==="AXIS").map(t=>this.convertAxis(t)).sort((t,i)=>(t.order||0)-(i.order||0))}static convert(e,t={}){switch(e[0]){case"PROJCRS":t.type="ProjectedCRS",t.name=e[1],t.base_crs=e.find(y=>Array.isArray(y)&&y[0]==="BASEGEOGCRS")?this.convert(e.find(y=>Array.isArray(y)&&y[0]==="BASEGEOGCRS")):null,t.conversion=e.find(y=>Array.isArray(y)&&y[0]==="CONVERSION")?this.convert(e.find(y=>Array.isArray(y)&&y[0]==="CONVERSION")):null;const i=e.find(y=>Array.isArray(y)&&y[0]==="CS");i&&(t.coordinate_system={type:i[1],axis:this.extractAxes(e)});const r=e.find(y=>Array.isArray(y)&&y[0]==="LENGTHUNIT");if(r){const y=this.convertUnit(r);t.coordinate_system.unit=y}t.id=this.getId(e);break;case"BASEGEOGCRS":case"GEOGCRS":t.type="GeographicCRS",t.name=e[1];const o=e.find(y=>Array.isArray(y)&&(y[0]==="DATUM"||y[0]==="ENSEMBLE"));if(o){const y=this.convert(o);o[0]==="ENSEMBLE"?t.datum_ensemble=y:t.datum=y;const x=e.find(C=>Array.isArray(C)&&C[0]==="PRIMEM");x&&x[1]!=="Greenwich"&&(y.prime_meridian={name:x[1],longitude:parseFloat(x[2])})}t.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(e)},t.id=this.getId(e);break;case"DATUM":t.type="GeodeticReferenceFrame",t.name=e[1],t.ellipsoid=e.find(y=>Array.isArray(y)&&y[0]==="ELLIPSOID")?this.convert(e.find(y=>Array.isArray(y)&&y[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":t.type="DatumEnsemble",t.name=e[1],t.members=e.filter(y=>Array.isArray(y)&&y[0]==="MEMBER").map(y=>({type:"DatumEnsembleMember",name:y[1],id:this.getId(y)}));const s=e.find(y=>Array.isArray(y)&&y[0]==="ENSEMBLEACCURACY");s&&(t.accuracy=parseFloat(s[1]));const l=e.find(y=>Array.isArray(y)&&y[0]==="ELLIPSOID");l&&(t.ellipsoid=this.convert(l)),t.id=this.getId(e);break;case"ELLIPSOID":t.type="Ellipsoid",t.name=e[1],t.semi_major_axis=parseFloat(e[2]),t.inverse_flattening=parseFloat(e[3]),e.find(y=>Array.isArray(y)&&y[0]==="LENGTHUNIT")&&this.convert(e.find(y=>Array.isArray(y)&&y[0]==="LENGTHUNIT"),t);break;case"CONVERSION":t.type="Conversion",t.name=e[1],t.method=e.find(y=>Array.isArray(y)&&y[0]==="METHOD")?this.convert(e.find(y=>Array.isArray(y)&&y[0]==="METHOD")):null,t.parameters=e.filter(y=>Array.isArray(y)&&y[0]==="PARAMETER").map(y=>this.convert(y));break;case"METHOD":t.type="Method",t.name=e[1],t.id=this.getId(e);break;case"PARAMETER":t.type="Parameter",t.name=e[1],t.value=parseFloat(e[2]),t.unit=this.convertUnit(e.find(y=>Array.isArray(y)&&(y[0]==="LENGTHUNIT"||y[0]==="ANGLEUNIT"||y[0]==="SCALEUNIT"))),t.id=this.getId(e);break;case"BOUNDCRS":t.type="BoundCRS";const u=e.find(y=>Array.isArray(y)&&y[0]==="SOURCECRS");if(u){const y=u.find(x=>Array.isArray(x));t.source_crs=y?this.convert(y):null}const h=e.find(y=>Array.isArray(y)&&y[0]==="TARGETCRS");if(h){const y=h.find(x=>Array.isArray(x));t.target_crs=y?this.convert(y):null}const d=e.find(y=>Array.isArray(y)&&y[0]==="ABRIDGEDTRANSFORMATION");d?t.transformation=this.convert(d):t.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(t.type="Transformation",t.name=e[1],t.method=e.find(y=>Array.isArray(y)&&y[0]==="METHOD")?this.convert(e.find(y=>Array.isArray(y)&&y[0]==="METHOD")):null,t.parameters=e.filter(y=>Array.isArray(y)&&(y[0]==="PARAMETER"||y[0]==="PARAMETERFILE")).map(y=>{if(y[0]==="PARAMETER")return this.convert(y);if(y[0]==="PARAMETERFILE")return{name:y[1],value:y[2],id:{authority:"EPSG",code:8656}}}),t.parameters.length===7){const y=t.parameters[6];y.name==="Scale difference"&&(y.value=Math.round((y.value-1)*1e12)/1e6)}t.id=this.getId(e);break;case"AXIS":t.coordinate_system||(t.coordinate_system={type:"unspecified",axis:[]}),t.coordinate_system.axis.push(this.convertAxis(e));break;case"LENGTHUNIT":const m=this.convertUnit(e,"LinearUnit");t.coordinate_system&&t.coordinate_system.axis&&t.coordinate_system.axis.forEach(y=>{y.unit||(y.unit=m)}),m.conversion_factor&&m.conversion_factor!==1&&t.semi_major_axis&&(t.semi_major_axis={value:t.semi_major_axis,unit:m});break;default:t.keyword=e[0];break}return t}}class Nj extends d4{static convert(e,t={}){return super.convert(e,t),t.coordinate_system&&t.coordinate_system.subtype==="Cartesian"&&delete t.coordinate_system,t.usage&&delete t.usage,t}}class Dj extends d4{static convert(e,t={}){super.convert(e,t);const i=e.find(o=>Array.isArray(o)&&o[0]==="CS");i&&(t.coordinate_system={subtype:i[1],axis:this.extractAxes(e)});const r=e.find(o=>Array.isArray(o)&&o[0]==="USAGE");if(r){const o=r.find(u=>Array.isArray(u)&&u[0]==="SCOPE"),s=r.find(u=>Array.isArray(u)&&u[0]==="AREA"),l=r.find(u=>Array.isArray(u)&&u[0]==="BBOX");t.usage={},o&&(t.usage.scope=o[1]),s&&(t.usage.area=s[1]),l&&(t.usage.bbox=l.slice(1))}return t}}function Vj(n){return n.find(e=>Array.isArray(e)&&e[0]==="USAGE")?"2019":(n.find(e=>Array.isArray(e)&&e[0]==="CS")||n[0]==="BOUNDCRS"||n[0]==="PROJCRS"||n[0]==="GEOGCRS","2015")}function Bj(n){return(Vj(n)==="2019"?Dj:Nj).convert(n)}function Zj(n){const e=n.toUpperCase();return e.includes("PROJCRS")||e.includes("GEOGCRS")||e.includes("BOUNDCRS")||e.includes("VERTCRS")||e.includes("LENGTHUNIT")||e.includes("ANGLEUNIT")||e.includes("SCALEUNIT")?"WKT2":(e.includes("PROJCS")||e.includes("GEOGCS")||e.includes("LOCAL_CS")||e.includes("VERT_CS")||e.includes("UNIT"),"WKT1")}var Dv=1,f4=2,p4=3,fC=4,g4=5,bM=-1,Wj=/\s/,zj=/[A-Za-z]/,Uj=/[A-Za-z84_]/,Yw=/[,\]]/,m4=/[\d\.E\-\+]/;function od(n){if(typeof n!="string")throw new Error("not a string");this.text=n.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Dv}od.prototype.readCharicter=function(){var n=this.text[this.place++];if(this.state!==fC)for(;Wj.test(n);){if(this.place>=this.text.length)return;n=this.text[this.place++]}switch(this.state){case Dv:return this.neutral(n);case f4:return this.keyword(n);case fC:return this.quoted(n);case g4:return this.afterquote(n);case p4:return this.number(n);case bM:return}};od.prototype.afterquote=function(n){if(n==='"'){this.word+='"',this.state=fC;return}if(Yw.test(n)){this.word=this.word.trim(),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in afterquote yet, index '+this.place)};od.prototype.afterItem=function(n){if(n===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Dv;return}if(n==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Dv,this.currentObject=this.stack.pop(),this.currentObject||(this.state=bM);return}};od.prototype.number=function(n){if(m4.test(n)){this.word+=n;return}if(Yw.test(n)){this.word=parseFloat(this.word),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in number yet, index '+this.place)};od.prototype.quoted=function(n){if(n==='"'){this.state=g4;return}this.word+=n};od.prototype.keyword=function(n){if(Uj.test(n)){this.word+=n;return}if(n==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=Dv;return}if(Yw.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in keyword yet, index '+this.place)};od.prototype.neutral=function(n){if(zj.test(n)){this.word=n,this.state=f4;return}if(n==='"'){this.word="",this.state=fC;return}if(m4.test(n)){this.word=n,this.state=p4;return}if(Yw.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in neutral yet, index '+this.place)};od.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===bM)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function Xj(n){var e=new od(n);return e.output()}function j2(n,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var i=e?{}:n,r=t.reduce(function(o,s){return Vm(s,o),o},i);e&&(n[e]=r)}function Vm(n,e){if(!Array.isArray(n)){e[n]=!0;return}var t=n.shift();if(t==="PARAMETER"&&(t=n.shift()),n.length===1){if(Array.isArray(n[0])){e[t]={},Vm(n[0],e[t]);return}e[t]=n[0];return}if(!n.length){e[t]=!0;return}if(t==="TOWGS84"){e[t]=n;return}if(t==="AXIS"){t in e||(e[t]=[]),e[t].push(n);return}Array.isArray(t)||(e[t]={});var i;switch(t){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[t]={name:n[0].toLowerCase(),convert:n[1]},n.length===3&&Vm(n[2],e[t]);return;case"SPHEROID":case"ELLIPSOID":e[t]={name:n[0],a:n[1],rf:n[2]},n.length===4&&Vm(n[3],e[t]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":n[0]=["name",n[0]],j2(e,t,n);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":n[0]=["name",n[0]],j2(e,t,n),e[t].type=t;return;default:for(i=-1;++i<n.length;)if(!Array.isArray(n[i]))return Vm(n,e[t]);return j2(e,t,n)}}var Yj=.017453292519943295;function mu(n){return n*Yj}function y4(n){const e=(n.projName||"").toLowerCase().replace(/_/g," ");!n.long0&&n.longc&&(e==="albers conic equal area"||e==="lambert azimuthal equal area")&&(n.long0=n.longc),!n.lat_ts&&n.lat1&&(e==="stereographic south pole"||e==="polar stereographic (variant b)")?(n.lat0=mu(n.lat1>0?90:-90),n.lat_ts=n.lat1,delete n.lat1):!n.lat_ts&&n.lat0&&(e==="polar stereographic"||e==="polar stereographic (variant a)")&&(n.lat_ts=n.lat0,n.lat0=mu(n.lat0>0?90:-90),delete n.lat1)}function uF(n){let e={units:null,to_meter:void 0};return typeof n=="string"?(e.units=n.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.units==="meter"&&(e.to_meter=1)):n&&n.name&&(e.units=n.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.to_meter=n.conversion_factor),e}function cF(n){return typeof n=="object"?n.value*n.unit.conversion_factor:n}function hF(n,e){n.ellipsoid.radius?(e.a=n.ellipsoid.radius,e.rf=0):(e.a=cF(n.ellipsoid.semi_major_axis),n.ellipsoid.inverse_flattening!==void 0?e.rf=n.ellipsoid.inverse_flattening:n.ellipsoid.semi_major_axis!==void 0&&n.ellipsoid.semi_minor_axis!==void 0&&(e.rf=e.a/(e.a-cF(n.ellipsoid.semi_minor_axis))))}function pC(n,e={}){return!n||typeof n!="object"?n:n.type==="BoundCRS"?(pC(n.source_crs,e),n.transformation&&(n.transformation.method&&n.transformation.method.name==="NTv2"?e.nadgrids=n.transformation.parameters[0].value:e.datum_params=n.transformation.parameters.map(t=>t.value)),e):(Object.keys(n).forEach(t=>{const i=n[t];if(i!==null)switch(t){case"name":if(e.srsCode)break;e.name=i,e.srsCode=i;break;case"type":i==="GeographicCRS"?e.projName="longlat":i==="ProjectedCRS"&&n.conversion&&n.conversion.method&&(e.projName=n.conversion.method.name);break;case"datum":case"datum_ensemble":i.ellipsoid&&(e.ellps=i.ellipsoid.name,hF(i,e)),i.prime_meridian&&(e.from_greenwich=i.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":e.ellps=i.name,hF(i,e);break;case"prime_meridian":e.long0=(i.longitude||0)*Math.PI/180;break;case"coordinate_system":if(i.axis){if(e.axis=i.axis.map(r=>{const o=r.direction;if(o==="east")return"e";if(o==="north")return"n";if(o==="west")return"w";if(o==="south")return"s";throw new Error(`Unknown axis direction: ${o}`)}).join("")+"u",i.unit){const{units:r,to_meter:o}=uF(i.unit);e.units=r,e.to_meter=o}else if(i.axis[0]&&i.axis[0].unit){const{units:r,to_meter:o}=uF(i.axis[0].unit);e.units=r,e.to_meter=o}}break;case"id":i.authority&&i.code&&(e.title=i.authority+":"+i.code);break;case"conversion":i.method&&i.method.name&&(e.projName=i.method.name),i.parameters&&i.parameters.forEach(r=>{const o=r.name.toLowerCase().replace(/\s+/g,"_"),s=r.value;r.unit&&r.unit.conversion_factor?e[o]=s*r.unit.conversion_factor:r.unit==="degree"?e[o]=s*Math.PI/180:e[o]=s});break;case"unit":i.name&&(e.units=i.name.toLowerCase(),e.units==="metre"&&(e.units="meter")),i.conversion_factor&&(e.to_meter=i.conversion_factor);break;case"base_crs":pC(i,e),e.datumCode=i.id?i.id.authority+"_"+i.id.code:i.name;break}}),e.latitude_of_false_origin!==void 0&&(e.lat0=e.latitude_of_false_origin),e.longitude_of_false_origin!==void 0&&(e.long0=e.longitude_of_false_origin),e.latitude_of_standard_parallel!==void 0&&(e.lat0=e.latitude_of_standard_parallel,e.lat1=e.latitude_of_standard_parallel),e.latitude_of_1st_standard_parallel!==void 0&&(e.lat1=e.latitude_of_1st_standard_parallel),e.latitude_of_2nd_standard_parallel!==void 0&&(e.lat2=e.latitude_of_2nd_standard_parallel),e.latitude_of_projection_centre!==void 0&&(e.lat0=e.latitude_of_projection_centre),e.longitude_of_projection_centre!==void 0&&(e.longc=e.longitude_of_projection_centre),e.easting_at_false_origin!==void 0&&(e.x0=e.easting_at_false_origin),e.northing_at_false_origin!==void 0&&(e.y0=e.northing_at_false_origin),e.latitude_of_natural_origin!==void 0&&(e.lat0=e.latitude_of_natural_origin),e.longitude_of_natural_origin!==void 0&&(e.long0=e.longitude_of_natural_origin),e.longitude_of_origin!==void 0&&(e.long0=e.longitude_of_origin),e.false_easting!==void 0&&(e.x0=e.false_easting),e.easting_at_projection_centre&&(e.x0=e.easting_at_projection_centre),e.false_northing!==void 0&&(e.y0=e.false_northing),e.northing_at_projection_centre&&(e.y0=e.northing_at_projection_centre),e.standard_parallel_1!==void 0&&(e.lat1=e.standard_parallel_1),e.standard_parallel_2!==void 0&&(e.lat2=e.standard_parallel_2),e.scale_factor_at_natural_origin!==void 0&&(e.k0=e.scale_factor_at_natural_origin),e.scale_factor_at_projection_centre!==void 0&&(e.k0=e.scale_factor_at_projection_centre),e.scale_factor_on_pseudo_standard_parallel!==void 0&&(e.k0=e.scale_factor_on_pseudo_standard_parallel),e.azimuth!==void 0&&(e.alpha=e.azimuth),e.azimuth_at_projection_centre!==void 0&&(e.alpha=e.azimuth_at_projection_centre),e.angle_from_rectified_to_skew_grid&&(e.rectified_grid_angle=e.angle_from_rectified_to_skew_grid),y4(e),e)}var Hj=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function Kj(n,e){var t=e[0],i=e[1];!(t in n)&&i in n&&(n[t]=n[i],e.length===3&&(n[t]=e[2](n[t])))}function _4(n){for(var e=Object.keys(n),t=0,i=e.length;t<i;++t){var r=e[t];Hj.indexOf(r)!==-1&&jj(n[r]),typeof n[r]=="object"&&_4(n[r])}}function jj(n){if(n.AUTHORITY){var e=Object.keys(n.AUTHORITY)[0];e&&e in n.AUTHORITY&&(n.title=e+":"+n.AUTHORITY[e])}if(n.type==="GEOGCS"?n.projName="longlat":n.type==="LOCAL_CS"?(n.projName="identity",n.local=!0):typeof n.PROJECTION=="object"?n.projName=Object.keys(n.PROJECTION)[0]:n.projName=n.PROJECTION,n.AXIS){for(var t="",i=0,r=n.AXIS.length;i<r;++i){var o=[n.AXIS[i][0].toLowerCase(),n.AXIS[i][1].toLowerCase()];o[0].indexOf("north")!==-1||(o[0]==="y"||o[0]==="lat")&&o[1]==="north"?t+="n":o[0].indexOf("south")!==-1||(o[0]==="y"||o[0]==="lat")&&o[1]==="south"?t+="s":o[0].indexOf("east")!==-1||(o[0]==="x"||o[0]==="lon")&&o[1]==="east"?t+="e":(o[0].indexOf("west")!==-1||(o[0]==="x"||o[0]==="lon")&&o[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(n.axis=t)}n.UNIT&&(n.units=n.UNIT.name.toLowerCase(),n.units==="metre"&&(n.units="meter"),n.UNIT.convert&&(n.type==="GEOGCS"?n.DATUM&&n.DATUM.SPHEROID&&(n.to_meter=n.UNIT.convert*n.DATUM.SPHEROID.a):n.to_meter=n.UNIT.convert));var s=n.GEOGCS;n.type==="GEOGCS"&&(s=n),s&&(s.DATUM?n.datumCode=s.DATUM.name.toLowerCase():n.datumCode=s.name.toLowerCase(),n.datumCode.slice(0,2)==="d_"&&(n.datumCode=n.datumCode.slice(2)),n.datumCode==="new_zealand_1949"&&(n.datumCode="nzgd49"),(n.datumCode==="wgs_1984"||n.datumCode==="world_geodetic_system_1984")&&(n.PROJECTION==="Mercator_Auxiliary_Sphere"&&(n.sphere=!0),n.datumCode="wgs84"),n.datumCode==="belge_1972"&&(n.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(n.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),n.ellps.toLowerCase().slice(0,13)==="international"&&(n.ellps="intl"),n.a=s.DATUM.SPHEROID.a,n.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(n.datum_params=s.DATUM.TOWGS84),~n.datumCode.indexOf("osgb_1936")&&(n.datumCode="osgb36"),~n.datumCode.indexOf("osni_1952")&&(n.datumCode="osni52"),(~n.datumCode.indexOf("tm65")||~n.datumCode.indexOf("geodetic_datum_of_1965"))&&(n.datumCode="ire65"),n.datumCode==="ch1903+"&&(n.datumCode="ch1903"),~n.datumCode.indexOf("israel")&&(n.datumCode="isr93")),n.b&&!isFinite(n.b)&&(n.b=n.a),n.rectified_grid_angle&&(n.rectified_grid_angle=mu(n.rectified_grid_angle));function l(d){var m=n.to_meter||1;return d*m}var u=function(d){return Kj(n,d)},h=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",mu],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",mu],["x0","false_easting",l],["y0","false_northing",l],["long0","central_meridian",mu],["lat0","latitude_of_origin",mu],["lat0","standard_parallel_1",mu],["lat1","standard_parallel_1",mu],["lat2","standard_parallel_2",mu],["azimuth","Azimuth"],["alpha","azimuth",mu],["srsCode","name"]];h.forEach(u),y4(n)}function gC(n){if(typeof n=="object")return pC(n);const e=Zj(n);var t=Xj(n);if(e==="WKT2"){const o=Bj(t);return pC(o)}var i=t[0],r={};return Vm(t,r),_4(r),r[i]}function Ro(n){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?Ro[n]=$E(arguments[1]):Ro[n]=gC(arguments[1]):t&&typeof t=="object"&&!("projName"in t)?Ro[n]=gC(arguments[1]):(Ro[n]=t,t||delete Ro[n])}else if(arguments.length===1){if(Array.isArray(n))return n.map(function(i){return Array.isArray(i)?Ro.apply(e,i):Ro(i)});if(typeof n=="string"){if(n in Ro)return Ro[n]}else"EPSG"in n?Ro["EPSG:"+n.EPSG]=n:"ESRI"in n?Ro["ESRI:"+n.ESRI]=n:"IAU2000"in n?Ro["IAU2000:"+n.IAU2000]=n:console.log(n);return}}Mj(Ro);function $j(n){return typeof n=="string"}function Jj(n){return n in Ro}function qj(n){return n.indexOf("+")!==0&&n.indexOf("[")!==-1||typeof n=="object"&&!("srsCode"in n)}var Qj=["3857","900913","3785","102113"];function e7(n){var e=pf(n,"authority");if(e){var t=pf(e,"epsg");return t&&Qj.indexOf(t)>-1}}function t7(n){var e=pf(n,"extension");if(e)return pf(e,"proj4")}function n7(n){return n[0]==="+"}function i7(n){if($j(n)){if(Jj(n))return Ro[n];if(qj(n)){var e=gC(n);if(e7(e))return Ro["EPSG:3857"];var t=t7(e);return t?$E(t):e}if(n7(n))return $E(n)}else return"projName"in n?n:gC(n)}function dF(n,e){n=n||{};var t,i;if(!e)return n;for(i in e)t=e[i],t!==void 0&&(n[i]=t);return n}function Gc(n,e,t){var i=n*e;return t/Math.sqrt(1-i*i)}function _b(n){return n<0?-1:1}function dn(n,e){return e||Math.abs(n)<=Fs?n:n-_b(n)*Nv}function Su(n,e,t){var i=n*t,r=.5*n;return i=Math.pow((1-i)/(1+i),r),Math.tan(.5*(Vt-e))/i}function Vv(n,e){for(var t=.5*n,i,r,o=Vt-2*Math.atan(e),s=0;s<=15;s++)if(i=n*Math.sin(o),r=Vt-2*Math.atan(e*Math.pow((1-i)/(1+i),t))-o,o+=r,Math.abs(r)<=1e-10)return o;return-9999}function r7(){var n=this.b/this.a;this.es=1-n*n,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Gc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function s7(n){var e=n.x,t=n.y;if(t*$a>90&&t*$a<-90&&e*$a>180&&e*$a<-180)return null;var i,r;if(Math.abs(Math.abs(t)-Vt)<=on)return null;if(this.sphere)i=this.x0+this.a*this.k0*dn(e-this.long0,this.over),r=this.y0+this.a*this.k0*Math.log(Math.tan(_r+.5*t));else{var o=Math.sin(t),s=Su(this.e,t,o);i=this.x0+this.a*this.k0*dn(e-this.long0,this.over),r=this.y0-this.a*this.k0*Math.log(s)}return n.x=i,n.y=r,n}function o7(n){var e=n.x-this.x0,t=n.y-this.y0,i,r;if(this.sphere)r=Vt-2*Math.atan(Math.exp(-t/(this.a*this.k0)));else{var o=Math.exp(-t/(this.a*this.k0));if(r=Vv(this.e,o),r===-9999)return null}return i=dn(this.long0+e/(this.a*this.k0),this.over),n.x=i,n.y=r,n}var a7=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"];const l7={init:r7,forward:s7,inverse:o7,names:a7};function u7(){}function fF(n){return n}var v4=["longlat","identity"];const c7={init:u7,forward:fF,inverse:fF,names:v4};var h7=[l7,c7],xp={},Bm=[];function b4(n,e){var t=Bm.length;return n.names?(Bm[t]=n,n.names.forEach(function(i){xp[i.toLowerCase()]=t}),this):(console.log(e),!0)}function x4(n){return n.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function d7(n){if(!n)return!1;var e=n.toLowerCase();if(typeof xp[e]<"u"&&Bm[xp[e]]||(e=x4(e),e in xp&&Bm[xp[e]]))return Bm[xp[e]]}function f7(){h7.forEach(b4)}const p7={start:f7,add:b4,get:d7};var I4={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};const g7=I4.WGS84;function m7(n,e,t,i){var r=n*n,o=e*e,s=(r-o)/r,l=0;i?(n*=1-s*(Pj+s*(Gj+s*Fj)),r=n*n,s=0):l=Math.sqrt(s);var u=(r-o)/o;return{es:s,e:l,ep2:u}}function y7(n,e,t,i,r){if(!n){var o=pf(I4,i);o||(o=g7),n=o.a,e=o.b,t=o.rf}return t&&!e&&(e=(1-1/t)*n),(t===0||Math.abs(n-e)<on)&&(r=!0,e=n),{a:n,b:e,rf:t,sphere:r}}var lI={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var _7 in lI){var $2=lI[_7];$2.datumName&&(lI[$2.datumName]=$2)}function v7(n,e,t,i,r,o,s){var l={};return n===void 0||n==="none"?l.datum_type=jE:l.datum_type=kj,e&&(l.datum_params=e.map(parseFloat),(l.datum_params[0]!==0||l.datum_params[1]!==0||l.datum_params[2]!==0)&&(l.datum_type=qp),l.datum_params.length>3&&(l.datum_params[3]!==0||l.datum_params[4]!==0||l.datum_params[5]!==0||l.datum_params[6]!==0)&&(l.datum_type=Qp,l.datum_params[3]*=j0,l.datum_params[4]*=j0,l.datum_params[5]*=j0,l.datum_params[6]=l.datum_params[6]/1e6+1)),s&&(l.datum_type=ry,l.grids=s),l.a=t,l.b=i,l.es=r,l.ep2=o,l}var xM={};function b7(n,e,t){return e instanceof ArrayBuffer?x7(n,e,t):{ready:I7(n,e)}}function x7(n,e,t){var i=!0;t!==void 0&&t.includeErrorFields===!1&&(i=!1);var r=new DataView(e),o=A7(r),s=S7(r,o),l=E7(r,s,o,i),u={header:s,subgrids:l};return xM[n]=u,u}async function I7(n,e){for(var t=[],i=await e.getImageCount(),r=i-1;r>=0;r--){var o=await e.getImage(r),s=await o.readRasters(),l=s,u=[o.getWidth(),o.getHeight()],h=o.getBoundingBox().map(pF),d=[o.fileDirectory.ModelPixelScale[0],o.fileDirectory.ModelPixelScale[1]].map(pF),m=h[0]+(u[0]-1)*d[0],y=h[3]-(u[1]-1)*d[1],x=l[0],C=l[1],w=[];for(let M=u[1]-1;M>=0;M--)for(let G=u[0]-1;G>=0;G--){var S=M*u[0]+G;w.push([-qd(C[S]),qd(x[S])])}t.push({del:d,lim:u,ll:[-m,y],cvs:w})}var T={header:{nSubgrids:i},subgrids:t};return xM[n]=T,T}function C7(n){if(n===void 0)return null;var e=n.split(",");return e.map(w7)}function w7(n){if(n.length===0)return null;var e=n[0]==="@";return e&&(n=n.slice(1)),n==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:n,mandatory:!e,grid:xM[n]||null,isNull:!1}}function pF(n){return n*Math.PI/180}function qd(n){return n/3600*Math.PI/180}function A7(n){var e=n.getInt32(8,!1);return e===11?!1:(e=n.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function S7(n,e){return{nFields:n.getInt32(8,e),nSubgridFields:n.getInt32(24,e),nSubgrids:n.getInt32(40,e),shiftType:JE(n,56,64).trim(),fromSemiMajorAxis:n.getFloat64(120,e),fromSemiMinorAxis:n.getFloat64(136,e),toSemiMajorAxis:n.getFloat64(152,e),toSemiMinorAxis:n.getFloat64(168,e)}}function JE(n,e,t){return String.fromCharCode.apply(null,new Uint8Array(n.buffer.slice(e,t)))}function E7(n,e,t,i){for(var r=176,o=[],s=0;s<e.nSubgrids;s++){var l=R7(n,r,t),u=M7(n,r,l,t,i),h=Math.round(1+(l.upperLongitude-l.lowerLongitude)/l.longitudeInterval),d=Math.round(1+(l.upperLatitude-l.lowerLatitude)/l.latitudeInterval);o.push({ll:[qd(l.lowerLongitude),qd(l.lowerLatitude)],del:[qd(l.longitudeInterval),qd(l.latitudeInterval)],lim:[h,d],count:l.gridNodeCount,cvs:T7(u)});var m=16;i===!1&&(m=8),r+=176+l.gridNodeCount*m}return o}function T7(n){return n.map(function(e){return[qd(e.longitudeShift),qd(e.latitudeShift)]})}function R7(n,e,t){return{name:JE(n,e+8,e+16).trim(),parent:JE(n,e+24,e+24+8).trim(),lowerLatitude:n.getFloat64(e+72,t),upperLatitude:n.getFloat64(e+88,t),lowerLongitude:n.getFloat64(e+104,t),upperLongitude:n.getFloat64(e+120,t),latitudeInterval:n.getFloat64(e+136,t),longitudeInterval:n.getFloat64(e+152,t),gridNodeCount:n.getInt32(e+168,t)}}function M7(n,e,t,i,r){var o=e+176,s=16;r===!1&&(s=8);for(var l=[],u=0;u<t.gridNodeCount;u++){var h={latitudeShift:n.getFloat32(o+u*s,i),longitudeShift:n.getFloat32(o+u*s+4,i)};r!==!1&&(h.latitudeAccuracy=n.getFloat32(o+u*s+8,i),h.longitudeAccuracy=n.getFloat32(o+u*s+12,i)),l.push(h)}return l}function Kl(n,e){if(!(this instanceof Kl))return new Kl(n);this.forward=null,this.inverse=null,this.init=null,this.name,this.names=null,this.title,e=e||function(h){if(h)throw h};var t=i7(n);if(typeof t!="object"){e("Could not parse to valid json: "+n);return}var i=Kl.projections.get(t.projName);if(!i){e("Could not get projection name from: "+n);return}if(t.datumCode&&t.datumCode!=="none"){var r=pf(lI,t.datumCode);r&&(t.datum_params=t.datum_params||(r.towgs84?r.towgs84.split(","):null),t.ellps=r.ellipse,t.datumName=r.datumName?r.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var o=y7(t.a,t.b,t.rf,t.ellps,t.sphere),s=m7(o.a,o.b,o.rf,t.R_A),l=C7(t.nadgrids),u=t.datum||v7(t.datumCode,t.datum_params,o.a,o.b,s.es,s.ep2,l);dF(this,t),dF(this,i),this.a=o.a,this.b=o.b,this.rf=o.rf,this.sphere=o.sphere,this.es=s.es,this.e=s.e,this.ep2=s.ep2,this.datum=u,"init"in this&&typeof this.init=="function"&&this.init(),e(null,this)}Kl.projections=p7;Kl.projections.start();function k7(n,e){return n.datum_type!==e.datum_type||n.a!==e.a||Math.abs(n.es-e.es)>5e-11?!1:n.datum_type===qp?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]:n.datum_type===Qp?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]&&n.datum_params[3]===e.datum_params[3]&&n.datum_params[4]===e.datum_params[4]&&n.datum_params[5]===e.datum_params[5]&&n.datum_params[6]===e.datum_params[6]:!0}function C4(n,e,t){var i=n.x,r=n.y,o=n.z?n.z:0,s,l,u,h;if(r<-Vt&&r>-1.001*Vt)r=-Vt;else if(r>Vt&&r<1.001*Vt)r=Vt;else{if(r<-Vt)return{x:-1/0,y:-1/0,z:n.z};if(r>Vt)return{x:1/0,y:1/0,z:n.z}}return i>Math.PI&&(i-=2*Math.PI),l=Math.sin(r),h=Math.cos(r),u=l*l,s=t/Math.sqrt(1-e*u),{x:(s+o)*h*Math.cos(i),y:(s+o)*h*Math.sin(i),z:(s*(1-e)+o)*l}}function w4(n,e,t,i){var r=1e-12,o=r*r,s=30,l,u,h,d,m,y,x,C,w,S,T,M,G,N=n.x,V=n.y,W=n.z?n.z:0,j,J,te;if(l=Math.sqrt(N*N+V*V),u=Math.sqrt(N*N+V*V+W*W),l/t<r){if(j=0,u/t<r)return J=Vt,te=-i,{x:n.x,y:n.y,z:n.z}}else j=Math.atan2(V,N);h=W/u,d=l/u,m=1/Math.sqrt(1-e*(2-e)*d*d),C=d*(1-e)*m,w=h*m,G=0;do G++,x=t/Math.sqrt(1-e*w*w),te=l*C+W*w-x*(1-e*w*w),y=e*x/(x+te),m=1/Math.sqrt(1-y*(2-y)*d*d),S=d*(1-y)*m,T=h*m,M=T*C-S*w,C=S,w=T;while(M*M>o&&G<s);return J=Math.atan(T/Math.abs(S)),{x:j,y:J,z:te}}function L7(n,e,t){if(e===qp)return{x:n.x+t[0],y:n.y+t[1],z:n.z+t[2]};if(e===Qp){var i=t[0],r=t[1],o=t[2],s=t[3],l=t[4],u=t[5],h=t[6];return{x:h*(n.x-u*n.y+l*n.z)+i,y:h*(u*n.x+n.y-s*n.z)+r,z:h*(-l*n.x+s*n.y+n.z)+o}}}function P7(n,e,t){if(e===qp)return{x:n.x-t[0],y:n.y-t[1],z:n.z-t[2]};if(e===Qp){var i=t[0],r=t[1],o=t[2],s=t[3],l=t[4],u=t[5],h=t[6],d=(n.x-i)/h,m=(n.y-r)/h,y=(n.z-o)/h;return{x:d+u*m-l*y,y:-u*d+m+s*y,z:l*d-s*m+y}}}function ux(n){return n===qp||n===Qp}function G7(n,e,t){if(k7(n,e)||n.datum_type===jE||e.datum_type===jE)return t;var i=n.a,r=n.es;if(n.datum_type===ry){var o=gF(n,!1,t);if(o!==0)return;i=oF,r=aF}var s=e.a,l=e.b,u=e.es;if(e.datum_type===ry&&(s=oF,l=Lj,u=aF),r===u&&i===s&&!ux(n.datum_type)&&!ux(e.datum_type))return t;if(t=C4(t,r,i),ux(n.datum_type)&&(t=L7(t,n.datum_type,n.datum_params)),ux(e.datum_type)&&(t=P7(t,e.datum_type,e.datum_params)),t=w4(t,u,s,l),e.datum_type===ry){var h=gF(e,!0,t);if(h!==0)return}return t}function gF(n,e,t){if(n.grids===null||n.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-t.x,y:t.y},r={x:Number.NaN,y:Number.NaN},o=[];e:for(var s=0;s<n.grids.length;s++){var l=n.grids[s];if(o.push(l.name),l.isNull){r=i;break}if(l.grid===null){if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1;continue}for(var u=l.grid.subgrids,h=0,d=u.length;h<d;h++){var m=u[h],y=(Math.abs(m.del[1])+Math.abs(m.del[0]))/1e4,x=m.ll[0]-y,C=m.ll[1]-y,w=m.ll[0]+(m.lim[0]-1)*m.del[0]+y,S=m.ll[1]+(m.lim[1]-1)*m.del[1]+y;if(!(C>i.y||x>i.x||S<i.y||w<i.x)&&(r=F7(i,e,m),!isNaN(r.x)))break e}}return isNaN(r.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*$a+" "+i.y*$a+" tried: '"+o+"'"),-1):(t.x=-r.x,t.y=r.y,0)}function F7(n,e,t){var i={x:Number.NaN,y:Number.NaN};if(isNaN(n.x))return i;var r={x:n.x,y:n.y};r.x-=t.ll[0],r.y-=t.ll[1],r.x=dn(r.x-Math.PI)+Math.PI;var o=mF(r,t);if(e){if(isNaN(o.x))return i;o.x=r.x-o.x,o.y=r.y-o.y;var s=9,l=1e-12,u,h;do{if(h=mF(o,t),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}u={x:r.x-(h.x+o.x),y:r.y-(h.y+o.y)},o.x+=u.x,o.y+=u.y}while(s--&&Math.abs(u.x)>l&&Math.abs(u.y)>l);if(s<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=dn(o.x+t.ll[0]),i.y=o.y+t.ll[1]}else isNaN(o.x)||(i.x=n.x+o.x,i.y=n.y+o.y);return i}function mF(n,e){var t={x:n.x/e.del[0],y:n.y/e.del[1]},i={x:Math.floor(t.x),y:Math.floor(t.y)},r={x:t.x-1*i.x,y:t.y-1*i.y},o={x:Number.NaN,y:Number.NaN},s;if(i.x<0||i.x>=e.lim[0]||i.y<0||i.y>=e.lim[1])return o;s=i.y*e.lim[0]+i.x;var l={x:e.cvs[s][0],y:e.cvs[s][1]};s++;var u={x:e.cvs[s][0],y:e.cvs[s][1]};s+=e.lim[0];var h={x:e.cvs[s][0],y:e.cvs[s][1]};s--;var d={x:e.cvs[s][0],y:e.cvs[s][1]},m=r.x*r.y,y=r.x*(1-r.y),x=(1-r.x)*(1-r.y),C=(1-r.x)*r.y;return o.x=x*l.x+y*u.x+C*d.x+m*h.x,o.y=x*l.y+y*u.y+C*d.y+m*h.y,o}function yF(n,e,t){var i=t.x,r=t.y,o=t.z||0,s,l,u,h={};for(u=0;u<3;u++)if(!(e&&u===2&&t.z===void 0))switch(u===0?(s=i,"ew".indexOf(n.axis[u])!==-1?l="x":l="y"):u===1?(s=r,"ns".indexOf(n.axis[u])!==-1?l="y":l="x"):(s=o,l="z"),n.axis[u]){case"e":h[l]=s;break;case"w":h[l]=-s;break;case"n":h[l]=s;break;case"s":h[l]=-s;break;case"u":t[l]!==void 0&&(h.z=s);break;case"d":t[l]!==void 0&&(h.z=-s);break;default:return null}return h}function A4(n){var e={x:n[0],y:n[1]};return n.length>2&&(e.z=n[2]),n.length>3&&(e.m=n[3]),e}function O7(n){_F(n.x),_F(n.y)}function _F(n){if(typeof Number.isFinite=="function"){if(Number.isFinite(n))return;throw new TypeError("coordinates must be finite numbers")}if(typeof n!="number"||n!==n||!isFinite(n))throw new TypeError("coordinates must be finite numbers")}function N7(n,e){return(n.datum.datum_type===qp||n.datum.datum_type===Qp||n.datum.datum_type===ry)&&e.datumCode!=="WGS84"||(e.datum.datum_type===qp||e.datum.datum_type===Qp||e.datum.datum_type===ry)&&n.datumCode!=="WGS84"}function mC(n,e,t,i){var r;Array.isArray(t)?t=A4(t):t={x:t.x,y:t.y,z:t.z,m:t.m};var o=t.z!==void 0;if(O7(t),n.datum&&e.datum&&N7(n,e)&&(r=new Kl("WGS84"),t=mC(n,r,t,i),n=r),i&&n.axis!=="enu"&&(t=yF(n,!1,t)),n.projName==="longlat")t={x:t.x*ws,y:t.y*ws,z:t.z||0};else if(n.to_meter&&(t={x:t.x*n.to_meter,y:t.y*n.to_meter,z:t.z||0}),t=n.inverse(t),!t)return;if(n.from_greenwich&&(t.x+=n.from_greenwich),t=G7(n.datum,e.datum,t),!!t)return t=t,e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*$a,y:t.y*$a,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),i&&e.axis!=="enu"?yF(e,!0,t):(t&&!o&&delete t.z,t)}var vF=Kl("WGS84");function J2(n,e,t,i){var r,o,s;return Array.isArray(t)?(r=mC(n,e,t,i)||{x:NaN,y:NaN},t.length>2?typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof r.z=="number"?[r.x,r.y,r.z].concat(t.slice(3)):[r.x,r.y,t[2]].concat(t.slice(3)):[r.x,r.y].concat(t.slice(2)):[r.x,r.y]):(o=mC(n,e,t,i),s=Object.keys(t),s.length===2||s.forEach(function(l){if(typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(l==="x"||l==="y"||l==="z")return}else if(l==="x"||l==="y")return;o[l]=t[l]}),o)}function cx(n){return n instanceof Kl?n:typeof n=="object"&&"oProj"in n?n.oProj:Kl(n)}function D7(n,e,t){var i,r,o=!1,s;return typeof e>"u"?(r=cx(n),i=vF,o=!0):(typeof e.x<"u"||Array.isArray(e))&&(t=e,r=cx(n),i=vF,o=!0),i||(i=cx(n)),r||(r=cx(e)),t?J2(i,r,t):(s={forward:function(l,u){return J2(i,r,l,u)},inverse:function(l,u){return J2(r,i,l,u)}},o&&(s.oProj=r),s)}var bF=6,S4="AJSAJS",E4="AFAFAF",Zm=65,Va=73,Bl=79,w0=86,A0=90;const V7={forward:T4,inverse:B7,toPoint:R4};function T4(n,e){return e=e||5,z7(Z7({lat:n[1],lon:n[0]}),e)}function B7(n){var e=IM(k4(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function R4(n){var e=IM(k4(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function q2(n){return n*(Math.PI/180)}function xF(n){return 180*(n/Math.PI)}function Z7(n){var e=n.lat,t=n.lon,i=6378137,r=.00669438,o=.9996,s,l,u,h,d,m,y,x=q2(e),C=q2(t),w,S;S=Math.floor((t+180)/6)+1,t===180&&(S=60),e>=56&&e<64&&t>=3&&t<12&&(S=32),e>=72&&e<84&&(t>=0&&t<9?S=31:t>=9&&t<21?S=33:t>=21&&t<33?S=35:t>=33&&t<42&&(S=37)),s=(S-1)*6-180+3,w=q2(s),l=r/(1-r),u=i/Math.sqrt(1-r*Math.sin(x)*Math.sin(x)),h=Math.tan(x)*Math.tan(x),d=l*Math.cos(x)*Math.cos(x),m=Math.cos(x)*(C-w),y=i*((1-r/4-3*r*r/64-5*r*r*r/256)*x-(3*r/8+3*r*r/32+45*r*r*r/1024)*Math.sin(2*x)+(15*r*r/256+45*r*r*r/1024)*Math.sin(4*x)-35*r*r*r/3072*Math.sin(6*x));var T=o*u*(m+(1-h+d)*m*m*m/6+(5-18*h+h*h+72*d-58*l)*m*m*m*m*m/120)+5e5,M=o*(y+u*Math.tan(x)*(m*m/2+(5-h+9*d+4*d*d)*m*m*m*m/24+(61-58*h+h*h+600*d-330*l)*m*m*m*m*m*m/720));return e<0&&(M+=1e7),{northing:Math.round(M),easting:Math.round(T),zoneNumber:S,zoneLetter:W7(e)}}function IM(n){var e=n.northing,t=n.easting,i=n.zoneLetter,r=n.zoneNumber;if(r<0||r>60)return null;var o=.9996,s=6378137,l=.00669438,u,h=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)),d,m,y,x,C,w,S,T,M,G=t-5e5,N=e;i<"N"&&(N-=1e7),S=(r-1)*6-180+3,u=l/(1-l),w=N/o,T=w/(s*(1-l/4-3*l*l/64-5*l*l*l/256)),M=T+(3*h/2-27*h*h*h/32)*Math.sin(2*T)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*T)+151*h*h*h/96*Math.sin(6*T),d=s/Math.sqrt(1-l*Math.sin(M)*Math.sin(M)),m=Math.tan(M)*Math.tan(M),y=u*Math.cos(M)*Math.cos(M),x=s*(1-l)/Math.pow(1-l*Math.sin(M)*Math.sin(M),1.5),C=G/(d*o);var V=M-d*Math.tan(M)/x*(C*C/2-(5+3*m+10*y-4*y*y-9*u)*C*C*C*C/24+(61+90*m+298*y+45*m*m-252*u-3*y*y)*C*C*C*C*C*C/720);V=xF(V);var W=(C-(1+2*m+y)*C*C*C/6+(5-2*y+28*m-3*y*y+8*u+24*m*m)*C*C*C*C*C/120)/Math.cos(M);W=S+xF(W);var j;if(n.accuracy){var J=IM({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});j={top:J.lat,right:J.lon,bottom:V,left:W}}else j={lat:V,lon:W};return j}function W7(n){var e="Z";return 84>=n&&n>=72?e="X":72>n&&n>=64?e="W":64>n&&n>=56?e="V":56>n&&n>=48?e="U":48>n&&n>=40?e="T":40>n&&n>=32?e="S":32>n&&n>=24?e="R":24>n&&n>=16?e="Q":16>n&&n>=8?e="P":8>n&&n>=0?e="N":0>n&&n>=-8?e="M":-8>n&&n>=-16?e="L":-16>n&&n>=-24?e="K":-24>n&&n>=-32?e="J":-32>n&&n>=-40?e="H":-40>n&&n>=-48?e="G":-48>n&&n>=-56?e="F":-56>n&&n>=-64?e="E":-64>n&&n>=-72?e="D":-72>n&&n>=-80&&(e="C"),e}function z7(n,e){var t="00000"+n.easting,i="00000"+n.northing;return n.zoneNumber+n.zoneLetter+U7(n.easting,n.northing,n.zoneNumber)+t.substr(t.length-5,e)+i.substr(i.length-5,e)}function U7(n,e,t){var i=M4(t),r=Math.floor(n/1e5),o=Math.floor(e/1e5)%20;return X7(r,o,i)}function M4(n){var e=n%bF;return e===0&&(e=bF),e}function X7(n,e,t){var i=t-1,r=S4.charCodeAt(i),o=E4.charCodeAt(i),s=r+n-1,l=o+e,u=!1;s>A0&&(s=s-A0+Zm-1,u=!0),(s===Va||r<Va&&s>Va||(s>Va||r<Va)&&u)&&s++,(s===Bl||r<Bl&&s>Bl||(s>Bl||r<Bl)&&u)&&(s++,s===Va&&s++),s>A0&&(s=s-A0+Zm-1),l>w0?(l=l-w0+Zm-1,u=!0):u=!1,(l===Va||o<Va&&l>Va||(l>Va||o<Va)&&u)&&l++,(l===Bl||o<Bl&&l>Bl||(l>Bl||o<Bl)&&u)&&(l++,l===Va&&l++),l>w0&&(l=l-w0+Zm-1);var h=String.fromCharCode(s)+String.fromCharCode(l);return h}function k4(n){if(n&&n.length===0)throw"MGRSPoint coverting from nothing";for(var e=n.length,t=null,i="",r,o=0;!/[A-Z]/.test(r=n.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+n;i+=r,o++}var s=parseInt(i,10);if(o===0||o+3>e)throw"MGRSPoint bad conversion from: "+n;var l=n.charAt(o++);if(l<="A"||l==="B"||l==="Y"||l>="Z"||l==="I"||l==="O")throw"MGRSPoint zone letter "+l+" not handled: "+n;t=n.substring(o,o+=2);for(var u=M4(s),h=Y7(t.charAt(0),u),d=H7(t.charAt(1),u);d<K7(l);)d+=2e6;var m=e-o;if(m%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+n;var y=m/2,x=0,C=0,w,S,T,M,G;return y>0&&(w=1e5/Math.pow(10,y),S=n.substring(o,o+y),x=parseFloat(S)*w,T=n.substring(o+y),C=parseFloat(T)*w),M=x+h,G=C+d,{easting:M,northing:G,zoneLetter:l,zoneNumber:s,accuracy:w}}function Y7(n,e){for(var t=S4.charCodeAt(e-1),i=1e5,r=!1;t!==n.charCodeAt(0);){if(t++,t===Va&&t++,t===Bl&&t++,t>A0){if(r)throw"Bad character: "+n;t=Zm,r=!0}i+=1e5}return i}function H7(n,e){if(n>"V")throw"MGRSPoint given invalid Northing "+n;for(var t=E4.charCodeAt(e-1),i=0,r=!1;t!==n.charCodeAt(0);){if(t++,t===Va&&t++,t===Bl&&t++,t>w0){if(r)throw"Bad character: "+n;t=Zm,r=!0}i+=1e5}return i}function K7(n){var e;switch(n){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+n}function Ay(n,e,t){if(!(this instanceof Ay))return new Ay(n,e,t);if(Array.isArray(n))this.x=n[0],this.y=n[1],this.z=n[2]||0;else if(typeof n=="object")this.x=n.x,this.y=n.y,this.z=n.z||0;else if(typeof n=="string"&&typeof e>"u"){var i=n.split(",");this.x=parseFloat(i[0]),this.y=parseFloat(i[1]),this.z=parseFloat(i[2])||0}else this.x=n,this.y=e,this.z=t||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Ay.fromMGRS=function(n){return new Ay(R4(n))};Ay.prototype.toMGRS=function(n){return T4([this.x,this.y],n)};var j7=1,$7=.25,IF=.046875,CF=.01953125,wF=.01068115234375,J7=.75,q7=.46875,Q7=.013020833333333334,e$=.007120768229166667,t$=.3645833333333333,n$=.005696614583333333,i$=.3076171875;function CM(n){var e=[];e[0]=j7-n*($7+n*(IF+n*(CF+n*wF))),e[1]=n*(J7-n*(IF+n*(CF+n*wF)));var t=n*n;return e[2]=t*(q7-n*(Q7+n*e$)),t*=n,e[3]=t*(t$-n*n$),e[4]=t*n*i$,e}function By(n,e,t,i){return t*=e,e*=e,i[0]*n-t*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))}var r$=20;function wM(n,e,t){for(var i=1/(1-e),r=n,o=r$;o;--o){var s=Math.sin(r),l=1-e*s*s;if(l=(By(r,s,Math.cos(r),t)-n)*(l*Math.sqrt(l))*i,r-=l,Math.abs(l)<on)return r}return r}function s$(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=CM(this.es),this.ml0=By(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function o$(n){var e=n.x,t=n.y,i=dn(e-this.long0,this.over),r,o,s,l=Math.sin(t),u=Math.cos(t);if(this.es){var d=u*i,m=Math.pow(d,2),y=this.ep2*Math.pow(u,2),x=Math.pow(y,2),C=Math.abs(u)>on?Math.tan(t):0,w=Math.pow(C,2),S=Math.pow(w,2);r=1-this.es*Math.pow(l,2),d=d/Math.sqrt(r);var T=By(t,l,u,this.en);o=this.a*(this.k0*d*(1+m/6*(1-w+y+m/20*(5-18*w+S+14*y-58*w*y+m/42*(61+179*S-S*w-479*w)))))+this.x0,s=this.a*(this.k0*(T-this.ml0+l*i*d/2*(1+m/12*(5-w+9*y+4*x+m/30*(61+S-58*w+270*y-330*w*y+m/56*(1385+543*S-S*w-3111*w))))))+this.y0}else{var h=u*Math.sin(i);if(Math.abs(Math.abs(h)-1)<on)return 93;if(o=.5*this.a*this.k0*Math.log((1+h)/(1-h))+this.x0,s=u*Math.cos(i)/Math.sqrt(1-Math.pow(h,2)),h=Math.abs(s),h>=1){if(h-1>on)return 93;s=0}else s=Math.acos(s);t<0&&(s=-s),s=this.a*this.k0*(s-this.lat0)+this.y0}return n.x=o,n.y=s,n}function a$(n){var e,t,i,r,o=(n.x-this.x0)*(1/this.a),s=(n.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+s/this.k0,t=wM(e,this.es,this.en),Math.abs(t)<Vt){var m=Math.sin(t),y=Math.cos(t),x=Math.abs(y)>on?Math.tan(t):0,C=this.ep2*Math.pow(y,2),w=Math.pow(C,2),S=Math.pow(x,2),T=Math.pow(S,2);e=1-this.es*Math.pow(m,2);var M=o*Math.sqrt(e)/this.k0,G=Math.pow(M,2);e=e*x,i=t-e*G/(1-this.es)*.5*(1-G/12*(5+3*S-9*C*S+C-4*w-G/30*(61+90*S-252*C*S+45*T+46*C-G/56*(1385+3633*S+4095*T+1574*T*S)))),r=dn(this.long0+M*(1-G/6*(1+2*S+C-G/20*(5+28*S+24*T+8*C*S+6*C-G/42*(61+662*S+1320*T+720*T*S))))/y,this.over)}else i=Vt*_b(s),r=0;else{var l=Math.exp(o/this.k0),u=.5*(l-1/l),h=this.lat0+s/this.k0,d=Math.cos(h);e=Math.sqrt((1-Math.pow(d,2))/(1+Math.pow(u,2))),i=Math.asin(e),s<0&&(i=-i),u===0&&d===0?r=0:r=dn(Math.atan2(u,d)+this.long0,this.over)}return n.x=r,n.y=i,n}var l$=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const uI={init:s$,forward:o$,inverse:a$,names:l$};function L4(n){var e=Math.exp(n);return e=(e-1/e)/2,e}function Ya(n,e){n=Math.abs(n),e=Math.abs(e);var t=Math.max(n,e),i=Math.min(n,e)/(t||1);return t*Math.sqrt(1+Math.pow(i,2))}function u$(n){var e=1+n,t=e-1;return t===0?n:n*Math.log(e)/t}function c$(n){var e=Math.abs(n);return e=u$(e*(1+e/(Ya(1,e)+1))),n<0?-e:e}function AM(n,e){for(var t=2*Math.cos(2*e),i=n.length-1,r=n[i],o=0,s;--i>=0;)s=-o+t*r+n[i],o=r,r=s;return e+s*Math.sin(2*e)}function h$(n,e){for(var t=2*Math.cos(e),i=n.length-1,r=n[i],o=0,s;--i>=0;)s=-o+t*r+n[i],o=r,r=s;return Math.sin(e)*s}function d$(n){var e=Math.exp(n);return e=(e+1/e)/2,e}function P4(n,e,t){for(var i=Math.sin(e),r=Math.cos(e),o=L4(t),s=d$(t),l=2*r*s,u=-2*i*o,h=n.length-1,d=n[h],m=0,y=0,x=0,C,w;--h>=0;)C=y,w=m,y=d,m=x,d=-C+l*y-u*m+n[h],x=-w+u*y+l*m;return l=i*s,u=r*o,[l*d-u*x,l*x+u*d]}function f$(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(uI.init.apply(this),this.forward=uI.forward,this.inverse=uI.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var n=this.es/(1+Math.sqrt(1-this.es)),e=n/(2-n),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),t=t*e,this.cgb[1]=t*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t=t*e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),t=t*e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(-12/5+e*(-24832/14175))),t=t*e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t=t*e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),t=t*e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t=t*e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t=t*e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t=t*e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=t*(212378941/319334400);var i=AM(this.cbg,this.lat0);this.Zb=-this.Qn*(i+h$(this.gtu,2*i))}function p$(n){var e=dn(n.x-this.long0,this.over),t=n.y;t=AM(this.cbg,t);var i=Math.sin(t),r=Math.cos(t),o=Math.sin(e),s=Math.cos(e);t=Math.atan2(i,s*r),e=Math.atan2(o*r,Ya(i,r*s)),e=c$(Math.tan(e));var l=P4(this.gtu,2*t,2*e);t=t+l[0],e=e+l[1];var u,h;return Math.abs(e)<=2.623395162778?(u=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*t+this.Zb)+this.y0):(u=1/0,h=1/0),n.x=u,n.y=h,n}function g$(n){var e=(n.x-this.x0)*(1/this.a),t=(n.y-this.y0)*(1/this.a);t=(t-this.Zb)/this.Qn,e=e/this.Qn;var i,r;if(Math.abs(e)<=2.623395162778){var o=P4(this.utg,2*t,2*e);t=t+o[0],e=e+o[1],e=Math.atan(L4(e));var s=Math.sin(t),l=Math.cos(t),u=Math.sin(e),h=Math.cos(e);t=Math.atan2(s*h,Ya(u,h*l)),e=Math.atan2(u,h*l),i=dn(e+this.long0,this.over),r=AM(this.cgb,t)}else i=1/0,r=1/0;return n.x=i,n.y=r,n}var m$=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const cI={init:f$,forward:p$,inverse:g$,names:m$};function y$(n,e){if(n===void 0){if(n=Math.floor((dn(e)+Math.PI)*30/Math.PI)+1,n<0)return 0;if(n>60)return 60}return n}var _$="etmerc";function v$(){var n=y$(this.zone,this.long0);if(n===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(n)-183)*ws,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,cI.init.apply(this),this.forward=cI.forward,this.inverse=cI.inverse}var b$=["Universal Transverse Mercator System","utm"];const x$={init:v$,names:b$,dependsOn:_$};function SM(n,e){return Math.pow((1-n)/(1+n),e)}var I$=20;function C$(){var n=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*n*n),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(n/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+_r)/(Math.pow(Math.tan(.5*this.lat0+_r),this.C)*SM(this.e*n,this.ratexp))}function w$(n){var e=n.x,t=n.y;return n.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+_r),this.C)*SM(this.e*Math.sin(t),this.ratexp))-Vt,n.x=this.C*e,n}function A$(n){for(var e=1e-14,t=n.x/this.C,i=n.y,r=Math.pow(Math.tan(.5*i+_r)/this.K,1/this.C),o=I$;o>0&&(i=2*Math.atan(r*SM(this.e*Math.sin(n.y),-.5*this.e))-Vt,!(Math.abs(i-n.y)<e));--o)n.y=i;return o?(n.x=t,n.y=i,n):null}const EM={init:C$,forward:w$,inverse:A$};function S$(){EM.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function E$(n){var e,t,i,r;return n.x=dn(n.x-this.long0,this.over),EM.forward.apply(this,[n]),e=Math.sin(n.y),t=Math.cos(n.y),i=Math.cos(n.x),r=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*i),n.x=r*t*Math.sin(n.x),n.y=r*(this.cosc0*e-this.sinc0*t*i),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function T$(n){var e,t,i,r,o;if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,o=Ya(n.x,n.y)){var s=2*Math.atan2(o,this.R2);e=Math.sin(s),t=Math.cos(s),r=Math.asin(t*this.sinc0+n.y*e*this.cosc0/o),i=Math.atan2(n.x*e,o*this.cosc0*t-n.y*this.sinc0*e)}else r=this.phic0,i=0;return n.x=i,n.y=r,EM.inverse.apply(this,[n]),n.x=dn(n.x+this.long0,this.over),n}var R$=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const M$={init:S$,forward:E$,inverse:T$,names:R$};function TM(n,e,t){return e*=t,Math.tan(.5*(Vt+n))*Math.pow((1-e)/(1+e),.5*t)}function k$(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=on&&(this.k0=.5*(1+_b(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=on&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=on&&Math.abs(Math.cos(this.lat_ts))>on&&(this.k0=.5*this.cons*Gc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Su(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Gc(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(TM(this.lat0,this.sinlat0,this.e))-Vt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function L$(n){var e=n.x,t=n.y,i=Math.sin(t),r=Math.cos(t),o,s,l,u,h,d,m=dn(e-this.long0,this.over);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=on&&Math.abs(t+this.lat0)<=on?(n.x=NaN,n.y=NaN,n):this.sphere?(o=2*this.k0/(1+this.sinlat0*i+this.coslat0*r*Math.cos(m)),n.x=this.a*o*r*Math.sin(m)+this.x0,n.y=this.a*o*(this.coslat0*i-this.sinlat0*r*Math.cos(m))+this.y0,n):(s=2*Math.atan(TM(t,i,this.e))-Vt,u=Math.cos(s),l=Math.sin(s),Math.abs(this.coslat0)<=on?(h=Su(this.e,t*this.con,this.con*i),d=2*this.a*this.k0*h/this.cons,n.x=this.x0+d*Math.sin(e-this.long0),n.y=this.y0-this.con*d*Math.cos(e-this.long0),n):(Math.abs(this.sinlat0)<on?(o=2*this.a*this.k0/(1+u*Math.cos(m)),n.y=o*l):(o=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*l+this.cosX0*u*Math.cos(m))),n.y=o*(this.cosX0*l-this.sinX0*u*Math.cos(m))+this.y0),n.x=o*u*Math.sin(m)+this.x0,n))}function P$(n){n.x-=this.x0,n.y-=this.y0;var e,t,i,r,o,s=Math.sqrt(n.x*n.x+n.y*n.y);if(this.sphere){var l=2*Math.atan(s/(2*this.a*this.k0));return e=this.long0,t=this.lat0,s<=on?(n.x=e,n.y=t,n):(t=Math.asin(Math.cos(l)*this.sinlat0+n.y*Math.sin(l)*this.coslat0/s),Math.abs(this.coslat0)<on?this.lat0>0?e=dn(this.long0+Math.atan2(n.x,-1*n.y),this.over):e=dn(this.long0+Math.atan2(n.x,n.y),this.over):e=dn(this.long0+Math.atan2(n.x*Math.sin(l),s*this.coslat0*Math.cos(l)-n.y*this.sinlat0*Math.sin(l)),this.over),n.x=e,n.y=t,n)}else if(Math.abs(this.coslat0)<=on){if(s<=on)return t=this.lat0,e=this.long0,n.x=e,n.y=t,n;n.x*=this.con,n.y*=this.con,i=s*this.cons/(2*this.a*this.k0),t=this.con*Vv(this.e,i),e=this.con*dn(this.con*this.long0+Math.atan2(n.x,-1*n.y),this.over)}else r=2*Math.atan(s*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,s<=on?o=this.X0:(o=Math.asin(Math.cos(r)*this.sinX0+n.y*Math.sin(r)*this.cosX0/s),e=dn(this.long0+Math.atan2(n.x*Math.sin(r),s*this.cosX0*Math.cos(r)-n.y*this.sinX0*Math.sin(r)),this.over)),t=-1*Vv(this.e,Math.tan(.5*(Vt+o)));return n.x=e,n.y=t,n}var G$=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"];const F$={init:k$,forward:L$,inverse:P$,names:G$,ssfn_:TM};function O$(){var n=this.lat0;this.lambda0=this.long0;var e=Math.sin(n),t=this.a,i=this.rf,r=1/i,o=2*r-Math.pow(r,2),s=this.e=Math.sqrt(o);this.R=this.k0*t*Math.sqrt(1-o)/(1-o*Math.pow(e,2)),this.alpha=Math.sqrt(1+o/(1-o)*Math.pow(Math.cos(n),4)),this.b0=Math.asin(e/this.alpha);var l=Math.log(Math.tan(Math.PI/4+this.b0/2)),u=Math.log(Math.tan(Math.PI/4+n/2)),h=Math.log((1+s*e)/(1-s*e));this.K=l-this.alpha*u+this.alpha*s/2*h}function N$(n){var e=Math.log(Math.tan(Math.PI/4-n.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(n.y))/(1-this.e*Math.sin(n.y))),i=-this.alpha*(e+t)+this.K,r=2*(Math.atan(Math.exp(i))-Math.PI/4),o=this.alpha*(n.x-this.lambda0),s=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(o))),l=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(o));return n.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,n.x=this.R*s+this.x0,n}function D$(n){for(var e=n.x-this.x0,t=n.y-this.y0,i=e/this.R,r=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(i)),s=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(r))),l=this.lambda0+s/this.alpha,u=0,h=o,d=-1e3,m=0;Math.abs(h-d)>1e-7;){if(++m>20)return;u=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),d=h,h=2*Math.atan(Math.exp(u))-Math.PI/2}return n.x=l,n.y=h,n}var V$=["somerc"];const B$={init:O$,forward:N$,inverse:D$,names:V$};var km=1e-7;function Z$(n){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],t=typeof n.projName=="object"?Object.keys(n.projName)[0]:n.projName;return"no_uoff"in n||"no_off"in n||e.indexOf(t)!==-1||e.indexOf(x4(t))!==-1}function W$(){var n,e,t,i,r,o,s,l,u,h,d=0,m,y=0,x=0,C=0,w=0,S=0,T=0;this.no_off=Z$(this),this.no_rot="no_rot"in this;var M=!1;"alpha"in this&&(M=!0);var G=!1;if("rectified_grid_angle"in this&&(G=!0),M&&(T=this.alpha),G&&(d=this.rectified_grid_angle),M||G)y=this.longc;else if(x=this.long1,w=this.lat1,C=this.long2,S=this.lat2,Math.abs(w-S)<=km||(n=Math.abs(w))<=km||Math.abs(n-Vt)<=km||Math.abs(Math.abs(this.lat0)-Vt)<=km||Math.abs(Math.abs(S)-Vt)<=km)throw new Error;var N=1-this.es;e=Math.sqrt(N),Math.abs(this.lat0)>on?(l=Math.sin(this.lat0),t=Math.cos(this.lat0),n=1-this.es*l*l,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/N),this.A=this.B*this.k0*e/n,i=this.B*e/(t*Math.sqrt(n)),r=i*i-1,r<=0?r=0:(r=Math.sqrt(r),this.lat0<0&&(r=-r)),this.E=r+=i,this.E*=Math.pow(Su(this.e,this.lat0,l),this.B)):(this.B=1/e,this.A=this.k0,this.E=i=r=1),M||G?(M?(m=Math.asin(Math.sin(T)/i),G||(d=T)):(m=d,T=Math.asin(i*Math.sin(m))),this.lam0=y-Math.asin(.5*(r-1/r)*Math.tan(m))/this.B):(o=Math.pow(Su(this.e,w,Math.sin(w)),this.B),s=Math.pow(Su(this.e,S,Math.sin(S)),this.B),r=this.E/o,u=(s-o)/(s+o),h=this.E*this.E,h=(h-s*o)/(h+s*o),n=x-C,n<-Math.PI?C-=Nv:n>Math.PI&&(C+=Nv),this.lam0=dn(.5*(x+C)-Math.atan(h*Math.tan(.5*this.B*(x-C))/u)/this.B,this.over),m=Math.atan(2*Math.sin(this.B*dn(x-this.lam0,this.over))/(r-1/r)),d=T=Math.asin(i*Math.sin(m))),this.singam=Math.sin(m),this.cosgam=Math.cos(m),this.sinrot=Math.sin(d),this.cosrot=Math.cos(d),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(T))),this.lat0<0&&(this.u_0=-this.u_0)),r=.5*m,this.v_pole_n=this.ArB*Math.log(Math.tan(_r-r)),this.v_pole_s=this.ArB*Math.log(Math.tan(_r+r))}function z$(n){var e={},t,i,r,o,s,l,u,h;if(n.x=n.x-this.lam0,Math.abs(Math.abs(n.y)-Vt)>on){if(s=this.E/Math.pow(Su(this.e,n.y,Math.sin(n.y)),this.B),l=1/s,t=.5*(s-l),i=.5*(s+l),o=Math.sin(this.B*n.x),r=(t*this.singam-o*this.cosgam)/i,Math.abs(Math.abs(r)-1)<on)throw new Error;h=.5*this.ArB*Math.log((1-r)/(1+r)),l=Math.cos(this.B*n.x),Math.abs(l)<km?u=this.A*n.x:u=this.ArB*Math.atan2(t*this.cosgam+o*this.singam,l)}else h=n.y>0?this.v_pole_n:this.v_pole_s,u=this.ArB*n.y;return this.no_rot?(e.x=u,e.y=h):(u-=this.u_0,e.x=h*this.cosrot+u*this.sinrot,e.y=u*this.cosrot-h*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function U$(n){var e,t,i,r,o,s,l,u={};if(n.x=(n.x-this.x0)*(1/this.a),n.y=(n.y-this.y0)*(1/this.a),this.no_rot?(t=n.y,e=n.x):(t=n.x*this.cosrot-n.y*this.sinrot,e=n.y*this.cosrot+n.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*t),r=.5*(i-1/i),o=.5*(i+1/i),s=Math.sin(this.BrA*e),l=(s*this.cosgam+r*this.singam)/o,Math.abs(Math.abs(l)-1)<on)u.x=0,u.y=l<0?-Vt:Vt;else{if(u.y=this.E/Math.sqrt((1+l)/(1-l)),u.y=Vv(this.e,Math.pow(u.y,1/this.B)),u.y===1/0)throw new Error;u.x=-this.rB*Math.atan2(r*this.cosgam-s*this.singam,Math.cos(this.BrA*e))}return u.x+=this.lam0,u}var X$=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const Y$={init:W$,forward:z$,inverse:U$,names:X$};function H$(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<on)){var n=this.b/this.a;this.e=Math.sqrt(1-n*n);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),i=Gc(this.e,e,t),r=Su(this.e,this.lat1,e),o=Math.sin(this.lat2),s=Math.cos(this.lat2),l=Gc(this.e,o,s),u=Su(this.e,this.lat2,o),h=Math.abs(Math.abs(this.lat0)-Vt)<on?0:Su(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>on?this.ns=Math.log(i/l)/Math.log(r/u):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=i/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function K$(n){var e=n.x,t=n.y;Math.abs(2*Math.abs(t)-Math.PI)<=on&&(t=_b(t)*(Vt-2*on));var i=Math.abs(Math.abs(t)-Vt),r,o;if(i>on)r=Su(this.e,t,Math.sin(t)),o=this.a*this.f0*Math.pow(r,this.ns);else{if(i=t*this.ns,i<=0)return null;o=0}var s=this.ns*dn(e-this.long0,this.over);return n.x=this.k0*(o*Math.sin(s))+this.x0,n.y=this.k0*(this.rh-o*Math.cos(s))+this.y0,n}function j$(n){var e,t,i,r,o,s=(n.x-this.x0)/this.k0,l=this.rh-(n.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(s*s+l*l),t=1):(e=-Math.sqrt(s*s+l*l),t=-1);var u=0;if(e!==0&&(u=Math.atan2(t*s,t*l)),e!==0||this.ns>0){if(t=1/this.ns,i=Math.pow(e/(this.a*this.f0),t),r=Vv(this.e,i),r===-9999)return null}else r=-Vt;return o=dn(u/this.ns+this.long0,this.over),n.x=o,n.y=r,n}var $$=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const J$={init:H$,forward:K$,inverse:j$,names:$$};function q$(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function Q$(n){var e,t,i,r,o,s,l,u=n.x,h=n.y,d=dn(u-this.long0,this.over);return e=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/e)-this.s45),i=-d*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(i)),o=Math.asin(Math.cos(t)*Math.sin(i)/Math.cos(r)),s=this.n*o,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),n.y=l*Math.cos(s)/1,n.x=l*Math.sin(s)/1,this.czech||(n.y*=-1,n.x*=-1),n}function eJ(n){var e,t,i,r,o,s,l,u,h=n.x;n.x=n.y,n.y=h,this.czech||(n.y*=-1,n.x*=-1),s=Math.sqrt(n.x*n.x+n.y*n.y),o=Math.atan2(n.y,n.x),r=o/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/s,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),t=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(e)),n.x=this.long0-t/this.alfa,l=e,u=0;var d=0;do n.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.e/2))-this.s45),Math.abs(l-n.y)<1e-10&&(u=1),l=n.y,d+=1;while(u===0&&d<15);return d>=15?null:n}var tJ=["Krovak","krovak"];const nJ={init:q$,forward:Q$,inverse:eJ,names:tJ};function xa(n,e,t,i,r){return n*r-e*Math.sin(2*r)+t*Math.sin(4*r)-i*Math.sin(6*r)}function vb(n){return 1-.25*n*(1+n/16*(3+1.25*n))}function bb(n){return .375*n*(1+.25*n*(1+.46875*n))}function xb(n){return .05859375*n*n*(1+.75*n)}function Ib(n){return n*n*n*(35/3072)}function RM(n,e,t){var i=e*t;return n/Math.sqrt(1-i*i)}function Af(n){return Math.abs(n)<Vt?n:n-_b(n)*Math.PI}function yC(n,e,t,i,r){var o,s;o=n/e;for(var l=0;l<15;l++)if(s=(n-(e*o-t*Math.sin(2*o)+i*Math.sin(4*o)-r*Math.sin(6*o)))/(e-2*t*Math.cos(2*o)+4*i*Math.cos(4*o)-6*r*Math.cos(6*o)),o+=s,Math.abs(s)<=1e-10)return o;return NaN}function iJ(){this.sphere||(this.e0=vb(this.es),this.e1=bb(this.es),this.e2=xb(this.es),this.e3=Ib(this.es),this.ml0=this.a*xa(this.e0,this.e1,this.e2,this.e3,this.lat0))}function rJ(n){var e,t,i=n.x,r=n.y;if(i=dn(i-this.long0,this.over),this.sphere)e=this.a*Math.asin(Math.cos(r)*Math.sin(i)),t=this.a*(Math.atan2(Math.tan(r),Math.cos(i))-this.lat0);else{var o=Math.sin(r),s=Math.cos(r),l=RM(this.a,this.e,o),u=Math.tan(r)*Math.tan(r),h=i*Math.cos(r),d=h*h,m=this.es*s*s/(1-this.es),y=this.a*xa(this.e0,this.e1,this.e2,this.e3,r);e=l*h*(1-d*u*(1/6-(8-u+8*m)*d/120)),t=y-this.ml0+l*o/s*d*(.5+(5-u+6*m)*d/24)}return n.x=e+this.x0,n.y=t+this.y0,n}function sJ(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,t=n.y/this.a,i,r;if(this.sphere){var o=t+this.lat0;i=Math.asin(Math.sin(o)*Math.cos(e)),r=Math.atan2(Math.tan(e),Math.cos(o))}else{var s=this.ml0/this.a+t,l=yC(s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-Vt)<=on)return n.x=this.long0,n.y=Vt,t<0&&(n.y*=-1),n;var u=RM(this.a,this.e,Math.sin(l)),h=u*u*u/this.a/this.a*(1-this.es),d=Math.pow(Math.tan(l),2),m=e*this.a/u,y=m*m;i=l-u*Math.tan(l)/h*m*m*(.5-(1+3*d)*m*m/24),r=m*(1-y*(d/3+(1+3*d)*d*y/15))/Math.cos(l)}return n.x=dn(r+this.long0,this.over),n.y=Af(i),n}var oJ=["Cassini","Cassini_Soldner","cass"];const aJ={init:iJ,forward:rJ,inverse:sJ,names:oJ};function lf(n,e){var t;return n>1e-7?(t=n*e,(1-n*n)*(e/(1-t*t)-.5/n*Math.log((1-t)/(1+t)))):2*e}var qE=1,QE=2,eT=3,hI=4;function lJ(){var n=Math.abs(this.lat0);if(Math.abs(n-Vt)<on?this.mode=this.lat0<0?qE:QE:Math.abs(n)<on?this.mode=eT:this.mode=hI,this.es>0){var e;switch(this.qp=lf(this.e,1),this.mmf=.5/(1-this.es),this.apa=yJ(this.es),this.mode){case QE:this.dd=1;break;case qE:this.dd=1;break;case eT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case hI:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=lf(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===hI&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function uJ(n){var e,t,i,r,o,s,l,u,h,d,m=n.x,y=n.y;if(m=dn(m-this.long0,this.over),this.sphere){if(o=Math.sin(y),d=Math.cos(y),i=Math.cos(m),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t=this.mode===this.EQUIT?1+d*i:1+this.sinph0*o+this.cosph0*d*i,t<=on)return null;t=Math.sqrt(2/t),e=t*d*Math.sin(m),t*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*d*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(y+this.lat0)<on)return null;t=_r-y*.5,t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)),e=t*Math.sin(m),t*=i}}else{switch(l=0,u=0,h=0,i=Math.cos(m),r=Math.sin(m),o=Math.sin(y),s=lf(this.e,o),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(l=s/this.qp,u=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:h=1+this.sinb1*l+this.cosb1*u*i;break;case this.EQUIT:h=1+u*i;break;case this.N_POLE:h=Vt+y,s=this.qp-s;break;case this.S_POLE:h=y-Vt,s=this.qp+s;break}if(Math.abs(h)<on)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?t=this.ymf*h*(this.cosb1*l-this.sinb1*u*i):t=(h=Math.sqrt(2/(1+u*i)))*l*this.ymf,e=this.xmf*h*u*r;break;case this.N_POLE:case this.S_POLE:s>=0?(e=(h=Math.sqrt(s))*r,t=i*(this.mode===this.S_POLE?h:-h)):e=t=0;break}}return n.x=this.a*e+this.x0,n.y=this.a*t+this.y0,n}function cJ(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,t=n.y/this.a,i,r,o,s,l,u,h;if(this.sphere){var d=0,m,y=0;if(m=Math.sqrt(e*e+t*t),r=m*.5,r>1)return null;switch(r=2*Math.asin(r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(y=Math.sin(r),d=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(m)<=on?0:Math.asin(t*y/m),e*=y,t=d*m;break;case this.OBLIQ:r=Math.abs(m)<=on?this.lat0:Math.asin(d*this.sinph0+t*y*this.cosph0/m),e*=y*this.cosph0,t=(d-Math.sin(r)*this.sinph0)*m;break;case this.N_POLE:t=-t,r=Vt-r;break;case this.S_POLE:r-=Vt;break}i=t===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,t)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,t*=this.dd,u=Math.sqrt(e*e+t*t),u<on)return n.x=this.long0,n.y=this.lat0,n;s=2*Math.asin(.5*u/this.rq),o=Math.cos(s),e*=s=Math.sin(s),this.mode===this.OBLIQ?(h=o*this.sinb1+t*s*this.cosb1/u,l=this.qp*h,t=u*this.cosb1*o-t*this.sinb1*s):(h=t*s/u,l=this.qp*h,t=u*o)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(t=-t),l=e*e+t*t,!l)return n.x=this.long0,n.y=this.lat0,n;h=1-l/this.qp,this.mode===this.S_POLE&&(h=-h)}i=Math.atan2(e,t),r=_J(Math.asin(h),this.apa)}return n.x=dn(this.long0+i,this.over),n.y=r,n}var hJ=.3333333333333333,dJ=.17222222222222222,fJ=.10257936507936508,pJ=.06388888888888888,gJ=.0664021164021164,mJ=.016415012942191543;function yJ(n){var e,t=[];return t[0]=n*hJ,e=n*n,t[0]+=e*dJ,t[1]=e*pJ,e*=n,t[0]+=e*fJ,t[1]+=e*gJ,t[2]=e*mJ,t}function _J(n,e){var t=n+n;return n+e[0]*Math.sin(t)+e[1]*Math.sin(t+t)+e[2]*Math.sin(t+t+t)}var vJ=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const bJ={init:lJ,forward:uJ,inverse:cJ,names:vJ,S_POLE:qE,N_POLE:QE,EQUIT:eT,OBLIQ:hI};function gf(n){return Math.abs(n)>1&&(n=n>1?1:-1),Math.asin(n)}function xJ(){Math.abs(this.lat1+this.lat2)<on||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Gc(this.e3,this.sin_po,this.cos_po),this.qs1=lf(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Gc(this.e3,this.sin_po,this.cos_po),this.qs2=lf(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=lf(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>on?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function IJ(n){var e=n.x,t=n.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var i=lf(this.e3,this.sin_phi),r=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,o=this.ns0*dn(e-this.long0,this.over),s=r*Math.sin(o)+this.x0,l=this.rh-r*Math.cos(o)+this.y0;return n.x=s,n.y=l,n}function CJ(n){var e,t,i,r,o,s;return n.x-=this.x0,n.y=this.rh-n.y+this.y0,this.ns0>=0?(e=Math.sqrt(n.x*n.x+n.y*n.y),i=1):(e=-Math.sqrt(n.x*n.x+n.y*n.y),i=-1),r=0,e!==0&&(r=Math.atan2(i*n.x,i*n.y)),i=e*this.ns0/this.a,this.sphere?s=Math.asin((this.c-i*i)/(2*this.ns0)):(t=(this.c-i*i)/this.ns0,s=this.phi1z(this.e3,t)),o=dn(r/this.ns0+this.long0,this.over),n.x=o,n.y=s,n}function wJ(n,e){var t,i,r,o,s,l=gf(.5*e);if(n<on)return l;for(var u=n*n,h=1;h<=25;h++)if(t=Math.sin(l),i=Math.cos(l),r=n*t,o=1-r*r,s=.5*o*o/i*(e/(1-u)-t/o+.5/n*Math.log((1-r)/(1+r))),l=l+s,Math.abs(s)<=1e-7)return l;return null}var AJ=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"];const SJ={init:xJ,forward:IJ,inverse:CJ,names:AJ,phi1z:wJ};function EJ(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function TJ(n){var e,t,i,r,o,s,l,u,h=n.x,d=n.y;return i=dn(h-this.long0,this.over),e=Math.sin(d),t=Math.cos(d),r=Math.cos(i),s=this.sin_p14*e+this.cos_p14*t*r,o=1,s>0||Math.abs(s)<=on?(l=this.x0+this.a*o*t*Math.sin(i)/s,u=this.y0+this.a*o*(this.cos_p14*e-this.sin_p14*t*r)/s):(l=this.x0+this.infinity_dist*t*Math.sin(i),u=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*r)),n.x=l,n.y=u,n}function RJ(n){var e,t,i,r,o,s;return n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,(e=Math.sqrt(n.x*n.x+n.y*n.y))?(r=Math.atan2(e,this.rc),t=Math.sin(r),i=Math.cos(r),s=gf(i*this.sin_p14+n.y*t*this.cos_p14/e),o=Math.atan2(n.x*t,e*this.cos_p14*i-n.y*this.sin_p14*t),o=dn(this.long0+o,this.over)):(s=this.phic0,o=0),n.x=o,n.y=s,n}var MJ=["gnom"];const kJ={init:EJ,forward:TJ,inverse:RJ,names:MJ};function LJ(n,e){var t=1-(1-n*n)/(2*n)*Math.log((1-n)/(1+n));if(Math.abs(Math.abs(e)-t)<1e-6)return e<0?-1*Vt:Vt;for(var i=Math.asin(.5*e),r,o,s,l,u=0;u<30;u++)if(o=Math.sin(i),s=Math.cos(i),l=n*o,r=Math.pow(1-l*l,2)/(2*s)*(e/(1-n*n)-o/(1-l*l)+.5/n*Math.log((1-l)/(1+l))),i+=r,Math.abs(r)<=1e-10)return i;return NaN}function PJ(){this.sphere||(this.k0=Gc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function GJ(n){var e=n.x,t=n.y,i,r,o=dn(e-this.long0,this.over);if(this.sphere)i=this.x0+this.a*o*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(t)/Math.cos(this.lat_ts);else{var s=lf(this.e,Math.sin(t));i=this.x0+this.a*this.k0*o,r=this.y0+this.a*s*.5/this.k0}return n.x=i,n.y=r,n}function FJ(n){n.x-=this.x0,n.y-=this.y0;var e,t;return this.sphere?(e=dn(this.long0+n.x/this.a/Math.cos(this.lat_ts),this.over),t=Math.asin(n.y/this.a*Math.cos(this.lat_ts))):(t=LJ(this.e,2*n.y*this.k0/this.a),e=dn(this.long0+n.x/(this.a*this.k0),this.over)),n.x=e,n.y=t,n}var OJ=["cea"];const NJ={init:PJ,forward:GJ,inverse:FJ,names:OJ};function DJ(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function VJ(n){var e=n.x,t=n.y,i=dn(e-this.long0,this.over),r=Af(t-this.lat0);return n.x=this.x0+this.a*i*this.rc,n.y=this.y0+this.a*r,n}function BJ(n){var e=n.x,t=n.y;return n.x=dn(this.long0+(e-this.x0)/(this.a*this.rc),this.over),n.y=Af(this.lat0+(t-this.y0)/this.a),n}var ZJ=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"];const WJ={init:DJ,forward:VJ,inverse:BJ,names:ZJ};var AF=20;function zJ(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=vb(this.es),this.e1=bb(this.es),this.e2=xb(this.es),this.e3=Ib(this.es),this.ml0=this.a*xa(this.e0,this.e1,this.e2,this.e3,this.lat0)}function UJ(n){var e=n.x,t=n.y,i,r,o,s=dn(e-this.long0,this.over);if(o=s*Math.sin(t),this.sphere)Math.abs(t)<=on?(i=this.a*s,r=-1*this.a*this.lat0):(i=this.a*Math.sin(o)/Math.tan(t),r=this.a*(Af(t-this.lat0)+(1-Math.cos(o))/Math.tan(t)));else if(Math.abs(t)<=on)i=this.a*s,r=-1*this.ml0;else{var l=RM(this.a,this.e,Math.sin(t))/Math.tan(t);i=l*Math.sin(o),r=this.a*xa(this.e0,this.e1,this.e2,this.e3,t)-this.ml0+l*(1-Math.cos(o))}return n.x=i+this.x0,n.y=r+this.y0,n}function XJ(n){var e,t,i,r,o,s,l,u,h;if(i=n.x-this.x0,r=n.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=on)e=dn(i/this.a+this.long0,this.over),t=0;else{s=this.lat0+r/this.a,l=i*i/this.a/this.a+s*s,u=s;var d;for(o=AF;o;--o)if(d=Math.tan(u),h=-1*(s*(u*d+1)-u-.5*(u*u+l)*d)/((u-s)/d-1),u+=h,Math.abs(h)<=on){t=u;break}e=dn(this.long0+Math.asin(i*Math.tan(u)/this.a)/Math.sin(t),this.over)}else if(Math.abs(r+this.ml0)<=on)t=0,e=dn(this.long0+i/this.a,this.over);else{s=(this.ml0+r)/this.a,l=i*i/this.a/this.a+s*s,u=s;var m,y,x,C,w;for(o=AF;o;--o)if(w=this.e*Math.sin(u),m=Math.sqrt(1-w*w)*Math.tan(u),y=this.a*xa(this.e0,this.e1,this.e2,this.e3,u),x=this.e0-2*this.e1*Math.cos(2*u)+4*this.e2*Math.cos(4*u)-6*this.e3*Math.cos(6*u),C=y/this.a,h=(s*(m*C+1)-C-.5*m*(C*C+l))/(this.es*Math.sin(2*u)*(C*C+l-2*s*C)/(4*m)+(s-C)*(m*x-2/Math.sin(2*u))-x),u-=h,Math.abs(h)<=on){t=u;break}m=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=dn(this.long0+Math.asin(i*m/this.a)/Math.sin(t),this.over)}return n.x=e,n.y=t,n}var YJ=["Polyconic","American_Polyconic","poly"];const HJ={init:zJ,forward:UJ,inverse:XJ,names:YJ};function KJ(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function jJ(n){var e,t=n.x,i=n.y,r=i-this.lat0,o=t-this.long0,s=r/j0*1e-5,l=o,u=1,h=0;for(e=1;e<=10;e++)u=u*s,h=h+this.A[e]*u;var d=h,m=l,y=1,x=0,C,w,S=0,T=0;for(e=1;e<=6;e++)C=y*d-x*m,w=x*d+y*m,y=C,x=w,S=S+this.B_re[e]*y-this.B_im[e]*x,T=T+this.B_im[e]*y+this.B_re[e]*x;return n.x=T*this.a+this.x0,n.y=S*this.a+this.y0,n}function $J(n){var e,t=n.x,i=n.y,r=t-this.x0,o=i-this.y0,s=o/this.a,l=r/this.a,u=1,h=0,d,m,y=0,x=0;for(e=1;e<=6;e++)d=u*s-h*l,m=h*s+u*l,u=d,h=m,y=y+this.C_re[e]*u-this.C_im[e]*h,x=x+this.C_im[e]*u+this.C_re[e]*h;for(var C=0;C<this.iterations;C++){var w=y,S=x,T,M,G=s,N=l;for(e=2;e<=6;e++)T=w*y-S*x,M=S*y+w*x,w=T,S=M,G=G+(e-1)*(this.B_re[e]*w-this.B_im[e]*S),N=N+(e-1)*(this.B_im[e]*w+this.B_re[e]*S);w=1,S=0;var V=this.B_re[1],W=this.B_im[1];for(e=2;e<=6;e++)T=w*y-S*x,M=S*y+w*x,w=T,S=M,V=V+e*(this.B_re[e]*w-this.B_im[e]*S),W=W+e*(this.B_im[e]*w+this.B_re[e]*S);var j=V*V+W*W;y=(G*V+N*W)/j,x=(N*V-G*W)/j}var J=y,te=x,ce=1,pe=0;for(e=1;e<=9;e++)ce=ce*J,pe=pe+this.D[e]*ce;var Y=this.lat0+pe*j0*1e5,he=this.long0+te;return n.x=he,n.y=Y,n}var JJ=["New_Zealand_Map_Grid","nzmg"];const qJ={init:KJ,forward:jJ,inverse:$J,names:JJ};function QJ(){}function eq(n){var e=n.x,t=n.y,i=dn(e-this.long0,this.over),r=this.x0+this.a*i,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return n.x=r,n.y=o,n}function tq(n){n.x-=this.x0,n.y-=this.y0;var e=dn(this.long0+n.x/this.a,this.over),t=2.5*(Math.atan(Math.exp(.8*n.y/this.a))-Math.PI/4);return n.x=e,n.y=t,n}var nq=["Miller_Cylindrical","mill"];const iq={init:QJ,forward:eq,inverse:tq,names:nq};var rq=20;function sq(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=CM(this.es)}function oq(n){var e,t,i=n.x,r=n.y;if(i=dn(i-this.long0,this.over),this.sphere){if(!this.m)r=this.n!==1?Math.asin(this.n*Math.sin(r)):r;else for(var o=this.n*Math.sin(r),s=rq;s;--s){var l=(this.m*r+Math.sin(r)-o)/(this.m+Math.cos(r));if(r-=l,Math.abs(l)<on)break}e=this.a*this.C_x*i*(this.m+Math.cos(r)),t=this.a*this.C_y*r}else{var u=Math.sin(r),h=Math.cos(r);t=this.a*By(r,u,h,this.en),e=this.a*i*h/Math.sqrt(1-this.es*u*u)}return n.x=e,n.y=t,n}function aq(n){var e,t,i,r;return n.x-=this.x0,i=n.x/this.a,n.y-=this.y0,e=n.y/this.a,this.sphere?(e/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(e))),this.m?e=gf((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=gf(Math.sin(e)/this.n)),i=dn(i+this.long0,this.over),e=Af(e)):(e=wM(n.y/this.a,this.es,this.en),r=Math.abs(e),r<Vt?(r=Math.sin(e),t=this.long0+n.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(e)),i=dn(t,this.over)):r-on<Vt&&(i=this.long0)),n.x=i,n.y=e,n}var lq=["Sinusoidal","sinu"];const uq={init:sq,forward:oq,inverse:aq,names:lq};function cq(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0}function hq(n){for(var e=n.x,t=n.y,i=dn(e-this.long0,this.over),r=t,o=Math.PI*Math.sin(t);;){var s=-(r+Math.sin(r)-o)/(1+Math.cos(r));if(r+=s,Math.abs(s)<on)break}r/=2,Math.PI/2-Math.abs(t)<on&&(i=0);var l=.900316316158*this.a*i*Math.cos(r)+this.x0,u=1.4142135623731*this.a*Math.sin(r)+this.y0;return n.x=l,n.y=u,n}function dq(n){var e,t;n.x-=this.x0,n.y-=this.y0,t=n.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var i=dn(this.long0+n.x/(.900316316158*this.a*Math.cos(e)),this.over);i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var r=Math.asin(t);return n.x=i,n.y=r,n}var fq=["Mollweide","moll"];const pq={init:cq,forward:hq,inverse:dq,names:fq};function gq(){Math.abs(this.lat1+this.lat2)<on||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=vb(this.es),this.e1=bb(this.es),this.e2=xb(this.es),this.e3=Ib(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=Gc(this.e,this.sin_phi,this.cos_phi),this.ml1=xa(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<on?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=Gc(this.e,this.sin_phi,this.cos_phi),this.ml2=xa(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=xa(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function mq(n){var e=n.x,t=n.y,i;if(this.sphere)i=this.a*(this.g-t);else{var r=xa(this.e0,this.e1,this.e2,this.e3,t);i=this.a*(this.g-r)}var o=this.ns*dn(e-this.long0,this.over),s=this.x0+i*Math.sin(o),l=this.y0+this.rh-i*Math.cos(o);return n.x=s,n.y=l,n}function yq(n){n.x-=this.x0,n.y=this.rh-n.y+this.y0;var e,t,i,r;this.ns>=0?(t=Math.sqrt(n.x*n.x+n.y*n.y),e=1):(t=-Math.sqrt(n.x*n.x+n.y*n.y),e=-1);var o=0;if(t!==0&&(o=Math.atan2(e*n.x,e*n.y)),this.sphere)return r=dn(this.long0+o/this.ns,this.over),i=Af(this.g-t/this.a),n.x=r,n.y=i,n;var s=this.g-t/this.a;return i=yC(s,this.e0,this.e1,this.e2,this.e3),r=dn(this.long0+o/this.ns,this.over),n.x=r,n.y=i,n}var _q=["Equidistant_Conic","eqdc"];const vq={init:gq,forward:mq,inverse:yq,names:_q};function bq(){this.R=this.a}function xq(n){var e=n.x,t=n.y,i=dn(e-this.long0,this.over),r,o;Math.abs(t)<=on&&(r=this.x0+this.R*i,o=this.y0);var s=gf(2*Math.abs(t/Math.PI));(Math.abs(i)<=on||Math.abs(Math.abs(t)-Vt)<=on)&&(r=this.x0,t>=0?o=this.y0+Math.PI*this.R*Math.tan(.5*s):o=this.y0+Math.PI*this.R*-Math.tan(.5*s));var l=.5*Math.abs(Math.PI/i-i/Math.PI),u=l*l,h=Math.sin(s),d=Math.cos(s),m=d/(h+d-1),y=m*m,x=m*(2/h-1),C=x*x,w=Math.PI*this.R*(l*(m-C)+Math.sqrt(u*(m-C)*(m-C)-(C+u)*(y-C)))/(C+u);i<0&&(w=-w),r=this.x0+w;var S=u+m;return w=Math.PI*this.R*(x*S-l*Math.sqrt((C+u)*(u+1)-S*S))/(C+u),t>=0?o=this.y0+w:o=this.y0-w,n.x=r,n.y=o,n}function Iq(n){var e,t,i,r,o,s,l,u,h,d,m,y,x;return n.x-=this.x0,n.y-=this.y0,m=Math.PI*this.R,i=n.x/m,r=n.y/m,o=i*i+r*r,s=-Math.abs(r)*(1+o),l=s-2*r*r+i*i,u=-2*s+1+2*r*r+o*o,x=r*r/u+(2*l*l*l/u/u/u-9*s*l/u/u)/27,h=(s-l*l/3/u)/u,d=2*Math.sqrt(-h/3),m=3*x/h/d,Math.abs(m)>1&&(m>=0?m=1:m=-1),y=Math.acos(m)/3,n.y>=0?t=(-d*Math.cos(y+Math.PI/3)-l/3/u)*Math.PI:t=-(-d*Math.cos(y+Math.PI/3)-l/3/u)*Math.PI,Math.abs(i)<on?e=this.long0:e=dn(this.long0+Math.PI*(o-1+Math.sqrt(1+2*(i*i-r*r)+o*o))/2/i,this.over),n.x=e,n.y=t,n}var Cq=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"];const wq={init:bq,forward:xq,inverse:Iq,names:Cq};function Aq(n,e,t,i,r,o){const s=i-e,l=Math.atan((1-o)*Math.tan(n)),u=Math.atan((1-o)*Math.tan(t)),h=Math.sin(l),d=Math.cos(l),m=Math.sin(u),y=Math.cos(u);let x=s,C,w=100,S,T,M,G,N,V,W,j,J,te,ce,pe,Y,he;do{if(S=Math.sin(x),T=Math.cos(x),M=Math.sqrt(y*S*(y*S)+(d*m-h*y*T)*(d*m-h*y*T)),M===0)return{azi1:0,s12:0};G=h*m+d*y*T,N=Math.atan2(M,G),V=d*y*S/M,W=1-V*V,j=W!==0?G-2*h*m/W:0,J=o/16*W*(4+o*(4-3*W)),C=x,x=s+(1-J)*o*V*(N+J*M*(j+J*G*(-1+2*j*j)))}while(Math.abs(x-C)>1e-12&&--w>0);return w===0?{azi1:NaN,s12:NaN}:(te=W*(r*r-r*(1-o)*(r*(1-o)))/(r*(1-o)*(r*(1-o))),ce=1+te/16384*(4096+te*(-768+te*(320-175*te))),pe=te/1024*(256+te*(-128+te*(74-47*te))),Y=pe*M*(j+pe/4*(G*(-1+2*j*j)-pe/6*j*(-3+4*M*M)*(-3+4*j*j))),he=r*(1-o)*ce*(N-Y),{azi1:Math.atan2(y*S,d*m-h*y*T),s12:he})}function Sq(n,e,t,i,r,o){const s=Math.atan((1-o)*Math.tan(n)),l=Math.sin(s),u=Math.cos(s),h=Math.sin(t),d=Math.cos(t),m=Math.atan2(l,u*d),y=u*h,x=1-y*y,C=x*(r*r-r*(1-o)*(r*(1-o)))/(r*(1-o)*(r*(1-o))),w=1+C/16384*(4096+C*(-768+C*(320-175*C))),S=C/1024*(256+C*(-128+C*(74-47*C)));let T=i/(r*(1-o)*w),M,G=100,N,V,W,j;do N=Math.cos(2*m+T),V=Math.sin(T),W=Math.cos(T),j=S*V*(N+S/4*(W*(-1+2*N*N)-S/6*N*(-3+4*V*V)*(-3+4*N*N))),M=T,T=i/(r*(1-o)*w)+j;while(Math.abs(T-M)>1e-12&&--G>0);if(G===0)return{lat2:NaN,lon2:NaN};const J=l*V-u*W*d,te=Math.atan2(l*W+u*V*d,(1-o)*Math.sqrt(y*y+J*J)),ce=Math.atan2(V*h,u*W-l*V*d),pe=o/16*x*(4+o*(4-3*x)),Y=ce-(1-pe)*o*y*(T+pe*V*(N+pe*W*(-1+2*N*N))),he=e+Y;return{lat2:te,lon2:he}}function Eq(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))}function Tq(n){var e=n.x,t=n.y,i=Math.sin(n.y),r=Math.cos(n.y),o=dn(e-this.long0,this.over),s,l,u,h,d,m,y,x,C,w,S;return this.sphere?Math.abs(this.sin_p12-1)<=on?(n.x=this.x0+this.a*(Vt-t)*Math.sin(o),n.y=this.y0-this.a*(Vt-t)*Math.cos(o),n):Math.abs(this.sin_p12+1)<=on?(n.x=this.x0+this.a*(Vt+t)*Math.sin(o),n.y=this.y0+this.a*(Vt+t)*Math.cos(o),n):(C=this.sin_p12*i+this.cos_p12*r*Math.cos(o),y=Math.acos(C),x=y?y/Math.sin(y):1,n.x=this.x0+this.a*x*r*Math.sin(o),n.y=this.y0+this.a*x*(this.cos_p12*i-this.sin_p12*r*Math.cos(o)),n):(s=vb(this.es),l=bb(this.es),u=xb(this.es),h=Ib(this.es),Math.abs(this.sin_p12-1)<=on?(d=this.a*xa(s,l,u,h,Vt),m=this.a*xa(s,l,u,h,t),n.x=this.x0+(d-m)*Math.sin(o),n.y=this.y0-(d-m)*Math.cos(o),n):Math.abs(this.sin_p12+1)<=on?(d=this.a*xa(s,l,u,h,Vt),m=this.a*xa(s,l,u,h,t),n.x=this.x0+(d+m)*Math.sin(o),n.y=this.y0+(d+m)*Math.cos(o),n):Math.abs(e)<on&&Math.abs(t-this.lat0)<on?(n.x=n.y=0,n):(w=Aq(this.lat0,this.long0,t,e,this.a,this.f),S=w.azi1,n.x=w.s12*Math.sin(S),n.y=w.s12*Math.cos(S),n))}function Rq(n){n.x-=this.x0,n.y-=this.y0;var e,t,i,r,o,s,l,u,h,d,m,y,x,C,w,S;return this.sphere?(e=Math.sqrt(n.x*n.x+n.y*n.y),e>2*Vt*this.a?void 0:(t=e/this.a,i=Math.sin(t),r=Math.cos(t),o=this.long0,Math.abs(e)<=on?s=this.lat0:(s=gf(r*this.sin_p12+n.y*i*this.cos_p12/e),l=Math.abs(this.lat0)-Vt,Math.abs(l)<=on?this.lat0>=0?o=dn(this.long0+Math.atan2(n.x,-n.y),this.over):o=dn(this.long0-Math.atan2(-n.x,n.y),this.over):o=dn(this.long0+Math.atan2(n.x*i,e*this.cos_p12*r-n.y*this.sin_p12*i),this.over)),n.x=o,n.y=s,n)):(u=vb(this.es),h=bb(this.es),d=xb(this.es),m=Ib(this.es),Math.abs(this.sin_p12-1)<=on?(y=this.a*xa(u,h,d,m,Vt),e=Math.sqrt(n.x*n.x+n.y*n.y),x=y-e,s=yC(x/this.a,u,h,d,m),o=dn(this.long0+Math.atan2(n.x,-1*n.y),this.over),n.x=o,n.y=s,n):Math.abs(this.sin_p12+1)<=on?(y=this.a*xa(u,h,d,m,Vt),e=Math.sqrt(n.x*n.x+n.y*n.y),x=e-y,s=yC(x/this.a,u,h,d,m),o=dn(this.long0+Math.atan2(n.x,n.y),this.over),n.x=o,n.y=s,n):(C=Math.atan2(n.x,n.y),w=Math.sqrt(n.x*n.x+n.y*n.y),S=Sq(this.lat0,this.long0,C,w,this.a,this.f),n.x=S.lon2,n.y=S.lat2,n))}var Mq=["Azimuthal_Equidistant","aeqd"];const kq={init:Eq,forward:Tq,inverse:Rq,names:Mq};function Lq(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function Pq(n){var e,t,i,r,o,s,l,u,h=n.x,d=n.y;return i=dn(h-this.long0,this.over),e=Math.sin(d),t=Math.cos(d),r=Math.cos(i),s=this.sin_p14*e+this.cos_p14*t*r,o=1,(s>0||Math.abs(s)<=on)&&(l=this.a*o*t*Math.sin(i),u=this.y0+this.a*o*(this.cos_p14*e-this.sin_p14*t*r)),n.x=l,n.y=u,n}function Gq(n){var e,t,i,r,o,s,l;return n.x-=this.x0,n.y-=this.y0,e=Math.sqrt(n.x*n.x+n.y*n.y),t=gf(e/this.a),i=Math.sin(t),r=Math.cos(t),s=this.long0,Math.abs(e)<=on?(l=this.lat0,n.x=s,n.y=l,n):(l=gf(r*this.sin_p14+n.y*i*this.cos_p14/e),o=Math.abs(this.lat0)-Vt,Math.abs(o)<=on?(this.lat0>=0?s=dn(this.long0+Math.atan2(n.x,-n.y),this.over):s=dn(this.long0-Math.atan2(-n.x,n.y),this.over),n.x=s,n.y=l,n):(s=dn(this.long0+Math.atan2(n.x*i,e*this.cos_p14*r-n.y*this.sin_p14*i),this.over),n.x=s,n.y=l,n))}var Fq=["ortho"];const Oq={init:Lq,forward:Pq,inverse:Gq,names:Fq};var hs={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},vr={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Nq(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Vt-_r/2?this.face=hs.TOP:this.lat0<=-(Vt-_r/2)?this.face=hs.BOTTOM:Math.abs(this.long0)<=_r?this.face=hs.FRONT:Math.abs(this.long0)<=Vt+_r?this.face=this.long0>0?hs.RIGHT:hs.LEFT:this.face=hs.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function Dq(n){var e={x:0,y:0},t,i,r,o,s,l,u={value:0};if(n.x-=this.long0,this.es!==0?t=Math.atan(this.one_minus_f_squared*Math.tan(n.y)):t=n.y,i=n.x,this.face===hs.TOP)o=Vt-t,i>=_r&&i<=Vt+_r?(u.value=vr.AREA_0,r=i-Vt):i>Vt+_r||i<=-(Vt+_r)?(u.value=vr.AREA_1,r=i>0?i-Fs:i+Fs):i>-(Vt+_r)&&i<=-_r?(u.value=vr.AREA_2,r=i+Vt):(u.value=vr.AREA_3,r=i);else if(this.face===hs.BOTTOM)o=Vt+t,i>=_r&&i<=Vt+_r?(u.value=vr.AREA_0,r=-i+Vt):i<_r&&i>=-_r?(u.value=vr.AREA_1,r=-i):i<-_r&&i>=-(Vt+_r)?(u.value=vr.AREA_2,r=-i-Vt):(u.value=vr.AREA_3,r=i>0?-i+Fs:-i-Fs);else{var h,d,m,y,x,C,w;this.face===hs.RIGHT?i=sy(i,+Vt):this.face===hs.BACK?i=sy(i,+Fs):this.face===hs.LEFT&&(i=sy(i,-Vt)),y=Math.sin(t),x=Math.cos(t),C=Math.sin(i),w=Math.cos(i),h=x*w,d=x*C,m=y,this.face===hs.FRONT?(o=Math.acos(h),r=hx(o,m,d,u)):this.face===hs.RIGHT?(o=Math.acos(d),r=hx(o,m,-h,u)):this.face===hs.BACK?(o=Math.acos(-h),r=hx(o,m,-d,u)):this.face===hs.LEFT?(o=Math.acos(-d),r=hx(o,m,h,u)):(o=r=0,u.value=vr.AREA_0)}return l=Math.atan(12/Fs*(r+Math.acos(Math.sin(r)*Math.cos(_r))-Vt)),s=Math.sqrt((1-Math.cos(o))/(Math.cos(l)*Math.cos(l))/(1-Math.cos(Math.atan(1/Math.cos(r))))),u.value===vr.AREA_1?l+=Vt:u.value===vr.AREA_2?l+=Fs:u.value===vr.AREA_3&&(l+=1.5*Fs),e.x=s*Math.cos(l),e.y=s*Math.sin(l),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,n.x=e.x,n.y=e.y,n}function Vq(n){var e={lam:0,phi:0},t,i,r,o,s,l,u,h,d,m={value:0};if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,i=Math.atan(Math.sqrt(n.x*n.x+n.y*n.y)),t=Math.atan2(n.y,n.x),n.x>=0&&n.x>=Math.abs(n.y)?m.value=vr.AREA_0:n.y>=0&&n.y>=Math.abs(n.x)?(m.value=vr.AREA_1,t-=Vt):n.x<0&&-n.x>=Math.abs(n.y)?(m.value=vr.AREA_2,t=t<0?t+Fs:t-Fs):(m.value=vr.AREA_3,t+=Vt),d=Fs/12*Math.tan(t),s=Math.sin(d)/(Math.cos(d)-1/Math.sqrt(2)),l=Math.atan(s),r=Math.cos(t),o=Math.tan(i),u=1-r*r*o*o*(1-Math.cos(Math.atan(1/Math.cos(l)))),u<-1?u=-1:u>1&&(u=1),this.face===hs.TOP)h=Math.acos(u),e.phi=Vt-h,m.value===vr.AREA_0?e.lam=l+Vt:m.value===vr.AREA_1?e.lam=l<0?l+Fs:l-Fs:m.value===vr.AREA_2?e.lam=l-Vt:e.lam=l;else if(this.face===hs.BOTTOM)h=Math.acos(u),e.phi=h-Vt,m.value===vr.AREA_0?e.lam=-l+Vt:m.value===vr.AREA_1?e.lam=-l:m.value===vr.AREA_2?e.lam=-l-Vt:e.lam=l<0?-l-Fs:-l+Fs;else{var y,x,C;y=u,d=y*y,d>=1?C=0:C=Math.sqrt(1-d)*Math.sin(l),d+=C*C,d>=1?x=0:x=Math.sqrt(1-d),m.value===vr.AREA_1?(d=x,x=-C,C=d):m.value===vr.AREA_2?(x=-x,C=-C):m.value===vr.AREA_3&&(d=x,x=C,C=-d),this.face===hs.RIGHT?(d=y,y=-x,x=d):this.face===hs.BACK?(y=-y,x=-x):this.face===hs.LEFT&&(d=y,y=x,x=-d),e.phi=Math.acos(-C)-Vt,e.lam=Math.atan2(x,y),this.face===hs.RIGHT?e.lam=sy(e.lam,-Vt):this.face===hs.BACK?e.lam=sy(e.lam,-Fs):this.face===hs.LEFT&&(e.lam=sy(e.lam,+Vt))}if(this.es!==0){var w,S,T;w=e.phi<0?1:0,S=Math.tan(e.phi),T=this.b/Math.sqrt(S*S+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-T*T)/(this.one_minus_f*T)),w&&(e.phi=-e.phi)}return e.lam+=this.long0,n.x=e.lam,n.y=e.phi,n}function hx(n,e,t,i){var r;return n<on?(i.value=vr.AREA_0,r=0):(r=Math.atan2(e,t),Math.abs(r)<=_r?i.value=vr.AREA_0:r>_r&&r<=Vt+_r?(i.value=vr.AREA_1,r-=Vt):r>Vt+_r||r<=-(Vt+_r)?(i.value=vr.AREA_2,r=r>=0?r-Fs:r+Fs):(i.value=vr.AREA_3,r+=Vt)),r}function sy(n,e){var t=n+e;return t<-Fs?t+=Nv:t>+Fs&&(t-=Nv),t}var Bq=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const Zq={init:Nq,forward:Dq,inverse:Vq,names:Bq};var tT=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],S0=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],G4=.8487,F4=1.3523,O4=$a/5,Wq=1/O4,Wm=18,_C=function(n,e){return n[0]+e*(n[1]+e*(n[2]+e*n[3]))},zq=function(n,e){return n[1]+e*(2*n[2]+e*3*n[3])};function Uq(n,e,t,i){for(var r=e;i;--i){var o=n(r);if(r-=o,Math.abs(o)<t)break}return r}function Xq(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function Yq(n){var e=dn(n.x-this.long0,this.over),t=Math.abs(n.y),i=Math.floor(t*O4);i<0?i=0:i>=Wm&&(i=Wm-1),t=$a*(t-Wq*i);var r={x:_C(tT[i],t)*e,y:_C(S0[i],t)};return n.y<0&&(r.y=-r.y),r.x=r.x*this.a*G4+this.x0,r.y=r.y*this.a*F4+this.y0,r}function Hq(n){var e={x:(n.x-this.x0)/(this.a*G4),y:Math.abs(n.y-this.y0)/(this.a*F4)};if(e.y>=1)e.x/=tT[Wm][0],e.y=n.y<0?-Vt:Vt;else{var t=Math.floor(e.y*Wm);for(t<0?t=0:t>=Wm&&(t=Wm-1);;)if(S0[t][0]>e.y)--t;else if(S0[t+1][0]<=e.y)++t;else break;var i=S0[t],r=5*(e.y-i[0])/(S0[t+1][0]-i[0]);r=Uq(function(o){return(_C(i,o)-e.y)/zq(i,o)},r,on,100),e.x/=_C(tT[t],r),e.y=(5*t+r)*ws,n.y<0&&(e.y=-e.y)}return e.x=dn(e.x+this.long0,this.over),e}var Kq=["Robinson","robin"];const jq={init:Xq,forward:Yq,inverse:Hq,names:Kq};function $q(){this.name="geocent"}function Jq(n){var e=C4(n,this.es,this.a);return e}function qq(n){var e=w4(n,this.es,this.a,this.b);return e}var Qq=["Geocentric","geocentric","geocent","Geocent"];const eQ={init:$q,forward:Jq,inverse:qq,names:Qq};var Ko={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},l0={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function tQ(){if(Object.keys(l0).forEach((function(t){if(typeof this[t]>"u")this[t]=l0[t].def;else{if(l0[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);l0[t].num&&(this[t]=parseFloat(this[t]))}l0[t].degrees&&(this[t]=this[t]*ws)}).bind(this)),Math.abs(Math.abs(this.lat0)-Vt)<on?this.mode=this.lat0<0?Ko.S_POLE:Ko.N_POLE:Math.abs(this.lat0)<on?this.mode=Ko.EQUIT:(this.mode=Ko.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var n=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(n),this.sw=Math.sin(n)}function nQ(n){n.x-=this.long0;var e=Math.sin(n.y),t=Math.cos(n.y),i=Math.cos(n.x),r,o;switch(this.mode){case Ko.OBLIQ:o=this.sinph0*e+this.cosph0*t*i;break;case Ko.EQUIT:o=t*i;break;case Ko.S_POLE:o=-e;break;case Ko.N_POLE:o=e;break}switch(o=this.pn1/(this.p-o),r=o*t*Math.sin(n.x),this.mode){case Ko.OBLIQ:o*=this.cosph0*e-this.sinph0*t*i;break;case Ko.EQUIT:o*=e;break;case Ko.N_POLE:o*=-(t*i);break;case Ko.S_POLE:o*=t*i;break}var s,l;return s=o*this.cg+r*this.sg,l=1/(s*this.sw*this.h1+this.cw),r=(r*this.cg-o*this.sg)*this.cw*l,o=s*l,n.x=r*this.a,n.y=o*this.a,n}function iQ(n){n.x/=this.a,n.y/=this.a;var e={x:n.x,y:n.y},t,i,r;r=1/(this.pn1-n.y*this.sw),t=this.pn1*n.x*r,i=this.pn1*n.y*this.cw*r,n.x=t*this.cg+i*this.sg,n.y=i*this.cg-t*this.sg;var o=Ya(n.x,n.y);if(Math.abs(o)<on)e.x=0,e.y=n.y;else{var s,l;switch(l=1-o*o*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/o+o/this.pn1),s=Math.sqrt(1-l*l),this.mode){case Ko.OBLIQ:e.y=Math.asin(s*this.sinph0+n.y*l*this.cosph0/o),n.y=(s-this.sinph0*Math.sin(e.y))*o,n.x*=l*this.cosph0;break;case Ko.EQUIT:e.y=Math.asin(n.y*l/o),n.y=s*o,n.x*=l;break;case Ko.N_POLE:e.y=Math.asin(s),n.y=-n.y;break;case Ko.S_POLE:e.y=-Math.asin(s);break}e.x=Math.atan2(n.x,n.y)}return n.x=e.x+this.long0,n.y=e.y,n}var rQ=["Tilted_Perspective","tpers"];const sQ={init:tQ,forward:nQ,inverse:iQ,names:rQ};function oQ(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var n=1-this.es,e=1/n;this.radius_p=Math.sqrt(n),this.radius_p2=n,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function aQ(n){var e=n.x,t=n.y,i,r,o,s;if(e=e-this.long0,this.shape==="ellipse"){t=Math.atan(this.radius_p2*Math.tan(t));var l=this.radius_p/Ya(this.radius_p*Math.cos(t),Math.sin(t));if(r=l*Math.cos(e)*Math.cos(t),o=l*Math.sin(e)*Math.cos(t),s=l*Math.sin(t),(this.radius_g-r)*r-o*o-s*s*this.radius_p_inv2<0)return n.x=Number.NaN,n.y=Number.NaN,n;i=this.radius_g-r,this.flip_axis?(n.x=this.radius_g_1*Math.atan(o/Ya(s,i)),n.y=this.radius_g_1*Math.atan(s/i)):(n.x=this.radius_g_1*Math.atan(o/i),n.y=this.radius_g_1*Math.atan(s/Ya(o,i)))}else this.shape==="sphere"&&(i=Math.cos(t),r=Math.cos(e)*i,o=Math.sin(e)*i,s=Math.sin(t),i=this.radius_g-r,this.flip_axis?(n.x=this.radius_g_1*Math.atan(o/Ya(s,i)),n.y=this.radius_g_1*Math.atan(s/i)):(n.x=this.radius_g_1*Math.atan(o/i),n.y=this.radius_g_1*Math.atan(s/Ya(o,i))));return n.x=n.x*this.a,n.y=n.y*this.a,n}function lQ(n){var e=-1,t=0,i=0,r,o,s,l;if(n.x=n.x/this.a,n.y=n.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),t=Math.tan(n.x/this.radius_g_1)*Ya(1,i)):(t=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*Ya(1,t));var u=i/this.radius_p;if(r=t*t+u*u+e*e,o=2*this.radius_g*e,s=o*o-4*r*this.C,s<0)return n.x=Number.NaN,n.y=Number.NaN,n;l=(-o-Math.sqrt(s))/(2*r),e=this.radius_g+l*e,t*=l,i*=l,n.x=Math.atan2(t,e),n.y=Math.atan(i*Math.cos(n.x)/e),n.y=Math.atan(this.radius_p_inv2*Math.tan(n.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),t=Math.tan(n.x/this.radius_g_1)*Math.sqrt(1+i*i)):(t=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*Math.sqrt(1+t*t)),r=t*t+i*i+e*e,o=2*this.radius_g*e,s=o*o-4*r*this.C,s<0)return n.x=Number.NaN,n.y=Number.NaN,n;l=(-o-Math.sqrt(s))/(2*r),e=this.radius_g+l*e,t*=l,i*=l,n.x=Math.atan2(t,e),n.y=Math.atan(i*Math.cos(n.x)/e)}return n.x=n.x+this.long0,n}var uQ=["Geostationary Satellite View","Geostationary_Satellite","geos"];const cQ={init:oQ,forward:aQ,inverse:lQ,names:uQ};var $0=1.340264,J0=-.081106,q0=893e-6,Q0=.003796,vC=Math.sqrt(3)/2;function hQ(){this.es=0,this.long0=this.long0!==void 0?this.long0:0,this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0}function dQ(n){var e=dn(n.x-this.long0,this.over),t=n.y,i=Math.asin(vC*Math.sin(t)),r=i*i,o=r*r*r;return n.x=e*Math.cos(i)/(vC*($0+3*J0*r+o*(7*q0+9*Q0*r))),n.y=i*($0+J0*r+o*(q0+Q0*r)),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function fQ(n){n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a;var e=1e-9,t=12,i=n.y,r,o,s,l,u,h;for(h=0;h<t&&(r=i*i,o=r*r*r,s=i*($0+J0*r+o*(q0+Q0*r))-n.y,l=$0+3*J0*r+o*(7*q0+9*Q0*r),i-=u=s/l,!(Math.abs(u)<e));++h);return r=i*i,o=r*r*r,n.x=vC*n.x*($0+3*J0*r+o*(7*q0+9*Q0*r))/Math.cos(i),n.y=Math.asin(Math.sin(i)/vC),n.x=dn(n.x+this.long0,this.over),n}var pQ=["eqearth","Equal Earth","Equal_Earth"];const gQ={init:hQ,forward:dQ,inverse:fQ,names:pQ};var Bv=1e-10;function mQ(){var n;if(this.phi1=this.lat1,Math.abs(this.phi1)<Bv)throw new Error;this.es?(this.en=CM(this.es),this.m1=By(this.phi1,this.am1=Math.sin(this.phi1),n=Math.cos(this.phi1),this.en),this.am1=n/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=_Q,this.forward=yQ):(Math.abs(this.phi1)+Bv>=Vt?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=bQ,this.forward=vQ)}function yQ(n){var e=dn(n.x-(this.long0||0),this.over),t=n.y,i,r,o;return i=this.am1+this.m1-By(t,r=Math.sin(t),o=Math.cos(t),this.en),r=o*e/(i*Math.sqrt(1-this.es*r*r)),n.x=i*Math.sin(r),n.y=this.am1-i*Math.cos(r),n.x=this.a*n.x+(this.x0||0),n.y=this.a*n.y+(this.y0||0),n}function _Q(n){n.x=(n.x-(this.x0||0))/this.a,n.y=(n.y-(this.y0||0))/this.a;var e,t,i,r;if(t=Ya(n.x,n.y=this.am1-n.y),r=wM(this.am1+this.m1-t,this.es,this.en),(e=Math.abs(r))<Vt)e=Math.sin(r),i=t*Math.atan2(n.x,n.y)*Math.sqrt(1-this.es*e*e)/Math.cos(r);else if(Math.abs(e-Vt)<=Bv)i=0;else throw new Error;return n.x=dn(i+(this.long0||0),this.over),n.y=Af(r),n}function vQ(n){var e=dn(n.x-(this.long0||0),this.over),t=n.y,i,r;return r=this.cphi1+this.phi1-t,Math.abs(r)>Bv?(n.x=r*Math.sin(i=e*Math.cos(t)/r),n.y=this.cphi1-r*Math.cos(i)):n.x=n.y=0,n.x=this.a*n.x+(this.x0||0),n.y=this.a*n.y+(this.y0||0),n}function bQ(n){n.x=(n.x-(this.x0||0))/this.a,n.y=(n.y-(this.y0||0))/this.a;var e,t,i=Ya(n.x,n.y=this.cphi1-n.y);if(t=this.cphi1+this.phi1-i,Math.abs(t)>Vt)throw new Error;return Math.abs(Math.abs(t)-Vt)<=Bv?e=0:e=i*Math.atan2(n.x,n.y)/Math.cos(t),n.x=dn(e+(this.long0||0),this.over),n.y=Af(t),n}var xQ=["bonne","Bonne (Werner lat_1=90)"];const IQ={init:mQ,names:xQ},SF={OBLIQUE:{forward:EQ,inverse:RQ},TRANSVERSE:{forward:TQ,inverse:MQ}},bC={ROTATE:{o_alpha:"oAlpha",o_lon_c:"oLongC",o_lat_c:"oLatC"},NEW_POLE:{o_lat_p:"oLatP",o_lon_p:"oLongP"},NEW_EQUATOR:{o_lon_1:"oLong1",o_lat_1:"oLat1",o_lon_2:"oLong2",o_lat_2:"oLat2"}};function CQ(){if(this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.title=this.title||"General Oblique Transformation",this.isIdentity=v4.includes(this.o_proj),!this.o_proj)throw new Error("Missing parameter: o_proj");if(this.o_proj==="ob_tran")throw new Error("Invalid value for o_proj: "+this.o_proj);const n=this.projStr.replace("+proj=ob_tran","").replace("+o_proj=","+proj=").trim(),e=Kl(n);if(!e)throw new Error("Invalid parameter: o_proj. Unknown projection "+this.o_proj);e.long0=0,this.obliqueProjection=e;let t;const i=Object.keys(bC),r=l=>{if(typeof this[l]>"u")return;const u=parseFloat(this[l])*ws;if(isNaN(u))throw new Error("Invalid value for "+l+": "+this[l]);return u};for(let l=0;l<i.length;l++){const u=i[l],h=bC[u],d=Object.entries(h);if(d.some(([y])=>typeof this[y]<"u")){t=h;for(let y=0;y<d.length;y++){const[x,C]=d[y],w=r(x);if(typeof w>"u")throw new Error("Missing parameter: "+x+".");this[C]=w}break}}if(!t)throw new Error("No valid parameters provided for ob_tran projection.");const{lamp:o,phip:s}=SQ(this,t);this.lamp=o,Math.abs(s)>on?(this.cphip=Math.cos(s),this.sphip=Math.sin(s),this.projectionType=SF.OBLIQUE):this.projectionType=SF.TRANSVERSE}function wQ(n){return this.projectionType.forward(this,n)}function AQ(n){return this.projectionType.inverse(this,n)}function SQ(n,e){let t,i;if(e===bC.ROTATE){let r=n.oLongC,o=n.oLatC,s=n.oAlpha;if(Math.abs(Math.abs(o)-Vt)<=on)throw new Error("Invalid value for o_lat_c: "+n.o_lat_c+" should be < 90");i=r+Math.atan2(-1*Math.cos(s),-1*Math.sin(s)*Math.sin(o)),t=Math.asin(Math.cos(o)*Math.sin(s))}else if(e===bC.NEW_POLE)i=n.oLongP,t=n.oLatP;else{let r=n.oLong1,o=n.oLat1,s=n.oLong2,l=n.oLat2,u=Math.abs(o);if(Math.abs(o)>Vt-on)throw new Error("Invalid value for o_lat_1: "+n.o_lat_1+" should be < 90");if(Math.abs(l)>Vt-on)throw new Error("Invalid value for o_lat_2: "+n.o_lat_2+" should be < 90");if(Math.abs(o-l)<on)throw new Error("Invalid value for o_lat_1 and o_lat_2: o_lat_1 should be different from o_lat_2");if(u<on)throw new Error("Invalid value for o_lat_1: o_lat_1 should be different from zero");i=Math.atan2(Math.cos(o)*Math.sin(l)*Math.cos(r)-Math.sin(o)*Math.cos(l)*Math.cos(s),Math.sin(o)*Math.cos(l)*Math.sin(s)-Math.cos(o)*Math.sin(l)*Math.sin(r)),t=Math.atan(-1*Math.cos(i-r)/Math.tan(o))}return{lamp:i,phip:t}}function EQ(n,e){let{x:t,y:i}=e;t+=n.long0;const r=Math.cos(t),o=Math.sin(i),s=Math.cos(i);e.x=dn(Math.atan2(s*Math.sin(t),n.sphip*s*r+n.cphip*o)+n.lamp),e.y=Math.asin(n.sphip*o-n.cphip*s*r);const l=n.obliqueProjection.forward(e);return n.isIdentity&&(l.x*=$a,l.y*=$a),l}function TQ(n,e){let{x:t,y:i}=e;t+=n.long0;const r=Math.cos(i),o=Math.cos(t);e.x=dn(Math.atan2(r*Math.sin(t),Math.sin(i))+n.lamp),e.y=Math.asin(-1*r*o);const s=n.obliqueProjection.forward(e);return n.isIdentity&&(s.x*=$a,s.y*=$a),s}function RQ(n,e){n.isIdentity&&(e.x*=ws,e.y*=ws);const t=n.obliqueProjection.inverse(e);let{x:i,y:r}=t;if(i<Number.MAX_VALUE){i-=n.lamp;const o=Math.cos(i),s=Math.sin(r),l=Math.cos(r);e.x=Math.atan2(l*Math.sin(i),n.sphip*l*o-n.cphip*s),e.y=Math.asin(n.sphip*s+n.cphip*l*o)}return e.x=dn(e.x+n.long0),e}function MQ(n,e){n.isIdentity&&(e.x*=ws,e.y*=ws);const t=n.obliqueProjection.inverse(e);let{x:i,y:r}=t;if(i<Number.MAX_VALUE){const o=Math.cos(r);i-=n.lamp,e.x=Math.atan2(o*Math.sin(i),-1*Math.sin(r)),e.y=Math.asin(o*Math.cos(i))}return e.x=dn(e.x+n.long0),e}var kQ=["General Oblique Transformation","General_Oblique_Transformation","ob_tran"];const LQ={init:CQ,forward:wQ,inverse:AQ,names:kQ};function PQ(n){n.Proj.projections.add(uI),n.Proj.projections.add(cI),n.Proj.projections.add(x$),n.Proj.projections.add(M$),n.Proj.projections.add(F$),n.Proj.projections.add(B$),n.Proj.projections.add(Y$),n.Proj.projections.add(J$),n.Proj.projections.add(nJ),n.Proj.projections.add(aJ),n.Proj.projections.add(bJ),n.Proj.projections.add(SJ),n.Proj.projections.add(kJ),n.Proj.projections.add(NJ),n.Proj.projections.add(WJ),n.Proj.projections.add(HJ),n.Proj.projections.add(qJ),n.Proj.projections.add(iq),n.Proj.projections.add(uq),n.Proj.projections.add(pq),n.Proj.projections.add(vq),n.Proj.projections.add(wq),n.Proj.projections.add(kq),n.Proj.projections.add(Oq),n.Proj.projections.add(Zq),n.Proj.projections.add(jq),n.Proj.projections.add(eQ),n.Proj.projections.add(sQ),n.Proj.projections.add(cQ),n.Proj.projections.add(gQ),n.Proj.projections.add(IQ),n.Proj.projections.add(LQ)}const E0=Object.assign(D7,{defaultDatum:"WGS84",Proj:Kl,WGS84:new Kl("WGS84"),Point:Ay,toPoint:A4,defs:Ro,nadgrid:b7,transform:mC,mgrs:V7,version:"__VERSION__"});PQ(E0);function N4(){E0.defs("EPSG:32632","+proj=utm +zone=32 +datum=WGS84 +units=m +no_defs"),E0.defs("EPSG:32631","+proj=utm +zone=31 +datum=WGS84 +units=m +no_defs"),E0.defs("EPSG:2169","+proj=tmerc +lat_0=49.83333333333334 +lon_0=6.166666666666667 +k=1 +x_0=80000 +y_0=100000 +ellps=intl +towgs84=-189.681,18.3463,-42.7695,-0.33746,-3.09264,2.53861,0.4598 +units=m +no_defs"),Rj(E0),Oi("EPSG:32632")?.setExtent([166021.44,0,833978.55,932900518e-2]),Oi("EPSG:32631")?.setExtent([166021.44,0,833978.55,932900518e-2]),Oi("EPSG:2169")?.setExtent([48225.17,56225.6,105842.04,139616.4])}const GQ="main",FQ="root_3d",OQ=-222,Vr=Sa("config",()=>{const n=Ei(),e=Ke(GQ),t=At(()=>n.value?.themes),i=At(()=>t.value?.find(h=>h.name===e.value)),r=At(()=>n.value?.background_layers||[]),o=At(()=>{const h=t.value?.filter(d=>d.metadata?.ol3d_type!==void 0);if(h)return{name:FQ,id:OQ,children:h.flatMap(d=>d?.children?d.children:d),metadata:{}}});function s(h){n.value=h}function l(h){e.value=decodeURIComponent(h)}async function u(){const d="https://migration.geoportail.lu/".replace(/\/$/,""),m=Date.now(),y=d?`${d}/themes?interface=main&background=background&cache_version=${m}`:`/themes?interface=main&background=background&cache_version=${m}`;try{const x=await fetch(y,{credentials:"include"});if(!x.ok)throw new Error(`Failed to fetch themes: ${x.status}`);const C=await x.json();if(!Array.isArray(C?.themes)||C.themes.length===0)return;s(C)}catch{}}return{config:n,themes:t,themeName:e,theme:i,bgLayers:r,layerTrees_3d:o,setTheme:l,setThemes:s,loadThemes:u}},{}),D4="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAM0AAAAoCAMAAABq645qAAACPVBMVEUAAABaW13////tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy7tGy5aW13tGy5DjxTaAAAAvXRSTlMAAAABAgMEBQYHCAkKCwwNDg8QERESFBUWFxkaGx0eHyAhIiInKSosMTIzNTY5Ojs8PUFCQ0RERkpMTk9QU1RVVldaXmFjZWZmamtwcXJzdXd3eHl7fX+AgYKDhIaHiIiKi4yOj5CTlJWWl5iZmZqcnZ+goaKjpKanqKqqq6ywsbK0tbW4u7u8vb6/wMHExcbHysvMzM7P0NDS1NXa29zd3t/g4eTl5ujp6uvs7e7u8PLz9PX29/j5+vv8/f5cALqzAAAEcklEQVRo3u3Z+ZPUVBAH8O63LsLKijoIgotHFI+HgiKNeGC8MCqgUUFAJYjgAQ6HKMgGEQQiqChIPFh1iciiwPIEhvv49t/mD5lBORa2tHbLTO2rmqnUTCrJZ3r65ZuEjDHGGLrMWGcKMah7mh/7NP8PzXBqbqgfzdtPb7i/fjQPvq8r5jUVXNNIY4moYeL6+XNfn9Ov6LUZ2/Z7Pxo3YaZWTp/uLPw/reXYbqLRPz/38g+qJ/oTEV396IzmgmquXHZoIRHd/sTs31T1DqIBcyqHZjQWtTbf6nQiokHLVVWn7ju4euXGjsX9LtTAGgPAGGMzOPZSOGFYtmAXsO8skFkgZovQgi2QcZKyIGAAjJQtIgAB/5vRTc2IvbqSqOWNJQdUVdfe+/zitmsu2jeQ/GWMC43HacRhxhAWcJRyEgmYBSVYgROwgJkzeGVEDGEGotqnPaih1Xp63KSvVFVVtz0wt23AvMVda5AZY2FM7OWO/N2DwBMgESBiQZyABUgYSYQkYSBjhAh7QXN3Zfey7YdyzXh6aQpdu2fIpWsD30CykKOU4XPgmBPEnNcmC1jgIT9uCx9ZkOW1kQi9oBm6aMvO3KIVomUPES19/KIaoNo34uA8cUgtB4DzmQXCFoCFhbXgMtgC8DNGKMj7xnIKtj2toeGf55X5c9+ZRpo1lWjyq5c/33Avj+5obpz25miiwd+p6q4/2jfvIrqtrYlemF5MzZObTuhHCw6cUd2y/91ftj5DRJOn0JKniqm56jPtUNXDx44u6NywvaPzPqL+G5v3jCimhhqaX/vyi6VTxtzyYkVV9dSsRvrmnVXUI5oo7GkNEV2RH/igaRVV1Y8fOdE+tEc0tlzqBU1tND+7U1W18t51F8/QAFJrkUccL4VjABFb+MwoMyznszWzBZxfDT2SIbZgm0/TzBbIpLqcr8GwScJxfF4UiliAgGEZ1gKx8VK4bmuafmpdrqr6cFdXBJBSORPkp9A0ZI8hAi4jYQY8CEN8MDML2K/FBBdwKU80kOp3eSBirq7BkJJLstK5UShw+eYhDBGUYNPQeN3WTND2rd+r6oquNUZQ00A49gCEJQg8RhJD8j0DQX6IEBZYMLMAAANZrpHa8lkNBwjOi0Ion90KRIDIQEzsdVfzlurhT1X11F2XqE3qwfNQMiYLGYIYNgAQMcTltXHV3z9w1dAD/8LapH/XJt9eycWudG4U8lGrjYeSIAtMFlaD1SU1NxAR0cA9qrpqr6ruaOmybxLPREBojLEOzoMNkAXsO4YNYRnIpNo3WS30+EByXt+kttY3AEdAyGmZ4/TcKORCDgDhEAg5D0wO7vK1mbmwhajxA9XWkXTTh8dVj6wZX9gr6ZFL9eTm1nbVhUREdOs2Vb25sJqmRTuOq+r+rwfmgGEHVYcU+H7a8KNrdP6kYTXBJ6qPFVjT2DxwzD/msbWqE+vnrvqvevSeutGMUm0dXC+ahk3asb5unt+8cvLIqOvr52nU7Dv7nq31afo0/0mzrhiavwAx1n2SsZnMdgAAAABJRU5ErkJggg==",NQ="fr",DQ=!0,VQ=!1,BQ=!1,ZQ=!1,WQ=!1,zQ=!1,UQ=!1,XQ=!1,YQ=!1,HQ=!1,KQ=!1,jQ=!1,oi=Sa("app",()=>{const n=Ke(!1),e=Ke(!1),t=Ke(NQ),i=Ke(DQ),r=Ke(VQ),o=Ke(BQ),s=Ke(ZQ),l=Ke(),u=Ke(void 0),h=Ke(!1),d=Ke(!1),m=Ke(WQ),y=Ke(zQ),x=Ke(jQ),C=Ke(KQ),w=Ke(UQ),S=Ke(XQ),T=Ke(YQ),M=Ke(HQ),G=Ke(),N=Ke(!1),V=Ke(void 0),W=Ke(!1),j=Ke(!1),J=Ke(!1),te=Ke(!1),ce=Ke(!1),pe=Ke(!1);function Y(tn){pe.value=tn}function he(tn){t.value=tn}function D(tn){i.value=tn}function re(tn){o.value=tn,o.value&&(s.value=!1,r.value=!1)}function le(tn){s.value=tn,s.value&&(N.value=!1,r.value=!1)}function fe(){s.value?(i.value=!1,r.value=!1,m.value=!1,s.value=!1,C.value=!1):(s.value=!0,i.value=!0,r.value=!1,m.value=!1,y.value=!1,C.value=!1,N.value=!1,o.value&&(o.value=!1))}function Le(tn){G.value=tn}function we(){N.value=!0,i.value=!1}function se(){N.value=!1,i.value=!0}function Q(tn){n.value=tn??!n.value}function q(tn){W.value=tn??!W.value}function $e(tn){m.value=tn??!m.value}function Qe(tn){r.value=tn??!r.value}function qe(tn){y.value=tn??!y.value}function Lt(tn){x.value=tn??!x.value,x.value&&(W.value=!1,j.value=!1,te.value=!1)}function Pt(tn){C.value=tn??!C.value}function zt(tn){te.value=tn??!te.value}function Dt(tn){J.value=tn??!J.value}function yn(tn){w.value=tn??!w.value}return{authFormOpened:n,embedded:e,lang:t,layersOpen:i,legendsOpen:r,myLayersTabOpen:o,themeGridOpen:s,myMapId:l,myMap:u,myMapIsLoading:h,myMapLayersChanged:d,myMapsOpen:m,infoOpen:y,shareOpen:x,lidarOpen:C,feedbackOpen:w,feedbackanfOpen:S,feedbackageOpen:T,feedbackcruesOpen:M,styleEditorOpen:N,styleEditorOpenedSection:V,remoteLayersOpen:G,drawToolbarOpen:W,measureToolbarOpen:j,elevationProfileToolbarOpen:J,isOffLine:ce,isApp:pe,printToolbarOpen:te,setIsApp:Y,setLang:he,setLayersOpen:D,setMyLayersTabOpen:re,setThemeGridOpen:le,setRemoteLayersOpen:Le,openStyleEditorPanel:we,closeStyleEditorPanel:se,toggleAuthFormOpen:Q,toggleDrawToolbarOpen:q,togglePrintToolbarOpen:zt,toggleMyMapsOpen:$e,toggleInfoOpen:qe,toggleShareOpen:Lt,toggleLidarOpen:Pt,toggleThemeGrid:fe,toggleLegendsOpen:Qe,toggleElevationProfileToolbarOpen:Dt,toggleFeedbackOpen:yn}},{}),Du=Sa("user-manager",()=>{const n=oi(),{isOffLine:e}=xt(n),t=Ke(void 0),i=At(()=>e.value||!!t.value);function r(){return i.value}function o(l){if(l.login)t.value=l;else throw s(),new Error("Invalid username or password")}function s(){t.value=void 0}return{authenticated:i,currentUser:t,clearUser:s,isAuthenticated:r,setCurrentUser:o}},{}),Q2="include",$Q="https://migration.geoportail.lu/login",JQ="https://migration.geoportail.lu/logout",qQ="https://migration.geoportail.lu/getuserinfo";class QQ{async authenticate(e,t,i=!1){const r=new URLSearchParams({login:e,password:t,app:i?"true":"false"}),o=await fetch($Q,{method:"POST",credentials:Q2,headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r});if(!o.ok)throw new Error("Error while trying to authenticate user");const s=await o.json();return this.mapUserApiToUser(s)}async logout(){const e=await fetch(JQ,{credentials:Q2});if(!e.ok)throw new Error("Error while trying to logout user");return await e.text()}async getUserInfo(){const e=new URLSearchParams({}),t=await fetch(qQ,{method:"POST",credentials:Q2,headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e}),i=t.ok&&await t.json();if(!i.login)throw new Error("Error while trying to get user info");return this.mapUserApiToUser(i)}mapUserApiToUser(e){const{is_admin:t,login:i,mail:r,mymaps_role:o,role:s,role_id:l,sn:u,typeUtilisateur:h}=e;return{login:i,mail:r,isAdmin:t,mymapsRole:o,name:u,role:s,roleId:l,sn:u,typeUtilisateur:h}}}const eS=new QQ;var Eo=[];for(var tS=0;tS<256;++tS)Eo.push((tS+256).toString(16).slice(1));function eee(n,e=0){return(Eo[n[e+0]]+Eo[n[e+1]]+Eo[n[e+2]]+Eo[n[e+3]]+"-"+Eo[n[e+4]]+Eo[n[e+5]]+"-"+Eo[n[e+6]]+Eo[n[e+7]]+"-"+Eo[n[e+8]]+Eo[n[e+9]]+"-"+Eo[n[e+10]]+Eo[n[e+11]]+Eo[n[e+12]]+Eo[n[e+13]]+Eo[n[e+14]]+Eo[n[e+15]]).toLowerCase()}var dx,tee=new Uint8Array(16);function nee(){if(!dx&&(dx=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!dx))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return dx(tee)}var iee=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const EF={randomUUID:iee};function Zv(n,e,t){if(EF.randomUUID&&!n)return EF.randomUUID();n=n||{};var i=n.random||(n.rng||nee)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,eee(i)}var mi=(n=>(n.INFO="alert-info",n.WARNING="alert-warning",n.ERROR="alert-danger",n))(mi||{});class ree{constructor(e,t,i,r,o){this.uuid=e,this.message=t,this.type=i,this.duration=r,this.timer=o,this.start()}timeoutID;start(){this.timer&&(this.timeoutID=setTimeout(()=>this.timer(this.uuid),this.duration))}cancel(){clearTimeout(this.timeoutID)}}const see=mi.INFO,oee=7e3,aee=4e3,ns=Sa("alert-notifications",()=>{const n=Ke([]);function e(i,r=see,o){o=o??(r===mi.WARNING?aee:oee);const s=new ree(Zv(),i,r,o,l=>t(l));return n.value.push(s),s.uuid}function t(i){n.value=n.value.filter(r=>(r.uuid===i&&r.cancel(),r.uuid!==i))}return{notifications:n,addNotification:e,removeNotification:t}},{}),lee={"data-cy":"authForm",class:"lux-account bg-secondary"},uee={class:"lux-panel-title pt-5 mb-5 pl-5 h-16 shrink-0 flex justify-between"},cee={class:"lux-account-content"},hee={class:"flex flex-col gap-2 mb-2"},dee=["placeholder"],fee=["placeholder"],pee={class:"flex mt-3 items-center"},gee={class:"grow leading-5"},mee=["href"],yee=["href"],_ee=["value"],vee={key:1},bee={class:"flex flex-col gap-[1px] mb-2 text-white"},xee={class:"bg-secondary py-1 px-3"},Iee={class:"bg-secondary py-1 px-3"},Cee={class:"flex items-center gap-3 justify-end"},wee=["href"],Aee=st({__name:"auth-form",setup(n){const e="https://myaccount.geoportail.lu",t="https://myaccount.geoportail.lu/recover-password",i="https://myaccount.geoportail.lu/new-user",{t:r}=Ct(),{addNotification:o}=ns(),{lang:s,isApp:l}=xt(oi()),u=Vr(),h=Du(),{setCurrentUser:d,clearUser:m}=h,{authenticated:y,currentUser:x}=xt(h),C=Ke(!1),w=Ke(""),S=Ke("");kt(y,W=>{!C.value&&W&&o(r("Vous tes maintenant correctement connect."))}),gr(()=>{eS.getUserInfo().then(W=>{C.value=!0,G(W)}).catch(()=>{})});function T(){eS.logout().then(()=>{m(),u.loadThemes()}).catch(()=>o(r("Une erreur est survenue durant la dconnexion."),mi.ERROR)),V()}function M(){eS.authenticate(w.value,S.value,l.value).then(W=>{C.value=!1,G(W)}).catch(N),V()}function G(W){d(W),u.loadThemes()}function N(){o(r("Invalid username or password."),mi.WARNING),m()}function V(){w.value="",S.value=""}return(W,j)=>(U(),oe("div",lee,[P("h4",uee,K(k(r)("My account")),1),P("fieldset",null,[j[2]||(j[2]=P("legend",{class:"lux-account-tab"},null,-1)),P("div",cee,[k(y)?(U(),oe("div",vee,[P("div",bee,[P("div",xee,K(k(x)?.login),1),P("div",Iee,K(k(x)?.mail),1)]),P("div",Cee,[P("div",null,[P("a",{class:"text-secondary hover:underline hover:text-white",target:"_blank",href:`${k(e)}?lang=${k(s)}`},K(k(r)("My account")),9,wee)]),P("div",null,[P("button",{class:"lux-btn",onClick:T},K(k(r)("Logout")),1)])])])):(U(),oe("form",{key:0,onSubmit:fs(M,["prevent"])},[P("div",hee,[P("div",null,[Sn(P("input",{class:"w-full lux-input h-11",type:"text",name:"userName","onUpdate:modelValue":j[0]||(j[0]=J=>w.value=J),placeholder:k(r)("Username"),required:""},null,8,dee),[[Zr,w.value]])]),P("div",null,[Sn(P("input",{class:"w-full lux-input h-11",type:"password",name:"userPassword","onUpdate:modelValue":j[1]||(j[1]=J=>S.value=J),placeholder:k(r)("Password"),required:""},null,8,fee),[[Zr,S.value]])])]),P("div",pee,[P("div",gee,[P("p",null,[P("a",{"data-cy":"authFormLostPwd",class:"text-secondary hover:underline hover:text-white",target:"_blank",href:k(t)},K(k(r)("I lost my password")),9,mee)]),P("p",null,[P("a",{"data-cy":"authFormNewAccount",class:"text-secondary hover:underline hover:text-white",target:"_blank",href:k(i)},K(k(r)("Create a new user account")),9,yee)])]),P("div",null,[P("input",{class:"lux-btn h-11 w-24 text-white placeholder:italic bg-secondary border-none uppercase hover:text-primary hover:bg-secondary",type:"submit",value:k(r)("Submit")},null,8,_ee)])])],32))])])]))}}),See={class:"h-full w-full"},Eee=["aria-expanded"],Tee=["title"],Ree={class:"lux-dropdown-wrapper",ref:"dropdownWrapperDOM"},Mee=st({__name:"dropdown-content",props:{placeholder:{},enableClickOutside:{type:Boolean,default:!0},isOpen:{type:Boolean,default:!1},direction:{}},emits:["toggleDropdown"],setup(n,{emit:e}){const t=n,i=e,r=Ei(t.isOpen);kt(()=>t.isOpen,d=>{r.value=d});function o(d){r.value=d===void 0?!r.value:d,i("toggleDropdown",r.value)}function s(d){d.stopImmediatePropagation(),o()}function l(){o(!1)}const u=Ke(null),h=Ke("");return gr(()=>{t.enableClickOutside&&document.addEventListener("click",l),h.value=u.value?"lux-btn-"+getComputedStyle(u.value).getPropertyValue("--button-theme"):""}),Ds(()=>t.enableClickOutside&&document.removeEventListener("click",l)),(d,m)=>(U(),oe("div",MR({class:"lux-dropdown"},d.$attrs,{ref_key:"root",ref:u}),[P("div",See,[P("button",{type:"button",class:Dn(["lux-btn lux-dropdown-btn flex items-center text-ellipsis max-w-full",[r.value?"expanded":"",h.value]]),"aria-expanded":r.value,"aria-haspopup":"true",onClick:s},[P("span",{class:"grow text-left text-ellipsis max-w-full overflow-hidden text-nowrap",title:t.placeholder},K(t.placeholder),9,Tee),P("span",{class:Dn(["lux-caret ml-1",{up:n.direction==="up"}])},null,2)],10,Eee)]),P("div",Ree,[P("div",{class:Dn(["lux-dropdown-content",r.value?"":"hidden"]),tabindex:"-1"},[Jn(d.$slots,"default",{},void 0,!0)],2)],512)],16))}}),is=(n,e)=>{const t=n.__vccOpts||n;for(const[i,r]of e)t[i]=r;return t},V4=is(Mee,[["__scopeId","data-v-22e52595"]]),kee=["data-cy"],Lee=["aria-label","data-value"],eg=st({__name:"dropdown-list",props:{placeholder:{},options:{default:()=>[{label:"Default label",value:"Default value"}]},modelValue:{},direction:{default:"down"}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,r=Ei(),o=K3(t.direction);function s(u){u.preventDefault(),r.value=u.target.dataset.value,i("change",r.value)}function l(){return t.modelValue!==void 0?t.options.find(u=>u.value===t.modelValue)?.label:t.placeholder}return(u,h)=>(U(),Mt(V4,MR({placeholder:l(),direction:o.value},u.$attrs),{default:Xt(()=>[P("ul",{class:Dn(["lux-dropdown-list",o.value])},[(U(!0),oe(Et,null,yi(t.options,d=>(U(),oe("li",{key:d.value,class:Dn(n.modelValue===d.value?"selected":""),"data-cy":`dropdownItem-${d.value}`},[P("button",{class:"lux-dropdown-list-item","aria-label":d.ariaLabel,"data-value":d.value,onClick:s},K(d.label),9,Lee)],10,kee))),128))],2)]),_:1},16,["placeholder","direction"]))}});function Pee(n){return{fr:"fre",en:"eng",de:"ger",lb:"ltz"}[n.toLowerCase()]}function Gee(n){return new DOMParser().parseFromString(n,"text/html").body}function Fee(n){const e=[];function t(i){if(!i)return;const r=i.split("|");r[3]==="WWW:LINK-1.0-http--link"&&e.indexOf(r[2])===-1&&e.push(r[2])}return Array.isArray(n)?n.forEach(t,n):t(n),e}function Oee(n){const t=(Array.isArray(n)?n:[n]).filter(i=>{const r=i.split("|")[1];return r==="metadata"||r==="resource"});return t.length===0?{organisaton:"",name:"",unknown:"",address:"",email:""}:{organisaton:t[0].split("|")[2],name:t[0].split("|")[5],unknown:t[0].split("|")[6],address:t[0].split("|")[7],email:t[0].split("|")[4]}}const Nee="/";var B4=(n=>(n.PNG="image/png",n.JPG="image/jpeg",n))(B4||{}),Mh=(n=>(n.VALUE="value",n.RANGE="range",n))(Mh||{}),dI=(n=>(n.DATEPICKER="datepicker",n.SLIDER="slider",n))(dI||{});function sa(){const n=Sl();function e(h,d){try{const m=JSON.parse(h).concat(JSON.parse(d));return new Set(m).size<m.length}catch{return!1}}function t(h){return h.opacity=h.previousOpacity=h.metadata?.start_opacity??1,i(h),h}function i(h){h.currentTimeMinValue||(h.currentTimeMinValue=h.time?.minDefValue??h.time?.minValue);const d=h.time?.mode===Mh.RANGE;!h.currentTimeMaxValue&&d&&(h.currentTimeMaxValue=h.time?.maxDefValue??h.time?.maxValue)}function r(h){const d=o(h);let m=h.name;return d&&(m=h.metadata?.time_layers?.[d]??m),m}function o(h){return[h.currentTimeMinValue,...h.currentTimeMaxValue?[h.currentTimeMaxValue]:[]].join(Nee)}function s(h){const d=ns();if(!h.metadata?.exclusion)return;const m=Wi(),y=m.layers.filter(x=>e(h?.metadata?.exclusion,x?.metadata?.exclusion));y.length>0&&(m.removeLayers(...y.map(x=>x.id)),d.addNotification(Wn.t("The layer <b>{{layersToRemove}}</b> has been removed because it cannot be displayed while the layer <b>{{layer}}</b> is displayed",{count:y.length,layersToRemove:y.map(x=>Wn.t(x.name,{ns:"client"})).join(", "),layer:Wn.t(h.name,{ns:"client"}),ns:"client"}),mi.WARNING)),h.id!==m.bgLayer?.id&&l(h)}function l(h){const d=Wi(),m=ns();e(h.metadata?.exclusion,d.bgLayer?.metadata?.exclusion)&&(d.setBgLayer(null),m.addNotification(Wn.t("Background has been deactivated because the layer {{layer}} cannot be displayed on top of it.",{layer:Wn.t(h.name,{ns:"client"}),ns:"client"}),mi.WARNING))}function u(h,d=!0,m,y){const x=Vr(),C=Wi(),w=m?x.layerTrees_3d:x.theme,S=n.findById(h,y?w:void 0);if(S){const T=S.metadata?.linked_layers||[];d===!1?C.removeLayers(S.id,...T):(s(S),(m?C.add3dLayers:C.addLayers)(t(S),...T.map(G=>t(n.findById(parseInt(G,10))))))}}return{initLayer:t,getLayerCurrentLabel:r,getLayerCurrentTime:o,handleExclusionLayers:s,toggleLayer:u}}class dg extends Error{}class Dee extends dg{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class Vee extends dg{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class Bee extends dg{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class zm extends dg{}class Z4 extends dg{constructor(e){super(`Invalid unit ${e}`)}}class jo extends dg{}class kd extends dg{constructor(){super("Zone is an abstract class")}}const fn="numeric",Ou="short",Al="long",xC={year:fn,month:fn,day:fn},W4={year:fn,month:Ou,day:fn},Zee={year:fn,month:Ou,day:fn,weekday:Ou},z4={year:fn,month:Al,day:fn},U4={year:fn,month:Al,day:fn,weekday:Al},X4={hour:fn,minute:fn},Y4={hour:fn,minute:fn,second:fn},H4={hour:fn,minute:fn,second:fn,timeZoneName:Ou},K4={hour:fn,minute:fn,second:fn,timeZoneName:Al},j4={hour:fn,minute:fn,hourCycle:"h23"},$4={hour:fn,minute:fn,second:fn,hourCycle:"h23"},J4={hour:fn,minute:fn,second:fn,hourCycle:"h23",timeZoneName:Ou},q4={hour:fn,minute:fn,second:fn,hourCycle:"h23",timeZoneName:Al},Q4={year:fn,month:fn,day:fn,hour:fn,minute:fn},eV={year:fn,month:fn,day:fn,hour:fn,minute:fn,second:fn},tV={year:fn,month:Ou,day:fn,hour:fn,minute:fn},nV={year:fn,month:Ou,day:fn,hour:fn,minute:fn,second:fn},Wee={year:fn,month:Ou,day:fn,weekday:Ou,hour:fn,minute:fn},iV={year:fn,month:Al,day:fn,hour:fn,minute:fn,timeZoneName:Ou},rV={year:fn,month:Al,day:fn,hour:fn,minute:fn,second:fn,timeZoneName:Ou},sV={year:fn,month:Al,day:fn,weekday:Al,hour:fn,minute:fn,timeZoneName:Al},oV={year:fn,month:Al,day:fn,weekday:Al,hour:fn,minute:fn,second:fn,timeZoneName:Al};class Cb{get type(){throw new kd}get name(){throw new kd}get ianaName(){return this.name}get isUniversal(){throw new kd}offsetName(e,t){throw new kd}formatOffset(e,t){throw new kd}offset(e){throw new kd}equals(e){throw new kd}get isValid(){throw new kd}}let nS=null;class Hw extends Cb{static get instance(){return nS===null&&(nS=new Hw),nS}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return yV(e,t,i)}formatOffset(e,t){return ev(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}const nT=new Map;function zee(n){let e=nT.get(n);return e===void 0&&(e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:n,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),nT.set(n,e)),e}const Uee={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function Xee(n,e){const t=n.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(t),[,r,o,s,l,u,h,d]=i;return[s,r,o,l,u,h,d]}function Yee(n,e){const t=n.formatToParts(e),i=[];for(let r=0;r<t.length;r++){const{type:o,value:s}=t[r],l=Uee[o];o==="era"?i[l]=s:si(l)||(i[l]=parseInt(s,10))}return i}const iS=new Map;class jh extends Cb{static create(e){let t=iS.get(e);return t===void 0&&iS.set(e,t=new jh(e)),t}static resetCache(){iS.clear(),nT.clear()}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=jh.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:i}){return yV(e,t,i,this.name)}formatOffset(e,t){return ev(this.offset(e),t)}offset(e){if(!this.valid)return NaN;const t=new Date(e);if(isNaN(t))return NaN;const i=zee(this.name);let[r,o,s,l,u,h,d]=i.formatToParts?Yee(i,t):Xee(i,t);l==="BC"&&(r=-Math.abs(r)+1);const y=jw({year:r,month:o,day:s,hour:u===24?0:u,minute:h,second:d,millisecond:0});let x=+t;const C=x%1e3;return x-=C>=0?C:1e3+C,(y-x)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let TF={};function Hee(n,e={}){const t=JSON.stringify([n,e]);let i=TF[t];return i||(i=new Intl.ListFormat(n,e),TF[t]=i),i}const iT=new Map;function rT(n,e={}){const t=JSON.stringify([n,e]);let i=iT.get(t);return i===void 0&&(i=new Intl.DateTimeFormat(n,e),iT.set(t,i)),i}const sT=new Map;function Kee(n,e={}){const t=JSON.stringify([n,e]);let i=sT.get(t);return i===void 0&&(i=new Intl.NumberFormat(n,e),sT.set(t,i)),i}const oT=new Map;function jee(n,e={}){const{base:t,...i}=e,r=JSON.stringify([n,i]);let o=oT.get(r);return o===void 0&&(o=new Intl.RelativeTimeFormat(n,e),oT.set(r,o)),o}let T0=null;function $ee(){return T0||(T0=new Intl.DateTimeFormat().resolvedOptions().locale,T0)}const aT=new Map;function aV(n){let e=aT.get(n);return e===void 0&&(e=new Intl.DateTimeFormat(n).resolvedOptions(),aT.set(n,e)),e}const lT=new Map;function Jee(n){let e=lT.get(n);if(!e){const t=new Intl.Locale(n);e="getWeekInfo"in t?t.getWeekInfo():t.weekInfo,"minimalDays"in e||(e={...lV,...e}),lT.set(n,e)}return e}function qee(n){const e=n.indexOf("-x-");e!==-1&&(n=n.substring(0,e));const t=n.indexOf("-u-");if(t===-1)return[n];{let i,r;try{i=rT(n).resolvedOptions(),r=n}catch{const u=n.substring(0,t);i=rT(u).resolvedOptions(),r=u}const{numberingSystem:o,calendar:s}=i;return[r,o,s]}}function Qee(n,e,t){return(t||e)&&(n.includes("-u-")||(n+="-u"),t&&(n+=`-ca-${t}`),e&&(n+=`-nu-${e}`)),n}function ete(n){const e=[];for(let t=1;t<=12;t++){const i=ri.utc(2009,t,1);e.push(n(i))}return e}function tte(n){const e=[];for(let t=1;t<=7;t++){const i=ri.utc(2016,11,13+t);e.push(n(i))}return e}function fx(n,e,t,i){const r=n.listingMode();return r==="error"?null:r==="en"?t(e):i(e)}function nte(n){return n.numberingSystem&&n.numberingSystem!=="latn"?!1:n.numberingSystem==="latn"||!n.locale||n.locale.startsWith("en")||aV(n.locale).numberingSystem==="latn"}class ite{constructor(e,t,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:r,floor:o,...s}=i;if(!t||Object.keys(s).length>0){const l={useGrouping:!1,...i};i.padTo>0&&(l.minimumIntegerDigits=i.padTo),this.inf=Kee(e,l)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}else{const t=this.floor?Math.floor(e):GM(e,3);return js(t,this.padTo)}}}class rte{constructor(e,t,i){this.opts=i,this.originalZone=void 0;let r;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const s=-1*(e.offset/60),l=s>=0?`Etc/GMT+${s}`:`Etc/GMT${s}`;e.offset!==0&&jh.create(l).valid?(r=l,this.dt=e):(r="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,r=e.zone.name):(r="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const o={...this.opts};o.timeZone=o.timeZone||r,this.dtf=rT(t,o)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(t=>{if(t.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...t,value:i}}else return t}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class ste{constructor(e,t,i){this.opts={style:"long",...i},!t&&gV()&&(this.rtf=jee(e,i))}format(e,t){return this.rtf?this.rtf.format(e,t):Ete(t,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}const lV={firstDay:1,minimalDays:4,weekend:[6,7]};class br{static fromOpts(e){return br.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,t,i,r,o=!1){const s=e||As.defaultLocale,l=s||(o?"en-US":$ee()),u=t||As.defaultNumberingSystem,h=i||As.defaultOutputCalendar,d=cT(r)||As.defaultWeekSettings;return new br(l,u,h,d,s)}static resetCache(){T0=null,iT.clear(),sT.clear(),oT.clear(),aT.clear(),lT.clear()}static fromObject({locale:e,numberingSystem:t,outputCalendar:i,weekSettings:r}={}){return br.create(e,t,i,r)}constructor(e,t,i,r,o){const[s,l,u]=qee(e);this.locale=s,this.numberingSystem=t||l||null,this.outputCalendar=i||u||null,this.weekSettings=r,this.intl=Qee(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=o,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=nte(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&t?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:br.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,cT(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1){return fx(this,e,bV,()=>{const i=this.intl==="ja"||this.intl.startsWith("ja-");t&=!i;const r=t?{month:e,day:"numeric"}:{month:e},o=t?"format":"standalone";if(!this.monthsCache[o][e]){const s=i?l=>this.dtFormatter(l,r).format():l=>this.extract(l,r,"month");this.monthsCache[o][e]=ete(s)}return this.monthsCache[o][e]})}weekdays(e,t=!1){return fx(this,e,CV,()=>{const i=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},r=t?"format":"standalone";return this.weekdaysCache[r][e]||(this.weekdaysCache[r][e]=tte(o=>this.extract(o,i,"weekday"))),this.weekdaysCache[r][e]})}meridiems(){return fx(this,void 0,()=>wV,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[ri.utc(2016,11,13,9),ri.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return fx(this,e,AV,()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[ri.utc(-40,1,1),ri.utc(2017,1,1)].map(i=>this.extract(i,t,"era"))),this.eraCache[e]})}extract(e,t,i){const r=this.dtFormatter(e,t),o=r.formatToParts(),s=o.find(l=>l.type.toLowerCase()===i);return s?s.value:null}numberFormatter(e={}){return new ite(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new rte(e,this.intl,t)}relFormatter(e={}){return new ste(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Hee(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||aV(this.intl).locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:mV()?Jee(this.locale):lV}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let rS=null;class Ia extends Cb{static get utcInstance(){return rS===null&&(rS=new Ia(0)),rS}static instance(e){return e===0?Ia.utcInstance:new Ia(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new Ia($w(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${ev(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${ev(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return ev(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class ote extends Cb{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Yd(n,e){if(si(n)||n===null)return e;if(n instanceof Cb)return n;if(dte(n)){const t=n.toLowerCase();return t==="default"?e:t==="local"||t==="system"?Hw.instance:t==="utc"||t==="gmt"?Ia.utcInstance:Ia.parseSpecifier(t)||jh.create(n)}else return uf(n)?Ia.instance(n):typeof n=="object"&&"offset"in n&&typeof n.offset=="function"?n:new ote(n)}const MM={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},RF={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},ate=MM.hanidec.replace(/[\[|\]]/g,"").split("");function lte(n){let e=parseInt(n,10);if(isNaN(e)){e="";for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);if(n[t].search(MM.hanidec)!==-1)e+=ate.indexOf(n[t]);else for(const r in RF){const[o,s]=RF[r];i>=o&&i<=s&&(e+=i-o)}}return parseInt(e,10)}else return e}const uT=new Map;function ute(){uT.clear()}function du({numberingSystem:n},e=""){const t=n||"latn";let i=uT.get(t);i===void 0&&(i=new Map,uT.set(t,i));let r=i.get(e);return r===void 0&&(r=new RegExp(`${MM[t]}${e}`),i.set(e,r)),r}let MF=()=>Date.now(),kF="system",LF=null,PF=null,GF=null,FF=60,OF,NF=null;class As{static get now(){return MF}static set now(e){MF=e}static set defaultZone(e){kF=e}static get defaultZone(){return Yd(kF,Hw.instance)}static get defaultLocale(){return LF}static set defaultLocale(e){LF=e}static get defaultNumberingSystem(){return PF}static set defaultNumberingSystem(e){PF=e}static get defaultOutputCalendar(){return GF}static set defaultOutputCalendar(e){GF=e}static get defaultWeekSettings(){return NF}static set defaultWeekSettings(e){NF=cT(e)}static get twoDigitCutoffYear(){return FF}static set twoDigitCutoffYear(e){FF=e%100}static get throwOnInvalid(){return OF}static set throwOnInvalid(e){OF=e}static resetCaches(){br.resetCache(),jh.resetCache(),ri.resetCache(),ute()}}class Cu{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const uV=[0,31,59,90,120,151,181,212,243,273,304,334],cV=[0,31,60,91,121,152,182,213,244,274,305,335];function Ul(n,e){return new Cu("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${n}, which is invalid`)}function kM(n,e,t){const i=new Date(Date.UTC(n,e-1,t));n<100&&n>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const r=i.getUTCDay();return r===0?7:r}function hV(n,e,t){return t+(wb(n)?cV:uV)[e-1]}function dV(n,e){const t=wb(n)?cV:uV,i=t.findIndex(o=>o<e),r=e-t[i];return{month:i+1,day:r}}function LM(n,e){return(n-e+7)%7+1}function IC(n,e=4,t=1){const{year:i,month:r,day:o}=n,s=hV(i,r,o),l=LM(kM(i,r,o),t);let u=Math.floor((s-l+14-e)/7),h;return u<1?(h=i-1,u=Wv(h,e,t)):u>Wv(i,e,t)?(h=i+1,u=1):h=i,{weekYear:h,weekNumber:u,weekday:l,...Jw(n)}}function DF(n,e=4,t=1){const{weekYear:i,weekNumber:r,weekday:o}=n,s=LM(kM(i,1,e),t),l=oy(i);let u=r*7+o-s-7+e,h;u<1?(h=i-1,u+=oy(h)):u>l?(h=i+1,u-=oy(i)):h=i;const{month:d,day:m}=dV(h,u);return{year:h,month:d,day:m,...Jw(n)}}function sS(n){const{year:e,month:t,day:i}=n,r=hV(e,t,i);return{year:e,ordinal:r,...Jw(n)}}function VF(n){const{year:e,ordinal:t}=n,{month:i,day:r}=dV(e,t);return{year:e,month:i,day:r,...Jw(n)}}function BF(n,e){if(!si(n.localWeekday)||!si(n.localWeekNumber)||!si(n.localWeekYear)){if(!si(n.weekday)||!si(n.weekNumber)||!si(n.weekYear))throw new zm("Cannot mix locale-based week fields with ISO-based week fields");return si(n.localWeekday)||(n.weekday=n.localWeekday),si(n.localWeekNumber)||(n.weekNumber=n.localWeekNumber),si(n.localWeekYear)||(n.weekYear=n.localWeekYear),delete n.localWeekday,delete n.localWeekNumber,delete n.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function cte(n,e=4,t=1){const i=Kw(n.weekYear),r=Xl(n.weekNumber,1,Wv(n.weekYear,e,t)),o=Xl(n.weekday,1,7);return i?r?o?!1:Ul("weekday",n.weekday):Ul("week",n.weekNumber):Ul("weekYear",n.weekYear)}function hte(n){const e=Kw(n.year),t=Xl(n.ordinal,1,oy(n.year));return e?t?!1:Ul("ordinal",n.ordinal):Ul("year",n.year)}function fV(n){const e=Kw(n.year),t=Xl(n.month,1,12),i=Xl(n.day,1,CC(n.year,n.month));return e?t?i?!1:Ul("day",n.day):Ul("month",n.month):Ul("year",n.year)}function pV(n){const{hour:e,minute:t,second:i,millisecond:r}=n,o=Xl(e,0,23)||e===24&&t===0&&i===0&&r===0,s=Xl(t,0,59),l=Xl(i,0,59),u=Xl(r,0,999);return o?s?l?u?!1:Ul("millisecond",r):Ul("second",i):Ul("minute",t):Ul("hour",e)}function si(n){return typeof n>"u"}function uf(n){return typeof n=="number"}function Kw(n){return typeof n=="number"&&n%1===0}function dte(n){return typeof n=="string"}function fte(n){return Object.prototype.toString.call(n)==="[object Date]"}function gV(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function mV(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function pte(n){return Array.isArray(n)?n:[n]}function ZF(n,e,t){if(n.length!==0)return n.reduce((i,r)=>{const o=[e(r),r];return i&&t(i[0],o[0])===i[0]?i:o},null)[1]}function gte(n,e){return e.reduce((t,i)=>(t[i]=n[i],t),{})}function Sy(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function cT(n){if(n==null)return null;if(typeof n!="object")throw new jo("Week settings must be an object");if(!Xl(n.firstDay,1,7)||!Xl(n.minimalDays,1,7)||!Array.isArray(n.weekend)||n.weekend.some(e=>!Xl(e,1,7)))throw new jo("Invalid week settings");return{firstDay:n.firstDay,minimalDays:n.minimalDays,weekend:Array.from(n.weekend)}}function Xl(n,e,t){return Kw(n)&&n>=e&&n<=t}function mte(n,e){return n-e*Math.floor(n/e)}function js(n,e=2){const t=n<0;let i;return t?i="-"+(""+-n).padStart(e,"0"):i=(""+n).padStart(e,"0"),i}function Wd(n){if(!(si(n)||n===null||n===""))return parseInt(n,10)}function fp(n){if(!(si(n)||n===null||n===""))return parseFloat(n)}function PM(n){if(!(si(n)||n===null||n==="")){const e=parseFloat("0."+n)*1e3;return Math.floor(e)}}function GM(n,e,t="round"){const i=10**e;switch(t){case"expand":return n>0?Math.ceil(n*i)/i:Math.floor(n*i)/i;case"trunc":return Math.trunc(n*i)/i;case"round":return Math.round(n*i)/i;case"floor":return Math.floor(n*i)/i;case"ceil":return Math.ceil(n*i)/i;default:throw new RangeError(`Value rounding ${t} is out of range`)}}function wb(n){return n%4===0&&(n%100!==0||n%400===0)}function oy(n){return wb(n)?366:365}function CC(n,e){const t=mte(e-1,12)+1,i=n+(e-t)/12;return t===2?wb(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][t-1]}function jw(n){let e=Date.UTC(n.year,n.month-1,n.day,n.hour,n.minute,n.second,n.millisecond);return n.year<100&&n.year>=0&&(e=new Date(e),e.setUTCFullYear(n.year,n.month-1,n.day)),+e}function WF(n,e,t){return-LM(kM(n,1,e),t)+e-1}function Wv(n,e=4,t=1){const i=WF(n,e,t),r=WF(n+1,e,t);return(oy(n)-i+r)/7}function hT(n){return n>99?n:n>As.twoDigitCutoffYear?1900+n:2e3+n}function yV(n,e,t,i=null){const r=new Date(n),o={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(o.timeZone=i);const s={timeZoneName:e,...o},l=new Intl.DateTimeFormat(t,s).formatToParts(r).find(u=>u.type.toLowerCase()==="timezonename");return l?l.value:null}function $w(n,e){let t=parseInt(n,10);Number.isNaN(t)&&(t=0);const i=parseInt(e,10)||0,r=t<0||Object.is(t,-0)?-i:i;return t*60+r}function _V(n){const e=Number(n);if(typeof n=="boolean"||n===""||!Number.isFinite(e))throw new jo(`Invalid unit value ${n}`);return e}function wC(n,e){const t={};for(const i in n)if(Sy(n,i)){const r=n[i];if(r==null)continue;t[e(i)]=_V(r)}return t}function ev(n,e){const t=Math.trunc(Math.abs(n/60)),i=Math.trunc(Math.abs(n%60)),r=n>=0?"+":"-";switch(e){case"short":return`${r}${js(t,2)}:${js(i,2)}`;case"narrow":return`${r}${t}${i>0?`:${i}`:""}`;case"techie":return`${r}${js(t,2)}${js(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function Jw(n){return gte(n,["hour","minute","second","millisecond"])}const yte=["January","February","March","April","May","June","July","August","September","October","November","December"],vV=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_te=["J","F","M","A","M","J","J","A","S","O","N","D"];function bV(n){switch(n){case"narrow":return[..._te];case"short":return[...vV];case"long":return[...yte];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const xV=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],IV=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],vte=["M","T","W","T","F","S","S"];function CV(n){switch(n){case"narrow":return[...vte];case"short":return[...IV];case"long":return[...xV];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const wV=["AM","PM"],bte=["Before Christ","Anno Domini"],xte=["BC","AD"],Ite=["B","A"];function AV(n){switch(n){case"narrow":return[...Ite];case"short":return[...xte];case"long":return[...bte];default:return null}}function Cte(n){return wV[n.hour<12?0:1]}function wte(n,e){return CV(e)[n.weekday-1]}function Ate(n,e){return bV(e)[n.month-1]}function Ste(n,e){return AV(e)[n.year<0?0:1]}function Ete(n,e,t="always",i=!1){const r={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},o=["hours","minutes","seconds"].indexOf(n)===-1;if(t==="auto"&&o){const m=n==="days";switch(e){case 1:return m?"tomorrow":`next ${r[n][0]}`;case-1:return m?"yesterday":`last ${r[n][0]}`;case 0:return m?"today":`this ${r[n][0]}`}}const s=Object.is(e,-0)||e<0,l=Math.abs(e),u=l===1,h=r[n],d=i?u?h[1]:h[2]||h[1]:u?r[n][0]:n;return s?`${l} ${d} ago`:`in ${l} ${d}`}function zF(n,e){let t="";for(const i of n)i.literal?t+=i.val:t+=e(i.val);return t}const Tte={D:xC,DD:W4,DDD:z4,DDDD:U4,t:X4,tt:Y4,ttt:H4,tttt:K4,T:j4,TT:$4,TTT:J4,TTTT:q4,f:Q4,ff:tV,fff:iV,ffff:sV,F:eV,FF:nV,FFF:rV,FFFF:oV};class ea{static create(e,t={}){return new ea(e,t)}static parseFormat(e){let t=null,i="",r=!1;const o=[];for(let s=0;s<e.length;s++){const l=e.charAt(s);l==="'"?((i.length>0||r)&&o.push({literal:r||/^\s+$/.test(i),val:i===""?"'":i}),t=null,i="",r=!r):r||l===t?i+=l:(i.length>0&&o.push({literal:/^\s+$/.test(i),val:i}),i=l,t=l)}return i.length>0&&o.push({literal:r||/^\s+$/.test(i),val:i}),o}static macroTokenToFormatOpts(e){return Tte[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0,i=void 0){if(this.opts.forceSimple)return js(e,t);const r={...this.opts};return t>0&&(r.padTo=t),i&&(r.signDisplay=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,t){const i=this.loc.listingMode()==="en",r=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",o=(x,C)=>this.loc.extract(e,x,C),s=x=>e.isOffsetFixed&&e.offset===0&&x.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,x.format):"",l=()=>i?Cte(e):o({hour:"numeric",hourCycle:"h12"},"dayperiod"),u=(x,C)=>i?Ate(e,x):o(C?{month:x}:{month:x,day:"numeric"},"month"),h=(x,C)=>i?wte(e,x):o(C?{weekday:x}:{weekday:x,month:"long",day:"numeric"},"weekday"),d=x=>{const C=ea.macroTokenToFormatOpts(x);return C?this.formatWithSystemDefault(e,C):x},m=x=>i?Ste(e,x):o({era:x},"era"),y=x=>{switch(x){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return s({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return s({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return s({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return l();case"d":return r?o({day:"numeric"},"day"):this.num(e.day);case"dd":return r?o({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return h("short",!0);case"cccc":return h("long",!0);case"ccccc":return h("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return h("short",!1);case"EEEE":return h("long",!1);case"EEEEE":return h("narrow",!1);case"L":return r?o({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return r?o({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return u("short",!0);case"LLLL":return u("long",!0);case"LLLLL":return u("narrow",!0);case"M":return r?o({month:"numeric"},"month"):this.num(e.month);case"MM":return r?o({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return u("short",!1);case"MMMM":return u("long",!1);case"MMMMM":return u("narrow",!1);case"y":return r?o({year:"numeric"},"year"):this.num(e.year);case"yy":return r?o({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return r?o({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return r?o({year:"numeric"},"year"):this.num(e.year,6);case"G":return m("short");case"GG":return m("long");case"GGGGG":return m("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return d(x)}};return zF(ea.parseFormat(t),y)}formatDurationFromString(e,t){const i=this.opts.signMode==="negativeLargestOnly"?-1:1,r=d=>{switch(d[0]){case"S":return"milliseconds";case"s":return"seconds";case"m":return"minutes";case"h":return"hours";case"d":return"days";case"w":return"weeks";case"M":return"months";case"y":return"years";default:return null}},o=(d,m)=>y=>{const x=r(y);if(x){const C=m.isNegativeDuration&&x!==m.largestUnit?i:1;let w;return this.opts.signMode==="negativeLargestOnly"&&x!==m.largestUnit?w="never":this.opts.signMode==="all"?w="always":w="auto",this.num(d.get(x)*C,y.length,w)}else return y},s=ea.parseFormat(t),l=s.reduce((d,{literal:m,val:y})=>m?d:d.concat(y),[]),u=e.shiftTo(...l.map(r).filter(d=>d)),h={isNegativeDuration:u<0,largestUnit:Object.keys(u.values)[0]};return zF(s,o(u,h))}}const SV=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function Zy(...n){const e=n.reduce((t,i)=>t+i.source,"");return RegExp(`^${e}$`)}function Wy(...n){return e=>n.reduce(([t,i,r],o)=>{const[s,l,u]=o(e,r);return[{...t,...s},l||i,u]},[{},null,1]).slice(0,2)}function zy(n,...e){if(n==null)return[null,null];for(const[t,i]of e){const r=t.exec(n);if(r)return i(r)}return[null,null]}function EV(...n){return(e,t)=>{const i={};let r;for(r=0;r<n.length;r++)i[n[r]]=Wd(e[t+r]);return[i,null,t+r]}}const TV=/(?:([Zz])|([+-]\d\d)(?::?(\d\d))?)/,Rte=`(?:${TV.source}?(?:\\[(${SV.source})\\])?)?`,FM=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,RV=RegExp(`${FM.source}${Rte}`),OM=RegExp(`(?:[Tt]${RV.source})?`),Mte=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,kte=/(\d{4})-?W(\d\d)(?:-?(\d))?/,Lte=/(\d{4})-?(\d{3})/,Pte=EV("weekYear","weekNumber","weekDay"),Gte=EV("year","ordinal"),Fte=/(\d{4})-(\d\d)-(\d\d)/,MV=RegExp(`${FM.source} ?(?:${TV.source}|(${SV.source}))?`),Ote=RegExp(`(?: ${MV.source})?`);function ay(n,e,t){const i=n[e];return si(i)?t:Wd(i)}function Nte(n,e){return[{year:ay(n,e),month:ay(n,e+1,1),day:ay(n,e+2,1)},null,e+3]}function Uy(n,e){return[{hours:ay(n,e,0),minutes:ay(n,e+1,0),seconds:ay(n,e+2,0),milliseconds:PM(n[e+3])},null,e+4]}function Ab(n,e){const t=!n[e]&&!n[e+1],i=$w(n[e+1],n[e+2]),r=t?null:Ia.instance(i);return[{},r,e+3]}function Sb(n,e){const t=n[e]?jh.create(n[e]):null;return[{},t,e+1]}const Dte=RegExp(`^T?${FM.source}$`),Vte=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Bte(n){const[e,t,i,r,o,s,l,u,h]=n,d=e[0]==="-",m=u&&u[0]==="-",y=(x,C=!1)=>x!==void 0&&(C||x&&d)?-x:x;return[{years:y(fp(t)),months:y(fp(i)),weeks:y(fp(r)),days:y(fp(o)),hours:y(fp(s)),minutes:y(fp(l)),seconds:y(fp(u),u==="-0"),milliseconds:y(PM(h),m)}]}const Zte={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function NM(n,e,t,i,r,o,s){const l={year:e.length===2?hT(Wd(e)):Wd(e),month:vV.indexOf(t)+1,day:Wd(i),hour:Wd(r),minute:Wd(o)};return s&&(l.second=Wd(s)),n&&(l.weekday=n.length>3?xV.indexOf(n)+1:IV.indexOf(n)+1),l}const Wte=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function zte(n){const[,e,t,i,r,o,s,l,u,h,d,m]=n,y=NM(e,r,i,t,o,s,l);let x;return u?x=Zte[u]:h?x=0:x=$w(d,m),[y,new Ia(x)]}function Ute(n){return n.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const Xte=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Yte=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Hte=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function UF(n){const[,e,t,i,r,o,s,l]=n;return[NM(e,r,i,t,o,s,l),Ia.utcInstance]}function Kte(n){const[,e,t,i,r,o,s,l]=n;return[NM(e,l,t,i,r,o,s),Ia.utcInstance]}const jte=Zy(Mte,OM),$te=Zy(kte,OM),Jte=Zy(Lte,OM),qte=Zy(RV),kV=Wy(Nte,Uy,Ab,Sb),Qte=Wy(Pte,Uy,Ab,Sb),ene=Wy(Gte,Uy,Ab,Sb),tne=Wy(Uy,Ab,Sb);function nne(n){return zy(n,[jte,kV],[$te,Qte],[Jte,ene],[qte,tne])}function ine(n){return zy(Ute(n),[Wte,zte])}function rne(n){return zy(n,[Xte,UF],[Yte,UF],[Hte,Kte])}function sne(n){return zy(n,[Vte,Bte])}const one=Wy(Uy);function ane(n){return zy(n,[Dte,one])}const lne=Zy(Fte,Ote),une=Zy(MV),cne=Wy(Uy,Ab,Sb);function hne(n){return zy(n,[lne,kV],[une,cne])}const XF="Invalid Duration",LV={weeks:{days:7,hours:168,minutes:10080,seconds:10080*60,milliseconds:10080*60*1e3},days:{hours:24,minutes:1440,seconds:1440*60,milliseconds:1440*60*1e3},hours:{minutes:60,seconds:3600,milliseconds:3600*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},dne={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:2184*60,seconds:2184*60*60,milliseconds:2184*60*60*1e3},months:{weeks:4,days:30,hours:720,minutes:720*60,seconds:720*60*60,milliseconds:720*60*60*1e3},...LV},Vl=146097/400,ym=146097/4800,fne={years:{quarters:4,months:12,weeks:Vl/7,days:Vl,hours:Vl*24,minutes:Vl*24*60,seconds:Vl*24*60*60,milliseconds:Vl*24*60*60*1e3},quarters:{months:3,weeks:Vl/28,days:Vl/4,hours:Vl*24/4,minutes:Vl*24*60/4,seconds:Vl*24*60*60/4,milliseconds:Vl*24*60*60*1e3/4},months:{weeks:ym/7,days:ym,hours:ym*24,minutes:ym*24*60,seconds:ym*24*60*60,milliseconds:ym*24*60*60*1e3},...LV},Mp=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],pne=Mp.slice(0).reverse();function mh(n,e,t=!1){const i={values:t?e.values:{...n.values,...e.values||{}},loc:n.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||n.conversionAccuracy,matrix:e.matrix||n.matrix};return new tr(i)}function PV(n,e){let t=e.milliseconds??0;for(const i of pne.slice(1))e[i]&&(t+=e[i]*n[i].milliseconds);return t}function YF(n,e){const t=PV(n,e)<0?-1:1;Mp.reduceRight((i,r)=>{if(si(e[r]))return i;if(i){const o=e[i]*t,s=n[r][i],l=Math.floor(o/s);e[r]+=l*t,e[i]-=l*s*t}return r},null),Mp.reduce((i,r)=>{if(si(e[r]))return i;if(i){const o=e[i]%1;e[i]-=o,e[r]+=o*n[i][r]}return r},null)}function HF(n){const e={};for(const[t,i]of Object.entries(n))i!==0&&(e[t]=i);return e}class tr{constructor(e){const t=e.conversionAccuracy==="longterm"||!1;let i=t?fne:dne;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||br.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,t){return tr.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(e==null||typeof e!="object")throw new jo(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new tr({values:wC(e,tr.normalizeUnit),loc:br.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(uf(e))return tr.fromMillis(e);if(tr.isDuration(e))return e;if(typeof e=="object")return tr.fromObject(e);throw new jo(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[i]=sne(e);return i?tr.fromObject(i,t):tr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[i]=ane(e);return i?tr.fromObject(i,t):tr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new jo("need to specify a reason the Duration is invalid");const i=e instanceof Cu?e:new Cu(e,t);if(As.throwOnInvalid)throw new Bee(i);return new tr({invalid:i})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!t)throw new Z4(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const i={...t,floor:t.round!==!1&&t.floor!==!1};return this.isValid?ea.create(this.loc,i).formatDurationFromString(this,e):XF}toHuman(e={}){if(!this.isValid)return XF;const t=e.showZeros!==!1,i=Mp.map(r=>{const o=this.values[r];return si(o)||o===0&&!t?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(o)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=GM(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();return t<0||t>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},ri.fromMillis(t,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?PV(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=tr.fromDurationLike(e),i={};for(const r of Mp)(Sy(t.values,r)||Sy(this.values,r))&&(i[r]=t.get(r)+this.get(r));return mh(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const t=tr.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=_V(e(this.values[i],i));return mh(this,{values:t},!0)}get(e){return this[tr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const t={...this.values,...wC(e,tr.normalizeUnit)};return mh(this,{values:t})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:i,matrix:r}={}){const s={loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:r,conversionAccuracy:i};return mh(this,s)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return YF(this.matrix,e),mh(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=HF(this.normalize().shiftToAll().toObject());return mh(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(s=>tr.normalizeUnit(s));const t={},i={},r=this.toObject();let o;for(const s of Mp)if(e.indexOf(s)>=0){o=s;let l=0;for(const h in i)l+=this.matrix[h][s]*i[h],i[h]=0;uf(r[s])&&(l+=r[s]);const u=Math.trunc(l);t[s]=u,i[s]=(l*1e3-u*1e3)/1e3}else uf(r[s])&&(i[s]=r[s]);for(const s in i)i[s]!==0&&(t[o]+=s===o?i[s]:i[s]/this.matrix[o][s]);return YF(this.matrix,t),mh(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=this.values[t]===0?0:-this.values[t];return mh(this,{values:e},!0)}removeZeros(){if(!this.isValid)return this;const e=HF(this.values);return mh(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function t(i,r){return i===void 0||i===0?r===void 0||r===0:i===r}for(const i of Mp)if(!t(this.values[i],e.values[i]))return!1;return!0}}const _m="Invalid Interval";function gne(n,e){return!n||!n.isValid?Cs.invalid("missing or invalid start"):!e||!e.isValid?Cs.invalid("missing or invalid end"):e<n?Cs.invalid("end before start",`The end of an interval must be after its start, but you had start=${n.toISO()} and end=${e.toISO()}`):null}class Cs{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new jo("need to specify a reason the Interval is invalid");const i=e instanceof Cu?e:new Cu(e,t);if(As.throwOnInvalid)throw new Vee(i);return new Cs({invalid:i})}static fromDateTimes(e,t){const i=u0(e),r=u0(t),o=gne(i,r);return o??new Cs({start:i,end:r})}static after(e,t){const i=tr.fromDurationLike(t),r=u0(e);return Cs.fromDateTimes(r,r.plus(i))}static before(e,t){const i=tr.fromDurationLike(t),r=u0(e);return Cs.fromDateTimes(r.minus(i),r)}static fromISO(e,t){const[i,r]=(e||"").split("/",2);if(i&&r){let o,s;try{o=ri.fromISO(i,t),s=o.isValid}catch{s=!1}let l,u;try{l=ri.fromISO(r,t),u=l.isValid}catch{u=!1}if(s&&u)return Cs.fromDateTimes(o,l);if(s){const h=tr.fromISO(r,t);if(h.isValid)return Cs.after(o,h)}else if(u){const h=tr.fromISO(i,t);if(h.isValid)return Cs.before(l,h)}}return Cs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",t){if(!this.isValid)return NaN;const i=this.start.startOf(e,t);let r;return t?.useLocaleWeeks?r=this.end.reconfigure({locale:i.locale}):r=this.end,r=r.startOf(e,t),Math.floor(r.diff(i,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:t}={}){return this.isValid?Cs.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(u0).filter(s=>this.contains(s)).sort((s,l)=>s.toMillis()-l.toMillis()),i=[];let{s:r}=this,o=0;for(;r<this.e;){const s=t[o]||this.e,l=+s>+this.e?this.e:s;i.push(Cs.fromDateTimes(r,l)),r=l,o+=1}return i}splitBy(e){const t=tr.fromDurationLike(e);if(!this.isValid||!t.isValid||t.as("milliseconds")===0)return[];let{s:i}=this,r=1,o;const s=[];for(;i<this.e;){const l=this.start.plus(t.mapUnits(u=>u*r));o=+l>+this.e?this.e:l,s.push(Cs.fromDateTimes(i,o)),i=o,r+=1}return s}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return t>=i?null:Cs.fromDateTimes(t,i)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return Cs.fromDateTimes(t,i)}static merge(e){const[t,i]=e.sort((r,o)=>r.s-o.s).reduce(([r,o],s)=>o?o.overlaps(s)||o.abutsStart(s)?[r,o.union(s)]:[r.concat([o]),s]:[r,s],[[],null]);return i&&t.push(i),t}static xor(e){let t=null,i=0;const r=[],o=e.map(u=>[{time:u.s,type:"s"},{time:u.e,type:"e"}]),s=Array.prototype.concat(...o),l=s.sort((u,h)=>u.time-h.time);for(const u of l)i+=u.type==="s"?1:-1,i===1?t=u.time:(t&&+t!=+u.time&&r.push(Cs.fromDateTimes(t,u.time)),t=null);return Cs.merge(r)}difference(...e){return Cs.xor([this].concat(e)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:_m}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=xC,t={}){return this.isValid?ea.create(this.s.loc.clone(t),e).formatInterval(this):_m}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:_m}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:_m}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:_m}toFormat(e,{separator:t="  "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:_m}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):tr.invalid(this.invalidReason)}mapEndpoints(e){return Cs.fromDateTimes(e(this.s),e(this.e))}}class px{static hasDST(e=As.defaultZone){const t=ri.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return jh.isValidZone(e)}static normalizeZone(e){return Yd(e,As.defaultZone)}static getStartOfWeek({locale:e=null,locObj:t=null}={}){return(t||br.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:t=null}={}){return(t||br.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:t=null}={}){return(t||br.create(e)).getWeekendDays().slice()}static months(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null,outputCalendar:o="gregory"}={}){return(r||br.create(t,i,o)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null,outputCalendar:o="gregory"}={}){return(r||br.create(t,i,o)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null}={}){return(r||br.create(t,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:i=null,locObj:r=null}={}){return(r||br.create(t,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return br.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return br.create(t,null,"gregory").eras(e)}static features(){return{relative:gV(),localeWeek:mV()}}}function KF(n,e){const t=r=>r.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=t(e)-t(n);return Math.floor(tr.fromMillis(i).as("days"))}function mne(n,e,t){const i=[["years",(u,h)=>h.year-u.year],["quarters",(u,h)=>h.quarter-u.quarter+(h.year-u.year)*4],["months",(u,h)=>h.month-u.month+(h.year-u.year)*12],["weeks",(u,h)=>{const d=KF(u,h);return(d-d%7)/7}],["days",KF]],r={},o=n;let s,l;for(const[u,h]of i)t.indexOf(u)>=0&&(s=u,r[u]=h(n,e),l=o.plus(r),l>e?(r[u]--,n=o.plus(r),n>e&&(l=n,r[u]--,n=o.plus(r))):n=l);return[n,r,l,s]}function yne(n,e,t,i){let[r,o,s,l]=mne(n,e,t);const u=e-r,h=t.filter(m=>["hours","minutes","seconds","milliseconds"].indexOf(m)>=0);h.length===0&&(s<e&&(s=r.plus({[l]:1})),s!==r&&(o[l]=(o[l]||0)+u/(s-r)));const d=tr.fromObject(o,i);return h.length>0?tr.fromMillis(u,i).shiftTo(...h).plus(d):d}const _ne="missing Intl.DateTimeFormat.formatToParts support";function hr(n,e=t=>t){return{regex:n,deser:([t])=>e(lte(t))}}const vne="",GV=`[ ${vne}]`,FV=new RegExp(GV,"g");function bne(n){return n.replace(/\./g,"\\.?").replace(FV,GV)}function jF(n){return n.replace(/\./g,"").replace(FV," ").toLowerCase()}function fu(n,e){return n===null?null:{regex:RegExp(n.map(bne).join("|")),deser:([t])=>n.findIndex(i=>jF(t)===jF(i))+e}}function $F(n,e){return{regex:n,deser:([,t,i])=>$w(t,i),groups:e}}function gx(n){return{regex:n,deser:([e])=>e}}function xne(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Ine(n,e){const t=du(e),i=du(e,"{2}"),r=du(e,"{3}"),o=du(e,"{4}"),s=du(e,"{6}"),l=du(e,"{1,2}"),u=du(e,"{1,3}"),h=du(e,"{1,6}"),d=du(e,"{1,9}"),m=du(e,"{2,4}"),y=du(e,"{4,6}"),x=S=>({regex:RegExp(xne(S.val)),deser:([T])=>T,literal:!0}),w=(S=>{if(n.literal)return x(S);switch(S.val){case"G":return fu(e.eras("short"),0);case"GG":return fu(e.eras("long"),0);case"y":return hr(h);case"yy":return hr(m,hT);case"yyyy":return hr(o);case"yyyyy":return hr(y);case"yyyyyy":return hr(s);case"M":return hr(l);case"MM":return hr(i);case"MMM":return fu(e.months("short",!0),1);case"MMMM":return fu(e.months("long",!0),1);case"L":return hr(l);case"LL":return hr(i);case"LLL":return fu(e.months("short",!1),1);case"LLLL":return fu(e.months("long",!1),1);case"d":return hr(l);case"dd":return hr(i);case"o":return hr(u);case"ooo":return hr(r);case"HH":return hr(i);case"H":return hr(l);case"hh":return hr(i);case"h":return hr(l);case"mm":return hr(i);case"m":return hr(l);case"q":return hr(l);case"qq":return hr(i);case"s":return hr(l);case"ss":return hr(i);case"S":return hr(u);case"SSS":return hr(r);case"u":return gx(d);case"uu":return gx(l);case"uuu":return hr(t);case"a":return fu(e.meridiems(),0);case"kkkk":return hr(o);case"kk":return hr(m,hT);case"W":return hr(l);case"WW":return hr(i);case"E":case"c":return hr(t);case"EEE":return fu(e.weekdays("short",!1),1);case"EEEE":return fu(e.weekdays("long",!1),1);case"ccc":return fu(e.weekdays("short",!0),1);case"cccc":return fu(e.weekdays("long",!0),1);case"Z":case"ZZ":return $F(new RegExp(`([+-]${l.source})(?::(${i.source}))?`),2);case"ZZZ":return $F(new RegExp(`([+-]${l.source})(${i.source})?`),2);case"z":return gx(/[a-z_+-/]{1,256}?/i);case" ":return gx(/[^\S\n\r]/);default:return x(S)}})(n)||{invalidReason:_ne};return w.token=n,w}const Cne={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function wne(n,e,t){const{type:i,value:r}=n;if(i==="literal"){const u=/^\s+$/.test(r);return{literal:!u,val:u?" ":r}}const o=e[i];let s=i;i==="hour"&&(e.hour12!=null?s=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?s="hour12":s="hour24":s=t.hour12?"hour12":"hour24");let l=Cne[s];if(typeof l=="object"&&(l=l[o]),l)return{literal:!1,val:l}}function Ane(n){return[`^${n.map(t=>t.regex).reduce((t,i)=>`${t}(${i.source})`,"")}$`,n]}function Sne(n,e,t){const i=n.match(e);if(i){const r={};let o=1;for(const s in t)if(Sy(t,s)){const l=t[s],u=l.groups?l.groups+1:1;!l.literal&&l.token&&(r[l.token.val[0]]=l.deser(i.slice(o,o+u))),o+=u}return[i,r]}else return[i,{}]}function Ene(n){const e=o=>{switch(o){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let t=null,i;return si(n.z)||(t=jh.create(n.z)),si(n.Z)||(t||(t=new Ia(n.Z)),i=n.Z),si(n.q)||(n.M=(n.q-1)*3+1),si(n.h)||(n.h<12&&n.a===1?n.h+=12:n.h===12&&n.a===0&&(n.h=0)),n.G===0&&n.y&&(n.y=-n.y),si(n.u)||(n.S=PM(n.u)),[Object.keys(n).reduce((o,s)=>{const l=e(s);return l&&(o[l]=n[s]),o},{}),t,i]}let oS=null;function Tne(){return oS||(oS=ri.fromMillis(1555555555555)),oS}function Rne(n,e){if(n.literal)return n;const t=ea.macroTokenToFormatOpts(n.val),i=VV(t,e);return i==null||i.includes(void 0)?n:i}function OV(n,e){return Array.prototype.concat(...n.map(t=>Rne(t,e)))}class NV{constructor(e,t){if(this.locale=e,this.format=t,this.tokens=OV(ea.parseFormat(t),e),this.units=this.tokens.map(i=>Ine(i,e)),this.disqualifyingUnit=this.units.find(i=>i.invalidReason),!this.disqualifyingUnit){const[i,r]=Ane(this.units);this.regex=RegExp(i,"i"),this.handlers=r}}explainFromTokens(e){if(this.isValid){const[t,i]=Sne(e,this.regex,this.handlers),[r,o,s]=i?Ene(i):[null,null,void 0];if(Sy(i,"a")&&Sy(i,"H"))throw new zm("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:t,matches:i,result:r,zone:o,specificOffset:s}}else return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function DV(n,e,t){return new NV(n,t).explainFromTokens(e)}function Mne(n,e,t){const{result:i,zone:r,specificOffset:o,invalidReason:s}=DV(n,e,t);return[i,r,o,s]}function VV(n,e){if(!n)return null;const i=ea.create(e,n).dtFormatter(Tne()),r=i.formatToParts(),o=i.resolvedOptions();return r.map(s=>wne(s,n,o))}const aS="Invalid DateTime",JF=864e13;function R0(n){return new Cu("unsupported zone",`the zone "${n.name}" is not supported`)}function lS(n){return n.weekData===null&&(n.weekData=IC(n.c)),n.weekData}function uS(n){return n.localWeekData===null&&(n.localWeekData=IC(n.c,n.loc.getMinDaysInFirstWeek(),n.loc.getStartOfWeek())),n.localWeekData}function pp(n,e){const t={ts:n.ts,zone:n.zone,c:n.c,o:n.o,loc:n.loc,invalid:n.invalid};return new ri({...t,...e,old:t})}function BV(n,e,t){let i=n-e*60*1e3;const r=t.offset(i);if(e===r)return[i,e];i-=(r-e)*60*1e3;const o=t.offset(i);return r===o?[i,r]:[n-Math.min(r,o)*60*1e3,Math.max(r,o)]}function mx(n,e){n+=e*60*1e3;const t=new Date(n);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate(),hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()}}function fI(n,e,t){return BV(jw(n),e,t)}function qF(n,e){const t=n.o,i=n.c.year+Math.trunc(e.years),r=n.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,o={...n.c,year:i,month:r,day:Math.min(n.c.day,CC(i,r))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},s=tr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),l=jw(o);let[u,h]=BV(l,t,n.zone);return s!==0&&(u+=s,h=n.zone.offset(u)),{ts:u,o:h}}function vm(n,e,t,i,r,o){const{setZone:s,zone:l}=t;if(n&&Object.keys(n).length!==0||e){const u=e||l,h=ri.fromObject(n,{...t,zone:u,specificOffset:o});return s?h:h.setZone(l)}else return ri.invalid(new Cu("unparsable",`the input "${r}" can't be parsed as ${i}`))}function yx(n,e,t=!0){return n.isValid?ea.create(br.create("en-US"),{allowZ:t,forceSimple:!0}).formatDateTimeFromString(n,e):null}function cS(n,e,t){const i=n.c.year>9999||n.c.year<0;let r="";if(i&&n.c.year>=0&&(r+="+"),r+=js(n.c.year,i?6:4),t==="year")return r;if(e){if(r+="-",r+=js(n.c.month),t==="month")return r;r+="-"}else if(r+=js(n.c.month),t==="month")return r;return r+=js(n.c.day),r}function QF(n,e,t,i,r,o,s){let l=!t||n.c.millisecond!==0||n.c.second!==0,u="";switch(s){case"day":case"month":case"year":break;default:if(u+=js(n.c.hour),s==="hour")break;if(e){if(u+=":",u+=js(n.c.minute),s==="minute")break;l&&(u+=":",u+=js(n.c.second))}else{if(u+=js(n.c.minute),s==="minute")break;l&&(u+=js(n.c.second))}if(s==="second")break;l&&(!i||n.c.millisecond!==0)&&(u+=".",u+=js(n.c.millisecond,3))}return r&&(n.isOffsetFixed&&n.offset===0&&!o?u+="Z":n.o<0?(u+="-",u+=js(Math.trunc(-n.o/60)),u+=":",u+=js(Math.trunc(-n.o%60))):(u+="+",u+=js(Math.trunc(n.o/60)),u+=":",u+=js(Math.trunc(n.o%60)))),o&&(u+="["+n.zone.ianaName+"]"),u}const ZV={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},kne={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Lne={ordinal:1,hour:0,minute:0,second:0,millisecond:0},pI=["year","month","day","hour","minute","second","millisecond"],Pne=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Gne=["year","ordinal","hour","minute","second","millisecond"];function gI(n){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[n.toLowerCase()];if(!e)throw new Z4(n);return e}function e5(n){switch(n.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return gI(n)}}function Fne(n){if(M0===void 0&&(M0=As.now()),n.type!=="iana")return n.offset(M0);const e=n.name;let t=dT.get(e);return t===void 0&&(t=n.offset(M0),dT.set(e,t)),t}function t5(n,e){const t=Yd(e.zone,As.defaultZone);if(!t.isValid)return ri.invalid(R0(t));const i=br.fromObject(e);let r,o;if(si(n.year))r=As.now();else{for(const u of pI)si(n[u])&&(n[u]=ZV[u]);const s=fV(n)||pV(n);if(s)return ri.invalid(s);const l=Fne(t);[r,o]=fI(n,l,t)}return new ri({ts:r,zone:t,loc:i,o})}function n5(n,e,t){const i=si(t.round)?!0:t.round,r=si(t.rounding)?"trunc":t.rounding,o=(l,u)=>(l=GM(l,i||t.calendary?0:2,t.calendary?"round":r),e.loc.clone(t).relFormatter(t).format(l,u)),s=l=>t.calendary?e.hasSame(n,l)?0:e.startOf(l).diff(n.startOf(l),l).get(l):e.diff(n,l).get(l);if(t.unit)return o(s(t.unit),t.unit);for(const l of t.units){const u=s(l);if(Math.abs(u)>=1)return o(u,l)}return o(n>e?-0:0,t.units[t.units.length-1])}function i5(n){let e={},t;return n.length>0&&typeof n[n.length-1]=="object"?(e=n[n.length-1],t=Array.from(n).slice(0,n.length-1)):t=Array.from(n),[e,t]}let M0;const dT=new Map;class ri{constructor(e){const t=e.zone||As.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new Cu("invalid input"):null)||(t.isValid?null:R0(t));this.ts=si(e.ts)?As.now():e.ts;let r=null,o=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[r,o]=[e.old.c,e.old.o];else{const l=uf(e.o)&&!e.old?e.o:t.offset(this.ts);r=mx(this.ts,l),i=Number.isNaN(r.year)?new Cu("invalid input"):null,r=i?null:r,o=i?null:l}this._zone=t,this.loc=e.loc||br.create(),this.invalid=i,this.weekData=null,this.localWeekData=null,this.c=r,this.o=o,this.isLuxonDateTime=!0}static now(){return new ri({})}static local(){const[e,t]=i5(arguments),[i,r,o,s,l,u,h]=t;return t5({year:i,month:r,day:o,hour:s,minute:l,second:u,millisecond:h},e)}static utc(){const[e,t]=i5(arguments),[i,r,o,s,l,u,h]=t;return e.zone=Ia.utcInstance,t5({year:i,month:r,day:o,hour:s,minute:l,second:u,millisecond:h},e)}static fromJSDate(e,t={}){const i=fte(e)?e.valueOf():NaN;if(Number.isNaN(i))return ri.invalid("invalid input");const r=Yd(t.zone,As.defaultZone);return r.isValid?new ri({ts:i,zone:r,loc:br.fromObject(t)}):ri.invalid(R0(r))}static fromMillis(e,t={}){if(uf(e))return e<-JF||e>JF?ri.invalid("Timestamp out of range"):new ri({ts:e,zone:Yd(t.zone,As.defaultZone),loc:br.fromObject(t)});throw new jo(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(uf(e))return new ri({ts:e*1e3,zone:Yd(t.zone,As.defaultZone),loc:br.fromObject(t)});throw new jo("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const i=Yd(t.zone,As.defaultZone);if(!i.isValid)return ri.invalid(R0(i));const r=br.fromObject(t),o=wC(e,e5),{minDaysInFirstWeek:s,startOfWeek:l}=BF(o,r),u=As.now(),h=si(t.specificOffset)?i.offset(u):t.specificOffset,d=!si(o.ordinal),m=!si(o.year),y=!si(o.month)||!si(o.day),x=m||y,C=o.weekYear||o.weekNumber;if((x||d)&&C)throw new zm("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(y&&d)throw new zm("Can't mix ordinal dates with month/day");const w=C||o.weekday&&!x;let S,T,M=mx(u,h);w?(S=Pne,T=kne,M=IC(M,s,l)):d?(S=Gne,T=Lne,M=sS(M)):(S=pI,T=ZV);let G=!1;for(const ce of S){const pe=o[ce];si(pe)?G?o[ce]=T[ce]:o[ce]=M[ce]:G=!0}const N=w?cte(o,s,l):d?hte(o):fV(o),V=N||pV(o);if(V)return ri.invalid(V);const W=w?DF(o,s,l):d?VF(o):o,[j,J]=fI(W,h,i),te=new ri({ts:j,zone:i,o:J,loc:r});return o.weekday&&x&&e.weekday!==te.weekday?ri.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${te.toISO()}`):te.isValid?te:ri.invalid(te.invalid)}static fromISO(e,t={}){const[i,r]=nne(e);return vm(i,r,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[i,r]=ine(e);return vm(i,r,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[i,r]=rne(e);return vm(i,r,t,"HTTP",t)}static fromFormat(e,t,i={}){if(si(e)||si(t))throw new jo("fromFormat requires an input string and a format");const{locale:r=null,numberingSystem:o=null}=i,s=br.fromOpts({locale:r,numberingSystem:o,defaultToEN:!0}),[l,u,h,d]=Mne(s,e,t);return d?ri.invalid(d):vm(l,u,i,`format ${t}`,e,h)}static fromString(e,t,i={}){return ri.fromFormat(e,t,i)}static fromSQL(e,t={}){const[i,r]=hne(e);return vm(i,r,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new jo("need to specify a reason the DateTime is invalid");const i=e instanceof Cu?e:new Cu(e,t);if(As.throwOnInvalid)throw new Dee(i);return new ri({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const i=VV(e,br.fromObject(t));return i?i.map(r=>r?r.val:null).join(""):null}static expandFormat(e,t={}){return OV(ea.parseFormat(e),br.fromObject(t)).map(r=>r.val).join("")}static resetCache(){M0=void 0,dT.clear()}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?lS(this).weekYear:NaN}get weekNumber(){return this.isValid?lS(this).weekNumber:NaN}get weekday(){return this.isValid?lS(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?uS(this).weekday:NaN}get localWeekNumber(){return this.isValid?uS(this).weekNumber:NaN}get localWeekYear(){return this.isValid?uS(this).weekYear:NaN}get ordinal(){return this.isValid?sS(this.c).ordinal:NaN}get monthShort(){return this.isValid?px.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?px.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?px.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?px.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,i=jw(this.c),r=this.zone.offset(i-e),o=this.zone.offset(i+e),s=this.zone.offset(i-r*t),l=this.zone.offset(i-o*t);if(s===l)return[this];const u=i-s*t,h=i-l*t,d=mx(u,s),m=mx(h,l);return d.hour===m.hour&&d.minute===m.minute&&d.second===m.second&&d.millisecond===m.millisecond?[pp(this,{ts:u}),pp(this,{ts:h})]:[this]}get isInLeapYear(){return wb(this.year)}get daysInMonth(){return CC(this.year,this.month)}get daysInYear(){return this.isValid?oy(this.year):NaN}get weeksInWeekYear(){return this.isValid?Wv(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?Wv(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:i,calendar:r}=ea.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:i,outputCalendar:r}}toUTC(e=0,t={}){return this.setZone(Ia.instance(e),t)}toLocal(){return this.setZone(As.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:i=!1}={}){if(e=Yd(e,As.defaultZone),e.equals(this.zone))return this;if(e.isValid){let r=this.ts;if(t||i){const o=e.offset(this.ts),s=this.toObject();[r]=fI(s,o,e)}return pp(this,{ts:r,zone:e})}else return ri.invalid(R0(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:i}={}){const r=this.loc.clone({locale:e,numberingSystem:t,outputCalendar:i});return pp(this,{loc:r})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=wC(e,e5),{minDaysInFirstWeek:i,startOfWeek:r}=BF(t,this.loc),o=!si(t.weekYear)||!si(t.weekNumber)||!si(t.weekday),s=!si(t.ordinal),l=!si(t.year),u=!si(t.month)||!si(t.day),h=l||u,d=t.weekYear||t.weekNumber;if((h||s)&&d)throw new zm("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(u&&s)throw new zm("Can't mix ordinal dates with month/day");let m;o?m=DF({...IC(this.c,i,r),...t},i,r):si(t.ordinal)?(m={...this.toObject(),...t},si(t.day)&&(m.day=Math.min(CC(m.year,m.month),m.day))):m=VF({...sS(this.c),...t});const[y,x]=fI(m,this.o,this.zone);return pp(this,{ts:y,o:x})}plus(e){if(!this.isValid)return this;const t=tr.fromDurationLike(e);return pp(this,qF(this,t))}minus(e){if(!this.isValid)return this;const t=tr.fromDurationLike(e).negate();return pp(this,qF(this,t))}startOf(e,{useLocaleWeeks:t=!1}={}){if(!this.isValid)return this;const i={},r=tr.normalizeUnit(e);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks")if(t){const o=this.loc.getStartOfWeek(),{weekday:s}=this;s<o&&(i.weekNumber=this.weekNumber-1),i.weekday=o}else i.weekday=1;if(r==="quarters"){const o=Math.ceil(this.month/3);i.month=(o-1)*3+1}return this.set(i)}endOf(e,t){return this.isValid?this.plus({[e]:1}).startOf(e,t).minus(1):this}toFormat(e,t={}){return this.isValid?ea.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):aS}toLocaleString(e=xC,t={}){return this.isValid?ea.create(this.loc.clone(t),e).formatDateTime(this):aS}toLocaleParts(e={}){return this.isValid?ea.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:i=!1,includeOffset:r=!0,extendedZone:o=!1,precision:s="milliseconds"}={}){if(!this.isValid)return null;s=gI(s);const l=e==="extended";let u=cS(this,l,s);return pI.indexOf(s)>=3&&(u+="T"),u+=QF(this,l,t,i,r,o,s),u}toISODate({format:e="extended",precision:t="day"}={}){return this.isValid?cS(this,e==="extended",gI(t)):null}toISOWeekDate(){return yx(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:i=!0,includePrefix:r=!1,extendedZone:o=!1,format:s="extended",precision:l="milliseconds"}={}){return this.isValid?(l=gI(l),(r&&pI.indexOf(l)>=3?"T":"")+QF(this,s==="extended",t,e,i,o,l)):null}toRFC2822(){return yx(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return yx(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?cS(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:i=!0}={}){let r="HH:mm:ss.SSS";return(t||e)&&(i&&(r+=" "),t?r+="z":e&&(r+="ZZ")),yx(this,r,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():aS}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",i={}){if(!this.isValid||!e.isValid)return tr.invalid("created by diffing an invalid DateTime");const r={locale:this.locale,numberingSystem:this.numberingSystem,...i},o=pte(t).map(tr.normalizeUnit),s=e.valueOf()>this.valueOf(),l=s?this:e,u=s?e:this,h=yne(l,u,o,r);return s?h.negate():h}diffNow(e="milliseconds",t={}){return this.diff(ri.now(),e,t)}until(e){return this.isValid?Cs.fromDateTimes(this,e):this}hasSame(e,t,i){if(!this.isValid)return!1;const r=e.valueOf(),o=this.setZone(e.zone,{keepLocalTime:!0});return o.startOf(t,i)<=r&&r<=o.endOf(t,i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||ri.fromObject({},{zone:this.zone}),i=e.padding?this<t?-e.padding:e.padding:0;let r=["years","months","days","hours","minutes","seconds"],o=e.unit;return Array.isArray(e.unit)&&(r=e.unit,o=void 0),n5(t,this.plus(i),{...e,numeric:"always",units:r,unit:o})}toRelativeCalendar(e={}){return this.isValid?n5(e.base||ri.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(ri.isDateTime))throw new jo("min requires all arguments be DateTimes");return ZF(e,t=>t.valueOf(),Math.min)}static max(...e){if(!e.every(ri.isDateTime))throw new jo("max requires all arguments be DateTimes");return ZF(e,t=>t.valueOf(),Math.max)}static fromFormatExplain(e,t,i={}){const{locale:r=null,numberingSystem:o=null}=i,s=br.fromOpts({locale:r,numberingSystem:o,defaultToEN:!0});return DV(s,e,t)}static fromStringExplain(e,t,i={}){return ri.fromFormatExplain(e,t,i)}static buildFormatParser(e,t={}){const{locale:i=null,numberingSystem:r=null}=t,o=br.fromOpts({locale:i,numberingSystem:r,defaultToEN:!0});return new NV(o,e)}static fromFormatParser(e,t,i={}){if(si(e)||si(t))throw new jo("fromFormatParser requires an input string and a format parser");const{locale:r=null,numberingSystem:o=null}=i,s=br.fromOpts({locale:r,numberingSystem:o,defaultToEN:!0});if(!s.equals(t.locale))throw new jo(`fromFormatParser called with a locale of ${s}, but the format parser was created for ${t.locale}`);const{result:l,zone:u,specificOffset:h,invalidReason:d}=t.explainFromTokens(e);return d?ri.invalid(d):vm(l,u,i,`format ${t.format}`,e,h)}static get DATE_SHORT(){return xC}static get DATE_MED(){return W4}static get DATE_MED_WITH_WEEKDAY(){return Zee}static get DATE_FULL(){return z4}static get DATE_HUGE(){return U4}static get TIME_SIMPLE(){return X4}static get TIME_WITH_SECONDS(){return Y4}static get TIME_WITH_SHORT_OFFSET(){return H4}static get TIME_WITH_LONG_OFFSET(){return K4}static get TIME_24_SIMPLE(){return j4}static get TIME_24_WITH_SECONDS(){return $4}static get TIME_24_WITH_SHORT_OFFSET(){return J4}static get TIME_24_WITH_LONG_OFFSET(){return q4}static get DATETIME_SHORT(){return Q4}static get DATETIME_SHORT_WITH_SECONDS(){return eV}static get DATETIME_MED(){return tV}static get DATETIME_MED_WITH_SECONDS(){return nV}static get DATETIME_MED_WITH_WEEKDAY(){return Wee}static get DATETIME_FULL(){return iV}static get DATETIME_FULL_WITH_SECONDS(){return rV}static get DATETIME_HUGE(){return sV}static get DATETIME_HUGE_WITH_SECONDS(){return oV}}function u0(n){if(ri.isDateTime(n))return n;if(n&&n.valueOf&&uf(n.valueOf()))return ri.fromJSDate(n);if(n&&typeof n=="object")return ri.fromObject(n);throw new jo(`Unknown datetime argument: ${n}, of type ${typeof n}`)}const WV=[0,1,0,0];function r5(n,e="second",t,i){const{t:r}=Ct(),o=new Date(n).toISOString(),s={year:r("yyyy"),month:r("M/yyyy"),day:r("M/d/yyyy"),second:r("M/d/yyyy HH:mm:ss")},u=(t?{year:"yyyy",month:"yyyy-MM",day:"yyyy-MM-dd",second:void 0}:s)[e];return u?ri.fromISO(o).toFormat(`${i?"UTC:":""}${u}`):o.replace(/\.\d{3}/,"")}function fT(n){return new Date(n).toISOString().split(".")[0]+"Z"}function hS(n){return ri.fromISO(n).toFormat("yyyy-MM-dd")}function One(n,e){return n<=e.minValue?e.minValue:n>=e.maxValue?e.maxValue:e.timeValueList?Nne(n,e):Dne(n,e)}function Nne(n,e){const t=e.timeValueList??[];let i,r=0,o=t.length-1;for(;o-r>1;)i=Math.floor((r+o)/2),t[i]>=n?o=i:r=i;const s=Math.abs(t[r]-n),l=Math.abs(t[o]-n);return t[s<l?r:o]}function Dne(n,e){const t=e.timeInterval??WV,i=new Date(n).getTime(),r=new Date(e.minValue),o=e.maxValue;let s=e.minValue,l=Math.abs(i-s);for(let u=1;;u++){const h=new Date(r.getTime());if(h.setFullYear(r.getFullYear()+u*t[0]),h.setMonth(r.getMonth()+u*t[1],r.getDate()+u*t[2]),h.setSeconds(r.getSeconds()+u*t[3]),h.getTime()>o)break;const d=Math.abs(i-h.getTime());if(d<=l)s=h.getTime(),l=d;else break}return s}const Wi=Sa("map",()=>{const n=sa(),e=Ke({}),t=Ei([]),i=Ei([]),r=Ke(!1),o=Ke(!1),s=Ke(void 0),l=Ke(void 0),u=Ke(void 0),h=Ke(void 0),d=Ke(void 0),m=Ke(void 0),y=Ke(void 0);function x(J){s.value=J}function C(...J){t.value=[...new Set([...t.value,...J])]}function w(...J){i.value=[...new Set([...i.value,...J])]}function S(...J){t.value=t.value.filter(te=>J.indexOf(te.id)===-1),i.value=i.value.filter(te=>J.indexOf(te.id)===-1)}function T(){t.value=[]}function M(J){return!!t.value?.find(te=>te.id===J)}function G(J,te=!1){const ce=te?i:t;ce.value=[...ce.value?.sort((pe,Y)=>J.indexOf(pe.id)-J.indexOf(Y.id))||[]]}function N(J,te){t.value=t.value.map(ce=>ce.id===J?{...ce,opacity:te,previousOpacity:ce.opacity}:ce)}function V(J,te,ce){t.value=t.value.map(pe=>{if(pe.id===J){const Y={...pe,currentTimeMinValue:te?fT(te):void 0,currentTimeMaxValue:ce?fT(ce):void 0};return Y.type==="WMTS"&&(Y.name=n.getLayerCurrentLabel(Y)),Y}return pe})}function W(J){r.value=J}function j(J){o.value=J}return{map:e,layers:t,layers3d:i,is3dActive:r,is3dMesh:o,bgLayer:s,minZoom:l,maxZoom:u,x:h,y:d,zoom:m,rotation:y,addLayers:C,add3dLayers:w,removeLayers:S,removeAllLayers:T,reorderLayers:G,setLayerOpacity:N,setLayerTime:V,setBgLayer:x,setIs3dActive:W,setIs3dMesh:j,hasLayer:M}});function Sl(){function n(d,m){return t(d,void 0,m)}function e(d,m){return t(void 0,d,m)}function t(d,m,y){const{themes:x}=Vr();if(y=y||x?.find(C=>t(d,m,C)),d&&y?.id===+d||m&&y?.name===m)return y;if(y?.children)for(const C of y.children){const w=t(d,m,C);if(w)return w}}function i(d){const{themes:m}=Vr(),y=[];function x(C,w){C.id===+d&&y.push(w),C.children&&C.children.forEach(S=>x(S,w))}return m&&Array.isArray(m)&&m.forEach(C=>{C?.metadata?.display_in_switcher&&x(C,C.name)}),[...new Set(y)]}function r(d){const{layerTrees_3d:m}=Vr();return t(d,void 0,m)}function o(d){const{bgLayers:m}=Vr();return m.find(y=>y.id===d)}function s(d){const{bgLayers:m}=Vr();return m.find(y=>y.name===d)}function l(d){return o(+d)||n(+d)||r(+d)}function u(d){const{setTheme:m}=Vr();m(d),h(d)}function h(d){const{maxZoom:m}=xt(Wi()),y=e(d),{resolutions:x}=y?.metadata||{};m.value=x?x.length+7:h4}return{findById:n,findByName:e,find3dLayerById:r,findBgLayerById:o,findBgLayerByName:s,findAnyLayerById:l,setTheme:u,findThemeNamesByLayerId:i}}var Tc=(n=>(n.WMS="WMS",n.WMTS="WMTS",n))(Tc||{});let Vne=0;function Bne(){return Vne++}var DM=Object.defineProperty,Zne=Object.getOwnPropertyDescriptor,Wne=Object.getOwnPropertyNames,zne=Object.prototype.hasOwnProperty,Une=(n,e)=>{for(var t in e)DM(n,t,{get:e[t],enumerable:!0})},Xne=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Wne(e))!zne.call(n,r)&&r!==t&&DM(n,r,{get:()=>e[r],enumerable:!(i=Zne(e,r))||i.enumerable});return n},Yne=n=>Xne(DM({},"__esModule",{value:!0}),n),zV={};Une(zV,{XmlCdata:()=>HV,XmlComment:()=>KV,XmlDeclaration:()=>jV,XmlDocument:()=>$V,XmlDocumentType:()=>JV,XmlElement:()=>qw,XmlError:()=>qV,XmlNode:()=>sr,XmlProcessingInstruction:()=>pT,XmlText:()=>BM,parseXml:()=>iie});Yne(zV);var gp="",Hne=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Kne=class{constructor(n){if(this.k=this.q(n,!0),this.d=0,this.length=n.length,this.n=this.k!==this.length,this.m=n,this.n){let e=[];for(let t=0,i=0;i<this.k;++i)e[i]=t,t+=n.codePointAt(t)>65535?2:1;this.y=e}}get z(){return this.d>=this.k}q(n,e=this.n){return e?n.replace(Hne,"_").length:n.length}g(n=1){this.d=Math.min(this.k,this.d+n)}i(n=this.d){var e;return this.n?(e=this.y[n])!=null?e:1/0:n}F(n=1){let e=this.h(n);return this.g(n),e}G(n){if(!n.sticky)throw new Error('`regex` must have a sticky flag ("y")');n.lastIndex=this.i();let e=n.exec(this.m);if(e===null||e.length===0)return gp;let t=e[0];return this.g(this.q(t)),t}v(n){let e,t=gp;for(;(e=this.h())&&n(e);)t+=e,this.g();return t}Q(n){if(this.b(n))return n;if(this.n){let{length:e}=n,t=this.q(n);if(t!==e&&n===this.h(t))return this.g(t),n}return gp}b(n){let{length:e}=n;return this.h(e)===n?(this.g(e),n):gp}A(n){let e=this.m.slice(this.i()),t=e.search(n);if(t<=0)return gp;let i=e.slice(0,t);return this.g(this.q(i)),i}t(n){let{m:e}=this,t=this.i(),i=e.indexOf(n,t);if(i<=0)return gp;let r=e.slice(t,i);return this.g(this.q(r)),r}h(n=1){let{d:e,n:t,m:i}=this;return t?e>=this.k?gp:i.slice(this.i(e),this.i(e+n)):i.slice(e,e+n)}o(n=0){this.d=n>=0?Math.min(this.k,n):Math.max(0,this.d+n)}},jne=/[^"&<]+/y,$ne=/[^'&<]+/y,Jne=/\r\n|[\n\r\t]/g,qne=/<|&|]]>/,Qne=Object.freeze(Object.assign(Object.create(null),{amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}));function UV(n){let e=VM(n);return e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57||e===45||e===46||e===183||e>=768&&e<=879||e>=8255&&e<=8256||XV(n,e)}function XV(n,e=VM(n)){return e>=97&&e<=122||e>=65&&e<=90||e===58||e===95||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039}function eie(n){return n==="#"||UV(n)}function tie(n){let e=VM(n);return e===32||e===9||e===10||e===13}function s5(n){return n===9||n===10||n===13||n>=32&&n<=55295||n>=57344&&n<=65533||n>=65536&&n<=1114111}function VM(n){return n.codePointAt(0)||-1}var YV=class{constructor(){this.parent=null,this.start=-1,this.end=-1}get document(){var n,e;return(e=(n=this.parent)==null?void 0:n.document)!=null?e:null}get isRootNode(){return this.parent!==null&&this.parent===this.document&&this.type===YV.TYPE_ELEMENT}get preserveWhitespace(){var n;return!!((n=this.parent)!=null&&n.preserveWhitespace)}get type(){return""}toJSON(){let n={type:this.type};return this.isRootNode&&(n.isRootNode=!0),this.preserveWhitespace&&(n.preserveWhitespace=!0),this.start!==-1&&(n.start=this.start,n.end=this.end),n}},sr=YV;sr.TYPE_CDATA="cdata";sr.TYPE_COMMENT="comment";sr.TYPE_DOCUMENT="document";sr.TYPE_DOCUMENT_TYPE="doctype";sr.TYPE_ELEMENT="element";sr.TYPE_PROCESSING_INSTRUCTION="pi";sr.TYPE_TEXT="text";sr.TYPE_XML_DECLARATION="xmldecl";var BM=class extends sr{constructor(n=""){super(),this.text=n}get type(){return sr.TYPE_TEXT}toJSON(){return Object.assign(sr.prototype.toJSON.call(this),{text:this.text})}},HV=class extends BM{get type(){return sr.TYPE_CDATA}},KV=class extends sr{constructor(n=""){super(),this.content=n}get type(){return sr.TYPE_COMMENT}toJSON(){return Object.assign(sr.prototype.toJSON.call(this),{content:this.content})}},jV=class extends sr{constructor(n,e,t){super(),this.version=n,this.encoding=e??null,this.standalone=t??null}get type(){return sr.TYPE_XML_DECLARATION}toJSON(){let n=sr.prototype.toJSON.call(this);n.version=this.version;for(let e of["encoding","standalone"])this[e]!==null&&(n[e]=this[e]);return n}},qw=class extends sr{constructor(n,e=Object.create(null),t=[]){super(),this.name=n,this.attributes=e,this.children=t}get isEmpty(){return this.children.length===0}get preserveWhitespace(){let n=this;for(;n instanceof qw;){if("xml:space"in n.attributes)return n.attributes["xml:space"]==="preserve";n=n.parent}return!1}get text(){return this.children.map(n=>"text"in n?n.text:"").join("")}get type(){return sr.TYPE_ELEMENT}toJSON(){return Object.assign(sr.prototype.toJSON.call(this),{name:this.name,attributes:this.attributes,children:this.children.map(n=>n.toJSON())})}},$V=class extends sr{constructor(n=[]){super(),this.children=n}get document(){return this}get root(){for(let n of this.children)if(n instanceof qw)return n;return null}get text(){return this.children.map(n=>"text"in n?n.text:"").join("")}get type(){return sr.TYPE_DOCUMENT}toJSON(){return Object.assign(sr.prototype.toJSON.call(this),{children:this.children.map(n=>n.toJSON())})}},JV=class extends sr{constructor(n,e,t,i){super(),this.name=n,this.publicId=e??null,this.systemId=t??null,this.internalSubset=i??null}get type(){return sr.TYPE_DOCUMENT_TYPE}toJSON(){let n=sr.prototype.toJSON.call(this);n.name=this.name;for(let e of["publicId","systemId","internalSubset"])this[e]!==null&&(n[e]=this[e]);return n}},qV=class extends Error{constructor(n,e,t){let i=1,r="",o=1;for(let u=0;u<e;++u){let h=t[u];h===`
`?(i=1,r="",o+=1):(i+=1,r+=h)}let s=t.indexOf(`
`,e);r+=s===-1?t.slice(e):t.slice(e,s);let l=0;r.length>50&&(i<40?r=r.slice(0,50):(l=i-20,r=r.slice(l,i+30))),super(`${n} (line ${o}, column ${i})
  ${r}
`+" ".repeat(i-l+1)+`^
`),this.column=i,this.excerpt=r,this.line=o,this.name="XmlError",this.pos=e}},pT=class extends sr{constructor(n,e=""){super(),this.name=n,this.content=e}get type(){return sr.TYPE_PROCESSING_INSTRUCTION}toJSON(){return Object.assign(sr.prototype.toJSON.call(this),{name:this.name,content:this.content})}},dS="",nie=class{constructor(n,e={}){let t=this.document=new $V,i=this.c=new Kne(n);if(this.l=t,this.f=e,this.f.includeOffsets&&(t.start=0,t.end=n.length),i.b("\uFEFF"),this.H(),!this.B())throw this.a("Root element is missing or invalid");for(;this.w(););if(!i.z)throw this.a("Extra content at the end of the document")}j(n,e){return n.parent=this.l,this.f.includeOffsets&&(n.start=this.c.i(e),n.end=this.c.i()),this.l.children.push(n),!0}x(n,e){let{children:t}=this.l,{length:i}=t;if(n=_x(n),i>0){let r=t[i-1];if(r?.type===sr.TYPE_TEXT){let o=r;return o.text+=n,this.f.includeOffsets&&(o.end=this.c.i()),!0}}return this.j(new BM(n),e)}I(){let n=Object.create(null);for(;this.e();){let e=this.r();if(!e)break;let t=this.u()&&this.J();if(t===!1)throw this.a("Attribute value expected");if(e in n)throw this.a(`Duplicate attribute: ${e}`);if(e==="xml:space"&&t!=="default"&&t!=="preserve")throw this.a('Value of the `xml:space` attribute must be "default" or "preserve"');n[e]=t}if(this.f.sortAttributes){let e=Object.keys(n).sort(),t=Object.create(null);for(let i=0;i<e.length;++i){let r=e[i];t[r]=n[r]}n=t}return n}J(){let{c:n}=this,e=n.h();if(e!=='"'&&e!=="'")return!1;n.g();let t,i=!1,r=dS,o=e==='"'?jne:$ne;e:for(;!n.z;)switch(t=n.G(o),t&&(this.p(t),r+=t.replace(Jne," ")),n.h()){case e:i=!0;break e;case"&":r+=this.C();continue;case"<":throw this.a("Unescaped `<` is not allowed in an attribute value");case dS:break e}if(!i)throw this.a("Unclosed attribute");return n.g(),r}K(){let{c:n}=this,e=n.d;if(!n.b("<![CDATA["))return!1;let t=n.t("]]>");if(this.p(t),!n.b("]]>"))throw this.a("Unclosed CDATA section");return this.f.preserveCdata?this.j(new HV(_x(t)),e):this.x(t,e)}L(){let{c:n}=this,e=n.d,t=n.A(qne);if(!t)return!1;if(this.p(t),n.h(3)==="]]>")throw this.a("Element content may not contain the CDATA section close delimiter `]]>`");return this.x(t,e)}D(){let{c:n}=this,e=n.d;if(!n.b("<!--"))return!1;let t=n.t("--");if(this.p(t),!n.b("-->"))throw n.h(2)==="--"?this.a("The string `--` isn't allowed inside a comment"):this.a("Unclosed comment");return this.f.preserveComments?this.j(new KV(_x(t)),e):!0}M(){let n=this.c.d,e=this.C();return e?this.x(e,n):!1}N(){let{c:n}=this,e=n.d;if(!n.b("<!DOCTYPE"))return!1;let t=this.e()&&this.r();if(!t)throw this.a("Expected a name");let i,r;if(this.e()){if(n.b("PUBLIC")){if(i=this.e()&&this.O(),i===!1)throw this.a("Expected a public identifier");this.e()}if(i!==void 0||n.b("SYSTEM")){if(this.e(),r=this.s(),r===!1)throw this.a("Expected a system identifier");this.e()}}let o;if(n.b("[")){if(o=n.A(/\][\x20\t\r\n]*>/),!n.b("]"))throw this.a("Unclosed internal subset");this.e()}if(!n.b(">"))throw this.a("Unclosed doctype declaration");return this.f.preserveDocumentType?this.j(new JV(t,i,r,o),e):!0}B(){let{c:n}=this,e=n.d;if(!n.b("<"))return!1;let t=this.r();if(!t)return n.o(e),!1;let i=this.I(),r=!!n.b("/>"),o=new qw(t,i);if(o.parent=this.l,!r){if(!n.b(">"))throw this.a(`Unclosed start tag for element \`${t}\``);this.l=o;do this.L();while(this.B()||this.M()||this.K()||this.E()||this.D());let s=n.d,l;if(!n.b("</")||!(l=this.r())||l!==t)throw n.o(s),this.a(`Missing end tag for element ${t}`);if(this.e(),!n.b(">"))throw this.a(`Unclosed end tag for element ${t}`);this.l=o.parent}return this.j(o,e)}u(){return this.e(),this.c.b("=")?(this.e(),!0):!1}w(){return this.D()||this.E()||this.e()}r(){return XV(this.c.h())?this.c.v(UV):dS}E(){let{c:n}=this,e=n.d;if(!n.b("<?"))return!1;let t=this.r();if(t){if(t.toLowerCase()==="xml")throw n.o(e),this.a("XML declaration isn't allowed here")}else throw this.a("Invalid processing instruction");if(!this.e()){if(n.b("?>"))return this.j(new pT(t),e);throw this.a("Whitespace is required after a processing instruction name")}let i=n.t("?>");if(this.p(i),!n.b("?>"))throw this.a("Unterminated processing instruction");return this.j(new pT(t,_x(i)),e)}H(){let{c:n}=this,e=n.d;for(this.P();this.w(););if(this.N())for(;this.w(););return e<n.d}O(){let n=this.c.d,e=this.s();if(e!==!1&&!/^[-\x20\r\na-zA-Z0-9'()+,./:=?;!*#@$_%]*$/.test(e))throw this.c.o(n),this.a("Invalid character in public identifier");return e}C(){let{c:n}=this;if(!n.b("&"))return!1;let e=n.v(eie);if(n.F()!==";")throw this.a("Unterminated reference (a reference must end with `;`)");let t;if(e[0]==="#"){let i=e[1]==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10);if(isNaN(i))throw this.a("Invalid character reference");if(!s5(i))throw this.a("Character reference resolves to an invalid character");t=String.fromCodePoint(i)}else if(t=Qne[e],t===void 0){let{ignoreUndefinedEntities:i,resolveUndefinedEntity:r}=this.f,o=`&${e};`;if(r){let s=r(o);if(s!=null){let l=typeof s;if(l!=="string")throw new TypeError(`\`resolveUndefinedEntity()\` must return a string, \`null\`, or \`undefined\`, but returned a value of type ${l}`);return s}}if(i)return o;throw n.o(-o.length),this.a(`Named entity isn't defined: ${o}`)}return t}s(){let{c:n}=this,e=n.b('"')||n.b("'");if(!e)return!1;let t=n.t(e);if(this.p(t),!n.b(e))throw this.a("Missing end quote");return t}e(){return!!this.c.v(tie)}P(){let{c:n}=this,e=n.d;if(!n.b("<?xml"))return!1;if(!this.e())throw this.a("Invalid XML declaration");let t=!!n.b("version")&&this.u()&&this.s();if(t===!1)throw this.a("XML version is missing or invalid");if(!/^1\.[0-9]+$/.test(t))throw this.a("Invalid character in version number");let i,r;if(this.e()&&(i=!!n.b("encoding")&&this.u()&&this.s(),i&&this.e(),r=!!n.b("standalone")&&this.u()&&this.s(),r)){if(r!=="yes"&&r!=="no")throw this.a('Only "yes" and "no" are permitted as values of `standalone`');this.e()}if(!n.b("?>"))throw this.a("Invalid or unclosed XML declaration");return this.f.preserveXmlDeclaration?this.j(new jV(t,i||void 0,r||void 0),e):!0}a(n){let{c:e}=this;return new qV(n,e.d,e.m)}p(n){let{length:e}=n;for(let t=0;t<e;++t){let i=n.codePointAt(t);if(!s5(i))throw this.c.o(-([...n].length-t)),this.a("Invalid character");i>65535&&(t+=1)}}};function _x(n){let e=0;for(;(e=n.indexOf("\r",e))!==-1;)n=n[e+1]===`
`?n.slice(0,e)+n.slice(e+1):n.slice(0,e)+`
`+n.slice(e+1);return n}function iie(n,e){return new nie(n,e).document}let rie=class extends Error{constructor(e,t,i){super(e),this.httpStatus=t,this.isCrossOriginRelated=i,this.name="EndpointError"}},sie=class extends Error{constructor(e,t,i,r,o){super(e),this.requestUrl=t,this.code=i,this.locator=r,this.response=o,this.name="ServiceExceptionError"}};function oie(n){if(n.name==="ServiceExceptionError"){const t=new sie(n.message,n.requestUrl,n.code,n.locator,n.response);return t.stack=n.stack,t}if(n.name==="EndpointError"){const t=new rie(n.message,n.httpStatus,n.isCrossOriginRelated);return t.stack=n.stack,t}const e=new Error(n.message);return e.stack=n.stack,e}const fS=new EventTarget;function aie(n,e,t){return new Promise((i,r)=>{const o=Bne(),s={requestId:o,taskName:n,params:t};e===null?fS.dispatchEvent(new CustomEvent("ogc-client.request",{detail:s})):e.postMessage(s);const l=d=>{d.requestId===o&&(e===null?fS.removeEventListener("ogc-client.response",u):e.removeEventListener("message",h),"error"in d?r(oie(d.error)):i(d.response))},u=d=>l(d.detail),h=d=>l(d.data);e===null?fS.addEventListener("ogc-client.response",u):e.addEventListener("message",h)})}const QV="KGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICAvKiEgQHJncm92ZS9wYXJzZS14bWwgdjQuMS4wIHwgSVNDIExpY2Vuc2UgfCBDb3B5cmlnaHQgUnlhbiBHcm92ZSAqLwogIHZhciBfX2RlZlByb3AgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7CiAgdmFyIF9fZ2V0T3duUHJvcERlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwogIHZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwogIHZhciBfX2hhc093blByb3AgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwogIHZhciBfX2V4cG9ydCA9ICh0YXJnZXQsIGFsbCkgPT4gewogICAgZm9yICh2YXIgbmFtZSBpbiBhbGwpCiAgICAgIF9fZGVmUHJvcCh0YXJnZXQsIG5hbWUsIHsgZ2V0OiBhbGxbbmFtZV0sIGVudW1lcmFibGU6IHRydWUgfSk7CiAgfTsKICB2YXIgX19jb3B5UHJvcHMgPSAodG8sIGZyb20sIGV4Y2VwdCwgZGVzYykgPT4gewogICAgaWYgKGZyb20gJiYgdHlwZW9mIGZyb20gPT09ICJvYmplY3QiIHx8IHR5cGVvZiBmcm9tID09PSAiZnVuY3Rpb24iKSB7CiAgICAgIGZvciAobGV0IGtleSBvZiBfX2dldE93blByb3BOYW1lcyhmcm9tKSkKICAgICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KQogICAgICAgICAgX19kZWZQcm9wKHRvLCBrZXksIHsgZ2V0OiAoKSA9PiBmcm9tW2tleV0sIGVudW1lcmFibGU6ICEoZGVzYyA9IF9fZ2V0T3duUHJvcERlc2MoZnJvbSwga2V5KSkgfHwgZGVzYy5lbnVtZXJhYmxlIH0pOwogICAgfQogICAgcmV0dXJuIHRvOwogIH07CiAgdmFyIF9fdG9Db21tb25KUyA9IChtb2QpID0+IF9fY29weVByb3BzKF9fZGVmUHJvcCh7fSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pLCBtb2QpOwogIHZhciBzcmNfZXhwb3J0cyA9IHt9OwogIF9fZXhwb3J0KHNyY19leHBvcnRzLCB7CiAgICBYbWxDZGF0YTogKCkgPT4gWG1sQ2RhdGEsCiAgICBYbWxDb21tZW50OiAoKSA9PiBYbWxDb21tZW50LAogICAgWG1sRGVjbGFyYXRpb246ICgpID0+IFhtbERlY2xhcmF0aW9uLAogICAgWG1sRG9jdW1lbnQ6ICgpID0+IFhtbERvY3VtZW50LAogICAgWG1sRG9jdW1lbnRUeXBlOiAoKSA9PiBYbWxEb2N1bWVudFR5cGUsCiAgICBYbWxFbGVtZW50OiAoKSA9PiBYbWxFbGVtZW50LAogICAgWG1sRXJyb3I6ICgpID0+IFhtbEVycm9yLAogICAgWG1sTm9kZTogKCkgPT4gWG1sTm9kZSwKICAgIFhtbFByb2Nlc3NpbmdJbnN0cnVjdGlvbjogKCkgPT4gWG1sUHJvY2Vzc2luZ0luc3RydWN0aW9uLAogICAgWG1sVGV4dDogKCkgPT4gWG1sVGV4dCwKICAgIHBhcnNlWG1sOiAoKSA9PiBwYXJzZVhtbAogIH0pOwogIHZhciBicm93c2VyID0gX190b0NvbW1vbkpTKHNyY19leHBvcnRzKTsKICB2YXIgZW1wdHlTdHJpbmcgPSAiIjsKICB2YXIgc3Vycm9nYXRlUGFpciA9IC9bXHVEODAwLVx1REJGRl1bXHVEQzAwLVx1REZGRl0vZzsKICB2YXIgU3RyaW5nU2Nhbm5lciA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKHN0cmluZykgewogICAgICB0aGlzLmsgPSB0aGlzLnEoc3RyaW5nLCB0cnVlKTsKICAgICAgdGhpcy5kID0gMDsKICAgICAgdGhpcy5sZW5ndGggPSBzdHJpbmcubGVuZ3RoOwogICAgICB0aGlzLm4gPSB0aGlzLmsgIT09IHRoaXMubGVuZ3RoOwogICAgICB0aGlzLm0gPSBzdHJpbmc7CiAgICAgIGlmICh0aGlzLm4pIHsKICAgICAgICBsZXQgY2hhcnNUb0J5dGVzID0gW107CiAgICAgICAgZm9yIChsZXQgYnl0ZUluZGV4ID0gMCwgY2hhckluZGV4ID0gMDsgY2hhckluZGV4IDwgdGhpcy5rOyArK2NoYXJJbmRleCkgewogICAgICAgICAgY2hhcnNUb0J5dGVzW2NoYXJJbmRleF0gPSBieXRlSW5kZXg7CiAgICAgICAgICBieXRlSW5kZXggKz0gc3RyaW5nLmNvZGVQb2ludEF0KGJ5dGVJbmRleCkgPiA2NTUzNSA/IDIgOiAxOwogICAgICAgIH0KICAgICAgICB0aGlzLnkgPSBjaGFyc1RvQnl0ZXM7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogV2hldGhlciB0aGUgY3VycmVudCBjaGFyYWN0ZXIgaW5kZXggaXMgYXQgdGhlIGVuZCBvZiB0aGUgaW5wdXQgc3RyaW5nLgogICAgICovCiAgICBnZXQgeigpIHsKICAgICAgcmV0dXJuIHRoaXMuZCA+PSB0aGlzLms7CiAgICB9CiAgICAvLyAtLSBQcm90ZWN0ZWQgTWV0aG9kcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIGNoYXJhY3RlcnMgaW4gdGhlIGdpdmVuIHN0cmluZywgd2hpY2ggbWF5IGRpZmZlciBmcm9tCiAgICAgKiB0aGUgYnl0ZSBsZW5ndGggaWYgdGhlIHN0cmluZyBjb250YWlucyBtdWx0aWJ5dGUgY2hhcmFjdGVycy4KICAgICAqLwogICAgcShzdHJpbmcsIG11bHRpQnl0ZVNhZmUgPSB0aGlzLm4pIHsKICAgICAgcmV0dXJuIG11bHRpQnl0ZVNhZmUgPyBzdHJpbmcucmVwbGFjZShzdXJyb2dhdGVQYWlyLCAiXyIpLmxlbmd0aCA6IHN0cmluZy5sZW5ndGg7CiAgICB9CiAgICAvLyAtLSBQdWJsaWMgTWV0aG9kcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8qKgogICAgICogQWR2YW5jZXMgdGhlIHNjYW5uZXIgYnkgdGhlIGdpdmVuIG51bWJlciBvZiBjaGFyYWN0ZXJzLCBzdG9wcGluZyBpZiB0aGUgZW5kCiAgICAgKiBvZiB0aGUgc3RyaW5nIGlzIHJlYWNoZWQuCiAgICAgKi8KICAgIGcoY291bnQgPSAxKSB7CiAgICAgIHRoaXMuZCA9IE1hdGgubWluKHRoaXMuaywgdGhpcy5kICsgY291bnQpOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBieXRlIGluZGV4IG9mIHRoZSBnaXZlbiBjaGFyYWN0ZXIgaW5kZXggaW4gdGhlIHN0cmluZy4gVGhlIHR3bwogICAgICogbWF5IGRpZmZlciBpbiBzdHJpbmdzIHRoYXQgY29udGFpbiBtdWx0aWJ5dGUgY2hhcmFjdGVycy4KICAgICAqLwogICAgaShjaGFySW5kZXggPSB0aGlzLmQpIHsKICAgICAgdmFyIF9hOwogICAgICByZXR1cm4gdGhpcy5uID8gKF9hID0gdGhpcy55W2NoYXJJbmRleF0pICE9IG51bGwgPyBfYSA6IEluZmluaXR5IDogY2hhckluZGV4OwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBhbmQgcmV0dXJucyB0aGUgZ2l2ZW4gbnVtYmVyIG9mIGNoYXJhY3RlcnMgaWYgcG9zc2libGUsIGFkdmFuY2luZwogICAgICogdGhlIHNjYW5uZXIgYW5kIHN0b3BwaW5nIGlmIHRoZSBlbmQgb2YgdGhlIHN0cmluZyBpcyByZWFjaGVkLgogICAgICoKICAgICAqIElmIG5vIGNoYXJhY3RlcnMgY291bGQgYmUgY29uc3VtZWQsIGFuIGVtcHR5IHN0cmluZyB3aWxsIGJlIHJldHVybmVkLgogICAgICovCiAgICBGKGNvdW50ID0gMSkgewogICAgICBsZXQgY2hhcnMgPSB0aGlzLmgoY291bnQpOwogICAgICB0aGlzLmcoY291bnQpOwogICAgICByZXR1cm4gY2hhcnM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgbWF0Y2ggZm9yIHRoZSBnaXZlbiBzdGlja3kgcmVnZXgsIGFkdmFuY2VzIHRoZSBzY2FubmVyLCB1cGRhdGVzCiAgICAgKiB0aGUgYGxhc3RJbmRleGAgcHJvcGVydHkgb2YgdGhlIHJlZ2V4LCBhbmQgcmV0dXJucyB0aGUgbWF0Y2hpbmcgc3RyaW5nLgogICAgICoKICAgICAqIFRoZSByZWdleCBtdXN0IGhhdmUgYSBzdGlja3kgZmxhZyAoInkiKSBzbyB0aGF0IGl0cyBgbGFzdEluZGV4YCBwcm9wIGNhbiBiZQogICAgICogdXNlZCB0byBhbmNob3IgdGhlIG1hdGNoIGF0IHRoZSBjdXJyZW50IHNjYW5uZXIgcG9zaXRpb24uCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgY29uc3VtZWQgc3RyaW5nLCBvciBhbiBlbXB0eSBzdHJpbmcgaWYgbm90aGluZyB3YXMgY29uc3VtZWQuCiAgICAgKi8KICAgIEcocmVnZXgpIHsKICAgICAgaWYgKCFyZWdleC5zdGlja3kpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ByZWdleGAgbXVzdCBoYXZlIGEgc3RpY2t5IGZsYWcgKCJ5IiknKTsKICAgICAgfQogICAgICByZWdleC5sYXN0SW5kZXggPSB0aGlzLmkoKTsKICAgICAgbGV0IHJlc3VsdCA9IHJlZ2V4LmV4ZWModGhpcy5tKTsKICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGVtcHR5U3RyaW5nOwogICAgICB9CiAgICAgIGxldCBtYXRjaCA9IHJlc3VsdFswXTsKICAgICAgdGhpcy5nKHRoaXMucShtYXRjaCkpOwogICAgICByZXR1cm4gbWF0Y2g7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGFuZCByZXR1cm5zIGFsbCBjaGFyYWN0ZXJzIGZvciB3aGljaCB0aGUgZ2l2ZW4gZnVuY3Rpb24gcmV0dXJucyBhCiAgICAgKiB0cnV0aHkgdmFsdWUsIHN0b3BwaW5nIG9uIHRoZSBmaXJzdCBmYWxzeSByZXR1cm4gdmFsdWUgb3IgaWYgdGhlIGVuZCBvZiB0aGUKICAgICAqIGlucHV0IGlzIHJlYWNoZWQuCiAgICAgKi8KICAgIHYoZm4pIHsKICAgICAgbGV0IGNoYXI7CiAgICAgIGxldCBtYXRjaCA9IGVtcHR5U3RyaW5nOwogICAgICB3aGlsZSAoKGNoYXIgPSB0aGlzLmgoKSkgJiYgZm4oY2hhcikpIHsKICAgICAgICBtYXRjaCArPSBjaGFyOwogICAgICAgIHRoaXMuZygpOwogICAgICB9CiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3VtZXMgdGhlIGdpdmVuIHN0cmluZyBpZiBpdCBleGlzdHMgYXQgdGhlIGN1cnJlbnQgY2hhcmFjdGVyIGluZGV4LCBhbmQKICAgICAqIGFkdmFuY2VzIHRoZSBzY2FubmVyLgogICAgICoKICAgICAqIElmIHRoZSBnaXZlbiBzdHJpbmcgZG9lc24ndCBleGlzdCBhdCB0aGUgY3VycmVudCBjaGFyYWN0ZXIgaW5kZXgsIGFuIGVtcHR5CiAgICAgKiBzdHJpbmcgd2lsbCBiZSByZXR1cm5lZCBhbmQgdGhlIHNjYW5uZXIgd2lsbCBub3QgYmUgYWR2YW5jZWQuCiAgICAgKi8KICAgIFEoc3RyaW5nVG9Db25zdW1lKSB7CiAgICAgIGlmICh0aGlzLmIoc3RyaW5nVG9Db25zdW1lKSkgewogICAgICAgIHJldHVybiBzdHJpbmdUb0NvbnN1bWU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMubikgewogICAgICAgIGxldCB7IGxlbmd0aCB9ID0gc3RyaW5nVG9Db25zdW1lOwogICAgICAgIGxldCBjaGFyTGVuZ3RoVG9NYXRjaCA9IHRoaXMucShzdHJpbmdUb0NvbnN1bWUpOwogICAgICAgIGlmIChjaGFyTGVuZ3RoVG9NYXRjaCAhPT0gbGVuZ3RoICYmIHN0cmluZ1RvQ29uc3VtZSA9PT0gdGhpcy5oKGNoYXJMZW5ndGhUb01hdGNoKSkgewogICAgICAgICAgdGhpcy5nKGNoYXJMZW5ndGhUb01hdGNoKTsKICAgICAgICAgIHJldHVybiBzdHJpbmdUb0NvbnN1bWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBlbXB0eVN0cmluZzsKICAgIH0KICAgIC8qKgogICAgICogRG9lcyB0aGUgc2FtZSB0aGluZyBhcyBgY29uc3VtZVN0cmluZygpYCwgYnV0IGRvZXNuJ3Qgc3VwcG9ydCBjb25zdW1pbmcKICAgICAqIG11bHRpYnl0ZSBjaGFyYWN0ZXJzLiBUaGlzIGNhbiBiZSBmYXN0ZXIgaWYgeW91IG9ubHkgbmVlZCB0byBtYXRjaCBzaW5nbGUKICAgICAqIGJ5dGUgY2hhcmFjdGVycy4KICAgICAqLwogICAgYihzdHJpbmdUb0NvbnN1bWUpIHsKICAgICAgbGV0IHsgbGVuZ3RoIH0gPSBzdHJpbmdUb0NvbnN1bWU7CiAgICAgIGlmICh0aGlzLmgobGVuZ3RoKSA9PT0gc3RyaW5nVG9Db25zdW1lKSB7CiAgICAgICAgdGhpcy5nKGxlbmd0aCk7CiAgICAgICAgcmV0dXJuIHN0cmluZ1RvQ29uc3VtZTsKICAgICAgfQogICAgICByZXR1cm4gZW1wdHlTdHJpbmc7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGNoYXJhY3RlcnMgdW50aWwgdGhlIGdpdmVuIGdsb2JhbCByZWdleCBpcyBtYXRjaGVkLCBhZHZhbmNpbmcgdGhlCiAgICAgKiBzY2FubmVyIHVwIHRvIChidXQgbm90IGJleW9uZCkgdGhlIGJlZ2lubmluZyBvZiB0aGUgbWF0Y2guIElmIHRoZSByZWdleAogICAgICogZG9lc24ndCBtYXRjaCwgbm90aGluZyB3aWxsIGJlIGNvbnN1bWVkLgogICAgICoKICAgICAqIFJldHVybnMgdGhlIGNvbnN1bWVkIHN0cmluZywgb3IgYW4gZW1wdHkgc3RyaW5nIGlmIG5vdGhpbmcgd2FzIGNvbnN1bWVkLgogICAgICovCiAgICBBKHJlZ2V4KSB7CiAgICAgIGxldCByZXN0T2ZTdHJpbmcgPSB0aGlzLm0uc2xpY2UodGhpcy5pKCkpOwogICAgICBsZXQgbWF0Y2hCeXRlSW5kZXggPSByZXN0T2ZTdHJpbmcuc2VhcmNoKHJlZ2V4KTsKICAgICAgaWYgKG1hdGNoQnl0ZUluZGV4IDw9IDApIHsKICAgICAgICByZXR1cm4gZW1wdHlTdHJpbmc7CiAgICAgIH0KICAgICAgbGV0IHJlc3VsdCA9IHJlc3RPZlN0cmluZy5zbGljZSgwLCBtYXRjaEJ5dGVJbmRleCk7CiAgICAgIHRoaXMuZyh0aGlzLnEocmVzdWx0KSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGNoYXJhY3RlcnMgdW50aWwgdGhlIGdpdmVuIHN0cmluZyBpcyBmb3VuZCwgYWR2YW5jaW5nIHRoZSBzY2FubmVyCiAgICAgKiB1cCB0byAoYnV0IG5vdCBiZXlvbmQpIHRoYXQgcG9pbnQuIElmIHRoZSBzdHJpbmcgaXMgbmV2ZXIgZm91bmQsIG5vdGhpbmcKICAgICAqIHdpbGwgYmUgY29uc3VtZWQuCiAgICAgKgogICAgICogUmV0dXJucyB0aGUgY29uc3VtZWQgc3RyaW5nLCBvciBhbiBlbXB0eSBzdHJpbmcgaWYgbm90aGluZyB3YXMgY29uc3VtZWQuCiAgICAgKi8KICAgIHQoc2VhcmNoU3RyaW5nKSB7CiAgICAgIGxldCB7IG06IHN0cmluZyB9ID0gdGhpczsKICAgICAgbGV0IGJ5dGVJbmRleCA9IHRoaXMuaSgpOwogICAgICBsZXQgbWF0Y2hCeXRlSW5kZXggPSBzdHJpbmcuaW5kZXhPZihzZWFyY2hTdHJpbmcsIGJ5dGVJbmRleCk7CiAgICAgIGlmIChtYXRjaEJ5dGVJbmRleCA8PSAwKSB7CiAgICAgICAgcmV0dXJuIGVtcHR5U3RyaW5nOwogICAgICB9CiAgICAgIGxldCByZXN1bHQgPSBzdHJpbmcuc2xpY2UoYnl0ZUluZGV4LCBtYXRjaEJ5dGVJbmRleCk7CiAgICAgIHRoaXMuZyh0aGlzLnEocmVzdWx0KSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGdpdmVuIG51bWJlciBvZiBjaGFyYWN0ZXJzIHN0YXJ0aW5nIGF0IHRoZSBjdXJyZW50IGNoYXJhY3RlcgogICAgICogaW5kZXgsIHdpdGhvdXQgYWR2YW5jaW5nIHRoZSBzY2FubmVyIGFuZCB3aXRob3V0IGV4Y2VlZGluZyB0aGUgZW5kIG9mIHRoZQogICAgICogaW5wdXQgc3RyaW5nLgogICAgICovCiAgICBoKGNvdW50ID0gMSkgewogICAgICBsZXQgeyBkOiBjaGFySW5kZXgsIG46IG11bHRpQnl0ZU1vZGUsIG06IHN0cmluZyB9ID0gdGhpczsKICAgICAgaWYgKG11bHRpQnl0ZU1vZGUpIHsKICAgICAgICBpZiAoY2hhckluZGV4ID49IHRoaXMuaykgewogICAgICAgICAgcmV0dXJuIGVtcHR5U3RyaW5nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyaW5nLnNsaWNlKAogICAgICAgICAgdGhpcy5pKGNoYXJJbmRleCksCiAgICAgICAgICB0aGlzLmkoY2hhckluZGV4ICsgY291bnQpCiAgICAgICAgKTsKICAgICAgfQogICAgICByZXR1cm4gc3RyaW5nLnNsaWNlKGNoYXJJbmRleCwgY2hhckluZGV4ICsgY291bnQpOwogICAgfQogICAgLyoqCiAgICAgKiBSZXNldHMgdGhlIHNjYW5uZXIgcG9zaXRpb24gdG8gdGhlIGdpdmVuIGNoYXJhY3RlciBfaW5kZXhfLCBvciB0byB0aGUgc3RhcnQKICAgICAqIG9mIHRoZSBpbnB1dCBzdHJpbmcgaWYgbm8gaW5kZXggaXMgZ2l2ZW4uCiAgICAgKgogICAgICogSWYgX2luZGV4XyBpcyBuZWdhdGl2ZSwgdGhlIHNjYW5uZXIgcG9zaXRpb24gd2lsbCBiZSBtb3ZlZCBiYWNrd2FyZCBieSB0aGF0CiAgICAgKiBtYW55IGNoYXJhY3RlcnMsIHN0b3BwaW5nIGlmIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHN0cmluZyBpcyByZWFjaGVkLgogICAgICovCiAgICBvKGluZGV4ID0gMCkgewogICAgICB0aGlzLmQgPSBpbmRleCA+PSAwID8gTWF0aC5taW4odGhpcy5rLCBpbmRleCkgOiBNYXRoLm1heCgwLCB0aGlzLmQgKyBpbmRleCk7CiAgICB9CiAgfTsKICB2YXIgYXR0VmFsdWVDaGFyRG91YmxlUXVvdGUgPSAvW14iJjxdKy95OwogIHZhciBhdHRWYWx1ZUNoYXJTaW5nbGVRdW90ZSA9IC9bXicmPF0rL3k7CiAgdmFyIGF0dFZhbHVlTm9ybWFsaXplZFdoaXRlc3BhY2UgPSAvXHJcbnxbXG5cclx0XS9nOwogIHZhciBlbmRDaGFyRGF0YSA9IC88fCZ8XV0+LzsKICB2YXIgcHJlZGVmaW5lZEVudGl0aWVzID0gT2JqZWN0LmZyZWV6ZShPYmplY3QuYXNzaWduKC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpLCB7CiAgICBhbXA6ICImIiwKICAgIGFwb3M6ICInIiwKICAgIGd0OiAiPiIsCiAgICBsdDogIjwiLAogICAgcXVvdDogJyInCiAgfSkpOwogIGZ1bmN0aW9uIGlzTmFtZUNoYXIoY2hhcikgewogICAgbGV0IGNwID0gZ2V0Q29kZVBvaW50KGNoYXIpOwogICAgcmV0dXJuIGNwID49IDk3ICYmIGNwIDw9IDEyMiB8fCBjcCA+PSA2NSAmJiBjcCA8PSA5MCB8fCBjcCA+PSA0OCAmJiBjcCA8PSA1NyB8fCBjcCA9PT0gNDUgfHwgY3AgPT09IDQ2IHx8IGNwID09PSAxODMgfHwgY3AgPj0gNzY4ICYmIGNwIDw9IDg3OSB8fCBjcCA+PSA4MjU1ICYmIGNwIDw9IDgyNTYgfHwgaXNOYW1lU3RhcnRDaGFyKGNoYXIsIGNwKTsKICB9CiAgZnVuY3Rpb24gaXNOYW1lU3RhcnRDaGFyKGNoYXIsIGNwID0gZ2V0Q29kZVBvaW50KGNoYXIpKSB7CiAgICByZXR1cm4gY3AgPj0gOTcgJiYgY3AgPD0gMTIyIHx8IGNwID49IDY1ICYmIGNwIDw9IDkwIHx8IGNwID09PSA1OCB8fCBjcCA9PT0gOTUgfHwgY3AgPj0gMTkyICYmIGNwIDw9IDIxNCB8fCBjcCA+PSAyMTYgJiYgY3AgPD0gMjQ2IHx8IGNwID49IDI0OCAmJiBjcCA8PSA3NjcgfHwgY3AgPj0gODgwICYmIGNwIDw9IDg5MyB8fCBjcCA+PSA4OTUgJiYgY3AgPD0gODE5MSB8fCBjcCA+PSA4MjA0ICYmIGNwIDw9IDgyMDUgfHwgY3AgPj0gODMwNCAmJiBjcCA8PSA4NTkxIHx8IGNwID49IDExMjY0ICYmIGNwIDw9IDEyMjcxIHx8IGNwID49IDEyMjg5ICYmIGNwIDw9IDU1Mjk1IHx8IGNwID49IDYzNzQ0ICYmIGNwIDw9IDY0OTc1IHx8IGNwID49IDY1MDA4ICYmIGNwIDw9IDY1NTMzIHx8IGNwID49IDY1NTM2ICYmIGNwIDw9IDk4MzAzOTsKICB9CiAgZnVuY3Rpb24gaXNSZWZlcmVuY2VDaGFyKGNoYXIpIHsKICAgIHJldHVybiBjaGFyID09PSAiIyIgfHwgaXNOYW1lQ2hhcihjaGFyKTsKICB9CiAgZnVuY3Rpb24gaXNXaGl0ZXNwYWNlKGNoYXIpIHsKICAgIGxldCBjcCA9IGdldENvZGVQb2ludChjaGFyKTsKICAgIHJldHVybiBjcCA9PT0gMzIgfHwgY3AgPT09IDkgfHwgY3AgPT09IDEwIHx8IGNwID09PSAxMzsKICB9CiAgZnVuY3Rpb24gaXNYbWxDb2RlUG9pbnQoY3ApIHsKICAgIHJldHVybiBjcCA9PT0gOSB8fCBjcCA9PT0gMTAgfHwgY3AgPT09IDEzIHx8IGNwID49IDMyICYmIGNwIDw9IDU1Mjk1IHx8IGNwID49IDU3MzQ0ICYmIGNwIDw9IDY1NTMzIHx8IGNwID49IDY1NTM2ICYmIGNwIDw9IDExMTQxMTE7CiAgfQogIGZ1bmN0aW9uIGdldENvZGVQb2ludChjaGFyKSB7CiAgICByZXR1cm4gY2hhci5jb2RlUG9pbnRBdCgwKSB8fCAtMTsKICB9CiAgdmFyIF9YbWxOb2RlID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMucGFyZW50ID0gbnVsbDsKICAgICAgdGhpcy5zdGFydCA9IC0xOwogICAgICB0aGlzLmVuZCA9IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBEb2N1bWVudCB0aGF0IGNvbnRhaW5zIHRoaXMgbm9kZSwgb3IgYG51bGxgIGlmIHRoaXMgbm9kZSBpcyBub3QgYXNzb2NpYXRlZAogICAgICogd2l0aCBhIGRvY3VtZW50LgogICAgICovCiAgICBnZXQgZG9jdW1lbnQoKSB7CiAgICAgIHZhciBfYSwgX2I7CiAgICAgIHJldHVybiAoX2IgPSAoX2EgPSB0aGlzLnBhcmVudCkgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLmRvY3VtZW50KSAhPSBudWxsID8gX2IgOiBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRoaXMgbm9kZSBpcyB0aGUgcm9vdCBub2RlIG9mIHRoZSBkb2N1bWVudCAoYWxzbyBrbm93biBhcyB0aGUKICAgICAqIGRvY3VtZW50IGVsZW1lbnQpLgogICAgICovCiAgICBnZXQgaXNSb290Tm9kZSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGFyZW50ICE9PSBudWxsICYmIHRoaXMucGFyZW50ID09PSB0aGlzLmRvY3VtZW50ICYmIHRoaXMudHlwZSA9PT0gX1htbE5vZGUuVFlQRV9FTEVNRU5UOwogICAgfQogICAgLyoqCiAgICAgKiBXaGV0aGVyIHdoaXRlc3BhY2Ugc2hvdWxkIGJlIHByZXNlcnZlZCBpbiB0aGUgY29udGVudCBvZiB0aGlzIGVsZW1lbnQgYW5kCiAgICAgKiBpdHMgY2hpbGRyZW4uCiAgICAgKgogICAgICogVGhpcyBpcyBpbmZsdWVuY2VkIGJ5IHRoZSB2YWx1ZSBvZiB0aGUgc3BlY2lhbCBgeG1sOnNwYWNlYCBhdHRyaWJ1dGUsIGFuZAogICAgICogd2lsbCBiZSBgdHJ1ZWAgZm9yIGFueSBub2RlIHdob3NlIGB4bWw6c3BhY2VgIGF0dHJpYnV0ZSBpcyBzZXQgdG8KICAgICAqICJwcmVzZXJ2ZSIuIElmIGEgbm9kZSBoYXMgbm8gc3VjaCBhdHRyaWJ1dGUsIGl0IHdpbGwgaW5oZXJpdCB0aGUgdmFsdWUgb2YKICAgICAqIHRoZSBuZWFyZXN0IGFuY2VzdG9yIHRoYXQgZG9lcyAoaWYgYW55KS4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI3NlYy13aGl0ZS1zcGFjZQogICAgICovCiAgICBnZXQgcHJlc2VydmVXaGl0ZXNwYWNlKCkgewogICAgICB2YXIgX2E7CiAgICAgIHJldHVybiAhISgoX2EgPSB0aGlzLnBhcmVudCkgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLnByZXNlcnZlV2hpdGVzcGFjZSk7CiAgICB9CiAgICAvKioKICAgICAqIFR5cGUgb2YgdGhpcyBub2RlLgogICAgICoKICAgICAqIFRoZSB2YWx1ZSBvZiB0aGlzIHByb3BlcnR5IGlzIGEgc3RyaW5nIHRoYXQgbWF0Y2hlcyBvbmUgb2YgdGhlIHN0YXRpYwogICAgICogYFRZUEVfKmAgcHJvcGVydGllcyBvbiB0aGUgYFhtbE5vZGVgIGNsYXNzIChlLmcuIGBUWVBFX0VMRU1FTlRgLAogICAgICogYFRZUEVfVEVYVGAsIGV0Yy4pLgogICAgICoKICAgICAqIFRoZSBgWG1sTm9kZWAgY2xhc3MgaXRzZWxmIGlzIGEgYmFzZSBjbGFzcyBhbmQgZG9lc24ndCBoYXZlIGl0cyBvd24gdHlwZQogICAgICogbmFtZS4KICAgICAqLwogICAgZ2V0IHR5cGUoKSB7CiAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIG9iamVjdCByZXByZXNlbnRpbmcgdGhpcyBub2RlLCBtaW51cyBwcm9wZXJ0aWVzCiAgICAgKiB0aGF0IGNvdWxkIHJlc3VsdCBpbiBjaXJjdWxhciByZWZlcmVuY2VzLgogICAgICovCiAgICB0b0pTT04oKSB7CiAgICAgIGxldCBqc29uID0gewogICAgICAgIHR5cGU6IHRoaXMudHlwZQogICAgICB9OwogICAgICBpZiAodGhpcy5pc1Jvb3ROb2RlKSB7CiAgICAgICAganNvbi5pc1Jvb3ROb2RlID0gdHJ1ZTsKICAgICAgfQogICAgICBpZiAodGhpcy5wcmVzZXJ2ZVdoaXRlc3BhY2UpIHsKICAgICAgICBqc29uLnByZXNlcnZlV2hpdGVzcGFjZSA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuc3RhcnQgIT09IC0xKSB7CiAgICAgICAganNvbi5zdGFydCA9IHRoaXMuc3RhcnQ7CiAgICAgICAganNvbi5lbmQgPSB0aGlzLmVuZDsKICAgICAgfQogICAgICByZXR1cm4ganNvbjsKICAgIH0KICB9OwogIHZhciBYbWxOb2RlID0gX1htbE5vZGU7CiAgWG1sTm9kZS5UWVBFX0NEQVRBID0gImNkYXRhIjsKICBYbWxOb2RlLlRZUEVfQ09NTUVOVCA9ICJjb21tZW50IjsKICBYbWxOb2RlLlRZUEVfRE9DVU1FTlQgPSAiZG9jdW1lbnQiOwogIFhtbE5vZGUuVFlQRV9ET0NVTUVOVF9UWVBFID0gImRvY3R5cGUiOwogIFhtbE5vZGUuVFlQRV9FTEVNRU5UID0gImVsZW1lbnQiOwogIFhtbE5vZGUuVFlQRV9QUk9DRVNTSU5HX0lOU1RSVUNUSU9OID0gInBpIjsKICBYbWxOb2RlLlRZUEVfVEVYVCA9ICJ0ZXh0IjsKICBYbWxOb2RlLlRZUEVfWE1MX0RFQ0xBUkFUSU9OID0gInhtbGRlY2wiOwogIHZhciBYbWxUZXh0ID0gY2xhc3MgZXh0ZW5kcyBYbWxOb2RlIHsKICAgIGNvbnN0cnVjdG9yKHRleHQgPSAiIikgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLnRleHQgPSB0ZXh0OwogICAgfQogICAgZ2V0IHR5cGUoKSB7CiAgICAgIHJldHVybiBYbWxOb2RlLlRZUEVfVEVYVDsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oWG1sTm9kZS5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcyksIHsKICAgICAgICB0ZXh0OiB0aGlzLnRleHQKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgWG1sQ2RhdGEgPSBjbGFzcyBleHRlbmRzIFhtbFRleHQgewogICAgZ2V0IHR5cGUoKSB7CiAgICAgIHJldHVybiBYbWxOb2RlLlRZUEVfQ0RBVEE7CiAgICB9CiAgfTsKICB2YXIgWG1sQ29tbWVudCA9IGNsYXNzIGV4dGVuZHMgWG1sTm9kZSB7CiAgICBjb25zdHJ1Y3Rvcihjb250ZW50ID0gIiIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5jb250ZW50ID0gY29udGVudDsKICAgIH0KICAgIGdldCB0eXBlKCkgewogICAgICByZXR1cm4gWG1sTm9kZS5UWVBFX0NPTU1FTlQ7CiAgICB9CiAgICB0b0pTT04oKSB7CiAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKFhtbE5vZGUucHJvdG90eXBlLnRvSlNPTi5jYWxsKHRoaXMpLCB7CiAgICAgICAgY29udGVudDogdGhpcy5jb250ZW50CiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIFhtbERlY2xhcmF0aW9uID0gY2xhc3MgZXh0ZW5kcyBYbWxOb2RlIHsKICAgIGNvbnN0cnVjdG9yKHZlcnNpb24sIGVuY29kaW5nLCBzdGFuZGFsb25lKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247CiAgICAgIHRoaXMuZW5jb2RpbmcgPSBlbmNvZGluZyAhPSBudWxsID8gZW5jb2RpbmcgOiBudWxsOwogICAgICB0aGlzLnN0YW5kYWxvbmUgPSBzdGFuZGFsb25lICE9IG51bGwgPyBzdGFuZGFsb25lIDogbnVsbDsKICAgIH0KICAgIGdldCB0eXBlKCkgewogICAgICByZXR1cm4gWG1sTm9kZS5UWVBFX1hNTF9ERUNMQVJBVElPTjsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgbGV0IGpzb24gPSBYbWxOb2RlLnByb3RvdHlwZS50b0pTT04uY2FsbCh0aGlzKTsKICAgICAganNvbi52ZXJzaW9uID0gdGhpcy52ZXJzaW9uOwogICAgICBmb3IgKGxldCBrZXkgb2YgWyJlbmNvZGluZyIsICJzdGFuZGFsb25lIl0pIHsKICAgICAgICBpZiAodGhpc1trZXldICE9PSBudWxsKSB7CiAgICAgICAgICBqc29uW2tleV0gPSB0aGlzW2tleV07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBqc29uOwogICAgfQogIH07CiAgdmFyIFhtbEVsZW1lbnQgPSBjbGFzcyBleHRlbmRzIFhtbE5vZGUgewogICAgY29uc3RydWN0b3IobmFtZSwgYXR0cmlidXRlcyA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpLCBjaGlsZHJlbiA9IFtdKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjsKICAgIH0KICAgIC8qKgogICAgICogV2hldGhlciB0aGlzIGVsZW1lbnQgaXMgZW1wdHkgKG1lYW5pbmcgaXQgaGFzIG5vIGNoaWxkcmVuKS4KICAgICAqLwogICAgZ2V0IGlzRW1wdHkoKSB7CiAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9PT0gMDsKICAgIH0KICAgIGdldCBwcmVzZXJ2ZVdoaXRlc3BhY2UoKSB7CiAgICAgIGxldCBub2RlID0gdGhpczsKICAgICAgd2hpbGUgKG5vZGUgaW5zdGFuY2VvZiBYbWxFbGVtZW50KSB7CiAgICAgICAgaWYgKCJ4bWw6c3BhY2UiIGluIG5vZGUuYXR0cmlidXRlcykgewogICAgICAgICAgcmV0dXJuIG5vZGUuYXR0cmlidXRlc1sieG1sOnNwYWNlIl0gPT09ICJwcmVzZXJ2ZSI7CiAgICAgICAgfQogICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFRleHQgY29udGVudCBvZiB0aGlzIGVsZW1lbnQgYW5kIGFsbCBpdHMgZGVzY2VuZGFudHMuCiAgICAgKi8KICAgIGdldCB0ZXh0KCkgewogICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiAidGV4dCIgaW4gY2hpbGQgPyBjaGlsZC50ZXh0IDogIiIpLmpvaW4oIiIpOwogICAgfQogICAgZ2V0IHR5cGUoKSB7CiAgICAgIHJldHVybiBYbWxOb2RlLlRZUEVfRUxFTUVOVDsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oWG1sTm9kZS5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcyksIHsKICAgICAgICBuYW1lOiB0aGlzLm5hbWUsCiAgICAgICAgYXR0cmlidXRlczogdGhpcy5hdHRyaWJ1dGVzLAogICAgICAgIGNoaWxkcmVuOiB0aGlzLmNoaWxkcmVuLm1hcCgoY2hpbGQpID0+IGNoaWxkLnRvSlNPTigpKQogICAgICB9KTsKICAgIH0KICB9OwogIHZhciBYbWxEb2N1bWVudCA9IGNsYXNzIGV4dGVuZHMgWG1sTm9kZSB7CiAgICBjb25zdHJ1Y3RvcihjaGlsZHJlbiA9IFtdKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjsKICAgIH0KICAgIGdldCBkb2N1bWVudCgpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJvb3QgZWxlbWVudCBvZiB0aGlzIGRvY3VtZW50LCBvciBgbnVsbGAgaWYgdGhpcyBkb2N1bWVudCBpcyBlbXB0eS4KICAgICAqLwogICAgZ2V0IHJvb3QoKSB7CiAgICAgIGZvciAobGV0IGNoaWxkIG9mIHRoaXMuY2hpbGRyZW4pIHsKICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBYbWxFbGVtZW50KSB7CiAgICAgICAgICByZXR1cm4gY2hpbGQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBUZXh0IGNvbnRlbnQgb2YgdGhpcyBkb2N1bWVudCBhbmQgYWxsIGl0cyBkZXNjZW5kYW50cy4KICAgICAqLwogICAgZ2V0IHRleHQoKSB7CiAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuLm1hcCgoY2hpbGQpID0+ICJ0ZXh0IiBpbiBjaGlsZCA/IGNoaWxkLnRleHQgOiAiIikuam9pbigiIik7CiAgICB9CiAgICBnZXQgdHlwZSgpIHsKICAgICAgcmV0dXJuIFhtbE5vZGUuVFlQRV9ET0NVTUVOVDsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oWG1sTm9kZS5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcyksIHsKICAgICAgICBjaGlsZHJlbjogdGhpcy5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiBjaGlsZC50b0pTT04oKSkKICAgICAgfSk7CiAgICB9CiAgfTsKICB2YXIgWG1sRG9jdW1lbnRUeXBlID0gY2xhc3MgZXh0ZW5kcyBYbWxOb2RlIHsKICAgIGNvbnN0cnVjdG9yKG5hbWUsIHB1YmxpY0lkLCBzeXN0ZW1JZCwgaW50ZXJuYWxTdWJzZXQpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgdGhpcy5wdWJsaWNJZCA9IHB1YmxpY0lkICE9IG51bGwgPyBwdWJsaWNJZCA6IG51bGw7CiAgICAgIHRoaXMuc3lzdGVtSWQgPSBzeXN0ZW1JZCAhPSBudWxsID8gc3lzdGVtSWQgOiBudWxsOwogICAgICB0aGlzLmludGVybmFsU3Vic2V0ID0gaW50ZXJuYWxTdWJzZXQgIT0gbnVsbCA/IGludGVybmFsU3Vic2V0IDogbnVsbDsKICAgIH0KICAgIGdldCB0eXBlKCkgewogICAgICByZXR1cm4gWG1sTm9kZS5UWVBFX0RPQ1VNRU5UX1RZUEU7CiAgICB9CiAgICB0b0pTT04oKSB7CiAgICAgIGxldCBqc29uID0gWG1sTm9kZS5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcyk7CiAgICAgIGpzb24ubmFtZSA9IHRoaXMubmFtZTsKICAgICAgZm9yIChsZXQga2V5IG9mIFsicHVibGljSWQiLCAic3lzdGVtSWQiLCAiaW50ZXJuYWxTdWJzZXQiXSkgewogICAgICAgIGlmICh0aGlzW2tleV0gIT09IG51bGwpIHsKICAgICAgICAgIGpzb25ba2V5XSA9IHRoaXNba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGpzb247CiAgICB9CiAgfTsKICB2YXIgWG1sRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHsKICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIGNoYXJJbmRleCwgeG1sKSB7CiAgICAgIGxldCBjb2x1bW4gPSAxOwogICAgICBsZXQgZXhjZXJwdCA9ICIiOwogICAgICBsZXQgbGluZSA9IDE7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hhckluZGV4OyArK2kpIHsKICAgICAgICBsZXQgY2hhciA9IHhtbFtpXTsKICAgICAgICBpZiAoY2hhciA9PT0gIlxuIikgewogICAgICAgICAgY29sdW1uID0gMTsKICAgICAgICAgIGV4Y2VycHQgPSAiIjsKICAgICAgICAgIGxpbmUgKz0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29sdW1uICs9IDE7CiAgICAgICAgICBleGNlcnB0ICs9IGNoYXI7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCBlb2wgPSB4bWwuaW5kZXhPZigiXG4iLCBjaGFySW5kZXgpOwogICAgICBleGNlcnB0ICs9IGVvbCA9PT0gLTEgPyB4bWwuc2xpY2UoY2hhckluZGV4KSA6IHhtbC5zbGljZShjaGFySW5kZXgsIGVvbCk7CiAgICAgIGxldCBleGNlcnB0U3RhcnQgPSAwOwogICAgICBpZiAoZXhjZXJwdC5sZW5ndGggPiA1MCkgewogICAgICAgIGlmIChjb2x1bW4gPCA0MCkgewogICAgICAgICAgZXhjZXJwdCA9IGV4Y2VycHQuc2xpY2UoMCwgNTApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBleGNlcnB0U3RhcnQgPSBjb2x1bW4gLSAyMDsKICAgICAgICAgIGV4Y2VycHQgPSBleGNlcnB0LnNsaWNlKGV4Y2VycHRTdGFydCwgY29sdW1uICsgMzApOwogICAgICAgIH0KICAgICAgfQogICAgICBzdXBlcigKICAgICAgICBgJHttZXNzYWdlfSAobGluZSAke2xpbmV9LCBjb2x1bW4gJHtjb2x1bW59KQogICR7ZXhjZXJwdH0KYCArICIgIi5yZXBlYXQoY29sdW1uIC0gZXhjZXJwdFN0YXJ0ICsgMSkgKyAiXlxuIgogICAgICApOwogICAgICB0aGlzLmNvbHVtbiA9IGNvbHVtbjsKICAgICAgdGhpcy5leGNlcnB0ID0gZXhjZXJwdDsKICAgICAgdGhpcy5saW5lID0gbGluZTsKICAgICAgdGhpcy5uYW1lID0gIlhtbEVycm9yIjsKICAgICAgdGhpcy5wb3MgPSBjaGFySW5kZXg7CiAgICB9CiAgfTsKICB2YXIgWG1sUHJvY2Vzc2luZ0luc3RydWN0aW9uID0gY2xhc3MgZXh0ZW5kcyBYbWxOb2RlIHsKICAgIGNvbnN0cnVjdG9yKG5hbWUsIGNvbnRlbnQgPSAiIikgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50OwogICAgfQogICAgZ2V0IHR5cGUoKSB7CiAgICAgIHJldHVybiBYbWxOb2RlLlRZUEVfUFJPQ0VTU0lOR19JTlNUUlVDVElPTjsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oWG1sTm9kZS5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcyksIHsKICAgICAgICBuYW1lOiB0aGlzLm5hbWUsCiAgICAgICAgY29udGVudDogdGhpcy5jb250ZW50CiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIGVtcHR5U3RyaW5nMiA9ICIiOwogIHZhciBQYXJzZXIgPSBjbGFzcyB7CiAgICAvKioKICAgICAqIEBwYXJhbSB4bWwgWE1MIHN0cmluZyB0byBwYXJzZS4KICAgICAqIEBwYXJhbSBvcHRpb25zIFBhcnNlciBvcHRpb25zLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih4bWwsIG9wdGlvbnMgPSB7fSkgewogICAgICBsZXQgZG9jID0gdGhpcy5kb2N1bWVudCA9IG5ldyBYbWxEb2N1bWVudCgpOwogICAgICBsZXQgc2Nhbm5lciA9IHRoaXMuYyA9IG5ldyBTdHJpbmdTY2FubmVyKHhtbCk7CiAgICAgIHRoaXMubCA9IGRvYzsKICAgICAgdGhpcy5mID0gb3B0aW9uczsKICAgICAgaWYgKHRoaXMuZi5pbmNsdWRlT2Zmc2V0cykgewogICAgICAgIGRvYy5zdGFydCA9IDA7CiAgICAgICAgZG9jLmVuZCA9IHhtbC5sZW5ndGg7CiAgICAgIH0KICAgICAgc2Nhbm5lci5iKCJcdUZFRkYiKTsKICAgICAgdGhpcy5IKCk7CiAgICAgIGlmICghdGhpcy5CKCkpIHsKICAgICAgICB0aHJvdyB0aGlzLmEoIlJvb3QgZWxlbWVudCBpcyBtaXNzaW5nIG9yIGludmFsaWQiKTsKICAgICAgfQogICAgICB3aGlsZSAodGhpcy53KCkpIHsKICAgICAgfQogICAgICBpZiAoIXNjYW5uZXIueikgewogICAgICAgIHRocm93IHRoaXMuYSgiRXh0cmEgY29udGVudCBhdCB0aGUgZW5kIG9mIHRoZSBkb2N1bWVudCIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgdGhlIGdpdmVuIGBYbWxOb2RlYCBhcyBhIGNoaWxkIG9mIGB0aGlzLmN1cnJlbnROb2RlYC4KICAgICAqLwogICAgaihub2RlLCBjaGFySW5kZXgpIHsKICAgICAgbm9kZS5wYXJlbnQgPSB0aGlzLmw7CiAgICAgIGlmICh0aGlzLmYuaW5jbHVkZU9mZnNldHMpIHsKICAgICAgICBub2RlLnN0YXJ0ID0gdGhpcy5jLmkoY2hhckluZGV4KTsKICAgICAgICBub2RlLmVuZCA9IHRoaXMuYy5pKCk7CiAgICAgIH0KICAgICAgdGhpcy5sLmNoaWxkcmVuLnB1c2gobm9kZSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBBZGRzIHRoZSBnaXZlbiBfdGV4dF8gdG8gdGhlIGRvY3VtZW50LCBlaXRoZXIgYnkgYXBwZW5kaW5nIGl0IHRvIGEKICAgICAqIHByZWNlZGluZyBgWG1sVGV4dGAgbm9kZSAoaWYgcG9zc2libGUpIG9yIGJ5IGNyZWF0aW5nIGEgbmV3IGBYbWxUZXh0YCBub2RlLgogICAgICovCiAgICB4KHRleHQsIGNoYXJJbmRleCkgewogICAgICBsZXQgeyBjaGlsZHJlbiB9ID0gdGhpcy5sOwogICAgICBsZXQgeyBsZW5ndGggfSA9IGNoaWxkcmVuOwogICAgICB0ZXh0ID0gbm9ybWFsaXplTGluZUJyZWFrcyh0ZXh0KTsKICAgICAgaWYgKGxlbmd0aCA+IDApIHsKICAgICAgICBsZXQgcHJldk5vZGUgPSBjaGlsZHJlbltsZW5ndGggLSAxXTsKICAgICAgICBpZiAoKHByZXZOb2RlID09IG51bGwgPyB2b2lkIDAgOiBwcmV2Tm9kZS50eXBlKSA9PT0gWG1sTm9kZS5UWVBFX1RFWFQpIHsKICAgICAgICAgIGxldCB0ZXh0Tm9kZSA9IHByZXZOb2RlOwogICAgICAgICAgdGV4dE5vZGUudGV4dCArPSB0ZXh0OwogICAgICAgICAgaWYgKHRoaXMuZi5pbmNsdWRlT2Zmc2V0cykgewogICAgICAgICAgICB0ZXh0Tm9kZS5lbmQgPSB0aGlzLmMuaSgpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmoobmV3IFhtbFRleHQodGV4dCksIGNoYXJJbmRleCk7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGVsZW1lbnQgYXR0cmlidXRlcy4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI3NlYy1zdGFydHRhZ3MKICAgICAqLwogICAgSSgpIHsKICAgICAgbGV0IGF0dHJpYnV0ZXMgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgd2hpbGUgKHRoaXMuZSgpKSB7CiAgICAgICAgbGV0IGF0dHJOYW1lID0gdGhpcy5yKCk7CiAgICAgICAgaWYgKCFhdHRyTmFtZSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGxldCBhdHRyVmFsdWUgPSB0aGlzLnUoKSAmJiB0aGlzLkooKTsKICAgICAgICBpZiAoYXR0clZhbHVlID09PSBmYWxzZSkgewogICAgICAgICAgdGhyb3cgdGhpcy5hKCJBdHRyaWJ1dGUgdmFsdWUgZXhwZWN0ZWQiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGF0dHJOYW1lIGluIGF0dHJpYnV0ZXMpIHsKICAgICAgICAgIHRocm93IHRoaXMuYShgRHVwbGljYXRlIGF0dHJpYnV0ZTogJHthdHRyTmFtZX1gKTsKICAgICAgICB9CiAgICAgICAgaWYgKGF0dHJOYW1lID09PSAieG1sOnNwYWNlIiAmJiBhdHRyVmFsdWUgIT09ICJkZWZhdWx0IiAmJiBhdHRyVmFsdWUgIT09ICJwcmVzZXJ2ZSIpIHsKICAgICAgICAgIHRocm93IHRoaXMuYSgnVmFsdWUgb2YgdGhlIGB4bWw6c3BhY2VgIGF0dHJpYnV0ZSBtdXN0IGJlICJkZWZhdWx0IiBvciAicHJlc2VydmUiJyk7CiAgICAgICAgfQogICAgICAgIGF0dHJpYnV0ZXNbYXR0ck5hbWVdID0gYXR0clZhbHVlOwogICAgICB9CiAgICAgIGlmICh0aGlzLmYuc29ydEF0dHJpYnV0ZXMpIHsKICAgICAgICBsZXQgYXR0ck5hbWVzID0gT2JqZWN0LmtleXMoYXR0cmlidXRlcykuc29ydCgpOwogICAgICAgIGxldCBzb3J0ZWRBdHRyaWJ1dGVzID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhdHRyTmFtZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGxldCBhdHRyTmFtZSA9IGF0dHJOYW1lc1tpXTsKICAgICAgICAgIHNvcnRlZEF0dHJpYnV0ZXNbYXR0ck5hbWVdID0gYXR0cmlidXRlc1thdHRyTmFtZV07CiAgICAgICAgfQogICAgICAgIGF0dHJpYnV0ZXMgPSBzb3J0ZWRBdHRyaWJ1dGVzOwogICAgICB9CiAgICAgIHJldHVybiBhdHRyaWJ1dGVzOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBhbiBgQXR0VmFsdWVgIChhdHRyaWJ1dGUgdmFsdWUpIGlmIHBvc3NpYmxlLgogICAgICoKICAgICAqIEByZXR1cm5zCiAgICAgKiAgIENvbnRlbnRzIG9mIHRoZSBgQXR0VmFsdWVgIG1pbnVzIHF1b3Rlcywgb3IgYGZhbHNlYCBpZiBub3RoaW5nIHdhcwogICAgICogICBjb25zdW1lZC4gQW4gZW1wdHkgc3RyaW5nIGluZGljYXRlcyB0aGF0IGFuIGBBdHRWYWx1ZWAgd2FzIGNvbnN1bWVkIGJ1dAogICAgICogICB3YXMgZW1wdHkuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNOVC1BdHRWYWx1ZQogICAgICovCiAgICBKKCkgewogICAgICBsZXQgeyBjOiBzY2FubmVyIH0gPSB0aGlzOwogICAgICBsZXQgcXVvdGUgPSBzY2FubmVyLmgoKTsKICAgICAgaWYgKHF1b3RlICE9PSAnIicgJiYgcXVvdGUgIT09ICInIikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBzY2FubmVyLmcoKTsKICAgICAgbGV0IGNoYXJzOwogICAgICBsZXQgaXNDbG9zZWQgPSBmYWxzZTsKICAgICAgbGV0IHZhbHVlID0gZW1wdHlTdHJpbmcyOwogICAgICBsZXQgcmVnZXggPSBxdW90ZSA9PT0gJyInID8gYXR0VmFsdWVDaGFyRG91YmxlUXVvdGUgOiBhdHRWYWx1ZUNoYXJTaW5nbGVRdW90ZTsKICAgICAgbWF0Y2hMb29wOgogICAgICAgIHdoaWxlICghc2Nhbm5lci56KSB7CiAgICAgICAgICBjaGFycyA9IHNjYW5uZXIuRyhyZWdleCk7CiAgICAgICAgICBpZiAoY2hhcnMpIHsKICAgICAgICAgICAgdGhpcy5wKGNoYXJzKTsKICAgICAgICAgICAgdmFsdWUgKz0gY2hhcnMucmVwbGFjZShhdHRWYWx1ZU5vcm1hbGl6ZWRXaGl0ZXNwYWNlLCAiICIpOwogICAgICAgICAgfQogICAgICAgICAgc3dpdGNoIChzY2FubmVyLmgoKSkgewogICAgICAgICAgICBjYXNlIHF1b3RlOgogICAgICAgICAgICAgIGlzQ2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhayBtYXRjaExvb3A7CiAgICAgICAgICAgIGNhc2UgIiYiOgogICAgICAgICAgICAgIHZhbHVlICs9IHRoaXMuQygpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlICI8IjoKICAgICAgICAgICAgICB0aHJvdyB0aGlzLmEoIlVuZXNjYXBlZCBgPGAgaXMgbm90IGFsbG93ZWQgaW4gYW4gYXR0cmlidXRlIHZhbHVlIik7CiAgICAgICAgICAgIGNhc2UgZW1wdHlTdHJpbmcyOgogICAgICAgICAgICAgIGJyZWFrIG1hdGNoTG9vcDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIGlmICghaXNDbG9zZWQpIHsKICAgICAgICB0aHJvdyB0aGlzLmEoIlVuY2xvc2VkIGF0dHJpYnV0ZSIpOwogICAgICB9CiAgICAgIHNjYW5uZXIuZygpOwogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgQ0RBVEEgc2VjdGlvbiBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGEgQ0RBVEEgc2VjdGlvbiB3YXMgY29uc3VtZWQuCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI3NlYy1jZGF0YS1zZWN0CiAgICAgKi8KICAgIEsoKSB7CiAgICAgIGxldCB7IGM6IHNjYW5uZXIgfSA9IHRoaXM7CiAgICAgIGxldCBzdGFydEluZGV4ID0gc2Nhbm5lci5kOwogICAgICBpZiAoIXNjYW5uZXIuYigiPCFbQ0RBVEFbIikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IHRleHQgPSBzY2FubmVyLnQoIl1dPiIpOwogICAgICB0aGlzLnAodGV4dCk7CiAgICAgIGlmICghc2Nhbm5lci5iKCJdXT4iKSkgewogICAgICAgIHRocm93IHRoaXMuYSgiVW5jbG9zZWQgQ0RBVEEgc2VjdGlvbiIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmYucHJlc2VydmVDZGF0YSA/IHRoaXMuaihuZXcgWG1sQ2RhdGEobm9ybWFsaXplTGluZUJyZWFrcyh0ZXh0KSksIHN0YXJ0SW5kZXgpIDogdGhpcy54KHRleHQsIHN0YXJ0SW5kZXgpOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBjaGFyYWN0ZXIgZGF0YSBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGNoYXJhY3RlciBkYXRhIHdhcyBjb25zdW1lZC4KICAgICAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSLzIwMDgvUkVDLXhtbC0yMDA4MTEyNi8jZHQtY2hhcmRhdGEKICAgICAqLwogICAgTCgpIHsKICAgICAgbGV0IHsgYzogc2Nhbm5lciB9ID0gdGhpczsKICAgICAgbGV0IHN0YXJ0SW5kZXggPSBzY2FubmVyLmQ7CiAgICAgIGxldCBjaGFyRGF0YSA9IHNjYW5uZXIuQShlbmRDaGFyRGF0YSk7CiAgICAgIGlmICghY2hhckRhdGEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgdGhpcy5wKGNoYXJEYXRhKTsKICAgICAgaWYgKHNjYW5uZXIuaCgzKSA9PT0gIl1dPiIpIHsKICAgICAgICB0aHJvdyB0aGlzLmEoIkVsZW1lbnQgY29udGVudCBtYXkgbm90IGNvbnRhaW4gdGhlIENEQVRBIHNlY3Rpb24gY2xvc2UgZGVsaW1pdGVyIGBdXT5gIik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMueChjaGFyRGF0YSwgc3RhcnRJbmRleCk7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgY29tbWVudCBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGEgY29tbWVudCB3YXMgY29uc3VtZWQuCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI05ULUNvbW1lbnQKICAgICAqLwogICAgRCgpIHsKICAgICAgbGV0IHsgYzogc2Nhbm5lciB9ID0gdGhpczsKICAgICAgbGV0IHN0YXJ0SW5kZXggPSBzY2FubmVyLmQ7CiAgICAgIGlmICghc2Nhbm5lci5iKCI8IS0tIikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IGNvbnRlbnQgPSBzY2FubmVyLnQoIi0tIik7CiAgICAgIHRoaXMucChjb250ZW50KTsKICAgICAgaWYgKCFzY2FubmVyLmIoIi0tPiIpKSB7CiAgICAgICAgaWYgKHNjYW5uZXIuaCgyKSA9PT0gIi0tIikgewogICAgICAgICAgdGhyb3cgdGhpcy5hKCJUaGUgc3RyaW5nIGAtLWAgaXNuJ3QgYWxsb3dlZCBpbnNpZGUgYSBjb21tZW50Iik7CiAgICAgICAgfQogICAgICAgIHRocm93IHRoaXMuYSgiVW5jbG9zZWQgY29tbWVudCIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmYucHJlc2VydmVDb21tZW50cyA/IHRoaXMuaihuZXcgWG1sQ29tbWVudChub3JtYWxpemVMaW5lQnJlYWtzKGNvbnRlbnQpKSwgc3RhcnRJbmRleCkgOiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBhIHJlZmVyZW5jZSBpbiBhIGNvbnRlbnQgY29udGV4dCBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBUaGlzIGRpZmZlcnMgZnJvbSBgY29uc3VtZVJlZmVyZW5jZSgpYCBpbiB0aGF0IGEgY29uc3VtZWQgcmVmZXJlbmNlIHdpbGwgYmUKICAgICAqIGFkZGVkIHRvIHRoZSBkb2N1bWVudCBhcyBhIHRleHQgbm9kZSBpbnN0ZWFkIG9mIHJldHVybmVkLgogICAgICoKICAgICAqIEByZXR1cm5zIFdoZXRoZXIgYSByZWZlcmVuY2Ugd2FzIGNvbnN1bWVkLgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNlbnRwcm9jCiAgICAgKi8KICAgIE0oKSB7CiAgICAgIGxldCBzdGFydEluZGV4ID0gdGhpcy5jLmQ7CiAgICAgIGxldCByZWYgPSB0aGlzLkMoKTsKICAgICAgcmV0dXJuIHJlZiA/IHRoaXMueChyZWYsIHN0YXJ0SW5kZXgpIDogZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgZG9jdHlwZSBkZWNsYXJhdGlvbiBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBUaGlzIGlzIGEgbG9vc2UgaW1wbGVtZW50YXRpb24gc2luY2UgZG9jdHlwZSBkZWNsYXJhdGlvbnMgYXJlIGN1cnJlbnRseQogICAgICogZGlzY2FyZGVkIHdpdGhvdXQgZnVydGhlciBwYXJzaW5nLgogICAgICoKICAgICAqIEByZXR1cm5zIFdoZXRoZXIgYSBkb2N0eXBlIGRlY2xhcmF0aW9uIHdhcyBjb25zdW1lZC4KICAgICAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSLzIwMDgvUkVDLXhtbC0yMDA4MTEyNi8jZHRkCiAgICAgKi8KICAgIE4oKSB7CiAgICAgIGxldCB7IGM6IHNjYW5uZXIgfSA9IHRoaXM7CiAgICAgIGxldCBzdGFydEluZGV4ID0gc2Nhbm5lci5kOwogICAgICBpZiAoIXNjYW5uZXIuYigiPCFET0NUWVBFIikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IG5hbWUgPSB0aGlzLmUoKSAmJiB0aGlzLnIoKTsKICAgICAgaWYgKCFuYW1lKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJFeHBlY3RlZCBhIG5hbWUiKTsKICAgICAgfQogICAgICBsZXQgcHVibGljSWQ7CiAgICAgIGxldCBzeXN0ZW1JZDsKICAgICAgaWYgKHRoaXMuZSgpKSB7CiAgICAgICAgaWYgKHNjYW5uZXIuYigiUFVCTElDIikpIHsKICAgICAgICAgIHB1YmxpY0lkID0gdGhpcy5lKCkgJiYgdGhpcy5PKCk7CiAgICAgICAgICBpZiAocHVibGljSWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRocm93IHRoaXMuYSgiRXhwZWN0ZWQgYSBwdWJsaWMgaWRlbnRpZmllciIpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5lKCk7CiAgICAgICAgfQogICAgICAgIGlmIChwdWJsaWNJZCAhPT0gdm9pZCAwIHx8IHNjYW5uZXIuYigiU1lTVEVNIikpIHsKICAgICAgICAgIHRoaXMuZSgpOwogICAgICAgICAgc3lzdGVtSWQgPSB0aGlzLnMoKTsKICAgICAgICAgIGlmIChzeXN0ZW1JZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgdGhpcy5hKCJFeHBlY3RlZCBhIHN5c3RlbSBpZGVudGlmaWVyIik7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmUoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbGV0IGludGVybmFsU3Vic2V0OwogICAgICBpZiAoc2Nhbm5lci5iKCJbIikpIHsKICAgICAgICBpbnRlcm5hbFN1YnNldCA9IHNjYW5uZXIuQSgvXF1bXHgyMFx0XHJcbl0qPi8pOwogICAgICAgIGlmICghc2Nhbm5lci5iKCJdIikpIHsKICAgICAgICAgIHRocm93IHRoaXMuYSgiVW5jbG9zZWQgaW50ZXJuYWwgc3Vic2V0Iik7CiAgICAgICAgfQogICAgICAgIHRoaXMuZSgpOwogICAgICB9CiAgICAgIGlmICghc2Nhbm5lci5iKCI+IikpIHsKICAgICAgICB0aHJvdyB0aGlzLmEoIlVuY2xvc2VkIGRvY3R5cGUgZGVjbGFyYXRpb24iKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5mLnByZXNlcnZlRG9jdW1lbnRUeXBlID8gdGhpcy5qKG5ldyBYbWxEb2N1bWVudFR5cGUobmFtZSwgcHVibGljSWQsIHN5c3RlbUlkLCBpbnRlcm5hbFN1YnNldCksIHN0YXJ0SW5kZXgpIDogdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3VtZXMgYW4gZWxlbWVudCBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGFuIGVsZW1lbnQgd2FzIGNvbnN1bWVkLgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNOVC1lbGVtZW50CiAgICAgKi8KICAgIEIoKSB7CiAgICAgIGxldCB7IGM6IHNjYW5uZXIgfSA9IHRoaXM7CiAgICAgIGxldCBzdGFydEluZGV4ID0gc2Nhbm5lci5kOwogICAgICBpZiAoIXNjYW5uZXIuYigiPCIpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGxldCBuYW1lID0gdGhpcy5yKCk7CiAgICAgIGlmICghbmFtZSkgewogICAgICAgIHNjYW5uZXIubyhzdGFydEluZGV4KTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IGF0dHJpYnV0ZXMgPSB0aGlzLkkoKTsKICAgICAgbGV0IGlzRW1wdHkgPSAhIXNjYW5uZXIuYigiLz4iKTsKICAgICAgbGV0IGVsZW1lbnQgPSBuZXcgWG1sRWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzKTsKICAgICAgZWxlbWVudC5wYXJlbnQgPSB0aGlzLmw7CiAgICAgIGlmICghaXNFbXB0eSkgewogICAgICAgIGlmICghc2Nhbm5lci5iKCI+IikpIHsKICAgICAgICAgIHRocm93IHRoaXMuYShgVW5jbG9zZWQgc3RhcnQgdGFnIGZvciBlbGVtZW50IFxgJHtuYW1lfVxgYCk7CiAgICAgICAgfQogICAgICAgIHRoaXMubCA9IGVsZW1lbnQ7CiAgICAgICAgZG8gewogICAgICAgICAgdGhpcy5MKCk7CiAgICAgICAgfSB3aGlsZSAodGhpcy5CKCkgfHwgdGhpcy5NKCkgfHwgdGhpcy5LKCkgfHwgdGhpcy5FKCkgfHwgdGhpcy5EKCkpOwogICAgICAgIGxldCBlbmRUYWdNYXJrID0gc2Nhbm5lci5kOwogICAgICAgIGxldCBlbmRUYWdOYW1lOwogICAgICAgIGlmICghc2Nhbm5lci5iKCI8LyIpIHx8ICEoZW5kVGFnTmFtZSA9IHRoaXMucigpKSB8fCBlbmRUYWdOYW1lICE9PSBuYW1lKSB7CiAgICAgICAgICBzY2FubmVyLm8oZW5kVGFnTWFyayk7CiAgICAgICAgICB0aHJvdyB0aGlzLmEoYE1pc3NpbmcgZW5kIHRhZyBmb3IgZWxlbWVudCAke25hbWV9YCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuZSgpOwogICAgICAgIGlmICghc2Nhbm5lci5iKCI+IikpIHsKICAgICAgICAgIHRocm93IHRoaXMuYShgVW5jbG9zZWQgZW5kIHRhZyBmb3IgZWxlbWVudCAke25hbWV9YCk7CiAgICAgICAgfQogICAgICAgIHRoaXMubCA9IGVsZW1lbnQucGFyZW50OwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmooZWxlbWVudCwgc3RhcnRJbmRleCk7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGFuIGBFcWAgcHJvZHVjdGlvbiBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGFuIGBFcWAgcHJvZHVjdGlvbiB3YXMgY29uc3VtZWQuCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI05ULUVxCiAgICAgKi8KICAgIHUoKSB7CiAgICAgIHRoaXMuZSgpOwogICAgICBpZiAodGhpcy5jLmIoIj0iKSkgewogICAgICAgIHRoaXMuZSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3VtZXMgYE1pc2NgIGNvbnRlbnQgaWYgcG9zc2libGUuCiAgICAgKgogICAgICogQHJldHVybnMgV2hldGhlciBhbnl0aGluZyB3YXMgY29uc3VtZWQuCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI05ULU1pc2MKICAgICAqLwogICAgdygpIHsKICAgICAgcmV0dXJuIHRoaXMuRCgpIHx8IHRoaXMuRSgpIHx8IHRoaXMuZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBvbmUgb3IgbW9yZSBgTmFtZWAgY2hhcmFjdGVycyBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBgTmFtZWAgY2hhcmFjdGVycywgb3IgYW4gZW1wdHkgc3RyaW5nIGlmIG5vbmUgd2VyZSBjb25zdW1lZC4KICAgICAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSLzIwMDgvUkVDLXhtbC0yMDA4MTEyNi8jTlQtTmFtZQogICAgICovCiAgICByKCkgewogICAgICByZXR1cm4gaXNOYW1lU3RhcnRDaGFyKHRoaXMuYy5oKCkpID8gdGhpcy5jLnYoaXNOYW1lQ2hhcikgOiBlbXB0eVN0cmluZzI7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIGEgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiB3YXMgY29uc3VtZWQuCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI3NlYy1waQogICAgICovCiAgICBFKCkgewogICAgICBsZXQgeyBjOiBzY2FubmVyIH0gPSB0aGlzOwogICAgICBsZXQgc3RhcnRJbmRleCA9IHNjYW5uZXIuZDsKICAgICAgaWYgKCFzY2FubmVyLmIoIjw/IikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IG5hbWUgPSB0aGlzLnIoKTsKICAgICAgaWYgKG5hbWUpIHsKICAgICAgICBpZiAobmFtZS50b0xvd2VyQ2FzZSgpID09PSAieG1sIikgewogICAgICAgICAgc2Nhbm5lci5vKHN0YXJ0SW5kZXgpOwogICAgICAgICAgdGhyb3cgdGhpcy5hKCJYTUwgZGVjbGFyYXRpb24gaXNuJ3QgYWxsb3dlZCBoZXJlIik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IHRoaXMuYSgiSW52YWxpZCBwcm9jZXNzaW5nIGluc3RydWN0aW9uIik7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmUoKSkgewogICAgICAgIGlmIChzY2FubmVyLmIoIj8+IikpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmoobmV3IFhtbFByb2Nlc3NpbmdJbnN0cnVjdGlvbihuYW1lKSwgc3RhcnRJbmRleCk7CiAgICAgICAgfQogICAgICAgIHRocm93IHRoaXMuYSgiV2hpdGVzcGFjZSBpcyByZXF1aXJlZCBhZnRlciBhIHByb2Nlc3NpbmcgaW5zdHJ1Y3Rpb24gbmFtZSIpOwogICAgICB9CiAgICAgIGxldCBjb250ZW50ID0gc2Nhbm5lci50KCI/PiIpOwogICAgICB0aGlzLnAoY29udGVudCk7CiAgICAgIGlmICghc2Nhbm5lci5iKCI/PiIpKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJVbnRlcm1pbmF0ZWQgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiIpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmoobmV3IFhtbFByb2Nlc3NpbmdJbnN0cnVjdGlvbihuYW1lLCBub3JtYWxpemVMaW5lQnJlYWtzKGNvbnRlbnQpKSwgc3RhcnRJbmRleCk7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgcHJvbG9nIGlmIHBvc3NpYmxlLgogICAgICoKICAgICAqIEByZXR1cm5zIFdoZXRoZXIgYSBwcm9sb2cgd2FzIGNvbnN1bWVkLgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNzZWMtcHJvbG9nLWR0ZAogICAgICovCiAgICBIKCkgewogICAgICBsZXQgeyBjOiBzY2FubmVyIH0gPSB0aGlzOwogICAgICBsZXQgc3RhcnRJbmRleCA9IHNjYW5uZXIuZDsKICAgICAgdGhpcy5QKCk7CiAgICAgIHdoaWxlICh0aGlzLncoKSkgewogICAgICB9CiAgICAgIGlmICh0aGlzLk4oKSkgewogICAgICAgIHdoaWxlICh0aGlzLncoKSkgewogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gc3RhcnRJbmRleCA8IHNjYW5uZXIuZDsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3VtZXMgYSBwdWJsaWMgaWRlbnRpZmllciBsaXRlcmFsIGlmIHBvc3NpYmxlLgogICAgICoKICAgICAqIEByZXR1cm5zCiAgICAgKiAgIFZhbHVlIG9mIHRoZSBwdWJsaWMgaWRlbnRpZmllciBsaXRlcmFsIG1pbnVzIHF1b3Rlcywgb3IgYGZhbHNlYCBpZgogICAgICogICBub3RoaW5nIHdhcyBjb25zdW1lZC4gQW4gZW1wdHkgc3RyaW5nIGluZGljYXRlcyB0aGF0IGEgcHVibGljIGlkIGxpdGVyYWwKICAgICAqICAgd2FzIGNvbnN1bWVkIGJ1dCB3YXMgZW1wdHkuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNOVC1QdWJpZExpdGVyYWwKICAgICAqLwogICAgTygpIHsKICAgICAgbGV0IHN0YXJ0SW5kZXggPSB0aGlzLmMuZDsKICAgICAgbGV0IHZhbHVlID0gdGhpcy5zKCk7CiAgICAgIGlmICh2YWx1ZSAhPT0gZmFsc2UgJiYgIS9eWy1ceDIwXHJcbmEtekEtWjAtOScoKSssLi86PT87ISojQCRfJV0qJC8udGVzdCh2YWx1ZSkpIHsKICAgICAgICB0aGlzLmMubyhzdGFydEluZGV4KTsKICAgICAgICB0aHJvdyB0aGlzLmEoIkludmFsaWQgY2hhcmFjdGVyIGluIHB1YmxpYyBpZGVudGlmaWVyIik7CiAgICAgIH0KICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBhIHJlZmVyZW5jZSBpZiBwb3NzaWJsZS4KICAgICAqCiAgICAgKiBUaGlzIGRpZmZlcnMgZnJvbSBgY29uc3VtZUNvbnRlbnRSZWZlcmVuY2UoKWAgaW4gdGhhdCBhIGNvbnN1bWVkIHJlZmVyZW5jZQogICAgICogd2lsbCBiZSByZXR1cm5lZCByYXRoZXIgdGhhbiBhZGRlZCB0byB0aGUgZG9jdW1lbnQuCiAgICAgKgogICAgICogQHJldHVybnMKICAgICAqICAgUGFyc2VkIHJlZmVyZW5jZSB2YWx1ZSwgb3IgYGZhbHNlYCBpZiBub3RoaW5nIHdhcyBjb25zdW1lZCAodG8KICAgICAqICAgZGlzdGluZ3Vpc2ggZnJvbSBhIHJlZmVyZW5jZSB0aGF0IHJlc29sdmVzIHRvIGFuIGVtcHR5IHN0cmluZykuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNOVC1SZWZlcmVuY2UKICAgICAqLwogICAgQygpIHsKICAgICAgbGV0IHsgYzogc2Nhbm5lciB9ID0gdGhpczsKICAgICAgaWYgKCFzY2FubmVyLmIoIiYiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBsZXQgcmVmID0gc2Nhbm5lci52KGlzUmVmZXJlbmNlQ2hhcik7CiAgICAgIGlmIChzY2FubmVyLkYoKSAhPT0gIjsiKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJVbnRlcm1pbmF0ZWQgcmVmZXJlbmNlIChhIHJlZmVyZW5jZSBtdXN0IGVuZCB3aXRoIGA7YCkiKTsKICAgICAgfQogICAgICBsZXQgcGFyc2VkVmFsdWU7CiAgICAgIGlmIChyZWZbMF0gPT09ICIjIikgewogICAgICAgIGxldCBjb2RlUG9pbnQgPSByZWZbMV0gPT09ICJ4IiA/IHBhcnNlSW50KHJlZi5zbGljZSgyKSwgMTYpIDogcGFyc2VJbnQocmVmLnNsaWNlKDEpLCAxMCk7CiAgICAgICAgaWYgKGlzTmFOKGNvZGVQb2ludCkpIHsKICAgICAgICAgIHRocm93IHRoaXMuYSgiSW52YWxpZCBjaGFyYWN0ZXIgcmVmZXJlbmNlIik7CiAgICAgICAgfQogICAgICAgIGlmICghaXNYbWxDb2RlUG9pbnQoY29kZVBvaW50KSkgewogICAgICAgICAgdGhyb3cgdGhpcy5hKCJDaGFyYWN0ZXIgcmVmZXJlbmNlIHJlc29sdmVzIHRvIGFuIGludmFsaWQgY2hhcmFjdGVyIik7CiAgICAgICAgfQogICAgICAgIHBhcnNlZFZhbHVlID0gU3RyaW5nLmZyb21Db2RlUG9pbnQoY29kZVBvaW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwYXJzZWRWYWx1ZSA9IHByZWRlZmluZWRFbnRpdGllc1tyZWZdOwogICAgICAgIGlmIChwYXJzZWRWYWx1ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICBsZXQgewogICAgICAgICAgICBpZ25vcmVVbmRlZmluZWRFbnRpdGllcywKICAgICAgICAgICAgcmVzb2x2ZVVuZGVmaW5lZEVudGl0eQogICAgICAgICAgfSA9IHRoaXMuZjsKICAgICAgICAgIGxldCB3cmFwcGVkUmVmID0gYCYke3JlZn07YDsKICAgICAgICAgIGlmIChyZXNvbHZlVW5kZWZpbmVkRW50aXR5KSB7CiAgICAgICAgICAgIGxldCByZXNvbHZlZFZhbHVlID0gcmVzb2x2ZVVuZGVmaW5lZEVudGl0eSh3cmFwcGVkUmVmKTsKICAgICAgICAgICAgaWYgKHJlc29sdmVkVmFsdWUgIT09IG51bGwgJiYgcmVzb2x2ZWRWYWx1ZSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgbGV0IHR5cGUgPSB0eXBlb2YgcmVzb2x2ZWRWYWx1ZTsKICAgICAgICAgICAgICBpZiAodHlwZSAhPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYFxgcmVzb2x2ZVVuZGVmaW5lZEVudGl0eSgpXGAgbXVzdCByZXR1cm4gYSBzdHJpbmcsIFxgbnVsbFxgLCBvciBcYHVuZGVmaW5lZFxgLCBidXQgcmV0dXJuZWQgYSB2YWx1ZSBvZiB0eXBlICR7dHlwZX1gKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmVkVmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChpZ25vcmVVbmRlZmluZWRFbnRpdGllcykgewogICAgICAgICAgICByZXR1cm4gd3JhcHBlZFJlZjsKICAgICAgICAgIH0KICAgICAgICAgIHNjYW5uZXIubygtd3JhcHBlZFJlZi5sZW5ndGgpOwogICAgICAgICAgdGhyb3cgdGhpcy5hKGBOYW1lZCBlbnRpdHkgaXNuJ3QgZGVmaW5lZDogJHt3cmFwcGVkUmVmfWApOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcGFyc2VkVmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIENvbnN1bWVzIGEgYFN5c3RlbUxpdGVyYWxgIGlmIHBvc3NpYmxlLgogICAgICoKICAgICAqIEEgYFN5c3RlbUxpdGVyYWxgIGlzIHNpbWlsYXIgdG8gYW4gYXR0cmlidXRlIHZhbHVlLCBidXQgYWxsb3dzIHRoZQogICAgICogY2hhcmFjdGVycyBgPGAgYW5kIGAmYCBhbmQgZG9lc24ndCByZXBsYWNlIHJlZmVyZW5jZXMuCiAgICAgKgogICAgICogQHJldHVybnMKICAgICAqICAgVmFsdWUgb2YgdGhlIGBTeXN0ZW1MaXRlcmFsYCBtaW51cyBxdW90ZXMsIG9yIGBmYWxzZWAgaWYgbm90aGluZyB3YXMKICAgICAqICAgY29uc3VtZWQuIEFuIGVtcHR5IHN0cmluZyBpbmRpY2F0ZXMgdGhhdCBhIGBTeXN0ZW1MaXRlcmFsYCB3YXMgY29uc3VtZWQKICAgICAqICAgYnV0IHdhcyBlbXB0eS4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yMDA4L1JFQy14bWwtMjAwODExMjYvI05ULVN5c3RlbUxpdGVyYWwKICAgICAqLwogICAgcygpIHsKICAgICAgbGV0IHsgYzogc2Nhbm5lciB9ID0gdGhpczsKICAgICAgbGV0IHF1b3RlID0gc2Nhbm5lci5iKCciJykgfHwgc2Nhbm5lci5iKCInIik7CiAgICAgIGlmICghcXVvdGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgbGV0IHZhbHVlID0gc2Nhbm5lci50KHF1b3RlKTsKICAgICAgdGhpcy5wKHZhbHVlKTsKICAgICAgaWYgKCFzY2FubmVyLmIocXVvdGUpKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJNaXNzaW5nIGVuZCBxdW90ZSIpOwogICAgICB9CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3VtZXMgb25lIG9yIG1vcmUgd2hpdGVzcGFjZSBjaGFyYWN0ZXJzIGlmIHBvc3NpYmxlLgogICAgICoKICAgICAqIEByZXR1cm5zIFdoZXRoZXIgYW55IHdoaXRlc3BhY2UgY2hhcmFjdGVycyB3ZXJlIGNvbnN1bWVkLgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyN3aGl0ZQogICAgICovCiAgICBlKCkgewogICAgICByZXR1cm4gISF0aGlzLmMudihpc1doaXRlc3BhY2UpOwogICAgfQogICAgLyoqCiAgICAgKiBDb25zdW1lcyBhbiBYTUwgZGVjbGFyYXRpb24gaWYgcG9zc2libGUuCiAgICAgKgogICAgICogQHJldHVybnMgV2hldGhlciBhbiBYTUwgZGVjbGFyYXRpb24gd2FzIGNvbnN1bWVkLgogICAgICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvMjAwOC9SRUMteG1sLTIwMDgxMTI2LyNOVC1YTUxEZWNsCiAgICAgKi8KICAgIFAoKSB7CiAgICAgIGxldCB7IGM6IHNjYW5uZXIgfSA9IHRoaXM7CiAgICAgIGxldCBzdGFydEluZGV4ID0gc2Nhbm5lci5kOwogICAgICBpZiAoIXNjYW5uZXIuYigiPD94bWwiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAoIXRoaXMuZSgpKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJJbnZhbGlkIFhNTCBkZWNsYXJhdGlvbiIpOwogICAgICB9CiAgICAgIGxldCB2ZXJzaW9uID0gISFzY2FubmVyLmIoInZlcnNpb24iKSAmJiB0aGlzLnUoKSAmJiB0aGlzLnMoKTsKICAgICAgaWYgKHZlcnNpb24gPT09IGZhbHNlKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJYTUwgdmVyc2lvbiBpcyBtaXNzaW5nIG9yIGludmFsaWQiKTsKICAgICAgfSBlbHNlIGlmICghL14xXC5bMC05XSskLy50ZXN0KHZlcnNpb24pKSB7CiAgICAgICAgdGhyb3cgdGhpcy5hKCJJbnZhbGlkIGNoYXJhY3RlciBpbiB2ZXJzaW9uIG51bWJlciIpOwogICAgICB9CiAgICAgIGxldCBlbmNvZGluZzsKICAgICAgbGV0IHN0YW5kYWxvbmU7CiAgICAgIGlmICh0aGlzLmUoKSkgewogICAgICAgIGVuY29kaW5nID0gISFzY2FubmVyLmIoImVuY29kaW5nIikgJiYgdGhpcy51KCkgJiYgdGhpcy5zKCk7CiAgICAgICAgaWYgKGVuY29kaW5nKSB7CiAgICAgICAgICB0aGlzLmUoKTsKICAgICAgICB9CiAgICAgICAgc3RhbmRhbG9uZSA9ICEhc2Nhbm5lci5iKCJzdGFuZGFsb25lIikgJiYgdGhpcy51KCkgJiYgdGhpcy5zKCk7CiAgICAgICAgaWYgKHN0YW5kYWxvbmUpIHsKICAgICAgICAgIGlmIChzdGFuZGFsb25lICE9PSAieWVzIiAmJiBzdGFuZGFsb25lICE9PSAibm8iKSB7CiAgICAgICAgICAgIHRocm93IHRoaXMuYSgnT25seSAieWVzIiBhbmQgIm5vIiBhcmUgcGVybWl0dGVkIGFzIHZhbHVlcyBvZiBgc3RhbmRhbG9uZWAnKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIXNjYW5uZXIuYigiPz4iKSkgewogICAgICAgIHRocm93IHRoaXMuYSgiSW52YWxpZCBvciB1bmNsb3NlZCBYTUwgZGVjbGFyYXRpb24iKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5mLnByZXNlcnZlWG1sRGVjbGFyYXRpb24gPyB0aGlzLmoobmV3IFhtbERlY2xhcmF0aW9uKAogICAgICAgIHZlcnNpb24sCiAgICAgICAgZW5jb2RpbmcgfHwgdm9pZCAwLAogICAgICAgIHN0YW5kYWxvbmUgfHwgdm9pZCAwCiAgICAgICksIHN0YXJ0SW5kZXgpIDogdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbiBgWG1sRXJyb3JgIGZvciB0aGUgY3VycmVudCBzY2FubmVyIHBvc2l0aW9uLgogICAgICovCiAgICBhKG1lc3NhZ2UpIHsKICAgICAgbGV0IHsgYzogc2Nhbm5lciB9ID0gdGhpczsKICAgICAgcmV0dXJuIG5ldyBYbWxFcnJvcihtZXNzYWdlLCBzY2FubmVyLmQsIHNjYW5uZXIubSk7CiAgICB9CiAgICAvKioKICAgICAqIFRocm93cyBhbiBpbnZhbGlkIGNoYXJhY3RlciBlcnJvciBpZiBhbnkgY2hhcmFjdGVyIGluIHRoZSBnaXZlbiBfc3RyaW5nXwogICAgICogaXNuJ3QgYSB2YWxpZCBYTUwgY2hhcmFjdGVyLgogICAgICovCiAgICBwKHN0cmluZykgewogICAgICBsZXQgeyBsZW5ndGggfSA9IHN0cmluZzsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgIGxldCBjcCA9IHN0cmluZy5jb2RlUG9pbnRBdChpKTsKICAgICAgICBpZiAoIWlzWG1sQ29kZVBvaW50KGNwKSkgewogICAgICAgICAgdGhpcy5jLm8oLShbLi4uc3RyaW5nXS5sZW5ndGggLSBpKSk7CiAgICAgICAgICB0aHJvdyB0aGlzLmEoIkludmFsaWQgY2hhcmFjdGVyIik7CiAgICAgICAgfQogICAgICAgIGlmIChjcCA+IDY1NTM1KSB7CiAgICAgICAgICBpICs9IDE7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKICBmdW5jdGlvbiBub3JtYWxpemVMaW5lQnJlYWtzKHRleHQpIHsKICAgIGxldCBpID0gMDsKICAgIHdoaWxlICgoaSA9IHRleHQuaW5kZXhPZigiXHIiLCBpKSkgIT09IC0xKSB7CiAgICAgIHRleHQgPSB0ZXh0W2kgKyAxXSA9PT0gIlxuIiA/IHRleHQuc2xpY2UoMCwgaSkgKyB0ZXh0LnNsaWNlKGkgKyAxKSA6IHRleHQuc2xpY2UoMCwgaSkgKyAiXG4iICsgdGV4dC5zbGljZShpICsgMSk7CiAgICB9CiAgICByZXR1cm4gdGV4dDsKICB9CiAgZnVuY3Rpb24gcGFyc2VYbWwoeG1sLCBvcHRpb25zKSB7CiAgICByZXR1cm4gbmV3IFBhcnNlcih4bWwsIG9wdGlvbnMpLmRvY3VtZW50OwogIH0KICBjbGFzcyBYbWxQYXJzZUVycm9yIGV4dGVuZHMgRXJyb3IgewogICAgY29uc3RydWN0b3IobWVzc2FnZSkgewogICAgICBzdXBlcihtZXNzYWdlKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gcGFyc2VYbWxTdHJpbmcoeG1sU3RyaW5nKSB7CiAgICBsZXQgZG9jID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGRvYyA9IGJyb3dzZXIucGFyc2VYbWwoeG1sU3RyaW5nKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgdGhyb3cgbmV3IFhtbFBhcnNlRXJyb3IoZS5tZXNzYWdlKTsKICAgIH0KICAgIHJldHVybiBkb2M7CiAgfQogIGZ1bmN0aW9uIHN0cmlwTmFtZXNwYWNlKG5hbWUpIHsKICAgIGNvbnN0IGNvbG9uID0gbmFtZS5pbmRleE9mKCI6Iik7CiAgICByZXR1cm4gY29sb24gPiAtMSA/IG5hbWUuc3Vic3RyKGNvbG9uICsgMSkgOiBuYW1lOwogIH0KICBmdW5jdGlvbiBnZXRSb290RWxlbWVudCh4bWxEb2MpIHsKICAgIHJldHVybiB4bWxEb2MuY2hpbGRyZW5bMF07CiAgfQogIGZ1bmN0aW9uIGdldEVsZW1lbnROYW1lKGVsZW1lbnQpIHsKICAgIHJldHVybiBlbGVtZW50Lm5hbWUgfHwgIiI7CiAgfQogIGZ1bmN0aW9uIGZpbmRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCwgbmFtZSwgbmVzdGVkID0gZmFsc2UpIHsKICAgIGNvbnN0IHN0cmlwcGVkTmFtZSA9IHN0cmlwTmFtZXNwYWNlKG5hbWUpOwogICAgZnVuY3Rpb24gcmVkdWNlcihwcmV2LCBjdXJyKSB7CiAgICAgIGlmIChzdHJpcE5hbWVzcGFjZShnZXRFbGVtZW50TmFtZShjdXJyKSkgPT09IHN0cmlwcGVkTmFtZSkgewogICAgICAgIHByZXYucHVzaChjdXJyKTsKICAgICAgfQogICAgICBpZiAobmVzdGVkICYmIEFycmF5LmlzQXJyYXkoY3Vyci5jaGlsZHJlbikpIHsKICAgICAgICByZXR1cm4gWy4uLnByZXYsIC4uLmN1cnIuY2hpbGRyZW4ucmVkdWNlKHJlZHVjZXIsIFtdKV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHByZXY7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBlbGVtZW50ICYmIEFycmF5LmlzQXJyYXkoZWxlbWVudC5jaGlsZHJlbikgPyBlbGVtZW50LmNoaWxkcmVuLnJlZHVjZShyZWR1Y2VyLCBbXSkgOiBbXTsKICB9CiAgZnVuY3Rpb24gZmluZENoaWxkRWxlbWVudChlbGVtZW50LCBuYW1lLCBuZXN0ZWQgPSBmYWxzZSkgewogICAgcmV0dXJuIGZpbmRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCwgbmFtZSwgbmVzdGVkKVswXSB8fCBudWxsOwogIH0KICBmdW5jdGlvbiBnZXRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCkgewogICAgcmV0dXJuIGVsZW1lbnQgJiYgQXJyYXkuaXNBcnJheShlbGVtZW50LmNoaWxkcmVuKSA/IFsKICAgICAgLi4uZWxlbWVudC5jaGlsZHJlbi5maWx0ZXIoCiAgICAgICAgKGVsKSA9PiBlbCBpbnN0YW5jZW9mIGJyb3dzZXIuWG1sRWxlbWVudAogICAgICApCiAgICBdIDogW107CiAgfQogIGZ1bmN0aW9uIGdldEVsZW1lbnRUZXh0KGVsZW1lbnQpIHsKICAgIGNvbnN0IHRleHROb2RlID0gZWxlbWVudCAmJiBBcnJheS5pc0FycmF5KGVsZW1lbnQuY2hpbGRyZW4pID8gZWxlbWVudC5jaGlsZHJlbi5maW5kKChub2RlKSA9PiBub2RlLnR5cGUgPT09ICJ0ZXh0IikgOiBudWxsOwogICAgcmV0dXJuIHRleHROb2RlID8gdGV4dE5vZGUudGV4dCA6ICIiOwogIH0KICBmdW5jdGlvbiBnZXRFbGVtZW50QXR0cmlidXRlKGVsZW1lbnQsIGF0dHJOYW1lKSB7CiAgICByZXR1cm4gZWxlbWVudCAmJiBlbGVtZW50LmF0dHJpYnV0ZXNbYXR0ck5hbWVdIHx8ICIiOwogIH0KICBjbGFzcyBFbmRwb2ludEVycm9yIGV4dGVuZHMgRXJyb3IgewogICAgY29uc3RydWN0b3IobWVzc2FnZSwgaHR0cFN0YXR1cywgaXNDcm9zc09yaWdpblJlbGF0ZWQpIHsKICAgICAgc3VwZXIobWVzc2FnZSk7CiAgICAgIHRoaXMuaHR0cFN0YXR1cyA9IGh0dHBTdGF0dXM7CiAgICAgIHRoaXMuaXNDcm9zc09yaWdpblJlbGF0ZWQgPSBpc0Nyb3NzT3JpZ2luUmVsYXRlZDsKICAgICAgdGhpcy5uYW1lID0gIkVuZHBvaW50RXJyb3IiOwogICAgfQogIH0KICBjbGFzcyBTZXJ2aWNlRXhjZXB0aW9uRXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yCiAgICAgKiBAcGFyYW0gbWVzc2FnZSBFcnJvciBtZXNzYWdlCiAgICAgKiBAcGFyYW0gcmVxdWVzdFVybCBVUkwgd2hpY2ggcmVzdWx0ZWQgaW4gdGhlIFNlcnZpY2VFeGNlcHRpb24KICAgICAqIEBwYXJhbSBjb2RlIE9wdGlvbmFsIFNlcnZpY2VFeGNlcHRpb24gY29kZQogICAgICogQHBhcmFtIGxvY2F0b3IgT3B0aW9uYWwgU2VydmljZUV4Y2VwdGlvbiBsb2NhdG9yCiAgICAgKiBAcGFyYW0gcmVzcG9uc2UgT3B0aW9uYWwgcmVzcG9uc2UgY29udGVudCByZWNlaXZlZAogICAgICovCiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCByZXF1ZXN0VXJsLCBjb2RlLCBsb2NhdG9yLCByZXNwb25zZSkgewogICAgICBzdXBlcihtZXNzYWdlKTsKICAgICAgdGhpcy5yZXF1ZXN0VXJsID0gcmVxdWVzdFVybDsKICAgICAgdGhpcy5jb2RlID0gY29kZTsKICAgICAgdGhpcy5sb2NhdG9yID0gbG9jYXRvcjsKICAgICAgdGhpcy5yZXNwb25zZSA9IHJlc3BvbnNlOwogICAgICB0aGlzLm5hbWUgPSAiU2VydmljZUV4Y2VwdGlvbkVycm9yIjsKICAgIH0KICB9CiAgZnVuY3Rpb24gcGFyc2Uoc2VydmljZUV4Y2VwdGlvbiwgdXJsKSB7CiAgICBjb25zdCBlcnJvckNvZGUgPSBnZXRFbGVtZW50QXR0cmlidXRlKHNlcnZpY2VFeGNlcHRpb24sICJjb2RlIikgfHwgZ2V0RWxlbWVudEF0dHJpYnV0ZShzZXJ2aWNlRXhjZXB0aW9uLCAiZXhjZXB0aW9uQ29kZSIpOwogICAgY29uc3QgZXJyb3JMb2NhdG9yID0gZ2V0RWxlbWVudEF0dHJpYnV0ZShzZXJ2aWNlRXhjZXB0aW9uLCAibG9jYXRvciIpOwogICAgY29uc3QgdGV4dEVsZW1lbnQgPSBmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2VFeGNlcHRpb24sICJFeGNlcHRpb25UZXh0IikgfHwgc2VydmljZUV4Y2VwdGlvbjsKICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGdldEVsZW1lbnRUZXh0KHRleHRFbGVtZW50KS50cmltKCk7CiAgICByZXR1cm4gbmV3IFNlcnZpY2VFeGNlcHRpb25FcnJvcigKICAgICAgZXJyb3JNZXNzYWdlLAogICAgICB1cmwsCiAgICAgIGVycm9yQ29kZSwKICAgICAgZXJyb3JMb2NhdG9yLAogICAgICBzZXJ2aWNlRXhjZXB0aW9uLmRvY3VtZW50CiAgICApOwogIH0KICBmdW5jdGlvbiBjaGVjayhyZXNwb25zZSwgdXJsKSB7CiAgICBjb25zdCByb290RWwgPSBnZXRSb290RWxlbWVudChyZXNwb25zZSk7CiAgICBjb25zdCByb290RWxOYW1lID0gc3RyaXBOYW1lc3BhY2UoZ2V0RWxlbWVudE5hbWUocm9vdEVsKSk7CiAgICBpZiAocm9vdEVsTmFtZSA9PT0gIlNlcnZpY2VFeGNlcHRpb25SZXBvcnQiKSB7CiAgICAgIGNvbnN0IGVycm9yID0gZmluZENoaWxkRWxlbWVudChyb290RWwsICJTZXJ2aWNlRXhjZXB0aW9uIik7CiAgICAgIGlmIChlcnJvcikgewogICAgICAgIHRocm93IHBhcnNlKGVycm9yLCB1cmwpOwogICAgICB9CiAgICB9CiAgICBpZiAocm9vdEVsTmFtZSA9PT0gIkV4Y2VwdGlvblJlcG9ydCIpIHsKICAgICAgY29uc3QgZXJyb3IgPSBmaW5kQ2hpbGRFbGVtZW50KHJvb3RFbCwgIkV4Y2VwdGlvbiIpOwogICAgICBpZiAoZXJyb3IpIHsKICAgICAgICB0aHJvdyBwYXJzZShlcnJvciwgdXJsKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3BvbnNlOwogIH0KICBmdW5jdGlvbiBlbmNvZGVFcnJvcihlcnJvcikgewogICAgY29uc3QgYmFzZSA9IHsKICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSwKICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLAogICAgICBuYW1lOiBlcnJvci5uYW1lCiAgICB9OwogICAgaWYgKGVycm9yIGluc3RhbmNlb2YgU2VydmljZUV4Y2VwdGlvbkVycm9yKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgLi4uYmFzZSwKICAgICAgICBjb2RlOiBlcnJvci5jb2RlLAogICAgICAgIGxvY2F0b3I6IGVycm9yLmxvY2F0b3IsCiAgICAgICAgcmVzcG9uc2U6IGVycm9yLnJlc3BvbnNlLAogICAgICAgIHJlcXVlc3RVcmw6IGVycm9yLnJlcXVlc3RVcmwKICAgICAgfTsKICAgIH0KICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVuZHBvaW50RXJyb3IpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICAuLi5iYXNlLAogICAgICAgIGh0dHBTdGF0dXM6IGVycm9yLmh0dHBTdGF0dXMsCiAgICAgICAgaXNDcm9zc09yaWdpblJlbGF0ZWQ6IGVycm9yLmlzQ3Jvc3NPcmlnaW5SZWxhdGVkCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gYmFzZTsKICB9CiAgY29uc3QgZmFsbGJhY2tFdmVudFRhcmdldCA9IG5ldyBFdmVudFRhcmdldCgpOwogIGZ1bmN0aW9uIGFkZFRhc2tIYW5kbGVyKHRhc2tOYW1lLCBzY29wZSwgaGFuZGxlcikgewogICAgY29uc3QgdXNlV29ya2VyID0gdHlwZW9mIFdvcmtlckdsb2JhbFNjb3BlICE9PSAidW5kZWZpbmVkIjsKICAgIGNvbnN0IGV2ZW50SGFuZGxlciA9IGFzeW5jIChyZXF1ZXN0KSA9PiB7CiAgICAgIGlmIChyZXF1ZXN0LnRhc2tOYW1lID09PSB0YXNrTmFtZSkgewogICAgICAgIGxldCByZXNwb25zZSwgZXJyb3I7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlcihyZXF1ZXN0LnBhcmFtcyk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgZXJyb3IgPSBlbmNvZGVFcnJvcihlKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbWVzc2FnZSA9ICgKICAgICAgICAgIC8qKiBAdHlwZSB7V29ya2VyUmVzcG9uc2V9ICovCiAgICAgICAgICB7CiAgICAgICAgICAgIHRhc2tOYW1lLAogICAgICAgICAgICByZXF1ZXN0SWQ6IHJlcXVlc3QucmVxdWVzdElkLAogICAgICAgICAgICAuLi5yZXNwb25zZSAmJiB7IHJlc3BvbnNlIH0sCiAgICAgICAgICAgIC4uLmVycm9yICYmIHsgZXJyb3IgfQogICAgICAgICAgfQogICAgICAgICk7CiAgICAgICAgaWYgKHVzZVdvcmtlcikgewogICAgICAgICAgc2NvcGUucG9zdE1lc3NhZ2UobWVzc2FnZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZhbGxiYWNrRXZlbnRUYXJnZXQuZGlzcGF0Y2hFdmVudCgKICAgICAgICAgICAgbmV3IEN1c3RvbUV2ZW50KCJvZ2MtY2xpZW50LnJlc3BvbnNlIiwgewogICAgICAgICAgICAgIGRldGFpbDogbWVzc2FnZQogICAgICAgICAgICB9KQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICBpZiAodXNlV29ya2VyKSB7CiAgICAgIHNjb3BlLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCAoZXZlbnQpID0+IGV2ZW50SGFuZGxlcihldmVudC5kYXRhKSk7CiAgICB9IGVsc2UgewogICAgICBmYWxsYmFja0V2ZW50VGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICAgIm9nYy1jbGllbnQucmVxdWVzdCIsCiAgICAgICAgKGV2ZW50KSA9PiBldmVudEhhbmRsZXIoZXZlbnQuZGV0YWlsKQogICAgICApOwogICAgfQogIH0KICBjb25zdCBFTkNPRElOR1MgPSBbInV0Zi04IiwgInV0Zi0xNiIsICJpc28tODg1OS0xIl07CiAgY29uc3QgRkFMTEJBQ0tfRU5DT0RJTkcgPSAidXRmLTgiOwogIGZ1bmN0aW9uIGV4dHJhY3RFbmNvZGluZyhjb250ZW50VHlwZSkgewogICAgY29uc3QgbWF0Y2hlcyA9IC9jaGFyc2V0PShbXjtdKykvLmV4ZWMoY29udGVudFR5cGUpOwogICAgcmV0dXJuIG1hdGNoZXMgPyBtYXRjaGVzWzFdIDogbnVsbDsKICB9CiAgZnVuY3Rpb24gZGVjb2RlU3RyaW5nKGJ1ZmZlciwgY29udGVudFR5cGUpIHsKICAgIGNvbnN0IGVuY29kaW5nSGludCA9IGNvbnRlbnRUeXBlID8gZXh0cmFjdEVuY29kaW5nKGNvbnRlbnRUeXBlKSA6IG51bGw7CiAgICBjb25zdCBlbmNvZGluZ0F0dGVtcHRzID0gZW5jb2RpbmdIaW50ID8gW2VuY29kaW5nSGludCwgLi4uRU5DT0RJTkdTXSA6IEVOQ09ESU5HUzsKICAgIGZvciAoY29uc3QgZW5jb2Rpbmcgb2YgZW5jb2RpbmdBdHRlbXB0cykgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmcsIHsgZmF0YWw6IHRydWUgfSk7CiAgICAgICAgcmV0dXJuIGRlY29kZXIuZGVjb2RlKGJ1ZmZlcik7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgfQogICAgfQogICAgY29uc29sZS53YXJuKAogICAgICBgW29nYy1jbGllbnRdIFhNTCBkb2N1bWVudCBlbmNvZGluZyBjb3VsZCBub3QgYmUgZGV0ZXJtaW5lZCwgZmFsbGluZyBiYWNrIHRvICR7RkFMTEJBQ0tfRU5DT0RJTkd9LmAKICAgICk7CiAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKEZBTExCQUNLX0VOQ09ESU5HKS5kZWNvZGUoYnVmZmVyKTsKICB9CiAgY29uc3QgZmV0Y2hQcm9taXNlcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgbGV0IGZldGNoT3B0aW9ucyA9IHt9OwogIGZ1bmN0aW9uIHNldEZldGNoT3B0aW9ucyhvcHRpb25zKSB7CiAgICBmZXRjaE9wdGlvbnMgPSBvcHRpb25zOwogIH0KICBmdW5jdGlvbiBnZXRGZXRjaE9wdGlvbnMoKSB7CiAgICByZXR1cm4gZmV0Y2hPcHRpb25zOwogIH0KICBmdW5jdGlvbiBzaGFyZWRGZXRjaCh1cmwsIG1ldGhvZCA9ICJHRVQiLCBhc0pzb24pIHsKICAgIGxldCBmZXRjaEtleSA9IGAke21ldGhvZH0jJHt1cmx9YDsKICAgIGlmIChhc0pzb24pIHsKICAgICAgZmV0Y2hLZXkgPSBgJHttZXRob2R9I2FzSnNvbiMke3VybH1gOwogICAgfQogICAgaWYgKGZldGNoUHJvbWlzZXMuaGFzKGZldGNoS2V5KSkgewogICAgICByZXR1cm4gZmV0Y2hQcm9taXNlcy5nZXQoZmV0Y2hLZXkpOwogICAgfQogICAgY29uc3Qgb3B0aW9ucyA9IHsgLi4uZ2V0RmV0Y2hPcHRpb25zKCkgfTsKICAgIG9wdGlvbnMubWV0aG9kID0gbWV0aG9kOwogICAgaWYgKGFzSnNvbikgewogICAgICBvcHRpb25zLmhlYWRlcnMgPSAiaGVhZGVycyIgaW4gb3B0aW9ucyA/IG9wdGlvbnMuaGVhZGVycyA6IHt9OwogICAgICBvcHRpb25zLmhlYWRlcnNbIkFjY2VwdCJdID0gImFwcGxpY2F0aW9uL2pzb24sYXBwbGljYXRpb24vc2NoZW1hK2pzb24iOwogICAgfQogICAgY29uc3QgcHJvbWlzZSA9IGZldGNoKHVybCwgb3B0aW9ucykuY2F0Y2goKGUpID0+IGUpLnRoZW4oKHJlc3ApID0+IHsKICAgICAgZmV0Y2hQcm9taXNlcy5kZWxldGUoZmV0Y2hLZXkpOwogICAgICByZXR1cm4gcmVzcDsKICAgIH0pOwogICAgZmV0Y2hQcm9taXNlcy5zZXQoZmV0Y2hLZXksIHByb21pc2UpOwogICAgcmV0dXJuIHByb21pc2UudGhlbigocmVzcCkgPT4gewogICAgICBpZiAocmVzcCBpbnN0YW5jZW9mIEVycm9yKQogICAgICAgIHRocm93IHJlc3A7CiAgICAgIHJldHVybiByZXNwLmNsb25lKCk7CiAgICB9KTsKICB9CiAgZnVuY3Rpb24gcXVlcnlYbWxEb2N1bWVudCh1cmwpIHsKICAgIHJldHVybiBzaGFyZWRGZXRjaCh1cmwpLmNhdGNoKAogICAgICAoKSA9PiAoCiAgICAgICAgLy8gYXR0ZW1wdCBhIEhFQUQgdG8gc2VlIGlmIHRoZSBmYWlsdXJlIGNvbWVzIGZyb20gQ09SUyBvciB0aGUgc2VydmljZSBpcyBnZW5lcmFsbHkgdW5yZWFjaGFibGUKICAgICAgICBmZXRjaCh1cmwsIHsgLi4uZ2V0RmV0Y2hPcHRpb25zKCksIG1ldGhvZDogIkhFQUQiLCBtb2RlOiAibm8tY29ycyIgfSkuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICB0aHJvdyBuZXcgRW5kcG9pbnRFcnJvcigKICAgICAgICAgICAgYEZldGNoaW5nIHRoZSBkb2N1bWVudCBmYWlsZWQgZWl0aGVyIGR1ZSB0byBuZXR3b3JrIGVycm9ycyBvciB1bnJlYWNoYWJsZSBob3N0LCBlcnJvciBpczogJHtlcnJvci5tZXNzYWdlfWAsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGZhbHNlCiAgICAgICAgICApOwogICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhyb3cgbmV3IEVuZHBvaW50RXJyb3IoCiAgICAgICAgICAgIGBUaGUgZG9jdW1lbnQgY291bGQgbm90IGJlIGZldGNoZWQgZHVlIHRvIENPUlMgbGltaXRhdGlvbnNgLAogICAgICAgICAgICAwLAogICAgICAgICAgICB0cnVlCiAgICAgICAgICApOwogICAgICAgIH0pCiAgICAgICkKICAgICkudGhlbihhc3luYyAocmVzcCkgPT4gewogICAgICBpZiAoIXJlc3Aub2spIHsKICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcC50ZXh0KCk7CiAgICAgICAgdGhyb3cgbmV3IEVuZHBvaW50RXJyb3IoCiAgICAgICAgICBgUmVjZWl2ZWQgYW4gZXJyb3Igd2l0aCBjb2RlICR7cmVzcC5zdGF0dXN9OiAke3RleHR9YCwKICAgICAgICAgIHJlc3Auc3RhdHVzLAogICAgICAgICAgZmFsc2UKICAgICAgICApOwogICAgICB9CiAgICAgIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IHJlc3AuYXJyYXlCdWZmZXIoKTsKICAgICAgY29uc3QgY29udGVudFR5cGVIZWFkZXIgPSByZXNwLmhlYWRlcnMuZ2V0KCJDb250ZW50LVR5cGUiKTsKICAgICAgcmV0dXJuIGRlY29kZVN0cmluZyhidWZmZXIsIGNvbnRlbnRUeXBlSGVhZGVyKTsKICAgIH0pLnRoZW4oKHhtbCkgPT4gcGFyc2VYbWxTdHJpbmcoeG1sKSk7CiAgfQogIGZ1bmN0aW9uIHNldFF1ZXJ5UGFyYW1zKHVybCwgcGFyYW1zKSB7CiAgICBjb25zdCBlbmNvZGVkVXJsTWF0Y2ggPSB1cmwubWF0Y2goLyhodHRwcz8lM0ElMkYlMkZbXi9dKykkLyk7CiAgICBpZiAoZW5jb2RlZFVybE1hdGNoKSB7CiAgICAgIGNvbnN0IGVuY29kZWRVcmwgPSBlbmNvZGVkVXJsTWF0Y2hbMV07CiAgICAgIGNvbnN0IG1vZGlmaWVkVXJsID0gc2V0UXVlcnlQYXJhbXMoZGVjb2RlVVJJQ29tcG9uZW50KGVuY29kZWRVcmwpLCBwYXJhbXMpOwogICAgICByZXR1cm4gdXJsLnJlcGxhY2UoZW5jb2RlZFVybCwgZW5jb2RlVVJJQ29tcG9uZW50KG1vZGlmaWVkVXJsKSk7CiAgICB9CiAgICBjb25zdCB1cmxPYmogPSBuZXcgVVJMKHVybCk7CiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocGFyYW1zKTsKICAgIGNvbnN0IGtleXNMb3dlciA9IGtleXMubWFwKChrZXkpID0+IGtleS50b0xvd2VyQ2FzZSgpKTsKICAgIGNvbnN0IHRvRGVsZXRlID0gW107CiAgICBmb3IgKGNvbnN0IHBhcmFtIG9mIHVybE9iai5zZWFyY2hQYXJhbXMua2V5cygpKSB7CiAgICAgIGlmIChrZXlzTG93ZXIuaW5kZXhPZihwYXJhbS50b0xvd2VyQ2FzZSgpKSA+IC0xKSB7CiAgICAgICAgdG9EZWxldGUucHVzaChwYXJhbSk7CiAgICAgIH0KICAgIH0KICAgIHRvRGVsZXRlLm1hcCgocGFyYW0pID0+IHVybE9iai5zZWFyY2hQYXJhbXMuZGVsZXRlKHBhcmFtKSk7CiAgICBrZXlzLmZvckVhY2goCiAgICAgIChrZXkpID0+IHVybE9iai5zZWFyY2hQYXJhbXMuc2V0KAogICAgICAgIGtleSwKICAgICAgICBwYXJhbXNba2V5XSA9PT0gdHJ1ZSA/ICIiIDogcGFyYW1zW2tleV0KICAgICAgKQogICAgKTsKICAgIHJldHVybiB1cmxPYmoudG9TdHJpbmcoKTsKICB9CiAgY29uc3QgTGF0TG9uQ3JzTGlzdCA9IFsKICAgICJFUFNHOjQwNDYiLAogICAgLy8gUkdSREMgMjAwNQogICAgIkVQU0c6NDA3NSIsCiAgICAvLyBTUkVGOTgKICAgICJFUFNHOjQxMjAiLAogICAgLy8gR3JlZWsKICAgICJFUFNHOjQxMjIiLAogICAgLy8gQVRTNzcKICAgICJFUFNHOjQxMjQiLAogICAgLy8gUlQ5MAogICAgIkVQU0c6NDEyNiIsCiAgICAvLyBMS1M5NCAoRVRSUzg5KQogICAgIkVQU0c6NDE0OSIsCiAgICAvLyBDSDE5MDMKICAgICJFUFNHOjQxNTEiLAogICAgLy8gQ0hUUkY5NQogICAgIkVQU0c6NDE1MyIsCiAgICAvLyBSYXNzYWRpcmFuCiAgICAiRVBTRzo0MTU1IiwKICAgIC8vIERhYm9sYSAxOTgxCiAgICAiRVBTRzo0MTU3IiwKICAgIC8vIE1vdW50IERpbGxvbgogICAgIkVQU0c6NDE1OSIsCiAgICAvLyBFTEQ3OQogICAgIkVQU0c6NDE2MSIsCiAgICAvLyBQYW1wYSBkZWwgQ2FzdGlsbG8KICAgICJFUFNHOjQxNjMiLAogICAgLy8gWWVtZW4gTkdOOTYKICAgICJFUFNHOjQxNjUiLAogICAgLy8gQmlzc2F1CiAgICAiRVBTRzo0MTY3IiwKICAgIC8vIE5aR0QyMDAwCiAgICAiRVBTRzo0MTY5IiwKICAgIC8vIEFtZXJpY2FuIFNhbW9hIDE5NjIKICAgICJFUFNHOjQxNzEiLAogICAgLy8gUkdGOTMKICAgICJFUFNHOjQxNzMiLAogICAgLy8gSVJFTkVUOTUKICAgICJFUFNHOjQxNzUiLAogICAgLy8gU2llcnJhIExlb25lIDE5NjgKICAgICJFUFNHOjQxNzgiLAogICAgLy8gUHVsa292byAxOTQyKDgzKQogICAgIkVQU0c6NDE4MCIsCiAgICAvLyBFU1Q5NwogICAgIkVQU0c6NDE4MiIsCiAgICAvLyBBem9yZXMgT2NjaWRlbnRhbCAxOTM5CiAgICAiRVBTRzo0MTg0IiwKICAgIC8vIEF6b3JlcyBPcmllbnRhbCAxOTQwCiAgICAiRVBTRzo0MTg4IiwKICAgIC8vIE9TTkkgMTk1MgogICAgIkVQU0c6NDE5MCIsCiAgICAvLyBQT1NHQVIgOTgKICAgICJFUFNHOjQxOTEiLAogICAgLy8gQWxiYW5pYW4gMTk4NwogICAgIkVQU0c6NDE5NiIsCiAgICAvLyBBbW1hc3NhbGlrIDE5NTgKICAgICJFUFNHOjQxOTgiLAogICAgLy8gS291c3NlcmkKICAgICJFUFNHOjQyMDIiLAogICAgLy8gQUdENjYKICAgICJFUFNHOjQyMTAiLAogICAgLy8gQXJjIDE5NjAKICAgICJFUFNHOjQyMTEiLAogICAgLy8gQmF0YXZpYQogICAgIkVQU0c6NDIxNCIsCiAgICAvLyBCZWlqaW5nIDE5NTQKICAgICJFUFNHOjQyMjYiLAogICAgLy8gQ290ZSBkJ0l2b2lyZQogICAgIkVQU0c6NDIyOSIsCiAgICAvLyBFZ3lwdCAxOTA3CiAgICAiRVBTRzo0MjMxIiwKICAgIC8vIEVEODcKICAgICJFUFNHOjQyMzMiLAogICAgLy8gR2FuZGFqaWthIDE5NzAKICAgICJFUFNHOjQyMzYiLAogICAgLy8gSHUgVHp1IFNoYW4gMTk1MAogICAgIkVQU0c6NDIzOCIsCiAgICAvLyBJRDc0CiAgICAiRVBTRzo0MjQwIiwKICAgIC8vIEluZGlhbiAxOTc1CiAgICAiRVBTRzo0MjQyIiwKICAgIC8vIEpBRDY5CiAgICAiRVBTRzo0MjQ0IiwKICAgIC8vIEthbmRhd2FsYQogICAgIkVQU0c6NDI0NiIsCiAgICAvLyBLT0MKICAgICJFUFNHOjQyNDgiLAogICAgLy8gUFNBRDU2CiAgICAiRVBTRzo0MjUwIiwKICAgIC8vIExlaWdvbgogICAgIkVQU0c6NDI1MiIsCiAgICAvLyBMb21lCiAgICAiRVBTRzo0MjU1IiwKICAgIC8vIEhlcmF0IE5vcnRoCiAgICAiRVBTRzo0MjU4IiwKICAgIC8vIEVUUlM4OQogICAgIkVQU0c6NDI2MSIsCiAgICAvLyBNZXJjaGljaAogICAgIkVQU0c6NDI2NCIsCiAgICAvLyBNaGFzdAogICAgIkVQU0c6NDI2NyIsCiAgICAvLyBOQUQyNwogICAgIkVQU0c6NDI3MCIsCiAgICAvLyBOYWhyd2FuIDE5NjcKICAgICJFUFNHOjQyNzMiLAogICAgLy8gTkdPIDE5NDgKICAgICJFUFNHOjQyNzYiLAogICAgLy8gTlNXQyA5Wi0yCiAgICAiRVBTRzo0Mjc5IiwKICAgIC8vIE9TKFNOKTgwCiAgICAiRVBTRzo0MjgxIiwKICAgIC8vIFBhbGVzdGluZSAxOTIzCiAgICAiRVBTRzo0Mjg0IiwKICAgIC8vIFB1bGtvdm8gMTk0MgogICAgIkVQU0c6NDI4NiIsCiAgICAvLyBRYXRhciAxOTQ4CiAgICAiRVBTRzo0Mjg4IiwKICAgIC8vIExvbWEgUXVpbnRhbmEKICAgICJFUFNHOjQyOTIiLAogICAgLy8gU2FwcGVyIEhpbGwgMTk0MwogICAgIkVQU0c6NDI5NSIsCiAgICAvLyBTZXJpbmR1bmcKICAgICJFUFNHOjQyOTciLAogICAgLy8gVGFuYW5hcml2ZQogICAgIkVQU0c6NDI5OSIsCiAgICAvLyBUTTY1CiAgICAiRVBTRzo0MzAyIiwKICAgIC8vIFRyaW5pZGFkIDE5MDMKICAgICJFUFNHOjQzMjQiLAogICAgLy8gV0dTIDcyQkUKICAgICJFUFNHOjQzMjYiCiAgICAvLyBXR1MgODQKICBdOwogIGZ1bmN0aW9uIGhhc0ludmVydGVkQ29vcmRpbmF0ZXMoY3JzTmFtZSkgewogICAgcmV0dXJuIExhdExvbkNyc0xpc3QuaW5kZXhPZihzaW1wbGlmeUVwc2dVcm4oY3JzTmFtZSkpID4gLTE7CiAgfQogIGZ1bmN0aW9uIHNpbXBsaWZ5RXBzZ1VybihmdWxsQ3JzTmFtZSkgewogICAgaWYgKC9edXJuOig/OngtKT9vZ2M6ZGVmOmNyczplcHNnOi8udGVzdChmdWxsQ3JzTmFtZS50b0xvd2VyQ2FzZSgpKSkgewogICAgICBjb25zdCBjb2RlID0gLyhbMC05XSspJC8uZXhlYyhmdWxsQ3JzTmFtZSlbMV07CiAgICAgIHJldHVybiBgRVBTRzoke2NvZGV9YDsKICAgIH0KICAgIHJldHVybiBmdWxsQ3JzTmFtZTsKICB9CiAgZnVuY3Rpb24gcmVhZE9wZXJhdGlvblVybHNGcm9tQ2FwYWJpbGl0aWVzJDEoY2FwYWJpbGl0aWVzRG9jKSB7CiAgICBjb25zdCB1cmxzID0ge307CiAgICBjb25zdCBjYXBhYmlsaXR5ID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwKICAgICAgIkNhcGFiaWxpdHkiCiAgICApOwogICAgY29uc3QgcmVxdWVzdCA9IGZpbmRDaGlsZEVsZW1lbnQoY2FwYWJpbGl0eSwgIlJlcXVlc3QiKTsKICAgIGdldENoaWxkcmVuRWxlbWVudChyZXF1ZXN0KS5mb3JFYWNoKChvcGVyYXRpb24pID0+IHsKICAgICAgY29uc3Qgb3BlcmF0aW9uTmFtZSA9IHN0cmlwTmFtZXNwYWNlKGdldEVsZW1lbnROYW1lKG9wZXJhdGlvbikpOwogICAgICB1cmxzW29wZXJhdGlvbk5hbWVdID0gcGFyc2VPcGVyYXRpb24ob3BlcmF0aW9uKTsKICAgIH0pOwogICAgcmV0dXJuIHVybHM7CiAgfQogIGZ1bmN0aW9uIHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyQxKGNhcGFiaWxpdGllc0RvYykgewogICAgcmV0dXJuIGdldFJvb3RFbGVtZW50KGNhcGFiaWxpdGllc0RvYykuYXR0cmlidXRlc1sidmVyc2lvbiJdOwogIH0KICBmdW5jdGlvbiByZWFkTGF5ZXJzRnJvbUNhcGFiaWxpdGllcyQxKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3QgdmVyc2lvbiA9IHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyQxKGNhcGFiaWxpdGllc0RvYyk7CiAgICBjb25zdCBjYXBhYmlsaXR5ID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwKICAgICAgIkNhcGFiaWxpdHkiCiAgICApOwogICAgcmV0dXJuIGZpbmRDaGlsZHJlbkVsZW1lbnQoY2FwYWJpbGl0eSwgIkxheWVyIikubWFwKAogICAgICAobGF5ZXJFbCkgPT4gcGFyc2VMYXllcihsYXllckVsLCB2ZXJzaW9uKQogICAgKTsKICB9CiAgZnVuY3Rpb24gcmVhZE91dHB1dEZvcm1hdHNGcm9tQ2FwYWJpbGl0aWVzJDEoY2FwYWJpbGl0aWVzRG9jKSB7CiAgICBjb25zdCBjYXBhYmlsaXR5ID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwKICAgICAgIkNhcGFiaWxpdHkiCiAgICApOwogICAgY29uc3QgZ2V0TWFwID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgZmluZENoaWxkRWxlbWVudChjYXBhYmlsaXR5LCAiUmVxdWVzdCIpLAogICAgICAiR2V0TWFwIgogICAgKTsKICAgIGNvbnN0IG91dHB1dEZvcm1hdHMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGdldE1hcCwgIkZvcm1hdCIpLm1hcCgKICAgICAgZ2V0RWxlbWVudFRleHQKICAgICk7CiAgICByZXR1cm4gb3V0cHV0Rm9ybWF0czsKICB9CiAgZnVuY3Rpb24gcmVhZEluZm9Gb3JtYXRzRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpIHsKICAgIGNvbnN0IGNhcGFiaWxpdHkgPSBmaW5kQ2hpbGRFbGVtZW50KAogICAgICBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLAogICAgICAiQ2FwYWJpbGl0eSIKICAgICk7CiAgICBjb25zdCBnZXRGZWF0dXJlSW5mbyA9IGZpbmRDaGlsZEVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQoY2FwYWJpbGl0eSwgIlJlcXVlc3QiKSwKICAgICAgIkdldEZlYXR1cmVJbmZvIgogICAgKTsKICAgIGNvbnN0IG91dHB1dEZvcm1hdHMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGdldEZlYXR1cmVJbmZvLCAiRm9ybWF0IikubWFwKAogICAgICBnZXRFbGVtZW50VGV4dAogICAgKTsKICAgIHJldHVybiBvdXRwdXRGb3JtYXRzOwogIH0KICBmdW5jdGlvbiByZWFkRXhjZXB0aW9uRm9ybWF0c0Zyb21DYXBhYmlsaXRpZXMoY2FwYWJpbGl0aWVzRG9jKSB7CiAgICBjb25zdCBjYXBhYmlsaXR5ID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwKICAgICAgIkNhcGFiaWxpdHkiCiAgICApOwogICAgY29uc3QgZXhjZXB0aW9uID0gZmluZENoaWxkRWxlbWVudChjYXBhYmlsaXR5LCAiRXhjZXB0aW9uIik7CiAgICBjb25zdCBleGNlcHRpb25Gb3JtYXRzID0gZmluZENoaWxkcmVuRWxlbWVudChleGNlcHRpb24sICJGb3JtYXQiKS5tYXAoCiAgICAgIGdldEVsZW1lbnRUZXh0CiAgICApOwogICAgcmV0dXJuIGV4Y2VwdGlvbkZvcm1hdHM7CiAgfQogIGZ1bmN0aW9uIHJlYWRJbmZvRnJvbUNhcGFiaWxpdGllcyQyKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3Qgc2VydmljZSA9IGZpbmRDaGlsZEVsZW1lbnQoZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwgIlNlcnZpY2UiKTsKICAgIGNvbnN0IG91dHB1dEZvcm1hdHMgPSByZWFkT3V0cHV0Rm9ybWF0c0Zyb21DYXBhYmlsaXRpZXMkMShjYXBhYmlsaXRpZXNEb2MpOwogICAgY29uc3QgaW5mb0Zvcm1hdHMgPSByZWFkSW5mb0Zvcm1hdHNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYyk7CiAgICBjb25zdCBleGNlcHRpb25Gb3JtYXRzID0gcmVhZEV4Y2VwdGlvbkZvcm1hdHNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYyk7CiAgICBjb25zdCBrZXl3b3JkcyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIktleXdvcmRMaXN0IiksCiAgICAgICJLZXl3b3JkIgogICAgKS5tYXAoZ2V0RWxlbWVudFRleHQpLmZpbHRlcigodiwgaSwgYXJyKSA9PiBhcnIuaW5kZXhPZih2KSA9PT0gaSk7CiAgICBjb25zdCBwcm92aWRlciA9IHJlYWRQcm92aWRlckZyb21DYXBhYmlsaXRpZXMkMShjYXBhYmlsaXRpZXNEb2MpOwogICAgcmV0dXJuIHsKICAgICAgdGl0bGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIlRpdGxlIikpLAogICAgICBuYW1lOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJOYW1lIikpLAogICAgICBhYnN0cmFjdDogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzZXJ2aWNlLCAiQWJzdHJhY3QiKSksCiAgICAgIG91dHB1dEZvcm1hdHMsCiAgICAgIGluZm9Gb3JtYXRzLAogICAgICBleGNlcHRpb25Gb3JtYXRzLAogICAgICBmZWVzOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJGZWVzIikpLAogICAgICBjb25zdHJhaW50czogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzZXJ2aWNlLCAiQWNjZXNzQ29uc3RyYWludHMiKSksCiAgICAgIHByb3ZpZGVyLAogICAgICBrZXl3b3JkcwogICAgfTsKICB9CiAgZnVuY3Rpb24gcGFyc2VPcGVyYXRpb24ob3BlcmF0aW9uKSB7CiAgICBjb25zdCB1cmxzID0ge307CiAgICBjb25zdCBkY3BUeXBlID0gZmluZENoaWxkcmVuRWxlbWVudChvcGVyYXRpb24sICJEQ1BUeXBlIik7CiAgICBjb25zdCBodHRwID0gZGNwVHlwZS5mbGF0TWFwKChkKSA9PiBmaW5kQ2hpbGRFbGVtZW50KGQsICJIVFRQIikpOwogICAgY29uc3QgbWV0aG9kcyA9IGh0dHAuZmxhdE1hcCgoaCkgPT4gZ2V0Q2hpbGRyZW5FbGVtZW50KGgpKTsKICAgIG1ldGhvZHMuZm9yRWFjaCgobWV0aG9kKSA9PiB7CiAgICAgIGNvbnN0IG9ubGluZVJlc291cmNlID0gZmluZENoaWxkRWxlbWVudChtZXRob2QsICJPbmxpbmVSZXNvdXJjZSIpOwogICAgICBjb25zdCBtZXRob2ROYW1lID0gc3RyaXBOYW1lc3BhY2UoZ2V0RWxlbWVudE5hbWUobWV0aG9kKSk7CiAgICAgIHVybHNbbWV0aG9kTmFtZV0gPSBnZXRFbGVtZW50QXR0cmlidXRlKG9ubGluZVJlc291cmNlLCAieGxpbms6aHJlZiIpOwogICAgfSk7CiAgICByZXR1cm4gdXJsczsKICB9CiAgZnVuY3Rpb24gcGFyc2VMYXllcihsYXllckVsLCB2ZXJzaW9uLCBpbmhlcml0ZWRTcnMgPSBbXSwgaW5oZXJpdGVkU3R5bGVzID0gW10sIGluaGVyaXRlZEF0dHJpYnV0aW9uID0gbnVsbCwgaW5oZXJpdGVkQm91bmRpbmdCb3hlcyA9IG51bGwsIGluaGVyaXRlZE1heFNjYWxlRGVub20gPSBudWxsLCBpbmhlcml0ZWRNaW5TY2FsZURlbm9tID0gbnVsbCkgewogICAgY29uc3Qgc3JzVGFnID0gdmVyc2lvbiA9PT0gIjEuMy4wIiA/ICJDUlMiIDogIlNSUyI7CiAgICBjb25zdCBzcnNMaXN0ID0gZmluZENoaWxkcmVuRWxlbWVudChsYXllckVsLCBzcnNUYWcpLm1hcChnZXRFbGVtZW50VGV4dCk7CiAgICBjb25zdCBhdmFpbGFibGVDcnMgPSBzcnNMaXN0Lmxlbmd0aCA+IDAgPyBzcnNMaXN0IDogaW5oZXJpdGVkU3JzOwogICAgY29uc3QgbGF5ZXJTdHlsZXMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGxheWVyRWwsICJTdHlsZSIpLm1hcCgKICAgICAgcGFyc2VMYXllclN0eWxlCiAgICApOwogICAgY29uc3Qgc3R5bGVzID0gbGF5ZXJTdHlsZXMubGVuZ3RoID4gMCA/IGxheWVyU3R5bGVzIDogaW5oZXJpdGVkU3R5bGVzOwogICAgZnVuY3Rpb24gcGFyc2VCQm94MihiYm94RWwpIHsKICAgICAgY29uc3Qgc3JzID0gZ2V0RWxlbWVudEF0dHJpYnV0ZShiYm94RWwsIHNyc1RhZyk7CiAgICAgIGNvbnN0IGF0dHJzID0gaGFzSW52ZXJ0ZWRDb29yZGluYXRlcyhzcnMpICYmIHZlcnNpb24gPT09ICIxLjMuMCIgPyBbIm1pbnkiLCAibWlueCIsICJtYXh5IiwgIm1heHgiXSA6IFsibWlueCIsICJtaW55IiwgIm1heHgiLCAibWF4eSJdOwogICAgICByZXR1cm4gYXR0cnMubWFwKChuYW1lKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGJib3hFbCwgbmFtZSkpOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VFeEdlb2dyYXBoaWNCb3VuZGluZ0JveChiYm94RWwpIHsKICAgICAgcmV0dXJuIFsKICAgICAgICAid2VzdEJvdW5kTG9uZ2l0dWRlIiwKICAgICAgICAic291dGhCb3VuZExhdGl0dWRlIiwKICAgICAgICAiZWFzdEJvdW5kTG9uZ2l0dWRlIiwKICAgICAgICAibm9ydGhCb3VuZExhdGl0dWRlIgogICAgICBdLm1hcCgobmFtZSkgPT4gZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChiYm94RWwsIG5hbWUpKSk7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZUxhdExvbkJvdW5kaW5nQm94KGJib3hFbCkgewogICAgICByZXR1cm4gWyJtaW54IiwgIm1pbnkiLCAibWF4eCIsICJtYXh5Il0ubWFwKAogICAgICAgIChuYW1lKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGJib3hFbCwgbmFtZSkKICAgICAgKTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlU2NhbGVIaW50VmFsdWUodGV4dFZhbHVlLCBkZWZhdWx0VmFsdWUpIHsKICAgICAgaWYgKHRleHRWYWx1ZSA9PT0gIiIpIHsKICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogICAgICB9CiAgICAgIHJldHVybiBNYXRoLnNxcnQoMC41ICogcGFyc2VGbG9hdCh0ZXh0VmFsdWUpICoqIDIpIC8gMjhlLTU7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZVNjYWxlSGludCgpIHsKICAgICAgY29uc3Qgc2NhbGVIaW50ID0gZmluZENoaWxkRWxlbWVudChsYXllckVsLCAiU2NhbGVIaW50Iik7CiAgICAgIGlmICghc2NhbGVIaW50KSB7CiAgICAgICAgcmV0dXJuIFtpbmhlcml0ZWRNaW5TY2FsZURlbm9tLCBpbmhlcml0ZWRNYXhTY2FsZURlbm9tXTsKICAgICAgfQogICAgICBjb25zdCBtaW4gPSBnZXRFbGVtZW50QXR0cmlidXRlKHNjYWxlSGludCwgIm1pbiIpOwogICAgICBjb25zdCBtYXggPSBnZXRFbGVtZW50QXR0cmlidXRlKHNjYWxlSGludCwgIm1heCIpOwogICAgICByZXR1cm4gWwogICAgICAgIHBhcnNlU2NhbGVIaW50VmFsdWUobWluLCBpbmhlcml0ZWRNaW5TY2FsZURlbm9tKSwKICAgICAgICBwYXJzZVNjYWxlSGludFZhbHVlKG1heCwgaW5oZXJpdGVkTWF4U2NhbGVEZW5vbSkKICAgICAgXTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlU2NhbGVEZW5vbWluYXRvcihuYW1lLCBpbmhlcml0ZWRWYWx1ZSkgewogICAgICBjb25zdCB0ZXh0VmFsdWUgPSBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGxheWVyRWwsIG5hbWUpKTsKICAgICAgcmV0dXJuIHRleHRWYWx1ZSA9PT0gIiIgPyBpbmhlcml0ZWRWYWx1ZSA6IHBhcnNlRmxvYXQodGV4dFZhbHVlKTsKICAgIH0KICAgIGNvbnN0IGF0dHJpYnV0aW9uRWwgPSBmaW5kQ2hpbGRFbGVtZW50KGxheWVyRWwsICJBdHRyaWJ1dGlvbiIpOwogICAgY29uc3QgYXR0cmlidXRpb24gPSBhdHRyaWJ1dGlvbkVsICE9PSBudWxsID8gcGFyc2VMYXllckF0dHJpYnV0aW9uKGF0dHJpYnV0aW9uRWwpIDogaW5oZXJpdGVkQXR0cmlidXRpb247CiAgICBjb25zdCBsYXRMb25CYm94RWwgPSB2ZXJzaW9uID09PSAiMS4zLjAiID8gZmluZENoaWxkRWxlbWVudChsYXllckVsLCAiRVhfR2VvZ3JhcGhpY0JvdW5kaW5nQm94IikgOiBmaW5kQ2hpbGRFbGVtZW50KGxheWVyRWwsICJMYXRMb25Cb3VuZGluZ0JveCIpOwogICAgY29uc3QgYmFzZUJvdW5kaW5nQm94ID0ge307CiAgICBpZiAobGF0TG9uQmJveEVsKSB7CiAgICAgIGJhc2VCb3VuZGluZ0JveFsiRVBTRzo0MzI2Il0gPSB2ZXJzaW9uID09PSAiMS4zLjAiID8gcGFyc2VFeEdlb2dyYXBoaWNCb3VuZGluZ0JveChsYXRMb25CYm94RWwpIDogcGFyc2VMYXRMb25Cb3VuZGluZ0JveChsYXRMb25CYm94RWwpOwogICAgfQogICAgbGV0IGJvdW5kaW5nQm94ZXMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGxheWVyRWwsICJCb3VuZGluZ0JveCIpLnJlZHVjZSgKICAgICAgKHByZXYsIGJib3hFbCkgPT4gKHsKICAgICAgICAuLi5wcmV2LAogICAgICAgIFtnZXRFbGVtZW50QXR0cmlidXRlKGJib3hFbCwgc3JzVGFnKV06IHBhcnNlQkJveDIoYmJveEVsKQogICAgICB9KSwKICAgICAgYmFzZUJvdW5kaW5nQm94CiAgICApOwogICAgYm91bmRpbmdCb3hlcyA9IE9iamVjdC5rZXlzKGJvdW5kaW5nQm94ZXMpLmxlbmd0aCA+IDAgfHwgaW5oZXJpdGVkQm91bmRpbmdCb3hlcyA9PT0gbnVsbCA/IGJvdW5kaW5nQm94ZXMgOiBpbmhlcml0ZWRCb3VuZGluZ0JveGVzOwogICAgY29uc3QgcXVlcnlhYmxlID0gbGF5ZXJFbC5hdHRyaWJ1dGVzLnF1ZXJ5YWJsZSA9PT0gIjEiIHx8IGxheWVyRWwuYXR0cmlidXRlcy5xdWVyeWFibGUgPT09ICJ0cnVlIiA/IHRydWUgOiBmYWxzZTsKICAgIGNvbnN0IG9wYXF1ZSA9IGxheWVyRWwuYXR0cmlidXRlcy5vcGFxdWUgPT09ICIxIiB8fCBsYXllckVsLmF0dHJpYnV0ZXMub3BhcXVlID09PSAidHJ1ZSIgPyB0cnVlIDogZmFsc2U7CiAgICBjb25zdCBrZXl3b3JkcyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQobGF5ZXJFbCwgIktleXdvcmRMaXN0IiksCiAgICAgICJLZXl3b3JkIgogICAgKS5tYXAoZ2V0RWxlbWVudFRleHQpLmZpbHRlcigodiwgaSwgYXJyKSA9PiBhcnIuaW5kZXhPZih2KSA9PT0gaSk7CiAgICBsZXQgbWluU2NhbGVEZW5vbWluYXRvciwgbWF4U2NhbGVEZW5vbWluYXRvcjsKICAgIGlmICh2ZXJzaW9uID09PSAiMS4zLjAiKSB7CiAgICAgIG1pblNjYWxlRGVub21pbmF0b3IgPSBwYXJzZVNjYWxlRGVub21pbmF0b3IoCiAgICAgICAgIk1pblNjYWxlRGVub21pbmF0b3IiLAogICAgICAgIGluaGVyaXRlZE1pblNjYWxlRGVub20KICAgICAgKTsKICAgICAgbWF4U2NhbGVEZW5vbWluYXRvciA9IHBhcnNlU2NhbGVEZW5vbWluYXRvcigKICAgICAgICAiTWF4U2NhbGVEZW5vbWluYXRvciIsCiAgICAgICAgaW5oZXJpdGVkTWF4U2NhbGVEZW5vbQogICAgICApOwogICAgfSBlbHNlIHsKICAgICAgW21pblNjYWxlRGVub21pbmF0b3IsIG1heFNjYWxlRGVub21pbmF0b3JdID0gcGFyc2VTY2FsZUhpbnQoKTsKICAgIH0KICAgIGNvbnN0IG1ldGFkYXRhID0gZmluZENoaWxkcmVuRWxlbWVudChsYXllckVsLCAiTWV0YWRhdGFVUkwiKS5tYXAoCiAgICAgIChtZXRhZGF0YVVybEVsKSA9PiAoewogICAgICAgIHR5cGU6IGdldEVsZW1lbnRBdHRyaWJ1dGUobWV0YWRhdGFVcmxFbCwgInR5cGUiKSwKICAgICAgICBmb3JtYXQ6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQobWV0YWRhdGFVcmxFbCwgIkZvcm1hdCIpKSwKICAgICAgICB1cmw6IGdldEVsZW1lbnRBdHRyaWJ1dGUoCiAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KG1ldGFkYXRhVXJsRWwsICJPbmxpbmVSZXNvdXJjZSIpLAogICAgICAgICAgInhsaW5rOmhyZWYiCiAgICAgICAgKQogICAgICB9KQogICAgKTsKICAgIGNvbnN0IGNoaWxkcmVuID0gZmluZENoaWxkcmVuRWxlbWVudChsYXllckVsLCAiTGF5ZXIiKS5tYXAoCiAgICAgIChsYXllcikgPT4gcGFyc2VMYXllcigKICAgICAgICBsYXllciwKICAgICAgICB2ZXJzaW9uLAogICAgICAgIGF2YWlsYWJsZUNycywKICAgICAgICBzdHlsZXMsCiAgICAgICAgYXR0cmlidXRpb24sCiAgICAgICAgYm91bmRpbmdCb3hlcywKICAgICAgICBtYXhTY2FsZURlbm9taW5hdG9yLAogICAgICAgIG1pblNjYWxlRGVub21pbmF0b3IKICAgICAgKQogICAgKTsKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQobGF5ZXJFbCwgIk5hbWUiKSksCiAgICAgIHRpdGxlOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGxheWVyRWwsICJUaXRsZSIpKSwKICAgICAgYWJzdHJhY3Q6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQobGF5ZXJFbCwgIkFic3RyYWN0IikpLAogICAgICBhdmFpbGFibGVDcnMsCiAgICAgIHN0eWxlcywKICAgICAgYXR0cmlidXRpb24sCiAgICAgIGJvdW5kaW5nQm94ZXMsCiAgICAgIGtleXdvcmRzLAogICAgICBxdWVyeWFibGUsCiAgICAgIG9wYXF1ZSwKICAgICAgLi4ubWluU2NhbGVEZW5vbWluYXRvciAhPT0gbnVsbCA/IHsgbWluU2NhbGVEZW5vbWluYXRvciB9IDoge30sCiAgICAgIC4uLm1heFNjYWxlRGVub21pbmF0b3IgIT09IG51bGwgPyB7IG1heFNjYWxlRGVub21pbmF0b3IgfSA6IHt9LAogICAgICAuLi5tZXRhZGF0YS5sZW5ndGggJiYgeyBtZXRhZGF0YSB9LAogICAgICAuLi5jaGlsZHJlbi5sZW5ndGggJiYgeyBjaGlsZHJlbiB9CiAgICB9OwogIH0KICBmdW5jdGlvbiBwYXJzZUxheWVyU3R5bGUoc3R5bGVFbCkgewogICAgY29uc3QgbGVnZW5kVXJsID0gZ2V0RWxlbWVudEF0dHJpYnV0ZSgKICAgICAgZmluZENoaWxkRWxlbWVudChmaW5kQ2hpbGRFbGVtZW50KHN0eWxlRWwsICJMZWdlbmRVUkwiKSwgIk9ubGluZVJlc291cmNlIiksCiAgICAgICJ4bGluazpocmVmIgogICAgKTsKICAgIGNvbnN0IGFic3RyYWN0ID0gZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzdHlsZUVsLCAiQWJzdHJhY3QiKSk7CiAgICByZXR1cm4gewogICAgICBuYW1lOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHN0eWxlRWwsICJOYW1lIikpLAogICAgICB0aXRsZTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzdHlsZUVsLCAiVGl0bGUiKSksCiAgICAgIC4uLmFic3RyYWN0ICYmIHsgYWJzdHJhY3QgfSwKICAgICAgLi4ubGVnZW5kVXJsICYmIHsgbGVnZW5kVXJsIH0KICAgIH07CiAgfQogIGZ1bmN0aW9uIHBhcnNlTGF5ZXJBdHRyaWJ1dGlvbihhdHRyaWJ1dGlvbkVsKSB7CiAgICBjb25zdCBsb2dvVXJsID0gZ2V0RWxlbWVudEF0dHJpYnV0ZSgKICAgICAgZmluZENoaWxkRWxlbWVudCgKICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGF0dHJpYnV0aW9uRWwsICJMb2dvVVJMIiksCiAgICAgICAgIk9ubGluZVJlc291cmNlIgogICAgICApLAogICAgICAieGxpbms6aHJlZiIKICAgICk7CiAgICBjb25zdCB1cmwgPSBnZXRFbGVtZW50QXR0cmlidXRlKAogICAgICBmaW5kQ2hpbGRFbGVtZW50KGF0dHJpYnV0aW9uRWwsICJPbmxpbmVSZXNvdXJjZSIpLAogICAgICAieGxpbms6aHJlZiIKICAgICk7CiAgICBjb25zdCB0aXRsZSA9IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoYXR0cmlidXRpb25FbCwgIlRpdGxlIikpOwogICAgcmV0dXJuIHsKICAgICAgLi4udGl0bGUgJiYgeyB0aXRsZSB9LAogICAgICAuLi51cmwgJiYgeyB1cmwgfSwKICAgICAgLi4ubG9nb1VybCAmJiB7IGxvZ29VcmwgfQogICAgfTsKICB9CiAgZnVuY3Rpb24gcmVhZFByb3ZpZGVyRnJvbUNhcGFiaWxpdGllcyQxKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3Qgc2VydmljZSA9IGZpbmRDaGlsZEVsZW1lbnQoZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKSwgIlNlcnZpY2UiKTsKICAgIGNvbnN0IGNvbnRhY3RJbmZvcm1hdGlvbiA9IGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIkNvbnRhY3RJbmZvcm1hdGlvbiIpOwogICAgY29uc3QgY29udGFjdFBlcnNvblByaW1hcnkgPSBmaW5kQ2hpbGRFbGVtZW50KAogICAgICBjb250YWN0SW5mb3JtYXRpb24sCiAgICAgICJDb250YWN0UGVyc29uUHJpbWFyeSIKICAgICk7CiAgICBjb25zdCBhZGRyZXNzID0gZmluZENoaWxkRWxlbWVudChjb250YWN0SW5mb3JtYXRpb24sICJDb250YWN0QWRkcmVzcyIpOwogICAgcmV0dXJuIHsKICAgICAgY29udGFjdDogewogICAgICAgIG5hbWU6IGdldEVsZW1lbnRUZXh0KAogICAgICAgICAgZmluZENoaWxkRWxlbWVudChjb250YWN0UGVyc29uUHJpbWFyeSwgIkNvbnRhY3RQZXJzb24iKQogICAgICAgICksCiAgICAgICAgb3JnYW5pemF0aW9uOiBnZXRFbGVtZW50VGV4dCgKICAgICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoY29udGFjdFBlcnNvblByaW1hcnksICJDb250YWN0T3JnYW5pemF0aW9uIikKICAgICAgICApLAogICAgICAgIHBvc2l0aW9uOiBnZXRFbGVtZW50VGV4dCgKICAgICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoY29udGFjdEluZm9ybWF0aW9uLCAiQ29udGFjdFBvc2l0aW9uIikKICAgICAgICApLAogICAgICAgIHBob25lOiBnZXRFbGVtZW50VGV4dCgKICAgICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoY29udGFjdEluZm9ybWF0aW9uLCAiQ29udGFjdFZvaWNlVGVsZXBob25lIikKICAgICAgICApLAogICAgICAgIGZheDogZ2V0RWxlbWVudFRleHQoCiAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGNvbnRhY3RJbmZvcm1hdGlvbiwgIkNvbnRhY3RGYWNzaW1pbGVUZWxlcGhvbmUiKQogICAgICAgICksCiAgICAgICAgYWRkcmVzczogewogICAgICAgICAgZGVsaXZlcnlQb2ludDogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChhZGRyZXNzLCAiQWRkcmVzcyIpKSwKICAgICAgICAgIGNpdHk6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoYWRkcmVzcywgIkNpdHkiKSksCiAgICAgICAgICBhZG1pbmlzdHJhdGl2ZUFyZWE6IGdldEVsZW1lbnRUZXh0KAogICAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGFkZHJlc3MsICJTdGF0ZU9yUHJvdmluY2UiKQogICAgICAgICAgKSwKICAgICAgICAgIHBvc3RhbENvZGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoYWRkcmVzcywgIlBvc3RDb2RlIikpLAogICAgICAgICAgY291bnRyeTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChhZGRyZXNzLCAiQ291bnRyeSIpKQogICAgICAgIH0sCiAgICAgICAgZW1haWw6IGdldEVsZW1lbnRUZXh0KAogICAgICAgICAgZmluZENoaWxkRWxlbWVudChjb250YWN0SW5mb3JtYXRpb24sICJDb250YWN0RWxlY3Ryb25pY01haWxBZGRyZXNzIikKICAgICAgICApCiAgICAgIH0KICAgIH07CiAgfQogIGZ1bmN0aW9uIHJlYWRQcm92aWRlckZyb21DYXBhYmlsaXRpZXMoY2FwYWJpbGl0aWVzRG9jKSB7CiAgICBjb25zdCBzZXJ2aWNlUHJvdmlkZXIgPSBmaW5kQ2hpbGRFbGVtZW50KAogICAgICBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLAogICAgICAiU2VydmljZVByb3ZpZGVyIgogICAgKTsKICAgIGNvbnN0IHNlcnZpY2VDb250YWN0ID0gZmluZENoaWxkRWxlbWVudChzZXJ2aWNlUHJvdmlkZXIsICJTZXJ2aWNlQ29udGFjdCIpOwogICAgY29uc3QgY29udGFjdEluZm8gPSBmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2VDb250YWN0LCAiQ29udGFjdEluZm8iKTsKICAgIGNvbnN0IHBob25lID0gZmluZENoaWxkRWxlbWVudChjb250YWN0SW5mbywgIlBob25lIik7CiAgICBjb25zdCBhZGRyZXNzID0gZmluZENoaWxkRWxlbWVudChjb250YWN0SW5mbywgIkFkZHJlc3MiKTsKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZVByb3ZpZGVyLCAiUHJvdmlkZXJOYW1lIikpLAogICAgICBzaXRlOiBnZXRFbGVtZW50QXR0cmlidXRlKAogICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZVByb3ZpZGVyLCAiUHJvdmlkZXJTaXRlIiksCiAgICAgICAgInhsaW5rOmhyZWYiCiAgICAgICksCiAgICAgIGNvbnRhY3Q6IHsKICAgICAgICBuYW1lOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2VDb250YWN0LCAiSW5kaXZpZHVhbE5hbWUiKSksCiAgICAgICAgcG9zaXRpb246IGdldEVsZW1lbnRUZXh0KAogICAgICAgICAgZmluZENoaWxkRWxlbWVudChzZXJ2aWNlQ29udGFjdCwgIlBvc2l0aW9uTmFtZSIpCiAgICAgICAgKSwKICAgICAgICBwaG9uZTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChwaG9uZSwgIlZvaWNlIikpLAogICAgICAgIGZheDogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChwaG9uZSwgIkZhY3NpbWlsZSIpKSwKICAgICAgICBhZGRyZXNzOiB7CiAgICAgICAgICBkZWxpdmVyeVBvaW50OiBnZXRFbGVtZW50VGV4dCgKICAgICAgICAgICAgZmluZENoaWxkRWxlbWVudChhZGRyZXNzLCAiRGVsaXZlcnlQb2ludCIpCiAgICAgICAgICApLAogICAgICAgICAgY2l0eTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChhZGRyZXNzLCAiQ2l0eSIpKSwKICAgICAgICAgIGFkbWluaXN0cmF0aXZlQXJlYTogZ2V0RWxlbWVudFRleHQoCiAgICAgICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoYWRkcmVzcywgIkFkbWluaXN0cmF0aXZlQXJlYSIpCiAgICAgICAgICApLAogICAgICAgICAgcG9zdGFsQ29kZTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChhZGRyZXNzLCAiUG9zdGFsQ29kZSIpKSwKICAgICAgICAgIGNvdW50cnk6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoYWRkcmVzcywgIkNvdW50cnkiKSkKICAgICAgICB9LAogICAgICAgIGVtYWlsOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGFkZHJlc3MsICJFbGVjdHJvbmljTWFpbEFkZHJlc3MiKSkKICAgICAgfQogICAgfTsKICB9CiAgZnVuY3Rpb24gcmVhZE9wZXJhdGlvblVybHNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3QgdXJscyA9IHt9OwogICAgY29uc3QgY2FwYWJpbGl0aWVzID0gZ2V0Um9vdEVsZW1lbnQoY2FwYWJpbGl0aWVzRG9jKTsKICAgIGNvbnN0IG9wZXJhdGlvbnNNZXRhZGF0YSA9IGZpbmRDaGlsZEVsZW1lbnQoCiAgICAgIGNhcGFiaWxpdGllcywKICAgICAgIk9wZXJhdGlvbnNNZXRhZGF0YSIKICAgICk7CiAgICBpZiAob3BlcmF0aW9uc01ldGFkYXRhKSB7CiAgICAgIGZpbmRDaGlsZHJlbkVsZW1lbnQob3BlcmF0aW9uc01ldGFkYXRhLCAiT3BlcmF0aW9uIikuZm9yRWFjaCgKICAgICAgICAob3BlcmF0aW9uKSA9PiB7CiAgICAgICAgICBjb25zdCBuYW1lID0gZ2V0RWxlbWVudEF0dHJpYnV0ZShvcGVyYXRpb24sICJuYW1lIik7CiAgICAgICAgICB1cmxzW25hbWVdID0gcGFyc2VPcGVyYXRpb24xMTAob3BlcmF0aW9uKTsKICAgICAgICB9CiAgICAgICk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBjYXBhYmlsaXR5ID0gZmluZENoaWxkRWxlbWVudChjYXBhYmlsaXRpZXMsICJDYXBhYmlsaXR5Iik7CiAgICAgIGNvbnN0IHJlcXVlc3QgPSBmaW5kQ2hpbGRFbGVtZW50KGNhcGFiaWxpdHksICJSZXF1ZXN0Iik7CiAgICAgIGdldENoaWxkcmVuRWxlbWVudChyZXF1ZXN0KS5mb3JFYWNoKChvcGVyYXRpb24pID0+IHsKICAgICAgICBjb25zdCBuYW1lID0gc3RyaXBOYW1lc3BhY2UoZ2V0RWxlbWVudE5hbWUob3BlcmF0aW9uKSk7CiAgICAgICAgdXJsc1tuYW1lXSA9IHBhcnNlT3BlcmF0aW9uMTAwKG9wZXJhdGlvbik7CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIHVybHM7CiAgfQogIGZ1bmN0aW9uIHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpIHsKICAgIHJldHVybiBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLmF0dHJpYnV0ZXNbInZlcnNpb24iXTsKICB9CiAgZnVuY3Rpb24gcmVhZE91dHB1dEZvcm1hdHNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3QgdmVyc2lvbiA9IHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpOwogICAgbGV0IG91dHB1dEZvcm1hdHM7CiAgICBpZiAodmVyc2lvbi5zdGFydHNXaXRoKCIxLjAiKSkgewogICAgICBjb25zdCBnZXRGZWF0dXJlID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KAogICAgICAgICAgZmluZENoaWxkRWxlbWVudChnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLCAiQ2FwYWJpbGl0eSIpLAogICAgICAgICAgIlJlcXVlc3QiCiAgICAgICAgKSwKICAgICAgICAiR2V0RmVhdHVyZSIKICAgICAgKTsKICAgICAgb3V0cHV0Rm9ybWF0cyA9IGdldENoaWxkcmVuRWxlbWVudCgKICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGdldEZlYXR1cmUsICJSZXN1bHRGb3JtYXQiKQogICAgICApLm1hcChnZXRFbGVtZW50TmFtZSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBvcGVyYXRpb25zID0gZmluZENoaWxkRWxlbWVudCgKICAgICAgICBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLAogICAgICAgICJPcGVyYXRpb25zTWV0YWRhdGEiCiAgICAgICk7CiAgICAgIGNvbnN0IGdldEZlYXR1cmUgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KG9wZXJhdGlvbnMsICJPcGVyYXRpb24iKS5maW5kKAogICAgICAgIChlbCkgPT4gZ2V0RWxlbWVudEF0dHJpYnV0ZShlbCwgIm5hbWUiKSA9PT0gIkdldEZlYXR1cmUiCiAgICAgICk7CiAgICAgIGNvbnN0IHBhcmFtZXRlciA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoZ2V0RmVhdHVyZSwgIlBhcmFtZXRlciIpLmZpbmQoCiAgICAgICAgKGVsKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGVsLCAibmFtZSIpID09PSAib3V0cHV0Rm9ybWF0IgogICAgICApOwogICAgICBvdXRwdXRGb3JtYXRzID0gZmluZENoaWxkcmVuRWxlbWVudChwYXJhbWV0ZXIsICJWYWx1ZSIsIHRydWUpLm1hcCgKICAgICAgICBnZXRFbGVtZW50VGV4dAogICAgICApOwogICAgfQogICAgcmV0dXJuIG91dHB1dEZvcm1hdHM7CiAgfQogIGZ1bmN0aW9uIHJlYWRJbmZvRnJvbUNhcGFiaWxpdGllcyQxKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3QgdmVyc2lvbiA9IHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpOwogICAgY29uc3Qgc2VydmljZVRhZyA9IHZlcnNpb24uc3RhcnRzV2l0aCgiMS4wIikgPyAiU2VydmljZSIgOiAiU2VydmljZUlkZW50aWZpY2F0aW9uIjsKICAgIGNvbnN0IG5hbWVUYWcgPSB2ZXJzaW9uLnN0YXJ0c1dpdGgoIjEuMCIpID8gIk5hbWUiIDogIlNlcnZpY2VUeXBlIjsKICAgIGNvbnN0IHNlcnZpY2UgPSBmaW5kQ2hpbGRFbGVtZW50KGdldFJvb3RFbGVtZW50KGNhcGFiaWxpdGllc0RvYyksIHNlcnZpY2VUYWcpOwogICAgbGV0IGtleXdvcmRzOwogICAgaWYgKHZlcnNpb24uc3RhcnRzV2l0aCgiMS4wIikpIHsKICAgICAga2V5d29yZHMgPSBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJLZXl3b3JkcyIpKS5zcGxpdCgiLCIpLm1hcCgoa2V5d29yZCkgPT4ga2V5d29yZC50cmltKCkpOwogICAgfSBlbHNlIHsKICAgICAga2V5d29yZHMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KAogICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIktleXdvcmRzIiksCiAgICAgICAgIktleXdvcmQiCiAgICAgICkubWFwKGdldEVsZW1lbnRUZXh0KTsKICAgIH0KICAgIGxldCBwcm92aWRlcjsKICAgIGlmICh2ZXJzaW9uICE9PSAiMS4wLjAiKSB7CiAgICAgIHByb3ZpZGVyID0gcmVhZFByb3ZpZGVyRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgdGl0bGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIlRpdGxlIikpLAogICAgICBuYW1lOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsIG5hbWVUYWcpKSwKICAgICAgYWJzdHJhY3Q6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIkFic3RyYWN0IikpLAogICAgICBmZWVzOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJGZWVzIikpLAogICAgICBjb25zdHJhaW50czogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzZXJ2aWNlLCAiQWNjZXNzQ29uc3RyYWludHMiKSksCiAgICAgIGtleXdvcmRzLAogICAgICBwcm92aWRlciwKICAgICAgb3V0cHV0Rm9ybWF0czogcmVhZE91dHB1dEZvcm1hdHNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYykKICAgIH07CiAgfQogIGZ1bmN0aW9uIHJlYWRGZWF0dXJlVHlwZXNGcm9tQ2FwYWJpbGl0aWVzKGNhcGFiaWxpdGllc0RvYykgewogICAgY29uc3QgdmVyc2lvbiA9IHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpOwogICAgY29uc3Qgb3V0cHV0Rm9ybWF0cyA9IHJlYWRPdXRwdXRGb3JtYXRzRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpOwogICAgY29uc3QgY2FwYWJpbGl0eSA9IGZpbmRDaGlsZEVsZW1lbnQoCiAgICAgIGdldFJvb3RFbGVtZW50KGNhcGFiaWxpdGllc0RvYyksCiAgICAgICJGZWF0dXJlVHlwZUxpc3QiCiAgICApOwogICAgcmV0dXJuIGZpbmRDaGlsZHJlbkVsZW1lbnQoY2FwYWJpbGl0eSwgIkZlYXR1cmVUeXBlIikubWFwKAogICAgICAoZmVhdHVyZVR5cGVFbCkgPT4gcGFyc2VGZWF0dXJlVHlwZShmZWF0dXJlVHlwZUVsLCB2ZXJzaW9uLCBvdXRwdXRGb3JtYXRzKQogICAgKTsKICB9CiAgZnVuY3Rpb24gcGFyc2VPcGVyYXRpb24xMDAob3BlcmF0aW9uKSB7CiAgICBjb25zdCB1cmxzID0ge307CiAgICBjb25zdCBkY3BUeXBlID0gZmluZENoaWxkcmVuRWxlbWVudChvcGVyYXRpb24sICJEQ1BUeXBlIik7CiAgICBjb25zdCBodHRwID0gZGNwVHlwZS5mbGF0TWFwKChkKSA9PiBmaW5kQ2hpbGRyZW5FbGVtZW50KGQsICJIVFRQIikpOwogICAgY29uc3QgbWV0aG9kcyA9IGh0dHAuZmxhdE1hcCgoaCkgPT4gZ2V0Q2hpbGRyZW5FbGVtZW50KGgpKTsKICAgIG1ldGhvZHMuZm9yRWFjaCgobWV0aG9kKSA9PiB7CiAgICAgIGNvbnN0IG1ldGhvZE5hbWUgPSBzdHJpcE5hbWVzcGFjZShnZXRFbGVtZW50TmFtZShtZXRob2QpKTsKICAgICAgdXJsc1ttZXRob2ROYW1lXSA9IGdldEVsZW1lbnRBdHRyaWJ1dGUobWV0aG9kLCAib25saW5lUmVzb3VyY2UiKTsKICAgIH0pOwogICAgcmV0dXJuIHVybHM7CiAgfQogIGZ1bmN0aW9uIHBhcnNlT3BlcmF0aW9uMTEwKG9wZXJhdGlvbikgewogICAgY29uc3QgdXJscyA9IHt9OwogICAgY29uc3QgZGNwVHlwZSA9IGZpbmRDaGlsZHJlbkVsZW1lbnQob3BlcmF0aW9uLCAiRENQIik7CiAgICBjb25zdCBodHRwID0gZGNwVHlwZS5mbGF0TWFwKChkKSA9PiBmaW5kQ2hpbGRFbGVtZW50KGQsICJIVFRQIikpOwogICAgY29uc3QgbWV0aG9kcyA9IGh0dHAuZmxhdE1hcCgoaCkgPT4gZ2V0Q2hpbGRyZW5FbGVtZW50KGgpKTsKICAgIG1ldGhvZHMuZm9yRWFjaCgobWV0aG9kKSA9PiB7CiAgICAgIGNvbnN0IG1ldGhvZE5hbWUgPSBzdHJpcE5hbWVzcGFjZShnZXRFbGVtZW50TmFtZShtZXRob2QpKTsKICAgICAgdXJsc1ttZXRob2ROYW1lXSA9IGdldEVsZW1lbnRBdHRyaWJ1dGUobWV0aG9kLCAieGxpbms6aHJlZiIpOwogICAgfSk7CiAgICByZXR1cm4gdXJsczsKICB9CiAgZnVuY3Rpb24gcGFyc2VGZWF0dXJlVHlwZShmZWF0dXJlVHlwZUVsLCBzZXJ2aWNlVmVyc2lvbiwgZGVmYXVsdE91dHB1dEZvcm1hdHMpIHsKICAgIGNvbnN0IHNyc1RhZyA9IHNlcnZpY2VWZXJzaW9uLnN0YXJ0c1dpdGgoIjIuIikgPyAiQ1JTIiA6ICJTUlMiOwogICAgY29uc3QgZGVmYXVsdFNyc1RhZyA9IHNlcnZpY2VWZXJzaW9uLnN0YXJ0c1dpdGgoIjEuMCIpID8gIlNSUyIgOiBgRGVmYXVsdCR7c3JzVGFnfWA7CiAgICBmdW5jdGlvbiBwYXJzZUJCb3gxMDAoKSB7CiAgICAgIGNvbnN0IGJib3hFbCA9IGZpbmRDaGlsZEVsZW1lbnQoZmVhdHVyZVR5cGVFbCwgIkxhdExvbmdCb3VuZGluZ0JveCIpOwogICAgICByZXR1cm4gWyJtaW54IiwgIm1pbnkiLCAibWF4eCIsICJtYXh5Il0ubWFwKChuYW1lKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGJib3hFbCwgbmFtZSkpLm1hcChwYXJzZUZsb2F0KTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlQkJveDIoKSB7CiAgICAgIGNvbnN0IGJib3hFbCA9IGZpbmRDaGlsZEVsZW1lbnQoZmVhdHVyZVR5cGVFbCwgIldHUzg0Qm91bmRpbmdCb3giKTsKICAgICAgcmV0dXJuIFsiTG93ZXJDb3JuZXIiLCAiVXBwZXJDb3JuZXIiXS5tYXAoKGVsTmFtZSkgPT4gZmluZENoaWxkRWxlbWVudChiYm94RWwsIGVsTmFtZSkpLm1hcCgoY29ybmVyRWwpID0+IGdldEVsZW1lbnRUZXh0KGNvcm5lckVsKS5zcGxpdCgiICIpKS5yZWR1Y2UoKHByZXYsIGN1cnIpID0+IFsuLi5wcmV2LCAuLi5jdXJyXSkubWFwKHBhcnNlRmxvYXQpOwogICAgfQogICAgY29uc3Qgb3RoZXJDcnMgPSBzZXJ2aWNlVmVyc2lvbi5zdGFydHNXaXRoKCIxLjAiKSA/IFtdIDogZmluZENoaWxkcmVuRWxlbWVudChmZWF0dXJlVHlwZUVsLCBgT3RoZXIke3Nyc1RhZ31gKS5tYXAoZ2V0RWxlbWVudFRleHQpLm1hcChzaW1wbGlmeUVwc2dVcm4pOwogICAgY29uc3Qgb3V0cHV0Rm9ybWF0cyA9IHNlcnZpY2VWZXJzaW9uLnN0YXJ0c1dpdGgoIjEuMCIpID8gW10gOiBmaW5kQ2hpbGRyZW5FbGVtZW50KAogICAgICBmaW5kQ2hpbGRFbGVtZW50KGZlYXR1cmVUeXBlRWwsICJPdXRwdXRGb3JtYXRzIiksCiAgICAgICJGb3JtYXQiCiAgICApLm1hcChnZXRFbGVtZW50VGV4dCk7CiAgICBjb25zdCBrZXl3b3JkcyA9IHNlcnZpY2VWZXJzaW9uLnN0YXJ0c1dpdGgoIjEuMCIpID8gZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChmZWF0dXJlVHlwZUVsLCAiS2V5d29yZHMiKSkuc3BsaXQoIiwiKS5tYXAoKGtleXdvcmQpID0+IGtleXdvcmQudHJpbSgpKSA6IGZpbmRDaGlsZHJlbkVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQoZmVhdHVyZVR5cGVFbCwgIktleXdvcmRzIiksCiAgICAgICJLZXl3b3JkIgogICAgKS5tYXAoZ2V0RWxlbWVudFRleHQpLmZpbHRlcigodiwgaSwgYXJyKSA9PiBhcnIuaW5kZXhPZih2KSA9PT0gaSk7CiAgICBjb25zdCBtZXRhZGF0YSA9IHNlcnZpY2VWZXJzaW9uID09PSAiMi4wLjAiID8gZmluZENoaWxkcmVuRWxlbWVudChmZWF0dXJlVHlwZUVsLCAiTWV0YWRhdGFVUkwiKS5tYXAoCiAgICAgIChtZXRhZGF0YVVybEVsKSA9PiAoewogICAgICAgIHVybDogZ2V0RWxlbWVudEF0dHJpYnV0ZShtZXRhZGF0YVVybEVsLCAieGxpbms6aHJlZiIpCiAgICAgIH0pCiAgICApIDogZmluZENoaWxkcmVuRWxlbWVudChmZWF0dXJlVHlwZUVsLCAiTWV0YWRhdGFVUkwiKS5tYXAoCiAgICAgIChtZXRhZGF0YVVybEVsKSA9PiAoewogICAgICAgIGZvcm1hdDogZ2V0RWxlbWVudEF0dHJpYnV0ZShtZXRhZGF0YVVybEVsLCAiZm9ybWF0IiksCiAgICAgICAgdHlwZTogZ2V0RWxlbWVudEF0dHJpYnV0ZShtZXRhZGF0YVVybEVsLCAidHlwZSIpLAogICAgICAgIHVybDogZ2V0RWxlbWVudFRleHQobWV0YWRhdGFVcmxFbCkudHJpbSgpCiAgICAgIH0pCiAgICApOwogICAgcmV0dXJuIHsKICAgICAgbmFtZTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChmZWF0dXJlVHlwZUVsLCAiTmFtZSIpKSwKICAgICAgdGl0bGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZmVhdHVyZVR5cGVFbCwgIlRpdGxlIikpLAogICAgICBhYnN0cmFjdDogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChmZWF0dXJlVHlwZUVsLCAiQWJzdHJhY3QiKSksCiAgICAgIGRlZmF1bHRDcnM6IHNpbXBsaWZ5RXBzZ1VybigKICAgICAgICBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGZlYXR1cmVUeXBlRWwsIGRlZmF1bHRTcnNUYWcpKQogICAgICApLAogICAgICBvdGhlckNycywKICAgICAgb3V0cHV0Rm9ybWF0czogb3V0cHV0Rm9ybWF0cy5sZW5ndGggPiAwID8gb3V0cHV0Rm9ybWF0cyA6IGRlZmF1bHRPdXRwdXRGb3JtYXRzLAogICAgICBsYXRMb25Cb3VuZGluZ0JveDogc2VydmljZVZlcnNpb24uc3RhcnRzV2l0aCgiMS4wIikgPyBwYXJzZUJCb3gxMDAoKSA6IHBhcnNlQkJveDIoKSwKICAgICAga2V5d29yZHMsCiAgICAgIC4uLm1ldGFkYXRhLmxlbmd0aCAmJiB7IG1ldGFkYXRhIH0KICAgIH07CiAgfQogIGZ1bmN0aW9uIHBhcnNlQkJveCh4bWxFbGVtZW50KSB7CiAgICBjb25zdCByZXN1bHQgPSBbIkxvd2VyQ29ybmVyIiwgIlVwcGVyQ29ybmVyIl0ubWFwKChlbE5hbWUpID0+IGZpbmRDaGlsZEVsZW1lbnQoeG1sRWxlbWVudCwgZWxOYW1lKSkubWFwKChjb3JuZXJFbCkgPT4gZ2V0RWxlbWVudFRleHQoY29ybmVyRWwpLnNwbGl0KCIgIikpLnJlZHVjZSgocHJldiwgY3VycikgPT4gWy4uLnByZXYsIC4uLmN1cnJdKS5tYXAocGFyc2VGbG9hdCk7CiAgICBpZiAocmVzdWx0LnNvbWUoTnVtYmVyLmlzTmFOKSkKICAgICAgcmV0dXJuIG51bGw7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBmdW5jdGlvbiByZWFkSW5mb0Zyb21DYXBhYmlsaXRpZXMoY2FwYWJpbGl0aWVzRG9jKSB7CiAgICBjb25zdCByb290RWwgPSBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpOwogICAgY29uc3Qgc2VydmljZSA9IGZpbmRDaGlsZEVsZW1lbnQocm9vdEVsLCAiU2VydmljZUlkZW50aWZpY2F0aW9uIik7CiAgICBjb25zdCBrZXl3b3JkcyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIktleXdvcmRzIiksCiAgICAgICJLZXl3b3JkIgogICAgKS5tYXAoZ2V0RWxlbWVudFRleHQpOwogICAgY29uc3QgbWV0YWRhdGEgPSBmaW5kQ2hpbGRFbGVtZW50KHJvb3RFbCwgIk9wZXJhdGlvbnNNZXRhZGF0YSIpOwogICAgY29uc3QgZ2V0VGlsZU9wZXJhdGlvbiA9IGZpbmRDaGlsZHJlbkVsZW1lbnQobWV0YWRhdGEsICJPcGVyYXRpb24iKS5maW5kKAogICAgICAoZWwpID0+IGdldEVsZW1lbnRBdHRyaWJ1dGUoZWwsICJuYW1lIikgPT0gIkdldFRpbGUiCiAgICApOwogICAgY29uc3QgZ2V0VGlsZVVybHMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGdldFRpbGVPcGVyYXRpb24sICJHZXQiLCB0cnVlKS5yZWR1Y2UoCiAgICAgIChwcmV2LCBjdXJyKSA9PiB7CiAgICAgICAgY29uc3QgZW5jb2RpbmdUeXBlID0gZ2V0RWxlbWVudFRleHQoCiAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGN1cnIsICJWYWx1ZSIsIHRydWUpCiAgICAgICAgKTsKICAgICAgICBjb25zdCB1cmwgPSBnZXRFbGVtZW50QXR0cmlidXRlKGN1cnIsICJ4bGluazpocmVmIik7CiAgICAgICAgaWYgKGVuY29kaW5nVHlwZS50b0xvd2VyQ2FzZSgpID09PSAicmVzdGZ1bCIpCiAgICAgICAgICByZXR1cm4geyAuLi5wcmV2LCByZXN0OiB1cmwgfTsKICAgICAgICByZXR1cm4geyAuLi5wcmV2LCBrdnA6IHVybCB9OwogICAgICB9LAogICAgICB7fQogICAgKTsKICAgIHJldHVybiB7CiAgICAgIHRpdGxlOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJUaXRsZSIpKSwKICAgICAgbmFtZTogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzZXJ2aWNlLCAiU2VydmljZVR5cGUiKSksCiAgICAgIGFic3RyYWN0OiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KHNlcnZpY2UsICJBYnN0cmFjdCIpKSwKICAgICAgZmVlczogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChzZXJ2aWNlLCAiRmVlcyIpKSwKICAgICAgY29uc3RyYWludHM6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoc2VydmljZSwgIkFjY2Vzc0NvbnN0cmFpbnRzIikpLAogICAgICBrZXl3b3JkcywKICAgICAgcHJvdmlkZXI6IHJlYWRQcm92aWRlckZyb21DYXBhYmlsaXRpZXMoY2FwYWJpbGl0aWVzRG9jKSwKICAgICAgZ2V0VGlsZVVybHMKICAgIH07CiAgfQogIGZ1bmN0aW9uIHJlYWRNYXRyaXhTZXRzRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpIHsKICAgIGZ1bmN0aW9uIHBhcnNlTWF0cml4U2V0KGVsZW1lbnQpIHsKICAgICAgY29uc3QgdG9wTGVmdCA9IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIlRvcExlZnRDb3JuZXIiKSkuc3BsaXQoIiAiKS5tYXAocGFyc2VGbG9hdCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgaWRlbnRpZmllcjogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50LCAiSWRlbnRpZmllciIpKSwKICAgICAgICB0aWxlV2lkdGg6IHBhcnNlSW50KAogICAgICAgICAgZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50LCAiVGlsZVdpZHRoIikpCiAgICAgICAgKSwKICAgICAgICB0aWxlSGVpZ2h0OiBwYXJzZUludCgKICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIlRpbGVIZWlnaHQiKSkKICAgICAgICApLAogICAgICAgIG1hdHJpeFdpZHRoOiBwYXJzZUludCgKICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIk1hdHJpeFdpZHRoIikpCiAgICAgICAgKSwKICAgICAgICBtYXRyaXhIZWlnaHQ6IHBhcnNlSW50KAogICAgICAgICAgZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50LCAiTWF0cml4SGVpZ2h0IikpCiAgICAgICAgKSwKICAgICAgICBzY2FsZURlbm9taW5hdG9yOiBwYXJzZUZsb2F0KAogICAgICAgICAgZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50LCAiU2NhbGVEZW5vbWluYXRvciIpKQogICAgICAgICksCiAgICAgICAgdG9wTGVmdAogICAgICB9OwogICAgfQogICAgY29uc3QgY29udGVudHMgPSBmaW5kQ2hpbGRFbGVtZW50KAogICAgICBnZXRSb290RWxlbWVudChjYXBhYmlsaXRpZXNEb2MpLAogICAgICAiQ29udGVudHMiCiAgICApOwogICAgY29uc3QgbWF0cml4U2V0cyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoY29udGVudHMsICJUaWxlTWF0cml4U2V0Iik7CiAgICByZXR1cm4gbWF0cml4U2V0cy5tYXAoKGVsZW1lbnQpID0+IHsKICAgICAgY29uc3Qgd2VsbEtub3duU2NhbGVTZXQgPSBnZXRFbGVtZW50VGV4dCgKICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQsICJXZWxsS25vd25TY2FsZVNldCIpCiAgICAgICk7CiAgICAgIGNvbnN0IGJvdW5kaW5nQm94ID0gcGFyc2VCQm94KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIkJvdW5kaW5nQm94IikpOwogICAgICByZXR1cm4gewogICAgICAgIGlkZW50aWZpZXI6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIklkZW50aWZpZXIiKSksCiAgICAgICAgY3JzOiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQsICJTdXBwb3J0ZWRDUlMiKSksCiAgICAgICAgdGlsZU1hdHJpY2VzOiBmaW5kQ2hpbGRyZW5FbGVtZW50KGVsZW1lbnQsICJUaWxlTWF0cml4IikubWFwKAogICAgICAgICAgcGFyc2VNYXRyaXhTZXQKICAgICAgICApLAogICAgICAgIC4uLmJvdW5kaW5nQm94ICYmIHsgYm91bmRpbmdCb3ggfSwKICAgICAgICAuLi53ZWxsS25vd25TY2FsZVNldCAmJiB7IHdlbGxLbm93blNjYWxlU2V0IH0KICAgICAgfTsKICAgIH0pOwogIH0KICBmdW5jdGlvbiByZWFkTGF5ZXJzRnJvbUNhcGFiaWxpdGllcyhjYXBhYmlsaXRpZXNEb2MpIHsKICAgIGNvbnN0IHJvb3RFbCA9IGdldFJvb3RFbGVtZW50KGNhcGFiaWxpdGllc0RvYyk7CiAgICBjb25zdCBjb250ZW50c0VsID0gZmluZENoaWxkRWxlbWVudChyb290RWwsICJDb250ZW50cyIpOwogICAgZnVuY3Rpb24gZ2V0TWF0cml4U2V0Q3JzKGNvbnRlbnRzRWwyLCBpZGVudGlmaWVyKSB7CiAgICAgIGNvbnN0IG1hdHJpeFNldCA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoY29udGVudHNFbDIsICJUaWxlTWF0cml4U2V0IikuZmluZCgKICAgICAgICAobWF0cml4U2V0RWwpID0+IHsKICAgICAgICAgIGNvbnN0IGlkZW50aWZpZXJFbCA9IGZpbmRDaGlsZEVsZW1lbnQobWF0cml4U2V0RWwsICJJZGVudGlmaWVyIik7CiAgICAgICAgICByZXR1cm4gZ2V0RWxlbWVudFRleHQoaWRlbnRpZmllckVsKSA9PT0gaWRlbnRpZmllcjsKICAgICAgICB9CiAgICAgICk7CiAgICAgIHJldHVybiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KG1hdHJpeFNldCwgIlN1cHBvcnRlZENSUyIpKTsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlTWF0cml4U2V0TGluayhlbGVtZW50KSB7CiAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBnZXRFbGVtZW50VGV4dCgKICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQsICJUaWxlTWF0cml4U2V0IikKICAgICAgKTsKICAgICAgY29uc3QgY3JzID0gZ2V0TWF0cml4U2V0Q3JzKGNvbnRlbnRzRWwsIGlkZW50aWZpZXIpOwogICAgICByZXR1cm4gewogICAgICAgIGlkZW50aWZpZXIsCiAgICAgICAgY3JzLAogICAgICAgIGxpbWl0czogZmluZENoaWxkcmVuRWxlbWVudChlbGVtZW50LCAiVGlsZU1hdHJpeExpbWl0cyIsIHRydWUpLm1hcCgKICAgICAgICAgIChlbGVtZW50MikgPT4gKHsKICAgICAgICAgICAgdGlsZU1hdHJpeDogZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50MiwgIlRpbGVNYXRyaXgiKSksCiAgICAgICAgICAgIG1pblRpbGVSb3c6IHBhcnNlSW50KAogICAgICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJNaW5UaWxlUm93IikpCiAgICAgICAgICAgICksCiAgICAgICAgICAgIG1pblRpbGVDb2w6IHBhcnNlSW50KAogICAgICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJNaW5UaWxlQ29sIikpCiAgICAgICAgICAgICksCiAgICAgICAgICAgIG1heFRpbGVSb3c6IHBhcnNlSW50KAogICAgICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJNYXhUaWxlUm93IikpCiAgICAgICAgICAgICksCiAgICAgICAgICAgIG1heFRpbGVDb2w6IHBhcnNlSW50KAogICAgICAgICAgICAgIGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJNYXhUaWxlQ29sIikpCiAgICAgICAgICAgICkKICAgICAgICAgIH0pCiAgICAgICAgKQogICAgICB9OwogICAgfQogICAgY29uc3QgZ2V0VGlsZU9wZXJhdGlvbiA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoCiAgICAgIGZpbmRDaGlsZEVsZW1lbnQocm9vdEVsLCAiT3BlcmF0aW9uc01ldGFkYXRhIiksCiAgICAgICJPcGVyYXRpb24iCiAgICApLmZpbmQoKGVsKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGVsLCAibmFtZSIpID09ICJHZXRUaWxlIik7CiAgICBjb25zdCBnZXRLdnBFbHQgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGdldFRpbGVPcGVyYXRpb24sICJHZXQiLCB0cnVlKS5maWx0ZXIoCiAgICAgIChlbHQpID0+IHsKICAgICAgICBjb25zdCBlbmNvZGluZ1R5cGUgPSBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGVsdCwgIlZhbHVlIiwgdHJ1ZSkpOwogICAgICAgIHJldHVybiBlbmNvZGluZ1R5cGUudG9Mb3dlckNhc2UoKSA9PT0gImt2cCI7CiAgICAgIH0KICAgIClbMF07CiAgICBjb25zdCBnZXRLdnBVcmwgPSBnZXRLdnBFbHQgPyBnZXRFbGVtZW50QXR0cmlidXRlKGdldEt2cEVsdCwgInhsaW5rOmhyZWYiKSA6ICIiOwogICAgY29uc3QgY29udGVudHMgPSBmaW5kQ2hpbGRFbGVtZW50KHJvb3RFbCwgIkNvbnRlbnRzIik7CiAgICBjb25zdCBsYXllcnMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGNvbnRlbnRzLCAiTGF5ZXIiKTsKICAgIHJldHVybiBsYXllcnMubWFwKChlbGVtZW50KSA9PiB7CiAgICAgIGNvbnN0IGxhdExvbkJvdW5kaW5nQm94ID0gcGFyc2VCQm94KAogICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIldHUzg0Qm91bmRpbmdCb3giKQogICAgICApOwogICAgICBsZXQgZGVmYXVsdFN0eWxlID0gIiI7CiAgICAgIGNvbnN0IHN0eWxlcyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCwgIlN0eWxlIikubWFwKChlbGVtZW50MikgPT4gewogICAgICAgIGNvbnN0IGxlZ2VuZFVybCA9IGdldEVsZW1lbnRBdHRyaWJ1dGUoCiAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQyLCAiTGVnZW5kVVJMIiksCiAgICAgICAgICAieGxpbms6aHJlZiIKICAgICAgICApOwogICAgICAgIGNvbnN0IGFic3RyYWN0ID0gZ2V0RWxlbWVudFRleHQoZmluZENoaWxkRWxlbWVudChlbGVtZW50MiwgIkFic3RyYWN0IikpOwogICAgICAgIGNvbnN0IHN0eWxlID0gewogICAgICAgICAgdGl0bGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJUaXRsZSIpKSwKICAgICAgICAgIG5hbWU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJJZGVudGlmaWVyIikpLAogICAgICAgICAgLi4uYWJzdHJhY3QgJiYgeyBhYnN0cmFjdCB9LAogICAgICAgICAgLi4ubGVnZW5kVXJsICYmIHsgbGVnZW5kVXJsIH0KICAgICAgICB9OwogICAgICAgIGlmIChnZXRFbGVtZW50QXR0cmlidXRlKGVsZW1lbnQyLCAiaXNEZWZhdWx0IikgPT09ICJ0cnVlIikgewogICAgICAgICAgZGVmYXVsdFN0eWxlID0gc3R5bGUubmFtZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0eWxlOwogICAgICB9KTsKICAgICAgY29uc3Qgb3V0cHV0Rm9ybWF0cyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCwgIkZvcm1hdCIpLm1hcCgKICAgICAgICBnZXRFbGVtZW50VGV4dAogICAgICApOwogICAgICBjb25zdCByZXNvdXJjZUxpbmtzID0gZmluZENoaWxkcmVuRWxlbWVudCgKICAgICAgICBlbGVtZW50LAogICAgICAgICJSZXNvdXJjZVVSTCIKICAgICAgKS5maWx0ZXIoCiAgICAgICAgKGVsZW1lbnQyKSA9PiBnZXRFbGVtZW50QXR0cmlidXRlKGVsZW1lbnQyLCAicmVzb3VyY2VUeXBlIikgPT09ICJ0aWxlIgogICAgICApLm1hcCgoZWxlbWVudDIpID0+IHsKICAgICAgICBjb25zdCBmb3JtYXQgPSBnZXRFbGVtZW50QXR0cmlidXRlKGVsZW1lbnQyLCAiZm9ybWF0Iik7CiAgICAgICAgY29uc3QgdXJsID0gZ2V0RWxlbWVudEF0dHJpYnV0ZShlbGVtZW50MiwgInRlbXBsYXRlIik7CiAgICAgICAgcmV0dXJuIHsgZm9ybWF0LCB1cmwsIGVuY29kaW5nOiAiUkVTVCIgfTsKICAgICAgfSk7CiAgICAgIGlmIChnZXRLdnBVcmwpIHsKICAgICAgICByZXNvdXJjZUxpbmtzLnB1c2goCiAgICAgICAgICAuLi5vdXRwdXRGb3JtYXRzLm1hcCgoZm9ybWF0KSA9PiAoewogICAgICAgICAgICBlbmNvZGluZzogIktWUCIsCiAgICAgICAgICAgIHVybDogZ2V0S3ZwVXJsLAogICAgICAgICAgICBmb3JtYXQKICAgICAgICAgIH0pKQogICAgICAgICk7CiAgICAgIH0KICAgICAgY29uc3QgbWF0cml4U2V0cyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoZWxlbWVudCwgIlRpbGVNYXRyaXhTZXRMaW5rIikubWFwKAogICAgICAgIHBhcnNlTWF0cml4U2V0TGluawogICAgICApOwogICAgICBjb25zdCBkaW1lbnNpb25zID0gZmluZENoaWxkcmVuRWxlbWVudChlbGVtZW50LCAiRGltZW5zaW9uIikubWFwKAogICAgICAgIChlbGVtZW50MikgPT4gewogICAgICAgICAgY29uc3QgaWRlbnRpZmllciA9IGdldEVsZW1lbnRUZXh0KAogICAgICAgICAgICBmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQyLCAiSWRlbnRpZmllciIpCiAgICAgICAgICApOwogICAgICAgICAgY29uc3QgZGVmYXVsdFZhbHVlID0gZ2V0RWxlbWVudFRleHQoCiAgICAgICAgICAgIGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudDIsICJEZWZhdWx0IikKICAgICAgICAgICk7CiAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBmaW5kQ2hpbGRyZW5FbGVtZW50KGVsZW1lbnQyLCAiVmFsdWVzIikubWFwKAogICAgICAgICAgICBnZXRFbGVtZW50VGV4dAogICAgICAgICAgKTsKICAgICAgICAgIHJldHVybiB7IGlkZW50aWZpZXIsIGRlZmF1bHRWYWx1ZSwgdmFsdWVzIH07CiAgICAgICAgfQogICAgICApOwogICAgICByZXR1cm4gewogICAgICAgIG5hbWU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIklkZW50aWZpZXIiKSksCiAgICAgICAgdGl0bGU6IGdldEVsZW1lbnRUZXh0KGZpbmRDaGlsZEVsZW1lbnQoZWxlbWVudCwgIlRpdGxlIikpLAogICAgICAgIGFic3RyYWN0OiBnZXRFbGVtZW50VGV4dChmaW5kQ2hpbGRFbGVtZW50KGVsZW1lbnQsICJBYnN0cmFjdCIpKSwKICAgICAgICBzdHlsZXMsCiAgICAgICAgcmVzb3VyY2VMaW5rcywKICAgICAgICBtYXRyaXhTZXRzLAogICAgICAgIGRlZmF1bHRTdHlsZSwKICAgICAgICAuLi5sYXRMb25Cb3VuZGluZ0JveCAmJiB7IGxhdExvbkJvdW5kaW5nQm94IH0sCiAgICAgICAgLi4uZGltZW5zaW9ucyAmJiB7IGRpbWVuc2lvbnMgfQogICAgICB9OwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIHBhcnNlRmVhdHVyZVByb3BzKGdldEZlYXR1cmVzRG9jLCBmZWF0dXJlVHlwZUZ1bGwsIHNlcnZpY2VWZXJzaW9uKSB7CiAgICBjb25zdCBjb2xsZWN0aW9uID0gZ2V0Um9vdEVsZW1lbnQoZ2V0RmVhdHVyZXNEb2MpOwogICAgbGV0IG1lbWJlcnM7CiAgICBpZiAoc2VydmljZVZlcnNpb24uc3RhcnRzV2l0aCgiMi4wIikpIHsKICAgICAgbWVtYmVycyA9IGZpbmRDaGlsZHJlbkVsZW1lbnQoY29sbGVjdGlvbiwgIm1lbWJlciIpLm1hcCgKICAgICAgICAocGFyZW50KSA9PiBnZXRDaGlsZHJlbkVsZW1lbnQocGFyZW50KVswXQogICAgICApOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgbWVtYmVyc1Jvb3QgPSBmaW5kQ2hpbGRFbGVtZW50KGNvbGxlY3Rpb24sICJmZWF0dXJlTWVtYmVycyIpOwogICAgICBtZW1iZXJzID0gbWVtYmVyc1Jvb3QgPyBnZXRDaGlsZHJlbkVsZW1lbnQobWVtYmVyc1Jvb3QpIDogZmluZENoaWxkcmVuRWxlbWVudChjb2xsZWN0aW9uLCAiZmVhdHVyZU1lbWJlciIpLm1hcCgKICAgICAgICAocGFyZW50KSA9PiBnZXRDaGlsZHJlbkVsZW1lbnQocGFyZW50KVswXQogICAgICApOwogICAgfQogICAgY29uc3QgaWRBdHRyID0gc2VydmljZVZlcnNpb24gPT09ICIxLjAuMCIgPyAiZmlkIiA6ICJnbWw6aWQiOwogICAgZnVuY3Rpb24gaXNFbGVtZW50UHJvcGVydHkocHJvcE5hbWUpIHsKICAgICAgcmV0dXJuIHByb3BOYW1lIGluIGZlYXR1cmVUeXBlRnVsbC5wcm9wZXJ0aWVzOwogICAgfQogICAgZnVuY3Rpb24gcGFyc2VFbGVtZW50UHJvcGVydHlWYWx1ZShwcm9wTmFtZSwgdmFsdWVBc1N0cmluZykgewogICAgICBjb25zdCB0eXBlID0gZmVhdHVyZVR5cGVGdWxsLnByb3BlcnRpZXNbcHJvcE5hbWVdOwogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlICJpbnRlZ2VyIjoKICAgICAgICAgIHJldHVybiBwYXJzZUludCh2YWx1ZUFzU3RyaW5nKTsKICAgICAgICBjYXNlICJmbG9hdCI6CiAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCh2YWx1ZUFzU3RyaW5nKTsKICAgICAgICBjYXNlICJib29sZWFuIjoKICAgICAgICAgIHJldHVybiB2YWx1ZUFzU3RyaW5nID09PSAidHJ1ZSI7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiB2YWx1ZUFzU3RyaW5nOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBnZXRQcm9wZXJ0aWVzKG1lbWJlckVsKSB7CiAgICAgIHJldHVybiBnZXRDaGlsZHJlbkVsZW1lbnQobWVtYmVyRWwpLmZpbHRlcigoZWwpID0+IGlzRWxlbWVudFByb3BlcnR5KHN0cmlwTmFtZXNwYWNlKGdldEVsZW1lbnROYW1lKGVsKSkpKS5yZWR1Y2UoKHByZXYsIGN1cnIpID0+IHsKICAgICAgICBjb25zdCBwcm9wTmFtZSA9IHN0cmlwTmFtZXNwYWNlKGdldEVsZW1lbnROYW1lKGN1cnIpKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgLi4ucHJldiwKICAgICAgICAgIFtwcm9wTmFtZV06IHBhcnNlRWxlbWVudFByb3BlcnR5VmFsdWUocHJvcE5hbWUsIGdldEVsZW1lbnRUZXh0KGN1cnIpKQogICAgICAgIH07CiAgICAgIH0sIHt9KTsKICAgIH0KICAgIHJldHVybiBtZW1iZXJzLm1hcCgoZWwpID0+ICh7CiAgICAgIGlkOiBnZXRFbGVtZW50QXR0cmlidXRlKGVsLCBpZEF0dHIpLAogICAgICBwcm9wZXJ0aWVzOiBnZXRQcm9wZXJ0aWVzKGVsKQogICAgfSkpOwogIH0KICBmdW5jdGlvbiBjb21wdXRlRmVhdHVyZVByb3BzRGV0YWlscyhmZWF0dXJlc1dpdGhQcm9wcykgewogICAgcmV0dXJuIGZlYXR1cmVzV2l0aFByb3BzLnJlZHVjZSgocHJldiwgY3VycikgPT4gewogICAgICBmb3IgKGNvbnN0IHByb3BOYW1lIGluIGN1cnIucHJvcGVydGllcykgewogICAgICAgIGNvbnN0IHByb3BWYWx1ZSA9IGN1cnIucHJvcGVydGllc1twcm9wTmFtZV07CiAgICAgICAgaWYgKCEocHJvcE5hbWUgaW4gcHJldikpIHsKICAgICAgICAgIHByZXZbcHJvcE5hbWVdID0geyB1bmlxdWVWYWx1ZXM6IFtdIH07CiAgICAgICAgfQogICAgICAgIGNvbnN0IHVuaXF1ZVZhbHVlID0gcHJldltwcm9wTmFtZV0udW5pcXVlVmFsdWVzLmZpbmQoCiAgICAgICAgICAodikgPT4gdi52YWx1ZSA9PT0gcHJvcFZhbHVlCiAgICAgICAgKTsKICAgICAgICBpZiAodW5pcXVlVmFsdWUpCiAgICAgICAgICB1bmlxdWVWYWx1ZS5jb3VudCsrOwogICAgICAgIGVsc2UKICAgICAgICAgIHByZXZbcHJvcE5hbWVdLnVuaXF1ZVZhbHVlcy5wdXNoKHsgdmFsdWU6IHByb3BWYWx1ZSwgY291bnQ6IDEgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHByZXY7CiAgICB9LCB7fSk7CiAgfQogIGZ1bmN0aW9uIGdlbmVyYXRlR2V0RmVhdHVyZVVybChzZXJ2aWNlVXJsLCB2ZXJzaW9uLCBmZWF0dXJlVHlwZSwgb3V0cHV0Rm9ybWF0LCBtYXhGZWF0dXJlcywgYXR0cmlidXRlcywgaGl0c09ubHksIG91dHB1dENycywgZXh0ZW50LCBleHRlbnRDcnMsIHN0YXJ0SW5kZXgsIHNvcnRCeSkgewogICAgY29uc3QgdHlwZVBhcmFtID0gdmVyc2lvbiA9PT0gIjIuMC4wIiA/ICJUWVBFTkFNRVMiIDogIlRZUEVOQU1FIjsKICAgIGNvbnN0IGNvdW50UGFyYW0gPSB2ZXJzaW9uID09PSAiMi4wLjAiID8gIkNPVU5UIiA6ICJNQVhGRUFUVVJFUyI7CiAgICBjb25zdCBuZXdQYXJhbXMgPSB7CiAgICAgIFNFUlZJQ0U6ICJXRlMiLAogICAgICBSRVFVRVNUOiAiR2V0RmVhdHVyZSIsCiAgICAgIFZFUlNJT046IHZlcnNpb24sCiAgICAgIFt0eXBlUGFyYW1dOiBmZWF0dXJlVHlwZQogICAgfTsKICAgIGlmIChvdXRwdXRGb3JtYXQgIT09IHZvaWQgMCkKICAgICAgbmV3UGFyYW1zLk9VVFBVVEZPUk1BVCA9IG91dHB1dEZvcm1hdDsKICAgIGlmIChhdHRyaWJ1dGVzICE9PSB2b2lkIDApCiAgICAgIG5ld1BhcmFtcy5QUk9QRVJUWU5BTUUgPSBhdHRyaWJ1dGVzLmpvaW4oIiwiKTsKICAgIGlmIChoaXRzT25seSkgewogICAgICBuZXdQYXJhbXMuUkVTVUxUVFlQRSA9ICJoaXRzIjsKICAgICAgbmV3UGFyYW1zW2NvdW50UGFyYW1dID0gIjEiOwogICAgfSBlbHNlIGlmIChtYXhGZWF0dXJlcyAhPT0gdm9pZCAwKQogICAgICBuZXdQYXJhbXNbY291bnRQYXJhbV0gPSBtYXhGZWF0dXJlcy50b1N0cmluZygxMCk7CiAgICBpZiAob3V0cHV0Q3JzKSB7CiAgICAgIG5ld1BhcmFtcy5TUlNOQU1FID0gb3V0cHV0Q3JzOwogICAgfQogICAgaWYgKGV4dGVudCkgewogICAgICBjb25zdCBleHRlbnRKb2luZWQgPSBleHRlbnQuam9pbigiLCIpOwogICAgICBuZXdQYXJhbXMuQkJPWCA9IGV4dGVudENycyA/IGAke2V4dGVudEpvaW5lZH0sJHtleHRlbnRDcnN9YCA6IGV4dGVudEpvaW5lZDsKICAgIH0KICAgIGlmIChzdGFydEluZGV4KSB7CiAgICAgIG5ld1BhcmFtcy5TVEFSVElOREVYID0gc3RhcnRJbmRleC50b1N0cmluZygxMCk7CiAgICB9CiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHNldFF1ZXJ5UGFyYW1zKHNlcnZpY2VVcmwsIG5ld1BhcmFtcykpOwogICAgaWYgKEFycmF5LmlzQXJyYXkoc29ydEJ5KSAmJiBzb3J0QnkubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBzb3J0cyA9IHNvcnRCeS5tYXAoKGZpZWxkU29ydCkgPT4gYCR7ZmllbGRTb3J0WzFdfSAke2ZpZWxkU29ydFswXX1gKS5qb2luKCIsIik7CiAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCJTT1JUQlkiLCBzb3J0cyk7CiAgICB9CiAgICByZXR1cm4gdXJsLnRvU3RyaW5nKCk7CiAgfQogIGFkZFRhc2tIYW5kbGVyKAogICAgInBhcnNlV21zQ2FwYWJpbGl0aWVzIiwKICAgIGdsb2JhbFRoaXMsCiAgICAoeyB1cmwgfSkgPT4gcXVlcnlYbWxEb2N1bWVudCh1cmwpLnRoZW4oKHhtbERvYykgPT4gY2hlY2soeG1sRG9jLCB1cmwpKS50aGVuKCh4bWxEb2MpID0+ICh7CiAgICAgIGluZm86IHJlYWRJbmZvRnJvbUNhcGFiaWxpdGllcyQyKHhtbERvYyksCiAgICAgIGxheWVyczogcmVhZExheWVyc0Zyb21DYXBhYmlsaXRpZXMkMSh4bWxEb2MpLAogICAgICB1cmw6IHJlYWRPcGVyYXRpb25VcmxzRnJvbUNhcGFiaWxpdGllcyQxKHhtbERvYyksCiAgICAgIHZlcnNpb246IHJlYWRWZXJzaW9uRnJvbUNhcGFiaWxpdGllcyQxKHhtbERvYykKICAgIH0pKQogICk7CiAgYWRkVGFza0hhbmRsZXIoCiAgICAicGFyc2VXZnNDYXBhYmlsaXRpZXMiLAogICAgZ2xvYmFsVGhpcywKICAgICh7IHVybCB9KSA9PiBxdWVyeVhtbERvY3VtZW50KHVybCkudGhlbigoeG1sRG9jKSA9PiBjaGVjayh4bWxEb2MsIHVybCkpLnRoZW4oKHhtbERvYykgPT4gKHsKICAgICAgaW5mbzogcmVhZEluZm9Gcm9tQ2FwYWJpbGl0aWVzJDEoeG1sRG9jKSwKICAgICAgZmVhdHVyZVR5cGVzOiByZWFkRmVhdHVyZVR5cGVzRnJvbUNhcGFiaWxpdGllcyh4bWxEb2MpLAogICAgICB1cmw6IHJlYWRPcGVyYXRpb25VcmxzRnJvbUNhcGFiaWxpdGllcyh4bWxEb2MpLAogICAgICB2ZXJzaW9uOiByZWFkVmVyc2lvbkZyb21DYXBhYmlsaXRpZXMoeG1sRG9jKQogICAgfSkpCiAgKTsKICBhZGRUYXNrSGFuZGxlcigKICAgICJxdWVyeVdmc0ZlYXR1cmVUeXBlRGV0YWlscyIsCiAgICBnbG9iYWxUaGlzLAogICAgKHsKICAgICAgdXJsLAogICAgICBzZXJ2aWNlVmVyc2lvbiwKICAgICAgZmVhdHVyZVR5cGVGdWxsCiAgICB9KSA9PiB7CiAgICAgIGNvbnN0IGdldEZlYXR1cmVVcmwgPSBnZW5lcmF0ZUdldEZlYXR1cmVVcmwoCiAgICAgICAgdXJsLAogICAgICAgIHNlcnZpY2VWZXJzaW9uLAogICAgICAgIGZlYXR1cmVUeXBlRnVsbC5uYW1lLAogICAgICAgIHZvaWQgMCwKICAgICAgICB2b2lkIDAsCiAgICAgICAgT2JqZWN0LmtleXMoZmVhdHVyZVR5cGVGdWxsLnByb3BlcnRpZXMpCiAgICAgICk7CiAgICAgIHJldHVybiBxdWVyeVhtbERvY3VtZW50KGdldEZlYXR1cmVVcmwpLnRoZW4oKGdldEZlYXR1cmVEb2MpID0+ICh7CiAgICAgICAgcHJvcHM6IGNvbXB1dGVGZWF0dXJlUHJvcHNEZXRhaWxzKAogICAgICAgICAgcGFyc2VGZWF0dXJlUHJvcHMoZ2V0RmVhdHVyZURvYywgZmVhdHVyZVR5cGVGdWxsLCBzZXJ2aWNlVmVyc2lvbikKICAgICAgICApCiAgICAgIH0pKTsKICAgIH0KICApOwogIGFkZFRhc2tIYW5kbGVyKAogICAgInVwZGF0ZUZldGNoT3B0aW9ucyIsCiAgICBnbG9iYWxUaGlzLAogICAgKHsgb3B0aW9ucyB9KSA9PiB7CiAgICAgIHNldEZldGNoT3B0aW9ucyhvcHRpb25zKTsKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7fSk7CiAgICB9CiAgKTsKICBhZGRUYXNrSGFuZGxlcigKICAgICJwYXJzZVdtdHNDYXBhYmlsaXRpZXMiLAogICAgZ2xvYmFsVGhpcywKICAgICh7IHVybCB9KSA9PiBxdWVyeVhtbERvY3VtZW50KHVybCkudGhlbigoeG1sRG9jKSA9PiBjaGVjayh4bWxEb2MsIHVybCkpLnRoZW4oKHhtbERvYykgPT4gKHsKICAgICAgaW5mbzogcmVhZEluZm9Gcm9tQ2FwYWJpbGl0aWVzKHhtbERvYyksCiAgICAgIGxheWVyczogcmVhZExheWVyc0Zyb21DYXBhYmlsaXRpZXMoeG1sRG9jKSwKICAgICAgbWF0cml4U2V0czogcmVhZE1hdHJpeFNldHNGcm9tQ2FwYWJpbGl0aWVzKHhtbERvYykKICAgIH0pKQogICk7Cn0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXdvcmtlci1MRGtNT3gwZC5qcy5tYXAK",o5=typeof window<"u"&&window.Blob&&new Blob([atob(QV)],{type:"text/javascript;charset=utf-8"});function lie(n){let e;try{if(e=o5&&(window.URL||window.webkitURL).createObjectURL(o5),!e)throw"";const t=new Worker(e,{name:n?.name});return t.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:text/javascript;base64,"+QV,{name:n?.name})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}let pS;function uie(){return pS||(pS=new lie),pS}function cie(n){return aie("parseWmsCapabilities",uie(),{url:n})}var gS,a5;function hie(){if(a5)return gS;a5=1;var n=Object.defineProperty,e=Object.getOwnPropertyDescriptor,t=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,r=(se,Q)=>{for(var q in Q)n(se,q,{get:Q[q],enumerable:!0})},o=(se,Q,q,$e)=>{if(Q&&typeof Q=="object"||typeof Q=="function")for(let Qe of t(Q))!i.call(se,Qe)&&Qe!==q&&n(se,Qe,{get:()=>Q[Qe],enumerable:!($e=e(Q,Qe))||$e.enumerable});return se},s=se=>o(n({},"__esModule",{value:!0}),se),l={};r(l,{XmlCdata:()=>J,XmlComment:()=>te,XmlDeclaration:()=>ce,XmlDocument:()=>Y,XmlDocumentType:()=>he,XmlElement:()=>pe,XmlError:()=>D,XmlNode:()=>W,XmlProcessingInstruction:()=>re,XmlText:()=>j,parseXml:()=>we}),gS=s(l);var u="",h=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,d=class{constructor(se){if(this.k=this.u(se,!0),this.d=0,this.length=se.length,this.l=this.k!==this.length,this.h=se,this.l){let Q=[];for(let q=0,$e=0;$e<this.k;++$e)Q[$e]=q,q+=se.codePointAt(q)>65535?2:1;this.A=Q}}get B(){return this.d>=this.k}u(se,Q=this.l){return Q?se.replace(h,"_").length:se.length}p(se=1){this.d=Math.min(this.k,this.d+se)}f(se=this.d){var Q;return this.l?(Q=this.A[se])!=null?Q:1/0:se}G(se=1){let Q=this.m(se);return this.p(se),Q}v(se){let Q=this.f(),q=this.h.slice(Q,Q+se);return this.p(this.u(q)),q}w(se){let{length:Q,l:q,h:$e}=this,Qe=this.f(),qe=Qe;if(q)for(;qe<Q;){let Lt=$e[qe],Pt=Lt>="\uD800"&&Lt<="\uDBFF";if(Pt&&(Lt+=$e[qe+1]),!se(Lt))break;qe+=Pt?2:1}else for(;qe<Q&&se($e[qe]);)++qe;return this.v(qe-Qe)}b(se){let{length:Q}=se,q=this.f();return se===this.h.slice(q,q+Q)?(this.p(Q===1?1:this.u(se)),se):u}x(se){let Q=this.h.slice(this.f()).search(se);return Q>0?this.v(Q):u}s(se){let Q=this.f(),q=this.h.indexOf(se,Q);return q>0?this.v(q-Q):u}m(se=1){let{d:Q,h:q}=this;return this.l?q.slice(this.f(Q),this.f(Q+se)):q.slice(Q,Q+se)}n(se=0){this.d=se>=0?Math.min(this.k,se):Math.max(0,this.d+se)}},m=/["&<]/,y=/['&<]/,x=/\r\n|[\n\r\t]/g,C=/<|&|]]>/,w=Object.freeze(Object.assign(Object.create(null),{amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}));function S(se){let Q=se.codePointAt(0);return Q>=97&&Q<=122||Q>=65&&Q<=90||Q>=48&&Q<=57||Q===45||Q===46||Q===183||Q>=768&&Q<=879||Q===8255||Q===8256||T(se,Q)}function T(se,Q=se.codePointAt(0)){return Q>=97&&Q<=122||Q>=65&&Q<=90||Q===58||Q===95||Q>=192&&Q<=214||Q>=216&&Q<=246||Q>=248&&Q<=767||Q>=880&&Q<=893||Q>=895&&Q<=8191||Q===8204||Q===8205||Q>=8304&&Q<=8591||Q>=11264&&Q<=12271||Q>=12289&&Q<=55295||Q>=63744&&Q<=64975||Q>=65008&&Q<=65533||Q>=65536&&Q<=983039}function M(se){return se==="#"||S(se)}function G(se){let Q=se.codePointAt(0);return Q===32||Q===9||Q===10||Q===13}function N(se){return se>=32&&se<=55295||se===10||se===9||se===13||se>=57344&&se<=65533||se>=65536&&se<=1114111}var V=class eB{constructor(){this.parent=null,this.start=-1,this.end=-1}get document(){var Q,q;return(q=(Q=this.parent)==null?void 0:Q.document)!=null?q:null}get isRootNode(){return this.parent!==null&&this.parent===this.document&&this.type===eB.TYPE_ELEMENT}get preserveWhitespace(){var Q;return!!((Q=this.parent)!=null&&Q.preserveWhitespace)}get type(){return""}toJSON(){let Q={type:this.type};return this.isRootNode&&(Q.isRootNode=!0),this.preserveWhitespace&&(Q.preserveWhitespace=!0),this.start!==-1&&(Q.start=this.start,Q.end=this.end),Q}};V.TYPE_CDATA="cdata",V.TYPE_COMMENT="comment",V.TYPE_DOCUMENT="document",V.TYPE_DOCUMENT_TYPE="doctype",V.TYPE_ELEMENT="element",V.TYPE_PROCESSING_INSTRUCTION="pi",V.TYPE_TEXT="text",V.TYPE_XML_DECLARATION="xmldecl";var W=V,j=class extends W{constructor(se=""){super(),this.text=se}get type(){return W.TYPE_TEXT}toJSON(){return Object.assign(W.prototype.toJSON.call(this),{text:this.text})}},J=class extends j{get type(){return W.TYPE_CDATA}},te=class extends W{constructor(se=""){super(),this.content=se}get type(){return W.TYPE_COMMENT}toJSON(){return Object.assign(W.prototype.toJSON.call(this),{content:this.content})}},ce=class extends W{constructor(se,Q,q){super(),this.version=se,this.encoding=Q??null,this.standalone=q??null}get type(){return W.TYPE_XML_DECLARATION}toJSON(){let se=W.prototype.toJSON.call(this);se.version=this.version;for(let Q of["encoding","standalone"])this[Q]!==null&&(se[Q]=this[Q]);return se}},pe=class tB extends W{constructor(Q,q=Object.create(null),$e=[]){super(),this.name=Q,this.attributes=q,this.children=$e}get isEmpty(){return this.children.length===0}get preserveWhitespace(){let Q=this;for(;Q instanceof tB;){if("xml:space"in Q.attributes)return Q.attributes["xml:space"]==="preserve";Q=Q.parent}return!1}get text(){return this.children.map(Q=>"text"in Q?Q.text:"").join("")}get type(){return W.TYPE_ELEMENT}toJSON(){return Object.assign(W.prototype.toJSON.call(this),{name:this.name,attributes:this.attributes,children:this.children.map(Q=>Q.toJSON())})}},Y=class extends W{constructor(se=[]){super(),this.children=se}get document(){return this}get root(){for(let se of this.children)if(se instanceof pe)return se;return null}get text(){return this.children.map(se=>"text"in se?se.text:"").join("")}get type(){return W.TYPE_DOCUMENT}toJSON(){return Object.assign(W.prototype.toJSON.call(this),{children:this.children.map(se=>se.toJSON())})}},he=class extends W{constructor(se,Q,q,$e){super(),this.name=se,this.publicId=Q??null,this.systemId=q??null,this.internalSubset=$e??null}get type(){return W.TYPE_DOCUMENT_TYPE}toJSON(){let se=W.prototype.toJSON.call(this);se.name=this.name;for(let Q of["publicId","systemId","internalSubset"])this[Q]!==null&&(se[Q]=this[Q]);return se}},D=class extends Error{constructor(se,Q,q){let $e=1,Qe="",qe=1;for(let zt=0;zt<Q;++zt){let Dt=q[zt];Dt===`
`?($e=1,Qe="",qe+=1):($e+=1,Qe+=Dt)}let Lt=q.indexOf(`
`,Q);Qe+=Lt===-1?q.slice(Q):q.slice(Q,Lt);let Pt=0;Qe.length>50&&($e<40?Qe=Qe.slice(0,50):(Pt=$e-20,Qe=Qe.slice(Pt,$e+30))),super(`${se} (line ${qe}, column ${$e})
  ${Qe}
`+" ".repeat($e-Pt+1)+`^
`),this.column=$e,this.excerpt=Qe,this.line=qe,this.name="XmlError",this.pos=Q}},re=class extends W{constructor(se,Q=""){super(),this.name=se,this.content=Q}get type(){return W.TYPE_PROCESSING_INSTRUCTION}toJSON(){return Object.assign(W.prototype.toJSON.call(this),{name:this.name,content:this.content})}},le="",fe=class{constructor(se,Q={}){let q=this.document=new Y;this.j=q,this.g=Q,this.c=new d(se),this.g.includeOffsets&&(q.start=0,q.end=se.length),this.parse()}i(se,Q){return se.parent=this.j,this.g.includeOffsets&&(se.start=this.c.f(Q),se.end=this.c.f()),this.j.children.push(se),!0}y(se,Q){let{children:q}=this.j,{length:$e}=q;if(se=Le(se),$e>0){let Qe=q[$e-1];if(Qe?.type===W.TYPE_TEXT){let qe=Qe;return qe.text+=se,this.g.includeOffsets&&(qe.end=this.c.f()),!0}}return this.i(new j(se),Q)}H(){let se=Object.create(null);for(;this.e();){let Q=this.q();if(!Q)break;let q=this.t()&&this.I();if(q===!1)throw this.a("Attribute value expected");if(Q in se)throw this.a(`Duplicate attribute: ${Q}`);if(Q==="xml:space"&&q!=="default"&&q!=="preserve")throw this.a('Value of the `xml:space` attribute must be "default" or "preserve"');se[Q]=q}if(this.g.sortAttributes){let Q=Object.keys(se).sort(),q=Object.create(null);for(let $e=0;$e<Q.length;++$e){let Qe=Q[$e];q[Qe]=se[Qe]}se=q}return se}I(){let{c:se}=this,Q=se.m();if(Q!=='"'&&Q!=="'")return!1;se.p();let q,$e=!1,Qe=le,qe=Q==='"'?m:y;e:for(;!se.B;)switch(q=se.x(qe),q&&(this.o(q),Qe+=q.replace(x," ")),se.m()){case Q:$e=!0;break e;case"&":Qe+=this.C();continue;case"<":throw this.a("Unescaped `<` is not allowed in an attribute value");default:break e}if(!$e)throw this.a("Unclosed attribute");return se.p(),Qe}J(){let{c:se}=this,Q=se.d;if(!se.b("<![CDATA["))return!1;let q=se.s("]]>");if(this.o(q),!se.b("]]>"))throw this.a("Unclosed CDATA section");return this.g.preserveCdata?this.i(new J(Le(q)),Q):this.y(q,Q)}K(){let{c:se}=this,Q=se.d,q=se.x(C);if(!q)return!1;if(this.o(q),se.m(3)==="]]>")throw this.a("Element content may not contain the CDATA section close delimiter `]]>`");return this.y(q,Q)}D(){let{c:se}=this,Q=se.d;if(!se.b("<!--"))return!1;let q=se.s("--");if(this.o(q),!se.b("-->"))throw se.m(2)==="--"?this.a("The string `--` isn't allowed inside a comment"):this.a("Unclosed comment");return this.g.preserveComments?this.i(new te(Le(q)),Q):!0}L(){let se=this.c.d,Q=this.C();return Q?this.y(Q,se):!1}M(){let{c:se}=this,Q=se.d;if(!se.b("<!DOCTYPE"))return!1;let q=this.e()&&this.q();if(!q)throw this.a("Expected a name");let $e,Qe;if(this.e()){if(se.b("PUBLIC")){if($e=this.e()&&this.N(),$e===!1)throw this.a("Expected a public identifier");this.e()}if($e!==void 0||se.b("SYSTEM")){if(this.e(),Qe=this.r(),Qe===!1)throw this.a("Expected a system identifier");this.e()}}let qe;if(se.b("[")){if(qe=se.x(/\][\x20\t\r\n]*>/),!se.b("]"))throw this.a("Unclosed internal subset");this.e()}if(!se.b(">"))throw this.a("Unclosed doctype declaration");return this.g.preserveDocumentType?this.i(new he(q,$e,Qe,qe),Q):!0}E(){let{c:se}=this,Q=se.d;if(!se.b("<"))return!1;let q=this.q();if(!q)return se.n(Q),!1;let $e=this.H(),Qe=!!se.b("/>"),qe=new pe(q,$e);if(qe.parent=this.j,!Qe){if(!se.b(">"))throw this.a(`Unclosed start tag for element \`${q}\``);this.j=qe;do this.K();while(this.E()||this.L()||this.J()||this.F()||this.D());let Lt=se.d,Pt;if(!se.b("</")||!(Pt=this.q())||Pt!==q)throw se.n(Lt),this.a(`Missing end tag for element ${q}`);if(this.e(),!se.b(">"))throw this.a(`Unclosed end tag for element ${q}`);this.j=qe.parent}return this.i(qe,Q)}t(){return this.e(),this.c.b("=")?(this.e(),!0):!1}z(){return this.D()||this.F()||this.e()}q(){return T(this.c.m())?this.c.w(S):le}F(){let{c:se}=this,Q=se.d;if(!se.b("<?"))return!1;let q=this.q();if(q){if(q.toLowerCase()==="xml")throw se.n(Q),this.a("XML declaration isn't allowed here")}else throw this.a("Invalid processing instruction");if(!this.e()){if(se.b("?>"))return this.i(new re(q),Q);throw this.a("Whitespace is required after a processing instruction name")}let $e=se.s("?>");if(this.o($e),!se.b("?>"))throw this.a("Unterminated processing instruction");return this.i(new re(q,Le($e)),Q)}O(){let{c:se}=this,Q=se.d;for(this.P();this.z(););if(this.M())for(;this.z(););return Q<se.d}N(){let se=this.c.d,Q=this.r();if(Q!==!1&&!/^[-\x20\r\na-zA-Z0-9'()+,./:=?;!*#@$_%]*$/.test(Q))throw this.c.n(se),this.a("Invalid character in public identifier");return Q}C(){let{c:se}=this;if(!se.b("&"))return!1;let Q=se.w(M);if(se.G()!==";")throw this.a("Unterminated reference (a reference must end with `;`)");let q;if(Q[0]==="#"){let $e=Q[1]==="x"?parseInt(Q.slice(2),16):parseInt(Q.slice(1),10);if(isNaN($e))throw this.a("Invalid character reference");if(!N($e))throw this.a("Character reference resolves to an invalid character");q=String.fromCodePoint($e)}else if(q=w[Q],q===void 0){let{ignoreUndefinedEntities:$e,resolveUndefinedEntity:Qe}=this.g,qe=`&${Q};`;if(Qe){let Lt=Qe(qe);if(Lt!=null){let Pt=typeof Lt;if(Pt!=="string")throw new TypeError(`\`resolveUndefinedEntity()\` must return a string, \`null\`, or \`undefined\`, but returned a value of type ${Pt}`);return Lt}}if($e)return qe;throw se.n(-qe.length),this.a(`Named entity isn't defined: ${qe}`)}return q}r(){let{c:se}=this,Q=se.b('"')||se.b("'");if(!Q)return!1;let q=se.s(Q);if(this.o(q),!se.b(Q))throw this.a("Missing end quote");return q}e(){return!!this.c.w(G)}P(){let{c:se}=this,Q=se.d;if(!se.b("<?xml"))return!1;if(!this.e())throw this.a("Invalid XML declaration");let q=!!se.b("version")&&this.t()&&this.r();if(q===!1)throw this.a("XML version is missing or invalid");if(!/^1\.[0-9]+$/.test(q))throw this.a("Invalid character in version number");let $e,Qe;if(this.e()){if($e=!!se.b("encoding")&&this.t()&&this.r(),$e){if(!/^[A-Za-z][\w.-]*$/.test($e))throw this.a("Invalid character in encoding name");this.e()}if(Qe=!!se.b("standalone")&&this.t()&&this.r(),Qe){if(Qe!=="yes"&&Qe!=="no")throw this.a('Only "yes" and "no" are permitted as values of `standalone`');this.e()}}if(!se.b("?>"))throw this.a("Invalid or unclosed XML declaration");return this.g.preserveXmlDeclaration?this.i(new ce(q,$e||void 0,Qe||void 0),Q):!0}a(se){let{c:Q}=this;return new D(se,Q.d,Q.h)}parse(){if(this.c.b("\uFEFF"),this.O(),!this.E())throw this.a("Root element is missing or invalid");for(;this.z(););if(!this.c.B)throw this.a("Extra content at the end of the document")}o(se){let{length:Q}=se;for(let q=0;q<Q;++q){let $e=se.codePointAt(q);if(!N($e))throw this.c.n(-([...se].length-q)),this.a("Invalid character");$e>65535&&(q+=1)}}};function Le(se){let Q=0;for(;(Q=se.indexOf("\r",Q))!==-1;)se=se[Q+1]===`
`?se.slice(0,Q)+se.slice(Q+1):se.slice(0,Q)+`
`+se.slice(Q+1);return se}function we(se,Q){return new fe(se,Q).document}return gS}var nB=hie();class die extends Error{constructor(e){super(e)}}function fie(n){let e=null;try{e=nB.parseXml(n)}catch(t){throw new die(t.message)}return e}function Fc(n){const e=n.indexOf(":");return e>-1?n.substr(e+1):n}function eo(n){return n.children[0]}function Oc(n){return n.name||""}function di(n,e,t=!1){const i=Fc(e);function r(o,s){return Fc(Oc(s))===i&&o.push(s),t&&Array.isArray(s.children)?[...o,...s.children.reduce(r,[])]:o}return n&&Array.isArray(n.children)?n.children.reduce(r,[]):[]}function gt(n,e,t=!1){return di(n,e,t)[0]||null}function xc(n){return n&&Array.isArray(n.children)?[...n.children.filter(e=>e instanceof nB.XmlElement)]:[]}function Wt(n){const e=n&&Array.isArray(n.children)?n.children.find(t=>t.type==="text"):null;return e?e.text:""}function Yi(n,e){return n&&n.attributes[e]||""}class mI extends Error{constructor(e,t,i){super(e),this.httpStatus=t,this.isCrossOriginRelated=i,this.name="EndpointError"}}class iB extends Error{constructor(e,t,i,r,o){super(e),this.requestUrl=t,this.code=i,this.locator=r,this.response=o,this.name="ServiceExceptionError"}}function l5(n,e){const t=Yi(n,"code")||Yi(n,"exceptionCode"),i=Yi(n,"locator"),r=gt(n,"ExceptionText")||n,o=Wt(r).trim();return new iB(o,e,t,i,n.document)}function ZM(n,e){const t=eo(n),i=Fc(Oc(t));if(i==="ServiceExceptionReport"){const r=gt(t,"ServiceException");if(r)throw l5(r,e)}if(i==="ExceptionReport"){const r=gt(t,"Exception");if(r)throw l5(r,e)}return n}function pie(n){const e={message:n.message,stack:n.stack,name:n.name};return n instanceof iB?{...e,code:n.code,locator:n.locator,response:n.response,requestUrl:n.requestUrl}:n instanceof mI?{...e,httpStatus:n.httpStatus,isCrossOriginRelated:n.isCrossOriginRelated}:e}const u5=["utf-8","utf-16","iso-8859-1"],c5="utf-8";function gie(n){const e=/charset=([^;]+)/.exec(n);return e?e[1]:null}function mie(n,e){const t=e?gie(e):null,i=t?[t,...u5]:u5;for(const r of i)try{return new TextDecoder(r,{fatal:!0}).decode(n)}catch{}return console.warn(`[ogc-client] XML document encoding could not be determined, falling back to ${c5}.`),new TextDecoder(c5).decode(n)}const vx=new Map;let rB={};function yie(n){rB=n}function sB(){return rB}function _ie(n,e="GET",t){let i=`${e}#${n}`;if(vx.has(i))return vx.get(i);const r={...sB()};r.method=e;const o=fetch(n,r).catch(s=>s).then(s=>(vx.delete(i),s));return vx.set(i,o),o.then(s=>{if(s instanceof Error)throw s;return s.clone()})}function Qw(n){return _ie(n).catch(()=>fetch(n,{...sB(),method:"HEAD",mode:"no-cors"}).catch(e=>{throw new mI(`Fetching the document failed either due to network errors or unreachable host, error is: ${e.message}`,0,!1)}).then(()=>{throw new mI("The document could not be fetched due to CORS limitations",0,!0)})).then(async e=>{if(!e.ok){const r=await e.text();throw new mI(`Received an error with code ${e.status}: ${r}`,e.status,!1)}const t=await e.arrayBuffer(),i=e.headers.get("Content-Type");return mie(t,i)}).then(e=>fie(e))}function zv(n,e){const t=n.match(/(https?%3A%2F%2F[^/]+)$/);if(t){const l=t[1],u=zv(decodeURIComponent(l),e);return n.replace(l,encodeURIComponent(u))}const i=new URL(n),r=Object.keys(e),o=r.map(l=>l.toLowerCase()),s=[];for(const l of i.searchParams.keys())o.indexOf(l.toLowerCase())>-1&&s.push(l);return s.map(l=>i.searchParams.delete(l)),r.forEach(l=>i.searchParams.set(l,e[l]===!0?"":e[l])),i.toString()}let vie=1e3*60*60;function bie(){return vie}let Ip;function eA(){return Ip!==void 0?Ip:"caches"in globalThis?(Ip=caches.open("ogc-client").catch(n=>(console.info("[ogc-client] Cache could not be accessed for the following reason:",n),null)),Ip):(Ip=Promise.resolve(null),Ip)}async function xie(n,...e){const t=await eA();if(!t)return;const i="https://cache/"+e.join("/");try{await t.put(i,new Response(JSON.stringify(n),{headers:{"x-expiry":(Date.now()+bie()).toString(10)}}))}catch(r){console.info("[ogc-client] Caching failed once for the following reason and will not be retried:",r),Ip=Promise.resolve(null)}}async function Iie(...n){const e=await eA();if(!e)return;const t="https://cache/"+n.join("/");return e.match(t).then(i=>!!i&&parseInt(i.headers.get("x-expiry"))>Date.now())}async function Cie(...n){const e=await eA();if(!e)return;const t="https://cache/"+n.join("/"),i=await e.match(t);return i?i.clone().json():null}const bx=new Map;async function wie(n,...e){if(await Aie(),await Iie(...e))return Cie(...e);const t=e.join("#");if(bx.has(t))return bx.get(t);const i=n();i instanceof Promise&&(i.then(()=>bx.delete(t)),bx.set(t,i));const r=await i;return await xie(r,...e),r}async function Aie(){const n=await eA();if(!n)return;const e=await n.keys();for(const t of e){const i=await n.match(t);parseInt(i.headers.get("x-expiry"))<=Date.now()&&await n.delete(t)}}function Sie(n,e,t,i,r,o,s,l,u,h,d,m){const x={SERVICE:"WFS",REQUEST:"GetFeature",VERSION:e,[e==="2.0.0"?"TYPENAMES":"TYPENAME"]:t};o!==void 0&&(x.PROPERTYNAME=o.join(","));const C=new URL(zv(n,x));if(Array.isArray(m)&&m.length>0){const w=m.map(S=>`${S[1]} ${S[0]}`).join(",");C.searchParams.set("SORTBY",w)}return C.toString()}function Eie(n,e,t,i,r,o,s,l,u){const h=e==="1.3.0"?"CRS":"SRS",d={SERVICE:"WMS",REQUEST:"GetMap",VERSION:e,LAYERS:t,STYLES:u??""};return d.WIDTH=i.toString(),d.HEIGHT=r.toString(),d.FORMAT=l??"image/png",d[h]=o,d.BBOX=s.join(","),zv(n,d)}class Tie{_capabilitiesUrl;_capabilitiesPromise;_info;_layers;_url;_version;constructor(e){this._capabilitiesUrl=zv(e,{SERVICE:"WMS",REQUEST:"GetCapabilities"}),this._capabilitiesPromise=wie(()=>cie(this._capabilitiesUrl),"WMS","CAPABILITIES",this._capabilitiesUrl).then(({info:t,layers:i,url:r,version:o})=>{this._info=t,this._layers=i,this._url=r,this._version=o})}isReady(){return this._capabilitiesPromise.then(()=>this)}getServiceInfo(){return this._info}getLayers(){function e(t){return{title:t.title,name:t.name,abstract:t.abstract,..."children"in t&&{children:t.children.map(e)}}}return this._layers.map(e)}getFlattenedLayers(){return this.getLayers().flatMap(oB)}getLayerByName(e){let t=null;function i(r){if(t===null){if(r.name===e){t=r;return}"children"in r&&r.children.map(i)}}return this._layers.map(i),t}getSingleLayerName(){if(!this._layers)return null;const e=[];function t(i){i.name&&e.push(i),"children"in i&&i.children.map(t)}return this._layers.map(t),e.length===1?e[0].name:null}getVersion(){return this._version}getMapUrl(e,t){if(!this._layers)return null;const{widthPx:i,heightPx:r,crs:o,extent:s,outputFormat:l,styles:u}=t;return Eie(this.getOperationUrl("GetMap")||this._capabilitiesUrl,this._version,e.join(","),i,r,o,s,l,u!==void 0?u.join(","):"")}getCapabilitiesUrl(){const e=this.getOperationUrl("GetCapabilities");return e?zv(e,{SERVICE:"WMS",REQUEST:"GetCapabilities"}):this._capabilitiesUrl}getOperationUrl(e,t="Get"){return this._url?this._url[e]?.[t]:null}}function oB(n){const e={title:n.title,name:n.name,abstract:n.abstract};return"children"in n&&Array.isArray(n.children)?[e,...n.children.flatMap(oB)]:[e]}const h5=new EventTarget;function Eb(n,e,t){const i=typeof WorkerGlobalScope<"u",r=async o=>{if(o.taskName===n){let s,l;try{s=await t(o.params)}catch(h){l=pie(h)}const u={taskName:n,requestId:o.requestId,...s&&{response:s},...l&&{error:l}};i?e.postMessage(u):h5.dispatchEvent(new CustomEvent("ogc-client.response",{detail:u}))}};i?e.addEventListener("message",o=>r(o.data)):h5.addEventListener("ogc-client.request",o=>r(o.detail))}const Rie=["EPSG:4046","EPSG:4075","EPSG:4120","EPSG:4122","EPSG:4124","EPSG:4126","EPSG:4149","EPSG:4151","EPSG:4153","EPSG:4155","EPSG:4157","EPSG:4159","EPSG:4161","EPSG:4163","EPSG:4165","EPSG:4167","EPSG:4169","EPSG:4171","EPSG:4173","EPSG:4175","EPSG:4178","EPSG:4180","EPSG:4182","EPSG:4184","EPSG:4188","EPSG:4190","EPSG:4191","EPSG:4196","EPSG:4198","EPSG:4202","EPSG:4210","EPSG:4211","EPSG:4214","EPSG:4226","EPSG:4229","EPSG:4231","EPSG:4233","EPSG:4236","EPSG:4238","EPSG:4240","EPSG:4242","EPSG:4244","EPSG:4246","EPSG:4248","EPSG:4250","EPSG:4252","EPSG:4255","EPSG:4258","EPSG:4261","EPSG:4264","EPSG:4267","EPSG:4270","EPSG:4273","EPSG:4276","EPSG:4279","EPSG:4281","EPSG:4284","EPSG:4286","EPSG:4288","EPSG:4292","EPSG:4295","EPSG:4297","EPSG:4299","EPSG:4302","EPSG:4324","EPSG:4326"];function Mie(n){return Rie.indexOf(gT(n))>-1}function gT(n){return/^urn:(?:x-)?ogc:def:crs:epsg:/.test(n.toLowerCase())?`EPSG:${/([0-9]+)$/.exec(n)[1]}`:n}function kie(n){const e={},t=gt(eo(n),"Capability"),i=gt(t,"Request");return xc(i).forEach(r=>{const o=Fc(Oc(r));e[o]=Nie(r)}),e}function aB(n){return eo(n).attributes.version}function Lie(n){const e=aB(n),t=gt(eo(n),"Capability");return di(t,"Layer").map(i=>lB(i,e))}function Pie(n){const e=gt(eo(n),"Capability"),t=gt(gt(e,"Request"),"GetMap");return di(t,"Format").map(Wt)}function Gie(n){const e=gt(eo(n),"Capability"),t=gt(gt(e,"Request"),"GetFeatureInfo");return di(t,"Format").map(Wt)}function Fie(n){const e=gt(eo(n),"Capability"),t=gt(e,"Exception");return di(t,"Format").map(Wt)}function Oie(n){const e=gt(eo(n),"Service"),t=Pie(n),i=Gie(n),r=Fie(n),o=di(gt(e,"KeywordList"),"Keyword").map(Wt).filter((l,u,h)=>h.indexOf(l)===u),s=Bie(n);return{title:Wt(gt(e,"Title")),name:Wt(gt(e,"Name")),abstract:Wt(gt(e,"Abstract")),outputFormats:t,infoFormats:i,exceptionFormats:r,fees:Wt(gt(e,"Fees")),constraints:Wt(gt(e,"AccessConstraints")),provider:s,keywords:o}}function Nie(n){const e={};return di(n,"DCPType").flatMap(o=>gt(o,"HTTP")).flatMap(o=>xc(o)).forEach(o=>{const s=gt(o,"OnlineResource"),l=Fc(Oc(o));e[l]=Yi(s,"xlink:href")}),e}function lB(n,e,t=[],i=[],r=null,o=null,s=null,l=null){const u=e==="1.3.0"?"CRS":"SRS",h=di(n,u).map(Wt),d=h.length>0?h:t,m=di(n,"Style").map(Die),y=m.length>0?m:i;function x(re){const le=Yi(re,u);return(Mie(le)&&e==="1.3.0"?["miny","minx","maxy","maxx"]:["minx","miny","maxx","maxy"]).map(Le=>Yi(re,Le))}function C(re){return["westBoundLongitude","southBoundLatitude","eastBoundLongitude","northBoundLatitude"].map(le=>Wt(gt(re,le)))}function w(re){return["minx","miny","maxx","maxy"].map(le=>Yi(re,le))}function S(re,le){return re===""?le:Math.sqrt(.5*parseFloat(re)**2)/28e-5}function T(){const re=gt(n,"ScaleHint");if(!re)return[l,s];const le=Yi(re,"min"),fe=Yi(re,"max");return[S(le,l),S(fe,s)]}function M(re,le){const fe=Wt(gt(n,re));return fe===""?le:parseFloat(fe)}const G=gt(n,"Attribution"),N=G!==null?Vie(G):r,V=e==="1.3.0"?gt(n,"EX_GeographicBoundingBox"):gt(n,"LatLonBoundingBox"),W={};V&&(W["EPSG:4326"]=e==="1.3.0"?C(V):w(V));let j=di(n,"BoundingBox").reduce((re,le)=>({...re,[Yi(le,u)]:x(le)}),W);j=Object.keys(j).length>0||o===null?j:o;const J=n.attributes.queryable==="1"||n.attributes.queryable==="true",te=n.attributes.opaque==="1"||n.attributes.opaque==="true",ce=di(gt(n,"KeywordList"),"Keyword").map(Wt).filter((re,le,fe)=>fe.indexOf(re)===le);let pe,Y;e==="1.3.0"?(pe=M("MinScaleDenominator",l),Y=M("MaxScaleDenominator",s)):[pe,Y]=T();const he=di(n,"MetadataURL").map(re=>({type:Yi(re,"type"),format:Wt(gt(re,"Format")),url:Yi(gt(re,"OnlineResource"),"xlink:href")})),D=di(n,"Layer").map(re=>lB(re,e,d,y,N,j,Y,pe));return{name:Wt(gt(n,"Name")),title:Wt(gt(n,"Title")),abstract:Wt(gt(n,"Abstract")),availableCrs:d,styles:y,attribution:N,boundingBoxes:j,keywords:ce,queryable:J,opaque:te,...pe!==null?{minScaleDenominator:pe}:{},...Y!==null?{maxScaleDenominator:Y}:{},...he.length&&{metadata:he},...D.length&&{children:D}}}function Die(n){const e=Yi(gt(gt(n,"LegendURL"),"OnlineResource"),"xlink:href"),t=Wt(gt(n,"Abstract"));return{name:Wt(gt(n,"Name")),title:Wt(gt(n,"Title")),...t&&{abstract:t},...e&&{legendUrl:e}}}function Vie(n){const e=Yi(gt(gt(n,"LogoURL"),"OnlineResource"),"xlink:href"),t=Yi(gt(n,"OnlineResource"),"xlink:href"),i=Wt(gt(n,"Title"));return{...i&&{title:i},...t&&{url:t},...e&&{logoUrl:e}}}function Bie(n){const e=gt(eo(n),"Service"),t=gt(e,"ContactInformation"),i=gt(t,"ContactPersonPrimary"),r=gt(t,"ContactAddress");return{contact:{name:Wt(gt(i,"ContactPerson")),organization:Wt(gt(i,"ContactOrganization")),position:Wt(gt(t,"ContactPosition")),phone:Wt(gt(t,"ContactVoiceTelephone")),fax:Wt(gt(t,"ContactFacsimileTelephone")),address:{deliveryPoint:Wt(gt(r,"Address")),city:Wt(gt(r,"City")),administrativeArea:Wt(gt(r,"StateOrProvince")),postalCode:Wt(gt(r,"PostCode")),country:Wt(gt(r,"Country"))},email:Wt(gt(t,"ContactElectronicMailAddress"))}}}function uB(n){const e=gt(eo(n),"ServiceProvider"),t=gt(e,"ServiceContact"),i=gt(t,"ContactInfo"),r=gt(i,"Phone"),o=gt(i,"Address");return{name:Wt(gt(e,"ProviderName")),site:Yi(gt(e,"ProviderSite"),"xlink:href"),contact:{name:Wt(gt(t,"IndividualName")),position:Wt(gt(t,"PositionName")),phone:Wt(gt(r,"Voice")),fax:Wt(gt(r,"Facsimile")),address:{deliveryPoint:Wt(gt(o,"DeliveryPoint")),city:Wt(gt(o,"City")),administrativeArea:Wt(gt(o,"AdministrativeArea")),postalCode:Wt(gt(o,"PostalCode")),country:Wt(gt(o,"Country"))},email:Wt(gt(o,"ElectronicMailAddress"))}}}function Zie(n){const e={},t=eo(n),i=gt(t,"OperationsMetadata");if(i)di(i,"Operation").forEach(r=>{const o=Yi(r,"name");e[o]=Xie(r)});else{const r=gt(t,"Capability"),o=gt(r,"Request");xc(o).forEach(s=>{const l=Fc(Oc(s));e[l]=Uie(s)})}return e}function tA(n){return eo(n).attributes.version}function cB(n){const e=tA(n);let t;if(e.startsWith("1.0")){const i=gt(gt(gt(eo(n),"Capability"),"Request"),"GetFeature");t=xc(gt(i,"ResultFormat")).map(Oc)}else{const i=gt(eo(n),"OperationsMetadata"),r=di(i,"Operation").find(s=>Yi(s,"name")==="GetFeature"),o=di(r,"Parameter").find(s=>Yi(s,"name")==="outputFormat");t=di(o,"Value",!0).map(Wt)}return t}function Wie(n){const e=tA(n),t=e.startsWith("1.0")?"Service":"ServiceIdentification",i=e.startsWith("1.0")?"Name":"ServiceType",r=gt(eo(n),t);let o;e.startsWith("1.0")?o=Wt(gt(r,"Keywords")).split(",").map(l=>l.trim()):o=di(gt(r,"Keywords"),"Keyword").map(Wt);let s;return e!=="1.0.0"&&(s=uB(n)),{title:Wt(gt(r,"Title")),name:Wt(gt(r,i)),abstract:Wt(gt(r,"Abstract")),fees:Wt(gt(r,"Fees")),constraints:Wt(gt(r,"AccessConstraints")),keywords:o,provider:s,outputFormats:cB(n)}}function zie(n){const e=tA(n),t=cB(n),i=gt(eo(n),"FeatureTypeList");return di(i,"FeatureType").map(r=>Yie(r,e,t))}function Uie(n){const e={};return di(n,"DCPType").flatMap(o=>di(o,"HTTP")).flatMap(o=>xc(o)).forEach(o=>{const s=Fc(Oc(o));e[s]=Yi(o,"onlineResource")}),e}function Xie(n){const e={};return di(n,"DCP").flatMap(o=>gt(o,"HTTP")).flatMap(o=>xc(o)).forEach(o=>{const s=Fc(Oc(o));e[s]=Yi(o,"xlink:href")}),e}function Yie(n,e,t){const i=e.startsWith("2.")?"CRS":"SRS",r=e.startsWith("1.0")?"SRS":`Default${i}`;function o(){const m=gt(n,"LatLongBoundingBox");return["minx","miny","maxx","maxy"].map(y=>Yi(m,y)).map(parseFloat)}function s(){const m=gt(n,"WGS84BoundingBox");return["LowerCorner","UpperCorner"].map(y=>gt(m,y)).map(y=>Wt(y).split(" ")).reduce((y,x)=>[...y,...x]).map(parseFloat)}const l=e.startsWith("1.0")?[]:di(n,`Other${i}`).map(Wt).map(gT),u=e.startsWith("1.0")?[]:di(gt(n,"OutputFormats"),"Format").map(Wt),h=e.startsWith("1.0")?Wt(gt(n,"Keywords")).split(",").map(m=>m.trim()):di(gt(n,"Keywords"),"Keyword").map(Wt).filter((m,y,x)=>x.indexOf(m)===y),d=e==="2.0.0"?di(n,"MetadataURL").map(m=>({url:Yi(m,"xlink:href")})):di(n,"MetadataURL").map(m=>({format:Yi(m,"format"),type:Yi(m,"type"),url:Wt(m).trim()}));return{name:Wt(gt(n,"Name")),title:Wt(gt(n,"Title")),abstract:Wt(gt(n,"Abstract")),defaultCrs:gT(Wt(gt(n,r))),otherCrs:l,outputFormats:u.length>0?u:t,latLonBoundingBox:e.startsWith("1.0")?o():s(),keywords:h,...d.length&&{metadata:d}}}function hB(n){const e=["LowerCorner","UpperCorner"].map(t=>gt(n,t)).map(t=>Wt(t).split(" ")).reduce((t,i)=>[...t,...i]).map(parseFloat);return e.some(Number.isNaN)?null:e}function Hie(n){const e=eo(n),t=gt(e,"ServiceIdentification"),i=di(gt(t,"Keywords"),"Keyword").map(Wt),r=gt(e,"OperationsMetadata"),o=di(r,"Operation").find(l=>Yi(l,"name")=="GetTile"),s=di(o,"Get",!0).reduce((l,u)=>{const h=Wt(gt(u,"Value",!0)),d=Yi(u,"xlink:href");return h.toLowerCase()==="restful"?{...l,rest:d}:{...l,kvp:d}},{});return{title:Wt(gt(t,"Title")),name:Wt(gt(t,"ServiceType")),abstract:Wt(gt(t,"Abstract")),fees:Wt(gt(t,"Fees")),constraints:Wt(gt(t,"AccessConstraints")),keywords:i,provider:uB(n),getTileUrls:s}}function Kie(n){function e(r){const o=Wt(gt(r,"TopLeftCorner")).split(" ").map(parseFloat);return{identifier:Wt(gt(r,"Identifier")),tileWidth:parseInt(Wt(gt(r,"TileWidth"))),tileHeight:parseInt(Wt(gt(r,"TileHeight"))),matrixWidth:parseInt(Wt(gt(r,"MatrixWidth"))),matrixHeight:parseInt(Wt(gt(r,"MatrixHeight"))),scaleDenominator:parseFloat(Wt(gt(r,"ScaleDenominator"))),topLeft:o}}const t=gt(eo(n),"Contents");return di(t,"TileMatrixSet").map(r=>{const o=Wt(gt(r,"WellKnownScaleSet")),s=hB(gt(r,"BoundingBox"));return{identifier:Wt(gt(r,"Identifier")),crs:Wt(gt(r,"SupportedCRS")),tileMatrices:di(r,"TileMatrix").map(e),...s&&{boundingBox:s},...o&&{wellKnownScaleSet:o}}})}function jie(n){const e=eo(n),t=gt(e,"Contents");function i(d,m){const y=di(d,"TileMatrixSet").find(x=>{const C=gt(x,"Identifier");return Wt(C)===m});return Wt(gt(y,"SupportedCRS"))}function r(d){const m=Wt(gt(d,"TileMatrixSet")),y=i(t,m);return{identifier:m,crs:y,limits:di(d,"TileMatrixLimits",!0).map(x=>({tileMatrix:Wt(gt(x,"TileMatrix")),minTileRow:parseInt(Wt(gt(x,"MinTileRow"))),minTileCol:parseInt(Wt(gt(x,"MinTileCol"))),maxTileRow:parseInt(Wt(gt(x,"MaxTileRow"))),maxTileCol:parseInt(Wt(gt(x,"MaxTileCol")))}))}}const o=di(gt(e,"OperationsMetadata"),"Operation").find(d=>Yi(d,"name")=="GetTile"),s=di(o,"Get",!0).filter(d=>Wt(gt(d,"Value",!0)).toLowerCase()==="kvp")[0],l=s?Yi(s,"xlink:href"):"",u=gt(e,"Contents");return di(u,"Layer").map(d=>{const m=hB(gt(d,"WGS84BoundingBox"));let y="";const x=di(d,"Style").map(M=>{const G=Yi(gt(M,"LegendURL"),"xlink:href"),N=Wt(gt(M,"Abstract")),V={title:Wt(gt(M,"Title")),name:Wt(gt(M,"Identifier")),...N&&{abstract:N},...G&&{legendUrl:G}};return Yi(M,"isDefault")==="true"&&(y=V.name),V}),C=di(d,"Format").map(Wt),w=di(d,"ResourceURL").filter(M=>Yi(M,"resourceType")==="tile").map(M=>{const G=Yi(M,"format"),N=Yi(M,"template");return{format:G,url:N,encoding:"REST"}});l&&w.push(...C.map(M=>({encoding:"KVP",url:l,format:M})));const S=di(d,"TileMatrixSetLink").map(r),T=di(d,"Dimension").map(M=>{const G=Wt(gt(M,"Identifier")),N=Wt(gt(M,"Default")),V=di(M,"Values").map(Wt);return{identifier:G,defaultValue:N,values:V}});return{name:Wt(gt(d,"Identifier")),title:Wt(gt(d,"Title")),abstract:Wt(gt(d,"Abstract")),styles:x,resourceLinks:w,matrixSets:S,defaultStyle:y,...m&&{latLonBoundingBox:m},...T&&{dimensions:T}}})}function $ie(n,e,t){const i=eo(n);let r;if(t.startsWith("2.0"))r=di(i,"member").map(h=>xc(h)[0]);else{const h=gt(i,"featureMembers");r=h?xc(h):di(i,"featureMember").map(d=>xc(d)[0])}const o=t==="1.0.0"?"fid":"gml:id";function s(h){return h in e.properties}function l(h,d){switch(e.properties[h]){case"integer":return parseInt(d);case"float":return parseFloat(d);case"boolean":return d==="true";default:return d}}function u(h){return xc(h).filter(d=>s(Fc(Oc(d)))).reduce((d,m)=>{const y=Fc(Oc(m));return{...d,[y]:l(y,Wt(m))}},{})}return r.map(h=>({id:Yi(h,o),properties:u(h)}))}function Jie(n){return n.reduce((e,t)=>{for(const i in t.properties){const r=t.properties[i];i in e||(e[i]={uniqueValues:[]});const o=e[i].uniqueValues.find(s=>s.value===r);o?o.count++:e[i].uniqueValues.push({value:r,count:1})}return e},{})}Eb("parseWmsCapabilities",globalThis,({url:n})=>Qw(n).then(e=>ZM(e,n)).then(e=>({info:Oie(e),layers:Lie(e),url:kie(e),version:aB(e)})));Eb("parseWfsCapabilities",globalThis,({url:n})=>Qw(n).then(e=>ZM(e,n)).then(e=>({info:Wie(e),featureTypes:zie(e),url:Zie(e),version:tA(e)})));Eb("queryWfsFeatureTypeDetails",globalThis,({url:n,serviceVersion:e,featureTypeFull:t})=>{const i=Sie(n,e,t.name,void 0,void 0,Object.keys(t.properties));return Qw(i).then(r=>({props:Jie($ie(r,t,e))}))});Eb("updateFetchOptions",globalThis,({options:n})=>(yie(n),Promise.resolve({})));Eb("parseWmtsCapabilities",globalThis,({url:n})=>Qw(n).then(e=>ZM(e,n)).then(e=>({info:Hie(e),layers:jie(e),matrixSets:Kie(e)})));const qie=()=>[{url:"http://wmts1.geoportail.lu/opendata/service",label:"Open Data Webservices WMS"},{url:"http://ows.terrestris.de/osm-gray/service",label:"OpenStreetMap by Terrestris (Grey)"},{url:"http://ows.terrestris.de/osm/service",label:"OpenStreetMap by Terrestris (Color)"}],AC="http://www.w3.org/2001/XMLSchema-instance";function $h(n,e){return Xy().createElementNS(n,e)}function Vu(n,e){return dB(n,e,[]).join("")}function dB(n,e,t){if(n.nodeType==Node.CDATA_SECTION_NODE||n.nodeType==Node.TEXT_NODE)t.push(n.nodeValue);else{let i;for(i=n.firstChild;i;i=i.nextSibling)dB(i,e,t)}return t}function Ic(n){return"documentElement"in n}function Cc(n){return new DOMParser().parseFromString(n,"application/xml")}function d5(n,e){return(function(t,i){const r=n.call(e??this,t,i);if(r!==void 0){const o=i[i.length-1];dr(o,r)}})}function Ha(n,e){return(function(t,i){const r=n.call(e??this,t,i);r!==void 0&&i[i.length-1].push(r)})}function WM(n,e){return(function(t,i){const r=n.call(this,t,i);r!==void 0&&(i[i.length-1]=r)})}function Ua(n,e,t){return(function(i,r){const o=n.call(this,i,r);if(o!==void 0){const s=r[r.length-1],l=i.localName;let u;l in s?u=s[l]:(u=[],s[l]=u),u.push(o)}})}function at(n,e,t){return(function(i,r){const o=n.call(this,i,r);if(o!==void 0){const s=r[r.length-1],l=e!==void 0?e:i.localName;s[l]=o}})}function jt(n,e){return(function(t,i,r){n.call(this,t,i,r),r[r.length-1].node.appendChild(t)})}function fB(n,e){let t,i;return function(r,o,s){if(t===void 0){t={};const l={};l[r.localName]=n,t[r.namespaceURI]=l,i=Bu(r.localName)}pB(t,i,o,s)}}function Bu(n,e){return(function(t,i,r){const s=i[i.length-1].node;let l=n;l===void 0&&(l=r);const u=s.namespaceURI;return $h(u,l)})}const oa=Bu();function el(n,e){const t=e.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=n[e[r]];return i}function Ft(n,e,t){t=t!==void 0?t:{};let i,r;for(i=0,r=n.length;i<r;++i)t[n[i]]=e;return t}function Sf(n,e,t,i){let r;for(r=e.firstElementChild;r;r=r.nextElementSibling){const o=n[r.namespaceURI];if(o!==void 0){const s=o[r.localName];s!==void 0&&s.call(i,r,t)}}}function kn(n,e,t,i,r){return i.push(n),Sf(e,t,i,r),i.pop()}function pB(n,e,t,i,r,o){const s=(r!==void 0?r:t).length;let l,u;for(let h=0;h<s;++h)l=t[h],l!==void 0&&(u=e.call(o,l,i,r!==void 0?r[h]:void 0),u!==void 0&&n[u.namespaceURI][u.localName].call(o,u,l,i))}function Gr(n,e,t,i,r,o,s){return r.push(n),pB(e,t,i,r,o,s),r.pop()}let mS;function Qie(){return mS===void 0&&typeof XMLSerializer<"u"&&(mS=new XMLSerializer),mS}let yS;function Xy(){return yS===void 0&&typeof document<"u"&&(yS=document.implementation.createDocument("","",null)),yS}class gB{read(e){if(!e)return null;if(typeof e=="string"){const t=Cc(e);return this.readFromDocument(t)}return Ic(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){Zn()}}const ere="http://www.w3.org/1999/xlink";function zM(n){return n.getAttributeNS(ere,"href")}function mf(n){const e=Vu(n,!1);return tre(e)}function tre(n){const e=/^\s*(true|1)|(false|0)\s*$/.exec(n);if(e)return e[1]!==void 0||!1}function nA(n){const e=Vu(n,!1),t=Date.parse(e);return isNaN(t)?void 0:t/1e3}function nr(n){const e=Vu(n,!1);return nre(e)}function nre(n){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(n);if(e)return parseFloat(e[1])}function Cl(n){const e=Vu(n,!1);return ire(e)}function ire(n){const e=/^\s*(\d+)\s*$/.exec(n);if(e)return parseInt(e[1],10)}function pn(n){return Vu(n,!1).trim()}function Ey(n,e){rr(n,e?"1":"0")}function rre(n,e){n.appendChild(Xy().createCDATASection(e))}function sre(n,e){const t=new Date(e*1e3),i=t.getUTCFullYear()+"-"+Xd(t.getUTCMonth()+1,2)+"-"+Xd(t.getUTCDate(),2)+"T"+Xd(t.getUTCHours(),2)+":"+Xd(t.getUTCMinutes(),2)+":"+Xd(t.getUTCSeconds(),2)+"Z";n.appendChild(Xy().createTextNode(i))}function Za(n,e){const t=e.toPrecision();n.appendChild(Xy().createTextNode(t))}function SC(n,e){const t=e.toString();n.appendChild(Xy().createTextNode(t))}const ore=/^\s/,are=/\s$/,lre=/(\n|\t|\r|<|&| {2})/;function rr(n,e){typeof e=="string"&&(ore.test(e)||are.test(e)||lre.test(e))?e.split("]]>").forEach((t,i,r)=>{i<r.length-1&&(t+="]]"),i>0&&(t=">"+t),rre(n,t)}):n.appendChild(Xy().createTextNode(e))}const nl=[null,"http://www.opengis.net/ows/1.1"],ure=Ft(nl,{ServiceIdentification:at(Gre),ServiceProvider:at(Ore),OperationsMetadata:at(Lre)});class cre extends gB{constructor(){super()}readFromNode(e){const t=kn({},ure,e,[]);return t||null}}const hre=Ft(nl,{DeliveryPoint:at(pn),City:at(pn),AdministrativeArea:at(pn),PostalCode:at(pn),Country:at(pn),ElectronicMailAddress:at(pn)}),dre=Ft(nl,{Value:Ua(Nre)}),fre=Ft(nl,{AllowedValues:at(Are)}),pre=Ft(nl,{Phone:at(Pre),Address:at(wre)}),gre=Ft(nl,{HTTP:at(Mre)}),mre=Ft(nl,{Get:Ua(Rre),Post:void 0}),yre=Ft(nl,{DCP:at(Tre)}),_re=Ft(nl,{Operation:kre}),vre=Ft(nl,{Voice:at(pn),Facsimile:at(pn)}),bre=Ft(nl,{Constraint:Ua(Sre)}),xre=Ft(nl,{IndividualName:at(pn),PositionName:at(pn),ContactInfo:at(Ere)}),Ire=Ft(nl,{Abstract:at(pn),AccessConstraints:at(pn),Fees:at(pn),Title:at(pn),ServiceTypeVersion:at(pn),ServiceType:at(pn)}),Cre=Ft(nl,{ProviderName:at(pn),ProviderSite:at(zM),ServiceContact:at(Fre)});function wre(n,e){return kn({},hre,n,e)}function Are(n,e){return kn({},dre,n,e)}function Sre(n,e){const t=n.getAttribute("name");if(t)return kn({name:t},fre,n,e)}function Ere(n,e){return kn({},pre,n,e)}function Tre(n,e){return kn({},gre,n,e)}function Rre(n,e){const t=zM(n);if(t)return kn({href:t},bre,n,e)}function Mre(n,e){return kn({},mre,n,e)}function kre(n,e){const t=n.getAttribute("name"),i=kn({},yre,n,e);if(!i)return;const r=e[e.length-1];r[t]=i}function Lre(n,e){return kn({},_re,n,e)}function Pre(n,e){return kn({},vre,n,e)}function Gre(n,e){return kn({},Ire,n,e)}function Fre(n,e){return kn({},xre,n,e)}function Ore(n,e){return kn({},Cre,n,e)}function Nre(n,e){return pn(n)}const Zc=[null,"http://www.opengis.net/wmts/1.0"],Yy=[null,"http://www.opengis.net/ows/1.1"],Dre=Ft(Zc,{Contents:at(jre)});class Vre extends gB{constructor(){super(),this.owsParser_=new cre}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let i=this.owsParser_.readFromNode(e);return i?(i.version=t,i=kn(i,Dre,e,[]),i||null):null}}const Bre=Ft(Zc,{Layer:Ua($re),TileMatrixSet:Ua(Jre)}),Zre=Ft(Zc,{Style:Ua(qre),Format:Ua(pn),TileMatrixSetLink:Ua(Qre),Dimension:Ua(ese),ResourceURL:Ua(tse)},Ft(Yy,{Title:at(pn),Abstract:at(pn),WGS84BoundingBox:at(yB),BoundingBox:Ua(nse),Identifier:at(pn)})),Wre=Ft(Zc,{LegendURL:Ua(ise)},Ft(Yy,{Title:at(pn),Identifier:at(pn)})),zre=Ft(Zc,{TileMatrixSet:at(pn),TileMatrixSetLimits:at(sse)}),Ure=Ft(Zc,{TileMatrixLimits:Ha(ose)}),Xre=Ft(Zc,{TileMatrix:at(pn),MinTileRow:at(Cl),MaxTileRow:at(Cl),MinTileCol:at(Cl),MaxTileCol:at(Cl)}),Yre=Ft(Zc,{Default:at(pn),Value:Ua(pn)},Ft(Yy,{Identifier:at(pn)})),mB=Ft(Yy,{LowerCorner:Ha(mT),UpperCorner:Ha(mT)}),Hre=Ft(Zc,{WellKnownScaleSet:at(pn),TileMatrix:Ua(rse)},Ft(Yy,{SupportedCRS:at(pn),Identifier:at(pn),BoundingBox:at(yB)})),Kre=Ft(Zc,{TopLeftCorner:at(mT),ScaleDenominator:at(nr),TileWidth:at(Cl),TileHeight:at(Cl),MatrixWidth:at(Cl),MatrixHeight:at(Cl)},Ft(Yy,{Identifier:at(pn)}));function jre(n,e){return kn({},Bre,n,e)}function $re(n,e){return kn({},Zre,n,e)}function Jre(n,e){return kn({},Hre,n,e)}function qre(n,e){const t=kn({},Wre,n,e);if(!t)return;const i=n.getAttribute("isDefault")==="true";return t.isDefault=i,t}function Qre(n,e){return kn({},zre,n,e)}function ese(n,e){return kn({},Yre,n,e)}function tse(n,e){const t=n.getAttribute("format"),i=n.getAttribute("template"),r=n.getAttribute("resourceType"),o={};return t&&(o.format=t),i&&(o.template=i),r&&(o.resourceType=r),o}function yB(n,e){const t=kn([],mB,n,e);if(t.length==2)return Ks(t)}function nse(n,e){const t=n.getAttribute("crs"),i=kn([],mB,n,e);if(i.length==2)return{extent:Ks(i),crs:t}}function ise(n,e){const t={};return t.format=n.getAttribute("format"),t.href=zM(n),t}function mT(n,e){const t=pn(n).split(/\s+/);if(!t||t.length!=2)return;const i=+t[0],r=+t[1];if(!(isNaN(i)||isNaN(r)))return[i,r]}function rse(n,e){return kn({},Kre,n,e)}function sse(n,e){return kn([],Ure,n,e)}function ose(n,e){return kn({},Xre,n,e)}class ase{capabilitiesPromise;serviceInfo;layers;constructor(e){const t=new Vre;let i="&";e.indexOf("?")===-1&&(i="?"),e.indexOf("Capabilities")===-1&&(e=e+i+"SERVICE=WMTS&REQUEST=GetCapabilities"),this.capabilitiesPromise=fetch(e).then(r=>r.text()).then(r=>{const o=t.read(r);this.serviceInfo=this.mapServiceInfo(o.ServiceIdentification),this.layers=this.mapToRemoteLayers(o.Contents?.Layer)})}mapToRemoteLayers(e){return[{type:Tc.WMTS,children:e.map(t=>({type:Tc.WMTS,abstract:t.Abstract,format:t.Format,name:t.Identifier,title:t.Title,tileMatrixSetLink:t.TileMatrixSetLink,wgs84BoundingBox:t.WGS84BoundingBox}))}]}mapServiceInfo(e){return{type:Tc.WMTS,title:e.Title,abstract:e.Abstract,fees:e.Fees,constraints:e.AccessConstraints,serviceTypeVersion:e.ServiceTypeVersion}}isReady(){return this.capabilitiesPromise.then(()=>this)}getLayerByName(e){return this.layers[0].children.filter(t=>t.name===e)[0]}getLayers(){return this.layers}getServiceInfo(){return this.serviceInfo}}const lse="https://migration.geoportail.lu/ogcproxywms",use="https://migration.geoportail.lu/httpsproxy";class cse{_wmsProxyUrl=lse;_remoteProxyUrl=use;get wmsProxyUrl(){return this._wmsProxyUrl===void 0&&console.warn("Warning: proxyWmsUrl is not set."),this._wmsProxyUrl}get remoteProxyUrl(){return this._remoteProxyUrl===void 0&&console.warn("Warning: remoteProxy is not set."),this._remoteProxyUrl}getProxyfiedUrl(e){return e.indexOf("httpsproxy")>0?e:this.remoteProxyUrl+"?url="+encodeURIComponent(e)}init_v3(e,t){e&&(this._wmsProxyUrl=e),t&&(this._remoteProxyUrl=t),console.warn("Deprecated: ProxyUrlHelper.init_v3() is meant to be removed when v4 is fully operational")}}const Uv=new cse;class hse{async getRemoteEndpoint(e){let t;return await this.getWmsEndpoint(e).isReady().catch(async()=>{t=await this.getWmtsEndpoint(e).isReady()})||t}getWmsEndpoint(e){return new Tie(Uv.getProxyfiedUrl(e))}getWmtsEndpoint(e){return new ase(Uv.getProxyfiedUrl(e))}async fetchRemoteWmsEndpoint(){return new Promise(e=>e(qie()))}isRemoteLayer(e){return typeof e=="string"&&(e.indexOf(Tc.WMS)===0||e.indexOf(Tc.WMTS)===0)}}const Xv=new hse;class _B{}class dse extends _B{async getMetadata(e,t,i){const r=Xv.getWmsEndpoint(t);await r.isReady();const o=r?.getServiceInfo(),s=r?.getLayerByName(i);return{title:s.title,description:s.abstract,keywords:o.keywords,accessConstraints:o.constraints,serviceDescription:o.abstract}}}const fse=new dse;class pse extends _B{async getMetadata(e,t,i){const r=Xv.getWmtsEndpoint(t);await r.isReady();const o=r?.getServiceInfo(),s=r?.getLayerByName(i);return{title:s.title,description:s.abstract,accessConstraints:o.constraints,serviceDescription:o.abstract}}}const gse=new pse;class mse{async getMetadata(e,t,i){if(e===Tc.WMS)return fse.getMetadata(e,t,i);if(e===Tc.WMTS)return gse.getMetadata(e,t,i);throw new Error(`Unsupported service type: ${e}`)}}const yse=new mse,xx=new Map,_se="https://geocatalogue.geoportail.lu/geonetwork/srv",vse="https://migration.geoportail.lu/legends/get_html",bse="https://migration.geoportail.lu/getMetadata";class xse{async getLayerMetadata(e,t){let i;const o=Sl().findAnyLayerById(e);return xx.has(e)?xx.get(e):(o?i=this.getLayerMetadataLocal(o,t):i=this.getLayerMetadataRemote(e),xx.set(e,i),i)}async getLayerMetadataRemote(e){const[t,i,r]=String(e).split("%2D").join("-").split("||");return yse.getMetadata(t,i,r)}async getLayerMetadataLocal(e,t){const i=e.metadata,r=i?.metadata_id,o=r?await this.getLocalMetadata(bse,r,t):{isError:!0},s=e.name,l=i?.legend_name||"",u=e?.id,h=await this.getLegendHtml(vse,l,u,t),d=!!h&&h.hasChildNodes();return{...o,title:s,hasLegend:d,...d&&{legendHtml:h}}}getLocalMetadata(e,t,i){return fetch(`${e}?lang=${i}&uid=${t}`).then(async r=>{const o=(await r.json()).metadata;return{name:o.title,serviceDescription:o.serviceDescription,description:o.abstract,legalConstraints:o.legalConstraints,link:Fee(o.link),revisionDate:o.revisionDate,keyword:o.keyword,responsibleParty:o.responsibleParty?Oee(o.responsibleParty):void 0,metadataLink:`${_se}/${Pee(i)}/catalog.search#/metadata/${t}`,isError:!1}}).catch(()=>({isError:!0}))}getLegendHtml(e,t,i,r){const o={lang:r,...t&&{name:t},...i&&{id:i.toString()}};if(o.lang){window.devicePixelRatio>1&&(o.dpi=(window.devicePixelRatio*96).toString());const s=`${e}?${new URLSearchParams(o).toString()}`;return fetch(s).then(async l=>{if(l.status>=400&&l.status<600)throw new Error("Server responded with error code");const u=await l.text();return u?Gee(u):void 0}).catch(()=>{})}}clearCache(){xx.clear()}}const EC=new xse,Hy="ipv6",TC="address",fg="applogin",yf="localforage",ly="debug",Ise="embedded",vB="embeddedserver",bB="embeddedserverprotocol",yT="features",Ty="fid",cf="lang",RC="layersOpen",_T="version",_S="map_id",f5="layers",p5="bgLayer",g5="opacities",MC="theme",m5="time",y5="zoom",_5="rotation",Cse="SRS",vT="X",bT="Y",vS="crosshair",Yv="serial",xB=["basemap_2015_global","topogr_global","topo_bw_jpeg"],xT="lc",IT="sliderRatio",IB="bgOpacity",wse="layers_indices",v5="layers_opacity",b5="layers_visibility";var Mo=(n=>(n[n.localStorage=0]="localStorage",n[n.permalink=1]="permalink",n[n.permalinkAsPath=2]="permalinkAsPath",n[n.permalinkAndLocalStorage=3]="permalinkAndLocalStorage",n))(Mo||{});class CB{}function uy(n,e){let t;return(...i)=>{clearTimeout(t),t=setTimeout(()=>{n.apply(i)},e)}}const Ase=(n,e)=>{let t=null;return(...i)=>new Promise((r,o)=>{t&&clearTimeout(t),t=setTimeout(async()=>{try{const s=await n(...i);r(s)}catch(s){o(s)}},e)})};function wB(n,e){let t,i;return function(...r){const o=this;i?(clearTimeout(t),t=setTimeout(function(){Date.now()-i>=e&&(n.apply(o,r),i=Date.now())},e-(Date.now()-i))):(n.apply(o,r),i=Date.now())}}function kp(n){return n?.trim()&&!isNaN(Number(n))?Number(n):void 0}function Sse(n,e){return n?.split(e).map(t=>t!==null&&!isNaN(Number(t))?parseFloat(t):void 0)||[]}function Ese(n,e){return n?.split(e).map(UM)||[]}function UM(n){return n?.trim()==="true"?!0:n?.trim()==="false"?!1:void 0}function AB(){return window.matchMedia("(-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2), (min-resolution: 192dpi)").matches}function Rc(n){return typeof window<"u"&&window.navigator&&n.test(navigator.userAgent)}function Tse(n){const e=new RegExp("[^/]*//[^/]+/(.*)"),t=n.match(e);return t?t[1]:null}const Rse=Rc(/firefox/i);Rc(/safari/i)&&!Rc(/chrome/i)&&Rc(/android/i);Rc(/iP(ad|od|hone)/i);Rc(/chrome/i)&&Rc(/android/i);Rc(/chrome/i);Rc(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i);Rc(/Edge/i);function x5(n){return n.replace(/\s+/g,"_").replace(/[^a-z0-9\-_]/gi,"")||"_"}async function Mse(n,e){const t=await fetch(n);if(!t.ok)throw new Error;const i=await t.blob();EB(e,i)}function SB(n,e,t="text/plain"){const i=new Blob([e],{type:t});EB(n,i)}function EB(n,e){const t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}function kse(n){return n.charAt(0).toUpperCase()+n.slice(1)}class kC extends CB{static processRules(e){return kC.ruleUseLocalStorage(e)?Mo.localStorage:Mo.permalink}static processRulesForKey(e,t){if(xB.includes(e))return Mo.localStorage;if(e===Yv)return Mo.permalink;if(e===RC)return Mo.localStorage}static ruleUseLocalStorage(e){return[Lse,Pse,Gse].reduce((t,i)=>t||i(e),!1)}}const Lse=n=>Object.keys(n).length===0,Pse=n=>Object.keys(n).length===1&&(n.hasOwnProperty(Hy)||n.hasOwnProperty(fg)||n.hasOwnProperty(yf)),Gse=n=>Object.keys(n).length===3&&n.hasOwnProperty(Hy)&&n.hasOwnProperty(fg)&&n.hasOwnProperty(yf);class LC extends CB{static processRules(){return Mo.permalinkAndLocalStorage}static processRulesForKey(e,t){if(LC.ruleUsePermalink(e))return Mo.permalink;if(e===RC||xB.includes(e))return Mo.localStorage;if(e===Yv||e===yT)return Mo.permalink;if(e===MC)return Mo.permalinkAsPath}static ruleUsePermalink(e){return[Fse,Ose,Nse].reduce((t,i)=>t||i(e),!1)}}const Fse=n=>n===xT||n===IT,Ose=n=>n===_T,Nse=n=>n===MC&&!0;class TB{snappedUrl;constructor(){this.snappedUrl=new URL(window.location.toString())}get length(){throw new Error("Method not implemented.")}clear(){throw new Error("Method not implemented.")}key(e){throw new Error("Method key() not implemented. "+e)}getStrippedUrl(e){const t=new URL(window.location.toString()),i=new URLSearchParams(t.search);return e!==void 0&&(i.set("X",Math.round(e[0]).toString()),i.set("Y",Math.round(e[1]).toString())),i.delete(yf),i.delete(fg),i.delete(Hy),i.delete(vB),i.delete(bB),t.search=i.toString(),t}getRelativeUrl(){const e=this.getStrippedUrl(void 0);return e.pathname+e.search}async getShortUrl(e){const t=this.getStrippedUrl(e).toString().replace(/https:\/\/geoportail-luxembourg.github.io\/luxembourg-geoportail\/.+\//,"https://migration.geoportail.lu/").replace(/http:\/\/localhost:[45]173\//,"https://migration.geoportail.lu/"),i=new URLSearchParams;return i.set("url",t),await(await fetch("https://migration.geoportail.lu/short/create",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()})).json()}getSnappedUrl(){return this.snappedUrl}getSnappedParamsAsObj(){return this.getSnappedParams().reduce((e,t)=>{const[i,r]=t.split("=");return{...e,[i]:r}},{})}getSnappedParams(){return this.getSnappedUrl().search.replace("?","").split("&").filter(e=>e.split("=")[1])}setItem(e,t){const i=new URLSearchParams(new URL(window.location.toString()).search);i.set(encodeURIComponent(e),encodeURIComponent(t));try{window.history.replaceState(null,"","?"+i.toString())}catch{}}getItem(e){const t=this.getSnappedUrl().searchParams.get(e);return t!==null?decodeURIComponent(t):t}removeItem(e){const t=new URLSearchParams(new URL(window.location.toString()).search);t.delete(e);try{window.history.replaceState(null,"","?"+t.toString())}catch{}}encodeQueryParam(e,t){return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`}removeQueryParam(e){const t=new URL(window.location.href);t.searchParams.delete(e),window.history.replaceState({},document.title,t.toString())}}const jl=new TB;class Dse extends TB{getItem(e){const t=this.getSnappedUrl().pathname.split("/"),i=t.findIndex(r=>r===e);return t[i+1]}setItem(e,t){const i=new URL(window.location.toString()).search,r=`/luxembourg-geoportail/builder/${e}/${t}${i}`;try{window.history.replaceState(null,"",r)}catch{}}}const RB=new Dse;class Vse{get length(){throw new Error("Method not implemented.")}clear(){throw new Error("Method not implemented.")}key(e){throw new Error("Method key() not implemented. "+e)}removeItem(e){this.getWriteStorages(e)?.map(i=>i.removeItem(e))}setItem(e,t){this.setValue(e,t)}getItem(e){return this.getValue(e)}get paramKeys(){return jl.getSnappedParamsAsObj()}getValue(e){const t=this.correspondingStorages(kC.processRules(this.paramKeys))?.pop(),i=this.storageForKey(e,kC,t);return i?i.getItem(e):null}setValue(e,t){this.getWriteStorages(e)?.map(r=>r.setItem(e,t))}getWriteStorages(e){const t=this.correspondingStorages(LC.processRules()),i=this.storageForKey(e,LC);return i?[i]:t}storageForKey(e,t,i){return this.correspondingStorages(t.processRulesForKey(e,this.paramKeys))?.pop()??i}correspondingStorages(e){if(e===Mo.permalinkAndLocalStorage)return[jl,localStorage];if(e===Mo.localStorage)return[localStorage];if(e===Mo.permalink)return[jl];if(e===Mo.permalinkAsPath)return[RB]}}const Ix=new Vse;function Bse(n){return Zse(n)||Wse(n)||zse(n)||Use(n)}const Zse=n=>Object.keys(n).length===0,Wse=n=>{const e=Object.keys(n);return Object.keys(n).length===1&&[Hy,fg,yf,Ty,cf,TC,ly].some(t=>e.indexOf(t)!==-1)},zse=n=>{const e=Object.keys(n),t=r=>e.indexOf(r)!==-1,i=[[fg,yf],[ly,Ty],[cf,Ty],[ly,cf],[ly,TC],[cf,TC]];return Object.keys(n).length===2&&i.reduce((r,o)=>r||o.every(t),!1)},Use=n=>{const e=Object.keys(n),t=s=>e.indexOf(s)!==-1,i=[Hy,fg,yf].every(t),r=[ly,Ty,cf].every(t),o=[ly,TC,cf].every(t);return Object.keys(n).length===3&&(i||r||o)};class Xse{intialVersion;constructor(){const e=Ix.paramKeys,t=this.getValue(_T,kp);this.intialVersion=t?Math.max(2,Math.min(t,3)):Bse(e)?3:2,this.setValue(_T,3)}getInitialVersion(){return this.intialVersion}mapToEntity(e,t){return t?t(e):e}mapToStorage(e,t){return t?t(e):String(e)}getValue(e,t){return this.mapToEntity(Ix.getValue(e),t)}setValue(e,t,i){Ix.setValue(e,this.mapToStorage(t,i))}removeItem(e){Ix.removeItem(e)}}const Nn=new Xse;class Yse{bootstrap(){this.restore();let e;e=Ss(()=>{this.persist(),e&&e()})}persist(){const e=oi(),{lang:t}=xt(e);kt(t,(i,r)=>{r!==i&&(Nn.setValue(cf,i),document.documentElement.setAttribute("lang",i))},{immediate:!0})}restore(){const e=Nn.getValue(cf);if(e){const{setLang:t}=oi(),{i18next:i}=Ct();i.changeLanguage(e),t(e)}}}const Hse=new Yse,Kse=st({__name:"language-selector",setup(n){const{i18next:e,t}=Ct(),{setLang:i}=oi(),{lang:r}=xt(oi()),o=At(()=>["en","de","fr","lb"].map(u=>({label:t(u),value:u,ariaLabel:t("Change language: {{lang}}",{ns:"app",lang:u})}))),s=t("Change language",{ns:"app"});Hse.bootstrap(),kt(()=>e.language,()=>{EC.clearCache()});function l(u){e.changeLanguage(u),i(u)}return(u,h)=>(U(),Mt(eg,{class:"lux-navbar-dropdown lux-dropdown-inline text-white h-full",options:o.value,placeholder:k(s),modelValue:k(r),"onUpdate:modelValue":h[0]||(h[0]=d=>Pr(r)?r.value=d:null),onChange:l},null,8,["options","placeholder","modelValue"]))}}),jse="include";async function Vs(n,e,t="GET",i){const r={},o={method:t,credentials:jse,headers:r};let s=n;if(t==="GET"){const u=new URLSearchParams(e);s=`${n}?${u.toString()}`}else e instanceof FormData?o.body=e:i==="application/json"?(r["Content-Type"]="application/json",o.body=JSON.stringify(e)):(r["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",o.body=new URLSearchParams(e));const l=await fetch(s,o);if(!l.ok)throw new Error("Error while trying to call api");return l}class MB{drawCustom(e,t,i,r,o){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,i){}drawFeature(e,t,i){}drawGeometryCollection(e,t,i){}drawLineString(e,t,i){}drawMultiLineString(e,t,i){}drawMultiPoint(e,t,i){}drawMultiPolygon(e,t,i){}drawPoint(e,t,i){}drawPolygon(e,t,i){}drawText(e,t,i){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const Xn={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Cx=[Xn.FILL],Qd=[Xn.STROKE],Lp=[Xn.BEGIN_PATH],I5=[Xn.CLOSE_PATH];class Tb extends MB{constructor(e,t,i,r){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,o=this.coordinates;let s=o.length;for(let l=0,u=e.length;l<u;l+=t)r[0]=e[l],r[1]=e[l+1],Lc(i,r)&&(o[s++]=r[0],o[s++]=r[1]);return s}appendFlatLineCoordinates(e,t,i,r,o,s){const l=this.coordinates;let u=l.length;const h=this.getBufferedMaxExtent();s&&(t+=r);let d=e[t],m=e[t+1];const y=this.tmpCoordinate_;let x=!0,C,w,S;for(C=t+r;C<i;C+=r)y[0]=e[C],y[1]=e[C+1],S=TE(h,y),S!==w?(x&&(l[u++]=d,l[u++]=m,x=!1),l[u++]=y[0],l[u++]=y[1]):S===_o.INTERSECTING?(l[u++]=y[0],l[u++]=y[1],x=!1):x=!0,d=y[0],m=y[1],w=S;return(o&&x||C===t+r)&&(l[u++]=d,l[u++]=m),u}drawCustomCoordinates_(e,t,i,r,o){for(let s=0,l=i.length;s<l;++s){const u=i[s],h=this.appendFlatLineCoordinates(e,t,u,r,!1,!1);o.push(h),t=u}return t}drawCustom(e,t,i,r,o){this.beginGeometry(e,t,o);const s=e.getType(),l=e.getStride(),u=this.coordinates.length;let h,d,m,y,x;switch(s){case"MultiPolygon":h=e.getOrientedFlatCoordinates(),y=[];const C=e.getEndss();x=0;for(let w=0,S=C.length;w<S;++w){const T=[];x=this.drawCustomCoordinates_(h,x,C[w],l,T),y.push(T)}this.instructions.push([Xn.CUSTOM,u,y,e,i,NE,o]),this.hitDetectionInstructions.push([Xn.CUSTOM,u,y,e,r||i,NE,o]);break;case"Polygon":case"MultiLineString":m=[],h=s=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),x=this.drawCustomCoordinates_(h,0,e.getEnds(),l,m),this.instructions.push([Xn.CUSTOM,u,m,e,i,Rv,o]),this.hitDetectionInstructions.push([Xn.CUSTOM,u,m,e,r||i,Rv,o]);break;case"LineString":case"Circle":h=e.getFlatCoordinates(),d=this.appendFlatLineCoordinates(h,0,h.length,l,!1,!1),this.instructions.push([Xn.CUSTOM,u,d,e,i,jd,o]),this.hitDetectionInstructions.push([Xn.CUSTOM,u,d,e,r||i,jd,o]);break;case"MultiPoint":h=e.getFlatCoordinates(),d=this.appendFlatPointCoordinates(h,l),d>u&&(this.instructions.push([Xn.CUSTOM,u,d,e,i,jd,o]),this.hitDetectionInstructions.push([Xn.CUSTOM,u,d,e,r||i,jd,o]));break;case"Point":h=e.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),d=this.coordinates.length,this.instructions.push([Xn.CUSTOM,u,d,e,i,void 0,o]),this.hitDetectionInstructions.push([Xn.CUSTOM,u,d,e,r||i,void 0,o]);break}this.endGeometry(t)}beginGeometry(e,t,i){this.beginGeometryInstruction1_=[Xn.BEGIN_GEOMETRY,t,0,e,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Xn.BEGIN_GEOMETRY,t,0,e,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let r,o,s=-1;for(t=0;t<i;++t)r=e[t],o=r[0],o==Xn.END_GEOMETRY?s=t:o==Xn.BEGIN_GEOMETRY&&(r[2]=t,FY(this.hitDetectionInstructions,s,t),s=-1)}fillStyleToState(e,t={}){if(e){const i=e.getColor();t.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,t.fillStyle=bc(i||za)}else t.fillStyle=void 0;return t}strokeStyleToState(e,t={}){if(e){const i=e.getColor();t.strokeStyle=bc(i||Lv);const r=e.getLineCap();t.lineCap=r!==void 0?r:Cy;const o=e.getLineDash();t.lineDash=o?o.slice():Dh;const s=e.getLineDashOffset();t.lineDashOffset=s||Vh;const l=e.getLineJoin();t.lineJoin=l!==void 0?l:wy;const u=e.getWidth();t.lineWidth=u!==void 0?u:Gv;const h=e.getMiterLimit();t.miterLimit=h!==void 0?h:kv,t.lineWidth>this.maxLineWidth&&(this.maxLineWidth=t.lineWidth,this.bufferedMaxExtent_=null)}else t.strokeStyle=void 0,t.lineCap=void 0,t.lineDash=null,t.lineDashOffset=void 0,t.lineJoin=void 0,t.lineWidth=void 0,t.miterLimit=void 0;return t}setFillStrokeStyle(e,t){const i=this.state;this.fillStyleToState(e,i),this.strokeStyleToState(t,i)}createFill(e){const t=e.fillStyle,i=[Xn.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(e.fillPatternScale),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[Xn.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,r=e.lineCap,o=e.lineDash,s=e.lineDashOffset,l=e.lineJoin,u=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=r||o!=e.currentLineDash&&!nd(e.currentLineDash,o)||e.currentLineDashOffset!=s||e.currentLineJoin!=l||e.currentLineWidth!=u||e.currentMiterLimit!=h)&&(t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=r,e.currentLineDash=o,e.currentLineDashOffset=s,e.currentLineJoin=l,e.currentLineWidth=u,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[Xn.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=qN(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;Hh(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class $se extends Tb{constructor(e,t,i,r){super(e,t,i,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,i){if(!this.image_||this.maxExtent&&!Lc(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,i);const r=e.getFlatCoordinates(),o=e.getStride(),s=this.coordinates.length,l=this.appendFlatPointCoordinates(r,o);this.instructions.push([Xn.DRAW_IMAGE,s,l,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Xn.DRAW_IMAGE,s,l,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,i){if(!this.image_)return;this.beginGeometry(e,t,i);const r=e.getFlatCoordinates(),o=[];for(let u=0,h=r.length;u<h;u+=e.getStride())(!this.maxExtent||Lc(this.maxExtent,r.slice(u,u+2)))&&o.push(r[u],r[u+1]);const s=this.coordinates.length,l=this.appendFlatPointCoordinates(o,2);this.instructions.push([Xn.DRAW_IMAGE,s,l,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Xn.DRAW_IMAGE,s,l,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),r=e.getSize(),o=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=e.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=r[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class Jse extends Tb{constructor(e,t,i,r){super(e,t,i,r)}drawFlatCoordinates_(e,t,i,r){const o=this.coordinates.length,s=this.appendFlatLineCoordinates(e,t,i,r,!1,!1),l=[Xn.MOVE_TO_LINE_TO,o,s];return this.instructions.push(l),this.hitDetectionInstructions.push(l),i}drawLineString(e,t,i){const r=this.state,o=r.strokeStyle,s=r.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Dh,Vh],Lp);const l=e.getFlatCoordinates(),u=e.getStride();this.drawFlatCoordinates_(l,0,l.length,u),this.hitDetectionInstructions.push(Qd),this.endGeometry(t)}drawMultiLineString(e,t,i){const r=this.state,o=r.strokeStyle,s=r.lineWidth;if(o===void 0||s===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Dh,Vh],Lp);const l=e.getEnds(),u=e.getFlatCoordinates(),h=e.getStride();let d=0;for(let m=0,y=l.length;m<y;++m)d=this.drawFlatCoordinates_(u,d,l[m],h);this.hitDetectionInstructions.push(Qd),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(Qd),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(Qd),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Lp)}}class C5 extends Tb{constructor(e,t,i,r){super(e,t,i,r)}drawFlatCoordinatess_(e,t,i,r){const o=this.state,s=o.fillStyle!==void 0,l=o.strokeStyle!==void 0,u=i.length;this.instructions.push(Lp),this.hitDetectionInstructions.push(Lp);for(let h=0;h<u;++h){const d=i[h],m=this.coordinates.length,y=this.appendFlatLineCoordinates(e,t,d,r,!0,!l),x=[Xn.MOVE_TO_LINE_TO,m,y];this.instructions.push(x),this.hitDetectionInstructions.push(x),l&&(this.instructions.push(I5),this.hitDetectionInstructions.push(I5)),t=d}return s&&(this.instructions.push(Cx),this.hitDetectionInstructions.push(Cx)),l&&(this.instructions.push(Qd),this.hitDetectionInstructions.push(Qd)),t}drawCircle(e,t,i){const r=this.state,o=r.fillStyle,s=r.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_FILL_STYLE,za]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Dh,Vh]);const l=e.getFlatCoordinates(),u=e.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(l,0,l.length,u,!1,!1);const d=[Xn.CIRCLE,h];this.instructions.push(Lp,d),this.hitDetectionInstructions.push(Lp,d),r.fillStyle!==void 0&&(this.instructions.push(Cx),this.hitDetectionInstructions.push(Cx)),r.strokeStyle!==void 0&&(this.instructions.push(Qd),this.hitDetectionInstructions.push(Qd)),this.endGeometry(t)}drawPolygon(e,t,i){const r=this.state,o=r.fillStyle,s=r.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_FILL_STYLE,za]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Dh,Vh]);const l=e.getEnds(),u=e.getOrientedFlatCoordinates(),h=e.getStride();this.drawFlatCoordinatess_(u,0,l,h),this.endGeometry(t)}drawMultiPolygon(e,t,i){const r=this.state,o=r.fillStyle,s=r.strokeStyle;if(o===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_FILL_STYLE,za]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Dh,Vh]);const l=e.getEndss(),u=e.getOrientedFlatCoordinates(),h=e.getStride();let d=0;for(let m=0,y=l.length;m<y;++m)d=this.drawFlatCoordinatess_(u,d,l[m],h);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,r=t.length;i<r;++i)t[i]=bp(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;this.updateFillStyle(e,this.createFill),this.updateStrokeStyle(e,this.applyStroke)}}function qse(n,e,t,i,r){const o=[];let s=t,l=0,u=e.slice(t,2);for(;l<n&&s+r<i;){const[h,d]=u.slice(-2),m=e[s+r],y=e[s+r+1],x=Math.sqrt((m-h)*(m-h)+(y-d)*(y-d));if(l+=x,l>=n){const C=(n-l+x)/x,w=ml(h,m,C),S=ml(d,y,C);u.push(w,S),o.push(u),u=[w,S],l==n&&(s+=r),l=0}else if(l<n)u.push(e[s+r],e[s+r+1]),s+=r;else{const C=x-l,w=ml(h,m,C/x),S=ml(d,y,C/x);u.push(w,S),o.push(u),u=[w,S],l=0,s+=r}}return l>0&&o.push(u),o}function Qse(n,e,t,i,r){let o=t,s=t,l=0,u=0,h=t,d,m,y,x,C,w,S,T,M,G;for(m=t;m<i;m+=r){const N=e[m],V=e[m+1];C!==void 0&&(M=N-C,G=V-w,x=Math.sqrt(M*M+G*G),S!==void 0&&(u+=y,d=Math.acos((S*M+T*G)/(y*x)),d>n&&(u>l&&(l=u,o=h,s=m),u=0,h=m-r)),y=x,S=M,T=G),C=N,w=V}return u+=x,u>l?[h,m]:[o,s]}const PC={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class eoe extends Tb{constructor(e,t,i,r){super(e,t,i,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[za]={fillStyle:za},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,i){const r=this.textFillState_,o=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!r&&!o)return;const l=this.coordinates;let u=l.length;const h=e.getType();let d=null,m=e.getStride();if(s.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!Os(this.maxExtent,e.getExtent()))return;let y;if(d=e.getFlatCoordinates(),h=="LineString")y=[d.length];else if(h=="MultiLineString")y=e.getEnds();else if(h=="Polygon")y=e.getEnds().slice(0,1);else if(h=="MultiPolygon"){const S=e.getEndss();y=[];for(let T=0,M=S.length;T<M;++T)y.push(S[T][0])}this.beginGeometry(e,t,i);const x=s.repeat,C=x?void 0:s.textAlign;let w=0;for(let S=0,T=y.length;S<T;++S){let M;x?M=qse(x*this.resolution,d,w,y[S],m):M=[d.slice(w,y[S])];for(let G=0,N=M.length;G<N;++G){const V=M[G];let W=0,j=V.length;if(C==null){const te=Qse(s.maxAngle,V,0,V.length,2);W=te[0],j=te[1]}for(let te=W;te<j;te+=m)l.push(V[te],V[te+1]);const J=l.length;w=y[S],this.drawChars_(u,J),u=J}}this.endGeometry(t)}else{let y=s.overflow?null:[];switch(h){case"Point":case"MultiPoint":d=e.getFlatCoordinates();break;case"LineString":d=e.getFlatMidpoint();break;case"Circle":d=e.getCenter();break;case"MultiLineString":d=e.getFlatMidpoints(),m=2;break;case"Polygon":d=e.getFlatInteriorPoint(),s.overflow||y.push(d[2]/this.resolution),m=3;break;case"MultiPolygon":const N=e.getFlatInteriorPoints();d=[];for(let V=0,W=N.length;V<W;V+=3)s.overflow||y.push(N[V+2]/this.resolution),d.push(N[V],N[V+1]);if(d.length===0)return;m=2;break}const x=this.appendFlatPointCoordinates(d,m);if(x===u)return;if(y&&(x-u)/2!==d.length/m){let N=u/2;y=y.filter((V,W)=>{const j=l[(N+W)*2]===d[W*m]&&l[(N+W)*2+1]===d[W*m+1];return j||--N,j})}this.saveTextStates_();const C=s.backgroundFill?this.createFill(this.fillStyleToState(s.backgroundFill)):null,w=s.backgroundStroke?this.createStroke(this.strokeStyleToState(s.backgroundStroke)):null;this.beginGeometry(e,t,i);let S=s.padding;if(S!=Rp&&(s.scale[0]<0||s.scale[1]<0)){let N=s.padding[0],V=s.padding[1],W=s.padding[2],j=s.padding[3];s.scale[0]<0&&(V=-V,j=-j),s.scale[1]<0&&(N=-N,W=-W),S=[N,V,W,j]}const T=this.pixelRatio;this.instructions.push([Xn.DRAW_IMAGE,u,x,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,S==Rp?Rp:S.map(function(N){return N*T}),C,w,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,y]);const M=1/T,G=C?C.slice(0):null;G&&(G[1]=za),this.hitDetectionInstructions.push([Xn.DRAW_IMAGE,u,x,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[M,M],NaN,this.declutterMode_,this.declutterImageWithText_,S,G,w,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?za:this.fillKey_,this.textOffsetX_,this.textOffsetY_,y]),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,r=this.strokeKey_;e&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const o=this.textKey_;o in this.textStates||(this.textStates[o]={font:t.font,textAlign:t.textAlign||Pv,justify:t.justify,textBaseline:t.textBaseline||cC,scale:t.scale});const s=this.fillKey_;i&&(s in this.fillStates||(this.fillStates[s]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,r=this.textState_,o=this.strokeKey_,s=this.textKey_,l=this.fillKey_;this.saveTextStates_();const u=this.pixelRatio,h=PC[r.textBaseline],d=this.textOffsetY_*u,m=this.text_,y=i?i.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([Xn.DRAW_CHARS,e,t,h,r.overflow,l,r.maxAngle,u,d,o,y*u,m,s,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([Xn.DRAW_CHARS,e,t,h,r.overflow,l&&za,r.maxAngle,u,d,o,y*u,m,s,1/u,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,t){let i,r,o;if(!e)this.text_="";else{const s=e.getFill();s?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=bc(s.getColor()||za)):(r=null,this.textFillState_=r);const l=e.getStroke();if(!l)o=null,this.textStrokeState_=o;else{o=this.textStrokeState_,o||(o={},this.textStrokeState_=o);const w=l.getLineDash(),S=l.getLineDashOffset(),T=l.getWidth(),M=l.getMiterLimit();o.lineCap=l.getLineCap()||Cy,o.lineDash=w?w.slice():Dh,o.lineDashOffset=S===void 0?Vh:S,o.lineJoin=l.getLineJoin()||wy,o.lineWidth=T===void 0?Gv:T,o.miterLimit=M===void 0?kv:M,o.strokeStyle=bc(l.getColor()||Lv)}i=this.textState_;const u=e.getFont()||qD;UK(u);const h=e.getScaleArray();i.overflow=e.getOverflow(),i.font=u,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||cC,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||Rp,i.scale=h===void 0?[1,1]:h;const d=e.getOffsetX(),m=e.getOffsetY(),y=e.getRotateWithView(),x=e.getKeepUpright(),C=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=d===void 0?0:d,this.textOffsetY_=m===void 0?0:m,this.textRotateWithView_=y===void 0?!1:y,this.textKeepUpright_=x===void 0?!0:x,this.textRotation_=C===void 0?0:C,this.strokeKey_=o?(typeof o.strokeStyle=="string"?o.strokeStyle:ti(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=r&&r.fillStyle?typeof r.fillStyle=="string"?r.fillStyle:"|"+ti(r.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const toe={Circle:C5,Default:Tb,Image:$se,LineString:Jse,Polygon:C5,Text:eoe};class kB{constructor(e,t,i,r){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=r,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const r in i){const o=i[r].finish();e[t][r]=o}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let r=this.buildersByZIndex_[i];r===void 0&&(r={},this.buildersByZIndex_[i]=r);let o=r[t];if(o===void 0){const s=toe[t];o=new s(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[t]=o}return o}}function XM(n,e,t,i){let r=n[e],o=n[e+1],s=0;for(let l=e+i;l<t;l+=i){const u=n[l],h=n[l+1];s+=Math.sqrt((u-r)*(u-r)+(h-o)*(h-o)),r=u,o=h}return s}function noe(n,e,t,i,r,o,s,l,u,h,d,m,y=!0){let x=n[e],C=n[e+1],w=0,S=0,T=0,M=0;function G(){w=x,S=C,e+=i,x=n[e],C=n[e+1],M+=T,T=Math.sqrt((x-w)*(x-w)+(C-S)*(C-S))}do G();while(e<t-i&&M+T<o);let N=T===0?0:(o-M)/T;const V=ml(w,x,N),W=ml(S,C,N),j=e-i,J=M,te=o+l*u(h,r,d);for(;e<t-i&&M+T<te;)G();N=T===0?0:(te-M)/T;const ce=ml(w,x,N),pe=ml(S,C,N);let Y=!1;if(y)if(m){const fe=[V,W,ce,pe];XR(fe,0,4,2,m,fe,fe),Y=fe[0]>fe[2]}else Y=V>ce;const he=Math.PI,D=[],re=j+i===e;e=j,T=0,M=J,x=n[e],C=n[e+1];let le;if(re){G(),le=Math.atan2(C-S,x-w),Y&&(le+=le>0?-he:he);const fe=(ce+V)/2,Le=(pe+W)/2;return D[0]=[fe,Le,(te-o)/2,le,r],D}r=r.replace(/\n/g," ");for(let fe=0,Le=r.length;fe<Le;){G();let we=Math.atan2(C-S,x-w);if(Y&&(we+=we>0?-he:he),le!==void 0){let qe=we-le;if(qe+=qe>he?-2*he:qe<-he?2*he:0,Math.abs(qe)>s)return null}le=we;const se=fe;let Q=0;for(;fe<Le;++fe){const qe=Y?Le-fe-1:fe,Lt=l*u(h,r[qe],d);if(e+i<t&&M+T<o+Q+Lt/2)break;Q+=Lt}if(fe===se)continue;const q=Y?r.substring(Le-se,Le-fe):r.substring(se,fe);N=T===0?0:(o+Q/2-M)/T;const $e=ml(w,x,N),Qe=ml(S,C,N);D.push([$e,Qe,Q/2,we,q]),o+=Q}return D}class YM{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(aC(),{get:(e,t)=>{if(typeof aC()[t]=="function")return this.push_(t),this.pushMethodArgs_},set:(e,t,i)=>(this.push_(t,i),!0)})}push_(...e){const t=this.instructions_,i=this.zIndex+this.offset_;t[i]||(t[i]=[]),t[i].push(...e)}pushMethodArgs_=(...e)=>(this.push_(e),this);pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let i=0,r=t.length;i<r;++i){const o=t[i];if(typeof o=="function"){o(e);continue}const s=t[++i];if(typeof e[o]=="function")e[o](...s);else{if(typeof s=="function"){e[o]=s(e);continue}e[o]=s}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const bm=Qa(),Ld=[],yh=[],_h=[],Pd=[];function w5(n){return n[3].declutterBox}const A5=new RegExp("[-----]");function bS(n,e){return e==="start"?e=A5.test(n)?"right":"left":e==="end"&&(e=A5.test(n)?"left":"right"),PC[e]}function ioe(n,e,t){return t>0&&n.push(`
`,""),n.push(e,""),n}function roe(n,e,t){return t%2===0&&(n+=e),n}class soe{constructor(e,t,i,r,o){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=qa(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=o?new YM:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,i,r){const o=e+t+i+r;if(this.labels_[o])return this.labels_[o];const s=r?this.strokeStates[r]:null,l=i?this.fillStates[i]:null,u=this.textStates[t],h=this.pixelRatio,d=[u.scale[0]*h,u.scale[1]*h],m=u.justify?PC[u.justify]:bS(Array.isArray(e)?e[0]:e,u.textAlign||Pv),y=r&&s.lineWidth?s.lineWidth:0,x=Array.isArray(e)?e:String(e).split(`
`).reduce(ioe,[]),{width:C,height:w,widths:S,heights:T,lineWidths:M}=YK(u,x),G=C+y,N=[],V=(G+2)*d[0],W=(w+y)*d[1],j={width:V<0?Math.floor(V):Math.ceil(V),height:W<0?Math.floor(W):Math.ceil(W),contextInstructions:N};(d[0]!=1||d[1]!=1)&&N.push("scale",d),r&&(N.push("strokeStyle",s.strokeStyle),N.push("lineWidth",y),N.push("lineCap",s.lineCap),N.push("lineJoin",s.lineJoin),N.push("miterLimit",s.miterLimit),N.push("setLineDash",[s.lineDash]),N.push("lineDashOffset",s.lineDashOffset)),i&&N.push("fillStyle",l.fillStyle),N.push("textBaseline","middle"),N.push("textAlign","center");const J=.5-m;let te=m*G+J*y;const ce=[],pe=[];let Y=0,he=0,D=0,re=0,le;for(let fe=0,Le=x.length;fe<Le;fe+=2){const we=x[fe];if(we===`
`){he+=Y,Y=0,te=m*G+J*y,++re;continue}const se=x[fe+1]||u.font;se!==le&&(r&&ce.push("font",se),i&&pe.push("font",se),le=se),Y=Math.max(Y,T[D]);const Q=[we,te+J*S[D]+m*(S[D]-M[re]),.5*(y+Y)+he];te+=S[D],r&&ce.push("strokeText",Q),i&&pe.push("fillText",Q),++D}return Array.prototype.push.apply(N,ce),Array.prototype.push.apply(N,pe),this.labels_[o]=j,j}replayTextBackground_(e,t,i,r,o,s,l){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,r),e.lineTo.apply(e,o),e.lineTo.apply(e,t),s&&(this.alignAndScaleFill_=s[2],e.fillStyle=s[1],this.fill_(e)),l&&(this.setStrokeStyle_(e,l),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,r,o,s,l,u,h,d,m,y,x,C,w,S){l*=y[0],u*=y[1];let T=i-l,M=r-u;const G=o+h>e?e-h:o,N=s+d>t?t-d:s,V=C[3]+G*y[0]+C[1],W=C[0]+N*y[1]+C[2],j=T-C[3],J=M-C[0];(w||m!==0)&&(Ld[0]=j,Pd[0]=j,Ld[1]=J,yh[1]=J,yh[0]=j+V,_h[0]=yh[0],_h[1]=J+W,Pd[1]=_h[1]);let te;return m!==0?(te=Lu(qa(),i,r,1,1,m,-i,-r),Gs(te,Ld),Gs(te,yh),Gs(te,_h),Gs(te,Pd),Pc(Math.min(Ld[0],yh[0],_h[0],Pd[0]),Math.min(Ld[1],yh[1],_h[1],Pd[1]),Math.max(Ld[0],yh[0],_h[0],Pd[0]),Math.max(Ld[1],yh[1],_h[1],Pd[1]),bm)):Pc(Math.min(j,j+V),Math.min(J,J+W),Math.max(j,j+V),Math.max(J,J+W),bm),x&&(T=Math.round(T),M=Math.round(M)),{drawImageX:T,drawImageY:M,drawImageW:G,drawImageH:N,originX:h,originY:d,declutterBox:{minX:bm[0],minY:bm[1],maxX:bm[2],maxY:bm[3],value:S},canvasTransform:te,scale:y}}replayImageOrLabel_(e,t,i,r,o,s,l){const u=!!(s||l),h=r.declutterBox,d=l?l[2]*r.scale[0]/2:0;return h.minX-d<=t[0]&&h.maxX+d>=0&&h.minY-d<=t[1]&&h.maxY+d>=0&&(u&&this.replayTextBackground_(e,Ld,yh,_h,Pd,s,l),HK(e,r.canvasTransform,o,i,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const i=Gs(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;e.save(),e.translate(i[0]%r,i[1]%r),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],t[1]&&(e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6]))}drawLabelWithPointPlacement_(e,t,i,r){const o=this.textStates[t],s=this.createLabel(e,t,r,i),l=this.strokeStates[i],u=this.pixelRatio,h=bS(Array.isArray(e)?e[0]:e,o.textAlign||Pv),d=PC[o.textBaseline||cC],m=l&&l.lineWidth?l.lineWidth:0,y=s.width/u-2*o.scale[0],x=h*y+2*(.5-h)*m,C=d*s.height/u+2*(.5-d)*m;return{label:s,anchorX:x,anchorY:C}}execute_(e,t,i,r,o,s,l,u){const h=this.zIndexContext_;let d;this.pixelCoordinates_&&nd(i,this.renderedTransform_)?d=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),d=Nh(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),HY(this.renderedTransform_,i));let m=0;const y=r.length;let x=0,C,w,S,T,M,G,N,V,W,j,J,te,ce,pe=0,Y=0;const he=this.coordinateCache_,D=this.viewRotation_,re=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,le={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:D},fe=this.instructions!=r||this.overlaps?0:200;let Le,we,se,Q;for(;m<y;){const q=r[m];switch(q[0]){case Xn.BEGIN_GEOMETRY:Le=q[1],Q=q[3],Le.getGeometry()?l!==void 0&&!Os(l,Q.getExtent())?m=q[2]+1:++m:m=q[2],h&&(h.zIndex=q[4]);break;case Xn.BEGIN_PATH:pe>fe&&(this.fill_(e),pe=0),Y>fe&&(e.stroke(),Y=0),!pe&&!Y&&(e.beginPath(),M=NaN,G=NaN),++m;break;case Xn.CIRCLE:x=q[1];const Qe=d[x],qe=d[x+1],Lt=d[x+2],Pt=d[x+3],zt=Lt-Qe,Dt=Pt-qe,yn=Math.sqrt(zt*zt+Dt*Dt);e.moveTo(Qe+yn,qe),e.arc(Qe,qe,yn,0,2*Math.PI,!0),++m;break;case Xn.CLOSE_PATH:e.closePath(),++m;break;case Xn.CUSTOM:x=q[1],C=q[2];const tn=q[3],Ne=q[4],Be=q[5];le.geometry=tn,le.feature=Le,m in he||(he[m]=[]);const z=he[m];Be?Be(d,x,C,2,z):(z[0]=d[x],z[1]=d[x+1],z.length=2),h&&(h.zIndex=q[6]),Ne(z,le),++m;break;case Xn.DRAW_IMAGE:x=q[1],C=q[2],W=q[3],w=q[4],S=q[5];let We=q[6];const ke=q[7],ge=q[8],ie=q[9],Ce=q[10];let Te=q[11];const De=q[12];let Ze=q[13];T=q[14]||"declutter";const Je=q[15];if(!W&&q.length>=20){j=q[19],J=q[20],te=q[21],ce=q[22];const Ai=this.drawLabelWithPointPlacement_(j,J,te,ce);W=Ai.label,q[3]=W;const ee=q[23];w=(Ai.anchorX-ee)*this.pixelRatio,q[4]=w;const ue=q[24];S=(Ai.anchorY-ue)*this.pixelRatio,q[5]=S,We=W.height,q[6]=We,Ze=W.width,q[13]=Ze}let dt;q.length>25&&(dt=q[25]);let ft,Tt,hn;q.length>17?(ft=q[16],Tt=q[17],hn=q[18]):(ft=Rp,Tt=null,hn=null),Ce&&re?Te+=D:!Ce&&!re&&(Te-=D);let cn=0;for(;x<C;x+=2){if(dt&&dt[cn++]<Ze/this.pixelRatio)continue;const Ai=this.calculateImageOrLabelDimensions_(W.width,W.height,d[x],d[x+1],Ze,We,w,S,ge,ie,Te,De,o,ft,!!Tt||!!hn,Le),ee=[e,t,W,Ai,ke,Tt,hn];if(u){let ue,me,xe;if(Je){const ze=C-x;if(!Je[ze]){Je[ze]={args:ee,declutterMode:T};continue}const ye=Je[ze];ue=ye.args,me=ye.declutterMode,delete Je[ze],xe=w5(ue)}let Ae,Ye;if(ue&&(me!=="declutter"||!u.collides(xe))&&(Ae=!0),(T!=="declutter"||!u.collides(Ai.declutterBox))&&(Ye=!0),me==="declutter"&&T==="declutter"){const ze=Ae&&Ye;Ae=ze,Ye=ze}Ae&&(me!=="none"&&u.insert(xe),this.replayImageOrLabel_.apply(this,ue)),Ye&&(T!=="none"&&u.insert(Ai.declutterBox),this.replayImageOrLabel_.apply(this,ee))}else this.replayImageOrLabel_.apply(this,ee)}++m;break;case Xn.DRAW_CHARS:const vi=q[1],Hi=q[2],Li=q[3],Tr=q[4];ce=q[5];const pi=q[6],rs=q[7],wi=q[8];te=q[9];const Ti=q[10];j=q[11],Array.isArray(j)&&(j=j.reduce(roe,"")),J=q[12];const Bs=[q[13],q[13]];T=q[14]||"declutter";const xo=q[15],Ea=this.textStates[J],ms=Ea.font,Wr=[Ea.scale[0]*rs,Ea.scale[1]*rs];let zr;ms in this.widths_?zr=this.widths_[ms]:(zr={},this.widths_[ms]=zr);const ys=XM(d,vi,Hi,2),Ml=Math.abs(Wr[0])*jG(ms,j,zr);if(Tr||Ml<=ys){const Ai=this.textStates[J].textAlign,ee=(ys-Ml)*bS(j,Ai),ue=noe(d,vi,Hi,2,j,ee,pi,Math.abs(Wr[0]),jG,ms,zr,re?0:this.viewRotation_,xo);e:if(ue){const me=[];let xe,Ae,Ye,ze,ye;if(te)for(xe=0,Ae=ue.length;xe<Ae;++xe){ye=ue[xe],Ye=ye[4],ze=this.createLabel(Ye,J,"",te),w=ye[2]+(Wr[0]<0?-Ti:Ti),S=Li*ze.height+(.5-Li)*2*Ti*Wr[1]/Wr[0]-wi;const Se=this.calculateImageOrLabelDimensions_(ze.width,ze.height,ye[0],ye[1],ze.width,ze.height,w,S,0,0,ye[3],Bs,!1,Rp,!1,Le);if(u&&T==="declutter"&&u.collides(Se.declutterBox))break e;me.push([e,t,ze,Se,1,null,null])}if(ce)for(xe=0,Ae=ue.length;xe<Ae;++xe){ye=ue[xe],Ye=ye[4],ze=this.createLabel(Ye,J,ce,""),w=ye[2],S=Li*ze.height-wi;const Se=this.calculateImageOrLabelDimensions_(ze.width,ze.height,ye[0],ye[1],ze.width,ze.height,w,S,0,0,ye[3],Bs,!1,Rp,!1,Le);if(u&&T==="declutter"&&u.collides(Se.declutterBox))break e;me.push([e,t,ze,Se,1,null,null])}u&&T!=="none"&&u.load(me.map(w5));for(let Se=0,tt=me.length;Se<tt;++Se)this.replayImageOrLabel_.apply(this,me[Se])}}++m;break;case Xn.END_GEOMETRY:if(s!==void 0){Le=q[1];const Ai=s(Le,Q,T);if(Ai)return Ai}++m;break;case Xn.FILL:fe?pe++:this.fill_(e),++m;break;case Xn.MOVE_TO_LINE_TO:for(x=q[1],C=q[2],we=d[x],se=d[x+1],e.moveTo(we,se),M=we+.5|0,G=se+.5|0,x+=2;x<C;x+=2)we=d[x],se=d[x+1],N=we+.5|0,V=se+.5|0,(x==C-2||N!==M||V!==G)&&(e.lineTo(we,se),M=N,G=V);++m;break;case Xn.SET_FILL_STYLE:this.alignAndScaleFill_=q[2],pe&&(this.fill_(e),pe=0,Y&&(e.stroke(),Y=0)),e.fillStyle=q[1],++m;break;case Xn.SET_STROKE_STYLE:Y&&(e.stroke(),Y=0),this.setStrokeStyle_(e,q),++m;break;case Xn.STROKE:fe?Y++:e.stroke(),++m;break;default:++m;break}}pe&&this.fill_(e),Y&&e.stroke()}execute(e,t,i,r,o,s){this.viewRotation_=r,this.execute_(e,t,i,this.instructions,o,void 0,void 0,s)}executeHitDetection(e,t,i,r,o){return this.viewRotation_=i,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,r,o)}}const Sp=["Polygon","Circle","LineString","Image","Text","Default"],GC=["Image","Text"],ooe=Sp.filter(n=>!GC.includes(n));class LB{constructor(e,t,i,r,o,s,l){this.maxExtent_=e,this.overlaps_=r,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=qa(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(o,l)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e,t){for(const i in e){let r=this.executorsByZIndex_[i];r===void 0&&(r={},this.executorsByZIndex_[i]=r);const o=e[i];for(const s in o){const l=o[s];r[s]=new soe(this.resolution_,this.pixelRatio_,this.overlaps_,l,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let r=0,o=e.length;r<o;++r)if(e[r]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,r,o,s){r=Math.round(r);const l=r*2+1,u=Lu(this.hitDetectionTransform_,r+.5,r+.5,1/t,-1/t,-i,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=qs(l,l));const d=this.hitDetectionContext_;d.canvas.width!==l||d.canvas.height!==l?(d.canvas.width=l,d.canvas.height=l):h||d.clearRect(0,0,l,l);let m;this.renderBuffer_!==void 0&&(m=Qa(),H0(m,e),Hh(m,t*(this.renderBuffer_+r),m));const y=aoe(r);let x;function C(V,W,j){const J=d.getImageData(0,0,l,l).data;for(let te=0,ce=y.length;te<ce;te++)if(J[y[te]]>0){if(!s||j==="none"||x!=="Image"&&x!=="Text"||s.includes(V)){const pe=(y[te]-3)/4,Y=r-pe%l,he=r-(pe/l|0),D=o(V,W,Y*Y+he*he);if(D)return D}d.clearRect(0,0,l,l);break}}const w=Object.keys(this.executorsByZIndex_).map(Number);w.sort(Ec);let S,T,M,G,N;for(S=w.length-1;S>=0;--S){const V=w[S].toString();for(M=this.executorsByZIndex_[V],T=Sp.length-1;T>=0;--T)if(x=Sp[T],G=M[x],G!==void 0&&(N=G.executeHitDetection(d,u,i,C,m),N))return N}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],r=t[1],o=t[2],s=t[3],l=[i,r,i,s,o,s,o,r];return Nh(l,0,8,2,e,l),l}isEmpty(){return Yp(this.executorsByZIndex_)}execute(e,t,i,r,o,s,l){const u=Object.keys(this.executorsByZIndex_).map(Number);u.sort(l?GY:Ec),s=s||Sp;const h=Sp.length;for(let d=0,m=u.length;d<m;++d){const y=u[d].toString(),x=this.executorsByZIndex_[y];for(let C=0,w=s.length;C<w;++C){const S=s[C],T=x[S];if(T!==void 0){const M=l===null?void 0:T.getZIndexContext(),G=M?M.getContext():e,N=this.maxExtent_&&S!=="Image"&&S!=="Text";if(N&&(G.save(),this.clip(G,i)),!M||S==="Text"||S==="Image"?T.execute(G,t,i,r,o,l):M.pushFunction(V=>T.execute(V,t,i,r,o,l)),N&&G.restore(),M){M.offset();const V=u[d]*h+Sp.indexOf(S);this.deferredZIndexContexts_[V]||(this.deferredZIndexContexts_[V]=[]),this.deferredZIndexContexts_[V].push(M)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(Ec);for(let i=0,r=t.length;i<r;++i)e[t[i]].forEach(o=>{o.draw(this.renderedContext_),o.clear()}),e[t[i]].length=0}}const xS={};function aoe(n){if(xS[n]!==void 0)return xS[n];const e=n*2+1,t=n*n,i=new Array(t+1);for(let o=0;o<=n;++o)for(let s=0;s<=n;++s){const l=o*o+s*s;if(l>t)break;let u=i[l];u||(u=[],i[l]=u),u.push(((n+o)*e+(n+s))*4+3),o>0&&u.push(((n-o)*e+(n+s))*4+3),s>0&&(u.push(((n+o)*e+(n-s))*4+3),o>0&&u.push(((n-o)*e+(n-s))*4+3))}const r=[];for(let o=0,s=i.length;o<s;++o)i[o]&&r.push(...i[o]);return xS[n]=r,r}const S5=Object.freeze(Object.defineProperty({__proto__:null,Circle:Qs,Fill:Ji,Icon:Gu,IconImage:dM,Image:mb,RegularShape:vl,Stroke:ki,Style:qn,Text:sd},Symbol.toStringTag,{value:"Module"}));class PB extends MB{constructor(e,t,i,r,o,s,l){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=r,this.transformRotation_=r?Oy(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=o,this.squaredTolerance_=s,this.userTransform_=l,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=qa()}drawImages_(e,t,i,r){if(!this.image_)return;const o=Nh(e,t,i,r,this.transform_,this.pixelCoordinates_),s=this.context_,l=this.tmpLocalTransform_,u=s.globalAlpha;this.imageOpacity_!=1&&(s.globalAlpha=u*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let d=0,m=o.length;d<m;d+=2){const y=o[d]-this.imageAnchorX_,x=o[d+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const C=y+this.imageAnchorX_,w=x+this.imageAnchorY_;Lu(l,C,w,1,1,h,-C,-w),s.save(),s.transform.apply(s,l),s.translate(C,w),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.restore()}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,y,x,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(s.globalAlpha=u)}drawText_(e,t,i,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const o=Nh(e,t,i,r,this.transform_,this.pixelCoordinates_),s=this.context_;let l=this.textRotation_;for(this.transformRotation_===0&&(l-=this.viewRotation_),this.textRotateWithView_&&(l+=this.viewRotation_);t<i;t+=r){const u=o[t]+this.textOffsetX_,h=o[t+1]+this.textOffsetY_;l!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(s.save(),s.translate(u-this.textOffsetX_,h-this.textOffsetY_),s.rotate(l),s.translate(this.textOffsetX_,this.textOffsetY_),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.restore()):(this.textStrokeState_&&s.strokeText(this.text_,u,h),this.textFillState_&&s.fillText(this.text_,u,h))}}moveToLineTo_(e,t,i,r,o){const s=this.context_,l=Nh(e,t,i,r,this.transform_,this.pixelCoordinates_);s.moveTo(l[0],l[1]);let u=l.length;o&&(u-=2);for(let h=2;h<u;h+=2)s.lineTo(l[h],l[h+1]);return o&&s.closePath(),i}drawRings_(e,t,i,r){for(let o=0,s=i.length;o<s;++o)t=this.moveToLineTo_(e,t,i[o],r,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Os(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=nH(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],r=t[3]-t[1],o=Math.sqrt(i*i+r*r),s=this.context_;s.beginPath(),s.arc(t[0],t[1],o,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,r=t.length;i<r;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Os(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(Os(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,r=e.getFlatCoordinates();let o=0;const s=e.getEnds(),l=e.getStride();i.beginPath();for(let u=0,h=s.length;u<h;++u)o=this.moveToLineTo_(r,o,s[u],l,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Os(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Os(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let r=0;const o=e.getEndss(),s=e.getStride();t.beginPath();for(let l=0,u=o.length;l<u;++l){const h=o[l];r=this.drawRings_(i,r,h,s)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),nd(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,r=e.textAlign?e.textAlign:Pv;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=r&&(i.textAlign=r,t.textAlign=r),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=r,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:bc(i||za)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),r=t.getLineCap(),o=t.getLineDash(),s=t.getLineDashOffset(),l=t.getLineJoin(),u=t.getWidth(),h=t.getMiterLimit(),d=o||Dh;this.strokeState_={lineCap:r!==void 0?r:Cy,lineDash:this.pixelRatio_===1?d:d.map(m=>m*this.pixelRatio_),lineDashOffset:(s||Vh)*this.pixelRatio_,lineJoin:l!==void 0?l:wy,lineWidth:(u!==void 0?u:Gv)*this.pixelRatio_,miterLimit:h!==void 0?h:kv,strokeStyle:bc(i||Lv)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),r=e.getAnchor(),o=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*i,this.imageAnchorY_=r[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const s=e.getScaleArray();this.imageScale_=[s[0]*this.pixelRatio_/i,s[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const x=t.getColor();this.textFillState_={fillStyle:bc(x||za)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const x=i.getColor(),C=i.getLineCap(),w=i.getLineDash(),S=i.getLineDashOffset(),T=i.getLineJoin(),M=i.getWidth(),G=i.getMiterLimit();this.textStrokeState_={lineCap:C!==void 0?C:Cy,lineDash:w||Dh,lineDashOffset:S||Vh,lineJoin:T!==void 0?T:wy,lineWidth:M!==void 0?M:Gv,miterLimit:G!==void 0?G:kv,strokeStyle:bc(x||Lv)}}const r=e.getFont(),o=e.getOffsetX(),s=e.getOffsetY(),l=e.getRotateWithView(),u=e.getRotation(),h=e.getScaleArray(),d=e.getText(),m=e.getTextAlign(),y=e.getTextBaseline();this.textState_={font:r!==void 0?r:qD,textAlign:m!==void 0?m:Pv,textBaseline:y!==void 0?y:cC},this.text_=d!==void 0?Array.isArray(d)?d.reduce((x,C,w)=>x+=w%2?" ":C,""):d:"",this.textOffsetX_=o!==void 0?this.pixelRatio_*o:0,this.textOffsetY_=s!==void 0?this.pixelRatio_*s:0,this.textRotateWithView_=l!==void 0?l:!1,this.textRotation_=u!==void 0?u:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const bl=.5;function GB(n,e,t,i,r,o,s,l,u){const h=u?Ow(r):r,d=n[0]*bl,m=n[1]*bl,y=qs(d,m);y.imageSmoothingEnabled=!1;const x=y.canvas,C=new PB(y,bl,r,null,s,l,u?Ny(kY(),u):null),w=t.length,S=Math.floor((256*256*256-1)/w),T={};for(let G=1;G<=w;++G){const N=t[G-1],V=N.getStyleFunction()||i;if(!V)continue;let W=V(N,o);if(!W)continue;Array.isArray(W)||(W=[W]);const J=(G*S).toString(16).padStart(7,"#00000");for(let te=0,ce=W.length;te<ce;++te){const pe=W[te],Y=pe.getGeometryFunction()(N);if(!Y||!Os(h,Y.getExtent()))continue;const he=pe.clone(),D=he.getFill();D&&D.setColor(J);const re=he.getStroke();re&&(re.setColor(J),re.setLineDash(null)),he.setText(void 0);const le=pe.getImage();if(le){const se=le.getImageSize();if(!se)continue;const Q=qs(se[0],se[1],void 0,{alpha:!1}),q=Q.canvas;Q.fillStyle=J,Q.fillRect(0,0,q.width,q.height),he.setImage(new Gu({img:q,anchor:le.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:le.getOrigin(),opacity:1,size:le.getSize(),scale:le.getScale(),rotation:le.getRotation(),rotateWithView:le.getRotateWithView()}))}const fe=he.getZIndex()||0;let Le=T[fe];Le||(Le={},T[fe]=Le,Le.Polygon=[],Le.Circle=[],Le.LineString=[],Le.Point=[]);const we=Y.getType();if(we==="GeometryCollection"){const se=Y.getGeometriesArrayRecursive();for(let Q=0,q=se.length;Q<q;++Q){const $e=se[Q];Le[$e.getType().replace("Multi","")].push($e,he)}}else Le[we.replace("Multi","")].push(Y,he)}}const M=Object.keys(T).map(Number).sort(Ec);for(let G=0,N=M.length;G<N;++G){const V=T[M[G]];for(const W in V){const j=V[W];for(let J=0,te=j.length;J<te;J+=2){C.setStyle(j[J+1]);for(let ce=0,pe=e.length;ce<pe;++ce)C.setTransform(e[ce]),C.drawGeometry(j[J])}}}return y.getImageData(0,0,x.width,x.height)}function FB(n,e,t){const i=[];if(t){const r=Math.floor(Math.round(n[0])*bl),o=Math.floor(Math.round(n[1])*bl),s=(Br(r,0,t.width-1)+Br(o,0,t.height-1)*t.width)*4,l=t.data[s],u=t.data[s+1],d=t.data[s+2]+256*(u+256*l),m=Math.floor((256*256*256-1)/e.length);d&&d%m===0&&i.push(e[d/m-1])}return i}const loe=.5,OB={Point:moe,LineString:foe,Polygon:_oe,MultiPoint:yoe,MultiLineString:poe,MultiPolygon:goe,GeometryCollection:doe,Circle:coe};function uoe(n,e){return parseInt(ti(n),10)-parseInt(ti(e),10)}function CT(n,e){const t=NB(n,e);return t*t}function NB(n,e){return loe*n/e}function coe(n,e,t,i,r){const o=t.getFill(),s=t.getStroke();if(o||s){const u=n.getBuilder(t.getZIndex(),"Circle");u.setFillStrokeStyle(o,s),u.drawCircle(e,i,r)}const l=t.getText();if(l&&l.getText()){const u=n.getBuilder(t.getZIndex(),"Text");u.setTextStyle(l),u.drawText(e,i)}}function FC(n,e,t,i,r,o,s,l){const u=[],h=t.getImage();if(h){let y=!0;const x=h.getImageState();x==An.LOADED||x==An.ERROR?y=!1:x==An.IDLE&&h.load(),y&&u.push(h.ready())}const d=t.getFill();d&&d.loading()&&u.push(d.ready());const m=u.length>0;return m&&Promise.all(u).then(()=>r(null)),hoe(n,e,t,i,o,s,l),m}function hoe(n,e,t,i,r,o,s){const l=t.getGeometryFunction()(e);if(!l)return;const u=l.simplifyTransformed(i,r);if(t.getRenderer())DB(n,u,t,e,s);else{const d=OB[u.getType()];d(n,u,t,e,s,o)}}function DB(n,e,t,i,r){if(e.getType()=="GeometryCollection"){const s=e.getGeometries();for(let l=0,u=s.length;l<u;++l)DB(n,s[l],t,i,r);return}n.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer(),r)}function doe(n,e,t,i,r,o){const s=e.getGeometriesArray();let l,u;for(l=0,u=s.length;l<u;++l){const h=OB[s[l].getType()];h(n,s[l],t,i,r,o)}}function foe(n,e,t,i,r){const o=t.getStroke();if(o){const l=n.getBuilder(t.getZIndex(),"LineString");l.setFillStrokeStyle(null,o),l.drawLineString(e,i,r)}const s=t.getText();if(s&&s.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(s),l.drawText(e,i,r)}}function poe(n,e,t,i,r){const o=t.getStroke();if(o){const l=n.getBuilder(t.getZIndex(),"LineString");l.setFillStrokeStyle(null,o),l.drawMultiLineString(e,i,r)}const s=t.getText();if(s&&s.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(s),l.drawText(e,i,r)}}function goe(n,e,t,i,r){const o=t.getFill(),s=t.getStroke();if(s||o){const u=n.getBuilder(t.getZIndex(),"Polygon");u.setFillStrokeStyle(o,s),u.drawMultiPolygon(e,i,r)}const l=t.getText();if(l&&l.getText()){const u=n.getBuilder(t.getZIndex(),"Text");u.setTextStyle(l),u.drawText(e,i,r)}}function moe(n,e,t,i,r,o){const s=t.getImage(),l=t.getText(),u=l&&l.getText(),h=o&&s&&u?{}:void 0;if(s){if(s.getImageState()!=An.LOADED)return;const d=n.getBuilder(t.getZIndex(),"Image");d.setImageStyle(s,h),d.drawPoint(e,i,r)}if(u){const d=n.getBuilder(t.getZIndex(),"Text");d.setTextStyle(l,h),d.drawText(e,i,r)}}function yoe(n,e,t,i,r,o){const s=t.getImage(),l=s&&s.getOpacity()!==0,u=t.getText(),h=u&&u.getText(),d=o&&l&&h?{}:void 0;if(l){if(s.getImageState()!=An.LOADED)return;const m=n.getBuilder(t.getZIndex(),"Image");m.setImageStyle(s,d),m.drawMultiPoint(e,i,r)}if(h){const m=n.getBuilder(t.getZIndex(),"Text");m.setTextStyle(u,d),m.drawText(e,i,r)}}function _oe(n,e,t,i,r){const o=t.getFill(),s=t.getStroke();if(o||s){const u=n.getBuilder(t.getZIndex(),"Polygon");u.setFillStrokeStyle(o,s),u.drawPolygon(e,i,r)}const l=t.getText();if(l&&l.getText()){const u=n.getBuilder(t.getZIndex(),"Text");u.setTextStyle(l),u.drawText(e,i,r)}}const voe=5;class boe extends fb{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=voe}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return Zn()}getData(e){return null}prepareFrame(e){return Zn()}renderFrame(e,t){return Zn()}forEachFeatureAtCoordinate(e,t,i,r,o){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===An.LOADED||t.getState()===An.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=An.LOADED&&t!=An.ERROR&&e.addEventListener($n.CHANGE,this.boundHandleImageChange_),t==An.IDLE&&(e.load(),t=e.getState()),t==An.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const E5=[];let Lm=null;function xoe(){Lm=qs(1,1,void 0,{willReadFrequently:!0})}class HM extends boe{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=qa(),this.pixelTransform=qa(),this.inversePixelTransform=qa(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,i){Lm||xoe(),Lm.clearRect(0,0,1,1);let r;try{Lm.drawImage(e,t,i,1,1,0,0,1,1),r=Lm.getImageData(0,0,1,1).data}catch{return Lm=null,null}return r}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const r=this.getLayer().getClassName();let o,s;if(e&&e.className===r&&(!i||e&&e.style.backgroundColor&&nd(Hl(e.style.backgroundColor),Hl(i)))){const l=e.firstElementChild;$d(l)&&(s=l.getContext("2d"))}if(s&&qY(s.canvas.style.transform,t)?(this.container=e,this.context=s,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){o=Il?PD():document.createElement("div"),o.className=r;let l=o.style;l.position="absolute",l.width="100%",l.height="100%",s=qs();const u=s.canvas;o.appendChild(u),l=u.style,l.position="absolute",l.left="0",l.transformOrigin="top left",this.container=o,this.context=s}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const r=td(i),o=kw(i),s=Mw(i),l=Rw(i);Gs(t.coordinateToPixelTransform,r),Gs(t.coordinateToPixelTransform,o),Gs(t.coordinateToPixelTransform,s),Gs(t.coordinateToPixelTransform,l);const u=this.inversePixelTransform;Gs(u,r),Gs(u,o),Gs(u,s),Gs(u,l),e.save(),e.beginPath(),e.moveTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(l[0]),Math.round(l[1])),e.clip()}prepareContainer(e,t){const i=e.extent,r=e.viewState.resolution,o=e.viewState.rotation,s=e.pixelRatio,l=Math.round(Ni(i)/r*s),u=Math.round(Ns(i)/r*s);Lu(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/s,1/s,o,-l/2,-u/2),_D(this.inversePixelTransform,this.pixelTransform);const h=JY(this.pixelTransform);if(this.useContainer(t,h,this.getBackground(e)),!this.containerReused){const d=this.context.canvas;d.width!=l||d.height!=u?(d.width=l,d.height=u):this.context.clearRect(0,0,l,u),h!==d.style.transform&&(d.style.transform=h)}}dispatchRenderEvent_(e,t,i){const r=this.getLayer();if(r.hasListener(e)){const o=new o4(e,this.inversePixelTransform,i,t);r.dispatchEvent(o)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(ja.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(ja.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new YM),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(ja.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(ja.POSTRENDER,this.context,e))}getRenderTransform(e,t,i,r,o,s,l){const u=o/2,h=s/2,d=r/t,m=-d,y=-e[0]+l,x=-e[1];return Lu(this.tempTransform,u,h,d,m,-i,y,x)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class Ioe extends HM{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Qa(),this.wrappedRenderedExtent_=Qa(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,i){const r=t.extent,o=t.viewState,s=o.center,l=o.resolution,u=o.projection,h=o.rotation,d=u.getExtent(),m=this.getLayer().getSource(),y=this.getLayer().getDeclutter(),x=t.pixelRatio,C=t.viewHints,w=!(C[jr.ANIMATING]||C[jr.INTERACTING]),S=this.context,T=Math.round(Ni(r)/l*x),M=Math.round(Ns(r)/l*x),G=m.getWrapX()&&u.canWrapX(),N=G?Ni(d):null,V=G?Math.ceil((r[2]-d[2])/N)+1:1;let W=G?Math.floor((r[0]-d[0])/N):0;do{let j=this.getRenderTransform(s,l,0,x,T,M,W*N);t.declutter&&(j=j.slice(0)),e.execute(S,[S.canvas.width,S.canvas.height],j,h,w,i===void 0?Sp:i?GC:ooe,i?y&&t.declutter[y]:void 0)}while(++W<V)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=qs(this.context.canvas.width,this.context.canvas.height,E5))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,Ww(this.context),E5.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex];this.opacity_=i.opacity;const r=e.viewState;this.prepareContainer(e,t);const o=this.context,s=this.replayGroup_;let l=s&&!s.isEmpty();if(!l&&!(this.getLayer().hasListener(ja.PRERENDER)||this.getLayer().hasListener(ja.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(o,e),r.projection,this.clipped_=!1,l&&i.extent&&this.clipping){const u=Wl(i.extent);l=Os(u,e.extent),this.clipped_=l&&!_c(u,e.extent),this.clipped_&&this.clipUnrotated(o,e,u)}return l&&this.renderWorlds(s,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&o.restore(),this.postRender(o,e),this.renderedRotation_!==r.rotation&&(this.renderedRotation_=r.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),r=this.renderedCenter_,o=this.renderedResolution_,s=this.renderedRotation_,l=this.renderedProjection_,u=this.wrappedRenderedExtent_,h=this.getLayer(),d=[],m=i[0]*bl,y=i[1]*bl;d.push(this.getRenderTransform(r,o,s,bl,m,y,0).slice());const x=h.getSource(),C=l.getExtent();if(x.getWrapX()&&l.canWrapX()&&!_c(C,u)){let w=u[0];const S=Ni(C);let T=0,M;for(;w<C[0];)--T,M=S*T,d.push(this.getRenderTransform(r,o,s,bl,m,y,M).slice()),w+=S;for(T=0,w=u[2];w>C[2];)++T,M=S*T,d.push(this.getRenderTransform(r,o,s,bl,m,y,M).slice()),w-=S}this.hitDetectionImageData_=GB(i,d,this.renderedFeatures_,h.getStyleFunction(),u,o,s,CT(o,this.renderedPixelRatio_),null)}t(FB(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,r,o){if(!this.replayGroup_)return;const s=t.viewState.resolution,l=t.viewState.rotation,u=this.getLayer(),h={},d=function(y,x,C){const w=ti(y),S=h[w];if(S){if(S!==!0&&C<S.distanceSq){if(C===0)return h[w]=!0,o.splice(o.lastIndexOf(S),1),r(y,u,x);S.geometry=x,S.distanceSq=C}}else{if(C===0)return h[w]=!0,r(y,u,x);o.push(h[w]={feature:y,layer:u,geometry:x,distanceSq:C,callback:r})}},m=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,s,l,i,d,m?t.declutter?.[m]?.all().map(y=>y.value):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const r=e.viewHints[jr.ANIMATING],o=e.viewHints[jr.INTERACTING],s=t.getUpdateWhileAnimating(),l=t.getUpdateWhileInteracting();if(this.ready&&!s&&r||!l&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const u=e.extent,h=e.viewState,d=h.projection,m=h.resolution,y=e.pixelRatio,x=t.getRevision(),C=t.getRenderBuffer();let w=t.getRenderOrder();w===void 0&&(w=uoe);const S=h.center.slice(),T=Hh(u,C*m),M=T.slice(),G=[T.slice()],N=d.getExtent();if(i.getWrapX()&&d.canWrapX()&&!_c(N,e.extent)){const D=Ni(N),re=Math.max(Ni(T)/2,D);T[0]=N[0]-re,T[2]=N[2]+re,Lw(S,d);const le=tD(G[0],d);le[0]<N[0]&&le[2]<N[2]?G.push([le[0]+D,le[1],le[2]+D,le[3]]):le[0]>N[0]&&le[2]>N[2]&&G.push([le[0]-D,le[1],le[2]-D,le[3]])}if(this.ready&&this.renderedResolution_==m&&this.renderedRevision_==x&&this.renderedRenderOrder_==w&&this.renderedFrameDeclutter_===!!e.declutter&&_c(this.wrappedRenderedExtent_,T))return nd(this.renderedExtent_,M)||(this.hitDetectionImageData_=null,this.renderedExtent_=M),this.renderedCenter_=S,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const V=new kB(NB(m,y),T,m,y);let W;for(let D=0,re=G.length;D<re;++D)i.loadFeatures(G[D],m,d);const j=CT(m,y);let J=!0;const te=(D,re)=>{let le;const fe=D.getStyleFunction()||t.getStyleFunction();if(fe&&(le=fe(D,m)),le){const Le=this.renderFeature(D,j,le,V,W,this.getLayer().getDeclutter(),re);J=J&&!Le}},ce=Ow(T),pe=i.getFeaturesInExtent(ce);w&&pe.sort(w);for(let D=0,re=pe.length;D<re;++D)te(pe[D],D);this.renderedFeatures_=pe,this.ready=J;const Y=V.finish(),he=new LB(T,m,y,i.getOverlaps(),Y,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=m,this.renderedRevision_=x,this.renderedRenderOrder_=w,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=M,this.wrappedRenderedExtent_=T,this.renderedCenter_=S,this.renderedProjection_=d,this.renderedPixelRatio_=y,this.replayGroup_=he,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,r,o,s,l){if(!i)return!1;let u=!1;if(Array.isArray(i))for(let h=0,d=i.length;h<d;++h)u=FC(r,e,i[h],t,this.boundHandleStyleImageChange_,o,s,l)||u;else u=FC(r,e,i,t,this.boundHandleStyleImageChange_,o,s,l);return u}}class bo extends gM{constructor(e){super(e)}createRenderer(){return new Ioe(this)}}let Coe=!1;function woe(n,e,t,i,r,o,s){const l=new XMLHttpRequest;l.open("GET",typeof n=="function"?n(t,i,r):n,!0),e.getType()=="arraybuffer"&&(l.responseType="arraybuffer"),l.withCredentials=Coe,l.onload=function(u){if(!l.status||l.status>=200&&l.status<300){const h=e.getType();try{let d;h=="text"||h=="json"?d=l.responseText:h=="xml"?d=l.responseXML||l.responseText:h=="arraybuffer"&&(d=l.response),d?o(e.readFeatures(d,{extent:t,featureProjection:r}),e.readProjection(d)):s()}catch{s()}}else s()},l.onerror=s,l.send()}function T5(n,e){return function(t,i,r,o,s){woe(n,e,t,i,r,(l,u)=>{this.addFeatures(l),o!==void 0&&o(l)},()=>{this.changed(),s!==void 0&&s()})}}function Aoe(n,e){return[[-1/0,-1/0,1/0,1/0]]}class Zi extends eu{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Zi(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(pr(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=In(e,$n.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?Soe(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Soe(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(fr(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[n]),function(){return e}}function VB(n,e,t,i){const r=[];let o=Qa();for(let s=0,l=t.length;s<l;++s){const u=t[s];o=LR(n,e,u[0],i),r.push((o[0]+o[2])/2,(o[1]+o[3])/2),e=u[u.length-1]}return r}function OC(n,e,t,i,r,o,s){let l,u;const h=(t-e)/i;if(h===1)l=e;else if(h===2)l=e,u=r;else if(h!==0){let d=n[e],m=n[e+1],y=0;const x=[0];for(let S=e+i;S<t;S+=i){const T=n[S],M=n[S+1];y+=Math.sqrt((T-d)*(T-d)+(M-m)*(M-m)),x.push(y),d=T,m=M}const C=r*y,w=PY(x,C);w<0?(u=(C-x[-w-2])/(x[-w-1]-x[-w-2]),l=e+(-w-2)*i):l=e+w*i}s=s>1?s:2,o=o||new Array(s);for(let d=0;d<s;++d)o[d]=l===void 0?NaN:u===void 0?n[l+d]:ml(n[l+d],n[l+i+d],u);return o}function wT(n,e,t,i,r,o){if(t==e)return null;let s;if(r<n[e+i-1])return o?(s=n.slice(e,e+i),s[i-1]=r,s):null;if(n[t-1]<r)return o?(s=n.slice(t-i,t),s[i-1]=r,s):null;if(r==n[e+i-1])return n.slice(e,e+i);let l=e/i,u=t/i;for(;l<u;){const y=l+u>>1;r<n[(y+1)*i-1]?u=y:l=y+1}const h=n[l*i-1];if(r==h)return n.slice((l-1)*i,(l-1)*i+i);const d=n[(l+1)*i-1],m=(r-h)/(d-h);s=[];for(let y=0;y<i-1;++y)s.push(ml(n[(l-1)*i+y],n[l*i+y],m));return s.push(r),s}function Eoe(n,e,t,i,r,o,s){if(s)return wT(n,e,t[t.length-1],i,r,o);let l;if(r<n[i-1])return o?(l=n.slice(0,i),l[i-1]=r,l):null;if(n[n.length-1]<r)return o?(l=n.slice(n.length-i),l[i-1]=r,l):null;for(let u=0,h=t.length;u<h;++u){const d=t[u];if(e!=d){if(r<n[e+i-1])return null;if(r<=n[d-1])return wT(n,e,d,i,r,!1);e=d}}return null}class _f extends If{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new _f(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){const o=this.flatCoordinates,s=e-o[0],l=t-o[1],u=s*s+l*l;if(u<r){if(u===0)for(let h=0;h<this.stride;++h)i[h]=o[h];else{const h=this.getRadius()/Math.sqrt(u);i[0]=o[0]+h*s,i[1]=o[1]+h*l;for(let d=2;d<this.stride;++d)i[d]=o[d]}return i.length=this.stride,u}return r}containsXY(e,t){const i=this.flatCoordinates,r=e-i[0],o=t-i[1];return r*r+o*o<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return Pc(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Os(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:PR(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],r=e.slice();r[t]=r[0]+i;for(let o=1;o<t;++o)r[t+o]=e[o];this.setFlatCoordinates(this.layout,r),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let o=ID(r,0,e,this.stride);r[o++]=r[0]+t;for(let s=1,l=this.stride;s<l;++s)r[o++]=r[s];r.length=o,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),r=this.getStride();this.setCenter(XR(i,0,i.length,r,e,t,i)),this.changed()}}_f.prototype.transform;class $l extends vD{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(pr),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,i=e.length;t<i;++t)this.changeEventsKeys_.push(In(e[t],$n.CHANGE,this.changed,this))}clone(){const e=new $l(IS(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<ag(this.getExtent(),e,t))return r;const o=this.geometries_;for(let s=0,l=o.length;s<l;++s)r=o[s].closestPointXY(e,t,i,r);return r}containsXY(e,t){const i=this.geometries_;for(let r=0,o=i.length;r<o;++r)if(i[r].containsXY(e,t))return!0;return!1}computeExtent(e){Fy(e);const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)by(e,t[i].getExtent());return e}getGeometries(){return IS(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let r=!1;for(let o=0,s=i.length;o<s;++o){const l=i[o],u=l.getSimplifiedGeometry(e);t.push(u),u!==l&&(r=!0)}return r?new $l(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let r=0,o=i.length;r<o;++r)i[r].rotate(e,t);this.changed()}scale(e,t,i){i||(i=ku(this.getExtent()));const r=this.geometries_;for(let o=0,s=r.length;o<s;++o)r[o].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(IS(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let r=0,o=i.length;r<o;++r)i[r].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function IS(n){return n.map(e=>e.clone())}class $i extends If{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){dr(this.flatCoordinates,e),this.changed()}clone(){const e=new $i(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<ag(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(YR(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),KR(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,r))}forEachSegment(e){return ED(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,wT(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return jd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return OC(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return XM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=Bw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new $i(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return Zw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Vw(this.flatCoordinates,0,e,this.stride),this.changed()}}class Nu extends If{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{const r=e,o=[],s=[];for(let u=0,h=r.length;u<h;++u){const d=r[u];dr(o,d.getFlatCoordinates()),s.push(o.length)}const l=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(l,o),this.ends_=s}}appendLineString(e){dr(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Nu(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<ag(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(HR(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),jR(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,r))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,Eoe(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return Rv(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new $i(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,r=[];let o=0;for(let s=0,l=t.length;s<l;++s){const u=t[s],h=new $i(e.slice(o,u),i);r.push(h),o=u}return r}getLength(){const e=this.ends_;let t=0,i=0;for(let r=0,o=e.length;r<o;++r)i+=XM(this.flatCoordinates,t,e[r],this.stride),t=e[r];return i}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const r=this.ends_,o=this.stride;for(let s=0,l=r.length;s<l;++s){const u=r[s],h=OC(t,i,u,o,.5);dr(e,h),i=u}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=wD(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new Nu(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return cH(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=pb(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class Jh extends If{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){dr(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new Jh(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<ag(this.getExtent(),e,t))return r;const o=this.flatCoordinates,s=this.stride;for(let l=0,u=o.length;l<u;l+=s){const h=Ph(e,t,o[l],o[l+1]);if(h<r){r=h;for(let d=0;d<s;++d)i[d]=o[l+d];i.length=s}}return r}getCoordinates(){return jd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new Mr(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,r=[];for(let o=0,s=e.length;o<s;o+=i){const l=new Mr(e.slice(o,o+i),t);r.push(l)}return r}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let r=0,o=t.length;r<o;r+=i){const s=t[r],l=t[r+1];if(kR(e,s,l))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Vw(this.flatCoordinates,0,e,this.stride),this.changed()}}class vf extends If{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){const r=e,o=[],s=[];for(let l=0,u=r.length;l<u;++l){const h=r[l],d=o.length,m=h.getEnds();for(let y=0,x=m.length;y<x;++y)m[y]+=d;dr(o,h.getFlatCoordinates()),s.push(m)}t=r.length===0?this.getLayout():r[0].getLayout(),e=o,i=s}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;dr(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let r=0,o=t.length;r<o;++r)t[r]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=this.endss_[r].slice();const i=new vf(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,r){return r<ag(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(rH(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),sH(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,r))}containsXY(e,t){return uH(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return iH(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),DE(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,NE(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=VB(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=SD(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Jh(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;MD(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=DE(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=aH(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new vf(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const o=this.endss_[e-1];t=o[o.length-1]}const i=this.endss_[e].slice(),r=i[i.length-1];if(t!==0)for(let o=0,s=i.length;o<s;++o)i[o]-=t;return new Fo(this.flatCoordinates.slice(t,r),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,r=[];let o=0;for(let s=0,l=i.length;s<l;++s){const u=i[s].slice(),h=u[u.length-1];if(o!==0)for(let m=0,y=u.length;m<y;++m)u[m]-=o;const d=new Fo(t.slice(o,h),e,u);r.push(d),o=h}return r}getType(){return"MultiPolygon"}intersectsExtent(e){return hH(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=CD(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const r=i[i.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}}const R5=qa();class yl{constructor(e,t,i,r,o,s){this.styleFunction,this.extent_,this.id_=s,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=o,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?ey(this.flatCoordinates_):LR(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=ku(this.getExtent());this.flatInteriorPoints_=qR(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=fH(this.flatCoordinates_,this.ends_),t=VB(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=SD(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=OC(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let r=0,o=i.length;r<o;++r){const s=i[r],l=OC(e,t,s,2,.5);dr(this.flatMidpoints_,l),t=s}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=Oi(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const r=Ns(i)/Ns(t);Lu(R5,i[0],i[3],r,-r,0,0,0),Nh(this.flatCoordinates_,0,this.flatCoordinates_.length,2,R5,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new yl(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=hD((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const i=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":i.length=Bw(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,i,0),r=[i.length];break;case"MultiLineString":r=[],i.length=wD(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,i,0,r);break;case"Polygon":r=[],i.length=$R(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),i,0,r);break}return r&&(this.simplifiedGeometry_=new yl(this.type_,i,r,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}yl.prototype.getFlatCoordinates=yl.prototype.getOrientedFlatCoordinates;class NC{constructor(e){this.rbush_=new UD(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[ti(t)]=i}load(e,t){const i=new Array(t.length);for(let r=0,o=t.length;r<o;r++){const s=e[r],l=t[r],u={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:l};i[r]=u,this.items_[ti(l)]=u}this.rbush_.load(i)}remove(e){const t=ti(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[ti(t)],r=[i.minX,i.minY,i.maxX,i.maxY];Up(r,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(r){return r.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let r=0,o=e.length;r<o;r++)if(i=t(e[r]),i)return i;return i}isEmpty(){return Yp(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return Pc(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}class KM extends eu{constructor(e){super(),this.projection=Oi(e.projection),this.attributions_=M5(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,r){t.viewResolver=i,t.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=M5(e),this.changed()}setState(e){this.state_=e,this.changed()}}function M5(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),e=>n):null}const Ba={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class Gd extends la{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class ua extends KM{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Ev,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(fr(this.format_,"`format` must be set when `url` is set"),this.loader_=T5(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:Aoe;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new NC:null,this.loadedExtentsRtree_=new NC,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,r;Array.isArray(e.features)?r=e.features:e.features&&(i=e.features,r=i.getArray()),!t&&i===void 0&&(i=new na(r)),r!==void 0&&this.addFeaturesInternal(r),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=ti(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const r=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Gd(Ba.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof yl||(this.featureChangeKeys_[e]=[In(t,$n.CHANGE,this.handleFeatureChange_,this),In(t,jp.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let i=!0;if(t.getId()!==void 0){const r=String(t.getId());if(!(r in this.idIndex_))this.idIndex_[r]=t;else if(t instanceof yl){const o=this.idIndex_[r];o instanceof yl?Array.isArray(o)?o.push(t):this.idIndex_[r]=[o,t]:i=!1}else i=!1}return i&&(fr(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],r=[];for(let o=0,s=e.length;o<s;o++){const l=e[o],u=ti(l);this.addToIndex_(u,l)&&i.push(l)}for(let o=0,s=i.length;o<s;o++){const l=i[o],u=ti(l);this.setupChangeEvents_(u,l);const h=l.getGeometry();if(h){const d=h.getExtent();t.push(d),r.push(l)}else this.nullGeometryFeatures_[u]=l}if(this.featuresRtree_&&this.featuresRtree_.load(t,r),this.hasListener(Ba.ADDFEATURE))for(let o=0,s=i.length;o<s;o++)this.dispatchEvent(new Gd(Ba.ADDFEATURE,i[o]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Ba.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(Ba.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(Jo.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(Jo.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(pr);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Gd(Ba.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(r){const o=r.getGeometry();if(o instanceof yl||o.intersectsCoordinate(e))return t(r)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){const r=i.getGeometry();if(r instanceof yl||r.intersectsExtent(e)){const o=t(i);if(o)return o}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),Yp(this.nullGeometryFeatures_)||dr(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const r=nD(e,t);return[].concat(...r.map(o=>this.featuresRtree_.getInExtent(o)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],r=e[1];let o=null;const s=[NaN,NaN];let l=1/0;const u=[-1/0,-1/0,1/0,1/0];return t=t||Iy,this.featuresRtree_.forEachInExtent(u,function(h){if(t(h)){const d=h.getGeometry(),m=l;if(l=d instanceof yl?0:d.closestPointXY(i,r,s,l),l<m){o=h;const y=Math.sqrt(l);u[0]=i-y,u[1]=r-y,u[2]=i+y,u[3]=r+y}}}),o}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=ti(t),r=t.getGeometry();if(!r)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const s=r.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(s,t)):this.featuresRtree_&&this.featuresRtree_.update(s,t)}const o=t.getId();if(o!==void 0){const s=o.toString();this.idIndex_[s]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[s]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new Gd(Ba.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:ti(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Yp(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const r=this.loadedExtentsRtree_,o=this.strategy_(e,t,i);for(let s=0,l=o.length;s<l;++s){const u=o[s];r.forEachInExtent(u,function(d){return _c(d.extent,u)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Gd(Ba.FEATURESLOADSTART)),this.loader_.call(this,u,t,i,d=>{--this.loadingExtentsCount_,this.dispatchEvent(new Gd(Ba.FEATURESLOADEND,void 0,d))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Gd(Ba.FEATURESLOADERROR))}),r.insert(u,{extent:u.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_,i=t.forEachInExtent(e,function(r){if(Up(r.extent,e))return r});i&&t.remove(i)}removeFeatures(e){let t=!1;for(let i=0,r=e.length;i<r;++i)t=this.removeFeatureInternal(e[i])||t;t&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=ti(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.featureChangeKeys_[t]?.forEach(pr),delete this.featureChangeKeys_[t];const r=e.getId();if(r!==void 0){const o=r.toString(),s=this.idIndex_[o];s===e?delete this.idIndex_[o]:Array.isArray(s)&&(s.splice(s.indexOf(e),1),s.length===1&&(this.idIndex_[o]=s[0]))}return delete this.uidIndex_[t],this.hasListener(Ba.REMOVEFEATURE)&&this.dispatchEvent(new Gd(Ba.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){fr(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(T5(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}class jM{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Zi,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?Oi(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=Oi(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return Zn()}readFeature(e,t){return Zn()}readFeatures(e,t){return Zn()}readGeometry(e,t){return Zn()}readProjection(e){return Zn()}writeFeature(e,t){return Zn()}writeFeatures(e,t){return Zn()}writeGeometry(e,t){return Zn()}}function nu(n,e,t){const i=t?Oi(t.featureProjection):null,r=t?Oi(t.dataProjection):null;let o=n;if(i&&r&&!Oh(i,r)){e&&(o=n.clone());const s=e?i:r,l=e?r:i;s.getUnits()==="tile-pixels"?o.transform(s,l):o.applyTransform(ff(s,l))}if(e&&t&&t.decimals!==void 0){const s=Math.pow(10,t.decimals),l=function(u){for(let h=0,d=u.length;h<d;++h)u[h]=Math.round(u[h]*s)/s;return u};o===n&&(o=n.clone()),o.applyTransform(l)}return o}const Toe={Point:Mr,LineString:$i,Polygon:Fo,MultiPoint:Jh,MultiLineString:Nu,MultiPolygon:vf};function Roe(n,e,t){return Array.isArray(e[0])?(MD(n,0,e,t)||(n=n.slice(),DE(n,0,e,t)),n):(eM(n,0,e,t)||(n=n.slice(),sC(n,0,e,t)),n)}function BB(n,e){const t=n.geometry;if(!t)return[];if(Array.isArray(t))return t.map(o=>BB({...n,geometry:o})).flat();const i=t.type==="MultiPolygon"?"Polygon":t.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const r=t.layout.length;return nu(new yl(i,i==="Polygon"?Roe(t.flatCoordinates,t.ends,r):t.flatCoordinates,t.ends?.flat(),r,n.properties||{},n.id).enableSimplifyTransformed(),!1,e)}function $M(n,e){if(!n)return null;if(Array.isArray(n)){const i=n.map(r=>$M(r,e));return new $l(i)}const t=Toe[n.type];return nu(new t(n.flatCoordinates,n.layout||"XY",n.ends),!1,e)}class Moe extends jM{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(wx(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(wx(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return Zn()}readFeaturesFromObject(e,t){return Zn()}readGeometry(e,t){return this.readGeometryFromObject(wx(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return Zn()}readProjection(e){return this.readProjectionFromObject(wx(e))}readProjectionFromObject(e){return Zn()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return Zn()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return Zn()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return Zn()}}function wx(n){if(typeof n=="string"){const e=JSON.parse(n);return e||null}return n!==null?n:null}class Jl extends Moe{constructor(e){e=e||{},super(),this.dataProjection=Oi(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=Oi(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;e.type==="Feature"?i=e:i={type:"Feature",geometry:e,properties:null};const r=JM(i.geometry);if(this.featureClass===yl)return BB({geometry:r,id:i.id,properties:i.properties},t);const o=new Zi;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&o.setGeometryName(i.geometry_name),o.setGeometry($M(r,t)),"id"in i&&o.setId(i.id),i.properties&&o.setProperties(i.properties,!0),o}readFeaturesFromObject(e,t){const i=e;let r=null;if(i.type==="FeatureCollection"){const o=e;r=[];const s=o.features;for(let l=0,u=s.length;l<u;++l){const h=this.readFeatureFromObject(s[l],t);h&&r.push(h)}}else r=[this.readFeatureFromObject(e,t)];return r.flat()}readGeometryFromObject(e,t){return koe(e,t)}readProjectionFromObject(e){const t=e.crs;let i;if(t)if(t.type=="name")i=Oi(t.properties.name);else if(t.type==="EPSG")i=Oi("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},r=e.getId();if(r!==void 0&&(i.id=r),!e.hasProperties())return i;const o=e.getProperties(),s=e.getGeometry();return s&&(i.geometry=AT(s,t),delete o[e.getGeometryName()]),Yp(o)||(i.properties=o),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let r=0,o=e.length;r<o;++r)i.push(this.writeFeatureObject(e[r],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return AT(e,this.adaptOptions(t))}}function JM(n,e){if(!n)return null;let t;switch(n.type){case"Point":{t=Poe(n);break}case"LineString":{t=Goe(n);break}case"Polygon":{t=Doe(n);break}case"MultiPoint":{t=Ooe(n);break}case"MultiLineString":{t=Foe(n);break}case"MultiPolygon":{t=Noe(n);break}case"GeometryCollection":{t=Loe(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return t}function koe(n,e){const t=JM(n);return $M(t,e)}function Loe(n,e){return n.geometries.map(function(i){return JM(i)})}function Poe(n){const e=n.coordinates;return{type:"Point",flatCoordinates:e,layout:ug(e.length)}}function Goe(n){const e=n.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:ug(e[0]?.length||2)}}function Foe(n){const e=n.coordinates,t=e[0]?.[0]?.length||2,i=[],r=pb(i,0,e,t);return{type:"MultiLineString",flatCoordinates:i,ends:r,layout:ug(t)}}function Ooe(n){const e=n.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:ug(e[0]?.length||2)}}function Noe(n){const e=n.coordinates,t=[],i=e[0]?.[0]?.[0].length||2,r=CD(t,0,e,i);return{type:"MultiPolygon",flatCoordinates:t,ends:r,layout:ug(i)}}function Doe(n){const e=n.coordinates,t=[],i=e[0]?.[0]?.length,r=pb(t,0,e,i);return{type:"Polygon",flatCoordinates:t,ends:r,layout:ug(i)}}function AT(n,e){n=nu(n,!0,e);const t=n.getType();let i;switch(t){case"Point":{i=Uoe(n);break}case"LineString":{i=Boe(n);break}case"Polygon":{i=Xoe(n,e);break}case"MultiPoint":{i=Woe(n);break}case"MultiLineString":{i=Zoe(n);break}case"MultiPolygon":{i=zoe(n,e);break}case"GeometryCollection":{i=Voe(n,e);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return i}function Voe(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return AT(i,e)})}}function Boe(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function Zoe(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function Woe(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function zoe(n,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(t)}}function Uoe(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function Xoe(n,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(t)}}const Yoe="searchLayer",k5=17;class Hoe{map;featureLayer;init(e){this.map=e,this.createFeatureLayer()}createFeatureLayer(){this.featureLayer=new bo({source:new ua,zIndex:1e3});const e=new Ji({color:[255,255,0,.6]}),t=new ki({color:[255,155,55,1],width:3}),i=new Qs({radius:10,fill:e,stroke:t});this.featureLayer.set("cyLayerType",Yoe),this.featureLayer.setStyle(function(r){const o=r.get("color")||"#ffcc33",s=r.get("width")||3,l=[new qn({fill:new Ji({color:[255,255,0,.6]})}),new qn({stroke:new ki({color:"#ffffff",width:5})}),new qn({stroke:new ki({color:o,width:s})})],u=r.getGeometry?.()?.getType?.();return u==="Point"||u==="MultiPoint"?[new qn({image:i})]:l}),this.map.addLayer(this.featureLayer)}clearFeatures(){this.featureLayer.getSource()?.clear()}fitFeatures(e,t,i){const r={dataProjection:i||Fu,featureProjection:this.map.getView().getProjection()},o=new Jl().readFeatures({type:"FeatureCollection",features:e},r);if(o.length>0){let s=o[0].getGeometry()?.getExtent()||[0,0,0,0];for(const l of o){const u=l.getGeometry()?.getExtent()||[0,0,0,0];s=by(s,u)}if(s){const l={size:this.map.getSize(),maxZoom:t||k5};this.map.getView().fit(s,l)}}}isGeoJsonArray(e){return e.length>0&&typeof e[0].type=="string"}isFeatureArray(e){return e.length>0&&typeof e[0].getGeometry=="function"}highlightFeatures(e,t,i,r){if(this.clearFeatures(),e!=null){this.map.getLayers().getArray().indexOf(this.featureLayer)===-1&&this.map.addLayer(this.featureLayer);const o={dataProjection:r||Fu,featureProjection:this.map.getView().getProjection()};let s=[];if(this.isGeoJsonArray(e)?s=new Jl().readFeatures({type:"FeatureCollection",features:e},o):this.isFeatureArray(e)&&(s=e),s.length>0){let l=s[0].getGeometry()?.getExtent()||[0,0,0,0];for(const u of s){const h=u.getGeometry()?.getExtent()||[0,0,0,0];l=by(l,h),u.getId()==null&&u.setId(void 0),u.getGeometry()?.getType()==="GeometryCollection"?u.getGeometry().getGeometriesArray().forEach(m=>{const y=u.clone();y.setGeometry(m),this.featureLayer.getSource()?.addFeature(y)}):this.featureLayer.getSource()?.addFeature(u)}if(t&&l){const u={size:this.map.getSize(),maxZoom:i||k5};this.map.getView().fit(l,u)}}}}}const xh=new Hoe;function Ax(n,e){return n.indexOf(e)>=0}function ZB(){function n(o,s,l,u=!1,h=!1){let d="",m=l;if(l==="EPSG:3263*"){const x=gs(o,s,"EPSG:4326");m=Math.floor(x[0])>=6?"EPSG:32632":"EPSG:32631"}const y=gs(o,s,m);switch(m){case"EPSG:2169":d=n0(y,"{x} E | {y} N",0);break;case"EPSG:4326":if(u){const x=e(y),C=x.split(" ").slice(0,4).join(" ");d=`${x.split(" ").slice(4,8).join(" ")} | ${C}`}else if(h){const x=t(y),C=x.split(" ").slice(0,3).join(" ");d=`${x.split(" ").slice(3,6).join(" ")} | ${C}`}else d=n0(y,"{x} E | {y} N",5);break;case"EPSG:32632":d=n0(y,"{x} | {y} (UTM32N)",0);break;case"EPSG:32631":d=n0(y,"{x} | {y} (UTM31N)",0);break;default:d=n0(y,"{x} E | {y} N",0);break}return d}function e(o){return o?i(o[1],"NS")+" "+i(o[0],"EW"):""}function t(o){return o?r(o[1],"NS")+" "+r(o[0],"EW"):""}function i(o,s){const l=(o+180)%360-180,u=Math.abs(3600*l);return Math.floor(u/3600)+" "+Xd(Math.floor(u/60%60),2)+" "+Xd(Math.floor(u%60),2)+","+Math.floor((u-(u<0?Math.ceil(u):Math.floor(u)))*10)+" "+s.charAt(l<0?1:0)}function r(o,s){const l=(o+180)%360-180,h=Math.abs(3600*l)/3600,d=(h-Math.floor(h))*60,m=(d%1).toString();return Math.floor(h)+" "+Xd(Math.floor(d),2)+","+m.substring(m.indexOf(".")+1,m.indexOf(".")+6)+" "+s.charAt(l<0?1:0)}return{coordinateString:n}}function Koe(n,e){const t=JSON.parse("[2.6, 47.7, 8.6, 51]"),i=hb(t,"EPSG:4326",e);n=n.replace(/,/gi,".");const r=[],o={"EPSG:32631":{regex:/(\d{6,6}[,.]?\d{0,3})\s*?\W*(\d{7,7}[,.]?\d{0,3})\s*?/,label:"UTM31N",epsgCode:"EPSG:32631"},"EPSG:32632":{regex:/(\d{6,6}[,.]?\d{0,3})\s*?\W*(\d{7,7}[,.]?\d{0,3})\s*?/,label:"UTM32N",epsgCode:"EPSG:32632"},"EPSG:2169":{regex:/(\d{4,6}[,.]?\d{0,3})\s*([E|N])?\W*(\d{4,6}\s*[,.|]?\s*?\d{0,3})\s*([E|N])?/,label:"LUREF",epsgCode:"EPSG:2169"},"EPSG:2169:V2":{regex:/(\d{4,6})\s*([E|N])?\s*[,.|]?\s*(\d{4,6})\s*([E|N])?/,label:"LUREF",epsgCode:"EPSG:2169"},"EPSG:4326":{regex:/(\d{1,2}[,.]\d{1,6})\d*\s?(latitude|lat|N|longitude|long|lon|E|east|est)?\W*(\d{1,2}[,.]\d{1,6})\d*\s?(longitude|long|lon|E|latitude|lat|N|north|nord)?/i,label:"long/lat WGS84",epsgCode:"EPSG:4326"},"EPSG:4326:DMS":{regex:/([NSEW])?(-)?(\d+(?:\.\d+)?)[:d\s]?\s?(?:(\d+(?:\.\d+)?)[':]\s?(?:(\d{1,2}(?:\.\d+)?)(?:"|||'')?)?)?\s?([NSEW])?/i,label:"long/lat WGS84 DMS",epsgCode:"EPSG:4326"}},s=["LATITUDE","LAT","N","NORTH","NORD"],l=["LONGITUDE","LONG","LON","E","EAST","EST"];for(const u in o){let h=o[u].regex.exec(n);if(u==="EPSG:2169"&&(n.match(/\./g)||[]).length===1&&(h=null),h){const d=o[u].epsgCode;let m=!1,y,x;if(d==="EPSG:32631"||d==="EPSG:32632"){if(h[1]&&h[2]){const C=[parseFloat(h[1].replace(",",".")),parseFloat(h[2].replace(",","."))],w=gs(C,d,"EPSG:4326");(Math.floor(w[0])===5||Math.floor(w[0])===6)&&(y=parseFloat(h[1].replace(",",".")),x=parseFloat(h[2].replace(",",".")))}}else if(u==="EPSG:4326"||u==="EPSG:2169"||u==="EPSG:2169:V2")h[2]&&h[4]?Ax(s,h[2].toUpperCase())&&Ax(l,h[4].toUpperCase())?(y=parseFloat(h[3].replace(",",".")),x=parseFloat(h[1].replace(",","."))):Ax(s,h[4].toUpperCase())&&Ax(l,h[2].toUpperCase())&&(y=parseFloat(h[1].replace(",",".")),x=parseFloat(h[3].replace(",","."))):(!h[2]||h[2]==="|")&&h[4]===void 0&&(y=parseFloat(h[1].replace(",",".")),x=parseFloat(h[3].replace(",",".")));else if(u==="EPSG:4326:DMS"){const C=h;let w;C[1]?(C[6]="",w=n.substring(C[0].length-1).trim()):w=n.substring(C[0].length).trim();const S=L5(C);if(S!==void 0){const T=o[u].regex.exec(w),M=T?L5(T):void 0;M!==void 0&&(typeof S.latLon>"u"&&!isNaN(S.decDeg)&&!isNaN(M.decDeg)&&(S.latLon="lat"),S.latLon==="lat"?(x=S.decDeg,y=M.decDeg):(y=S.decDeg,x=M.decDeg),m=!0)}}if(y!==void 0&&x!==void 0){const C=new Mr([y,x]).transform(d,e),w=new Mr([x,y]).transform(d,e);let S=null;if(i&&Lc(i,C.getCoordinates())?S=new Zi(C):d==="EPSG:4326"&&i&&Lc(i,w.getCoordinates())&&(S=new Zi(w)),S){const T=S.getGeometry(),{coordinateString:M}=ZB(),G=M(T.getCoordinates(),e,d,m,!1);S.set("label",G),S.set("epsgLabel",o[u].label),r.push(S)}}}}return r}function L5(n){const e={"-":-1,N:1,S:-1,E:1,W:-1},t={N:"lat",S:"lat",E:"lon",W:"lon"},i=e[n[2]]||e[n[1]]||e[n[6]]||1;if(n[3]===void 0)return;const r=Number(n[3]),o=n[4]!==void 0?Number(n[4]):0,s=n[5]!==void 0?Number(n[5]):0,l=t[n[1]]||t[n[6]];return{decDeg:i*(r+o/60+s/3600),latLon:l}}const Bh=()=>({bg_layers:[{icon_id:"route",vector_id:"roadmap",simple_style_class:"road",medium_style_class:"road",expert_style_class:"maputnik",id:556,is_default:!0},{icon_id:"topo",vector_id:"topomap",medium_style_class:"topo",expert_style_class:"maputnik",id:529},{icon_id:"topo_bw",vector_id:"topomap_gray",medium_style_class:"topo",expert_style_class:"maputnik",id:502},{icon_id:"ortho",id:530},{icon_id:"hybrid",id:501},{icon_id:"blank",id:0}],bg_layer_theme_defaults:{tourisme:502},simple_styles:{road:[{unlocalized_label:"Light grey",hillshade:!1,colors:["#ffffff","#ffffff","#d6e0d7","#e1e1e1","#cccccc","#f2f2f2"],selected:!1},{unlocalized_label:"Dark grey",hillshade:!1,colors:["#808080","#808080","#494b4a","#505052","#232426","#454545"],selected:!1},{unlocalized_label:"Dark sand",hillshade:!1,colors:["#9e9375","#9e9375","#6b6249","#403928","#b8aa84","#1a1814"],selected:!1},{unlocalized_label:"Kids",hillshade:!1,colors:["#f9c50d","#ffffff","#839836","#d6d3ce","#2a5ba8","#eeeeee"],selected:!1},{unlocalized_label:"Light mauve",hillshade:!1,colors:["#f3edf5","#f3edf5","#9d7da8","#caa9d1","#613b5c","#e5d3e6"],selected:!1},{unlocalized_label:"Light Blue",hillshade:!1,colors:["#dceaf5","#dceaf5","#5598cf","#81b7e3","#3b576e","#b6cde0"],selected:!1}]},medium_default_styles:{road:[{label:"Roads primary",color:"#f7f7f7",lines:["lu_road_trunk_primary","lu_bridge_major","lu_tunnel_major","lu_road_major_motorway"],visible:!0},{label:"Roads secondary",color:"#f7f7f7",lines:["lu_road_minor","lu_road_secondary_tertiary","lu_bridge_minor","lu_road_path","lu_bridge_path","lu_bridge_railway case","lu_bridge_path case"],visible:!0},{label:"Vegetation",color:"#B8D293",opacity:"1",fills:["lu_landcover_wood","lu_landcover_grass","lu_landuse_stadium","lu_landuse_cemetery"],visible:!0},{label:"Buildings",color:"#D6AA85",opacity:"1",fillExtrusions:["lu_building-3d_public","lu_building-3d"],fills:["lu_building","lu_building_public"],lines:["lu_bridge_railway","lu_railway","lu_tunnel_railway"],visible:!0},{label:"Water",color:"#94c1e1",lines:["lu_waterway","lu_waterway_tunnel","lu_waterway_intermittent"],fills:["lu_water"],visible:!0},{label:"Background",color:"#e7e7e7",backgrounds:["background"],visible:!0},{label:"Hillshade",hillshades:["hillshade"],visible:!0}],topo:[{label:"Primary Names",symbols:["lu_place-label_other","lu_place-label_city","lu_place-label_canton","lu_country-label-other","lu_country-label","place_label_other","place_label_city","country_label-other","country_label"],visible:!0},{label:"Secondary Names",symbols:["lu_place-label_isolated","lu_place-label_locality_forest","lu_place-label_locality_lieudit"],visible:!0},{label:"Transport",lines:["lu_tunnel_track-casing","lu_tunnel_major_motorway-casing","lu_tunnel_railway_transit","lu_tunnel_railway","lu_tunnel_railway-hatching","lu_tunnel_path","lu_tunnel_track","lu_tunnel_minor","lu_tunnel_major_motorway","lu_tunnel_secondary_tertiary","lu_tunnel_trunk_primary","lu_road_track-casing","lu_road_minor-casing","lu_road_major_motorway-casing","lu_road_secondary_tertiary-casing","lu_road_trunk_primary-casing","lu_road_pier","lu_road_path","lu_road_track","lu_road_minor","lu_road_major_motorway","lu_road_secondary_tertiary","lu_road_trunk_primary","lu_tram","lu_tram-hatching","lu_railway_transit","lu_railway","lu_railway-hatching","lu_bridge_railway-casing","lu_bridge_track-casing","lu_bridge_path-casing","lu_bridge_minor-casing","lu_bridge_major_motorway-casing","lu_bridge_secondary_tertiary-casing","lu_bridge_trunk_primary-casing","lu_bridge_railway","lu_bridge_path","lu_bridge_track","lu_bridge_minor","lu_bridge_major_motorway","lu_bridge_secondary_tertiary","lu_bridge_trunk_primary","tunnel_track-casing","tunnel_major_motorway-casing","tunnel_railway_transit","tunnel_railway_transit-hatching","tunnel_railway","tunnel_railway-hatching","tunnel_path","tunnel_track","tunnel_minor","tunnel_major_motorway","tunnel_secondary_tertiary","tunnel_trunk_primary","road_track-casing","road_minor-casing","road_major_motorway-casing","road_secondary_tertiary-casing","road_trunk_primary-casing","road_pier","road_path","road_track","road_minor","road_major_motorway","road_secondary_tertiary","road_trunk_primary","railway-transit","railway-transit-hatching","railway","railway-hatching","bridge_railway-casing","bridge_path-casing","bridge_track_casing","bridge_minor-casing","bridge_major_motorway-casing","bridge_secondary_tertiary-casing","bridge_trunk_primary-casing","bridge_railway","bridge_path","bridge_track","bridge_minor","bridge_major_motorway","bridge_secondary_tertiary","bridge_trunk_primary"],symbols:["lu_road_major-label","lu_motorway-shield","lu_road-shield"],visible:!0},{label:"Vegetation",fills:["lu_landuse_stadium","lu_landuse_cemetery","lu_landuse_gras","lu_landuse_park","lu_landuse_park-outline","lu_landuse_vineyard","lu_landuse_orchard","lu_landuse_wood","landcover_grass","landcover_wood"],visible:!0},{label:"Electricity",fills:["lu_power_station","lu_power_pylone"],lines:["lu_power_line","lu_power_station-outline"],symbols:["lu_power_station-label","lu_eolienne"],visible:!0},{label:"Contours and Height Points",lines:["lu_contour-100","lu_contour-50","lu_contour-20","lu_contour-10","lu_contour"],symbols:["lu_contour-label-100","lu_contour-label-20","lu_apex-label"],visible:!0},{label:"Hillshade",hillshades:["lu_hillshade"],visible:!0}]},http_bg_server:"wmts{1-2}",https_bg_server:"wmts{3-4}",bg_wmts_server_path:"mapproxy_4_v3/wmts/{Layer}",bg_wmts_tile_template:"{TileMatrixSet}/{TileMatrix}/{TileCol}/{TileRow}",bg_layer_projection:"EPSG:3857",olcs_extent:[5.31,49.38,6.64,50.21],olcs_extent_projection:"EPSG:3857",bg_layer_resolutions:[156543.033928,78271.516964,39135.758482,19567.879241,9783.9396205,4891.96981025,2445.98490513,1222.99245256,611.496226281,305.748113141,152.87405657,76.4370282852,38.2185141426,19.1092570713,9.55462853565,4.77731426782,2.38865713391,1.19432856696,.597164283478,.298582141739,.1492910708695,.07464553543475],bg_matrix_ids:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21"]}),DC={name:"blank",id:0};var Zh=(n=>(n.WMS="WMS",n.WFS="WFS",n.WMTS="WMTS",n.BG_WMTS="BG WMTS",n.BG_MVT="BG MVT",n["3D"]="3D",n.TILE_WMS="tileWMS",n))(Zh||{});function iA(){const n=oi(),{myMapId:e}=xt(n),t=Sl(),i=Wi(),r=sa(),o=At(()=>{if(!e.value){const m=Vr().theme?.name;if(m)return Bh().bg_layer_theme_defaults[m]||u()}return u()});function s(m,y){const x=y?t.findBgLayerByName(y)??null:m?t.findBgLayerById(m)??null:null;l(x)}function l(m){if(m){if(m.type===Zh.WMTS||m.type===Zh.BG_WMTS)m.type="BG WMTS";else throw new Error(`Only WMTS and MVT BG layers are currently implemented (not ${m.type} for ${m.name})`);r.handleExclusionLayers(m),i.setBgLayer(r.initLayer(m))}else i.setBgLayer(null)}function u(){return d().find(m=>m.is_default)?.id||DC.id}function h(){return DC.id}function d(){return Bh().bg_layers}return{setBgLayer:s,setMapBackground:l,getBgLayersFromConfig:d,getNullId:h,getDefaultSelectedId:u,defaultSelectedBgId:o}}const joe=["aria-checked","aria-label"],$oe={class:"ml-1 hover:underline"},c0=st({__name:"filter-toggle",props:{label:{},checked:{type:Boolean}},emits:["toggle"],setup(n,{emit:e}){const t=e;function i(){t("toggle")}return(r,o)=>(U(),oe("button",{class:"w-full text-left filter-toggle-btn",onClick:i,role:"checkbox","aria-checked":n.checked,"aria-label":n.label,tabindex:"0"},[P("i",{class:Dn(["fa-solid",n.checked?"fa-check-square":"fa-square"])},null,2),P("span",$oe,K(n.label),1)],8,joe))}}),yI={cms:!0,layers:!0,address:!1,parcels:!1,localite:!1,lieudit:!1,commune:!1,flik:!1,hydro:!1,biotopes:!1,extent:!1,activeLayers:!0},fl=Ke(Object.assign({},localStorage.getItem("searchFacets")?JSON.parse(localStorage.getItem("searchFacets")):yI)),Joe={address:"Adresses",parcels:"Parcelles cadastrales",localite:"Localits",lieudit:"Lieux-dits",commune:"Communes",flik:"lments agricoles",hydro:"Hydrographie",biotopes:"Biotopes"},P5={address:["Adresse","nom_de_rue"],parcels:["Parcelle"],localite:["Localit"],lieudit:["lieu_dit"],commune:["Commune"],flik:["FLIK","asta esp","FLIK_Provisoire"],hydro:["hydro","hydro_km"],biotopes:["biotope"]},qoe={class:"filter-panel bg-secondary text-tertiary"},Qoe={class:"flex"},eae=st({__name:"filter-panel",emits:["close"],setup(n,{expose:e,emit:t}){const i=Object.keys(yI).length,{t:r}=Ct(),o=t;function s(y){fl.value[y]=!fl.value[y]}function l(){localStorage.setItem("searchFacets",JSON.stringify(fl.value)),o("close")}function u(){fl.value=Object.assign({},yI)}const h=Ke(null);function d(y){const x=document.querySelectorAll(".filter-toggle-btn")[y];x&&x.focus()}function m(y){if(y.stopPropagation(),h.value===null&&(h.value=-1),y.key==="Tab"&&y.shiftKey&&h.value<=0){h.value=-1;return}if(y.key==="Tab"&&!y.shiftKey&&h.value>=i-1){h.value=-1;return}if(y.key==="ArrowDown"||y.key==="Tab"&&!y.shiftKey)y.preventDefault(),h.value<i-1&&(h.value++,d(h.value));else if(y.key==="ArrowUp"||y.key==="Tab"&&y.shiftKey)y.preventDefault(),h.value>0&&(h.value--,d(h.value));else if(y.key==="Enter"||y.key===" "||y.code==="Space"){y.preventDefault();const x=Object.keys(yI);s(x[h.value])}}return e({focusedIndex:h,focusItem:d}),(y,x)=>(U(),oe("div",qoe,[P("h3",null,K(k(r)("Paramtres de recherche")),1),P("button",{class:"close-panel",onClick:x[0]||(x[0]=C=>y.$emit("close"))},""),P("div",{onKeydown:m},[P("h4",null,K(k(r)("Inclure")),1),mt(c0,{label:k(r)("Pages du site"),checked:k(fl).cms,onToggle:x[1]||(x[1]=C=>s("cms"))},null,8,["label","checked"]),mt(c0,{label:k(r)("Couches"),checked:k(fl).layers,onToggle:x[2]||(x[2]=C=>s("layers"))},null,8,["label","checked"]),x[7]||(x[7]=P("hr",{class:"section-divider"},null,-1)),P("h4",null,K(k(r)("Limiter la recherche ")),1),(U(!0),oe(Et,null,yi(k(Joe),(C,w)=>(U(),Mt(c0,{key:w,label:k(r)(C),checked:k(fl)[w],onToggle:S=>s(w)},null,8,["label","checked","onToggle"]))),128)),x[8]||(x[8]=P("hr",{class:"section-divider"},null,-1)),P("h4",null,K(k(r)("tendue")),1),mt(c0,{label:k(r)("Uniquement dans la partie actuellement visible de la carte"),checked:k(fl).extent,onToggle:x[3]||(x[3]=C=>s("extent"))},null,8,["label","checked"]),x[9]||(x[9]=P("hr",{class:"section-divider"},null,-1)),P("h4",null,K(k(r)("Avance")),1),mt(c0,{label:k(r)("Chercher dans les couches actives"),checked:k(fl).activeLayers,onToggle:x[4]||(x[4]=C=>s("activeLayers"))},null,8,["label","checked"]),x[10]||(x[10]=P("hr",{class:"section-divider"},null,-1))],32),P("div",Qoe,[P("button",{class:"lux-btn mr-auto",onClick:x[5]||(x[5]=C=>u())},K(k(r)("Rinitialiser")),1),P("button",{class:"lux-btn ml-auto",onClick:x[6]||(x[6]=C=>l())},K(k(r)("Sauvegarder la recherche")),1)])]))}}),tae=is(eae,[["__scopeId","data-v-7268e4a2"]]),rA=Sa("metadata",()=>{const n=Ei();function e(i){n.value=i}function t(){n.value=void 0}return{metadataLayer:n,setMetadataLayer:e,clearMetadataLayer:t}},{}),nae={class:"search-dropdown"},iae={class:"search-input-wrapper"},rae=["placeholder"],sae={role:"listbox"},oae={key:0,class:"dropdown-title"},aae=["onClick","onKeydown","aria-selected"],lae=["innerHTML"],uae={key:0,class:"search-result-routing"},cae=["onClick"],hae=["onClick","onKeydown"],dae={key:1,class:"loading-indicator"},fae=st({__name:"search-dropdown",setup(n){const{setMetadataLayer:e}=rA(),t=At(()=>Lt.value?"var(--color-tertiary)":"#ffffff"),{findThemeNamesByLayerId:i}=Sl(),{t:r,i18next:o}=Ct(),{maxZoom:s}=xt(Wi()),l=Ke(),u=Ke(""),h=Ke(!1),d=Ke([]),m=Ke(!1),y={Adresse:["addresses"],Parcelle:["parcels","parcels_labels"],Parcelle_go:["parcels_go","parcels_labels_go"],Parcelle_prof:["parcels_prof","parcels_labels"],lieu_dit:["toponymes"],FLIK:["asta_flik_parcels"],FLIK_Provisoire:["asta_flik_parcels_provisoire"],asta_esp:["asta_esp_esp"],nom_de_rue:["roads","roads_labels"]};let x=0;const C=["Addresses","Parcelles","Features","Layers","Website Pages","Background Layers","Coordinates"],w=At(()=>d.value.slice().sort((ie,Ce)=>{const Te=C.indexOf(ie.groupKey),De=C.indexOf(Ce.groupKey);return(Te===-1?999:Te)-(De===-1?999:De)}));function S(ie){const{theme:Ce}=Vr();let Te=ie;ie==="Parcelle"&&typeof Ce=="string"&&["go","prof"].includes(Ce)&&(Te=Te+"_"+Ce);const De=y[Te]||[],{findByName:Ze}=Sl(),Je=sa();De.forEach(function(dt){const ft=Ze(dt);ft!==void 0&&Je.toggleLayer(ft.id,!0,!1,!1)})}function T(ie,Ce){const Te=ie.features.filter(Ze=>Ze.properties.layer_name==="Parcelle"),De=ie.features.filter(Ze=>Ze.properties.layer_name!=="Parcelle");Te.length&&d.value.push({header:r("Parcelles"),groupKey:"Parcelles",selectResult:Ce,results:Te.map(function(Ze){return{label:Ze.properties.label+(Ze.properties.layer_name?` (${r(Ze.properties.layer_name)})`:""),layer_name:Ze.properties.layer_name,entry:Ze,showRoutingButton:!0,showInfoButton:!1}})}),De.length&&d.value.push({header:r("Addresses"),groupKey:"Addresses",selectResult:Ce,results:De.map(function(Ze){return{label:Ze.properties.label+(Ze.properties.layer_name?` (${r(Ze.properties.layer_name)})`:""),layer_name:Ze.properties.layer_name,entry:Ze,showRoutingButton:!0,showInfoButton:!1}})})}function M(ie,Ce){d.value.push({header:r("Features"),groupKey:"Features",selectResult:Ce,results:ie.features.map(function(Te){return{label:Te.properties.label+(Te.properties.layer_name?` (${r(Te.properties.layer_name)})`:""),layer_name:Te.properties.layer_name,entry:Te,showRoutingButton:!1,showInfoButton:!1}})})}function G(ie){const Ce=ie.target;Ce.tagName==="A"&&Ce.hasAttribute("data-theme")&&(ie.preventDefault(),N(Ce.getAttribute("data-theme")))}function N(ie){Vr().setTheme(ie),yn()}function V(ie,Ce){d.value.push({header:r("Layers"),groupKey:"Layers",selectResult:Ce,results:ie.map(function(Te){const De=ge(Te.layer_id);return{label:r(Te.name)+De,layer_id:Te.layer_id,name:Te.name,language:Te.language,showRoutingButton:!1,showInfoButton:!0}})})}function W(ie){const{findAnyLayerById:Ce}=Sl();if(ie.layer_id){const Te=Ce(ie.layer_id);Te&&e(Te)}}function j(ie){}function J(ie,Ce){d.value.push({header:r("Website Pages"),groupKey:"Website Pages",selectResult:Ce,results:ie.map(Te=>({label:r(Te.title),url:Te.url,text:Te.text,language:Te.language,showRoutingButton:!1,showInfoButton:!1}))})}function te(ie){u.value=ie.label,xh.highlightFeatures([ie.entry],!0,s.value,Kn().getOlMap().getView().getProjection().getCode())}function ce(ie){switch(u.value=ie.label,S(ie.layer_name),ie.layer_name){case"Parcelle":xh.highlightFeatures([ie.entry],!0,s.value);break;case"Adresse":xh.highlightFeatures([ie.entry],!0,s.value);break;default:xh.clearFeatures(),xh.fitFeatures([ie.entry],s.value)}yn()}function pe(ie){iA().setBgLayer(ie.layer_id),yn()}function Y(ie){sa().toggleLayer(ie.layer_id,!0,!1,!1),yn()}function he(ie){window.open("https://www.geoportail.lu"+ie.url,"_blank"),yn(),u.value=ie.label}function D(ie){u.value=ie.label,xh.highlightFeatures([ie.entry],!0,s.value),yn()}function re(ie,Ce){d.value.push({header:r("Background Layers"),groupKey:"Background Layers",selectResult:Ce,results:ie.map(Te=>({label:r(Te.name),layer_id:Te.id,name:Te.name,showRoutingButton:!1,showInfoButton:!0}))})}async function le(ie,Ce){return await(await Vs(ie,Ce,"GET")).json()}async function fe(ie,Ce){if(!fl.value.activeLayers)return!1;let Te={query:ie,limit:8,language:o.language},De=Kn().getOlMap().getLayers().getArray().map(Je=>Je.get("queryable_id")).filter(Je=>Je!==void 0);if(Te.layers=De.join(","),fl.value.extent){let Je=Kn().getOlMap().getView().calculateExtent();Te.extent=Je.join(",")}const Ze=await le("https://migration.geoportail.lu/featuresearch",Te);Ce===x&&M(Ze,te)}async function Le(ie,Ce){let Te={query:ie,limit:8},De=Object.keys(P5).filter(Je=>fl.value[Je]).map(Je=>P5[Je]).flat();if(De.length>0&&(Te.layer=De.join(",")),fl.value.extent){let Je=hb(Kn().getOlMap().getView().calculateExtent(),"EPSG:3857","EPSG:4326");Te.extent=Je.join(",")}const Ze=await le("https://migration.geoportail.lu/fulltextsearch",Te);Ce===x&&T(Ze,ce)}async function we(ie,Ce){const De=await le("https://migration.geoportail.lu/layersearch",{query:ie,limit:8});Ce===x&&V(De,Y)}async function se(ie,Ce){const De=await le("https://migration.geoportail.lu/cmssearch",{query:ie,limit:8});Ce===x&&J(De,he)}function Q(ie,Ce){const{bgLayers:Te}=Vr();if(ie.length===0)return;const De=Te.filter(Ze=>r(Ze.name).toLowerCase().includes(ie.toLowerCase()));Ce===x&&re(De,pe)}const q={backgroundsearch:{getData:Q},fulltextsearch:{getData:Le},layersearch:{getData:we},cmssearch:{getData:se},featuresearch:{getData:fe},coordinate:{getData:$e}};function $e(ie,Ce){if(Ce!==x)return;const Te=ie,De=xh.map.getView().getProjection().getCode(),Ze=Koe(Te,De);d.value.push({header:r("Coordinates"),groupKey:"Coordinates",selectResult:D,results:Ze.map(function(Je){return{label:Je.get("label")+" ("+Je.get("epsgLabel")+")",layer_name:"Coordinates",entry:Je,showRoutingButton:!1,showInfoButton:!1}})})}async function Qe(ie,Ce){if(d.value=[],ie.length===0)return qe();m.value=!0,Dt(),await Promise.all(Object.entries(q).map(async([,Te])=>{"getData"in Te&&typeof Te.getData=="function"&&Te.getData(ie,Ce)})),Ce===x&&(m.value=!1,h.value=!0)}kt(u,async ie=>{x++,Qe(ie,x)});function qe(){xh.clearFeatures(),u.value="",d.value=[],yn()}const Lt=Ke(!1);kt(Lt,ie=>{ie&&aa(()=>{l.value&&(l.value.focusedIndex=0,l.value.focusItem(0))})});function Pt(){if(Lt.value){Dt();return}yn(),zt()}function zt(){Lt.value=!0}function Dt(){Lt.value=!1}function yn(){h.value=!1}const tn=Ke(null);function Ne(ie){const Ce=document.querySelectorAll(".dropdown-item")[ie];Ce&&Ce.focus()}function Be(ie){if(ie.stopPropagation(),Lt.value||!d.value.length)return;const Ce=d.value.flatMap(Te=>Te.results);if(tn.value===null&&(tn.value=0),ie.key==="ArrowDown")ie.preventDefault(),tn.value<Ce.length-1&&(tn.value++,Ne(tn.value));else if(ie.key==="ArrowUp")ie.preventDefault(),tn.value>0&&(tn.value--,Ne(tn.value));else if(ie.key==="Enter"||ie.key===" "||ie.code==="Space"){ie.preventDefault();let Te=tn.value;for(const De of d.value){if(Te<De.results.length){De.selectResult(De.results[Te]);break}Te-=De.results.length}}}function z(ie,Ce){let Te=0;for(let De=0;De<ie;De++)Te+=d.value[De].results.length;return Te+=Ce,tn.value===Te}const We=Ke(null);function ke(ie){(ie.key==="ArrowDown"||ie.key==="ArrowUp")&&h.value&&d.value.length&&(ie.preventDefault(),h.value&&(tn.value=0,aa(()=>{We.value?.focus()})))}function ge(ie){const Ce=i(ie),{themeName:Te}=xt(Vr());return Ce.map(De=>Te.value!==De?`<br><a href="#" data-theme="${De}">(${r("open in theme")} ${r(De)})</a>`:"").join("")}return(ie,Ce)=>(U(),oe("div",nae,[P("div",iae,[Sn(P("input",{type:"text",placeholder:k(r)("Recherche adresse, parcelles, couches ..."),"onUpdate:modelValue":Ce[0]||(Ce[0]=Te=>u.value=Te),class:"w-full lux-input search-input",onKeydown:ke},null,40,rae),[[Zr,u.value]]),u.value.length?(U(),oe("button",{key:0,onClick:qe,class:"clear-button"},"  ")):Ge("",!0),P("button",{class:"filter-button",onClick:Pt},[P("span",{class:"filter-icon",style:Dc({color:t.value})},null,4)])]),h.value&&d.value.some(Te=>Te.results.length>0)?(U(),oe("div",{key:0,class:"dropdown",onKeydown:Be,onClick:G,tabindex:"0",ref_key:"dropdownRef",ref:We},[P("ul",sae,[(U(!0),oe(Et,null,yi(w.value,(Te,De)=>(U(),oe("li",{key:De},[Te.results.length>0?(U(),oe("div",oae,K(k(r)(Te.header)),1)):Ge("",!0),P("ul",null,[(U(!0),oe(Et,null,yi(Te.results,(Ze,Je)=>(U(),oe("li",{key:Je,onClick:dt=>Te.selectResult(Ze),class:Dn(["dropdown-item",{focused:z(De,Je)}]),tabindex:"0",onKeydown:Js(dt=>Te.selectResult(Ze),["enter"]),role:"option","aria-selected":z(De,Je)},[P("span",{innerHTML:Ze.label},null,8,lae),Ze.showRoutingButton?(U(),oe("span",uae,[P("button",{class:"lux-btn-primary routing-button",onClick:fs(dt=>void 0,["stop"])},[...Ce[1]||(Ce[1]=[P("span",{class:"routing-icon"},null,-1)])],8,cae)])):Ge("",!0),Ze.showInfoButton?(U(),oe("button",{key:1,class:"search-result-info self-start before:text-[.85rem] before:transform before:translate-y-[.1rem] before:inline-block before:content-['\\f129'] fa-solid fa-fw fa-fh fa-info",onClick:[dt=>W(Ze),fs(dt=>W(Ze),["stop"])],onKeydown:[Js(fs(dt=>W(Ze),["stop"]),["enter"]),Js(fs(dt=>W(Ze),["stop","prevent"]),["space"])]},null,40,hae)):Ge("",!0)],42,aae))),128))])]))),128))])],544)):Ge("",!0),m.value?(U(),oe("div",dae,K(k(r)("Loading...")),1)):Ge("",!0),Lt.value?(U(),Mt(tae,{key:2,ref_key:"filterPanelRef",ref:l,onClose:Dt},null,512)):Ge("",!0)]))}}),G5=is(fae,[["__scopeId","data-v-a0ea9508"]]),pae={class:"w-full h-14 flex bg-white shadow-header z-10 shrink-0"},gae={class:"grow flex justify-center items-center"},mae={class:"h-full flex"},yae={class:"hidden md:flex"},_ae={class:"hidden lg:inline-block"},vae={class:"block md:hidden"},bae={class:"border-l-[1px] border-stone-300 h-full"},xae={class:"border-l-[1px] border-stone-300 h-full"},Iae=st({__name:"header-bar",setup(n){const{t:e}=Ct(),t=oi(),{toggleAuthFormOpen:i,toggleThemeGrid:r}=t,{authFormOpened:o}=xt(t),{themeName:s}=xt(Vr()),{authenticated:l}=xt(Du()),u=Ke(!1),h=Ke(!1);kt(l,y=>y&&i(!1));function d(y){u.value=y,y&&i(!1)}function m(y){i(y),y&&(u.value=!1)}return(y,x)=>(U(),oe("header",pae,[x[2]||(x[2]=P("div",{class:"flex-2 p-[5px]"},[P("img",{src:D4})],-1)),P("div",gae,[mt(G5,{class:"hidden md:block"}),h.value?(U(),Mt(G5,{key:0,class:"block md:hidden"})):Ge("",!0)]),P("div",null,[P("ul",mae,[P("li",yae,[P("button",{class:Dn(["flex items-center before:font-icons before:text-3xl before:w-16 text-primary uppercase h-full mr-3",`before:content-${k(s)}`]),"data-cy":"selectedThemeIcon",onClick:x[0]||(x[0]=(...C)=>k(r)&&k(r)(...C))},[P("span",_ae,K(k(e)(`${k(s)}`)),1)],2)]),P("li",vae,[P("button",{class:"lux-btn lux-dropdown-btn h-full",onClick:x[1]||(x[1]=C=>h.value=!h.value)},[P("span",{class:Dn(["before:font-icons before:text-3xl after:font-icons after:text-3xl",[{"lux-navbar-search-dropdown":!h.value},{"lux-navbar-search-close":h.value}]])},null,2)])]),P("li",bae,[mt(Kse,{"data-cy":"langSelect",class:"flex-none h-full",isOpen:u.value,onToggleDropdown:d},null,8,["isOpen"])]),P("li",xae,[mt(V4,{"data-cy":"authFormIcon",class:"lux-navbar-dropdown lux-navbar-dropdown-auth h-full",enableClickOutside:!1,isOpen:k(o),onToggleDropdown:m},{default:Xt(()=>[mt(Aee,{class:"w-80"})]),_:1},8,["isOpen"])])])])]))}}),Cae={class:"w-full h-14 flex items-center justify-center bg-orange-600 shadow-header z-10 shrink-0",role:"alert","aria-live":"polite"},wae={class:"flex items-center gap-3 px-4"},Aae={class:"text-white"},Sae={class:"font-semibold text-base","data-cy":"offlineHeaderMessage"},Eae={class:"text-xs opacity-90 hidden sm:block"},Tae=st({__name:"header-bar-offline",setup(n){const{t:e}=Ct();return(t,i)=>(U(),oe("header",Cae,[P("div",wae,[i[0]||(i[0]=P("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},[P("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3"})],-1)),P("div",Aae,[P("p",Sae,K(k(e)("You are currently disconnected")),1),P("p",Eae,K(k(e)("Features requiring network connection are temporarily hidden")),1)]),i[1]||(i[1]=P("div",{class:"ml-auto hidden md:block opacity-80"},[P("img",{src:D4,alt:"Luxembourg Government",class:"h-8 brightness-0 invert"})],-1))])]))}}),Rae=is(Tae,[["__scopeId","data-v-01f0cfe8"]]),Rl="https://migration.geoportail.lu/mymaps";async function Mae(){const n=await Vs(Rl+"/maps",{});if(!n.ok)throw new Error("Error while trying to get My Maps");return await n.json()}async function kae(n){const e=await Vs(Rl+"/map/"+n,{});if(!e.ok)throw new Error("Error while trying to get My Map info");return await e.json()}async function Lae(){const n=await Vs(Rl+"/categories",{});if(!n.ok)throw new Error("Error while trying to get categories");return await n.json()}async function Pae(n,e,t,i){const r={title:n,description:e,category_id:t,public:i},o=await Vs(Rl+"/create",r,"POST");if(!o.ok)throw new Error("Error while trying to create My Map");return await o.json()}async function Gae(n,e,t,i,r){const o={title:e,description:t,category_id:i,public:r,dirty:!0},s=await Vs(Rl+"/update/"+n,o,"PUT");if(!s.ok)throw new Error("Error while trying to update My Map");return await s.json()}async function WB(n,e,t,i,r,o,s,l){const u={bgLayer:e,bgOpacity:t,layers:i,layers_opacity:r,layers_visibility:o,layers_indices:s,theme:l},h=await Vs(Rl+"/update/"+n,u,"PUT");if(!h.ok)throw new Error("Error while trying to update My Map");return await h.json()}async function Fae(n,e,t,i,r){const o={title:e,description:t,category_id:i,public:r},s=await Vs(Rl+"/copy/"+n,o,"POST");if(!s.ok)throw new Error("Error while trying to copy My Map");return await s.json()}async function Oae(n){const e=await Vs(Rl+"/delete/"+n,{},"DELETE");if(!e.ok)throw new Error("Error while trying to delete My Map");return(await e.json()).success}async function Nae(n){const e=await Vs(Rl+"/delete_all_features/"+n,{},"DELETE");if(!e.ok)throw new Error("Error while trying to clear My Map");return(await e.json()).success}async function ST(n,e){const t={feature:e},i=await Vs(Rl+"/save_feature/"+n,t,"POST");if(!i.ok)throw new Error("Error while trying to save feature to My Map");return await i.json()}async function Dae(n,e){const t={orders:JSON.stringify(e)},i=await Vs(Rl+"/save_order/"+n,t,"POST");if(!i.ok)throw new Error("Error while trying to save features order to My Map");return await i.json()}async function zB(n){const e=await Vs(Rl+"/delete_feature/"+n,{},"DELETE");if(!e.ok)throw new Error("Error while trying to delete feature to My Map");return await e.json()}async function Vae(n){const e=await Vs(Rl+"/features/"+n,{});if(!e.ok)throw new Error("Error while trying to fetch My Map features");return await e.json()}const Jr=Sa("draw",()=>{const{t:n}=Ct(),{addNotification:e}=ns(),t=Ke(void 0),i=Ke(void 0),r=Ke(void 0),o=Ke(void 0),s=Ke([]),l=At(()=>s.value.filter(q=>!q.map_id)),u=At(()=>s.value.filter(q=>q.map_id)),h=At(()=>i.value?s.value.find(q=>q.id===i.value):void 0),d=Ke(!1),m=Ke(void 0),y=Ke(!1),x=Ke(!1),C=Ei([]),w=Ke(!1);function S(){V("drawPoint")}function T(){V("drawLabel")}function M(){V("drawLine")}function G(){V("drawPolygon")}function N(){V("drawCircle")}function V(q){const $e=o.value?.replace("edit","").replace("Continue",""),Qe=q?.replace("draw","").replace("Continue","");$e===Qe?(r.value=void 0,o.value=void 0,i.value=void 0):r.value===q?r.value=void 0:W(q)}function W(q){q&&(o.value=void 0,i.value=void 0),r.value=q}function j(q){q?r.value=void 0:i.value=void 0,o.value=q}function J(){r.value=void 0,i.value=void 0,o.value=void 0}function te(){W("drawLineContinue")}async function ce(q){if(C.value=[q],s.value=[...s.value,q],q.map_id!==void 0){const $e=await ST(q.map_id,q.toGeoJSONString()).catch(Qe=>e(n("Erreur inattendue lors de la sauvegarde de votre modification."),mi.ERROR));q.id=$e.id,q.fid=$e.id}}function pe(q){t.value=q.id,i.value=q.id,o.value=q.featureType.replace("drawn","edit").replace("Continue",""),r.value=void 0}function Y(q){const $e=s.value.findIndex(Qe=>Qe.id===q.id);$e!==-1&&(s.value[$e]=q),s.value=[...s.value],q.map_id!==void 0&&ST(q.map_id,q.toGeoJSONString())}function he(q){s.value=q}function D(q,$e=!0){const Qe=Array.isArray(q)?q:[q];$e&&Qe.forEach(qe=>{const Lt=s.value.find(Pt=>Pt.id===qe);Lt&&Lt.map_id&&$e&&zB(Lt.id).catch(Pt=>e(n("Erreur inattendue lors de la sauvegarde de votre modification."),mi.ERROR))}),s.value=s.value.filter(qe=>!Qe.includes(qe.id)),(Qe.includes(t.value)||Qe.includes(i.value))&&(t.value=void 0,i.value=void 0)}function re(q){t.value=void 0,i.value=void 0;const $e=s.value.filter(Qe=>Qe.map_id===q).map(Qe=>Qe.id);return D($e,!1)}function le(){t.value=void 0,i.value=void 0,s.value=s.value.filter(q=>q.map_id)}function fe(q){s.value=s.value.map(Qe=>Object.assign(Qe,{display_order:q.indexOf(`f-${Qe.id}`)}));const $e=s.value.filter(Qe=>Qe.map_id);if($e.length>0){const Qe=$e[0].map_id,qe=$e.map(Lt=>({fid:Lt.id,display_order:Lt.display_order}));Dae(Qe,qe)}}function Le(q){return s.value.filter($e=>$e.getGeometry()&&q.includes($e.getGeometry()?.getType()))}function we(q){return s.value.filter($e=>q.includes($e.id))}function se(q){w.value=q??!w.value}function Q(q){y.value=q??!y.value}return{activeFeatureId:t,editingFeatureId:i,drawStateActive:r,editStateActive:o,drawnFeatures:s,drawnFeaturesExceptMyMaps:l,drawnFeaturesMyMaps:u,editingFeature:h,featureEditionDocked:d,currentDrawInteraction:m,clipLineActive:y,followRoads:x,queueAddedDrawnFeatures:C,showModalMergeLines:w,deactivateDraw:J,removeFeature:D,removeMyMapsFeature:re,removeAllFeatures:le,reorderFeatures:fe,toggleDrawCircle:N,toggleDrawLabel:T,toggleDrawLine:M,toggleDrawPolygon:G,toggleDrawPoint:S,toggleDrawActiveState:V,setDrawActiveState:W,setEditActiveState:j,activateDrawLineContinue:te,addDrawnFeatureToCollection:ce,selectDrawnFeature:pe,updateDrawnFeature:Y,setDrawnFeatures:he,getDrawnFeaturesOfTypes:Le,getDrawnFeaturesWithIds:we,toggleDrawMergeLinesModal:se,toggleDrawCutLineMode:Q}}),tg=Sa("featureInfo",()=>{const n=Ei(),e=Ei(),t=Ei(!1),i=Ei(!1);function r(h){!h||h.length===0?n.value=void 0:(n.value=[...h],t.value=!1)}function o(){n.value=void 0,t.value=!1}function s(h){e.value=h}function l(h){t.value=h}function u(h){i.value=h}return{featureInfoPanelContent:n,fid:e,isLoading:t,displayStarOnMobile:i,setFeatureInfoPanelContent:r,clearContent:o,setFid:s,setLoading:l,setDisplayStarOnMobile:u}},{}),Bae=["aria-label","aria-pressed"],Zae={class:"block text-[13px] sm:text-base uppercase"},vh=st({__name:"button-icon",props:{label:{},icon:{},active:{type:Boolean},ariaLabel:{}},setup(n){const e=n;return(t,i)=>(U(),oe("button",{class:Dn(["h-[42px] w-full sm:h-full sm:w-16 hover:text-white hover:bg-primary",e.active?"bg-primary text-white":""]),"aria-label":e.ariaLabel||e.label,"aria-pressed":e.active!==void 0?e.active:void 0},[P("span",{class:Dn(["block text-[1.7rem] sm:text-[2rem] -mt-1.5 -mb-3 after:font-icons",e.active?"lux-close-cross":`after:content-${e.icon}`]),"aria-hidden":"true"},null,2),P("span",Zae,K(e.label),1)],10,Bae))}}),Wae=["href"],mp=st({__name:"button-link",props:{label:{},link:{}},setup(n){const e=n;return(t,i)=>(U(),oe("a",{class:"h-full flex flex-col justify-center px-[7px] uppercase hover:text-white hover:bg-primary",href:`${e.link}`,target:"_blank"},K(t.$props.label),9,Wae))}});function ef(n,e){const t=n.length;return e<0?n[e+t]:e>=t?n[e-t]:n[e]}function Um(n,e){const t=n.length;let i=Math.floor(e);const r=e-i;i>=t?i-=t:i<0&&(i+=t);let o=i+1;o>=t&&(o-=t);const s=n[i],l=s[0],u=s[1],h=n[o],d=h[0]-l,m=h[1]-u;return[l+d*r,u+m*r]}const Sx={index:-1,endIndex:NaN,closestTargetDistance:1/0};function UB(n,e,t,i){const r=n[0],o=n[1];let s=1/0,l=-1,u=NaN;for(let m=0;m<e.targets.length;++m){const y=e.targets[m],x=y.coordinates;let C=1/0,w;for(let S=0;S<x.length-1;++S){const T=x[S],M=x[S+1],G=HB(r,o,T,M);G.squaredDistance<C&&(C=G.squaredDistance,w=S+G.along)}C<s&&(s=C,y.ring&&e.targetIndex===m&&(y.endIndex>y.startIndex?w<y.startIndex&&(w+=x.length):y.endIndex<y.startIndex&&w>y.startIndex&&(w-=x.length)),u=w,l=m)}const h=e.targets[l];let d=h.ring;if(e.targetIndex===l&&d){const m=Um(h.coordinates,u),y=t.getPixelFromCoordinate(m),x=t.getPixelFromCoordinate(e.startCoord);Nm(y,x)>i&&(d=!1)}if(d){const m=h.coordinates,y=m.length,x=h.startIndex,C=u;if(x<C){const w=Rx(m,x,C);Rx(m,x,C-y)<w&&(u-=y)}else{const w=Rx(m,x,C);Rx(m,x,C+y)<w&&(u+=y)}}return Sx.index=l,Sx.endIndex=u,Sx.closestTargetDistance=s,Sx}function XB(n,e){const t=[];for(let i=0;i<e.length;++i){const o=e[i].getGeometry();YB(n,o,t)}return t}function YB(n,e,t){if(e instanceof $i){Ex(n,e.getCoordinates(),!1,t);return}if(e instanceof Nu){const i=e.getCoordinates();for(let r=0,o=i.length;r<o;++r)Ex(n,i[r],!1,t);return}if(e instanceof Fo){const i=e.getCoordinates();for(let r=0,o=i.length;r<o;++r)Ex(n,i[r],!0,t);return}if(e instanceof vf){const i=e.getCoordinates();for(let r=0,o=i.length;r<o;++r){const s=i[r];for(let l=0,u=s.length;l<u;++l)Ex(n,s[l],!0,t)}return}if(e instanceof $l){const i=e.getGeometries();for(let r=0;r<i.length;++r)YB(n,i[r],t);return}}function Ex(n,e,t,i){const r=n[0],o=n[1];for(let s=0,l=e.length-1;s<l;++s){const u=e[s],h=e[s+1],d=HB(r,o,u,h);if(d.squaredDistance===0){const m=s+d.along;i.push({coordinates:e,ring:t,startIndex:m,endIndex:m});return}}}function Tx(n,e){return Ph(n[0],n[1],e[0],e[1])}function Rx(n,e,t){let i,r;e<t?(i=e,r=t):(i=t,r=e);const o=Math.ceil(i),s=Math.floor(r);if(o>s){const u=Um(n,i),h=Um(n,r);return Tx(u,h)}let l=0;if(i<o){const u=Um(n,i),h=ef(n,o);l+=Tx(u,h)}if(s<r){const u=ef(n,s),h=Um(n,r);l+=Tx(u,h)}for(let u=o;u<s-1;++u){const h=ef(n,u),d=ef(n,u+1);l+=Tx(h,d)}return l}const CS={along:0,squaredDistance:0};function HB(n,e,t,i){const r=t[0],o=t[1],s=i[0],l=i[1],u=s-r,h=l-o;let d=0,m=r,y=o;return(u!==0||h!==0)&&(d=Br(((n-r)*u+(e-o)*h)/(u*u+h*h),0,1),m+=u*d,y+=h*d),CS.along=d,CS.squaredDistance=Oy(Ph(n,e,m,y),10),CS}const Mx={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class kx extends la{constructor(e,t){super(e),this.feature=t}}class Ky extends Bc{constructor(e){const t=e;t.stopDown||(t.stopDown=Dy),super(t),this.on,this.once,this.un,this.options_=e,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=Uae(this.type_),this.stopClick_=!!e.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Iy,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const r=this.mode_;if(r==="Circle")i=(o,s,l)=>{const u=s||new _f([NaN,NaN]),h=ds(o[0]),d=Fh(h,ds(o[o.length-1]));return u.setCenterAndRadius(h,Math.sqrt(d),this.geometryLayout_),u};else{let o;r==="Point"?o=Mr:r==="LineString"?o=$i:r==="Polygon"&&(o=Fo),i=(s,l,u)=>(l?r==="Polygon"?s[0].length?l.setCoordinates([s[0].concat([s[0][0]])],this.geometryLayout_):l.setCoordinates([],this.geometryLayout_):l.setCoordinates(s,this.geometryLayout_):l=new o(s,this.geometryLayout_),l)}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new bo({source:new ua({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:zae(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:zw,this.freehandCondition_,e.freehand?this.freehandCondition_=ny:this.freehandCondition_=e.freehandCondition?e.freehandCondition:zE,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(ZE.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=ny:t=e:t=DD,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}setFreehand(e){this.freehand_=e,this.freehand_?this.freehandCondition_=ny:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:zE}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(e){e.originalEvent.type===$n.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===Bi.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===Bi.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===Bi.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===Bi.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===Bi.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===Bi.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===Bi.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new pc(Bi.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),r=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),o=Ks([i,r]),s=this.traceSource_.getFeaturesInExtent(o);if(s.length===0)return;const l=XB(e.coordinate,s);l.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:l,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,r=e.startIndex<=t;i===r?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const r=Math.ceil(e);let o=Math.floor(t);o===t&&(o-=1),i=o-r+1}else{const r=Math.floor(e);let o=Math.ceil(t);o===t&&(o+=1),i=r-o+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const r=[];if(t<i){const o=Math.ceil(t);let s=Math.floor(i);s===i&&(s-=1);for(let l=o;l<=s;++l)r.push(ef(e.coordinates,l))}else{const o=Math.floor(t);let s=Math.ceil(i);s===i&&(s+=1);for(let l=o;l>=s;--l)r.push(ef(e.coordinates,l))}r.length&&this.appendCoordinates(r)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const l=e.map.getPixelFromCoordinate(t.startCoord);if(Nm(l,e.pixel)<this.snapTolerance_)return}const i=UB(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const u=t.targets[t.targetIndex];this.removeTracedCoordinates_(u.startIndex,u.endIndex)}const l=t.targets[i.index];this.addTracedCoordinates_(l,l.startIndex,i.endIndex)}else{const l=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(l,i.endIndex)}t.targetIndex=i.index;const r=t.targets[t.targetIndex];r.endIndex=i.endIndex;const o=Um(r.coordinates,r.endIndex),s=this.getMap().getPixelFromCoordinate(o);e.coordinate=o,e.pixel=[Math.round(s[0]),Math.round(s[1])]}handleDragEvent(e){this.ignoreNextUpEvent_=!0,super.handleDragEvent(e)}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(e),this.shouldHandle_){const r=!this.finishCoordinate_;r&&this.startDrawing_(e.coordinate),!r&&this.freehand_?this.finishDrawing():!this.freehand_&&(!r||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,r=t[0]-i[0],o=t[1]-i[1],s=r*r+o*o;if(this.shouldHandle_=this.freehand_?s>this.squaredClickTolerance_:s<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let r=!1,o=[this.finishCoordinate_];const s=this.mode_;if(s==="Point")i=!0;else if(s==="Circle")i=this.sketchCoords_.length===2;else if(s==="LineString")r=!t&&this.sketchCoords_.length>this.minPoints_;else if(s==="Polygon"){const l=this.sketchCoords_;r=l[0].length>this.minPoints_,o=[l[0][0],l[0][l[0].length-2]],t?o=[l[0][0]]:o=[l[0][0],l[0][l[0].length-2]]}if(r){const l=this.getMap();for(let u=0,h=o.length;u<h;u++){const d=o[u],m=l.getPixelFromCoordinate(d),y=e[0]-m[0],x=e[1]-m[1],C=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(y*y+x*x)<=C,i){this.finishCoordinate_=d;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Zi(new Mr(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Zi);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new $i(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=rC(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Zi(new $i(this.sketchLineCoords_)));const r=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Zi,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new kx(Mx.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),r=t.getView().getProjection(),o=rC(this.geometryLayout_);let s,l;for(;e.length<o;)e.push(0);this.mode_==="Point"?l=this.sketchCoords_:this.mode_==="Polygon"?(s=this.sketchCoords_[0],l=s[s.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(s=this.sketchCoords_,l=s[s.length-1]),l[0]=e[0],l[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,r),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let r,o;const s=this.mode_;return s==="LineString"||s==="Circle"?(this.finishCoordinate_=e.slice(),o=this.sketchCoords_,o.length>=this.maxPoints_&&(this.freehand_?o.pop():r=!0),o.push(e.slice()),this.geometryFunction_(o,t,i)):s==="Polygon"&&(o=this.sketchCoords_[0],o.length>=this.maxPoints_&&(this.freehand_?o.pop():r=!0),o.push(e.slice()),r&&(this.finishCoordinate_=o[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),r?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),r=this.mode_;for(let o=0;o<e;++o){let s;if(r==="LineString"||r==="Circle"){if(s=this.sketchCoords_,s.splice(-2,1),s.length>=2){this.finishCoordinate_=s[s.length-2].slice();const l=this.finishCoordinate_.slice();s[s.length-1]=l,this.createOrUpdateSketchPoint_(l)}this.geometryFunction_(s,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(r==="Polygon"){s=this.sketchCoords_[0],s.splice(-2,1);const l=this.sketchLine_.getGeometry();if(s.length>=2){const u=s[s.length-2].slice();s[s.length-1]=u,this.createOrUpdateSketchPoint_(u)}l.setCoordinates(s),this.geometryFunction_(this.sketchCoords_,t,i)}if(s.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const i=e.getGeometry(),r=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,r)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,r),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new Jh([t])):this.type_==="MultiLineString"?e.setGeometry(new Nu([t])):this.type_==="MultiPolygon"&&e.setGeometry(new vf([t])),this.dispatchEvent(new kx(Mx.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new kx(Mx.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let r;if(t==="LineString"||t==="Circle")r=this.sketchCoords_;else if(t==="Polygon")r=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&r.shift(),r.pop();for(let s=0;s<e.length;s++)this.addToDrawing_(e[s]);const o=e[e.length-1];this.sketchFeature_=this.addToDrawing_(o),this.modifyDrawing_(o)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.sketchPoint_=new Zi(new Mr(r)),this.updateSketchFeatures_(),this.dispatchEvent(new kx(Mx.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function zae(){const n=t4();return function(e,t){return n[e.getGeometry().getType()]}}function Uae(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const F5=0,tv=1,O5=[0,0,0,0],cy=[],wS={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function AS(n,e,t){let i;switch(e){case"LineString":i=n;break;case"MultiLineString":case"Polygon":i=n[t[0]];break;case"MultiPolygon":i=n[t[1]][t[0]];break}return i}class _I extends la{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class Xae extends Bc{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:ZD,this.defaultDeleteCondition_=function(i){return FH(i)&&VD(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:ny,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new NC,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new bo({source:new ua({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Hae(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new na(this.source_.getFeatures()),this.source_.addEventListener(Ba.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Ba.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Jo.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Jo.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;e?e===!0?t=ny:t=e:t=DD,this.traceCondition_=t}addFeature_(e){const t=e.getGeometry();if(t){const r=this.SEGMENT_WRITERS_[t.getType()];r&&r(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener($n.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new na;const i=this.featuresBeingModified_.getArray();for(let r=0,o=t.length;r<o;++r){const s=t[r].feature;s&&!i.includes(s)&&this.featuresBeingModified_.push(s)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new _I(wS.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener($n.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(r){e===r.feature&&i.push(r)});for(let r=i.length-1;r>=0;--r){const o=i[r];for(let s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===o&&this.dragSegments_.splice(s,1);t.remove(o)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),r={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),r)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let r=0,o=i.length;r<o;++r){const s=i[r],l={feature:e,geometry:t,depth:[r],index:r,segment:[s,s]};this.rBush_.insert(t.getExtent(),l)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,o=i.length-1;r<o;++r){const s=i.slice(r,r+2),l={feature:e,geometry:t,index:r,segment:s};this.rBush_.insert(Ks(s),l)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,o=i.length;r<o;++r){const s=i[r];for(let l=0,u=s.length-1;l<u;++l){const h=s.slice(l,l+2),d={feature:e,geometry:t,depth:[r],index:l,segment:h};this.rBush_.insert(Ks(h),d)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,o=i.length;r<o;++r){const s=i[r];for(let l=0,u=s.length-1;l<u;++l){const h=s.slice(l,l+2),d={feature:e,geometry:t,depth:[r],index:l,segment:h};this.rBush_.insert(Ks(h),d)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,o=i.length;r<o;++r){const s=i[r];for(let l=0,u=s.length;l<u;++l){const h=s[l];for(let d=0,m=h.length-1;d<m;++d){const y=h.slice(d,d+2),x={feature:e,geometry:t,depth:[l,r],index:d,segment:y};this.rBush_.insert(Ks(y),x)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),r={feature:e,geometry:t,index:F5,segment:[i,i]},o={feature:e,geometry:t,index:tv,segment:[i,i]},s=[r,o];r.featureSegments=s,o.featureSegments=s,this.rBush_.insert(ey(i),r);let l=t;this.rBush_.insert(l.getExtent(),o)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let r=0;r<i.length;++r){const o=i[r],s=this.SEGMENT_WRITERS_[o.getType()];s(e,o)}}createOrUpdateVertexFeature_(e,t,i,r){let o=this.vertexFeature_;return o?o.getGeometry().setCoordinates(e):(o=new Zi(new Mr(e)),this.vertexFeature_=o,this.overlay_.getSource().addFeature(o)),o.set("features",t),o.set("geometries",i),o.set("existing",r),o}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==Bi.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Bi.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==Bi.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;this.getMap().getView().getProjection();const i=[],r=this.vertexFeature_.getGeometry().getCoordinates(),o=Ks([r]),s=this.rBush_.getInExtent(o),l={};s.sort(Yae);for(let u=0,h=s.length;u<h;++u){const d=s[u],m=d.segment;let y=ti(d.geometry);const x=d.depth;if(x&&(y+="-"+x.join("-")),l[y]||(l[y]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===tv){const C=D5(e,d);Yo(C,r)&&!l[y][0]&&(this.dragSegments_.push([d,0]),l[y][0]=d);continue}if(Yo(m[0],r)&&!l[y][0]){this.dragSegments_.push([d,0]),l[y][0]=d;continue}if(Yo(m[1],r)&&!l[y][1]){if(l[y][0]&&l[y][0].index===0){let C=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":C=C[x[1]];case"Polygon":if(d.index!==C[x[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),l[y][1]=d;continue}ti(m)in this.vertexSegments_&&!l[y][0]&&!l[y][1]&&i.push(d)}return i}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const o=e.map.getPixelFromCoordinate(t.startCoord);if(Nm(o,e.pixel)<this.pixelTolerance_)return}const i=UB(e.coordinate,t,e.map,this.pixelTolerance_);if(t.targetIndex===-1&&Math.sqrt(i.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)return;if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const s=t.targets[t.targetIndex];this.removeTracedCoordinates_(s.startIndex,s.endIndex)}else for(const s of this.traceSegments_){const l=s[0],u=l.geometry,h=s[1],d=u.getCoordinates();AS(d,u.getType(),l.depth).splice(l.index+h,1),u.setCoordinates(d),h===0&&(l.index-=1)}const o=t.targets[i.index];this.addTracedCoordinates_(o,o.startIndex,i.endIndex)}else{const o=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(o,i.endIndex)}t.targetIndex=i.index;const r=t.targets[t.targetIndex];r.endIndex=i.endIndex}getTraceCandidates_(e){const t=this.getMap(),i=this.pixelTolerance_,r=t.getCoordinateFromPixel([e.pixel[0]-i,e.pixel[1]+i]),o=t.getCoordinateFromPixel([e.pixel[0]+i,e.pixel[1]-i]),s=Ks([r,o]);return this.traceSource_.getFeaturesInExtent(s)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}const t=this.getTraceCandidates_(e);if(t.length===0)return;const i=XB(e.coordinate,t);i.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:i,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,r=e.startIndex<=t;i===r?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const r=Math.ceil(e);let o=Math.floor(t);o===t&&(o-=1),i=o-r+1}else{const r=Math.floor(e);let o=Math.ceil(t);o===t&&(o+=1),i=r-o+1}if(i>0)for(const r of this.traceSegments_){const o=r[0],s=o.geometry,l=r[1];let u=r[0].index+1;l===1&&(u-=i);const h=s.getCoordinates();AS(h,s.getType(),o.depth).splice(u,i),s.setCoordinates(h),l===1&&(o.index-=i)}}addTracedCoordinates_(e,t,i){if(t===i)return;const r=[];if(t<i){const o=Math.ceil(t);let s=Math.floor(i);s===i&&(s-=1);for(let l=o;l<=s;++l)r.push(ef(e.coordinates,l))}else{const o=Math.floor(t);let s=Math.ceil(i);s===i&&(s+=1);for(let l=o;l>=s;--l)r.push(ef(e.coordinates,l))}if(r.length)for(const o of this.traceSegments_){const s=o[0],l=s.geometry,u=o[1],h=s.index+1;u===0&&r.reverse();const d=l.getCoordinates();AS(d,l.getType(),s.depth).splice(h,0,...r),l.setCoordinates(d),u===1&&(s.index+=r.length)}}updateGeometry_(e,t){const i=t[0],r=i.depth;let o;const s=i.segment,l=i.geometry,u=t[1];for(;e.length<l.getStride();)e.push(s[u][e.length]);switch(l.getType()){case"Point":o=e,s[0]=e,s[1]=e;break;case"MultiPoint":o=l.getCoordinates(),o[i.index]=e,s[0]=e,s[1]=e;break;case"LineString":o=l.getCoordinates(),o[i.index+u]=e,s[u]=e;break;case"MultiLineString":o=l.getCoordinates(),o[r[0]][i.index+u]=e,s[u]=e;break;case"Polygon":o=l.getCoordinates(),o[r[0]][i.index+u]=e,s[u]=e;break;case"MultiPolygon":o=l.getCoordinates(),o[r[1]][r[0]][i.index+u]=e,s[u]=e;break;case"Circle":const h=l;if(s[0]=e,s[1]=e,i.index===F5)this.changingFeature_=!0,h.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,this.getMap().getView().getProjection();let d=Nm(ds(h.getCenter()),ds(e));h.setRadius(d),this.changingFeature_=!1}break}o&&this.setGeometryCoordinates_(l,o)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([s])=>s));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],r=[],o=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(o){this.traceSegments_=[];for(const s of this.dragSegments_){const l=s[0];Nm(lb(o,l.segment),o)/e.map.getView().getResolution()<1&&this.traceSegments_.push(s)}}for(let s=0,l=this.dragSegments_.length;s<l;++s){const u=this.dragSegments_[s],h=u[0],d=h.feature;i.includes(d)||i.push(d);const m=h.geometry;r.includes(m)||r.push(m),this.updateGeometry_(t,u)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,i,r,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(t);if(i?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,i),this.vertexFeature_)){const r=this.vertexFeature_.getGeometry().getCoordinates();for(let o=i.length-1;o>=0;--o)this.insertVertex_(i[o],r);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],r=i.geometry;if(r.getType()==="Circle"){const o=r,s=o.getCenter(),l=i.featureSegments[0],u=i.featureSegments[1];l.segment[0]=s,l.segment[1]=s,u.segment[0]=s,u.segment[1]=s,this.rBush_.update(ey(s),l);let h=o;this.rBush_.update(h.getExtent(),u)}else this.rBush_.update(Ks(i.segment),i)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new _I(wS.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){const t=this.getMap(),i=t.getPixelFromCoordinate(e);t.getView().getProjection();const r=function(l,u){return N5(e,l)-N5(e,u)};let o,s;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?u=>u===this.hitDetection_:void 0;t.forEachFeatureAtPixel(i,(u,h,d)=>{d&&d.getType()==="Point"&&(d=new Mr(Kp(d.getCoordinates())));const m=d||u.getGeometry();if(m&&m.getType()==="Point"&&u instanceof Zi&&this.features_.getArray().includes(u)){s=m;const y=u.getGeometry().getFlatCoordinates().slice(0,2);o=[{feature:u,geometry:s,segment:[y,y]}]}return!0},{layerFilter:l})}if(!o){const l=Wl(ey(e,O5)),u=t.getView().getResolution()*this.pixelTolerance_,h=Ow(Hh(l,u,O5));o=this.rBush_.getInExtent(h)}if(o&&o.length>0){const l=o.sort(r)[0],u=l.segment;let h=D5(e,l);const d=t.getPixelFromCoordinate(h);let m=Nm(i,d);if(s||m<=this.pixelTolerance_){const y={};if(y[ti(u)]=!0,this.snapToPointer_||(this.delta_[0]=h[0]-e[0],this.delta_[1]=h[1]-e[1]),l.geometry.getType()==="Circle"&&l.index===tv)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h,[l.feature],[l.geometry],this.snappedToVertex_);else{const x=t.getPixelFromCoordinate(u[0]),C=t.getPixelFromCoordinate(u[1]),w=Fh(d,x),S=Fh(d,C);if(m=Math.sqrt(Math.min(w,S)),this.snappedToVertex_=m<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(h=w>S?u[1]:u[0]),this.createOrUpdateVertexFeature_(h,[l.feature],[l.geometry],this.snappedToVertex_);const T={};T[ti(l.geometry)]=!0;for(let M=1,G=o.length;M<G;++M){const N=o[M].segment;if(Yo(u[0],N[0])&&Yo(u[1],N[1])||Yo(u[0],N[1])&&Yo(u[1],N[0])){const V=ti(o[M].geometry);V in T||(T[V]=!0,y[ti(N)]=!0)}else break}}this.vertexSegments_=y;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,r=e.feature,o=e.geometry,s=e.depth,l=e.index;let u;for(;t.length<o.getStride();)t.push(0);switch(o.getType()){case"MultiLineString":u=o.getCoordinates(),u[s[0]].splice(l+1,0,t);break;case"Polygon":u=o.getCoordinates(),u[s[0]].splice(l+1,0,t);break;case"MultiPolygon":u=o.getCoordinates(),u[s[1]][s[0]].splice(l+1,0,t);break;case"LineString":u=o.getCoordinates(),u.splice(l+1,0,t);break;default:return!1}this.setGeometryCoordinates_(o,u);const h=this.rBush_;h.remove(e),this.updateSegmentIndices_(o,l,s,1);const d={segment:[i[0],t],feature:r,geometry:o,depth:s,index:l};h.insert(Ks(d.segment),d),this.dragSegments_.push([d,1]);const m={segment:[t,i[1]],feature:r,geometry:o,depth:s,index:l+1};return h.insert(Ks(m.segment),m),this.dragSegments_.push([m,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const e=this.vertexFeature_?.getGeometry().getCoordinates();return e?Kp(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(Ks([e])).some(({segment:i})=>Yo(i[0],e)||Yo(i[1],e))}removePoint(e){if(e&&(e=ds(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=Bi.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([r])=>r));const i=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new _I(wS.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,i}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,r,o,s,l,u,h,d,m,y,x,C;for(u=e.length-1;u>=0;--u)s=e[u],x=s[0],C=ti(x.feature),x.depth&&(C+="-"+x.depth.join("-")),C in t||(t[C]={}),s[1]===0?(t[C].right=x,t[C].index=x.index):s[1]==1&&(t[C].left=x,t[C].index=x.index+1);for(C in t){switch(y=t[C].right,d=t[C].left,h=t[C].index,m=h-1,d!==void 0?x=d:x=y,m<0&&(m=0),l=x.geometry,o=l.getCoordinates(),r=o,i=!1,l.getType()){case"MultiLineString":o[x.depth[0]].length>2&&(o[x.depth[0]].splice(h,1),i=!0);break;case"LineString":o.length>2&&(o.splice(h,1),i=!0);break;case"MultiPolygon":r=r[x.depth[1]];case"Polygon":r=r[x.depth[0]],r.length>4&&(h==r.length-1&&(h=0),r.splice(h,1),i=!0,h===0&&(r.pop(),r.push(r[0]),m=r.length-1));break}if(i){this.setGeometryCoordinates_(l,o);const w=[];if(d!==void 0&&(this.rBush_.remove(d),w.push(d.segment[0])),y!==void 0&&(this.rBush_.remove(y),w.push(y.segment[1])),d!==void 0&&y!==void 0){const S={depth:x.depth,feature:x.feature,geometry:x.geometry,index:m,segment:w};this.rBush_.insert(Ks(S.segment),S)}this.updateSegmentIndices_(l,h,x.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(Ks([e])).some(({segment:i})=>!(Yo(i[0],e)||Yo(i[1],e)))}insertPoint(e){const t=e?ds(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((r,o)=>r||this.insertVertex_(o,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,r){this.rBush_.forEachInExtent(e.getExtent(),function(o){o.geometry===e&&(i===void 0||o.depth===void 0||nd(o.depth,i))&&o.index>t&&(o.index+=r)})}}function Yae(n,e){return n.index-e.index}function N5(n,e,t){const i=e.geometry;if(i.getType()==="Circle"){let o=i;if(e.index===tv){const s=Fh(o.getCenter(),ds(n)),l=Math.sqrt(s)-o.getRadius();return l*l}}const r=ds(n);return cy[0]=ds(e.segment[0]),cy[1]=ds(e.segment[1]),kE(r,cy)}function D5(n,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===tv)return Kp(i.getClosestPoint(ds(n)));const r=ds(n);return cy[0]=ds(e.segment[0]),cy[1]=ds(e.segment[1]),Kp(lb(r,cy))}function Hae(){const n=t4();return function(e,t){return n.Point}}class Kae extends la{feature;constructor(e,t){super(e),this.feature=t}}class jae extends Bc{source_;features_;mapMatching_;getRouteUrl_;maxPoints_;freehand_;style_;sketchFeature_=null;sketchPoint_=null;sketchLine_=null;sketchCoords_=[];finishCoordinate_=null;lastWaypoints_="";isRequestingRoute_=!1;pointsCnt_=[];finishAfterRoute_=!1;isDoubleClick_=!1;clickTimeout_=null;active_=!0;constructor(e={}){if(super({stopDown:()=>!1,handleDownEvent:Jae,handleUpEvent:qae,handleMoveEvent:Qae,handleEvent:$ae}),this.source_=e.source,this.features_=e.features,this.mapMatching_=e.mapMatching??!1,this.getRouteUrl_=e.getRouteUrl,this.maxPoints_=e.maxPoints??1/0,this.freehand_=e.freehand??!1,e.style)this.style_=e.style;else{const i=new Ky({type:"LineString",source:new ua}).overlay_;i?this.style_=i.getStyleFunction():this.style_=fM}e.existingSketch&&this.adoptExistingSketch_(e.existingSketch)}setActive(e){this.active_=e}getActive(){return this.active_}setMapMatching(e){this.mapMatching_=e}getMapMatching(){return this.mapMatching_}toggleMapMatching(){return this.mapMatching_=!this.mapMatching_,this.mapMatching_}startDrawing_(e){this.finishCoordinate_=e,this.sketchCoords_=[e.slice(),e.slice()];const t=new $i(this.sketchCoords_);this.sketchFeature_=new Zi({geometry:t}),this.sketchFeature_.setStyle(this.style_),this.sketchPoint_=new Zi({geometry:new Mr(e)}),this.sketchPoint_.setStyle(this.style_),this.source_&&(this.source_.addFeature(this.sketchFeature_),this.sketchPoint_&&this.source_.addFeature(this.sketchPoint_)),this.updateSketchFeatures_()}adoptExistingSketch_(e){const t=e.getGeometry();if(!(t instanceof $i))return;this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates(),this.sketchFeature_.setStyle(this.style_),this.source_&&(this.source_.getFeatures().includes(this.sketchFeature_)||this.source_.addFeature(this.sketchFeature_)),this.sketchCoords_.length>=2?this.finishCoordinate_=this.sketchCoords_[this.sketchCoords_.length-2].slice():this.sketchCoords_.length===1&&(this.finishCoordinate_=this.sketchCoords_[0].slice());const i=this.sketchCoords_[this.sketchCoords_.length-1];this.sketchPoint_=new Zi({geometry:new Mr(i)}),this.sketchPoint_.setStyle(this.style_),this.source_&&this.sketchPoint_&&this.source_.addFeature(this.sketchPoint_)}modifyDrawing_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.sketchCoords_,r=i[i.length-1];r[0]=e[0],r[1]=e[1],this.isRequestingRoute_||t.setCoordinates(this.sketchCoords_),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),this.updateSketchFeatures_()}async addToDrawing_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.sketchCoords_;if(this.finishCoordinate_=e.slice(),i.length>=this.maxPoints_){this.finishDrawing();return}if(i[i.length-1]=e.slice(),i.push(e.slice()),!this.mapMatching_||this.freehand_||!this.getRouteUrl_){this.pointsCnt_.push(1),t.setCoordinates(i),this.updateSketchFeatures_();return}if(i.length>2){const r=gs(i[i.length-2],"EPSG:3857","EPSG:4326"),o=gs(i[i.length-3],"EPSG:3857","EPSG:4326"),s=`${o[1]},${o[0]},${r[1]},${r[0]}`;s!==this.lastWaypoints_&&!this.isRequestingRoute_&&(this.lastWaypoints_=s,await this.requestRoute_(s,t,e))}if(!this.isRequestingRoute_){const r=t.getCoordinates().slice(0,-1);r.push(e),t.setCoordinates(r)}}async requestRoute_(e,t,i){if(!this.getRouteUrl_)return;this.isRequestingRoute_=!0;const r=`${this.getRouteUrl_}?waypoints=${e}`;try{const s=await(await fetch(r)).json();if(s.success){const u=new Jl().readGeometry(s.geom);this.pointsCnt_.push(u.getCoordinates().length);const h=t.getCoordinates().slice(0,-2).concat(u.transform("EPSG:4326","EPSG:3857").getCoordinates());this.finishAfterRoute_||h.push(i),t.setCoordinates(h),this.sketchCoords_=h,this.finishAfterRoute_?(this.finishAfterRoute_=!1,this.finishCoordinate_=null,this.finishDrawing()):(this.updateSketchFeatures_(),h.length>=2&&(this.finishCoordinate_=h[h.length-2].slice()))}}catch{}finally{this.isRequestingRoute_=!1}}removeLastPoint(){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry(),t=this.sketchCoords_;if(this.mapMatching_&&this.pointsCnt_.length>0){const i=this.pointsCnt_.pop();t.splice(-1*i-1,i)}else t.splice(-2,1);e.setCoordinates(t),t.length>=2?this.finishCoordinate_=t[t.length-2].slice():this.finishCoordinate_=null,this.updateSketchFeatures_()}finishDrawing(){const e=this.abortDrawing_();e&&(this.dispatchEvent(new Kae("drawend",e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e))}suspendDrawing(){this.sketchPoint_&&this.source_&&this.source_.removeFeature(this.sketchPoint_),this.sketchPoint_=null,this.finishCoordinate_=null}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.clickTimeout_!==null&&(window.clearTimeout(this.clickTimeout_),this.clickTimeout_=null),e&&(this.source_&&(this.source_.removeFeature(e),this.sketchPoint_&&this.source_.removeFeature(this.sketchPoint_)),this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.updateSketchFeatures_()),e}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_)}handlePointerMove_(e){return this.sketchFeature_&&this.modifyDrawing_(e.coordinate),!0}}function $ae(n){const e=this;if(!e.active_)return!0;if(n.type===Bi.DBLCLICK)return e.isDoubleClick_=!0,e.clickTimeout_!==null&&(window.clearTimeout(e.clickTimeout_),e.clickTimeout_=null),e.finishDrawing(),setTimeout(()=>{e.isDoubleClick_=!1},300),!1;if(n.type==="singleclick"){if(e.isDoubleClick_)return!1;const t=n.coordinate;return e.sketchFeature_?e.addToDrawing_(t):e.startDrawing_(t),!1}return n.type==="pointermove"&&e.finishCoordinate_&&e.modifyDrawing_(n.coordinate),!0}function Jae(){return!0}function qae(){return!1}function Qae(n){return this.handlePointerMove_(n)}const us={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},ele={ERROR:"error"};class tle extends la{constructor(e){super(ele.ERROR),this.code=e.code,this.message=e.message}}class nle extends eu{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=cD,this.watchId_=void 0,this.addChangeListener(us.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(us.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Ny(Oi("EPSG:4326"),e),this.position_&&this.set(us.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(us.ACCURACY,t.accuracy),this.set(us.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(us.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(us.HEADING,t.heading===null?void 0:ra(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const i=this.transform_(this.position_);this.set(us.POSITION,i.slice()),this.set(us.SPEED,t.speed===null?void 0:t.speed);const r=pH(this.position_,t.accuracy);r.applyTransform(this.transform_),this.set(us.ACCURACY_GEOMETRY,r),this.changed()}positionError_(e){this.dispatchEvent(new tle(e))}getAccuracy(){return this.get(us.ACCURACY)}getAccuracyGeometry(){return this.get(us.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(us.ALTITUDE)}getAltitudeAccuracy(){return this.get(us.ALTITUDE_ACCURACY)}getHeading(){return this.get(us.HEADING)}getPosition(){return this.get(us.POSITION)}getProjection(){return this.get(us.PROJECTION)}getSpeed(){return this.get(us.SPEED)}getTracking(){return this.get(us.TRACKING)}getTrackingOptions(){return this.get(us.TRACKING_OPTIONS)}setProjection(e){this.set(us.PROJECTION,Oi(e))}setTracking(e){this.set(us.TRACKING,e)}setTrackingOptions(e){this.set(us.TRACKING_OPTIONS,e)}}function ile(n,e){const t=n.canvas;e=e||{};const i=e.pixelRatio||fD,r=e.size;r&&(t.width=r[0]*i,t.height=r[1]*i,t.style.width=r[0]+"px",t.style.height=r[1]+"px");const o=[0,0,t.width,t.height],s=oI(qa(),i,i);return new PB(n,i,o,s,0)}function Lx(n,e){return Gs(n.inversePixelTransform,e.slice(0))}class qM extends db{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent($n.CHANGE)}release(){this.setState(Vn.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==Vn.EMPTY){if(this.state!==Vn.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}}load(){Zn()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const r=t-i+1e3/60;return r>=this.transition_?1:mD(r/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}class KB extends qM{constructor(e,t,i,r,o,s){super(e,t,s),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_,Il?this.image_=new OffscreenCanvas(1,1):(this.image_=new Image,r!==null&&(this.image_.crossOrigin=r)),this.unlisten_=null,this.tileLoadFunction_=o}getImage(){return this.image_}setImage(e){this.image_=e,this.state=Vn.LOADED,this.unlistenImage_(),this.changed()}getCrossOrigin(){return this.crossOrigin_}handleImageError_(){this.state=Vn.ERROR,this.unlistenImage_(),this.image_=rle(),this.changed()}handleImageLoad_(){if(Il)this.state=Vn.LOADED;else{const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=Vn.LOADED:this.state=Vn.EMPTY}this.unlistenImage_(),this.changed()}load(){this.state==Vn.ERROR&&(this.state=Vn.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Vn.IDLE&&(this.state=Vn.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=DK(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function rle(){const n=qs(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}const Uo={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Vp extends eu{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+AH,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Uo.ELEMENT,this.handleElementChanged),this.addChangeListener(Uo.MAP,this.handleMapChanged),this.addChangeListener(Uo.OFFSET,this.handleOffsetChanged),this.addChangeListener(Uo.POSITION,this.handlePositionChanged),this.addChangeListener(Uo.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(Uo.ELEMENT)}getId(){return this.id}getMap(){return this.get(Uo.MAP)||null}getOffset(){return this.get(Uo.OFFSET)}getPosition(){return this.get(Uo.POSITION)}getPositioning(){return this.get(Uo.POSITIONING)}handleElementChanged(){LD(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),pr(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=In(e,Ch.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(Uo.ELEMENT,e)}setMap(e){this.set(Uo.MAP,e)}setOffset(e){this.set(Uo.OFFSET,e)}setPosition(e){this.set(Uo.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(Uo.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),r=this.getElement(),o=this.getRect(r,[EH(r),TH(r)]);e=e||{};const s=e.margin===void 0?20:e.margin;if(!_c(i,o)){const l=o[0]-i[0],u=i[2]-o[2],h=o[1]-i[1],d=i[3]-o[3],m=[0,0];if(l<0?m[0]=l-s:u<0&&(m[0]=Math.abs(u)+s),h<0?m[1]=h-s:d<0&&(m[1]=Math.abs(d)+s),m[0]!==0||m[1]!==0){const y=t.getView().getCenterInternal(),x=t.getPixelFromCoordinateInternal(y);if(!x)return;const C=[x[0]+m[0],x[1]+m[1]],w=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(C),duration:w.duration,easing:w.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),r=i.left+window.pageXOffset,o=i.top+window.pageYOffset;return[r,o,r+t[0],o+t[1]]}setPositioning(e){this.set(Uo.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),r=e.getSize();this.updateRenderedPosition(i,r)}updateRenderedPosition(e,t){const i=this.element.style,r=this.getOffset(),o=this.getPositioning();this.setVisible(!0);const s=`${e[0]+r[0]}px`,l=`${e[1]+r[1]}px`;let u="0%",h="0%";o=="bottom-right"||o=="center-right"||o=="top-right"?u="-100%":(o=="bottom-center"||o=="center-center"||o=="top-center")&&(u="-50%"),o=="bottom-left"||o=="bottom-center"||o=="bottom-right"?h="-100%":(o=="center-left"||o=="center-center"||o=="center-right")&&(h="-50%");const d=`translate(${u}, ${h}) translate(${s}, ${l})`;this.rendered.transform_!=d&&(this.rendered.transform_=d,i.transform=d)}getOptions(){return this.options}}class QM{constructor(e,t,i,r){this.minX=e,this.maxX=t,this.minY=i,this.maxY=r}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function xm(n,e,t,i,r){return r!==void 0?(r.minX=n,r.maxX=e,r.minY=t,r.maxY=i,r):new QM(n,e,t,i)}function Rb(n,e=console){const t=n.startsWith("[")?n:`[${n}]`,i=(o,s)=>{const l=[t,...s];try{if(typeof e[o]=="function"){e[o](...l);return}}catch{}try{typeof e.log=="function"&&e.log(...l)}catch{}},r=o=>(...s)=>{i(o,s)};return{log:r("log"),info:r("info"),warn:r("warn"),error:r("error"),debug:r("debug")}}const sle="https://migration.geoportail.lu/profile.json";async function ole(n,e,t="dhm",i=100){const r={geom:n,nbPoints:i+"",layers:t,id:e+""},o=await Vs(sle,r,"POST");if(!o.ok){let l="";try{l=await o.text()}catch{}const{error:u}=Rb("PROFILE");throw u("[fetchProfileJson] non-ok response",{status:o.status,body:l}),new Error("Error while trying to get profile")}return await o.json()}function V5(n,e=1){if(!/^#[0-9A-Fa-f]{6}$/.test(n))throw new Error(`Invalid hex color string: ${n}`);const i=parseInt(n.slice(1,3),16),r=parseInt(n.slice(3,5),16),o=parseInt(n.slice(5,7),16);return[i,r,o,e]}function jB(n){const[e,t,i]=n;if(e!==(e&255)||t!==(t&255)||i!==(i&255))throw Error(`"(${e},${t},${i})" is not a valid RGB color`);const r=SS(e.toString(16)),o=SS(t.toString(16)),s=SS(i.toString(16));return`#${r}${o}${s}`}function SS(n){return n.length===1?`0${n}`:n}function ale(){return{angle:0,color:"#ed1c24",arrowcolor:void 0,stroke:1.25,linestyle:"plain",opacity:.2,showOrientation:!1,shape:"circle",symbolId:void 0,symboltype:void 0,size:10}}const Bp=function(n,e){let t=0,i=[];n.getType()==="Polygon"?i=n.getCoordinates()[0]:n.getType()==="LineString"&&(i=n.getCoordinates());for(let r=0,o=i.length-1;r<o;++r){const s=gs(i[r],e,Fu),l=gs(i[r+1],e,Fu);t+=eC(s,l)}return t},ET=function(n){return Math.abs(uD(n))},lle=function(n,e){const t=Hv(n,e);return 2*Math.PI*t},ule=function(n,e){return Math.PI*Math.pow(Hv(n,e),2)},Hv=function(n,e){const t=n.getLastCoordinate(),i=n.getCenter();return i!==null&&t!==null?Bp(new $i([i,t]),e):0},ek=function(n,e,t){const i=n.getCenter(),r=t.getView().getProjection(),o=t.getView().getResolution()||0,s=Sv(r,o,i),l=o/s;e=e/Xp.m*l,n.setRadius(e)};function tk(n){const e=n.getGeometry();return n.featureType==="drawnCircle"&&e?.getType()==="Circle"&&n.setGeometry(kD(e,64)),n}function $B(n){const e=Kn().getOlMap();if(!e)return n;const t=n.getGeometry();if(n.featureType==="drawnCircle"&&t?.getType()==="Polygon"){const i=t.getExtent(),r=[(i[0]+i[2])/2,(i[1]+i[3])/2],o=t.getCoordinates()[0];let s=0;o.forEach(u=>{const h=eC(vc(r),vc(u));h>s&&(s=h)});const l=new _f(r);e?ek(l,s,e):l.setRadius(s),n.setGeometry(l)}return n}function JB(n){const e=n.getGeometry().getCoordinates().reverse();n.setGeometry(new $i(e))}function cle(n){const e=Jr(),t=n.filter(s=>["LineString","MultiLineString"].includes(s.getGeometry()?.getType())),i=t.shift(),r=t.map(s=>s.id);if(!i)return;const o=i.getGeometry();for(;t.length>0;){const s=o.getFirstCoordinate(),l=o.getLastCoordinate();let u,h=!1,d=!1;for(let x=0;x<t.length;x++){const w=t[x].getGeometry(),S=w.getFirstCoordinate(),T=w.getLastCoordinate(),M=new $i([s,S]),G=new $i([l,T]),N=new $i([l,S]),V=new $i([s,T]),W=M.getLength(),j=N.getLength(),J=V.getLength(),te=G.getLength();W<j&&W<J&&W<te?(u===void 0||W<u)&&(u=W,h=!0,d=!0):te<W&&te<j&&te<J?(u===void 0||te<u)&&(u=te,h=!1,d=!0):j<W&&j<J&&j<te?(u===void 0||j<u)&&(u=j,h=!1,d=!1):(u===void 0||J<u)&&(u=J,h=!0,d=!1)}let y=t.shift().getGeometry();return d&&(y=new $i(y.getCoordinates().reverse())),o.setCoordinates(h?y.getCoordinates().concat(o.getCoordinates()):o.getCoordinates().concat(y.getCoordinates())),i.resetProfileData(),e.removeFeature(r),i}}function hle(){const n=Jr(),{activateDrawLineContinue:e}=n,{currentDrawInteraction:t}=xt(n),i=Kn().getOlMap();function r(s,l){const u=El.clone(s),h=u.getGeometry();return ek(h,l,i),u}async function o(s){e(),t.value&&(await aa(),t.value?.setActive(!0),t.value?.extend(s))}return{createConcentricCircle:r,continueLine:o}}const dle="https://migration.geoportail.lu/mymaps",fle="https://migration.geoportail.lu/mymaps/symbol",ple=dle+"/getarrow",ES={dataProjection:tu,featureProjection:Dp};class El extends Zi{id;fid;label;description;display_order;selected;editable;map_id;saving;featureType;_featureStyle;map=Kn().getOlMap();profileData=void 0;constructor(e,t){e?(super(e.getGeometry()),this.label=e.label,this.featureType=e.featureType,this.map_id=e.map_id,this.description=e.description,this.display_order=e.display_order,this.selected=e.selected,this.editable=e.editable,this._featureStyle=e.featureStyle,this.id=e.id,this.saving=e.saving,this.setProperties(e.getProperties())):(super(t),this.editable=!1)}clone(){const e=new El(this,this.hasProperties()?this.getProperties():void 0);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e.id=Zv(),e}static clone(e){return e.clone()}static generateFromFeature(e,t={}){const i=Object.assign(new El,e,{id:Zv(),label:void 0,description:"",display_order:void 0,selected:!1,editable:!1,map_id:void 0,saving:!1,featureType:void 0},t);i.editable=i.map_id===void 0;const r=e.getGeometry()?.getType(),o={Point:"drawnPoint",LineString:"drawnLine",Polygon:"drawnPolygon",Circle:"drawnCircle"};return i.featureType===void 0&&(i.featureType=o[r]||"drawnPolygon"),i.featureStyle=ale(),i.fromProperties(e.getProperties()),i.setStyle(i.getStyleFunction()),i}static generateFromGeoJson(e,t={}){const i=new Jl(ES).readFeature(e),r=El.generateFromFeature(i,t),o=i.getProperties();return r.fromProperties(o),r.setStyle(r.getStyleFunction()),r}get featureStyle(){return this._featureStyle}set featureStyle(e){this._featureStyle=e,this.changed()}fit(){const e=this.map.getSize(),t=this.getGeometry()?.getExtent();this.map.getView().fit(t,{size:e})}resetProfileData(){this.profileData=void 0}async getProfile(){const e=this.getGeometry();if(!(e?.getType()!=="LineString"&&e?.getType()!=="MultiLineString")){if(this.profileData===void 0){const t=new Jl().writeGeometry(this.getGeometry(),ES),i=await ole(t,this.id);let r=0,o=0,s=0,l;this.profileData=i.profile.map(u=>{const h={...u,cumulativeElevation:0,elevationGain:0,elevationLoss:0},d=h.values.dhm;if(l!==void 0){const m=d-l;s=s+m,m>0?r=r+m:o=o+m}return h.cumulativeElevation=s,h.elevationGain=r,h.elevationLoss=o,l=d,h})}return this.profileData}}toProperties(){return{angle:this.featureStyle.angle,color:this.featureStyle.color,description:this.description,display_order:this.display_order,fid:this.fid,stroke:this.featureStyle.stroke,isLabel:this.featureType==="drawnLabel",linestyle:this.featureStyle.linestyle,name:this.label,opacity:this.featureStyle.opacity,showOrientation:this.featureStyle.showOrientation,shape:this.featureStyle.shape,size:this.featureStyle.size,isCircle:this.featureType==="drawnCircle",symbolId:this.featureStyle.symbolId,symboltype:this.featureStyle.symboltype,__map_id__:this.map_id}}fromProperties(e){e&&(this.description=e.description??this.description,this.display_order=e.display_order??this.display_order,this.label=e.name??this.label,this.map_id=e.__map_id__??this.map_id,e.isCircle===!0?this.featureType="drawnCircle":e.isLabel===!0&&(this.featureType="drawnLabel"),this.featureStyle={angle:e.angle??this.featureStyle.angle,color:e.color??this.featureStyle.color,stroke:e.stroke??this.featureStyle.stroke,linestyle:e.linestyle??this.featureStyle.linestyle,opacity:e.opacity??this.featureStyle.opacity,showOrientation:e.showOrientation??this.featureStyle.showOrientation,shape:e.shape??this.featureStyle.shape,size:e.size??this.featureStyle.size,symbolId:e.symbolId??this.featureStyle.symbolId,symboltype:e.symboltype??this.featureStyle.symboltype,arrowcolor:e.arrowcolor??this.featureStyle.arrowcolor})}toGeoJSONString(){const e=this.clone();return e.setProperties(this.toProperties()),new Jl().writeFeature(e.getGeometry()?.getType()==="Circle"?tk(e):e,ES)}getStyleFunction(){const e=[],t=new qn({image:new vl({radius:6,points:4,angle:Math.PI/4,fill:new Ji({color:[255,255,255,.5]}),stroke:new ki({color:[0,0,0,1]})}),geometry:function(l){const u=l.getGeometry();let h;return u instanceof $i?(h=u.getCoordinates(),new Jh(h)):u instanceof Fo?(h=u.getCoordinates()[0],new Jh(h)):u}}),i=new qn({image:new Qs({radius:8,fill:new Ji({color:[0,0,255,.8]}),stroke:new ki({color:[255,255,255,1],width:2})}),geometry:function(l){const u=l.getGeometry();if(u instanceof _f)return new Mr(u.getCenter())}}),r=new Ji,o=ple,s=this.map;return function(l,u){u===void 0&&(u=l,l=this),e.length=0,l.get("__isBeingEdited__")&&(e.push(t),l.featureType==="drawnCircle"&&l.getGeometry()?.getType()==="Circle"&&e.push(i));const h=l.display_order??0,d=l.featureStyle.color||"#FF0000",m=V5(d,1),y=V5(d,l.featureStyle.opacity??1);if(r.setColor(y),l.getGeometry()?.getType()==="LineString"&&l.featureStyle.showOrientation){let G,N,V=l.featureStyle.arrowcolor;V==null&&(V=d),l.getGeometry()?.forEachSegment(function(W,j){const J=new Mr([(W[0]+j[0])/2,(W[1]+j[1])/2]),te=j[0]-W[0],ce=j[1]-W[1];if(G!=null){const pe=s.getPixelFromCoordinate(J.getCoordinates()),Y=s.getPixelFromCoordinate(G.getCoordinates()),he=Y[0]-pe[0],D=Y[1]-pe[1];N=Math.sqrt(he*he+D*D)}if(!G||N>600){const pe=o,Y=Math.PI/2-Math.atan2(ce,te);e.push(new qn({geometry:J,zIndex:h,image:new Gu({color:V,rotation:Y,src:pe})})),G=J}})}let x;if(l.featureStyle.linestyle)switch(l.featureStyle.linestyle){case"dashed":x=[10,10];break;case"dotted":x=[1,6];break}let C,w=l.featureStyle.stroke;w>0&&(l.selected&&(w=w+3),C=new ki({color:m,width:w,lineDash:x}));let S=l.featureStyle.size;l.selected&&(S=S+3);const T={fill:r,stroke:new ki({color:m,width:S/7}),radius:S};let M=null;if(l.featureType==="drawnPoint"||l.featureType==="drawnLabel")if(l.featureStyle.symbolId){const G={...T,src:fle+"/"+l.featureStyle.symbolId+"?scale="+S,scale:1,rotation:l.featureStyle.angle};M=new Gu(G)}else{const G=l.featureStyle.shape;G==="circle"?M=new Qs(T):G==="square"?(Object.assign(T,{points:4,angle:Math.PI/4,rotation:l.featureStyle.angle}),M=new vl(T)):G==="triangle"?(Object.assign(T,{points:3,angle:0,rotation:l.featureStyle.angle}),M=new vl(T)):G==="star"?(Object.assign(T,{points:5,angle:Math.PI/4,rotation:l.featureStyle.angle,radius2:S}),M=new vl(T)):G==="cross"&&(Object.assign(T,{points:4,angle:0,rotation:l.featureStyle.angle,radius2:0}),M=new vl(T))}return l.featureType==="drawnLabel"?[new qn({text:new sd({text:l.label,textAlign:"left",font:"normal "+S+"px Sans-serif",rotation:l.featureStyle.angle,fill:new Ji({color:m}),stroke:new ki({color:[255,255,255],width:2})})})]:(M?e.push(new qn({image:M,fill:r,stroke:C,zIndex:h})):e.push(new qn({fill:r,stroke:C,zIndex:h})),e)}}}let B5=!1;function Ef(){const{t:n}=Ct(),e=oi(),t=Wi(),i=Jr(),{drawnFeatures:r,drawnFeaturesMyMaps:o,drawnFeaturesExceptMyMaps:s}=xt(i),l=Vr(),{addNotification:u}=ns(),{authenticated:h}=xt(Du()),{myMap:d,myMapId:m,myMapIsLoading:y,myMapLayersChanged:x}=xt(e),{layers:C,bgLayer:w}=xt(t),S=Sl(),{themeName:T}=xt(l),{initLayer:M}=sa(),{setBgLayer:G}=iA(),N=At(()=>d.value?.is_editable&&h.value?d.value.uuid:void 0);function V(){u(n("Erreur inattendue lors du chargement de votre carte."),mi.ERROR)}async function W(re){d.value=void 0,y.value=!0;try{const[le,fe]=await Promise.all([kae(re),Vae(re)]),Le=fe.features?.map(we=>{const se=El.generateFromGeoJson(we,{map_id:re,id:we.id,fid:we.id,display_order:we.properties?.display_order});return $B(se)});d.value=le,Le.forEach(we=>{we.editable=h.value&&le.is_editable}),r.value=[...r.value,...Le]}catch(le){console.error("[MyMaps] loadMyMap() - ERROR",le),V()}finally{y.value=!1}}function j(re){m.value=re}function J(){m.value&&i.removeMyMapsFeature(m.value),m.value=void 0,d.value=void 0}async function te(re){const le=await Nae(re);return le&&(o.value.forEach(fe=>zB(fe.id)),i.removeMyMapsFeature(re)),le}async function ce(){if(d.value){const re=C.value.reverse();d.value.bg_layer=w.value?.name??"blank",d.value.bg_opacity=1,d.value.layers=re.map(le=>le.name).join(","),d.value.layers_opacity=re.map(le=>le.opacity??"1").join(","),d.value.layers_visibility=re.map(()=>"true").join(","),d.value.layers_indices=re.map((le,fe)=>fe).join(","),WB(d.value.uuid,d.value.bg_layer,d.value.bg_opacity,d.value.layers,d.value.layers_opacity,d.value.layers_visibility,d.value.layers_indices,T.value).catch(()=>u(n("Erreur inattendue lors de la mise  jour de votre carte."),mi.ERROR))}}function pe(){G(void 0,d.value?.bg_layer);const re=d.value?.layers_opacity?d.value?.layers_opacity.split(",").map(Le=>parseInt(Le,10)):[],le=d.value?.layers_visibility?d.value?.layers_visibility.split(",").map(Le=>Le!=="false"):[],fe=d.value?.layers?d.value?.layers.split(",").map((Le,we)=>{const se=S.findByName(Le.trim());if(se){const Q=M(se);return Q.opacity=le[we]??!0?re[we]:0,Q}}).filter(Le=>Le!==void 0):[];if(t.removeAllLayers(),t.addLayers(...fe),d.value&&d.value.zoom!==null&&d.value.x!==null&&d.value.y!==null){const Le=Kn().getOlMap();Le.getView().setZoom(d.value.zoom),Le.getView().setCenter([d.value.x,d.value.y])}else{const Le=Kn().getOlMap(),we=Qa();o.value.forEach(se=>{se.getGeometry()&&by(we,se.getGeometry().getExtent())}),we[0]!==1/0&&we[1]!==1/0&&we[2]!==-1/0&&we[3]!==-1/0&&we[0]<we[2]&&we[1]<we[3]&&Le.getView().fit(we,{padding:[20,20,20,20]})}}function Y(){B5||(kt(m,async(re,le)=>{re&&re!==le&&Kn().getOlMap()?W(re):!re&&le&&(o.value.forEach(fe=>{fe.map_id=void 0,fe.editable=!0,fe.changed()}),d.value=void 0)},{immediate:!0}),kt(()=>Kn().olMap,re=>{re&&m.value&&!d.value&&W(m.value)}),kt(d,re=>re&&pe()),kt(h,re=>{o.value.forEach(le=>{le.editable=re&&(d.value?.is_editable??!1),le.changed()}),re&&m.value&&d.value&&W(m.value)}),kt([C,w,d],([re,le,fe])=>x.value=fe?gle(fe,re,le):!1,{immediate:!0,deep:!0}),B5=!0)}async function he(){if(N.value){const re=[...s.value],le=re.map(fe=>fe.id).filter(fe=>fe!==void 0);le.length>0&&i.removeFeature(le,!1),await Promise.all(re.map(async fe=>{fe.map_id=N.value;const Le=await ST(fe.map_id,fe.toGeoJSONString()).catch(we=>{console.error("[MyMaps] Error saving feature:",we),u(n("Erreur inattendue lors de la sauvegarde de votre modification."),mi.ERROR)});Le&&(fe.id=Le.id,fe.fid=Le.id)})),r.value=[...r.value,...re]}}function D(){return h.value?!0:(u(n("Veuillez vous identifier afin d'accder  vos cartes")),e.toggleAuthFormOpen(!0),!1)}return{isMyMapEditable:N,init:Y,addInMyMap:he,loadMyMap:W,checkAuth:D,clearMyMap:te,closeMyMap:J,openMyMap:j,applyToMyMap:ce,resetFromMyMap:pe}}function gle(n,e,t){const i=e.map(o=>o.name).join(","),r=e.map(o=>o.opacity).join(",");return i!==(n.layers??"")||r!==(n.layers_opacity??"")||(t?.name??"blank")!==(n.bg_layer??"blank")}function sA(){const n=Jr(),{drawStateActive:e,drawnFeatures:t}=xt(n),{isMyMapEditable:i}=Ef();function r(o){const s=o.getGeometry()?.getType().replace("String",""),l=e.value==="drawCircle"?"drawnCircle":e.value==="drawLabel"?"drawnLabel":`drawn${s}`,u=o.get("name")||`${x6(s)} ${t.value.length+1}`,h=El.generateFromFeature(o,{label:u,display_order:t.value.length,featureType:l,map_id:i.value});return h.fromProperties(o.getProperties()),h}return{generateDrawnFeature:r}}function mle(){const n=Kn().getOlMap(),e=Jr(),{drawStateActive:t,editStateActive:i,followRoads:r}=xt(e),{generateDrawnFeature:o}=sA(),s=Ke(!1),l=Ke(!0);let u=null,h=null;function d(){return"https://map.geoportail.lu/mymaps/getroute"}function m(){if(!n)return null;const M=n.getLayers().getArray();for(const G of M)if(G instanceof bo&&G.get("cyLayerType")==="interactionDrawLayer")return G.getSource();return null}function y(M={}){if(!n)return;let G=null;n.getInteractions().getArray().forEach(j=>{if(j instanceof Ky&&j.getActive()){const J=j.overlay_;if(J){const te=J.getSource(),ce=te?.getFeatures();ce&&ce.length>0&&(G=ce[0],te.clear())}h=j,j.setActive(!1)}});const V=m();if(!V)return;u=new jae({source:V,mapMatching:M.mapMatching??l.value,getRouteUrl:d(),maxPoints:1/0,freehand:!1,existingSketch:G||void 0});const W=j=>{T(j)};u.addEventListener("drawend",W),n.addInteraction(u),s.value=!0}function x(){if(!n||!u)return;u.setActive(!1);const M=u.sketchFeature_,G=u.sketchCoords_;u.suspendDrawing(),n.removeInteraction(u),u=null,s.value=!1,h&&(i.value||(h.setActive(!0),M&&G&&(h.sketchFeature_=M,h.sketchCoords_=G,h.updateSketchFeatures_())),h=null)}function C(){if(u){const M=u.toggleMapMatching();return l.value=M,M}return l.value=!l.value,l.value}function w(){u&&u.removeLastPoint()}function S(){u&&u.finishDrawing()}function T(M){const G=M.feature,N=o(G);e.addDrawnFeatureToCollection(N),e.selectDrawnFeature(N)}return kt(r,M=>{t.value==="drawLine"&&i.value!=="editLine"&&(M?y({mapMatching:!0}):x())}),kt(t,(M,G)=>{M==="drawLine"&&r.value&&i.value!=="editLine"&&y({mapMatching:!0}),G==="drawLine"&&M!=="drawLine"&&i.value!=="editLine"&&(s.value&&x(),r.value=!1)}),kt(i,(M,G)=>{M!==void 0&&s.value&&x(),G!==void 0&&M===void 0&&t.value==="drawLine"&&r.value&&y({mapMatching:!0})}),Ds(()=>{x()}),{isActive:s,mapMatchingEnabled:l,activate:y,deactivate:x,toggleMapMatching:C,removeLastPoint:w,finishDrawing:S}}const yle={class:"block"},Pm=st({__name:"button-text",props:{label:{},active:{type:Boolean}},setup(n){const e=n;return(t,i)=>(U(),oe("button",{class:Dn(["h-16 w-16 text-white hover:bg-primary",e.active?"bg-primary":"bg-tertiary"])},[P("span",yle,K(e.label),1)],2))}}),_le={"data-cy":"toolbarDraw"},vle={class:"absolute bottom-full top-auto z-20 flex flex-row justify-start divide-y-0 divide-x divide-gray-400 divide-solid box-content border-y-0 border-x border-gray-400"},ble={key:0,class:"absolute bottom-full top-auto z-10 pl-[130px] pb-16 w-[326px]","data-cy":"followRoads"},xle={class:"flex flex-row justify-center text-white bg-tertiary hover:bg-primary py-2 box-content border-y border-x border-gray-400"},Ile={class:"cursor-pointer"},Cle=["disabled"],wle=st({__name:"toolbar-draw",setup(n){const{t:e}=Ct(),t=Jr(),{toggleDrawCircle:i,toggleDrawLabel:r,toggleDrawLine:o,toggleDrawPolygon:s,toggleDrawPoint:l,setDrawActiveState:u}=t,{drawStateActive:h,editStateActive:d,followRoads:m}=xt(t);return mle(),og(()=>{u(void 0)}),(y,x)=>(U(),oe("div",_le,[P("ul",vle,[P("li",null,[mt(Pm,{label:k(e)("Draw Point",{ns:"client"}),active:k(h)==="drawPoint"||k(d)==="editPoint",onClick:k(l),"data-cy":"drawPointButton"},null,8,["label","active","onClick"])]),P("li",null,[mt(Pm,{label:k(e)("Label",{ns:"client"}),active:k(h)==="drawLabel"||k(d)==="editLabel",onClick:k(r),"data-cy":"drawLabelButton"},null,8,["label","active","onClick"])]),P("li",null,[mt(Pm,{label:k(e)("Line",{ns:"client"}),active:k(h)==="drawLine"||k(d)==="editLine",onClick:k(o),"data-cy":"drawLineButton"},null,8,["label","active","onClick"])]),P("li",null,[mt(Pm,{label:k(e)("Polygon",{ns:"client"}),active:k(h)==="drawPolygon"||k(d)==="editPolygon",onClick:k(s),"data-cy":"drawPolygonButton"},null,8,["label","active","onClick"])]),P("li",null,[mt(Pm,{label:k(e)("Circle",{ns:"client"}),active:k(h)==="drawCircle"||k(d)==="editCircle",onClick:k(i),"data-cy":"drawCircleButton"},null,8,["label","active","onClick"])])]),k(h)==="drawLine"||k(d)==="editLine"?(U(),oe("ul",ble,[P("li",xle,[P("label",Ile,[Sn(P("input",{type:"checkbox","onUpdate:modelValue":x[0]||(x[0]=C=>Pr(m)?m.value=C:null),disabled:k(d)==="editLine",class:"mr-2 cursor-pointer"},null,8,Cle),[[Yh,k(m)]]),Bt(" "+K(k(e)("Suivre la route",{ns:"client"})),1)])])])):Ge("",!0)]))}}),Ale="https://migration.geoportail.lu/raster",Sle="EPSG:3857",Ele="EPSG:2169",Kv=async(n,e)=>{const t=gs(n,Sle,Ele);try{const i=await fetch(`${Ale}?lon=${t[0]}&lat=${t[1]}`,{signal:e});if(!i.ok)throw new Error("Network response was not ok");return(await i.json()).dhm}catch{return null}},qB=Ase(Kv,300);class Tle{measureTooltipElement=null;measureTooltipOverlay=null;changeEventKey=null;add(e,t){this.createMeasureTooltip(e);const i=t.feature.getGeometry();if(i===void 0)return;const r=e.getView().getProjection();this.changeEventKey=In(i,"change",()=>this.updateTootip(i,r),this)}remove(){this.removeMeasureTooltip(),this.changeEventKey!==null&&(_l(this.changeEventKey),this.changeEventKey=null)}createPersistentMeasurement(e,t){const i=document.createElement("div");i.classList.add("lux-tooltip");const r=new Vp({element:i,offset:[0,-15],positioning:"bottom-center",stopEvent:!1});e.addOverlay(r);const o=e.getView().getProjection(),s=()=>{let u,h="";if(t.getType()==="LineString"){const d=t;u=d.getCoordinateAt(.5),u!=null&&(h=af(Bp(d,o),1))}else if(t.getType()==="Polygon"){const d=t;d.getCoordinates()[0].length>2&&(u=d.getInteriorPoint().getCoordinates()),u!=null&&(h=KE(ET(d)))}i.innerText=h,r.setPosition(u)},l=In(t,"change",s,this);return s(),()=>{try{e.removeOverlay(r)}catch{}try{_l(l)}catch{}try{i.parentNode&&i.parentNode.removeChild(i)}catch{}}}createMeasureTooltip(e){this.removeMeasureTooltip(),this.measureTooltipElement=document.createElement("div"),this.measureTooltipElement.classList.add("lux-tooltip"),this.measureTooltipOverlay=new Vp({element:this.measureTooltipElement,offset:[0,-15],positioning:"bottom-center",stopEvent:!1}),e.addOverlay(this.measureTooltipOverlay)}removeMeasureTooltip(){this.measureTooltipElement!==null&&(this.measureTooltipElement.parentNode?.removeChild(this.measureTooltipElement),this.measureTooltipElement=null,this.measureTooltipOverlay=null)}updateTootip(e,t){let i,r="";if(e.getType()==="LineString"){const o=e;i=o.getCoordinateAt(.5),i!=null&&(r=af(Bp(o,t)))}else if(e.getType()==="Polygon"){const o=e;o.getCoordinates()[0].length>2&&(i=o.getInteriorPoint().getCoordinates()),i!=null&&(r=KE(ET(o)))}else if(e.getType()==="Circle"){const o=e;i=o.getLastCoordinate();const s=o.getCenter();s!=null&&i!=null&&(r=af(Bp(new $i([s,i]),t),1))}this.measureTooltipElement&&(this.measureTooltipElement.innerText=r,this.measureTooltipOverlay?.setPosition(i))}}const wu=new Tle;function Rle(){const n=Ke(void 0),e=Ke(null),t=Ke(null),{t:i}=Ct(),{warn:r,error:o}=Rb("MEASURE"),s=Kn().getOlMap(),l=Ke(!1),u=Ke(null),h=Ke(null),d=Ke(null),m=Ke(null),y=Ke(null),x=[],C=new qn({stroke:new ki({color:"#ff8c00",width:4})}),w=new qn({stroke:new ki({color:"#ff8c00",width:2,lineDash:[6,6]})}),S=-15,T=-30,M=[0,S],G=[0,T],N="bottom-center";function V(){if(!(!y.value||!s)){try{s.removeOverlay(y.value)}catch(Y){r("[measure] removeHintOverlay failed",Y)}y.value=null}}function W(Y,he){if(s)try{V();const D=document.createElement("div");D.className="lux-tooltip lux-tooltip--hint",D.innerHTML=Y;const re=new Vp({element:D,offset:G,positioning:N,stopEvent:!1});y.value=re,s.addOverlay(y.value);const le=he||s.getView()&&s.getView().getCenter();le&&y.value.setPosition(le)}catch(D){r("[measure] showHintOverlay failed",D)}}function j([Y,he],[D,re]){const le=he*Math.PI/180,fe=re*Math.PI/180,Le=Y*Math.PI/180,we=D*Math.PI/180,se=Math.sin(we-Le)*Math.cos(fe),Q=Math.cos(le)*Math.sin(fe)-Math.sin(le)*Math.cos(fe)*Math.cos(we-Le),$e=(Math.atan2(se,Q)*180/Math.PI+360)%360;return $e>180?$e-360:$e}function J(Y,he,D){const re=document.createElement("div");re.className="lux-tooltip",re.innerHTML=Y,D&&re.dataset&&(re.dataset.measurementId=D);const le=new Vp({element:re,offset:M,positioning:N,stopEvent:!1});return le.setPosition(he),s.addOverlay(le),le}function te(Y){if(!s)return;let he=u.value?.getSource();if(!he){try{const le=s.getLayers().getArray();for(const fe of le)try{if(fe.get&&fe.get("cyLayerType")==="interactionMeasureLayer"){u.value=fe,he=u.value.getSource();break}}catch{}}catch{}he||(he=new ua,u.value=new bo({source:he}),u.value.set("cyLayerType","interactionMeasureLayer"),s.addLayer(u.value))}const D=Y==="azimuth"?"Circle":Y==="area"?"Polygon":"LineString",re=new Ky({type:D,source:he});d.value=In(s,"pointermove",le=>{m.value=le.coordinate;try{y.value&&s&&y.value.setPosition(le.coordinate)}catch(fe){r("[measure] pointermove handler failed",fe)}}),In(re,"drawstart",le=>{try{if(Y!=="azimuth"){wu.add(s,le);try{const fe=le.feature?.getGeometry();let Le;if(fe&&fe.getType&&fe.getType()==="LineString"){const we=fe.getCoordinateAt(.5);we&&we.length>=2&&(Le=[we[0],we[1]])}W(i(Y==="area"?"measure_continue_instruction_area":"measure_continue_instruction"),Le)}catch(fe){r("[measure] drawstart hint update failed",fe)}}}catch(fe){r("[measure] drawstart handler failed",fe)}}),In(re,"drawstart",le=>{if(!(Y!=="azimuth"||!s))try{const Le=le.feature.getGeometry(),we=Le&&Le.getCenter?Le.getCenter():null;if(!we)return;const se=new Zi({geometry:new $i([we,we])});se.set("isMeasurement",!0),se.set("isAzimuthPreview",!0),se.setStyle(w),he.addFeature(se);const Q=new Zi({geometry:new _f(we,0)});Q.set("isMeasurement",!0),Q.set("isAzimuthPreview",!0),Q.setStyle(w),he.addFeature(Q);const q=document.createElement("div");q.className="lux-tooltip",q.innerHTML="";const $e=new Vp({element:q,offset:M,positioning:N,stopEvent:!1});e.value=$e,s.addOverlay(e.value);try{W(i("measure_continue_instruction_azimuth"),we)}catch(qe){r("[measure] showHintOverlay (azimuth) failed",qe)}const Qe=In(s,"pointermove",qe=>{try{const Lt=qe.coordinate;m.value=Lt;const Pt=[Lt[0],Lt[1]];try{se.getGeometry().setCoordinates([we,Pt])}catch(zt){r("[measure] previewRadial.setCoordinates failed",zt)}try{Q.getGeometry().setRadius(Math.sqrt((Pt[0]-we[0])**2+(Pt[1]-we[1])**2))}catch(zt){r("[measure] previewCircle.setRadius failed",zt)}try{const zt=j(vc(we),vc(Pt)),Dt=af(Bp(new $i([we,Pt]),s.getView().getProjection()));q.innerHTML=`${zt.toFixed(1)}  ${Dt}`;const yn=[(we[0]+Pt[0])/2,(we[1]+Pt[1])/2];e.value?.setPosition(yn)}catch(zt){r("[measure] azimuth preview overlay update failed",zt)}}catch(Lt){r("[measure] azimuth pointermove outer failed",Lt)}});t.value={radial:se,preview:Q,key:Qe},x.push(()=>{try{const qe=t.value?.key;qe&&_l(qe)}catch(qe){r("[measure] unByKey for azimuth preview failed",qe)}try{e.value&&s&&s.removeOverlay(e.value),e.value=null}catch(qe){r("[measure] removing azimuth preview overlay failed",qe)}try{t.value?.radial&&he.removeFeature(t.value.radial),t.value?.preview&&he.removeFeature(t.value.preview)}catch(qe){r("[measure] removing azimuth preview features failed",qe)}})}catch(fe){r("[measure] azimuth drawstart handler failed",fe)}}),In(re,"drawend",le=>{const fe=le.feature?.getGeometry();if(fe&&s&&n.value!=="azimuth"){const we=wu.createPersistentMeasurement(s,fe);x.push(we)}if(wu.remove(),V(),d.value){try{_l(d.value)}catch(we){r("[measure] unByKey(pointerMoveKey) failed",we)}d.value=null}const Le=le.feature;if(Le){if(Y==="area")ZI(async()=>{const{Fill:we}=await Promise.resolve().then(()=>S5);return{Fill:we}},void 0).then(({Fill:we})=>{Le.setStyle(new qn({stroke:new ki({color:"#ff8c00",width:3}),fill:new we({color:"rgba(255,140,0,0.15)"})}))});else if(Y==="azimuth"){ZI(async()=>{const{Fill:se}=await Promise.resolve().then(()=>S5);return{Fill:se}},void 0).then(({Fill:se})=>{Le.setStyle(new qn({stroke:new ki({color:"#ff8c00",width:3}),fill:new se({color:"rgba(255,140,0,0.05)"})}))});const we=Le.getGeometry();if(we&&we.getCenter&&we.getRadius){const se=we.getCenter(),Q=we.getRadius(),q=m.value;let $e=0;q&&($e=Math.atan2(q[1]-se[1],q[0]-se[0]));const Qe=[se[0]+Q*Math.cos($e),se[1]+Q*Math.sin($e)],qe=new _f(se,Q);Le.setGeometry(qe);const Lt=new Zi({geometry:new $i([se,Qe])});Lt.setStyle(new qn({stroke:new ki({color:"#ff8c00",width:2})})),Lt.set("isMeasurement",!0),Lt.set("isAzimuthRadial",!0),he.addFeature(Lt),x.push(()=>he.removeFeature(Lt));const Pt=[(se[0]+Qe[0])/2,(se[1]+Qe[1])/2],zt=j(vc(se),vc(Qe)),Dt=af(Bp(new $i([se,Qe]),s.getView().getProjection())),yn=`${zt.toFixed(1)}`;if(e.value&&s){try{s.removeOverlay(e.value)}catch(ke){r("[measure] removing azimuth preview overlay failed",ke)}try{e.value=null}catch{}}let tn=!1;try{tn=Le?.get&&(!!Le.get("measurementId")||!!Le.get("finalOverlayRef"))}catch(ke){r("[measure] checking measurementId/finalOverlayRef failed",ke)}let Ne=null;if(!tn){const ke=Zv();try{Le.set("measurementId",ke)}catch(ge){r("[measure] setting measurementId on feature failed",ge)}try{Lt.set("measurementId",ke)}catch(ge){r("[measure] setting measurementId on radial failed",ge)}Ne=J(`${yn}  ${Dt}  h: N/A`,Pt,ke);try{const ge=Ne?Ne.getElement&&Ne.getElement():null;ge&&ge.dataset&&(ge.dataset.measurementId=ke)}catch(ge){r("[measure] annotating final overlay element failed",ge)}try{Le.set("finalOverlayRef",Ne)}catch(ge){r("[measure] setting finalOverlayRef failed",ge)}try{x.push(()=>{try{he.removeFeature(Le)}catch(ge){r("[measure] removing persistent feature failed",ge)}})}catch(ge){r("[measure] registering persistent remover failed",ge)}}const Be=(ke,ge,ie,Ce,Te)=>{if(ke)try{const De=ke?ke.getElement&&ke.getElement():null;De&&(De.innerHTML=Te===null?`${ie.toFixed(1)}  ${Ce}  h: N/A`:`${ie.toFixed(1)}  ${Ce}  h: ${Te} m`),ke.setPosition(ge)}catch(De){r("[measure] updating final overlay failed",De)}},z=new AbortController,We=()=>{try{z.abort()}catch{}};x.push(We),(async()=>{try{const[ke,ge]=await Promise.all([Kv(se,z.signal),Kv(Qe,z.signal)]);try{const ie=s.getOverlays().getArray();if(!Ne||ie.indexOf(Ne)===-1){const Ce=x.indexOf(We);Ce!==-1&&x.splice(Ce,1);return}}catch{}if(ke===null||ge===null)r("[measure][azimuth] elevation data missing for points",{eCenter:ke,eEdge:ge,center:se,edge:Qe}),Be(Ne,Pt,zt,Dt,null);else{const ie=Math.round(ge-ke);Be(Ne,Pt,zt,Dt,ie)}}catch(ke){o("[measure][azimuth] elevation request failed",ke);try{const ge=s.getOverlays().getArray();if(!Ne||ge.indexOf(Ne)===-1)return}catch{}Be(Ne,Pt,zt,Dt,null)}finally{const ke=x.indexOf(We);ke!==-1&&x.splice(ke,1)}})()}}else Le.setStyle(C);Le.set("isMeasurement",!0)}try{re.setActive(!1),s.removeInteraction(re)}catch(we){r("[measure] removing draw interaction failed",we)}if(t.value){try{const{radial:we,preview:se,key:Q}=t.value;Q&&_l(Q),we&&he.removeFeature(we),se&&he.removeFeature(se)}catch(we){r("[measure] cleanup azimuth preview state failed",we)}t.value=null}h.value=null,n.value=void 0,l.value=!1}),s.addInteraction(re),h.value=re,n.value=Y,l.value=!0;try{const le=Y==="azimuth"?"measure_start_instruction_azimuth":Y==="area"?"measure_start_instruction_area":"measure_start_instruction",fe=m.value??(s.getView()&&s.getView().getCenter());W(i(le),fe)}catch(le){r("[measure] showHintOverlay (start hint) failed",le)}}function ce(){if(s&&l.value){if(h.value&&(h.value.setActive(!1),s.removeInteraction(h.value),h.value=null),wu.remove(),d.value){try{_l(d.value)}catch(Y){r("[measure] unByKey(pointerMoveKey) failed",Y)}d.value=null}if(V(),t.value){try{const{radial:Y,preview:he,key:D}=t.value;D&&_l(D);const re=u.value?.getSource();re&&(Y&&re.removeFeature(Y),he&&re.removeFeature(he))}catch(Y){r("[measure] cleaning up azimuthPreviewState in deactivate failed",Y)}t.value=null}if(e.value&&s){try{s.removeOverlay(e.value)}catch(Y){r("[measure] removing azimuth preview overlay in deactivate failed",Y)}e.value=null}m.value=null,l.value=!1}}function pe(){ce();try{x.forEach(Y=>Y())}catch(Y){r("[measure] running persistent removers failed",Y)}x.length=0;try{s.getLayers().getArray().slice().forEach(he=>{try{const D=he.getSource&&he.getSource();if(!D||!D.getFeatures)return;D.getFeatures().slice().forEach(re=>{try{const le=re.get&&(re.get("isMeasurement")||re.get("isAzimuthRadial")||re.get("isAzimuth")||re.get("isAzimuthPreview")||re.get("measurementId")||re.get("finalOverlayRef")),fe=re.getGeometry&&re.getGeometry().getType&&re.getGeometry().getType()==="Circle";(le||fe)&&D.removeFeature(re)}catch(le){r("[measure] removing measurement features failed",le)}});try{he.get&&he.get("cyLayerType")==="interactionMeasureLayer"&&s.removeLayer(he)}catch(re){r("[measure] removing interaction measure layer failed",re)}}catch(D){r("[measure] iterating layers during reset failed",D)}});try{Mle(s)}catch(he){r("[measure] removeAllMeasurementOverlays failed",he)}u.value=null}catch(Y){r("[measure] reset encountered an unexpected error",Y)}m.value=null}return Ds(()=>{try{pe()}catch(Y){r("[measure] reset on unmount failed",Y)}}),{activate:te,deactivate:ce,reset:pe,isActive:l,currentMode:n,measureLayer:u}}function Mle(n){if(n)try{n.getOverlays().getArray().slice().forEach(t=>{try{const i=t.getElement&&t.getElement(),r=i&&i.dataset&&i.dataset.measurementId,o=i&&i.classList&&i.classList.contains("lux-tooltip");(r||o)&&n.removeOverlay(t)}catch{}})}catch{}}const kle={"data-cy":"toolbarMeasure"},Lle={class:"absolute bottom-full top-auto z-20 flex flex-row justify-start divide-y-0 divide-x divide-gray-400 divide-solid box-content border-y-0 border-x border-gray-400"},Ple=st({__name:"toolbar-measure",setup(n){const{toggleLidarOpen:e,toggleElevationProfileToolbarOpen:t}=oi(),{t:i}=Ct(),{activate:r,deactivate:o,reset:s,currentMode:l}=Rle(),u=[{label:i("Length"),active:()=>l.value==="length",onClick:()=>l.value==="length"?o():r("length")},{label:i("Surface"),active:()=>l.value==="area",onClick:()=>l.value==="area"?o():r("area")},{label:i("Azimut"),active:()=>l.value==="azimuth",onClick:()=>l.value==="azimuth"?o():r("azimuth")},{label:i("Profile"),active:()=>!1,onClick:()=>t(!0)},{label:i("Profil Lidar"),active:()=>!1,onClick:()=>e(!0)},{label:i("Reset"),active:()=>!1,onClick:()=>s()}];return(h,d)=>(U(),oe("div",kle,[P("ul",Lle,[(U(),oe(Et,null,yi(u,(m,y)=>P("li",{key:y},[mt(Pm,{label:m.label,active:m.active(),onClick:m.onClick},null,8,["label","active","onClick"])])),64))])]))}}),Gle="/luxembourg-geoportail/builder/assets/images/profile-CttQMPxA.png";var TT="http://www.w3.org/1999/xhtml";const Z5={svg:"http://www.w3.org/2000/svg",xhtml:TT,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function oA(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),Z5.hasOwnProperty(e)?{space:Z5[e],local:n}:n}function Fle(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===TT&&e.documentElement.namespaceURI===TT?e.createElement(n):e.createElementNS(t,n)}}function Ole(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function QB(n){var e=oA(n);return(e.local?Ole:Fle)(e)}function Nle(){}function nk(n){return n==null?Nle:function(){return this.querySelector(n)}}function Dle(n){typeof n!="function"&&(n=nk(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,l=i[r]=new Array(s),u,h,d=0;d<s;++d)(u=o[d])&&(h=n.call(u,u.__data__,d,o))&&("__data__"in u&&(h.__data__=u.__data__),l[d]=h);return new Aa(i,this._parents)}function eZ(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function Vle(){return[]}function tZ(n){return n==null?Vle:function(){return this.querySelectorAll(n)}}function Ble(n){return function(){return eZ(n.apply(this,arguments))}}function Zle(n){typeof n=="function"?n=Ble(n):n=tZ(n);for(var e=this._groups,t=e.length,i=[],r=[],o=0;o<t;++o)for(var s=e[o],l=s.length,u,h=0;h<l;++h)(u=s[h])&&(i.push(n.call(u,u.__data__,h,s)),r.push(u));return new Aa(i,r)}function nZ(n){return function(){return this.matches(n)}}function iZ(n){return function(e){return e.matches(n)}}var Wle=Array.prototype.find;function zle(n){return function(){return Wle.call(this.children,n)}}function Ule(){return this.firstElementChild}function Xle(n){return this.select(n==null?Ule:zle(typeof n=="function"?n:iZ(n)))}var Yle=Array.prototype.filter;function Hle(){return Array.from(this.children)}function Kle(n){return function(){return Yle.call(this.children,n)}}function jle(n){return this.selectAll(n==null?Hle:Kle(typeof n=="function"?n:iZ(n)))}function $le(n){typeof n!="function"&&(n=nZ(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,l=i[r]=[],u,h=0;h<s;++h)(u=o[h])&&n.call(u,u.__data__,h,o)&&l.push(u);return new Aa(i,this._parents)}function rZ(n){return new Array(n.length)}function Jle(){return new Aa(this._enter||this._groups.map(rZ),this._parents)}function VC(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}VC.prototype={constructor:VC,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function qle(n){return function(){return n}}function Qle(n,e,t,i,r,o){for(var s=0,l,u=e.length,h=o.length;s<h;++s)(l=e[s])?(l.__data__=o[s],i[s]=l):t[s]=new VC(n,o[s]);for(;s<u;++s)(l=e[s])&&(r[s]=l)}function eue(n,e,t,i,r,o,s){var l,u,h=new Map,d=e.length,m=o.length,y=new Array(d),x;for(l=0;l<d;++l)(u=e[l])&&(y[l]=x=s.call(u,u.__data__,l,e)+"",h.has(x)?r[l]=u:h.set(x,u));for(l=0;l<m;++l)x=s.call(n,o[l],l,o)+"",(u=h.get(x))?(i[l]=u,u.__data__=o[l],h.delete(x)):t[l]=new VC(n,o[l]);for(l=0;l<d;++l)(u=e[l])&&h.get(y[l])===u&&(r[l]=u)}function tue(n){return n.__data__}function nue(n,e){if(!arguments.length)return Array.from(this,tue);var t=e?eue:Qle,i=this._parents,r=this._groups;typeof n!="function"&&(n=qle(n));for(var o=r.length,s=new Array(o),l=new Array(o),u=new Array(o),h=0;h<o;++h){var d=i[h],m=r[h],y=m.length,x=iue(n.call(d,d&&d.__data__,h,i)),C=x.length,w=l[h]=new Array(C),S=s[h]=new Array(C),T=u[h]=new Array(y);t(d,m,w,S,T,x,e);for(var M=0,G=0,N,V;M<C;++M)if(N=w[M]){for(M>=G&&(G=M+1);!(V=S[G])&&++G<C;);N._next=V||null}}return s=new Aa(s,i),s._enter=l,s._exit=u,s}function iue(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function rue(){return new Aa(this._exit||this._groups.map(rZ),this._parents)}function sue(n,e,t){var i=this.enter(),r=this,o=this.exit();return typeof n=="function"?(i=n(i),i&&(i=i.selection())):i=i.append(n+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?o.remove():t(o),i&&r?i.merge(r).order():r}function oue(n){for(var e=n.selection?n.selection():n,t=this._groups,i=e._groups,r=t.length,o=i.length,s=Math.min(r,o),l=new Array(r),u=0;u<s;++u)for(var h=t[u],d=i[u],m=h.length,y=l[u]=new Array(m),x,C=0;C<m;++C)(x=h[C]||d[C])&&(y[C]=x);for(;u<r;++u)l[u]=t[u];return new Aa(l,this._parents)}function aue(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var i=n[e],r=i.length-1,o=i[r],s;--r>=0;)(s=i[r])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function lue(n){n||(n=uue);function e(m,y){return m&&y?n(m.__data__,y.__data__):!m-!y}for(var t=this._groups,i=t.length,r=new Array(i),o=0;o<i;++o){for(var s=t[o],l=s.length,u=r[o]=new Array(l),h,d=0;d<l;++d)(h=s[d])&&(u[d]=h);u.sort(e)}return new Aa(r,this._parents).order()}function uue(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function cue(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function hue(){return Array.from(this)}function due(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null}function fue(){let n=0;for(const e of this)++n;return n}function pue(){return!this.node()}function gue(n){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var r=e[t],o=0,s=r.length,l;o<s;++o)(l=r[o])&&n.call(l,l.__data__,o,r);return this}function mue(n){return function(){this.removeAttribute(n)}}function yue(n){return function(){this.removeAttributeNS(n.space,n.local)}}function _ue(n,e){return function(){this.setAttribute(n,e)}}function vue(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function bue(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function xue(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function Iue(n,e){var t=oA(n);if(arguments.length<2){var i=this.node();return t.local?i.getAttributeNS(t.space,t.local):i.getAttribute(t)}return this.each((e==null?t.local?yue:mue:typeof e=="function"?t.local?xue:bue:t.local?vue:_ue)(t,e))}function sZ(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function Cue(n){return function(){this.style.removeProperty(n)}}function wue(n,e,t){return function(){this.style.setProperty(n,e,t)}}function Aue(n,e,t){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(n):this.style.setProperty(n,i,t)}}function Sue(n,e,t){return arguments.length>1?this.each((e==null?Cue:typeof e=="function"?Aue:wue)(n,e,t??"")):Ry(this.node(),n)}function Ry(n,e){return n.style.getPropertyValue(e)||sZ(n).getComputedStyle(n,null).getPropertyValue(e)}function Eue(n){return function(){delete this[n]}}function Tue(n,e){return function(){this[n]=e}}function Rue(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function Mue(n,e){return arguments.length>1?this.each((e==null?Eue:typeof e=="function"?Rue:Tue)(n,e)):this.node()[n]}function oZ(n){return n.trim().split(/^|\s+/)}function ik(n){return n.classList||new aZ(n)}function aZ(n){this._node=n,this._names=oZ(n.getAttribute("class")||"")}aZ.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function lZ(n,e){for(var t=ik(n),i=-1,r=e.length;++i<r;)t.add(e[i])}function uZ(n,e){for(var t=ik(n),i=-1,r=e.length;++i<r;)t.remove(e[i])}function kue(n){return function(){lZ(this,n)}}function Lue(n){return function(){uZ(this,n)}}function Pue(n,e){return function(){(e.apply(this,arguments)?lZ:uZ)(this,n)}}function Gue(n,e){var t=oZ(n+"");if(arguments.length<2){for(var i=ik(this.node()),r=-1,o=t.length;++r<o;)if(!i.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?Pue:e?kue:Lue)(t,e))}function Fue(){this.textContent=""}function Oue(n){return function(){this.textContent=n}}function Nue(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function Due(n){return arguments.length?this.each(n==null?Fue:(typeof n=="function"?Nue:Oue)(n)):this.node().textContent}function Vue(){this.innerHTML=""}function Bue(n){return function(){this.innerHTML=n}}function Zue(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function Wue(n){return arguments.length?this.each(n==null?Vue:(typeof n=="function"?Zue:Bue)(n)):this.node().innerHTML}function zue(){this.nextSibling&&this.parentNode.appendChild(this)}function Uue(){return this.each(zue)}function Xue(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Yue(){return this.each(Xue)}function Hue(n){var e=typeof n=="function"?n:QB(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Kue(){return null}function jue(n,e){var t=typeof n=="function"?n:QB(n),i=e==null?Kue:typeof e=="function"?e:nk(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),i.apply(this,arguments)||null)})}function $ue(){var n=this.parentNode;n&&n.removeChild(this)}function Jue(){return this.each($ue)}function que(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Que(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function ece(n){return this.select(n?Que:que)}function tce(n){return arguments.length?this.property("__data__",n):this.node().__data__}function nce(n){return function(e){n.call(this,e,this.__data__)}}function ice(n){return n.trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}})}function rce(n){return function(){var e=this.__on;if(e){for(var t=0,i=-1,r=e.length,o;t<r;++t)o=e[t],(!n.type||o.type===n.type)&&o.name===n.name?this.removeEventListener(o.type,o.listener,o.options):e[++i]=o;++i?e.length=i:delete this.__on}}}function sce(n,e,t){return function(){var i=this.__on,r,o=nce(e);if(i){for(var s=0,l=i.length;s<l;++s)if((r=i[s]).type===n.type&&r.name===n.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=t),r.value=e;return}}this.addEventListener(n.type,o,t),r={type:n.type,name:n.name,value:e,listener:o,options:t},i?i.push(r):this.__on=[r]}}function oce(n,e,t){var i=ice(n+""),r,o=i.length,s;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,h=l.length,d;u<h;++u)for(r=0,d=l[u];r<o;++r)if((s=i[r]).type===d.type&&s.name===d.name)return d.value}return}for(l=e?sce:rce,r=0;r<o;++r)this.each(l(i[r],e,t));return this}function cZ(n,e,t){var i=sZ(n),r=i.CustomEvent;typeof r=="function"?r=new r(e,t):(r=i.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),n.dispatchEvent(r)}function ace(n,e){return function(){return cZ(this,n,e)}}function lce(n,e){return function(){return cZ(this,n,e.apply(this,arguments))}}function uce(n,e){return this.each((typeof e=="function"?lce:ace)(n,e))}function*cce(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,o=i.length,s;r<o;++r)(s=i[r])&&(yield s)}var rk=[null];function Aa(n,e){this._groups=n,this._parents=e}function Mb(){return new Aa([[document.documentElement]],rk)}function hce(){return this}Aa.prototype=Mb.prototype={constructor:Aa,select:Dle,selectAll:Zle,selectChild:Xle,selectChildren:jle,filter:$le,data:nue,enter:Jle,exit:rue,join:sue,merge:oue,selection:hce,order:aue,sort:lue,call:cue,nodes:hue,node:due,size:fue,empty:pue,each:gue,attr:Iue,style:Sue,property:Mue,classed:Gue,text:Due,html:Wue,raise:Uue,lower:Yue,append:Hue,insert:jue,remove:Jue,clone:ece,datum:tce,on:oce,dispatch:uce,[Symbol.iterator]:cce};function ta(n){return typeof n=="string"?new Aa([[document.querySelector(n)]],[document.documentElement]):new Aa([[n]],rk)}function dce(n){let e;for(;e=n.sourceEvent;)n=e;return n}function yu(n,e){if(n=dce(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var i=t.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop]}}return[n.pageX,n.pageY]}function fce(n){return typeof n=="string"?new Aa([document.querySelectorAll(n)],[document.documentElement]):new Aa([eZ(n)],rk)}var pce={value:()=>{}};function sk(){for(var n=0,e=arguments.length,t={},i;n<e;++n){if(!(i=arguments[n]+"")||i in t||/[\s.]/.test(i))throw new Error("illegal type: "+i);t[i]=[]}return new vI(t)}function vI(n){this._=n}function gce(n,e){return n.trim().split(/^|\s+/).map(function(t){var i="",r=t.indexOf(".");if(r>=0&&(i=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}})}vI.prototype=sk.prototype={constructor:vI,on:function(n,e){var t=this._,i=gce(n+"",t),r,o=-1,s=i.length;if(arguments.length<2){for(;++o<s;)if((r=(n=i[o]).type)&&(r=mce(t[r],n.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(r=(n=i[o]).type)t[r]=W5(t[r],n.name,e);else if(e==null)for(r in t)t[r]=W5(t[r],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new vI(n)},call:function(n,e){if((r=arguments.length-2)>0)for(var t=new Array(r),i=0,r,o;i<r;++i)t[i]=arguments[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(o=this._[n],i=0,r=o.length;i<r;++i)o[i].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var i=this._[n],r=0,o=i.length;r<o;++r)i[r].value.apply(e,t)}};function mce(n,e){for(var t=0,i=n.length,r;t<i;++t)if((r=n[t]).name===e)return r.value}function W5(n,e,t){for(var i=0,r=n.length;i<r;++i)if(n[i].name===e){n[i]=pce,n=n.slice(0,i).concat(n.slice(i+1));break}return t!=null&&n.push({name:e,value:t}),n}var My=0,k0=0,h0=0,hZ=1e3,BC,L0,ZC=0,ng=0,aA=0,jv=typeof performance=="object"&&performance.now?performance:Date,dZ=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function ok(){return ng||(dZ(yce),ng=jv.now()+aA)}function yce(){ng=0}function WC(){this._call=this._time=this._next=null}WC.prototype=fZ.prototype={constructor:WC,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?ok():+t)+(e==null?0:+e),!this._next&&L0!==this&&(L0?L0._next=this:BC=this,L0=this),this._call=n,this._time=t,RT()},stop:function(){this._call&&(this._call=null,this._time=1/0,RT())}};function fZ(n,e,t){var i=new WC;return i.restart(n,e,t),i}function _ce(){ok(),++My;for(var n=BC,e;n;)(e=ng-n._time)>=0&&n._call.call(void 0,e),n=n._next;--My}function z5(){ng=(ZC=jv.now())+aA,My=k0=0;try{_ce()}finally{My=0,bce(),ng=0}}function vce(){var n=jv.now(),e=n-ZC;e>hZ&&(aA-=e,ZC=n)}function bce(){for(var n,e=BC,t,i=1/0;e;)e._call?(i>e._time&&(i=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:BC=t);L0=n,RT(i)}function RT(n){if(!My){k0&&(k0=clearTimeout(k0));var e=n-ng;e>24?(n<1/0&&(k0=setTimeout(z5,n-jv.now()-aA)),h0&&(h0=clearInterval(h0))):(h0||(ZC=jv.now(),h0=setInterval(vce,hZ)),My=1,dZ(z5))}}function U5(n,e,t){var i=new WC;return e=e==null?0:+e,i.restart(r=>{i.stop(),n(r+e)},e,t),i}var xce=sk("start","end","cancel","interrupt"),Ice=[],pZ=0,X5=1,MT=2,bI=3,Y5=4,kT=5,xI=6;function lA(n,e,t,i,r,o){var s=n.__transition;if(!s)n.__transition={};else if(t in s)return;Cce(n,t,{name:e,index:i,group:r,on:xce,tween:Ice,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:pZ})}function ak(n,e){var t=Zu(n,e);if(t.state>pZ)throw new Error("too late; already scheduled");return t}function Wc(n,e){var t=Zu(n,e);if(t.state>bI)throw new Error("too late; already running");return t}function Zu(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function Cce(n,e,t){var i=n.__transition,r;i[e]=t,t.timer=fZ(o,0,t.time);function o(h){t.state=X5,t.timer.restart(s,t.delay,t.time),t.delay<=h&&s(h-t.delay)}function s(h){var d,m,y,x;if(t.state!==X5)return u();for(d in i)if(x=i[d],x.name===t.name){if(x.state===bI)return U5(s);x.state===Y5?(x.state=xI,x.timer.stop(),x.on.call("interrupt",n,n.__data__,x.index,x.group),delete i[d]):+d<e&&(x.state=xI,x.timer.stop(),x.on.call("cancel",n,n.__data__,x.index,x.group),delete i[d])}if(U5(function(){t.state===bI&&(t.state=Y5,t.timer.restart(l,t.delay,t.time),l(h))}),t.state=MT,t.on.call("start",n,n.__data__,t.index,t.group),t.state===MT){for(t.state=bI,r=new Array(y=t.tween.length),d=0,m=-1;d<y;++d)(x=t.tween[d].value.call(n,n.__data__,t.index,t.group))&&(r[++m]=x);r.length=m+1}}function l(h){for(var d=h<t.duration?t.ease.call(null,h/t.duration):(t.timer.restart(u),t.state=kT,1),m=-1,y=r.length;++m<y;)r[m].call(n,d);t.state===kT&&(t.on.call("end",n,n.__data__,t.index,t.group),u())}function u(){t.state=xI,t.timer.stop(),delete i[e];for(var h in i)return;delete n.__transition}}function II(n,e){var t=n.__transition,i,r,o=!0,s;if(t){e=e==null?null:e+"";for(s in t){if((i=t[s]).name!==e){o=!1;continue}r=i.state>MT&&i.state<kT,i.state=xI,i.timer.stop(),i.on.call(r?"interrupt":"cancel",n,n.__data__,i.index,i.group),delete t[s]}o&&delete n.__transition}}function wce(n){return this.each(function(){II(this,n)})}function lk(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function gZ(n,e){var t=Object.create(n.prototype);for(var i in e)t[i]=e[i];return t}function kb(){}var $v=.7,zC=1/$v,hy="\\s*([+-]?\\d+)\\s*",Jv="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Mc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ace=/^#([0-9a-f]{3,8})$/,Sce=new RegExp(`^rgb\\(${hy},${hy},${hy}\\)$`),Ece=new RegExp(`^rgb\\(${Mc},${Mc},${Mc}\\)$`),Tce=new RegExp(`^rgba\\(${hy},${hy},${hy},${Jv}\\)$`),Rce=new RegExp(`^rgba\\(${Mc},${Mc},${Mc},${Jv}\\)$`),Mce=new RegExp(`^hsl\\(${Jv},${Mc},${Mc}\\)$`),kce=new RegExp(`^hsla\\(${Jv},${Mc},${Mc},${Jv}\\)$`),H5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};lk(kb,ig,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:K5,formatHex:K5,formatHex8:Lce,formatHsl:Pce,formatRgb:j5,toString:j5});function K5(){return this.rgb().formatHex()}function Lce(){return this.rgb().formatHex8()}function Pce(){return mZ(this).formatHsl()}function j5(){return this.rgb().formatRgb()}function ig(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=Ace.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?$5(e):t===3?new Ja(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?Px(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?Px(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Sce.exec(n))?new Ja(e[1],e[2],e[3],1):(e=Ece.exec(n))?new Ja(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Tce.exec(n))?Px(e[1],e[2],e[3],e[4]):(e=Rce.exec(n))?Px(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Mce.exec(n))?Q5(e[1],e[2]/100,e[3]/100,1):(e=kce.exec(n))?Q5(e[1],e[2]/100,e[3]/100,e[4]):H5.hasOwnProperty(n)?$5(H5[n]):n==="transparent"?new Ja(NaN,NaN,NaN,0):null}function $5(n){return new Ja(n>>16&255,n>>8&255,n&255,1)}function Px(n,e,t,i){return i<=0&&(n=e=t=NaN),new Ja(n,e,t,i)}function Gce(n){return n instanceof kb||(n=ig(n)),n?(n=n.rgb(),new Ja(n.r,n.g,n.b,n.opacity)):new Ja}function LT(n,e,t,i){return arguments.length===1?Gce(n):new Ja(n,e,t,i??1)}function Ja(n,e,t,i){this.r=+n,this.g=+e,this.b=+t,this.opacity=+i}lk(Ja,LT,gZ(kb,{brighter(n){return n=n==null?zC:Math.pow(zC,n),new Ja(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?$v:Math.pow($v,n),new Ja(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Ja(Zp(this.r),Zp(this.g),Zp(this.b),UC(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:J5,formatHex:J5,formatHex8:Fce,formatRgb:q5,toString:q5}));function J5(){return`#${Pp(this.r)}${Pp(this.g)}${Pp(this.b)}`}function Fce(){return`#${Pp(this.r)}${Pp(this.g)}${Pp(this.b)}${Pp((isNaN(this.opacity)?1:this.opacity)*255)}`}function q5(){const n=UC(this.opacity);return`${n===1?"rgb(":"rgba("}${Zp(this.r)}, ${Zp(this.g)}, ${Zp(this.b)}${n===1?")":`, ${n})`}`}function UC(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Zp(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Pp(n){return n=Zp(n),(n<16?"0":"")+n.toString(16)}function Q5(n,e,t,i){return i<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Iu(n,e,t,i)}function mZ(n){if(n instanceof Iu)return new Iu(n.h,n.s,n.l,n.opacity);if(n instanceof kb||(n=ig(n)),!n)return new Iu;if(n instanceof Iu)return n;n=n.rgb();var e=n.r/255,t=n.g/255,i=n.b/255,r=Math.min(e,t,i),o=Math.max(e,t,i),s=NaN,l=o-r,u=(o+r)/2;return l?(e===o?s=(t-i)/l+(t<i)*6:t===o?s=(i-e)/l+2:s=(e-t)/l+4,l/=u<.5?o+r:2-o-r,s*=60):l=u>0&&u<1?0:s,new Iu(s,l,u,n.opacity)}function Oce(n,e,t,i){return arguments.length===1?mZ(n):new Iu(n,e,t,i??1)}function Iu(n,e,t,i){this.h=+n,this.s=+e,this.l=+t,this.opacity=+i}lk(Iu,Oce,gZ(kb,{brighter(n){return n=n==null?zC:Math.pow(zC,n),new Iu(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?$v:Math.pow($v,n),new Iu(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,r=2*t-i;return new Ja(TS(n>=240?n-240:n+120,r,i),TS(n,r,i),TS(n<120?n+240:n-120,r,i),this.opacity)},clamp(){return new Iu(eO(this.h),Gx(this.s),Gx(this.l),UC(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=UC(this.opacity);return`${n===1?"hsl(":"hsla("}${eO(this.h)}, ${Gx(this.s)*100}%, ${Gx(this.l)*100}%${n===1?")":`, ${n})`}`}}));function eO(n){return n=(n||0)%360,n<0?n+360:n}function Gx(n){return Math.max(0,Math.min(1,n||0))}function TS(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const uk=n=>()=>n;function Nce(n,e){return function(t){return n+t*e}}function Dce(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(i){return Math.pow(n+i*e,t)}}function Vce(n){return(n=+n)==1?yZ:function(e,t){return t-e?Dce(e,t,n):uk(isNaN(e)?t:e)}}function yZ(n,e){var t=e-n;return t?Nce(n,t):uk(isNaN(n)?e:n)}const XC=(function n(e){var t=Vce(e);function i(r,o){var s=t((r=LT(r)).r,(o=LT(o)).r),l=t(r.g,o.g),u=t(r.b,o.b),h=yZ(r.opacity,o.opacity);return function(d){return r.r=s(d),r.g=l(d),r.b=u(d),r.opacity=h(d),r+""}}return i.gamma=n,i})(1);function Bce(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,i=e.slice(),r;return function(o){for(r=0;r<t;++r)i[r]=n[r]*(1-o)+e[r]*o;return i}}function Zce(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Wce(n,e){var t=e?e.length:0,i=n?Math.min(t,n.length):0,r=new Array(i),o=new Array(t),s;for(s=0;s<i;++s)r[s]=ck(n[s],e[s]);for(;s<t;++s)o[s]=e[s];return function(l){for(s=0;s<i;++s)o[s]=r[s](l);return o}}function zce(n,e){var t=new Date;return n=+n,e=+e,function(i){return t.setTime(n*(1-i)+e*i),t}}function vu(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function Uce(n,e){var t={},i={},r;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in n?t[r]=ck(n[r],e[r]):i[r]=e[r];return function(o){for(r in t)i[r]=t[r](o);return i}}var PT=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,RS=new RegExp(PT.source,"g");function Xce(n){return function(){return n}}function Yce(n){return function(e){return n(e)+""}}function _Z(n,e){var t=PT.lastIndex=RS.lastIndex=0,i,r,o,s=-1,l=[],u=[];for(n=n+"",e=e+"";(i=PT.exec(n))&&(r=RS.exec(e));)(o=r.index)>t&&(o=e.slice(t,o),l[s]?l[s]+=o:l[++s]=o),(i=i[0])===(r=r[0])?l[s]?l[s]+=r:l[++s]=r:(l[++s]=null,u.push({i:s,x:vu(i,r)})),t=RS.lastIndex;return t<e.length&&(o=e.slice(t),l[s]?l[s]+=o:l[++s]=o),l.length<2?u[0]?Yce(u[0].x):Xce(e):(e=u.length,function(h){for(var d=0,m;d<e;++d)l[(m=u[d]).i]=m.x(h);return l.join("")})}function ck(n,e){var t=typeof e,i;return e==null||t==="boolean"?uk(e):(t==="number"?vu:t==="string"?(i=ig(e))?(e=i,XC):_Z:e instanceof ig?XC:e instanceof Date?zce:Zce(e)?Bce:Array.isArray(e)?Wce:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Uce:vu)(n,e)}function Hce(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}var tO=180/Math.PI,GT={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function vZ(n,e,t,i,r,o){var s,l,u;return(s=Math.sqrt(n*n+e*e))&&(n/=s,e/=s),(u=n*t+e*i)&&(t-=n*u,i-=e*u),(l=Math.sqrt(t*t+i*i))&&(t/=l,i/=l,u/=l),n*i<e*t&&(n=-n,e=-e,u=-u,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(e,n)*tO,skewX:Math.atan(u)*tO,scaleX:s,scaleY:l}}var Fx;function Kce(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?GT:vZ(e.a,e.b,e.c,e.d,e.e,e.f)}function jce(n){return n==null||(Fx||(Fx=document.createElementNS("http://www.w3.org/2000/svg","g")),Fx.setAttribute("transform",n),!(n=Fx.transform.baseVal.consolidate()))?GT:(n=n.matrix,vZ(n.a,n.b,n.c,n.d,n.e,n.f))}function bZ(n,e,t,i){function r(h){return h.length?h.pop()+" ":""}function o(h,d,m,y,x,C){if(h!==m||d!==y){var w=x.push("translate(",null,e,null,t);C.push({i:w-4,x:vu(h,m)},{i:w-2,x:vu(d,y)})}else(m||y)&&x.push("translate("+m+e+y+t)}function s(h,d,m,y){h!==d?(h-d>180?d+=360:d-h>180&&(h+=360),y.push({i:m.push(r(m)+"rotate(",null,i)-2,x:vu(h,d)})):d&&m.push(r(m)+"rotate("+d+i)}function l(h,d,m,y){h!==d?y.push({i:m.push(r(m)+"skewX(",null,i)-2,x:vu(h,d)}):d&&m.push(r(m)+"skewX("+d+i)}function u(h,d,m,y,x,C){if(h!==m||d!==y){var w=x.push(r(x)+"scale(",null,",",null,")");C.push({i:w-4,x:vu(h,m)},{i:w-2,x:vu(d,y)})}else(m!==1||y!==1)&&x.push(r(x)+"scale("+m+","+y+")")}return function(h,d){var m=[],y=[];return h=n(h),d=n(d),o(h.translateX,h.translateY,d.translateX,d.translateY,m,y),s(h.rotate,d.rotate,m,y),l(h.skewX,d.skewX,m,y),u(h.scaleX,h.scaleY,d.scaleX,d.scaleY,m,y),h=d=null,function(x){for(var C=-1,w=y.length,S;++C<w;)m[(S=y[C]).i]=S.x(x);return m.join("")}}}var $ce=bZ(Kce,"px, ","px)","deg)"),Jce=bZ(jce,", ",")",")"),qce=1e-12;function nO(n){return((n=Math.exp(n))+1/n)/2}function Qce(n){return((n=Math.exp(n))-1/n)/2}function ehe(n){return((n=Math.exp(2*n))-1)/(n+1)}const the=(function n(e,t,i){function r(o,s){var l=o[0],u=o[1],h=o[2],d=s[0],m=s[1],y=s[2],x=d-l,C=m-u,w=x*x+C*C,S,T;if(w<qce)T=Math.log(y/h)/e,S=function(j){return[l+j*x,u+j*C,h*Math.exp(e*j*T)]};else{var M=Math.sqrt(w),G=(y*y-h*h+i*w)/(2*h*t*M),N=(y*y-h*h-i*w)/(2*y*t*M),V=Math.log(Math.sqrt(G*G+1)-G),W=Math.log(Math.sqrt(N*N+1)-N);T=(W-V)/e,S=function(j){var J=j*T,te=nO(V),ce=h/(t*M)*(te*ehe(e*J+V)-Qce(V));return[l+ce*x,u+ce*C,h*te/nO(e*J+V)]}}return S.duration=T*1e3*e/Math.SQRT2,S}return r.rho=function(o){var s=Math.max(.001,+o),l=s*s,u=l*l;return n(s,l,u)},r})(Math.SQRT2,2,4);function nhe(n,e){var t,i;return function(){var r=Wc(this,n),o=r.tween;if(o!==t){i=t=o;for(var s=0,l=i.length;s<l;++s)if(i[s].name===e){i=i.slice(),i.splice(s,1);break}}r.tween=i}}function ihe(n,e,t){var i,r;if(typeof t!="function")throw new Error;return function(){var o=Wc(this,n),s=o.tween;if(s!==i){r=(i=s).slice();for(var l={name:e,value:t},u=0,h=r.length;u<h;++u)if(r[u].name===e){r[u]=l;break}u===h&&r.push(l)}o.tween=r}}function rhe(n,e){var t=this._id;if(n+="",arguments.length<2){for(var i=Zu(this.node(),t).tween,r=0,o=i.length,s;r<o;++r)if((s=i[r]).name===n)return s.value;return null}return this.each((e==null?nhe:ihe)(t,n,e))}function hk(n,e,t){var i=n._id;return n.each(function(){var r=Wc(this,i);(r.value||(r.value={}))[e]=t.apply(this,arguments)}),function(r){return Zu(r,i).value[e]}}function xZ(n,e){var t;return(typeof e=="number"?vu:e instanceof ig?XC:(t=ig(e))?(e=t,XC):_Z)(n,e)}function she(n){return function(){this.removeAttribute(n)}}function ohe(n){return function(){this.removeAttributeNS(n.space,n.local)}}function ahe(n,e,t){var i,r=t+"",o;return function(){var s=this.getAttribute(n);return s===r?null:s===i?o:o=e(i=s,t)}}function lhe(n,e,t){var i,r=t+"",o;return function(){var s=this.getAttributeNS(n.space,n.local);return s===r?null:s===i?o:o=e(i=s,t)}}function uhe(n,e,t){var i,r,o;return function(){var s,l=t(this),u;return l==null?void this.removeAttribute(n):(s=this.getAttribute(n),u=l+"",s===u?null:s===i&&u===r?o:(r=u,o=e(i=s,l)))}}function che(n,e,t){var i,r,o;return function(){var s,l=t(this),u;return l==null?void this.removeAttributeNS(n.space,n.local):(s=this.getAttributeNS(n.space,n.local),u=l+"",s===u?null:s===i&&u===r?o:(r=u,o=e(i=s,l)))}}function hhe(n,e){var t=oA(n),i=t==="transform"?Jce:xZ;return this.attrTween(n,typeof e=="function"?(t.local?che:uhe)(t,i,hk(this,"attr."+n,e)):e==null?(t.local?ohe:she)(t):(t.local?lhe:ahe)(t,i,e))}function dhe(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function fhe(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function phe(n,e){var t,i;function r(){var o=e.apply(this,arguments);return o!==i&&(t=(i=o)&&fhe(n,o)),t}return r._value=e,r}function ghe(n,e){var t,i;function r(){var o=e.apply(this,arguments);return o!==i&&(t=(i=o)&&dhe(n,o)),t}return r._value=e,r}function mhe(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var i=oA(n);return this.tween(t,(i.local?phe:ghe)(i,e))}function yhe(n,e){return function(){ak(this,n).delay=+e.apply(this,arguments)}}function _he(n,e){return e=+e,function(){ak(this,n).delay=e}}function vhe(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?yhe:_he)(e,n)):Zu(this.node(),e).delay}function bhe(n,e){return function(){Wc(this,n).duration=+e.apply(this,arguments)}}function xhe(n,e){return e=+e,function(){Wc(this,n).duration=e}}function Ihe(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?bhe:xhe)(e,n)):Zu(this.node(),e).duration}function Che(n,e){if(typeof e!="function")throw new Error;return function(){Wc(this,n).ease=e}}function whe(n){var e=this._id;return arguments.length?this.each(Che(e,n)):Zu(this.node(),e).ease}function Ahe(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Wc(this,n).ease=t}}function She(n){if(typeof n!="function")throw new Error;return this.each(Ahe(this._id,n))}function Ehe(n){typeof n!="function"&&(n=nZ(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var o=e[r],s=o.length,l=i[r]=[],u,h=0;h<s;++h)(u=o[h])&&n.call(u,u.__data__,h,o)&&l.push(u);return new qh(i,this._parents,this._name,this._id)}function The(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,i=e.length,r=t.length,o=Math.min(i,r),s=new Array(i),l=0;l<o;++l)for(var u=e[l],h=t[l],d=u.length,m=s[l]=new Array(d),y,x=0;x<d;++x)(y=u[x]||h[x])&&(m[x]=y);for(;l<i;++l)s[l]=e[l];return new qh(s,this._parents,this._name,this._id)}function Rhe(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function Mhe(n,e,t){var i,r,o=Rhe(e)?ak:Wc;return function(){var s=o(this,n),l=s.on;l!==i&&(r=(i=l).copy()).on(e,t),s.on=r}}function khe(n,e){var t=this._id;return arguments.length<2?Zu(this.node(),t).on.on(n):this.each(Mhe(t,n,e))}function Lhe(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function Phe(){return this.on("end.remove",Lhe(this._id))}function Ghe(n){var e=this._name,t=this._id;typeof n!="function"&&(n=nk(n));for(var i=this._groups,r=i.length,o=new Array(r),s=0;s<r;++s)for(var l=i[s],u=l.length,h=o[s]=new Array(u),d,m,y=0;y<u;++y)(d=l[y])&&(m=n.call(d,d.__data__,y,l))&&("__data__"in d&&(m.__data__=d.__data__),h[y]=m,lA(h[y],e,t,y,h,Zu(d,t)));return new qh(o,this._parents,e,t)}function Fhe(n){var e=this._name,t=this._id;typeof n!="function"&&(n=tZ(n));for(var i=this._groups,r=i.length,o=[],s=[],l=0;l<r;++l)for(var u=i[l],h=u.length,d,m=0;m<h;++m)if(d=u[m]){for(var y=n.call(d,d.__data__,m,u),x,C=Zu(d,t),w=0,S=y.length;w<S;++w)(x=y[w])&&lA(x,e,t,w,y,C);o.push(y),s.push(d)}return new qh(o,s,e,t)}var Ohe=Mb.prototype.constructor;function Nhe(){return new Ohe(this._groups,this._parents)}function Dhe(n,e){var t,i,r;return function(){var o=Ry(this,n),s=(this.style.removeProperty(n),Ry(this,n));return o===s?null:o===t&&s===i?r:r=e(t=o,i=s)}}function IZ(n){return function(){this.style.removeProperty(n)}}function Vhe(n,e,t){var i,r=t+"",o;return function(){var s=Ry(this,n);return s===r?null:s===i?o:o=e(i=s,t)}}function Bhe(n,e,t){var i,r,o;return function(){var s=Ry(this,n),l=t(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(n),Ry(this,n))),s===u?null:s===i&&u===r?o:(r=u,o=e(i=s,l))}}function Zhe(n,e){var t,i,r,o="style."+e,s="end."+o,l;return function(){var u=Wc(this,n),h=u.on,d=u.value[o]==null?l||(l=IZ(e)):void 0;(h!==t||r!==d)&&(i=(t=h).copy()).on(s,r=d),u.on=i}}function Whe(n,e,t){var i=(n+="")=="transform"?$ce:xZ;return e==null?this.styleTween(n,Dhe(n,i)).on("end.style."+n,IZ(n)):typeof e=="function"?this.styleTween(n,Bhe(n,i,hk(this,"style."+n,e))).each(Zhe(this._id,n)):this.styleTween(n,Vhe(n,i,e),t).on("end.style."+n,null)}function zhe(n,e,t){return function(i){this.style.setProperty(n,e.call(this,i),t)}}function Uhe(n,e,t){var i,r;function o(){var s=e.apply(this,arguments);return s!==r&&(i=(r=s)&&zhe(n,s,t)),i}return o._value=e,o}function Xhe(n,e,t){var i="style."+(n+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Uhe(n,e,t??""))}function Yhe(n){return function(){this.textContent=n}}function Hhe(n){return function(){var e=n(this);this.textContent=e??""}}function Khe(n){return this.tween("text",typeof n=="function"?Hhe(hk(this,"text",n)):Yhe(n==null?"":n+""))}function jhe(n){return function(e){this.textContent=n.call(this,e)}}function $he(n){var e,t;function i(){var r=n.apply(this,arguments);return r!==t&&(e=(t=r)&&jhe(r)),e}return i._value=n,i}function Jhe(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,$he(n))}function qhe(){for(var n=this._name,e=this._id,t=CZ(),i=this._groups,r=i.length,o=0;o<r;++o)for(var s=i[o],l=s.length,u,h=0;h<l;++h)if(u=s[h]){var d=Zu(u,e);lA(u,n,t,h,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new qh(i,this._parents,n,t)}function Qhe(){var n,e,t=this,i=t._id,r=t.size();return new Promise(function(o,s){var l={value:s},u={value:function(){--r===0&&o()}};t.each(function(){var h=Wc(this,i),d=h.on;d!==n&&(e=(n=d).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),h.on=e}),r===0&&o()})}var ede=0;function qh(n,e,t,i){this._groups=n,this._parents=e,this._name=t,this._id=i}function CZ(){return++ede}var bh=Mb.prototype;qh.prototype={constructor:qh,select:Ghe,selectAll:Fhe,selectChild:bh.selectChild,selectChildren:bh.selectChildren,filter:Ehe,merge:The,selection:Nhe,transition:qhe,call:bh.call,nodes:bh.nodes,node:bh.node,size:bh.size,empty:bh.empty,each:bh.each,on:khe,attr:hhe,attrTween:mhe,style:Whe,styleTween:Xhe,text:Khe,textTween:Jhe,remove:Phe,tween:rhe,delay:vhe,duration:Ihe,ease:whe,easeVarying:She,end:Qhe,[Symbol.iterator]:bh[Symbol.iterator]};function tde(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var nde={time:null,delay:0,duration:250,ease:tde};function ide(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function rde(n){var e,t;n instanceof qh?(e=n._id,n=n._name):(e=CZ(),(t=nde).time=ok(),n=n==null?null:n+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var s=i[o],l=s.length,u,h=0;h<l;++h)(u=s[h])&&lA(u,n,e,h,s,t||ide(u,e));return new qh(i,this._parents,n,e)}Mb.prototype.interrupt=wce;Mb.prototype.transition=rde;function CI(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function sde(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function dk(n){let e,t,i;n.length!==2?(e=CI,t=(l,u)=>CI(n(l),u),i=(l,u)=>n(l)-u):(e=n===CI||n===sde?n:ode,t=n,i=n);function r(l,u,h=0,d=l.length){if(h<d){if(e(u,u)!==0)return d;do{const m=h+d>>>1;t(l[m],u)<0?h=m+1:d=m}while(h<d)}return h}function o(l,u,h=0,d=l.length){if(h<d){if(e(u,u)!==0)return d;do{const m=h+d>>>1;t(l[m],u)<=0?h=m+1:d=m}while(h<d)}return h}function s(l,u,h=0,d=l.length){const m=r(l,u,h,d-1);return m>h&&i(l[m-1],u)>-i(l[m],u)?m-1:m}return{left:r,center:s,right:o}}function ode(){return 0}function ade(n){return n===null?NaN:+n}const lde=dk(CI),ude=lde.right;dk(ade).center;function cde(n,e){let t,i;if(e===void 0)for(const r of n)r!=null&&(t===void 0?r>=r&&(t=i=r):(t>r&&(t=r),i<r&&(i=r)));else{let r=-1;for(let o of n)(o=e(o,++r,n))!=null&&(t===void 0?o>=o&&(t=i=o):(t>o&&(t=o),i<o&&(i=o)))}return[t,i]}const hde=Math.sqrt(50),dde=Math.sqrt(10),fde=Math.sqrt(2);function YC(n,e,t){const i=(e-n)/Math.max(0,t),r=Math.floor(Math.log10(i)),o=i/Math.pow(10,r),s=o>=hde?10:o>=dde?5:o>=fde?2:1;let l,u,h;return r<0?(h=Math.pow(10,-r)/s,l=Math.round(n*h),u=Math.round(e*h),l/h<n&&++l,u/h>e&&--u,h=-h):(h=Math.pow(10,r)*s,l=Math.round(n/h),u=Math.round(e/h),l*h<n&&++l,u*h>e&&--u),u<l&&.5<=t&&t<2?YC(n,e,t*2):[l,u,h]}function pde(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const i=e<n,[r,o,s]=i?YC(e,n,t):YC(n,e,t);if(!(o>=r))return[];const l=o-r+1,u=new Array(l);if(i)if(s<0)for(let h=0;h<l;++h)u[h]=(o-h)/-s;else for(let h=0;h<l;++h)u[h]=(o-h)*s;else if(s<0)for(let h=0;h<l;++h)u[h]=(r+h)/-s;else for(let h=0;h<l;++h)u[h]=(r+h)*s;return u}function FT(n,e,t){return e=+e,n=+n,t=+t,YC(n,e,t)[2]}function gde(n,e,t){e=+e,n=+n,t=+t;const i=e<n,r=i?FT(e,n,t):FT(n,e,t);return(i?-1:1)*(r<0?1/-r:r)}function mde(n){return n}var MS=1,kS=2,OT=3,P0=4,iO=1e-6;function yde(n){return"translate("+n+",0)"}function _de(n){return"translate(0,"+n+")"}function vde(n){return e=>+n(e)}function bde(n,e){return e=Math.max(0,n.bandwidth()-e*2)/2,n.round()&&(e=Math.round(e)),t=>+n(t)+e}function xde(){return!this.__axis}function wZ(n,e){var t=[],i=null,r=null,o=6,s=6,l=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,h=n===MS||n===P0?-1:1,d=n===P0||n===kS?"x":"y",m=n===MS||n===OT?yde:_de;function y(x){var C=i??(e.ticks?e.ticks.apply(e,t):e.domain()),w=r??(e.tickFormat?e.tickFormat.apply(e,t):mde),S=Math.max(o,0)+l,T=e.range(),M=+T[0]+u,G=+T[T.length-1]+u,N=(e.bandwidth?bde:vde)(e.copy(),u),V=x.selection?x.selection():x,W=V.selectAll(".domain").data([null]),j=V.selectAll(".tick").data(C,e).order(),J=j.exit(),te=j.enter().append("g").attr("class","tick"),ce=j.select("line"),pe=j.select("text");W=W.merge(W.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),j=j.merge(te),ce=ce.merge(te.append("line").attr("stroke","currentColor").attr(d+"2",h*o)),pe=pe.merge(te.append("text").attr("fill","currentColor").attr(d,h*S).attr("dy",n===MS?"0em":n===OT?"0.71em":"0.32em")),x!==V&&(W=W.transition(x),j=j.transition(x),ce=ce.transition(x),pe=pe.transition(x),J=J.transition(x).attr("opacity",iO).attr("transform",function(Y){return isFinite(Y=N(Y))?m(Y+u):this.getAttribute("transform")}),te.attr("opacity",iO).attr("transform",function(Y){var he=this.parentNode.__axis;return m((he&&isFinite(he=he(Y))?he:N(Y))+u)})),J.remove(),W.attr("d",n===P0||n===kS?s?"M"+h*s+","+M+"H"+u+"V"+G+"H"+h*s:"M"+u+","+M+"V"+G:s?"M"+M+","+h*s+"V"+u+"H"+G+"V"+h*s:"M"+M+","+u+"H"+G),j.attr("opacity",1).attr("transform",function(Y){return m(N(Y)+u)}),ce.attr(d+"2",h*o),pe.attr(d,h*S).text(w),V.filter(xde).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",n===kS?"start":n===P0?"end":"middle"),V.each(function(){this.__axis=N})}return y.scale=function(x){return arguments.length?(e=x,y):e},y.ticks=function(){return t=Array.from(arguments),y},y.tickArguments=function(x){return arguments.length?(t=x==null?[]:Array.from(x),y):t.slice()},y.tickValues=function(x){return arguments.length?(i=x==null?null:Array.from(x),y):i&&i.slice()},y.tickFormat=function(x){return arguments.length?(r=x,y):r},y.tickSize=function(x){return arguments.length?(o=s=+x,y):o},y.tickSizeInner=function(x){return arguments.length?(o=+x,y):o},y.tickSizeOuter=function(x){return arguments.length?(s=+x,y):s},y.tickPadding=function(x){return arguments.length?(l=+x,y):l},y.offset=function(x){return arguments.length?(u=+x,y):u},y}function AZ(n){return wZ(OT,n)}function SZ(n){return wZ(P0,n)}function Ide(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function Cde(n){return function(){return n}}function wde(n){return+n}var rO=[0,1];function Xm(n){return n}function NT(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:Cde(isNaN(e)?NaN:.5)}function Ade(n,e){var t;return n>e&&(t=n,n=e,e=t),function(i){return Math.max(n,Math.min(e,i))}}function Sde(n,e,t){var i=n[0],r=n[1],o=e[0],s=e[1];return r<i?(i=NT(r,i),o=t(s,o)):(i=NT(i,r),o=t(o,s)),function(l){return o(i(l))}}function Ede(n,e,t){var i=Math.min(n.length,e.length)-1,r=new Array(i),o=new Array(i),s=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++s<i;)r[s]=NT(n[s],n[s+1]),o[s]=t(e[s],e[s+1]);return function(l){var u=ude(n,l,1,i)-1;return o[u](r[u](l))}}function Tde(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Rde(){var n=rO,e=rO,t=ck,i,r,o,s=Xm,l,u,h;function d(){var y=Math.min(n.length,e.length);return s!==Xm&&(s=Ade(n[0],n[y-1])),l=y>2?Ede:Sde,u=h=null,m}function m(y){return y==null||isNaN(y=+y)?o:(u||(u=l(n.map(i),e,t)))(i(s(y)))}return m.invert=function(y){return s(r((h||(h=l(e,n.map(i),vu)))(y)))},m.domain=function(y){return arguments.length?(n=Array.from(y,wde),d()):n.slice()},m.range=function(y){return arguments.length?(e=Array.from(y),d()):e.slice()},m.rangeRound=function(y){return e=Array.from(y),t=Hce,d()},m.clamp=function(y){return arguments.length?(s=y?!0:Xm,d()):s!==Xm},m.interpolate=function(y){return arguments.length?(t=y,d()):t},m.unknown=function(y){return arguments.length?(o=y,m):o},function(y,x){return i=y,r=x,d()}}function Mde(){return Rde()(Xm,Xm)}function kde(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function HC(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,i=n.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+n.slice(t+1)]}function ky(n){return n=HC(Math.abs(n)),n?n[1]:NaN}function Lde(n,e){return function(t,i){for(var r=t.length,o=[],s=0,l=n[0],u=0;r>0&&l>0&&(u+l+1>i&&(l=Math.max(1,i-u)),o.push(t.substring(r-=l,r+l)),!((u+=l+1)>i));)l=n[s=(s+1)%n.length];return o.reverse().join(e)}}function Pde(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var Gde=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function KC(n){if(!(e=Gde.exec(n)))throw new Error("invalid format: "+n);var e;return new fk({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}KC.prototype=fk.prototype;function fk(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}fk.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Fde(n){e:for(var e=n.length,t=1,i=-1,r;t<e;++t)switch(n[t]){case".":i=r=t;break;case"0":i===0&&(i=t),r=t;break;default:if(!+n[t])break e;i>0&&(i=0);break}return i>0?n.slice(0,i)+n.slice(r+1):n}var EZ;function Ode(n,e){var t=HC(n,e);if(!t)return n+"";var i=t[0],r=t[1],o=r-(EZ=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+HC(n,Math.max(0,e+o-1))[0]}function sO(n,e){var t=HC(n,e);if(!t)return n+"";var i=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const oO={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:kde,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>sO(n*100,e),r:sO,s:Ode,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function aO(n){return n}var lO=Array.prototype.map,uO=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Nde(n){var e=n.grouping===void 0||n.thousands===void 0?aO:Lde(lO.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",i=n.currency===void 0?"":n.currency[1]+"",r=n.decimal===void 0?".":n.decimal+"",o=n.numerals===void 0?aO:Pde(lO.call(n.numerals,String)),s=n.percent===void 0?"%":n.percent+"",l=n.minus===void 0?"":n.minus+"",u=n.nan===void 0?"NaN":n.nan+"";function h(m){m=KC(m);var y=m.fill,x=m.align,C=m.sign,w=m.symbol,S=m.zero,T=m.width,M=m.comma,G=m.precision,N=m.trim,V=m.type;V==="n"?(M=!0,V="g"):oO[V]||(G===void 0&&(G=12),N=!0,V="g"),(S||y==="0"&&x==="=")&&(S=!0,y="0",x="=");var W=w==="$"?t:w==="#"&&/[boxX]/.test(V)?"0"+V.toLowerCase():"",j=w==="$"?i:/[%p]/.test(V)?s:"",J=oO[V],te=/[defgprs%]/.test(V);G=G===void 0?6:/[gprs]/.test(V)?Math.max(1,Math.min(21,G)):Math.max(0,Math.min(20,G));function ce(pe){var Y=W,he=j,D,re,le;if(V==="c")he=J(pe)+he,pe="";else{pe=+pe;var fe=pe<0||1/pe<0;if(pe=isNaN(pe)?u:J(Math.abs(pe),G),N&&(pe=Fde(pe)),fe&&+pe==0&&C!=="+"&&(fe=!1),Y=(fe?C==="("?C:l:C==="-"||C==="("?"":C)+Y,he=(V==="s"?uO[8+EZ/3]:"")+he+(fe&&C==="("?")":""),te){for(D=-1,re=pe.length;++D<re;)if(le=pe.charCodeAt(D),48>le||le>57){he=(le===46?r+pe.slice(D+1):pe.slice(D))+he,pe=pe.slice(0,D);break}}}M&&!S&&(pe=e(pe,1/0));var Le=Y.length+pe.length+he.length,we=Le<T?new Array(T-Le+1).join(y):"";switch(M&&S&&(pe=e(we+pe,we.length?T-he.length:1/0),we=""),x){case"<":pe=Y+pe+he+we;break;case"=":pe=Y+we+pe+he;break;case"^":pe=we.slice(0,Le=we.length>>1)+Y+pe+he+we.slice(Le);break;default:pe=we+Y+pe+he;break}return o(pe)}return ce.toString=function(){return m+""},ce}function d(m,y){var x=h((m=KC(m),m.type="f",m)),C=Math.max(-8,Math.min(8,Math.floor(ky(y)/3)))*3,w=Math.pow(10,-C),S=uO[8+C/3];return function(T){return x(w*T)+S}}return{format:h,formatPrefix:d}}var Ox,TZ,RZ;Dde({thousands:",",grouping:[3],currency:["$",""]});function Dde(n){return Ox=Nde(n),TZ=Ox.format,RZ=Ox.formatPrefix,Ox}function Vde(n){return Math.max(0,-ky(Math.abs(n)))}function Bde(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ky(e)/3)))*3-ky(Math.abs(n)))}function Zde(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,ky(e)-ky(n))+1}function Wde(n,e,t,i){var r=gde(n,e,t),o;switch(i=KC(i??",f"),i.type){case"s":{var s=Math.max(Math.abs(n),Math.abs(e));return i.precision==null&&!isNaN(o=Bde(r,s))&&(i.precision=o),RZ(i,s)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=Zde(r,Math.max(Math.abs(n),Math.abs(e))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=Vde(r))&&(i.precision=o-(i.type==="%")*2);break}}return TZ(i)}function zde(n){var e=n.domain;return n.ticks=function(t){var i=e();return pde(i[0],i[i.length-1],t??10)},n.tickFormat=function(t,i){var r=e();return Wde(r[0],r[r.length-1],t??10,i)},n.nice=function(t){t==null&&(t=10);var i=e(),r=0,o=i.length-1,s=i[r],l=i[o],u,h,d=10;for(l<s&&(h=s,s=l,l=h,h=r,r=o,o=h);d-- >0;){if(h=FT(s,l,t),h===u)return i[r]=s,i[o]=l,e(i);if(h>0)s=Math.floor(s/h)*h,l=Math.ceil(l/h)*h;else if(h<0)s=Math.ceil(s*h)/h,l=Math.floor(l*h)/h;else break;u=h}return n},n}function pk(){var n=Mde();return n.copy=function(){return Tde(n,pk())},Ide.apply(n,arguments),zde(n)}function yo(n){return function(){return n}}const DT=Math.PI,VT=2*DT,Cp=1e-6,Ude=VT-Cp;function MZ(n){this._+=n[0];for(let e=1,t=n.length;e<t;++e)this._+=arguments[e]+n[e]}function Xde(n){let e=Math.floor(n);if(!(e>=0))throw new Error(`invalid digits: ${n}`);if(e>15)return MZ;const t=10**e;return function(i){this._+=i[0];for(let r=1,o=i.length;r<o;++r)this._+=Math.round(arguments[r]*t)/t+i[r]}}class Yde{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?MZ:Xde(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,i,r){this._append`Q${+e},${+t},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(e,t,i,r,o,s){this._append`C${+e},${+t},${+i},${+r},${this._x1=+o},${this._y1=+s}`}arcTo(e,t,i,r,o){if(e=+e,t=+t,i=+i,r=+r,o=+o,o<0)throw new Error(`negative radius: ${o}`);let s=this._x1,l=this._y1,u=i-e,h=r-t,d=s-e,m=l-t,y=d*d+m*m;if(this._x1===null)this._append`M${this._x1=e},${this._y1=t}`;else if(y>Cp)if(!(Math.abs(m*u-h*d)>Cp)||!o)this._append`L${this._x1=e},${this._y1=t}`;else{let x=i-s,C=r-l,w=u*u+h*h,S=x*x+C*C,T=Math.sqrt(w),M=Math.sqrt(y),G=o*Math.tan((DT-Math.acos((w+y-S)/(2*T*M)))/2),N=G/M,V=G/T;Math.abs(N-1)>Cp&&this._append`L${e+N*d},${t+N*m}`,this._append`A${o},${o},0,0,${+(m*x>d*C)},${this._x1=e+V*u},${this._y1=t+V*h}`}}arc(e,t,i,r,o,s){if(e=+e,t=+t,i=+i,s=!!s,i<0)throw new Error(`negative radius: ${i}`);let l=i*Math.cos(r),u=i*Math.sin(r),h=e+l,d=t+u,m=1^s,y=s?r-o:o-r;this._x1===null?this._append`M${h},${d}`:(Math.abs(this._x1-h)>Cp||Math.abs(this._y1-d)>Cp)&&this._append`L${h},${d}`,i&&(y<0&&(y=y%VT+VT),y>Ude?this._append`A${i},${i},0,1,${m},${e-l},${t-u}A${i},${i},0,1,${m},${this._x1=h},${this._y1=d}`:y>Cp&&this._append`A${i},${i},0,${+(y>=DT)},${m},${this._x1=e+i*Math.cos(o)},${this._y1=t+i*Math.sin(o)}`)}rect(e,t,i,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function kZ(n){let e=3;return n.digits=function(t){if(!arguments.length)return e;if(t==null)e=null;else{const i=Math.floor(t);if(!(i>=0))throw new RangeError(`invalid digits: ${t}`);e=i}return n},()=>new Yde(e)}function LZ(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function PZ(n){this._context=n}PZ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,e){switch(n=+n,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,e):this._context.moveTo(n,e);break;case 1:this._point=2;default:this._context.lineTo(n,e);break}}};function GZ(n){return new PZ(n)}function FZ(n){return n[0]}function OZ(n){return n[1]}function NZ(n,e){var t=yo(!0),i=null,r=GZ,o=null,s=kZ(l);n=typeof n=="function"?n:n===void 0?FZ:yo(n),e=typeof e=="function"?e:e===void 0?OZ:yo(e);function l(u){var h,d=(u=LZ(u)).length,m,y=!1,x;for(i==null&&(o=r(x=s())),h=0;h<=d;++h)!(h<d&&t(m=u[h],h,u))===y&&((y=!y)?o.lineStart():o.lineEnd()),y&&o.point(+n(m,h,u),+e(m,h,u));if(x)return o=null,x+""||null}return l.x=function(u){return arguments.length?(n=typeof u=="function"?u:yo(+u),l):n},l.y=function(u){return arguments.length?(e=typeof u=="function"?u:yo(+u),l):e},l.defined=function(u){return arguments.length?(t=typeof u=="function"?u:yo(!!u),l):t},l.curve=function(u){return arguments.length?(r=u,i!=null&&(o=r(i)),l):r},l.context=function(u){return arguments.length?(u==null?i=o=null:o=r(i=u),l):i},l}function Hde(n,e,t){var i=null,r=yo(!0),o=null,s=GZ,l=null,u=kZ(h);n=typeof n=="function"?n:n===void 0?FZ:yo(+n),e=typeof e=="function"?e:yo(e===void 0?0:+e),t=typeof t=="function"?t:t===void 0?OZ:yo(+t);function h(m){var y,x,C,w=(m=LZ(m)).length,S,T=!1,M,G=new Array(w),N=new Array(w);for(o==null&&(l=s(M=u())),y=0;y<=w;++y){if(!(y<w&&r(S=m[y],y,m))===T)if(T=!T)x=y,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),C=y-1;C>=x;--C)l.point(G[C],N[C]);l.lineEnd(),l.areaEnd()}T&&(G[y]=+n(S,y,m),N[y]=+e(S,y,m),l.point(i?+i(S,y,m):G[y],t?+t(S,y,m):N[y]))}if(M)return l=null,M+""||null}function d(){return NZ().defined(r).curve(s).context(o)}return h.x=function(m){return arguments.length?(n=typeof m=="function"?m:yo(+m),i=null,h):n},h.x0=function(m){return arguments.length?(n=typeof m=="function"?m:yo(+m),h):n},h.x1=function(m){return arguments.length?(i=m==null?null:typeof m=="function"?m:yo(+m),h):i},h.y=function(m){return arguments.length?(e=typeof m=="function"?m:yo(+m),t=null,h):e},h.y0=function(m){return arguments.length?(e=typeof m=="function"?m:yo(+m),h):e},h.y1=function(m){return arguments.length?(t=m==null?null:typeof m=="function"?m:yo(+m),h):t},h.lineX0=h.lineY0=function(){return d().x(n).y(e)},h.lineY1=function(){return d().x(n).y(t)},h.lineX1=function(){return d().x(i).y(e)},h.defined=function(m){return arguments.length?(r=typeof m=="function"?m:yo(!!m),h):r},h.curve=function(m){return arguments.length?(s=m,o!=null&&(l=s(o)),h):s},h.context=function(m){return arguments.length?(m==null?o=l=null:l=s(o=m),h):o},h}const cl={bisector:dk,extent:cde,axisBottom:AZ,axisLeft:SZ,scaleLinear:pk,pointer:yu,select:ta,selectAll:fce,area:Hde,line:NZ};function Kde(n){const e=n.light!==void 0?n.light:!1,t=e?{top:0,right:0,bottom:0,left:0}:{top:10,right:20,bottom:30,left:40},i=n.hoverCallback!==void 0?n.hoverCallback:()=>{},r=n.outCallback!==void 0?n.outCallback:()=>{},o=n.distanceExtractor,s=n.linesConfiguration,l=Object.keys(s).length,u=cl.bisector(ce=>o(ce)).left,h=n.poiExtractor,d=n.styleDefs,m=n.poiLabelAngle!==void 0?n.poiLabelAngle:-60,y=ce=>String(ce),x={xhover:y,yhover:y,xtick:y,ytick:y,xlabel:()=>"Distance",ylabel:()=>"Elevation",...n.formatter},C=n.lightXAxis!==void 0?n.lightXAxis:!1;let w,S,T;const M=n.scaleModifier;let G,N,V,W,j;const J=ce=>{ce.each(function(pe){if(cl.select(this).selectAll("svg").remove(),pe===void 0)return;V=Math.max(this.clientWidth-t.right-t.left,0),S=cl.scaleLinear().range([0,V]),N=Math.max(this.clientHeight-t.top-t.bottom,0),T=cl.scaleLinear().range([N,0]);const Y=cl.axisBottom(S),he=cl.axisLeft(T),D=l===1?cl.area().x(q=>S(o(q))).y0(N).y1(q=>{const $e=Object.keys(s)[0];return T(s[$e].zExtractor(q))}):void 0;w=cl.select(this).selectAll("svg").data([pe]);const re=w.enter().append("svg");w=cl.select(this).selectAll("svg").data([pe]),d!==void 0&&re.append("defs").append("style").attr("type","text/css").text(d);const le=re.append("g");te(),le.style("font","11px Arial"),l===1&&le.append("path").attr("class","area").style("fill","rgba(222, 222, 222, 0.5)"),le.insert("g",":first-child").attr("class","grid-y"),e||(le.append("g").attr("class","x axis").attr("transform",`translate(0,${N})`),le.append("text").attr("class","x label").attr("text-anchor","end").attr("x",V-4).attr("y",N-4),le.append("g").attr("class","y axis"),le.append("text").attr("class","y label").attr("text-anchor","end").attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").style("fill","grey").text(x.ylabel()),le.append("g").attr("class","metas").attr("transform",`translate(${V+3}, 0)`)),le.append("g").attr("class","pois");const fe=le.append("g").attr("class","x grid-hover");fe.append("svg:line").attr("stroke-dasharray","5,5"),fe.append("text"),le.append("rect").attr("class","overlay").attr("width",V).attr("height",N).style("fill","none").style("pointer-events","all"),w.attr("width",V+t.left+t.right).attr("height",N+t.top+t.bottom),G=w.select("g").attr("transform",`translate(${t.left},${t.top})`),j=cl.extent(pe,q=>o(q)),S.domain(j);const Le=(()=>{let q=[];for(const $e in s){const Qe=cl.extent(pe,qe=>s[$e].zExtractor(qe));Qe.every(Number.isFinite)&&(q=q.concat(Qe))}return[Math.min.apply(null,q),Math.max.apply(null,q)]})();if(T.domain(Le),M!==void 0)M(S,T,V,N);else{const q=(Le[1]-Le[0])*.1;T.domain([Le[0]-q,Le[1]+q])}l===1&&G.select(".area").transition().attr("d",D);let we,se,Q;for(se in s)le.append("path").attr("class",`line ${se}`).style("stroke",s[se].color||"#F00").style("fill","none"),Q=le.append("g").attr("class",`y grid-hover ${se}`),Q.append("svg:line").attr("stroke-dasharray","5,5"),Q.append("text"),we=cl.line().x(q=>S(o(q))).y(q=>T(s[se].zExtractor(q))).defined(q=>s[se].zExtractor(q)!==null),G.select(`.line.${se}`).transition().attr("d",we);j[1]>2e3?W=1e3:W=1,e||(Y.tickFormat(q=>x.xtick(q/W)),C&&Y.tickValues([0,S.domain()[1]]),he.tickFormat(q=>x.ytick(q)),G.select(".x.axis").transition().call(Y),G.select(".x.label").text(x.xlabel(W)).style("fill","grey").style("shape-rendering","crispEdges"),N/15<10&&he.ticks(N/15),G.select(".y.axis").transition().call(he)),G.select(".grid-y").transition().call(he.tickSize(-V).tickFormat(()=>"")).selectAll(".tick line").style("stroke","#ccc").style("opacity",.7),G.selectAll(".axis").selectAll("path, line").style("fill","none").style("stroke","#000").style("shape-rendering","crispEdges"),G.select(".grid-y").select("path").style("stroke","none"),G.selectAll(".grid-hover line").style("stroke","#222").style("opacity",.8),G.select(".overlay").on("mouseout",()=>J.clearHighlight()).on("mousemove",q=>{const[$e]=cl.pointer(q),Qe=S.invert($e);J.highlight(Qe)})})};J.clearHighlight=()=>{G.selectAll(".grid-hover").style("display","none"),r.call(null)},J.highlight=ce=>{const pe=w.datum(),Y=u(pe,ce);if(Y>=pe.length)return;const he=pe[Y],D=o(he);let re;const le=[],fe={};let Le;for(Le in s)re=s[Le].zExtractor(he),Number.isFinite(re)?(le.push(re),fe[Le]=re,G.select(`.y.grid-hover.${Le}`).style("display","inline").select("line").attr("x1",S(0)).attr("y1",T(re)).attr("x2",V).attr("y2",T(re))):G.select(`.y.grid-hover.${Le}`).style("display","none");const we=T(Math.max.apply(null,le));G.select(".x.grid-hover").style("display","inline").select("line").attr("x1",S(D)).attr("y1",N).attr("x2",S(D)).attr("y2",Number.isFinite(we)?we:0);const se=D>j[1]/2;let Q=S(D);if(Q+=se?-10:10,G.select(".x.grid-hover text").text(x.xhover(D)).style("text-anchor",se?"end":"start").attr("transform",`translate(${Q},${N-10})`),l===1){const q=le[0]===null?"no value":x.yhover(le[0]);G.select(".y.grid-hover text").text(q).style("text-anchor",se?"end":"start").attr("transform",`translate(${Q},${T(le[0])-10})`)}i.call(null,he,D,fe)},J.showPois=ce=>{ce=ce!==void 0?ce:[];const pe=h,Y=w.select("g"),he=w.datum(),le=Y.select(".pois").selectAll(".poi").data(ce,fe=>{const Le=u(he,pe?Math.round(pe.dist(fe)*10)/10:void 0,1),we=he[Le];if(we){let se;const Q=[];for(se in s)Q.push(s[se].zExtractor(we));const q=Math.max.apply(null,Q);pe?.z(fe,q)}return pe?.id(fe)}).enter().append("g").attr("class","poi");le.append("text").attr("x",e?0:9).attr("dy",".35em").attr("text-anchor",e?"middle":"start"),le.append("line").style("shape-rendering","crispEdges"),le.style("opacity",0).transition().duration(1e3).delay(100).style("opacity",1),le.selectAll("text").attr("transform",fe=>e?[`translate(${S(pe.dist(fe))},${T(pe.z(fe))-10})`]:[`translate(${S(pe.dist(fe))},${T(pe.z(fe))-20}) rotate(${m})`]).text(fe=>pe.sort(fe)+(e?"":` - ${pe.title(fe)}`)),le.selectAll("line").style("stroke","grey").attr("x1",fe=>S(pe.dist(fe))).attr("y1",()=>T(T.domain()[0])).attr("x2",fe=>S(pe.dist(fe))).attr("y2",fe=>T(pe.z(fe))),le.exit().remove()};function te(){J.showPois([])}return J}const jde=st({__name:"d3-graph-elevation",props:{showTooltip:{type:Boolean,default:!0},dataset:{},highlightDistance:{},labelXFormatter:{},labelYFormatter:{},xFormatter:{},yFormatter:{}},emits:["hover:profile","out:profile"],setup(n,{emit:e}){const t=e,i=n,r=Ke();let o,s,l=(d,m,y)=>t("hover:profile",d,m,y);gr(()=>{s=ta(r.value),o=Kde(h()),u()}),kt(()=>i.highlightDistance,d=>{d&&d>0?o.highlight(d):o.clearHighlight()}),In(window,"resize",uy(u,50));function u(){o!==void 0&&s.datum(i.dataset).call(o)}function h(){return{linesConfiguration:{line1:{zExtractor:d=>parseFloat(d?.values?.dhm?.toPrecision(5))||0}},distanceExtractor:d=>d.dist??0,hoverCallback:l,outCallback:()=>t("out:profile"),formatter:{xhover:i.xFormatter,yhover:i.yFormatter,xlabel:i.labelXFormatter,ylabel:i.labelYFormatter}}}return(d,m)=>(U(),oe("div",{class:"h-[250px]",ref_key:"graphElement",ref:r},null,512))}}),$de={key:1,class:"text-center"},Jde=st({__name:"elevation-profile",props:{profileData:{},highlightDistance:{}},setup(n){const{t:e}=Ct();return(t,i)=>n.profileData?(U(),Mt(jde,{key:0,dataset:n.profileData,highlightDistance:n.highlightDistance,labelXFormatter:r=>`${k(e)("Distance")} [${r===1?"m":"km"}]`,labelYFormatter:()=>`${k(e)("Elevation")} [m]`,xFormatter:r=>k(af)(r,2),yFormatter:r=>k(vM)(r,1)},null,8,["dataset","highlightDistance","labelXFormatter","labelYFormatter","xFormatter","yFormatter"])):(U(),oe("div",$de,[...i[0]||(i[0]=[P("img",{class:"inline-block min-h-64 p-1",src:Gle,alt:""},null,-1)])]))}}),Gm=new Map;function qde(){Gm.clear()}class Qde{styleSerialToStyle(e){return e?JSON.parse(decodeURIComponent(e))||[]:[]}styleLocalStorageToStyle(e){return e?JSON.parse(e).medium||[]:[]}styleToSerial(e){return e&&e.length>0?JSON.stringify(e):""}styleToLocalStorage(e){return e&&e.length>0?JSON.stringify({medium:e}):""}}const Nx=new Qde;var pl=(n=>(n[n.simpleStyle=0]="simpleStyle",n[n.mediumStyle=1]="mediumStyle",n[n.advancedStyle=2]="advancedStyle",n))(pl||{});const efe=["line","fill","symbol","fill-extrusion","background","hillshade"],tfe="https://vectortiles-staging.geoportail.lu",nfe="https://migration.geoportail.lu/getvtstyle",ife="https://migration.geoportail.lu/uploadvtstyle",rfe="https://migration.geoportail.lu/deletevtstyle";class sfe{_vectortilesUrl=tfe;_mvtStylesGetUrl=nfe;_mvtStylesUploadUrl=ife;_mvtStylesDeleteUrl=rfe;get vectortilesUrl(){return this._vectortilesUrl===void 0&&console.warn("Warning: vectortilesUrl is not set."),this._vectortilesUrl}get mvtStylesGetUrl(){return this._mvtStylesGetUrl===void 0&&console.warn("Warning: mvtStylesGetUrl is not set."),this._mvtStylesGetUrl}get mvtStylesUploadUrl(){return this._mvtStylesUploadUrl===void 0&&console.warn("Warning: mvtStylesUploadUrl is not set."),this._mvtStylesUploadUrl}get mvtStylesDeleteUrl(){return this._mvtStylesDeleteUrl===void 0&&console.warn("Warning: mvtStylesDeleteUrl is not set."),this._mvtStylesDeleteUrl}setRegisterUrl_v3(e){e.get&&(this._mvtStylesGetUrl=e.get),e.upload&&(this._mvtStylesUploadUrl=e.upload),e.delete&&(this._mvtStylesDeleteUrl=e.delete),e.vectortiles&&(this._vectortilesUrl=e.vectortiles),console.warn("Deprecated: StylesUrlHelper.setRegisterUrl_v3() is meant to be removed when v4 is fully operational")}}const G0=new sfe;function Tf(){function n(w){const S=jl.getItem(vB),T=jl.getItem(bB)||"http";return(S?`${T}://${S}`:G0.vectortilesUrl)+`/styles/${w}/style.json`}function e(w){return`${G0.vectortilesUrl}/styles/${w}/{z}/{x}/{y}.png`}function t(w,S){const T=Eu();if(w==null)return;const M=new Map;T.bgVectorSources.forEach((G,N)=>{if(N===w.id){const V={...G,xyz_custom:S};M.set(N,V)}else M.set(N,G)}),T.setBgVectorSources(M)}function i(w,S,T=!1){const G=n(S),N=e(S),V={label:w,defaultMapBoxStyle:G,defaultMapBoxStyleXYZ:N,xyz:N,xyz_custom:"",style:G};if(!jl.getItem(Yv)){if(!T)return Promise.resolve(V)}return Promise.resolve(V)}function r(w){const S=Bh().medium_default_styles.road;if(w){w.colors.forEach((M,G)=>{S[G].color=M});const T=S.findIndex(M=>M.label==="Hillshade");S[T].visible=w.hillshade}return S}function o(w,S,T){if(!w||!S.get(w.id))return;const M=JSON.parse(JSON.stringify(S.get(w.id)));if(M&&!(!M||!M.layers))return T&&T.forEach(G=>{M?.layers.forEach((N,V)=>{for(const W of efe)if((G[`${W}s`]||[]).includes(N.id)){const J=Object.assign({},M.layers[V].paint);G.color&&(J[`${W}-color`]=G.color,J[`${W}-opacity`]=1,M.layers[V].paint=J),M.layers[V].layout=Object.assign({},M.layers[V].layout,{visibility:G.visible?"visible":"none"})}})}),M}function s(w){return w?fetch(`${G0.mvtStylesDeleteUrl}?id=${w}`).catch(console.warn):Promise.resolve()}async function l(w,S){await s(S);const T=new FormData,M=JSON.stringify(w),G=new Blob([M],{type:"application/json"});T.append("style",G,"style.json");const N={method:"POST",body:T};return fetch(G0.mvtStylesUploadUrl,N).then(V=>V.json()).then(V=>V.id).catch(console.warn)}function u(w,S){if(!S)return;const T=w.maplibreMap;T&&(T.loaded()?T.setStyle(S):new Promise(M=>T.once("data",M)).then(()=>T.setStyle(S)))}function h(w){return Bh().bg_layers.find(S=>S.id==w?.id)}function d(w){return h(w)?.vector_id}function m(w){return h(w)?.vector_id!==void 0}function y(w){const S=h(w),T=[...S?.simple_style_class?[pl.simpleStyle]:[],...S?.medium_style_class?[pl.mediumStyle]:[],...S?.expert_style_class?[pl.advancedStyle]:[]];return{isEditable:S?.vector_id!==void 0,styleEditors:T}}function x(w,S){return S.map(T=>Object.assign(T,{selected:T.colors.every((M,G)=>w[G]?.color===M)}))}function C(){const w=[],S=Eu();Bh().bg_layers.forEach(T=>{if(T.vector_id){const M=i(T.icon_id,T.vector_id);w.push(M.then(G=>({id:T.id,config:G})))}}),Promise.all(w).then(T=>{const M=new Map;T.forEach(G=>M.set(G.id,G.config)),S.setBgVectorSources(M)})}return{getDefaultMapBoxStyleUrl:n,getDefaultMapBoxStyleXYZ:e,setConfigForLayer:i,getRoadStyleFromSimpleStyle:r,applyDefaultStyle:o,applyConsolidatedStyle:u,getVectorId:d,setCustomStyleSerial:t,unregisterStyle:s,registerStyle:l,checkSelection:x,isLayerStyleEditable:m,getStyleCapabilitiesFromLayer:y,initBackgroundsConfigs:C}}const Eu=Sa("style",()=>{const n=Tf(),e=Ei(),t=Ei(new Map),i=Ei(new Map),r=Ei(!1),o=Ei(null),s=Ei();function l(C){t.value=C}function u(C){const w=new Map;i.value.forEach((S,T)=>{T!==C&&w.set(T,S)}),i.value=w}function h(C,w){const S=new Map;i.value.forEach((T,M)=>S.set(M,T)),S.set(C,w),i.value=S}function d(C){e.value=n.getRoadStyleFromSimpleStyle(C),y()}function m(C){e.value=C,y()}function y(){r.value=!1}function x(){r.value=!0}return{bgStyle:e,bgVectorSources:t,bgVectorBaseStyles:i,isExpertStyleActive:r,appliedStyle:s,removeBaseStyle:u,setBaseStyle:h,setBgVectorSources:l,setSimpleStyle:d,setStyle:m,disableExpertStyle:y,enableExpertStyle:x,styleSerial:o}},{});class ofe{styleWatcher;bootstrap(){const e=Eu();let t,i=!1;t=Ss(()=>{e.bgVectorSources&&(this.restore(!1),i&&this.persist(),i=!0,t&&t())})}persist(){const e=Eu(),{bgStyle:t}=xt(e);this.styleWatcher||(this.styleWatcher=kt(t,(i,r)=>{if(r!==i){const o=Wi();o.bgLayer&&e.bgVectorSources.has(o.bgLayer.id)&&(i&&i.length?Nn.setValue(o.bgLayer.name,i||[],Nx.styleToLocalStorage):Nn.removeItem(o.bgLayer.name),Nn.setValue(Yv,i||[],Nx.styleToSerial))}},{immediate:!0}))}restore(e){const t=Eu();t.setStyle(null);const r=Wi().bgLayer;if(r){let o=[];e||(o=Nn.getValue(Yv,Nx.styleSerialToStyle)),o.length===0&&(o=Nn.getValue(r.name,Nx.styleLocalStorageToStyle)),o&&o.length>0&&t.setStyle(o)}}}const DZ=new ofe;var Gp=(n=>(n.LAYER_OFFLINE_TILE="tile",n.LAYER_OFFLINE_VECTOR="vector",n.LAYER_OFFLINE_BG_VECTOR="bg_vector",n.LAYER_OFFLINE_BG_WMTS="off_bg_wmts",n))(Gp||{});const BT="id",ZT="label",VZ="layer_name",jC="metadata",afe="queryable_id",lfe="current_time",ufe="time",cfe="defaultMapBoxStyle";class hfe extends HM{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,r=e.viewState,o=r.resolution,s=this.getLayer().getSource(),l=e.viewHints;let u=e.extent;if(t.extent!==void 0&&(u=Sc(u,Wl(t.extent,r.projection))),!l[jr.ANIMATING]&&!l[jr.INTERACTING]&&!lg(u))if(s){const h=r.projection,d=s.getImage(u,o,i,h);d&&(this.loadImage(d)?this.image=d:d.getState()===An.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),r=Gs(t.pixelToCoordinateTransform,e.slice()),o=i.getExtent();if(o&&!Lc(o,r))return null;const s=this.image.getExtent(),l=this.image.getImage(),u=Ni(s),h=Math.floor(l.width*((r[0]-s[0])/u));if(h<0||h>=l.width)return null;const d=Ns(s),m=Math.floor(l.height*((s[3]-r[1])/d));return m<0||m>=l.height?null:this.getImageData(l,h,m)}renderFrame(e,t){const i=this.image,r=i.getExtent(),o=i.getResolution(),[s,l]=Array.isArray(o)?o:[o,o],u=i.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],d=e.pixelRatio,m=e.viewState,y=m.center,x=m.resolution,C=d*s/(x*u),w=d*l/(x*u);this.prepareContainer(e,t);const S=this.context.canvas.width,T=this.context.canvas.height,M=this.getRenderContext(e);let G=!1,N=!0;if(h.extent){const te=Wl(h.extent,m.projection);N=Os(te,e.extent),G=N&&!_c(te,e.extent),G&&this.clipUnrotated(M,e,te)}const V=i.getImage(),W=Lu(this.tempTransform,S/2,T/2,C,w,0,u*(r[0]-y[0])/s,u*(y[1]-r[3])/l);this.renderedResolution=l*d/u;const j=V.width*W[0],J=V.height*W[3];if(this.getLayer().getSource().getInterpolate()||(M.imageSmoothingEnabled=!1),this.preRender(M,e),N&&j>=.5&&J>=.5){const te=W[4],ce=W[5],pe=h.opacity;pe!==1&&(M.save(),M.globalAlpha=pe),M.drawImage(V,0,0,+V.width,+V.height,te,ce,j,J),pe!==1&&M.restore()}return this.postRender(this.context,e),G&&M.restore(),M.imageSmoothingEnabled=!0,this.container}}class dfe extends cg{constructor(e){e=e||{},super(e)}}class nv extends dfe{constructor(e){super(e)}createRenderer(){return new hfe(this)}getData(e){return super.getData(e)}}let LS;const dy=[];function cO(n,e,t,i,r){n.beginPath(),n.moveTo(0,0),n.lineTo(e,t),n.lineTo(i,r),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(e,i)+1,Math.max(t,r)),n.restore()}function PS(n,e){return Math.abs(n[e*4]-210)>2||Math.abs(n[e*4+3]-.75*255)>2}function ffe(){if(LS===void 0){const n=qs(6,6,dy);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",cO(n,4,5,4,0),cO(n,4,5,0,5);const e=n.getImageData(0,0,3,3).data;LS=PS(e,0)||PS(e,4)||PS(e,8),Ww(n),dy.push(n.canvas)}return LS}function qv(n,e,t,i){const r=gs(t,e,n);let o=Sv(e,i,t);const s=e.getMetersPerUnit();s!==void 0&&(o*=s);const l=n.getMetersPerUnit();l!==void 0&&(o/=l);const u=n.getExtent();if(!u||Lc(u,r)){const h=Sv(n,o,r)/o;isFinite(h)&&h>0&&(o/=h)}return o}function pfe(n,e,t,i){const r=ku(t);let o=qv(n,e,r,i);return(!isFinite(o)||o<=0)&&PR(t,function(s){return o=qv(n,e,s,i),isFinite(o)&&o>0}),o}function BZ(n,e,t,i,r,o,s,l,u,h,d,m,y,x){const C=qs(Math.round(t*n),Math.round(t*e),dy);if(m||(C.imageSmoothingEnabled=!1),u.length===0)return C.canvas;C.scale(t,t);function w(V){return Math.round(V*t)/t}C.globalCompositeOperation="lighter";const S=Qa();u.forEach(function(V,W,j){by(S,V.extent)});let T;const M=t/i,G=(m?1:1+Math.pow(2,-24))/M;(!y||u.length!==1||h!==0)&&(T=qs(Math.round(Ni(S)*M),Math.round(Ns(S)*M),dy),m||(T.imageSmoothingEnabled=!1),u.forEach(function(V,W,j){if(V.image.width>0&&V.image.height>0){if(V.clipExtent){T.save();const Y=(V.clipExtent[0]-S[0])*M,he=-(V.clipExtent[3]-S[3])*M,D=Ni(V.clipExtent)*M,re=Ns(V.clipExtent)*M;T.rect(m?Y:Math.round(Y),m?he:Math.round(he),m?D:Math.round(Y+D)-Math.round(Y),m?re:Math.round(he+re)-Math.round(he)),T.clip()}const J=(V.extent[0]-S[0])*M,te=-(V.extent[3]-S[3])*M,ce=Ni(V.extent)*M,pe=Ns(V.extent)*M;T.drawImage(V.image,h,h,V.image.width-2*h,V.image.height-2*h,m?J:Math.round(J),m?te:Math.round(te),m?ce:Math.round(J+ce)-Math.round(J),m?pe:Math.round(te+pe)-Math.round(te)),V.clipExtent&&T.restore()}}));const N=td(s);return l.getTriangles().forEach(function(V,W,j){const J=V.source,te=V.target;let ce=J[0][0],pe=J[0][1],Y=J[1][0],he=J[1][1],D=J[2][0],re=J[2][1];const le=w((te[0][0]-N[0])/o),fe=w(-(te[0][1]-N[1])/o),Le=w((te[1][0]-N[0])/o),we=w(-(te[1][1]-N[1])/o),se=w((te[2][0]-N[0])/o),Q=w(-(te[2][1]-N[1])/o),q=ce,$e=pe;ce=0,pe=0,Y-=q,he-=$e,D-=q,re-=$e;const Qe=[[Y,he,0,0,Le-le],[D,re,0,0,se-le],[0,0,Y,he,we-fe],[0,0,D,re,Q-fe]],qe=QX(Qe);if(!qe)return;if(C.save(),C.beginPath(),ffe()||!m){C.moveTo(Le,we);const Pt=4,zt=le-Le,Dt=fe-we;for(let yn=0;yn<Pt;yn++)C.lineTo(Le+w((yn+1)*zt/Pt),we+w(yn*Dt/(Pt-1))),yn!=Pt-1&&C.lineTo(Le+w((yn+1)*zt/Pt),we+w((yn+1)*Dt/(Pt-1)));C.lineTo(se,Q)}else C.moveTo(Le,we),C.lineTo(le,fe),C.lineTo(se,Q);C.clip(),C.transform(qe[0],qe[2],qe[1],qe[3],le,fe),C.translate(S[0]-q,S[3]-$e);let Lt;if(T)Lt=T.canvas,C.scale(G,-G);else{const Pt=u[0],zt=Pt.extent;Lt=Pt.image,C.scale(Ni(zt)/Lt.width,-Ns(zt)/Lt.height)}C.drawImage(Lt,0,0),C.restore()}),T&&(Ww(T),dy.push(T.canvas)),d&&(C.save(),C.globalCompositeOperation="source-over",C.strokeStyle="black",C.lineWidth=1,l.getTriangles().forEach(function(V,W,j){const J=V.target,te=(J[0][0]-N[0])/o,ce=-(J[0][1]-N[1])/o,pe=(J[1][0]-N[0])/o,Y=-(J[1][1]-N[1])/o,he=(J[2][0]-N[0])/o,D=-(J[2][1]-N[1])/o;C.beginPath(),C.moveTo(pe,Y),C.lineTo(te,ce),C.lineTo(he,D),C.closePath(),C.stroke()}),C.restore()),C.canvas}function WT(n){return Array.isArray(n)?Math.min(...n):n}const gfe=10,hO=.25;class ZZ{constructor(e,t,i,r,o,s,l){this.sourceProj_=e,this.targetProj_=t;let u={};const h=l?FE(G=>Gs(l,gs(G,this.targetProj_,this.sourceProj_))):ff(this.targetProj_,this.sourceProj_);this.transformInv_=function(G){const N=G[0]+"/"+G[1];return u[N]||(u[N]=h(G)),u[N]},this.maxSourceExtent_=r,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Ni(r)>=Ni(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Ni(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Ni(this.targetProj_.getExtent()):null;const d=td(i),m=kw(i),y=Mw(i),x=Rw(i),C=this.transformInv_(d),w=this.transformInv_(m),S=this.transformInv_(y),T=this.transformInv_(x),M=gfe+(s?Math.max(0,Math.ceil(Math.log2(RE(i)/(s*s*256*256)))):0);if(this.addQuad_(d,m,y,x,C,w,S,T,M),this.wrapsXInSource_){let G=1/0;this.triangles_.forEach(function(N,V,W){G=Math.min(G,N.source[0][0],N.source[1][0],N.source[2][0])}),this.triangles_.forEach(N=>{if(Math.max(N.source[0][0],N.source[1][0],N.source[2][0])-G>this.sourceWorldWidth_/2){const V=[[N.source[0][0],N.source[0][1]],[N.source[1][0],N.source[1][1]],[N.source[2][0],N.source[2][1]]];V[0][0]-G>this.sourceWorldWidth_/2&&(V[0][0]-=this.sourceWorldWidth_),V[1][0]-G>this.sourceWorldWidth_/2&&(V[1][0]-=this.sourceWorldWidth_),V[2][0]-G>this.sourceWorldWidth_/2&&(V[2][0]-=this.sourceWorldWidth_);const W=Math.min(V[0][0],V[1][0],V[2][0]);Math.max(V[0][0],V[1][0],V[2][0])-W<this.sourceWorldWidth_/2&&(N.source=V)}})}u={}}addTriangle_(e,t,i,r,o,s){this.triangles_.push({source:[r,o,s],target:[e,t,i]})}addQuad_(e,t,i,r,o,s,l,u,h){const d=Ks([o,s,l,u]),m=this.sourceWorldWidth_?Ni(d)/this.sourceWorldWidth_:null,y=this.sourceWorldWidth_,x=this.sourceProj_.canWrapX()&&m>.5&&m<1;let C=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const S=Ks([e,t,i,r]);C=Ni(S)/this.targetWorldWidth_>hO||C}!x&&this.sourceProj_.isGlobal()&&m&&(C=m>hO||C)}if(!C&&this.maxSourceExtent_&&isFinite(d[0])&&isFinite(d[1])&&isFinite(d[2])&&isFinite(d[3])&&!Os(d,this.maxSourceExtent_))return;let w=0;if(!C&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(u[0])||!isFinite(u[1]))){if(h>0)C=!0;else if(w=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(s[0])||!isFinite(s[1])?4:0)+(!isFinite(l[0])||!isFinite(l[1])?2:0)+(!isFinite(u[0])||!isFinite(u[1])?1:0),w!=1&&w!=2&&w!=4&&w!=8)return}if(h>0){if(!C){const S=[(e[0]+i[0])/2,(e[1]+i[1])/2],T=this.transformInv_(S);let M;x?M=(Gh(o[0],y)+Gh(l[0],y))/2-Gh(T[0],y):M=(o[0]+l[0])/2-T[0];const G=(o[1]+l[1])/2-T[1];C=M*M+G*G>this.errorThresholdSquared_}if(C){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const S=[(t[0]+i[0])/2,(t[1]+i[1])/2],T=this.transformInv_(S),M=[(r[0]+e[0])/2,(r[1]+e[1])/2],G=this.transformInv_(M);this.addQuad_(e,t,S,M,o,s,T,G,h-1),this.addQuad_(M,S,i,r,G,T,l,u,h-1)}else{const S=[(e[0]+t[0])/2,(e[1]+t[1])/2],T=this.transformInv_(S),M=[(i[0]+r[0])/2,(i[1]+r[1])/2],G=this.transformInv_(M);this.addQuad_(e,S,M,r,o,T,G,u,h-1),this.addQuad_(S,t,i,M,T,s,l,G,h-1)}return}}if(x){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(w&11)==0&&this.addTriangle_(e,i,r,o,l,u),(w&14)==0&&this.addTriangle_(e,i,t,o,l,s),w&&((w&13)==0&&this.addTriangle_(t,r,e,s,u,o),(w&7)==0&&this.addTriangle_(t,r,i,s,u,l))}calculateSourceExtent(){const e=Qa();return this.triangles_.forEach(function(t,i,r){const o=t.source;H0(e,o[0]),H0(e,o[1]),H0(e,o[2])}),e}getTriangles(){return this.triangles_}}const WZ=.5;class mfe extends jD{constructor(e,t,i,r,o,s,l){let u=e.getExtent();u&&e.canWrapX()&&(u=u.slice(),u[0]=-1/0,u[2]=1/0);let h=t.getExtent();h&&t.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const d=h?Sc(i,h):i,m=ku(d),y=qv(e,t,m,r),x=WZ,C=new ZZ(e,t,d,u,y*x,r),w=C.calculateSourceExtent(),S=lg(w)?null:s(w,y,o),T=S?An.IDLE:An.EMPTY,M=S?S.getPixelRatio():1;super(i,r,M,T),this.targetProj_=t,this.maxSourceExtent_=u,this.triangulation_=C,this.targetResolution_=r,this.targetExtent_=i,this.sourceImage_=S,this.sourcePixelRatio_=M,this.interpolate_=l,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==An.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==An.LOADED){const t=Ni(this.targetExtent_)/this.targetResolution_,i=Ns(this.targetExtent_)/this.targetResolution_;this.canvas_=BZ(t,i,this.sourcePixelRatio_,WT(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==An.IDLE){this.state=An.LOADING,this.changed();const e=this.sourceImage_.getState();e==An.LOADED||e==An.ERROR?this.reproject_():(this.sourceListenerKey_=In(this.sourceImage_,$n.CHANGE,t=>{const i=this.sourceImage_.getState();(i==An.LOADED||i==An.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){pr(this.sourceListenerKey_),this.sourceListenerKey_=null}}const tf=4,GS={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class yfe extends la{constructor(e,t){super(e),this.image=t}}class _fe extends KM{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const i=Dw(t,e,0);e=t[i]}return e}getImage(e,t,i,r){const o=this.getProjection();if(!o||!r||Oh(o,r))return o&&(r=o),this.getImageInternal(e,t,i,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Oh(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==t&&Up(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new mfe(o,r,e,t,i,(s,l,u)=>this.getImageInternal(s,l,u,o),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,r){if(this.loader){const o=zZ(e,t,i,1),s=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&_c(this.wantedExtent_,o)||_c(this.image.getExtent(),o))&&(this.wantedResolution_&&WT(this.wantedResolution_)===s||WT(this.image.getResolution())===s)))return this.image;this.wantedProjection_=r,this.wantedExtent_=o,this.wantedResolution_=s,this.image=new jD(o,s,i,this.loader),this.image.addEventListener($n.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case An.LOADING:this.loading=!0,i=GS.IMAGELOADSTART;break;case An.LOADED:this.loading=!1,i=GS.IMAGELOADEND;break;case An.ERROR:this.loading=!1,i=GS.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new yfe(i,t))}}function vfe(n,e){n.getImage().src=e}function zZ(n,e,t,i){const r=e/t,o=ku(n),s=Kd(Ni(n)/r,tf),l=Kd(Ns(n)/r,tf),u=Kd((i-1)*s/2,tf),h=s+2*u,d=Kd((i-1)*l/2,tf),m=l+2*d;return Av(o,r,0,[h,m])}function $C(n,e,t,i){return i!==void 0?(i[0]=n,i[1]=e,i[2]=t,i):[n,e,t]}function bfe(n,e,t){return n+"/"+e+"/"+t}function wI(n,e,t,i,r){return`${ti(n)},${e},${bfe(t,i,r)}`}function UZ(n){return xfe(n[0],n[1],n[2])}function xfe(n,e,t){return(e<<n)+t}function Ife(n,e){const t=n[0],i=n[1],r=n[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const o=e.getFullTileRange(t);return o?o.containsXY(i,r):!0}function Qv(n,e){const t=[];Object.keys(e).forEach(function(r){e[r]!==null&&e[r]!==void 0&&t.push(r+"="+encodeURIComponent(e[r]))});const i=t.join("&");return n=n.replace(/[?&]$/,""),n+=n.includes("?")?"&":"?",n+i}const Cfe=/\{z\}/g,wfe=/\{x\}/g,Afe=/\{y\}/g,Sfe=/\{-y\}/g;function Efe(n,e,t,i,r){return n.replace(Cfe,e.toString()).replace(wfe,t.toString()).replace(Afe,i.toString()).replace(Sfe,function(){if(r===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(r-i).toString()})}function XZ(n){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(n);if(t){const i=t[1].charCodeAt(0),r=t[2].charCodeAt(0);let o;for(o=i;o<=r;++o)e.push(n.replace(t[0],String.fromCharCode(o)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){const i=parseInt(t[2],10);for(let r=parseInt(t[1],10);r<=i;r++)e.push(n.replace(t[0],r.toString()));return e}return e.push(n),e}const JC="1.3.0",dO=[101,101];function YZ(n,e,t,i,r){r.WIDTH=t[0],r.HEIGHT=t[1];const o=i.getAxisOrientation(),s=GR(r.VERSION,"1.3")>=0;r[s?"CRS":"SRS"]=i.getCode();const l=s&&o.startsWith("ne")?[e[1],e[0],e[3],e[2]]:e;return r.BBOX=l.join(","),Qv(n,r)}function HZ(n,e,t,i,r,o,s){o=Object.assign({REQUEST:"GetMap"},o);const l=e/t,u=[IG(Ni(n)/l,tf),IG(Ns(n)/l,tf)];if(t!=1)switch(s){case"geoserver":const d=90*t+.5|0;"FORMAT_OPTIONS"in o?o.FORMAT_OPTIONS+=";dpi:"+d:o.FORMAT_OPTIONS="dpi:"+d;break;case"mapserver":o.MAP_RESOLUTION=90*t;break;case"carmentaserver":case"qgis":o.DPI=90*t;break;default:throw new Error("Unknown `serverType` configured")}return YZ(r,n,u,i,o)}function qC(n,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:JC,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},n)}function Tfe(n){const e=n.hidpi===void 0?!0:n.hidpi,t=Oi(n.projection||"EPSG:3857"),i=n.ratio||1.5,r=n.load||JD,o=n.crossOrigin??null;return(s,l,u)=>{s=zZ(s,l,u,i),u!=1&&(!e||n.serverType===void 0)&&(u=1);const h=HZ(s,l,u,t,n.url,qC(n.params,"GetMap"),n.serverType),d=new Image;return d.crossOrigin=o,r(d,h).then(m=>({image:m,extent:s,pixelRatio:u}))}}function Rfe(n,e,t){if(n.url===void 0)return;const i=Oi(n.projection||"EPSG:3857"),r=Av(e,t,0,dO),o={QUERY_LAYERS:n.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(o,qC(n.params,"GetFeatureInfo"),n.params);const s=Om((e[0]-r[0])/t,tf),l=Om((r[3]-e[1])/t,tf),u=GR(o.VERSION,"1.3")>=0;return o[u?"I":"X"]=s,o[u?"J":"Y"]=l,YZ(n.url,r,dO,i,o)}function Mfe(n,e){if(n.url===void 0)return;const t={SERVICE:"WMS",VERSION:JC,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e!==void 0){const i=Oi(n.projection||"EPSG:3857").getMetersPerUnit()||1,r=28e-5;t.SCALE=e*i/r}if(Object.assign(t,n.params),n.params!==void 0&&t.LAYER===void 0){const i=t.LAYERS;if(!(!Array.isArray(i)||i.length!==1))return;t.LAYER=i}return Qv(n.url,t)}class QC extends _fe{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:vfe,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,i,r){const o=Oi(i),s=this.getProjection();s&&s!==o&&(t=qv(s,o,e,t),e=gs(e,o,s));const l={url:this.url_,params:{...this.params_,...r},projection:s||o};return Rfe(l,e,t)}getLegendUrl(e,t){return Mfe({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,i,r){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==r)&&(this.loaderProjection_=r,this.loader=Tfe({crossOrigin:this.crossOrigin_,params:this.params_,projection:r,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(o,s)=>(this.image.setImage(o),this.imageLoadFunction_(this.image,s),JD(o))})),super.getImageInternal(e,t,i,r))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}function KZ(){return hb([5.31,49.38,6.64,50.21],Fu,Dp)}function jZ(n){return!!n?.metadata?.hasRetina&&AB()}function kfe(n,e="https"){const t=n.imageType.split("/")[1],i=Nn.getValue(Hy,UM)?"app.geoportail.lu":"geoportail.lu";return`${e==="https"?"//wmts{3-4}.":"//wmts{1-2}."}${i}/mapproxy_4_v3/wmts/{Layer}${jZ(n)?"_hd":""}/{TileMatrixSet}/{TileMatrix}/{TileCol}/{TileRow}.${t}`}class Lfe{createOlLayer(e){const{name:t,layers:i,imageType:r,url:o,id:s}=e,l=new QC({url:o||Uv.wmsProxyUrl,hidpi:AB(),serverType:"mapserver",params:{FORMAT:r,LAYERS:i},crossOrigin:"anonymous"});return new nv({properties:{"olcs.extent":KZ(),label:t,id:s},source:l})}setLayerTime(e,t){const i=e.getParams();i.TIME=t,e.updateParams(i)}}const $Z=new Lfe;function zT(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}const Pfe=new Error("disposed"),Gfe=[256,256];class fO extends qM{constructor(e){const t=Vn.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=zT(this.data_);return e?[e.width,e.height]:Gfe}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==Vn.IDLE&&this.state!==Vn.ERROR)return;this.state=Vn.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=Vn.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=Vn.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(Pfe),this.controller_=null),super.disposeInternal()}}class JZ extends qM{constructor(e,t,i,r,o,s,l,u,h,d,m,y){super(o,Vn.IDLE,y),this.renderEdges_=m!==void 0?m:!1,this.pixelRatio_=l,this.gutter_=u,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=s||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const x=r.getTileCoordExtent(this.wrappedTileCoord_),C=this.targetTileGrid_.getExtent();let w=this.sourceTileGrid_.getExtent();const S=C?Sc(x,C):x;if(RE(S)===0){this.state=Vn.EMPTY;return}const T=e.getExtent();T&&(w?w=Sc(w,T):w=T);const M=r.getResolution(this.wrappedTileCoord_[0]),G=pfe(e,i,S,M);if(!isFinite(G)||G<=0){this.state=Vn.EMPTY;return}const N=d!==void 0?d:WZ;if(this.triangulation_=new ZZ(e,i,S,w,G*N,M),this.triangulation_.getTriangles().length===0){this.state=Vn.EMPTY;return}this.sourceZ_=t.getZForResolution(G);let V=this.triangulation_.calculateSourceExtent();if(w&&(e.canWrapX()?(V[1]=Br(V[1],w[1],w[3]),V[3]=Br(V[3],w[1],w[3])):V=Sc(V,w)),!RE(V))this.state=Vn.EMPTY;else{let W=0,j=0;e.canWrapX()&&(W=Ni(T),j=Math.floor((V[0]-T[0])/W)),nD(V.slice(),e,!0).forEach(te=>{const ce=t.getTileRangeForExtentAndZ(te,this.sourceZ_);for(let pe=ce.minX;pe<=ce.maxX;pe++)for(let Y=ce.minY;Y<=ce.maxY;Y++){const he=h(this.sourceZ_,pe,Y,l);if(he){const D=j*W;this.sourceTiles_.push({tile:he,offset:D})}}++j}),this.sourceTiles_.length===0&&(this.state=Vn.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{const i=t.tile;if(i&&i.getState()==Vn.LOADED){const r=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);r[0]+=t.offset,r[2]+=t.offset;const o=this.clipExtent_?.slice();o&&(o[0]+=t.offset,o[2]+=t.offset),e.push({extent:r,clipExtent:o,image:i.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=Vn.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),r=typeof i=="number"?i:i[0],o=typeof i=="number"?i:i[1],s=this.targetTileGrid_.getResolution(t),l=this.sourceTileGrid_.getResolution(this.sourceZ_),u=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=BZ(r,o,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),s,u,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=Vn.LOADED}this.changed()}load(){if(this.state==Vn.IDLE){this.state=Vn.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const i=t.getState();if(i==Vn.IDLE||i==Vn.LOADING){e++;const r=In(t,$n.CHANGE,o=>{const s=t.getState();(s==Vn.LOADED||s==Vn.ERROR||s==Vn.EMPTY)&&(pr(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(r)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},i,r){t.getState()==Vn.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(pr),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Ww(this.canvas_.getContext("2d")),dy.push(this.canvas_),this.canvas_=null),super.release()}}class pO{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof Nw&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return fr(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return fr(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){fr(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function FS(n,e,t){if(!(t in n))return n[t]=new Set([e]),!0;const i=n[t],r=i.has(e);return r||i.add(e),!r}function Ffe(n,e,t){const i=n[t];return i?i.delete(e):!1}function gO(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=Sc(e,Wl(t.extent,n.viewState.projection)));const i=t.layer.getRenderSource();if(!i.getWrapX()){const r=i.getTileGridForProjection(n.viewState.projection).getExtent();r&&(e=Sc(e,r))}return e}class qZ extends HM{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Qa(),this.tempTileRange_=new QM(0,0,0,0),this.tempTileCoord_=$C(0,0,0);const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new pO(i),this.sourceTileCache_=null,this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new pO(512)),this.sourceTileCache_}getOrCreateTile(e,t,i,r){const o=this.tileCache_,l=this.getLayer().getSource(),u=wI(l,l.getKey(),e,t,i);let h;if(o.containsKey(u))h=o.get(u);else{const d=r.viewState.projection,m=l.getProjection();if(h=l.getTile(e,t,i,r.pixelRatio,d,!m||Oh(m,d)?void 0:this.getSourceTileCache()),!h)return null;o.set(u,h)}return h}getTile(e,t,i,r){const o=this.getOrCreateTile(e,t,i,r);return o||null}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),r=Gs(t.pixelToCoordinateTransform,e.slice()),o=i.getExtent();if(o&&!Lc(o,r))return null;const s=t.viewState,l=i.getRenderSource(),u=l.getTileGridForProjection(s.projection),h=l.getTilePixelRatio(t.pixelRatio);for(let d=u.getZForResolution(s.resolution);d>=u.getMinZoom();--d){const m=u.getTileCoordForCoordAndZ(r,d),y=this.getTile(d,m[1],m[2],t);if(!y||y.getState()!==Vn.LOADED)continue;const x=u.getOrigin(d),C=ia(u.getTileSize(d)),w=u.getResolution(d);let S;if(y instanceof KB||y instanceof JZ)S=y.getImage();else if(y instanceof fO){if(S=zT(y.getData()),!S)continue}else continue;const T=Math.floor(h*((r[0]-x[0])/w-m[1]*C[0])),M=Math.floor(h*((x[1]-r[1])/w-m[2]*C[1])),G=Math.round(h*l.getGutterForProjection(s.projection));return this.getImageData(S,T+G,M+G)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=i,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,i,r,o){const s=e.viewState,l=this.getLayer(),u=l.getRenderSource(),h=u.getTileGridForProjection(s.projection),d=ti(u);d in e.wantedTiles||(e.wantedTiles[d]={});const m=e.wantedTiles[d],y=l.getMapInternal(),x=Math.max(i-o,h.getMinZoom(),h.getZForResolution(Math.min(l.getMaxResolution(),y?y.getView().getResolutionForZoom(Math.max(l.getMinZoom(),0)):h.getResolution(0)),u.zDirection)),C=s.rotation,w=C?eD(s.center,s.resolution,C,e.size):void 0;for(let S=i;S>=x;--S){const T=h.getTileRangeForExtentAndZ(t,S,this.tempTileRange_),M=h.getResolution(S);for(let G=T.minX;G<=T.maxX;++G)for(let N=T.minY;N<=T.maxY;++N){if(C&&!h.tileCoordIntersectsViewport([S,G,N],w))continue;const V=this.getTile(S,G,N,e);if(!V||!FS(r,V,S))continue;const j=V.getKey();if(m[j]=!0,V.getState()===Vn.IDLE&&!e.tileQueue.isKeyQueued(j)){const J=$C(S,G,N,this.tempTileCoord_);e.tileQueue.enqueue([V,d,h.getTileCoordCenter(J),M])}}}}findStaleTile_(e,t){const i=this.tileCache_,r=e[0],o=e[1],s=e[2],l=this.getStaleKeys();for(let u=0;u<l.length;++u){const h=wI(this.getLayer().getSource(),l[u],r,o,s);if(i.containsKey(h)){const d=i.peek(h);if(d.getState()===Vn.LOADED)return d.endTransition(ti(this)),FS(t,d,r),!0}}return!1}findAltTiles_(e,t,i,r){const o=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!o)return!1;let s=!0;const l=this.tileCache_,u=this.getLayer().getRenderSource(),h=u.getKey();for(let d=o.minX;d<=o.maxX;++d)for(let m=o.minY;m<=o.maxY;++m){const y=wI(u,h,i,d,m);let x=!1;if(l.containsKey(y)){const C=l.peek(y);C.getState()===Vn.LOADED&&(FS(r,C,i),x=!0)}x||(s=!1)}return s}renderFrame(e,t){this.renderComplete=!0;const i=e.layerStatesArray[e.layerIndex],r=e.viewState,o=r.projection,s=r.resolution,l=r.center,u=e.pixelRatio,h=this.getLayer(),d=h.getSource(),m=d.getTileGridForProjection(o),y=m.getZForResolution(s,d.zDirection),x=m.getResolution(y),C=d.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==C&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=C):this.renderedSourceKey_=C;let w=e.extent;const S=d.getTilePixelRatio(u);this.prepareContainer(e,t);const T=this.context.canvas.width,M=this.context.canvas.height,G=i.extent&&Wl(i.extent);G&&(w=Sc(w,Wl(i.extent)));const N=x*T/2/S,V=x*M/2/S,W=[l[0]-N,l[1]-V,l[0]+N,l[1]+V],j={};this.renderedTiles.length=0;const J=h.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){const Le=m.getZForResolution(r.nextResolution,d.zDirection),we=gO(e,e.nextExtent);this.enqueueTiles(e,we,Le,j,J)}const te=gO(e,w);if(this.enqueueTiles(e,te,y,j,0),J>0&&setTimeout(()=>{this.enqueueTiles(e,te,y-1,j,J-1)},0),!(y in j))return this.container;const ce=ti(this),pe=e.time;for(const Le of j[y]){const we=Le.getState();if(we===Vn.EMPTY)continue;const se=Le.tileCoord;if(we===Vn.LOADED&&Le.getAlpha(ce,pe)===1){Le.endTransition(ce);continue}if(we!==Vn.ERROR&&(this.renderComplete=!1),this.findStaleTile_(se,j)){Ffe(j,Le,y),e.animate=!0;continue}if(this.findAltTiles_(m,se,y+1,j))continue;const $e=m.getMinZoom();for(let Qe=y-1;Qe>=$e&&!this.findAltTiles_(m,se,Qe,j);--Qe);}const Y=x/s*u/S,he=this.getRenderContext(e);Lu(this.tempTransform,T/2,M/2,Y,Y,0,-T/2,-M/2),i.extent&&this.clipUnrotated(he,e,G),d.getInterpolate()||(he.imageSmoothingEnabled=!1),this.preRender(he,e);const D=Object.keys(j).map(Number);D.sort(Ec);let re;const le=[],fe=[];for(let Le=D.length-1;Le>=0;--Le){const we=D[Le],se=d.getTilePixelSize(we,u,o),q=m.getResolution(we)/x,$e=se[0]*q*Y,Qe=se[1]*q*Y,qe=m.getTileCoordForCoordAndZ(td(W),we),Lt=m.getTileCoordExtent(qe),Pt=Gs(this.tempTransform,[S*(Lt[0]-W[0])/x,S*(W[3]-Lt[3])/x]),zt=S*d.getGutterForProjection(o);for(const Dt of j[we]){if(Dt.getState()!==Vn.LOADED)continue;const yn=Dt.tileCoord,tn=qe[1]-yn[1],Ne=Math.round(Pt[0]-(tn-1)*$e),Be=qe[2]-yn[2],z=Math.round(Pt[1]-(Be-1)*Qe),We=Math.round(Pt[0]-tn*$e),ke=Math.round(Pt[1]-Be*Qe),ge=Ne-We,ie=z-ke,Ce=D.length===1;let Te=!1;re=[We,ke,We+ge,ke,We+ge,ke+ie,We,ke+ie];for(let De=0,Ze=le.length;De<Ze;++De)if(!Ce&&we<fe[De]){const Je=le[De];Os([We,ke,We+ge,ke+ie],[Je[0],Je[3],Je[4],Je[7]])&&(Te||(he.save(),Te=!0),he.beginPath(),he.moveTo(re[0],re[1]),he.lineTo(re[2],re[3]),he.lineTo(re[4],re[5]),he.lineTo(re[6],re[7]),he.moveTo(Je[6],Je[7]),he.lineTo(Je[4],Je[5]),he.lineTo(Je[2],Je[3]),he.lineTo(Je[0],Je[1]),he.clip())}le.push(re),fe.push(we),this.drawTile(Dt,e,We,ke,ge,ie,zt,Ce),Te&&he.restore(),this.renderedTiles.unshift(Dt),this.updateUsedTiles(e.usedTiles,d,Dt)}}if(this.renderedResolution=x,this.extentChanged=!this.renderedExtent_||!Up(this.renderedExtent_,W),this.renderedExtent_=W,this.renderedPixelRatio=u,this.postRender(this.context,e),i.extent&&he.restore(),he.imageSmoothingEnabled=!0,this.renderComplete){const Le=(we,se)=>{const Q=ti(d),q=se.wantedTiles[Q],$e=q?Object.keys(q).length:0;this.updateCacheSize($e),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()};e.postRenderFunctions.push(Le)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,i,r,o,s,l,u){let h;if(e instanceof fO){if(h=zT(e.getData()),!h)throw new Error("Rendering array data is not yet supported")}else h=this.getTileImage(e);if(!h)return;const d=this.getRenderContext(t),m=ti(this),y=t.layerStatesArray[t.layerIndex],x=y.opacity*(u?e.getAlpha(m,t.time):1),C=x!==d.globalAlpha;C&&(d.save(),d.globalAlpha=x),d.drawImage(h,l,l,h.width-2*l,h.height-2*l,i,r,o,s),C&&d.restore(),x!==y.opacity?t.animate=!0:u&&e.endTransition(m)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){const r=ti(t);r in e||(e[r]={}),e[r][i.getKey()]=!0}}const nf={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Ofe extends cg{constructor(e){e=e||{};const t=Object.assign({},e),i=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(nf.PRELOAD)}setPreload(e){this.set(nf.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(nf.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(nf.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class Ym extends Ofe{constructor(e){super(e)}createRenderer(){return new qZ(this,{cacheSize:this.getCacheSize()})}}const Im=[0,0,0],Fd=5;class uA{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,fr(OY(this.resolutions_,(r,o)=>o-r),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let r=0,o=this.resolutions_.length-1;r<o;++r)if(!t)t=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,fr(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=td(i)),fr(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,fr(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:rM,fr(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((r,o)=>{const s=new QM(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const l=this.getTileRangeForExtentAndZ(i,o);s.minX=Math.max(l.minX,s.minX),s.maxX=Math.min(l.maxX,s.maxX),s.minY=Math.max(l.minY,s.minY),s.maxY=Math.min(l.maxY,s.maxY)}return s}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const r=this.getTileRangeForExtentAndZ(e,t);for(let o=r.minX,s=r.maxX;o<=s;++o)for(let l=r.minY,u=r.maxY;l<=u;++l)i([t,o,l])}forEachTileCoordParentTileRange(e,t,i,r){let o,s,l,u=null,h=e[0]-1;for(this.zoomFactor_===2?(s=e[1],l=e[2]):u=this.getTileCoordExtent(e,r);h>=this.minZoom;){if(s!==void 0&&l!==void 0?(s=Math.floor(s/2),l=Math.floor(l/2),o=xm(s,s,l,l,i)):o=this.getTileRangeForExtentAndZ(u,h,i),t(h,o))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const o=e[1]*2,s=e[2]*2;return xm(o,o+1,s,s+1,t)}const r=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const r=e[0],o=e[1],s=e[2];if(t===r)return xm(o,s,o,s,i);if(this.zoomFactor_){const u=Math.pow(this.zoomFactor_,t-r),h=Math.floor(o*u),d=Math.floor(s*u);if(t<r)return xm(h,h,d,d,i);const m=Math.floor(u*(o+1))-1,y=Math.floor(u*(s+1))-1;return xm(h,m,d,y,i)}const l=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,Im);const r=Im[1],o=Im[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,Im);const s=Im[1],l=Im[2];return xm(r,s,o,l,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),r=ia(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*i,t[1]-(e[2]+.5)*r[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),r=this.getResolution(e[0]),o=ia(this.getTileSize(e[0]),this.tmpSize_),s=i[0]+e[1]*o[0]*r,l=i[1]-(e[2]+1)*o[1]*r,u=s+o[0]*r,h=l+o[1]*r;return Pc(s,l,u,h,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,r,o){const s=this.getZForResolution(i),l=i/this.getResolution(s),u=this.getOrigin(s),h=ia(this.getTileSize(s),this.tmpSize_);let d=l*(e-u[0])/i/h[0],m=l*(u[1]-t)/i/h[1];return r?(d=Kd(d,Fd)-1,m=Kd(m,Fd)-1):(d=Om(d,Fd),m=Om(m,Fd)),$C(s,d,m,o)}getTileCoordForXYAndZ_(e,t,i,r,o){const s=this.getOrigin(i),l=this.getResolution(i),u=ia(this.getTileSize(i),this.tmpSize_);let h=(e-s[0])/l/u[0],d=(s[1]-t)/l/u[1];return r?(h=Kd(h,Fd)-1,d=Kd(d,Fd)-1):(h=Om(h,Fd),d=Om(d,Fd)),$C(i,h,d,o)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=Dw(this.resolutions_,e,t||0);return Br(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return TD(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let r=this.minZoom;r<t;++r)i[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=i}}class gk extends uA{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function Nfe(n,e){return(function(t,i,r){if(!t)return;let o;const s=t[0];if(e){const l=e.getFullTileRange(s);l&&(o=l.getHeight()-1)}return Efe(n,s,t[1],t[2],o)})}function Dfe(n,e){const t=n.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=Nfe(n[r],e);return UT(i)}function UT(n){return n.length===1?n[0]:(function(e,t,i){if(!e)return;const r=UZ(e),o=Gh(r,n.length);return n[o](e,t,i)})}function QZ(n){let e=n.getDefaultTileGrid();return e||(e=Wfe(n),n.setDefaultTileGrid(e)),e}function Vfe(n,e,t){const i=e[0],r=n.getTileCoordCenter(e),o=mk(t);if(!Lc(o,r)){const s=Ni(o),l=Math.ceil((o[0]-r[0])/s);return r[0]+=s*l,n.getTileCoordForCoordAndZ(r,i)}return e}function Bfe(n,e,t,i){i=i!==void 0?i:"top-left";const r=eW(n,e,t);return new uA({extent:n,origin:KX(n,i),resolutions:r,tileSize:t})}function Zfe(n){const e=n||{},t=e.extent||Oi("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:eW(t,e.maxZoom,e.tileSize,e.maxResolution)};return new uA(i)}function eW(n,e,t,i){e=e!==void 0?e:bH,t=ia(t!==void 0?t:rM);const r=Ns(n),o=Ni(n);i=i>0?i:Math.max(o/t[0],r/t[1]);const s=e+1,l=new Array(s);for(let u=0;u<s;++u)l[u]=i/Math.pow(2,u);return l}function Wfe(n,e,t,i){const r=mk(n);return Bfe(r,e,t,i)}function mk(n){n=Oi(n);let e=n.getExtent();if(!e){const t=180*Xp.degrees/n.getMetersPerUnit();e=Pc(-t,-t,t,t)}return e}class zfe extends KM{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&ia(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||ti(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,r,o,s){return Zn()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:QZ(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const r=this.getTileGridForProjection(i),o=this.getTilePixelRatio(t),s=ia(r.getTileSize(e),this.tmpSize);return o==1?s:fK(s,o,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const i=t!==void 0?t:this.getProjection(),r=t!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=Vfe(r,e,i)),Ife(e,r)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class Ufe extends la{constructor(e,t){super(e),this.tile=t}}const OS={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class yk extends zfe{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===yk.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=ti(t),r=t.getState();let o;r==Vn.LOADING?(this.tileLoadingKeys_[i]=!0,o=OS.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],o=r==Vn.ERROR?OS.TILELOADERROR:r==Vn.LOADED?OS.TILELOADEND:void 0),o!=null&&this.dispatchEvent(new Ufe(o,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=XZ(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Dfe(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}}class _k extends yk{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:tW,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:KB,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!Oh(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Oh(t,e)))return this.tileGrid;const i=ti(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=QZ(e)),this.tileGridForProjection[i]}createTile_(e,t,i,r,o,s){const l=[e,t,i],u=this.getTileCoordForTileUrlFunction(l,o),h=u?this.tileUrlFunction(u,r,o):void 0,d=new this.tileClass(l,h!==void 0?Vn.IDLE:Vn.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return d.key=s,d.addEventListener($n.CHANGE,this.handleTileChange.bind(this)),d}getTile(e,t,i,r,o,s){const l=this.getProjection();if(!l||!o||Oh(l,o))return this.getTileInternal(e,t,i,r,l||o);const u=[e,t,i],h=this.getKey(),d=this.getTileGridForProjection(l),m=this.getTileGridForProjection(o),y=this.getTileCoordForTileUrlFunction(u,o),x=new JZ(l,d,o,m,u,y,this.getTilePixelRatio(r),this.getGutter(),(C,w,S,T)=>this.getTileInternal(C,w,S,T,l,s),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return x.key=h,x}getTileInternal(e,t,i,r,o,s){const l=this.getKey(),u=wI(this,l,e,t,i);if(s&&s.containsKey(u))return s.get(u);const h=this.createTile_(e,t,i,r,o,l);return s?.set(u,h),h}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const i=Oi(e);if(i){const r=ti(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}}function tW(n,e){if(Il){const t=n.getCrossOrigin();let i="same-origin",r="same-origin";t==="anonymous"||t===""?(i="cors",r="omit"):t==="use-credentials"&&(i="cors",r="include"),fetch(e,{mode:i,credentials:r}).then(o=>{if(!o.ok)throw new Error(`HTTP ${o.status}`);return o.blob()}).then(o=>createImageBitmap(o)).then(o=>{const s=n.getImage();s.width=o.width,s.height=o.height,s.getContext("2d").drawImage(o,0,0),o.close?.(),s.dispatchEvent(new Event("load"))}).catch(()=>{n.getImage().dispatchEvent(new Event("error"))});return}n.getImage().src=e}class eb extends _k{constructor(e){const t=e.requestEncoding!==void 0?e.requestEncoding:"KVP",i=e.tileGrid;let r=e.urls;r===void 0&&e.url!==void 0&&(r=XZ(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:r,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),r&&r.length>0&&(this.tileUrlFunction=UT(r.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join(`
`);this.setTileUrlFunction(UT(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t=="KVP"&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t=="KVP"?Qv(e,i):e.replace(/\{(\w+?)\}/g,function(s,l){return l.toLowerCase()in i?i[l.toLowerCase()]:s});const r=this.tileGrid,o=this.dimensions_;return(function(s,l,u){if(!s)return;const h={TileMatrix:r.getMatrixId(s[0]),TileCol:s[1],TileRow:s[2]};Object.assign(h,o);let d=e;return t=="KVP"?d=Qv(d,h):d=d.replace(/\{(\w+?)\}/g,function(m,y){return encodeURIComponent(h[y])}),d})}}const Xfe=[156543.033928,78271.516964,39135.758482,19567.879241,9783.9396205,4891.96981025,2445.98490513,1222.99245256,611.496226281,305.748113141,152.87405657,76.4370282852,38.2185141426,19.1092570713,9.55462853565,4.77731426782,2.38865713391,1.19432856696,.597164283478,.298582141739,.1492910708695,.07464553543475],Yfe=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21"];class Hfe{createOlLayer(e){const{name:t,imageType:i,id:r}=e,o=jZ(e),s=Oi(Dp),l=s.getExtent(),u=new eb({url:kfe(e),tilePixelRatio:o?2:1,layer:t,matrixSet:`GLOBAL_WEBMERCATOR_4_V3${o?"_HD":""}`,format:i,requestEncoding:"REST",projection:s,tileGrid:new gk({origin:td(l),extent:l,resolutions:Xfe,matrixIds:Yfe}),style:"default",crossOrigin:"anonymous"});return new Ym({source:u,properties:{"olcs.extent":KZ(),label:t,id:r}})}setLayerTime(e,t,i){const r=e.get(jC).time_layers[i],o=t.getUrls();if(o){const s=this.transformUrls(o,r);t.setUrls(s),e.set(ZT,r),e.set(VZ,r)}}transformUrls(e,t){return e.map(i=>i.replace(/[/][^/]*[/]{TileMatrixSet}/,`/${t}/{TileMatrixSet}`))}}const nW=new Hfe;class Kfe{createOlLayer(e,t){const i=Kn(),{id:r,metadata:o,name:s}=e,l=t.get(r);if(!l)return;const u={container:i.getOlMap().getTarget(),...l},h=new mM({maplibreOptions:u,label:s,id:r,queryable_id:r,metadata:o}),d=Eu(),m=Tf();return h.getMapLibreMap().loaded()?d.setBaseStyle(r,h.getMapLibreMap().getStyle()):new Promise(y=>h.getMapLibreMap().once("data",y)).then(()=>d.setBaseStyle(r,h.getMapLibreMap().getStyle())),h.set(cfe,m.getDefaultMapBoxStyleUrl(m.getVectorId(e))),h}}const jfe=new Kfe;class XT extends _k{constructor(e){e=e||{};const t=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=Qa(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,i,r){const o=Oi(i),s=this.getProjection()||o;let l=this.getTileGrid();l||(l=this.getTileGridForProjection(s));const u=gs(e,o,s),h=qv(s,o,e,t),d=l.getZForResolution(h,this.zDirection),m=l.getResolution(d),y=l.getTileCoordForCoordAndZ(u,d);if(l.getResolutions().length<=y[0])return;let x=l.getTileCoordExtent(y,this.tmpExtent_);const C=this.gutter_;C!==0&&(x=Hh(x,m*C,x));const w={QUERY_LAYERS:this.params_.LAYERS};Object.assign(w,qC(this.params_,"GetFeatureInfo"),r);const S=Math.floor((u[0]-x[0])/m),T=Math.floor((x[3]-u[1])/m);return w[this.v13_?"I":"X"]=S,w[this.v13_?"J":"Y"]=T,this.getRequestUrl_(y,x,1,s||o,w)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;const i={SERVICE:"WMS",VERSION:JC,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){const r=this.params_.LAYERS;if(!(!Array.isArray(r)||r.length===1))return;i.LAYER=r}if(e!==void 0){const r=this.getProjection()?this.getProjection().getMetersPerUnit():1,o=28e-5;i.SCALE=e*r/o}return Object.assign(i,t),Qv(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,i,r,o){const s=this.urls;if(!s)return;let l;if(s.length==1)l=s[0];else{const u=Gh(UZ(e),s.length);l=s[u]}return HZ(t,(this.tileGrid||this.getTileGridForProjection(r)).getResolution(e[0]),i,r,l,o,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0;const t=[];for(const i in this.params_)t[e++]=i+"-"+this.params_[i];return t.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){const e=this.params_.VERSION||JC;this.v13_=GR(e,"1.3")>=0}tileUrlFunction(e,t,i){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(i)),r.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);const o=r.getResolution(e[0]);let s=r.getTileCoordExtent(e,this.tmpExtent_);const l=this.gutter_;l!==0&&(s=Hh(s,o*l,s));const u=Object.assign({},qC(this.params_,"GetMap"));return this.getRequestUrl_(e,s,t,i,u)}}function $fe(){const{initLayer:n}=sa(),{addLayers:e,setBgLayer:t}=Wi(),{findBgLayerByName:i}=Sl();function r(s){if(s.layerType===Gp.LAYER_OFFLINE_BG_VECTOR)return i(s.key);{const l=JSON.parse(s.layerSerialization),{id:u,label:h,opacity:d}=l;let m=s.layerType;return m===Zh.BG_WMTS&&(m=Gp.LAYER_OFFLINE_BG_WMTS),{id:u,name:h,options:l,type:m,metadata:{start_opacity:d}}}}function o(s){if([Gp.LAYER_OFFLINE_TILE,Gp.LAYER_OFFLINE_BG_VECTOR].includes(s.layerType))try{const u=n(r(s));s.backgroundLayer?t(u):e(u)}catch{throw new Error("Invalid offline layer specification.")}}return{createOfflineLayer:o,offlineLayerToLayer:r}}let mO;function Ly(){const n=Wi(),e=$fe(),{isOffLine:t}=xt(oi()),{minZoom:i,maxZoom:r}=xt(n),{removeAllLayers:o,setBgLayer:s}=n;function l(C){mO=C,console.warn("Deprecated: useOffline.initLocalforage_v3() is meant to be removed when v4 is fully operational")}function u(){return t.value}function h(C){t.value=C}function d(C){m(),y(C),x(C)}function m(){qde(),o(),s(null)}function y(C){const{zooms:w}=C;i.value=w[0],r.value=w[w.length-1]}function x(C){[...C.layers].reverse().forEach(w=>e.createOfflineLayer(w))}return{localforage_v3:mO,isOffLine:t,initLocalforage_v3:l,getIsOffline:u,setIsOffline:h,doRestore:d}}class iW{createOlLayer(e){const t=this.deserializeTileLayer(e.options);return new Ym(t)}createTileLoadFunction(){const e=Ly().localforage_v3;return(i,r)=>{const o=Tse(r);e.getItem(o).then(s=>{i.getImage().src=s||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="}).catch(()=>i.setState(3))}}}class Jfe extends iW{deserializeTileLayer(e){const t=JSON.parse(e.source);if(t.tileLoadFunction=this.createTileLoadFunction(),t.gutter=parseInt("96",10),t.tileGrid){const i=new uA(JSON.parse(t.tileGrid));t.tileGrid=i}return e.source=new XT(t),e}serializeTileLayer(){throw new Error("Method not implemented.")}}const qfe=new Jfe;class Qfe extends iW{deserializeTileLayer(e){const t=JSON.parse(e.source);if(t.tileLoadFunction=this.createTileLoadFunction(),t.tileGrid){const i=new gk(JSON.parse(t.tileGrid));t.tileGrid=i}return e.source=new eb(t),e}serializeTileLayer(){throw new Error("Method not implemented.")}}const epe=new Qfe;class tpe{createOlLayer(e){let t;switch(this.getOfflineLayerSourceType(e)){case Zh.WMTS:t=epe.createOlLayer(e);break;case Zh.TILE_WMS:t=qfe.createOlLayer(e);break;default:throw new Error(`Unrecognized offline layer type: ${e.type}`)}return t}getOfflineLayerSourceType(e){return e.options.sourceType}}const npe=new tpe;function ipe(){return new qn({image:rpe})}const rpe=new Qs({radius:4,fill:new Ji({color:"white"}),stroke:new ki({color:"white",width:1})}),spe=1002,ope="featurePositionLayer";class ape extends bo{geoMarker;constructor(e){const t=new ua({features:[],useSpatialIndex:!1});super({...e,source:t})}moveGeoMarker(e,t){this.geoMarker?.getGeometry()||this.createGeoMarker(),this.geoMarker?.getGeometry()?.setCoordinates([e,t])}createGeoMarker(){this.geoMarker=new Zi({geometry:new Mr([0,0])}),this.getSource()?.clear(),this.getSource()?.addFeature(this.geoMarker)}removeGeoMarker(){this.getSource()?.clear(),this.geoMarker=void 0}}class lpe{createOlLayer(){const e=ipe(),t=new ape({declutter:!0,zIndex:spe,style:e,updateWhileAnimating:!0,updateWhileInteracting:!0});return t.set("cyLayerType",ope),t}}const upe=new lpe,rW=1e3,sW="interactionDrawLayer";class cpe{createOlLayer(){const e=new bo({source:new ua({features:[]}),zIndex:rW,style:(t,i)=>{const r=t.getStyle();return typeof r=="function"?r.call(t,t,i):r}});return e.set("cyLayerType",sW),e}}const yO=new cpe;class hpe{createOlLayer(e,t){let i;if(t&&(i=jfe.createOlLayer(e,t)),!i)switch(e.type){case"position":return this.createOlLayerFeaturePosition(e);case Zh.WMS:i=$Z.createOlLayer(e);break;case Zh.WMTS:case Zh.BG_WMTS:i=nW.createOlLayer(e);break;case Gp.LAYER_OFFLINE_TILE:case Gp.LAYER_OFFLINE_BG_VECTOR:i=npe.createOlLayer(e);break;default:throw new Error(`Unrecognized layer type: ${e.type}`)}return this.setOlProps(e,i),i}createOlLayerInteractionDraw(){return yO.createOlLayer()}createOlLayerInteractionClip(){return yO.createOlLayer()}createOlLayerFeaturePosition(e){const t=upe.createOlLayer();return t.set(BT,e.id),t.set(ZT,e.name),t}setOlProps(e,t){t.set(BT,e.id),t.set(ZT,e.name),t.set(VZ,e.name),t.set(jC,e.metadata),t.set(afe,e.id),t.set(lfe,sa().getLayerCurrentTime(e)),t.set(ufe,e.time),t.setOpacity(e.opacity)}}const iv=new hpe;class dpe{setLayerTime(e,t){const i=e.getSource();i instanceof QC&&$Z.setLayerTime(i,t),i instanceof eb&&nW.setLayerTime(e,i,t)}}const fpe=new dpe,Dx=-200;function vk(){function n(C,w){if(!w)return;const S=d(w);C.addLayer(S)}function e(C,w){if(!w)return;const S=iv.createOlLayer(w);return C.addLayer(S),S}function t(C,w){return C.getLayers().getArray().find(S=>S.get("id")===w)}function i(C,w){const S=t(C,w);S&&C.removeLayer(S)}function r(C,w){const S=C.getLayers().getArray();w.forEach((T,M)=>{S.find(N=>N.get("id")===T.id)?.setZIndex(M+1)})}function o(C,w,S){const T=C.getLayers().getArray().find(M=>M.get("id")===w);T&&T.setOpacity(S)}function s(C,w){const S=sa(),T=t(C,w.id),M=S.getLayerCurrentTime(w);M&&T&&fpe.setLayerTime(T,M)}function l(C){Gm.delete(C)}function u(C){return Gm.has(C.id)}function h(C,w){Gm.set(C,w)}function d(C){const w=C.id,S=Gm.get(w);if(S)return S;{const T=iv.createOlLayer(C);return h(w,T),T}}function m(C){return C&&Gm.get(C.id)||null}function y(C,w){const T=C.getLayers().getArray().find(M=>M.getZIndex()===Dx);T&&w(T)}function x(C,w,S){const T=C.getLayers(),M=T.getArray().findIndex(V=>V.getZIndex()===Dx),G=T.getArray()[M]?.get("id");let N;w&&(u(w)?N=m(w):(N=iv.createOlLayer(w,S),h(w.id,N))),M>=0?N?(N.setZIndex(Dx),T.setAt(M,N)):T.removeAt(M):N&&(N.setZIndex(Dx),C.addLayer(N)),G&&G!==w?.id&&DZ.restore(!0)}return{addLayer:n,addFeatureLayer:e,findLayer:t,removeLayer:i,removeFromCache:l,reorderLayers:r,setLayerOpacity:o,setLayerTime:s,getLayerFromCache:m,setBgLayer:x,applyOnBgLayer:y}}const oW=Sa("profile-position",()=>{const n=Ke(void 0),e=Ke(void 0);function t(i,r){n.value=i,e.value=r}return{x:n,y:e,setPosition:t}},{}),aW="lux-feat-position";let Cm;function ppe(n,e=!0){const t=vk(),i=oW(),r=Jr(),{drawStateActive:o,editStateActive:s}=xt(r),{x:l,y:u}=xt(i),h=Ei(n),d=Ei(void 0),m=Ke(!0),y=new $i([0,0]),x=Ke(!0),C=wB(W=>V(W),15);let w,S;gr(()=>{w=Kn().getOlMap(),T(),G()}),Ds(()=>N()),kt(()=>y9(e),W=>{x.value=W??!0,W||Cm?.removeGeoMarker()}),kt(h,W=>{W&&M(W)}),kt([l,u],([W,j])=>{x.value&&!o.value&&W&&j&&m.value?Cm?.moveGeoMarker(W,j):Cm?.removeGeoMarker()});function T(){if(Cm)return;const W={id:aW,type:"position"};Cm=t.addFeatureLayer(w,W)}function M(W){const j=W?.map(J=>{const te=gs([J.x,J.y],tu,w.getView().getProjection());return new Mr(te).getCoordinates().concat(J.dist)});y.setCoordinates(j)}function G(){S===void 0&&(S=In(w,"pointermove",C))}function N(){S&&(pr(S),S=void 0,Cm?.removeGeoMarker())}function V(W){if(W.dragging||o.value||!x.value)return;let j,J;const te=w.getEventCoordinate(W.originalEvent),ce=y.getClosestPoint(te),pe=ce[0]-te[0],Y=ce[1]-te[1],he=pe*pe+Y*Y,D=w.getView().getResolution();he/(D*D)<64?(d.value=ce[2],m.value=s.value!=="editLine",j=ce[0],J=ce[1]):(d.value=-1,m.value=!0),j!==void 0&&J!==void 0&&i.setPosition(j,J)}return{profileData:h,highlightDistance:d}}class cA{encodeOptions;constructor(e){this.encodeOptions={dataProjection:Fu,featureProjection:e.getView().getProjection()}}download(e,t,i="txt",r="text/plain"){const o=`${x5(e)}.${x5(i)}`;SB(o,t,r)}exploseFeatures(e){const t=[];return(Array.isArray(e)?e:[e]).forEach(i=>{switch(i.getGeometry()?.getType()){case"GeometryCollection":{i.getGeometry().getGeometriesArray().forEach(o=>t.push(this.cloneFeatureWithGeom(i,o)));break}case"MultiLineString":{i.getGeometry().getLineStrings().forEach(o=>t.push(this.cloneFeatureWithGeom(i,o)));break}case"Circle":{const r=new El(i);t.push(tk(r));break}default:t.push(i);break}}),t}cloneFeatureWithGeom(e,t){const i=e.clone();return i.setGeometry(t),i}}class lW extends jM{constructor(){super(),this.xmlSerializer_=Qie()}getType(){return"xml"}readFeature(e,t){if(!e)return null;if(typeof e=="string"){const i=Cc(e);return this.readFeatureFromDocument(i,t)}return Ic(e)?this.readFeatureFromDocument(e,t):this.readFeatureFromNode(e,t)}readFeatureFromDocument(e,t){const i=this.readFeaturesFromDocument(e,t);return i.length>0?i[0]:null}readFeatureFromNode(e,t){return null}readFeatures(e,t){if(!e)return[];if(typeof e=="string"){const i=Cc(e);return this.readFeaturesFromDocument(i,t)}return Ic(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)}readFeaturesFromDocument(e,t){const i=[];for(let r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&dr(i,this.readFeaturesFromNode(r,t));return i}readFeaturesFromNode(e,t){return Zn()}readGeometry(e,t){if(!e)return null;if(typeof e=="string"){const i=Cc(e);return this.readGeometryFromDocument(i,t)}return Ic(e)?this.readGeometryFromDocument(e,t):this.readGeometryFromNode(e,t)}readGeometryFromDocument(e,t){return null}readGeometryFromNode(e,t){return null}readProjection(e){if(!e)return null;if(typeof e=="string"){const t=Cc(e);return this.readProjectionFromDocument(t)}return Ic(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(e){return this.dataProjection}readProjectionFromNode(e){return this.dataProjection}writeFeature(e,t){const i=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(e,t){return null}writeFeatures(e,t){const i=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(e,t){return null}writeGeometry(e,t){const i=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(e,t){return null}}const $r=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],gpe="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",mpe={rte:cW,trk:hW,wpt:dW},ype=Ft($r,{rte:Ha(cW),trk:Ha(hW),wpt:Ha(dW)}),_pe=Ft($r,{text:at(pn,"linkText"),type:at(pn,"linkType")}),vpe=Ft($r,{name:at(pn),email:Xpe,link:Lb}),bpe=Ft($r,{name:at(pn),desc:at(pn),author:at(Wpe),copyright:at(zpe),link:Lb,time:at(nA),keywords:at(pn),bounds:Upe,extensions:hA}),xpe=Ft($r,{year:at(Cl),license:at(pn)}),Ipe=Ft($r,{rte:jt(jpe),trk:jt($pe),wpt:jt(qpe)});let uW=class extends lW{constructor(e){super(),e=e||{},this.dataProjection=Oi("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,i=e.length;t<i;++t){const r=e[t];if(this.readExtensions_){const o=r.get("extensionsNode_")||null;this.readExtensions_(r,o)}r.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(Cc(e)):Ic(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const i=this.readMetadataFromNode(t);if(i)return i}return null}readMetadataFromNode(e){if(!$r.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if($r.includes(t.namespaceURI)&&t.localName==="metadata")return kn({},bpe,t,[]);return null}readFeatureFromNode(e,t){if(!$r.includes(e.namespaceURI))return null;const i=mpe[e.localName];if(!i)return null;const r=i(e,[this.getReadOptions(e,t)]);return r?(this.handleReadExtensions_([r]),r):null}readFeaturesFromNode(e,t){if(!$r.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const i=kn([],ype,e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_(i),i):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=$h("http://www.topografix.com/GPX/1/1","gpx");return i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",AC),i.setAttributeNS(AC,"xsi:schemaLocation",gpe),i.setAttribute("version","1.1"),i.setAttribute("creator","OpenLayers"),Gr({node:i},Ipe,Zpe,e,[t]),i}};const Cpe=Ft($r,{name:at(pn),cmt:at(pn),desc:at(pn),src:at(pn),link:Lb,number:at(Cl),extensions:hA,type:at(pn),rtept:Ype}),wpe=Ft($r,{ele:at(nr),time:at(nA)}),Ape=Ft($r,{name:at(pn),cmt:at(pn),desc:at(pn),src:at(pn),link:Lb,number:at(Cl),type:at(pn),extensions:hA,trkseg:Kpe}),Spe=Ft($r,{trkpt:Hpe}),Epe=Ft($r,{ele:at(nr),time:at(nA)}),Tpe=Ft($r,{ele:at(nr),time:at(nA),magvar:at(nr),geoidheight:at(nr),name:at(pn),cmt:at(pn),desc:at(pn),src:at(pn),link:Lb,sym:at(pn),type:at(pn),fix:at(pn),sat:at(Cl),hdop:at(nr),vdop:at(nr),pdop:at(nr),ageofdgpsdata:at(nr),dgpsid:at(Cl),extensions:hA}),Rpe=["text","type"],Mpe=Ft($r,{text:jt(rr),type:jt(rr)}),kpe=Ft($r,["name","cmt","desc","src","link","number","type","rtept"]),Lpe=Ft($r,{name:jt(rr),cmt:jt(rr),desc:jt(rr),src:jt(rr),link:jt(Ik),number:jt(SC),type:jt(rr),rtept:fB(jt(Ck))}),Ppe=Ft($r,["ele","time"]),Gpe=Ft($r,["name","cmt","desc","src","link","number","type","trkseg"]),Fpe=Ft($r,{name:jt(rr),cmt:jt(rr),desc:jt(rr),src:jt(rr),link:jt(Ik),number:jt(SC),type:jt(rr),trkseg:fB(jt(Jpe))}),Ope=Bu("trkpt"),Npe=Ft($r,{trkpt:jt(Ck)}),Dpe=Ft($r,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Vpe=Ft($r,{ele:jt(Za),time:jt(sre),magvar:jt(Za),geoidheight:jt(Za),name:jt(rr),cmt:jt(rr),desc:jt(rr),src:jt(rr),link:jt(Ik),sym:jt(rr),type:jt(rr),fix:jt(rr),sat:jt(SC),hdop:jt(Za),vdop:jt(Za),pdop:jt(Za),ageofdgpsdata:jt(Za),dgpsid:jt(SC)}),Bpe={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Zpe(n,e,t){const i=n.getGeometry();if(i){const r=Bpe[i.getType()];if(r){const o=e[e.length-1].node;return $h(o.namespaceURI,r)}}}function bk(n,e,t,i){return n.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in i?(n.push(i.ele),delete i.ele,e.hasZ=!0):n.push(0),"time"in i?(n.push(i.time),delete i.time,e.hasM=!0):n.push(0),n}function xk(n,e,t){let i="XY",r=2;if(n.hasZ&&n.hasM?(i="XYZM",r=4):n.hasZ?(i="XYZ",r=3):n.hasM&&(i="XYM",r=3),r!==4){for(let o=0,s=e.length/4;o<s;o++)e[o*r]=e[o*4],e[o*r+1]=e[o*4+1],n.hasZ&&(e[o*r+2]=e[o*4+2]),n.hasM&&(e[o*r+2]=e[o*4+3]);if(e.length=e.length/4*r,t)for(let o=0,s=t.length;o<s;o++)t[o]=t[o]/4*r}return i}function Wpe(n,e){const t=kn({},vpe,n,e);if(t)return t}function zpe(n,e){const t=kn({},xpe,n,e);if(t){const i=n.getAttribute("author");return i!==null&&(t.author=i),t}}function Upe(n,e){const t=e[e.length-1],i=n.getAttribute("minlat"),r=n.getAttribute("minlon"),o=n.getAttribute("maxlat"),s=n.getAttribute("maxlon");r!==null&&i!==null&&s!==null&&o!==null&&(t.bounds=[[parseFloat(r),parseFloat(i)],[parseFloat(s),parseFloat(o)]])}function Xpe(n,e){const t=e[e.length-1],i=n.getAttribute("id"),r=n.getAttribute("domain");i!==null&&r!==null&&(t.email=`${i}@${r}`)}function Lb(n,e){const t=e[e.length-1],i=n.getAttribute("href");i!==null&&(t.link=i),Sf(_pe,n,e)}function hA(n,e){const t=e[e.length-1];t.extensionsNode_=n}function Ype(n,e){const t=kn({},wpe,n,e);if(t){const i=e[e.length-1],r=i.flatCoordinates,o=i.layoutOptions;bk(r,o,n,t)}}function Hpe(n,e){const t=kn({},Epe,n,e);if(t){const i=e[e.length-1],r=i.flatCoordinates,o=i.layoutOptions;bk(r,o,n,t)}}function Kpe(n,e){const t=e[e.length-1];Sf(Spe,n,e);const i=t.flatCoordinates;t.ends.push(i.length)}function cW(n,e){const t=e[0],i=kn({flatCoordinates:[],layoutOptions:{}},Cpe,n,e);if(!i)return;const r=i.flatCoordinates;delete i.flatCoordinates;const o=i.layoutOptions;delete i.layoutOptions;const s=xk(o,r),l=new $i(r,s);nu(l,!1,t);const u=new Zi(l);return u.setProperties(i,!0),u}function hW(n,e){const t=e[0],i=kn({flatCoordinates:[],ends:[],layoutOptions:{}},Ape,n,e);if(!i)return;const r=i.flatCoordinates;delete i.flatCoordinates;const o=i.ends;delete i.ends;const s=i.layoutOptions;delete i.layoutOptions;const l=xk(s,r,o),u=new Nu(r,l,o);nu(u,!1,t);const h=new Zi(u);return h.setProperties(i,!0),h}function dW(n,e){const t=e[0],i=kn({},Tpe,n,e);if(!i)return;const r={},o=bk([],r,n,i),s=xk(r,o),l=new Mr(o,s);nu(l,!1,t);const u=new Zi(l);return u.setProperties(i,!0),u}function Ik(n,e,t){n.setAttribute("href",e);const r=t[t.length-1].properties,o=[r.linkText,r.linkType];Gr({node:n},Mpe,oa,o,t,Rpe)}function Ck(n,e,t){const i=t[t.length-1],o=i.node.namespaceURI,s=i.properties;switch(n.setAttributeNS(null,"lat",String(e[1])),n.setAttributeNS(null,"lon",String(e[0])),i.geometryLayout){case"XYZM":e[3]!==0&&(s.time=e[3]);case"XYZ":e[2]!==0&&(s.ele=e[2]);break;case"XYM":e[2]!==0&&(s.time=e[2]);break}const u=n.nodeName=="rtept"?Ppe[o]:Dpe[o],h=el(s,u);Gr({node:n,properties:s},Vpe,oa,h,t,u)}function jpe(n,e,t){const i=t[0],r=e.getProperties(),o={node:n};o.properties=r;const s=e.getGeometry();if(s.getType()=="LineString"){const d=nu(s,!0,i);o.geometryLayout=d.getLayout(),r.rtept=d.getCoordinates()}const l=t[t.length-1].node,u=kpe[l.namespaceURI],h=el(r,u);Gr(o,Lpe,oa,h,t,u)}function $pe(n,e,t){const i=t[0],r=e.getProperties(),o={node:n};o.properties=r;const s=e.getGeometry();if(s.getType()=="MultiLineString"){const d=nu(s,!0,i);r.trkseg=d.getLineStrings()}const l=t[t.length-1].node,u=Gpe[l.namespaceURI],h=el(r,u);Gr(o,Fpe,oa,h,t,u)}function Jpe(n,e,t){const i={node:n};i.geometryLayout=e.getLayout(),i.properties={},Gr(i,Npe,Ope,e.getCoordinates(),t)}function qpe(n,e,t){const i=t[0],r=t[t.length-1];r.properties=e.getProperties();const o=e.getGeometry();if(o.getType()=="Point"){const s=nu(o,!0,i);r.geometryLayout=s.getLayout(),Ck(n,s.getCoordinates(),t)}}class Qpe extends uW{writeFeaturesNode(e,t){const i=super.writeFeaturesNode(e,t);if("metadata"in t&&"name"in t.metadata){const r="http://www.topografix.com/GPX/1/1",o=$h(r,"metadata"),s=$h(r,"name");rr(s,t.metadata.name),o.appendChild(s),i.childNodes.length>0?i.insertBefore(o,i.childNodes[0]):i.appendChild(o)}return i}}class ege extends cA{export(e,t,i=!1){const r=this.prepareFeatures(e,i),o=this.generateContent(r,t);this.download(t,o,"gpx","application/gpx")}prepareFeatures(e,t=!1){e.forEach(r=>{const o=r.getProperties();"feature_name"in o&&r.set("name",o.feature_name,!0)});let i=this.exploseFeatures(e);return t?i=this.changeLineToMultiline(i):i=this.changeMultilineToLine(i),i=this.changePolygonToLine(i),i}generateContent(e,t){return new Qpe().writeFeatures(this.orderFeaturesForGpx(e),{...this.encodeOptions,metadata:{name:t}})}changePolygonToLine(e){return e.map(t=>{if(t.getGeometry()?.getType()==="Polygon"){const o=t.getGeometry().getLinearRing(0)?.getCoordinates()||[],s=new $i(o);return this.cloneFeatureWithGeom(t,s)}return t})}changeMultilineToLine(e){return e.reduce((t,i)=>{const r=i.getGeometry();return r?.getType()==="MultiLineString"?r.getLineStrings().forEach(s=>t.push(this.cloneFeatureWithGeom(i,s))):t.push(i),t},[])}changeLineToMultiline(e){return e.map(t=>{const i=t.getGeometry();return i?.getType()==="LineString"?this.cloneFeatureWithGeom(t,new Nu([i.getCoordinates()])):t})}orderFeaturesForGpx(e){const t=[],i=[],r=[];return e.forEach(o=>{switch(o.getGeometry()?.getType()){case"Point":t.push(o);break;case"LineString":i.push(o);break;default:r.push(o);break}}),[...t,...i,...r]}}const ad=["http://www.google.com/kml/ext/2.2"],Pn=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],tge="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",_O={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},nge=Ft(Pn,{ExtendedData:TW,Region:RW,MultiGeometry:at(AW,"geometry"),LineString:at(CW,"geometry"),LinearRing:at(wW,"geometry"),Point:at(SW,"geometry"),Polygon:at(EW,"geometry"),Style:at(Sk),StyleMap:Dge,address:at(pn),description:at(pn),name:at(pn),open:at(mf),phoneNumber:at(pn),styleUrl:at(_W),visibility:at(mf)},Ft(ad,{MultiTrack:at(Age,"geometry"),Track:at(IW,"geometry")})),ige=Ft(Pn,{ExtendedData:TW,Region:RW,Link:$ge,address:at(pn),description:at(pn),name:at(pn),open:at(mf),phoneNumber:at(pn),visibility:at(mf)}),rge=Ft(Pn,{href:at(yW)}),sge=Ft(Pn,{Altitude:at(nr),Longitude:at(nr),Latitude:at(nr),Tilt:at(nr),AltitudeMode:at(pn),Heading:at(nr),Roll:at(nr)}),fW=Ft(Pn,{LatLonAltBox:zge,Lod:Xge}),oge=Ft(Pn,["Document","Placemark"]),age=Ft(Pn,{Document:jt(rme),Placemark:jt(LW)});let fy,AI=null,YT,rv,sv,ov,ew,HT=null,wk,KT=null,jT,Fp=null,vO=null,$T=null;function tw(n){return 32/Math.min(n[0],n[1])}function lge(){fy=[255,255,255,1],AI=new Ji({color:fy}),YT=[20,2],rv="pixels",sv="pixels",ov=[64,64],ew="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",HT=new Gu({anchor:YT,anchorOrigin:"bottom-left",anchorXUnits:rv,anchorYUnits:sv,crossOrigin:"anonymous",rotation:0,scale:tw(ov),size:ov,src:ew}),wk="NO_IMAGE",KT=new ki({color:fy,width:1}),jT=new ki({color:[51,51,51,1],width:2}),Fp=new sd({font:"bold 16px Helvetica",fill:AI,stroke:jT,scale:.8}),vO=new qn({fill:AI,image:HT,text:Fp,stroke:KT,zIndex:0}),$T=[vO]}let Vx;function uge(n){return n}class pW extends lW{constructor(e){super(),e=e||{},$T||lge(),this.dataProjection=Oi("EPSG:4326"),this.defaultStyle_=e.defaultStyle?e.defaultStyle:$T,this.extractStyles_=e.extractStyles!==void 0?e.extractStyles:!0,this.writeStyles_=e.writeStyles!==void 0?e.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=e.showPointNames!==void 0?e.showPointNames:!0,this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",this.iconUrlFunction_=e.iconUrlFunction?e.iconUrlFunction:uge,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(e,t){const i=Ft(Pn,{Document:d5(this.readDocumentOrFolder_,this),Folder:d5(this.readDocumentOrFolder_,this),Placemark:Ha(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),r=kn([],i,e,t,this);if(r)return r}readPlacemark_(e,t){const i=kn({geometry:null},nge,e,t,this);if(!i)return;const r=new Zi,o=e.getAttribute("id");o!==null&&r.setId(o);const s=t[0],l=i.geometry;if(l&&nu(l,!1,s),r.setGeometry(l),delete i.geometry,this.extractStyles_){const u=i.Style,h=i.styleUrl,d=hge(u,h,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);r.setStyle(d)}return delete i.Style,r.setProperties(i,!0),r}readSharedStyle_(e,t){const i=e.getAttribute("id");if(i!==null){const r=Sk.call(this,e,t);if(r){let o,s=e.baseURI;(!s||s=="about:blank")&&(s=window.location.href),s?o=new URL("#"+i,s).href:o="#"+i,this.sharedStyles_[o]=r}}}readSharedStyleMap_(e,t){const i=e.getAttribute("id");if(i===null)return;const r=bW.call(this,e,t);if(!r)return;let o,s=e.baseURI;(!s||s=="about:blank")&&(s=window.location.href),s?o=new URL("#"+i,s).href:o="#"+i,this.sharedStyles_[o]=r}readFeatureFromNode(e,t){if(!Pn.includes(e.namespaceURI))return null;const i=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return i||null}readFeaturesFromNode(e,t){if(!Pn.includes(e.namespaceURI))return[];let i;const r=e.localName;if(r=="Document"||r=="Folder")return i=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]),i||[];if(r=="Placemark"){const o=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return o?[o]:[]}if(r=="kml"){i=[];for(let o=e.firstElementChild;o;o=o.nextElementSibling){const s=this.readFeaturesFromNode(o,t);s&&dr(i,s)}return i}return[]}readName(e){if(e){if(typeof e=="string"){const t=Cc(e);return this.readNameFromDocument(t)}return Ic(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}}readNameFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){const i=this.readNameFromNode(t);if(i)return i}}readNameFromNode(e){for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(Pn.includes(t.namespaceURI)&&t.localName=="name")return pn(t);for(let t=e.firstElementChild;t;t=t.nextElementSibling){const i=t.localName;if(Pn.includes(t.namespaceURI)&&(i=="Document"||i=="Folder"||i=="Placemark"||i=="kml")){const r=this.readNameFromNode(t);if(r)return r}}}readNetworkLinks(e){const t=[];if(typeof e=="string"){const i=Cc(e);dr(t,this.readNetworkLinksFromDocument(i))}else Ic(e)?dr(t,this.readNetworkLinksFromDocument(e)):dr(t,this.readNetworkLinksFromNode(e));return t}readNetworkLinksFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&dr(t,this.readNetworkLinksFromNode(i));return t}readNetworkLinksFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(Pn.includes(i.namespaceURI)&&i.localName=="NetworkLink"){const r=kn({},ige,i,[]);t.push(r)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Pn.includes(i.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&dr(t,this.readNetworkLinksFromNode(i))}return t}readRegion(e){const t=[];if(typeof e=="string"){const i=Cc(e);dr(t,this.readRegionFromDocument(i))}else Ic(e)?dr(t,this.readRegionFromDocument(e)):dr(t,this.readRegionFromNode(e));return t}readRegionFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&dr(t,this.readRegionFromNode(i));return t}readRegionFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(Pn.includes(i.namespaceURI)&&i.localName=="Region"){const r=kn({},fW,i,[]);t.push(r)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Pn.includes(i.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&dr(t,this.readRegionFromNode(i))}return t}readCamera(e){const t=[];if(typeof e=="string"){const i=Cc(e);dr(t,this.readCameraFromDocument(i))}else Ic(e)?dr(t,this.readCameraFromDocument(e)):dr(t,this.readCameraFromNode(e));return t}readCameraFromDocument(e){const t=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType===Node.ELEMENT_NODE&&dr(t,this.readCameraFromNode(i));return t}readCameraFromNode(e){const t=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling)if(Pn.includes(i.namespaceURI)&&i.localName==="Camera"){const r=kn({},sge,i,[]);t.push(r)}for(let i=e.firstElementChild;i;i=i.nextElementSibling){const r=i.localName;Pn.includes(i.namespaceURI)&&(r==="Document"||r==="Folder"||r==="Placemark"||r==="kml")&&dr(t,this.readCameraFromNode(i))}return t}writeFeaturesNode(e,t){t=this.adaptOptions(t);const i=$h(Pn[4],"kml"),r="http://www.w3.org/2000/xmlns/";i.setAttributeNS(r,"xmlns:gx",ad[0]),i.setAttributeNS(r,"xmlns:xsi",AC),i.setAttributeNS(AC,"xsi:schemaLocation",tge);const o={node:i},s={};e.length>1?s.Document=e:e.length==1&&(s.Placemark=e[0]);const l=oge[i.namespaceURI],u=el(s,l);return Gr(o,age,oa,u,[t],l,this),i}}function cge(n,e){const t=[0,0];let i="start";const r=n.getImage();if(r){const l=r.getSize();if(l&&l.length==2){const u=r.getScaleArray(),h=r.getAnchor();t[0]=u[0]*(l[0]-h[0]),t[1]=u[1]*(l[1]/2-h[1]),i="left"}}let o=n.getText();return o?(o=o.clone(),o.setFont(o.getFont()||Fp.getFont()),o.setScale(o.getScale()||Fp.getScale()),o.setFill(o.getFill()||Fp.getFill()),o.setStroke(o.getStroke()||jT)):o=Fp.clone(),o.setText(e),o.setOffsetX(t[0]),o.setOffsetY(t[1]),o.setTextAlign(i),new qn({image:r,text:o})}function hge(n,e,t,i,r){return(function(o,s){let l=r,u="",h=[];if(l){const m=o.getGeometry();if(m)if(m instanceof $l)h=m.getGeometriesArrayRecursive().filter(function(y){const x=y.getType();return x==="Point"||x==="MultiPoint"}),l=h.length>0;else{const y=m.getType();l=y==="Point"||y==="MultiPoint"}}l&&(u=o.get("name"),l=l&&!!u,l&&/&[^&]+;/.test(u)&&(Vx||(Vx=document.createElement("textarea")),Vx.innerHTML=u,u=Vx.value));let d=t;if(n?d=n:e&&(d=gW(e,t,i)),l){const m=cge(d[0],u);if(h.length>0){m.setGeometry(new $l(h));const y=new qn({geometry:d[0].getGeometry(),image:null,fill:d[0].getFill(),stroke:d[0].getStroke(),text:null});return[m,y].concat(d.slice(1))}return m}return d})}function gW(n,e,t){return Array.isArray(n)?n:typeof n=="string"?gW(t[n],e,t):e}function dA(n){const e=Vu(n,!1),t=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(t){const i=t[1];return[parseInt(i.substr(6,2),16),parseInt(i.substr(4,2),16),parseInt(i.substr(2,2),16),parseInt(i.substr(0,2),16)/255]}}function mW(n){let e=Vu(n,!1);const t=[];e=e.replace(/\s*,\s*/g,",");const i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let r;for(;r=i.exec(e);){const o=parseFloat(r[1]),s=parseFloat(r[2]),l=r[3]?parseFloat(r[3]):0;t.push(o,s,l),e=e.substr(r[0].length)}if(e==="")return t}function yW(n){const e=Vu(n,!1).trim();let t=n.baseURI;return(!t||t=="about:blank")&&(t=window.location.href),t?new URL(e,t).href:e}function _W(n){const e=Vu(n,!1).trim().replace(/^(?!.*#)/,"#");let t=n.baseURI;return(!t||t=="about:blank")&&(t=window.location.href),t?new URL(e,t).href:e}function dge(n){const e=n.getAttribute("xunits"),t=n.getAttribute("yunits");let i;return e!=="insetPixels"?t!=="insetPixels"?i="bottom-left":i="top-left":t!=="insetPixels"?i="bottom-right":i="top-right",{x:parseFloat(n.getAttribute("x")),xunits:_O[e],y:parseFloat(n.getAttribute("y")),yunits:_O[t],origin:i}}function vW(n){return nr(n)}const fge=Ft(Pn,{Pair:Nge});function bW(n,e){return kn(void 0,fge,n,e,this)}const pge=Ft(Pn,{Icon:at(Tge),color:at(dA),heading:at(nr),hotSpot:at(dge),scale:at(vW)});function gge(n,e){const t=kn({},pge,n,e);if(!t)return;const i=e[e.length-1],r="Icon"in t?t.Icon:{},o=!("Icon"in t)||Object.keys(r).length>0;let s;const l=r.href;l?s=l:o&&(s=ew);let u,h,d,m="bottom-left";const y=t.hotSpot;y?(u=[y.x,y.y],h=y.xunits,d=y.yunits,m=y.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(s)&&(s.includes("pushpin")?(u=YT,h=rv,d=sv):s.includes("arrow-reverse")?(u=[54,42],h=rv,d=sv):s.includes("paddle")&&(u=[32,1],h=rv,d=sv));let x;const C=r.x,w=r.y;C!==void 0&&w!==void 0&&(x=[C,w]);let S;const T=r.w,M=r.h;T!==void 0&&M!==void 0&&(S=[T,M]);let G;const N=t.heading;N!==void 0&&(G=ra(N));const V=t.scale,W=t.color;if(o){s==ew&&(S=ov);const j=new Gu({anchor:u,anchorOrigin:m,anchorXUnits:h,anchorYUnits:d,crossOrigin:this.crossOrigin_,offset:x,offsetOrigin:"bottom-left",rotation:G,scale:V,size:S,src:this.iconUrlFunction_(s),color:W}),J=j.getScaleArray()[0],te=j.getSize();if(te===null){const ce=j.getImageState();if(ce===An.IDLE||ce===An.LOADING){const pe=function(){const Y=j.getImageState();if(!(Y===An.IDLE||Y===An.LOADING)){const he=j.getSize();if(he&&he.length==2){const D=tw(he);j.setScale(J*D)}j.unlistenImageChange(pe)}};j.listenImageChange(pe),ce===An.IDLE&&j.load()}}else if(te.length==2){const ce=tw(te);j.setScale(J*ce)}i.imageStyle=j}else i.imageStyle=wk}const mge=Ft(Pn,{color:at(dA),scale:at(vW)});function yge(n,e){const t=kn({},mge,n,e);if(!t)return;const i=e[e.length-1],r=new sd({fill:new Ji({color:"color"in t?t.color:fy}),scale:t.scale});i.textStyle=r}const _ge=Ft(Pn,{color:at(dA),width:at(nr)});function vge(n,e){const t=kn({},_ge,n,e);if(!t)return;const i=e[e.length-1],r=new ki({color:"color"in t?t.color:fy,width:"width"in t?t.width:1});i.strokeStyle=r}const bge=Ft(Pn,{color:at(dA),fill:at(mf),outline:at(mf)});function xge(n,e){const t=kn({},bge,n,e);if(!t)return;const i=e[e.length-1],r=new Ji({color:"color"in t?t.color:fy});i.fillStyle=r;const o=t.fill;o!==void 0&&(i.fill=o);const s=t.outline;s!==void 0&&(i.outline=s)}const Ige=Ft(Pn,{coordinates:WM(mW)});function xW(n,e){return kn(null,Ige,n,e)}function Cge(n,e){const i=e[e.length-1].coordinates,r=Vu(n,!1),s=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(r);if(s){const l=parseFloat(s[1]),u=parseFloat(s[2]),h=parseFloat(s[3]);i.push([l,u,h])}else i.push([])}const wge=Ft(ad,{Track:Ha(IW)});function Age(n,e){const t=kn([],wge,n,e);if(t)return new Nu(t)}const Sge=Ft(Pn,{when:Jge},Ft(ad,{coord:Cge}));function IW(n,e){const t=kn({coordinates:[],whens:[]},Sge,n,e);if(!t)return;const i=[],r=t.coordinates,o=t.whens;for(let s=0,l=Math.min(r.length,o.length);s<l;++s)r[s].length==3&&i.push(r[s][0],r[s][1],r[s][2],o[s]);return new $i(i,"XYZM")}const Ege=Ft(Pn,{href:at(yW)},Ft(ad,{x:at(nr),y:at(nr),w:at(nr),h:at(nr)}));function Tge(n,e){const t=kn({},Ege,n,e);return t||null}const Rge=Ft(Pn,{coordinates:WM(mW)});function Ak(n,e){return kn(null,Rge,n,e)}const fA=Ft(Pn,{extrude:at(mf),tessellate:at(mf),altitudeMode:at(pn)});function CW(n,e){const t=kn({},fA,n,e),i=Ak(n,e);if(i){const r=new $i(i,"XYZ");return r.setProperties(t,!0),r}}function wW(n,e){const t=kn({},fA,n,e),i=Ak(n,e);if(i){const r=new Fo(i,"XYZ",[i.length]);return r.setProperties(t,!0),r}}const Mge=Ft(Pn,{LineString:Ha(CW),LinearRing:Ha(wW),MultiGeometry:Ha(AW),Point:Ha(SW),Polygon:Ha(EW)});function AW(n,e){const t=kn([],Mge,n,e);if(!t)return null;if(t.length===0)return new $l(t);let i,r=!0;const o=t[0].getType();let s;for(let l=1,u=t.length;l<u;++l)if(s=t[l],s.getType()!=o){r=!1;break}if(r){let l,u;if(o=="Point"){const h=t[0];l=h.getLayout(),u=h.getFlatCoordinates();for(let d=1,m=t.length;d<m;++d)s=t[d],dr(u,s.getFlatCoordinates());i=new Jh(u,l),NS(i,t)}else if(o=="LineString")i=new Nu(t),NS(i,t);else if(o=="Polygon")i=new vf(t),NS(i,t);else if(o=="GeometryCollection"||o.startsWith("Multi"))i=new $l(t);else throw new Error("Unknown geometry type found")}else i=new $l(t);return i}function SW(n,e){const t=kn({},fA,n,e),i=Ak(n,e);if(i){const r=new Mr(i,"XYZ");return r.setProperties(t,!0),r}}const kge=Ft(Pn,{innerBoundaryIs:Hge,outerBoundaryIs:jge});function EW(n,e){const t=kn({},fA,n,e),i=kn([null],kge,n,e);if(i&&i[0]){const r=i[0],o=[r.length];for(let l=1,u=i.length;l<u;++l)dr(r,i[l]),o.push(r.length);const s=new Fo(r,"XYZ",o);return s.setProperties(t,!0),s}}const Lge=Ft(Pn,{IconStyle:gge,LabelStyle:yge,LineStyle:vge,PolyStyle:xge});function Sk(n,e){const t=kn({},Lge,n,e,this);if(!t)return null;let i="fillStyle"in t?t.fillStyle:AI;const r=t.fill;r!==void 0&&!r&&(i=null);let o;"imageStyle"in t?t.imageStyle!=wk&&(o=t.imageStyle):o=HT;const s="textStyle"in t?t.textStyle:Fp,l="strokeStyle"in t?t.strokeStyle:KT,u=t.outline;return u!==void 0&&!u?[new qn({geometry:function(h){const d=h.getGeometry(),m=d.getType();if(m==="GeometryCollection"){const y=d;return new $l(y.getGeometriesArrayRecursive().filter(function(x){const C=x.getType();return C!=="Polygon"&&C!=="MultiPolygon"}))}if(m!=="Polygon"&&m!=="MultiPolygon")return d},fill:i,image:o,stroke:l,text:s,zIndex:void 0}),new qn({geometry:function(h){const d=h.getGeometry(),m=d.getType();if(m==="GeometryCollection"){const y=d;return new $l(y.getGeometriesArrayRecursive().filter(function(x){const C=x.getType();return C==="Polygon"||C==="MultiPolygon"}))}if(m==="Polygon"||m==="MultiPolygon")return d},fill:i,stroke:null,zIndex:void 0})]:[new qn({fill:i,image:o,stroke:l,text:s,zIndex:void 0})]}function NS(n,e){const t=e.length,i=new Array(e.length),r=new Array(e.length),o=new Array(e.length);let s,l,u;s=!1,l=!1,u=!1;for(let h=0;h<t;++h){const d=e[h];i[h]=d.get("extrude"),r[h]=d.get("tessellate"),o[h]=d.get("altitudeMode"),s=s||i[h]!==void 0,l=l||r[h]!==void 0,u=u||o[h]}s&&n.set("extrude",i),l&&n.set("tessellate",r),u&&n.set("altitudeMode",o)}const Pge=Ft(Pn,{displayName:at(pn),value:at(pn)});function Gge(n,e){const t=n.getAttribute("name");Sf(Pge,n,e);const i=e[e.length-1];t&&i.displayName?i[t]={value:i.value,displayName:i.displayName,toString:function(){return i.value}}:t!==null?i[t]=i.value:i.displayName!==null&&(i[i.displayName]=i.value),delete i.value}const Fge=Ft(Pn,{Data:Gge,SchemaData:Bge});function TW(n,e){Sf(Fge,n,e)}function RW(n,e){Sf(fW,n,e)}const Oge=Ft(Pn,{Style:at(Sk),key:at(pn),styleUrl:at(_W)});function Nge(n,e){const t=kn({},Oge,n,e,this);if(!t)return;const i=t.key;if(i&&i=="normal"){const r=t.styleUrl;r&&(e[e.length-1]=r);const o=t.Style;o&&(e[e.length-1]=o)}}function Dge(n,e){const t=bW.call(this,n,e);if(!t)return;const i=e[e.length-1];if(Array.isArray(t))i.Style=t;else if(typeof t=="string")i.styleUrl=t;else throw new Error("`styleMapValue` has an unknown type")}const Vge=Ft(Pn,{SimpleData:Zge});function Bge(n,e){Sf(Vge,n,e)}function Zge(n,e){const t=n.getAttribute("name");if(t!==null){const i=pn(n),r=e[e.length-1];r[t]=i}}const Wge=Ft(Pn,{altitudeMode:at(pn),minAltitude:at(nr),maxAltitude:at(nr),north:at(nr),south:at(nr),east:at(nr),west:at(nr)});function zge(n,e){const t=kn({},Wge,n,e);if(!t)return;const i=e[e.length-1],r=[parseFloat(t.west),parseFloat(t.south),parseFloat(t.east),parseFloat(t.north)];i.extent=r,i.altitudeMode=t.altitudeMode,i.minAltitude=parseFloat(t.minAltitude),i.maxAltitude=parseFloat(t.maxAltitude)}const Uge=Ft(Pn,{minLodPixels:at(nr),maxLodPixels:at(nr),minFadeExtent:at(nr),maxFadeExtent:at(nr)});function Xge(n,e){const t=kn({},Uge,n,e);if(!t)return;const i=e[e.length-1];i.minLodPixels=parseFloat(t.minLodPixels),i.maxLodPixels=parseFloat(t.maxLodPixels),i.minFadeExtent=parseFloat(t.minFadeExtent),i.maxFadeExtent=parseFloat(t.maxFadeExtent)}const Yge=Ft(Pn,{LinearRing:Ha(xW)});function Hge(n,e){const t=kn([],Yge,n,e);t.length>0&&e[e.length-1].push(...t)}const Kge=Ft(Pn,{LinearRing:WM(xW)});function jge(n,e){const t=kn(void 0,Kge,n,e);if(t){const i=e[e.length-1];i[0]=t}}function $ge(n,e){Sf(rge,n,e)}function Jge(n,e){const i=e[e.length-1].whens,r=Vu(n,!1),o=Date.parse(r);i.push(isNaN(o)?0:o)}function pA(n,e){const t=Hl(e),r=[(t.length==4?t[3]:1)*255,t[2],t[1],t[0]];for(let o=0;o<4;++o){const s=Math.floor(r[o]).toString(16);r[o]=s.length==1?"0"+s:s}rr(n,r.join(""))}function qge(n,e,t){const i=t[t.length-1],r=i.layout,o=i.stride;let s;if(r=="XY"||r=="XYM")s=2;else if(r=="XYZ"||r=="XYZM")s=3;else throw new Error("Invalid geometry layout");const l=e.length;let u="";if(l>0){u+=e[0];for(let h=1;h<s;++h)u+=","+e[h];for(let h=o;h<l;h+=o){u+=" "+e[h];for(let d=1;d<s;++d)u+=","+e[h+d]}}rr(n,u)}const SI=Ft(Pn,{Data:jt(Qge),value:jt(tme),displayName:jt(eme)});function Qge(n,e,t){n.setAttribute("name",e.name);const i={node:n},r=e.value;typeof r=="object"?(r!==null&&r.displayName&&Gr(i,SI,oa,[r.displayName],t,["displayName"]),r!==null&&r.value&&Gr(i,SI,oa,[r.value],t,["value"])):Gr(i,SI,oa,[r],t,["value"])}function eme(n,e){rr(n,e)}function tme(n,e){rr(n,e)}const nme=Ft(Pn,{Placemark:jt(LW)}),ime=function(n,e,t){const i=e[e.length-1].node;return $h(i.namespaceURI,"Placemark")};function rme(n,e,t){Gr({node:n},nme,ime,e,t,void 0,this)}const sme=Bu("Data");function ome(n,e,t){const i={node:n},r=e.names,o=e.values,s=r.length;for(let l=0;l<s;l++)Gr(i,SI,sme,[{name:r[l],value:o[l]}],t)}const bO=Ft(Pn,["href"],Ft(ad,["x","y","w","h"])),xO=Ft(Pn,{href:jt(rr)},Ft(ad,{x:jt(Za),y:jt(Za),w:jt(Za),h:jt(Za)})),ame=function(n,e,t){return $h(ad[0],"gx:"+t)};function lme(n,e,t){const i={node:n},r=t[t.length-1].node;let o=bO[r.namespaceURI],s=el(e,o);Gr(i,xO,oa,s,t,o),o=bO[ad[0]],s=el(e,o),Gr(i,xO,ame,s,t,o)}const ume=Ft(Pn,["scale","heading","Icon","color","hotSpot"]),cme=Ft(Pn,{Icon:jt(lme),color:jt(pA),heading:jt(Za),hotSpot:jt(Nme),scale:jt(GW)});function hme(n,e,t){const i={node:n},r={},o=e.getSrc(),s=e.getSize(),l=e.getImageSize(),u={href:o};if(s){u.w=s[0],u.h=s[1];const S=e.getAnchor(),T=e.getOrigin();if(T&&l&&T[0]!==0&&T[1]!==s[1]&&(u.x=T[0],u.y=l[1]-(T[1]+s[1])),S&&(S[0]!==s[0]/2||S[1]!==s[1]/2)){const M={x:S[0],xunits:"pixels",y:s[1]-S[1],yunits:"pixels"};r.hotSpot=M}}r.Icon=u;let h=e.getScaleArray()[0],d=s;if(d===null&&(d=ov),d.length==2){const S=tw(d);h=h/S}h!==1&&(r.scale=h);const m=e.getRotation();m!==0&&(r.heading=m);const y=e.getColor();y&&(r.color=y);const x=t[t.length-1].node,C=ume[x.namespaceURI],w=el(r,C);Gr(i,cme,oa,w,t,C)}const dme=Ft(Pn,["color","scale"]),fme=Ft(Pn,{color:jt(pA),scale:jt(GW)});function pme(n,e,t){const i={node:n},r={},o=e.getFill();o&&(r.color=o.getColor());const s=e.getScale();s&&s!==1&&(r.scale=s);const l=t[t.length-1].node,u=dme[l.namespaceURI],h=el(r,u);Gr(i,fme,oa,h,t,u)}const gme=Ft(Pn,["color","width"]),mme=Ft(Pn,{color:jt(pA),width:jt(Za)});function yme(n,e,t){const i={node:n},r={color:e.getColor(),width:Number(e.getWidth())||1},o=t[t.length-1].node,s=gme[o.namespaceURI],l=el(r,s);Gr(i,mme,oa,l,t,s)}const _me={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},MW=function(n,e,t){if(n){const i=e[e.length-1].node;return $h(i.namespaceURI,_me[n.getType()])}},vme=Bu("Point"),bme=Bu("LineString"),xme=Bu("LinearRing"),Ime=Bu("Polygon"),Cme=Ft(Pn,{LineString:jt(py),Point:jt(py),Polygon:jt(PW),GeometryCollection:jt(kW)});function kW(n,e,t){const i={node:n},r=e.getType();let o=[],s;if(r==="GeometryCollection")e.getGeometriesArrayRecursive().forEach(function(l){const u=l.getType();if(u==="MultiPoint")o=o.concat(l.getPoints());else if(u==="MultiLineString")o=o.concat(l.getLineStrings());else if(u==="MultiPolygon")o=o.concat(l.getPolygons());else if(u==="Point"||u==="LineString"||u==="Polygon")o.push(l);else throw new Error("Unknown geometry type")}),s=MW;else if(r==="MultiPoint")o=e.getPoints(),s=vme;else if(r==="MultiLineString")o=e.getLineStrings(),s=bme;else if(r==="MultiPolygon")o=e.getPolygons(),s=Ime;else throw new Error("Unknown geometry type");Gr(i,Cme,s,o,t)}const wme=Ft(Pn,{LinearRing:jt(py)});function IO(n,e,t){Gr({node:n},wme,xme,[e],t)}const DS=Ft(Pn,{ExtendedData:jt(ome),MultiGeometry:jt(kW),LineString:jt(py),LinearRing:jt(py),Point:jt(py),Polygon:jt(PW),Style:jt(Ome),address:jt(rr),description:jt(rr),name:jt(rr),open:jt(Ey),phoneNumber:jt(rr),styleUrl:jt(rr),visibility:jt(Ey)}),Ame=Ft(Pn,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),Sme=Bu("ExtendedData");function LW(n,e,t){const i={node:n};e.getId()&&n.setAttribute("id",e.getId());const r=e.getProperties(),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};o[e.getGeometryName()]=1;const s=Object.keys(r||{}).sort().filter(function(x){return!o[x]}),l=e.getStyleFunction();if(l){const x=l(e,0);if(x){const C=Array.isArray(x)?x:[x];let w=C;if(e.getGeometry()&&(w=C.filter(function(S){const T=S.getGeometryFunction()(e);if(T){const M=T.getType();return M==="GeometryCollection"?T.getGeometriesArrayRecursive().filter(function(G){const N=G.getType();return N==="Point"||N==="MultiPoint"}).length:M==="Point"||M==="MultiPoint"}})),this.writeStyles_){let S=C,T=C;e.getGeometry()&&(S=C.filter(function(M){const G=M.getGeometryFunction()(e);if(G){const N=G.getType();return N==="GeometryCollection"?G.getGeometriesArrayRecursive().filter(function(V){const W=V.getType();return W==="LineString"||W==="MultiLineString"}).length:N==="LineString"||N==="MultiLineString"}}),T=C.filter(function(M){const G=M.getGeometryFunction()(e);if(G){const N=G.getType();return N==="GeometryCollection"?G.getGeometriesArrayRecursive().filter(function(V){const W=V.getType();return W==="Polygon"||W==="MultiPolygon"}).length:N==="Polygon"||N==="MultiPolygon"}})),r.Style={pointStyles:w,lineStyles:S,polyStyles:T}}if(w.length&&r.name===void 0){const S=w[0].getText();S&&(r.name=S.getText())}}}const u=t[t.length-1].node,h=Ame[u.namespaceURI],d=el(r,h);if(Gr(i,DS,oa,d,t,h),s.length>0){const x=el(r,s);Gr(i,DS,Sme,[{names:s,values:x}],t)}const m=t[0];let y=e.getGeometry();y&&(y=nu(y,!0,m)),Gr(i,DS,MW,[y],t)}const Eme=Ft(Pn,["extrude","tessellate","altitudeMode","coordinates"]),Tme=Ft(Pn,{extrude:jt(Ey),tessellate:jt(Ey),altitudeMode:jt(rr),coordinates:jt(qge)});function py(n,e,t){const i=e.getFlatCoordinates(),r={node:n};r.layout=e.getLayout(),r.stride=e.getStride();const o=e.getProperties();o.coordinates=i;const s=t[t.length-1].node,l=Eme[s.namespaceURI],u=el(o,l);Gr(r,Tme,oa,u,t,l)}const Rme=Ft(Pn,["color","fill","outline"]),CO=Ft(Pn,{outerBoundaryIs:jt(IO),innerBoundaryIs:jt(IO)}),Mme=Bu("innerBoundaryIs"),kme=Bu("outerBoundaryIs");function PW(n,e,t){const i=e.getLinearRings(),r=i.shift(),o={node:n};Gr(o,CO,Mme,i,t),Gr(o,CO,kme,[r],t)}const Lme=Ft(Pn,{color:jt(pA),fill:jt(Ey),outline:jt(Ey)});function Pme(n,e,t){const i={node:n},r=e.getFill(),o=e.getStroke(),s={color:r?r.getColor():void 0,fill:r?void 0:!1,outline:o?void 0:!1},l=t[t.length-1].node,u=Rme[l.namespaceURI],h=el(s,u);Gr(i,Lme,oa,h,t,u)}function GW(n,e){Za(n,Math.round(e*1e6)/1e6)}const Gme=Ft(Pn,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),Fme=Ft(Pn,{IconStyle:jt(hme),LabelStyle:jt(pme),LineStyle:jt(yme),PolyStyle:jt(Pme)});function Ome(n,e,t){const i={node:n},r={};if(e.pointStyles.length){const u=e.pointStyles[0].getText();u&&(r.LabelStyle=u);const h=e.pointStyles[0].getImage();h&&typeof h.getSrc=="function"&&(r.IconStyle=h)}if(e.lineStyles.length){const u=e.lineStyles[0].getStroke();u&&(r.LineStyle=u)}if(e.polyStyles.length){const u=e.polyStyles[0].getStroke();u&&!r.LineStyle&&(r.LineStyle=u),r.PolyStyle=e.polyStyles[0]}const o=t[t.length-1].node,s=Gme[o.namespaceURI],l=el(r,s);Gr(i,Fme,oa,l,t,s)}function Nme(n,e){n.setAttribute("x",String(e.x)),n.setAttribute("y",String(e.y)),n.setAttribute("xunits",e.xunits),n.setAttribute("yunits",e.yunits)}class Dme extends cA{export(e,t){const i=this.generateContent(e);this.download(t,i,"kml","application/vnd.google-earth.kml+xml")}generateContent(e){return new pW().writeFeatures(this.exploseFeatures(e),this.encodeOptions)}}const Vme="https://migration.geoportail.lu/mymaps/exportgpxkml";class Bme extends cA{constructor(e){super(e),this.encodeOptions.dataProjection=tu}async export(e,t){const i=this.generateContent(e),r=Vme,o=new URLSearchParams({format:"shape",name:t,doc:i}),s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()});if(!s.ok)throw new Error("Error while requesting shapefile");const l=await s.blob();this.download(t,l,"zip","application/octet-stream")}generateContent(e){return new Jl().writeFeatures(this.exploseFeatures(e),this.encodeOptions)}async fetchFileContent(e,t){return await(await fetch("mymaps/exportgpxkml",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify({doc:e,format:"shape",name:t})})).blob()}}class Zme extends cA{async export(e,t){const i=await this.generateContent(e);this.download(t,i,"csv","application/csv")}async generateContent(e){const t=await e.getProfile();return t?this.getCsvContent(t):""}getCsvContent(e){return e.reduce((i,r)=>i+this.getCsvContentRow(r),`dist,MNT,y,x,lon,lat
`)}getCsvContentRow(e){const t=vc([e.x,e.y],tu);return`${e.dist},${e.values.dhm},${e.x},${e.y},${t[0]},${t[1]}
`}}class Wme{export(e,t,i,r,o=!1){this.getExporter(e,t)?.export(i,r,o)}getExporter(e,t){switch(t){case"gpx":return new ege(e);case"kml":return new Dme(e);case"shapefile":return new Bme(e);case"csv":return new Zme(e)}}}const gA=new Wme,zme={"data-cy":"featItemProfile",class:"lux-profile relative"},Ume={class:"flex justify-between w-full px-1 gap-3 whitespace-nowrap"},Xme={class:"grow cursor-default","data-cy":"featItemProfileCumul"},Yme=["aria-label"],Hme={key:0,class:"no-print w-full absolute mt-2 text-center"},Kme={class:"text-gray-700 rounded p-2 bg-[rgba(120,120,120,0.5)]"},jme="mnt",Ek=st({__name:"feature-elevation-profile",props:{feature:{},enableExportCSV:{type:Boolean,default:!0},activatePositioning:{type:Boolean,default:!0}},emits:["close"],setup(n){const e=n,t=ppe(void 0,()=>e.activatePositioning),i=oW(),{t:r}=Ct(),o=At(()=>ob()?.vnode?.props?.onClose),s=Ei(void 0),l=At(()=>s.value?.length||0),u=At(()=>s.value&&s.value[l.value-1]),h=At(()=>u.value?.elevationGain),d=At(()=>u.value?.elevationLoss),m=At(()=>u.value?.cumulativeElevation),y=At(()=>e.feature&&!s.value),x=At(()=>!e.feature);gr(()=>{e.feature&&e.feature.getProfile().then(T=>s.value=T)}),Ds(()=>{i.setPosition(void 0,void 0)}),kt(()=>e.feature,(T,M)=>{T!==M&&(e.feature&&!e.feature.profileData?(s.value=void 0,e.feature?.getProfile().then(G=>s.value=G)):s.value=void 0)}),kt(()=>e.feature?.profileData,(T,M)=>{T!==M&&(e.feature&&!e.feature.profileData?(s.value=void 0,e.feature?.getProfile().then(G=>s.value=G)):s.value=void 0)}),kt(s,T=>t.profileData.value=T);function C(){e.feature&&gA.export(e.feature?.map,"csv",e.feature,e.feature.label||jme)}function w(T){const M=gs([T.x,T.y],tu,e.feature?.map.getView().getProjection());i.setPosition(M[0],M[1])}function S(){i.setPosition(void 0,void 0)}return(T,M)=>{const G=Tl("format-measure");return U(),oe("div",zme,[P("div",Ume,[P("div",Xme,[s.value?(U(),oe(Et,{key:0},[P("span",null,[M[2]||(M[2]=Bt(" +",-1)),Sn(P("span",null,null,512),[[G,h.value,void 0,{elevation:!0}]])]),P("span",null,[M[3]||(M[3]=Bt(" ",-1)),Sn(P("span",null,null,512),[[G,d.value,void 0,{elevation:!0}]])]),P("span",null,[M[4]||(M[4]=Bt(" ",-1)),Sn(P("span",null,null,512),[[G,m.value,void 0,{elevation:!0}]])])],64)):Ge("",!0)]),n.enableExportCSV&&s.value?(U(),oe("button",{key:0,"data-cy":"featItemProfileCSV",class:"profile-export no-print text-secondary hover:underline",onClick:M[0]||(M[0]=()=>C())},K(k(r)("Export csv")),1)):Ge("",!0),o.value?(U(),oe("button",{key:1,"aria-label":k(r)("Close"),class:"fa-solid fa-close text-secondary hover:text-tertiary",onClick:M[1]||(M[1]=N=>T.$emit("close"))},null,8,Yme)):Ge("",!0)]),y.value||x.value?(U(),oe("div",Hme,[P("span",Kme,K(y.value?k(r)("Please wait, the profile is loading."):x.value?k(r)("Draw a line on the map to display an elevation profile."):""),1)])):Ge("",!0),mt(Jde,{profileData:s.value,class:"w-full",highlightDistance:k(t).highlightDistance.value,"onHover:profile":w,"onOut:profile":S},null,8,["profileData","highlightDistance"])])}}}),FW=Sa("elevation-profile",()=>{const n=Ke(!1),e=Ke(null);return{drawElevationProfileActive:n,currentProfileFeature:e}});function $me(){const n=oi(),e=FW(),{drawElevationProfileActive:t,currentProfileFeature:i}=xt(e),{elevationProfileToolbarOpen:r}=xt(n);let o;const s=new Ky({type:"LineString"});let l;const u=new qn({fill:new Ji({color:"rgba(255, 204, 51, 0.2)"}),stroke:new ki({color:"rgba(255, 204, 51, 1)",width:2}),image:new Qs({radius:7,fill:new Ji({color:"rgba(255, 204, 51, 0.3)"})}),text:new sd({font:"bold 12px Calibri,sans-serif",fill:new Ji({color:"rgb(0 0 0)"}),stroke:new ki({color:"rgba(255, 204, 51, 1)",width:4}),overflow:!0})}),h=new bo({source:new ua,zIndex:1001});function d(){o=Kn().getOlMap(),kt(r,S=>{if(S)t.value=!0;else{t.value=!1;const T=h.getSource();T&&T.clear(),i.value=null}}),kt(()=>i.value,S=>{const T=h.getSource();T&&(T.clear(),S&&S instanceof Zi&&T.addFeature(S))}),s.setActive(!1),kt(t,S=>{s.setActive(S)}),o.addInteraction(s),o.addLayer(h),h.setStyle(u),In(s,"drawstart",S=>{const T=h.getSource();T&&T.clear(),i.value=null,wu.add(o,S)}),In(s,"drawend",S=>{m(S)}),l=In(document,"keyup",S=>{y(S)})}function m(S){wu.remove(),s.finishDrawing(),t.value=!1,S.stopPropagation(),i.value=S.feature}function y(S){S.key==="Escape"&&(wu.remove(),s.finishDrawing(),s.setActive(!1))}function x(){const S=h.getSource();S&&S.clear(),i.value=null}function C(){const S=i.value;return!!S&&typeof S.getGeometry=="function"&&S.getGeometry()&&S.getGeometry().getType&&S.getGeometry().getType()==="LineString"}function w(){l&&(pr(l),l=void 0);const S=h.getSource();S&&S.clear(),o&&(o.removeLayer(h),o.removeInteraction(s))}return{drawInteraction:s,drawElevationProfileActive:t,currentProfileFeature:i,init:d,clearFeature:x,hasLineFeature:C,destroy:w}}const Jme={"data-cy":"toolbarElevationProfile",class:"relative"},qme={class:"absolute bottom-full top-auto z-20 flex flex-col gap-2 bg-white border border-gray-400 p-2 rounded shadow-lg"},Qme={class:"flex gap-2"},eye=st({__name:"toolbar-elevation-profile",setup(n){const{t:e}=Ct(),t=FW(),{currentProfileFeature:i}=xt(t),r=$me(),o=Kn().getOlMap(),s=At(()=>{if(!i.value)return;const u=new El;return u.setGeometry(i.value.getGeometry()),u.map=o,u.id=Date.now(),u.label=e("Elevation Profile"),u.featureType="drawnLine",u});gr(()=>{r.init()}),Ds(()=>{r.destroy()});function l(){r.clearFeature(),r.drawElevationProfileActive.value=!0}return(u,h)=>(U(),oe("div",Jme,[P("div",qme,[P("div",Qme,[P("button",{"data-cy":"elevationProfileRedraw",class:"px-3 py-1 bg-primary text-white rounded hover:bg-secondary",onClick:l},K(k(e)("Draw new line")),1),k(i)?(U(),oe("button",{key:0,"data-cy":"elevationProfileClear",class:"px-3 py-1 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:h[0]||(h[0]=(...d)=>k(r).clearFeature&&k(r).clearFeature(...d))},K(k(e)("Clear")),1)):Ge("",!0)]),mt(Ek,{class:"w-[450px]",feature:s.value,"enable-export-c-s-v":!0,"activate-positioning":!0},null,8,["feature"])])]))}});class tye{printExtent;constructor(e){this.setPrintExtent(e||[0,0,1/0,1/0])}getPrintExtent(){return this.printExtent}setPrintExtent(e){this.printExtent=e}layerFilter(e){return!0}geometryFilter(e){return!0}feature(e,t){}line(e,t,i,r){}point(e,t,i,r){}text(e,t,i,r){}wmtsLayer(e,t,i){}wmsLayer(e,t,i){}}const OW={WMTS_PIXEL_SIZE:28e-5,CIRCLE_TO_POLYGON_SIDES:64};function VS(n){return n.length===1?`0${n}`:n}function BS(n){const e=n[0],t=n[1],i=n[2];if(e!==(e&255)||t!==(t&255)||i!==(i&255))throw new Error(`"(${e},${t},${i})" is not a valid RGB color`);const r=VS(e.toString(16)),o=VS(t.toString(16)),s=VS(i.toString(16));return`#${r}${o}${s}`}function nye(n){const e=n.getProjection(),t=n.getTileGrid();console.assert(t instanceof gk);const i=t.getMatrixIds(),r=[],o=e.getMetersPerUnit();console.assert(!!o);for(let s=0;s<i.length;s++){const l=t.getFullTileRange(s),u=t.getResolution(s)*o;r.push({identifier:i[s],scaleDenominator:u/OW.WMTS_PIXEL_SIZE,tileSize:ia(t.getTileSize(s)),topLeftCorner:t.getOrigin(s),matrixSize:[l.maxX-l.minX+1,l.maxY-l.minY+1]})}return r}const Bx=document.createElement("canvas");function iye(n,e){const t=Bx.getContext("2d");return Bx.width=n.width,Bx.height=n.height,t.globalAlpha=e,t.drawImage(n,0,0),Bx}function rye(n){const e=document.createElement("a");return e.href=encodeURI(n),decodeURI(e.href)}function sye(n){const e=n.getUrls();return console.assert(e.length>0),rye(e[0])}function oye(n,e,t,i,r,o){e&&n.forEach(s=>{const l=s.getGeometry();if(!l)return;const u=l.clone();u.applyTransform((d,m,y)=>Nh(d,0,d.length,y||2,i,m));const h=e(s,t);h&&(Array.isArray(h)?h.forEach(d=>{r.setStyle(d),r.drawGeometry(u)}):(r.setStyle(h),r.drawGeometry(u)),o&&o(r,u))})}function aye(n,e,t){const i=qa(),r=ku(n);return Lu(i,t[0]/2,t[1]/2,1/e,-1/e,0,-r[0],-r[1]),i}class lye extends _k{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:Zfe({extent:mk(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const uye='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class cye extends lye{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[uye];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",r=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:(o,s)=>{const l=o.getImage();!Il&&l instanceof HTMLImageElement&&(l.referrerPolicy="origin-when-cross-origin"),(e.tileLoadFunction||tW)(o,s)},transition:e.transition,url:r,wrapX:e.wrapX,zDirection:e.zDirection})}}const hye={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},wO={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class dye extends qZ{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=qa(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(e,t,i,r,o,s,l,u){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,i,r,o,s,l,u)}getTile(e,t,i,r){const o=this.getOrCreateTile(e,t,i,r);if(!o)return null;const s=r.viewState,l=s.resolution,u=r.viewHints,h=this.getLayer().getSource(),d=h.getTileGridForProjection(s.projection),m=!(u[jr.ANIMATING]||u[jr.INTERACTING]),y=d.getZForResolution(l,h.zDirection)===e;return m&&y?o.wantedResolution=l:o.wantedResolution||(o.wantedResolution=d.getResolution(e)),o}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,i){const r=this.getLayer(),o=r.getRevision(),s=r.getRenderOrder()||null,l=e.wantedResolution,u=e.getReplayState(r);if(!u.dirty&&u.renderedResolution===l&&u.renderedRevision==o&&u.renderedRenderOrder==s)return;const h=r.getSource(),d=!!r.getDeclutter(),m=h.getTileGrid(),x=h.getTileGridForProjection(i).getTileCoordExtent(e.wrappedTileCoord),C=h.getSourceTiles(t,i,e),w=ti(r);delete e.hitDetectionImageData[w],e.executorGroups[w]=[],u.dirty=!1;for(let S=0,T=C.length;S<T;++S){const M=C[S];if(M.getState()!=Vn.LOADED)continue;const G=h.getProjection(),N=M.tileCoord;let V=m.getTileCoordExtent(N);i&&G&&!Oh(i,G)&&(V=hb(V,G,i,32));const W=Sc(x,V),j=Hh(W,r.getRenderBuffer()*l,this.tempExtent),J=Up(V,W)?null:j,te=new kB(0,W,l,t),ce=CT(l,t),pe=function(le,fe){let Le;const we=le.getStyleFunction()||r.getStyleFunction();if(we&&(Le=we(le,l)),Le){const se=this.renderFeature(le,ce,Le,te,d,fe);u.dirty=u.dirty||se}},Y=M.getFeatures();s&&s!==u.renderedRenderOrder&&Y.sort(s);for(let le=0,fe=Y.length;le<fe;++le){let Le=Y[le];i&&M.projection&&!Oh(i,M.projection)&&(Le=Le.clone(),Le.getGeometry().applyTransform(ff(M.projection,i))),(!J||Os(J,Le.getGeometry().getExtent()))&&pe.call(this,Le,le)}const he=te.finish(),D=r.getRenderMode()!=="vector"&&d&&C.length===1?null:W,re=new LB(D,l,t,h.getOverlaps(),he,r.getRenderBuffer(),!0);e.executorGroups[w].push(re)}u.renderedRevision=o,u.renderedRenderOrder=s,u.renderedResolution=l}forEachFeatureAtCoordinate(e,t,i,r,o){const s=t.viewState.resolution,l=t.viewState.rotation;i=i??0;const u=this.getLayer(),d=u.getSource().getTileGridForProjection(t.viewState.projection),m=Ks([e]);Hh(m,s*i,m);const y={},x=function(G,N,V){let W=G.getId();W===void 0&&(W=ti(G));const j=y[W];if(j){if(j!==!0&&V<j.distanceSq){if(V===0)return y[W]=!0,o.splice(o.lastIndexOf(j),1),r(G,u,N);j.geometry=N,j.distanceSq=V}}else{if(V===0)return y[W]=!0,r(G,u,N);o.push(y[W]={feature:G,layer:u,geometry:N,distanceSq:V,callback:r})}},C=this.renderedTiles,w=ti(u),S=u.getDeclutter(),T=S?t.declutter?.[S]?.all().map(G=>G.value):null;let M;e:for(let G=0,N=C.length;G<N;++G){const V=C[G],W=d.getTileCoordExtent(V.wrappedTileCoord);if(!Os(W,m))continue;const j=V.executorGroups[w];for(let J=0,te=j.length;J<te;++J)if(M=j[J].forEachFeatureAtCoordinate(e,s,l,i,x,T),M)break e}return M}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((t,i)=>{const r=this.getLayer(),o=r.getSource(),s=this.renderedProjection,l=s.getExtent(),u=this.renderedResolution,h=o.getTileGridForProjection(s),d=Gs(this.renderedPixelToCoordinateTransform_,e.slice()),m=h.getTileCoordForCoordAndResolution(d,u).toString(),y=this.renderedTiles.find(G=>G.tileCoord.toString()===m&&G.getState()===Vn.LOADED);if(!y||y.loadingSourceTiles>0){t([]);return}o.getWrapX()&&s.canWrapX()&&!_c(l,h.getTileCoordExtent(y.tileCoord))&&Lw(d,s);const x=ti(r),C=h.getTileCoordExtent(y.wrappedTileCoord),w=td(C),S=[(d[0]-w[0])/u,(w[1]-d[1])/u],T=y.getSourceTiles().reduce((G,N)=>G.concat(N.getFeatures()),[]);let M=y.hitDetectionImageData[x];if(!M){const G=ia(h.getTileSize(h.getZForResolution(u,o.zDirection))),N=this.renderedRotation_,V=[this.getRenderTransform(h.getTileCoordCenter(y.wrappedTileCoord),u,0,bl,G[0]*bl,G[1]*bl,0)];M=GB(G,V,T,r.getStyleFunction(),h.getTileCoordExtent(y.wrappedTileCoord),y.getReplayState(r).renderedResolution,N),y.hitDetectionImageData[x]=M}t(FB(S,T,M))})}getFeaturesInExtent(e){const t=[],i=this.getTileCache();if(i.getCount()===0)return t;const o=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),s=o.getZForResolution(this.renderedResolution),l={};return i.forEach(u=>{if(u.tileCoord[0]!==s||u.getState()!==Vn.LOADED)return;const h=u.getSourceTiles();for(let d=0,m=h.length;d<m;++d){const y=h[d],x=y.getKey();if(x in l)continue;l[x]=!0;const C=y.tileCoord;if(Os(e,o.getTileCoordExtent(C))){const w=y.getFeatures();if(w)for(let S=0,T=w.length;S<T;++S){const M=w[S],G=M.getGeometry();Os(e,G.getExtent())&&t.push(M)}}}}),t}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){const i=this.context,r=i.globalAlpha;i.globalAlpha=t.opacity;const o=e.viewHints,s=!(o[jr.ANIMATING]||o[jr.INTERACTING]),l=[this.context.canvas.width,this.context.canvas.height],u=this.getLayer().getDeclutter(),h=u?e.declutter?.[u]:void 0,d=ti(this.getLayer()),m=this.renderedTiles;for(let y=0,x=m.length;y<x;++y){const C=m[y],w=C.executorGroups[d];if(w)for(let S=w.length-1;S>=0;--S)w[S].execute(this.context,l,this.getTileRenderTransform(C,e),e.viewState.rotation,s,GC,h)}i.globalAlpha=r}renderDeferredInternal(e){const t=this.renderedTiles,i=ti(this.getLayer()),r=t.reduce((u,h,d)=>(h.executorGroups[i].forEach(m=>u.push({executorGroup:m,index:d})),u),[]),o=r.map(({executorGroup:u})=>u.getDeferredZIndexContexts()),s={};for(let u=0,h=r.length;u<h;++u){const d=r[u].executorGroup.getDeferredZIndexContexts();for(const m in d)s[m]=!0}Object.keys(s).map(Number).sort(Ec).forEach(u=>{o.forEach((h,d)=>{h[u]&&(h[u].forEach(m=>{const{executorGroup:y,index:x}=r[d],C=y.getRenderedContext(),w=C.globalAlpha;C.globalAlpha=this.renderedOpacity_;const S=this.tileClipContexts_[x];S&&S.draw(C),m.draw(C),S&&C.restore(),C.globalAlpha=w,m.clear()}),h[u].length=0)})})}getTileRenderTransform(e,t){const i=t.pixelRatio,r=t.viewState,o=r.center,s=r.resolution,l=r.rotation,u=t.size,h=Math.round(u[0]*i),d=Math.round(u[1]*i),y=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),x=e.tileCoord,C=y.getTileCoordExtent(e.wrappedTileCoord),w=y.getTileCoordExtent(x,this.tempExtent)[0]-C[0];return zR(oI(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(o,s,l,i,h,d,w))}postRender(e,t){const i=t.viewHints,r=!(i[jr.ANIMATING]||i[jr.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const o=this.getLayer(),s=o.getRenderMode(),l=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const u=o.getDeclutter(),h=u?wO[s].filter(V=>!GC.includes(V)):wO[s],d=t.viewState,m=d.rotation,y=o.getSource(),C=y.getTileGridForProjection(d.projection).getZForResolution(d.resolution,y.zDirection),w=this.renderedTiles,S=[],T=[],M=[],G=ti(o);let N=!0;for(let V=w.length-1;V>=0;--V){const W=w[V];N=N&&!W.getReplayState(o).dirty;const j=W.executorGroups[G].filter(D=>D.hasExecutors(h));if(j.length===0)continue;const J=this.getTileRenderTransform(W,t),te=W.tileCoord[0];let ce=!1;const pe=j[0].getClipCoords(J);let Y=e,he;if(pe){he=new YM,Y=he.getContext();for(let D=0,re=S.length;D<re;++D)if(C!==te&&te<T[D]){const le=S[D];Os([pe[0],pe[3],pe[4],pe[7]],[le[0],le[3],le[4],le[7]])&&(ce||(Y.save(),ce=!0),Y.beginPath(),Y.moveTo(pe[0],pe[1]),Y.lineTo(pe[2],pe[3]),Y.lineTo(pe[4],pe[5]),Y.lineTo(pe[6],pe[7]),Y.moveTo(le[6],le[7]),Y.lineTo(le[4],le[5]),Y.lineTo(le[2],le[3]),Y.lineTo(le[0],le[1]),Y.clip())}S.push(pe),T.push(te)}for(let D=0,re=j.length;D<re;++D)j[D].execute(e,[e.canvas.width,e.canvas.height],J,m,r,h,t.declutter?.[u]);ce&&(Y===e?Y.restore():M[V]=he)}e.globalAlpha=l,this.ready=N,this.tileClipContexts_=M,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,i,r,o,s){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let u=0,h=i.length;u<h;++u)l=FC(r,e,i[u],t,this.boundHandleStyleImageChange_,void 0,o,s)||l;else l=FC(r,e,i,t,this.boundHandleStyleImageChange_,void 0,o,s);return l}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const i=e.getReplayState(t),r=t.getRevision(),o=e.wantedResolution;return i.renderedTileResolution!==o||i.renderedTileRevision!==r}renderTileImage_(e,t){const i=this.getLayer(),r=e.getReplayState(i),o=i.getRevision(),s=e.executorGroups[ti(i)];r.renderedTileRevision=o;const l=e.wrappedTileCoord,u=l[0],h=i.getSource();let d=t.pixelRatio;const y=t.viewState.projection,x=h.getTileGridForProjection(y),C=x.getResolution(e.tileCoord[0]),w=t.pixelRatio/e.wantedResolution*C,S=x.getResolution(u),T=e.getContext();d=Math.round(Math.max(d,w/d));const M=h.getTilePixelSize(u,d,y);T.canvas.width=M[0],T.canvas.height=M[1];const G=d/w;if(G!==1){const j=GG(this.tmpTransform_);oI(j,G,G),T.setTransform.apply(T,j)}const N=x.getTileCoordExtent(l,this.tempExtent),V=w/S,W=GG(this.tmpTransform_);oI(W,V,-V),KY(W,-N[0],-N[3]);for(let j=0,J=s.length;j<J;++j)s[j].execute(T,[T.canvas.width*G,T.canvas.height*G],W,0,!0,hye[i.getRenderMode()],null);r.renderedTileResolution=e.wantedResolution}}class fye extends gM{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload;const i=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i;const r=e.renderMode||"hybrid";fr(r=="hybrid"||r=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=r,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new dye(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(nf.PRELOAD)}getUseInterimTilesOnError(){return this.get(nf.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(nf.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(nf.USE_INTERIM_TILES_ON_ERROR,e)}}class pye extends jM{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(Zx(e),this.adaptOptions(t))}readFeatureFromText(e,t){return Zn()}readFeatures(e,t){return this.readFeaturesFromText(Zx(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return Zn()}readGeometry(e,t){return this.readGeometryFromText(Zx(e),this.adaptOptions(t))}readGeometryFromText(e,t){return Zn()}readProjection(e){return this.readProjectionFromText(Zx(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return Zn()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return Zn()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return Zn()}}function Zx(n){return typeof n=="string"?n:""}const Sh={LINE_STRING:"LineString",POINT:"Point",POLYGON:"Polygon"},NW=Object.freeze({LineString:Sh.LINE_STRING,Point:Sh.POINT,Polygon:Sh.POLYGON,MultiLineString:Sh.LINE_STRING,MultiPoint:Sh.POINT,MultiPolygon:Sh.POLYGON});function gye(n){return n in NW}const EI="_mfp_style",mye=n=>{const e=n.geometry;return e&&e.type==="Point"?0:1},ZS=n=>{const e=Array.isArray(n)?n.join(","):n;return`[${EI} = '${e}']`};class DW{layerState_;layer_;customizer_;geojsonFormat=new Jl;deepIds_=new Map;lastDeepId_=0;constructor(e,t){this.layerState_=e,this.layer_=this.layerState_.layer,this.customizer_=t}encodeVectorLayer(e){const t=this.layer_.getSource();if(!t)return null;console.assert(t instanceof ua);const i=t.getFeaturesInExtent(this.customizer_.getPrintExtent()),r=[],o={version:2};return i.forEach(l=>this.encodeFeature(l,e,r,o)),r.length<=0||Object.keys(o).length<=1?null:(r.sort((l,u)=>{const h=mye;return h(u)-h(l)}),{geoJson:{type:"FeatureCollection",features:r},opacity:this.layerState_.opacity,style:o,type:"geojson",name:this.layer_.get("name")})}encodeFeature(e,t,i,r){let o=null;const s=e.getStyleFunction()||this.layer_.getStyleFunction();s&&(o=s(e,t)),e.getGeometry().getType()==="Circle"&&(e=this.featureCircleAsPolygon(e));const l=this.geojsonFormat.writeFeatureObject(e);let u=o!==null&&!Array.isArray(o)?[o]:o;if(!u||(u=u.filter(d=>!!d),u.length===0))return;console.assert(Array.isArray(u));let h=!1;u.forEach(d=>{let m=d.getGeometry(),y;if(typeof m=="function"&&(m=m(e)),m&&typeof m=="object"){const x=e.clone();x.setGeometry(m),y=this.geojsonFormat.writeFeatureObject(x),i.push(y)}else{if(y=l,m=e.getGeometry(),!m||!this.customizer_.geometryFilter(m))return;h||(i.push(y),h=!0)}this.addVectorStyle(r,y,d)})}getDeepStyleUid(e){const t=[e];let i="";for(;t.length;){const o=t.pop();i+="_k"+ti(o);for(const[s,l]of Object.entries(o))l!=null&&(["number","string","boolean"].includes(typeof l)?i+=`_${s}:${l}`:t.push(l))}if(this.deepIds_.has(i))return this.deepIds_.get(i).toString();const r=++this.lastDeepId_;return this.deepIds_.set(i,r),r.toString()}addVectorStyle(e,t,i){const r=this.getDeepStyleUid(i),o=ZS(r);let s;if(o in e)s=!0;else{const l=this.encodeVectorStyle(t,i);s=l&&l.symbolizers.length!==0,s&&(e[o]=l)}if(s){t.properties||(t.properties={}),this.customizer_.feature(this.layerState_,t);const l=t.properties[EI];if(l){const u=[...l.split(","),r];e[ZS(u)]={symbolizers:[...e[ZS(l)].symbolizers,...e[o].symbolizers]},t.properties[EI]=u.join(",")}else t.properties[EI]=r}}encodeVectorStyle(e,t){const i=e.geometry.type;if(!gye(i))return console.warn("Unsupported geometry type: ",i),null;const r=NW[i],o={symbolizers:[]},s=t.getFill(),l=t.getImage(),u=t.getStroke(),h=t.getText();return r===Sh.POLYGON?s!==null&&this.encodeVectorStylePolygon(e,o.symbolizers,s,u):r===Sh.LINE_STRING?u!==null&&this.encodeVectorStyleLine(e,o.symbolizers,u):r===Sh.POINT&&l!==null&&this.encodeVectorStylePoint(e,o.symbolizers,l),h!==null&&this.encodeVectorStyleText(e,o.symbolizers,h),o}encodeVectorStyleFill(e,t,i){let r=i.getColor();r!==null&&(console.assert(typeof r=="string"||Array.isArray(r)),r=Hl(r),console.assert(Array.isArray(r),"only supporting fill colors"),t.fillColor=BS(r),t.fillOpacity=r[3])}encodeVectorStyleLine(e,t,i){const r={type:"line"};this.encodeVectorStyleStroke(e,r,i),this.customizer_.line(this.layerState_,e,r,i),t.push(r)}encodeVectorStylePoint(e,t,i){let r;i instanceof Qs?r=this.encodeVectorStylePointStyleCircle(e,i):i instanceof Gu&&(r=this.encodeVectorStylePointStyleIcon(e,i)),r&&(this.customizer_.point(this.layerState_,e,r,i),t.push(r))}encodeVectorStylePointStyleCircle(e,t){const i={type:"point"};i.pointRadius=t.getRadius();const r=t.getScale();r&&(Array.isArray(r)?i.pointRadius*=(r[0]+r[1])/2:i.pointRadius*=r);const o=t.getFill();let s=t.getStroke();return o!==null&&(this.encodeVectorStyleFill(e,i,o),s||(s=new ki({color:o.getColor()}))),s!==null&&this.encodeVectorStyleStroke(e,i,s),i}encodeVectorStylePointStyleIcon(e,t){const i=t.getSrc();if(i===void 0)return;const r={type:"point",externalGraphic:i},o=t.getOpacity();o!==null&&(r.graphicOpacity=o);const s=t.getSize();if(s!==null){let u=t.getScale();Array.isArray(u)&&(u=(u[0]+u[1])/2),isNaN(u)&&(u=1);const h=s[0]*u,d=s[1]*u;r.graphicWidth=d,this.addGraphicOffset_(r,t,h,d)}let l=t.getRotation();return isNaN(l)&&(l=0),r.rotation=Kh(l),r}addGraphicOffset_(e,t,i,r){if(this.hasDefaultAnchor_(t))return;const o=t.getAnchor(),s=i/2-o[0],l=r/2-o[1];e.graphicXOffset=s,e.graphicYOffset=l}hasDefaultAnchor_(e){const t=e,i=t.anchor_[0]===.5&&t.anchor_[1]===.5,r=t.anchorOrigin_==="top-left",o=t.anchorXUnits_==="fraction",s=t.anchorYUnits_==="fraction";return i&&r&&o&&s}encodeVectorStylePolygon(e,t,i,r){const o={type:"polygon"};this.encodeVectorStyleFill(e,o,i),r!==null&&this.encodeVectorStyleStroke(e,o,r),t.push(o)}encodeVectorStyleStroke(e,t,i){const r=i.getColor();if(r!==null){console.assert(typeof r=="string"||Array.isArray(r));const h=Hl(r);console.assert(Array.isArray(h),"only supporting stroke colors"),t.strokeColor=BS(h),t.strokeOpacity=h[3]}const o=i.getLineDash();o!==null&&(t.strokeDashstyle=o.join(" "));const s=i.getWidth();s!==void 0&&(t.strokeWidth=s);const l=i.getLineCap();l&&(t.strokeLinecap=l);const u=i.getLineJoin();u&&(t.strokeLinejoin=u)}encodeVectorStyleText(e,t,i){if(i.getText()){const o=oC(i.getFont()||"12px sans-serif"),s={type:"text",label:i.getText(),fontFamily:o?.family??"sans-serif",fontSize:o?.size??"12px",fontStyle:o?.style??"normal",fontWeight:o?.weight??"normal",labelXOffset:i.getOffsetX(),labelYOffset:-i.getOffsetY(),labelAlign:"cm"},l=i.getFill();l!==null&&(this.encodeVectorStyleFill(e,s,l),s.fontColor=s.fillColor);const u=i.getStroke();if(u!==null){const h=u.getColor();if(h){console.assert(typeof h=="string"||Array.isArray(h));const m=Hl(h);console.assert(Array.isArray(m),"only supporting stroke colors"),s.haloColor=BS(m),s.haloOpacity=m[3]}const d=u.getWidth();d!==void 0&&(s.haloRadius=d)}this.customizer_.text(this.layerState_,e,s,i),t.push(s)}}featureCircleAsPolygon(e){return new Zi({...e.getProperties(),geometry:kD(e.getGeometry(),OW.CIRCLE_TO_POLYGON_SIDES)})}}class yye{url;scratchCanvas=document.createElement("canvas");constructor(e){this.url=e}async encodeMap(e){const t=e.map.getView(),i=t.getCenter(),r=t.getProjection().getCode(),o=Kh(t.getRotation()),s=e.map.getLayerGroup(),l=await this.encodeLayerGroup(s,e.printResolution,e.customizer);return{center:i,dpi:e.dpi,projection:r,rotation:o,scale:e.scale,layers:l}}async encodeLayerGroup(e,t,i){const r=e.getLayerStatesArray().filter(i.layerFilter).sort((s,l)=>(s.zIndex||0)-(l.zIndex||0)).reverse(),o=[];for(const s of r){const l=await this.encodeLayerState(s,t,i);l&&(Array.isArray(l)?o.push(...l):o.push(l))}return o}async encodeLayerState(e,t,i){if(!e.visible||t<e.minResolution||t>=e.maxResolution)return null;const r=e.layer;if(r instanceof nv)return this.encodeImageLayerState(e,i);if(r instanceof bo){const o=new DW(e,i).encodeVectorLayer(t),s=e.layer.get("renderAsSvg");return s!==void 0&&(o.renderAsSvg=s),o}return r instanceof Ym?this.encodeTileLayerState(e,i):r instanceof fye?await this.encodeMVTLayerState(e,t,i):null}encodeImageLayerState(e,t){const i=e.layer;return i instanceof nv||console.assert(i instanceof nv),i.getSource()instanceof QC?this.encodeImageWmsLayerState(e,t):null}encodeImageWmsLayerState(e,t){const r=e.layer.getSource();console.assert(r instanceof QC);const o=r.getUrl();return o!==void 0?this.encodeWmsLayerState(e,o,r.getParams(),t):null}encodeWmsLayerState(e,t,i,r){const o=e.layer,s={...i};return["SERVICE","REQUEST","FORMAT","LAYERS","VERSION","STYLES"].forEach(l=>delete s[l]),{name:o.get("name"),baseURL:t,imageFormat:i.FORMAT,layers:i.LAYERS.split(","),customParams:s,serverType:"mapserver",type:"wms",opacity:o.getOpacity(),version:i.VERSION,useNativeAngle:!0,styles:i.STYLES?.split(",")??[""]}}encodeTileLayerState(e,t){const i=e.layer;console.assert(i instanceof Ym);const r=i.getSource();return r instanceof eb?this.encodeTileWmtsLayerState(e,t):r instanceof XT?this.encodeTileWmsLayerState(e,t):r instanceof cye?this.encodeOSMLayerState(e,t):null}encodeTileWmsLayerState(e,t){const i=e.layer;console.assert(i instanceof Ym);const r=i.getSource();console.assert(r instanceof XT);const o=r.getUrls();console.assert(!!o);const s=this.encodeWmsLayerState(e,o[0],r.getParams(),t);return t.wmsLayer(e,s,r),s}encodeOSMLayerState(e,t){const i=e.layer;return{type:"osm",baseURL:i.getSource().getUrls()[0],opacity:e.opacity,name:i.get("name")}}encodeTileWmtsLayerState(e,t){const i=e.layer;console.assert(i instanceof Ym);const r=i.getSource();console.assert(r instanceof eb);const o=r.getDimensions(),s=Object.keys(o),l={type:"wmts",baseURL:sye(r),dimensions:s,dimensionParams:o,imageFormat:r.getFormat(),name:i.get("name"),layer:r.getLayer(),matrices:nye(r),matrixSet:r.getMatrixSet(),opacity:e.opacity,requestEncoding:r.getRequestEncoding(),style:r.getStyle(),version:r.getVersion()};return t.wmtsLayer(e,l,r),l}async encodeMVTLayerState(e,t,i){const r=e.layer,{MVTEncoder:o}=await ZI(async()=>{const{MVTEncoder:x}=await import("./main-A7MfD1rV.js");return{MVTEncoder:x}},[]),s=new o,l=i.getPrintExtent(),u=Ni(l)/t,h=Ns(l)/t,d=[u,h],m={layer:r,printExtent:i.getPrintExtent(),tileResolution:t,styleResolution:t,canvasSize:d};return(await s.encodeMVTLayer(m)).filter(x=>x.baseURL.length>6).map(x=>Object.assign({type:"image",name:r.get("name"),opacity:1,imageFormat:"image/png"},x))}async encodeAsImageLayer(e,t,i,r){const o=e.layer,s=i.getPrintExtent(),l=Ni(s)/t,u=Ns(s)/t,h=[l,u],d=ile(this.scratchCanvas.getContext("2d"),{size:h,pixelRatio:1}),m=aye(s,t,h),y=o.getSource().getFeatures(),x=o.getStyleFunction();return oye(y,x,t,m,d,r),{type:"image",extent:s,imageFormat:"image/png",opacity:1,name:o.get("name"),baseURL:iye(this.scratchCanvas,o.getOpacity()).toDataURL("PNG")}}}const JT=39.37,qT=72;class _ye extends cg{constructor(e={}){super(e),this.context_=qs(),this.context_.canvas.style.opacity="0.5",this.context_.canvas.style.position="absolute",this.size=void 0,this.rotation=void 0,this.scale=void 0}render(e){const t=this.context_.canvas.width=e.size[0],i=this.context_.canvas.height=e.size[1],r=[t/2,i/2];this.context_.beginPath(),this.context_.moveTo(0,0),this.context_.lineTo(t,0),this.context_.lineTo(t,i),this.context_.lineTo(0,i),this.context_.lineTo(0,0),this.context_.closePath();const o=this.getSize();if(!o)return;const s=o[1],l=o[0],u=this.getScale();if(!u)return;const h=e.viewState.resolution,d=l/qT/JT*u/h/2,m=s/qT/JT*u/h/2,y=this.getRotation()!==void 0?ra(this.getRotation()):0,x=Math.sqrt(Math.pow(d,2)+Math.pow(m,2)),C=Math.atan(m/d)-y,w=Math.atan(d/m)-y,S=r[0]-Math.cos(C)*x,T=r[1]+Math.sin(C)*x,M=r[0]+Math.sin(w)*x,G=r[1]+Math.cos(w)*x,N=r[0]+Math.cos(C)*x,V=r[1]-Math.sin(C)*x,W=r[0]-Math.sin(w)*x,j=r[1]-Math.cos(w)*x;return this.context_.moveTo(S,T),this.context_.lineTo(M,G),this.context_.lineTo(N,V),this.context_.lineTo(W,j),this.context_.lineTo(S,T),this.context_.closePath(),this.context_.fillStyle="#000",this.context_.fill(),this.context_.canvas}getSize(){return this.size}getScale(){return this.scale}getRotation(){return this.rotation}setSize(e){this.size=e}setScale(e){this.scale=e}setRotation(e){this.rotation=e}}const vye=st({__name:"notification-item",props:{notification:{}},emits:["close"],setup(n){const e=n,t=Ei(!0);function i(r,o){setTimeout(()=>{t.value=!1},e.notification.duration),o()}return(r,o)=>{const s=Tl("dompurify-html");return U(),Mt(Ew,{name:"fade-out",appear:"","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"transform opacity-0",onEnter:i,onAfterLeave:o[0]||(o[0]=l=>r.$emit("close"))},{default:Xt(()=>[t.value?Sn((U(),oe("div",{key:0,"data-cy":"notification",class:Dn(["lux-alert",`lux-${e.notification.type}`]),role:"alert"},null,2)),[[s,e.notification.message]]):Ge("",!0)]),_:1})}}}),bye={key:0,class:"lux-notifications fixed w-[calc(100%-2rem)] max-w-[500px] top-10 left-1/2 -translate-x-1/2 z-[9999] mx-4 sm:mx-0","data-cy":"alertNotifications"},xye=st({__name:"alert-notifications",setup(n){const e=ns(),{notifications:t}=xt(e);function i(r){e.removeNotification(r)}return(r,o)=>(U(),Mt(bw,{to:"body"},[k(t).length?(U(),oe("div",bye,[(U(!0),oe(Et,null,yi(k(t),(s,l)=>(U(),Mt(vye,{key:l,notification:s,onClose:()=>i(s.uuid)},null,8,["notification","onClose"]))),128))])):Ge("",!0)]))}}),Iye=["title"],AO=st({__name:"background-selector-item",props:{bgTitle:{type:String,default:""},bgName:{type:String,default:""}},setup(n){const{t:e}=Ct(),t=n,i=At(()=>{const o=e(t.bgTitle),s=t.bgTitle.length>0,l=e(t.bgName);return`${o}${s?" - ":""}${l}`}),r=At(()=>`h-full w-full rounded-sm lux-bg-sel-icon
        lux-bg-sel-${t.bgName}
        bg-${t.bgName}_sm
        md:bg-${t.bgName}
        hd:bg-${t.bgName}_sm_hi
        hd_md:bg-${t.bgName}_hi`);return(o,s)=>(U(),oe("button",{title:i.value,class:Dn(r.value)},null,10,Iye))}}),Cye={key:0,class:"flex flex-row-reverse"},SO=st({__name:"background-selector",props:{isOpen:{type:Boolean,default:!1}},setup(n){const{t:e,i18next:t}=Ct(),i=iA(),r=Wi(),o=Vr(),{bgLayer:s,is3dMesh:l}=xt(r),h=Ke(n.isOpen),d=Ke(!1),m=Ke([]),y=At(()=>s.value?.id??i.getNullId()),x=At(()=>m.value?.find(S=>S.id===y.value)?.name);kt(()=>o.bgLayers,S=>{m.value=Bh().bg_layers.map(T=>Object.assign({id:T.id},S.find(M=>T.id===M.id),{name:T.icon_id}))},{immediate:!0}),kt(()=>r.bgLayer,(S,T)=>{const M=r.layers;T===void 0&&S===null&&M?.length===0&&(i.setBgLayer(i.defaultSelectedBgId.value),S===null&&(d.value=!0))}),kt([d,()=>t.isInitialized],([S,T])=>{S&&T&&ns().addNotification(e("Aucune couche n'tant dfinie pour cette carte, une couche de fond a automatiquement t ajoute."))});function C(S){i.setBgLayer(S.id),h.value=!1}function w(){h.value=!h.value}return(S,T)=>k(l)?Ge("",!0):(U(),oe("div",Cye,[P("div",{"data-cy":"selectedBg",class:Dn(["lux-bg-sel border border-black",h.value===!0?"hidden":"block"])},[mt(AO,{"aria-expanded":h.value,"bg-title":"Select BG layer","bg-name":x.value,onClick:w},null,8,["aria-expanded","bg-name"])],2),P("div",{"data-cy":"available-bgs",class:Dn(h.value===!0?"flex flex-col md:flex-row":"hidden")},[(U(!0),oe(Et,null,yi(m.value,M=>(U(),oe("div",{key:M.id,class:Dn(["lux-bg-sel hover:bg-cyan-600",M.id===y.value?"border-red-500 border-2":"border-black border"])},[mt(AO,{"bg-name":M.name,onClick:G=>C(M)},null,8,["bg-name","onClick"])],2))),128))],2)]))}}),rg=Sa("info",()=>{const n=Ke(void 0),e=Ke(void 0),t=Ke(!1),i=Ke(!1),r=Ke(!0),o=Ke(!1),s=Ke(!1),l=Ke(void 0),u=Ke(void 0);return{locationInfoCoords:n,locationInfoInfos:e,hidePointer:t,isStreetviewActive:i,noDataAtLocation:r,streetViewLoading:o,panoPositionChanging:s,svFeature:l,routingFeatureTemp:u}}),wye=1501,Aye="infoFeatureLayer";function Sye(){const n=Kn().getOlMap();let e=null,t=null;const{infoOpen:i}=xt(oi()),{locationInfoCoords:r,hidePointer:o}=xt(rg()),{clearContent:s}=tg(),l=new bo({source:new ua({features:[]}),zIndex:wye});l.set("cyLayerType",Aye),d(l),n.addLayer(l),kt(i,m=>{m||(r.value=void 0)}),kt([r,o],([m,y])=>{if(l.getSource()?.clear(),m&&!y){i.value=!0;const x=new Zi(new Mr(m));l.getSource()?.addFeature(x)}},{immediate:!0}),n.getViewport().addEventListener("contextmenu",m=>m.preventDefault()),In(n,"pointerdown",m=>h(m));function u(m){return n.getEventCoordinate(m.originalEvent)}function h(m){e=m.pixel,t=Date.now(),m.originalEvent.button===2&&(r.value=u(m),s())}In(n,"pointerup",m=>{const y=m.originalEvent;if(e&&t!==null){const x=m.pixel,C=Math.abs(e[0]-x[0]),w=Math.abs(e[1]-x[1]),S=Date.now()-t;y.pointerType==="touch"&&C+w<6&&S>=400?(r.value=u(m),s()):y.button===0&&C+w<6&&(o.value||(r.value=void 0))}e=null,t=null}),In(n,"pointermove",m=>{if(e!==null){const y=m.pixel,x=Math.abs(e[0]-y[0]),C=Math.abs(e[1]-y[1]);x+C>6&&(e=null,t=null)}});function d(m){const y=new Ji({color:[255,255,0,.6]}),x=new ki({color:[255,155,55,1],width:3}),C=new Qs({radius:10,fill:y,stroke:x});m.setStyle([new qn({image:C})])}}const Eye={"EPSG:2169":"Luref","EPSG:4326":"Lon/Lat WGS84","EPSG:4326:DMS":"Lon/Lat WGS84 DMS","EPSG:4326:DMm":"Lon/Lat WGS84 DM","EPSG:3263*":"WGS84 UTM"},Tye=[46602,53725,106944,141219];async function Rye(n,e){const t=gs(n,e,tu),[i,r,o]=(await Promise.allSettled([kye(n),Kv(n),Lye(t)])).map(s=>s.status==="fulfilled"?s.value:void 0);return{shortUrl:i,elevation:r,address:o,clickCoordinateLuref:t,isInBoxOfLidar:Mye(t)}}function Mye(n){return Lc(Tye,n)}async function kye(n){return(await jl.getShortUrl(n)).short_url.replace("http://g-o.lu/migration/","https://migration.geoportail.lu/s/")}async function Lye(n){return(await(await fetch(`https://migration.geoportail.lu/geocode/reverse?easting=${n[0]}&northing=${n[1]}`)).json()).results[0]}const Tk=Sa("print",()=>{const n=Ke(void 0),e=Ke(void 0);return{featureInfoPrintableRef:n,locationInfoPrintableRef:e}},{});function Pye(n){return n&&`https://migration.geoportail.lu/qr?url=${n}`}function Gye(n){return n!==void 0?`https://migration.geoportail.lu/qr?url=https://migration.geoportail.lu/qr?map_id=${n}`:void 0}function EO(n){if(n)return n.startsWith("data:image")?n:(n.startsWith("/")&&"https://migration.geoportail.lu/".endsWith("/")&&(n="."+n),`https://migration.geoportail.lu/${n}`)}const Fye={class:"flex flex-row"},Oye={class:"no-print grow-[2] flex flex-col justify-end content-end"},Nye={id:"short_url_title",class:"text-3xl text-white"},Dye=["value"],Vye=["src"],Bye={class:"mt-5 text-3xl text-white"},Zye={class:"lux-info-table"},Wye={style:{"text-align":"left"}},zye={style:{"text-align":"left"}},Uye=["disabled"],Xye={class:"flex flex-wrap mt-1 gap-x-1"},Yye=["href"],Hye=["href"],Kye=["href"],jye={class:"create-itinerary-text"},$ye={class:"lux-panel-content relative grow p-2.5 bg-primary overflow-auto"},Jye={class:"text-white"},qye={class:"flex justify-center flex-col items-center"},Qye=["href"],e_e=st({__name:"location-info",setup(n){const{t:e}=Ct(),{locationInfoCoords:t,locationInfoInfos:i,routingFeatureTemp:r}=xt(rg()),{currentUser:o}=xt(Du()),{addNotification:s}=ns(),l=Kn().getOlMap(),u=Ke(),h=Ke(),d=Ke(),m=Ke(),y=Ke(),x=Ke({}),C=Ke(!1),w=Ke(!1),S=Ke("ACT"),T=Ke("base");Sye(),M(t.value),kt(t,M);async function M(re){re&&(i.value=await Rye(re,l.getView().getProjection()),u.value=i.value.shortUrl,h.value=Pye(i.value.shortUrl),y.value=i.value.clickCoordinateLuref,x.value=Object.fromEntries(Object.entries(Eye).map(([le,fe])=>[fe,wj(re,l.getView().getProjection(),le)])),d.value=i.value.elevation===null?"N/A":vM(i.value.elevation),m.value=i.value.address,w.value=i.value.isInBoxOfLidar)}kt(o,re=>{S.value=re?.role||"anonymous",T.value=re?.role||"base"});const{locationInfoPrintableRef:G}=xt(Tk()),N=re=>G.value=re,V=At(()=>S.value==="ACT"),W=At(()=>T.value==="etat"||T.value==="commune"||S.value==="MinTour"),j=At(()=>!0),J=At(()=>y.value?`https://lidar.geoportail.lu?COORD_X=${y.value[0]}&COORD_Y=${y.value[1]}&COORD_Z=${parseInt(d.value||"0")}`:""),te=At(()=>y.value?`/getRapportForageVirtuel?x=${y.value[0]}&y=${y.value[1]}`:""),ce=At(()=>y.value?`http://streetsmart.cyclomedia.com/streetsmart?q=${y.value[0]};${y.value[1]}`:""),pe=At(()=>y.value?`https://oblique.geoportail.lu/publication/viewer?x=${y.value[0]}&y=${y.value[1]}&crs=2169`:""),Y=At(function(){const re=y.value?gs(y.value,tu,Fu):void 0;return y.value?`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${(re??[0,0])[1]},${(re??[0,0])[0]}&heading=0&pitch=0&fov=90`:""});function he(){if(!t.value)return;const re=new Zi(new Mr(t.value));m.value&&m.value.distance<=100?re.set("label",sF(m.value)):re.set("label",x.value.Luref),r.value=re}async function D(){C.value=!0;try{await Mse(te.value,"")}catch{s(e("An error occurred while downloading forage."),mi.ERROR)}finally{C.value=!1}}return kt(C,re=>{re?l.getViewport().style.cursor="wait":l.getViewport().style.cursor=""}),(re,le)=>(U(),oe(Et,null,[P("div",{ref:N},[P("div",Fye,[P("div",Oye,[P("h3",Nye,K(k(e)("Short Url",{ns:"client"})),1),P("input",{"aria-labelledby":"short_url_title",onclick:"this.select();",class:"lux-input",type:"text",value:u.value,readonly:"true"},null,8,Dye)]),h.value?(U(),oe("img",{key:0,class:"mx-5 mt-5",src:h.value},null,8,Vye)):Ge("",!0)]),P("div",null,[P("h3",Bye,K(k(e)("Location Coordinates",{ns:"client"})),1),P("table",null,[P("tbody",Zye,[(U(!0),oe(Et,null,yi(x.value,(fe,Le)=>(U(),oe("tr",{key:Le},[P("th",null,K(k(e)(Le)),1),P("td",null,K(fe),1)]))),128)),P("tr",null,[P("th",null,K(k(e)("Elevation")),1),P("td",null,K(d.value),1)]),P("tr",null,[P("th",Wye,K(k(e)("Adresse la plus proche")),1),P("td",null,K(k(sF)(m.value)),1)]),P("tr",null,[P("th",zye,K(k(e)("Distance approximative")),1),P("td",null,K(k(af)(m.value?.distance||null,0)),1)])])])])]),P("div",null,[le[3]||(le[3]=P("hr",null,null,-1)),V.value?(U(),oe("button",{key:0,disabled:C.value,class:"lux-btn mt-1",onClick:le[0]||(le[0]=fe=>D())},K(k(e)("Rapport forage virtuel")),9,Uye)):Ge("",!0),P("div",Xye,[w.value?(U(),oe("a",{key:0,class:"lux-btn whitespace-nowrap",href:J.value,target:"_geoportal_ext_lidar"},K(k(e)("Lien vers la dmo lidar")),9,Yye)):Ge("",!0),W.value?(U(),oe("a",{key:1,class:"lux-btn whitespace-nowrap",href:ce.value,target:"_geoportal_ext_cyclomedia"},K(k(e)("Lien vers Cyclomdia")),9,Hye)):Ge("",!0),j.value?(U(),oe("a",{key:2,class:"lux-btn whitespace-nowrap",href:pe.value,target:"_geoportal_ext_obliques"},K(k(e)("Images obliques")),9,Kye)):Ge("",!0)]),P("div",null,[P("button",{class:"lux-btn mt-1",onClick:le[1]||(le[1]=fe=>he())},[P("span",jye,K(k(e)("Ajouter tape  mon itinraire")),1)])]),P("div",$ye,[le[2]||(le[2]=P("hr",null,null,-1)),P("span",Jye,K(k(e)("Suite  la modification des conditions d'utilisation de Google Street View, nous avons dsactiv son intgration dans la carte et proposons dsormais un lien direct vers le service de Google.")),1),P("div",qye,[P("a",{class:"lux-btn whitespace-nowrap",href:Y.value,target:"_streetview_ext"},K(k(e)("Ouvrir streetView")),9,Qye)])])])],64))}}),t_e=["role"],n_e={class:"bg-white shadow-modal rounded-lg overflow-hidden w-[700px]"},i_e={class:"relative flex flex-row items-center py-2 px-4 border-b-[1px]"},r_e={class:"text-xl grow"},s_e={key:0,class:"p-[15px] border-t-[1px]"},o_e={class:"flex flex-row justify-end"},Rf=st({__name:"modal-dialog",props:{footer:{type:Boolean,default:!0},maxHeight:{type:Boolean,default:!1},title:String,role:{type:String,default:"dialog"}},emits:["close"],setup(n){const{t:e}=Ct(),t=Ke();gr(()=>{t.value.focus()});const i=Ei(!0);function r(){i.value=!1}return(o,s)=>(U(),Mt(bw,{to:"body"},[s[5]||(s[5]=P("div",{class:"fixed inset-0 bg-gray-900 opacity-40 z-[1050]"},null,-1)),mt(Ew,{appear:"","enter-active-class":"duration-200 ease-out","enter-from-class":"transform opacity-0 -translate-y-60","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"transform opacity-0 -translate-y-60",onAfterLeave:s[3]||(s[3]=l=>o.$emit("close"))},{default:Xt(()=>[i.value?(U(),oe("div",{key:0,role:n.role,ref_key:"modal",ref:t,tabindex:"0",onKeydown:s[2]||(s[2]=Js(fs(l=>r(),["stop"]),["esc"])),class:"fixed inset-x-0 inset-y-8 flex items-start justify-center z-[1100] outline-none"},[P("div",n_e,[P("div",i_e,[P("h4",r_e,K(n.title),1),P("button",{type:"button",class:"text-slate-400 text-2xl","data-dismiss":"modal","aria-label":"Close",onClick:s[0]||(s[0]=l=>r())},[...s[4]||(s[4]=[P("span",{"aria-hidden":"true"},"",-1)])])]),P("div",{class:Dn(["p-[15px] overflow-y-auto",n.maxHeight?"max-h-96":"max-h-full"])},[Jn(o.$slots,"content")],2),n.footer?(U(),oe("div",s_e,[Jn(o.$slots,"footer",{},()=>[P("div",o_e,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:s[1]||(s[1]=l=>r())},K(k(e)("Close",{ns:"client"})),1)])])])):Ge("",!0)])],40,t_e)):Ge("",!0)]),_:3})]))}});function a_e(){const{t:n}=Ct();return{translate:(t,i)=>{const o=new DOMParser().parseFromString(t,"text/html");return o.querySelectorAll("[translate]").forEach(l=>{const u=l.textContent?.trim();u&&(l.textContent=n(u,i),l.removeAttribute("translate"))}),new XMLSerializer().serializeToString(o)}}}const l_e={key:0,class:"lux-legend"},u_e={key:1},QT=st({__name:"legend-item",props:{layer:{},displayEmptyLegend:{type:Boolean,default:!1}},emits:["hasLegend","removedLegend"],setup(n,{emit:e}){const{t,i18next:i}=Ct(),{translate:r}=a_e(),o=Ke(),s=n,l=e;kt(()=>i.language,()=>u()),gr(()=>u()),Ds(()=>l("removedLegend"));async function u(){o.value=await EC.getLayerMetadata(s.layer.id,i.language),l("hasLegend",!!o.value?.hasLegend)}return(h,d)=>{const m=Tl("dompurify-html");return o.value&&o.value.legendHtml?.innerHTML?(U(),oe("div",l_e,[Jn(h.$slots,"title"),Sn(P("div",null,null,512),[[m,k(r)(o.value.legendHtml?.innerHTML)]])])):!o.value?.hasLegend&&n.displayEmptyLegend?(U(),oe("div",u_e,K(k(t)("The legend is not available for this layer")),1)):Ge("",!0)}}}),c_e={class:"font-bold"},h_e={class:"col-span-2"},d0=st({__name:"layer-metadata-item",props:{label:{},value:{}},setup(n){const e=n;return(t,i)=>(U(),oe(Et,null,[P("span",c_e,K(e.label),1),P("span",h_e,K(e.value),1)],64))}}),d_e={"data-cy":"metadata",class:"grid gap-2 grid-cols-3 pt-3 text-[13px] font-arial break-words"},f_e={key:2,class:"col-span-3 grid gap-2 grid-cols-3"},p_e={class:"font-bold"},g_e={class:"col-span-2"},m_e=["title"],y_e=["title"],__e={key:4,class:"col-span-3"},v_e={class:"font-bold"},b_e={class:"col-span-2"},x_e=["href"],I_e={key:7,class:"col-span-3 grid gap-2 grid-cols-3"},C_e={class:"font-bold"},w_e={class:"col-span-2"},A_e={key:0},S_e={key:1},E_e={key:2},T_e={key:3},R_e={key:4},M_e=["href"],k_e={key:8,class:"grid gap-2 grid-cols-3 col-span-3"},L_e={class:"font-bold"},P_e={class:"col-span-2"},G_e=["href"],F_e={key:9,class:"col-span-3"},WS=220,O_e=st({__name:"layer-metadata",setup(n){const e=rA(),{metadataLayer:t}=xt(e),{t:i,i18next:r}=Ct(),o=Ke(),s=Ke(!0);kt(t,async m=>{o.value=m?await EC.getLayerMetadata(m.id,r.language):void 0,s.value=(o.value?.description?.length||0)<WS}),kt(()=>r.language,async m=>{t.value&&(o.value=await EC.getLayerMetadata(t.value.id,m))});const l=At(()=>s.value?o.value?.description:o.value?.description?.slice(0,WS));function u(){s.value=!0}function h(){s.value=!1}function d(){e.clearMetadataLayer()}return(m,y)=>{const x=Tl("dompurify-html");return o.value?(U(),Mt(Rf,{key:0,footer:!1,"max-height":!0,title:k(i)(`${o.value.title}`,{ns:"client"}),onClose:d},{content:Xt(()=>[P("div",d_e,[o.value.name?(U(),Mt(d0,{key:0,label:k(i)("Name"),value:o.value.name},null,8,["label","value"])):Ge("",!0),o.value.serviceDescription?(U(),Mt(d0,{key:1,label:k(i)("Description du Service"),value:o.value.serviceDescription},null,8,["label","value"])):Ge("",!0),o.value.description?(U(),oe("div",f_e,[P("span",p_e,K(k(i)("Description")),1),P("span",g_e,[Sn(P("span",null,null,512),[[x,l.value]]),s.value?Ge("",!0):(U(),oe("button",{key:0,title:k(i)("Display full description",{ns:"app"}),onClick:u,class:"text-secondary hover:underline"}," ... ",8,m_e)),s.value&&(l.value?.length||0)>WS?(U(),oe("button",{key:1,title:k(i)("Hide full description",{ns:"app"}),onClick:h,class:"text-secondary hover:underline"}," - ",8,y_e)):Ge("",!0)])])):Ge("",!0),o.value.legalConstraints?(U(),Mt(d0,{key:3,label:k(i)("Contrainte d'utilisation"),value:o.value.legalConstraints},null,8,["label","value"])):Ge("",!0),o.value.link?.length!==0?(U(),oe("div",__e,[(U(!0),oe(Et,null,yi(o.value.link,C=>(U(),oe("div",{class:"grid gap-2 grid-cols-3",key:C},[P("span",v_e,K(k(i)("Url vers la resource")),1),P("span",b_e,[P("a",{class:"text-secondary hover:underline",target:"_blank",href:C},K(C),9,x_e)])]))),128))])):Ge("",!0),o.value.revisionDate?(U(),Mt(d0,{key:5,label:k(i)("Revision date"),value:k(_M)(o.value.revisionDate,k(r).language)},null,8,["label","value"])):Ge("",!0),o.value.keyword?(U(),Mt(d0,{key:6,label:k(i)("Keywords"),value:o.value.keyword?.join(",")},null,8,["label","value"])):Ge("",!0),o.value.responsibleParty?(U(),oe("div",I_e,[P("div",C_e,K(k(i)("Contact")),1),P("div",w_e,[o.value.responsibleParty?.organisaton?(U(),oe("p",A_e,K(o.value.responsibleParty?.organisaton),1)):Ge("",!0),o.value.responsibleParty?.name?(U(),oe("p",S_e,K(o.value.responsibleParty?.name),1)):Ge("",!0),o.value.responsibleParty?.unknown?(U(),oe("p",E_e,K(o.value.responsibleParty?.unknown),1)):Ge("",!0),o.value.responsibleParty?.address?(U(),oe("p",T_e,K(o.value.responsibleParty?.address),1)):Ge("",!0),o.value.responsibleParty?.email?(U(),oe("p",R_e,[P("a",{class:"text-secondary hover:underline",href:"mailto:"+o.value.responsibleParty?.email},K(o.value.responsibleParty?.email),9,M_e)])):Ge("",!0)])])):Ge("",!0),o.value.metadataLink?(U(),oe("div",k_e,[P("span",L_e,K(k(i)("Link to the metadata")),1),P("span",P_e,[P("a",{class:"text-secondary hover:underline",target:"_blank",href:o.value.metadataLink},K(k(i)("link")),9,G_e)])])):Ge("",!0),o.value.isError?(U(),oe("div",F_e,K(k(i)("The metadata is right now not available")),1)):k(t)?(U(),Mt(QT,{key:10,class:"mt-5 col-span-3",layer:k(t),displayEmptyLegend:!0},{title:Xt(()=>[P("h4",null,K(k(i)("Legend")),1)]),_:1},8,["layer"])):Ge("",!0)])]),_:1},8,["title"])):Ge("",!0)}}}),N_e={class:"flex flex-row flex-wrap pl-2.5","data-cy":"themeGrid"},D_e=["onClick"],V_e={class:"text-2xl absolute top-5"},B_e=st({__name:"theme-grid",props:{themes:{}},setup(n){const{t:e}=Ct(),t=n;return(i,r)=>(U(),oe("div",N_e,[(U(!0),oe(Et,null,yi(t.themes,o=>(U(),oe("button",{class:Dn(["relative shrink-0 h-[150px] w-1/2 px-2.5 text-start text-gray-100/40 uppercase hover:bg-[#ccc]",`bg-${o.name}-primary hover:text-${o.name}-primary`]),key:o.id,onClick:s=>i.$emit("setTheme",o.name)},[P("div",V_e,K(k(e)(`${o.name}`)),1),P("div",{class:Dn(["text-6xl absolute bottom-1 after:font-icons",`after:content-${o.name}`])},null,2)],10,D_e))),128))]))}}),Z_e=["aria-expanded"],W_e={class:"py-0.5"},z_e={class:"px-1 py-0.5 shrink-0 flex flex-row text-[12px] bg-secondary text-white"},U_e={class:"py-[3px]"},X_e={class:"flex flex-row flex-wrap ml-1 w-12"},Y_e=st({__name:"theme-selector-button",props:{themes:{},themeName:{},currentTheme:{},isOpen:{type:Boolean}},setup(n){const{t:e}=Ct(),t=n,i=At(()=>t.themes?.slice(0,8)||[]);return(r,o)=>(U(),oe("button",{class:"w-full flex flex-row justify-between bg-tertiary text-white px-2 py-1.5 uppercase cursor-pointer hover:bg-white hover:text-primary","aria-expanded":t.isOpen},[P("span",W_e,K(k(e)("Theme"))+": "+K(k(e)(`${t.themeName}`)),1),P("span",z_e,[P("span",U_e,K(k(e)("Changer")),1),P("span",X_e,[(U(!0),oe(Et,null,yi(i.value,s=>(U(),oe("div",{class:Dn(`h-2.5 w-2.5 m-px bg-${s.name}-primary`),key:s.id},null,2))),128))])])],8,Z_e))}});class H_e{setCurrentThemeColors(e){const t=document.querySelector(":root");["primary","secondary","tertiary","quaternary"].forEach(r=>{const o=getComputedStyle(t).getPropertyValue(`--${e.replace(/\s/g,"_")}-${r}`);t.style.setProperty(`--color-${r}`,o)})}}const K_e=new H_e,j_e={key:0,class:"absolute inset-x-0 top-14 bottom-0 mt-1 bg-primary overflow-y-auto overflow-x-hidden"},$_e=st({__name:"theme-selector",setup(n){const e=oi(),{setThemeGridOpen:t}=e,{themeGridOpen:i}=xt(e),r=Vr(),o=Sl(),{theme:s,themes:l,themeName:u}=xt(r),h=At(()=>l.value?.filter(y=>y.metadata?.display_in_switcher===!0)||[]);kt(u,y=>{y&&K_e.setCurrentThemeColors(y)},{immediate:!0});function d(){t(!i.value)}function m(y){o.setTheme(y),d()}return(y,x)=>(U(),oe(Et,null,[mt(Y_e,{"data-cy":"themeSelectorButton",onClick:d,themes:h.value,currentTheme:k(s),themeName:k(u),isOpen:k(i)},null,8,["themes","currentTheme","themeName","isOpen"]),k(i)?(U(),oe("div",j_e,[mt(B_e,{onSetTheme:m,themes:h.value},null,8,["themes"])])):Ge("",!0)],64))}}),J_e=["aria-expanded"],q_e={class:"leading-6"},Q_e={key:0},TI=st({__name:"expandable-panel",props:{expanded:{type:Boolean},title:{}},emits:["togglePanel"],setup(n){return(e,t)=>(U(),oe(Et,null,[P("button",{onClick:t[0]||(t[0]=i=>e.$emit("togglePanel")),class:"group w-full text-left flex px-2 py-1.5 uppercase bg-tertiary","aria-expanded":n.expanded},[P("span",{class:Dn(["grow",n.expanded?"text-white":"text-secondary"])},K(n.title),3),P("span",q_e,[P("span",{class:Dn(["fa fa-sharp fa-solid group-hover:text-white text-primary",n.expanded?"fa-caret-up":"fa-caret-down"])},null,2)])],8,J_e),mt(Ew,{name:"slide"},{default:Xt(()=>[n.expanded?(U(),oe("div",Q_e,[Jn(e.$slots,"default")])):Ge("",!0)]),_:3})],64))}}),e0e={class:"mb-px",key:"node.id"},t0e=["data-cy"],n0e=["aria-expanded","data-cy"],i0e={class:"grow"},r0e={class:"leading-6"},s0e=["data-cy"],o0e={key:1,class:"flex text-tertiary pr-2"},a0e=["data-cy"],l0e=["data-cy"],u0e={class:"ml-1 hover:underline"},eR=st({__name:"layer-tree-node",props:{node:{}},emits:["toggleLayer","toggleParent"],setup(n,{emit:e}){const t=n,i=e,{t:r}=Ct(),{setMetadataLayer:o}=rA(),s=!!t.node.children,l=t.node.depth===0,u=t.node.depth>=10,h=At(()=>r(t.node.name,{ns:"client"}));function d(y){i("toggleLayer",y)}function m(y){i("toggleParent",y)}return(y,x)=>{const C=W9("layer-tree-node",!0);return s?(U(),oe("div",e0e,[n.node.depth===1?(U(),oe("div",{key:0,"data-cy":`parentLayerLabel-${n.node.id}`},[mt(TI,{title:h.value,expanded:n.node.expanded,onTogglePanel:x[0]||(x[0]=w=>m(n.node))},null,8,["title","expanded"])],8,t0e)):n.node.depth>1&&!u?(U(),oe("button",{key:1,class:Dn(["w-full text-left flex px-2 py-1.5 pl-2",n.node.expanded?"text-tertiary":"bg-white text-primary"]),"aria-expanded":n.node.expanded,onClick:x[1]||(x[1]=w=>m(n.node)),"data-cy":`parentLayerLabel-${n.node.id}`},[P("div",i0e,K(h.value),1),P("div",r0e,[P("div",{class:Dn(["fa-sharp fa-solid",n.node.expanded?"fa-minus":"fa-plus"])},null,2)])],10,n0e)):Ge("",!0),u?Ge("",!0):(U(),oe("div",{key:2,class:Dn(["bg-secondary",[{"pl-2":n.node.depth>1},{"lux-collapse":!l},{expanded:!l&&n.node.expanded}]]),"data-cy":`subLayerLabel-${n.node.id}`},[(U(!0),oe(Et,null,yi(n.node.children,w=>(U(),Mt(C,{key:w.id,node:w,onToggleParent:x[2]||(x[2]=S=>m(S)),onToggleLayer:x[3]||(x[3]=S=>d(S))},null,8,["node"]))),128))],10,s0e))])):(U(),oe("div",o0e,[P("button",{"data-cy":`layerMetadata-${n.node.id}`,class:"self-start before:text-[.85rem] before:transform before:translate-y-[.1rem] before:inline-block before:content-['\\f129'] fa-solid fa-fw fa-fh fa-info",onClick:x[4]||(x[4]=w=>k(o)(n.node))},null,8,a0e),P("button",{class:Dn(["w-full text-left",{"font-bold":n.node.checked}]),onClick:x[5]||(x[5]=w=>d(n.node)),"data-cy":`layerLabel-${n.node.id}`},[P("i",{class:Dn(["fa-solid",n.node.checked?"fa-check-square":"fa-square"])},null,2),P("span",u0e,K(h.value),1)],10,l0e)]))}}});function tR(n,e=0){const{name:t,id:i,children:r,metadata:o}=n;return{name:t,id:i,depth:e,children:r?.map(s=>tR(s,e+1)),checked:!1,expanded:o?.is_expanded||!1}}class c0e{toggleNode(e,t,i){return t?.id===e?{...t,[i]:!t[i]}:{...t,children:t.children?.map(r=>this.toggleNode(e,r,i))}}updateLayers(e,t){const{id:i}=e;if(e.children)return{...e,children:e.children.map(r=>this.updateLayers(r,t))};{const r=!!t?.find(o=>o.id===i);return{...e,checked:r}}}}const gy=new c0e,h0e={key:0,class:"mb-7"},d0e=st({__name:"catalog-tree",setup(n){const e=Wi(),t=Vr(),i=sa(),r=Ei(),o=Ei(),s=At(()=>!e.is3dActive||e.is3dActive&&!e.is3dMesh),{layerTrees_3d:l}=xt(t);Ss(u);function u(){if(t.theme&&e.layers){const m=r.value&&r.value.id===t.theme?.id?r.value:tR(t.theme);r.value=gy.updateLayers(m,e.layers)}}Ss(()=>{if(l.value){const m=o.value?o.value:tR(l.value);o.value=gy.updateLayers(m,e.layers3d)}});function h(m,y){const x=y?o:r;x.value=gy.toggleNode(m.id,x.value,"expanded")}function d(m,y){i.toggleLayer(+m.id,!m.checked,y,!0)}return(m,y)=>(U(),oe("div",null,[o.value&&k(e).is3dActive?(U(),oe("div",h0e,[(U(),Mt(eR,{node:o.value,key:o.value.id,onToggleParent:y[0]||(y[0]=x=>h(x,!0)),onToggleLayer:y[1]||(y[1]=x=>d(x,!0))},null,8,["node"]))])):Ge("",!0),r.value&&s.value?(U(),Mt(eR,{node:r.value,key:r.value.id,onToggleParent:y[2]||(y[2]=x=>h(x,!1)),onToggleLayer:y[3]||(y[3]=x=>d(x,!1))},null,8,["node"])):Ge("",!0)]))}}),f0e=st({__name:"catalog-tab",setup(n){const{themeGridOpen:e}=xt(oi());return(t,i)=>(U(),oe(Et,null,[mt($_e),k(e)===!1?(U(),Mt(d0e,{key:0,"data-cy":"catalog",class:"pt-5 absolute inset-x-2.5 bg-primary overflow-y-auto overflow-x-hidden"})):Ge("",!0)],64))}});function TO(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function Nc(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?TO(Object(t),!0).forEach(function(i){p0e(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):TO(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function RI(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?RI=function(e){return typeof e}:RI=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},RI(n)}function p0e(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Qh(){return Qh=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Qh.apply(this,arguments)}function g0e(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,o;for(o=0;o<i.length;o++)r=i[o],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function m0e(n,e){if(n==null)return{};var t=g0e(n,e),i,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)i=o[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(n,i)&&(t[i]=n[i])}return t}var y0e="1.15.6";function Wh(n){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(n)}var ld=Wh(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Pb=Wh(/Edge/i),RO=Wh(/firefox/i),av=Wh(/safari/i)&&!Wh(/chrome/i)&&!Wh(/android/i),Rk=Wh(/iP(ad|od|hone)/i),VW=Wh(/chrome/i)&&Wh(/android/i),BW={capture:!1,passive:!1};function Ui(n,e,t){n.addEventListener(e,t,!ld&&BW)}function Vi(n,e,t){n.removeEventListener(e,t,!ld&&BW)}function nw(n,e){if(e){if(e[0]===">"&&(e=e.substring(1)),n)try{if(n.matches)return n.matches(e);if(n.msMatchesSelector)return n.msMatchesSelector(e);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(e)}catch{return!1}return!1}}function ZW(n){return n.host&&n!==document&&n.host.nodeType?n.host:n.parentNode}function _u(n,e,t,i){if(n){t=t||document;do{if(e!=null&&(e[0]===">"?n.parentNode===t&&nw(n,e):nw(n,e))||i&&n===t)return n;if(n===t)break}while(n=ZW(n))}return null}var MO=/\s+/g;function hl(n,e,t){if(n&&e)if(n.classList)n.classList[t?"add":"remove"](e);else{var i=(" "+n.className+" ").replace(MO," ").replace(" "+e+" "," ");n.className=(i+(t?" "+e:"")).replace(MO," ")}}function Qn(n,e,t){var i=n&&n.style;if(i){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(n,""):n.currentStyle&&(t=n.currentStyle),e===void 0?t:t[e];!(e in i)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),i[e]=t+(typeof t=="string"?"":"px")}}function my(n,e){var t="";if(typeof n=="string")t=n;else do{var i=Qn(n,"transform");i&&i!=="none"&&(t=i+" "+t)}while(!e&&(n=n.parentNode));var r=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return r&&new r(t)}function WW(n,e,t){if(n){var i=n.getElementsByTagName(e),r=0,o=i.length;if(t)for(;r<o;r++)t(i[r],r);return i}return[]}function kc(){var n=document.scrollingElement;return n||document.documentElement}function $s(n,e,t,i,r){if(!(!n.getBoundingClientRect&&n!==window)){var o,s,l,u,h,d,m;if(n!==window&&n.parentNode&&n!==kc()?(o=n.getBoundingClientRect(),s=o.top,l=o.left,u=o.bottom,h=o.right,d=o.height,m=o.width):(s=0,l=0,u=window.innerHeight,h=window.innerWidth,d=window.innerHeight,m=window.innerWidth),(e||t)&&n!==window&&(r=r||n.parentNode,!ld))do if(r&&r.getBoundingClientRect&&(Qn(r,"transform")!=="none"||t&&Qn(r,"position")!=="static")){var y=r.getBoundingClientRect();s-=y.top+parseInt(Qn(r,"border-top-width")),l-=y.left+parseInt(Qn(r,"border-left-width")),u=s+o.height,h=l+o.width;break}while(r=r.parentNode);if(i&&n!==window){var x=my(r||n),C=x&&x.a,w=x&&x.d;x&&(s/=w,l/=C,m/=C,d/=w,u=s+d,h=l+m)}return{top:s,left:l,bottom:u,right:h,width:m,height:d}}}function kO(n,e,t){for(var i=rf(n,!0),r=$s(n)[e];i;){var o=$s(i)[t],s=void 0;if(s=r>=o,!s)return i;if(i===kc())break;i=rf(i,!1)}return!1}function Py(n,e,t,i){for(var r=0,o=0,s=n.children;o<s.length;){if(s[o].style.display!=="none"&&s[o]!==ei.ghost&&(i||s[o]!==ei.dragged)&&_u(s[o],t.draggable,n,!1)){if(r===e)return s[o];r++}o++}return null}function Mk(n,e){for(var t=n.lastElementChild;t&&(t===ei.ghost||Qn(t,"display")==="none"||e&&!nw(t,e));)t=t.previousElementSibling;return t||null}function Zl(n,e){var t=0;if(!n||!n.parentNode)return-1;for(;n=n.previousElementSibling;)n.nodeName.toUpperCase()!=="TEMPLATE"&&n!==ei.clone&&(!e||nw(n,e))&&t++;return t}function LO(n){var e=0,t=0,i=kc();if(n)do{var r=my(n),o=r.a,s=r.d;e+=n.scrollLeft*o,t+=n.scrollTop*s}while(n!==i&&(n=n.parentNode));return[e,t]}function _0e(n,e){for(var t in n)if(n.hasOwnProperty(t)){for(var i in e)if(e.hasOwnProperty(i)&&e[i]===n[t][i])return Number(t)}return-1}function rf(n,e){if(!n||!n.getBoundingClientRect)return kc();var t=n,i=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var r=Qn(t);if(t.clientWidth<t.scrollWidth&&(r.overflowX=="auto"||r.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(r.overflowY=="auto"||r.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return kc();if(i||e)return t;i=!0}}while(t=t.parentNode);return kc()}function v0e(n,e){if(n&&e)for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}function zS(n,e){return Math.round(n.top)===Math.round(e.top)&&Math.round(n.left)===Math.round(e.left)&&Math.round(n.height)===Math.round(e.height)&&Math.round(n.width)===Math.round(e.width)}var lv;function zW(n,e){return function(){if(!lv){var t=arguments,i=this;t.length===1?n.call(i,t[0]):n.apply(i,t),lv=setTimeout(function(){lv=void 0},e)}}}function b0e(){clearTimeout(lv),lv=void 0}function UW(n,e,t){n.scrollLeft+=e,n.scrollTop+=t}function XW(n){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(n).cloneNode(!0):t?t(n).clone(!0)[0]:n.cloneNode(!0)}function YW(n,e,t){var i={};return Array.from(n.children).forEach(function(r){var o,s,l,u;if(!(!_u(r,e.draggable,n,!1)||r.animated||r===t)){var h=$s(r);i.left=Math.min((o=i.left)!==null&&o!==void 0?o:1/0,h.left),i.top=Math.min((s=i.top)!==null&&s!==void 0?s:1/0,h.top),i.right=Math.max((l=i.right)!==null&&l!==void 0?l:-1/0,h.right),i.bottom=Math.max((u=i.bottom)!==null&&u!==void 0?u:-1/0,h.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var Ka="Sortable"+new Date().getTime();function x0e(){var n=[],e;return{captureAnimationState:function(){if(n=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(r){if(!(Qn(r,"display")==="none"||r===ei.ghost)){n.push({target:r,rect:$s(r)});var o=Nc({},n[n.length-1].rect);if(r.thisAnimationDuration){var s=my(r,!0);s&&(o.top-=s.f,o.left-=s.e)}r.fromRect=o}})}},addAnimationState:function(i){n.push(i)},removeAnimationState:function(i){n.splice(_0e(n,{target:i}),1)},animateAll:function(i){var r=this;if(!this.options.animation){clearTimeout(e),typeof i=="function"&&i();return}var o=!1,s=0;n.forEach(function(l){var u=0,h=l.target,d=h.fromRect,m=$s(h),y=h.prevFromRect,x=h.prevToRect,C=l.rect,w=my(h,!0);w&&(m.top-=w.f,m.left-=w.e),h.toRect=m,h.thisAnimationDuration&&zS(y,m)&&!zS(d,m)&&(C.top-m.top)/(C.left-m.left)===(d.top-m.top)/(d.left-m.left)&&(u=C0e(C,y,x,r.options)),zS(m,d)||(h.prevFromRect=d,h.prevToRect=m,u||(u=r.options.animation),r.animate(h,C,m,u)),u&&(o=!0,s=Math.max(s,u),clearTimeout(h.animationResetTimer),h.animationResetTimer=setTimeout(function(){h.animationTime=0,h.prevFromRect=null,h.fromRect=null,h.prevToRect=null,h.thisAnimationDuration=null},u),h.thisAnimationDuration=u)}),clearTimeout(e),o?e=setTimeout(function(){typeof i=="function"&&i()},s):typeof i=="function"&&i(),n=[]},animate:function(i,r,o,s){if(s){Qn(i,"transition",""),Qn(i,"transform","");var l=my(this.el),u=l&&l.a,h=l&&l.d,d=(r.left-o.left)/(u||1),m=(r.top-o.top)/(h||1);i.animatingX=!!d,i.animatingY=!!m,Qn(i,"transform","translate3d("+d+"px,"+m+"px,0)"),this.forRepaintDummy=I0e(i),Qn(i,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),Qn(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){Qn(i,"transition",""),Qn(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},s)}}}}function I0e(n){return n.offsetWidth}function C0e(n,e,t,i){return Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*i.animation}var wm=[],US={initializeByDefault:!0},Gb={mount:function(e){for(var t in US)US.hasOwnProperty(t)&&!(t in e)&&(e[t]=US[t]);wm.forEach(function(i){if(i.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),wm.push(e)},pluginEvent:function(e,t,i){var r=this;this.eventCanceled=!1,i.cancel=function(){r.eventCanceled=!0};var o=e+"Global";wm.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][o]&&t[s.pluginName][o](Nc({sortable:t},i)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](Nc({sortable:t},i)))})},initializePlugins:function(e,t,i,r){wm.forEach(function(l){var u=l.pluginName;if(!(!e.options[u]&&!l.initializeByDefault)){var h=new l(e,t,e.options);h.sortable=e,h.options=e.options,e[u]=h,Qh(i,h.defaults)}});for(var o in e.options)if(e.options.hasOwnProperty(o)){var s=this.modifyOption(e,o,e.options[o]);typeof s<"u"&&(e.options[o]=s)}},getEventProperties:function(e,t){var i={};return wm.forEach(function(r){typeof r.eventProperties=="function"&&Qh(i,r.eventProperties.call(t[r.pluginName],e))}),i},modifyOption:function(e,t,i){var r;return wm.forEach(function(o){e[o.pluginName]&&o.optionListeners&&typeof o.optionListeners[t]=="function"&&(r=o.optionListeners[t].call(e[o.pluginName],i))}),r}};function w0e(n){var e=n.sortable,t=n.rootEl,i=n.name,r=n.targetEl,o=n.cloneEl,s=n.toEl,l=n.fromEl,u=n.oldIndex,h=n.newIndex,d=n.oldDraggableIndex,m=n.newDraggableIndex,y=n.originalEvent,x=n.putSortable,C=n.extraEventProperties;if(e=e||t&&t[Ka],!!e){var w,S=e.options,T="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!ld&&!Pb?w=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(w=document.createEvent("Event"),w.initEvent(i,!0,!0)),w.to=s||t,w.from=l||t,w.item=r||t,w.clone=o,w.oldIndex=u,w.newIndex=h,w.oldDraggableIndex=d,w.newDraggableIndex=m,w.originalEvent=y,w.pullMode=x?x.lastPutMode:void 0;var M=Nc(Nc({},C),Gb.getEventProperties(i,e));for(var G in M)w[G]=M[G];t&&t.dispatchEvent(w),S[T]&&S[T].call(e,w)}}var A0e=["evt"],Da=function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=i.evt,o=m0e(i,A0e);Gb.pluginEvent.bind(ei)(e,t,Nc({dragEl:an,parentEl:Is,ghostEl:fi,rootEl:ts,nextEl:wp,lastDownEl:MI,cloneEl:cs,cloneHidden:Hd,dragStarted:F0,putSortable:To,activeSortable:ei.active,originalEvent:r,oldIndex:Hm,oldDraggableIndex:uv,newIndex:dl,newDraggableIndex:zd,hideGhostForTarget:$W,unhideGhostForTarget:JW,cloneNowHidden:function(){Hd=!0},cloneNowShown:function(){Hd=!1},dispatchSortableEvent:function(l){ya({sortable:t,name:l,originalEvent:r})}},o))};function ya(n){w0e(Nc({putSortable:To,cloneEl:cs,targetEl:an,rootEl:ts,oldIndex:Hm,oldDraggableIndex:uv,newIndex:dl,newDraggableIndex:zd},n))}var an,Is,fi,ts,wp,MI,cs,Hd,Hm,dl,uv,zd,Wx,To,Fm=!1,iw=!1,rw=[],yp,pu,XS,YS,PO,GO,F0,Am,cv,hv=!1,zx=!1,kI,Xo,HS=[],nR=!1,sw=[],mA=typeof document<"u",Ux=Rk,FO=Pb||ld?"cssFloat":"float",S0e=mA&&!VW&&!Rk&&"draggable"in document.createElement("div"),HW=(function(){if(mA){if(ld)return!1;var n=document.createElement("x");return n.style.cssText="pointer-events:auto",n.style.pointerEvents==="auto"}})(),KW=function(e,t){var i=Qn(e),r=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=Py(e,0,t),s=Py(e,1,t),l=o&&Qn(o),u=s&&Qn(s),h=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+$s(o).width,d=u&&parseInt(u.marginLeft)+parseInt(u.marginRight)+$s(s).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&l.float&&l.float!=="none"){var m=l.float==="left"?"left":"right";return s&&(u.clear==="both"||u.clear===m)?"vertical":"horizontal"}return o&&(l.display==="block"||l.display==="flex"||l.display==="table"||l.display==="grid"||h>=r&&i[FO]==="none"||s&&i[FO]==="none"&&h+d>r)?"vertical":"horizontal"},E0e=function(e,t,i){var r=i?e.left:e.top,o=i?e.right:e.bottom,s=i?e.width:e.height,l=i?t.left:t.top,u=i?t.right:t.bottom,h=i?t.width:t.height;return r===l||o===u||r+s/2===l+h/2},T0e=function(e,t){var i;return rw.some(function(r){var o=r[Ka].options.emptyInsertThreshold;if(!(!o||Mk(r))){var s=$s(r),l=e>=s.left-o&&e<=s.right+o,u=t>=s.top-o&&t<=s.bottom+o;if(l&&u)return i=r}}),i},jW=function(e){function t(o,s){return function(l,u,h,d){var m=l.options.group.name&&u.options.group.name&&l.options.group.name===u.options.group.name;if(o==null&&(s||m))return!0;if(o==null||o===!1)return!1;if(s&&o==="clone")return o;if(typeof o=="function")return t(o(l,u,h,d),s)(l,u,h,d);var y=(s?l:u).options.group.name;return o===!0||typeof o=="string"&&o===y||o.join&&o.indexOf(y)>-1}}var i={},r=e.group;(!r||RI(r)!="object")&&(r={name:r}),i.name=r.name,i.checkPull=t(r.pull,!0),i.checkPut=t(r.put),i.revertClone=r.revertClone,e.group=i},$W=function(){!HW&&fi&&Qn(fi,"display","none")},JW=function(){!HW&&fi&&Qn(fi,"display","")};mA&&!VW&&document.addEventListener("click",function(n){if(iw)return n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.stopImmediatePropagation&&n.stopImmediatePropagation(),iw=!1,!1},!0);var _p=function(e){if(an){e=e.touches?e.touches[0]:e;var t=T0e(e.clientX,e.clientY);if(t){var i={};for(var r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);i.target=i.rootEl=t,i.preventDefault=void 0,i.stopPropagation=void 0,t[Ka]._onDragOver(i)}}},R0e=function(e){an&&an.parentNode[Ka]._isOutsideThisEl(e.target)};function ei(n,e){if(!(n&&n.nodeType&&n.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(n));this.el=n,this.options=e=Qh({},e),n[Ka]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(n.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return KW(n,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,l){s.setData("Text",l.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:ei.supportPointer!==!1&&"PointerEvent"in window&&(!av||Rk),emptyInsertThreshold:5};Gb.initializePlugins(this,n,t);for(var i in t)!(i in e)&&(e[i]=t[i]);jW(e);for(var r in this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this));this.nativeDraggable=e.forceFallback?!1:S0e,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?Ui(n,"pointerdown",this._onTapStart):(Ui(n,"mousedown",this._onTapStart),Ui(n,"touchstart",this._onTapStart)),this.nativeDraggable&&(Ui(n,"dragover",this),Ui(n,"dragenter",this)),rw.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Qh(this,x0e())}ei.prototype={constructor:ei,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(Am=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,an):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,i=this.el,r=this.options,o=r.preventOnFilter,s=e.type,l=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,u=(l||e).target,h=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||u,d=r.filter;if(N0e(i),!an&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||r.disabled)&&!h.isContentEditable&&!(!this.nativeDraggable&&av&&u&&u.tagName.toUpperCase()==="SELECT")&&(u=_u(u,r.draggable,i,!1),!(u&&u.animated)&&MI!==u)){if(Hm=Zl(u),uv=Zl(u,r.draggable),typeof d=="function"){if(d.call(this,e,u,this)){ya({sortable:t,rootEl:h,name:"filter",targetEl:u,toEl:i,fromEl:i}),Da("filter",t,{evt:e}),o&&e.preventDefault();return}}else if(d&&(d=d.split(",").some(function(m){if(m=_u(h,m.trim(),i,!1),m)return ya({sortable:t,rootEl:m,name:"filter",targetEl:u,fromEl:i,toEl:i}),Da("filter",t,{evt:e}),!0}),d)){o&&e.preventDefault();return}r.handle&&!_u(h,r.handle,i,!1)||this._prepareDragStart(e,l,u)}}},_prepareDragStart:function(e,t,i){var r=this,o=r.el,s=r.options,l=o.ownerDocument,u;if(i&&!an&&i.parentNode===o){var h=$s(i);if(ts=o,an=i,Is=an.parentNode,wp=an.nextSibling,MI=i,Wx=s.group,ei.dragged=an,yp={target:an,clientX:(t||e).clientX,clientY:(t||e).clientY},PO=yp.clientX-h.left,GO=yp.clientY-h.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,an.style["will-change"]="all",u=function(){if(Da("delayEnded",r,{evt:e}),ei.eventCanceled){r._onDrop();return}r._disableDelayedDragEvents(),!RO&&r.nativeDraggable&&(an.draggable=!0),r._triggerDragStart(e,t),ya({sortable:r,name:"choose",originalEvent:e}),hl(an,s.chosenClass,!0)},s.ignore.split(",").forEach(function(d){WW(an,d.trim(),KS)}),Ui(l,"dragover",_p),Ui(l,"mousemove",_p),Ui(l,"touchmove",_p),s.supportPointer?(Ui(l,"pointerup",r._onDrop),!this.nativeDraggable&&Ui(l,"pointercancel",r._onDrop)):(Ui(l,"mouseup",r._onDrop),Ui(l,"touchend",r._onDrop),Ui(l,"touchcancel",r._onDrop)),RO&&this.nativeDraggable&&(this.options.touchStartThreshold=4,an.draggable=!0),Da("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(Pb||ld))){if(ei.eventCanceled){this._onDrop();return}s.supportPointer?(Ui(l,"pointerup",r._disableDelayedDrag),Ui(l,"pointercancel",r._disableDelayedDrag)):(Ui(l,"mouseup",r._disableDelayedDrag),Ui(l,"touchend",r._disableDelayedDrag),Ui(l,"touchcancel",r._disableDelayedDrag)),Ui(l,"mousemove",r._delayedDragTouchMoveHandler),Ui(l,"touchmove",r._delayedDragTouchMoveHandler),s.supportPointer&&Ui(l,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=setTimeout(u,s.delay)}else u()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){an&&KS(an),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;Vi(e,"mouseup",this._disableDelayedDrag),Vi(e,"touchend",this._disableDelayedDrag),Vi(e,"touchcancel",this._disableDelayedDrag),Vi(e,"pointerup",this._disableDelayedDrag),Vi(e,"pointercancel",this._disableDelayedDrag),Vi(e,"mousemove",this._delayedDragTouchMoveHandler),Vi(e,"touchmove",this._delayedDragTouchMoveHandler),Vi(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?Ui(document,"pointermove",this._onTouchMove):t?Ui(document,"touchmove",this._onTouchMove):Ui(document,"mousemove",this._onTouchMove):(Ui(an,"dragend",this),Ui(ts,"dragstart",this._onDragStart));try{document.selection?LI(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(Fm=!1,ts&&an){Da("dragStarted",this,{evt:t}),this.nativeDraggable&&Ui(document,"dragover",R0e);var i=this.options;!e&&hl(an,i.dragClass,!1),hl(an,i.ghostClass,!0),ei.active=this,e&&this._appendGhost(),ya({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(pu){this._lastX=pu.clientX,this._lastY=pu.clientY,$W();for(var e=document.elementFromPoint(pu.clientX,pu.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(pu.clientX,pu.clientY),e!==t);)t=e;if(an.parentNode[Ka]._isOutsideThisEl(e),t)do{if(t[Ka]){var i=void 0;if(i=t[Ka]._onDragOver({clientX:pu.clientX,clientY:pu.clientY,target:e,rootEl:t}),i&&!this.options.dragoverBubble)break}e=t}while(t=ZW(t));JW()}},_onTouchMove:function(e){if(yp){var t=this.options,i=t.fallbackTolerance,r=t.fallbackOffset,o=e.touches?e.touches[0]:e,s=fi&&my(fi,!0),l=fi&&s&&s.a,u=fi&&s&&s.d,h=Ux&&Xo&&LO(Xo),d=(o.clientX-yp.clientX+r.x)/(l||1)+(h?h[0]-HS[0]:0)/(l||1),m=(o.clientY-yp.clientY+r.y)/(u||1)+(h?h[1]-HS[1]:0)/(u||1);if(!ei.active&&!Fm){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if(fi){s?(s.e+=d-(XS||0),s.f+=m-(YS||0)):s={a:1,b:0,c:0,d:1,e:d,f:m};var y="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");Qn(fi,"webkitTransform",y),Qn(fi,"mozTransform",y),Qn(fi,"msTransform",y),Qn(fi,"transform",y),XS=d,YS=m,pu=o}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!fi){var e=this.options.fallbackOnBody?document.body:ts,t=$s(an,!0,Ux,!0,e),i=this.options;if(Ux){for(Xo=e;Qn(Xo,"position")==="static"&&Qn(Xo,"transform")==="none"&&Xo!==document;)Xo=Xo.parentNode;Xo!==document.body&&Xo!==document.documentElement?(Xo===document&&(Xo=kc()),t.top+=Xo.scrollTop,t.left+=Xo.scrollLeft):Xo=kc(),HS=LO(Xo)}fi=an.cloneNode(!0),hl(fi,i.ghostClass,!1),hl(fi,i.fallbackClass,!0),hl(fi,i.dragClass,!0),Qn(fi,"transition",""),Qn(fi,"transform",""),Qn(fi,"box-sizing","border-box"),Qn(fi,"margin",0),Qn(fi,"top",t.top),Qn(fi,"left",t.left),Qn(fi,"width",t.width),Qn(fi,"height",t.height),Qn(fi,"opacity","0.8"),Qn(fi,"position",Ux?"absolute":"fixed"),Qn(fi,"zIndex","100000"),Qn(fi,"pointerEvents","none"),ei.ghost=fi,e.appendChild(fi),Qn(fi,"transform-origin",PO/parseInt(fi.style.width)*100+"% "+GO/parseInt(fi.style.height)*100+"%")}},_onDragStart:function(e,t){var i=this,r=e.dataTransfer,o=i.options;if(Da("dragStart",this,{evt:e}),ei.eventCanceled){this._onDrop();return}Da("setupClone",this),ei.eventCanceled||(cs=XW(an),cs.removeAttribute("id"),cs.draggable=!1,cs.style["will-change"]="",this._hideClone(),hl(cs,this.options.chosenClass,!1),ei.clone=cs),i.cloneId=LI(function(){Da("clone",i),!ei.eventCanceled&&(i.options.removeCloneOnHide||ts.insertBefore(cs,an),i._hideClone(),ya({sortable:i,name:"clone"}))}),!t&&hl(an,o.dragClass,!0),t?(iw=!0,i._loopId=setInterval(i._emulateDragOver,50)):(Vi(document,"mouseup",i._onDrop),Vi(document,"touchend",i._onDrop),Vi(document,"touchcancel",i._onDrop),r&&(r.effectAllowed="move",o.setData&&o.setData.call(i,r,an)),Ui(document,"drop",i),Qn(an,"transform","translateZ(0)")),Fm=!0,i._dragStartId=LI(i._dragStarted.bind(i,t,e)),Ui(document,"selectstart",i),F0=!0,window.getSelection().removeAllRanges(),av&&Qn(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,i=e.target,r,o,s,l=this.options,u=l.group,h=ei.active,d=Wx===u,m=l.sort,y=To||h,x,C=this,w=!1;if(nR)return;function S(Le,we){Da(Le,C,Nc({evt:e,isOwner:d,axis:x?"vertical":"horizontal",revert:s,dragRect:r,targetRect:o,canSort:m,fromSortable:y,target:i,completed:M,onMove:function(Q,q){return Xx(ts,t,an,r,Q,$s(Q),e,q)},changed:G},we))}function T(){S("dragOverAnimationCapture"),C.captureAnimationState(),C!==y&&y.captureAnimationState()}function M(Le){return S("dragOverCompleted",{insertion:Le}),Le&&(d?h._hideClone():h._showClone(C),C!==y&&(hl(an,To?To.options.ghostClass:h.options.ghostClass,!1),hl(an,l.ghostClass,!0)),To!==C&&C!==ei.active?To=C:C===ei.active&&To&&(To=null),y===C&&(C._ignoreWhileAnimating=i),C.animateAll(function(){S("dragOverAnimationComplete"),C._ignoreWhileAnimating=null}),C!==y&&(y.animateAll(),y._ignoreWhileAnimating=null)),(i===an&&!an.animated||i===t&&!i.animated)&&(Am=null),!l.dragoverBubble&&!e.rootEl&&i!==document&&(an.parentNode[Ka]._isOutsideThisEl(e.target),!Le&&_p(e)),!l.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),w=!0}function G(){dl=Zl(an),zd=Zl(an,l.draggable),ya({sortable:C,name:"change",toEl:t,newIndex:dl,newDraggableIndex:zd,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),i=_u(i,l.draggable,t,!0),S("dragOver"),ei.eventCanceled)return w;if(an.contains(e.target)||i.animated&&i.animatingX&&i.animatingY||C._ignoreWhileAnimating===i)return M(!1);if(iw=!1,h&&!l.disabled&&(d?m||(s=Is!==ts):To===this||(this.lastPutMode=Wx.checkPull(this,h,an,e))&&u.checkPut(this,h,an,e))){if(x=this._getDirection(e,i)==="vertical",r=$s(an),S("dragOverValid"),ei.eventCanceled)return w;if(s)return Is=ts,T(),this._hideClone(),S("revert"),ei.eventCanceled||(wp?ts.insertBefore(an,wp):ts.appendChild(an)),M(!0);var N=Mk(t,l.draggable);if(!N||P0e(e,x,this)&&!N.animated){if(N===an)return M(!1);if(N&&t===e.target&&(i=N),i&&(o=$s(i)),Xx(ts,t,an,r,i,o,e,!!i)!==!1)return T(),N&&N.nextSibling?t.insertBefore(an,N.nextSibling):t.appendChild(an),Is=t,G(),M(!0)}else if(N&&L0e(e,x,this)){var V=Py(t,0,l,!0);if(V===an)return M(!1);if(i=V,o=$s(i),Xx(ts,t,an,r,i,o,e,!1)!==!1)return T(),t.insertBefore(an,V),Is=t,G(),M(!0)}else if(i.parentNode===t){o=$s(i);var W=0,j,J=an.parentNode!==t,te=!E0e(an.animated&&an.toRect||r,i.animated&&i.toRect||o,x),ce=x?"top":"left",pe=kO(i,"top","top")||kO(an,"top","top"),Y=pe?pe.scrollTop:void 0;Am!==i&&(j=o[ce],hv=!1,zx=!te&&l.invertSwap||J),W=G0e(e,i,o,x,te?1:l.swapThreshold,l.invertedSwapThreshold==null?l.swapThreshold:l.invertedSwapThreshold,zx,Am===i);var he;if(W!==0){var D=Zl(an);do D-=W,he=Is.children[D];while(he&&(Qn(he,"display")==="none"||he===fi))}if(W===0||he===i)return M(!1);Am=i,cv=W;var re=i.nextElementSibling,le=!1;le=W===1;var fe=Xx(ts,t,an,r,i,o,e,le);if(fe!==!1)return(fe===1||fe===-1)&&(le=fe===1),nR=!0,setTimeout(k0e,30),T(),le&&!re?t.appendChild(an):i.parentNode.insertBefore(an,le?re:i),pe&&UW(pe,0,Y-pe.scrollTop),Is=an.parentNode,j!==void 0&&!zx&&(kI=Math.abs(j-$s(i)[ce])),G(),M(!0)}if(t.contains(an))return M(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){Vi(document,"mousemove",this._onTouchMove),Vi(document,"touchmove",this._onTouchMove),Vi(document,"pointermove",this._onTouchMove),Vi(document,"dragover",_p),Vi(document,"mousemove",_p),Vi(document,"touchmove",_p)},_offUpEvents:function(){var e=this.el.ownerDocument;Vi(e,"mouseup",this._onDrop),Vi(e,"touchend",this._onDrop),Vi(e,"pointerup",this._onDrop),Vi(e,"pointercancel",this._onDrop),Vi(e,"touchcancel",this._onDrop),Vi(document,"selectstart",this)},_onDrop:function(e){var t=this.el,i=this.options;if(dl=Zl(an),zd=Zl(an,i.draggable),Da("drop",this,{evt:e}),Is=an&&an.parentNode,dl=Zl(an),zd=Zl(an,i.draggable),ei.eventCanceled){this._nulling();return}Fm=!1,zx=!1,hv=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),iR(this.cloneId),iR(this._dragStartId),this.nativeDraggable&&(Vi(document,"drop",this),Vi(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),av&&Qn(document.body,"user-select",""),Qn(an,"transform",""),e&&(F0&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),fi&&fi.parentNode&&fi.parentNode.removeChild(fi),(ts===Is||To&&To.lastPutMode!=="clone")&&cs&&cs.parentNode&&cs.parentNode.removeChild(cs),an&&(this.nativeDraggable&&Vi(an,"dragend",this),KS(an),an.style["will-change"]="",F0&&!Fm&&hl(an,To?To.options.ghostClass:this.options.ghostClass,!1),hl(an,this.options.chosenClass,!1),ya({sortable:this,name:"unchoose",toEl:Is,newIndex:null,newDraggableIndex:null,originalEvent:e}),ts!==Is?(dl>=0&&(ya({rootEl:Is,name:"add",toEl:Is,fromEl:ts,originalEvent:e}),ya({sortable:this,name:"remove",toEl:Is,originalEvent:e}),ya({rootEl:Is,name:"sort",toEl:Is,fromEl:ts,originalEvent:e}),ya({sortable:this,name:"sort",toEl:Is,originalEvent:e})),To&&To.save()):dl!==Hm&&dl>=0&&(ya({sortable:this,name:"update",toEl:Is,originalEvent:e}),ya({sortable:this,name:"sort",toEl:Is,originalEvent:e})),ei.active&&((dl==null||dl===-1)&&(dl=Hm,zd=uv),ya({sortable:this,name:"end",toEl:Is,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){Da("nulling",this),ts=an=Is=fi=wp=cs=MI=Hd=yp=pu=F0=dl=zd=Hm=uv=Am=cv=To=Wx=ei.dragged=ei.ghost=ei.clone=ei.active=null,sw.forEach(function(e){e.checked=!0}),sw.length=XS=YS=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":an&&(this._onDragOver(e),M0e(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,i=this.el.children,r=0,o=i.length,s=this.options;r<o;r++)t=i[r],_u(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||O0e(t));return e},sort:function(e,t){var i={},r=this.el;this.toArray().forEach(function(o,s){var l=r.children[s];_u(l,this.options.draggable,r,!1)&&(i[o]=l)},this),t&&this.captureAnimationState(),e.forEach(function(o){i[o]&&(r.removeChild(i[o]),r.appendChild(i[o]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return _u(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var i=this.options;if(t===void 0)return i[e];var r=Gb.modifyOption(this,e,t);typeof r<"u"?i[e]=r:i[e]=t,e==="group"&&jW(i)},destroy:function(){Da("destroy",this);var e=this.el;e[Ka]=null,Vi(e,"mousedown",this._onTapStart),Vi(e,"touchstart",this._onTapStart),Vi(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(Vi(e,"dragover",this),Vi(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),rw.splice(rw.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Hd){if(Da("hideClone",this),ei.eventCanceled)return;Qn(cs,"display","none"),this.options.removeCloneOnHide&&cs.parentNode&&cs.parentNode.removeChild(cs),Hd=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(Hd){if(Da("showClone",this),ei.eventCanceled)return;an.parentNode==ts&&!this.options.group.revertClone?ts.insertBefore(cs,an):wp?ts.insertBefore(cs,wp):ts.appendChild(cs),this.options.group.revertClone&&this.animate(an,cs),Qn(cs,"display",""),Hd=!1}}};function M0e(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move"),n.cancelable&&n.preventDefault()}function Xx(n,e,t,i,r,o,s,l){var u,h=n[Ka],d=h.options.onMove,m;return window.CustomEvent&&!ld&&!Pb?u=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(u=document.createEvent("Event"),u.initEvent("move",!0,!0)),u.to=e,u.from=n,u.dragged=t,u.draggedRect=i,u.related=r||e,u.relatedRect=o||$s(e),u.willInsertAfter=l,u.originalEvent=s,n.dispatchEvent(u),d&&(m=d.call(h,u,s)),m}function KS(n){n.draggable=!1}function k0e(){nR=!1}function L0e(n,e,t){var i=$s(Py(t.el,0,t.options,!0)),r=YW(t.el,t.options,fi),o=10;return e?n.clientX<r.left-o||n.clientY<i.top&&n.clientX<i.right:n.clientY<r.top-o||n.clientY<i.bottom&&n.clientX<i.left}function P0e(n,e,t){var i=$s(Mk(t.el,t.options.draggable)),r=YW(t.el,t.options,fi),o=10;return e?n.clientX>r.right+o||n.clientY>i.bottom&&n.clientX>i.left:n.clientY>r.bottom+o||n.clientX>i.right&&n.clientY>i.top}function G0e(n,e,t,i,r,o,s,l){var u=i?n.clientY:n.clientX,h=i?t.height:t.width,d=i?t.top:t.left,m=i?t.bottom:t.right,y=!1;if(!s){if(l&&kI<h*r){if(!hv&&(cv===1?u>d+h*o/2:u<m-h*o/2)&&(hv=!0),hv)y=!0;else if(cv===1?u<d+kI:u>m-kI)return-cv}else if(u>d+h*(1-r)/2&&u<m-h*(1-r)/2)return F0e(e)}return y=y||s,y&&(u<d+h*o/2||u>m-h*o/2)?u>d+h/2?1:-1:0}function F0e(n){return Zl(an)<Zl(n)?1:-1}function O0e(n){for(var e=n.tagName+n.className+n.src+n.href+n.textContent,t=e.length,i=0;t--;)i+=e.charCodeAt(t);return i.toString(36)}function N0e(n){sw.length=0;for(var e=n.getElementsByTagName("input"),t=e.length;t--;){var i=e[t];i.checked&&sw.push(i)}}function LI(n){return setTimeout(n,0)}function iR(n){return clearTimeout(n)}mA&&Ui(document,"touchmove",function(n){(ei.active||Fm)&&n.cancelable&&n.preventDefault()});ei.utils={on:Ui,off:Vi,css:Qn,find:WW,is:function(e,t){return!!_u(e,t,e,!1)},extend:v0e,throttle:zW,closest:_u,toggleClass:hl,clone:XW,index:Zl,nextTick:LI,cancelNextTick:iR,detectDirection:KW,getChild:Py,expando:Ka};ei.get=function(n){return n[Ka]};ei.mount=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(ei.utils=Nc(Nc({},ei.utils),i.utils)),Gb.mount(i)})};ei.create=function(n,e){return new ei(n,e)};ei.version=y0e;var Hs=[],O0,rR,sR=!1,jS,$S,ow,N0;function D0e(){function n(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return n.prototype={dragStarted:function(t){var i=t.originalEvent;this.sortable.nativeDraggable?Ui(document,"dragover",this._handleAutoScroll):this.options.supportPointer?Ui(document,"pointermove",this._handleFallbackAutoScroll):i.touches?Ui(document,"touchmove",this._handleFallbackAutoScroll):Ui(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var i=t.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?Vi(document,"dragover",this._handleAutoScroll):(Vi(document,"pointermove",this._handleFallbackAutoScroll),Vi(document,"touchmove",this._handleFallbackAutoScroll),Vi(document,"mousemove",this._handleFallbackAutoScroll)),OO(),PI(),b0e()},nulling:function(){ow=rR=O0=sR=N0=jS=$S=null,Hs.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,i){var r=this,o=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,l=document.elementFromPoint(o,s);if(ow=t,i||this.options.forceAutoScrollFallback||Pb||ld||av){JS(t,this.options,l,i);var u=rf(l,!0);sR&&(!N0||o!==jS||s!==$S)&&(N0&&OO(),N0=setInterval(function(){var h=rf(document.elementFromPoint(o,s),!0);h!==u&&(u=h,PI()),JS(t,r.options,h,i)},10),jS=o,$S=s)}else{if(!this.options.bubbleScroll||rf(l,!0)===kc()){PI();return}JS(t,this.options,rf(l,!1),!1)}}},Qh(n,{pluginName:"scroll",initializeByDefault:!0})}function PI(){Hs.forEach(function(n){clearInterval(n.pid)}),Hs=[]}function OO(){clearInterval(N0)}var JS=zW(function(n,e,t,i){if(e.scroll){var r=(n.touches?n.touches[0]:n).clientX,o=(n.touches?n.touches[0]:n).clientY,s=e.scrollSensitivity,l=e.scrollSpeed,u=kc(),h=!1,d;rR!==t&&(rR=t,PI(),O0=e.scroll,d=e.scrollFn,O0===!0&&(O0=rf(t,!0)));var m=0,y=O0;do{var x=y,C=$s(x),w=C.top,S=C.bottom,T=C.left,M=C.right,G=C.width,N=C.height,V=void 0,W=void 0,j=x.scrollWidth,J=x.scrollHeight,te=Qn(x),ce=x.scrollLeft,pe=x.scrollTop;x===u?(V=G<j&&(te.overflowX==="auto"||te.overflowX==="scroll"||te.overflowX==="visible"),W=N<J&&(te.overflowY==="auto"||te.overflowY==="scroll"||te.overflowY==="visible")):(V=G<j&&(te.overflowX==="auto"||te.overflowX==="scroll"),W=N<J&&(te.overflowY==="auto"||te.overflowY==="scroll"));var Y=V&&(Math.abs(M-r)<=s&&ce+G<j)-(Math.abs(T-r)<=s&&!!ce),he=W&&(Math.abs(S-o)<=s&&pe+N<J)-(Math.abs(w-o)<=s&&!!pe);if(!Hs[m])for(var D=0;D<=m;D++)Hs[D]||(Hs[D]={});(Hs[m].vx!=Y||Hs[m].vy!=he||Hs[m].el!==x)&&(Hs[m].el=x,Hs[m].vx=Y,Hs[m].vy=he,clearInterval(Hs[m].pid),(Y!=0||he!=0)&&(h=!0,Hs[m].pid=setInterval((function(){i&&this.layer===0&&ei.active._onTouchMove(ow);var re=Hs[this.layer].vy?Hs[this.layer].vy*l:0,le=Hs[this.layer].vx?Hs[this.layer].vx*l:0;typeof d=="function"&&d.call(ei.dragged.parentNode[Ka],le,re,n,ow,Hs[this.layer].el)!=="continue"||UW(Hs[this.layer].el,le,re)}).bind({layer:m}),24))),m++}while(e.bubbleScroll&&y!==u&&(y=rf(y,!1)));sR=h}},30),qW=function(e){var t=e.originalEvent,i=e.putSortable,r=e.dragEl,o=e.activeSortable,s=e.dispatchSortableEvent,l=e.hideGhostForTarget,u=e.unhideGhostForTarget;if(t){var h=i||o;l();var d=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,m=document.elementFromPoint(d.clientX,d.clientY);u(),h&&!h.el.contains(m)&&(s("spill"),this.onSpill({dragEl:r,putSortable:i}))}};function kk(){}kk.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var r=Py(this.sortable.el,this.startIndex,this.options);r?this.sortable.el.insertBefore(t,r):this.sortable.el.appendChild(t),this.sortable.animateAll(),i&&i.animateAll()},drop:qW};Qh(kk,{pluginName:"revertOnSpill"});function Lk(){}Lk.prototype={onSpill:function(e){var t=e.dragEl,i=e.putSortable,r=i||this.sortable;r.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),r.animateAll()},drop:qW};Qh(Lk,{pluginName:"removeOnSpill"});ei.mount(new D0e);ei.mount(Lk,kk);function oR(n,e){let t;const i={dragClass:"lux-sortable-drag",ghostClass:"lux-sortable-ghost",sort:!0,handle:".drag-handle",forceFallback:Rse};e?.onSort&&(i.onSort=s=>e.onSort(s.to.children)),r();function r(){n&&(t=ei.create(n,{...i,...e&&(({onSort:s,...l})=>l)(e)||{}}))}function o(){t?.destroy()}return{sortable:t,destroy:o}}const QW=.5,V0e=!1,aw=Sa("slider",()=>{const n=Wi(),e=Ke(QW),t=Ke(V0e),i=At(()=>[...n.layers].reverse()[0]);function r(s){let l=s;s<.1?l=.1:s>.9&&(l=.9),e.value=l}function o(s){t.value=s??!t.value}return{sliderActive:t,sliderRatio:e,sliderTopLayer:i,setRatio:r,toggleSlider:o}},{});function ez(n,e){const{t}=Ct();function i(){e?.emit("clickInfo",n)}return{t,onClickInfo:i}}const B0e={class:"lux-layer-manager-item mt-2.5"},Z0e=["title"],W0e={class:"flex-1 text-left cursor-default"},z0e=["aria-label","title"],U0e=st({__name:"layer-item-background",props:{showEditButton:{type:Boolean},layer:{}},emits:["clickEdit","clickInfo"],setup(n,{emit:e}){const t=n,i=e,{t:r,onClickInfo:o}=ez(t.layer,{emit:i}),s=At(()=>r('Display informations for "{{layerName}}"',{ns:"app",layerName:u()})),l=At(()=>!Ly().isOffLine.value);function u(){return r(t.layer.name,{ns:"client"})}return(h,d)=>(U(),oe("div",B0e,[l.value?(U(),oe("button",{key:0,class:"fa fa-info w-3",title:s.value,onClick:d[0]||(d[0]=(...m)=>k(o)&&k(o)(...m))},null,8,Z0e)):Ge("",!0),P("span",W0e,K(u()),1),n.showEditButton?(U(),oe("button",{key:1,"data-cy":"openStylePanel",class:"fa fa-pencil","aria-label":k(r)("Open editor panel",{ns:"app"}),title:k(r)("Open editor panel",{ns:"app"}),onClick:d[1]||(d[1]=m=>h.$emit("clickEdit"))},null,8,z0e)):Ge("",!0)]))}}),X0e=["id"],Y0e=["aria-checked","title"],H0e=["id","value","aria-label"],K0e=["aria-checked","aria-label"],j0e=st({__name:"layer-item-sub",props:{layer:{},isOpen:{type:Boolean},isLayerComparatorOpen:{type:Boolean},displayLayerComparatorOpen:{type:Boolean}},emits:["changeOpacity","clickToggleLayerComparator"],setup(n,{emit:e}){const t=n,i=e,{t:r}=Ct(),o=sa(),s=At(()=>r(o.getLayerCurrentLabel(t.layer),{ns:"client"})),l=Ei((t.layer?.opacity??1)*100),u=Ei((t.layer?.previousOpacity??l.value)*100);function h(){l.value===0?l.value=u.value:(u.value=l.value,l.value=0),y()}function d(x){x.target&&(l.value=parseInt(x.target.value),y())}function m(){i("clickToggleLayerComparator",t.layer)}function y(){i("changeOpacity",t.layer,l.value)}return(x,C)=>(U(),oe("div",{class:Dn(["lux-layer-manager-item-content",n.isOpen?"h-6":"h-0"]),id:`layer-manager-item-content-${n.layer.id}`,"data-cy":"myLayerSubContent"},[P("button",{class:Dn(["w-5 fa-solid",l.value===0?"fa-eye-slash":"fa-eye"]),role:"switch","aria-checked":l.value===0,title:k(r)("Toggle layer opacity for {{layerName}}",{ns:"app",layerName:s.value}),onClick:h},null,10,Y0e),P("input",{id:`${n.layer.id}-steps-range`,type:"range",min:"0",max:"100",value:l.value,step:"25",onChange:d,class:"m-2.5 w-16 h-[5px] rounded-lg appearance-none cursor-pointer","aria-label":k(r)("Change opacity for {{layerName}}",{ns:"app",layerName:s.value})},null,40,H0e),n.displayLayerComparatorOpen?(U(),oe("button",{key:0,"data-cy":"myLayerComparatorBtn",role:"switch",class:Dn(["fa ml-auto text-sm cursor-pointer",n.isLayerComparatorOpen?"fa-adjust":"fa-circle"]),"aria-checked":n.isLayerComparatorOpen,"aria-label":k(r)("Toggle layer comparator for {{ layerName }}",{ns:"app",layerName:s.value}),onClick:m},null,10,K0e)):Ge("",!0)],10,X0e))}}),$0e=["min","max","value"],aR=st({__name:"layer-time-datepicker",props:{minDateAllowed:{default:""},maxDateAllowed:{default:""},dateValue:{}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,r=At(()=>hS(t.minDateAllowed)),o=At(()=>hS(t.maxDateAllowed));function s(l){i("change",l.target.value)}return(l,u)=>(U(),oe("input",{class:"lux-time-datepicker",type:"date",min:r.value,max:o.value,value:n.dateValue?k(hS)(n.dateValue):"",onChange:s},null,40,$0e))}}),J0e={class:"lux-time-slider w-full"},q0e=["for"],Q0e=st({__name:"layer-time-datepicker-value",props:{layer:{}},emits:["changeTime"],setup(n){const{t:e}=Ct(),t=n,i=Ei(t.layer.currentTimeMinValue);return(r,o)=>(U(),oe("div",J0e,[P("div",null,[P("label",{for:`${n.layer.id}-time-slider-start`,class:"lux-time-slider-label"},K(k(e)("Date:")),9,q0e),mt(aR,{id:`${n.layer.id}-time-slider-start`,"date-value":i.value,"min-date-allowed":t.layer.time?.minValue,"max-date-allowed":t.layer.time?.maxValue,onChange:o[0]||(o[0]=s=>r.$emit("changeTime",s))},null,8,["id","date-value","min-date-allowed","max-date-allowed"])])]))}}),eve={class:"lux-time-slider w-full"},tve=["for"],nve=["for"],ive=st({__name:"layer-time-datepicker-range",props:{layer:{}},emits:["changeTime"],setup(n,{emit:e}){const{t}=Ct(),i=n,r=e,o=Ei(i.layer.currentTimeMinValue),s=Ei(i.layer.currentTimeMaxValue);function l(h){r("changeTime",h,i.layer.currentTimeMaxValue)}function u(h){r("changeTime",i.layer.currentTimeMinValue,h)}return(h,d)=>(U(),oe("div",eve,[P("div",null,[P("label",{for:`${n.layer.id}-time-slider-start`,class:"lux-time-slider-label"},K(k(t)("From:")),9,tve),mt(aR,{id:`${n.layer.id}-time-slider-start`,"date-value":o.value,"min-date-allowed":i.layer.time?.minValue,"max-date-allowed":i.layer.time?.maxValue,onChange:l},null,8,["id","date-value","min-date-allowed","max-date-allowed"])]),P("div",null,[P("label",{for:`${n.layer.id}-time-slider-end`,class:"lux-time-slider-label"},K(k(t)("To:")),9,nve),mt(aR,{id:`${n.layer.id}-time-slider-end`,"date-value":s.value,"min-date-allowed":i.layer.time?.minValue,"max-date-allowed":i.layer.time?.maxValue,onChange:u},null,8,["id","date-value","min-date-allowed","max-date-allowed"])])]))}}),rve=["onKeydown","aria-label","title"],NO=st({__name:"slider-range-thumb",props:{ariaLabel:{},maxLimit:{default:100},minLimit:{default:0},selectedValue:{}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,r=Ke(!1),o=Ke(),s=Ke(),l=At(()=>o.value?.offsetWidth||274),u=At(()=>s.value?.offsetWidth||9),h=Ke(t.selectedValue),d=At(()=>l.value*h.value/100-u.value/2),m=At(()=>({left:`${d.value}px`}));Ds(()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",T)}),kt(()=>t.selectedValue,G=>{h.value=G});function y(G){h.value=Math.max(Math.min(G,100),0),i("change",h.value,r.value)}function x(){y(h.value-1)}function C(){y(h.value+1)}function w(){r.value=!0,document.addEventListener("mousemove",S),document.addEventListener("mouseup",T)}function S(G){r.value&&y(M(G))}function T(G){r.value=!1,y(M(G)),document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",T)}function M(G){const N=o.value?.offsetWidth?(G.clientX-u.value*2)*100/o.value?.offsetWidth:0;return Math.round(Math.max(Math.min(N,t.maxLimit),t.minLimit))}return(G,N)=>(U(),oe("div",{class:"w-full",role:"slider",ref_key:"elRefTrack",ref:o},[P("button",{class:Dn(["lux-slidebar-thumb",r.value?"dragging":""]),ref_key:"elRefThumb",ref:s,style:Dc(m.value),onKeydown:[Js(fs(C,["stop"]),["space"]),Js(fs(C,["stop"]),["right"]),Js(fs(x,["stop"]),["left"]),Js(fs(x,["stop"]),["delete"])],onMousedown:w,onMousemove:S,onMouseup:T,"aria-label":n.ariaLabel,title:n.ariaLabel},null,46,rve)],512))}}),sve=st({__name:"slider-range-active-track",props:{selectedMinValue:{},selectedMaxValue:{}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,r=Ke(),o=Ke(),s=At(()=>r.value?Math.round(r.value.offsetWidth*t.selectedMinValue/100):0),l=At(()=>{let d=0;return t.selectedMaxValue!==void 0&&r.value?.offsetWidth&&(d=r.value?.offsetWidth*t.selectedMaxValue/100-s.value),Math.round(d)}),u=At(()=>({left:`${s.value}px`,width:`${l.value}px`}));function h(d){if(r.value){const m=r.value.getBoundingClientRect().x,y=(d.clientX-m)*100/r.value.offsetWidth;i("change",y)}}return(d,m)=>(U(),oe("div",{ref_key:"elRefFullTrack",ref:r,class:"lux-slidebar-track"},[n.selectedMaxValue!==void 0?(U(),oe("div",{key:0,ref_key:"elRefSelectionTrack",ref:o,class:"lux-slidebar-track-selection",style:Dc(u.value),onClick:h},null,4)):Ge("",!0),P("div",{class:"lux-slidebar-track-full",onClick:h})],512))}}),ove={class:"lux-slidebar-fake"},DO=st({__name:"slider-range",props:{selectedMinValue:{},selectedMaxValue:{},ariaLabelMin:{},ariaLabelMax:{}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,r=Ke(t.selectedMinValue),o=Ke(t.selectedMaxValue);function s(h,d){i("change",h,t.selectedMaxValue,d)}function l(h,d){i("change",t.selectedMinValue,h,d)}function u(h){o.value===void 0?r.value=h:h>=o.value?o.value=h:h<=t.selectedMinValue?r.value=h:Math.abs(o.value-h)<Math.abs(r.value-h)?o.value=h:r.value=h,i("change",r.value,o.value,!1)}return(h,d)=>(U(),oe("div",ove,[o.value!==void 0?(U(),Mt(NO,{key:0,ariaLabel:n.ariaLabelMax,minLimit:n.selectedMinValue,selectedValue:o.value,onChange:l},null,8,["ariaLabel","minLimit","selectedValue"])):Ge("",!0),mt(NO,{ariaLabel:n.ariaLabelMin,maxLimit:n.selectedMaxValue,selectedValue:r.value,onChange:s},null,8,["ariaLabel","maxLimit","selectedValue"]),mt(sve,{selectedMinValue:n.selectedMinValue,selectedMaxValue:n.selectedMaxValue,onChange:u},null,8,["selectedMinValue","selectedMaxValue"])]))}}),ave={class:"lux-time-slider w-full"},lve={key:0,class:"lux-time-slider-value mr-1.5"},uve={key:1,class:"lux-time-slider-range mr-1.5"},cve={class:"lux-time-displayed-dates"},hve={key:0,class:"lux-time-start-date grow"},dve={key:1,class:"lux-time-slider-end-date grow text-right"},fve=st({__name:"layer-time-slider",props:{layer:{}},emits:["changeTime"],setup(n,{emit:e}){const{t}=Ct(),i=n,r=e,o=At(S),s=At(()=>i.layer.time?.minValue?new Date(i.layer.time?.minValue).getTime():0),l=At(()=>i.layer.time?.maxValue?new Date(i.layer.time?.maxValue).getTime():0),u=At(()=>l.value-s.value),h=Ke(i.layer.currentTimeMaxValue),d=Ke(i.layer.currentTimeMinValue),m=At(()=>d.value?new Date(d.value).getTime():void 0),y=At(()=>h.value?new Date(h.value).getTime():void 0),x=At(()=>w(m.value)),C=At(()=>w(y.value));function w(N){return N?(N-s.value)/u.value*100:0}function S(){const N=i.layer.time,V=[];if(!N)return;if(N.values)return N.values.map(pe=>new Date(pe).getTime());const W=new Date(N.minValue),j=new Date(N.maxValue??Date.now()),J=1024,te=new Date(W.getTime()),ce=N.interval??WV;if(te.setFullYear(W.getFullYear()+J*ce[0]),te.setMonth(W.getMonth()+J*ce[1],W.getDate()+J*ce[2]),te.setSeconds(W.getSeconds()+J*ce[3]),te>j)for(let pe=0;;pe++){const Y=new Date(W.getTime());if(Y.setFullYear(W.getFullYear()+pe*ce[0]),Y.setMonth(W.getMonth()+pe*ce[1],W.getDate()+pe*ce[2]),Y.setSeconds(W.getSeconds()+pe*ce[3]),Y<=j)V.push(Y.getTime());else break}return V}function T(N){const V=N/100*(l.value-s.value)+s.value,W=One(V,{minValue:s.value,maxValue:l.value,timeValueList:o.value,timeInterval:i.layer.time?.interval});return fT(W)}function M(N,V){const W=T(N);if(d.value=W,V){const j=T(V);h.value=j}}function G(N,V,W){M(N,V),W||r("changeTime",d.value,h.value)}return(N,V)=>(U(),oe("div",ave,[n.layer.time?.mode===k(Mh).VALUE?(U(),oe("div",lve,[mt(DO,{ariaLabelMin:`${k(t)("Edit the start date",{ns:"app"})}`,selectedMinValue:x.value,onChange:G},null,8,["ariaLabelMin","selectedMinValue"])])):Ge("",!0),n.layer.time?.mode===k(Mh).RANGE?(U(),oe("div",uve,[mt(DO,{ariaLabelMin:`${k(t)("Edit the start date",{ns:"app"})}`,ariaLabelMax:`${k(t)("Edit the end date",{ns:"app"})}`,selectedMinValue:x.value,selectedMaxValue:C.value,onChange:G},null,8,["ariaLabelMin","ariaLabelMax","selectedMinValue","selectedMaxValue"])])):Ge("",!0),P("div",cve,[n.layer.time?.mode===k(Mh).RANGE||n.layer.time?.mode===k(Mh).VALUE?(U(),oe("div",hve,[P("span",null,K(d.value?k(r5)(d.value,n.layer.time?.resolution):"-"),1)])):Ge("",!0),n.layer.time?.mode===k(Mh).RANGE?(U(),oe("div",dve,[P("span",null,K(h.value?k(r5)(h.value,n.layer.time?.resolution):"-"),1)])):Ge("",!0)])]))}}),pve=st({__name:"layer-time",props:{layer:{}},emits:["changeTime"],setup(n,{emit:e}){const t=e;function i(r,o){t("changeTime",r,o)}return(r,o)=>(U(),oe(Et,null,[n.layer.time?.widget===k(dI).SLIDER?(U(),Mt(fve,{key:0,layer:n.layer,onChangeTime:i},null,8,["layer"])):Ge("",!0),n.layer.time?.widget===k(dI).DATEPICKER&&n.layer.time?.mode===k(Mh).VALUE?(U(),Mt(Q0e,{key:1,layer:n.layer,onChangeTime:i},null,8,["layer"])):Ge("",!0),n.layer.time?.widget===k(dI).DATEPICKER&&n.layer.time?.mode===k(Mh).RANGE?(U(),Mt(ive,{key:2,layer:n.layer,onChangeTime:i},null,8,["layer"])):Ge("",!0)],64))}}),gve={class:"lux-layer-manager-item relative"},mve={class:"w-full flex flex-nowrap items-start gap-x-2"},yve=["title"],_ve=["aria-label","title"],vve=["aria-expanded","aria-controls","data-cy"],bve={class:"grow"},xve=["title","aria-label"],VO=st({__name:"layer-item",props:{is3d:{type:Boolean},layer:{},dragHandleClassName:{},isOpen:{type:Boolean},isLayerComparatorOpen:{type:Boolean},displayLayerComparatorOpen:{type:Boolean}},emits:["clickInfo","clickToggle","clickToggleLayerComparator","clickRemove","changeOpacity","changeTime"],setup(n,{emit:e}){const t=n,i=e,{t:r,onClickInfo:o}=ez(t.layer,{emit:i}),s=sa(),l=At(()=>r(s.getLayerCurrentLabel(t.layer),{ns:"client"})),u=At(()=>!Ly().isOffLine.value),h=At(()=>r('Sort "{{layerName}}" in the list',{ns:"app",layerName:l.value})),d=At(()=>r('Display informations for "{{layerName}}"',{ns:"app",layerName:l.value})),m=At(()=>r('Remove layer "{{layerName}}"',{ns:"app",layerName:l.value}));function y(x,C){i("changeTime",x,C)}return(x,C)=>(U(),oe("div",gve,[P("div",mve,[P("button",{class:Dn(["fa-solid fa-bars cursor-move mt-1",n.dragHandleClassName]),title:h.value},null,10,yve),u.value?(U(),oe("button",{key:0,class:"fa-solid fa-info mt-1","aria-label":d.value,title:d.value,onClick:C[0]||(C[0]=(...w)=>k(o)&&k(o)(...w))},null,8,_ve)):Ge("",!0),P("button",{"aria-expanded":n.isOpen,"aria-controls":`layer-manager-item-content-${n.layer.id}`,"data-cy":`myLayerItemLabel-${n.layer.id}`,class:Dn([n.is3d?"cursor-default":"","grow text-left break-words w-[70%] flex items-center"]),onClick:C[1]||(C[1]=w=>x.$emit("clickToggle",n.layer))},[P("span",bve,K(l.value),1),n.is3d?Ge("",!0):(U(),oe("span",{key:0,class:Dn(["w-3.5 fa-solid",n.isOpen?"fa-xmark":"fa-ellipsis"]),"aria-hidden":"true"},null,2))],10,vve),P("button",{class:"mt-1 fa-regular fa-trash-can",title:m.value,"aria-label":m.value,onClick:C[2]||(C[2]=w=>x.$emit("clickRemove",n.layer))},null,8,xve)]),n.is3d?Ge("",!0):(U(),Mt(j0e,{key:0,layer:n.layer,isOpen:n.isOpen,isLayerComparatorOpen:n.isLayerComparatorOpen,displayLayerComparatorOpen:n.displayLayerComparatorOpen,onClickToggleLayerComparator:C[3]||(C[3]=w=>x.$emit("clickToggleLayerComparator",w)),onChangeOpacity:C[4]||(C[4]=(w,S)=>x.$emit("changeOpacity",w,S))},null,8,["layer","isOpen","isLayerComparatorOpen","displayLayerComparatorOpen"])),n.layer.time?(U(),Mt(pve,{key:1,layer:n.layer,onChangeTime:y},null,8,["layer"])):Ge("",!0)]))}}),Ive={key:0,class:"text-black"},Cve=["id"],wve=["id"],Ave={key:2,class:"flex flex-row justify-center space-x-1 my-2"},BO="drag-handle",Sve=st({__name:"layer-manager",emits:["displayCatalog"],setup(n,{emit:e}){const{t}=Ct(),{setMetadataLayer:i}=rA(),r=Wi(),o=oi(),s=Tf(),l=aw(),{bgLayer:u}=xt(r),{sliderActive:h}=xt(l),{isOffLine:d}=xt(o),{setRemoteLayersOpen:m}=o,y=vv("sortableLayers"),x=vv("sortableLayers3d"),C=At(()=>[...r.layers].reverse()),w=At(()=>[...r.layers3d].reverse()),S=Ei(),T=At(()=>s.isLayerStyleEditable(u.value)),M=At(()=>!d.value),G=e;gr(()=>{oR(y.value,{onSort:N}),oR(x.value,{onSort:V})});function N(Y,he){const D=[...Y].map(re=>Number(re.id)).reverse();r.reorderLayers(D,he)}function V(Y){N(Y,!0)}function W(Y,he){r.setLayerOpacity(Y.id,he/100)}function j(Y,he,D){r.setLayerTime(Y.id,he,D)}function J(Y){r.removeLayers(Y.id)}function te(Y){S.value=S.value!==Y.id?Y.id:void 0}function ce(){o.openStyleEditorPanel()}function pe(){l.toggleSlider()}return(Y,he)=>(U(),oe("div",null,[k(d)&&C.value.length===0?(U(),oe("div",Ive,K(k(t)("No layer selected",{ns:"client"})),1)):Ge("",!0),w.value.length>0?(U(),oe("ul",{key:1,ref_key:"sortableLayers3d",ref:x,class:"mb-4 sortable-layers-3d"},[(U(!0),oe(Et,null,yi(w.value,(D,re)=>(U(),oe("li",{key:D.id,id:D.id,"data-cy":"myLayer"},[mt(VO,{is3d:!0,dragHandleClassName:BO,layer:D,isOpen:S.value===D.id,isLayerComparatorOpen:k(h),displayLayerComparatorOpen:re===0,onClickRemove:J,onClickToggle:te,onClickToggleLayerComparator:pe,onClickInfo:le=>k(i)(D),onChangeOpacity:W,onChangeTime:(le,fe)=>j(D,le,fe)},null,8,["layer","isOpen","isLayerComparatorOpen","displayLayerComparatorOpen","onClickInfo","onChangeTime"])],8,Cve))),128))],512)):Ge("",!0),P("ul",{ref_key:"sortableLayers",ref:y,class:"sortable-layers"},[(U(!0),oe(Et,null,yi(C.value,(D,re)=>(U(),oe("li",{key:D.id,id:D.id,"data-cy":"myLayer"},[mt(VO,{is3d:!1,dragHandleClassName:BO,layer:D,isOpen:S.value===D.id,isLayerComparatorOpen:k(h),displayLayerComparatorOpen:re===0,onClickRemove:J,onClickToggle:te,onClickToggleLayerComparator:pe,onClickInfo:le=>k(i)(D),onChangeOpacity:W,onChangeTime:(le,fe)=>j(D,le,fe)},null,8,["layer","isOpen","isLayerComparatorOpen","displayLayerComparatorOpen","onClickInfo","onChangeTime"])],8,wve))),128))],512),mt(U0e,{layer:k(u)||k(DC),showEditButton:T.value,onClickInfo:he[0]||(he[0]=()=>k(u)&&k(i)(k(u))),onClickEdit:ce},null,8,["layer","showEditButton"]),M.value?(U(),oe("div",Ave,[P("button",{"data-cy":"addLayer",class:"bg-white text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5",onClick:he[1]||(he[1]=D=>G("displayCatalog"))},K(k(t)("+ Add layers",{ns:"client"})),1),P("button",{"data-cy":"addRemoteLayer",class:"bg-white text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5",onClick:he[2]||(he[2]=D=>k(m)(!0))},K(k(t)("+ Add external Wms",{ns:"client"})),1)])):Ge("",!0),he[3]||(he[3]=P("div",{class:"lux-preload"},[P("i",{class:"fa-regular fa-trash-can"})],-1))]))}}),Eve=["data-cy"],Tve={key:0,class:"lux-panel-title h-16 shrink-0 flex justify-between"},Rve=["aria-label"],Mve={key:1,class:"lux-panel-tabs flex flex-row gap-2 h-10 text-2xl"},kve={class:"lux-panel-content relative grow p-2.5 bg-primary overflow-auto"},pg=st({__name:"side-panel-layout",props:{dataCyValue:{},closeFn:{type:Function}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),oe("div",{"data-cy":n.dataCyValue,class:"lux-panel flex flex-col h-full pt-1.5"},[t.$slots.header?(U(),oe("div",Tve,[Jn(t.$slots,"header"),P("span",null,[P("button",{"data-cy":"panelClose",onClick:i[0]||(i[0]=()=>n.closeFn()),"aria-label":k(e)("Close",{ns:"client"}),class:"fa-sharp fa-solid fa-close"},null,8,Rve)])])):Ge("",!0),t.$slots.tabs?(U(),oe("div",Mve,[Jn(t.$slots,"tabs")])):Ge("",!0),P("div",kve,[Jn(t.$slots,"content")])],8,Eve))}}),Lve=["aria-expanded"],Pve={key:0},Gve=["aria-expanded"],Fve=st({__name:"layer-panel",setup(n){const{t:e}=Ct(),t=oi(),{setLayersOpen:i}=t,{myLayersTabOpen:r}=xt(t),{layers:o}=xt(Wi()),s=At(()=>!Ly().isOffLine.value),l=At(()=>r.value||Ly().isOffLine.value);function u(){t.setMyLayersTabOpen(!0)}function h(){t.setMyLayersTabOpen(!1)}return(d,m)=>(U(),Mt(pg,{"data-cy-value":"layerPanel","close-fn":()=>k(i)(!1)},{header:Xt(()=>[P("h1",null,K(k(e)("layers",{ns:"client"})),1)]),tabs:Xt(()=>[P("button",{"data-cy":"myLayersButton",onClick:u,class:Dn(["text-white px-4 hover:bg-primary cursor-pointer text-center uppercase",l.value?"bg-primary":"bg-tertiary"]),"aria-expanded":l.value},[Bt(K(k(e)("my_layers",{ns:"client"}))+" ",1),k(o).length?(U(),oe("span",Pve,"("+K(k(o).length)+")",1)):Ge("",!0)],10,Lve),s.value?(U(),oe("button",{key:0,"data-cy":"catalogButton",onClick:h,class:Dn(["text-white px-4 hover:bg-primary cursor-pointer text-center uppercase",l.value?"bg-tertiary":"bg-primary"]),"aria-expanded":!l.value},K(k(e)("Catalog",{ns:"client"})),11,Gve)):Ge("",!0)]),content:Xt(()=>[Sn(mt(Sve,{"data-cy":"myLayers",onDisplayCatalog:h},null,512),[[zp,l.value]]),Sn(P("div",null,[mt(f0e)],512),[[zp,!l.value]])]),_:1},8,["close-fn"]))}}),Ove={class:"lux-legends absolute"},Nve={key:0,class:"text-white"},Dve={class:"pb-5"},Vve={class:"pb-5"},Bve=st({__name:"legends-panel",setup(n){const{t:e}=Ct(),t=oi(),i=Wi(),r=sa(),{layers:o,bgLayer:s}=xt(i),l=At(()=>[...o.value].reverse()),u=Ke(new Map),h=Ke(!1);return Ss(()=>h.value=[...u.value].some(([d,m])=>m)),Ds(()=>u.value.clear()),hN(()=>u.value.clear()),(d,m)=>(U(),Mt(pg,{"data-cy-value":"legendsPanel","close-fn":()=>k(t).toggleLegendsOpen(!1)},{header:Xt(()=>[P("h1",null,K(k(e)("Legends")),1)]),content:Xt(()=>[P("div",Ove,[h.value?Ge("",!0):(U(),oe("div",Nve,K(k(e)("Aucune lgende n'est disponible pour les couches slectionnes.")),1)),(U(!0),oe(Et,null,yi(l.value,y=>(U(),Mt(QT,{"data-cy":"legendLayer",class:"pt-10",key:y.id,layer:y,onHasLegend:x=>u.value.set(y.id,x),onRemovedLegend:()=>u.value.delete(y.id)},{title:Xt(()=>[P("h1",Dve,K(k(e)(k(r).getLayerCurrentLabel(y))),1)]),_:2},1032,["layer","onHasLegend","onRemovedLegend"]))),128)),k(s)?(U(),Mt(QT,{"data-cy":"legendBgLayer",class:"pt-10",key:k(s).id,layer:k(s)},{title:Xt(()=>[P("h1",Vve,K(k(e)(k(r).getLayerCurrentLabel(k(s)))),1)]),_:1},8,["layer"])):Ge("",!0)])]),_:1},8,["close-fn"]))}});class Zve{timeoutID;constructor(e){const t=Wi(),i=Eu(),r=Kn(),o=Tf(),s=vk(),{getIsOffline:l}=Ly(),{appliedStyle:u}=xt(i);kt(()=>t.layers,(h,d)=>{const m={layers:d},y={layers:h},x=r.getRemovedLayers(y,m),C=r.getAddedLayers(y,m),w=r.getMutatedLayers(y,m);x.forEach(S=>s.removeLayer(e,S.id)),C.forEach(S=>{s.addLayer(e,S.layer),s.setLayerTime(e,S.layer)}),w.forEach(S=>{r.getMutationType(S.id,y,m)===yM.ON_LAYER_TYPE?(s.removeLayer(e,S.id),s.addLayer(e,S)):s.setLayerOpacity(e,S.id,S.opacity),s.setLayerTime(e,S)}),y.layers&&s.reorderLayers(e,y.layers)}),kt(()=>t.bgLayer,h=>h!==void 0&&s.setBgLayer(e,h,i.bgVectorSources)),Ss(()=>{i.isExpertStyleActive||(u.value=o.applyDefaultStyle(t.bgLayer,i.bgVectorBaseStyles,i.bgStyle))}),kt(u,h=>{l()||(i.bgStyle===null&&!i.isExpertStyleActive?o.unregisterStyle(i.styleSerial).then(i.styleSerial=null):(clearTimeout(this.timeoutID),this.timeoutID=setTimeout(()=>{o.registerStyle(h,i.styleSerial).then(d=>{i.styleSerial=d;const m=t?.bgLayer?.id;t?.bgLayer&&m!==void 0&&d!==void 0&&s.setBgLayer(e,t?.bgLayer,i.bgVectorSources)})},2e3))),s.applyOnBgLayer(e,d=>o.applyConsolidatedStyle(d,h))}),kt(()=>i.bgVectorSources,(h,d)=>{for(const m of h.keys())(!d||d.get(m)!==h.get(m))&&(s.removeFromCache(m),m===t?.bgLayer?.id&&s.setBgLayer(e,t?.bgLayer,h))})}}class Wve{constructor(e){const t=e.getView(),i=Wi();t.setMaxZoom(h4),t.setMinZoom(bj),t.setConstrainResolution(!0),kt(()=>i.minZoom,r=>r!==void 0&&t.setMinZoom(r)),kt(()=>i.maxZoom,r=>r!==void 0&&t.setMaxZoom(r))}}function zve(){const n=Jr(),{generateDrawnFeature:e}=sA(),{addDrawnFeatureToCollection:t}=n,{activeFeatureId:i,drawnFeatures:r}=xt(n),o=Kn().getOlMap();function s(h,d="new"){let m;wu.remove(),h.stopPropagation(),d==="new"?(m=e(h.feature),t(m)):m=r.value.find(y=>y.id===i.value),m.resetProfileData(),n.selectDrawnFeature(m)}function l(h,d){d.key==="Escape"&&(wu.remove(),h.finishDrawing())}function u(h,d="new"){const m=new Ky(h);return m.setActive(!1),In(m,"drawstart",y=>wu.add(o,y)),In(m,"drawend",y=>s(y,d)),In(document,"keyup",y=>l(m,y)),o.addInteraction(m),m}return{createDrawInteraction:u}}function Uve(){const n=Jr(),{drawStateActive:e,editStateActive:t,drawnFeatures:i,currentDrawInteraction:r,editingFeatureId:o}=xt(n),{createDrawInteraction:s}=zve(),l=iv.createOlLayerInteractionDraw(),u={drawPoint:s({type:"Point"}),drawLabel:s({type:"Point"}),drawLine:s({type:"LineString"}),drawLineContinue:s({type:"LineString"},"update"),drawCircle:s({type:"Circle"}),drawPolygon:s({type:"Polygon"})};kt(e,m=>{Object.keys(u).forEach(y=>{const x=u[y];`${[y]}`==`${m}`&&!t.value?(x.setActive(!0),r.value=x):x.setActive(!1)})}),kt(t,m=>{if(m)Object.values(u).forEach(y=>{y.setActive(!1)});else if(e.value){const y=e.value;u[y]&&(u[y].setActive(!0),r.value=u[y])}}),kt(i,m=>{d(m,o.value)},{flush:"post"}),kt(o,()=>{d(i.value,o.value)});function h(m){m.addLayer(l)}function d(m,y){const x=l.getSource(),C=y?m.filter(S=>S.id!==y):m,w=x?.getFeatures()||[];w.forEach(S=>{const T=S;C.find(M=>M.id===T.id)||x?.removeFeature(S)}),C.forEach(S=>{w.find(T=>T.id===S.id)||(S.changed(),x?.addFeature(S))})}return{addDrawLayer:h,drawInteractions:u}}function Xve(){const n=Kn().getOlMap(),e=oi(),{drawStateActive:t,editStateActive:i,activeFeatureId:r,editingFeatureId:o,drawnFeatures:s}=xt(Jr()),{layersOpen:l,myMapsOpen:u}=xt(e),{layers:h}=xt(Wi());In(n,"click",m=>d(m)),kt([r,o],([m,y],[x,C])=>{C!==y&&y!==m&&(o.value=void 0),x!==void 0&&x!==m&&s.value.filter(w=>w.id===x).forEach(w=>{w.selected=!1,w.changed()}),s.value.filter(w=>w.id===m).forEach(w=>{w.selected=!0,w.changed()})});const d=function(m){const y=m.pixel;if(t.value!==void 0||i.value!==void 0)return!0;if(n.forEachFeatureAtPixel(y,C=>{const w=s.value.includes(C);if(w&&(l.value||u.value)&&s.value.length>0||w&&h.value.length===0)return e.toggleMyMapsOpen(!0),r.value=C.id,!0},{hitTolerance:5}))return!1}}const Yve="featureInfoLayer",Hve=17;class Kve{map;featureLayer;init(e){this.map=e,this.createFeatureLayer()}createFeatureLayer(){this.featureLayer=new bo({source:new ua,zIndex:1e3});const e=new Ji({color:[255,255,0,.6]}),t=new ki({color:[255,155,55,1],width:3}),i=new Qs({radius:10,fill:e,stroke:t});this.featureLayer.set("cyLayerType",Yve),this.featureLayer.setStyle(function(r){const o=r.get("color")||"#ffcc33",s=r.get("width")||3,l=[new qn({fill:new Ji({color:[255,255,0,.6]})}),new qn({stroke:new ki({color:"#ffffff",width:5})}),new qn({stroke:new ki({color:o,width:s})})],u=r.getGeometry()?.getType();return u==="Point"||u==="MultiPoint"?[new qn({image:i})]:l}),this.map.addLayer(this.featureLayer)}highlightFeatures(e,t,i){if(e!=null){this.map.getLayers().getArray().indexOf(this.featureLayer)===-1&&this.map.addLayer(this.featureLayer);const r={dataProjection:tu,featureProjection:this.map.getView().getProjection()},o=new Jl().readFeatures({type:"FeatureCollection",features:e},r);if(o.length>0){let s=o[0].getGeometry()?.getExtent()||[0,0,0,0];for(const l of o){const u=l.getGeometry()?.getExtent()||[0,0,0,0];s=by(s,u),l.getId()==null&&l.setId(void 0),l.getGeometry()?.getType()==="GeometryCollection"?l.getGeometry().getGeometriesArray().forEach(d=>{const m=l.clone();m.setGeometry(d),this.featureLayer.getSource()?.addFeature(m)}):this.featureLayer.getSource()?.addFeature(l)}if(t&&s){const l={size:this.map.getSize(),maxZoom:i||Hve};this.map.getView().fit(s,l)}}}}clearFeatures(){this.featureLayer.getSource()?.clear()}}const Yx=new Kve,jve={xs:0,sm:640,md:768,lg:1024,xl:1280,"2xl":1536};function Pk(n){return window.innerWidth>=jve[n]}const $ve="https://migration.geoportail.lu/getfeatureinfo";async function ZO(n){const e=await Vs($ve,n,"GET");if(!e.ok)throw new Error("Error while trying to get profile");return await e.json()}function Jve(){const n=Kn().getOlMap(),{setFeatureInfoPanelContent:e,setLoading:t,setDisplayStarOnMobile:i}=tg(),{fid:r,isLoading:o}=xt(tg()),{toggleInfoOpen:s}=oi(),{layersOpen:l,myMapsOpen:u}=xt(oi()),{findById:h}=Sl(),{drawStateActive:d,editStateActive:m,drawnFeatures:y}=xt(Jr()),{locationInfoCoords:x,isStreetviewActive:C}=xt(rg()),{maxZoom:w}=xt(Wi()),S=Ke([]),T=Ke([]),M=Ke([]),G=Ke([]),N=Ke(null);function V(){Yx.init(n),In(n,"pointerdown",he=>{M.value=he.pixel}),In(n,"pointerup",wB(he=>W(he),499)),In(n,"pointermove",he=>{j(he)}),Ss(()=>{r.value&&(async()=>await J(r.value))()})}function W(he){(async()=>(G.value=he.pixel,!(he.originalEvent.button===2||C.value&&x.value||d.value||m.value||o.value)&&(N.value=window.setTimeout(()=>{let D=!1;if((l.value||u.value)&&y.value.length>0&&(D=Y(he.pixel)),!D&&M.value&&G.value){const re=Math.abs(M.value[0]-G.value[0]),le=Math.abs(M.value[1]-G.value[1]);re+le<6&&(te(he),M.value=null,G.value=null)}},500))))()}async function j(he){if(he.dragging||o.value)return;const D=await Promise.all(n.getLayers().getArray().filter(re=>re instanceof nv).map(async re=>{const le=re.getData(he.pixel);if(re.getVisible()&&re.getOpacity()>0&&!le?.every(fe=>fe===0)){const fe=re.get(jC);return fe&&fe.is_queryable}return!1})).then(re=>re.some(Boolean));n.getViewport().style.cursor=D?"pointer":""}async function J(he){const D=he.split(",");for(const re of D){const le=re.split("_")[0],fe=[le],Le={};try{if(fe.length>0){t(!0),n.getViewport().style.cursor="wait";const we=await ZO({fid:re});let se=!1;Pk("sm")?(se=!0,i(!1)):i(!0);const Q=h(le);Q&&(Le[le]=Q.layers),we.length>0&&ce(!0,we,Le,se,!0)}}catch{pe()}}}async function te(he){const D=n.getLayers().getArray(),re=[],le={};for(let fe=D.length-1;fe>=0;fe--){const Le=D[fe].get(jC);if(Le!=null&&Le.is_queryable&&D[fe].getVisible()&&D[fe].getOpacity()>0){const we=D[fe].get("queryable_id");re.push(we),le[we]=D[fe].get("label")}}if(re.length>0){const fe=n.getView().getResolution();let Le=0,we=0;fe&&(Le=20*fe,we=1*fe);const se=gs(he.coordinate,n.getView().getProjection(),tu),Q=[[se[0]-Le,se[1]+Le],[se[0]+Le,se[1]-Le]],q=[[se[0]-we,se[1]+we],[se[0]+we,se[1]-we]];t(!0),n.getViewport().style.cursor="wait";const $e=n.getSize()||[0,0],qe=n.getView().calculateExtent($e).join(","),Lt={layers:re.join(),box1:Q.join(),box2:q.join(),srs:Dp,zoom:n.getView().getZoom(),BBOX:qe,WIDTH:$e[0],HEIGHT:$e[1],X:he.pixel[0],Y:he.pixel[1]};try{const Pt=await ZO(Lt);Pt.length>0?ce(he.originalEvent.shiftKey,Pt,le,!0,!1):(T.value=[],Yx.highlightFeatures(T.value,!1,w.value),pe())}catch{pe()}}}function ce(he,D,re,le,fe){he?D.forEach(se=>{se.layerLabel=re[se.layer];let Q=!1;for(let q=0;q<S.value.length;q++)if(S.value[q].layer===se.layer){Q=!0;let $e=!1;for(let Qe=0;Qe<se.features.length;Qe++){for(let qe=0;qe<S.value[q].features.length;qe++)if(S.value[q].features[qe].fid==se.features[Qe].fid){$e=!0,S.value[q].features.splice(qe,1);break}$e||(S.value[q].features=S.value[q].features.concat(se.features[Qe]))}break}Q||S.value.push(se)}):(S.value=D,S.value.forEach(se=>{se.layerLabel=re[se.layer]}));const Le=S.value.filter(se=>"features"in se&&se.features.length>0),we=S.value.length>0?le:!1;pe(we),T.value=[];for(let se=0;se<S.value.length;se++)T.value.push(...S.value[se].features);Yx.highlightFeatures(T.value,fe,w.value),e(Le)}function pe(he=!1){s(he),t(!1),n.getViewport().style.cursor="",Yx.clearFeatures()}function Y(he){const D=[];return n.forEachFeatureAtPixel(he,re=>y.value.indexOf(re)!==-1?(D.push(re),!1):!0,{hitTolerance:5}),D.length>0}return{init:V}}function qve(){const{t:n}=Ct(),{addNotification:e}=ns(),{drawStateActive:t}=xt(Jr());kt(t,i);function i(r){let o;switch(r){case"drawPoint":o=n("Click to draw the point");break;case"drawLine":case"drawLineContinue":o=n("Click to start drawing line<br>Double-click to finish");break;case"drawPolygon":o=n("Click to start drawing polygon<br>Double-click or click last point to finish");break;case"drawCircle":o=n("Click to start drawing circle");break;case"drawLabel":o=n("Click to place the label");break}o&&e(o)}return{}}function Qve(){let n,e,t;const{editStateActive:i,editingFeatureId:r,drawnFeatures:o}=xt(Jr()),{updateDrawnFeature:s}=Jr(),l=Kn().getOlMap(),u=new bo({source:new ua({features:[]}),zIndex:rW+1,style:(y,x)=>{const C=y,w=C.getStyleFunction();return w?w.call(C,C,x):[]}});u.set("cyLayerType",sW);const h=u.getSource();l.addLayer(u),kt(i,y=>{d(),y&&m()}),kt(r,y=>{h.clear();const x=o.value.find(C=>C.id===y);if(x){t=x;const C=new El(x);C.setGeometry(x.getGeometry()?.clone()),C.set("__isBeingEdited__",!0),h.addFeature(C),l.render()}else t=void 0},{flush:"post"});function d(){n&&e&&(n.un("modifyend",e),l.removeInteraction(n),n=void 0,e=void 0)}function m(){n=new Xae({source:h,pixelTolerance:20,deleteCondition:y=>zw(y)&&VD(y)}),e=y=>{const x=y.features.getArray()[0];x.resetProfileData(),t&&x&&(t.setGeometry(x.getGeometry()?.clone()),t.resetProfileData(),t.setStyle(t.getStyleFunction()),t.changed(),s(t)),x.setStyle(x.getStyleFunction()),x.changed()},n.on("modifyend",e),l.addInteraction(n)}return{}}const ebe={0:8,1:9,2:9,3:10,4:11,5:12,6:13,7:14,8:16,9:17,10:18,11:19,12:20,13:21};class tbe{bootstrap(){this.restore(),this.persist()}persistZoom(){const e=Wi(),{zoom:t}=xt(e),i=Kn().getOlMap().getView(),r=()=>{const o=i.getZoom(),s=o?Math.ceil(o):null;Nn.setValue(y5,s),t.value=s};r(),In(i,"change:resolution",uy(r,300))}persistRotation(){const e=Wi(),{rotation:t}=xt(e),i=Kn().getOlMap().getView(),r=()=>{const o=i.getRotation()||0;Nn.setValue(_5,o),t.value=o};r(),In(i,"change:rotation",uy(r,300))}persistXY(){const e=Wi(),{x:t,y:i}=xt(e),r=Kn().getOlMap().getView(),o=()=>{const s=r.getCenter(),l=s?Math.round(s[0]):null,u=s?Math.round(s[1]):null;Nn.setValue(vT,l),Nn.setValue(bT,u),t.value=l,i.value=u};o(),In(r,jp.PROPERTYCHANGE,uy(o,300))}persist(){this.persistXY(),this.persistZoom(),this.persistRotation()}restore(){const e=Kn().getOlMap().getView(),t=Nn.getValue(y5,kp),i=Nn.getValue(_5,kp),r=Nn.getInitialVersion(),o=Nn.getValue(vT,kp),s=Nn.getValue(bT,kp),l=Nn.getValue(Cse),u=ff(tu,Dp);let h,d;t!==void 0?d=r===3?Number(t):ebe[t]:d=parseInt("8",10),o!=null&&s!=null?r===3&&l!=null?h=gs([o,s],l,Dp):h=r===3?[o,s]:u([s,o],void 0,2):h=gs([6,49.7],Fu,Dp),e.setCenter(h),e.setZoom(d),e.setRotation(i||0)}}const nbe=new tbe,Nd={ANGLE:"a",IS_RECTANGLE:"r",IS_TEXT:"t",OPACITY:"o",SHOW_MEASURE:"m",SIZE:"s",STROKE:"k"},Eh={LINE_STRING:"LineString",POINT:"Point",POLYGON:"Polygon"},ibe={LineString:Eh.LINE_STRING,Point:Eh.POINT,Polygon:Eh.POLYGON,MultiLineString:Eh.LINE_STRING,MultiPoint:Eh.POINT,MultiPolygon:Eh.POLYGON};let dv={};class rbe extends pye{accuracy_;encodeStyles_;propertiesFunction_;setStyle_;prevX_;prevY_;constructor(e){super();const t=e??{};this.accuracy_=t.accuracy??sbe,this.encodeStyles_=t.encodeStyles??!0,this.propertiesFunction_=t.properties??obe,this.setStyle_=t.setStyle??!0,this.prevX_=0,this.prevY_=0,dv=t.propertiesType!==void 0&&t.propertiesType}decodeCoordinates_(e,t){const i=e.length;let r=0;const o=t!==void 0?t:[];let s=o.length;for(;r<i;){let l,u=0,h=0;do l=lw.indexOf(e.charAt(r++)),h|=(l&31)<<u,u+=5;while(l>=32);const d=h&1?~(h>>1):h>>1;this.prevX_+=d,u=0,h=0;do l=lw.indexOf(e.charAt(r++)),h|=(l&31)<<u,u+=5;while(l>=32);const m=h&1?~(h>>1):h>>1;this.prevY_+=m,o[s++]=this.prevX_*this.accuracy_,o[s++]=this.prevY_*this.accuracy_}return o}encodeCoordinates_(e,t,i,r){let o="";for(let s=i;s<r;s+=t){let l=e[s],u=e[s+1];l=Math.floor(l/this.accuracy_),u=Math.floor(u/this.accuracy_);const h=l-this.prevX_,d=u-this.prevY_;this.prevX_=l,this.prevY_=u,o+=WO(h)+WO(d)}return o}readFeatureFromText(e){let t=e.indexOf("~");const i=t>=0?e.substring(0,t)+")":e,r=this.readGeometryFromText(i),o=new Zi(r);if(t>=0){const s=e.substring(t+1,e.length-1);t=s.indexOf("~");const l=t>=0?s.substring(0,t):s;if(l!=""){const u=l.split("'");for(let h=0;h<u.length;++h){const m=u[h].split("*");let y=m[0];const x=m[1];!this.setStyle_&&dv[y]&&(y=dv[y]),o.set(y,x)}}if(t>=0){const u=s.substring(t+1);this.setStyle_?vbe(u,o):bbe(u,o)}}return o}readFeaturesFromText(e){const t=[];for(e=e.substring(1);e.length>0;){const i=e.indexOf(")"),r=this.readFeatureFromText(e.substring(0,i+1));t.push(r),e=e.substring(i+1)}return t}readGeometryFromText(e){const t=Ebe[e[0]];return this.prevX_=0,this.prevY_=0,t.call(this,e)}getCastShortProperty(e,t){const i=Km[t];return tz(t,e.get(i))}decodeShortProperties(e,t){const i=e.getGeometry()?.getType(),r=this.getCastShortProperty(e,"isCircle")?"drawnCircle":this.getCastShortProperty(e,"isLabel")?"drawnLabel":`drawn${i?.replace("String","")}`,o={showOrientation:!1,...Object.fromEntries(Rbe.map(h=>[h,this.getCastShortProperty(e,h)]))},s=e.get(Km.name),l=e.get(Km.description);Object.values(Km).forEach(h=>e.unset(h));const u=Object.assign(new El,e,{id:Math.floor(Math.random()*Date.now()),label:s,description:l,display_order:t,selected:!1,map_id:void 0,saving:!1,featureType:r,featureStyle:o});return u.editable=u.map_id===void 0,u.setStyle(u.getStyleFunction()),u}writeFeatureText(e,t){const i=[];let r="";const o=e.getGeometry();o!=null&&(r=this.writeGeometryText(o,t)),r.length>0&&(r=r.substring(0,r.length-1),i.push(r));const s=[],l=function(h,d){if(d!==e.getGeometryName()){s.length!==0&&s.push("'");const m=d.replace(/[()'*]/g,"_")+"*"+h.toString().replace(/[()'*]/g,"_");s.push(m)}},u=this.propertiesFunction_(e);for(const h in u)l(u[h],h);if(s.length>0&&(i.push("~"),Array.prototype.push.apply(i,s)),this.encodeStyles_){const h=e.getStyleFunction();if(h!==void 0){let d=h.call(this,e,0);if(d!==null){const m=[];d=Array.isArray(d)?d:[d],lbe(d,o?.getType(),m),m.length>0&&(i.push("~"),Array.prototype.push.apply(i,m))}}}return i.push(")"),i.join("")}writeFeaturesText(e,t){const i=[];if(e.length>0){i.push("F");for(let r=0,o=e.length;r<o;++r)i.push(this.writeFeatureText(e[r],t))}return i.join("")}writeGeometryText(e,t){const i=Tbe[e.getType()],r=nu(e,!0,t);return this.prevX_=0,this.prevY_=0,i.call(this,r)}}const lw=".-_!*ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghjkmnpqrstuvwxyz",sbe=1;function obe(n){return n.getProperties()}function WO(n){let e=n<<1;return n<0&&(e=~e),abe(e)}function abe(n){let e="";for(;n>=32;)e+=lw.charAt(32|n&31),n>>=5;return e+=lw.charAt(n),e}function lbe(n,e,t){const i=ibe[e];for(let r=0;r<n.length;++r){const o=n[r],s=o.getFill(),l=o.getImage(),u=o.getStroke(),h=o.getText();i==Eh.POLYGON?s!==null&&u&&hbe(s,u,t):i==Eh.LINE_STRING?u!==null&&ube(u,t):i==Eh.POINT&&l!==null&&cbe(l,t),h!==null&&dbe(h,t)}}function ube(n,e){Fk(n,e)}function cbe(n,e){if(n instanceof Qs){const t=n.getRadius();e.length>0&&e.push("'"),e.push("pointRadius*"+t);const i=n.getFill();i!==null&&Gk(i,e);const r=n.getStroke();r!==null&&Fk(r,e)}}function hbe(n,e,t){Gk(n,t),e!==null&&Fk(e,t)}function Gk(n,e,t){const i=t!==void 0?t:"fillColor",r=n.getColor();if(r!==null){const o=Hl(r),s=jB(o);e.length>0&&e.push("'"),e.push(i+"*"+s)}}function Fk(n,e){const t=n.getColor();if(t!==null){const r=Hl(t),o=jB(r);e.length>0&&e.push("'"),e.push("strokeColor*"+o)}const i=n.getWidth();i!==void 0&&(e.length>0&&e.push("'"),e.push("strokeWidth*"+i))}function dbe(n,e){const t=n.getFont();if(t!==void 0){const r=t.split(" ");r.length>=3&&(e.length>0&&e.push("'"),e.push("fontSize*"+r[1]))}const i=n.getFill();i!==null&&Gk(i,e,"fontColor")}function fbe(n){n=n.substring(2,n.length-1);const e=this.decodeCoordinates_(n,[]);return new $i(e,"XY")}function pbe(n){n=n.substring(2,n.length-1);let e=[];const t=[],i=n.split("'");for(let r=0,o=i.length;r<o;++r)e=this?.decodeCoordinates_(i[r],e),t[r]=e.length;return new Nu(e,"XY",t)}function gbe(n){n=n.substring(2,n.length-1);const e=this?.decodeCoordinates_(n);return new Mr(e)}function mbe(n){n=n.substring(2,n.length-1);const e=this?.decodeCoordinates_(n);return new Jh(e)}function ybe(n){n=n.substring(2,n.length-1);let e=[];const t=[],i=n.split("'");for(let r=0,o=i.length;r<o;++r){e=this?.decodeCoordinates_(i[r],e);let s=e.length;r===0?(e[s++]=e[0],e[s++]=e[1]):(e[s++]=e[t[r-1]],e[s++]=e[t[r-1]+1]),t[r]=s}return new Fo(e,"XY",t)}function _be(n){n=n.substring(2,n.length-1);let e=[];const t=[],i=n.split(")(");for(let r=0,o=i.length;r<o;++r){const s=i[r].split("'"),l=t[r]=[];for(let u=0,h=s.length;u<h;++u){e=this?.decodeCoordinates_(s[u],e);let d=e.length;u===0?(e[d++]=e[0],e[d++]=e[1]):(e[d++]=e[l[u-1]],e[d++]=e[l[u-1]+1]),l[u]=d}}return new vf(e,"XY",t)}function vbe(n,e){if(n=="")return;const t=nz(n),i=t.fillColor,r=t.fontSize,o=t.fontColor,s=t.pointRadius,l=t.strokeColor,u=t.strokeWidth;let h;i!==void 0&&(h=new Ji({color:i}));let d;l!==void 0&&u!==void 0&&(d=new ki({color:l,width:u}));let m;s!==void 0&&(m=new Qs({radius:s,fill:h,stroke:d}),h=d=void 0);let y;r!==void 0&&o!==void 0&&(y=new sd({font:r+" sans-serif",fill:new Ji({color:o})}));const x=new qn({fill:h,image:m,stroke:d,text:y});e.setStyle(x)}function bbe(n,e){const t=nz(n),i=e.getGeometry();if(i instanceof Mr?t.isLabel||t[Nd.IS_TEXT]?(delete t.strokeColor,delete t.fillColor):(delete t.fontColor,delete t.fontSize):(delete t.fontColor,i instanceof $i&&(delete t.fillColor,delete t.fillOpacity)),t.fontSize){let o=parseFloat(t.fontSize);t.fontSize.indexOf("px")!==-1&&(o=Math.round(o/1.333333)),t.fontSize=o}const r={};for(const o in t){const s=t[o];dv[o]?r[dv[o]]=s:r[o]=s}e.setProperties(r)}function tz(n,e){const t=[Nd.ANGLE,Nd.OPACITY,Nd.SIZE,Nd.STROKE,"pointRadius","strokeWidth","stroke","angle","opacity","size"],i=[Nd.IS_RECTANGLE,Nd.IS_TEXT,Nd.SHOW_MEASURE,"isCircle","isRectangle","isLabel","showMeasure","showOrientation"];return t.includes(n)?+e:i.includes(n)?e==="true":e}function nz(n){const e=n.split("'"),t={};for(let i=0;i<e.length;++i){const o=e[i].split("*"),s=o[0],l=o[1];t[s]=tz(s,l)}return t}function xbe(n){const e=n,t=e.getFlatCoordinates(),i=e.getStride(),r=t.length;return"l("+this?.encodeCoordinates_(t,i,0,r)+")"}function Ibe(n){const e=n,t=e.getEnds(),i=t.length,r=e.getFlatCoordinates(),o=e.getStride();let s=0;const l=["L("];for(let u=0;u<i;++u){const h=t[u],d=this?.encodeCoordinates_(r,o,s,h);u!==0&&l.push("'"),l.push(d),s=h}return l.push(")"),l.join("")}function Cbe(n){const e=n,t=e.getFlatCoordinates(),i=e.getStride(),r=t.length;return"p("+this?.encodeCoordinates_(t,i,0,r)+")"}function wbe(n){const e=n,t=e.getFlatCoordinates(),i=e.getStride(),r=t.length;return"P("+this?.encodeCoordinates_(t,i,0,r)+")"}function iz(n,e,t,i,r){const o=i.length;for(let s=0;s<o;++s){const l=i[s]-e,u=this?.encodeCoordinates_(n,e,t,l);s!==0&&r.push("'"),r.push(u),t=i[s]}return t}function Abe(n){const e=n,t=e.getFlatCoordinates(),i=e.getStride(),r=e.getEnds(),o=0,s=["a("];return iz.call(this,t,i,o,r,s),s.push(")"),s.join("")}function Sbe(n){const e=n,t=e.getFlatCoordinates(),i=e.getStride(),r=e.getEndss(),o=r.length;let s=0;const l=["A"];for(let u=0;u<o;++u){const h=r[u];l.push("("),s=iz.call(this,t,i,s,h,l),l.push(")")}return l.join("")}const Ebe={P:mbe,L:pbe,A:_be,l:fbe,p:gbe,a:ybe},Tbe={MultiLineString:Ibe,MultiPoint:wbe,MultiPolygon:Sbe,LineString:xbe,Point:Cbe,Polygon:Abe},Km={angle:"a",color:"c",description:"d",stroke:"e",isLabel:"i",linestyle:"l",name:"n",opacity:"o",showOrientation:"r",shape:"s",size:"t",isCircle:"u",symbolId:"symbolId",symboltype:"symboltype"},Rbe=["angle","color","stroke","linestyle","opacity","showOrientation","shape","size","symbolId","symboltype"],GI=new rbe({encodeStyles:!1,properties:function(n){const e=n.toProperties();for(const t in e)if(e[t]===null||e[t]===void 0)delete e[t];else if(t==="__map_id__"||t==="fid")delete e[t];else if(Km[t]){const i=e[t];delete e[t],e[Km[t]]=i}return e}});window.Cypress&&(window.featureHash=GI);class Mbe{featuresToUrl(e){if(!e)return"";const t=e.filter(i=>!i.map_id).sort((i,r)=>i.display_order-r.display_order).map(i=>{const r=new El(i);return tk(r)});return t.length>0?GI.writeFeatures(t):""}urlToFeatures(e){return(e?GI.readFeatures(e):[]).map((r,o)=>GI.decodeShortProperties(r,o)).map(r=>$B(r))}}const zO=new Mbe;class kbe{bootstrap(){this.restore();let e;e=Ss(()=>{this.persist(),e&&e()})}persist(){const{drawnFeatures:e}=xt(Jr());kt(e,t=>{Nn.setValue(yT,t,zO.featuresToUrl)},{immediate:!0})}restore(){const{drawnFeatures:e}=xt(Jr()),i=Nn.getValue(yT,zO.urlToFeatures).filter(r=>r!=null);i.forEach(r=>{r.map_id=void 0}),e.value=[...e.value,...i]}}const Lbe=new kbe;class Pbe{bootstrap(){this.restore();let e;e=Ss(()=>{this.persist(),e&&e()})}persist(){const{locationInfoCoords:e}=xt(rg());kt(e,t=>{t===void 0?Nn.removeItem(vS):(Nn.setValue(vS,!0),Nn.setValue(vT,t[0]),Nn.setValue(bT,t[1]))},{immediate:!0})}restore(){const{locationInfoCoords:e}=xt(rg()),t=Kn().getOlMap(),i=Nn.getValue(vS);i&&i!=="false"&&(e.value=t.getView().getCenter())}}const Gbe=new Pbe,Fbe={key:0,"data-cy":"attributionControl",class:"absolute bottom-0 z-10 text-[0.8em] px-[4px] text-[#6b818f] bg-[#ffffffb3]"},Obe=st({__name:"attribution-control",setup(n){const e=Wi(),t=Ke("");return Ss(()=>{t.value=e.bgLayer?.metadata?.attribution||""}),(i,r)=>{const o=Tl("dompurify-html");return t.value?Sn((U(),oe("div",Fbe,null,512)),[[o,t.value]]):Ge("",!0)}}});function jy(n,e){const t=new n(e),i=Kn(),r=Go("olMap");return gr(()=>{r.addControl(t),r.changed()}),Ds(()=>{const o=i.getOlMap();o.removeControl(t),o.changed()}),{control:t}}const Nbe=["title"],Dbe=st({__name:"location-control",props:{className:{default:"location-button"},label:{default:""},tipLabel:{default:"Location"}},setup(n){const{t:e}=Ct(),{addNotification:t}=ns(),i=n,r=Ke(null),o=Ke(!1);let s=null,l=null,u=null,h=null,d=null;function m(){if(window.location.protocol!=="https:"&&window.location.hostname!=="localhost"){t(e("La geolocalisation n'est disponible que dans la version scurise du Geoportail (https). Voulez-vous tre automatiquement redirig?",{ns:"client"}),mi.WARNING);return}s===null&&y(),s?.getTracking()?(C(),s?.setTracking(!1)):(x(),d?.getView().setZoom(17),s?.setTracking(!0))}function y(){d&&(s=new nle({projection:d.getView().getProjection(),trackingOptions:{enableHighAccuracy:!0,maximumAge:6e4,timeout:7e3}}),s.on("change:tracking",()=>{o.value=s?.getTracking()??!1}),s.on("change:position",()=>{const w=s?.getPosition();w&&l&&(l.setGeometry(new Mr(w)),d?.getView().setCenter(w))}),s.on("change:accuracyGeometry",()=>{const w=s?.getAccuracyGeometry();w&&u&&u.setGeometry(w)}),s.on("error",w=>{if(C(),w.message&&w.message.length>0){const S=e("Erreur lors de l'acquisition de la position :",{ns:"client"})+" "+w.message;t(S,mi.ERROR)}}))}function x(){d&&(h||(l=new Zi,l.setStyle(new qn({image:new Qs({radius:6,fill:new Ji({color:"#3399CC"}),stroke:new ki({color:"#fff",width:2})})})),u=new Zi,u.setStyle(new qn({fill:new Ji({color:"rgba(51, 153, 204, 0.2)"}),stroke:new ki({color:"#3399CC",width:2})})),h=new bo({source:new ua({features:[]}),zIndex:1e3}),d.addLayer(h)),h.getSource()?.clear(),u?.setGeometry(void 0),l?.setGeometry(void 0),u&&l&&(h.getSource()?.addFeature(u),h.getSource()?.addFeature(l)))}function C(){h?.getSource()?.clear()}return gr(()=>{d=Kn().getOlMap(),jy(id,{...i,target:r})}),Ds(()=>{s&&s.setTracking(!1),h&&d&&d.removeLayer(h)}),(w,S)=>(U(),oe("div",{ref_key:"controlElement",ref:r,class:Dn([{"tracker-on":o.value,"tracker-off":!o.value},i.className,k(Vc),k(Cf)])},[P("button",{title:k(e)(i.tipLabel),onClick:m},K(i.label),9,Nbe)],2))}}),Vbe=is(Dbe,[["__scopeId","data-v-74224a7f"]]),Bbe={class:"scale-selector dropup"},Zbe=["aria-label","aria-expanded","aria-controls"],Wbe=["innerHTML"],zbe=["aria-labelledby"],Ube=["onClick","aria-label"],Xbe=["innerHTML"],Ybe=st({__name:"scale-selector",setup(n){const{t:e}=Ct(),{getOlMap:t}=Kn(),i=t(),{minZoom:r,maxZoom:o}=xt(Wi()),s=Ke(!1),l=Ke(null),u=Ke(null);let h=null,d=null;const m={8:"1&nbsp;:&nbsp;1'500'000",9:"1&nbsp;:&nbsp;750'000",10:"1&nbsp;:&nbsp;400'000",11:"1&nbsp;:&nbsp;200'000",12:"1&nbsp;:&nbsp;100'000",13:"1&nbsp;:&nbsp;50'000",14:"1&nbsp;:&nbsp;25'000",15:"1&nbsp;:&nbsp;12'000",16:"1&nbsp;:&nbsp;6'000",17:"1&nbsp;:&nbsp;3'000",18:"1&nbsp;:&nbsp;1'500",19:"1&nbsp;:&nbsp;750",20:"1&nbsp;:&nbsp;400",21:"1&nbsp;:&nbsp;200"},y=Ke(void 0),x=At(()=>{const ce=r.value??8,pe=o.value??19,Y={};return Object.keys(m).forEach(he=>{const D=Number(he);D>=ce&&D<=pe&&(Y[D]=m[D])}),Y}),C=At(()=>Object.keys(x.value).map(Number).sort((ce,pe)=>ce-pe)),w=ce=>x.value[ce]||m[ce]||"",S=ce=>ce.replace(/&nbsp;/g," ").replace(/'/g,"'"),T=At(()=>y.value!==void 0?y.value:""),M=At(()=>y.value?S(y.value):e("No scale")),G=ce=>{const pe=i.getView();pe&&(pe.setZoom(ce),s.value=!1),aa(()=>{l.value?.focus()})},N=()=>{const ce=i.getView();if(!ce)return;const pe=Math.round(ce.getZoom()||0),Y=m[pe];Y!==void 0&&(y.value=Y)},V=()=>{h!==null&&_l(h);const ce=i.getView();ce&&(h=ce.on("change:resolution",N))},W=()=>{s.value=!s.value,s.value&&aa(()=>{u.value?.querySelector("a")?.focus()})},j=ce=>{ce.key==="Enter"||ce.key===" "?(ce.preventDefault(),ce.stopPropagation(),W()):ce.key==="Escape"&&s.value?(ce.preventDefault(),ce.stopPropagation(),s.value=!1):ce.key==="ArrowDown"&&!s.value?(ce.preventDefault(),ce.stopPropagation(),W()):(ce.key==="ArrowUp"||ce.key==="ArrowDown")&&ce.stopPropagation()},J=ce=>{const pe=Array.from(u.value?.querySelectorAll("a")||[]),Y=pe.findIndex(he=>he===document.activeElement);if(ce.key==="Escape")ce.preventDefault(),ce.stopPropagation(),s.value=!1,l.value?.focus();else if(ce.key==="ArrowDown"){ce.preventDefault(),ce.stopPropagation();const he=(Y+1)%pe.length;pe[he]?.focus()}else if(ce.key==="ArrowUp"){ce.preventDefault(),ce.stopPropagation();const he=Y<=0?pe.length-1:Y-1;pe[he]?.focus()}else ce.key==="Home"?(ce.preventDefault(),ce.stopPropagation(),pe[0]?.focus()):ce.key==="End"?(ce.preventDefault(),ce.stopPropagation(),pe[pe.length-1]?.focus()):ce.key==="Tab"&&(s.value=!1)},te=ce=>{const pe=ce.target;l.value&&!l.value.contains(pe)&&u.value&&!u.value.contains(pe)&&(s.value=!1)};return gr(()=>{const ce=i.getView();if(ce){const Y=ce.getZoom();Y!==void 0&&(y.value=m[Math.round(Y)])}V();const pe=i.getView();pe&&(d=pe.on("change",()=>{V(),N()})),document.addEventListener("click",te)}),og(()=>{h!==null&&_l(h),d!==null&&_l(d),document.removeEventListener("click",te)}),(ce,pe)=>(U(),oe("div",Bbe,[P("button",{type:"button",class:"scale-button",onClick:W,onKeydown:j,ref_key:"dropdownButton",ref:l,"aria-label":k(e)("Select scale")+": "+M.value,"aria-expanded":s.value,"aria-haspopup":"true","aria-controls":s.value?"scale-menu":void 0},[P("span",{innerHTML:T.value,"aria-hidden":"true"},null,8,Wbe),pe[0]||(pe[0]=Bt("",-1)),pe[1]||(pe[1]=P("span",{class:"caret","aria-hidden":"true"},null,-1))],40,Zbe),Sn(P("ul",{ref_key:"dropdownMenu",ref:u,id:"scale-menu",class:"scale-dropdown",role:"menu",onKeydown:J,"aria-labelledby":l.value?"scale-button":void 0},[(U(!0),oe(Et,null,yi(C.value,Y=>(U(),oe("li",{key:Y,role:"none"},[P("a",{href:"#",role:"menuitem",onClick:fs(he=>G(Y),["prevent"]),"aria-label":S(w(Y)),tabindex:"0"},[P("span",{innerHTML:w(Y)},null,8,Xbe)],8,Ube)]))),128))],40,zbe),[[zp,s.value]])]))}}),Hbe=is(Ybe,[["__scopeId","data-v-1f8cd5e5"]]),qS="units",Kbe=[1,2,5],f0=25.4/.28;let jbe=class extends id{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+Vc,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(qS,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(qS)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(qS,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,r=this.getUnits(),o=r=="degrees"?"degrees":"m";let s=Sv(i,e.resolution,t,o);const l=this.minWidth_*(this.dpi_||f0)/f0,u=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||f0)/f0:void 0;let h=l*s,d="";if(r=="degrees"){const G=Xp.degrees;h*=G,h<G/60?(d="",s*=3600):h<G?(d="",s*=60):d=""}else if(r=="imperial")h<.9144?(d="in",s/=.0254):h<1609.344?(d="ft",s/=.3048):(d="mi",s/=1609.344);else if(r=="nautical")s/=1852,d="NM";else if(r=="metric")h<1e-6?(d="nm",s*=1e9):h<.001?(d="m",s*=1e6):h<1?(d="mm",s*=1e3):h<1e3?d="m":(d="km",s/=1e3);else if(r=="us")h<.9144?(d="in",s*=39.37):h<1609.344?(d="ft",s/=.30480061):(d="mi",s/=1609.3472);else throw new Error("Invalid units");let m=3*Math.floor(Math.log(l*s)/Math.log(10)),y,x,C,w=0,S,T;for(;;){C=Math.floor(m/3);const G=Math.pow(10,C);if(y=Kbe[(m%3+3)%3]*G,x=Math.round(y/s),isNaN(x)){this.element.style.display="none",this.renderedVisible_=!1;return}if(u!==void 0&&x>=u){y=w,x=S,C=T;break}else if(x>=l)break;w=y,S=x,T=C,++m}const M=this.scaleBar_?this.createScaleBar(x,y,d):y.toFixed(C<0?-C:0)+" "+d;this.renderedHTML_!=M&&(this.innerElement_.innerHTML=M,this.renderedHTML_=M),this.renderedWidth_!=x&&(this.innerElement_.style.width=x+"px",this.renderedWidth_=x),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const r=this.getScaleForResolution(),o=r<1?Math.round(1/r).toLocaleString()+" : 1":"1 : "+Math.round(r).toLocaleString(),s=this.scaleBarSteps_,l=e/s,u=[this.createMarker("absolute")];for(let d=0;d<s;++d){const m=d%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";u.push(`<div><div class="ol-scale-singlebar ${m}" style="width: ${l}px;"></div>`+this.createMarker("relative")+(d%2===0||s===2?this.createStepText(d,e,!1,t,i):"")+"</div>")}return u.push(this.createStepText(s,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+o+"</div>":"")+u.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,r,o){const l=(e===0?0:Math.round(r/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+o),u=e===0?-3:t/this.scaleBarSteps_*-1,h=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${u}px;text-align: ${e===0?"left":"center"};min-width: ${h}px;left: ${i?t+"px":"unset"};">`+l+"</div>"}getScaleForResolution(){const e=Sv(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||f0,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}};const $be={class:"scaleline-wrapper"},Jbe=st({__name:"scale-line",setup(n){const{getOlMap:e}=Kn(),t=e(),i=Ke(null);let r=null;return gr(()=>{i.value&&(r=new jbe({target:i.value,units:"metric",bar:!1,text:!0,minWidth:64}),t.addControl(r))}),og(()=>{r&&(t.removeControl(r),r=null)}),(o,s)=>(U(),oe("div",$be,[P("div",{ref_key:"scaleLineContainer",ref:i,class:"scaleline-container"},null,512)]))}}),qbe=is(Jbe,[["__scopeId","data-v-21f5738c"]]),QS="projection",UO="coordinateFormat";class Qbe extends id{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(QS,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(UO)}getProjection(){return this.get(QS)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(In(t,Tv.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(In(t,Tv.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(UO,e)}setProjection(e){this.set(QS,Oi(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const o=this.getProjection();o?this.transform_=Ny(this.mapProjection_,o):this.transform_=cD}const r=this.getMap().getCoordinateFromPixelInternal(e);if(r){if(this.transform_(r,r),this.wrapX_){const s=this.getProjection()||this.mapProjection_;Lw(r,s)}const o=this.getCoordinateFormat();o?t=o(r):t=r.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}const e1e={class:"projection-selector-wrapper"},t1e={class:"projection-selector dropup"},n1e=["aria-label","aria-expanded","aria-controls"],i1e={class:"projection-label","aria-hidden":"true"},r1e=["aria-labelledby"],s1e=["onClick","aria-current"],o1e=["aria-label"],a1e=st({__name:"projection-selector",setup(n){const{t:e}=Ct(),{getOlMap:t}=Kn(),i=t(),{coordinateString:r}=ZB(),o=Ke(!1),s=Ke(null),l=Ke(null),u=Ke(null);let h=null;const d=[{label:"LUREF",value:"EPSG:2169"},{label:"Lon/Lat WGS84",value:"EPSG:4326"},{label:"Lon/Lat WGS84 DMS",value:"EPSG:4326:DMS"},{label:"Lon/Lat WGS84 DM",value:"EPSG:4326:DMm"},{label:"WGS84 UTM 32|31",value:"EPSG:3263*"}],m=Ke(d[0]),y=At(()=>m.value.label),x=G=>{if(!G)return"";const N=i.getView().getProjection().getCode(),V=m.value.value;return V==="EPSG:4326:DMS"?r(G,N,"EPSG:4326",!0,!1):V==="EPSG:4326:DMm"?r(G,N,"EPSG:4326",!1,!0):r(G,N,V,!1,!1)},C=G=>{m.value=G,o.value=!1,h&&h.setCoordinateFormat(x),aa(()=>{s.value?.focus()})},w=()=>{o.value=!o.value,o.value&&aa(()=>{l.value?.querySelector("a")?.focus()})},S=G=>{G.key==="Enter"||G.key===" "?(G.preventDefault(),G.stopPropagation(),w()):G.key==="Escape"&&o.value?(G.preventDefault(),G.stopPropagation(),o.value=!1):G.key==="ArrowDown"&&!o.value&&(G.preventDefault(),G.stopPropagation(),w())},T=G=>{const N=Array.from(l.value?.querySelectorAll("a")||[]),V=N.findIndex(W=>W===document.activeElement);if(G.key==="Escape")G.preventDefault(),G.stopPropagation(),o.value=!1,s.value?.focus();else if(G.key==="ArrowDown"){G.preventDefault(),G.stopPropagation();const W=(V+1)%N.length;N[W]?.focus()}else if(G.key==="ArrowUp"){G.preventDefault(),G.stopPropagation();const W=V<=0?N.length-1:V-1;N[W]?.focus()}else G.key==="Home"?(G.preventDefault(),G.stopPropagation(),N[0]?.focus()):G.key==="End"?(G.preventDefault(),G.stopPropagation(),N[N.length-1]?.focus()):G.key==="Tab"&&(o.value=!1)},M=G=>{const N=G.target;s.value&&!s.value.contains(N)&&l.value&&!l.value.contains(N)&&(o.value=!1)};return gr(()=>{u.value&&(h=new Qbe({className:"custom-mouse-coordinates",target:u.value,coordinateFormat:x,projection:void 0}),i.addControl(h)),document.addEventListener("click",M)}),og(()=>{h&&(i.removeControl(h),h=null),document.removeEventListener("click",M)}),(G,N)=>(U(),oe("div",e1e,[P("div",t1e,[P("button",{type:"button",class:"projection-button",onClick:w,onKeydown:S,ref_key:"dropdownButton",ref:s,"aria-label":k(e)("Select projection")+": "+y.value,"aria-expanded":o.value,"aria-haspopup":"true","aria-controls":o.value?"projection-menu":void 0},[P("span",i1e,K(y.value),1),N[0]||(N[0]=P("span",{class:"caret","aria-hidden":"true"},null,-1))],40,n1e),Sn(P("ul",{ref_key:"dropdownMenu",ref:l,id:"projection-menu",class:"projection-dropdown",role:"menu",onKeydown:T,"aria-labelledby":s.value?"projection-button":void 0},[(U(),oe(Et,null,yi(d,V=>P("li",{key:V.value,role:"none"},[P("a",{href:"#",role:"menuitem",onClick:fs(W=>C(V),["prevent"]),class:Dn({active:V.value===m.value.value}),"aria-current":V.value===m.value.value?"true":void 0,tabindex:"0"},K(V.label),11,s1e)])),64))],40,r1e),[[zp,o.value]])]),P("div",{ref_key:"mousePositionContainer",ref:u,class:"mouse-position",role:"status","aria-live":"polite","aria-label":k(e)("Current coordinates")},null,8,o1e)]))}}),l1e=is(a1e,[["__scopeId","data-v-5fe08aa6"]]),u1e=["aria-label"],c1e={class:"elevation-label"},h1e={class:"elevation-value",role:"status","aria-live":"polite"},d1e=st({__name:"elevation-display",setup(n){const{t:e}=Ct(),{getOlMap:t}=Kn(),i=t(),r=Ke("N/A");let o=null;const s=h=>h===null||h<=0?"N/A":`${h.toFixed(2)} m`,l=async h=>{if(h.coordinate)try{const d=await qB(h.coordinate);r.value=s(d)}catch{r.value="N/A"}},u=h=>{l(h)};return gr(()=>{o=In(i,"pointermove",u)}),og(()=>{o&&(_l(o),o=null)}),(h,d)=>(U(),oe("div",{class:"elevation-display","aria-label":k(e)("Elevation at cursor position")},[P("span",c1e,K(k(e)("Elevation"))+":",1),P("span",h1e,K(r.value),1)],8,u1e))}}),f1e=is(d1e,[["__scopeId","data-v-71c32fcf"]]),p1e=["aria-label"],g1e={class:"infobar-item"},m1e={class:"infobar-item"},y1e={class:"!hidden lg:!flex infobar-item-projection"},_1e={class:"!hidden lg:!flex infobar-item-elevation"},v1e=st({__name:"infobar-content",setup(n){const{t:e}=Ct();return(t,i)=>(U(),oe("div",{class:"infobar",role:"toolbar","aria-label":k(e)("Map information toolbar")},[P("div",g1e,[mt(Hbe)]),i[0]||(i[0]=P("div",{class:"infobar-separator","aria-hidden":"true"},null,-1)),P("div",m1e,[mt(qbe)]),i[1]||(i[1]=P("div",{class:"!hidden lg:!block infobar-separator","aria-hidden":"true"},null,-1)),P("div",y1e,[mt(l1e)]),i[2]||(i[2]=P("div",{class:"!hidden lg:!block infobar-separator","aria-hidden":"true"},null,-1)),P("div",_1e,[mt(f1e)])],8,p1e))}}),b1e=is(v1e,[["__scopeId","data-v-f917cdb1"]]),x1e={key:0,class:"infobar-container"},I1e=["title"],C1e=st({__name:"infobar-control",props:{className:{default:"infobar-button"},label:{default:""},tipLabel:{default:"Infobar"}},setup(n){const e=Ke(!1),{t}=Ct(),i=n;function r(){e.value=!e.value}return(o,s)=>(U(),oe("div",{class:Dn([[i.className,k(Cf)],"infobar-wrapper"])},[e.value?(U(),oe("div",x1e,[mt(b1e)])):Ge("",!0),P("div",{ref:"controlElement",class:Dn([{"infobar-on":e.value,"infobar-off":!e.value},k(Vc)])},[P("button",{title:k(t)(i.tipLabel),onClick:r},K(i.label),9,I1e)],2)],2))}}),w1e=is(C1e,[["__scopeId","data-v-d41d0ac3"]]),A1e=["href","title"],S1e=st({__name:"map-3d",props:{className:{default:"map-3d-button"},label:{default:"3D"},tipLabel:{default:"3D"}},setup(n){const e="https://geoportail-luxembourg.github.io/3dviewer/lux/",t=[6.13,49.61],i=["catalogConfig","LuxConfig"],r={9:35e4,10:18e4,11:1e5,12:4e4,13:25e3,14:9e3,15:6e3,16:3500,17:1900,18:900,19:600},o=Wi(),{t:s}=Ct(),l=n,{x:u,y:h,zoom:d,layers:m,bgLayer:y,rotation:x}=xt(o),C=Ke(null),w=At(()=>{const[G,N]=S(u.value,h.value),V=T(d.value??12),W=M(x.value??0),j=m.value.map(ce=>JSON.stringify([ce.name,1,0])),J=y.value?JSON.stringify([y.value.name,1,0]):null;J&&j.unshift(J);const te=`[[[${[G,N,V].join(",")}],[${[G,N,V].join(",")}],300,${W},-90,0],"cesium",["${i.join('","')}"],[${j.join(",")}],[],0]`;return`${e}?state=${encodeURIComponent(te)}`});gr(()=>{window.name="lux2d",jy(id,{...l,target:C})});function S(G,N){return G&&N?vc([G,N]):t}function T(G){const W=Math.max(9,Math.min(19,Math.round(G)));return r[W]}function M(G){const N=-((G*(180/Math.PI)+360)%360);return Math.round(N)}return(G,N)=>(U(),oe("div",{"data-cy":"3dViewerLink",ref_key:"controlElement",ref:C,class:Dn(`${l.className} ${k(Vc)} ${k(Cf)}`)},[P("a",{type:"button",target:"lux3d",href:w.value,title:k(s)(l.tipLabel)},"3D",8,A1e)],2))}}),E1e=is(S1e,[["__scopeId","data-v-05085833"]]),XO=["fullscreenchange","webkitfullscreenchange"],YO={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class T1e extends id{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const r=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=r,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener($n.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${Vc} ${Cf}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(HO(t))if(KO(t))M1e(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?R1e(i):rz(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=KO(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(lC(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(YO.ENTERFULLSCREEN)):(lC(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(YO.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(mo.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(mo.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,r=e.length;i<r;++i)pr(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();HO(i)?this.element.classList.remove(VG):this.element.classList.add(VG);for(let r=0,o=XO.length;r<o;++r)e.push(In(i,XO[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function HO(n){const e=n.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&n.fullscreenEnabled)}function KO(n){return!!(n.webkitIsFullScreen||n.fullscreenElement)}function rz(n){n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()}function R1e(n){n.webkitRequestFullscreen?n.webkitRequestFullscreen():rz(n)}function M1e(n){n.exitFullscreen?n.exitFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen()}const k1e=st({__name:"fullscreen-control",props:{className:{},label:{default:""},labelActive:{default:""}},setup(n){return jy(T1e,n),(t,i)=>Ge("",!0)}}),L1e=st({__name:"zoom-control",props:{className:{},zoomInLabel:{default:""},zoomOutLabel:{default:""}},setup(n){return jy(FD,n),(t,i)=>Ge("",!0)}}),P1e=st({__name:"rotate-control",props:{className:{},label:{}},setup(n){return jy(GD,n),(t,i)=>Ge("",!0)}});let G1e=class extends id{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null,this.fitOptions=e.fitOptions||{};const t=e.className!==void 0?e.className:"ol-zoom-extent",i=e.label!==void 0?e.label:"E",r=e.tipLabel!==void 0?e.tipLabel:"Fit to extent",o=document.createElement("button");o.setAttribute("type","button"),o.title=r,o.appendChild(typeof i=="string"?document.createTextNode(i):i),o.addEventListener($n.CLICK,this.handleClick_.bind(this),!1);const s=t+" "+Vc+" "+Cf,l=this.element;l.className=s,l.appendChild(o)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const t=this.getMap().getView(),i=this.extent?Wl(this.extent,t.getProjection()):t.getProjection().getExtent();t.fitInternal(VE(i),this.fitOptions)}};class F1e extends G1e{ol3dm;constructor(e){super(e)}handleZoomToExtent(){this.ol3dm&&this.ol3dm.luxCameraExtentInRadians&&this.ol3dm.is3dEnabled()||super.handleZoomToExtent()}}const O1e=st({__name:"zoom-to-extent-control",props:{className:{},label:{default:""},tipLabel:{},extent:{}},setup(n){return jy(F1e,n),(t,i)=>Ge("",!0)}}),jO=st({__name:"map-container",props:{v4_standalone:{type:Boolean,default:!1}},setup(n){const e=oi(),{embedded:t}=xt(e),i=Kn(),r=Ke(null),o=i.createMap(),s=n;o.getInteractions().forEach(h=>{h instanceof UE&&o.removeInteraction(h)});const l=new UE({condition:DH});o.addInteraction(l),s.v4_standalone&&(qve(),Qve(),Uve().addDrawLayer(o),Xve(),Jve().init(),xh.init(o));const u=[425152.9429259216,632446599999133e-8,914349.9239510496,6507914867875754e-9];return gr(()=>{r.value&&(new Zve(o),new Wve(o),nbe.bootstrap(),Lbe.bootstrap(),Gbe.bootstrap(),o.setTarget(r.value),window.olMap=o)}),Ss(()=>{r.value&&t.value&&setTimeout(()=>{i.resize()},1e3)}),Cw("olMap",o),(h,d)=>(U(),oe("div",{id:"map-container","data-cy":"mapContainer",ref_key:"mapContainer",ref:r,class:"h-full w-full bg-white relative"},[mt(L1e),mt(O1e,{extent:u}),k(t)?Ge("",!0):(U(),oe(Et,{key:0},[mt(k1e),mt(Obe),n.v4_standalone?(U(),Mt(E1e,{key:0})):Ge("",!0),mt(Vbe),mt(w1e),mt(P1e)],64))],512))}});function N1e(n,e){return n.children&&!e.children||e.children?.length===0?1:e.children&&!n.children||n.children?.length===0?-1:0}function sz(n,e,t=0){const{name:i="",type:r=Tc.WMS,children:o}=n,s=`${r}||${e}||${i}`.split("-").join("%2D"),l=Wi();return{id:s,name:i,depth:t,children:o?.sort(N1e).map(u=>sz(u,e,t+1)),checked:l.hasLayer(s),expanded:!1}}function D1e(n){const e=decodeURIComponent(n),[t,i,r]=e.split("||");return oz({id:e,url:Uv.getProxyfiedUrl(i),remoteLayer:{name:r,type:t}})}function oz({id:n,url:e,remoteLayer:t}){const{name:i="",type:r=Tc.WMS}=t;return{id:n,name:i,layers:i,url:e,type:r,imageType:B4.PNG}}const V1e={class:"relative text-center","data-cy":"remoteLayerModalContent"},B1e=["placeholder","value"],Z1e={key:0,class:"text-center"},W1e={class:"lux-label"},z1e={key:1,class:"text-center"},U1e={class:"lux-label"},X1e={key:2,class:"text-center"},Y1e={key:3,class:"overflow-auto max-h-[calc(400px-36px)]"},H1e=st({__name:"remote-layers",setup(n){const{t:e}=Ct(),t=Wi(),i=sa(),r=Ei([]),o=Ei(),{remoteLayersOpen:s}=xt(oi()),{setRemoteLayersOpen:l}=oi();let u=!1,h,d,m;Ss(y);function y(){o.value=o.value?gy.updateLayers(o.value,t.layers):void 0}Xv.fetchRemoteWmsEndpoint().then(N=>{r.value=N.map(({url:V,label:W})=>({label:W,value:V}))});async function x(N){u=!0,m=await Xv.getRemoteEndpoint(N).catch(()=>alert(e("Impossible de contacter ce WMS",{ns:"client"}))),d=N,u=!1}async function C(){const V=m?.getLayers();if(V&&V[0]){const W=sz(V[0],d);o.value=gy.updateLayers(W,t.layers)}}async function w(N){d=h=N,await x(d),C()}function S(N){h=N.target.value}async function T(){await x(h),C()}function M(N){o.value=gy.toggleNode(N.id,o.value,"expanded")}function G(N){const{id:V,name:W}=N,j=m;if(N.checked===!0)t.removeLayers(V);else{const J=j?.getLayerByName(W);if(J){const te=i.initLayer(oz({id:V,url:Uv.getProxyfiedUrl(d),remoteLayer:J}));t.addLayers(te)}}}return(N,V)=>k(s)?(U(),Mt(Rf,{key:0,title:k(e)("Add external data",{ns:"client"}),onClose:V[0]||(V[0]=W=>k(l)(!1))},{content:Xt(()=>[P("div",V1e,[mt(eg,{class:"lux-remote-services-dropdown",options:r.value,placeholder:k(e)("Predefined wms",{ns:"client"}),onChange:w},null,8,["options","placeholder"]),P("input",{class:"lux-input w-[300px]",type:"url",placeholder:k(e)("Choose or write a WMS url",{ns:"client"}),value:k(d)||"",onChange:S},null,40,B1e),P("button",{type:"button",class:"lux-btn",onClick:T},K(k(e)("Get the layers",{ns:"client"})),1)]),!k(u)&&k(m)?(U(),oe("div",Z1e,[P("span",W1e,K(k(e)("Description du service :",{ns:"client"})),1),Bt(" "+K(k(m).getServiceInfo()?.abstract),1)])):Ge("",!0),!k(u)&&k(m)?(U(),oe("div",z1e,[P("span",U1e,K(k(e)("Access constraints :",{ns:"client"})),1),Bt(" "+K(k(m).getServiceInfo()?.constraints),1)])):Ge("",!0),k(u)?(U(),oe("div",X1e,[V[1]||(V[1]=P("div",{class:"fa fa-refresh fa-spin"},null,-1)),P("span",null,K(k(e)("Chargement des informations",{ns:"client"})),1)])):Ge("",!0),k(u)?Ge("",!0):(U(),oe("div",Y1e,[o.value?(U(),Mt(eR,{key:0,class:"block p-[10px] mb-[11px]",node:o.value,onToggleParent:M,onToggleLayer:G},null,8,["node"])):Ge("",!0)]))]),_:1},8,["title"])):Ge("",!0)}});class K1e{bootstrap(){let e;e=Ss(()=>{this.restore(),this.persist(),e&&e()})}persist(){const e=aw();kt([()=>e.sliderActive,()=>e.sliderRatio],([t,i],[r])=>{t!==r&&Nn.setValue(xT,t),Nn.setValue(IT,i)})}restore(){const e=Nn.getValue(xT,UM),t=Nn.getValue(IT,kp),{toggleSlider:i,setRatio:r}=aw();typeof e<"u"&&e!==null&&(i(e),typeof t!==void 0&&t!==null&&r(t??QW))}}const j1e=new K1e,$1e=["onKeydown"],J1e={key:0,"data-cy":"sliderLayerLabel",class:"lux-slider-layer-label"},$O=30,q1e=st({__name:"splitter-element",props:{sliderActive:{type:Boolean},sliderRatio:{},sliderTopLayer:{},sliderOffset:{},containerOffset:{}},emits:["moveSplitBar","escSplitBar"],setup(n,{expose:e,emit:t}){const i=n,r=t,{t:o}=Ct(),s=Ke(null),l=At(()=>({left:`${i.sliderOffset}px`}));let u=!1;e({sliderElement:s});function h(S){r("moveSplitBar",S+s.value.offsetWidth/2)}function d(){u=!0,document.addEventListener("mousemove",m),document.addEventListener("mouseup",y)}function m(S){u&&h(S.clientX)}function y(){u=!1,document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",y)}function x(){const S=i.containerOffset+s.value.offsetLeft;h(S+$O)}function C(){const S=i.containerOffset+s.value.offsetLeft;h(S-$O)}function w(){r("escSplitBar")}return gr(()=>{s.value?.focus({focusVisible:!0})}),Ds(()=>{document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",y)}),(S,T)=>(U(),oe("button",{ref_key:"sliderElement",ref:s,onMousedown:d,onMousemove:m,onMouseup:y,onKeydown:[Js(fs(x,["stop"]),["space"]),Js(fs(x,["stop"]),["right"]),Js(fs(C,["stop"]),["left"]),Js(fs(C,["stop"]),["delete"]),Js(fs(w,["stop"]),["esc"])],class:"left-[20px] absolute h-full w-[32px] block",style:Dc(l.value),role:"seperator","aria-controls":"map-container","data-cy":"sliderElement"},[T[1]||(T[1]=P("span",{class:"lux-slider-line"},null,-1)),T[2]||(T[2]=P("span",{class:"lux-slider-arrows"},[P("span"),P("span")],-1)),n.sliderTopLayer?(U(),oe("span",J1e,[T[0]||(T[0]=P("i",{class:"fa fa-arrow-left mr-2"},null,-1)),P("span",null,K(k(o)(n.sliderTopLayer.name)),1)])):Ge("",!0)],44,$1e))}}),Q1e=st({__name:"slider-comparator",setup(n){const e=aw(),t=vk(),i=Kn().olMap,r=Ke(null),{sliderActive:o,sliderRatio:s,sliderTopLayer:l}=xt(e),u=At(()=>r.value?.sliderElement?.offsetWidth||0),h=Ke([0,0]),d=function(){let N=i.value?.getViewport()?.parentElement?.offsetLeft;return(N===void 0||N===0)&&(N=w?.offsetLeft),N!==void 0?N:0},m=At(()=>i.value&&r.value?s.value*h.value[0]-r.value?.sliderElement?.offsetWidth/2:0);let y,x,C,w;j1e.bootstrap(),kt([l,o],([N,V],[W])=>{N&&V?(N!==W&&T(),S()):T(),i.value?.render()}),kt(m,()=>{i.value?.render()});function S(){const N=t.getLayerFromCache(l.value);h.value=i.value?.getSize(),N&&(y=N.on(ja.PRERENDER,function(V){const W=V.context,j=m.value+u.value/2,J=Lx(V,[0,0]),te=Lx(V,[j,0]),ce=Lx(V,[0,h.value[1]]),pe=Lx(V,[j,h.value[1]]);W.save(),W.beginPath(),W.moveTo(J[0],J[1]),W.lineTo(ce[0],ce[1]),W.lineTo(pe[0],pe[1]),W.lineTo(te[0],te[1]),W.closePath(),W.clip()}),x=N.on(ja.POSTRENDER,function(V){V.context.restore()}),C=i?.value.on("change:size",()=>{h.value=i.value?.getSize()}))}function T(){_l([y,x,C])}function M(N){const V=i.value?.getSize(),W=(N-d())/V[0];e.setRatio(W)}function G(){e.toggleSlider()}return gr(()=>{w=i.value?.getTargetElement()?.closest(".map-wrapper")}),Ds(()=>{T()}),(N,V)=>k(l)&&k(o)?(U(),Mt(q1e,{key:0,ref_key:"splitterElement",ref:r,sliderActive:k(o),sliderRatio:k(s),sliderTopLayer:k(l),sliderOffset:m.value,containerOffset:d(),onMoveSplitBar:M,onEscSplitBar:G},null,8,["sliderActive","sliderRatio","sliderTopLayer","sliderOffset","containerOffset"])):Ge("",!0)}}),exe=st({__name:"simple-style-item",props:{styleName:{},colors:{}},setup(n){const e=n;return(t,i)=>(U(!0),oe(Et,null,yi(e.colors,(r,o)=>(U(),oe("span",{key:`${n.styleName}-${o}`,class:"grow m-px",style:Dc(`background-color: ${r}`)},"  ",4))),128))}}),txe={class:"text-white border-2 p-[10px] m-[10px]"},nxe={class:"text-center mb-3"},ixe=["title"],rxe={class:"text-white"},sxe=["title","onClick"],oxe={class:"flex"},axe=st({__name:"simple-style-selector",setup(n){const{t:e}=Ct(),t=Eu(),i=Tf(),{bgStyle:r}=xt(t),o=Bh().simple_styles.road,s=Ke(o);kt(r,u=>s.value=i.checkSelection(u||[],o),{immediate:!0});function l(u){t.setSimpleStyle(u)}return(u,h)=>(U(),oe("div",txe,[P("h5",nxe,K(k(e)("Slectionner un set de couleurs",{ns:"client"})),1),(U(!0),oe(Et,null,yi(s.value,d=>(U(),oe("div",{key:d.unlocalized_label,title:k(e)(d.unlocalized_label,{ns:"client"}),class:Dn(`${d.selected?"border-dotted":"border-hidden"} border-2 p-px`)},[P("span",rxe,K(k(e)(d.unlocalized_label,{ns:"client"}))+" : ",1),P("button",{title:k(e)("Select style: {{styleName}}",{ns:"app",styleName:k(e)(d.unlocalized_label)}),onClick:m=>l(d),class:"w-full"},[P("span",oxe,[mt(exe,{colors:d.colors,"style-name":d.unlocalized_label},null,8,["colors","style-name"])])],8,sxe)],10,ixe))),128))]))}});function lxe(n){const e=uxe(n);return!e||!e.medium_style_class?[]:Bh().medium_default_styles[e.medium_style_class]}function uxe(n){return Bh().bg_layers.find(e=>e.id==n?.id)}const cxe={class:"flex w-full items-center"},hxe={for:"colorId",class:"w-40 m-0 font-medium"},dxe={class:"grow"},fxe=["value"],pxe=["checked","aria-label"],gxe=st({__name:"medium-style-item",props:{style:{},colorEditable:{type:Boolean}},emits:["changeStyle"],setup(n,{emit:e}){const{t}=Ct(),i=n,r=e;function o(l){if(l.target){const u={...i.style,color:l.target.value};r("changeStyle",u)}}function s(l){if(l){const u={...i.style,visible:l.target.checked};r("changeStyle",u)}}return(l,u)=>(U(),oe("div",cxe,[P("label",hxe,K(k(t)(n.style.label)),1),P("div",dxe,[n.colorEditable&&i.style.color?(U(),oe("input",{key:0,id:"colorId",type:"color",class:"w-11 h-5 py-[1px] px-[2px]",value:i.style.color,onInput:o},null,40,fxe)):Ge("",!0)]),P("input",{type:"checkbox",class:"flex-none mr-3",checked:i.style.visible,onChange:s,"aria-label":k(t)("Show or hide {{thematicName}}",{ns:"app",thematicName:i.style.label})},null,40,pxe)]))}}),mxe={class:"text-white border-2 p-[10px] m-[10px]"},yxe={class:"text-center mb-3"},_xe=st({__name:"medium-style-selector",props:{layer:{}},setup(n){const e=["basemap_2015_global"],t=Eu(),{bgStyle:i}=xt(t),{t:r}=Ct(),o=n,s=At(()=>e.includes(o.layer.name)),l=At(()=>i.value||lxe(o.layer));function u(h,d){i.value=l.value.map((m,y)=>y===h?d:m),t.disableExpertStyle()}return(h,d)=>(U(),oe("div",mxe,[P("h5",yxe,K(s.value?k(r)("Slectionner une couleur par couche"):k(r)("Afficher une catgorie par couche")),1),(U(!0),oe(Et,null,yi(l.value,(m,y)=>(U(),Mt(gxe,{key:m.label,style:Dc(m),onChangeStyle:x=>u(y,x),colorEditable:s.value},null,8,["style","onChangeStyle","colorEditable"]))),128))]))}});var FI={exports:{}},vxe=FI.exports,JO;function bxe(){return JO||(JO=1,(function(n,e){(function(t,i){i()})(vxe,function(){function t(h,d){return typeof d>"u"?d={autoBom:!1}:typeof d!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}function i(h,d,m){var y=new XMLHttpRequest;y.open("GET",h),y.responseType="blob",y.onload=function(){u(y.response,d,m)},y.onerror=function(){console.error("could not download file")},y.send()}function r(h){var d=new XMLHttpRequest;d.open("HEAD",h,!1);try{d.send()}catch{}return 200<=d.status&&299>=d.status}function o(h){try{h.dispatchEvent(new MouseEvent("click"))}catch{var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(d)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Jd=="object"&&Jd.global===Jd?Jd:void 0,l=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(h,d,m){var y=s.URL||s.webkitURL,x=document.createElement("a");d=d||h.name||"download",x.download=d,x.rel="noopener",typeof h=="string"?(x.href=h,x.origin===location.origin?o(x):r(x.href)?i(h,d,m):o(x,x.target="_blank")):(x.href=y.createObjectURL(h),setTimeout(function(){y.revokeObjectURL(x.href)},4e4),setTimeout(function(){o(x)},0))}:"msSaveOrOpenBlob"in navigator?function(h,d,m){if(d=d||h.name||"download",typeof h!="string")navigator.msSaveOrOpenBlob(t(h,m),d);else if(r(h))i(h,d,m);else{var y=document.createElement("a");y.href=h,y.target="_blank",setTimeout(function(){o(y)})}}:function(h,d,m,y){if(y=y||open("","_blank"),y&&(y.document.title=y.document.body.innerText="downloading..."),typeof h=="string")return i(h,d,m);var x=h.type==="application/octet-stream",C=/constructor/i.test(s.HTMLElement)||s.safari,w=/CriOS\/[\d]+/.test(navigator.userAgent);if((w||x&&C||l)&&typeof FileReader<"u"){var S=new FileReader;S.onloadend=function(){var G=S.result;G=w?G:G.replace(/^data:[^;]*;/,"data:attachment/file;"),y?y.location.href=G:location=G,y=null},S.readAsDataURL(h)}else{var T=s.URL||s.webkitURL,M=T.createObjectURL(h);y?y.location=M:location.href=M,y=null,setTimeout(function(){T.revokeObjectURL(M)},4e4)}});s.saveAs=u.saveAs=u,n.exports=u})})(FI)),FI.exports}var az=bxe();const xxe={class:"text-white border-2 p-[10px] m-[10px] flex flex-col overflow-hidden"},Ixe={class:"text-center mb-3"},Cxe={class:"flex flex-row justify-center"},wxe={class:"absolute top-[70px] w-full text-center text-base leading-3 font-medium text-white"},Axe={class:"text-white border-2 relative h-[100px] w-[85px] mx-[10px] my-0 mb-[15px] text-sm hover:bg-secondary"},Sxe={class:"'block z-[5] w-full h-full cursor-pointer after:absolute after:pt-[15px] after:px-[15px] after:w-full after:text-center after:content-upload",for:"uploadMvtStyle"},Exe={class:"absolute top-[70px] w-full text-center text-base leading-3 font-medium"},Txe=["href"],Rxe=st({__name:"expert-style-selector",setup(n){const e=Wi(),t=Eu(),i=Tf(),{appliedStyle:r}=xt(t),{t:o}=Ct();function s(){const h=r.value,d=JSON.stringify(h),m=new Blob([d],{type:"text/plain;charset=utf-8"});az.saveAs(m,"styles.json")}function l(h){const d=h.target.files;if(d?.length!==1)return;const m=d[0];m.type==="application/json"&&(m.text().then(y=>{t.enableExpertStyle(),r.value=JSON.parse(y)}),h.target.value="")}function u(){return t.styleSerial===null?i.getDefaultMapBoxStyleUrl(i.getVectorId(e.bgLayer)):`${G0.mvtStylesGetUrl}?id=${t.styleSerial}`}return(h,d)=>(U(),oe("div",xxe,[P("h5",Ixe,K(k(o)("Lancer diteur externe ou importer json")),1),P("div",Cxe,[P("a",{href:"#",class:"text-white border-2 relative h-[100px] w-[85px] mx-[10px] my-0 mb-[15px] z-5 text-sm after:absolute after:left-[20px] after:top-[10px] after:z-4 after:w-[3.6em] after:text-center after:content-download hover:bg-secondary",onClick:d[0]||(d[0]=m=>s())},[P("span",wxe,K(k(o)("Download style")),1)]),P("div",Axe,[P("label",Sxe,[P("span",Exe,K(k(o)("Upload style")),1)]),P("input",{class:"invisible",type:"file",name:"uploadMvtStyle",id:"uploadMvtStyle",onChange:l},null,32)])]),P("a",{href:`https://maputnik.github.io/editor/?style=${u()}`,target:"_blank",class:"lux-btn text-center"},K(k(o)("Open Maputnik editor")),9,Txe)]))}}),Mxe={key:0,class:"lux","data-cy":"styleSelector"},kxe={key:0,class:"mb-px"},Lxe={key:1,class:"mb-px"},Pxe={key:2,class:"mb-px"},Gxe=st({__name:"style-selector",setup(n){const{t:e}=Ct(),t=Wi(),i=oi(),r=Eu(),{bgStyle:o,isExpertStyleActive:s}=xt(r),{bgLayer:l}=xt(t),{styleEditorOpenedSection:u}=xt(i),h=Tf(),d=At(()=>h.getStyleCapabilitiesFromLayer(l.value)),m=At(()=>d.value.styleEditors);kt(l,w=>{h.isLayerStyleEditable(w)?y():i.closeStyleEditorPanel()}),gr(()=>{y()});function y(){(!u.value||!m.value.includes(u.value))&&(u.value=m.value[0])}function x(){r.setStyle(null)}function C(w){u.value=u.value===w?void 0:w}return(w,S)=>d.value.isEditable?(U(),oe("div",Mxe,[m.value.includes(k(pl).simpleStyle)?(U(),oe("div",kxe,[mt(TI,{title:k(e)("Simple"),expanded:k(u)===k(pl).simpleStyle,onTogglePanel:S[0]||(S[0]=()=>C(k(pl).simpleStyle))},{default:Xt(()=>[mt(axe)]),_:1},8,["title","expanded"])])):Ge("",!0),m.value.includes(k(pl).mediumStyle)?(U(),oe("div",Lxe,[mt(TI,{title:k(e)("Medium"),expanded:k(u)===k(pl).mediumStyle,onTogglePanel:S[1]||(S[1]=()=>C(k(pl).mediumStyle))},{default:Xt(()=>[k(l)?(U(),Mt(_xe,{key:0,layer:k(l)},null,8,["layer"])):Ge("",!0)]),_:1},8,["title","expanded"])])):Ge("",!0),m.value.includes(k(pl).advancedStyle)?(U(),oe("div",Pxe,[mt(TI,{title:k(e)("Expert (style.json)"),expanded:k(u)===k(pl).advancedStyle,onTogglePanel:S[2]||(S[2]=()=>C(k(pl).advancedStyle))},{default:Xt(()=>[k(l)?(U(),Mt(Rxe,{key:0,layer:k(l)},null,8,["layer"])):Ge("",!0)]),_:1},8,["title","expanded"])])):Ge("",!0),k(o)||k(s)?(U(),oe("button",{key:3,onClick:x,class:"lux-btn my-2"},K(k(e)("Rinitialiser style",{ns:"client"})),1)):Ge("",!0)])):Ge("",!0)}}),Fxe=st({__name:"style-panel",setup(n){const{t:e}=Ct(),t=oi();return(i,r)=>(U(),Mt(pg,{"data-cy-value":"stylePanel","close-fn":k(t).closeStyleEditorPanel},{header:Xt(()=>[P("h1",null,K(k(e)("Vector tiles editor",{ns:"client"})),1)]),content:Xt(()=>[mt(Gxe)]),_:1},8,["close-fn"]))}});class Oxe{bootstrap(){this.restore();let e;e=Ss(()=>{this.persist(),e&&e()})}persist(){this.persistLayersOpen()}persistLayersOpen(){const e=oi(),{layersOpen:t}=xt(e);kt(t,(i,r)=>{r!==i&&Nn.setValue(RC,i)},{immediate:!0})}restore(){this.restoreLayersOpen(),this.restoreEmbeddedMode(),this.restoreIsAppMode()}restoreEmbeddedMode(){const e=Nn.getValue(Ise),t=e!==null&&e!=="false",{embedded:i}=xt(oi());i.value=t}restoreLayersOpen(){const e=Nn.getValue(RC)!=="false",{setLayersOpen:t}=oi();t(e)}restoreIsAppMode(){const{setIsApp:e}=oi(),t=Nn.getValue(yf)==="android"||Nn.getValue(yf)==="ios"||Nn.getValue(fg)==="yes";e(t)}}const Nxe=new Oxe,Hx="-",eE=",",qO="--";class Dxe{layerTimesToStrings(e){return e?e.split(qO):[]}layerIdsToLayers(e){const t=Sl(),i=sa();return(e?e.split(Hx):[]).map(o=>{const s=Xv.isRemoteLayer(o)?D1e(o):t.findById(parseInt(o,10));return s?i.initLayer(s):void 0}).reverse()}layerNamesToLayersV2(e){const t=Sl(),i=sa();return(e?e.split(eE):[]).map(o=>{const s=t.findByName(o);return s?i.initLayer(s):void 0}).reverse()}layersOpacitiesToNumbers(e,t=Hx){return Sse(e,t).reverse()}layersOpacitiesToNumbersV2=e=>this.layersOpacitiesToNumbers(e,eE);layersVisibilitiesToBooleansV2(e){return Ese(e,eE)}layersToLayerIds(e){return e?.map(t=>t.id).reverse().join(Hx)||""}layersToLayerOpacities(e){return e?.map(t=>t.opacity??1).reverse().join(Hx)||""}layersToLayerTimes(e){return e?.map(t=>sa().getLayerCurrentTime(t)??"").reverse().join(qO)||""}bgLayerNameToBgLayer(e){const t=Sl();return e?t.findBgLayerByName(e):null}bgLayerToBgLayerName(e){return e?.name||DC.name}}const gl=new Dxe,Vxe="basemap_2015_global",Bxe="orthogr_2013_global",Zxe={webbasemap:"basemap_2015_global","pixelmaps-color":"topogr_global","pixelmaps-gray":"topo_bw_jpeg",streets:"streets_jpeg",voidlayer:"blank"};class Wxe{bootstrap(){const e=Vr();let t;t=Ss(()=>{e.bgLayers.length>0&&(this.restore(),this.persist(),t&&t())})}persist(){const e=Wi(),{bgLayer:t}=xt(e);kt(t,(i,r)=>{r!==i&&Nn.setValue(p5,i,gl.bgLayerToBgLayerName)},{immediate:!0})}restore(){const{setMapBackground:e}=iA(),t=this.getBgLayerFromStorage();e(t)}getBgLayerFromStorage(){const e=Nn.getInitialVersion(),t=Nn.getValue(p5);return t?e===2?this.getBgLayerFromStorageV2(t):gl.bgLayerNameToBgLayer(t):gl.bgLayerNameToBgLayer(Vxe)}getBgLayerFromStorageV2(e){const t=Nn.getValue(IB,kp);let i="";return e?i=Zxe[e]:t===0&&(i=Bxe),gl.bgLayerNameToBgLayer(i)}}const zxe=new Wxe;class Uxe{bootstrap(){const e=Vr();let t;t=Ss(()=>{e.themes&&(this.restore(),this.persist(),t&&t())})}persist(){const e=Wi(),{layers:t}=xt(e);kt(t,(i,r)=>{r!==i&&(Nn.setValue(f5,i,gl.layersToLayerIds),Nn.setValue(g5,i,gl.layersToLayerOpacities),Nn.setValue(m5,i,gl.layersToLayerTimes))},{immediate:!0})}restore(){const e=Nn.getInitialVersion(),t=Wi(),i=Nn.getValue(f5,e===2?gl.layerNamesToLayersV2:gl.layerIdsToLayers);this.restoreLayersOpacities(i,e),this.restoreLayersTimes(i),e===2&&(Nn.removeItem(IB),Nn.removeItem(wse),Nn.removeItem(v5),Nn.removeItem(b5)),t.addLayers(...i?.filter(r=>r)||[])}restoreLayersOpacities(e,t){const i=t===2?this.getOpacitiesFromStorageV2():this.getOpacitiesFromStorage();i.length&&e?.forEach((r,o)=>r&&(r.opacity=i[o]??1))}restoreLayersTimes(e){const t=Nn.getValue(m5,gl.layerTimesToStrings);t.length&&e?.forEach((i,r)=>i&&t[r]&&this.restoreLayerTime(i,t[r]))}restoreLayerTime(e,t){const i=t.split("/");e.currentTimeMinValue=i[0],e.currentTimeMaxValue=i[1]}getOpacitiesFromStorage(){return Nn.getValue(g5,gl.layersOpacitiesToNumbers)}getOpacitiesFromStorageV2(){const e=Nn.getValue(v5,gl.layersOpacitiesToNumbersV2),t=Nn.getValue(b5,gl.layersVisibilitiesToBooleansV2);return e.map((i,r)=>t[r]?i:0).reverse()}}const Xxe=new Uxe;class Yxe{bootstrap(){this.restore();let e;e=Ss(()=>{this.persist(),e&&e()})}persist(){const e=oi(),{myMap:t}=xt(e);kt(t,(i,r)=>{r?.uuid!==i?.uuid&&(i?Nn.setValue(_S,i.uuid):Nn.removeItem(_S))},{immediate:!0})}restore(){const e=Nn.getValue(_S);e&&Ef().openMyMap(e)}}const Hxe=new Yxe;class Kxe{themeToThemeName(e){return e?.name||""}}const jxe=new Kxe;class $xe{bootstrap(){this.restore();let e;e=Ss(()=>{this.persist(),e&&e()})}persist(){const e=Vr();kt(()=>e.theme,(t,i)=>{i!==t&&t&&Nn.setValue(MC,t,jxe.themeToThemeName)},{immediate:!0})}restore(){const e=Nn.getValue(MC);if(e){const{setTheme:t}=Vr();t(e)}}}const Jxe=new $xe;N4();class qxe extends DW{geojsonFormatCustom=new Jl;encodeVectorStylePoint(e,t,i){let r;i instanceof Qs?r=this.encodeVectorStylePointStyleCircle(e,i):i instanceof Gu?r=this.encodeVectorStylePointStyleIcon(e,i):i instanceof vl&&(r=this.encodeVectorStylePointRegularShape(e,i)),r&&(this.customizer_.point(this.layerState_,e,r,i),t.push(r))}encodeVectorStylePointRegularShape(e,t){const i={type:"point"},r=t.getPoints(),o=t.getAngle();r===4&&o!==0?i.graphicName="square":r===4&&o===0?i.graphicName="cross":r===3?i.graphicName="triangle":r===5?i.graphicName="star":r===8&&(i.graphicName="cross");const s=t.getOpacity();s!==null&&(i.graphicOpacity=s);const l=t.getSize();if(l!==null){let m=t.getScale();Array.isArray(m)&&(m=(m[0]+m[1])/2),isNaN(m)&&(m=1),i.graphicWidth=l[1]*m}let u=t.getRotation();isNaN(u)&&(u=0),i.rotation=Kh(u);const h=t.getFill(),d=t.getStroke();return h!==null&&this.encodeVectorStyleFill(e,i,h),d!==null&&this.encodeVectorStyleStroke(e,i,d),i!==void 0&&i.graphicName==="cross"&&(i.strokeWidth=0,i.fillOpacity=1),i}encodeVectorStylePointStyleIcon(e,t){const i=t.getSrc();if(i===void 0)return;const r={type:"point",externalGraphic:i},o=t.getOpacity();o!==null&&(r.graphicOpacity=o);const s=t.getSize();if(s!==null){let u=t.getScale();Array.isArray(u)&&(u=(u[0]+u[1])/2),isNaN(u)&&(u=1);const h=s[0]*u,d=s[1]*u;r.graphicWidth=d,this.addGraphicOffset_(r,t,h,d)}let l=t.getRotation();return isNaN(l)&&(l=0),r.rotation=Kh(l),r.labelAlign&&(r.labelAlign="lm"),r.externalGraphic&&(r.graphicFormat="image/png",r.externalGraphic.indexOf("scale=")>0?delete r.graphicWidth:r.externalGraphic.indexOf("getarrow")>0&&(r.graphicWidth=10)),r}}const QO=127;class Qxe extends yye{async encodeLayerState(e,t,i){let r;const o=e.layer;if(o instanceof mM)r=this.encodeXYZLayer_(o.getXYZ());else if(o instanceof bo){r=new qxe(e,i).encodeVectorLayer(t);const s=e.layer.get("renderAsSvg");s!==void 0&&(r.renderAsSvg=s)}else r=await super.encodeLayerState(e,t,i);return Array.isArray(r)?r=r.map(s=>this.legacyMFPAppendCustomParams(o,s)):r&&(r=this.legacyMFPAppendCustomParams(o,r)),r}legacyMFPAppendCustomParams(e,t){return t?{...t,...e instanceof bo?{}:{customParams:{TRANSPARENT:!0,MAP_RESOLUTION:QO}}}:null}encodeXYZLayer_(e){const t=e.indexOf("/{z}/{x}/{y}"),i=e.lastIndexOf(".");if(t===-1||i===-1)return;const r=e.substring(0,t),o=e.substring(i+1),s=r.substring(r.lastIndexOf("/styles/")+8);return s==="topomap"||s==="roadmap"||s==="topomap_gray"?{baseURL:"https://wms.geoportail.lu/vectortiles_wms_4_print/service",imageFormat:"image/"+o,layers:[s],customParams:{TRANSPARENT:!0,MAP_RESOLUTION:QO},type:"wms",opacity:1,version:"1.1.1",useNativeAngle:!0}:{baseURL:r,type:"OSM",imageExtension:o}}}const p0="https://migration.geoportail.lu",eIe="https://migration.geoportail.lu/legends/get_html",tIe="https://migration.geoportail.lu/short/create",e3="https://migration.geoportail.lu/printproxy",nIe="https://migration.geoportail.lu/qr",iIe=[1500,2500,5e3,1e4,15e3,2e4,25e3,5e4,8e4,1e5,125e3,2e5,25e4,4e5],tE=[[715,395],[470,650],[1065,640],[715,975],[1558,985],[1064,1475],[2255,1482],[1558,2175],[3241,2173],[2254,3155]],nE=["A4 landscape","A4 portrait","A3 landscape","A3 portrait","A2 landscape","A2 portrait","A1 landscape","A1 portrait","A0 landscape","A0 portrait"],t3=127,rIe=(n,e,t)=>Math.round(e/qT/JT*n/t);class sIe{getScales(){return Vr().theme?.metadata?.print_scales?.map(t=>+t).sort((t,i)=>t-i)||iIe}getLayouts(){return nE}async print(e,t){const i=`${e3}/report.${t.toLocaleLowerCase()||"pdf"}`,o=await(await fetch(i,{method:"POST",body:JSON.stringify(e)})).json(),s=p0+o.statusURL.replace(/print/,"printproxy");return{downloadURL:p0+o.downloadURL.replace(/print/,"printproxy"),ref:o.ref,statusURL:s}}cancel(e){return fetch(`${e3}/cancel/${e}`,{method:"DELETE"})}async getJobStatus(e){const t=await(await fetch(e)).json();return t.downloadURL&&(t.downloadURL=p0+t.downloadURL.replace(/print/,"printproxy")),t}async getSpec(e,t){const i=new Qxe(p0),r=new tye,o=await this.getShortLink(),s=await i.encodeMap({map:t,scale:e.scale,printResolution:t.getView().getResolution(),dpi:t3,customizer:r});s.layers=s.layers.filter(d=>d!==null);const l=await this.getLegends(t.getLayers().getArray(),e.lang),u=[];return lz(t.getLayerGroup(),u,e.framestate),{attributes:{map:s,disclaimer:e.disclaimer,scaleTitle:e.scaleTitle,appTitle:e.appTitle,scale:e.scale,name:e.title,url:o,qrimage:`${nIe}?url=${o}`,lang:e.lang,legend:e.legend?l:null,scalebar:{geodetic:!0},dataOwner:[...new Set(u)].join(" "),dateText:e.dateText,queryResults:e.queryResults},format:e.format.toLowerCase(),layout:e.layout}}getLayersForPrint(e){return e.getLayers().getArray().filter(i=>i.get(BT)!==aW)}getSize(e){return tE[nE.indexOf(e)]}getNearestScale(e,t,i){const r=this.getScales(),o=tE[nE.indexOf(t)][0]||tE[0][0];return r.reverse().find(s=>rIe(s,o,i)<e)||r[0]}async getShortLink(){const t={url:p0+RB.getRelativeUrl()};return(await(await Vs(tIe,t,"POST")).json()).short_url}async getLegends(e,t){const i=[];let r=t3;const o=eIe;return e.reverse().forEach(s=>{const l=s.get("metadata"),u=l?.max_dpi;if(u!==void 0){const d=parseInt(u,10);r>d&&(r=d)}const h=l?.legend_name;if(h!==void 0)i.push({name:h});else{const d=s.get("queryable_id");if(l?.isExternalWms){const m=l?.legendUrl,y=l?.legendAccessConstraints,x=l?.legendTitle;m!==void 0&&i.push({name:null,legendUrl:m,accessConstraints:y,legendTitle:x})}else if(d!==void 0){const m=new URLSearchParams({lang:t,id:d,dpi:r.toString(),legend_title:s.get("label")});i.push({name:s.get("label"),restUrl:o+"?"+m.toString(),legendTitle:s.get("label")})}}}),i}}function lz(n,e,t){if(n instanceof wf)n.getLayers().forEach(i=>lz(i,e,t));else{const i=n.getSource()?.getAttributions(),r=n.get("metadata")?.attribution,o=[];i&&o.push(...i(t)),r&&o.push(r),e.push(...o)}}const sf=new sIe,oIe=1e3;function aIe(n){return typeof n=="number"&&n>=400&&n<=500||n==="error"}function lIe(){const n=Ke(null),e=Ke(null),t=Ke(!1),i=Ke(!1);let r=null;const o=async u=>{try{const{status:h,done:d,downloadURL:m}=await sf.getJobStatus(u);n.value=h,aIe(h)&&(t.value=!0,l()),h==="finished"&&d&&m&&(e.value=m,l())}catch{l()}},s=(u,h=oIe)=>{t.value=!1,l(),i.value=!0,r=window.setInterval(()=>o(u),h)},l=()=>{r!==null&&(clearInterval(r),r=null),n.value=null,i.value=!1,t.value=!1};return Ds(()=>l()),{jobStatus:n,url:e,startPolling:s,clearPolling:l,error:t,loading:i}}function uIe(){const{t:n}=Ct(),{featureInfoPrintableRef:e,locationInfoPrintableRef:t}=xt(Tk()),{locationInfoCoords:i}=xt(rg()),{startPolling:r,clearPolling:o,url:s,error:l,loading:u}=lIe(),h=Kn().getOlMap(),d=Ke(null);async function m(T){const M=y(),G={disclaimer:n(`www.geoportail.lu est un portail d'accs aux informations golocalises, donnes et services qui sont mis  disposition par les administrations publiques luxembourgeoises. Responsabilit: Malgr la grande attention quelles portent  la justesse des informations diffuses sur ce site, les autorits ne peuvent endosser aucune responsabilit quant  la fidlit,  lexactitude,  lactualit,  la fiabilit et  lintgralit de ces informations. Information dpourvue de foi publique. 
Droits d'auteur: Administration du Cadastre et de la Topographie. http://g-o.lu/copyright`),scaleTitle:n("Echelle approximative 1:"),appTitle:n("Le goportail national du Grand-Duch du Luxembourg",{ns:"app"}),dateText:n("Date d'impression:"),queryResults:M,...T},N=await sf.getSpec(G,h);try{const V=await sf.print(N,T.format);d.value=V.ref,r(V.statusURL)}catch{d.value=null,l.value=!0,o()}}function y(){const T=C(),M=w();return`${T??""}${M??""}`||void 0}async function x(){d.value&&(await sf.cancel(d.value),d.value=null,o())}function C(){if(!(!i.value||!t.value))return S(t.value)}function w(){if(!(i.value||!e.value))return S(e.value)}function S(T){const M=T.cloneNode(!0);return M.querySelectorAll("[data-cy], [v-]").forEach(V=>{V.removeAttribute("data-cy"),V.removeAttribute("v-")}),M.querySelectorAll(".no-print").forEach(V=>V.remove()),M.innerHTML}return{print:m,abortPrint:x,url:s,error:l,loading:u}}var lR=(n=>(n.PDF="PDF",n.PNG="PNG",n))(lR||{});const cIe={"data-cy":"toolbarPrint"},hIe={class:"absolute bottom-full top-auto z-20 flex flex-col divide-gray-400 divide-solid box-content border-y border-x border-gray-400 bg-primary md:w-64 p-3 gap-3"},dIe={class:"md:w-full"},fIe=["placeholder"],pIe={class:"flex gap-1 items-center"},gIe=["id"],mIe=["for"],yIe={class:"flex gap-1 items-center secondary-button"},_Ie={class:"md:w-1/2"},vIe={class:"md:w-1/2"},bIe={class:"flex gap-1 justify-end items-center"},xIe={key:0,"data-cy":"printLoading",class:"mr-4 flex gap-2 items-center"},IIe=["disabled"],CIe=["disabled"],wIe=2e3,AIe=st({__name:"toolbar-print",setup(n){const{addNotification:e}=ns(),{t}=Ct(),{lang:i}=oi(),{print:r,abortPrint:o,url:s,error:l,loading:u}=uIe(),h=Zv();let d=null;const m=Kn().getOlMap(),y=new _ye({id:"mask",opacity:0});y.setZIndex(wIe);const x=Ke(""),C=Ke(!1),w=At(()=>!C.value),S=Ke(""),T=At(()=>sf.getLayouts().map(J=>({label:t(J),value:J,ariaLabel:t("Change layout:",{ns:"app"})}))),M=J=>{S.value=J,G.value=J,y.setSize(sf.getSize(J)),m.render()},G=Ke(""),N=Ke(""),V=At(()=>sf.getScales().map(J=>({label:`1 : ${J.toLocaleString()}`,value:J.toString(),ariaLabel:t("Change scale:",{ns:"app"})}))),W=J=>{N.value=J,y.setScale(parseInt(J,10)),m.render()};function j(J){r({format:J,layout:S.value,scale:parseInt(N.value,10),resolution:m.getView().getResolution(),title:x.value,legend:C.value,lang:i,framestate:d})}return kt(l,J=>{J&&e(t("An error occurred while printing"),mi.ERROR)}),kt(s,J=>J&&window.open(J,"_blank")),gr(()=>{m.addLayer(y),y.setOpacity(.5),m.on("rendercomplete",J=>{d=J.frameState||null}),M(T.value[0].value),W(sf.getNearestScale(m.getSize()[0],S.value,m.getView().getResolution()).toString())}),Ds(()=>{m.removeLayer(y),y.setOpacity(0)}),(J,te)=>(U(),oe("div",cIe,[P("div",hIe,[P("div",dIe,[Sn(P("input",{class:"cursor-pointer w-full p-2 lux-input",type:"text","onUpdate:modelValue":te[0]||(te[0]=ce=>x.value=ce),placeholder:k(t)("Title",{ns:"client"}),"data-cy":"printTitle"},null,8,fIe),[[Zr,x.value]])]),P("div",pIe,[Sn(P("input",{id:k(h),class:"hover:cursor-pointer",type:"checkbox","onUpdate:modelValue":te[1]||(te[1]=ce=>C.value=ce),"data-cy":"printWithLegend"},null,8,gIe),[[Yh,C.value]]),P("label",{class:"font-bold block lux-text-default hover:cursor-pointer",for:k(h)},K(k(t)("Avec lgende")),9,mIe)]),P("div",yIe,[P("div",_Ie,[mt(eg,{"data-cy":"printLayouts",class:"w-full",options:T.value,modelValue:S.value,"onUpdate:modelValue":te[2]||(te[2]=ce=>S.value=ce),onChange:M,direction:"up"},null,8,["options","modelValue"])]),P("div",vIe,[mt(eg,{"data-cy":"printScales",class:"w-full",options:V.value,modelValue:N.value,"onUpdate:modelValue":te[3]||(te[3]=ce=>N.value=ce),onChange:W,direction:"up"},null,8,["options","modelValue"])])]),P("div",bIe,[k(u)?(U(),oe("div",xIe,[te[7]||(te[7]=P("span",{class:"text-black fa-solid fa-arrows-rotate animate-spin","aria-hidden":"true"},null,-1)),P("button",{class:"btn btn-link opacity-75 text-white hover:underline hover:opacity-100",onClick:te[4]||(te[4]=ce=>k(o)())},K(k(t)("Abort")),1)])):Ge("",!0),P("button",{"data-cy":"printPng",class:"bg-white disabled:opacity-75 disabled:cursor-not-allowed text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5",onClick:te[5]||(te[5]=ce=>j(k(lR).PNG)),disabled:k(u)||!w.value},K(k(t)("PNG")),9,IIe),P("button",{"data-cy":"printPdf",class:"bg-white disabled:opacity-75 disabled:cursor-not-allowed text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5",onClick:te[6]||(te[6]=ce=>j(k(lR).PDF)),disabled:k(u)},K(k(t)("PDF")),9,CIe)])])]))}}),SIe=is(AIe,[["__scopeId","data-v-9820d18c"]]),EIe={class:"flex flex-col gap-3"},TIe={class:"md:w-full"},RIe={for:"share-url-input",class:"block text-white text-sm font-medium mb-2"},MIe=["value","aria-label"],kIe=["value","aria-label"],LIe={class:"flex gap-1 items-center"},PIe={for:"show-long-url-checkbox",class:"font-bold block lux-text-default hover:cursor-pointer"},GIe={key:0,class:"flex gap-1 items-center"},FIe={for:"only-mymaps-checkbox",class:"font-bold block lux-text-default hover:cursor-pointer"},OIe=st({__name:"share-url",setup(n){const{t:e}=Ct(),t=oi(),{myMapId:i,shareOpen:r}=xt(t),o=Ke(""),s=Ke(""),l=Ke(!1),u=Ke(!1);let h=null,d="";function m(T){if(u.value&&i.value){const M=new URL(T);return M.search=`?map_id=${i.value}`,M.toString()}return T}async function y(){const T=jl.getStrippedUrl(),M=m(T.toString());s.value=M,d=M;try{if(u.value&&i.value){const G=new URLSearchParams;G.set("url",M);const V=await(await fetch("https://migration.geoportail.lu/short/create",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:G.toString()})).json();o.value=V.short_url}else{const G=await jl.getShortUrl(void 0);o.value=G.short_url}}catch{o.value=M}}function x(T){T.target.select()}function C(){h!==null&&clearInterval(h),h=setInterval(()=>{const T=jl.getStrippedUrl().toString(),M=m(T);d!==M&&y()},500)}function w(){h!==null&&(clearInterval(h),h=null)}kt(u,()=>{r.value&&y()}),kt(r,T=>{T?(y(),C()):w()},{immediate:!0}),Ds(()=>{w()});const S=()=>!!i.value;return(T,M)=>(U(),oe("div",EIe,[P("div",TIe,[P("label",RIe,K(k(e)("Short Url",{ns:"client"})),1),l.value?(U(),oe("input",{key:1,id:"share-url-input",type:"text",class:"w-full px-3 py-2 lux-input cursor-pointer",value:s.value,"aria-label":k(e)("Long Url",{ns:"client"}),onClick:x,readonly:"","data-cy":"shareLongUrl"},null,8,kIe)):(U(),oe("input",{key:0,id:"share-url-input",type:"text",class:"w-full px-3 py-2 lux-input cursor-pointer",value:o.value,"aria-label":k(e)("Short Url",{ns:"client"}),onClick:x,readonly:"","data-cy":"shareShortUrl"},null,8,MIe))]),P("div",LIe,[Sn(P("input",{id:"show-long-url-checkbox",type:"checkbox","onUpdate:modelValue":M[0]||(M[0]=G=>l.value=G),class:"hover:cursor-pointer","data-cy":"showLongUrlCheckbox"},null,512),[[Yh,l.value]]),P("label",PIe,K(k(e)("Show long url",{ns:"client"})),1)]),S()?(U(),oe("div",GIe,[Sn(P("input",{id:"only-mymaps-checkbox",type:"checkbox","onUpdate:modelValue":M[1]||(M[1]=G=>u.value=G),class:"hover:cursor-pointer","data-cy":"onlyMymapsCheckbox"},null,512),[[Yh,u.value]]),P("label",FIe,K(k(e)("Share only Mymaps",{ns:"client"})),1)])):Ge("",!0)]))}}),NIe={class:"md:w-full"},DIe={for:"embed-code-input",class:"block text-white text-sm font-medium mb-2"},VIe={class:"flex gap-2"},BIe=["value","aria-label"],ZIe=["aria-label"],WIe={class:"flex justify-between items-center p-4 border-b"},zIe={id:"modal-title",class:"text-xl font-semibold"},UIe=["aria-label"],XIe={class:"p-4 space-y-4"},YIe={for:"iframe-size-select",class:"sr-only"},HIe=["aria-label"],KIe={value:"small"},jIe={value:"medium"},$Ie={value:"large"},JIe={value:"custom"},qIe={key:0,class:"flex gap-2 items-center"},QIe={class:"border border-gray-300 overflow-auto"},eCe=["src","width","height","title"],tCe={class:"flex gap-2"},nCe={for:"iframe-code-input",class:"sr-only"},iCe=["value","aria-label"],rCe=["aria-label"],sCe=st({__name:"share-embed",setup(n){const{t:e}=Ct(),t=Ke(!1),i=Ke("small"),r=Ke(800),o=Ke(600),s=Ke(null),l={small:[400,300],medium:[600,450],large:[800,600],custom:[800,600]},u=At(()=>i.value==="custom"?r.value:l[i.value][0]),h=At(()=>i.value==="custom"?o.value:l[i.value][1]),d=At(()=>{const M=new URL(window.location.href);return M.searchParams.set("embedded","true"),M.href}),m=At(()=>`<iframe src="${d.value}" width="${u.value}" height="${h.value}" frameborder="0" style="border:0"></iframe>`),y=At(()=>`${u.value+48}px`);function x(M){M.target.select()}function C(){t.value=!0}function w(){t.value=!1}function S(){navigator.clipboard.writeText(m.value)}function T(M){if(!t.value||!s.value)return;const G=s.value.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),N=G[0],V=G[G.length-1];M.key==="Tab"?M.shiftKey&&document.activeElement===N?(M.preventDefault(),V.focus()):!M.shiftKey&&document.activeElement===V&&(M.preventDefault(),N.focus()):M.key==="Escape"&&w()}return kt(t,M=>{M?document.addEventListener("keydown",T):document.removeEventListener("keydown",T)}),Ds(()=>{document.removeEventListener("keydown",T)}),(M,G)=>(U(),oe("div",null,[P("div",NIe,[P("label",DIe,K(k(e)("Integrate",{ns:"client"})),1),P("div",VIe,[P("input",{id:"embed-code-input",type:"text",class:"flex-1 px-3 py-2 lux-input cursor-pointer",value:m.value,"aria-label":k(e)("Integrate",{ns:"client"}),onClick:x,readonly:"","data-cy":"embedCodeInput"},null,8,BIe),P("button",{onClick:C,class:"bg-white disabled:opacity-75 disabled:cursor-not-allowed text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5","aria-label":k(e)("Preview",{ns:"client"}),"data-cy":"previewButton"},K(k(e)("Preview",{ns:"client"})),9,ZIe)])]),t.value?(U(),oe("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",onClick:fs(w,["self"]),"data-cy":"iframePreviewModal"},[P("div",{ref_key:"modalRef",ref:s,class:"bg-white rounded-lg shadow-xl mx-4 max-h-[90vh] overflow-auto",style:Dc({width:y.value,maxWidth:"90vw"})},[P("div",WIe,[P("h2",zIe,K(k(e)("Embed map",{ns:"app"})),1),P("button",{onClick:w,class:"text-gray-500 hover:text-gray-700 text-2xl leading-none","aria-label":k(e)("Close",{ns:"app"}),"data-cy":"closePreviewButton"},"  ",8,UIe)]),P("div",XIe,[P("div",null,[P("label",YIe,K(k(e)("Select iframe size",{ns:"client"})),1),Sn(P("select",{id:"iframe-size-select","onUpdate:modelValue":G[0]||(G[0]=N=>i.value=N),class:"w-full px-3 py-2 border border-gray-300 rounded","aria-label":k(e)("Select iframe size",{ns:"client"}),"data-cy":"iframeSizeSelect"},[P("option",KIe,K(k(e)("small",{ns:"app"})),1),P("option",jIe,K(k(e)("medium",{ns:"app"})),1),P("option",$Ie,K(k(e)("large",{ns:"app"})),1),P("option",JIe,K(k(e)("custom",{ns:"app"})),1)],8,HIe),[[DN,i.value]])]),i.value==="custom"?(U(),oe("div",qIe,[G[3]||(G[3]=P("label",{for:"custom-width-input",class:"sr-only"},"Width",-1)),Sn(P("input",{id:"custom-width-input",type:"number","onUpdate:modelValue":G[1]||(G[1]=N=>r.value=N),min:"0",class:"w-24 px-3 py-2 border border-gray-300 rounded","aria-label":"Custom width","data-cy":"customWidthInput"},null,512),[[Zr,r.value,void 0,{number:!0}]]),G[4]||(G[4]=P("span",{"aria-hidden":"true"},"X",-1)),G[5]||(G[5]=P("label",{for:"custom-height-input",class:"sr-only"},"Height",-1)),Sn(P("input",{id:"custom-height-input",type:"number","onUpdate:modelValue":G[2]||(G[2]=N=>o.value=N),min:"0",class:"w-24 px-3 py-2 border border-gray-300 rounded","aria-label":"Custom height","data-cy":"customHeightInput"},null,512),[[Zr,o.value,void 0,{number:!0}]])])):Ge("",!0),P("div",QIe,[P("iframe",{src:d.value,width:u.value,height:h.value,frameborder:"0",style:{border:"0"},title:k(e)("Embed map preview",{ns:"client"}),"data-cy":"iframePreview"},null,8,eCe)]),P("div",tCe,[P("label",nCe,K(k(e)("Iframe code",{ns:"client"})),1),P("input",{id:"iframe-code-input",type:"text",value:m.value,onClick:x,readonly:"",class:"flex-1 px-3 py-2 border border-gray-300 rounded cursor-pointer","aria-label":k(e)("Iframe code",{ns:"client"}),"data-cy":"iframeCodeInput"},null,8,iCe),P("button",{onClick:S,class:"bg-white disabled:opacity-75 disabled:cursor-not-allowed text-primary hover:bg-primary hover:text-white border border-slate-300 py-1.5 px-2.5","aria-label":k(e)("Copy",{ns:"client"}),"data-cy":"copyIframeCodeButton"},K(k(e)("Copy",{ns:"client"})),9,rCe)])])],4)])):Ge("",!0)]))}}),oCe={"data-cy":"sharePanel"},aCe={class:"absolute bottom-full top-auto z-20 flex flex-col divide-gray-400 divide-solid box-content border-y border-x border-gray-400 bg-primary md:w-80 p-3 gap-3"},lCe=st({__name:"share-panel",setup(n){return(e,t)=>(U(),oe("div",oCe,[P("div",aCe,[mt(OIe),mt(sCe)])]))}}),uCe={class:"flex flex-col w-12 justify-between bg-white z-5 shrink-0 sm:flex-row sm:w-full sm:h-14 sm:shadow-footer"},cCe={class:"flex flex-col w-full sm:w-80 sm:flex-row justify-start text-primary divide-y sm:divide-y-0 sm:divide-x divide-gray-400 divide-solid box-content border-y sm:border-y-0 border-x border-gray-400"},hCe={"data-cy":"layersOpenClose"},dCe={"data-cy":"mymapsOpenClose"},fCe={key:0,"data-cy":"infoOpenClose"},pCe={key:1,"data-cy":"legendsOpenClose"},gCe={key:2},mCe={key:0,class:"hidden sm:block sm:flex-grow"},yCe={key:1,class:"hidden sm:block sm:flex-grow"},_Ce={key:2,class:"w-[466px] hidden sm:flex flex-row justify-end text-gray-500 whitespace-nowrap"},vCe=["aria-pressed","aria-label"],bCe=st({__name:"footer-bar",setup(n){const{t:e,i18next:t}=Ct(),i=oi(),r=Jr(),o="https://geocatalogue.geoportail.lu/geonetwork/srv",{setLayersOpen:s,togglePrintToolbarOpen:l,toggleDrawToolbarOpen:u,toggleMyMapsOpen:h,toggleLegendsOpen:d,toggleInfoOpen:m,toggleShareOpen:y,toggleFeedbackOpen:x}=i,{layersOpen:C,legendsOpen:w,drawToolbarOpen:S,measureToolbarOpen:T,elevationProfileToolbarOpen:M,styleEditorOpen:G,myMapLayersChanged:N,myMapsOpen:V,infoOpen:W,shareOpen:j,lidarOpen:J,themeGridOpen:te,printToolbarOpen:ce,feedbackOpen:pe,isOffLine:Y}=xt(i),{setEditActiveState:he}=r;function D(){const we=!C.value;s(we),we&&(G.value=!1,V.value=!1,W.value=!1,J.value=!1),te.value=!1}kt(S,we=>{we?(T.value=!1,M.value=!1,ce.value=!1,j.value=!1,J.value=!1):he(void 0)}),kt(T,we=>{we&&(S.value=!1,M.value=!1,ce.value=!1,j.value=!1,J.value=!1)}),kt(M,we=>{we&&(S.value=!1,T.value=!1,ce.value=!1,j.value=!1,J.value=!1)}),kt(ce,we=>{we&&(S.value=!1,T.value=!1,M.value=!1,j.value=!1,J.value=!1)}),kt(j,we=>{we&&(S.value=!1,T.value=!1,M.value=!1,ce.value=!1,J.value=!1)}),kt(J,we=>{we&&(C.value=w.value=te.value=ce.value=S.value=T.value=M.value=j.value=G.value=V.value=W.value=!1)});const re=tg(),{displayStarOnMobile:le}=xt(re),{setDisplayStarOnMobile:fe}=re;function Le(){m(),fe(!1)}return(we,se)=>(U(),oe("footer",uCe,[P("ul",cCe,[P("li",hCe,[mt(vh,{label:k(e)("layers",{ns:"client"}),"aria-label":k(C)?k(e)("Close layers panel"):k(e)("Open layers panel to browse and add map layers"),icon:"layers",active:k(C),onClick:D},null,8,["label","aria-label","active"])]),P("li",dCe,[mt(vh,{label:k(e)("my_maps",{ns:"client"})+(k(N)?"(*)":""),"aria-label":k(V)?k(e)("Close my maps panel"):k(e)("Open my maps panel to access saved maps"),icon:"mymaps",active:k(V),onClick:se[0]||(se[0]=()=>k(h)())},null,8,["label","aria-label","active"])]),k(Y)?Ge("",!0):(U(),oe("li",fCe,[mt(vh,{label:`${k(e)("Infos",{ns:"client"})}${k(le)?"(*)":""}`,"aria-label":k(W)?k(e)("Close feature info panel"):k(e)("Open feature info panel to view map details"),icon:"infos",active:k(W),onClick:Le},null,8,["label","aria-label","active"])])),k(Y)?Ge("",!0):(U(),oe("li",pCe,[mt(vh,{label:k(e)("Legends",{ns:"client"}),"aria-label":k(w)?k(e)("Close legends panel"):k(e)("Open legends panel"),icon:"legends",active:k(w),onClick:se[1]||(se[1]=()=>k(d)())},null,8,["label","aria-label","active"])])),k(Y)?Ge("",!0):(U(),oe("li",gCe,[mt(vh,{class:"text-gray-300",label:k(e)("Routing",{ns:"client"}),"aria-label":k(e)("Routing tool - not yet implemented"),icon:"routing"},null,8,["label","aria-label"])]))]),k(Y)?(U(),oe("div",mCe)):Ge("",!0),P("div",{class:Dn(["relative flex flex-col w-12 sm:flex-row justify-start text-primary divide-y sm:divide-y-0 sm:divide-x divide-gray-400 divide-solid box-content border-y sm:border-y-0 border-x border-gray-400",k(Y)?"sm:w-16":"sm:w-64"])},[k(S)?(U(),Mt(wle,{key:0})):Ge("",!0),k(ce)?(U(),Mt(SIe,{key:1})):Ge("",!0),k(j)?(U(),Mt(lCe,{key:2})):Ge("",!0),k(M)?(U(),Mt(eye,{key:3})):Ge("",!0),mt(vh,{label:k(e)("Dessin",{ns:"client"}),"aria-label":k(S)?k(e)("Close drawing toolbar"):k(e)("Open drawing toolbar to draw on the map"),icon:"draw",active:k(S),onClick:se[2]||(se[2]=()=>k(u)()),"data-cy":"drawButton"},null,8,["label","aria-label","active"]),k(Y)?Ge("",!0):(U(),oe(Et,{key:4},[k(T)?(U(),Mt(Ple,{key:0})):Ge("",!0),mt(vh,{label:k(e)("Mesurer",{ns:"client"}),"aria-label":k(T)?k(e)("Close measure toolbar"):k(e)("Open measure toolbar to measure distances and areas"),active:k(T),icon:"measure",onClick:se[3]||(se[3]=()=>T.value=!k(T))},null,8,["label","aria-label","active"])],64)),k(Y)?Ge("",!0):(U(),Mt(vh,{key:5,class:"hidden sm:block",label:k(e)("Imprimer",{ns:"client"}),"aria-label":k(ce)?k(e)("Close print toolbar"):k(e)("Open print toolbar to create a PDF of the map"),active:k(ce),onClick:se[4]||(se[4]=()=>k(l)()),icon:"print","data-cy":"printButton"},null,8,["label","aria-label","active"])),k(Y)?Ge("",!0):(U(),Mt(vh,{key:6,label:k(e)("Partager",{ns:"client"}),"aria-label":k(j)?k(e)("Close share panel"):k(e)("Open share panel to create a shareable link"),active:k(j),icon:"share",onClick:se[5]||(se[5]=()=>k(y)()),"data-cy":"shareButton"},null,8,["label","aria-label","active"]))],2),k(Y)?(U(),oe("div",yCe)):(U(),oe("div",_Ce,[mt(mp,{class:"hidden lg:flex text-gray-500",label:k(e)("What's new",{ns:"client"}),link:`https://geoportail.lu/${k(t).language}/questions/whats-new/`},null,8,["label","link"]),mt(mp,{class:"hidden lg:flex text-gray-500",label:k(e)("Geocatalogue",{ns:"client"}),link:k(o)},null,8,["label","link"]),P("button",{class:Dn(["hidden lg:flex h-full flex-col justify-center px-[7px] uppercase hover:text-white hover:bg-primary text-gray-500",{"bg-primary text-white":k(pe)}]),"aria-pressed":k(pe)?"true":"false","aria-label":k(e)("Feedback",{ns:"client"}),onClick:se[6]||(se[6]=()=>k(x)()),"data-cy":"feedbackButton"},K(k(e)("Feedback",{ns:"client"})),11,vCe),mt(mp,{class:"hidden lg:flex text-gray-500",label:k(e)("A Propos",{ns:"client"}),link:`https://www.geoportail.lu/${k(t).language}/propos/`},null,8,["label","link"]),mt(mp,{class:"hidden lg:flex text-gray-500",label:k(e)("Aide",{ns:"client"}),link:`https://www.geoportail.lu/${k(t).language}/documentation/`},null,8,["label","link"]),mt(mp,{class:"hidden lg:flex text-gray-500",label:k(e)("Contact",{ns:"client"}),link:`https://www.geoportail.lu/${k(t).language}/propos/contactez-nous/`},null,8,["label","link"]),mt(mp,{class:"text-gray-500",label:k(e)("Legalites",{ns:"client"}),link:`https://www.geoportail.lu/${k(t).language}/propos/mentions-legales/`},null,8,["label","link"]),mt(mp,{class:"text-gray-500",label:k(e)("ACT",{ns:"client"}),link:"http://www.act.public.lu/"},null,8,["label"])]))]))}}),tb=Sa("lidar",()=>{const n=Ke(!1),e=Ke(!1),t=Ke(5),i=Ke(null);return{drawLidarActive:n,profileWidth:t,currentProfileFeature:i,lidarConfig:{clientConfig:{autoWidth:!0,margin:{left:40,top:10,right:0,bottom:40},pointAttributes:{},pointSum:0,tolerance:5},serverConfig:{classification_colors:{1:{color:"120, 120, 120",name:{fr:"points non classifis",en:"unclassified points",de:"nicht klassifizierte Punkte",lb:"onklassiert Punkten"},value:"unclassified points",visible:1},2:{color:"160, 82, 40",name:{fr:"sol",en:"ground",de:"Boden",lb:"Buedem"},value:"ground",visible:1},3:{color:"0, 240, 0",name:{fr:"vgtation basse",en:"low vegetation",de:"niedrige Vegetation",lb:"niddereg Vegetatioun"},value:"low vegetation",visible:1},4:{color:"0, 204, 0",name:{fr:"vgtation moyenne",en:"average vegetation",de:"mittlere Vegetation",lb:"mttel Vegetatioun"},value:"average vegetation",visible:1},5:{color:"0, 150, 0",name:{fr:"vgtation haute",en:"high vegetation",de:"hohe Vegetation",lb:"hich Vegetatioun"},value:"high vegetation",visible:1},6:{color:"255, 170, 0",name:{fr:"btiments",en:"buildings",de:"Gebude",lb:"Gebai"},value:"buildings",visible:1},7:{color:"0, 0, 0",name:{fr:"points bas (bruit)",en:"low points (noise)",de:"niedrige Punkte",lb:"niddereg Punkten"},value:"low points (noise)",visible:1},9:{color:"60, 130, 250",name:{fr:"eau",en:"water",de:"Wasser",lb:"Waasser"},value:"water",visible:1},13:{color:"255, 0, 0",name:{fr:"ponts, passerelles, viaducs",en:"bridges",de:"Brcken",lb:"Brcke"},value:"bridges",visible:1},15:{color:"255, 255, 0",name:{fr:"lignes  haute tension",en:"high voltage lines",de:"Hochspannungsleitung",lb:"hich Volt Linn"},value:"high voltage lines",visible:1}},debug:!1,default_attribute:"CLASSIFICATION",default_color:"RGB(250,150,150)",default_point_attribute:"CLASSIFICATION",default_point_cloud:"luxembourg",initialLOD:10,max_levels:{25:{max:14,width:2},50:{max:13,width:2},75:{max:13,width:3},100:{max:12,width:3},150:{max:12,width:4},250:{max:11,width:4},350:{max:11,width:4},500:{max:10,width:5},1e3:{max:10,width:5},5e3:{max:9,width:6},7500:{max:9,width:6},1e5:{max:9,width:7}},max_point_number:15e4,minLOD:0,point_attributes:{CLASSIFICATION:{bytes:1,elements:1,name:"Classification",value:"CLASSIFICATION",visible:1},COLOR_PACKED:{bytes:4,elements:4,name:"Couleur",value:"COLOR_PACKED",visible:1},INTENSITY:{bytes:2,element:1,name:"Intensit",value:"INTENSITY",visible:1},POSITION_CARTESIAN:{bytes:12,elements:3,name:"Position-cartesian",value:"POSITION_CARTESIAN",visible:0},POSITION_PROJECTED_PROFILE:{bytes:8,elements:2,name:"Position-projected",value:"POSITION_PROJECTED_PROFILE",visible:0},RGB:{bytes:3,elements:4,name:"Couleur",value:"RGBA",visible:0}},point_size:1,width:10}},measureActive:e}}),uR={capture:!0,passive:!1};function cR(n){n.preventDefault(),n.stopImmediatePropagation()}function xCe(n){var e=n.document.documentElement,t=ta(n).on("dragstart.drag",cR,uR);"onselectstart"in e?t.on("selectstart.drag",cR,uR):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function ICe(n,e){var t=n.document.documentElement,i=ta(n).on("dragstart.drag",null);e&&(i.on("click.drag",cR,uR),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in t?i.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const Kx=n=>()=>n;function CCe(n,{sourceEvent:e,target:t,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function kh(n,e,t){this.k=n,this.x=e,this.y=t}kh.prototype={constructor:kh,scale:function(n){return n===1?this:new kh(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new kh(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var uz=new kh(1,0,0);kh.prototype;function iE(n){n.stopImmediatePropagation()}function g0(n){n.preventDefault(),n.stopImmediatePropagation()}function wCe(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function ACe(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function n3(){return this.__zoom||uz}function SCe(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function ECe(){return navigator.maxTouchPoints||"ontouchstart"in this}function TCe(n,e,t){var i=n.invertX(e[0][0])-t[0][0],r=n.invertX(e[1][0])-t[1][0],o=n.invertY(e[0][1])-t[0][1],s=n.invertY(e[1][1])-t[1][1];return n.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function RCe(){var n=wCe,e=ACe,t=TCe,i=SCe,r=ECe,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],l=250,u=the,h=sk("start","zoom","end"),d,m,y,x=500,C=150,w=0,S=10;function T(D){D.property("__zoom",n3).on("wheel.zoom",J,{passive:!1}).on("mousedown.zoom",te).on("dblclick.zoom",ce).filter(r).on("touchstart.zoom",pe).on("touchmove.zoom",Y).on("touchend.zoom touchcancel.zoom",he).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}T.transform=function(D,re,le,fe){var Le=D.selection?D.selection():D;Le.property("__zoom",n3),D!==Le?V(D,re,le,fe):Le.interrupt().each(function(){W(this,arguments).event(fe).start().zoom(null,typeof re=="function"?re.apply(this,arguments):re).end()})},T.scaleBy=function(D,re,le,fe){T.scaleTo(D,function(){var Le=this.__zoom.k,we=typeof re=="function"?re.apply(this,arguments):re;return Le*we},le,fe)},T.scaleTo=function(D,re,le,fe){T.transform(D,function(){var Le=e.apply(this,arguments),we=this.__zoom,se=le==null?N(Le):typeof le=="function"?le.apply(this,arguments):le,Q=we.invert(se),q=typeof re=="function"?re.apply(this,arguments):re;return t(G(M(we,q),se,Q),Le,s)},le,fe)},T.translateBy=function(D,re,le,fe){T.transform(D,function(){return t(this.__zoom.translate(typeof re=="function"?re.apply(this,arguments):re,typeof le=="function"?le.apply(this,arguments):le),e.apply(this,arguments),s)},null,fe)},T.translateTo=function(D,re,le,fe,Le){T.transform(D,function(){var we=e.apply(this,arguments),se=this.__zoom,Q=fe==null?N(we):typeof fe=="function"?fe.apply(this,arguments):fe;return t(uz.translate(Q[0],Q[1]).scale(se.k).translate(typeof re=="function"?-re.apply(this,arguments):-re,typeof le=="function"?-le.apply(this,arguments):-le),we,s)},fe,Le)};function M(D,re){return re=Math.max(o[0],Math.min(o[1],re)),re===D.k?D:new kh(re,D.x,D.y)}function G(D,re,le){var fe=re[0]-le[0]*D.k,Le=re[1]-le[1]*D.k;return fe===D.x&&Le===D.y?D:new kh(D.k,fe,Le)}function N(D){return[(+D[0][0]+ +D[1][0])/2,(+D[0][1]+ +D[1][1])/2]}function V(D,re,le,fe){D.on("start.zoom",function(){W(this,arguments).event(fe).start()}).on("interrupt.zoom end.zoom",function(){W(this,arguments).event(fe).end()}).tween("zoom",function(){var Le=this,we=arguments,se=W(Le,we).event(fe),Q=e.apply(Le,we),q=le==null?N(Q):typeof le=="function"?le.apply(Le,we):le,$e=Math.max(Q[1][0]-Q[0][0],Q[1][1]-Q[0][1]),Qe=Le.__zoom,qe=typeof re=="function"?re.apply(Le,we):re,Lt=u(Qe.invert(q).concat($e/Qe.k),qe.invert(q).concat($e/qe.k));return function(Pt){if(Pt===1)Pt=qe;else{var zt=Lt(Pt),Dt=$e/zt[2];Pt=new kh(Dt,q[0]-zt[0]*Dt,q[1]-zt[1]*Dt)}se.zoom(null,Pt)}})}function W(D,re,le){return!le&&D.__zooming||new j(D,re)}function j(D,re){this.that=D,this.args=re,this.active=0,this.sourceEvent=null,this.extent=e.apply(D,re),this.taps=0}j.prototype={event:function(D){return D&&(this.sourceEvent=D),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(D,re){return this.mouse&&D!=="mouse"&&(this.mouse[1]=re.invert(this.mouse[0])),this.touch0&&D!=="touch"&&(this.touch0[1]=re.invert(this.touch0[0])),this.touch1&&D!=="touch"&&(this.touch1[1]=re.invert(this.touch1[0])),this.that.__zoom=re,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(D){var re=ta(this.that).datum();h.call(D,this.that,new CCe(D,{sourceEvent:this.sourceEvent,target:T,transform:this.that.__zoom,dispatch:h}),re)}};function J(D,...re){if(!n.apply(this,arguments))return;var le=W(this,re).event(D),fe=this.__zoom,Le=Math.max(o[0],Math.min(o[1],fe.k*Math.pow(2,i.apply(this,arguments)))),we=yu(D);if(le.wheel)(le.mouse[0][0]!==we[0]||le.mouse[0][1]!==we[1])&&(le.mouse[1]=fe.invert(le.mouse[0]=we)),clearTimeout(le.wheel);else{if(fe.k===Le)return;le.mouse=[we,fe.invert(we)],II(this),le.start()}g0(D),le.wheel=setTimeout(se,C),le.zoom("mouse",t(G(M(fe,Le),le.mouse[0],le.mouse[1]),le.extent,s));function se(){le.wheel=null,le.end()}}function te(D,...re){if(y||!n.apply(this,arguments))return;var le=D.currentTarget,fe=W(this,re,!0).event(D),Le=ta(D.view).on("mousemove.zoom",q,!0).on("mouseup.zoom",$e,!0),we=yu(D,le),se=D.clientX,Q=D.clientY;xCe(D.view),iE(D),fe.mouse=[we,this.__zoom.invert(we)],II(this),fe.start();function q(Qe){if(g0(Qe),!fe.moved){var qe=Qe.clientX-se,Lt=Qe.clientY-Q;fe.moved=qe*qe+Lt*Lt>w}fe.event(Qe).zoom("mouse",t(G(fe.that.__zoom,fe.mouse[0]=yu(Qe,le),fe.mouse[1]),fe.extent,s))}function $e(Qe){Le.on("mousemove.zoom mouseup.zoom",null),ICe(Qe.view,fe.moved),g0(Qe),fe.event(Qe).end()}}function ce(D,...re){if(n.apply(this,arguments)){var le=this.__zoom,fe=yu(D.changedTouches?D.changedTouches[0]:D,this),Le=le.invert(fe),we=le.k*(D.shiftKey?.5:2),se=t(G(M(le,we),fe,Le),e.apply(this,re),s);g0(D),l>0?ta(this).transition().duration(l).call(V,se,fe,D):ta(this).call(T.transform,se,fe,D)}}function pe(D,...re){if(n.apply(this,arguments)){var le=D.touches,fe=le.length,Le=W(this,re,D.changedTouches.length===fe).event(D),we,se,Q,q;for(iE(D),se=0;se<fe;++se)Q=le[se],q=yu(Q,this),q=[q,this.__zoom.invert(q),Q.identifier],Le.touch0?!Le.touch1&&Le.touch0[2]!==q[2]&&(Le.touch1=q,Le.taps=0):(Le.touch0=q,we=!0,Le.taps=1+!!d);d&&(d=clearTimeout(d)),we&&(Le.taps<2&&(m=q[0],d=setTimeout(function(){d=null},x)),II(this),Le.start())}}function Y(D,...re){if(this.__zooming){var le=W(this,re).event(D),fe=D.changedTouches,Le=fe.length,we,se,Q,q;for(g0(D),we=0;we<Le;++we)se=fe[we],Q=yu(se,this),le.touch0&&le.touch0[2]===se.identifier?le.touch0[0]=Q:le.touch1&&le.touch1[2]===se.identifier&&(le.touch1[0]=Q);if(se=le.that.__zoom,le.touch1){var $e=le.touch0[0],Qe=le.touch0[1],qe=le.touch1[0],Lt=le.touch1[1],Pt=(Pt=qe[0]-$e[0])*Pt+(Pt=qe[1]-$e[1])*Pt,zt=(zt=Lt[0]-Qe[0])*zt+(zt=Lt[1]-Qe[1])*zt;se=M(se,Math.sqrt(Pt/zt)),Q=[($e[0]+qe[0])/2,($e[1]+qe[1])/2],q=[(Qe[0]+Lt[0])/2,(Qe[1]+Lt[1])/2]}else if(le.touch0)Q=le.touch0[0],q=le.touch0[1];else return;le.zoom("touch",t(G(se,Q,q),le.extent,s))}}function he(D,...re){if(this.__zooming){var le=W(this,re).event(D),fe=D.changedTouches,Le=fe.length,we,se;for(iE(D),y&&clearTimeout(y),y=setTimeout(function(){y=null},x),we=0;we<Le;++we)se=fe[we],le.touch0&&le.touch0[2]===se.identifier?delete le.touch0:le.touch1&&le.touch1[2]===se.identifier&&delete le.touch1;if(le.touch1&&!le.touch0&&(le.touch0=le.touch1,delete le.touch1),le.touch0)le.touch0[1]=this.__zoom.invert(le.touch0[0]);else if(le.end(),le.taps===2&&(se=yu(se,this),Math.hypot(m[0]-se[0],m[1]-se[1])<S)){var Q=ta(this).on("dblclick.zoom");Q&&Q.apply(this,arguments)}}}return T.wheelDelta=function(D){return arguments.length?(i=typeof D=="function"?D:Kx(+D),T):i},T.filter=function(D){return arguments.length?(n=typeof D=="function"?D:Kx(!!D),T):n},T.touchable=function(D){return arguments.length?(r=typeof D=="function"?D:Kx(!!D),T):r},T.extent=function(D){return arguments.length?(e=typeof D=="function"?D:Kx([[+D[0][0],+D[0][1]],[+D[1][0],+D[1][1]]]),T):e},T.scaleExtent=function(D){return arguments.length?(o[0]=+D[0],o[1]=+D[1],T):[o[0],o[1]]},T.translateExtent=function(D){return arguments.length?(s[0][0]=+D[0][0],s[1][0]=+D[1][0],s[0][1]=+D[0][1],s[1][1]=+D[1][1],T):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},T.constrain=function(D){return arguments.length?(t=D,T):t},T.duration=function(D){return arguments.length?(l=+D,T):l},T.interpolate=function(D){return arguments.length?(u=D,T):u},T.on=function(){var D=h.on.apply(h,arguments);return D===h?T:D},T.clickDistance=function(D){return arguments.length?(w=(D=+D)*D,T):Math.sqrt(w)},T.tapDistance=function(D){return arguments.length?(S=+D,T):S},T}const Ys={axisBottom:AZ,axisLeft:SZ,scaleLinear:pk,select:ta,zoom:RCe};class MCe{manager_;scaleX;scaleY;updateScaleX=e=>e;updateScaleY=e=>e;material;width_;height_;previousDomainX=[];zoom_;svg_;constructor(e){this.manager_=e}drawPoints(e){const t=e.distance.length,i=Ys.select(".lidarprofile-container .lidar-canvas").node().getContext("2d"),r=this.manager_.config.serverConfig;for(let o=0;o<t;++o){const s=e.distance[o],l=e.altitude[o],u=e.color_packed[o],h=e.intensity[o],d=e.classification[o];if(r.classification_colors[d]&&r.classification_colors[d].visible){const m=this.updateScaleX(s),y=this.updateScaleY(l);i.beginPath(),i.moveTo(m,y),this.material==="COLOR_PACKED"?i.fillStyle=`rgb(${u[0]}, ${u[1]}, ${u[2]})`:this.material==="INTENSITY"?i.fillStyle=`rgb(${h}, ${h}, ${h})`:this.material==="CLASSIFICATION"?i.fillStyle=`rgb(${r.classification_colors[d].color})`:i.fillStyle=r.default_color,i.arc(m,y,r.point_size,0,2*Math.PI,!1),i.fill()}}}setupPlot(e,t){const i=Ys.select(".lidarprofile-container .lidar-canvas"),r=i.node();r.getContext("2d").clearRect(0,0,r.getBoundingClientRect().width,r.getBoundingClientRect().height);const s=this.manager_.config.clientConfig.margin,l=Ys.select(".lidarprofile-container").node(),u=l.getBoundingClientRect().width,h=l.getBoundingClientRect().height;this.width_=Math.max(u-(s.left+s.right),0),this.height_=Math.max(h-(s.top+s.bottom),0),this.material=this.manager_.config.serverConfig.default_attribute,i.attr("height",this.height_).attr("width",this.width_).style("background-color","white").style("z-index",0).style("position","absolute").style("margin-left",`${s.left}px`).style("margin-top",`${s.top}px`);const d=e[1]-e[0],m=t[1]-t[0],y=d/m,x=this.width_,C=this.height_,w=x/C;if(y<w)this.scaleX=Ys.scaleLinear().domain(e).range([0,this.width_]),this.scaleY=Ys.scaleLinear().domain(t).range([this.height_,0]);else{const M=y/w,G=m*M,N=(t[1]+t[0])/2;this.scaleX=Ys.scaleLinear().domain(e).range([0,this.width_]),this.scaleY=Ys.scaleLinear().domain([N-G/2,N+G/2]).range([this.height_,0])}this.zoom_=Ys.zoom().scaleExtent([-10,100]).translateExtent([[0,0],[this.width_+1e3,this.height_]]).extent([[0,0],[this.width_+1e3,this.height_]]).on("zoom",this.zoomed.bind(this)).on("end",this.zoomEnd.bind(this)),this.previousDomainX=this.scaleX.domain(),this.updateScaleX=this.scaleX,this.updateScaleY=this.scaleY,this.svg_=Ys.select(".lidarprofile-container svg.lidar-svg"),this.svg_.call(this.zoom_).on("dblclick.zoom",null),this.svg_.selectAll("*").remove(),this.svg_.attr("width",this.width_+s.left).attr("height",this.height_+s.top+s.bottom),this.svg_.on("mousemove",M=>{this.pointHighlight(M)});const S=Ys.axisBottom(this.scaleX),T=Ys.axisLeft(this.scaleY).tickSize(-this.width_);this.svg_.append("g").attr("class","y axis").call(T),this.svg_.append("g").attr("class","x axis").call(S),this.svg_.select(".y.axis").attr("transform",`translate(${s.left}, ${s.top})`),this.svg_.select(".x.axis").attr("transform",`translate(${s.left}, ${this.height_+s.top})`),this.svg_.select(".y.axis").selectAll("g.tick line").style("opacity","0.5").style("stroke","#b7cff7")}activateZoom(){this.svg_.call(this.zoom_)}deactivateZoom(){this.svg_.on(".zoom",null)}zoomEnd(){Ys.select(".lidarprofile-container .lidar-canvas").node().getContext("2d").clearRect(0,0,this.width_,this.height_),this.manager_.updateData()}zoomed(e){this.manager_.clearMeasure();const t=e.transform,i=Ys.select(".lidarprofile-container svg.lidar-svg"),r=Ys.axisBottom(this.scaleX),o=Ys.axisLeft(this.scaleY).tickSize(-this.width_),s=t.rescaleX(this.scaleX),l=t.rescaleY(this.scaleY),u=r.scale(s),h=o.scale(l);i.select(".x.axis").call(u),i.select(".y.axis").call(h),Ys.select(".lidarprofile-container .lidar-canvas").node().getContext("2d").clearRect(0,0,this.width_,this.height_),i.select(".y.axis").selectAll("g.tick line").style("opacity","0.5").style("stroke","#b7cff7"),this.updateScaleX=s,this.updateScaleY=l}pointHighlight(e){const t=Ys.select(".lidarprofile-container svg.lidar-svg"),i=Ys.select(".lidarprofile-container .lidar-info"),r=this.manager_.config.serverConfig.point_size,o=this.manager_.config.clientConfig.margin,s=this.manager_.config.clientConfig.tolerance||0,l=Ys.select(".lidarprofile-container .lidar-canvas").node(),u=yu(e,l),h=this.manager_.config.serverConfig.classification_colors,d=this.manager_.utils.getClosestPoint(this.manager_.profilePoints,u[0],u[1],s,this.updateScaleX,this.updateScaleY,h);if(d!=null){const m=this.updateScaleX(d.distance)+o.left,y=this.updateScaleY(d.altitude)+o.top;t.selectAll("#highlightCircle").remove(),t.append("circle").attr("id","highlightCircle").attr("cx",m).attr("cy",y).attr("r",r+3).style("fill","red");const x=d.classification??-1,C=h[x]||{},w=this.getInfoHTML(d,C,1);i.html(w),this.manager_.cartoHighlight.setElement(void 0);const S=document.createElement("div");S.className+="tooltip gmf-tooltip-measure",S.innerHTML=w,this.manager_.cartoHighlight.setElement(S);const T=new Mr([d.coords[0],d.coords[1]]).transform("EPSG:2169","EPSG:3857");this.manager_.cartoHighlight.setPosition(T.getCoordinates());const M=this.manager_.lidarPointHighlight.getSource();M&&M.clear();const G=new Zi(T);typeof C.color<"u"&&G.setStyle(new qn({image:new Qs({fill:new Ji({color:`rgba(${C.color}, 1)`}),radius:3})})),M&&M.addFeature(G)}else{const m=this.manager_.lidarPointHighlight.getSource();m&&m.clear(),t.select("#highlightCircle").remove(),i.html(""),this.manager_.cartoHighlight.setPosition(void 0)}}getInfoHTML(e,t,i){const r=(m,y)=>parseFloat(`${m}`).toFixed(y),o=e.distance,s=e.altitude,l=t.name?t.name[Wn.language]:"",u=l!=null?String(l):"",h=e.intensity,d=[];if(o!==void 0){const m=Wn.t("Distance: ");d.push(`${m+r(o,i)}`)}if(s!==void 0){const m=Wn.t("Altitude: ");d.push(`${m+r(s,i)}`)}if(u.length>0){const m=Wn.t("Classification: ");d.push(`${m+u}`)}if(h!==void 0){const m=Wn.t("Intensity: ");d.push(`${m+r(h,0)}`)}return d.join("</br>")}changeStyle(e){this.material=e,this.clear(),this.drawPoints(this.manager_.profilePoints)}clear(){const e=Ys.select(".lidarprofile-container .lidar-canvas").node();e.getContext("2d").clearRect(0,0,e.width,e.height)}setClassActive(e,t){this.manager_.config.serverConfig.classification_colors=e,this.changeStyle(t)}}const i3={select:ta};class kCe{clipLineByMeasure(e,t,i){const r=new $i([]);let o=0,s=0;const l=e.getLength(),u=t/l,h=i/l;let d=e.getCoordinates().length-1,m=0;e.forEachSegment((V,W)=>{m+=1;const j=new $i([V,W]);s+=j.getLength(),t==o?r.appendCoordinate(V):t>o&&t<s&&r.appendCoordinate(e.getCoordinateAt(u)),o>t&&o<i&&r.appendCoordinate(V),i==s?r.appendCoordinate(W):(i>o&&i<s||i>o&&i>s&&m===d)&&r.appendCoordinate(e.getCoordinateAt(h)),o+=j.getLength()});const y=r.clone(),x=new Zi({geometry:r.transform("EPSG:2169","EPSG:3857")}),C=new qn({stroke:new ki({color:"rgba(255,0,0,1)",width:2,lineCap:"square"})});let w=0,S=0;d=r.getCoordinates().length-1;let T=1;r.forEachSegment((V,W)=>{if(T==1){const j=W[0]-V[0],J=W[1]-V[1];w=Math.atan2(j,J)}if(T==d){const j=W[0]-V[0],J=W[1]-V[1];S=Math.atan2(j,J)}T+=1});const M=[C],G=r.getLastCoordinate(),N=r.getFirstCoordinate();return M.push(new qn({geometry:new Mr(N),image:new vl({fill:new Ji({color:"rgba(255, 0, 0, 1)"}),stroke:new ki({color:"rgba(255,0,0,1)",width:1,lineCap:"square"}),points:3,radius:5,rotation:w,angle:Math.PI/3})}),new qn({geometry:new Mr(G),image:new vl({fill:new Ji({color:"rgba(255, 0, 0, 1)"}),stroke:new ki({color:"rgba(255,0,0,1)",width:1,lineCap:"square"}),points:3,radius:5,rotation:S,angle:4*Math.PI/3})})),{clippedLine:y.getCoordinates(),distanceOffset:t,bufferGeom:x,bufferStyle:M}}getNiceLOD(e,t){let i=0,r=0;for(const o in t){const s=parseInt(o,10);e<s&&t[s].max>i&&(i=t[s].max,r=t[s].width)}return{maxLOD:i,width:r}}downloadProfileAsImageFile(e){const t=i3.select(".lidarprofile-container svg.lidar-svg"),i=parseInt(t.attr("width"),10),r=parseInt(t.attr("height"),10),o=e.margin,s=document.createElement("canvas");s.style.display="none",s.width=i,s.height=r;const l=s.getContext("2d");if(l){l.fillStyle="white",l.fillRect(0,0,i,r);const u=i3.select(".lidarprofile-container .lidar-canvas").node();u instanceof HTMLCanvasElement&&l.drawImage(u,o.left,o.top,i-(o.left+o.right),r-(o.top+o.bottom));const h=new Image,d=new XMLSerializer,m=t.node(),y=d.serializeToString(m),x="lidar_profile_for_export_uid";h.id=x,h.src=`data:image/svg+xml;base64, ${btoa(y)}`,h.style.setProperty("display","none");const C=document.getElementsByTagName("body")[0];h.onload=()=>{l.drawImage(h,0,0,i,r);const w=document.getElementById(x);w&&C.removeChild(w),s.toBlob(S=>{az.saveAs(S,"LIDAR_profile.png")})},C.appendChild(h)}}getFlatPointsByDistance(e){const t=[];for(let i=0;i<e.distance.length;i++){const r={distance:e.distance[i],altitude:e.altitude[i],color_packed:e.color_packed[i],intensity:e.intensity[i],classification:e.classification[i],coords:e.coords[i]};t.push(r)}return t.sort((i,r)=>i.distance-r.distance),t}getCSVData(e){return e.map(t=>{const i={};for(const r in t){const o=t[r];r==="altitude"?i[r]=o?o.toFixed(4):null:r==="color_packed"||r=="coords"?i[r]=o?o.join(" "):null:i[r]=o}return i})}arrayMax(e){return Math.max(...e)}arrayMin(e){let t=1/0;for(let i=0;i<e.length;i++)e[i]<t&&(t=e[i]);return t}getPytreeLinestring(e){const t=e.getCoordinates();let i="";for(let r=0;r<t.length;r++){const o=t[r][0],s=t[r][1];i+=`{${Math.round(100*o)/100}, ${Math.round(100*s)/100}},`}return i.slice(0,-1)}getClosestPoint(e,t,i,r,o,s,l){const u=e,h=r,d=[],m=[];if(u.distance&&u.altitude&&u.classification&&u.color_packed&&u.intensity&&u.coords){for(let x=0;x<u.distance.length;x++)if(o(u.distance[x])<t+h&&o(u.distance[x])>t-h&&s(u.altitude[x])<i+h&&s(u.altitude[x])>i-h){const C=Math.sqrt(Math.pow(o(u.distance[x])-t,2)+Math.pow(s(u.altitude[x])-i,2)),w=l[u.classification[x]];w&&w.visible==1&&(m.push({distance:u.distance[x],altitude:u.altitude[x],classification:u.classification[x],color_packed:u.color_packed[x],intensity:u.intensity[x],coords:u.coords[x]}),d.push(C))}}let y;if(m.length>0){const x=Math.min(...d),C=d.indexOf(x);C!=-1?y=m[C]:y=m[0]}return y}}class LCe{manager;pStart;pEnd;constructor(e){this.manager=e,this.pStart={},this.pEnd={}}clearMeasure(){this.manager.plot.activateZoom(),this.pStart={},this.pEnd={};const e=ta(".lidarprofile-container svg.lidar-svg");e.selectAll("#text_m").remove(),e.selectAll("#start_m").remove(),e.selectAll("#end_m").remove(),e.selectAll("#line_m").remove(),e.on("click",null),e.style("cursor","default")}setMeasureActive(){this.manager.plot.deactivateZoom();const e=ta(".lidarprofile-container svg.lidar-svg");e.style("cursor","pointer"),e.on("click",t=>this.measureHeight(t))}measureHeight(e){const t=ta(".lidarprofile-container svg.lidar-svg"),i=t.node(),r=ta(".lidarprofile-container .lidar-canvas").node();if(!i||!r)return;const o=yu(e,i),s=yu(e,r),l=this.manager.config.clientConfig.margin,u=o[0],h=o[1],d=2,m=this.manager.plot.updateScaleX,y=this.manager.plot.updateScaleY,x=3,C=this.manager.utils.getClosestPoint(this.manager.profilePoints,s[0],s[1],d,m,y,this.manager.config.serverConfig.classification_colors);if(this.pStart.set?this.pEnd.set||(C!==void 0?(this.pEnd.distance=C.distance,this.pEnd.altitude=C.altitude,this.pEnd.cx=m(C.distance)+l.left,this.pEnd.cy=y(C.altitude)+l.top):(this.pEnd.distance=m.invert(u),this.pEnd.altitude=y.invert(h),this.pEnd.cx=u,this.pEnd.cy=h),this.pEnd.set=!0,t.append("circle").attr("id","end_m").attr("cx",this.pEnd.cx).attr("cy",this.pEnd.cy).attr("r",x).style("fill","red"),t.append("line").attr("id","line_m").attr("x1",this.pStart.cx).attr("y1",this.pStart.cy).attr("x2",this.pEnd.cx).attr("y2",this.pEnd.cy).attr("stroke-width",2).attr("stroke","red")):(C!==void 0?(this.pStart.distance=C.distance,this.pStart.altitude=C.altitude,this.pStart.cx=m(C.distance)+l.left,this.pStart.cy=y(C.altitude)+l.top):(this.pStart.distance=m.invert(u),this.pStart.altitude=y.invert(h),this.pStart.cx=u,this.pStart.cy=h),this.pStart.set=!0,t.append("circle").attr("id","start_m").attr("cx",this.pStart.cx).attr("cy",this.pStart.cy).attr("r",x).style("fill","red")),this.pStart.set&&this.pEnd.set){const w=this.pEnd.altitude-this.pStart.altitude,S=this.pEnd.distance-this.pStart.distance,T=Math.round(10*Math.sqrt(Math.pow(w,2)+Math.pow(S,2)))/10;isNaN(T)||t.append("text").attr("id","text_m").attr("x",10+(this.pStart.cx+this.pEnd.cx)/2).attr("y",(this.pStart.cy+this.pEnd.cy)/2).text(`${T} m`).attr("font-family","sans-serif").attr("font-size","14px").style("font-weight","bold").attr("fill","red"),this.pEnd.set=!1,this.pStart.set=!1}}}const Sm={select:ta};class PCe{map=Kn().getOlMap();utils=new kCe;promise=null;plot=null;measure=null;config=null;cartoHighlight=new Vp({offset:[0,-15],positioning:"bottom-center"});lidarPointHighlight=new bo({source:new ua({}),style:new qn({image:new Qs({fill:new Ji({color:"rgba(0, 0, 255, 1)"}),radius:3})})});lidarBuffer=new bo({source:new ua({})});profilePoints=this.getEmptyProfilePoints_();isPlotSetup_=!1;line_;constructor(){}init(e){this.config=e,this.plot=new MCe(this),this.lidarBuffer.setMap(this.map),this.lidarPointHighlight.setMap(this.map),this.measure=new LCe(this)}clearBuffer(){if(this.lidarBuffer){const e=this.lidarBuffer.getSource();e&&e.clear()}}setLine(e){this.line_=e}getEmptyProfilePoints_(){return{distance:[],altitude:[],color_packed:[],intensity:[],classification:[],coords:[]}}resetPlot(){this.isPlotSetup_=!1,this.plot.clear()}arrayToCsvString(e){if(!e.length)return"";const t=Object.keys(e[0]),i=e.map(r=>t.map(o=>JSON.stringify(r[o]??"")).join(","));return[t.join(","),...i].join(`\r
`)}exportCsv(){const e=this.utils.getFlatPointsByDistance(this.profilePoints)||{},t=this.utils.getCSVData(e),i=this.arrayToCsvString(t),r=new Blob([i],{type:"text/csv"});SB("export-lidar.csv",r,"text/csv")}exportPng(){this.utils.downloadProfileAsImageFile(this.config.clientConfig)}exportLas(){const e=tb(),{profileWidth:t}=xt(e);this.getProfileByLOD([],0,0,!0,t.value)}getProfileByLOD(e,t,i,r,o){this.profilePoints=this.getEmptyProfilePoints_(),Sm.select(".lidarprofile-container .lidar-error").style("visibility","hidden");let s=this.utils.getPytreeLinestring(this.line_),l;Sm.select(".lidarprofile-container .lod-info").html("");const u=this.config.serverConfig.max_levels;let h=0;if(t==0)l=this.utils.getNiceLOD(this.line_.getLength(),u);else{const m=this.plot.updateScaleX.domain();s="";for(let y=0;y<e.length;y++)s+=`{${e[y][0]},${e[y][1]}},`;s=s.slice(0,-1),l=this.utils.getNiceLOD(m[1]-m[0],u)}this.config.clientConfig.pointSum=0,this.config.clientConfig.autoWidth?h=l.width:h=this.config.serverConfig.width,h=o;const d=Wn.t("Profile width: ");if(Sm.select(".lidarprofile-container .width-info").html(`${d} ${h}m`),r)this.queryPytree_(void 0,void 0,s,t,h,!0);else for(let m=0;m<l.maxLOD;m++)m==0?(this.queryPytree_(i,this.config.serverConfig.initialLOD,s,t,h,!1),m+=this.config.serverConfig.initialLOD-1):this.queryPytree_(i+m,i+m+1,s,t,h,!1)}queryPytree_(e,t,i,r,o,s){if(!this.config)throw new Error("Missing config");if(!this.config.serverConfig)throw new Error("Missing config.serverConfig");this.map.getViewport().style.cursor="wait",document.body.style.cursor="wait";const l=Sm.select(".lidarprofile-container .lod-info");if(this.config.serverConfig.debug){let m=l.html();const y=Wn.t("Loading LOD: ");m+=`${y} ${e}-${t}...<br>`,l.html(m)}const u=this.config.serverConfig.default_point_cloud,h=s?1:0,d={method:"GET",headers:{"Content-Type":"text/plain; charset=x-user-defined"},responseType:"arraybuffer"};if(s){const m=`https://migration.geoportail.lu/profile/get?width=${o}&coordinates=${i}&pointCloud=${u}&attributes=&getLAS=${h}`;fetch(m,d).then(y=>y.blob()).then(y=>{const x=window.URL.createObjectURL(y),C=document.createElement("a");C.style.display="none",C.href=x,C.download="output.las",document.body.appendChild(C),C.click(),window.URL.revokeObjectURL(x)}).finally(()=>{this.map.getViewport().style.cursor="",document.body.style.cursor=""})}else{let m=`https://migration.geoportail.lu/profile/get?minLOD=${e}&maxLOD=${t}&width=${o}&coordinates=${i}&pointCloud=${u}&attributes=&getLAS=${h}`;(e===void 0||t===void 0)&&(m=`https://migration.geoportail.lu/profile/get?width=${o}&coordinates=${i}&pointCloud=${u}&attributes=&getLAS=${h}`),fetch(m,d).then(y=>y.arrayBuffer()).then(y=>{if(!this.config)throw new Error("Missing config");if(!this.config.serverConfig)throw new Error("Missing config.serverConfig");if(this.config.serverConfig.debug){let x=l.html();const C=Wn.t("LOD: "),w=Wn.t("loaded");x+=`${C} ${e}-${t} ${w}<br>`,l.html(x)}this.processBuffer_(y,r)}).catch(y=>{throw`Error on pytree query: ${y.message}`}).finally(()=>{this.map.getViewport().style.cursor="",document.body.style.cursor=""})}}processBuffer_(e,t){const i=Sm.select(".lidarprofile-container .lidar-error"),o=new Int32Array(e,0,4)[0],s=new Uint8Array(e,4,o);let l="";for(let T=0;T<s.length;T++)l+=String.fromCharCode(s[T]);try{JSON.parse(l)}catch{if(!this.isPlotSetup_){const M=Sm.select(".lidarprofile-container .lidar-canvas"),G=M.node();if(G&&G instanceof HTMLCanvasElement){const N=G.getContext("2d");N&&N.clearRect(0,0,G.getBoundingClientRect().width,G.getBoundingClientRect().height),M.selectAll("*").remove();const V=this.getHTMLError_();i.style("visibility","visible"),i.html(V)}}return}i.style("visibility","hidden");const u=JSON.parse(l);this.config.clientConfig.pointSum+=u.points,this.config.clientConfig.pointSum>this.config.serverConfig.max_point_number&&console.warn("Number of points is higher than Pytree configuration max value !");const h=u.pointAttributes,d=[];for(let T=0;T<h.length;T++)this.config.serverConfig.point_attributes[h[T]]!=null&&d.push(this.config.serverConfig.point_attributes[h[T]]);const m=u.scale;if(u.points<3)return;const y=this.getEmptyProfilePoints_(),x=u.bytesPerPoint,C=e.slice(4+o);for(let T=0;T<u.points;T++){const M=x*T,G=new DataView(C,M,x);let N=0;for(let V=0;V<d.length;V++){if(d[V].value=="POSITION_PROJECTED_PROFILE"){const j=G.getUint32(N,!0)*m;y.distance.push(Math.round(100*(t+j))/100),this.profilePoints.distance.push(Math.round(100*(t+j))/100)}else if(d[V].value=="CLASSIFICATION"){const W=G.getUint8(N);y.classification.push(W),this.profilePoints.classification.push(W)}else if(d[V].value=="INTENSITY"){const W=G.getUint8(N);y.intensity.push(W),this.profilePoints.intensity.push(W)}else if(d[V].value=="COLOR_PACKED"){const W=G.getUint8(N),j=G.getUint8(N+1),J=G.getUint8(N+2);y.color_packed.push([W,j,J]),this.profilePoints.color_packed.push([W,j,J])}else if(d[V].value=="POSITION_CARTESIAN"){const W=G.getInt32(N,!0)*m+u.boundingBox.lx,j=G.getInt32(N+4,!0)*m+u.boundingBox.ly,J=G.getInt32(N+8,!0)*m+u.boundingBox.lz;y.coords.push([W,j]),y.altitude.push(J),this.profilePoints.altitude.push(J),this.profilePoints.coords.push([W,j])}N=N+d[V].bytes}}const w=[0,this.line_.getLength()],S=[this.utils.arrayMin(y.altitude),this.utils.arrayMax(y.altitude)];this.isPlotSetup_||(this.plot.setupPlot(w,S),this.isPlotSetup_=!0),this.plot.drawPoints(y)}getHTMLError_(){const e=Wn.t("Lidar profile service error"),t=Wn.t("It might be offline"),i=Wn.t("Or did you attempt to draw a profile outside data extent?"),r=Wn.t("Or did you attempt to draw such a small profile that no point was returned?");return`
      <div class="lidarprofile-error">
      <p class="bold">${e}</p>
      <p>${t}</p>
      <p>${i}</p>
      <p>${r}</p>
    `}updateData(){uy(this.updateData_.bind(this),200)()}updateData_(){const e=this.plot.updateScaleX.domain(),t=this.utils.clipLineByMeasure(this.line_,e[0],e[1]),i=this.lidarBuffer.getSource();i&&(i.clear(),i.addFeature(t.bufferGeom)),this.lidarBuffer.setStyle(t.bufferStyle);const r=e[1]-e[0],o=this.utils.getNiceLOD(r,this.config.serverConfig.max_levels),s=.2;if(Math.abs(e[0]-this.plot.previousDomainX[0])<s&&Math.abs(e[1]-this.plot.previousDomainX[1])<s)this.plot.drawPoints(this.profilePoints);else if(o.maxLOD<=this.config.serverConfig.initialLOD)this.plot.drawPoints(this.profilePoints);else{const l=tb(),{profileWidth:u}=xt(l);this.getProfileByLOD(t.clippedLine,t.distanceOffset,0,!1,u.value)}this.plot.previousDomainX=e}clearMeasure(){this.measure&&this.measure.clearMeasure()}setMeasureActive(){this.measure&&(this.clearMeasure(),this.measure.setMeasureActive())}}let go;function cz(){const n=oi(),e=tb(),{drawLidarActive:t,currentProfileFeature:i,profileWidth:r}=xt(e),{lidarOpen:o}=xt(n);let s;const l=new Ky({type:"LineString"}),u=new qn({fill:new Ji({color:"rgba(255,204,51,0.5)"}),stroke:new ki({color:"rgba(255,204,51,0.5)",width:4,lineCap:"square"})}),h=new bo({source:new ua,zIndex:1001});function d(){s=Kn().getOlMap(),go=new PCe,go.init(e.lidarConfig),kt(o,J=>{if(J)t.value=!0;else{t.value=!1;const te=h.getSource();te&&te.clear()}}),kt(()=>i.value,J=>{const te=h.getSource();te&&(te.clear(),J&&x(J.getGeometry()))}),kt(()=>r.value,()=>{const J=h.getSource();J&&(J.clear(),i.value&&i.value&&x(i.value.getGeometry()))}),l.setActive(!1),kt(t,J=>{l.setActive(J)}),s.addInteraction(l),s.addLayer(h),h.setStyle(u),In(l,"drawstart",J=>wu.add(s,J)),In(l,"drawend",J=>{m(J)}),In(document,"keyup",J=>{y(J)})}function m(J){l.finishDrawing(),t.value=!1,J.stopPropagation(),i.value=J.feature,S()}function y(J){J.key==="Escape"&&(l.finishDrawing(),l.setActive(!1))}function x(J){const te=J.getCoordinates();for(let ce=0;ce<te.length-1;ce++){const pe=gs(te[ce],s.getView().getProjection(),"EPSG:2169"),Y=gs(te[ce+1],s.getView().getProjection(),"EPSG:2169"),D=C(pe,Y,r.value/2).transform("EPSG:2169",s.getView().getProjection()),re=new Zi({geometry:D});h.getSource().addFeature(re)}}function C(J,te,ce){const[pe,Y]=J,[he,D]=te,re=(he-pe)/(D-Y),le=Math.sqrt(Math.pow(ce,2)/(Math.pow(re,2)+1)),fe=-re*le,Le=pe+le,we=Y+fe,se=he-le,Q=D-fe,q=pe-le,$e=Y-fe,Qe=he+le,qe=D+fe;return new Fo([[[Le,we],[q,$e],[se,Q],[Qe,qe],[Le,we]]])}function w(){go.clearBuffer(),go.resetPlot(),go.getProfileByLOD([],0,e.lidarConfig.serverConfig.minLOD,!1,r.value)}function S(){go.resetPlot(),go.clearBuffer(),go.setLine(i.value.clone().getGeometry().transform("EPSG:3857","EPSG:2169")),go.getProfileByLOD([],0,e.lidarConfig.serverConfig.minLOD,!1,r.value)}function T(){go.exportCsv()}function M(){go.exportPng()}function G(){go.exportLas()}function N(){const J=i.value;return!!J&&typeof J.getGeometry=="function"&&J.getGeometry()&&J.getGeometry().getType&&J.getGeometry().getType()==="LineString"}function V(){go.resetPlot(),go.updateData()}function W(){go.clearMeasure(),go.setMeasureActive()}function j(){go.clearMeasure()}return{drawInteraction:l,drawLidarActive:t,resetPlot:w,lidarManager:go,hasLineFeature:N,exportCsv:T,exportPng:M,exportLas:G,init:d,updateData:V,setMeasureActive:W,clearMeasure:j}}const GCe={class:"lidarprofile-container"},FCe={class:"lidar-flex"},OCe={class:"lidar-legend p-2.5 bg-primary text-white"},NCe={class:"export-tools"},DCe=["disabled"],VCe=["disabled"],BCe=["disabled"],ZCe=["disabled"],WCe=["disabled"],zCe={key:0,class:"lux-alert-info"},UCe={class:"lidarprofile"},XCe={class:"lidar-svg",style:{fill:"#ffff00",position:"absolute","z-index":"1"}},YCe=st({__name:"lidar-graph-panel",setup(n){const{toggleLidarOpen:e}=oi(),t=tb(),{measureActive:i}=xt(t),{t:r}=Ct(),o=cz();function s(){o.exportCsv()}function l(){o.exportPng()}function u(){o.exportLas()}function h(){i.value=!i.value,i.value?d():m()}function d(){o.setMeasureActive()}function m(){i.value=!1,o.clearMeasure()}return(y,x)=>(U(),oe("div",GCe,[P("div",{class:"close",onClick:x[0]||(x[0]=C=>k(e)(!1))},""),P("div",FCe,[P("div",OCe,[P("div",NCe,[P("div",null,[P("button",{class:"lux-btn mt-3",disabled:!(k(o)&&k(o).hasLineFeature()),onClick:s},K(k(r)("Export CSV")),9,DCe),P("button",{class:"lux-btn mt-3",disabled:!(k(o)&&k(o).hasLineFeature()),onClick:l},K(k(r)("Export PNG")),9,VCe),P("button",{class:"lux-btn mt-3",disabled:!(k(o)&&k(o).hasLineFeature()),onClick:u},K(k(r)("Export LAS")),9,BCe),P("div",null,[P("p",null,[P("button",{class:Dn(["lux-btn mt-3",{active:k(i)}]),disabled:!(k(o)&&k(o).hasLineFeature()),onClick:h},K(k(r)("Take measure")),11,ZCe),P("button",{class:"lux-btn mt-3",onClick:m,disabled:!(k(o)&&k(o).hasLineFeature())},[...x[1]||(x[1]=[P("span",{class:"fa fa-eraser"},null,-1)])],8,WCe)]),k(i)?(U(),oe("p",zCe,[Bt(K(k(r)("Measure distances on the profile below."))+" ",1),P("em",null,K(k(r)("(Deactivates zoom and pan on the profile!)")),1)])):Ge("",!0)])])]),x[2]||(x[2]=P("hr",{style:{"margin-top":"10px"}},null,-1)),x[3]||(x[3]=P("div",{class:"width-info"},null,-1)),x[4]||(x[4]=P("div",{class:"lod-info"},null,-1)),x[5]||(x[5]=P("div",{class:"lidar-info poi-feature"},null,-1))]),P("div",UCe,[x[6]||(x[6]=P("div",{class:"lidar-error"},null,-1)),x[7]||(x[7]=P("canvas",{class:"lidar-canvas"},null,-1)),(U(),oe("svg",XCe))])])]))}}),HCe=is(YCe,[["__scopeId","data-v-07412ff6"]]),KCe={class:"lux-menu-popup"},jCe=["aria-expanded","aria-label"],$Ce=["aria-label","aria-labelledby"],Ok=st({__name:"menu-popup",props:{items:{},direction:{},ariaLabel:{},ariaLabelledby:{}},setup(n){const e=n,t=Ei(!1),i=Ke(null),r=Ke(null),o=Ke(-1);function s(C){C.stopPropagation(),l()}function l(C){const w=t.value;t.value=C??!t.value,!w&&t.value?(o.value=0,setTimeout(()=>{y(0),r.value?.focus()},100)):w&&!t.value&&(o.value=-1,i.value?.focus())}function u(){l(!1)}function h(C){if(!t.value){["Enter"," ","ArrowDown"].includes(C.key)&&(C.preventDefault(),C.stopPropagation(),l(!0));return}switch(C.key){case"Escape":C.preventDefault(),C.stopPropagation(),l(!1);break;case"ArrowDown":C.preventDefault(),C.stopPropagation(),d();break;case"ArrowUp":C.preventDefault(),C.stopPropagation(),m();break;case"ArrowLeft":case"ArrowRight":C.preventDefault(),C.stopPropagation();break;case"Home":C.preventDefault(),C.stopPropagation(),y(0);break;case"End":C.preventDefault(),C.stopPropagation(),y(e.items.length-1);break;case"Tab":C.stopPropagation(),l(!1);break;default:C.stopPropagation();break}}function d(){const C=(o.value+1)%e.items.length;y(C)}function m(){const C=o.value<=0?e.items.length-1:o.value-1;y(C)}function y(C){if(o.value=C,!r.value)return;const w=r.value.querySelectorAll('[role="menuitem"]');if(!(!w||w.length===0)&&w[C])try{w[C].focus()}catch(S){console.error("[MenuPopup] Error focusing item:",S)}}function x(C){if(t.value)try{h(C)}catch(w){console.error("[MenuPopup] Error in handleGlobalKeyDown:",w)}}return gr(()=>{document.addEventListener("click",u),document.addEventListener("keydown",x,!0)}),Ds(()=>{document.removeEventListener("click",u),document.removeEventListener("keydown",x,!0)}),kt(t,C=>{if(!C)return;const w=i.value,S=r.value,T=w.getBoundingClientRect(),M=e.direction==="down"?T.bottom:T.top-S.offsetHeight;S.style.top=`${M}px`,S.style.left=`${T.left+T.width-S.offsetWidth}px`}),(C,w)=>(U(),oe("div",KCe,[P("button",{onClick:s,onKeydown:h,ref_key:"btnElement",ref:i,"aria-expanded":t.value,"aria-haspopup":!0,"aria-label":n.ariaLabel},[Jn(C.$slots,"default")],40,jCe),(U(),Mt(bw,{to:"body"},[P("ul",{"aria-label":n.ariaLabel,"aria-labelledby":n.ariaLabelledby,class:Dn(["lux-menu-popup-list",t.value?"":"invisible"]),ref_key:"ddElement",ref:r,role:"menu",tabindex:"-1"},[(U(!0),oe(Et,null,yi(e.items,(S,T)=>(U(),oe("li",{key:S.label,class:Dn(S.separator?"border-b-[1px] pb-2 mb-2":""),role:"none"},[S.label?Jn(C.$slots,"item",{key:0,item:S,index:T,isFocused:o.value===T},()=>[Bt(K(S.label)+" "+K(S.separator),1)]):Ge("",!0)],2))),128))],10,$Ce)]))]))}}),Nk=st({__name:"menu-popup-item",props:{item:{},index:{},isFocused:{type:Boolean}},emits:["click"],setup(n,{emit:e}){const t=n,i=e;function r(){i("click",t.item)}function o(s){s.key==="Enter"||s.key===" "?(s.preventDefault(),s.stopPropagation(),r()):s.stopPropagation()}return(s,l)=>(U(),oe("button",{class:"lux-dropdown-list-item",onClick:r,onKeydown:fs(o,["stop"]),role:"menuitem",tabindex:"-1"},[Jn(s.$slots,"default",{},()=>[Bt(K(n.item.label),1)])],32))}});class JCe extends Bc{dragSegments_;features_;lastPixel_=[0,0];listener;modified_=!1;overlay_;pixelTolerance_=10;rBush_=new NC;snappedToVertex_=!1;vertexFeature_=null;constructor(){super({handleDownEvent:ewe,handleEvent:twe,handleUpEvent:QCe}),this.features_=new na,this.overlay_=iv.createOlLayerInteractionClip()}get overlay(){return this.overlay_}addFeature_(e){if(e.getGeometry()?.getType()==="LineString"){const t=e.getGeometry(),i=this.getMap();this.writeLineStringGeometry_(e,t),i&&this.lastPixel_[0]!==0&&this.lastPixel_[1]!==0&&this.handlePointerAtPixel_(this.lastPixel_,i)}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource()?.removeFeature(this.vertexFeature_),this.vertexFeature_=null),this.listener&&pr(this.listener)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(r){e===r.feature&&i.push(r)});for(let r=i.length-1;r>=0;--r)t.remove(i[r])}setMap(e){super.setMap(e),this.features_&&(this.features_.on("add",t=>{this.addFeature_(t.element)}),this.features_.on("remove",t=>{this.removeFeature_(t.element)}))}handleFeatureChange_(e){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}handleFeatureChanged(e){this.removeFeature_(e),this.addFeature_(e)}writeLineStringGeometry_(e,t){const i=t.getCoordinates();let r,o,s,l;for(r=0,o=i.length-1;r<o;++r)s=i.slice(r,r+2),l={feature:e,geometry:t,index:r,segment:s},this.rBush_.insert(Ks(s),l)}createOrUpdateVertexFeature_(e){let t=this.vertexFeature_;return t?t.getGeometry().setCoordinates(e):(t=new Zi(new Mr(e)),this.vertexFeature_=t,this.overlay_.getSource()?.addFeature(t)),t}setActive(e){this.handlingDownUpSequence=!1,this.overlay_!==void 0&&this.vertexFeature_&&(this.overlay_.getSource()?.removeFeature(this.vertexFeature_),this.vertexFeature_=null);const t=this.getMap();t&&(e?t.getTargetElement().style.cursor="crosshair":t.getTargetElement().style.cursor=""),super.setActive(e)}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map)}handlePointerAtPixel_(e,t){if(!this.getActive())return;const i=t.getCoordinateFromPixel(e),r=function(u,h){return kE(i,u.segment)-kE(i,h.segment)},o=Hh(ey(i),t.getView().getResolution()*this.pixelTolerance_),l=this.rBush_.getInExtent(o);if(l.length>0){l.sort(r);const h=l[0].segment;let d=lb(i,h);const m=t.getPixelFromCoordinate(d);if(Math.sqrt(Fh(e,m))<=this.pixelTolerance_){const y=t.getPixelFromCoordinate(h[0]),x=t.getPixelFromCoordinate(h[1]),C=Fh(m,y),w=Fh(m,x),S=Math.sqrt(Math.min(C,w));this.snappedToVertex_=S<=this.pixelTolerance_,this.snappedToVertex_&&(d=C>w?h[1]:h[0]),this.createOrUpdateVertexFeature_(d);return}}this.vertexFeature_&&(this.overlay_.getSource()?.removeFeature(this.vertexFeature_),this.vertexFeature_=null)}}function qCe(n,e){return n.index-e.index}function QCe(){return this.handlingDownUpSequence=!1,!1}function ewe(n){if(!this.getActive())return!1;this.handlePointerAtPixel_(n.pixel,n.map),this.dragSegments_=[],this.modified_=!1;const e=this.vertexFeature_;if(e){const i=e.getGeometry().getCoordinates(),r=Ks([i]),o=this.rBush_.getInExtent(r);o.sort(qCe);for(let s=0,l=o.length;s<l;++s){const u=o[s];if(u.feature!==void 0&&this.features_.getArray().indexOf(u.feature)>=0){const h=lb(i,u.segment);if(!Yo(h,i)){this.getActive()&&this.dispatchEvent(new la("clickmiss"));continue}this.features_.remove(u.feature);const d=u.feature.id;d&&u.feature.set("originalFeatureId",d);const m=u.feature.clone(),y=u.feature.clone(),x=m.getGeometry(),C=y.getGeometry(),w=u.feature.getGeometry(),S=w.getCoordinates().slice(0,[u.index+1]);S.push(i);const T=w.getCoordinates().slice([u.index+1]);S.push(i),T.splice(0,0,i),x.setCoordinates(S),C.setCoordinates(T),this.features_.push(m),this.features_.push(y),this.dispatchEvent(new _I("modifyend",new na([m,y,u.feature]),n)),this.modified_=!0}}}else this.getActive()&&this.dispatchEvent(new la("clickmiss"));return this.handlePointerAtPixel_(n.pixel,n.map),!!this.vertexFeature_}function twe(n){return n instanceof pc?(!n.map.getView().getHints()[jr.INTERACTING]&&n.type=="pointermove"&&!this.handlingDownUpSequence&&this.handlePointerMove_(n),Bc.prototype.handleEvent.call(this,n)):!0}function nwe(){const{t:n}=Ct(),e=Jr(),t=Kn().getOlMap(),{addNotification:i}=ns(),{clipLineActive:r,queueAddedDrawnFeatures:o,drawnFeatures:s,activeFeatureId:l}=xt(e),{generateDrawnFeature:u}=sA(),h=new JCe;gr(()=>{t.addLayer(h.overlay),t.addInteraction(h),In(h,"clickmiss",()=>{r.value&&i(n("Vous tes en mode dcoupage.<br> Veuillez cliquer sur une ligne pour la couper en deux."))}),In(h,"modifyend",m=>{const y=m.features.getArray();if(y.length>=3){const[x,C,w]=y,S=w.get("originalFeatureId");if(!S){console.error("[ClipLine] Could not find original feature ID");return}const T=w.getProperties();Object.keys(T).forEach(W=>{W!=="geometry"&&W!=="id"&&W!=="originalFeatureId"&&(x.set(W,T[W]),C.set(W,T[W]))});const M=t.getAllLayers().filter(W=>W.get&&W.get("cyLayerType")==="interactionDrawLayer");if(M.length>0){const j=M[0].getSource();j&&j.removeFeature(w)}e.removeFeature(S);let G,N;typeof w.clone=="function"&&w.featureStyle!==void 0?(G=w.clone(),G.setGeometry(x.getGeometry().clone()),N=w.clone(),N.setGeometry(C.getGeometry().clone())):(G=u(x),N=u(C)),e.addDrawnFeatureToCollection(G),e.addDrawnFeatureToCollection(N),r.value=!1}})}),kt(r,m=>{h.setActive(m),m&&i(n("Vous tes en mode dcoupage.<br> Veuillez cliquer sur une ligne pour la couper en deux."))}),kt(o,m=>{m.length!==0&&aa(()=>{m.forEach(y=>{if(r.value){const x=h.features_;x&&!x.getArray().includes(y)&&x.push(y)}}),o.value=[]})}),kt(l,m=>{if(!r.value||!m)return;const y=h.features_;if(!y)return;const x=s.value.find(C=>C.id===m);x&&x.featureType==="drawnLine"&&(y.getArray().includes(x)||y.push(x))}),kt(r,m=>{const y=h.features_;if(y)if(m){if(l.value){const x=s.value.find(C=>C.id===l.value);x&&x.featureType==="drawnLine"&&(y.getArray().includes(x)||y.push(x))}}else y.clear()});function d(m){r.value=m??!r.value}return{toggle:d}}const iwe=st({__name:"feature-menu-popup",emits:["newConcentricCircle","continueLine"],setup(n,{emit:e}){const{t}=Ct(),i=Ef(),r=Go("feature"),o=e,s=At(()=>r.map_id?!!i.isMyMapEditable.value:!0);function l(h){gA.export(r.map,h,[r],r.label,!0)}let u=[{label:"Exporter un GPX",action:()=>l("gpx")},{label:"Exporter un KML",action:()=>l("kml")},{label:"Exporter un Shapefile",action:()=>l("shapefile")}];return r?.featureType==="drawnLine"&&s.value&&(u=[...u,{label:"Continuer la ligne",action:()=>o("continueLine")},{label:"Changer sens de la ligne",action:()=>JB(r)}]),r?.featureType==="drawnCircle"&&s.value&&(u=[...u,{label:"Crer cercle concentrique",action:()=>o("newConcentricCircle")}]),(h,d)=>(U(),Mt(Ok,{"data-cy":"featMenuPopup",items:k(u),direction:"up",ariaLabel:k(t)("Drawings menu")},{item:Xt(({item:m})=>[mt(Nk,{"data-cy":"featMenuPopupItem",item:m,onClick:()=>m.action&&m.action()},{default:Xt(()=>[Bt(K(k(t)(m.label)),1)]),_:2},1032,["item","onClick"])]),default:Xt(()=>[d[0]||(d[0]=P("i",{class:"fa-solid fa-square-caret-down hover:text-tertiary"},null,-1))]),_:1},8,["items","ariaLabel"]))}}),r3=st({__name:"feature-confirm-delete",emits:["cancel","validate"],setup(n){const{t:e}=Ct();return(t,i)=>(U(),oe(Et,null,[Bt(K(k(e)("tes-vous certain de vouloir effacer cet lment de la carte ?"))+" ",1),Jn(t.$slots,"footer")],64))}}),s3=st({__name:"feature-edit-info",emits:["cancel","validate"],setup(n){const{t:e}=Ct(),t=Go("feature");return(i,r)=>(U(),oe(Et,null,[Bt(K(k(e)("Modification des informations"))+" ",1),k(t)?Sn((U(),oe("input",{key:0,"data-cy":"featureLabelEdit",type:"text",class:"form-control block mt-2 mb-4","onUpdate:modelValue":r[0]||(r[0]=o=>k(t).label=o)},null,512)),[[Zr,k(t).label]]):Ge("",!0),k(t)?Sn((U(),oe("textarea",{key:1,rows:"3",class:"form-control block w-full","onUpdate:modelValue":r[1]||(r[1]=o=>k(t).description=o)},null,512)),[[Zr,k(t).description]]):Ge("",!0),Jn(i.$slots,"footer")],64))}}),rwe={class:"flex"},swe=["min","max","name","step"],owe=["min","max","name","step"],jx=st({__name:"range-input",props:{min:{default:0},max:{default:10},step:{default:1},value:{default:0},name:{default:"range"}},emits:["change"],setup(n){const t=Ke(n.value);return(i,r)=>(U(),oe("div",rwe,[Sn(P("input",{type:"range",class:"m-2.5 w-16 h-[5px] rounded-lg appearance-none cursor-pointer",min:n.min,max:n.max,name:`range-${n.name}`,step:n.step,"onUpdate:modelValue":r[0]||(r[0]=o=>t.value=o),onInput:r[1]||(r[1]=o=>i.$emit("change",t.value))},null,40,swe),[[Zr,t.value,void 0,{number:!0}]]),Sn(P("input",{type:"number",class:"w-12",min:n.min,max:n.max,name:n.name,step:n.step,"onUpdate:modelValue":r[2]||(r[2]=o=>t.value=o),onChange:r[3]||(r[3]=o=>i.$emit("change",t.value))},null,40,owe),[[Zr,t.value]])]))}}),awe=st({__name:"feature-edit-style-circle",props:{feature:{}},setup(n){return(e,t)=>(U(),oe(Et,null,[Jn(e.$slots,"title"),Jn(e.$slots,"color"),Jn(e.$slots,"lineWidth"),Jn(e.$slots,"transparency"),Jn(e.$slots,"footer")],64))}}),lwe=st({__name:"feature-edit-style-point",props:{feature:{}},setup(n){const e=Ke(!1);function t(){e.value=!1}return(i,r)=>e.value?Jn(i.$slots,"symbolIcon",{key:1,closeEditIcon:t},()=>[Jn(i.$slots,"symbolcolor")]):(U(),oe(Et,{key:0},[Jn(i.$slots,"title"),Jn(i.$slots,"color"),Jn(i.$slots,"styleSymbol",{openEditIcon:()=>e.value=!0}),Jn(i.$slots,"size",{maxsize:900}),Jn(i.$slots,"angle"),Jn(i.$slots,"footer")],64))}}),uwe=st({__name:"feature-edit-style-line",props:{feature:{}},setup(n){return(e,t)=>(U(),oe(Et,null,[Jn(e.$slots,"title"),Jn(e.$slots,"color"),Jn(e.$slots,"lineWidth"),Jn(e.$slots,"style"),Jn(e.$slots,"orientation"),Jn(e.$slots,"footer")],64))}}),cwe=st({__name:"feature-edit-style-polygon",props:{feature:{}},setup(n){return(e,t)=>(U(),oe(Et,null,[Jn(e.$slots,"title"),Jn(e.$slots,"color"),Jn(e.$slots,"lineWidth"),Jn(e.$slots,"transparency"),Jn(e.$slots,"footer")],64))}}),hwe=st({__name:"feature-edit-style-label",props:{feature:{}},setup(n){return(e,t)=>(U(),oe(Et,null,[Jn(e.$slots,"title"),Jn(e.$slots,"color"),Jn(e.$slots,"size",{maxsize:40}),Jn(e.$slots,"angle"),Jn(e.$slots,"footer")],64))}}),dwe=st({__name:"feature-edit-linestyle-item",props:{linestyle:{}},emits:["changeLinestyle"],setup(n,{emit:e}){const{t}=Ct(),i=e,r=Go("feature");function o(s){i("changeLinestyle",s)}return(s,l)=>(U(),oe("button",{class:Dn(`lux-btn-grey${k(r).featureStyle.linestyle===n.linestyle?" pressed":""}`),onClick:l[0]||(l[0]=u=>o(n.linestyle))},K(k(t)(k(kse)(n.linestyle))),3))}}),fwe=["cx","cy","r","fill"],hz=st({__name:"circleSymbol",props:{radius:{default:9},fillColor:{default:"red"}},setup(n){const t=n.radius*2;return(i,r)=>(U(),oe("svg",{height:t,width:t},[P("circle",{cx:n.radius,cy:n.radius,r:n.radius,fill:n.fillColor},null,8,fwe)]))}}),pwe=["height","width"],gwe=["fill"],dz=st({__name:"squareSymbol",props:{fillColor:{default:"red"},height:{default:18},width:{default:18}},setup(n){return(e,t)=>(U(),oe("svg",{height:n.height,width:n.width},[P("rect",{height:"100%",width:"100%",fill:n.fillColor},null,8,gwe)],8,pwe))}}),mwe=["height","width"],ywe=["y","font-size","fill"],fz=st({__name:"crossSymbol",props:{fillColor:{default:"red"},fontSize:{default:42},height:{default:18},width:{default:18}},setup(n){return(e,t)=>(U(),oe("svg",{height:n.height,width:n.width},[P("text",{x:"1",y:n.height+2,"font-size":n.fontSize,fill:n.fillColor},"+",8,ywe)],8,mwe))}}),_we=["height","width"],vwe=["fill"],pz=st({__name:"triangleSymbol",props:{fillColor:{default:"red"},size:{default:18}},setup(n){const e=n,t=e.size/2,i=`0,${e.size} ${t},0 ${e.size},${e.size}`;return(r,o)=>(U(),oe("svg",{height:n.size,width:n.size},[P("polygon",{points:i,fill:n.fillColor},null,8,vwe)],8,_we))}}),bwe={class:"flex gap-2 items-center mt-1 mb-2"},xwe={class:"font-bold block"},Iwe=["src"],Cwe=st({__name:"feature-edit-style-symbol",emits:["clickSymbolIcon"],setup(n){const e="https://migration.geoportail.lu/mymaps/symbol",{t}=Ct(),i=Go("feature"),r={circle:hz,square:dz,cross:fz,triangle:pz};return(o,s)=>(U(),oe("div",bwe,[P("label",xwe,K(k(t)("Symbol")),1),k(i).featureStyle.symbolId?(U(),oe("button",{key:0,class:"lux-btn items-center",onClick:s[0]||(s[0]=l=>o.$emit("clickSymbolIcon")),"data-cy":"featStyleSymbolEdit"},[P("img",{class:"symbol-style max-h-10",src:`${k(e)}/${k(i).featureStyle.symbolId}`},null,8,Iwe)])):(U(),oe("button",{key:1,class:"lux-btn items-center flex gap-2",onClick:s[1]||(s[1]=l=>o.$emit("clickSymbolIcon")),"data-cy":"featStyleSymbolEdit"},[Bt(K(k(t)("Symbole"))+" ",1),k(i).featureStyle.shape?(U(),Mt(sb(r[k(i).featureStyle.shape]),{key:0,fillColor:k(i).featureStyle.color},null,8,["fillColor"])):Ge("",!0)]))]))}}),gz="https://migration.geoportail.lu/mymaps/symbols",wwe="https://migration.geoportail.lu/mymaps",Awe="http://migration.geoportail.lu/mymaps/upload_symbol";let rE,sE;async function Swe(n=!1){return(!rE?.results||n)&&(rE=await(await Vs(gz,{symboltype:"public"},"GET")).json()),rE?.results}async function Ewe(n=!1){return(!sE?.results||n)&&(sE=await(await Vs(gz,{symboltype:"us"},"GET")).json()),sE?.results}async function Twe(n){const e=new FormData;return e.append("file",n),await Vs(Awe,e,"POST")}const Rwe=["placeholder"],Mwe=["id","title","onClick"],kwe={class:"w-12"},Lwe=["src"],Pwe={class:"break-all"},Gwe=st({__name:"feature-edit-symbol-list",props:{symbols:{}},emits:["change"],setup(n,{emit:e}){const t=n,i=e,{t:r}=Ct(),o=Ke(""),s=At(()=>o.value?t.symbols.filter(u=>u.name.includes(o.value)):t.symbols);function l(u){i("change",u)}return(u,h)=>(U(),oe("div",null,[Sn(P("input",{"data-cy":"featStyleSymbolFilterList",class:"text-white w-full placeholder-white border-[1px] border-gray-300 mb-2",type:"text",placeholder:k(r)("Rechercher un symbole"),"onUpdate:modelValue":h[0]||(h[0]=d=>o.value=d)},null,8,Rwe),[[Zr,o.value,void 0,{trim:!0}]]),Bt(" "+K(k(r)("Symbole"))+" ",1),P("ul",null,[(U(!0),oe(Et,null,yi(s.value,d=>(U(),oe("li",{key:d.id,class:"border-b-[1px] border-b-gray-300"},[P("button",{id:d.id.toString(),class:"leading-5 p-1 items-center flex hover:bg-slate-100 w-full text-left",title:d.name,onClick:()=>l(d.id),"data-cy":"featStyleSymbolIcon"},[P("span",kwe,[P("img",{class:"max-h-10",src:`${k(wwe)}${d.url}`},null,8,Lwe)]),P("span",Pwe,K(d.name),1)],8,Mwe)]))),128))])]))}}),Fwe={class:"border-b-gray-300 border-b-[1px] mb-2"},Owe=["data-cy","onClick"],Nwe={class:"flex gap-1 my-2"},Dwe=["onClick","data-cy"],Vwe={class:"text-right mt-3"};var mz=(n=>(n.configurables="Configurables",n.mySymbols="Mes symboles",n.publics="Publics",n))(mz||{});const Bwe=st({__name:"feature-edit-symbol-icon",emits:["close","changeSymbolIcon","changeSymbolShape"],setup(n,{emit:e}){const t=e,{t:i}=Ct(),{addNotification:r}=ns(),o=Du(),s=Go("feature"),l={circle:hz,square:dz,cross:fz,triangle:pz},u=Ke("Configurables"),h=Ke(void 0),d=Ke([]);kt(u,async C=>{if(C==="Mes symboles"||C==="Publics")try{d.value=await m(C==="Mes symboles")}catch{d.value=[]}}),gr(()=>{s.featureStyle.symbolId&&(u.value=s.featureStyle.symboltype==="us"?"Mes symboles":"Publics")});async function m(C=!1,w=!1){const S=C?await Ewe(w):await Swe(w);return S.sort((T,M)=>T.name.localeCompare(M.name)),S}async function y(){if(h.value?.files&&h.value.files[0]){const C=h.value.files[0];try{await Twe(C),d.value=await m(!0,!0)}catch{r(i("Error while trying to upload new symbol."),mi.ERROR)}}}function x(C){t("changeSymbolShape",C)}return(C,w)=>(U(),oe(Et,null,[Bt(K(k(i)("Veuillez choisir un symbole dans une des catgories"))+" ",1),P("div",Fwe,[(U(),oe(Et,null,yi(mz,(S,T)=>(U(),oe(Et,{key:T},[T==="mySymbols"&&!k(o).isAuthenticated()?Ge("",!0):(U(),oe("button",{key:0,"data-cy":`featStyleSymbolTab${T==="mySymbols"?"_private":""}`,onClick:()=>u.value=S,class:Dn(["lux-tab",{active:u.value===S}])},K(k(i)(S)),11,Owe))],64))),64))]),u.value==="Configurables"?(U(),oe(Et,{key:0},[P("div",Nwe,[(U(!0),oe(Et,null,yi(Object.keys(l),S=>(U(),oe("button",{key:S,class:"lux-btn p-2 rounded-sm border-gray-600",onClick:T=>x(S),"data-cy":`featStyleSymbol_${S}`},[(U(),Mt(sb(l[S]),{fillColor:k(s).featureStyle.color},null,8,["fillColor"]))],8,Dwe))),128))]),Jn(C.$slots,"symbolcolor")],64)):Ge("",!0),u.value==="Publics"||u.value==="Mes symboles"?(U(),Mt(Gwe,{key:1,symbols:d.value,class:"max-h-80 overflow-y-auto",onChange:w[0]||(w[0]=S=>C.$emit("changeSymbolIcon",`${S}`,u.value==="Mes symboles"?"us":"public"))},null,8,["symbols"])):Ge("",!0),P("div",Vwe,[u.value==="Mes symboles"?(U(),oe(Et,{key:0},[P("input",{accept:"image/*",ref_key:"fileInput",ref:h,type:"file",id:"file",hidden:"",onChange:y},null,544),P("button",{class:"lux-btn mr-2",onClick:w[1]||(w[1]=()=>h.value?.click())},K(k(i)("Importer un symbole")),1)],64)):Ge("",!0),P("button",{class:"lux-btn",onClick:w[2]||(w[2]=()=>C.$emit("close")),"data-cy":"featClosePopup"},K(k(i)("Fermer")),1)])],64))}}),Zwe={class:"flex gap-1 items-center"},Wwe={class:"font-bold block",for:"color"},zwe={class:"md:w-2/3"},Uwe=["value"],Xwe={class:"flex gap-1 items-center mt-1"},Ywe={class:"font-bold block",for:"size"},Hwe={key:0,class:"flex gap-1 items-center mt-1 mb-2"},Kwe={class:"font-bold block",for:"angle"},jwe={class:"flex gap-1 items-center mt-1 mb-2","data-cy":"featStyleLineStyle"},$we={class:"font-bold block"},Jwe={class:"flex gap-1"},qwe={class:"flex gap-1 items-center"},Qwe={class:"font-bold block",for:"color"},eAe={class:"md:w-2/3"},tAe=["value"],nAe={class:"flex gap-1 items-center mt-1"},iAe={class:"font-bold block",for:"stroke"},rAe={class:"flex gap-1 items-center mt-1"},sAe={class:"font-bold block",for:"transparency"},oAe={class:"flex gap-2 items-center mt-1 mb-2"},aAe={class:"font-bold block",for:"showOrientation"},lAe=["checked"],uAe={class:"flex gap-1 items-center mt-1 mb-2"},o3=st({__name:"feature-edit-style",emits:["cancel","validate"],setup(n){const{t:e}=Ct(),t=Go("feature"),i=At(()=>!(t.featureType==="drawnPoint"&&t.featureStyle.shape==="circle")),r={FeatureEditStyleCircle:awe,FeatureEditStyleLine:uwe,FeatureEditStylePoint:lwe,FeatureEditStylePolygon:cwe,FeatureEditStyleLabel:hwe},o=["plain","dashed","dotted"],s=At(()=>t?.featureType.replace("drawn","FeatureEditStyle"));function l(T){t.featureStyle={...t.featureStyle,color:T.target.value}}function u(T){t.featureStyle={...t.featureStyle,size:T}}function h(T){t.featureStyle={...t.featureStyle,angle:T*Math.PI/180}}function d(T){t.featureStyle={...t.featureStyle,stroke:T}}function m(T){t.featureStyle={...t.featureStyle,opacity:(100-T)/100}}function y(T){t.featureStyle={...t.featureStyle,showOrientation:T.target.checked}}function x(){JB(t)}function C(T){t.featureStyle={...t.featureStyle,linestyle:T}}function w(T,M){t.featureStyle={...t.featureStyle,shape:T,symbolId:void 0,symboltype:void 0},M&&M()}function S(T,M,G){t.featureStyle={...t.featureStyle,symbolId:T,symboltype:M,size:100,shape:void 0},G&&G()}return(T,M)=>(U(),Mt(sb(r[s.value]),{feature:k(t)},{title:Xt(()=>[Bt(K(k(e)("Style your drawing")),1)]),color:Xt(()=>[P("div",Zwe,[P("label",Wwe,K(k(e)("Color")),1),P("div",zwe,[P("input",{name:"color",class:"cursor-pointer",type:"color",value:k(t).featureStyle.color,onInput:l,"data-cy":"featStyleColor"},null,40,Uwe)])])]),size:Xt(G=>[P("div",Xwe,[P("label",Ywe,K(k(e)("Size")),1),mt(jx,{name:"size",class:"md:w-2/3",max:G.maxsize,value:k(t).featureStyle.size,"data-cy":"featStyleSize",onChange:u},null,8,["max","value"])])]),angle:Xt(()=>[i.value?(U(),oe("div",Hwe,[P("label",Kwe,K(k(e)("Angle")),1),mt(jx,{name:"angle",class:"md:w-2/3",min:-180,max:180,value:(Math.round(k(t).featureStyle.angle*180/Math.PI)+180)%360-180,onChange:h,"data-cy":"featStyleAngle"},null,8,["value"])])):Ge("",!0)]),style:Xt(()=>[P("div",jwe,[P("label",$we,K(k(e)("Style")),1),P("div",Jwe,[(U(),oe(Et,null,yi(o,(G,N)=>mt(dwe,{key:N,linestyle:G,onChangeLinestyle:C},null,8,["linestyle"])),64))])])]),styleSymbol:Xt(({openEditIcon:G})=>[mt(Cwe,{"data-cy":"featStyleSymbol",onClickSymbolIcon:G},null,8,["onClickSymbolIcon"])]),symbolIcon:Xt(({closeEditIcon:G})=>[mt(Bwe,{onChangeSymbolIcon:(N,V)=>S(N,V,G),onChangeSymbolShape:N=>w(N,G),onClose:G},{symbolcolor:Xt(()=>[P("div",qwe,[P("label",Qwe,K(k(e)("Color")),1),P("div",eAe,[P("input",{name:"color",class:"cursor-pointer",type:"color",value:k(t).featureStyle.color,onInput:l,"data-cy":"featStyleColor"},null,40,tAe)])])]),_:1},8,["onChangeSymbolIcon","onChangeSymbolShape","onClose"])]),lineWidth:Xt(()=>[P("div",nAe,[P("label",iAe,K(k(e)("Stroke width")),1),mt(jx,{name:"stroke","data-cy":"featStyleLineWidth",value:k(t).featureStyle.stroke,onChange:d},null,8,["value"])])]),transparency:Xt(()=>[P("div",rAe,[P("label",sAe,K(k(e)("Transparence")),1),mt(jx,{name:"transparency",class:"md:w-2/3","data-cy":"featStyleTransparency",max:100,value:100-k(t).featureStyle.opacity*100,onChange:m},null,8,["value"])])]),orientation:Xt(()=>[P("div",oAe,[P("label",aAe,K(k(e)("Show orientation")),1),P("input",{type:"checkbox",id:"showOrientation",onChange:y,checked:k(t).featureStyle.showOrientation},null,40,lAe)]),P("div",uAe,[P("button",{class:"lux-btn-primary",onClick:x},K(k(e)("Changer sens de la ligne")),1)])]),footer:Xt(()=>[Jn(T.$slots,"footer")]),_:3},8,["feature"]))}}),cAe={class:"flex gap-2 items-center"},hAe={class:"flex items-center"},dAe={class:"mt-3 text-right"},a3=st({__name:"feature-concentric-circle",emits:["cancel","validate"],setup(n,{emit:e}){const t=e,{t:i}=Ct(),r=Kn().getOlMap(),o=Go("feature"),s=Ke(parseFloat(Hv(o.getGeometry(),r.getView().getProjection()).toFixed(2)));return(l,u)=>(U(),oe(Et,null,[Bt(K(k(i)("Veuillez entrer les caractristiques de votre nouveau cercle"))+" ",1),P("div",cAe,[P("span",null,K(k(i)("Rayon:")),1),P("div",hAe,[Sn(P("input",{class:"form-control block bg-secondary border !border-gray-300 mr-1",type:"number","onUpdate:modelValue":u[0]||(u[0]=h=>s.value=h)},null,512),[[Zr,s.value,void 0,{number:!0}]]),P("span",null,K(k(i)("mtres")),1)])]),P("div",dAe,[P("button",{"data-cy":"featureEditCancel",class:"lux-btn mr-2",onClick:u[1]||(u[1]=h=>t("cancel"))},K(k(i)("Cancel")),1),P("button",{"data-cy":"featureEditValidate",class:"lux-btn-primary",onClick:u[2]||(u[2]=h=>t("validate",{radius:s.value,baseFeature:k(o)}))},K(k(i)("Validate")),1)])],64))}}),fAe={class:"lux-drawing-item-measurements"},pAe={key:0,"data-cy":"featItemLength"},gAe={key:1,"data-cy":"featItemArea"},mAe={key:2,"data-cy":"featItemRadius",class:"flex items-center"},yAe={key:0},_Ae={key:1,class:"flex"},vAe={key:3},bAe={"data-cy":"featItemElevation"},xAe=st({__name:"feature-measurements",props:{isEditingFeature:{type:Boolean}},setup(n){const{t:e}=Ct(),t=Jr(),i=Kn().getOlMap(),r=i.getView().getProjection(),o=Ke(Go("feature")),s=Ke(o.value?.featureType||""),l=Ke(o.value?.getGeometry()),u=At(()=>{if(l.value){if(["drawnLine","drawnPolygon"].includes(s.value))return Bp(l.value,r);if(s.value==="drawnCircle")return lle(l.value,r)}}),h=At(()=>{if(l.value){if(s.value==="drawnPolygon")return ET(l.value);if(s.value==="drawnCircle")return ule(l.value,r)}}),d=At(()=>l.value&&s.value==="drawnCircle"?Hv(l.value,r):void 0),m=Ke(d.value||0),y=Ke();Ss(async()=>{const C=l.value.getCoordinates();l.value&&s.value==="drawnPoint"?y.value?y.value=await qB(C):y.value=await Kv(C):y.value=void 0}),Ss(()=>{m.value=s.value==="drawnCircle"?parseFloat(Hv(l.value,r).toFixed(2)):0});function x(C){if(o.value){const w=o.value.getGeometry();w?.getType()==="Circle"&&(ek(w,C,i),t.updateDrawnFeature(o.value))}}return(C,w)=>{const S=Tl("format-measure");return U(),oe("div",fAe,[u.value?(U(),oe("div",pAe,[P("span",null,K(k(e)("Length:"))+"",1),Sn(P("span",null,null,512),[[S,u.value,void 0,{length:!0}]])])):Ge("",!0),h.value?(U(),oe("div",gAe,[P("span",null,K(k(e)("Area:"))+"",1),Sn(P("span",null,null,512),[[S,h.value,void 0,{area:!0}]])])):Ge("",!0),s.value==="drawnCircle"?(U(),oe("div",mAe,[P("span",null,K(k(e)("Rayon:"))+"",1),n.isEditingFeature?(U(),oe("div",_Ae,[Sn(P("input",{"data-cy":"featItemInputRadius",class:"form-control block bg-secondary border !border-gray-300",type:"number","onUpdate:modelValue":w[0]||(w[0]=T=>m.value=T),onKeyup:w[1]||(w[1]=Js(T=>x(m.value),["enter"]))},null,544),[[Zr,m.value,void 0,{number:!0}]]),P("button",{class:"lux-btn-primary",onClick:w[2]||(w[2]=T=>x(m.value))},K(k(e)("Valider")),1)])):Sn((U(),oe("span",yAe,null,512)),[[S,d.value,void 0,{length:!0}]])])):Ge("",!0),s.value==="drawnPoint"?(U(),oe("div",vAe,[P("span",null,K(k(e)("Elevation"))+":",1),Sn(P("span",bAe,null,512),[[S,y.value,"2",{elevation:!0}]])])):Ge("",!0),s.value==="drawnLine"?(U(),Mt(Ek,{key:4,class:"mb-2",feature:o.value},null,8,["feature"])):Ge("",!0)])}}}),IAe={key:1},CAe={class:"flex justify-between items-center mt-1 gap-2"},wAe={"data-cy":"featItemActions"},AAe={class:"flex text-primary items-center gap-1"},SAe={class:"mt-3 text-right"},EAe=st({__name:"feature-sub-content",props:{isDocked:{type:Boolean},isEditingFeature:{type:Boolean}},emits:["continueLine","toggleEditFeature","toggleDock","clickDelete","resetInfo","resetStyle","submitEditFeature","submitNewConcentricCircle"],setup(n,{emit:e}){const t=e,{t:i}=Ct(),r=Ef(),o=Go("feature"),s=At(()=>o.map_id?!!r.isMyMapEditable.value:!0);let l=o.label,u=o.description,h={...o.featureStyle};const d={FeatureConcentricCircle:a3,FeatureEditInfo:s3,FeatureEditStyle:o3,FeatureConfirmDelete:r3},m=Ke(void 0);Cw("currentEditCompKey",m);function y(){m.value==="FeatureEditStyle"?(o.selected=!0,t("resetStyle",h)):m.value==="FeatureEditInfo"&&t("resetInfo",l,u),m.value=void 0}function x(C){const w=d[m.value];switch(l=o.label,u=o.description,h={...o.featureStyle},w){case a3:t("submitNewConcentricCircle",C);break;case r3:t("clickDelete");break;case s3:case o3:o.selected=!0,t("submitEditFeature");break;default:alert("Not implemented")}m.value=void 0}return(C,w)=>m.value?(U(),Mt(sb(d[m.value]),{key:1,onCancel:y,onValidate:x},{footer:Xt(()=>[P("div",SAe,[P("button",{"data-cy":"featureEditCancel",class:"lux-btn mr-2",onClick:y},K(k(i)("Cancel")),1),P("button",{"data-cy":"featureEditValidate",class:"lux-btn-primary",onClick:x},K(k(i)("Validate")),1)])]),_:1},32)):(U(),oe(Et,{key:0},[n.isDocked?Ge("",!0):(U(),oe("i",{key:0,"data-cy":"featItemDock",class:"fa fa-object-ungroup float-right",role:"button",onClick:w[0]||(w[0]=()=>t("toggleDock"))})),n.isDocked?(U(),oe("h6",IAe,K(k(o)?.label),1)):Ge("",!0),w[12]||(w[12]=P("div",{class:"min-h-2"},null,-1)),mt(xAe,{isEditingFeature:n.isEditingFeature},null,8,["isEditingFeature"]),P("div",CAe,[P("div",null,[s.value?(U(),oe("button",{key:0,"data-cy":"featItemToggleEdit",class:"lux-btn-primary",onClick:w[1]||(w[1]=S=>t("toggleEditFeature"))},K(n.isEditingFeature?k(i)("Terminer dition"):k(i)("Editer l'objet")),1)):Ge("",!0)]),P("div",wAe,[P("div",AAe,[P("button",{"data-cy":"featItemActionSearch",class:"hover:text-tertiary",onClick:w[2]||(w[2]=()=>k(o)?.fit())},[...w[8]||(w[8]=[P("i",{class:"fa fa-search"},null,-1)])]),s.value?(U(),oe("button",{key:0,"data-cy":"featItemActionEdit",class:"hover:text-tertiary",onClick:w[3]||(w[3]=()=>m.value="FeatureEditInfo")},[...w[9]||(w[9]=[P("i",{class:"fa fa-pencil"},null,-1)])])):Ge("",!0),s.value?(U(),oe("button",{key:1,"data-cy":"featItemActionStyle",class:"hover:text-tertiary",onClick:w[4]||(w[4]=()=>m.value="FeatureEditStyle")},[...w[10]||(w[10]=[P("i",{class:"fa fa-paint-brush"},null,-1)])])):Ge("",!0),s.value?(U(),oe("button",{key:2,"data-cy":"featItemActionDelete",class:"hover:text-tertiary",onClick:w[5]||(w[5]=()=>m.value="FeatureConfirmDelete")},[...w[11]||(w[11]=[P("i",{class:"fa fa-trash"},null,-1)])])):Ge("",!0),mt(iwe,{onContinueLine:w[6]||(w[6]=S=>t("continueLine")),onNewConcentricCircle:w[7]||(w[7]=()=>m.value="FeatureConcentricCircle")})])])])],64))}}),TAe=st({__name:"map-popup",props:{anchor:{}},emits:["closePopup"],setup(n,{emit:e}){const t=n,i=e,r=Kn(),o=Ke(null),s=Ei(new Vp({autoPan:{animation:{duration:250}}}));return gr(()=>{o.value&&(s.value.setElement(o.value),r.getOlMap().addOverlay(s.value))}),Ss(()=>{s.value.setPosition(t.anchor)}),(l,u)=>(U(),Mt(bw,{to:"body"},[P("div",{ref_key:"popupContainer",ref:o,"data-cy":"mapPopup",class:"popup"},[P("button",{class:"fa-sharp fa-solid fa-close float-right mt-2 hover:text-primary",onClick:u[0]||(u[0]=()=>i("closePopup"))}),Jn(l.$slots,"default")],512)]))}});function l3(n){const e=n.getGeometry();let t;if(e)switch(e.getType()){case"Point":t=e.getFlatCoordinates();break;case"LineString":t=e.getFlatMidpoint();break;case"Polygon":t=e.getFlatInteriorPoint();break;case"Circle":t=e.getCenter();break;case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":default:console.warn(`getFeatCoordinates: Geometry type ${e.getType()} not supported, please convert to a supported geometry type before calling this function.`);break}return t}const RAe=st({__name:"feature-sub-wrapper",props:{isDocked:{type:Boolean}},emits:["closePopup"],setup(n,{emit:e}){const t=e,i=Go("feature"),r=Ke(l());function o(){t("closePopup")}const s=uy(()=>{r.value=l()},1e3);function l(){return JSON.parse(JSON.stringify(l3(i)))}return Ss(()=>{i?.getGeometry()&&l3(i)&&s()}),(u,h)=>n.isDocked?(U(),Mt(TAe,{key:0,anchor:r.value,onClosePopup:o},{default:Xt(()=>[Jn(u.$slots,"default")]),_:3},8,["anchor"])):Jn(u.$slots,"default",{key:1})}}),MAe=["aria-expanded","aria-controls"],kAe=["id"],LAe=st({__name:"feature-item",props:{isDocked:{type:Boolean,default:!1},isEditing:{type:Boolean,default:!1},isOpen:{type:Boolean,default:!1},feature:{}},emits:["clickDelete","closePopup","continueLine","toggleFeatureSub","toggleEditFeature","toggleDock","submitFeature","submitNewConcentricCircle"],setup(n,{emit:e}){const t=n,i=t.feature,r=e;Cw("feature",i);function o(){r("toggleFeatureSub",i.id,!t.isOpen)}function s(){r("toggleEditFeature",i.id,!t.isEditing)}function l(){r("clickDelete",i.id)}function u(y,x){i.label=y,i.description=x}function h(y){i.featureStyle={...y}}function d(){r("submitFeature",i)}function m(y,x){r("submitNewConcentricCircle",y,x)}return(y,x)=>(U(),oe(Et,null,[P("button",{"data-cy":"featItemName",class:"lux-drawing-item-label flex items-center gap-1","aria-expanded":n.isOpen,"aria-controls":`drawing-item-content-${k(i).id}`,onClick:o},[x[3]||(x[3]=P("span",{class:"sortable-handle drag-handle fa fa-reorder ui-sortable-handle cursor-move"},null,-1)),P("span",{class:Dn(["lux-icon",{point:k(i).featureType==="drawnPoint"||k(i).featureType==="drawnLabel",line:k(i).featureType==="drawnLine",polygon:k(i).featureType==="drawnPolygon"||k(i).featureType==="drawnCircle"}])},null,2),P("span",{class:Dn({selected:n.isOpen})},K(k(i).label),3)],8,MAe),n.isOpen?(U(),Mt(RAe,{key:0,isDocked:n.isDocked,onClosePopup:x[2]||(x[2]=()=>r("toggleDock"))},{default:Xt(()=>[P("div",{class:"lux-drawing-item-content",id:`drawing-item-content-${k(i).id}`},[mt(EAe,{isDocked:n.isDocked,isEditingFeature:n.isEditing,onToggleEditFeature:s,onToggleDock:x[0]||(x[0]=()=>r("toggleDock")),onClickDelete:l,onContinueLine:x[1]||(x[1]=()=>r("continueLine")),onResetInfo:u,onResetStyle:h,onSubmitEditFeature:d,onSubmitNewConcentricCircle:m},null,8,["isDocked","isEditingFeature"])],8,kAe)]),_:1},8,["isDocked"])):Ge("",!0)],64))}}),PAe=["aria-activedescendant"],GAe=["id","tabindex","aria-selected","onFocus"],yz=st({__name:"features-list",props:{features:{},idPrefix:{}},setup(n){const e=Jr(),t=hle(),{activeFeatureId:i,editingFeatureId:r,editStateActive:o,featureEditionDocked:s,drawnFeatures:l}=xt(e),u=Ke(),h=vv("sortableFeatures");let d;function m(M){u.value=M}function y(M){if(M.key==="Tab"||!["ArrowDown","ArrowUp"," "].includes(M.key))return;if(M.preventDefault(),M.stopImmediatePropagation(),M.key===" "){u.value&&(i.value=i.value===u.value?void 0:u.value);return}const G=n.features.findIndex(V=>V.id===u.value),N=G===-1?0:G;if(M.key==="ArrowDown"){const V=(N+1)%n.features.length;u.value=n.features[V].id}else{const V=(N-1+n.features.length)%n.features.length;u.value=n.features[V].id}aa(()=>document.getElementById(`${n.idPrefix}-${u.value}`)?.focus())}function x(M){M.fit(),t.continueLine(M)}function C(M,G){i.value=G?M:void 0,r.value=void 0,u.value=G?M:void 0,G&&aa(()=>{document.getElementById(`${n.idPrefix}-${M}`)?.focus()})}function w(M,G){if(G){if(r.value===M)return;i.value=M,u.value=M;const N=l.value.find(V=>V.id===M);if(N){if(!N.editable)return;r.value=M,o.value=N.featureType.replace("drawn","edit").replace("Continue","")}}else{if(r.value===void 0)return;const N=l.value.find(V=>V.id===M);N&&N.changed(),r.value=void 0,o.value=void 0}}function S(M){const{baseFeature:G,radius:N}=M,V=t.createConcentricCircle(G,N);e.addDrawnFeatureToCollection(V),e.selectDrawnFeature(V)}function T(M){const G=[...M].map(N=>N.id);e.reorderFeatures(G)}return kt(h,M=>{M?d=oR(M,{onSort:T}):(d?.destroy(),d=void 0)}),(M,G)=>n.features.length?(U(),oe("ul",{key:0,class:"mx-1 sortable-features",ref_key:"sortableFeatures",ref:h,role:"listbox","aria-label":"Liste des objets dessins","aria-activedescendant":u.value?`${n.idPrefix}-${u.value}`:void 0,onKeydown:y},[(U(!0),oe(Et,null,yi(n.features,N=>(U(),oe("li",{class:"lux-drawing-item",id:`${n.idPrefix}-${N.id}`,key:N.id,role:"option",tabindex:k(i)===N.id?0:-1,"aria-selected":k(i)===N.id,onFocus:()=>m(N.id)},[mt(LAe,{isDocked:k(s),isEditing:k(r)===N.id,isOpen:k(i)===N.id,feature:N,onToggleFeatureSub:C,onToggleEditFeature:w,onToggleDock:G[0]||(G[0]=()=>s.value=!k(s)),onClosePopup:G[1]||(G[1]=()=>s.value=!1),onClickDelete:G[2]||(G[2]=V=>k(e).removeFeature(V)),onContinueLine:()=>x(N),onSubmitFeature:V=>k(e).updateDrawnFeature(V),onSubmitNewConcentricCircle:S},null,8,["isDocked","isEditing","isOpen","feature","onContinueLine","onSubmitFeature"])],40,GAe))),128))],40,PAe)):Ge("",!0)}}),FAe=st({__name:"draw-panel-features",setup(n){const e=Jr(),{drawnFeaturesExceptMyMaps:t}=xt(e);return(i,r)=>(U(),Mt(yz,{features:k(t),idPrefix:"draw"},null,8,["features"]))}}),OAe={class:"text-lg"},NAe={class:"flex flex-row justify-end gap-2"},DAe=st({__name:"modal-confirm-delete-all",emits:["cancel","confirm"],setup(n,{emit:e}){const t=e,{t:i}=Ct();return(r,o)=>(U(),Mt(Rf,{title:k(i)("Confirmation de suppression des dessins"),onClose:o[2]||(o[2]=s=>t("cancel"))},{content:Xt(()=>[P("p",OAe,K(k(i)("Etes-vous certain de vouloir effacer tous les dessins ?")),1)]),footer:Xt(()=>[P("div",NAe,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:o[0]||(o[0]=s=>t("cancel"))},K(k(i)("Annuler")),1),P("button",{class:"lux-btn","data-dismiss":"modal",onClick:o[1]||(o[1]=s=>t("confirm"))},K(k(i)("Effacer")),1)])]),_:1},8,["title"]))}}),VAe={class:"flex flex-col gap-4"},BAe={class:"flex flex-col"},ZAe={for:"mergedLineName",class:"lux-label"},WAe={class:"flex flex-col"},zAe={for:"mergedLineDescription",class:"lux-label"},UAe={class:"list-unstyled ml-2"},XAe=["id","value"],YAe=["for"],HAe={class:"flex flex-row justify-end gap-2"},KAe=["disabled"],jAe=st({__name:"modal-merge-lines",setup(n){const{addNotification:e}=ns(),{t}=Ct(),i=Jr(),{showModalMergeLines:r}=xt(i),o=Ke(t("Nouvelle ligne")),s=Ke(""),l=Ke([]);kt(r,h=>{h&&i.getDrawnFeaturesOfTypes(["LineString","MultiLineString"]).length<=1&&(e(t("Il faut au moins 2 lignes disponibles pour pouvoir les fusionner."),mi.WARNING),i.toggleDrawMergeLinesModal(!1))});function u(){const h=i.getDrawnFeaturesWithIds(l.value),d=cle(h);d&&(d.label=o.value,d.description=s.value),i.toggleDrawMergeLinesModal(!1)}return(h,d)=>k(r)?(U(),Mt(Rf,{key:0,title:k(t)("Fusionner des lignes"),onClose:d[4]||(d[4]=m=>k(i).toggleDrawMergeLinesModal(!1))},{content:Xt(()=>[P("form",VAe,[P("div",BAe,[P("label",ZAe,K(k(t)("Nouveau nom")),1),Sn(P("input",{id:"mergedLineName",class:"lux-input",type:"text","onUpdate:modelValue":d[0]||(d[0]=m=>o.value=m)},null,512),[[Zr,o.value]])]),P("div",WAe,[P("label",zAe,K(k(t)("Nouvelle description")),1),Sn(P("textarea",{id:"mergedLineDescription",class:"lux-input",rows:"3","onUpdate:modelValue":d[1]||(d[1]=m=>s.value=m)},null,512),[[Zr,s.value]])]),P("ul",UAe,[(U(!0),oe(Et,null,yi(k(i).getDrawnFeaturesOfTypes(["LineString","MultiLineString"]),m=>(U(),oe("li",{key:m.id},[Sn(P("input",{id:`featureLine-${m.id}`,type:"checkbox",class:"hidden",value:m.id,"onUpdate:modelValue":d[2]||(d[2]=y=>l.value=y)},null,8,XAe),[[Yh,l.value]]),P("label",{for:`featureLine-${m.id}`},[P("i",{class:Dn(["fa fa-solid mr-2",`${l.value.find(y=>y===m.id)?"fa-check-square":"fa-square"}`])},null,2),Bt(" "+K(m.label),1)],8,YAe)]))),128))])])]),footer:Xt(()=>[P("div",HAe,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:d[3]||(d[3]=m=>k(i).toggleDrawMergeLinesModal(!1))},K(k(t)("Annuler")),1),P("button",{class:"lux-btn","data-dismiss":"modal",onClick:u,disabled:l.value.length<2},K(k(t)("Fusionner")),9,KAe)])]),_:1},8,["title"])):Ge("",!0)}}),$Ae={class:"lux-draw-panel absolute w-[93%]","data-cy":"drawPanel"},JAe={class:"lux-draw-panel-title flex"},qAe={class:"grow"},QAe=st({__name:"draw-panel",emits:["moveInMyMap","createNewMyMap"],setup(n,{emit:e}){const t=e,{t:i}=Ct(),r=oi(),o=nwe(),{toggleMyMapsOpen:s}=r,{feedbackOpen:l,feedbackanfOpen:u,feedbackageOpen:h,feedbackcruesOpen:d}=xt(r),m=Jr(),{drawnFeaturesExceptMyMaps:y,clipLineActive:x}=xt(m),C=Ef(),w=At(()=>{const M=[{label:"Effacer tous les dessins",action:()=>S.value=!0},{label:"Crer une nouvelle carte  partir de ces dessins",action:()=>t("createNewMyMap")},{label:"Fusionner des lignes",action:()=>m.toggleDrawMergeLinesModal(!0)},{label:x.value?"Dsactiver mode couper une ligne":"Couper une ligne",action:()=>{o.toggle(),m.deactivateDraw()}}];return C.isMyMapEditable.value&&M.unshift({label:"Copier dans ma carte",action:()=>t("moveInMyMap")}),M}),S=Ke(!1);function T(){m.removeAllFeatures()}return kt(y,()=>{Pk("md")&&l.value!==!0&&u.value!==!0&&h.value!==!0&&d.value!==!0&&s(!0)}),(M,G)=>(U(),oe(Et,null,[k(y).length>0?(U(),oe(Et,{key:0},[G[3]||(G[3]=P("hr",{class:"separator my-5"},null,-1)),P("div",$Ae,[P("div",JAe,[P("h5",qAe,K(k(i)("Dessins")),1),mt(Ok,{"data-cy":"drawPanelMenuPopup",items:w.value,direction:"down",ariaLabel:k(i)("Drawings menu")},{item:Xt(({item:N})=>[mt(Nk,{"data-cy":"drawPanelMenuPopupItem",item:N,onClick:N.action},{default:Xt(()=>[Bt(K(k(i)(N.label)),1)]),_:2},1032,["item","onClick"])]),default:Xt(()=>[G[2]||(G[2]=P("i",{class:"fa-solid fa-square-caret-down hover:text-tertiary"},null,-1))]),_:1},8,["items","ariaLabel"])]),mt(FAe)]),S.value?(U(),Mt(DAe,{key:0,onCancel:G[0]||(G[0]=()=>S.value=!1),onConfirm:G[1]||(G[1]=()=>{S.value=!1,T()})})):Ge("",!0)],64)):Ge("",!0),mt(jAe)],64))}}),e2e=is(QAe,[["__scopeId","data-v-35e42ace"]]);var bu=(n=>(n.COPY="copy",n.CREATE="create",n.CREATE_FROM_FEATURES="create_from_features",n.EDIT="edit",n))(bu||{});const t2e={class:"flex flex-col gap-4"},n2e={class:"flex flex-col"},i2e={for:"map-title-input"},r2e={class:"ml-2 hover:cursor-pointer",for:"mapIsPublic"},s2e={for:"category-select",class:"sr-only"},o2e={class:"flex flex-col"},a2e={for:"map-description-input"},l2e={class:"flex flex-row justify-end gap-2"},u2e=st({__name:"my-map-edit-form",props:{map:{},mode:{}},emits:["cancel","confirm"],setup(n,{emit:e}){const t=e,i=n,{t:r}=Ct(),{addNotification:o}=ns(),s=Ef(),l=oi(),{myMapId:u}=xt(l),h=Wi(),{bgLayer:d}=xt(h),m=Vr(),{theme:y}=xt(m),x=i.map&&i.mode===bu.COPY,C=Ke(i.map?i.map.public:!1),w=Ke(i.map?i.map.title:r("Map without Title")),S=Ke(i.map?i.map.description:""),T=Ke(i.map?i.map.category_id+"":void 0),M=Ei([]),G=At(()=>M.value.map(V=>({label:V.name,value:""+V.id})));async function N(){const V=T.value?parseInt(T.value,10):999;let W;try{i.map&&i.mode===bu.COPY?W=await Fae(i.map.uuid,w.value,S.value,V,C.value):i.map&&i.mode===bu.EDIT?W=await Gae(i.map.uuid,w.value,S.value,V,C.value):(W=await Pae(w.value,S.value,V,C.value),await WB(W.uuid,d.value?.name||"",1,"","","","",y.value?.name||""),W?.success&&i.mode===bu.CREATE_FROM_FEATURES&&(u.value=W.uuid,aa(()=>{s.addInMyMap()}))),W?.success?t("confirm",W.uuid):t("cancel")}catch(j){o(j,mi.ERROR)}}return fN(async()=>{M.value=await Lae()}),(V,W)=>(U(),Mt(Rf,{title:k(x)?k(r)("Modify title and description of the map"):k(r)("Title and description of the map"),onClose:W[6]||(W[6]=j=>t("cancel"))},{content:Xt(()=>[P("form",t2e,[P("div",n2e,[P("label",i2e,K(k(r)("Titre de la carte")),1),Sn(P("input",{id:"map-title-input",class:"lux-input",type:"text","onUpdate:modelValue":W[0]||(W[0]=j=>w.value=j),required:"","aria-required":!0},null,512),[[Zr,w.value]])]),P("div",null,[Sn(P("input",{id:"mapIsPublic","onUpdate:modelValue":W[1]||(W[1]=j=>C.value=j),type:"checkbox"},null,512),[[Yh,C.value]]),P("label",r2e,K(k(r)("Public Map")),1)]),P("div",null,[P("label",s2e,K(k(r)("Please select a Category")),1),mt(eg,{id:"category-select",class:"min-w-36",placeholder:k(r)("Please select a Category"),options:G.value,modelValue:T.value,"onUpdate:modelValue":W[2]||(W[2]=j=>T.value=j),onChange:W[3]||(W[3]=j=>T.value=j),"aria-label":k(r)("Please select a Category")},null,8,["placeholder","options","modelValue","aria-label"])]),P("div",o2e,[P("label",a2e,K(k(r)("Description")),1),Sn(P("textarea",{id:"map-description-input",class:"lux-input",rows:"3","onUpdate:modelValue":W[4]||(W[4]=j=>S.value=j)},null,512),[[Zr,S.value]])])])]),footer:Xt(()=>[P("div",l2e,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:W[5]||(W[5]=j=>t("cancel"))},K(k(r)("Annuler")),1),P("button",{class:"lux-btn-primary","data-dismiss":"modal",onClick:N},K(n.map&&!k(x)?k(r)("Save changes"):k(r)("Save new map")),1)])]),_:1},8,["title"]))}});function $x(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var oE={exports:{}};var u3;function c2e(){return u3||(u3=1,(function(n,e){(function(t){n.exports=t()})(function(){return(function t(i,r,o){function s(h,d){if(!r[h]){if(!i[h]){var m=typeof $x=="function"&&$x;if(!d&&m)return m(h,!0);if(l)return l(h,!0);var y=new Error("Cannot find module '"+h+"'");throw y.code="MODULE_NOT_FOUND",y}var x=r[h]={exports:{}};i[h][0].call(x.exports,function(C){var w=i[h][1][C];return s(w||C)},x,x.exports,t,i,r,o)}return r[h].exports}for(var l=typeof $x=="function"&&$x,u=0;u<o.length;u++)s(o[u]);return s})({1:[function(t,i,r){var o=t("./utils"),s=t("./support"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(u){for(var h,d,m,y,x,C,w,S=[],T=0,M=u.length,G=M,N=o.getTypeOf(u)!=="string";T<u.length;)G=M-T,m=N?(h=u[T++],d=T<M?u[T++]:0,T<M?u[T++]:0):(h=u.charCodeAt(T++),d=T<M?u.charCodeAt(T++):0,T<M?u.charCodeAt(T++):0),y=h>>2,x=(3&h)<<4|d>>4,C=1<G?(15&d)<<2|m>>6:64,w=2<G?63&m:64,S.push(l.charAt(y)+l.charAt(x)+l.charAt(C)+l.charAt(w));return S.join("")},r.decode=function(u){var h,d,m,y,x,C,w=0,S=0,T="data:";if(u.substr(0,T.length)===T)throw new Error("Invalid base64 input, it looks like a data url.");var M,G=3*(u=u.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(u.charAt(u.length-1)===l.charAt(64)&&G--,u.charAt(u.length-2)===l.charAt(64)&&G--,G%1!=0)throw new Error("Invalid base64 input, bad content length.");for(M=s.uint8array?new Uint8Array(0|G):new Array(0|G);w<u.length;)h=l.indexOf(u.charAt(w++))<<2|(y=l.indexOf(u.charAt(w++)))>>4,d=(15&y)<<4|(x=l.indexOf(u.charAt(w++)))>>2,m=(3&x)<<6|(C=l.indexOf(u.charAt(w++))),M[S++]=h,x!==64&&(M[S++]=d),C!==64&&(M[S++]=m);return M}},{"./support":30,"./utils":32}],2:[function(t,i,r){var o=t("./external"),s=t("./stream/DataWorker"),l=t("./stream/Crc32Probe"),u=t("./stream/DataLengthProbe");function h(d,m,y,x,C){this.compressedSize=d,this.uncompressedSize=m,this.crc32=y,this.compression=x,this.compressedContent=C}h.prototype={getContentWorker:function(){var d=new s(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new u("data_length")),m=this;return d.on("end",function(){if(this.streamInfo.data_length!==m.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),d},getCompressedWorker:function(){return new s(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(d,m,y){return d.pipe(new l).pipe(new u("uncompressedSize")).pipe(m.compressWorker(y)).pipe(new u("compressedSize")).withStreamInfo("compression",m)},i.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,r){var o=t("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},r.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,r){var o=t("./utils"),s=(function(){for(var l,u=[],h=0;h<256;h++){l=h;for(var d=0;d<8;d++)l=1&l?3988292384^l>>>1:l>>>1;u[h]=l}return u})();i.exports=function(l,u){return l!==void 0&&l.length?o.getTypeOf(l)!=="string"?(function(h,d,m,y){var x=s,C=y+m;h^=-1;for(var w=y;w<C;w++)h=h>>>8^x[255&(h^d[w])];return-1^h})(0|u,l,l.length,0):(function(h,d,m,y){var x=s,C=y+m;h^=-1;for(var w=y;w<C;w++)h=h>>>8^x[255&(h^d.charCodeAt(w))];return-1^h})(0|u,l,l.length,0):0}},{"./utils":32}],5:[function(t,i,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(t,i,r){var o=null;o=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:o}},{lie:37}],7:[function(t,i,r){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=t("pako"),l=t("./utils"),u=t("./stream/GenericWorker"),h=o?"uint8array":"array";function d(m,y){u.call(this,"FlateWorker/"+m),this._pako=null,this._pakoAction=m,this._pakoOptions=y,this.meta={}}r.magic="\b\0",l.inherits(d,u),d.prototype.processChunk=function(m){this.meta=m.meta,this._pako===null&&this._createPako(),this._pako.push(l.transformTo(h,m.data),!1)},d.prototype.flush=function(){u.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},d.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this._pako=null},d.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var m=this;this._pako.onData=function(y){m.push({data:y,meta:m.meta})}},r.compressWorker=function(m){return new d("Deflate",m)},r.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,r){function o(x,C){var w,S="";for(w=0;w<C;w++)S+=String.fromCharCode(255&x),x>>>=8;return S}function s(x,C,w,S,T,M){var G,N,V=x.file,W=x.compression,j=M!==h.utf8encode,J=l.transformTo("string",M(V.name)),te=l.transformTo("string",h.utf8encode(V.name)),ce=V.comment,pe=l.transformTo("string",M(ce)),Y=l.transformTo("string",h.utf8encode(ce)),he=te.length!==V.name.length,D=Y.length!==ce.length,re="",le="",fe="",Le=V.dir,we=V.date,se={crc32:0,compressedSize:0,uncompressedSize:0};C&&!w||(se.crc32=x.crc32,se.compressedSize=x.compressedSize,se.uncompressedSize=x.uncompressedSize);var Q=0;C&&(Q|=8),j||!he&&!D||(Q|=2048);var q=0,$e=0;Le&&(q|=16),T==="UNIX"?($e=798,q|=(function(qe,Lt){var Pt=qe;return qe||(Pt=Lt?16893:33204),(65535&Pt)<<16})(V.unixPermissions,Le)):($e=20,q|=(function(qe){return 63&(qe||0)})(V.dosPermissions)),G=we.getUTCHours(),G<<=6,G|=we.getUTCMinutes(),G<<=5,G|=we.getUTCSeconds()/2,N=we.getUTCFullYear()-1980,N<<=4,N|=we.getUTCMonth()+1,N<<=5,N|=we.getUTCDate(),he&&(le=o(1,1)+o(d(J),4)+te,re+="up"+o(le.length,2)+le),D&&(fe=o(1,1)+o(d(pe),4)+Y,re+="uc"+o(fe.length,2)+fe);var Qe="";return Qe+=`
\0`,Qe+=o(Q,2),Qe+=W.magic,Qe+=o(G,2),Qe+=o(N,2),Qe+=o(se.crc32,4),Qe+=o(se.compressedSize,4),Qe+=o(se.uncompressedSize,4),Qe+=o(J.length,2),Qe+=o(re.length,2),{fileRecord:m.LOCAL_FILE_HEADER+Qe+J+re,dirRecord:m.CENTRAL_FILE_HEADER+o($e,2)+Qe+o(pe.length,2)+"\0\0\0\0"+o(q,4)+o(S,4)+J+re+pe}}var l=t("../utils"),u=t("../stream/GenericWorker"),h=t("../utf8"),d=t("../crc32"),m=t("../signature");function y(x,C,w,S){u.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=C,this.zipPlatform=w,this.encodeFileName=S,this.streamFiles=x,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}l.inherits(y,u),y.prototype.push=function(x){var C=x.meta.percent||0,w=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(x):(this.bytesWritten+=x.data.length,u.prototype.push.call(this,{data:x.data,meta:{currentFile:this.currentFile,percent:w?(C+100*(w-S-1))/w:100}}))},y.prototype.openedSource=function(x){this.currentSourceOffset=this.bytesWritten,this.currentFile=x.file.name;var C=this.streamFiles&&!x.file.dir;if(C){var w=s(x,C,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:w.fileRecord,meta:{percent:0}})}else this.accumulate=!0},y.prototype.closedSource=function(x){this.accumulate=!1;var C=this.streamFiles&&!x.file.dir,w=s(x,C,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(w.dirRecord),C)this.push({data:(function(S){return m.DATA_DESCRIPTOR+o(S.crc32,4)+o(S.compressedSize,4)+o(S.uncompressedSize,4)})(x),meta:{percent:100}});else for(this.push({data:w.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},y.prototype.flush=function(){for(var x=this.bytesWritten,C=0;C<this.dirRecords.length;C++)this.push({data:this.dirRecords[C],meta:{percent:100}});var w=this.bytesWritten-x,S=(function(T,M,G,N,V){var W=l.transformTo("string",V(N));return m.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(T,2)+o(T,2)+o(M,4)+o(G,4)+o(W.length,2)+W})(this.dirRecords.length,w,x,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},y.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},y.prototype.registerPrevious=function(x){this._sources.push(x);var C=this;return x.on("data",function(w){C.processChunk(w)}),x.on("end",function(){C.closedSource(C.previous.streamInfo),C._sources.length?C.prepareNextSource():C.end()}),x.on("error",function(w){C.error(w)}),this},y.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},y.prototype.error=function(x){var C=this._sources;if(!u.prototype.error.call(this,x))return!1;for(var w=0;w<C.length;w++)try{C[w].error(x)}catch{}return!0},y.prototype.lock=function(){u.prototype.lock.call(this);for(var x=this._sources,C=0;C<x.length;C++)x[C].lock()},i.exports=y},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,r){var o=t("../compressions"),s=t("./ZipFileWorker");r.generateWorker=function(l,u,h){var d=new s(u.streamFiles,h,u.platform,u.encodeFileName),m=0;try{l.forEach(function(y,x){m++;var C=(function(M,G){var N=M||G,V=o[N];if(!V)throw new Error(N+" is not a valid compression method !");return V})(x.options.compression,u.compression),w=x.options.compressionOptions||u.compressionOptions||{},S=x.dir,T=x.date;x._compressWorker(C,w).withStreamInfo("file",{name:y,dir:S,date:T,comment:x.comment||"",unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions}).pipe(d)}),d.entriesCount=m}catch(y){d.error(y)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,r){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new o;for(var l in this)typeof this[l]!="function"&&(s[l]=this[l]);return s}}(o.prototype=t("./object")).loadAsync=t("./load"),o.support=t("./support"),o.defaults=t("./defaults"),o.version="3.10.1",o.loadAsync=function(s,l){return new o().loadAsync(s,l)},o.external=t("./external"),i.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,r){var o=t("./utils"),s=t("./external"),l=t("./utf8"),u=t("./zipEntries"),h=t("./stream/Crc32Probe"),d=t("./nodejsUtils");function m(y){return new s.Promise(function(x,C){var w=y.decompressed.getContentWorker().pipe(new h);w.on("error",function(S){C(S)}).on("end",function(){w.streamInfo.crc32!==y.decompressed.crc32?C(new Error("Corrupted zip : CRC32 mismatch")):x()}).resume()})}i.exports=function(y,x){var C=this;return x=o.extend(x||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:l.utf8decode}),d.isNode&&d.isStream(y)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",y,!0,x.optimizedBinaryString,x.base64).then(function(w){var S=new u(x);return S.load(w),S}).then(function(w){var S=[s.Promise.resolve(w)],T=w.files;if(x.checkCRC32)for(var M=0;M<T.length;M++)S.push(m(T[M]));return s.Promise.all(S)}).then(function(w){for(var S=w.shift(),T=S.files,M=0;M<T.length;M++){var G=T[M],N=G.fileNameStr,V=o.resolve(G.fileNameStr);C.file(V,G.decompressed,{binary:!0,optimizedBinaryString:!0,date:G.date,dir:G.dir,comment:G.fileCommentStr.length?G.fileCommentStr:null,unixPermissions:G.unixPermissions,dosPermissions:G.dosPermissions,createFolders:x.createFolders}),G.dir||(C.file(V).unsafeOriginalName=N)}return S.zipComment.length&&(C.comment=S.zipComment),C})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,r){var o=t("../utils"),s=t("../stream/GenericWorker");function l(u,h){s.call(this,"Nodejs stream input adapter for "+u),this._upstreamEnded=!1,this._bindStream(h)}o.inherits(l,s),l.prototype._bindStream=function(u){var h=this;(this._stream=u).pause(),u.on("data",function(d){h.push({data:d,meta:{percent:0}})}).on("error",function(d){h.isPaused?this.generatedError=d:h.error(d)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},l.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=l},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,r){var o=t("readable-stream").Readable;function s(l,u,h){o.call(this,u),this._helper=l;var d=this;l.on("data",function(m,y){d.push(m)||d._helper.pause(),h&&h(y)}).on("error",function(m){d.emit("error",m)}).on("end",function(){d.push(null)})}t("../utils").inherits(s,o),s.prototype._read=function(){this._helper.resume()},i.exports=s},{"../utils":32,"readable-stream":16}],14:[function(t,i,r){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,s);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,s)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var s=new Buffer(o);return s.fill(0),s},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(t,i,r){function o(V,W,j){var J,te=l.getTypeOf(W),ce=l.extend(j||{},d);ce.date=ce.date||new Date,ce.compression!==null&&(ce.compression=ce.compression.toUpperCase()),typeof ce.unixPermissions=="string"&&(ce.unixPermissions=parseInt(ce.unixPermissions,8)),ce.unixPermissions&&16384&ce.unixPermissions&&(ce.dir=!0),ce.dosPermissions&&16&ce.dosPermissions&&(ce.dir=!0),ce.dir&&(V=T(V)),ce.createFolders&&(J=S(V))&&M.call(this,J,!0);var pe=te==="string"&&ce.binary===!1&&ce.base64===!1;j&&j.binary!==void 0||(ce.binary=!pe),(W instanceof m&&W.uncompressedSize===0||ce.dir||!W||W.length===0)&&(ce.base64=!1,ce.binary=!0,W="",ce.compression="STORE",te="string");var Y=null;Y=W instanceof m||W instanceof u?W:C.isNode&&C.isStream(W)?new w(V,W):l.prepareContent(V,W,ce.binary,ce.optimizedBinaryString,ce.base64);var he=new y(V,Y,ce);this.files[V]=he}var s=t("./utf8"),l=t("./utils"),u=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),d=t("./defaults"),m=t("./compressedObject"),y=t("./zipObject"),x=t("./generate"),C=t("./nodejsUtils"),w=t("./nodejs/NodejsStreamInputAdapter"),S=function(V){V.slice(-1)==="/"&&(V=V.substring(0,V.length-1));var W=V.lastIndexOf("/");return 0<W?V.substring(0,W):""},T=function(V){return V.slice(-1)!=="/"&&(V+="/"),V},M=function(V,W){return W=W!==void 0?W:d.createFolders,V=T(V),this.files[V]||o.call(this,V,null,{dir:!0,createFolders:W}),this.files[V]};function G(V){return Object.prototype.toString.call(V)==="[object RegExp]"}var N={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(V){var W,j,J;for(W in this.files)J=this.files[W],(j=W.slice(this.root.length,W.length))&&W.slice(0,this.root.length)===this.root&&V(j,J)},filter:function(V){var W=[];return this.forEach(function(j,J){V(j,J)&&W.push(J)}),W},file:function(V,W,j){if(arguments.length!==1)return V=this.root+V,o.call(this,V,W,j),this;if(G(V)){var J=V;return this.filter(function(ce,pe){return!pe.dir&&J.test(ce)})}var te=this.files[this.root+V];return te&&!te.dir?te:null},folder:function(V){if(!V)return this;if(G(V))return this.filter(function(te,ce){return ce.dir&&V.test(te)});var W=this.root+V,j=M.call(this,W),J=this.clone();return J.root=j.name,J},remove:function(V){V=this.root+V;var W=this.files[V];if(W||(V.slice(-1)!=="/"&&(V+="/"),W=this.files[V]),W&&!W.dir)delete this.files[V];else for(var j=this.filter(function(te,ce){return ce.name.slice(0,V.length)===V}),J=0;J<j.length;J++)delete this.files[j[J].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(V){var W,j={};try{if((j=l.extend(V||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=j.type.toLowerCase(),j.compression=j.compression.toUpperCase(),j.type==="binarystring"&&(j.type="string"),!j.type)throw new Error("No output type specified.");l.checkSupport(j.type),j.platform!=="darwin"&&j.platform!=="freebsd"&&j.platform!=="linux"&&j.platform!=="sunos"||(j.platform="UNIX"),j.platform==="win32"&&(j.platform="DOS");var J=j.comment||this.comment||"";W=x.generateWorker(this,j,J)}catch(te){(W=new u("error")).error(te)}return new h(W,j.type||"string",j.mimeType)},generateAsync:function(V,W){return this.generateInternalStream(V).accumulate(W)},generateNodeStream:function(V,W){return(V=V||{}).type||(V.type="nodebuffer"),this.generateInternalStream(V).toNodejsStream(W)}};i.exports=N},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,r){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,r){var o=t("./DataReader");function s(l){o.call(this,l);for(var u=0;u<this.data.length;u++)l[u]=255&l[u]}t("../utils").inherits(s,o),s.prototype.byteAt=function(l){return this.data[this.zero+l]},s.prototype.lastIndexOfSignature=function(l){for(var u=l.charCodeAt(0),h=l.charCodeAt(1),d=l.charCodeAt(2),m=l.charCodeAt(3),y=this.length-4;0<=y;--y)if(this.data[y]===u&&this.data[y+1]===h&&this.data[y+2]===d&&this.data[y+3]===m)return y-this.zero;return-1},s.prototype.readAndCheckSignature=function(l){var u=l.charCodeAt(0),h=l.charCodeAt(1),d=l.charCodeAt(2),m=l.charCodeAt(3),y=this.readData(4);return u===y[0]&&h===y[1]&&d===y[2]&&m===y[3]},s.prototype.readData=function(l){if(this.checkOffset(l),l===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=s},{"../utils":32,"./DataReader":18}],18:[function(t,i,r){var o=t("../utils");function s(l){this.data=l,this.length=l.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(l){this.checkIndex(this.index+l)},checkIndex:function(l){if(this.length<this.zero+l||l<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+l+"). Corrupted zip ?")},setIndex:function(l){this.checkIndex(l),this.index=l},skip:function(l){this.setIndex(this.index+l)},byteAt:function(){},readInt:function(l){var u,h=0;for(this.checkOffset(l),u=this.index+l-1;u>=this.index;u--)h=(h<<8)+this.byteAt(u);return this.index+=l,h},readString:function(l){return o.transformTo("string",this.readData(l))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var l=this.readInt(4);return new Date(Date.UTC(1980+(l>>25&127),(l>>21&15)-1,l>>16&31,l>>11&31,l>>5&63,(31&l)<<1))}},i.exports=s},{"../utils":32}],19:[function(t,i,r){var o=t("./Uint8ArrayReader");function s(l){o.call(this,l)}t("../utils").inherits(s,o),s.prototype.readData=function(l){this.checkOffset(l);var u=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,r){var o=t("./DataReader");function s(l){o.call(this,l)}t("../utils").inherits(s,o),s.prototype.byteAt=function(l){return this.data.charCodeAt(this.zero+l)},s.prototype.lastIndexOfSignature=function(l){return this.data.lastIndexOf(l)-this.zero},s.prototype.readAndCheckSignature=function(l){return l===this.readData(4)},s.prototype.readData=function(l){this.checkOffset(l);var u=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=s},{"../utils":32,"./DataReader":18}],21:[function(t,i,r){var o=t("./ArrayReader");function s(l){o.call(this,l)}t("../utils").inherits(s,o),s.prototype.readData=function(l){if(this.checkOffset(l),l===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+l);return this.index+=l,u},i.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,r){var o=t("../utils"),s=t("../support"),l=t("./ArrayReader"),u=t("./StringReader"),h=t("./NodeBufferReader"),d=t("./Uint8ArrayReader");i.exports=function(m){var y=o.getTypeOf(m);return o.checkSupport(y),y!=="string"||s.uint8array?y==="nodebuffer"?new h(m):s.uint8array?new d(o.transformTo("uint8array",m)):new l(o.transformTo("array",m)):new u(m)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,r){var o=t("./GenericWorker"),s=t("../utils");function l(u){o.call(this,"ConvertWorker to "+u),this.destType=u}s.inherits(l,o),l.prototype.processChunk=function(u){this.push({data:s.transformTo(this.destType,u.data),meta:u.meta})},i.exports=l},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,r){var o=t("./GenericWorker"),s=t("../crc32");function l(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(l,o),l.prototype.processChunk=function(u){this.streamInfo.crc32=s(u.data,this.streamInfo.crc32||0),this.push(u)},i.exports=l},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,r){var o=t("../utils"),s=t("./GenericWorker");function l(u){s.call(this,"DataLengthProbe for "+u),this.propName=u,this.withStreamInfo(u,0)}o.inherits(l,s),l.prototype.processChunk=function(u){if(u){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+u.data.length}s.prototype.processChunk.call(this,u)},i.exports=l},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,r){var o=t("../utils"),s=t("./GenericWorker");function l(u){s.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(d){h.dataIsReady=!0,h.data=d,h.max=d&&d.length||0,h.type=o.getTypeOf(d),h.isPaused||h._tickAndRepeat()},function(d){h.error(d)})}o.inherits(l,s),l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},l.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},l.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},l.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,h);break;case"uint8array":u=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":u=this.data.slice(this.index,h)}return this.index=h,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=l},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,r){function o(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,l){return this._listeners[s].push(l),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,l){if(this._listeners[s])for(var u=0;u<this._listeners[s].length;u++)this._listeners[s][u].call(this,l)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var l=this;return s.on("data",function(u){l.processChunk(u)}),s.on("end",function(){l.end()}),s.on("error",function(u){l.error(u)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,l){return this.extraStreamInfo[s]=l,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},i.exports=o},{}],29:[function(t,i,r){var o=t("../utils"),s=t("./ConvertWorker"),l=t("./GenericWorker"),u=t("../base64"),h=t("../support"),d=t("../external"),m=null;if(h.nodestream)try{m=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function y(C,w){return new d.Promise(function(S,T){var M=[],G=C._internalType,N=C._outputType,V=C._mimeType;C.on("data",function(W,j){M.push(W),w&&w(j)}).on("error",function(W){M=[],T(W)}).on("end",function(){try{var W=(function(j,J,te){switch(j){case"blob":return o.newBlob(o.transformTo("arraybuffer",J),te);case"base64":return u.encode(J);default:return o.transformTo(j,J)}})(N,(function(j,J){var te,ce=0,pe=null,Y=0;for(te=0;te<J.length;te++)Y+=J[te].length;switch(j){case"string":return J.join("");case"array":return Array.prototype.concat.apply([],J);case"uint8array":for(pe=new Uint8Array(Y),te=0;te<J.length;te++)pe.set(J[te],ce),ce+=J[te].length;return pe;case"nodebuffer":return Buffer.concat(J);default:throw new Error("concat : unsupported type '"+j+"'")}})(G,M),V);S(W)}catch(j){T(j)}M=[]}).resume()})}function x(C,w,S){var T=w;switch(w){case"blob":case"arraybuffer":T="uint8array";break;case"base64":T="string"}try{this._internalType=T,this._outputType=w,this._mimeType=S,o.checkSupport(T),this._worker=C.pipe(new s(T)),C.lock()}catch(M){this._worker=new l("error"),this._worker.error(M)}}x.prototype={accumulate:function(C){return y(this,C)},on:function(C,w){var S=this;return C==="data"?this._worker.on(C,function(T){w.call(S,T.data,T.meta)}):this._worker.on(C,function(){o.delay(w,arguments,S)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(C){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new m(this,{objectMode:this._outputType!=="nodebuffer"},C)}},i.exports=x},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var o=new ArrayBuffer(0);try{r.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(o),r.blob=s.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!t("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,r){for(var o=t("./utils"),s=t("./support"),l=t("./nodejsUtils"),u=t("./stream/GenericWorker"),h=new Array(256),d=0;d<256;d++)h[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;h[254]=h[254]=1;function m(){u.call(this,"utf-8 decode"),this.leftOver=null}function y(){u.call(this,"utf-8 encode")}r.utf8encode=function(x){return s.nodebuffer?l.newBufferFrom(x,"utf-8"):(function(C){var w,S,T,M,G,N=C.length,V=0;for(M=0;M<N;M++)(64512&(S=C.charCodeAt(M)))==55296&&M+1<N&&(64512&(T=C.charCodeAt(M+1)))==56320&&(S=65536+(S-55296<<10)+(T-56320),M++),V+=S<128?1:S<2048?2:S<65536?3:4;for(w=s.uint8array?new Uint8Array(V):new Array(V),M=G=0;G<V;M++)(64512&(S=C.charCodeAt(M)))==55296&&M+1<N&&(64512&(T=C.charCodeAt(M+1)))==56320&&(S=65536+(S-55296<<10)+(T-56320),M++),S<128?w[G++]=S:(S<2048?w[G++]=192|S>>>6:(S<65536?w[G++]=224|S>>>12:(w[G++]=240|S>>>18,w[G++]=128|S>>>12&63),w[G++]=128|S>>>6&63),w[G++]=128|63&S);return w})(x)},r.utf8decode=function(x){return s.nodebuffer?o.transformTo("nodebuffer",x).toString("utf-8"):(function(C){var w,S,T,M,G=C.length,N=new Array(2*G);for(w=S=0;w<G;)if((T=C[w++])<128)N[S++]=T;else if(4<(M=h[T]))N[S++]=65533,w+=M-1;else{for(T&=M===2?31:M===3?15:7;1<M&&w<G;)T=T<<6|63&C[w++],M--;1<M?N[S++]=65533:T<65536?N[S++]=T:(T-=65536,N[S++]=55296|T>>10&1023,N[S++]=56320|1023&T)}return N.length!==S&&(N.subarray?N=N.subarray(0,S):N.length=S),o.applyFromCharCode(N)})(x=o.transformTo(s.uint8array?"uint8array":"array",x))},o.inherits(m,u),m.prototype.processChunk=function(x){var C=o.transformTo(s.uint8array?"uint8array":"array",x.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var w=C;(C=new Uint8Array(w.length+this.leftOver.length)).set(this.leftOver,0),C.set(w,this.leftOver.length)}else C=this.leftOver.concat(C);this.leftOver=null}var S=(function(M,G){var N;for((G=G||M.length)>M.length&&(G=M.length),N=G-1;0<=N&&(192&M[N])==128;)N--;return N<0||N===0?G:N+h[M[N]]>G?N:G})(C),T=C;S!==C.length&&(s.uint8array?(T=C.subarray(0,S),this.leftOver=C.subarray(S,C.length)):(T=C.slice(0,S),this.leftOver=C.slice(S,C.length))),this.push({data:r.utf8decode(T),meta:x.meta})},m.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=m,o.inherits(y,u),y.prototype.processChunk=function(x){this.push({data:r.utf8encode(x.data),meta:x.meta})},r.Utf8EncodeWorker=y},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,r){var o=t("./support"),s=t("./base64"),l=t("./nodejsUtils"),u=t("./external");function h(w){return w}function d(w,S){for(var T=0;T<w.length;++T)S[T]=255&w.charCodeAt(T);return S}t("setimmediate"),r.newBlob=function(w,S){r.checkSupport("blob");try{return new Blob([w],{type:S})}catch{try{var T=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return T.append(w),T.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var m={stringifyByChunk:function(w,S,T){var M=[],G=0,N=w.length;if(N<=T)return String.fromCharCode.apply(null,w);for(;G<N;)S==="array"||S==="nodebuffer"?M.push(String.fromCharCode.apply(null,w.slice(G,Math.min(G+T,N)))):M.push(String.fromCharCode.apply(null,w.subarray(G,Math.min(G+T,N)))),G+=T;return M.join("")},stringifyByChar:function(w){for(var S="",T=0;T<w.length;T++)S+=String.fromCharCode(w[T]);return S},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,l.allocBuffer(1)).length===1}catch{return!1}})()}};function y(w){var S=65536,T=r.getTypeOf(w),M=!0;if(T==="uint8array"?M=m.applyCanBeUsed.uint8array:T==="nodebuffer"&&(M=m.applyCanBeUsed.nodebuffer),M)for(;1<S;)try{return m.stringifyByChunk(w,T,S)}catch{S=Math.floor(S/2)}return m.stringifyByChar(w)}function x(w,S){for(var T=0;T<w.length;T++)S[T]=w[T];return S}r.applyFromCharCode=y;var C={};C.string={string:h,array:function(w){return d(w,new Array(w.length))},arraybuffer:function(w){return C.string.uint8array(w).buffer},uint8array:function(w){return d(w,new Uint8Array(w.length))},nodebuffer:function(w){return d(w,l.allocBuffer(w.length))}},C.array={string:y,array:h,arraybuffer:function(w){return new Uint8Array(w).buffer},uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return l.newBufferFrom(w)}},C.arraybuffer={string:function(w){return y(new Uint8Array(w))},array:function(w){return x(new Uint8Array(w),new Array(w.byteLength))},arraybuffer:h,uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return l.newBufferFrom(new Uint8Array(w))}},C.uint8array={string:y,array:function(w){return x(w,new Array(w.length))},arraybuffer:function(w){return w.buffer},uint8array:h,nodebuffer:function(w){return l.newBufferFrom(w)}},C.nodebuffer={string:y,array:function(w){return x(w,new Array(w.length))},arraybuffer:function(w){return C.nodebuffer.uint8array(w).buffer},uint8array:function(w){return x(w,new Uint8Array(w.length))},nodebuffer:h},r.transformTo=function(w,S){if(S=S||"",!w)return S;r.checkSupport(w);var T=r.getTypeOf(S);return C[T][w](S)},r.resolve=function(w){for(var S=w.split("/"),T=[],M=0;M<S.length;M++){var G=S[M];G==="."||G===""&&M!==0&&M!==S.length-1||(G===".."?T.pop():T.push(G))}return T.join("/")},r.getTypeOf=function(w){return typeof w=="string"?"string":Object.prototype.toString.call(w)==="[object Array]"?"array":o.nodebuffer&&l.isBuffer(w)?"nodebuffer":o.uint8array&&w instanceof Uint8Array?"uint8array":o.arraybuffer&&w instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(w){if(!o[w.toLowerCase()])throw new Error(w+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(w){var S,T,M="";for(T=0;T<(w||"").length;T++)M+="\\x"+((S=w.charCodeAt(T))<16?"0":"")+S.toString(16).toUpperCase();return M},r.delay=function(w,S,T){setImmediate(function(){w.apply(T||null,S||[])})},r.inherits=function(w,S){function T(){}T.prototype=S.prototype,w.prototype=new T},r.extend=function(){var w,S,T={};for(w=0;w<arguments.length;w++)for(S in arguments[w])Object.prototype.hasOwnProperty.call(arguments[w],S)&&T[S]===void 0&&(T[S]=arguments[w][S]);return T},r.prepareContent=function(w,S,T,M,G){return u.Promise.resolve(S).then(function(N){return o.blob&&(N instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(N))!==-1)&&typeof FileReader<"u"?new u.Promise(function(V,W){var j=new FileReader;j.onload=function(J){V(J.target.result)},j.onerror=function(J){W(J.target.error)},j.readAsArrayBuffer(N)}):N}).then(function(N){var V=r.getTypeOf(N);return V?(V==="arraybuffer"?N=r.transformTo("uint8array",N):V==="string"&&(G?N=s.decode(N):T&&M!==!0&&(N=(function(W){return d(W,o.uint8array?new Uint8Array(W.length):new Array(W.length))})(N))),N):u.Promise.reject(new Error("Can't read the data of '"+w+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,r){var o=t("./reader/readerFor"),s=t("./utils"),l=t("./signature"),u=t("./zipEntry"),h=t("./support");function d(m){this.files=[],this.loadOptions=m}d.prototype={checkSignature:function(m){if(!this.reader.readAndCheckSignature(m)){this.reader.index-=4;var y=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(y)+", expected "+s.pretty(m)+")")}},isSignature:function(m,y){var x=this.reader.index;this.reader.setIndex(m);var C=this.reader.readString(4)===y;return this.reader.setIndex(x),C},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var m=this.reader.readData(this.zipCommentLength),y=h.uint8array?"uint8array":"array",x=s.transformTo(y,m);this.zipComment=this.loadOptions.decodeFileName(x)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var m,y,x,C=this.zip64EndOfCentralSize-44;0<C;)m=this.reader.readInt(2),y=this.reader.readInt(4),x=this.reader.readData(y),this.zip64ExtensibleData[m]={id:m,length:y,value:x}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var m,y;for(m=0;m<this.files.length;m++)y=this.files[m],this.reader.setIndex(y.localHeaderOffset),this.checkSignature(l.LOCAL_FILE_HEADER),y.readLocalPart(this.reader),y.handleUTF8(),y.processAttributes()},readCentralDir:function(){var m;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(l.CENTRAL_FILE_HEADER);)(m=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(m);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var m=this.reader.lastIndexOfSignature(l.CENTRAL_DIRECTORY_END);if(m<0)throw this.isSignature(0,l.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(m);var y=m;if(this.checkSignature(l.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(m=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(m),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,l.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var x=this.centralDirOffset+this.centralDirSize;this.zip64&&(x+=20,x+=12+this.zip64EndOfCentralSize);var C=y-x;if(0<C)this.isSignature(y,l.CENTRAL_FILE_HEADER)||(this.reader.zero=C);else if(C<0)throw new Error("Corrupted zip: missing "+Math.abs(C)+" bytes.")},prepareReader:function(m){this.reader=o(m)},load:function(m){this.prepareReader(m),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=d},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,r){var o=t("./reader/readerFor"),s=t("./utils"),l=t("./compressedObject"),u=t("./crc32"),h=t("./utf8"),d=t("./compressions"),m=t("./support");function y(x,C){this.options=x,this.loadOptions=C}y.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(x){var C,w;if(x.skip(22),this.fileNameLength=x.readInt(2),w=x.readInt(2),this.fileName=x.readData(this.fileNameLength),x.skip(w),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((C=(function(S){for(var T in d)if(Object.prototype.hasOwnProperty.call(d,T)&&d[T].magic===S)return d[T];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new l(this.compressedSize,this.uncompressedSize,this.crc32,C,x.readData(this.compressedSize))},readCentralPart:function(x){this.versionMadeBy=x.readInt(2),x.skip(2),this.bitFlag=x.readInt(2),this.compressionMethod=x.readString(2),this.date=x.readDate(),this.crc32=x.readInt(4),this.compressedSize=x.readInt(4),this.uncompressedSize=x.readInt(4);var C=x.readInt(2);if(this.extraFieldsLength=x.readInt(2),this.fileCommentLength=x.readInt(2),this.diskNumberStart=x.readInt(2),this.internalFileAttributes=x.readInt(2),this.externalFileAttributes=x.readInt(4),this.localHeaderOffset=x.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");x.skip(C),this.readExtraFields(x),this.parseZIP64ExtraField(x),this.fileComment=x.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var x=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),x==0&&(this.dosPermissions=63&this.externalFileAttributes),x==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var x=o(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=x.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=x.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=x.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=x.readInt(4))}},readExtraFields:function(x){var C,w,S,T=x.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});x.index+4<T;)C=x.readInt(2),w=x.readInt(2),S=x.readData(w),this.extraFields[C]={id:C,length:w,value:S};x.setIndex(T)},handleUTF8:function(){var x=m.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var C=this.findExtraFieldUnicodePath();if(C!==null)this.fileNameStr=C;else{var w=s.transformTo(x,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(w)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var T=s.transformTo(x,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(T)}}},findExtraFieldUnicodePath:function(){var x=this.extraFields[28789];if(x){var C=o(x.value);return C.readInt(1)!==1||u(this.fileName)!==C.readInt(4)?null:h.utf8decode(C.readData(x.length-5))}return null},findExtraFieldUnicodeComment:function(){var x=this.extraFields[25461];if(x){var C=o(x.value);return C.readInt(1)!==1||u(this.fileComment)!==C.readInt(4)?null:h.utf8decode(C.readData(x.length-5))}return null}},i.exports=y},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,r){function o(C,w,S){this.name=C,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=w,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var s=t("./stream/StreamHelper"),l=t("./stream/DataWorker"),u=t("./utf8"),h=t("./compressedObject"),d=t("./stream/GenericWorker");o.prototype={internalStream:function(C){var w=null,S="string";try{if(!C)throw new Error("No output type specified.");var T=(S=C.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),w=this._decompressWorker();var M=!this._dataBinary;M&&!T&&(w=w.pipe(new u.Utf8EncodeWorker)),!M&&T&&(w=w.pipe(new u.Utf8DecodeWorker))}catch(G){(w=new d("error")).error(G)}return new s(w,S,"")},async:function(C,w){return this.internalStream(C).accumulate(w)},nodeStream:function(C,w){return this.internalStream(C||"nodebuffer").toNodejsStream(w)},_compressWorker:function(C,w){if(this._data instanceof h&&this._data.compression.magic===C.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new u.Utf8EncodeWorker)),h.createWorkerFrom(S,C,w)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof d?this._data:new l(this._data)}};for(var m=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],y=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},x=0;x<m.length;x++)o.prototype[m[x]]=y;i.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,r){(function(o){var s,l,u=o.MutationObserver||o.WebKitMutationObserver;if(u){var h=0,d=new u(C),m=o.document.createTextNode("");d.observe(m,{characterData:!0}),s=function(){m.data=h=++h%2}}else if(o.setImmediate||o.MessageChannel===void 0)s="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var w=o.document.createElement("script");w.onreadystatechange=function(){C(),w.onreadystatechange=null,w.parentNode.removeChild(w),w=null},o.document.documentElement.appendChild(w)}:function(){setTimeout(C,0)};else{var y=new o.MessageChannel;y.port1.onmessage=C,s=function(){y.port2.postMessage(0)}}var x=[];function C(){var w,S;l=!0;for(var T=x.length;T;){for(S=x,x=[],w=-1;++w<T;)S[w]();T=x.length}l=!1}i.exports=function(w){x.push(w)!==1||l||s()}}).call(this,typeof Jd<"u"?Jd:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,r){var o=t("immediate");function s(){}var l={},u=["REJECTED"],h=["FULFILLED"],d=["PENDING"];function m(T){if(typeof T!="function")throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,T!==s&&w(this,T)}function y(T,M,G){this.promise=T,typeof M=="function"&&(this.onFulfilled=M,this.callFulfilled=this.otherCallFulfilled),typeof G=="function"&&(this.onRejected=G,this.callRejected=this.otherCallRejected)}function x(T,M,G){o(function(){var N;try{N=M(G)}catch(V){return l.reject(T,V)}N===T?l.reject(T,new TypeError("Cannot resolve promise with itself")):l.resolve(T,N)})}function C(T){var M=T&&T.then;if(T&&(typeof T=="object"||typeof T=="function")&&typeof M=="function")return function(){M.apply(T,arguments)}}function w(T,M){var G=!1;function N(j){G||(G=!0,l.reject(T,j))}function V(j){G||(G=!0,l.resolve(T,j))}var W=S(function(){M(V,N)});W.status==="error"&&N(W.value)}function S(T,M){var G={};try{G.value=T(M),G.status="success"}catch(N){G.status="error",G.value=N}return G}(i.exports=m).prototype.finally=function(T){if(typeof T!="function")return this;var M=this.constructor;return this.then(function(G){return M.resolve(T()).then(function(){return G})},function(G){return M.resolve(T()).then(function(){throw G})})},m.prototype.catch=function(T){return this.then(null,T)},m.prototype.then=function(T,M){if(typeof T!="function"&&this.state===h||typeof M!="function"&&this.state===u)return this;var G=new this.constructor(s);return this.state!==d?x(G,this.state===h?T:M,this.outcome):this.queue.push(new y(G,T,M)),G},y.prototype.callFulfilled=function(T){l.resolve(this.promise,T)},y.prototype.otherCallFulfilled=function(T){x(this.promise,this.onFulfilled,T)},y.prototype.callRejected=function(T){l.reject(this.promise,T)},y.prototype.otherCallRejected=function(T){x(this.promise,this.onRejected,T)},l.resolve=function(T,M){var G=S(C,M);if(G.status==="error")return l.reject(T,G.value);var N=G.value;if(N)w(T,N);else{T.state=h,T.outcome=M;for(var V=-1,W=T.queue.length;++V<W;)T.queue[V].callFulfilled(M)}return T},l.reject=function(T,M){T.state=u,T.outcome=M;for(var G=-1,N=T.queue.length;++G<N;)T.queue[G].callRejected(M);return T},m.resolve=function(T){return T instanceof this?T:l.resolve(new this(s),T)},m.reject=function(T){var M=new this(s);return l.reject(M,T)},m.all=function(T){var M=this;if(Object.prototype.toString.call(T)!=="[object Array]")return this.reject(new TypeError("must be an array"));var G=T.length,N=!1;if(!G)return this.resolve([]);for(var V=new Array(G),W=0,j=-1,J=new this(s);++j<G;)te(T[j],j);return J;function te(ce,pe){M.resolve(ce).then(function(Y){V[pe]=Y,++W!==G||N||(N=!0,l.resolve(J,V))},function(Y){N||(N=!0,l.reject(J,Y))})}},m.race=function(T){var M=this;if(Object.prototype.toString.call(T)!=="[object Array]")return this.reject(new TypeError("must be an array"));var G=T.length,N=!1;if(!G)return this.resolve([]);for(var V=-1,W=new this(s);++V<G;)j=T[V],M.resolve(j).then(function(J){N||(N=!0,l.resolve(W,J))},function(J){N||(N=!0,l.reject(W,J))});var j;return W}},{immediate:36}],38:[function(t,i,r){var o={};(0,t("./lib/utils/common").assign)(o,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,r){var o=t("./zlib/deflate"),s=t("./utils/common"),l=t("./utils/strings"),u=t("./zlib/messages"),h=t("./zlib/zstream"),d=Object.prototype.toString,m=0,y=-1,x=0,C=8;function w(T){if(!(this instanceof w))return new w(T);this.options=s.assign({level:y,method:C,chunkSize:16384,windowBits:15,memLevel:8,strategy:x,to:""},T||{});var M=this.options;M.raw&&0<M.windowBits?M.windowBits=-M.windowBits:M.gzip&&0<M.windowBits&&M.windowBits<16&&(M.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var G=o.deflateInit2(this.strm,M.level,M.method,M.windowBits,M.memLevel,M.strategy);if(G!==m)throw new Error(u[G]);if(M.header&&o.deflateSetHeader(this.strm,M.header),M.dictionary){var N;if(N=typeof M.dictionary=="string"?l.string2buf(M.dictionary):d.call(M.dictionary)==="[object ArrayBuffer]"?new Uint8Array(M.dictionary):M.dictionary,(G=o.deflateSetDictionary(this.strm,N))!==m)throw new Error(u[G]);this._dict_set=!0}}function S(T,M){var G=new w(M);if(G.push(T,!0),G.err)throw G.msg||u[G.err];return G.result}w.prototype.push=function(T,M){var G,N,V=this.strm,W=this.options.chunkSize;if(this.ended)return!1;N=M===~~M?M:M===!0?4:0,typeof T=="string"?V.input=l.string2buf(T):d.call(T)==="[object ArrayBuffer]"?V.input=new Uint8Array(T):V.input=T,V.next_in=0,V.avail_in=V.input.length;do{if(V.avail_out===0&&(V.output=new s.Buf8(W),V.next_out=0,V.avail_out=W),(G=o.deflate(V,N))!==1&&G!==m)return this.onEnd(G),!(this.ended=!0);V.avail_out!==0&&(V.avail_in!==0||N!==4&&N!==2)||(this.options.to==="string"?this.onData(l.buf2binstring(s.shrinkBuf(V.output,V.next_out))):this.onData(s.shrinkBuf(V.output,V.next_out)))}while((0<V.avail_in||V.avail_out===0)&&G!==1);return N===4?(G=o.deflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===m):N!==2||(this.onEnd(m),!(V.avail_out=0))},w.prototype.onData=function(T){this.chunks.push(T)},w.prototype.onEnd=function(T){T===m&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=T,this.msg=this.strm.msg},r.Deflate=w,r.deflate=S,r.deflateRaw=function(T,M){return(M=M||{}).raw=!0,S(T,M)},r.gzip=function(T,M){return(M=M||{}).gzip=!0,S(T,M)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,r){var o=t("./zlib/inflate"),s=t("./utils/common"),l=t("./utils/strings"),u=t("./zlib/constants"),h=t("./zlib/messages"),d=t("./zlib/zstream"),m=t("./zlib/gzheader"),y=Object.prototype.toString;function x(w){if(!(this instanceof x))return new x(w);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},w||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||w&&w.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var T=o.inflateInit2(this.strm,S.windowBits);if(T!==u.Z_OK)throw new Error(h[T]);this.header=new m,o.inflateGetHeader(this.strm,this.header)}function C(w,S){var T=new x(S);if(T.push(w,!0),T.err)throw T.msg||h[T.err];return T.result}x.prototype.push=function(w,S){var T,M,G,N,V,W,j=this.strm,J=this.options.chunkSize,te=this.options.dictionary,ce=!1;if(this.ended)return!1;M=S===~~S?S:S===!0?u.Z_FINISH:u.Z_NO_FLUSH,typeof w=="string"?j.input=l.binstring2buf(w):y.call(w)==="[object ArrayBuffer]"?j.input=new Uint8Array(w):j.input=w,j.next_in=0,j.avail_in=j.input.length;do{if(j.avail_out===0&&(j.output=new s.Buf8(J),j.next_out=0,j.avail_out=J),(T=o.inflate(j,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&te&&(W=typeof te=="string"?l.string2buf(te):y.call(te)==="[object ArrayBuffer]"?new Uint8Array(te):te,T=o.inflateSetDictionary(this.strm,W)),T===u.Z_BUF_ERROR&&ce===!0&&(T=u.Z_OK,ce=!1),T!==u.Z_STREAM_END&&T!==u.Z_OK)return this.onEnd(T),!(this.ended=!0);j.next_out&&(j.avail_out!==0&&T!==u.Z_STREAM_END&&(j.avail_in!==0||M!==u.Z_FINISH&&M!==u.Z_SYNC_FLUSH)||(this.options.to==="string"?(G=l.utf8border(j.output,j.next_out),N=j.next_out-G,V=l.buf2string(j.output,G),j.next_out=N,j.avail_out=J-N,N&&s.arraySet(j.output,j.output,G,N,0),this.onData(V)):this.onData(s.shrinkBuf(j.output,j.next_out)))),j.avail_in===0&&j.avail_out===0&&(ce=!0)}while((0<j.avail_in||j.avail_out===0)&&T!==u.Z_STREAM_END);return T===u.Z_STREAM_END&&(M=u.Z_FINISH),M===u.Z_FINISH?(T=o.inflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===u.Z_OK):M!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),!(j.avail_out=0))},x.prototype.onData=function(w){this.chunks.push(w)},x.prototype.onEnd=function(w){w===u.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},r.Inflate=x,r.inflate=C,r.inflateRaw=function(w,S){return(S=S||{}).raw=!0,C(w,S)},r.ungzip=C},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,r){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(u){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var d=h.shift();if(d){if(typeof d!="object")throw new TypeError(d+"must be non-object");for(var m in d)d.hasOwnProperty(m)&&(u[m]=d[m])}}return u},r.shrinkBuf=function(u,h){return u.length===h?u:u.subarray?u.subarray(0,h):(u.length=h,u)};var s={arraySet:function(u,h,d,m,y){if(h.subarray&&u.subarray)u.set(h.subarray(d,d+m),y);else for(var x=0;x<m;x++)u[y+x]=h[d+x]},flattenChunks:function(u){var h,d,m,y,x,C;for(h=m=0,d=u.length;h<d;h++)m+=u[h].length;for(C=new Uint8Array(m),h=y=0,d=u.length;h<d;h++)x=u[h],C.set(x,y),y+=x.length;return C}},l={arraySet:function(u,h,d,m,y){for(var x=0;x<m;x++)u[y+x]=h[d+x]},flattenChunks:function(u){return[].concat.apply([],u)}};r.setTyped=function(u){u?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,s)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,l))},r.setTyped(o)},{}],42:[function(t,i,r){var o=t("./common"),s=!0,l=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l=!1}for(var u=new o.Buf8(256),h=0;h<256;h++)u[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function d(m,y){if(y<65537&&(m.subarray&&l||!m.subarray&&s))return String.fromCharCode.apply(null,o.shrinkBuf(m,y));for(var x="",C=0;C<y;C++)x+=String.fromCharCode(m[C]);return x}u[254]=u[254]=1,r.string2buf=function(m){var y,x,C,w,S,T=m.length,M=0;for(w=0;w<T;w++)(64512&(x=m.charCodeAt(w)))==55296&&w+1<T&&(64512&(C=m.charCodeAt(w+1)))==56320&&(x=65536+(x-55296<<10)+(C-56320),w++),M+=x<128?1:x<2048?2:x<65536?3:4;for(y=new o.Buf8(M),w=S=0;S<M;w++)(64512&(x=m.charCodeAt(w)))==55296&&w+1<T&&(64512&(C=m.charCodeAt(w+1)))==56320&&(x=65536+(x-55296<<10)+(C-56320),w++),x<128?y[S++]=x:(x<2048?y[S++]=192|x>>>6:(x<65536?y[S++]=224|x>>>12:(y[S++]=240|x>>>18,y[S++]=128|x>>>12&63),y[S++]=128|x>>>6&63),y[S++]=128|63&x);return y},r.buf2binstring=function(m){return d(m,m.length)},r.binstring2buf=function(m){for(var y=new o.Buf8(m.length),x=0,C=y.length;x<C;x++)y[x]=m.charCodeAt(x);return y},r.buf2string=function(m,y){var x,C,w,S,T=y||m.length,M=new Array(2*T);for(x=C=0;x<T;)if((w=m[x++])<128)M[C++]=w;else if(4<(S=u[w]))M[C++]=65533,x+=S-1;else{for(w&=S===2?31:S===3?15:7;1<S&&x<T;)w=w<<6|63&m[x++],S--;1<S?M[C++]=65533:w<65536?M[C++]=w:(w-=65536,M[C++]=55296|w>>10&1023,M[C++]=56320|1023&w)}return d(M,C)},r.utf8border=function(m,y){var x;for((y=y||m.length)>m.length&&(y=m.length),x=y-1;0<=x&&(192&m[x])==128;)x--;return x<0||x===0?y:x+u[m[x]]>y?x:y}},{"./common":41}],43:[function(t,i,r){i.exports=function(o,s,l,u){for(var h=65535&o|0,d=o>>>16&65535|0,m=0;l!==0;){for(l-=m=2e3<l?2e3:l;d=d+(h=h+s[u++]|0)|0,--m;);h%=65521,d%=65521}return h|d<<16|0}},{}],44:[function(t,i,r){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,r){var o=(function(){for(var s,l=[],u=0;u<256;u++){s=u;for(var h=0;h<8;h++)s=1&s?3988292384^s>>>1:s>>>1;l[u]=s}return l})();i.exports=function(s,l,u,h){var d=o,m=h+u;s^=-1;for(var y=h;y<m;y++)s=s>>>8^d[255&(s^l[y])];return-1^s}},{}],46:[function(t,i,r){var o,s=t("../utils/common"),l=t("./trees"),u=t("./adler32"),h=t("./crc32"),d=t("./messages"),m=0,y=4,x=0,C=-2,w=-1,S=4,T=2,M=8,G=9,N=286,V=30,W=19,j=2*N+1,J=15,te=3,ce=258,pe=ce+te+1,Y=42,he=113,D=1,re=2,le=3,fe=4;function Le(z,We){return z.msg=d[We],We}function we(z){return(z<<1)-(4<z?9:0)}function se(z){for(var We=z.length;0<=--We;)z[We]=0}function Q(z){var We=z.state,ke=We.pending;ke>z.avail_out&&(ke=z.avail_out),ke!==0&&(s.arraySet(z.output,We.pending_buf,We.pending_out,ke,z.next_out),z.next_out+=ke,We.pending_out+=ke,z.total_out+=ke,z.avail_out-=ke,We.pending-=ke,We.pending===0&&(We.pending_out=0))}function q(z,We){l._tr_flush_block(z,0<=z.block_start?z.block_start:-1,z.strstart-z.block_start,We),z.block_start=z.strstart,Q(z.strm)}function $e(z,We){z.pending_buf[z.pending++]=We}function Qe(z,We){z.pending_buf[z.pending++]=We>>>8&255,z.pending_buf[z.pending++]=255&We}function qe(z,We){var ke,ge,ie=z.max_chain_length,Ce=z.strstart,Te=z.prev_length,De=z.nice_match,Ze=z.strstart>z.w_size-pe?z.strstart-(z.w_size-pe):0,Je=z.window,dt=z.w_mask,ft=z.prev,Tt=z.strstart+ce,hn=Je[Ce+Te-1],cn=Je[Ce+Te];z.prev_length>=z.good_match&&(ie>>=2),De>z.lookahead&&(De=z.lookahead);do if(Je[(ke=We)+Te]===cn&&Je[ke+Te-1]===hn&&Je[ke]===Je[Ce]&&Je[++ke]===Je[Ce+1]){Ce+=2,ke++;do;while(Je[++Ce]===Je[++ke]&&Je[++Ce]===Je[++ke]&&Je[++Ce]===Je[++ke]&&Je[++Ce]===Je[++ke]&&Je[++Ce]===Je[++ke]&&Je[++Ce]===Je[++ke]&&Je[++Ce]===Je[++ke]&&Je[++Ce]===Je[++ke]&&Ce<Tt);if(ge=ce-(Tt-Ce),Ce=Tt-ce,Te<ge){if(z.match_start=We,De<=(Te=ge))break;hn=Je[Ce+Te-1],cn=Je[Ce+Te]}}while((We=ft[We&dt])>Ze&&--ie!=0);return Te<=z.lookahead?Te:z.lookahead}function Lt(z){var We,ke,ge,ie,Ce,Te,De,Ze,Je,dt,ft=z.w_size;do{if(ie=z.window_size-z.lookahead-z.strstart,z.strstart>=ft+(ft-pe)){for(s.arraySet(z.window,z.window,ft,ft,0),z.match_start-=ft,z.strstart-=ft,z.block_start-=ft,We=ke=z.hash_size;ge=z.head[--We],z.head[We]=ft<=ge?ge-ft:0,--ke;);for(We=ke=ft;ge=z.prev[--We],z.prev[We]=ft<=ge?ge-ft:0,--ke;);ie+=ft}if(z.strm.avail_in===0)break;if(Te=z.strm,De=z.window,Ze=z.strstart+z.lookahead,Je=ie,dt=void 0,dt=Te.avail_in,Je<dt&&(dt=Je),ke=dt===0?0:(Te.avail_in-=dt,s.arraySet(De,Te.input,Te.next_in,dt,Ze),Te.state.wrap===1?Te.adler=u(Te.adler,De,dt,Ze):Te.state.wrap===2&&(Te.adler=h(Te.adler,De,dt,Ze)),Te.next_in+=dt,Te.total_in+=dt,dt),z.lookahead+=ke,z.lookahead+z.insert>=te)for(Ce=z.strstart-z.insert,z.ins_h=z.window[Ce],z.ins_h=(z.ins_h<<z.hash_shift^z.window[Ce+1])&z.hash_mask;z.insert&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[Ce+te-1])&z.hash_mask,z.prev[Ce&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=Ce,Ce++,z.insert--,!(z.lookahead+z.insert<te)););}while(z.lookahead<pe&&z.strm.avail_in!==0)}function Pt(z,We){for(var ke,ge;;){if(z.lookahead<pe){if(Lt(z),z.lookahead<pe&&We===m)return D;if(z.lookahead===0)break}if(ke=0,z.lookahead>=te&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+te-1])&z.hash_mask,ke=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),ke!==0&&z.strstart-ke<=z.w_size-pe&&(z.match_length=qe(z,ke)),z.match_length>=te)if(ge=l._tr_tally(z,z.strstart-z.match_start,z.match_length-te),z.lookahead-=z.match_length,z.match_length<=z.max_lazy_match&&z.lookahead>=te){for(z.match_length--;z.strstart++,z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+te-1])&z.hash_mask,ke=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart,--z.match_length!=0;);z.strstart++}else z.strstart+=z.match_length,z.match_length=0,z.ins_h=z.window[z.strstart],z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+1])&z.hash_mask;else ge=l._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++;if(ge&&(q(z,!1),z.strm.avail_out===0))return D}return z.insert=z.strstart<te-1?z.strstart:te-1,We===y?(q(z,!0),z.strm.avail_out===0?le:fe):z.last_lit&&(q(z,!1),z.strm.avail_out===0)?D:re}function zt(z,We){for(var ke,ge,ie;;){if(z.lookahead<pe){if(Lt(z),z.lookahead<pe&&We===m)return D;if(z.lookahead===0)break}if(ke=0,z.lookahead>=te&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+te-1])&z.hash_mask,ke=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),z.prev_length=z.match_length,z.prev_match=z.match_start,z.match_length=te-1,ke!==0&&z.prev_length<z.max_lazy_match&&z.strstart-ke<=z.w_size-pe&&(z.match_length=qe(z,ke),z.match_length<=5&&(z.strategy===1||z.match_length===te&&4096<z.strstart-z.match_start)&&(z.match_length=te-1)),z.prev_length>=te&&z.match_length<=z.prev_length){for(ie=z.strstart+z.lookahead-te,ge=l._tr_tally(z,z.strstart-1-z.prev_match,z.prev_length-te),z.lookahead-=z.prev_length-1,z.prev_length-=2;++z.strstart<=ie&&(z.ins_h=(z.ins_h<<z.hash_shift^z.window[z.strstart+te-1])&z.hash_mask,ke=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),--z.prev_length!=0;);if(z.match_available=0,z.match_length=te-1,z.strstart++,ge&&(q(z,!1),z.strm.avail_out===0))return D}else if(z.match_available){if((ge=l._tr_tally(z,0,z.window[z.strstart-1]))&&q(z,!1),z.strstart++,z.lookahead--,z.strm.avail_out===0)return D}else z.match_available=1,z.strstart++,z.lookahead--}return z.match_available&&(ge=l._tr_tally(z,0,z.window[z.strstart-1]),z.match_available=0),z.insert=z.strstart<te-1?z.strstart:te-1,We===y?(q(z,!0),z.strm.avail_out===0?le:fe):z.last_lit&&(q(z,!1),z.strm.avail_out===0)?D:re}function Dt(z,We,ke,ge,ie){this.good_length=z,this.max_lazy=We,this.nice_length=ke,this.max_chain=ge,this.func=ie}function yn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*j),this.dyn_dtree=new s.Buf16(2*(2*V+1)),this.bl_tree=new s.Buf16(2*(2*W+1)),se(this.dyn_ltree),se(this.dyn_dtree),se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(J+1),this.heap=new s.Buf16(2*N+1),se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*N+1),se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function tn(z){var We;return z&&z.state?(z.total_in=z.total_out=0,z.data_type=T,(We=z.state).pending=0,We.pending_out=0,We.wrap<0&&(We.wrap=-We.wrap),We.status=We.wrap?Y:he,z.adler=We.wrap===2?0:1,We.last_flush=m,l._tr_init(We),x):Le(z,C)}function Ne(z){var We=tn(z);return We===x&&(function(ke){ke.window_size=2*ke.w_size,se(ke.head),ke.max_lazy_match=o[ke.level].max_lazy,ke.good_match=o[ke.level].good_length,ke.nice_match=o[ke.level].nice_length,ke.max_chain_length=o[ke.level].max_chain,ke.strstart=0,ke.block_start=0,ke.lookahead=0,ke.insert=0,ke.match_length=ke.prev_length=te-1,ke.match_available=0,ke.ins_h=0})(z.state),We}function Be(z,We,ke,ge,ie,Ce){if(!z)return C;var Te=1;if(We===w&&(We=6),ge<0?(Te=0,ge=-ge):15<ge&&(Te=2,ge-=16),ie<1||G<ie||ke!==M||ge<8||15<ge||We<0||9<We||Ce<0||S<Ce)return Le(z,C);ge===8&&(ge=9);var De=new yn;return(z.state=De).strm=z,De.wrap=Te,De.gzhead=null,De.w_bits=ge,De.w_size=1<<De.w_bits,De.w_mask=De.w_size-1,De.hash_bits=ie+7,De.hash_size=1<<De.hash_bits,De.hash_mask=De.hash_size-1,De.hash_shift=~~((De.hash_bits+te-1)/te),De.window=new s.Buf8(2*De.w_size),De.head=new s.Buf16(De.hash_size),De.prev=new s.Buf16(De.w_size),De.lit_bufsize=1<<ie+6,De.pending_buf_size=4*De.lit_bufsize,De.pending_buf=new s.Buf8(De.pending_buf_size),De.d_buf=1*De.lit_bufsize,De.l_buf=3*De.lit_bufsize,De.level=We,De.strategy=Ce,De.method=ke,Ne(z)}o=[new Dt(0,0,0,0,function(z,We){var ke=65535;for(ke>z.pending_buf_size-5&&(ke=z.pending_buf_size-5);;){if(z.lookahead<=1){if(Lt(z),z.lookahead===0&&We===m)return D;if(z.lookahead===0)break}z.strstart+=z.lookahead,z.lookahead=0;var ge=z.block_start+ke;if((z.strstart===0||z.strstart>=ge)&&(z.lookahead=z.strstart-ge,z.strstart=ge,q(z,!1),z.strm.avail_out===0)||z.strstart-z.block_start>=z.w_size-pe&&(q(z,!1),z.strm.avail_out===0))return D}return z.insert=0,We===y?(q(z,!0),z.strm.avail_out===0?le:fe):(z.strstart>z.block_start&&(q(z,!1),z.strm.avail_out),D)}),new Dt(4,4,8,4,Pt),new Dt(4,5,16,8,Pt),new Dt(4,6,32,32,Pt),new Dt(4,4,16,16,zt),new Dt(8,16,32,32,zt),new Dt(8,16,128,128,zt),new Dt(8,32,128,256,zt),new Dt(32,128,258,1024,zt),new Dt(32,258,258,4096,zt)],r.deflateInit=function(z,We){return Be(z,We,M,15,8,0)},r.deflateInit2=Be,r.deflateReset=Ne,r.deflateResetKeep=tn,r.deflateSetHeader=function(z,We){return z&&z.state?z.state.wrap!==2?C:(z.state.gzhead=We,x):C},r.deflate=function(z,We){var ke,ge,ie,Ce;if(!z||!z.state||5<We||We<0)return z?Le(z,C):C;if(ge=z.state,!z.output||!z.input&&z.avail_in!==0||ge.status===666&&We!==y)return Le(z,z.avail_out===0?-5:C);if(ge.strm=z,ke=ge.last_flush,ge.last_flush=We,ge.status===Y)if(ge.wrap===2)z.adler=0,$e(ge,31),$e(ge,139),$e(ge,8),ge.gzhead?($e(ge,(ge.gzhead.text?1:0)+(ge.gzhead.hcrc?2:0)+(ge.gzhead.extra?4:0)+(ge.gzhead.name?8:0)+(ge.gzhead.comment?16:0)),$e(ge,255&ge.gzhead.time),$e(ge,ge.gzhead.time>>8&255),$e(ge,ge.gzhead.time>>16&255),$e(ge,ge.gzhead.time>>24&255),$e(ge,ge.level===9?2:2<=ge.strategy||ge.level<2?4:0),$e(ge,255&ge.gzhead.os),ge.gzhead.extra&&ge.gzhead.extra.length&&($e(ge,255&ge.gzhead.extra.length),$e(ge,ge.gzhead.extra.length>>8&255)),ge.gzhead.hcrc&&(z.adler=h(z.adler,ge.pending_buf,ge.pending,0)),ge.gzindex=0,ge.status=69):($e(ge,0),$e(ge,0),$e(ge,0),$e(ge,0),$e(ge,0),$e(ge,ge.level===9?2:2<=ge.strategy||ge.level<2?4:0),$e(ge,3),ge.status=he);else{var Te=M+(ge.w_bits-8<<4)<<8;Te|=(2<=ge.strategy||ge.level<2?0:ge.level<6?1:ge.level===6?2:3)<<6,ge.strstart!==0&&(Te|=32),Te+=31-Te%31,ge.status=he,Qe(ge,Te),ge.strstart!==0&&(Qe(ge,z.adler>>>16),Qe(ge,65535&z.adler)),z.adler=1}if(ge.status===69)if(ge.gzhead.extra){for(ie=ge.pending;ge.gzindex<(65535&ge.gzhead.extra.length)&&(ge.pending!==ge.pending_buf_size||(ge.gzhead.hcrc&&ge.pending>ie&&(z.adler=h(z.adler,ge.pending_buf,ge.pending-ie,ie)),Q(z),ie=ge.pending,ge.pending!==ge.pending_buf_size));)$e(ge,255&ge.gzhead.extra[ge.gzindex]),ge.gzindex++;ge.gzhead.hcrc&&ge.pending>ie&&(z.adler=h(z.adler,ge.pending_buf,ge.pending-ie,ie)),ge.gzindex===ge.gzhead.extra.length&&(ge.gzindex=0,ge.status=73)}else ge.status=73;if(ge.status===73)if(ge.gzhead.name){ie=ge.pending;do{if(ge.pending===ge.pending_buf_size&&(ge.gzhead.hcrc&&ge.pending>ie&&(z.adler=h(z.adler,ge.pending_buf,ge.pending-ie,ie)),Q(z),ie=ge.pending,ge.pending===ge.pending_buf_size)){Ce=1;break}Ce=ge.gzindex<ge.gzhead.name.length?255&ge.gzhead.name.charCodeAt(ge.gzindex++):0,$e(ge,Ce)}while(Ce!==0);ge.gzhead.hcrc&&ge.pending>ie&&(z.adler=h(z.adler,ge.pending_buf,ge.pending-ie,ie)),Ce===0&&(ge.gzindex=0,ge.status=91)}else ge.status=91;if(ge.status===91)if(ge.gzhead.comment){ie=ge.pending;do{if(ge.pending===ge.pending_buf_size&&(ge.gzhead.hcrc&&ge.pending>ie&&(z.adler=h(z.adler,ge.pending_buf,ge.pending-ie,ie)),Q(z),ie=ge.pending,ge.pending===ge.pending_buf_size)){Ce=1;break}Ce=ge.gzindex<ge.gzhead.comment.length?255&ge.gzhead.comment.charCodeAt(ge.gzindex++):0,$e(ge,Ce)}while(Ce!==0);ge.gzhead.hcrc&&ge.pending>ie&&(z.adler=h(z.adler,ge.pending_buf,ge.pending-ie,ie)),Ce===0&&(ge.status=103)}else ge.status=103;if(ge.status===103&&(ge.gzhead.hcrc?(ge.pending+2>ge.pending_buf_size&&Q(z),ge.pending+2<=ge.pending_buf_size&&($e(ge,255&z.adler),$e(ge,z.adler>>8&255),z.adler=0,ge.status=he)):ge.status=he),ge.pending!==0){if(Q(z),z.avail_out===0)return ge.last_flush=-1,x}else if(z.avail_in===0&&we(We)<=we(ke)&&We!==y)return Le(z,-5);if(ge.status===666&&z.avail_in!==0)return Le(z,-5);if(z.avail_in!==0||ge.lookahead!==0||We!==m&&ge.status!==666){var De=ge.strategy===2?(function(Ze,Je){for(var dt;;){if(Ze.lookahead===0&&(Lt(Ze),Ze.lookahead===0)){if(Je===m)return D;break}if(Ze.match_length=0,dt=l._tr_tally(Ze,0,Ze.window[Ze.strstart]),Ze.lookahead--,Ze.strstart++,dt&&(q(Ze,!1),Ze.strm.avail_out===0))return D}return Ze.insert=0,Je===y?(q(Ze,!0),Ze.strm.avail_out===0?le:fe):Ze.last_lit&&(q(Ze,!1),Ze.strm.avail_out===0)?D:re})(ge,We):ge.strategy===3?(function(Ze,Je){for(var dt,ft,Tt,hn,cn=Ze.window;;){if(Ze.lookahead<=ce){if(Lt(Ze),Ze.lookahead<=ce&&Je===m)return D;if(Ze.lookahead===0)break}if(Ze.match_length=0,Ze.lookahead>=te&&0<Ze.strstart&&(ft=cn[Tt=Ze.strstart-1])===cn[++Tt]&&ft===cn[++Tt]&&ft===cn[++Tt]){hn=Ze.strstart+ce;do;while(ft===cn[++Tt]&&ft===cn[++Tt]&&ft===cn[++Tt]&&ft===cn[++Tt]&&ft===cn[++Tt]&&ft===cn[++Tt]&&ft===cn[++Tt]&&ft===cn[++Tt]&&Tt<hn);Ze.match_length=ce-(hn-Tt),Ze.match_length>Ze.lookahead&&(Ze.match_length=Ze.lookahead)}if(Ze.match_length>=te?(dt=l._tr_tally(Ze,1,Ze.match_length-te),Ze.lookahead-=Ze.match_length,Ze.strstart+=Ze.match_length,Ze.match_length=0):(dt=l._tr_tally(Ze,0,Ze.window[Ze.strstart]),Ze.lookahead--,Ze.strstart++),dt&&(q(Ze,!1),Ze.strm.avail_out===0))return D}return Ze.insert=0,Je===y?(q(Ze,!0),Ze.strm.avail_out===0?le:fe):Ze.last_lit&&(q(Ze,!1),Ze.strm.avail_out===0)?D:re})(ge,We):o[ge.level].func(ge,We);if(De!==le&&De!==fe||(ge.status=666),De===D||De===le)return z.avail_out===0&&(ge.last_flush=-1),x;if(De===re&&(We===1?l._tr_align(ge):We!==5&&(l._tr_stored_block(ge,0,0,!1),We===3&&(se(ge.head),ge.lookahead===0&&(ge.strstart=0,ge.block_start=0,ge.insert=0))),Q(z),z.avail_out===0))return ge.last_flush=-1,x}return We!==y?x:ge.wrap<=0?1:(ge.wrap===2?($e(ge,255&z.adler),$e(ge,z.adler>>8&255),$e(ge,z.adler>>16&255),$e(ge,z.adler>>24&255),$e(ge,255&z.total_in),$e(ge,z.total_in>>8&255),$e(ge,z.total_in>>16&255),$e(ge,z.total_in>>24&255)):(Qe(ge,z.adler>>>16),Qe(ge,65535&z.adler)),Q(z),0<ge.wrap&&(ge.wrap=-ge.wrap),ge.pending!==0?x:1)},r.deflateEnd=function(z){var We;return z&&z.state?(We=z.state.status)!==Y&&We!==69&&We!==73&&We!==91&&We!==103&&We!==he&&We!==666?Le(z,C):(z.state=null,We===he?Le(z,-3):x):C},r.deflateSetDictionary=function(z,We){var ke,ge,ie,Ce,Te,De,Ze,Je,dt=We.length;if(!z||!z.state||(Ce=(ke=z.state).wrap)===2||Ce===1&&ke.status!==Y||ke.lookahead)return C;for(Ce===1&&(z.adler=u(z.adler,We,dt,0)),ke.wrap=0,dt>=ke.w_size&&(Ce===0&&(se(ke.head),ke.strstart=0,ke.block_start=0,ke.insert=0),Je=new s.Buf8(ke.w_size),s.arraySet(Je,We,dt-ke.w_size,ke.w_size,0),We=Je,dt=ke.w_size),Te=z.avail_in,De=z.next_in,Ze=z.input,z.avail_in=dt,z.next_in=0,z.input=We,Lt(ke);ke.lookahead>=te;){for(ge=ke.strstart,ie=ke.lookahead-(te-1);ke.ins_h=(ke.ins_h<<ke.hash_shift^ke.window[ge+te-1])&ke.hash_mask,ke.prev[ge&ke.w_mask]=ke.head[ke.ins_h],ke.head[ke.ins_h]=ge,ge++,--ie;);ke.strstart=ge,ke.lookahead=te-1,Lt(ke)}return ke.strstart+=ke.lookahead,ke.block_start=ke.strstart,ke.insert=ke.lookahead,ke.lookahead=0,ke.match_length=ke.prev_length=te-1,ke.match_available=0,z.next_in=De,z.input=Ze,z.avail_in=Te,ke.wrap=Ce,x},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,r){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,r){i.exports=function(o,s){var l,u,h,d,m,y,x,C,w,S,T,M,G,N,V,W,j,J,te,ce,pe,Y,he,D,re;l=o.state,u=o.next_in,D=o.input,h=u+(o.avail_in-5),d=o.next_out,re=o.output,m=d-(s-o.avail_out),y=d+(o.avail_out-257),x=l.dmax,C=l.wsize,w=l.whave,S=l.wnext,T=l.window,M=l.hold,G=l.bits,N=l.lencode,V=l.distcode,W=(1<<l.lenbits)-1,j=(1<<l.distbits)-1;e:do{G<15&&(M+=D[u++]<<G,G+=8,M+=D[u++]<<G,G+=8),J=N[M&W];t:for(;;){if(M>>>=te=J>>>24,G-=te,(te=J>>>16&255)===0)re[d++]=65535&J;else{if(!(16&te)){if((64&te)==0){J=N[(65535&J)+(M&(1<<te)-1)];continue t}if(32&te){l.mode=12;break e}o.msg="invalid literal/length code",l.mode=30;break e}ce=65535&J,(te&=15)&&(G<te&&(M+=D[u++]<<G,G+=8),ce+=M&(1<<te)-1,M>>>=te,G-=te),G<15&&(M+=D[u++]<<G,G+=8,M+=D[u++]<<G,G+=8),J=V[M&j];n:for(;;){if(M>>>=te=J>>>24,G-=te,!(16&(te=J>>>16&255))){if((64&te)==0){J=V[(65535&J)+(M&(1<<te)-1)];continue n}o.msg="invalid distance code",l.mode=30;break e}if(pe=65535&J,G<(te&=15)&&(M+=D[u++]<<G,(G+=8)<te&&(M+=D[u++]<<G,G+=8)),x<(pe+=M&(1<<te)-1)){o.msg="invalid distance too far back",l.mode=30;break e}if(M>>>=te,G-=te,(te=d-m)<pe){if(w<(te=pe-te)&&l.sane){o.msg="invalid distance too far back",l.mode=30;break e}if(he=T,(Y=0)===S){if(Y+=C-te,te<ce){for(ce-=te;re[d++]=T[Y++],--te;);Y=d-pe,he=re}}else if(S<te){if(Y+=C+S-te,(te-=S)<ce){for(ce-=te;re[d++]=T[Y++],--te;);if(Y=0,S<ce){for(ce-=te=S;re[d++]=T[Y++],--te;);Y=d-pe,he=re}}}else if(Y+=S-te,te<ce){for(ce-=te;re[d++]=T[Y++],--te;);Y=d-pe,he=re}for(;2<ce;)re[d++]=he[Y++],re[d++]=he[Y++],re[d++]=he[Y++],ce-=3;ce&&(re[d++]=he[Y++],1<ce&&(re[d++]=he[Y++]))}else{for(Y=d-pe;re[d++]=re[Y++],re[d++]=re[Y++],re[d++]=re[Y++],2<(ce-=3););ce&&(re[d++]=re[Y++],1<ce&&(re[d++]=re[Y++]))}break}}break}}while(u<h&&d<y);u-=ce=G>>3,M&=(1<<(G-=ce<<3))-1,o.next_in=u,o.next_out=d,o.avail_in=u<h?h-u+5:5-(u-h),o.avail_out=d<y?y-d+257:257-(d-y),l.hold=M,l.bits=G}},{}],49:[function(t,i,r){var o=t("../utils/common"),s=t("./adler32"),l=t("./crc32"),u=t("./inffast"),h=t("./inftrees"),d=1,m=2,y=0,x=-2,C=1,w=852,S=592;function T(Y){return(Y>>>24&255)+(Y>>>8&65280)+((65280&Y)<<8)+((255&Y)<<24)}function M(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function G(Y){var he;return Y&&Y.state?(he=Y.state,Y.total_in=Y.total_out=he.total=0,Y.msg="",he.wrap&&(Y.adler=1&he.wrap),he.mode=C,he.last=0,he.havedict=0,he.dmax=32768,he.head=null,he.hold=0,he.bits=0,he.lencode=he.lendyn=new o.Buf32(w),he.distcode=he.distdyn=new o.Buf32(S),he.sane=1,he.back=-1,y):x}function N(Y){var he;return Y&&Y.state?((he=Y.state).wsize=0,he.whave=0,he.wnext=0,G(Y)):x}function V(Y,he){var D,re;return Y&&Y.state?(re=Y.state,he<0?(D=0,he=-he):(D=1+(he>>4),he<48&&(he&=15)),he&&(he<8||15<he)?x:(re.window!==null&&re.wbits!==he&&(re.window=null),re.wrap=D,re.wbits=he,N(Y))):x}function W(Y,he){var D,re;return Y?(re=new M,(Y.state=re).window=null,(D=V(Y,he))!==y&&(Y.state=null),D):x}var j,J,te=!0;function ce(Y){if(te){var he;for(j=new o.Buf32(512),J=new o.Buf32(32),he=0;he<144;)Y.lens[he++]=8;for(;he<256;)Y.lens[he++]=9;for(;he<280;)Y.lens[he++]=7;for(;he<288;)Y.lens[he++]=8;for(h(d,Y.lens,0,288,j,0,Y.work,{bits:9}),he=0;he<32;)Y.lens[he++]=5;h(m,Y.lens,0,32,J,0,Y.work,{bits:5}),te=!1}Y.lencode=j,Y.lenbits=9,Y.distcode=J,Y.distbits=5}function pe(Y,he,D,re){var le,fe=Y.state;return fe.window===null&&(fe.wsize=1<<fe.wbits,fe.wnext=0,fe.whave=0,fe.window=new o.Buf8(fe.wsize)),re>=fe.wsize?(o.arraySet(fe.window,he,D-fe.wsize,fe.wsize,0),fe.wnext=0,fe.whave=fe.wsize):(re<(le=fe.wsize-fe.wnext)&&(le=re),o.arraySet(fe.window,he,D-re,le,fe.wnext),(re-=le)?(o.arraySet(fe.window,he,D-re,re,0),fe.wnext=re,fe.whave=fe.wsize):(fe.wnext+=le,fe.wnext===fe.wsize&&(fe.wnext=0),fe.whave<fe.wsize&&(fe.whave+=le))),0}r.inflateReset=N,r.inflateReset2=V,r.inflateResetKeep=G,r.inflateInit=function(Y){return W(Y,15)},r.inflateInit2=W,r.inflate=function(Y,he){var D,re,le,fe,Le,we,se,Q,q,$e,Qe,qe,Lt,Pt,zt,Dt,yn,tn,Ne,Be,z,We,ke,ge,ie=0,Ce=new o.Buf8(4),Te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Y||!Y.state||!Y.output||!Y.input&&Y.avail_in!==0)return x;(D=Y.state).mode===12&&(D.mode=13),Le=Y.next_out,le=Y.output,se=Y.avail_out,fe=Y.next_in,re=Y.input,we=Y.avail_in,Q=D.hold,q=D.bits,$e=we,Qe=se,We=y;e:for(;;)switch(D.mode){case C:if(D.wrap===0){D.mode=13;break}for(;q<16;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}if(2&D.wrap&&Q===35615){Ce[D.check=0]=255&Q,Ce[1]=Q>>>8&255,D.check=l(D.check,Ce,2,0),q=Q=0,D.mode=2;break}if(D.flags=0,D.head&&(D.head.done=!1),!(1&D.wrap)||(((255&Q)<<8)+(Q>>8))%31){Y.msg="incorrect header check",D.mode=30;break}if((15&Q)!=8){Y.msg="unknown compression method",D.mode=30;break}if(q-=4,z=8+(15&(Q>>>=4)),D.wbits===0)D.wbits=z;else if(z>D.wbits){Y.msg="invalid window size",D.mode=30;break}D.dmax=1<<z,Y.adler=D.check=1,D.mode=512&Q?10:12,q=Q=0;break;case 2:for(;q<16;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}if(D.flags=Q,(255&D.flags)!=8){Y.msg="unknown compression method",D.mode=30;break}if(57344&D.flags){Y.msg="unknown header flags set",D.mode=30;break}D.head&&(D.head.text=Q>>8&1),512&D.flags&&(Ce[0]=255&Q,Ce[1]=Q>>>8&255,D.check=l(D.check,Ce,2,0)),q=Q=0,D.mode=3;case 3:for(;q<32;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}D.head&&(D.head.time=Q),512&D.flags&&(Ce[0]=255&Q,Ce[1]=Q>>>8&255,Ce[2]=Q>>>16&255,Ce[3]=Q>>>24&255,D.check=l(D.check,Ce,4,0)),q=Q=0,D.mode=4;case 4:for(;q<16;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}D.head&&(D.head.xflags=255&Q,D.head.os=Q>>8),512&D.flags&&(Ce[0]=255&Q,Ce[1]=Q>>>8&255,D.check=l(D.check,Ce,2,0)),q=Q=0,D.mode=5;case 5:if(1024&D.flags){for(;q<16;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}D.length=Q,D.head&&(D.head.extra_len=Q),512&D.flags&&(Ce[0]=255&Q,Ce[1]=Q>>>8&255,D.check=l(D.check,Ce,2,0)),q=Q=0}else D.head&&(D.head.extra=null);D.mode=6;case 6:if(1024&D.flags&&(we<(qe=D.length)&&(qe=we),qe&&(D.head&&(z=D.head.extra_len-D.length,D.head.extra||(D.head.extra=new Array(D.head.extra_len)),o.arraySet(D.head.extra,re,fe,qe,z)),512&D.flags&&(D.check=l(D.check,re,qe,fe)),we-=qe,fe+=qe,D.length-=qe),D.length))break e;D.length=0,D.mode=7;case 7:if(2048&D.flags){if(we===0)break e;for(qe=0;z=re[fe+qe++],D.head&&z&&D.length<65536&&(D.head.name+=String.fromCharCode(z)),z&&qe<we;);if(512&D.flags&&(D.check=l(D.check,re,qe,fe)),we-=qe,fe+=qe,z)break e}else D.head&&(D.head.name=null);D.length=0,D.mode=8;case 8:if(4096&D.flags){if(we===0)break e;for(qe=0;z=re[fe+qe++],D.head&&z&&D.length<65536&&(D.head.comment+=String.fromCharCode(z)),z&&qe<we;);if(512&D.flags&&(D.check=l(D.check,re,qe,fe)),we-=qe,fe+=qe,z)break e}else D.head&&(D.head.comment=null);D.mode=9;case 9:if(512&D.flags){for(;q<16;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}if(Q!==(65535&D.check)){Y.msg="header crc mismatch",D.mode=30;break}q=Q=0}D.head&&(D.head.hcrc=D.flags>>9&1,D.head.done=!0),Y.adler=D.check=0,D.mode=12;break;case 10:for(;q<32;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}Y.adler=D.check=T(Q),q=Q=0,D.mode=11;case 11:if(D.havedict===0)return Y.next_out=Le,Y.avail_out=se,Y.next_in=fe,Y.avail_in=we,D.hold=Q,D.bits=q,2;Y.adler=D.check=1,D.mode=12;case 12:if(he===5||he===6)break e;case 13:if(D.last){Q>>>=7&q,q-=7&q,D.mode=27;break}for(;q<3;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}switch(D.last=1&Q,q-=1,3&(Q>>>=1)){case 0:D.mode=14;break;case 1:if(ce(D),D.mode=20,he!==6)break;Q>>>=2,q-=2;break e;case 2:D.mode=17;break;case 3:Y.msg="invalid block type",D.mode=30}Q>>>=2,q-=2;break;case 14:for(Q>>>=7&q,q-=7&q;q<32;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}if((65535&Q)!=(Q>>>16^65535)){Y.msg="invalid stored block lengths",D.mode=30;break}if(D.length=65535&Q,q=Q=0,D.mode=15,he===6)break e;case 15:D.mode=16;case 16:if(qe=D.length){if(we<qe&&(qe=we),se<qe&&(qe=se),qe===0)break e;o.arraySet(le,re,fe,qe,Le),we-=qe,fe+=qe,se-=qe,Le+=qe,D.length-=qe;break}D.mode=12;break;case 17:for(;q<14;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}if(D.nlen=257+(31&Q),Q>>>=5,q-=5,D.ndist=1+(31&Q),Q>>>=5,q-=5,D.ncode=4+(15&Q),Q>>>=4,q-=4,286<D.nlen||30<D.ndist){Y.msg="too many length or distance symbols",D.mode=30;break}D.have=0,D.mode=18;case 18:for(;D.have<D.ncode;){for(;q<3;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}D.lens[Te[D.have++]]=7&Q,Q>>>=3,q-=3}for(;D.have<19;)D.lens[Te[D.have++]]=0;if(D.lencode=D.lendyn,D.lenbits=7,ke={bits:D.lenbits},We=h(0,D.lens,0,19,D.lencode,0,D.work,ke),D.lenbits=ke.bits,We){Y.msg="invalid code lengths set",D.mode=30;break}D.have=0,D.mode=19;case 19:for(;D.have<D.nlen+D.ndist;){for(;Dt=(ie=D.lencode[Q&(1<<D.lenbits)-1])>>>16&255,yn=65535&ie,!((zt=ie>>>24)<=q);){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}if(yn<16)Q>>>=zt,q-=zt,D.lens[D.have++]=yn;else{if(yn===16){for(ge=zt+2;q<ge;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}if(Q>>>=zt,q-=zt,D.have===0){Y.msg="invalid bit length repeat",D.mode=30;break}z=D.lens[D.have-1],qe=3+(3&Q),Q>>>=2,q-=2}else if(yn===17){for(ge=zt+3;q<ge;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}q-=zt,z=0,qe=3+(7&(Q>>>=zt)),Q>>>=3,q-=3}else{for(ge=zt+7;q<ge;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}q-=zt,z=0,qe=11+(127&(Q>>>=zt)),Q>>>=7,q-=7}if(D.have+qe>D.nlen+D.ndist){Y.msg="invalid bit length repeat",D.mode=30;break}for(;qe--;)D.lens[D.have++]=z}}if(D.mode===30)break;if(D.lens[256]===0){Y.msg="invalid code -- missing end-of-block",D.mode=30;break}if(D.lenbits=9,ke={bits:D.lenbits},We=h(d,D.lens,0,D.nlen,D.lencode,0,D.work,ke),D.lenbits=ke.bits,We){Y.msg="invalid literal/lengths set",D.mode=30;break}if(D.distbits=6,D.distcode=D.distdyn,ke={bits:D.distbits},We=h(m,D.lens,D.nlen,D.ndist,D.distcode,0,D.work,ke),D.distbits=ke.bits,We){Y.msg="invalid distances set",D.mode=30;break}if(D.mode=20,he===6)break e;case 20:D.mode=21;case 21:if(6<=we&&258<=se){Y.next_out=Le,Y.avail_out=se,Y.next_in=fe,Y.avail_in=we,D.hold=Q,D.bits=q,u(Y,Qe),Le=Y.next_out,le=Y.output,se=Y.avail_out,fe=Y.next_in,re=Y.input,we=Y.avail_in,Q=D.hold,q=D.bits,D.mode===12&&(D.back=-1);break}for(D.back=0;Dt=(ie=D.lencode[Q&(1<<D.lenbits)-1])>>>16&255,yn=65535&ie,!((zt=ie>>>24)<=q);){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}if(Dt&&(240&Dt)==0){for(tn=zt,Ne=Dt,Be=yn;Dt=(ie=D.lencode[Be+((Q&(1<<tn+Ne)-1)>>tn)])>>>16&255,yn=65535&ie,!(tn+(zt=ie>>>24)<=q);){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}Q>>>=tn,q-=tn,D.back+=tn}if(Q>>>=zt,q-=zt,D.back+=zt,D.length=yn,Dt===0){D.mode=26;break}if(32&Dt){D.back=-1,D.mode=12;break}if(64&Dt){Y.msg="invalid literal/length code",D.mode=30;break}D.extra=15&Dt,D.mode=22;case 22:if(D.extra){for(ge=D.extra;q<ge;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}D.length+=Q&(1<<D.extra)-1,Q>>>=D.extra,q-=D.extra,D.back+=D.extra}D.was=D.length,D.mode=23;case 23:for(;Dt=(ie=D.distcode[Q&(1<<D.distbits)-1])>>>16&255,yn=65535&ie,!((zt=ie>>>24)<=q);){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}if((240&Dt)==0){for(tn=zt,Ne=Dt,Be=yn;Dt=(ie=D.distcode[Be+((Q&(1<<tn+Ne)-1)>>tn)])>>>16&255,yn=65535&ie,!(tn+(zt=ie>>>24)<=q);){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}Q>>>=tn,q-=tn,D.back+=tn}if(Q>>>=zt,q-=zt,D.back+=zt,64&Dt){Y.msg="invalid distance code",D.mode=30;break}D.offset=yn,D.extra=15&Dt,D.mode=24;case 24:if(D.extra){for(ge=D.extra;q<ge;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}D.offset+=Q&(1<<D.extra)-1,Q>>>=D.extra,q-=D.extra,D.back+=D.extra}if(D.offset>D.dmax){Y.msg="invalid distance too far back",D.mode=30;break}D.mode=25;case 25:if(se===0)break e;if(qe=Qe-se,D.offset>qe){if((qe=D.offset-qe)>D.whave&&D.sane){Y.msg="invalid distance too far back",D.mode=30;break}Lt=qe>D.wnext?(qe-=D.wnext,D.wsize-qe):D.wnext-qe,qe>D.length&&(qe=D.length),Pt=D.window}else Pt=le,Lt=Le-D.offset,qe=D.length;for(se<qe&&(qe=se),se-=qe,D.length-=qe;le[Le++]=Pt[Lt++],--qe;);D.length===0&&(D.mode=21);break;case 26:if(se===0)break e;le[Le++]=D.length,se--,D.mode=21;break;case 27:if(D.wrap){for(;q<32;){if(we===0)break e;we--,Q|=re[fe++]<<q,q+=8}if(Qe-=se,Y.total_out+=Qe,D.total+=Qe,Qe&&(Y.adler=D.check=D.flags?l(D.check,le,Qe,Le-Qe):s(D.check,le,Qe,Le-Qe)),Qe=se,(D.flags?Q:T(Q))!==D.check){Y.msg="incorrect data check",D.mode=30;break}q=Q=0}D.mode=28;case 28:if(D.wrap&&D.flags){for(;q<32;){if(we===0)break e;we--,Q+=re[fe++]<<q,q+=8}if(Q!==(4294967295&D.total)){Y.msg="incorrect length check",D.mode=30;break}q=Q=0}D.mode=29;case 29:We=1;break e;case 30:We=-3;break e;case 31:return-4;case 32:default:return x}return Y.next_out=Le,Y.avail_out=se,Y.next_in=fe,Y.avail_in=we,D.hold=Q,D.bits=q,(D.wsize||Qe!==Y.avail_out&&D.mode<30&&(D.mode<27||he!==4))&&pe(Y,Y.output,Y.next_out,Qe-Y.avail_out)?(D.mode=31,-4):($e-=Y.avail_in,Qe-=Y.avail_out,Y.total_in+=$e,Y.total_out+=Qe,D.total+=Qe,D.wrap&&Qe&&(Y.adler=D.check=D.flags?l(D.check,le,Qe,Y.next_out-Qe):s(D.check,le,Qe,Y.next_out-Qe)),Y.data_type=D.bits+(D.last?64:0)+(D.mode===12?128:0)+(D.mode===20||D.mode===15?256:0),($e==0&&Qe===0||he===4)&&We===y&&(We=-5),We)},r.inflateEnd=function(Y){if(!Y||!Y.state)return x;var he=Y.state;return he.window&&(he.window=null),Y.state=null,y},r.inflateGetHeader=function(Y,he){var D;return Y&&Y.state?(2&(D=Y.state).wrap)==0?x:((D.head=he).done=!1,y):x},r.inflateSetDictionary=function(Y,he){var D,re=he.length;return Y&&Y.state?(D=Y.state).wrap!==0&&D.mode!==11?x:D.mode===11&&s(1,he,re,0)!==D.check?-3:pe(Y,he,re,re)?(D.mode=31,-4):(D.havedict=1,y):x},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,r){var o=t("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(d,m,y,x,C,w,S,T){var M,G,N,V,W,j,J,te,ce,pe=T.bits,Y=0,he=0,D=0,re=0,le=0,fe=0,Le=0,we=0,se=0,Q=0,q=null,$e=0,Qe=new o.Buf16(16),qe=new o.Buf16(16),Lt=null,Pt=0;for(Y=0;Y<=15;Y++)Qe[Y]=0;for(he=0;he<x;he++)Qe[m[y+he]]++;for(le=pe,re=15;1<=re&&Qe[re]===0;re--);if(re<le&&(le=re),re===0)return C[w++]=20971520,C[w++]=20971520,T.bits=1,0;for(D=1;D<re&&Qe[D]===0;D++);for(le<D&&(le=D),Y=we=1;Y<=15;Y++)if(we<<=1,(we-=Qe[Y])<0)return-1;if(0<we&&(d===0||re!==1))return-1;for(qe[1]=0,Y=1;Y<15;Y++)qe[Y+1]=qe[Y]+Qe[Y];for(he=0;he<x;he++)m[y+he]!==0&&(S[qe[m[y+he]]++]=he);if(j=d===0?(q=Lt=S,19):d===1?(q=s,$e-=257,Lt=l,Pt-=257,256):(q=u,Lt=h,-1),Y=D,W=w,Le=he=Q=0,N=-1,V=(se=1<<(fe=le))-1,d===1&&852<se||d===2&&592<se)return 1;for(;;){for(J=Y-Le,ce=S[he]<j?(te=0,S[he]):S[he]>j?(te=Lt[Pt+S[he]],q[$e+S[he]]):(te=96,0),M=1<<Y-Le,D=G=1<<fe;C[W+(Q>>Le)+(G-=M)]=J<<24|te<<16|ce|0,G!==0;);for(M=1<<Y-1;Q&M;)M>>=1;if(M!==0?(Q&=M-1,Q+=M):Q=0,he++,--Qe[Y]==0){if(Y===re)break;Y=m[y+S[he]]}if(le<Y&&(Q&V)!==N){for(Le===0&&(Le=le),W+=D,we=1<<(fe=Y-Le);fe+Le<re&&!((we-=Qe[fe+Le])<=0);)fe++,we<<=1;if(se+=1<<fe,d===1&&852<se||d===2&&592<se)return 1;C[N=Q&V]=le<<24|fe<<16|W-w|0}}return Q!==0&&(C[W+Q]=Y-Le<<24|64<<16|0),T.bits=le,0}},{"../utils/common":41}],51:[function(t,i,r){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,r){var o=t("../utils/common"),s=0,l=1;function u(ie){for(var Ce=ie.length;0<=--Ce;)ie[Ce]=0}var h=0,d=29,m=256,y=m+1+d,x=30,C=19,w=2*y+1,S=15,T=16,M=7,G=256,N=16,V=17,W=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],J=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],te=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ce=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],pe=new Array(2*(y+2));u(pe);var Y=new Array(2*x);u(Y);var he=new Array(512);u(he);var D=new Array(256);u(D);var re=new Array(d);u(re);var le,fe,Le,we=new Array(x);function se(ie,Ce,Te,De,Ze){this.static_tree=ie,this.extra_bits=Ce,this.extra_base=Te,this.elems=De,this.max_length=Ze,this.has_stree=ie&&ie.length}function Q(ie,Ce){this.dyn_tree=ie,this.max_code=0,this.stat_desc=Ce}function q(ie){return ie<256?he[ie]:he[256+(ie>>>7)]}function $e(ie,Ce){ie.pending_buf[ie.pending++]=255&Ce,ie.pending_buf[ie.pending++]=Ce>>>8&255}function Qe(ie,Ce,Te){ie.bi_valid>T-Te?(ie.bi_buf|=Ce<<ie.bi_valid&65535,$e(ie,ie.bi_buf),ie.bi_buf=Ce>>T-ie.bi_valid,ie.bi_valid+=Te-T):(ie.bi_buf|=Ce<<ie.bi_valid&65535,ie.bi_valid+=Te)}function qe(ie,Ce,Te){Qe(ie,Te[2*Ce],Te[2*Ce+1])}function Lt(ie,Ce){for(var Te=0;Te|=1&ie,ie>>>=1,Te<<=1,0<--Ce;);return Te>>>1}function Pt(ie,Ce,Te){var De,Ze,Je=new Array(S+1),dt=0;for(De=1;De<=S;De++)Je[De]=dt=dt+Te[De-1]<<1;for(Ze=0;Ze<=Ce;Ze++){var ft=ie[2*Ze+1];ft!==0&&(ie[2*Ze]=Lt(Je[ft]++,ft))}}function zt(ie){var Ce;for(Ce=0;Ce<y;Ce++)ie.dyn_ltree[2*Ce]=0;for(Ce=0;Ce<x;Ce++)ie.dyn_dtree[2*Ce]=0;for(Ce=0;Ce<C;Ce++)ie.bl_tree[2*Ce]=0;ie.dyn_ltree[2*G]=1,ie.opt_len=ie.static_len=0,ie.last_lit=ie.matches=0}function Dt(ie){8<ie.bi_valid?$e(ie,ie.bi_buf):0<ie.bi_valid&&(ie.pending_buf[ie.pending++]=ie.bi_buf),ie.bi_buf=0,ie.bi_valid=0}function yn(ie,Ce,Te,De){var Ze=2*Ce,Je=2*Te;return ie[Ze]<ie[Je]||ie[Ze]===ie[Je]&&De[Ce]<=De[Te]}function tn(ie,Ce,Te){for(var De=ie.heap[Te],Ze=Te<<1;Ze<=ie.heap_len&&(Ze<ie.heap_len&&yn(Ce,ie.heap[Ze+1],ie.heap[Ze],ie.depth)&&Ze++,!yn(Ce,De,ie.heap[Ze],ie.depth));)ie.heap[Te]=ie.heap[Ze],Te=Ze,Ze<<=1;ie.heap[Te]=De}function Ne(ie,Ce,Te){var De,Ze,Je,dt,ft=0;if(ie.last_lit!==0)for(;De=ie.pending_buf[ie.d_buf+2*ft]<<8|ie.pending_buf[ie.d_buf+2*ft+1],Ze=ie.pending_buf[ie.l_buf+ft],ft++,De===0?qe(ie,Ze,Ce):(qe(ie,(Je=D[Ze])+m+1,Ce),(dt=j[Je])!==0&&Qe(ie,Ze-=re[Je],dt),qe(ie,Je=q(--De),Te),(dt=J[Je])!==0&&Qe(ie,De-=we[Je],dt)),ft<ie.last_lit;);qe(ie,G,Ce)}function Be(ie,Ce){var Te,De,Ze,Je=Ce.dyn_tree,dt=Ce.stat_desc.static_tree,ft=Ce.stat_desc.has_stree,Tt=Ce.stat_desc.elems,hn=-1;for(ie.heap_len=0,ie.heap_max=w,Te=0;Te<Tt;Te++)Je[2*Te]!==0?(ie.heap[++ie.heap_len]=hn=Te,ie.depth[Te]=0):Je[2*Te+1]=0;for(;ie.heap_len<2;)Je[2*(Ze=ie.heap[++ie.heap_len]=hn<2?++hn:0)]=1,ie.depth[Ze]=0,ie.opt_len--,ft&&(ie.static_len-=dt[2*Ze+1]);for(Ce.max_code=hn,Te=ie.heap_len>>1;1<=Te;Te--)tn(ie,Je,Te);for(Ze=Tt;Te=ie.heap[1],ie.heap[1]=ie.heap[ie.heap_len--],tn(ie,Je,1),De=ie.heap[1],ie.heap[--ie.heap_max]=Te,ie.heap[--ie.heap_max]=De,Je[2*Ze]=Je[2*Te]+Je[2*De],ie.depth[Ze]=(ie.depth[Te]>=ie.depth[De]?ie.depth[Te]:ie.depth[De])+1,Je[2*Te+1]=Je[2*De+1]=Ze,ie.heap[1]=Ze++,tn(ie,Je,1),2<=ie.heap_len;);ie.heap[--ie.heap_max]=ie.heap[1],(function(cn,vi){var Hi,Li,Tr,pi,rs,wi,Ti=vi.dyn_tree,Bs=vi.max_code,xo=vi.stat_desc.static_tree,Ea=vi.stat_desc.has_stree,ms=vi.stat_desc.extra_bits,Wr=vi.stat_desc.extra_base,zr=vi.stat_desc.max_length,ys=0;for(pi=0;pi<=S;pi++)cn.bl_count[pi]=0;for(Ti[2*cn.heap[cn.heap_max]+1]=0,Hi=cn.heap_max+1;Hi<w;Hi++)zr<(pi=Ti[2*Ti[2*(Li=cn.heap[Hi])+1]+1]+1)&&(pi=zr,ys++),Ti[2*Li+1]=pi,Bs<Li||(cn.bl_count[pi]++,rs=0,Wr<=Li&&(rs=ms[Li-Wr]),wi=Ti[2*Li],cn.opt_len+=wi*(pi+rs),Ea&&(cn.static_len+=wi*(xo[2*Li+1]+rs)));if(ys!==0){do{for(pi=zr-1;cn.bl_count[pi]===0;)pi--;cn.bl_count[pi]--,cn.bl_count[pi+1]+=2,cn.bl_count[zr]--,ys-=2}while(0<ys);for(pi=zr;pi!==0;pi--)for(Li=cn.bl_count[pi];Li!==0;)Bs<(Tr=cn.heap[--Hi])||(Ti[2*Tr+1]!==pi&&(cn.opt_len+=(pi-Ti[2*Tr+1])*Ti[2*Tr],Ti[2*Tr+1]=pi),Li--)}})(ie,Ce),Pt(Je,hn,ie.bl_count)}function z(ie,Ce,Te){var De,Ze,Je=-1,dt=Ce[1],ft=0,Tt=7,hn=4;for(dt===0&&(Tt=138,hn=3),Ce[2*(Te+1)+1]=65535,De=0;De<=Te;De++)Ze=dt,dt=Ce[2*(De+1)+1],++ft<Tt&&Ze===dt||(ft<hn?ie.bl_tree[2*Ze]+=ft:Ze!==0?(Ze!==Je&&ie.bl_tree[2*Ze]++,ie.bl_tree[2*N]++):ft<=10?ie.bl_tree[2*V]++:ie.bl_tree[2*W]++,Je=Ze,hn=(ft=0)===dt?(Tt=138,3):Ze===dt?(Tt=6,3):(Tt=7,4))}function We(ie,Ce,Te){var De,Ze,Je=-1,dt=Ce[1],ft=0,Tt=7,hn=4;for(dt===0&&(Tt=138,hn=3),De=0;De<=Te;De++)if(Ze=dt,dt=Ce[2*(De+1)+1],!(++ft<Tt&&Ze===dt)){if(ft<hn)for(;qe(ie,Ze,ie.bl_tree),--ft!=0;);else Ze!==0?(Ze!==Je&&(qe(ie,Ze,ie.bl_tree),ft--),qe(ie,N,ie.bl_tree),Qe(ie,ft-3,2)):ft<=10?(qe(ie,V,ie.bl_tree),Qe(ie,ft-3,3)):(qe(ie,W,ie.bl_tree),Qe(ie,ft-11,7));Je=Ze,hn=(ft=0)===dt?(Tt=138,3):Ze===dt?(Tt=6,3):(Tt=7,4)}}u(we);var ke=!1;function ge(ie,Ce,Te,De){Qe(ie,(h<<1)+(De?1:0),3),(function(Ze,Je,dt,ft){Dt(Ze),$e(Ze,dt),$e(Ze,~dt),o.arraySet(Ze.pending_buf,Ze.window,Je,dt,Ze.pending),Ze.pending+=dt})(ie,Ce,Te)}r._tr_init=function(ie){ke||((function(){var Ce,Te,De,Ze,Je,dt=new Array(S+1);for(Ze=De=0;Ze<d-1;Ze++)for(re[Ze]=De,Ce=0;Ce<1<<j[Ze];Ce++)D[De++]=Ze;for(D[De-1]=Ze,Ze=Je=0;Ze<16;Ze++)for(we[Ze]=Je,Ce=0;Ce<1<<J[Ze];Ce++)he[Je++]=Ze;for(Je>>=7;Ze<x;Ze++)for(we[Ze]=Je<<7,Ce=0;Ce<1<<J[Ze]-7;Ce++)he[256+Je++]=Ze;for(Te=0;Te<=S;Te++)dt[Te]=0;for(Ce=0;Ce<=143;)pe[2*Ce+1]=8,Ce++,dt[8]++;for(;Ce<=255;)pe[2*Ce+1]=9,Ce++,dt[9]++;for(;Ce<=279;)pe[2*Ce+1]=7,Ce++,dt[7]++;for(;Ce<=287;)pe[2*Ce+1]=8,Ce++,dt[8]++;for(Pt(pe,y+1,dt),Ce=0;Ce<x;Ce++)Y[2*Ce+1]=5,Y[2*Ce]=Lt(Ce,5);le=new se(pe,j,m+1,y,S),fe=new se(Y,J,0,x,S),Le=new se(new Array(0),te,0,C,M)})(),ke=!0),ie.l_desc=new Q(ie.dyn_ltree,le),ie.d_desc=new Q(ie.dyn_dtree,fe),ie.bl_desc=new Q(ie.bl_tree,Le),ie.bi_buf=0,ie.bi_valid=0,zt(ie)},r._tr_stored_block=ge,r._tr_flush_block=function(ie,Ce,Te,De){var Ze,Je,dt=0;0<ie.level?(ie.strm.data_type===2&&(ie.strm.data_type=(function(ft){var Tt,hn=4093624447;for(Tt=0;Tt<=31;Tt++,hn>>>=1)if(1&hn&&ft.dyn_ltree[2*Tt]!==0)return s;if(ft.dyn_ltree[18]!==0||ft.dyn_ltree[20]!==0||ft.dyn_ltree[26]!==0)return l;for(Tt=32;Tt<m;Tt++)if(ft.dyn_ltree[2*Tt]!==0)return l;return s})(ie)),Be(ie,ie.l_desc),Be(ie,ie.d_desc),dt=(function(ft){var Tt;for(z(ft,ft.dyn_ltree,ft.l_desc.max_code),z(ft,ft.dyn_dtree,ft.d_desc.max_code),Be(ft,ft.bl_desc),Tt=C-1;3<=Tt&&ft.bl_tree[2*ce[Tt]+1]===0;Tt--);return ft.opt_len+=3*(Tt+1)+5+5+4,Tt})(ie),Ze=ie.opt_len+3+7>>>3,(Je=ie.static_len+3+7>>>3)<=Ze&&(Ze=Je)):Ze=Je=Te+5,Te+4<=Ze&&Ce!==-1?ge(ie,Ce,Te,De):ie.strategy===4||Je===Ze?(Qe(ie,2+(De?1:0),3),Ne(ie,pe,Y)):(Qe(ie,4+(De?1:0),3),(function(ft,Tt,hn,cn){var vi;for(Qe(ft,Tt-257,5),Qe(ft,hn-1,5),Qe(ft,cn-4,4),vi=0;vi<cn;vi++)Qe(ft,ft.bl_tree[2*ce[vi]+1],3);We(ft,ft.dyn_ltree,Tt-1),We(ft,ft.dyn_dtree,hn-1)})(ie,ie.l_desc.max_code+1,ie.d_desc.max_code+1,dt+1),Ne(ie,ie.dyn_ltree,ie.dyn_dtree)),zt(ie),De&&Dt(ie)},r._tr_tally=function(ie,Ce,Te){return ie.pending_buf[ie.d_buf+2*ie.last_lit]=Ce>>>8&255,ie.pending_buf[ie.d_buf+2*ie.last_lit+1]=255&Ce,ie.pending_buf[ie.l_buf+ie.last_lit]=255&Te,ie.last_lit++,Ce===0?ie.dyn_ltree[2*Te]++:(ie.matches++,Ce--,ie.dyn_ltree[2*(D[Te]+m+1)]++,ie.dyn_dtree[2*q(Ce)]++),ie.last_lit===ie.lit_bufsize-1},r._tr_align=function(ie){Qe(ie,2,3),qe(ie,G,pe),(function(Ce){Ce.bi_valid===16?($e(Ce,Ce.bi_buf),Ce.bi_buf=0,Ce.bi_valid=0):8<=Ce.bi_valid&&(Ce.pending_buf[Ce.pending++]=255&Ce.bi_buf,Ce.bi_buf>>=8,Ce.bi_valid-=8)})(ie)}},{"../utils/common":41}],53:[function(t,i,r){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,r){(function(o){(function(s,l){if(!s.setImmediate){var u,h,d,m,y=1,x={},C=!1,w=s.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(s);S=S&&S.setTimeout?S:s,u={}.toString.call(s.process)==="[object process]"?function(N){process.nextTick(function(){M(N)})}:(function(){if(s.postMessage&&!s.importScripts){var N=!0,V=s.onmessage;return s.onmessage=function(){N=!1},s.postMessage("","*"),s.onmessage=V,N}})()?(m="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",G,!1):s.attachEvent("onmessage",G),function(N){s.postMessage(m+N,"*")}):s.MessageChannel?((d=new MessageChannel).port1.onmessage=function(N){M(N.data)},function(N){d.port2.postMessage(N)}):w&&"onreadystatechange"in w.createElement("script")?(h=w.documentElement,function(N){var V=w.createElement("script");V.onreadystatechange=function(){M(N),V.onreadystatechange=null,h.removeChild(V),V=null},h.appendChild(V)}):function(N){setTimeout(M,0,N)},S.setImmediate=function(N){typeof N!="function"&&(N=new Function(""+N));for(var V=new Array(arguments.length-1),W=0;W<V.length;W++)V[W]=arguments[W+1];var j={callback:N,args:V};return x[y]=j,u(y),y++},S.clearImmediate=T}function T(N){delete x[N]}function M(N){if(C)setTimeout(M,0,N);else{var V=x[N];if(V){C=!0;try{(function(W){var j=W.callback,J=W.args;switch(J.length){case 0:j();break;case 1:j(J[0]);break;case 2:j(J[0],J[1]);break;case 3:j(J[0],J[1],J[2]);break;default:j.apply(l,J)}})(V)}finally{T(N),C=!1}}}}function G(N){N.source===s&&typeof N.data=="string"&&N.data.indexOf(m)===0&&M(+N.data.slice(m.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Jd<"u"?Jd:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(oE)),oE.exports}var h2e=c2e();const d2e=u4(h2e);function f2e(n,e){const i=new pW({extractStyles:!0,showPointNames:!0}).readFeatures(n,{dataProjection:Fu,featureProjection:e.getView().getProjection()});return _z(i)}function p2e(n,e){const i=new uW().readFeatures(n,{dataProjection:Fu,featureProjection:e.getView().getProjection()});return _z(i)}function Jx(n,e){const t=n.clone();return t.setGeometry(e),t}function _z(n){const e=[];return n.forEach(t=>{const i=t.getGeometry();switch(i?.getType()){case"MultiPolygon":{const r=i.getPolygons();e.push(...r.map(o=>Jx(t,o)));break}case"MultiLineString":{const r=i.getLineStrings();e.push(...r.map(o=>Jx(t,o)));break}case"MultiPoint":{const r=i.getPoints();e.push(...r.map(o=>Jx(t,o)));break}case"GeometryCollection":{const r=i;e.push(...r.getGeometries().map(o=>Jx(t,o)));break}default:e.push(t);break}}),e}function g2e(n){return n.split(".").pop()?.toLowerCase()}function m2e(n){return n!==void 0&&["gpx","kml","kmz"].includes(n)}function y2e(n,e){return new Promise((t,i)=>{const r=n.name,o=g2e(r);if(!m2e(o)){i(new Error(`Invalid file extension: ${o}`));return}const s=new FileReader;s.onload=async l=>{const u=l.target?.result;if(!u){i(new Error("Failed to read file content"));return}try{let h;o==="kmz"?h=await v2e(u,e):o==="kml"?h=vz(u,e):h=_2e(u,e),t({content:u,fileName:r,extension:o,features:h})}catch(h){i(h)}},s.onerror=()=>{i(s.error||new Error("Failed to read file"))},o==="kmz"?s.readAsArrayBuffer(n):s.readAsText(n)})}function vz(n,e){return f2e(n,e)}function _2e(n,e){return p2e(n,e)}async function v2e(n,e){const i=await new d2e().loadAsync(n),r=Object.keys(i.files).find(s=>s.toLowerCase().endsWith(".kml"));if(!r)throw new Error("No KML file found in KMZ archive");const o=await i.files[r].async("string");return vz(o,e)}const b2e={class:"flex items-center"},x2e=["title","aria-label"],I2e=["aria-label"],C2e=["aria-label"],w2e={key:1,class:"italic"},A2e={key:0,class:"lux-alert-warning p-4 mb-2"},S2e={class:"font-bold"},E2e=["innerHTML"],T2e={class:"flex gap-2 mt-2 justify-end"},R2e={class:"flex items-center text-white mr-0.5"},M2e={class:"text-sm italic grow"},k2e=["aria-label"],L2e=["aria-label"],P2e=["aria-label"],G2e=st({__name:"my-map-info",props:{myMap:{}},emits:["close","new","open","copy","edit","share","delete","clear","resetLayers","saveLayers","draw:mergelines","draw:cutlines"],setup(n,{emit:e}){const{t}=Ct(),i=e,r=n,o=Kn().getOlMap(),{generateDrawnFeature:s}=sA(),{myMapLayersChanged:l}=xt(oi()),u=Jr(),{drawnFeaturesMyMaps:h,clipLineActive:d}=xt(u),m=Ke(null),y=Ke(null),x=At(()=>[{label:"Crer une nouvelle carte",action:()=>i("new")},{label:"Ouvrir une carte existante",action:()=>i("open")},{label:"Crer une copie",action:()=>i("copy",r.myMap)},{label:"Partager la carte",action:()=>i("share",r.myMap),separator:!0},{label:"Supprimer la carte",action:()=>i("delete",r.myMap)},{label:"Supprimer tous les lements de la carte",action:()=>i("clear",r.myMap)},{label:"Fusionner des lignes",action:()=>i("draw:mergelines",r.myMap)},{label:d.value?"Dsactiver mode couper une ligne":"Couper une ligne",action:()=>i("draw:cutlines",r.myMap),separator:!0},{label:"Fermer",action:()=>i("close"),separator:!0},{label:"Exporter un GPX",action:()=>C("gpx")},{label:"Exporter un KML",action:()=>C("kml")},{label:"Exporter un Shapefile",action:()=>C("shapefile")},{label:"Importer un fichier GPX/KML/KMZ",action:()=>w()}]);kt(y,async S=>{if(S)try{const T=await y2e(S,o),{features:M}=T;M.forEach(G=>{const N=s(G);u.addDrawnFeatureToCollection(N),N.fit()})}catch(T){console.error("Error importing file:",T)}finally{y.value=null}});function C(S){gA.export(o,S,h.value,r.myMap.title,!0)}function w(){m.value?.click()}return(S,T)=>(U(),oe(Et,null,[P("div",b2e,[P("h2",{"data-cy":"mymap-title",class:"text-white font-bold grow max-w-full text-ellipsis overflow-hidden text-nowrap hover:cursor-pointer",role:"button",title:n.myMap.title,"aria-label":k(t)("diter le titre de la carte")+" : "+n.myMap.title,tabindex:"0",onClick:T[0]||(T[0]=M=>i("edit",n.myMap)),onKeydown:[T[1]||(T[1]=Js(M=>i("edit",n.myMap),["enter"])),T[2]||(T[2]=Js(fs(M=>i("edit",n.myMap),["prevent"]),["space"]))]},K(n.myMap.title),41,x2e),P("button",{onClick:T[3]||(T[3]=M=>i("close")),class:"text-slate-400 hover:text-slate-700 text-2xl","aria-label":k(t)("Close")},[...T[10]||(T[10]=[P("span",{"aria-hidden":"true"},"",-1)])],8,I2e)]),P("p",{"data-cy":"mymap-description",class:"text-white mb-2 hover:cursor-pointer",role:"button","aria-label":k(t)("diter la description de la carte"),tabindex:"0",onClick:T[4]||(T[4]=M=>i("edit",n.myMap)),onKeydown:[T[5]||(T[5]=Js(M=>i("edit",n.myMap),["enter"])),T[6]||(T[6]=Js(fs(M=>i("edit",n.myMap),["prevent"]),["space"]))]},[n.myMap.description?(U(),oe(Et,{key:0},[Bt(K(n.myMap.description),1)],64)):(U(),oe("span",w2e,K(k(t)("Aucune description")),1))],40,C2e),k(l)?(U(),oe("div",A2e,[P("span",S2e,K(k(t)("Attention!")),1),T[11]||(T[11]=Bt("",-1)),P("span",{innerHTML:k(t)("Les couches slectionnes dans le catalogue sont diffrentes de celles charges avec votre carte. Voulez vous sauvegarder ces modifications dans votre carte?")},null,8,E2e),P("div",T2e,[P("button",{class:"lux-btn",onClick:T[7]||(T[7]=M=>i("resetLayers",n.myMap))},K(k(t)("Reset")),1),P("button",{class:"lux-btn",onClick:T[8]||(T[8]=M=>i("saveLayers",n.myMap))},K(k(t)("Oui")),1)])])):Ge("",!0),P("div",R2e,[P("span",M2e,[n.myMap.public?(U(),oe("i",{key:0,class:"fa fa-unlock mr-1","aria-label":k(t)("Carte publique")},null,8,k2e)):(U(),oe("i",{key:1,class:"fa fa-lock mr-1","aria-label":k(t)("Carte prive")},null,8,L2e)),Bt(" "+K(k(t)("Carte cre par"))+" "+K(n.myMap.user_login),1)]),P("input",{type:"file",class:"sr-only",ref_key:"fileInputRef",ref:m,id:"gpx-kml-import",accept:".gpx,.kml,.kmz","aria-label":k(t)("Importer un fichier GPX/KML/KMZ"),onChange:T[9]||(T[9]=M=>y.value=M.target.files?.[0]||null)},null,40,P2e),mt(Ok,{"data-cy":"drawPanelMenuPopup",items:x.value,direction:"down",ariaLabel:k(t)("My Map menu")},{item:Xt(({item:M})=>[mt(Nk,{item:M,onClick:M.action},{default:Xt(()=>[Bt(K(k(t)(M.label)),1)]),_:2},1032,["item","onClick"])]),default:Xt(()=>[T[12]||(T[12]=P("i",{class:"fa-solid fa-square-caret-down hover:text-tertiary"},null,-1))]),_:1},8,["items","ariaLabel"])])],64))}}),F2e={ref:"filtersWrapperDOM",class:"mt-2 mb-8 mx-2 flex flex-row gap-2 fixed"},O2e={for:"map-search-input",class:"sr-only"},N2e=["placeholder","aria-label"],D2e={for:"category-filter",class:"sr-only"},V2e={for:"owner-filter",class:"sr-only"},B2e={ref:"resultsWrapperDOM",class:"px-2 h-96 overflow-y-auto"},Z2e=["aria-label"],W2e={scope:"col",class:"py-2 text-left w-40"},z2e=["aria-label"],U2e={class:"w-5 inline-block","aria-hidden":"true"},X2e={scope:"col",class:"text-left"},Y2e=["aria-label"],H2e={class:"w-5 inline-block","aria-hidden":"true"},K2e={scope:"col",class:"text-left"},j2e=["aria-label"],$2e={class:"w-5 inline-block","aria-hidden":"true"},J2e={scope:"col",class:"text-left"},q2e=["aria-label"],Q2e={class:"w-5 inline-block","aria-hidden":"true"},eSe={scope:"col"},tSe={class:"sr-only"},nSe=["onClick","aria-label","onKeydown"],iSe=["title"],rSe=["aria-label"],sSe=["onClick"],oSe=["onClick"],aSe=["onClick"],lSe=["onClick","aria-label"],uSe=["onClick","aria-label"],cSe={key:0},hSe={colspan:"6",class:"pt-2 border-t-[1px] italic",role:"status"},dSe={key:1},fSe={colspan:"6",class:"pt-2 border-t-[1px] italic",role:"status","aria-live":"polite","aria-busy":"true"},pSe={class:"flex flex-row justify-end gap-2"},gSe=st({__name:"my-maps-open-map-list",props:{maps:{},isLoadingMyMaps:{type:Boolean}},emits:["cancel","select","delete"],setup(n,{emit:e}){const t=e,i=n,{t:r}=Ct(),{isOffLine:o}=xt(oi()),s=Ke(""),l=Ke(""),u=At(()=>[{label:r("Filter results by category"),value:""}].concat([...new Set(i.maps.map(G=>G.category))].map(G=>({label:G,value:G})))),h=Ke(""),d=At(()=>[{label:r("Filter results by username"),value:""}].concat([...new Set(i.maps.map(G=>G.owner))].map(G=>({label:G,value:G})))),m=Ke(void 0),y=Ke(!0),x=At(()=>i.isLoadingMyMaps?[]:i.maps.filter(T).sort((G,N)=>M(G,N,m.value,y.value))),C=vv("filtersWrapperDOM"),w=vv("resultsWrapperDOM");gr(()=>{const G=C.value?.offsetHeight;G&&w.value&&(w.value.style.marginTop=G+32+"px"),C.value&&w.value&&(C.value.style.width=w.value.offsetWidth+"px",C.value.style.maxWidth=w.value.offsetWidth+"px")});function S(G){console.log("TODO",G)}function T(G){const N=s.value?G.title.toLowerCase().includes(s.value.toLowerCase()):!0,V=l.value?G.category.toLowerCase()===l.value.toLowerCase():!0,W=h.value?G.owner.toLowerCase()===h.value.toLowerCase():!0;return N&&V&&W}function M(G,N,V,W){const j=(W?G[V]:N[V])||"",J=(W?N[V]:G[V])||"";return j<J?-1:j>J?1:0}return(G,N)=>(U(),Mt(Rf,{title:k(r)("Ouvrir une carte"),onClose:N[10]||(N[10]=V=>t("cancel"))},{content:Xt(()=>[P("div",F2e,[P("div",null,[P("label",O2e,K(k(r)("Search Maps")),1),Sn(P("input",{id:"map-search-input",placeholder:k(r)("Search Maps"),class:"lux-input",type:"text","onUpdate:modelValue":N[0]||(N[0]=V=>s.value=V),"aria-label":k(r)("Search Maps")},null,8,N2e),[[Zr,s.value]])]),P("div",null,[P("label",D2e,K(k(r)("Filter results by category")),1),mt(eg,{id:"category-filter",class:"inline-block min-w-36 w-60",options:u.value,modelValue:l.value,"onUpdate:modelValue":N[1]||(N[1]=V=>l.value=V),onChange:N[2]||(N[2]=V=>l.value=V),"aria-label":k(r)("Filter results by category")},null,8,["options","modelValue","aria-label"])]),P("div",null,[P("label",V2e,K(k(r)("Filter results by username")),1),mt(eg,{id:"owner-filter",class:"inline-block min-w-36 w-60",options:d.value,modelValue:h.value,"onUpdate:modelValue":N[3]||(N[3]=V=>h.value=V),onChange:N[4]||(N[4]=V=>h.value=V),"aria-label":k(r)("Filter results by username")},null,8,["options","modelValue","aria-label"])])],512),N[13]||(N[13]=P("div",{class:"separator border-b-[1px] bg-white mx-2","aria-hidden":"true"},null,-1)),P("div",B2e,[P("table",{class:"w-full",role:"table","aria-label":k(r)("Liste des cartes")},[P("thead",null,[P("tr",null,[P("th",W2e,[P("button",{class:"text-left text-primary w-full text-nowrap","aria-label":k(r)("Trier par titre")+(m.value==="title"?y.value?" (croissant)":" (dcroissant)":""),onClick:N[5]||(N[5]=()=>{m.value="title",y.value=!y.value})},[Bt(K(k(r)("Titre"))+" ",1),P("span",U2e,[m.value==="title"&&!y.value?(U(),oe(Et,{key:0},[Bt("")],64)):Ge("",!0),m.value==="title"&&y.value?(U(),oe(Et,{key:1},[Bt("")],64)):Ge("",!0)])],8,z2e)]),P("th",X2e,[P("button",{class:"text-left text-primary text-nowrap w-full","aria-label":k(r)("Trier par catgorie")+(m.value==="category"?y.value?" (croissant)":" (dcroissant)":""),onClick:N[6]||(N[6]=()=>{m.value="category",y.value=!y.value})},[Bt(K(k(r)("Catgorie"))+" ",1),P("span",H2e,[m.value==="category"&&!y.value?(U(),oe(Et,{key:0},[Bt("")],64)):Ge("",!0),m.value==="category"&&y.value?(U(),oe(Et,{key:1},[Bt("")],64)):Ge("",!0)])],8,Y2e)]),P("th",K2e,[P("button",{class:"text-left text-primary text-nowrap w-full","aria-label":k(r)("Trier par crateur")+(m.value==="owner"?y.value?" (croissant)":" (dcroissant)":""),onClick:N[7]||(N[7]=()=>{m.value="owner",y.value=!y.value})},[Bt(K(k(r)("Crateur carte"))+" ",1),P("span",$2e,[m.value==="owner"&&!y.value?(U(),oe(Et,{key:0},[Bt("")],64)):Ge("",!0),m.value==="owner"&&y.value?(U(),oe(Et,{key:1},[Bt("")],64)):Ge("",!0)])],8,j2e)]),P("th",J2e,[P("button",{class:"text-left text-primary text-nowrap w-full","aria-label":k(r)("Trier par date de mise  jour")+(m.value==="last_feature_update"?y.value?" (croissant)":" (dcroissant)":""),onClick:N[8]||(N[8]=()=>{m.value="last_feature_update",y.value=!y.value})},[Bt(K(k(r)("Dernire Actualisation"))+" ",1),P("span",Q2e,[m.value==="last_feature_update"&&!y.value?(U(),oe(Et,{key:0},[Bt("")],64)):Ge("",!0),m.value==="last_feature_update"&&y.value?(U(),oe(Et,{key:1},[Bt("")],64)):Ge("",!0)])],8,q2e)]),P("th",eSe,[P("span",tSe,K(k(r)("Actions")),1)])])]),P("tbody",null,[(U(!0),oe(Et,null,yi(x.value,V=>(U(),oe("tr",{class:"border-t-[1px]",key:V.uuid},[P("td",{class:"py-2 cursor-pointer text-left w-44",onClick:()=>t("select",V.uuid),role:"button","aria-label":k(r)("Ouvrir la carte")+" "+V.title,tabindex:"0",onKeydown:[Js(()=>t("select",V.uuid),["enter"]),Js(fs(()=>t("select",V.uuid),["prevent"]),["space"])]},[P("span",{class:"line-clamp-2 overflow-hidden",title:V.title},[P("i",{class:Dn(["mr-2 fa",{"fa-lock":!V.public,"fa-unlock":V.public}]),"aria-label":V.public?k(r)("Carte publique"):k(r)("Carte prive")},null,10,rSe),Bt(" "+K(V.title),1)],8,iSe)],40,nSe),P("td",{class:"cursor-pointer text-left",onClick:()=>t("select",V.uuid)},K(V.category),9,sSe),P("td",{class:"cursor-pointer text-left",onClick:()=>t("select",V.uuid)},K(V.owner),9,oSe),P("td",{class:"cursor-pointer text-left",onClick:()=>t("select",V.uuid)},K(k(_M)(V.last_feature_update)),9,aSe),P("td",null,[V.deletedWhileOffline?Ge("",!0):(U(),oe("button",{key:0,onClick:W=>t("delete",V),"aria-label":k(r)("Supprimer la carte")+" "+V.title,class:"hover:text-red-500"},[...N[11]||(N[11]=[P("i",{class:"fa fa-trash","aria-hidden":"true"},null,-1)])],8,lSe))]),P("td",null,[k(o)&&V.dirty?(U(),oe("button",{key:0,onClick:W=>S(V),"aria-label":k(r)("Synchroniser la carte")+" "+V.title,class:"hover:text-blue-500"},[...N[12]||(N[12]=[P("i",{class:"fa fa-refresh","aria-hidden":"true"},null,-1)])],8,uSe)):Ge("",!0)])]))),128)),!x.value.length&&!n.isLoadingMyMaps?(U(),oe("tr",cSe,[P("td",hSe,K(k(r)("No result",{ns:"client"})),1)])):Ge("",!0),n.isLoadingMyMaps?(U(),oe("tr",dSe,[P("td",fSe,K(k(r)("Chargement des cartes en cours",{ns:"client"})),1)])):Ge("",!0)])],8,Z2e)],512)]),footer:Xt(()=>[P("div",pSe,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:N[9]||(N[9]=V=>t("cancel"))},K(k(r)("Annuler")),1)])]),_:1},8,["title"]))}}),mSe={class:"font-bold"},ySe={class:"flex flex-row justify-end gap-2"},bz=st({__name:"my-map-confirm",props:{map:{},mode:{}},emits:["cancel","confirm"],setup(n){const e=n,{t}=Ct(),i=e.mode==="clear"?t("Confirmation de suppression des lments de la carte"):t("Confirmation de suppression de la carte");return(r,o)=>(U(),Mt(Rf,{title:k(i),onClose:o[2]||(o[2]=s=>r.$emit("cancel")),role:"alertdialog"},{content:Xt(()=>[e.mode==="clear"?(U(),oe(Et,{key:0},[Bt(K(k(t)("Etes-vous certain de vouloir effacer tous les lments de la carte ?")),1)],64)):(U(),oe(Et,{key:1},[Bt(K(k(t)("Etes-vous certain de vouloir effacer la carte intitule :"))+" ",1),P("span",mSe,K(n.map.title),1)],64))]),footer:Xt(()=>[P("div",ySe,[P("button",{class:"lux-btn","data-dismiss":"modal",onClick:o[0]||(o[0]=s=>r.$emit("cancel"))},K(k(t)("Annuler")),1),P("button",{class:"lux-btn","data-dismiss":"modal",onClick:o[1]||(o[1]=s=>r.$emit("confirm",n.map.uuid,n.mode))},K(k(t)("Effacer")),1)])]),_:1},8,["title"]))}}),_Se=st({__name:"my-maps-open-map",props:{maps:{},isLoadingMyMaps:{type:Boolean}},emits:["cancel","select","delete"],setup(n,{emit:e}){const t=e,i=Ke(void 0);function r(s){i.value=s}function o(s){i.value=void 0,t("delete",s)}return(s,l)=>i.value?(U(),Mt(bz,{key:1,map:i.value,mode:"delete",onCancel:l[2]||(l[2]=u=>i.value=void 0),onConfirm:o},null,8,["map"])):(U(),Mt(gSe,{key:0,maps:n.maps,isLoadingMyMaps:n.isLoadingMyMaps,onCancel:l[0]||(l[0]=u=>t("cancel")),onSelect:l[1]||(l[1]=u=>t("select",u)),onDelete:r},null,8,["maps","isLoadingMyMaps"]))}}),vSe={key:0},bSe={class:"text-white"},xSe={class:"flex justify-center flex-col items-center"},ISe=["disabled","aria-busy","aria-label"],CSe=st({__name:"my-maps-panel",setup(n){const{t:e}=Ct(),{addNotification:t}=ns(),i=oi(),r=Ef(),{toggleShareOpen:o}=i,{myMap:s}=xt(i),l=Jr(),{drawnFeaturesMyMaps:u}=xt(l),h=Ke(void 0),d=Ei(void 0),m=Ke(!1),y=Ke(void 0),x=Ke(void 0),C=Ei([]),w=Ke(!1);async function S(){w.value=!0;try{if(C.value=await Mae(),!C.value.length){t(e("You have no existing Maps, please create a New Map"),mi.WARNING);return}}catch{t(e("Erreur lors du chargement des cartes."),mi.ERROR)}finally{w.value=!1}}async function T(){r.checkAuth()&&(m.value=!0,S())}function M(D,re){r.checkAuth()&&(d.value=D,h.value=re)}async function G(D){await r.loadMyMap(D),h.value!==bu.EDIT&&t(e("Nouvelle carte cre")),h.value=void 0}async function N(D){r.openMyMap(D),m.value=!1}async function V(D){m.value=!1,J(D,"delete")}async function W(D){C.value=[],await ce(D),await S()}function j(D){J(D,"clear")}function J(D,re){y.value=re,x.value=D}function te(D,re){re==="delete"?ce(D):re==="clear"&&pe(D)}async function ce(D){await Oae(D)?(y.value=void 0,D===s.value?.uuid&&r.closeMyMap(),t(e("MyMap successfully deleted."))):t(e("Unable to delete MyMap."),mi.ERROR)}async function pe(D){await r.clearMyMap(D)?(y.value=void 0,l.removeMyMapsFeature(D)):t(e("Unable to clear MyMap."),mi.ERROR)}function Y(){r.checkAuth()&&r.addInMyMap()}function he(){M(void 0,bu.CREATE_FROM_FEATURES)}return kt(h,D=>D===void 0&&(d.value=void 0)),kt(y,D=>D===void 0&&(x.value=void 0)),kt(s,(D,re)=>!D&&re&&l.removeMyMapsFeature(re.uuid)),(D,re)=>(U(),oe(Et,null,[mt(pg,{"data-cy-value":"myMapsPanel","close-fn":()=>k(i).toggleMyMapsOpen(!1)},{header:Xt(()=>[P("h1",null,K(k(e)("My Maps",{ns:"client"})),1)]),content:Xt(()=>[k(s)?(U(),oe("div",vSe,[mt(G2e,{myMap:k(s),onClose:k(r).closeMyMap,onDelete:V,onClear:j,onCopy:re[0]||(re[0]=le=>M(le,k(bu).COPY)),onEdit:re[1]||(re[1]=le=>M(le,k(bu).EDIT)),onNew:re[2]||(re[2]=()=>M(void 0,k(bu).CREATE)),onOpen:T,onShare:re[3]||(re[3]=()=>k(o)(!0)),onResetLayers:k(r).resetFromMyMap,onSaveLayers:k(r).applyToMyMap,"onDraw:mergelines":re[4]||(re[4]=()=>k(l).toggleDrawMergeLinesModal(!0)),"onDraw:cutlines":re[5]||(re[5]=()=>k(l).toggleDrawCutLineMode())},null,8,["myMap","onClose","onResetLayers","onSaveLayers"]),mt(yz,{features:k(u),idPrefix:"mymap"},null,8,["features"])])):(U(),oe(Et,{key:1},[P("div",bSe,K(k(e)("Create, save and share your own maps.",{ns:"client"})),1),P("div",xSe,[P("button",{class:"lux-btn mt-3",onClick:T,disabled:w.value,"aria-busy":w.value,"aria-label":w.value?k(e)("Chargement en cours..."):k(e)("Ouvrir une carte",{ns:"client"})},K(k(e)("Ouvrir une carte",{ns:"client"})),9,ISe),P("button",{class:"lux-btn mt-3",onClick:re[6]||(re[6]=le=>M(void 0,k(bu).CREATE))},K(k(e)("Crer une nouvelle carte",{ns:"client"})),1)])],64)),mt(e2e,{onMoveInMyMap:Y,onCreateNewMyMap:he})]),_:1},8,["close-fn"]),x.value&&y.value?(U(),Mt(bz,{key:0,mode:y.value,map:x.value,onCancel:re[7]||(re[7]=le=>y.value=void 0),onConfirm:te},null,8,["mode","map"])):Ge("",!0),h.value?(U(),Mt(u2e,{key:1,mode:h.value,map:d.value,onCancel:re[8]||(re[8]=le=>h.value=void 0),onConfirm:G},null,8,["mode","map"])):Ge("",!0),m.value?(U(),Mt(_Se,{key:2,maps:C.value,isLoadingMyMaps:w.value,onCancel:re[9]||(re[9]=le=>m.value=!1),onSelect:N,onDelete:W},null,8,["maps","isLoadingMyMaps"])):Ge("",!0)],64))}});var m0={},ro={},c3;function wSe(){return c3||(c3=1,Object.defineProperty(ro,"__esModule",{value:!0}),ro.BLANK_URL=ro.relativeFirstCharacters=ro.whitespaceEscapeCharsRegex=ro.urlSchemeRegex=ro.ctrlCharactersRegex=ro.htmlCtrlEntityRegex=ro.htmlEntitiesRegex=ro.invalidProtocolRegex=void 0,ro.invalidProtocolRegex=/^([^\w]*)(javascript|data|vbscript)/im,ro.htmlEntitiesRegex=/&#(\w+)(^\w|;)?/g,ro.htmlCtrlEntityRegex=/&(newline|tab);/gi,ro.ctrlCharactersRegex=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,ro.urlSchemeRegex=/^.+(:|&colon;)/gim,ro.whitespaceEscapeCharsRegex=/(\\|%5[cC])((%(6[eE]|72|74))|[nrt])/g,ro.relativeFirstCharacters=[".","/"],ro.BLANK_URL="about:blank"),ro}var h3;function ASe(){if(h3)return m0;h3=1,Object.defineProperty(m0,"__esModule",{value:!0}),m0.sanitizeUrl=void 0;var n=wSe();function e(s){return n.relativeFirstCharacters.indexOf(s[0])>-1}function t(s){var l=s.replace(n.ctrlCharactersRegex,"");return l.replace(n.htmlEntitiesRegex,function(u,h){return String.fromCharCode(h)})}function i(s){return URL.canParse(s)}function r(s){try{return decodeURIComponent(s)}catch{return s}}function o(s){if(!s)return n.BLANK_URL;var l,u=r(s.trim());do u=t(u).replace(n.htmlCtrlEntityRegex,"").replace(n.ctrlCharactersRegex,"").replace(n.whitespaceEscapeCharsRegex,"").trim(),u=r(u),l=u.match(n.ctrlCharactersRegex)||u.match(n.htmlEntitiesRegex)||u.match(n.htmlCtrlEntityRegex)||u.match(n.whitespaceEscapeCharsRegex);while(l&&l.length>0);var h=u;if(!h)return n.BLANK_URL;if(e(h))return h;var d=h.trimStart(),m=d.match(n.urlSchemeRegex);if(!m)return h;var y=m[0].toLowerCase().trim();if(n.invalidProtocolRegex.test(y))return n.BLANK_URL;var x=d.replace(/\\/g,"/");if(y==="mailto:"||y.includes("://"))return x;if(y==="http:"||y==="https:"){if(!i(x))return n.BLANK_URL;var C=new URL(x);return C.protocol=C.protocol.toLowerCase(),C.hostname=C.hostname.toLowerCase(),C.toString()}return x}return m0.sanitizeUrl=o,m0}var jm=ASe();function $y(n,e,t="f_"){return Object.entries(n).filter(([i])=>i!=="showProfile").map(([i,r])=>({key:t+i,value:r})).sort((i,r)=>e?0:i.key.localeCompare(r.key))}function bf(n){return n.attributes!==void 0&&Object.keys(n.attributes).length>0}function Si(n,e,t){return t==null&&(t=0),n in e.attributes&&(""+e.attributes[n]).length>t}function sg(n){return n==null||n.length===0}function ko(n){const e=String(n).toLowerCase();return e.startsWith("http://")||e.startsWith("https://")}function Fb(n,e,t){const{key:i}=n;let r=!1;return e==="2407"&&(i==="f_Cl_erosion"||i==="f_Erosion_kl"||i==="f_Erosion_Cl"||i==="f_Erosioun_K")?(t==="fr"&&i==="f_Cl_erosion"||t==="de"&&i==="f_Erosion_kl"||t==="en"&&i==="f_Erosion_Cl"||t==="lb"&&i==="f_Erosioun_K")&&(r=!0):e==="2714"&&(i==="f_LABEL_eng"||i==="f_LC_class_name_fr"||i==="f_LC_class_name_de"||i==="f_LC_class_name")?(t==="fr"&&i==="f_LC_class_name_fr"||t==="de"&&i==="f_LC_class_name_de"||t==="en"&&i==="f_LABEL_eng"||t==="lb"&&i==="f_LC_class_name")&&(r=!0):e==="2444"&&(i==="f_Betriebsform"||i==="f_Forme_d_entreprise"||i==="f_Operation_Form"||i==="f_Form_vun_Geschaeft")?(t==="fr"&&i==="f_Forme_d_entreprise"||t==="de"&&i==="f_Betriebsform"||t==="en"&&i==="f_Operation_Form"||t==="lb"&&i==="f_Form_vun_Geschaeft")&&(r=!0):i.endsWith("_FR")||i.endsWith("_DE")||i.endsWith("_EN")||i.endsWith("_LU")||i.endsWith("_LB")?(t==="fr"&&i.endsWith("_FR")||t==="de"&&i.endsWith("_DE")||t==="en"&&i.endsWith("_EN")||t==="lb"&&(i.endsWith("_LB")||i.endsWith("_LU")))&&(r=!0):r=!0,r}function xz(n){return"fid"in n&&SSe(n.fid)}function SSe(n){return n==null?!1:n.split(",").every(t=>!!t&&t.split("_").length>=2)}function Iz(n){return jm.sanitizeUrl(n)}function Cz(n,e,t,i){const{i18next:r}=Ct();switch(r.language){case"de":return jm.sanitizeUrl(e??n);case"en":return jm.sanitizeUrl(t??n);case"lb":return jm.sanitizeUrl(i??n);case"fr":default:return jm.sanitizeUrl(n)}}function ESe(n,e,t=","){return n.map(i=>i.attributes[e]).join(t)}function d3(n,e){if(typeof n===void 0)return"";const{t}=Ct();return n.map(i=>t(e+"_"+i)).join(", ")}function qx(n){const{themes:e}=xt(Vr());return e.value?.some(t=>t.name===n)}const TSe={class:"lux-poi-title","data-cy":"defaultTemplateTitle"},RSe={key:0},MSe=["href"],or=st({__name:"info-feature-layout",props:{layers:{},currentUrl:{},getDirectLink:{type:Function,default:(n,e)=>`${e}&fid=${n.fid}`}},emits:["export"],setup(n){const{t:e}=Ct();return(t,i)=>(U(),oe(Et,null,[P("h1",TSe,K(k(e)(n.layers.layerLabel)),1),Jn(t.$slots,"layer-content"),(U(!0),oe(Et,null,yi(n.layers.features,r=>(U(),oe("div",{key:r.id,class:"lux-feature-info","data-cy":"defaultTemplateAttributes"},[Jn(t.$slots,"feature-content",{feature:r},()=>[Bt(K(r.id),1)]),k(xz)(r)?(U(),oe("div",RSe,[P("a",{"data-cy":"defaultTemplateLink",class:"print:hidden",href:n.getDirectLink(r,n.currentUrl),target:"_blank"},K(k(e)("Lien direct vers cet objet")),9,MSe)])):Ge("",!0)]))),128))],64))}}),kSe=st({__name:"adresse-template",props:{layers:{},currentUrl:{}},setup(n){return(e,t)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:i})=>[P("h4",null,K(i.attributes.num_affaire),1),Bt(" "+K(i.attributes.numero)+", "+K(i.attributes.rue),1),t[0]||(t[0]=P("br",null,null,-1)),Bt(" L-"+K(i.attributes.code_postal)+" "+K(i.attributes.localite),1),t[1]||(t[1]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),LSe=["href"],PSe=["src"],GSe={class:"no-print"},FSe=st({__name:"aero-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("h3",null,K(r.attributes.name),1),P("a",{href:r.attributes.path,target:"_blank"},[r.attributes.thumbnail_path?(U(),oe("img",{key:0,src:r.attributes.thumbnail_path,alt:"thumbnail",width:"250"},null,8,PSe)):Ge("",!0)],8,LSe),P("span",GSe,K(k(e)("Cliquez dans l'image pour agrandir")),1),i[0]||(i[0]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),OSe=st({__name:"affaires-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("h4",null,K(r.attributes.num_affaire),1),P("span",null,K(k(e)("Numero")),1),Bt(" : "+K(r.attributes.num_affaire),1),i[0]||(i[0]=P("br",null,null,-1)),P("span",null,K(k(e)("Numero cadastral")),1),Bt(" : "+K(r.attributes.label),1),i[1]||(i[1]=P("br",null,null,-1)),P("span",null,K(k(e)("Geometre")),1),Bt(" : "+K(r.attributes.geometre),1),i[2]||(i[2]=P("br",null,null,-1)),P("span",null,K(k(e)("Region")),1),Bt(" : "+K(r.attributes.region),1),i[3]||(i[3]=P("br",null,null,-1)),P("span",null,K(k(e)("Type")),1),Bt(" : "+K(k(e)(r.attributes.type)),1),i[4]||(i[4]=P("br",null,null,-1)),P("span",null,K(k(e)("Statut")),1),Bt(" : "+K(k(e)(r.attributes.statut)),1),i[5]||(i[5]=P("br",null,null,-1)),P("span",null,K(k(e)("Date")),1),Bt(" : "+K(r.attributes.date),1),i[6]||(i[6]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),NSe={key:0},DSe={key:1},VSe=st({__name:"asta-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>{const r=Tl("format-measure");return U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:o})=>[P("span",null,K(k(e)("Numero EFA")),1),Bt(" : "+K(o.attributes.code_elem)+K(o.attributes.efa),1),i[3]||(i[3]=P("br",null,null,-1)),o.attributes.surface?(U(),oe("div",NSe,[P("span",null,K(k(e)("Surface")),1),Bt(" : "+K(Number(o.attributes.surface).toFixed(1))+" a",1),i[0]||(i[0]=P("br",null,null,-1))])):Ge("",!0),o.attributes.longueur?(U(),oe("div",DSe,[P("span",null,K(k(e)("Longueur")),1),i[1]||(i[1]=Bt(" : ",-1)),Sn(P("span",null,null,512),[[r,o.attributes.longueur,"1",{length:!0}]]),i[2]||(i[2]=P("br",null,null,-1))])):Ge("",!0)]),_:1},8,["layers","currentUrl"])}}}),ud=st({__name:"profile-feature-info",props:{feature:{}},emits:["export"],setup(n){const e=n,{t}=Ct(),i=Kn().getOlMap(),r=At(()=>new El(new Jl().readFeature(e.feature,{dataProjection:tu,featureProjection:i.getView().getProjection()})));return(o,s)=>(U(),oe(Et,null,[mt(Ek,{feature:r.value},null,8,["feature"]),P("div",null,[P("button",{class:"lux-feature-info-export",onClick:s[0]||(s[0]=l=>o.$emit("export",{feature:n.feature,format:"kml"}))},K(k(t)("Exporter KMl")),1),P("button",{class:"lux-feature-info-export",onClick:s[1]||(s[1]=l=>o.$emit("export",{feature:n.feature,format:"gpx"}))},K(k(t)("Exporter GPX")),1)])],64))}}),BSe={key:0},ZSe={key:0},WSe={key:0},zSe={key:1},USe=["href"],XSe={key:1},YSe={key:0},HSe={key:1},KSe={key:2},jSe={key:3},$Se={key:4},JSe={key:5},qSe={key:0},QSe={key:2},eEe=st({__name:"automatic-sols-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=Ct();return(t,i)=>{const r=Tl("dompurify-html");return U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:o})=>[o.attributes.label?(U(),oe("h4",BSe,K(k(e)(o.attributes.label)),1)):Ge("",!0),k(bf)(o)?(U(),oe(Et,{key:1},[(U(!0),oe(Et,null,yi(k($y)(o.attributes,n.layers.ordered),s=>(U(),oe("div",{key:s.key},[!k(sg)(s.value)&&!s.key.startsWith("f_LC_class_name")&&!s.key.startsWith("f_LABEL_")?(U(),oe("span",ZSe,[k(ko)(s.value)?Ge("",!0):(U(),oe("label",WSe,K(k(e)(s.key))+" : ",1)),k(ko)(s.value)?Ge("",!0):Sn((U(),oe("span",zSe,null,512)),[[r,s.value]]),k(ko)(s.value)?(U(),oe("a",{key:2,href:s.value,target:"_blank"},K(k(e)(s.key)),9,USe)):Ge("",!0)])):Ge("",!0),!k(sg)(s.value)&&(s.key.startsWith("f_LC_class_name")||s.key.startsWith("f_LABEL_"))?(U(),oe("span",XSe,[k(Wn).language=="fr"&&(s.key=="f_LC_class_name_fr"||s.key=="f_LABEL_fr")?(U(),oe("label",YSe,K(k(e)(s.key))+" : ",1)):Ge("",!0),k(Wn).language=="fr"&&(s.key=="f_LC_class_name_fr"||s.key=="f_LABEL_fr")?Sn((U(),oe("span",HSe,null,512)),[[r,s.value]]):Ge("",!0),(k(Wn).language=="de"||k(Wn).language=="lb")&&(s.key=="f_LC_class_name_de"||s.key=="f_LABEL_de")?(U(),oe("label",KSe,K(k(e)(s.key))+" : ",1)):Ge("",!0),(k(Wn).language=="de"||k(Wn).language=="lb")&&(s.key=="f_LC_class_name_de"||s.key=="f_LABEL_de")?Sn((U(),oe("span",jSe,null,512)),[[r,s.value]]):Ge("",!0),k(Wn).language=="en"&&(s.key=="f_LC_class_name"||s.key=="f_LABEL_eng")?(U(),oe("label",$Se,K(k(e)(s.key))+" : ",1)):Ge("",!0),k(Wn).language=="en"&&(s.key=="f_LC_class_name"||s.key=="f_LABEL_eng")?Sn((U(),oe("span",JSe,null,512)),[[r,s.value]]):Ge("",!0)])):Ge("",!0)]))),128)),n.layers.has_profile?(U(),oe("div",qSe,[mt(ud,{feature:o,onExport:i[0]||(i[0]=s=>t.$emit("export",s))},null,8,["feature"])])):Ge("",!0)],64)):(U(),oe("div",QSe,[P("span",null,K(k(e)("Aucune information disponible pour cette couche")),1)]))]),_:1},8,["layers","currentUrl"])}}}),tEe=st({__name:"batiments-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("span",null,K(k(e)("Type")),1),i[0]||(i[0]=Bt(" : ",-1)),P("span",null,K(k(e)("bat_"+r.attributes.type)),1),i[1]||(i[1]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),nEe=["src"],iEe=st({__name:"bus-wo-title-template",props:{layers:{},currentUrl:{}},setup(n){const e="https://migration.geoportail.lu/getbuswidget";return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("h3",null,K(r.attributes.name),1),P("iframe",{class:"-ml-3.5",title:"bus widget",height:"300",width:"500",frameborder:"0",src:`${k(e)}${k(Cz)(`?lang=fr&id=${r.attributes.extid}`,`?lang=de&id=${r.attributes.extid}`,`?lang=en&id=${r.attributes.extid}`,`?lang=fr&id=${r.attributes.extid}`)}`},null,8,nEe)]),_:1},8,["layers","currentUrl"]))}}),rEe=["src"],sEe=st({__name:"bus-template",props:{layers:{},currentUrl:{}},setup(n){const e="https://migration.geoportail.lu/getbuswidget";return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("h3",null,K(r.attributes.name),1),P("iframe",{class:"-ml-3.5",title:"bus widget",height:"300",width:"500",frameborder:"0",src:`${k(e)}${k(Cz)(`?lang=fr&id=${r.attributes.extid}`,`?lang=de&id=${r.attributes.extid}`,`?lang=en&id=${r.attributes.extid}`,`?lang=fr&id=${r.attributes.extid}`)}`},null,8,rEe)]),_:1},8,["layers","currentUrl"]))}}),oEe={class:"lux-poi-title"},aEe={class:"lux-feature-info"},lEe={class:"poi-feature"},uEe={class:"casipo-form-container"},cEe={class:"casipo-mail"},hEe={class:"casipo-checkbox"},dEe=["innerHTML"],fEe=st({__name:"casipo-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{authenticated:e,currentUser:t}=xt(Du()),r=n.layers,{addNotification:o}=ns(),s=Ke(""),l=At(()=>e.value&&t.value?.mail||"");s.value=l.value;const u=Ke(!1),{t:h}=Ct(),d="https://migration.geoportail.lu/casipo";function m(x,C,w){return x.map(function(S){return S.attributes[C]}).join(w)}async function y(){if(!s.value&&!/^\S+@\S+\.\S+$/.test(s.value)){o(h("Veuillez saisir une adresse email valide"),mi.WARNING);return}if(!u.value){o(h("Veuillez accepter les termes du rapport"),mi.WARNING);return}const x=new URLSearchParams({email:s.value,staging:"false"});fetch(d+"/report/"+m(r.features,"textstring",",")+".pdf",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:x}),o(h("Votre rapport est en train d'tre gnr. Un email vous sera envoy  l'adresse {{email}} ds qu'il sera disponible",{email:s.value,ns:"client"}),mi.INFO)}return(x,C)=>(U(),oe(Et,null,[P("h1",oEe,K(k(h)(k(r).layerLabel)),1),P("div",aEe,[P("div",lEe,[P("label",null,K(k(h)("Ici vous pouvez commander le rapport relatif aux site potentiellement contamins")),1),C[3]||(C[3]=P("br",null,null,-1)),C[4]||(C[4]=P("br",null,null,-1)),P("div",uEe,[P("div",cEe,[P("label",null,K(k(h)("Adresse Email")),1),Sn(P("input",{type:"text","onUpdate:modelValue":C[0]||(C[0]=w=>s.value=w),style:{width:"165px"}},null,512),[[Zr,s.value]])]),P("div",hEe,[Sn(P("input",{type:"checkbox","onUpdate:modelValue":C[1]||(C[1]=w=>u.value=w),id:"terms"},null,512),[[Yh,u.value]]),P("label",{for:"terms",innerHTML:k(h)("En cochant cette case, l'utilisateur dclare avoir lu, compris et accept les <a target='_blank' rel='noopener noreferrer' href='https://files.geoportail.lu/Conditions_utilisation_CASIPO.pdf'>conditions gnrales d'utilisation </a>de ce site web")},null,8,dEe)])]),P("button",{class:"lux-btn-grey",onClick:C[2]||(C[2]=w=>y()),target:"_blank"},K(k(h)("Commander rapport")),1)])])],64))}}),pEe=is(fEe,[["__scopeId","data-v-c10938bd"]]),gEe={class:"flex flex-col"},mEe={class:"lux-poi-title","data-cy":"defaultTemplateTitle"},yEe={key:0},_Ee={key:1,"data-cy":"defaultTemplateAttributes"},vEe={key:0},bEe={key:0},xEe={key:1},IEe=["href"],CEe=["href"],wEe={class:"lux-solarkataster-button"},AEe={key:4},SEe={controls:"",autoplay:"",style:{width:"260px",height:"50px"}},EEe=["src"],TEe=["src"],REe={key:2},MEe={key:3,class:"no-print"},kEe={key:4,class:"no-print"},LEe=["href"],f3=st({__name:"default-template",props:{layers:{type:Object,required:!0},currentUrl:{type:String,required:!1}},emits:["export"],setup(n){const{t:e}=Ct();function t(s,l){return!(s.startsWith("myenergy_solarkataster_luxemburg")||s.startsWith("eau_new_Wasserstand"))&&ko(l.value)}function i(s,l){return s.startsWith("myenergy_solarkataster_luxemburg")&&ko(l.value)&&l.key==="f_href"}function r(s,l){return s.startsWith("eau_new_Wasserstand")&&ko(l.value)&&l.key==="f_Graph"}function o(s){return ko(s.value)&&s.key==="f_AudioURL"}return(s,l)=>{const u=Tl("dompurify-html");return U(),oe("div",gEe,[P("div",null,[P("h2",mEe,K(k(e)(n.layers.layerLabel)),1),(U(!0),oe(Et,null,yi(n.layers.features,h=>(U(),oe("div",{key:h.id,class:"lux-feature-info"},[h.attributes.label?(U(),oe("h4",yEe,K(k(e)(h.attributes.label)),1)):Ge("",!0),k(bf)(h)?(U(),oe("div",_Ee,[(U(!0),oe(Et,null,yi(k($y)(h.attributes,n.layers.ordered),d=>(U(),oe("div",{key:d.key},[!k(sg)(d.value)&&k(Fb)(d,n.layers.layer,k(Wn).language)?(U(),oe("div",vEe,[k(ko)(d.value)?Ge("",!0):(U(),oe("label",bEe,K(k(e)(d.key))+" : ",1)),k(ko)(d.value)?Ge("",!0):Sn((U(),oe("span",xEe,null,512)),[[u,d.value]]),t(n.layers.layerLabel,d)?(U(),oe("a",{key:2,href:d.value,target:"_blank"},K(k(e)(d.key)),9,IEe)):Ge("",!0),i(n.layers.layerLabel,d)?(U(),oe("a",{key:3,"data-cy":"defaultTemplateSolarLink",href:d.value,target:"_blank"},[P("button",wEe,[P("span",null,K(k(e)("Lien direct vers le calculateur d'efficacit conomique")),1)])],8,CEe)):Ge("",!0),o(d)?(U(),oe("span",AEe,[P("audio",SEe,[P("source",{src:d.value,type:"audio/wav"},null,8,EEe)])])):Ge("",!0),r(n.layers.layerLabel,d)?(U(),oe("iframe",{key:5,width:"260px",height:"560px",src:k(Iz)(d.value),title:"water level graph"},null,8,TEe)):Ge("",!0)])):Ge("",!0)]))),128))])):Ge("",!0),n.layers.has_profile?(U(),oe("div",REe,[mt(ud,{feature:h,onExport:l[0]||(l[0]=d=>s.$emit("export",d))},null,8,["feature"])])):Ge("",!0),k(bf)(h)?Ge("",!0):(U(),oe("div",MEe,[P("span",null,K(k(e)("Aucune information disponible pour cette couche")),1)])),k(xz)(h)?(U(),oe("div",kEe,[P("span",null,[P("a",{"data-cy":"defaultTemplateLink",href:n.currentUrl+"&fid="+h.fid,target:"_blank"},K(k(e)("Lien direct vers cet objet")),9,LEe)])])):Ge("",!0)]))),128))])])}}}),PEe={key:0},GEe={key:0},FEe={key:0,class:"flex"},OEe={class:"w-1/3"},NEe={class:"w-2/3"},DEe={key:1,class:"flex"},VEe=["href"],BEe={key:0},ZEe={key:2},WEe=st({__name:"default-table-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=Ct();return(t,i)=>{const r=Tl("dompurify-html");return U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:o})=>[o.attributes.label?(U(),oe("h4",PEe,K(k(e)(o.attributes.label)),1)):Ge("",!0),k(bf)(o)?(U(),oe(Et,{key:1},[(U(!0),oe(Et,null,yi(k($y)(o.attributes,n.layers.ordered),s=>(U(),oe("div",{key:s.key},[!k(sg)(s.value)&&k(Fb)(s,n.layers.layer,k(Wn).language)?(U(),oe("span",GEe,[k(ko)(s.value)?Ge("",!0):(U(),oe("div",FEe,[P("label",OEe,K(k(e)(s.key)),1),Sn(P("span",NEe,null,512),[[r,s.value]])])),k(ko)(s.value)?(U(),oe("div",DEe,[i[1]||(i[1]=P("label",{class:"w-1/3"},null,-1)),P("a",{class:"w-2/3",href:s.value,target:"_blank"},K(k(e)(s.key)),9,VEe)])):Ge("",!0)])):Ge("",!0)]))),128)),n.layers.has_profile?(U(),oe("div",BEe,[mt(ud,{feature:o,onExport:i[0]||(i[0]=s=>t.$emit("export",s))},null,8,["feature"])])):Ge("",!0)],64)):(U(),oe("div",ZEe,[P("span",null,K(k(e)("Aucune information disponible pour cette couche")),1)]))]),_:1},8,["layers","currentUrl"])}}}),zEe={key:0},UEe={key:0},XEe={key:0,class:"flex"},YEe={class:"w-1/3"},HEe={class:"w-2/3"},KEe={key:1,class:"flex"},jEe=["href"],$Ee={key:0},JEe={key:2},qEe=st({__name:"default-table-no-prefix-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=Ct();return(t,i)=>{const r=Tl("dompurify-html");return U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:o})=>[o.attributes.label?(U(),oe("h4",zEe,K(k(e)(o.attributes.label)),1)):Ge("",!0),k(bf)(o)?(U(),oe(Et,{key:1},[(U(!0),oe(Et,null,yi(k($y)(o.attributes,n.layers.ordered,""),s=>(U(),oe("div",{key:s.key},[!k(sg)(s.value)&&k(Fb)(s,n.layers.layer,k(Wn).language)?(U(),oe("span",UEe,[k(ko)(s.value)?Ge("",!0):(U(),oe("div",XEe,[P("label",YEe,K(k(e)(s.key)),1),Sn(P("span",HEe,null,512),[[r,s.value]])])),k(ko)(s.value)?(U(),oe("div",KEe,[i[1]||(i[1]=P("label",{class:"w-1/3"},null,-1)),P("a",{class:"w-2/3",href:s.value,target:"_blank"},K(k(e)(s.key)),9,jEe)])):Ge("",!0)])):Ge("",!0)]))),128)),n.layers.has_profile?(U(),oe("div",$Ee,[mt(ud,{feature:o,onExport:i[0]||(i[0]=s=>t.$emit("export",s))},null,8,["feature"])])):Ge("",!0)],64)):(U(),oe("div",JEe,[P("span",null,K(k(e)("Aucune information disponible pour cette couche")),1)]))]),_:1},8,["layers","currentUrl"])}}}),QEe=st({__name:"flik-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("span",null,K(k(e)("Numero FLIK"))+" : ",1),Bt(" "+K(r.attributes.element)+K(r.attributes.flik),1),i[0]||(i[0]=P("br",null,null,-1)),P("span",null,K(k(e)("Surface"))+" : ",1),Bt(" "+K(r.attributes.surface)+" a",1),i[1]||(i[1]=P("br",null,null,-1)),P("span",null,K(k(e)("Perimetre"))+" : ",1),Bt(" "+K(r.attributes.perimetre)+" m",1),i[2]||(i[2]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),eTe={class:"lux-poi-title"},tTe={class:"lux-feature-info"},nTe={class:"poi-feature"},iTe={class:"forage-virtuel-form-container"},rTe={class:"forage-virtuel-mail"},sTe=st({__name:"forage-virtuel-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{authenticated:e,currentUser:t}=xt(Du()),r=n.layers,{addNotification:o}=ns(),s=Ke(""),l=At(()=>e.value&&t.value?.mail||"");s.value=l.value;const{t:u}=Ct(),h=void 0;async function d(){if(!s.value&&!/^\S+@\S+\.\S+$/.test(s.value)){o(u("Veuillez saisir une adresse email valide"),mi.WARNING);return}const m=new URLSearchParams({x:String(r.features[0].geometry.coordinates[0]),y:String(r.features[0].geometry.coordinates[1]),email:s.value,staging:"false"});fetch(h,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:m}),o(u("Votre rapport est en train d'tre gnr. Un email vous sera envoy  l'adresse {{email}} ds qu'il sera disponible",{email:s.value,ns:"client"}),mi.INFO)}return(m,y)=>(U(),oe(Et,null,[P("h1",eTe,K(k(u)(k(r).layerLabel)),1),P("div",tTe,[P("div",nTe,[P("label",null,K(k(u)("Ici vous pouvez commander le rapport relatif au forage virtuel")),1),y[2]||(y[2]=P("br",null,null,-1)),y[3]||(y[3]=P("br",null,null,-1)),P("div",iTe,[P("div",rTe,[P("label",null,K(k(u)("Adresse Email")),1),Sn(P("input",{type:"text","onUpdate:modelValue":y[0]||(y[0]=x=>s.value=x),style:{width:"165px"}},null,512),[[Zr,s.value]])])]),P("button",{class:"lux-btn-grey",onClick:y[1]||(y[1]=x=>d()),target:"_blank"},K(k(u)("Commander rapport")),1)])])],64))}}),oTe=is(sTe,[["__scopeId","data-v-6d0be8d4"]]),aTe={class:"lux-poi-title"},lTe={key:0},uTe={href:"https://www.mobiliteit.lu/fr/horaires-et-lignes/tram/",target:"_blank"},cTe={key:1},hTe={href:"https://www.mobiliteit.lu/fr/horaires-et-lignes/trains/",target:"_blank"},dTe={key:2},fTe=["href"],pTe=["href"],gTe=st({__name:"lignes-bus-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=Ct();return(t,i)=>(U(),oe(Et,null,[P("h1",aTe,K(k(e)(n.layers.layerLabel)),1),P("table",null,[P("thead",null,[P("tr",null,[P("th",null,K(k(e)("Num ligne")),1),P("th",null,K(k(e)("Description")),1)])]),P("tbody",null,[(U(!0),oe(Et,null,yi(n.layers.features,r=>(U(),oe("tr",{key:r.id,class:"lux-feature-info"},[r.attributes.category_id===404?(U(),oe("td",lTe,[P("a",uTe,K(r.attributes.label),1)])):Ge("",!0),r.attributes.category_id===403?(U(),oe("td",cTe,[P("a",hTe,K(r.attributes.label),1)])):Ge("",!0),(r.attributes.category_id??0)<403?(U(),oe("td",dTe,[P("a",{href:`https://www.mobiliteit.lu/fr/ligne/bus-${r.attributes.label}-${r.attributes.category_id===400?"avl":r.attributes.category_id===401?"rgtr":"tice"}`,target:"_blank"},K(r.attributes.label),9,fTe)])):Ge("",!0),P("td",null,[P("a",{href:`?map_id=${r.attributes.map_id}`,target:"_blank"},K(r.attributes.map_description),9,pTe)])]))),128))])])],64))}}),mTe=["src"],yTe=st({__name:"meteo-template",props:{layers:{},currentUrl:{}},setup(n){return(e,t)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:i})=>[P("h3",null,K(i.attributes.stationsname)+" "+K(i.attributes.sid),1),P("iframe",{title:"meteo widget",class:"-ml-3.5",height:"150",width:"300",frameborder:"0",src:`https://dlr-web-daten1.aspdienste.de/cgi-bin/sinfoam.pl?c=92&nid=01&lid=${i.attributes.sid}`},null,8,mTe)]),_:1},8,["layers","currentUrl"]))}}),_Te=st({__name:"meteolux-europe-template",props:{layers:{},currentUrl:{}},setup(n){return(e,t)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:i})=>[P("h3",null,K(i.attributes.station)+" ("+K(i.attributes.icao)+")",1),P("label",null,K(i.attributes.weather),1),t[0]||(t[0]=Bt("",-1)),P("span",null,K(i.attributes.temperature)+"C",1)]),_:1},8,["layers","currentUrl"]))}}),vTe=st({__name:"meteolux-gr-template",props:{layers:{},currentUrl:{}},setup(n){return(e,t)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:i})=>[P("h3",null,K(i.attributes.station)+" ("+K(i.attributes.icao)+")",1),t[0]||(t[0]=P("label",null,"TAF:",-1)),t[1]||(t[1]=Bt()),P("span",null,K(i.attributes.taf),1),t[2]||(t[2]=P("br",null,null,-1)),t[3]||(t[3]=P("label",null,"Metar:",-1)),t[4]||(t[4]=Bt()),P("span",null,K(i.attributes.metar),1)]),_:1},8,["layers","currentUrl"]))}}),bTe=["href"],xTe=["src"],ITe={key:1},CTe={key:2},wTe={key:3},ATe={key:4},STe=["src"],ETe=["href"],TTe=st({__name:"mymaps-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("h4",null,K(r.attributes.sentier),1),r.attributes.image&&r.attributes.image.trim()!==""?(U(),oe("a",{key:0,href:k(EO)(r.attributes.image),target:"_blank"},[r.attributes.thumbnail&&r.attributes.thumbnail.trim()!==""?(U(),oe("img",{key:0,src:k(EO)(r.attributes.thumbnail)},null,8,xTe)):Ge("",!0)],8,bTe)):Ge("",!0),i[5]||(i[5]=P("br",null,null,-1)),r.attributes.sentier?(U(),oe("span",ITe,[P("span",null,K(k(e)("sentier")),1),Bt(" : "+K(r.attributes.sentier),1),i[1]||(i[1]=P("br",null,null,-1))])):Ge("",!0),r.attributes.name?(U(),oe("span",CTe,[P("span",null,K(k(e)("Name")),1),Bt(" : "+K(r.attributes.name),1),i[2]||(i[2]=P("br",null,null,-1))])):Ge("",!0),r.attributes.description?(U(),oe("span",wTe,[P("span",null,K(k(e)("Description")),1),Bt(" : "+K(r.attributes.description),1),i[3]||(i[3]=P("br",null,null,-1))])):Ge("",!0),r.attributes.length?(U(),oe("span",ATe,[P("span",null,K(k(e)("Longeueur")),1),Bt(" : "+K(r.attributes.length)+" Km",1),i[4]||(i[4]=P("br",null,null,-1))])):Ge("",!0),mt(ud,{feature:r,onExport:i[0]||(i[0]=o=>t.$emit("export",o))},null,8,["feature"]),P("img",{src:k(Gye)(r.attributes.map_id)},null,8,STe),i[6]||(i[6]=P("br",null,null,-1)),P("a",{class:"fid-link no-print",href:`?map_id=${r.attributes.map_id}`,target:"_blank"},K(k(e)("Lien vers la carte")),9,ETe),i[7]||(i[7]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),RTe=["onClick"],MTe=st({__name:"mo-template",props:{layers:{},currentUrl:{}},setup(n){const{addNotification:e}=ns(),t="https://shop.geoportail.lu",i=void 0,{t:r}=Ct(),o=function(l){for(var u=l+"=",h=document.cookie.split(";"),d=0;d<h.length;d++){for(var m=h[d];m.charAt(0)==" ";)m=m.substring(1);if(m.indexOf(u)==0){var y=m.substring(u.length,m.length);return y.indexOf('"')===0&&(y=y.substring(1,y.length-1)),y}}return""},s=async function(l,u){const m=`${location.search.includes("ipv6=true")?i:t}/Portail/commande/webservices/orderAffaireV3.jsp?numCommune=${encodeURIComponent(l)}&numMesurage=${encodeURIComponent(u)}&ticket=${encodeURIComponent(o("appAuthtktCookieName"))}`;try{const y=await fetch(m,{method:"GET",headers:{"Content-Type":"application/json"}});y.ok?(await y.json(),e(r("Fichier GML command."),mi.INFO)):e(r("Erreur lors de la commande du fichier."),mi.ERROR)}catch{e(r("Erreur lors de la commande du fichier."),mi.ERROR)}};return(l,u)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:h})=>[P("h3",null,K(h.attributes.K_MEASUREMENTID),1),P("span",null,K(k(r)("Affaire")),1),Bt(" : "+K(h.attributes.K_MEASUREMENTID),1),u[0]||(u[0]=P("br",null,null,-1)),P("span",null,K(k(r)("Commune administrative")),1),Bt(" : "+K(h.attributes.K_NOM_COMMUNE_ADMINISTRATIVE),1),u[1]||(u[1]=P("br",null,null,-1)),P("span",null,K(k(r)("Commune cadastrale")),1),Bt(" : "+K(h.attributes.K_NOM_COMMUNE_CADASTRALE),1),u[2]||(u[2]=P("br",null,null,-1)),P("span",null,K(k(r)("Mesurage")),1),Bt(" : "+K(h.attributes.K_MEASUREMENTNUMBER),1),u[3]||(u[3]=P("br",null,null,-1)),P("button",{class:"lux-btn-grey",onClick:d=>s(h.attributes.K_KATASTERGEMEINDE,h.attributes.K_MEASUREMENTNUMBER)},K(k(r)("Commander fichier GML")),9,RTe)]),_:1},8,["layers","currentUrl"]))}}),kTe={key:0},LTe=["href"],PTe={key:1},GTe=st({__name:"ng95-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct(),t="https://migration.geoportail.lu/downloadsketch";return(i,r)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:o})=>[P("h4",null,K(k(e)(o.attributes.nom)),1),P("span",null,K(k(e)("Elevation")),1),Bt(" : "+K(o.attributes.nouv_cote),1),r[0]||(r[0]=P("br",null,null,-1)),P("span",null,K(k(e)("Type")),1),Bt(" : "+K(o.attributes.type_rivet),1),r[1]||(r[1]=P("br",null,null,-1)),P("span",null,K(k(e)("Croquis")),1),r[2]||(r[2]=Bt(" : ",-1)),o.attributes.has_sketch?(U(),oe("span",kTe,[P("a",{class:"no-print",target:"_blank",download:"",href:`${k(t)}?name=${o.attributes.nom_croq}`},K(k(e)("Obtenir le fichier sous format pdf")),9,LTe)])):Ge("",!0),o.attributes.has_sketch?Ge("",!0):(U(),oe("span",PTe,K(k(e)("Croquis indisponible")),1))]),_:1},8,["layers","currentUrl"]))}}),FTe={key:0},OTe=["href"],NTe={key:1},DTe=st({__name:"ng95-new-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct(),t="https://migration.geoportail.lu/downloadsketch";return(i,r)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:o})=>[P("h4",null,K(k(e)(o.attributes.Nom)),1),P("span",null,K(k(e)("Elevation")),1),Bt(" : "+K(o.attributes["nouv. cote"]),1),r[0]||(r[0]=P("br",null,null,-1)),P("span",null,K(k(e)("Type")),1),Bt(" : "+K(o.attributes["type rivet"]),1),r[1]||(r[1]=P("br",null,null,-1)),P("span",null,K(k(e)("Croquis")),1),r[2]||(r[2]=Bt(" : ",-1)),o.attributes.has_sketch?(U(),oe("span",FTe,[P("a",{class:"no-print",target:"_blank",download:"",href:`${k(t)}?id=${o.attributes.OBJECTID}&type=new`},K(k(e)("Obtenir le fichier sous format pdf")),9,OTe)])):Ge("",!0),o.attributes.has_sketch?Ge("",!0):(U(),oe("span",NTe,K(k(e)("Croquis indisponible")),1))]),_:1},8,["layers","currentUrl"]))}}),VTe={key:0},BTe={key:1},ZTe={key:2},WTe={key:3},zTe={key:4},UTe={key:5},XTe={key:6},YTe={key:7},HTe={key:8},KTe={key:9},jTe={key:10},$Te={key:11},JTe={key:12},qTe={key:13},QTe={key:14},eRe={key:15},tRe={key:16},nRe={key:17},iRe={key:18},rRe=["href"],sRe={key:19},oRe=["href"],aRe={key:20},lRe=["href"],uRe={key:21},cRe=["href"],hRe={key:22},dRe=["src"],fRe={key:23},pRe=st({__name:"npour-poi-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=Ct(),{i18next:t}=Ct();return(i,r)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:o})=>[k(t).language=="de"&&k(Si)("title_de",o,0)?(U(),oe("h3",VTe,K(o.attributes.title_de),1)):Ge("",!0),k(t).language=="en"&&k(Si)("title_en",o,0)?(U(),oe("h3",BTe,K(o.attributes.title_en),1)):Ge("",!0),k(t).language=="lb"&&k(Si)("title_nl",o,0)?(U(),oe("h3",ZTe,K(o.attributes.title_nl),1)):Ge("",!0),k(t).language=="fr"&&k(Si)("title_fr",o,0)?(U(),oe("h3",WTe,K(o.attributes.title_fr),1)):Ge("",!0),k(t).language=="de"&&k(Si)("nom_de",o,0)?(U(),oe("h3",zTe,K(o.attributes.nom_de),1)):Ge("",!0),k(t).language=="fr"&&k(Si)("nom_fr",o,0)?(U(),oe("h3",UTe,K(o.attributes.nom_fr),1)):Ge("",!0),k(t).language=="en"&&k(Si)("nom_en",o,0)?(U(),oe("h3",XTe,K(o.attributes.nom_en),1)):Ge("",!0),k(t).language=="lb"&&k(Si)("nom_lu",o,0)?(U(),oe("h3",YTe,K(o.attributes.nom_lu),1)):Ge("",!0),k(t).language=="de"&&k(Si)("descr_de",o,0)?(U(),oe("span",HTe,K(o.attributes.descr_de),1)):Ge("",!0),k(t).language=="fr"&&k(Si)("descr_fr",o,0)?(U(),oe("span",KTe,K(o.attributes.descr_fr),1)):Ge("",!0),k(t).language=="en"&&k(Si)("descr_en",o,0)?(U(),oe("span",jTe,K(o.attributes.descr_en),1)):Ge("",!0),k(t).language=="lb"&&k(Si)("descr_nl",o,0)?(U(),oe("span",$Te,K(o.attributes.descr_nl),1)):Ge("",!0),k(Si)("number",o,0)?(U(),oe("span",JTe,K(o.attributes.number)+",",1)):Ge("",!0),k(Si)("street",o,0)?(U(),oe("span",qTe,K(o.attributes.street),1)):Ge("",!0),k(Si)("town",o,0)?(U(),oe("span",QTe,K(o.attributes.zip)+" "+K(o.attributes.town),1)):Ge("",!0),k(Si)("phone",o,1)?(U(),oe("span",eRe,[r[1]||(r[1]=P("i",{class:"fa fa-phone","aria-hidden":"true"},null,-1)),P("span",null,K(o.attributes.phone),1)])):Ge("",!0),k(Si)("fax",o,1)?(U(),oe("span",tRe,[r[2]||(r[2]=P("i",{class:"fa fa-fax","aria-hidden":"true"},null,-1)),P("span",null,K(o.attributes.fax),1)])):Ge("",!0),k(Si)("email",o,1)?(U(),oe("span",nRe,[r[3]||(r[3]=P("i",{class:"fa fa-at","aria-hidden":"true"},null,-1)),P("span",null,K(o.attributes.email),1)])):Ge("",!0),k(Si)("website",o,3)&&o.attributes.website.startsWith("http")?(U(),oe("span",iRe,[P("a",{target:"_blank",href:o.attributes.website},K(o.attributes.website),9,rRe)])):Ge("",!0),k(Si)("website",o,3)&&!o.attributes.website.startsWith("http")?(U(),oe("span",sRe,[P("a",{target:"_blank",href:"http://"+o.attributes.website},K(o.attributes.website),9,oRe)])):Ge("",!0),k(t).language!="fr"&&k(Si)("link_de",o,3)?(U(),oe("span",aRe,[P("a",{target:"_blank",href:o.attributes.link_de},K(o.attributes.link_de),9,lRe)])):Ge("",!0),k(t).language=="fr"&&k(Si)("link_fr",o,3)?(U(),oe("span",uRe,[P("a",{target:"_blank",href:o.attributes.link_fr},K(o.attributes.link_fr),9,cRe)])):Ge("",!0),k(Si)("Bild",o,3)?(U(),oe("span",hRe,[P("img",{src:o.attributes.Bild,width:"250"},null,8,dRe)])):Ge("",!0),k(Si)("longueur sentier",o,0)?(U(),oe("div",fRe,[P("span",null,K(k(e)("Longueur du sentier :")),1),P("span",null,K(o.attributes["longueur sentier"]),1)])):Ge("",!0),mt(ud,{feature:o,onExport:r[0]||(r[0]=s=>i.$emit("export",s))},null,8,["feature"])]),_:1},8,["layers","currentUrl"]))}}),gRe=is(pRe,[["__scopeId","data-v-e980fdd2"]]),mRe={key:0},yRe={key:1},_Re={key:2},vRe={key:3},bRe={key:4},xRe={key:5},IRe={key:6},CRe={key:7},wRe={key:8},ARe={key:9},SRe={key:10},ERe={key:11},TRe={key:12},RRe=["href"],MRe={key:13},kRe=["href"],LRe={key:14},PRe=["src"],GRe={key:15},FRe=st({__name:"npour-wo-address-poi-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{t:e}=Ct(),{i18next:t}=Ct();return(i,r)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:o})=>[k(t).language=="de"&&k(Si)("title_de",o,0)?(U(),oe("h3",mRe,K(o.attributes.title_de),1)):Ge("",!0),k(t).language=="en"&&k(Si)("title_en",o,0)?(U(),oe("h3",yRe,K(o.attributes.title_en),1)):Ge("",!0),k(t).language=="lb"&&k(Si)("title_nl",o,0)?(U(),oe("h3",_Re,K(o.attributes.title_nl),1)):Ge("",!0),k(t).language=="fr"&&k(Si)("title_fr",o,0)?(U(),oe("h3",vRe,K(o.attributes.title_fr),1)):Ge("",!0),k(t).language=="de"&&k(Si)("nom_de",o,0)?(U(),oe("h3",bRe,K(o.attributes.nom_de),1)):Ge("",!0),k(t).language=="fr"&&k(Si)("nom_fr",o,0)?(U(),oe("h3",xRe,K(o.attributes.nom_fr),1)):Ge("",!0),k(t).language=="en"&&k(Si)("nom_en",o,0)?(U(),oe("h3",IRe,K(o.attributes.nom_en),1)):Ge("",!0),k(t).language=="lb"&&k(Si)("nom_lu",o,0)?(U(),oe("h3",CRe,K(o.attributes.nom_lu),1)):Ge("",!0),k(t).language=="de"&&k(Si)("descr_de",o,0)?(U(),oe("span",wRe,K(o.attributes.descr_de),1)):Ge("",!0),k(t).language=="fr"&&k(Si)("descr_fr",o,0)?(U(),oe("span",ARe,K(o.attributes.descr_fr),1)):Ge("",!0),k(t).language=="en"&&k(Si)("descr_en",o,0)?(U(),oe("span",SRe,K(o.attributes.descr_en),1)):Ge("",!0),k(t).language=="lb"&&k(Si)("descr_nl",o,0)?(U(),oe("span",ERe,K(o.attributes.descr_nl),1)):Ge("",!0),k(t).language!="fr"&&k(Si)("link_de",o,3)?(U(),oe("span",TRe,[P("a",{target:"_blank",href:o.attributes.link_de},K(o.attributes.link_de),9,RRe)])):Ge("",!0),k(t).language=="fr"&&k(Si)("link_fr",o,3)?(U(),oe("span",MRe,[P("a",{target:"_blank",href:o.attributes.link_fr},K(o.attributes.link_fr),9,kRe)])):Ge("",!0),k(Si)("Bild",o,3)?(U(),oe("span",LRe,[P("img",{src:o.attributes.Bild,width:"250"},null,8,PRe)])):Ge("",!0),k(Si)("longueur sentier",o,0)?(U(),oe("div",GRe,[P("span",null,K(k(e)("Longueur du sentier :")),1),P("span",null,K(o.attributes["longueur sentier"]),1)])):Ge("",!0)]),_:1},8,["layers","currentUrl"]))}}),ORe=is(FRe,[["__scopeId","data-v-83fc1248"]]),NRe=["href"],DRe={key:1},VRe=["href"],BRe=st({__name:"pcn-pag-template",props:{layers:{},currentUrl:{}},setup(n){const e="https://migration.geoportail.lu/pagreport",{t}=Ct();return(i,r)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"layer-content":Xt(()=>[n.layers.features.length?(U(),oe("a",{key:0,class:"lux-btn",download:"",href:`${k(e)}/${k(ESe)(n.layers.features,"OBJECTID",",")}.pdf`,target:"_blank"},K(k(t)("Generer un rapport pour toutes les selections")),9,NRe)):(U(),oe("span",DRe,K(k(t)("Aucune information disponible pour cette couche")),1))]),"feature-content":Xt(({feature:o})=>[P("span",null,K(k(t)("Identifiant")),1),Bt(" : "+K(o.attributes.OBJECTID),1),r[0]||(r[0]=P("br",null,null,-1)),P("a",{class:"lux-btn",download:"",href:`${k(e)}/${o.attributes.OBJECTID}.pdf`,target:"_blank"},K(k(t)("Generer Rapport (peut prendre 30 sec)")),9,VRe)]),_:1},8,["layers","currentUrl"]))}}),ZRe={class:"lux-poi-title"},WRe={class:"lux-feature-info"},zRe={class:"poi-feature"},URe={class:"pag-form-container"},XRe={class:"pag-mail"},YRe={class:"pag-checkbox"},HRe=["innerHTML"],KRe=st({__name:"pag-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{authenticated:e,currentUser:t}=xt(Du()),r=n.layers,{addNotification:o}=ns(),s=Ke(""),l=At(()=>e.value&&t.value?.mail||"");s.value=l.value;const u=Ke(!1),{t:h}=Ct(),d="https://migration.geoportail.lu/pag";function m(x,C,w){return x.map(function(S){return S.attributes[C]}).join(w)}async function y(){if(!s.value&&!/^\S+@\S+\.\S+$/.test(s.value)){o(h("Veuillez saisir une adresse email valide"),mi.WARNING);return}if(!u.value){o(h("Veuillez accepter les termes du rapport"),mi.WARNING);return}const x=new URLSearchParams({email:s.value,staging:"false"});fetch(d+"/report/"+m(r.features,"OBJECTID",",")+".pdf",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:x}),o(h("Votre rapport est en train d'tre gnr. Un email vous sera envoy  l'adresse {{email}} ds qu'il sera disponible",{email:s.value,ns:"client"}),mi.INFO)}return(x,C)=>(U(),oe(Et,null,[P("h1",ZRe,K(k(h)(k(r).layerLabel)),1),P("div",WRe,[P("div",zRe,[P("label",null,K(k(h)("Ici vous pouvez commander le rapport relatif aux rgles urbanistiques applicables au terrain sctionn")),1),C[3]||(C[3]=P("br",null,null,-1)),C[4]||(C[4]=P("br",null,null,-1)),P("div",URe,[P("div",XRe,[P("label",null,K(k(h)("Adresse Email")),1),Sn(P("input",{type:"text","onUpdate:modelValue":C[0]||(C[0]=w=>s.value=w),style:{width:"165px"}},null,512),[[Zr,s.value]])]),P("div",YRe,[Sn(P("input",{type:"checkbox","onUpdate:modelValue":C[1]||(C[1]=w=>u.value=w),id:"terms"},null,512),[[Yh,u.value]]),P("label",{for:"terms",innerHTML:k(h)("En cochant cette case, l'utilisateur dclare avoir lu, compris et accept les <a target='_blank' rel='noopener noreferrer' href='https://files.geoportail.lu/pag/Disclaimer.pdf'>conditions gnrales d'utilisation </a>de ce site web")},null,8,HRe)])]),P("button",{class:"lux-btn-grey",onClick:C[2]||(C[2]=w=>y()),target:"_blank"},K(k(h)("Commander rapport")),1)])])],64))}}),jRe=is(KRe,[["__scopeId","data-v-d5f704f5"]]),$Re={class:"lux-poi-title"},JRe={class:"lux-feature-info"},qRe={class:"poi-feature"},QRe={class:"pag-form-container"},eMe={class:"pag-mail"},tMe={class:"pag-checkbox"},nMe=["innerHTML"],iMe=st({__name:"pag-staging-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{authenticated:e,currentUser:t}=xt(Du()),r=n.layers,{addNotification:o}=ns(),s=Ke(""),l=At(()=>e.value&&t.value?.mail||"");s.value=l.value;const u=Ke(!1),{t:h}=Ct(),d="https://migration.geoportail.lu/pag";function m(x,C,w){return x.map(function(S){return S.attributes[C]}).join(w)}async function y(){if(!s.value&&!/^\S+@\S+\.\S+$/.test(s.value)){o(h("Veuillez saisir une adresse email valide"),mi.WARNING);return}if(!u.value){o(h("Veuillez accepter les termes du rapport"),mi.WARNING);return}const x=new URLSearchParams({email:s.value,staging:"true"});fetch(d+"/report/"+m(r.features,"OBJECTID",",")+".pdf",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:x}),o(h("Votre rapport est en train d'tre gnr. Un email vous sera envoy  l'adresse {{email}} ds qu'il sera disponible",{email:s.value,ns:"client"}),mi.INFO)}return(x,C)=>(U(),oe(Et,null,[P("h1",$Re,K(k(h)(k(r).layerLabel)),1),P("div",JRe,[P("div",qRe,[P("label",null,K(k(h)("Ici vous pouvez commander le rapport relatif aux rgles urbanistiques applicables au terrain sctionn")),1),C[3]||(C[3]=P("br",null,null,-1)),C[4]||(C[4]=P("br",null,null,-1)),P("div",QRe,[P("div",eMe,[P("label",null,K(k(h)("Adresse Email")),1),Sn(P("input",{type:"text","onUpdate:modelValue":C[0]||(C[0]=w=>s.value=w),style:{width:"165px"}},null,512),[[Zr,s.value]])]),P("div",tMe,[Sn(P("input",{type:"checkbox","onUpdate:modelValue":C[1]||(C[1]=w=>u.value=w),id:"terms"},null,512),[[Yh,u.value]]),P("label",{for:"terms",innerHTML:k(h)("En cochant cette case, l'utilisateur dclare avoir lu, compris et accept les <a target='_blank' rel='noopener noreferrer' href='https://files.geoportail.lu/pag/Disclaimer.pdf'>conditions gnrales d'utilisation </a>de ce site web")},null,8,nMe)])]),P("button",{class:"lux-btn-grey",onClick:C[2]||(C[2]=w=>y()),target:"_blank"},K(k(h)("Commander rapport")),1)])])],64))}}),rMe=is(iMe,[["__scopeId","data-v-5ecbf7b0"]]),sMe={class:"lux-poi-title"},oMe={class:"lux-feature-info"},aMe={class:"poi-feature"},lMe={class:"pds-form-container"},uMe={class:"pds-mail"},cMe=st({__name:"pds-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const{authenticated:e,currentUser:t}=xt(Du()),r=n.layers,{addNotification:o}=ns(),s=Ke(""),l=At(()=>e.value&&t.value?.mail||"");s.value=l.value;const{t:u}=Ct(),h="https://migration.geoportail.lu/pds";function d(y,x,C){return y.map(function(w){return w.attributes[x]}).join(C)}async function m(){if(!s.value&&!/^\S+@\S+\.\S+$/.test(s.value)){o(u("Veuillez saisir une adresse email valide"),mi.WARNING);return}const y=new URLSearchParams({email:s.value,staging:"false"});fetch(h+"/report/"+d(r.features,"textstring",",")+".pdf",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:y}),o(u("Votre attestation est en train d'tre gnr. Un email vous sera envoy  l'adresse {{email}} ds qu'il sera disponible",{email:s.value,ns:"client"}),mi.INFO)}return(y,x)=>(U(),oe(Et,null,[P("h1",sMe,K(k(u)(k(r).layerLabel)),1),P("div",oMe,[P("div",aMe,[P("label",null,K(k(u)(`Ici vous pouvez commander l'attestation "plans directeurs sectoriels" par rapport au terrain sctionn`)),1),x[2]||(x[2]=P("br",null,null,-1)),x[3]||(x[3]=P("br",null,null,-1)),P("div",lMe,[P("div",uMe,[P("label",null,K(k(u)("Adresse Email")),1),Sn(P("input",{type:"text","onUpdate:modelValue":x[0]||(x[0]=C=>s.value=C),style:{width:"165px"}},null,512),[[Zr,s.value]])])]),P("button",{class:"lux-btn-grey",onClick:x[1]||(x[1]=C=>m()),target:"_blank"},K(k(u)("Commander rapport")),1)])])],64))}}),hMe=is(cMe,[["__scopeId","data-v-eadcbafd"]]),dMe=["src"],fMe=st({__name:"pegel-template",props:{layers:{},currentUrl:{}},setup(n){return(e,t)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:i})=>[P("h3",null,K(i.attributes.Nom),1),P("iframe",{width:"300",height:"1500",frameborder:"0",src:k(Iz)("http://geoportail.eau.etat.lu/pdf/112/"+i.attributes.Nom+".html")},null,8,dMe)]),_:1},8,["layers","currentUrl"]))}}),pMe=st({__name:"remembrements-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("span",null,K(k(e)("Nom")),1),Bt(" : "+K(r.attributes.K_NAME),1),i[0]||(i[0]=P("br",null,null,-1)),P("span",null,K(k(e)("Statut")),1),i[1]||(i[1]=Bt(" : ",-1)),P("span",null,K(k(e)("rem_status_"+r.attributes.K_STATUS)),1),i[2]||(i[2]=P("br",null,null,-1)),P("span",null,K(k(e)("Type")),1),i[3]||(i[3]=Bt(" : ",-1)),P("span",null,K(k(e)("rem_typ_"+r.attributes.K_TYP)),1)]),_:1},8,["layers","currentUrl"]))}}),gMe={key:0,class:"my-3"},mMe=["href"],yMe={key:1},_Me=st({__name:"sentier-nature-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const e=n,t="https://migration.geoportail.lu/downloadresource",{t:i}=Ct();function r(o){return`${e.currentUrl}&fid=${e.layers.layer}_${o.attributes.id_qr}`}return(o,s)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl,getDirectLink:r},{"feature-content":Xt(({feature:l})=>[P("h4",null,K(l.attributes.sentier),1),k(bf)(l)?(U(),oe(Et,{key:0},[P("div",null,[P("label",null,K(k(i)("Longueur du parcours")),1),s[1]||(s[1]=Bt(" : ",-1)),P("span",null,K(l.attributes.formatted_length),1),l.attributes.link?(U(),oe("div",gMe,[P("a",{class:"lux-btn py-2",href:`${k(t)}?fid=${n.layers.layer}_${l.attributes.objectid}&attribute=link&id_attribute=objectid`,target:"_blank"},K(k(i)("Tlcharger la brochure")),9,mMe)])):Ge("",!0)]),mt(ud,{feature:l,onExport:s[0]||(s[0]=u=>o.$emit("export",u))},null,8,["feature"])],64)):(U(),oe("div",yMe,K(k(i)("Aucune information disponible pour cette couche")),1))]),_:1},8,["layers","currentUrl"]))}}),vMe={class:"text-white text-3xl"},bMe=["href"],xMe=["src"],IMe=st({__name:"urplang-template",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("h2",vMe,K(r.attributes.nom_commune)+" "+K(r.attributes.section)+" "+K(r.attributes.feuille),1),r.attributes.thumb?(U(),oe(Et,{key:0},[P("a",{href:r.attributes.path,target:"_blank"},[P("img",{src:r.attributes.thumb,width:"250"},null,8,xMe)],8,bMe),P("span",null,K(k(e)("Cliquez dans l'image pour agrandir")),1)],64)):Ge("",!0)]),_:1},8,["layers","currentUrl"]))}}),CMe=st({__name:"viti-flik",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("span",null,K(k(e)("Numero FLIK")),1),Bt(" : "+K(r.attributes.CODE_ELEM)+K(r.attributes.FLIK),1),i[0]||(i[0]=P("br",null,null,-1)),P("span",null,K(k(e)("Commune cadastrale")),1),Bt(" : "+K(r.attributes.CODE_COM),1),i[1]||(i[1]=P("br",null,null,-1)),P("span",null,K(k(e)("Section cadastrale")),1),Bt(" : "+K(r.attributes.CODE_SECT),1),i[2]||(i[2]=P("br",null,null,-1)),P("span",null,K(k(e)("Surface")),1),Bt(" : "+K(r.attributes.F_Area_2021)+" a ",1)]),_:1},8,["layers","currentUrl"]))}}),wMe=st({__name:"viti-kleinlage",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("span",null,K(k(e)("Nom")),1),Bt(" : "+K(r.attributes.kleinlage),1)]),_:1},8,["layers","currentUrl"]))}}),AMe=st({__name:"viti-name",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("span",null,K(k(e)("Nom")),1),Bt(" : "+K(r.attributes.grosslage),1)]),_:1},8,["layers","currentUrl"]))}}),SMe=st({__name:"viti-parcels",props:{layers:{},currentUrl:{}},setup(n){const{t:e}=Ct();return(t,i)=>(U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:r})=>[P("span",null,K(k(e)("Numero")),1),Bt(" : V"+K(r.attributes.Weinbergsn),1),i[0]||(i[0]=P("br",null,null,-1)),P("span",null,K(k(e)("Commune")),1),Bt(" : "+K(r.attributes.CODE_COM),1),i[1]||(i[1]=P("br",null,null,-1)),P("span",null,K(k(e)("Section")),1),Bt(" : "+K(r.attributes.CODE_SECT),1),i[2]||(i[2]=P("br",null,null,-1))]),_:1},8,["layers","currentUrl"]))}}),EMe={key:0,class:"mt-2 mb-3"},TMe=["src"],RMe={class:"flex flex-row justify-end"},MMe=["href"],kMe=["href"],LMe=st({__name:"info-feature-measurement-modale",props:{measurement:{}},setup(n){const e=n,t="https://migration.geoportail.lu/previewmeasurement",i="https://migration.geoportail.lu/downloadmeasurement",{t:r,i18next:o}=Ct(),s=At(()=>jm.sanitizeUrl(t+"?document_id="+e.measurement.document_id));return(l,u)=>n.measurement?(U(),Mt(Rf,{key:0,footer:!0,"max-height":!0,title:k(r)("Prvisualisation du mesurage"),onClose:u[1]||(u[1]=h=>l.$emit("close"))},{content:Xt(()=>[n.measurement.isDownloadable?Ge("",!0):(U(),oe("p",EMe,K(k(r)("Pour des raisons de protection de donnes, nous ne pouvons pas afficher les documents de la mensuration officielle en rsolution complte, par contre vous avez la possibilit de les commander de manire individuelle et traable")),1)),s.value?(U(),oe("img",{key:1,src:s.value},null,8,TMe)):Ge("",!0)]),footer:Xt(()=>[P("div",RMe,[P("button",{type:"button",class:"lux-btn","data-dismiss":"modal",onClick:u[0]||(u[0]=h=>l.$emit("close"))},K(k(r)("Annuler")),1),n.measurement.is_downloadable?(U(),oe("a",{key:1,class:"lux-btn ml-3",target:"_blank",href:`${k(i)}?document_id=${n.measurement.document_id}`},K(k(r)("Tlcharger")),9,kMe)):(U(),oe("a",{key:0,class:"lux-btn ml-3",target:"_blank",href:`https://commande.geoportail.lu?&camefrom=mapv3&lang=${k(o).language}&documents=MESURAGE;EXTRAIT_MIXTE&ids=['${n.measurement.parcelId}']&remark=${n.measurement.description}`},K(k(r)("Commander")),9,MMe))])]),_:1},8,["title"])):Ge("",!0)}}),PMe={key:0},GMe={key:0,class:"flex"},FMe={key:1,class:"flex"},OMe={class:"flex"},NMe={key:2},DMe=["href"],VMe={key:3},BMe=["href"],ZMe={class:"list-disc pl-6"},WMe=["onClick"],zMe=["href"],UMe=["href"],XMe=["href"],YMe=st({__name:"parcels-template",props:{layers:{},currentUrl:{}},setup(n){const e="https://migration.geoportail.lu/downloadmeasurement",{t}=Ct(),i=Ke();function r(s){i.value=s}function o(){i.value=void 0}return(s,l)=>(U(),oe(Et,null,[i.value?(U(),Mt(LMe,{key:0,measurement:i.value,onClose:o},null,8,["measurement"])):Ge("",!0),mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:u})=>[u.attributes.PF?(U(),oe(Et,{key:1},[P("h2",null,K(u.attributes.PF.mainNumber)+"/"+K(u.attributes.PF.additionalNumber),1),P("span",null,K(k(t)("Commune")),1),Bt(" : "+K(u.attributes.PF.townName),1),l[1]||(l[1]=P("br",null,null,-1)),P("span",null,K(k(t)("Section")),1),Bt(" : "+K(u.attributes.PF.sectionDesignation),1),l[2]||(l[2]=P("br",null,null,-1)),P("span",null,K(k(t)("Numero cadastral")),1),Bt(" : "+K(u.attributes.PF.mainNumber)+"/"+K(u.attributes.PF.additionalNumber),1),l[3]||(l[3]=P("br",null,null,-1)),P("span",null,K(k(t)("Contenance")),1),Bt(" : "+K(u.attributes.PF.capacity),1),l[4]||(l[4]=P("br",null,null,-1)),P("span",null,K(k(t)("Lieudit")),1),Bt(" : "+K(u.attributes.PF.locality),1),l[5]||(l[5]=P("br",null,null,-1)),u.attributes.PF.farmingTypes&&Object.keys(u.attributes.PF.farmingTypes).length>0?(U(),oe("div",GMe,[P("span",null,K(k(t)("Nature")),1),Bt(" : "+K(k(d3)(u.attributes.PF.farmingTypes,"pf")),1)])):Ge("",!0),u.attributes.PF.occupations&&Object.keys(u.attributes.PF.occupations).length>0?(U(),oe("div",FMe,[P("span",null,K(k(t)("Occupation")),1),Bt(" : "+K(k(d3)(u.attributes.PF.occupations,"pf")),1)])):Ge("",!0),P("div",OMe,[P("span",null,K(k(t)("Dernier mesurage")),1),Bt(" : "+K(u.attributes.PF.measurementNumber),1)]),k(qx)("go")?(U(),oe("div",NMe,[P("a",{class:"lux-btn inline-block mb-1",href:`https://shop.geoportail.lu/Portail/express_mesurage/?ids=['${u.attributes.textstring}']&camefrom=mapv3_go&lang=${k(Wn).language}`,target:"_blank"},K(k(t)("Constitution de dossier de mesurage")),9,DMe)])):Ge("",!0),k(qx)("go")||k(qx)("prof")||k(qx)("municipalities")?(U(),oe("div",VMe,[P("a",{class:"lux-btn inline-block mb-1",href:`https://xxpfo.intranet.etat.lu/xxpfoi/detail_parcelle.do?noParcelle=${u.attributes.textstring}`,target:"_blank"},K(k(t)("Ouvrir la PF")),9,BMe)])):Ge("",!0),P("span",null,K(k(t)("Lien vers les mesurages")),1),l[6]||(l[6]=Bt(" : ",-1)),P("ul",ZMe,[(U(!0),oe(Et,null,yi(u.attributes.measurements,h=>(U(),oe("li",{key:h.measurementNumber},[h.document_id?(U(),oe(Et,{key:0},[P("a",{class:"cursor-pointer",target:"_blank",onClick:d=>r(h)},"No "+K(h.measurementNumber)+" "+K(k(t)("MESURAGE_"+h.description))+" "+K(k(_M)(h.date_document)),9,WMe),h.is_downloadable?(U(),oe("a",{key:0,target:"_blank",href:`${k(e)}?document_id=${h.document_id}`},[...l[0]||(l[0]=[P("i",{class:"fa fa-download","aria-hidden":"true"},null,-1)])],8,zMe)):Ge("",!0)],64)):(U(),oe(Et,{key:1},[P("span",null,K(k(t)("Mesurage non disponible")),1),Bt(" : "+K(h.measurementNumber),1)],64))]))),128))]),P("a",{class:"lux-btn inline-block mb-1",href:`https://historique.geoportail.lu/?id=${u.attributes.textstring}`,target:"_blank"},K(k(t)("Historique de la parcelle")),9,UMe),P("a",{class:"lux-btn inline-block mb-1",href:`https://commande.geoportail.lu/?ids=['${u.attributes.textstring}']&camefrom=mapv3&lang=${k(Wn).language}`,target:"_blank"},K(k(t)("Commander un extrait")),9,XMe)],64)):(U(),oe("div",PMe,K(k(t)("No parcel data available")),1))]),_:1},8,["layers","currentUrl"])],64))}}),aE=is(YMe,[["__scopeId","data-v-54005743"]]),HMe={key:0},KMe={key:0},jMe={key:0},$Me={key:1},JMe=["href"],qMe={key:1},QMe={key:0,class:"ng-hide"},eke=["href"],tke={key:0},nke={key:2},ike=st({__name:"default-attachment-no-prefix-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const e="https://migration.geoportail.lu/downloadpdf",{t}=Ct();return(i,r)=>{const o=Tl("dompurify-html");return U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:s})=>[s.attributes.label?(U(),oe("h4",HMe,K(k(t)(s.attributes.label)),1)):Ge("",!0),k(bf)(s)?(U(),oe(Et,{key:1},[(U(!0),oe(Et,null,yi(k($y)(s.attributes,n.layers.ordered,""),l=>(U(),oe("div",{key:l.key},[!["has_sketch","sketches"].includes(l.key)&&!k(sg)(l.value)&&k(Fb)(l,n.layers.layer,k(Wn).language)?(U(),oe("span",KMe,[k(ko)(l.value)?Ge("",!0):(U(),oe("div",jMe,[P("label",null,K(k(t)(l.key))+" : ",1),Sn(P("span",null,null,512),[[o,l.value]])])),k(ko)(l.value)?(U(),oe("div",$Me,[r[1]||(r[1]=P("label",null,null,-1)),P("a",{href:l.value,target:"_blank"},K(k(t)(l.key)),9,JMe)])):Ge("",!0)])):["sketches"].includes(l.key)?(U(),oe("span",qMe,[P("label",null,K(k(t)("Attachment"))+" : ",1),s.attributes.has_sketch?(U(),oe("span",QMe,[P("ul",null,[(U(!0),oe(Et,null,yi(s.attributes.sketches,u=>(U(),oe("li",{key:u.id},[P("a",{class:"no-print",target:"_blank",download:"",href:`${k(e)}?fid=${s.fid}&sketch_id=${u.id}`},K(k(t)(u.name)),9,eke)]))),128))])])):Ge("",!0)])):Ge("",!0)]))),128)),n.layers.has_profile?(U(),oe("div",tke,[mt(ud,{feature:s,onExport:r[0]||(r[0]=l=>i.$emit("export",l))},null,8,["feature"])])):Ge("",!0)],64)):(U(),oe("div",nke,[P("span",null,K(k(t)("Aucune information disponible pour cette couche")),1)]))]),_:1},8,["layers","currentUrl"])}}}),rke={key:0},ske={key:0},oke={key:0},ake={key:1},lke=["href"],uke={key:1},cke={key:0,class:"ng-hide"},hke=["href"],dke={key:0},fke={key:2},pke=st({__name:"default-attachment-template",props:{layers:{},currentUrl:{}},emits:["export"],setup(n){const e="https://migration.geoportail.lu/downloadpdf",{t}=Ct();return(i,r)=>{const o=Tl("dompurify-html");return U(),Mt(or,{layers:n.layers,currentUrl:n.currentUrl},{"feature-content":Xt(({feature:s})=>[s.attributes.label?(U(),oe("h4",rke,K(k(t)(s.attributes.label)),1)):Ge("",!0),k(bf)(s)?(U(),oe(Et,{key:1},[(U(!0),oe(Et,null,yi(k($y)(s.attributes,n.layers.ordered),l=>(U(),oe("div",{key:l.key},[!["f_has_sketch","f_sketches"].includes(l.key)&&!k(sg)(l.value)&&k(Fb)(l,n.layers.layer,k(Wn).language)?(U(),oe("span",ske,[k(ko)(l.value)?Ge("",!0):(U(),oe("div",oke,[P("label",null,K(k(t)(l.key))+" : ",1),Sn(P("span",null,null,512),[[o,l.value]])])),k(ko)(l.value)?(U(),oe("div",ake,[r[1]||(r[1]=P("label",null,null,-1)),P("a",{href:l.value,target:"_blank"},K(k(t)(l.key)),9,lke)])):Ge("",!0)])):["f_sketches"].includes(l.key)?(U(),oe("span",uke,[P("label",null,K(k(t)("Fichier  tlcharger"))+" : ",1),s.attributes.has_sketch?(U(),oe("span",cke,[P("ul",null,[(U(!0),oe(Et,null,yi(s.attributes.sketches,u=>(U(),oe("li",{key:u.id},[P("a",{class:"no-print",target:"_blank",download:"",href:`${k(e)}?fid=${s.fid}&sketch_id=${u.id}`},K(k(t)(u.name)),9,hke)]))),128))])])):Ge("",!0)])):Ge("",!0)]))),128)),n.layers.has_profile?(U(),oe("div",dke,[mt(ud,{feature:s,onExport:r[0]||(r[0]=l=>i.$emit("export",l))},null,8,["feature"])])):Ge("",!0)],64)):(U(),oe("div",fke,[P("span",null,K(k(t)("Aucune information disponible pour cette couche")),1)]))]),_:1},8,["layers","currentUrl"])}}}),gke=st({__name:"feature-info",props:{content:{type:Array,required:!0}},setup(n){const e=window.location.href,t=Kn().getOlMap(),{featureInfoPrintableRef:i}=xt(Tk()),r=h=>i.value=h,o={"adresse.html":kSe,"aero.html":FSe,"affaires.html":OSe,"asta_esp.html":VSe,"automatic_sols.html":eEe,"batiments.html":tEe,"bus_wo_title.html":iEe,"bus.html":sEe,"casipo.html":pEe,"default.html":f3,"default_attachment.html":pke,"default_attachment_no_prefix.html":ike,"default_table.html":WEe,"default_table_no_prefix.html":qEe,"flik.html":QEe,"forage_virtuel.html":oTe,"lignes_bus.html":gTe,"meteo.html":yTe,"meteolux_europe.html":_Te,"meteolux_gr.html":vTe,"mymaps.html":TTe,"mo.html":MTe,"ng95.html":GTe,"ng95_new.html":DTe,"npour_poi.html":gRe,"npour_poi_wo_address.html":ORe,"parcels.html":aE,"parcels_prof.html":aE,"parcels_go.html":aE,"pcn_pag.html":BRe,"pag.html":jRe,"pag_staging.html":rMe,"pds.html":hMe,"pegel.html":fMe,"remembrements.html":pMe,"sentier_nature.html":_Me,"urplang.html":IMe,"viti_flik.html":CMe,"viti_kleinlage.html":wMe,"viti_name.html":AMe,"viti_parcels.html":SMe},s=h=>o[h]||f3;function l(h){h.feature.attributes&&!h.feature.properties&&(h.feature.properties=h.feature.attributes);const d=new Jl().readFeature(h.feature,{dataProjection:tu,featureProjection:t.getView().getProjection()});gA.export(t,h.format,[d],h.feature.attributes.name||h.format,!0)}function u(...h){const[d]=h;l(d)}return(h,d)=>n.content&&n.content.length?(U(),oe("div",{key:0,ref:r,class:"absolute w-11/12"},[(U(!0),oe(Et,null,yi(n.content,(m,y)=>(U(),Mt(sb(s(m.template)),{key:y,layers:m,currentUrl:k(e),onExport:u},null,40,["layers","currentUrl"]))),128))])):Ge("",!0)}}),mke={key:0,"data-cy":"locationInfo",class:"absolute"},yke={key:1,class:"text-white absolute"},_ke={class:"flex flex-col gap-3 mr-5 mt-4 italic"},vke=st({__name:"info-panel",setup(n){const{t:e}=Ct(),t=oi(),{locationInfoCoords:i}=xt(rg()),r=Kn().olMap,{infoOpen:o}=xt(t),{clearContent:s}=tg(),{featureInfoPanelContent:l,isLoading:u}=xt(tg());return kt(o,h=>{h||s()}),(h,d)=>(U(),Mt(pg,{"data-cy-value":"infoPanel","close-fn":()=>k(t).toggleInfoOpen(!1)},{header:Xt(()=>[P("h1",null,K(k(e)("infos",{ns:"client"})),1)]),content:Xt(()=>[k(r)?Sn((U(),oe("div",mke,[mt(e_e)],512)),[[zp,k(i)]]):Ge("",!0),!k(i)&&!k(l)?(U(),oe("div",yke,[P("ul",_ke,[P("li",null,K(k(e)("A right click (tap and hold on mobile)...",{ns:"app"})),1),P("li",null,K(k(e)("A short click (tap on mobile)...",{ns:"app"})),1)])])):Ge("",!0),k(l)&&!k(u)?(U(),Mt(gke,{key:2,content:k(l)},null,8,["content"])):Ge("",!0)]),_:1},8,["close-fn"]))}}),bke={class:"text-white"},xke={key:0,class:"small"};const Ike=["checked","onChange"],Cke=st({__name:"lidar-config-panel",setup(n){const e=oi(),{t,i18next:i}=Ct(),r=tb(),{drawLidarActive:o,profileWidth:s,measureActive:l}=xt(r);function u(G,N){return["fr","en","de","lb"].includes(N)?G[N]:G.en}const h=r.lidarConfig.serverConfig.classification_colors;let d=cz();gr(()=>{d.init()});function m(){d.exportCsv()}function y(){d.exportPng()}function x(){d.exportLas()}function C(){d.resetPlot()}function w(){l.value=!l.value,l.value?S():T()}function S(){d.setMeasureActive()}function T(){l.value=!1,d.clearMeasure()}function M(G){G.visible=(G.visible+1)%2,d.updateData()}return(G,N)=>(U(),Mt(pg,{"data-cy-value":"lidarPanel","close-fn":()=>k(e).toggleLidarOpen(!1)},{header:Xt(()=>[P("h1",null,K(k(t)("lidar",{ns:"client"})),1)]),content:Xt(()=>[P("div",bke,[P("p",null,[P("button",{class:Dn(["lux-btn mt-3",{active:k(o)}]),onClick:N[0]||(N[0]=V=>o.value=!k(o))},K(k(t)("Draw a lidar profile")),3)]),P("p",null,[Bt(K(k(t)("Profile width"))+" ",1),Sn(P("input",{type:"number",min:"0",max:"1000","onUpdate:modelValue":N[1]||(N[1]=V=>Pr(s)?s.value=V:null),style:{width:"5em","margin-right":"1em"}},null,512),[[Zr,k(s),void 0,{number:!0}]]),P("button",{class:"lux-btn mt-3",onClick:C},[...N[2]||(N[2]=[P("span",{class:"fa fa-refresh"},null,-1)])])]),k(o)?(U(),oe("p",xke,[P("em",null,K(k(t)("Draw a line on the map to display the corresponding LIDAR profile. Double clic to confirm.")),1)])):Ge("",!0),Ge("",!0),N[5]||(N[5]=P("hr",{style:{"margin-top":"10px"}},null,-1)),P("div",null,[P("div",null,K(k(t)("Classes")),1),(U(!0),oe(Et,null,yi(k(h),(V,W)=>(U(),oe("div",{key:W,class:"checkbox"},[P("label",null,[P("input",{type:"checkbox",checked:V.visible===1,onChange:j=>M(V)},null,40,Ike),P("span",null,K(u(V.name,k(i).language)),1)])]))),128))])])]),_:1},8,["close-fn"]))}}),wke=is(Cke,[["__scopeId","data-v-4bf93fb6"]]),Ake={class:"feedback-content text-white"},Ske={class:"text-lg font-bold mb-4"},Eke={class:"form-group"},Tke={for:"inputEmail",class:"block mb-2 font-medium"},Rke=["aria-label"],Mke={class:"form-group"},kke={for:"dropdownLayerPicker",class:"block mb-2 font-medium"},Lke={class:"relative"},Pke=["aria-label"],Gke={value:"",disabled:""},Fke=["value"],Oke={class:"form-group"},Nke={for:"inputDescription",class:"block mb-2 font-medium"},Dke=["aria-label"],Vke={class:"text-sm text-gray-200 mt-1","aria-live":"polite","aria-atomic":"true",role:"status"},Bke={"aria-live":"assertive","aria-atomic":"true",class:"sr-only"},Zke={key:0},Wke={class:"form-group text-sm"},zke={class:"mb-2"},Uke=["href"],Xke=["disabled","aria-disabled"],Yke=st({__name:"feedback-panel",setup(n){const e="https://migration.geoportail.lu/feedback",{t}=Ct(),i=oi(),r=Wi(),o=Du(),{addNotification:s}=ns(),{feedbackOpen:l,drawToolbarOpen:u}=xt(i),{layers:h,bgLayer:d}=xt(r),{authenticated:m,currentUser:y}=xt(o),x=Ke(""),C=Ke(""),w=Ke(""),S=Ke(""),T=Ke(!1);kt(l,W=>{W&&(m.value&&y.value?.mail?x.value=y.value.mail:x.value="",w.value="",C.value="",M(),aa(()=>{document.getElementById("inputEmail")?.focus()}))},{immediate:!0});function M(){S.value=jl.getStrippedUrl().toString()}function G(){u.value=!0}async function N(){if(!x.value||!C.value||!w.value){s(t("Please fill all required fields",{ns:"client"}),mi.WARNING);return}T.value=!0;const W={url:S.value,email:x.value,description:C.value,layer:w.value};try{if((await Vs(e,W,"POST","application/json")).ok)s(t('Feedback sent to <a href="mailto:{{email}}">{{email}}</a>',{email:"support@geoportail.lu",ns:"client"}),mi.INFO),i.toggleFeedbackOpen(!1);else throw new Error("Failed to send feedback")}catch{s(t('Feedback could not be sent to <a href="mailto:{{email}}">{{email}}</a>',{email:"support@geoportail.lu",ns:"client"}),mi.ERROR)}finally{T.value=!1}}const V=At(()=>{const W=[];return d.value&&W.push({id:String(d.value.id),name:String(d.value.name)}),h.value.forEach(j=>{W.push({id:String(j.id),name:String(j.name)})}),W});return(W,j)=>(U(),Mt(pg,{"data-cy-value":"feedbackPanel","close-fn":()=>k(i).toggleFeedbackOpen(!1)},{header:Xt(()=>[P("h1",null,K(k(t)("Feedback",{ns:"client"})),1)]),content:Xt(()=>[P("div",Ake,[P("h3",Ske,K(k(t)("Report a map content problem:",{ns:"client"})),1),P("form",{onSubmit:fs(N,["prevent"]),class:"flex flex-col gap-4"},[P("div",Eke,[P("label",Tke,K(k(t)("Your email",{ns:"client"})),1),Sn(P("input",{type:"email",required:"","onUpdate:modelValue":j[0]||(j[0]=J=>x.value=J),class:"w-full px-3 py-2 lux-input",id:"inputEmail","aria-label":k(t)("Your email",{ns:"client"}),"data-cy":"feedbackEmail"},null,8,Rke),[[Zr,x.value]])]),P("div",Mke,[P("label",kke,K(k(t)("Pick layer where problem occurs",{ns:"client"})),1),P("div",Lke,[Sn(P("select",{id:"dropdownLayerPicker","onUpdate:modelValue":j[1]||(j[1]=J=>w.value=J),required:"",class:"w-full px-3 py-2 lux-input appearance-none cursor-pointer","aria-label":k(t)("Pick layer where problem occurs",{ns:"client"}),"data-cy":"feedbackLayerSelect"},[P("option",Gke,K(k(t)("Please pick a layer",{ns:"client"})),1),(U(!0),oe(Et,null,yi(V.value,J=>(U(),oe("option",{key:J.id,value:J.name},K(k(t)(J.name,{ns:"client"})),9,Fke))),128))],8,Pke),[[DN,w.value]]),j[3]||(j[3]=P("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none fa fa-caret-down text-primary","aria-hidden":"true"},null,-1))])]),P("div",Oke,[P("label",Nke,K(k(t)("Describe the problem within the current map extent:",{ns:"client"})),1),Sn(P("textarea",{rows:"5",required:"",maxlength:"500","onUpdate:modelValue":j[2]||(j[2]=J=>C.value=J),class:"w-full px-3 py-2 lux-input resize-none",id:"inputDescription","aria-label":k(t)("Describe the problem within the current map extent:",{ns:"client"}),"data-cy":"feedbackDescription"},null,8,Dke),[[Zr,C.value]]),P("p",Vke,K(C.value.length)+"/500 ",1)]),P("div",Bke,[T.value?(U(),oe("span",Zke,K(k(t)("Sending...",{ns:"client"})),1)):Ge("",!0)]),P("div",Wke,[P("p",zke,[P("a",{href:S.value,target:"_blank",class:"text-blue-400 hover:text-blue-300 underline"},K(k(t)("Click to view the map link that will be sent to our support team",{ns:"client"})),9,Uke)]),P("p",null,[Bt(K(k(t)("You can also use the Drawing Tools to annotate the map and send it to the support team.",{ns:"client"}))+" ",1),P("button",{type:"button",onClick:G,class:"ml-2 text-blue-400 hover:text-blue-300 underline bg-transparent border-0 p-0 cursor-pointer font-normal"},K(k(t)("Open Drawing Tools",{ns:"client"})),1)])]),P("button",{type:"submit",disabled:T.value,"aria-disabled":T.value?"true":"false",class:"lux-btn self-end","data-cy":"feedbackSubmit"},K(T.value?k(t)("Sending...",{ns:"client"}):k(t)("Send feedback to support team",{ns:"client"})),9,Xke)],32)])]),_:1},8,["close-fn"]))}}),Hke={key:0,class:"w-full md:w-80 bg-secondary z-10"},Kke={key:1,class:"w-full md:w-80 bg-secondary z-10"},jke={key:2,class:"w-full md:w-80 bg-secondary z-10"},$ke={key:3,class:"w-full md:w-80 bg-secondary z-10"},Jke={class:"w-full md:w-80 bg-secondary z-10"},qke={key:4,class:"w-full md:w-80 bg-secondary z-10"},Qke={class:"w-full md:w-80 bg-secondary z-10"},eLe=st({__name:"side-panel",setup(n){const e=oi(),{layersOpen:t,legendsOpen:i,myMapsOpen:r,infoOpen:o,lidarOpen:s,feedbackOpen:l,styleEditorOpen:u,themeGridOpen:h,drawToolbarOpen:d}=xt(e);return kt(t,m=>{m&&(s.value=i.value=r.value=u.value=l.value=!1)}),kt(r,m=>{m&&(u.value=t.value=h.value=i.value=o.value=l.value=!1)}),kt(i,m=>{m&&(r.value=u.value=t.value=h.value=o.value=s.value=l.value=!1)}),kt(d,m=>{m&&Pk("md")&&(r.value=!0,t.value=!1,i.value=!1,h.value=!1,o.value=!1,s.value=!1,l.value=!1)}),kt(o,m=>{m&&(r.value=u.value=t.value=h.value=i.value=s.value=l.value=!1)}),kt(l,m=>{m&&(r.value=u.value=t.value=h.value=i.value=s.value=o.value=!1)}),(m,y)=>(U(),oe(Et,null,[k(t)?(U(),oe("div",Hke,[mt(Fve)])):Ge("",!0),k(i)?(U(),oe("div",Kke,[mt(Bve)])):Ge("",!0),k(u)?(U(),oe("div",jke,[mt(Fxe)])):Ge("",!0),k(r)?(U(),oe("div",$ke,[mt(CSe)])):Ge("",!0),Sn(P("div",Jke,[mt(vke)],512),[[zp,k(o)]]),k(l)?(U(),oe("div",qke,[mt(Yke)])):Ge("",!0),Sn(P("div",Qke,[mt(wke)],512),[[zp,k(s)]])],64))}});class tLe{bootstrap(){this.restore()}restore(){const e=Nn.getValue(Ty);if(e){const{setFid:t}=tg();t(e),jl.removeQueryParam(Ty)}}}const nLe=new tLe;function iLe(){const n=oi(),e=ns(),{t}=Ct(),i=Ke(!1);let r=null;const{log:o}=Rb("SW");n.isOffLine=!navigator.onLine;const s=y=>{let x=y;for(;x;){const C=x.getAttribute("data-cy");if(C&&["infoOpenClose","legendsOpenClose","printOpenClose","shareOpenClose","feedbackOpenClose"].includes(C))return!0;x=x.parentElement}return!1},l=()=>{const y=document.querySelector('[data-cy="drawOpenClose"]');return y||document.querySelector(".map-wrapper")},u=()=>{n.isOffLine=!1,r&&document.contains(r)&&setTimeout(()=>{r?.focus(),r=null},100),i.value&&(e.addNotification(t("Connection restored"),mi.INFO,3e3),i.value=!1)},h=()=>{o("[Network] Going OFFLINE - navigator.onLine:",navigator.onLine),n.isOffLine=!0,o("[Network] Set appStore.isOffLine to:",n.isOffLine),i.value=!0;const y=document.activeElement;if(y&&y!==document.body&&s(y)){r=y;const x=l();x&&setTimeout(()=>{x.focus()},100)}};return{initialize:()=>{o("[Network] Initialize - navigator.onLine:",navigator.onLine);const y=!navigator.onLine;n.isOffLine!==y?(n.isOffLine=y,o("[Network] Set initial appStore.isOffLine to:",n.isOffLine)):o("[Network] appStore.isOffLine already set to:",n.isOffLine),window.addEventListener("online",u),window.addEventListener("offline",h),navigator.onLine||(i.value=!0),setTimeout(async()=>{o("[Network] Delayed check - navigator.onLine:",navigator.onLine);try{const x="https://migration.geoportail.lu/ping",C=new AbortController,w=setTimeout(()=>C.abort(),2e3),S=await fetch(x,{method:"HEAD",cache:"no-store",signal:C.signal});if(clearTimeout(w),!S.ok)throw new Error(`HTTP ${S.status}`);o("[Network] Connectivity test: ONLINE"),n.isOffLine&&(o("[Network] Correcting state to online"),u())}catch(x){o("[Network] Connectivity test: OFFLINE",x instanceof Error?x.message:String(x)),n.isOffLine||(o("[Network] Correcting state to offline"),h())}},100)},cleanup:()=>{window.removeEventListener("online",u),window.removeEventListener("offline",h)}}}const rLe={class:"h-screen flex flex-col overflow-hidden"},sLe={role:"status","aria-live":"polite","aria-atomic":"true",class:"sr-only"},oLe={key:0},aLe={class:"flex grow min-h-0"},lLe={class:"map-wrapper grow bg-blue-100 relative"},uLe={class:"absolute right-1 top-16"},cLe={key:0,class:"w-full flex-shrink-0",style:{height:"25rem"}},hLe={key:1,class:"flex grow"},dLe={class:"map-wrapper grow bg-blue-100 relative"},fLe={class:"absolute right-1 top-2"},pLe=st({__name:"App",setup(n){const{t:e}=Ct(),t=oi(),i=Tf(),r=Kn(),o=iLe(),{log:s}=Rb("SW");s("[App.vue] After useNetwork() - appStore.isOffLine:",t.isOffLine,"navigator.onLine:",navigator.onLine),Hxe.bootstrap(),Xxe.bootstrap(),Jxe.bootstrap(),Nxe.bootstrap(),DZ.bootstrap(),zxe.bootstrap(),i.initBackgroundsConfigs(),nLe.bootstrap(),gr(()=>{Ef().init()});const{embedded:l,layersOpen:u,legendsOpen:h,myMapsOpen:d,infoOpen:m,styleEditorOpen:y,lidarOpen:x,isOffLine:C}=xt(t);kt(u,w),kt(h,w),kt(y,w),kt(d,w),kt(m,w),kt(x,w);function w(){setTimeout(()=>r.resize(),50)}return gr(()=>{o.initialize(),window.addEventListener("resize",r.resize)}),Ds(()=>{o.cleanup(),window.removeEventListener("resize",r.resize)}),(S,T)=>(U(),oe("div",rLe,[P("div",sLe,[k(C)?(U(),oe("span",oLe,K(k(e)("You are offline. The following features are unavailable: Info panel, Legends, Routing, Measure tools, Print, Share, and external links.")),1)):Ge("",!0)]),k(l)?(U(),oe("main",hLe,[P("div",dLe,[mt(jO,{v4_standalone:!0})]),P("div",fLe,[mt(SO)])])):(U(),oe(Et,{key:0},[k(C)?(U(),Mt(Rae,{key:0})):(U(),Mt(Iae,{key:1})),P("main",aLe,[mt(eLe),P("div",lLe,[mt(jO,{v4_standalone:!0}),mt(Q1e,{class:"absolute top-0"}),mt(H1e),mt(O_e)]),P("div",uLe,[mt(SO)])]),mt(Ew,{name:"fade"},{default:Xt(()=>[k(x)?(U(),oe("div",cLe,[mt(HCe,{class:"w-full h-full"})])):Ge("",!0)]),_:1}),mt(bCe,{class:"sm:w-full flex-shrink-0 md:h-14 fixed bottom-5 sm:static"}),mt(xye)],64))]))}}),{log:OI,error:p3,warn:wz}=Rb("SW");N4();Wn.use(b3);Wn.init({lng:"fr",debug:!1,defaultNS:"client",returnEmptyString:!1,supportedLngs:["de","en","fr","lb"],ns:["app","client","legends","server","tooltips"],fallbackLng:"en",backend:{loadPath:"/luxembourg-geoportail/builder/assets/locales/{{ns}}.{{lng}}.json"},nsSeparator:!1,keySeparator:!1}).then(()=>{const n=lX(pLe);n.use(BX()),n.use(hX,{i18next:Wn}),n.use(VX),n.use(Ej),n.mount("#app"),Vr().loadThemes()});async function gLe(n){const e={type:"module"};try{return OI("Registering service worker as module:",n),await navigator.serviceWorker.register(n,e)}catch(t){return wz("Module service worker registration failed, retrying as classic script",t),navigator.serviceWorker.register(n)}}function mLe(n){const e=window.setInterval(()=>{n.update()},36e5),t=()=>{window.clearInterval(e),window.removeEventListener("pagehide",t),window.removeEventListener("beforeunload",t)};return window.addEventListener("pagehide",t),window.addEventListener("beforeunload",t),t}"serviceWorker"in navigator?window.addEventListener("load",()=>{gLe("/luxembourg-geoportail/builder/service-worker.js").then(e=>{OI("[SW]  Registered successfully:",e.scope),OI("[SW] State:",e.active?.state);const t=mLe(e);e.addEventListener("updatefound",()=>{const i=e.installing;i&&i.addEventListener("statechange",()=>{i.state==="installed"&&navigator.serviceWorker.controller&&(OI("[SW] New version available"),t())})})}).catch(e=>{p3("[SW]  Registration failed:",e),p3("[SW] Error details:",{name:e.name,message:e.message,stack:e.stack})})}):wz("[SW]  Service Worker not supported in this browser");export{kB as B,LB as E,jM as F,$i as L,Jh as M,Pw as P,yl as R,vLe as V,Oi as a,Mr as b,Jd as c,Nu as d,vf as e,Fo as f,u4 as g,Rw as h,fH as i,Ni as j,Ns as k,KY as l,qa as m,Nh as n,UD as o,ile as p,FC as r,oI as s,nu as t};
